import{dy as it,lZ as rt,aD as W,aE as G,du as q,gJ as Re,aA as nt,iq as ve,ir as Ne,aF as ot,cw as at,bd as f,dj as ct,oZ as ie,kS as lt,kT as dt,dV as Pe,kV as Se,ow as ke,kZ as ut,l5 as gt,az as ht,l7 as pt,l8 as bt,l9 as ft,la as mt,pf as _t,l2 as Q,k8 as $t,lg as Tt,pg as wt,kK as re,ll as Ot,ph as At,ln as Ct,lo as Et,k4 as It,k5 as Rt,oF as vt,kJ as _,kL as Le,hA as Nt,oN as de,nc as Pt,kQ as c,gN as k,nk as ze,nh as L,cc as ne,iN as b,lW as p,pi as Oe,nW as Y,ic as qe,i6 as Z,pj as Xe,kM as w,o$ as Ze,kP as X,oV as v,bQ as oe,ek as U,pk as St,cz as S,kN as K,l4 as ee,kO as kt,o_ as Ue,pl as Me,cI as be,gM as ye,pm as Ve,pn as We,po as xe,pp as Lt,pq as Ye,nm as H,ej as N,nU as Ut,pr as Mt,ps as me,pt as yt,pu as Vt,cB as Wt,ch as xt,mr as Gt,kd as Je,c8 as Ht,nP as Qe,pv as _e,pw as Ge,nS as Bt,px as Ft,b3 as jt}from"./index-cdda5707.js";import{i as B,u as Ke}from"./analysisThemeUtils-8c8dee01.js";import{b as Dt,u as zt,r as qt}from"./LineVisualElement-b4960232.js";import{N as Xt,$ as et,e as C,U as Zt,R as Yt}from"./manipulatorUtils-adaad8cc.js";let O=class extends it(at){constructor(t){super(t),this.type="plane",this.position=null,this.heading=0,this.tilt=0,this.width=10,this.height=10}equals(t){return this.heading===t.heading&&this.tilt===t.tilt&&rt(this.position,t.position)&&this.width===t.width&&this.height===t.height}};W([G({readOnly:!0,json:{read:!1,write:!0}})],O.prototype,"type",void 0),W([G({type:nt}),q()],O.prototype,"position",void 0),W([G({type:Number,nonNullable:!0,range:{min:0,max:360}}),q(),Re(e=>ve.normalize(Ne(e),0,!0))],O.prototype,"heading",void 0),W([G({type:Number,nonNullable:!0,range:{min:0,max:360}}),q(),Re(e=>ve.normalize(Ne(e),0,!0))],O.prototype,"tilt",void 0),W([G({type:Number,nonNullable:!0}),q()],O.prototype,"width",void 0),W([G({type:Number,nonNullable:!0}),q()],O.prototype,"height",void 0),O=W([ot("esri.analysis.SlicePlane")],O);const Jt=O;let Qt=class{constructor(){this.color=B()}},Kt=class{constructor(){this.color=new f([0,0,0,.04]),this.gridColor=B(.5),this.outlineColor=B(.7)}},es=class{constructor(){this.color=B()}},ts=class{constructor(){this.color=B(.5),this.contrastColor=Ke()}},ss=class{constructor(){this.color=Ke(),this.outlineColor=B()}},is=class{constructor(){this.callouts=new Qt,this.plane=new Kt,this.resizeManipulators=new es,this.rotateManipulators=new ts,this.shiftManipulator=new ss}},ae=new is;const Bs=ct("mac")?"Meta":"Control",Fs="Shift",rs=2,ns=1.15,os=1.15,js=2500,Ds=.02,as=Math.cos(ie(45)),He=Math.cos(ie(5)),zs=.95,qs=.3,Xs=2,cs=1,ls=3,tt=11,$e=22.5,se=40,Be=48,ds=2.25,us=4,Fe=1,gs=.3,hs=6,ps=4,je=1600,bs=.4;function fs(e){const t=new lt,{vertex:i,fragment:s,attributes:n,varyings:o}=t;return dt(i,e),n.add(Pe.POSITION,"vec3"),n.add(Pe.UV0,"vec2"),o.add("vUV","vec2"),i.code.add(Se`void main(void) {
vUV = uv0;
gl_Position = proj * view * vec4(position, 1.0);
}`),s.uniforms.add(new ke("backgroundColor",r=>r.backgroundColor),new ke("gridColor",r=>r.gridColor),new ut("gridWidth",r=>r.gridWidth)),s.code.add(Se`void main() {
const float LINE_WIDTH = 1.0;
vec2 uvScaled = vUV * gridWidth;
vec2 gridUV = (fract(uvScaled + 0.5) - 0.5) / (LINE_WIDTH * fwidth(uvScaled));
vec2 grid = (1.0 - step(0.5, gridUV)) * step(-0.5, gridUV);
grid.x *= step(0.5, uvScaled.x) * step(uvScaled.x, gridWidth - 0.5);
grid.y *= step(0.5, uvScaled.y) * step(uvScaled.y, gridWidth - 0.5);
float gridFade = max(grid.x, grid.y);
float gridAlpha = gridColor.a * gridFade;
fragColor =
vec4(backgroundColor.rgb * backgroundColor.a, backgroundColor.a) * (1.0 - gridAlpha) +
vec4(gridColor.rgb, 1.0) * gridAlpha;
}`),t}const ms=Object.freeze(Object.defineProperty({__proto__:null,build:fs},Symbol.toStringTag,{value:"Module"}));class _s extends wt{constructor(){super(...arguments),this.backgroundColor=re(1,0,0,.5),this.gridColor=re(0,1,0,.5),this.gridWidth=4}}class ue extends pt{initializeProgram(t){return new bt(t.rctx,ue.shader.get().build(this.configuration),ft)}initializePipeline(){return mt({blending:_t(Q.ONE,Q.ONE,Q.ONE_MINUS_SRC_ALPHA,Q.ONE_MINUS_SRC_ALPHA),depthTest:{func:$t.LESS},colorWrite:Tt})}}ue.shader=new gt(ms,()=>ht(()=>import("./SlicePlaneMaterial.glsl-182e9036.js"),["./SlicePlaneMaterial.glsl-182e9036.js","./index-cdda5707.js","./index-7772480e.css","./analysisThemeUtils-8c8dee01.js","./colorUtils-c9a97827.js","./LineVisualElement-b4960232.js","./manipulatorUtils-adaad8cc.js","./ImageMaterial-0a3c66dc.js"],import.meta.url));class $s extends Ot{constructor(t){super(t,new ws),this._configuration=new At}createBufferWriter(){return new Ct(Et)}requiresSlot(t,i){return i===It.Color&&t===Rt.TRANSPARENT_DEPTH_WRITE_DISABLED_MATERIAL}createGLMaterial(t){return new Ts(t)}getConfiguration(){return this._configuration}}class Ts extends vt{constructor(t){super(t),this.ensureTechnique(ue,null)}beginSlot(){return this.technique}}class ws extends _s{constructor(){super(...arguments),this.renderOccluded=_.Occlude}}class Os extends Dt{constructor(t){super(t),this._material=null,this._renderOccluded=_.OccludeAndTransparent,this._gridWidth=1,this._gridColor=re(1,0,0,1),this._backgroundColor=re(1,0,0,1),this.applyProps(t)}get renderOccluded(){return this._renderOccluded}set renderOccluded(t){t!==this._renderOccluded&&(this._renderOccluded=t,this._updateMaterial())}get gridWidth(){return this._gridWidth}set gridWidth(t){this._gridWidth!==t&&(this._gridWidth=t,this._updateMaterial())}get gridColor(){return this._gridColor}set gridColor(t){Le(this._gridColor,t),this._updateMaterial()}get backgroundColor(){return this._backgroundColor}set backgroundColor(t){Le(this._backgroundColor,t),this._updateMaterial()}createExternalResources(){this._material=new $s(this._materialParameters)}destroyExternalResources(){this._material=null}forEachExternalMaterial(t){this._material!=null&&t(this._material)}createGeometries(t){if(this._material!=null){const i=Nt(this._material);t.addGeometry(i)}}get _materialParameters(){return{backgroundColor:this._backgroundColor,gridWidth:this._gridWidth,gridColor:this._gridColor,renderOccluded:this._renderOccluded}}_updateMaterial(){this._material!=null&&this._material.setParameters(this._materialParameters)}}function Zs(e,t,i,s,n,o,r,a){return As(t,r.worldUpAtPosition(e,c.get()),n,o,a.basis1,a.basis2),p(a.basis1,a.basis1,i),p(a.basis2,a.basis2,s),k(a.origin,e),Ye(a.basis2,a.basis1,a.origin,a.plane),a}function As(e,t,i,s,n,o){const r=H(e,t),a=c.get(),d=c.get();switch(s===P.HORIZONTAL_OR_VERTICAL?Math.abs(r)>as?P.HORIZONTAL:P.VERTICAL:s){case P.VERTICAL:{const h=Math.abs(r)<=He?e:i.viewUp;N(a,h,t),k(d,t);break}case P.HORIZONTAL:N(a,i.viewUp,t),N(d,t,a);break;case P.TILTED:{const h=Math.abs(r)<=He?t:i.viewUp;N(a,h,e),N(d,e,a);break}}const g=N(c.get(),a,d);H(g,i.viewForward)>0&&p(d,d,-1),U(n,a),U(o,d)}function Cs(e,t,i){const s=t.worldUpAtPosition(e.origin,c.get()),n=e.basis1,o=Ee(e,s),r=Math.round(o/F)*F;return _e(e,r-o,n,i)}function Ys(e,t,i,s,n,o){const r=k(c.get(),n.origin);b(r,r,p(c.get(),n.basis1,e.direction[0]<0?1:-1)),b(r,r,p(c.get(),n.basis2,e.direction[1]<0?1:-1));const a=L(n.basis1),d=L(n.basis2),g=w(c.get(),i,r),h=w(c.get(),t,r);let u=0,l=0;if(Ce(e)){const T=Te(n),ge=Te(o);u=a-.5*e.direction[0]*H(n.basis1,h)/a,l=d-.5*e.direction[1]*H(n.basis2,h)/d;const j=ge/T;u*=j,l*=j}const $=u+.5*e.direction[0]*H(n.basis1,g)/a,m=l+.5*e.direction[1]*H(n.basis2,g)/d,M=p(c.get(),n.basis1,$/a),I=p(c.get(),n.basis2,m/d);($<=0||De(o.origin,M,s)<=je)&&k(M,o.basis1),(m<=0||De(o.origin,I,s)<=je)&&k(I,o.basis2);const R=k(c.get(),r);return b(R,R,p(c.get(),M,e.direction[0]<0?-1:1)),b(R,R,p(c.get(),I,e.direction[1]<0?-1:1)),Ut(R,M,I,o)}function Js(e,t){return bs*Math.min(t.width,t.height)*t.computeRenderPixelSizeAt(e)}function Qs(e,t,i,s){const n=N(c.get(),t,i);return N(n,n,t),ze(e,n,s)}function Ks(e,t){return Xt(e.basis1,e.basis2,e.origin,t)}function ei(e,t,i,s){const n=t.worldUpAtPosition(e.origin,c.get()),o=c.get();switch(i){case ce.HEADING:k(o,n);break;case ce.TILT:k(o,e.basis1)}return ze(e.origin,o,s)}function ti(e,t,i,s){const n=Ae(i,E.NEGATIVE_X),o=Y.get();Mt(o,t,n.edge*Math.PI/2);const r=U(c.get(),n.basis);let a=p(c.get(),r,n.direction*s.computeScreenPixelSizeAt(n.position)*se);b(a,a,n.position);const d=s.projectToRenderScreen(a,me(c.get())),g=Es(s,d);yt(s,d,te),U(te.direction,te.direction);const h=c.get();!g&&Vt(i,te,h)&&(a=h),o[12]=0,o[13]=0,o[14]=0,e.modelTransform=o,e.renderLocation=Wt(a),g?e.state|=le:e.state&=~le}function Es(e,t){const[i,s,n,o]=e.viewport,r=Math.min(n,o)/16;let a=!0;return t[0]<i+r?(t[0]=i+r,a=!1):t[0]>i+n-r&&(t[0]=i+n-r,a=!1),t[1]<s+r?(t[1]=s+r,a=!1):t[1]>s+o-r&&(t[1]=s+o-r,a=!1),a}function si(e,t,i,s){const n=L(s.basis1),o=L(s.basis2),r=st(s),a=Te(s),d=ne(c.get(),0,0,0);b(d,p(c.get(),s.basis1,t.direction[0]),p(c.get(),s.basis2,t.direction[1])),b(d,s.origin,d);let g=0,h=1;if(Ce(t))t.direction[0]===1&&t.direction[1]===-1?g=F:t.direction[0]===1&&t.direction[1]===1?g=Math.PI:t.direction[0]===-1&&t.direction[1]===1&&(g=3*Math.PI/2),h=a;else{const l=t.direction[0]!==0?1:2;g=l===1?F:0,h=(l===1?o:n)-r}const u=Oe(Y.get(),g);qe(u,u,ne(c.get(),h,h,h)),Z(u,i,u),u[12]=0,u[13]=0,u[14]=0,e.modelTransform=u,e.renderLocation=d}function ii(e,t,i,s){const n=s.worldUpAtPosition(i.origin,c.get()),o=Ae(i,E.POSITIVE_X),r=Oe(Y.get(),o.edge*Math.PI/2);Xe(r,r,-Ee(i,n)),Z(r,t,r),r[12]=0,r[13]=0,r[14]=0,e.modelTransform=r,e.renderLocation=o.position}function ri(e,t,i){const s=Ae(i,E.POSITIVE_Y),n=Oe(Y.get(),s.edge*Math.PI/2);Xe(n,n,F),Z(n,t,n),n[12]=0,n[13]=0,n[14]=0,e.modelTransform=n,e.renderLocation=s.position}var E;function Ae(e,t){switch(t){case E.POSITIVE_X:return{basis:e.basis1,direction:1,position:b(c.get(),e.origin,e.basis1),edge:t};case E.POSITIVE_Y:return{basis:e.basis2,direction:1,position:b(c.get(),e.origin,e.basis2),edge:t};case E.NEGATIVE_X:return{basis:e.basis1,direction:-1,position:w(c.get(),e.origin,e.basis1),edge:t};case E.NEGATIVE_Y:return{basis:e.basis2,direction:-1,position:w(c.get(),e.origin,e.basis2),edge:t}}}function De(e,t,i){const s=i.projectToRenderScreen(b(c.get(),e,t),me(c.get())),n=i.projectToRenderScreen(w(c.get(),e,t),me(c.get()));return xt(w(s,s,n))}function st(e){const t=L(e.basis1),i=L(e.basis2);return gs*Math.min(t,i)}function Te(e){return st(e)}function Ce(e){return e.direction[0]!==0&&e.direction[1]!==0}function ni(e,t){const i=t.offsetMode===we.CENTER_ON_CALLOUT?se:0,s=[S(i,0,-Be/2),S(i,0,Be/2)],n=vs(s,!0),o=(u,l)=>Is(s,u,l,t),r=o(0,!1),a=o(ds,!0),d=new Ze({color:f.toUnitRGBA(t.calloutColor),renderOccluded:_.OccludeAndTransparent}),g=X(d,[[i,0,0],[i-se,0,0]]),h=X(d,[[i,0,0],[i-se,0,0]]);return new et({view:e,renderObjects:[...r.normal.map(u=>new C(u,v.Unfocused|A)),...a.normal.map(u=>new C(u,v.Unfocused|A)),new C(g,v.Unfocused|A|le),...r.focused.map(u=>new C(u,v.Focused|A)),...a.focused.map(u=>new C(u,v.Focused|A)),new C(h,v.Focused|A|le)],autoScaleRenderObjects:!1,collisionType:{type:"line",paths:[n]},collisionPriority:1,radius:tt,state:A})}function oi(e,t){const i=Yt(e,{calloutColor:f.toUnitRGBA(ae.callouts.color),customStateMask:A,texture:t});return i.state=A,i}function ai(e){const t=[[-1,-1,0],[1,-1,0],[1,1,0],[-1,1,0],[-1,-1,0]];return new zt({view:e,attached:!1,color:f.toUnitRGBA(ae.plane.outlineColor),width:cs,renderOccluded:_.OccludeAndTransparent,geometry:[t]})}function ci(e){return new Os({view:e,attached:!1,backgroundColor:f.toUnitRGBA(ae.plane.color),gridColor:f.toUnitRGBA(ae.plane.gridColor),gridWidth:4,renderOccluded:_.OccludeAndTransparent})}function li(e,t,i){const s=Ce(t),n=s?[S(1,0,0),S(0,0,0),S(0,1,0)]:[S(1,0,0),S(-1,0,0)],o=f.toUnitRGBA(i.color),r=m=>new kt({color:o,width:m,renderOccluded:_.OccludeAndTransparent}),a=()=>new Ze({color:o,renderOccluded:_.OccludeAndTransparent}),d=s?us:Fe,g=d*rs,h=Fe,u=m=>m>1?r(m):a(),l=[new C(X(u(d),n),v.Unfocused|fe),new C(X(u(g),n),v.Focused|fe),new C(X(u(h),n),Ps)],$=new et({view:e,renderObjects:l,collisionType:{type:"line",paths:[n]},radius:s?hs:ps,...Zt});return $.state=fe,$}function Is(e,t,i,s){const n=f.blendColors(s.color,s.outlineColor,.4),o=f.blendColors(s.color,s.outlineColor,.14),r=new K({color:f.toUnitRGBA(s.color),cullFace:ee.Back,renderOccluded:_.Opaque}),a=new K({color:f.toUnitRGBA(n),cullFace:ee.Back,renderOccluded:_.Opaque}),d=new K({color:f.toUnitRGBA(o),cullFace:ee.Back,renderOccluded:_.Opaque}),g=new K({color:f.toUnitRGBA(s.outlineColor),transparent:!0,writeDepth:!1,cullFace:ee.Front,renderOccluded:_.Transparent}),h=u=>{const l=e.slice(0),$=w(c.get(),l[0],l[1]);U($,$);const m=w(c.get(),l[l.length-1],l[l.length-2]);if(U(m,m),t>0){const z=p(oe(),m,-t);l[l.length-1]=b(z,z,l[l.length-1]);const x=p(oe(),$,-t);l[0]=b(x,x,l[0])}const M=u?os:1,I=$e*M,R=tt*M,T=Ue(Y.get());if(t>0){const z=I/4,x=ne(c.get(),0,z,0),J=1+t/z;Me(T,T,x),qe(T,T,ne(c.get(),J,J,J)),Me(T,T,p(x,x,-1/J))}const ge=Ue(be()),j=S(0,1,0),y=ye(be(),Ve(We.get(),j,m));y[12]=l[l.length-1][0],y[13]=l[l.length-1][1],y[14]=l[l.length-1][2],Z(y,y,T);const Ie=Rs(ls*(u?ns:1)+t,l,i?g:d);Ie.transformation=ge;const D=[Ie],he=xe(i?g:r,I,R,24,!1,!1,!0);he.transformation=y,D.push(he);const pe=xe(i?g:a,I,R,24,!1,!0,!1);pe.transformation=y,D.push(pe);const V=ye(be(),Ve(We.get(),j,$));return V[12]=l[0][0],V[13]=l[0][1],V[14]=l[0][2],Z(V,V,T),D.push(he.instantiate({transformation:V})),D.push(pe.instantiate({transformation:V})),D};return{normal:h(!1),focused:h(!0)}}function Rs(e,t,i){const s=[];for(let o=0;o<12;o++){const r=o/12*2*Math.PI;s.push([Math.cos(r)*e,Math.sin(r)*e])}return Lt(i,s,t,[],[],!1)}function vs(e,t){const i=w(oe(),e[e.length-1],e[e.length-2]);if(U(i,i),p(i,i,$e),b(i,i,e[e.length-1]),t){const s=w(oe(),e[0],e[1]);return U(s,s),p(s,s,$e),b(s,s,e[0]),[s,...e,i]}return[...e,i]}function di(e,t,i,s=new Jt){if(e==null)return null;const{renderCoordsHelper:n}=t,o=n.fromRenderCoords(e.origin,t.spatialReference);if(o==null)return null;const r=Gt(o,i);if(r==null)return null;s.position=r;const a=2*L(e.basis1),d=2*L(e.basis2),g=Je.renderUnitScaleFactor(t.spatialReference,i);s.width=a*g,s.height=d*g;const h=n.worldUpAtPosition(e.origin,c.get());return s.tilt=Ht(Ee(e,h)),s.heading=n.headingAtPosition(e.origin,e.basis1)-90,s}function Ee(e,t){return St(t,e.basis2,e.basis1)+F}function Ns(e,t,i,s,n,o,r=Qe()){return o.toRenderCoords(e,r.origin)?(o.worldBasisAtPosition(r.origin,Ge.X,r.basis1),o.worldBasisAtPosition(r.origin,Ge.Y,r.basis2),Ye(r.basis2,r.basis1,r.origin,r.plane),_e(r,-ie(t),Bt(r),r),_e(r,ie(i),r.basis1,r),p(r.basis1,r.basis1,s/2),p(r.basis2,r.basis2,n/2),Ft(r),r):(jt.getLogger("esri.views.3d.analysis.Slice.sliceToolUtils").error(`Failed to project slice plane position, projection from ${e.spatialReference.wkid} is not supported`),null)}function ui(e,t){if(e==null||e.position==null)return null;const i=qt(e.position,t.spatialReference,t.elevationProvider);if(i==null)return null;const s=Je.renderUnitScaleFactor(e.position.spatialReference,t.spatialReference),n=e.width*s,o=e.height*s;return{position:i,heading:e.heading,tilt:e.tilt,renderWidth:n,renderHeight:o}}function gi(e,t,i,s=Qe()){if(e==null)return null;const n=Ns(e.position,e.heading,e.tilt,e.renderWidth,e.renderHeight,t.renderCoordsHelper,s);return i.tiltEnabled||n==null||Cs(n,t.renderCoordsHelper,n),n}(function(e){e[e.POSITIVE_X=0]="POSITIVE_X",e[e.POSITIVE_Y=1]="POSITIVE_Y",e[e.NEGATIVE_X=2]="NEGATIVE_X",e[e.NEGATIVE_Y=3]="NEGATIVE_Y"})(E||(E={}));const A=de.Custom1;var ce,P;(function(e){e[e.HEADING=1]="HEADING",e[e.TILT=2]="TILT"})(ce||(ce={})),function(e){e[e.HORIZONTAL_OR_VERTICAL=0]="HORIZONTAL_OR_VERTICAL",e[e.HORIZONTAL=1]="HORIZONTAL",e[e.VERTICAL=2]="VERTICAL",e[e.TILTED=3]="TILTED"}(P||(P={}));const le=de.Custom2,te=Pt(),F=Math.PI/2,fe=de.Custom1,Ps=de.Custom2;var we;function hi(e){return(e.type==="building-scene-3d"?e:null)!=null}(function(e){e[e.CENTER_ON_CALLOUT=0]="CENTER_ON_CALLOUT",e[e.CENTER_ON_ARROW=1]="CENTER_ON_ARROW"})(we||(we={}));export{Ce as $,hi as A,ti as B,ri as D,si as F,Qs as G,ei as H,ni as J,oi as K,Xs as M,we as O,ai as Q,Js as S,fe as T,ii as X,ae as a,ci as b,Fs as c,gi as d,li as e,Bs as f,qs as g,Jt as h,P as i,A as j,Ks as k,ui as l,js as m,zs as n,Ds as o,ce as p,cs as q,di as r,le as s,fs as t,Zs as v,Ps as w,Ys as y,Te as z};
