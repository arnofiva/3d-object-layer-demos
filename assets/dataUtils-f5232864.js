import{cK as Rt,aB as ye,ee as Zt,ay as Qt,az as en,iR as tn,hJ as Ve,aD as G,aE as B,aF as Re,bl as De,bj as nn,bk as rn,aA as sn,ca as te,dk as wt,bA as an,cd as Qe,dT as on,ax as ln,vn as Dt}from"./main-79e5ed80.js";import{u as ie,o as Ie,b as cn,h as qe,d as un,e as bt,g as Le,w as vt}from"./vectorFieldUtils-d080e5ba.js";import{u as ht,s as hn}from"./pixelRangeUtils-04f58c28.js";import{y as fn}from"./colorUtils-c0f43caf.js";var Ke,St,Tt,et={exports:{}};et.exports,St=et,Ke=function(){function e(){this.pos=0,this.bufferLength=0,this.eof=!1,this.buffer=null}return e.prototype={ensureBuffer:function(t){var n=this.buffer,o=n?n.byteLength:0;if(t<o)return n;for(var u=512;u<t;)u<<=1;for(var l=new Uint8Array(u),f=0;f<o;++f)l[f]=n[f];return this.buffer=l},getByte:function(){for(var t=this.pos;this.bufferLength<=t;){if(this.eof)return null;this.readBlock()}return this.buffer[this.pos++]},getBytes:function(t){var n=this.pos;if(t){this.ensureBuffer(n+t);for(var o=n+t;!this.eof&&this.bufferLength<o;)this.readBlock();var u=this.bufferLength;o>u&&(o=u)}else{for(;!this.eof;)this.readBlock();o=this.bufferLength}return this.pos=o,this.buffer.subarray(n,o)},lookChar:function(){for(var t=this.pos;this.bufferLength<=t;){if(this.eof)return null;this.readBlock()}return String.fromCharCode(this.buffer[this.pos])},getChar:function(){for(var t=this.pos;this.bufferLength<=t;){if(this.eof)return null;this.readBlock()}return String.fromCharCode(this.buffer[this.pos++])},makeSubStream:function(t,n,o){for(var u=t+n;this.bufferLength<=u&&!this.eof;)this.readBlock();return new Stream(this.buffer,t,n,o)},skip:function(t){t||(t=1),this.pos+=t},reset:function(){this.pos=0}},e}(),(Tt=function(){if(!self||!self.Uint32Array)return null;var e=new Uint32Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),t=new Uint32Array([3,4,5,6,7,8,9,10,65547,65549,65551,65553,131091,131095,131099,131103,196643,196651,196659,196667,262211,262227,262243,262259,327811,327843,327875,327907,258,258,258]),n=new Uint32Array([1,2,3,4,65541,65543,131081,131085,196625,196633,262177,262193,327745,327777,393345,393409,459009,459137,524801,525057,590849,591361,657409,658433,724993,727041,794625,798721,868353,876545]),o=[new Uint32Array([459008,524368,524304,524568,459024,524400,524336,590016,459016,524384,524320,589984,524288,524416,524352,590048,459012,524376,524312,589968,459028,524408,524344,590032,459020,524392,524328,59e4,524296,524424,524360,590064,459010,524372,524308,524572,459026,524404,524340,590024,459018,524388,524324,589992,524292,524420,524356,590056,459014,524380,524316,589976,459030,524412,524348,590040,459022,524396,524332,590008,524300,524428,524364,590072,459009,524370,524306,524570,459025,524402,524338,590020,459017,524386,524322,589988,524290,524418,524354,590052,459013,524378,524314,589972,459029,524410,524346,590036,459021,524394,524330,590004,524298,524426,524362,590068,459011,524374,524310,524574,459027,524406,524342,590028,459019,524390,524326,589996,524294,524422,524358,590060,459015,524382,524318,589980,459031,524414,524350,590044,459023,524398,524334,590012,524302,524430,524366,590076,459008,524369,524305,524569,459024,524401,524337,590018,459016,524385,524321,589986,524289,524417,524353,590050,459012,524377,524313,589970,459028,524409,524345,590034,459020,524393,524329,590002,524297,524425,524361,590066,459010,524373,524309,524573,459026,524405,524341,590026,459018,524389,524325,589994,524293,524421,524357,590058,459014,524381,524317,589978,459030,524413,524349,590042,459022,524397,524333,590010,524301,524429,524365,590074,459009,524371,524307,524571,459025,524403,524339,590022,459017,524387,524323,589990,524291,524419,524355,590054,459013,524379,524315,589974,459029,524411,524347,590038,459021,524395,524331,590006,524299,524427,524363,590070,459011,524375,524311,524575,459027,524407,524343,590030,459019,524391,524327,589998,524295,524423,524359,590062,459015,524383,524319,589982,459031,524415,524351,590046,459023,524399,524335,590014,524303,524431,524367,590078,459008,524368,524304,524568,459024,524400,524336,590017,459016,524384,524320,589985,524288,524416,524352,590049,459012,524376,524312,589969,459028,524408,524344,590033,459020,524392,524328,590001,524296,524424,524360,590065,459010,524372,524308,524572,459026,524404,524340,590025,459018,524388,524324,589993,524292,524420,524356,590057,459014,524380,524316,589977,459030,524412,524348,590041,459022,524396,524332,590009,524300,524428,524364,590073,459009,524370,524306,524570,459025,524402,524338,590021,459017,524386,524322,589989,524290,524418,524354,590053,459013,524378,524314,589973,459029,524410,524346,590037,459021,524394,524330,590005,524298,524426,524362,590069,459011,524374,524310,524574,459027,524406,524342,590029,459019,524390,524326,589997,524294,524422,524358,590061,459015,524382,524318,589981,459031,524414,524350,590045,459023,524398,524334,590013,524302,524430,524366,590077,459008,524369,524305,524569,459024,524401,524337,590019,459016,524385,524321,589987,524289,524417,524353,590051,459012,524377,524313,589971,459028,524409,524345,590035,459020,524393,524329,590003,524297,524425,524361,590067,459010,524373,524309,524573,459026,524405,524341,590027,459018,524389,524325,589995,524293,524421,524357,590059,459014,524381,524317,589979,459030,524413,524349,590043,459022,524397,524333,590011,524301,524429,524365,590075,459009,524371,524307,524571,459025,524403,524339,590023,459017,524387,524323,589991,524291,524419,524355,590055,459013,524379,524315,589975,459029,524411,524347,590039,459021,524395,524331,590007,524299,524427,524363,590071,459011,524375,524311,524575,459027,524407,524343,590031,459019,524391,524327,589999,524295,524423,524359,590063,459015,524383,524319,589983,459031,524415,524351,590047,459023,524399,524335,590015,524303,524431,524367,590079]),9],u=[new Uint32Array([327680,327696,327688,327704,327684,327700,327692,327708,327682,327698,327690,327706,327686,327702,327694,0,327681,327697,327689,327705,327685,327701,327693,327709,327683,327699,327691,327707,327687,327703,327695,0]),5];function l(s){throw new Error(s)}function f(s){var i=0,r=s[i++],a=s[i++];r!=-1&&a!=-1||l("Invalid header in flate stream"),(15&r)!=8&&l("Unknown compression method in flate stream"),((r<<8)+a)%31!=0&&l("Bad FCHECK in flate stream"),32&a&&l("FDICT bit set in flate stream"),this.bytes=s,this.bytesPos=i,this.codeSize=0,this.codeBuf=0,Ke.call(this)}return f.prototype=Object.create(Ke.prototype),f.prototype.getBits=function(s){for(var i,r=this.codeSize,a=this.codeBuf,h=this.bytes,p=this.bytesPos;r<s;)(i=h[p++])===void 0&&l("Bad encoding in flate stream"),a|=i<<r,r+=8;return i=a&(1<<s)-1,this.codeBuf=a>>s,this.codeSize=r-=s,this.bytesPos=p,i},f.prototype.getCode=function(s){for(var i=s[0],r=s[1],a=this.codeSize,h=this.codeBuf,p=this.bytes,g=this.bytesPos;a<r;){var b;(b=p[g++])===void 0&&l("Bad encoding in flate stream"),h|=b<<a,a+=8}var v=i[h&(1<<r)-1],x=v>>16,c=65535&v;return(a==0||a<x||x==0)&&l("Bad encoding in flate stream"),this.codeBuf=h>>x,this.codeSize=a-x,this.bytesPos=g,c},f.prototype.generateHuffmanTable=function(s){for(var i=s.length,r=0,a=0;a<i;++a)s[a]>r&&(r=s[a]);for(var h=1<<r,p=new Uint32Array(h),g=1,b=0,v=2;g<=r;++g,b<<=1,v<<=1)for(var x=0;x<i;++x)if(s[x]==g){var c=0,d=b;for(a=0;a<g;++a)c=c<<1|1&d,d>>=1;for(a=c;a<h;a+=v)p[a]=g<<16|x;++b}return[p,r]},f.prototype.readBlock=function(){function s(O,z,V,$,_){for(var X=O.getBits(V)+$;X-- >0;)z[v++]=_}var i=this.getBits(3);if(1&i&&(this.eof=!0),(i>>=1)!=0){var r,a;if(i==1)r=o,a=u;else if(i==2){for(var h=this.getBits(5)+257,p=this.getBits(5)+1,g=this.getBits(4)+4,b=Array(e.length),v=0;v<g;)b[e[v++]]=this.getBits(3);for(var x=this.generateHuffmanTable(b),c=0,d=(v=0,h+p),m=new Array(d);v<d;){var y=this.getCode(x);y==16?s(this,m,2,3,c):y==17?s(this,m,3,3,c=0):y==18?s(this,m,7,11,c=0):m[v++]=c=y}r=this.generateHuffmanTable(m.slice(0,h)),a=this.generateHuffmanTable(m.slice(h,d))}else l("Unknown block type in flate stream");for(var w=(C=this.buffer)?C.length:0,S=this.bufferLength;;){var T=this.getCode(r);if(T<256)S+1>=w&&(w=(C=this.ensureBuffer(S+1)).length),C[S++]=T;else{if(T==256)return void(this.bufferLength=S);var A=(T=t[T-=257])>>16;A>0&&(A=this.getBits(A)),c=(65535&T)+A,T=this.getCode(a),(A=(T=n[T])>>16)>0&&(A=this.getBits(A));var I=(65535&T)+A;S+c>=w&&(w=(C=this.ensureBuffer(S+c)).length);for(var E=0;E<c;++E,++S)C[S]=C[S-I]}}}else{var k,P=this.bytes,M=this.bytesPos;(k=P[M++])===void 0&&l("Bad block header in flate stream");var R=k;(k=P[M++])===void 0&&l("Bad block header in flate stream"),R|=k<<8,(k=P[M++])===void 0&&l("Bad block header in flate stream");var L=k;(k=P[M++])===void 0&&l("Bad block header in flate stream"),(L|=k<<8)!=(65535&~R)&&l("Bad uncompressed block length in flate stream"),this.codeBuf=0,this.codeSize=0;var U=this.bufferLength,C=this.ensureBuffer(U+R),F=U+R;this.bufferLength=F;for(var D=U;D<F;++D){if((k=P[M++])===void 0){this.eof=!0;break}C[D]=k}this.bytesPos=M}},f}())!==void 0&&(St.exports=Tt);const Ge=Rt(et.exports);let dn=class Gt{constructor(t){this._canvas=null,this._ctx=null,t&&(this._canvas=t.canvas,this._ctx=t.ctx||t.canvas&&t.canvas.getContext("2d"))}decode(t,n,o){if(!t||t.byteLength<10)throw new ye("imagecanvasdecoder: decode","required a valid encoded data as input.");let{width:u=0,height:l=0,format:f}=n;const{applyJpegMask:s}=n;if(s&&(!u||!l))throw new ye("imagecanvasdecoder: decode","image width and height are needed to apply jpeg mask directly to canvas");return new Promise((i,r)=>{let a=null;f==="jpg"&&s&&(a=Gt._getMask(t,{width:u,height:l}));const h=new Blob([new Uint8Array(t)],{type:"image/"+f=="jpg"?"jpeg":f}),p=URL.createObjectURL(h),g=new Image;let b;g.src=p,g.onload=()=>{if(URL.revokeObjectURL(p),Zt(o))return void r(Qt());u=g.width,l=g.height,this._canvas&&this._ctx?(this._canvas.width===u&&this._canvas.height===l||(this._canvas.width=u,this._canvas.height=l),this._ctx.clearRect(0,0,u,l)):(this._canvas=document.createElement("canvas"),this._canvas.width=u,this._canvas.height=l,this._ctx=this._canvas.getContext("2d")),this._ctx.drawImage(g,0,0);const v=this._ctx.getImageData(0,0,u,l);let x;if(b=v.data,n.renderOnCanvas){if(a)for(x=0;x<a.length;x++)a[x]?b[4*x+3]=255:b[4*x+3]=0;return this._ctx.putImageData(v,0,0),void i(null)}const c=u*l,d=new Uint8Array(c),m=new Uint8Array(c),y=new Uint8Array(c);if(a)for(x=0;x<c;x++)d[x]=b[4*x],m[x]=b[4*x+1],y[x]=b[4*x+2];else for(a=new Uint8Array(c),x=0;x<c;x++)d[x]=b[4*x],m[x]=b[4*x+1],y[x]=b[4*x+2],a[x]=b[4*x+3];i({width:u,height:l,pixels:[d,m,y],mask:a,pixelType:"u8"})},g.onerror=()=>{URL.revokeObjectURL(p),r("cannot load image")}})}static _getMask(t,n){let o=null;try{const u=new Uint8Array(t),l=Math.ceil(u.length/2);let f=0;const s=u.length-2;for(f=l;f<s&&(u[f]!==255||u[f+1]!==217);f++);if(f+=2,f<u.length-1){const i=new Ge(u.subarray(f)).getBytes();o=new Uint8Array(n.width*n.height);let r=0;for(let a=0;a<i.length;a++)for(let h=7;h>=0;h--)o[r++]=i[a]>>h&1}}catch{}return o}};var xt,It,At,tt={exports:{}};tt.exports,xt=tt,It=function(){var e=function(){function t(n){this.message="JPEG error: "+n}return t.prototype=new Error,t.prototype.name="JpegError",t.constructor=t,t}();return function(){if(!self||!self.Uint8ClampedArray)return null;var t=new Uint8Array([0,1,8,16,9,2,3,10,17,24,32,25,18,11,4,5,12,19,26,33,40,48,41,34,27,20,13,6,7,14,21,28,35,42,49,56,57,50,43,36,29,22,15,23,30,37,44,51,58,59,52,45,38,31,39,46,53,60,61,54,47,55,62,63]),n=4017,o=799,u=3406,l=2276,f=1567,s=3784,i=5793,r=2896;function a(){this.decodeTransform=null,this.colorTransform=-1}function h(c,d){for(var m,y,w=0,S=[],T=16;T>0&&!c[T-1];)T--;S.push({children:[],index:0});var A,I=S[0];for(m=0;m<T;m++){for(y=0;y<c[m];y++){for((I=S.pop()).children[I.index]=d[w];I.index>0;)I=S.pop();for(I.index++,S.push(I);S.length<=m;)S.push(A={children:[],index:0}),I.children[I.index]=A.children,I=A;w++}m+1<T&&(S.push(A={children:[],index:0}),I.children[I.index]=A.children,I=A)}return S[0].children}function p(c,d,m){return 64*((c.blocksPerLine+1)*d+m)}function g(c,d,m,y,w,S,T,A,I){var E=m.mcusPerLine,k=m.progressive,P=d,M=0,R=0;function L(){if(R>0)return R--,M>>R&1;if((M=c[d++])===255){var N=c[d++];if(N)throw new e("unexpected marker "+(M<<8|N).toString(16))}return R=7,M>>>7}function U(N){for(var W=N;;){if(typeof(W=W[L()])=="number")return W;if(typeof W!="object")throw new e("invalid huffman sequence")}}function C(N){for(var W=0;N>0;)W=W<<1|L(),N--;return W}function F(N){if(N===1)return L()===1?1:-1;var W=C(N);return W>=1<<N-1?W:W+(-1<<N)+1}function D(N,W){var q=U(N.huffmanTableDC),Z=q===0?0:F(q);N.blockData[W]=N.pred+=Z;for(var se=1;se<64;){var ue=U(N.huffmanTableAC),Q=15&ue,ae=ue>>4;if(Q!==0){var Xt=t[se+=ae];N.blockData[W+Xt]=F(Q),se++}else{if(ae<15)break;se+=16}}}function O(N,W){var q=U(N.huffmanTableDC),Z=q===0?0:F(q)<<I;N.blockData[W]=N.pred+=Z}function z(N,W){N.blockData[W]|=L()<<I}var V=0;function $(N,W){if(V>0)V--;else for(var q=S,Z=T;q<=Z;){var se=U(N.huffmanTableAC),ue=15&se,Q=se>>4;if(ue!==0){var ae=t[q+=Q];N.blockData[W+ae]=F(ue)*(1<<I),q++}else{if(Q<15){V=C(Q)+(1<<Q)-1;break}q+=16}}}var _,X=0;function ne(N,W){for(var q,Z,se=S,ue=T,Q=0;se<=ue;){var ae=t[se];switch(X){case 0:if(Q=(Z=U(N.huffmanTableAC))>>4,(q=15&Z)==0)Q<15?(V=C(Q)+(1<<Q),X=4):(Q=16,X=1);else{if(q!==1)throw new e("invalid ACn encoding");_=F(q),X=Q?2:3}continue;case 1:case 2:N.blockData[W+ae]?N.blockData[W+ae]+=L()<<I:--Q==0&&(X=X===2?3:0);break;case 3:N.blockData[W+ae]?N.blockData[W+ae]+=L()<<I:(N.blockData[W+ae]=_<<I,X=0);break;case 4:N.blockData[W+ae]&&(N.blockData[W+ae]+=L()<<I)}se++}X===4&&--V==0&&(X=0)}function pe(N,W,q,Z,se){var ue=q%E;W(N,p(N,(q/E|0)*N.v+Z,ue*N.h+se))}function me(N,W,q){W(N,p(N,q/N.blocksPerLine|0,q%N.blocksPerLine))}var K,H,ce,fe,Y,Ce,we=y.length;Ce=k?S===0?A===0?O:z:A===0?$:ne:D;var le,be,Ne,Fe,de=0;for(be=we===1?y[0].blocksPerLine*y[0].blocksPerColumn:E*m.mcusPerColumn;de<be;){var Be=w?Math.min(be-de,w):be;for(H=0;H<we;H++)y[H].pred=0;if(V=0,we===1)for(K=y[0],Y=0;Y<Be;Y++)me(K,Ce,de),de++;else for(Y=0;Y<Be;Y++){for(H=0;H<we;H++)for(Ne=(K=y[H]).h,Fe=K.v,ce=0;ce<Fe;ce++)for(fe=0;fe<Ne;fe++)pe(K,Ce,de,ce,fe);de++}R=0,(le=x(c,d))&&le.invalid&&(console.log("decodeScan - unexpected MCU data, next marker is: "+le.invalid),d=le.offset);var ve=le&&le.marker;if(!ve||ve<=65280)throw new e("marker was not found");if(!(ve>=65488&&ve<=65495))break;d+=2}return(le=x(c,d))&&le.invalid&&(console.log("decodeScan - unexpected Scan data, next marker is: "+le.invalid),d=le.offset),d-P}function b(c,d,m){var y,w,S,T,A,I,E,k,P,M,R,L,U,C,F,D,O,z=c.quantizationTable,V=c.blockData;if(!z)throw new e("missing required Quantization Table.");for(var $=0;$<64;$+=8)P=V[d+$],M=V[d+$+1],R=V[d+$+2],L=V[d+$+3],U=V[d+$+4],C=V[d+$+5],F=V[d+$+6],D=V[d+$+7],P*=z[$],M|R|L|U|C|F|D?(M*=z[$+1],R*=z[$+2],L*=z[$+3],U*=z[$+4],C*=z[$+5],F*=z[$+6],D*=z[$+7],w=(y=(y=i*P+128>>8)+(w=i*U+128>>8)+1>>1)-w,O=(S=R)*s+(T=F)*f+128>>8,S=S*f-T*s+128>>8,E=(A=(A=r*(M-D)+128>>8)+(E=C<<4)+1>>1)-E,I=(k=(k=r*(M+D)+128>>8)+(I=L<<4)+1>>1)-I,T=(y=y+(T=O)+1>>1)-T,S=(w=w+S+1>>1)-S,O=A*l+k*u+2048>>12,A=A*u-k*l+2048>>12,k=O,O=I*o+E*n+2048>>12,I=I*n-E*o+2048>>12,E=O,m[$]=y+k,m[$+7]=y-k,m[$+1]=w+E,m[$+6]=w-E,m[$+2]=S+I,m[$+5]=S-I,m[$+3]=T+A,m[$+4]=T-A):(O=i*P+512>>10,m[$]=O,m[$+1]=O,m[$+2]=O,m[$+3]=O,m[$+4]=O,m[$+5]=O,m[$+6]=O,m[$+7]=O);for(var _=0;_<8;++_)P=m[_],(M=m[_+8])|(R=m[_+16])|(L=m[_+24])|(U=m[_+32])|(C=m[_+40])|(F=m[_+48])|(D=m[_+56])?(w=(y=4112+((y=i*P+2048>>12)+(w=i*U+2048>>12)+1>>1))-w,O=(S=R)*s+(T=F)*f+2048>>12,S=S*f-T*s+2048>>12,T=O,E=(A=(A=r*(M-D)+2048>>12)+(E=C)+1>>1)-E,I=(k=(k=r*(M+D)+2048>>12)+(I=L)+1>>1)-I,O=A*l+k*u+2048>>12,A=A*u-k*l+2048>>12,k=O,O=I*o+E*n+2048>>12,I=I*n-E*o+2048>>12,P=(P=(y=y+T+1>>1)+k)<16?0:P>=4080?255:P>>4,M=(M=(w=w+S+1>>1)+(E=O))<16?0:M>=4080?255:M>>4,R=(R=(S=w-S)+I)<16?0:R>=4080?255:R>>4,L=(L=(T=y-T)+A)<16?0:L>=4080?255:L>>4,U=(U=T-A)<16?0:U>=4080?255:U>>4,C=(C=S-I)<16?0:C>=4080?255:C>>4,F=(F=w-E)<16?0:F>=4080?255:F>>4,D=(D=y-k)<16?0:D>=4080?255:D>>4,V[d+_]=P,V[d+_+8]=M,V[d+_+16]=R,V[d+_+24]=L,V[d+_+32]=U,V[d+_+40]=C,V[d+_+48]=F,V[d+_+56]=D):(O=(O=i*P+8192>>14)<-2040?0:O>=2024?255:O+2056>>4,V[d+_]=O,V[d+_+8]=O,V[d+_+16]=O,V[d+_+24]=O,V[d+_+32]=O,V[d+_+40]=O,V[d+_+48]=O,V[d+_+56]=O)}function v(c,d){for(var m=d.blocksPerLine,y=d.blocksPerColumn,w=new Int16Array(64),S=0;S<y;S++)for(var T=0;T<m;T++)b(d,p(d,S,T),w);return d.blockData}function x(c,d,m){function y(I){return c[I]<<8|c[I+1]}var w=c.length-1,S=m<d?m:d;if(d>=w)return null;var T=y(d);if(T>=65472&&T<=65534)return{invalid:null,marker:T,offset:d};for(var A=y(S);!(A>=65472&&A<=65534);){if(++S>=w)return null;A=y(S)}return{invalid:T.toString(16),marker:A,offset:S}}return a.prototype={parse:function(c){function d(){var N=c[T]<<8|c[T+1];return T+=2,N}function m(){var N=d(),W=T+N-2,q=x(c,W,T);q&&q.invalid&&(console.log("readDataBlock - incorrect length, next marker is: "+q.invalid),W=q.offset);var Z=c.subarray(T,W);return T+=Z.length,Z}function y(N){for(var W=Math.ceil(N.samplesPerLine/8/N.maxH),q=Math.ceil(N.scanLines/8/N.maxV),Z=0;Z<N.components.length;Z++){Y=N.components[Z];var se=Math.ceil(Math.ceil(N.samplesPerLine/8)*Y.h/N.maxH),ue=Math.ceil(Math.ceil(N.scanLines/8)*Y.v/N.maxV),Q=W*Y.h,ae=q*Y.v*64*(Q+1);Y.blockData=new Int16Array(ae),Y.blocksPerLine=se,Y.blocksPerColumn=ue}N.mcusPerLine=W,N.mcusPerColumn=q}var w,S,T=0,A=null,I=null,E=[],k=[],P=[],M=d();if(M!==65496)throw new e("SOI not found");for(M=d();M!==65497;){var R,L,U;switch(M){case 65504:case 65505:case 65506:case 65507:case 65508:case 65509:case 65510:case 65511:case 65512:case 65513:case 65514:case 65515:case 65516:case 65517:case 65518:case 65519:case 65534:var C=m();M===65504&&C[0]===74&&C[1]===70&&C[2]===73&&C[3]===70&&C[4]===0&&(A={version:{major:C[5],minor:C[6]},densityUnits:C[7],xDensity:C[8]<<8|C[9],yDensity:C[10]<<8|C[11],thumbWidth:C[12],thumbHeight:C[13],thumbData:C.subarray(14,14+3*C[12]*C[13])}),M===65518&&C[0]===65&&C[1]===100&&C[2]===111&&C[3]===98&&C[4]===101&&(I={version:C[5]<<8|C[6],flags0:C[7]<<8|C[8],flags1:C[9]<<8|C[10],transformCode:C[11]});break;case 65499:for(var F=d()+T-2;T<F;){var D=c[T++],O=new Uint16Array(64);if(D>>4){if(D>>4!=1)throw new e("DQT - invalid table spec");for(L=0;L<64;L++)O[t[L]]=d()}else for(L=0;L<64;L++)O[t[L]]=c[T++];E[15&D]=O}break;case 65472:case 65473:case 65474:if(w)throw new e("Only single frame JPEGs supported");d(),(w={}).extended=M===65473,w.progressive=M===65474,w.precision=c[T++],w.scanLines=d(),w.samplesPerLine=d(),w.components=[],w.componentIds={};var z,V=c[T++],$=0,_=0;for(R=0;R<V;R++){z=c[T];var X=c[T+1]>>4,ne=15&c[T+1];$<X&&($=X),_<ne&&(_=ne);var pe=c[T+2];U=w.components.push({h:X,v:ne,quantizationId:pe,quantizationTable:null}),w.componentIds[z]=U-1,T+=3}w.maxH=$,w.maxV=_,y(w);break;case 65476:var me=d();for(R=2;R<me;){var K=c[T++],H=new Uint8Array(16),ce=0;for(L=0;L<16;L++,T++)ce+=H[L]=c[T];var fe=new Uint8Array(ce);for(L=0;L<ce;L++,T++)fe[L]=c[T];R+=17+ce,(K>>4?k:P)[15&K]=h(H,fe)}break;case 65501:d(),S=d();break;case 65498:d();var Y,Ce=c[T++],we=[];for(R=0;R<Ce;R++){var le=w.componentIds[c[T++]];Y=w.components[le];var be=c[T++];Y.huffmanTableDC=P[be>>4],Y.huffmanTableAC=k[15&be],we.push(Y)}var Ne=c[T++],Fe=c[T++],de=c[T++],Be=g(c,T,w,we,S,Ne,Fe,de>>4,15&de);T+=Be;break;case 65535:c[T]!==255&&T--;break;default:if(c[T-3]===255&&c[T-2]>=192&&c[T-2]<=254){T-=3;break}throw new e("unknown marker "+M.toString(16))}M=d()}for(this.width=w.samplesPerLine,this.height=w.scanLines,this.jfif=A,this.eof=T,this.adobe=I,this.components=[],R=0;R<w.components.length;R++){var ve=E[(Y=w.components[R]).quantizationId];ve&&(Y.quantizationTable=ve),this.components.push({output:v(w,Y),scaleX:Y.h/w.maxH,scaleY:Y.v/w.maxV,blocksPerLine:Y.blocksPerLine,blocksPerColumn:Y.blocksPerColumn})}this.numComponents=this.components.length},_getLinearizedBlockData:function(c,d){var m,y,w,S,T,A,I,E,k,P,M,R=this.width/c,L=this.height/d,U=0,C=this.components.length,F=c*d*C,D=new Uint8ClampedArray(F),O=new Uint32Array(c),z=4294967288;for(I=0;I<C;I++){for(y=(m=this.components[I]).scaleX*R,w=m.scaleY*L,U=I,M=m.output,S=m.blocksPerLine+1<<3,T=0;T<c;T++)E=0|T*y,O[T]=(E&z)<<3|7&E;for(A=0;A<d;A++)for(P=S*((E=0|A*w)&z)|(7&E)<<3,T=0;T<c;T++)D[U]=M[P+O[T]],U+=C}var V=this.decodeTransform;if(V)for(I=0;I<F;)for(E=0,k=0;E<C;E++,I++,k+=2)D[I]=(D[I]*V[k]>>8)+V[k+1];return D},_isColorConversionNeeded:function(){return this.adobe?!!this.adobe.transformCode:this.numComponents===3?this.colorTransform!==0:this.colorTransform===1},_convertYccToRgb:function(c){for(var d,m,y,w=0,S=c.length;w<S;w+=3)d=c[w],m=c[w+1],y=c[w+2],c[w]=d-179.456+1.402*y,c[w+1]=d+135.459-.344*m-.714*y,c[w+2]=d-226.816+1.772*m;return c},_convertYcckToRgb:function(c){for(var d,m,y,w,S=0,T=0,A=c.length;T<A;T+=4)d=c[T],m=c[T+1],y=c[T+2],w=c[T+3],c[S++]=m*(-660635669420364e-19*m+.000437130475926232*y-54080610064599e-18*d+.00048449797120281*w-.154362151871126)-122.67195406894+y*(-.000957964378445773*y+.000817076911346625*d-.00477271405408747*w+1.53380253221734)+d*(.000961250184130688*d-.00266257332283933*w+.48357088451265)+w*(-.000336197177618394*w+.484791561490776),c[S++]=107.268039397724+m*(219927104525741e-19*m-.000640992018297945*y+.000659397001245577*d+.000426105652938837*w-.176491792462875)+y*(-.000778269941513683*y+.00130872261408275*d+.000770482631801132*w-.151051492775562)+d*(.00126935368114843*d-.00265090189010898*w+.25802910206845)+w*(-.000318913117588328*w-.213742400323665),c[S++]=m*(-.000570115196973677*m-263409051004589e-19*y+.0020741088115012*d-.00288260236853442*w+.814272968359295)-20.810012546947+y*(-153496057440975e-19*y-.000132689043961446*d+.000560833691242812*w-.195152027534049)+d*(.00174418132927582*d-.00255243321439347*w+.116935020465145)+w*(-.000343531996510555*w+.24165260232407);return c},_convertYcckToCmyk:function(c){for(var d,m,y,w=0,S=c.length;w<S;w+=4)d=c[w],m=c[w+1],y=c[w+2],c[w]=434.456-d-1.402*y,c[w+1]=119.541-d+.344*m+.714*y,c[w+2]=481.816-d-1.772*m;return c},_convertCmykToRgb:function(c){for(var d,m,y,w,S=0,T=1/255,A=0,I=c.length;A<I;A+=4)d=c[A]*T,m=c[A+1]*T,y=c[A+2]*T,w=c[A+3]*T,c[S++]=255+d*(-4.387332384609988*d+54.48615194189176*m+18.82290502165302*y+212.25662451639585*w-285.2331026137004)+m*(1.7149763477362134*m-5.6096736904047315*y-17.873870861415444*w-5.497006427196366)+y*(-2.5217340131683033*y-21.248923337353073*w+17.5119270841813)-w*(21.86122147463605*w+189.48180835922747),c[S++]=255+d*(8.841041422036149*d+60.118027045597366*m+6.871425592049007*y+31.159100130055922*w-79.2970844816548)+m*(-15.310361306967817*m+17.575251261109482*y+131.35250912493976*w-190.9453302588951)+y*(4.444339102852739*y+9.8632861493405*w-24.86741582555878)-w*(20.737325471181034*w+187.80453709719578),c[S++]=255+d*(.8842522430003296*d+8.078677503112928*m+30.89978309703729*y-.23883238689178934*w-14.183576799673286)+m*(10.49593273432072*m+63.02378494754052*y+50.606957656360734*w-112.23884253719248)+y*(.03296041114873217*y+115.60384449646641*w-193.58209356861505)-w*(22.33816807309886*w+180.12613974708367);return c},getData:function(c,d,m){if(this.numComponents>4)throw new e("Unsupported color mode");var y=this._getLinearizedBlockData(c,d);if(this.numComponents===1&&m){for(var w=y.length,S=new Uint8ClampedArray(3*w),T=0,A=0;A<w;A++){var I=y[A];S[T++]=I,S[T++]=I,S[T++]=I}return S}if(this.numComponents===3&&this._isColorConversionNeeded())return this._convertYccToRgb(y);if(this.numComponents===4){if(this._isColorConversionNeeded())return m?this._convertYcckToRgb(y):this._convertYcckToCmyk(y);if(m)return this._convertCmykToRgb(y)}return y}},a}()},(At=It())!==void 0&&(xt.exports=At);const Nt=Rt(tt.exports);let pn=class{static decode(t,n=!1){const o=new Uint8Array(t),u=new Nt;u.parse(o);const{width:l,height:f,numComponents:s,eof:i}=u,r=u.getData(l,f,!0),a=l*f;let h,p=null,g=0,b=0,v=0;if(!n&&i<o.length-1)try{const x=new Ge(o.subarray(i)).getBytes();p=new Uint8Array(a);let c=0;for(g=0;g<x.length;g++)for(v=7;v>=0;v--)p[c++]=x[g]>>v&1}catch{}if(s===1&&r.length===l*f){const x=new Uint8Array(r.buffer);h=[x,x,x]}else{for(h=[],g=0;g<3;g++)h.push(new Uint8Array(a));for(v=0,b=0;b<a;b++)for(g=0;g<3;g++)h[g][b]=r[v++]}return{width:l,height:f,pixels:h,mask:p}}};const Ft=[{pixelType:"S8",size:1,ctor:Int8Array,range:[-128,127]},{pixelType:"U8",size:1,ctor:Uint8Array,range:[0,255]},{pixelType:"S16",size:2,ctor:Int16Array,range:[-32768,32767]},{pixelType:"U16",size:2,ctor:Uint16Array,range:[0,65536]},{pixelType:"S32",size:4,ctor:Int32Array,range:[-2147483648,2147483647]},{pixelType:"U32",size:4,ctor:Uint32Array,range:[0,4294967296]},{pixelType:"F32",size:4,ctor:Float32Array,range:[-34027999387901484e22,34027999387901484e22]},{pixelType:"F64",size:8,ctor:Float64Array,range:[-17976931348623157e292,17976931348623157e292]}];let Je=null;function Bt(){return Je||(Je=en(()=>import("./lerc-wasm-307fcfec.js"),["./lerc-wasm-307fcfec.js","./main-79e5ed80.js","./main-7772480e.css"],import.meta.url).then(e=>e.l).then(({default:e})=>e({locateFile:t=>tn(`esri/layers/support/rasterFormats/${t}`)})).then(e=>{gn(e)}),Je)}const _e={getBlobInfo:null,decode:null};function mn(e){return 16+(e>>3<<3)}function ge(e,t,n){n.set(e.slice(t,t+n.length))}function gn(e){const{_malloc:t,_free:n,_lerc_getBlobInfo:o,_lerc_getDataRanges:u,_lerc_decode_4D:l,asm:f}=e;let s;const i=Object.values(f).find(a=>a&&"buffer"in a&&a.buffer===e.HEAPU8.buffer),r=a=>{const h=a.map(v=>mn(v)),p=h.reduce((v,x)=>v+x),g=t(p);s=new Uint8Array(i.buffer);let b=h[0];h[0]=g;for(let v=1;v<h.length;v++){const x=h[v];h[v]=h[v-1]+b,b=x}return h};_e.getBlobInfo=a=>{const g=new Uint8Array(48),b=new Uint8Array(8*3),[v,x,c]=r([a.length,g.length,b.length]);s.set(a,v),s.set(g,x),s.set(b,c);let d=o(v,a.length,x,c,12,3);if(d)throw n(v),new Error(`lerc-getBlobInfo: error code is ${d}`);s=new Uint8Array(i.buffer),ge(s,x,g),ge(s,c,b);const m=new Uint32Array(g.buffer),y=new Float64Array(b.buffer),[w,S,,T,A,I,E,k,P,M,R]=m,L={version:w,depthCount:M,width:T,height:A,validPixelCount:E,bandCount:I,blobSize:k,maskCount:P,dataType:S,minValue:y[0],maxValue:y[1],maxZerror:y[2],statistics:[],bandCountWithNoData:R};if(R)return L;if(M===1&&I===1)return n(v),L.statistics.push({minValue:y[0],maxValue:y[1]}),L;const U=M*I*8,C=new Uint8Array(U),F=new Uint8Array(U);let D=v,O=0,z=0,V=!1;if(s.byteLength<v+2*U?(n(v),V=!0,[D,O,z]=r([a.length,U,U]),s.set(a,D)):[O,z]=r([U,U]),s.set(C,O),s.set(F,z),d=u(D,a.length,M,I,O,z),d)throw n(D),V||n(O),new Error(`lerc-getDataRanges: error code is ${d}`);s=new Uint8Array(i.buffer),ge(s,O,C),ge(s,z,F);const $=new Float64Array(C.buffer),_=new Float64Array(F.buffer),X=L.statistics;for(let ne=0;ne<I;ne++)if(M>1){const pe=$.slice(ne*M,(ne+1)*M),me=_.slice(ne*M,(ne+1)*M),K=Math.min.apply(null,pe),H=Math.max.apply(null,me);X.push({minValue:K,maxValue:H,depthStats:{minValues:pe,maxValues:me}})}else X.push({minValue:$[ne],maxValue:_[ne]});return n(D),V||n(O),L},_e.decode=(a,h)=>{const{maskCount:p,depthCount:g,bandCount:b,width:v,height:x,dataType:c,bandCountWithNoData:d}=h,m=Ft[c],y=v*x,w=new Uint8Array(y*b),S=y*g*b*m.size,T=new Uint8Array(S),A=new Uint8Array(b),I=new Uint8Array(8*b),[E,k,P,M,R]=r([a.length,w.length,T.length,A.length,I.length]);s.set(a,E),s.set(w,k),s.set(T,P),s.set(A,M),s.set(I,R);const L=l(E,a.length,p,k,g,v,x,b,c,P,M,R);if(L)throw n(E),new Error(`lerc-decode: error code is ${L}`);s=new Uint8Array(i.buffer),ge(s,P,T),ge(s,k,w);let U=null;if(d){ge(s,M,A),ge(s,R,I),U=[];const C=new Float64Array(I.buffer);for(let F=0;F<A.length;F++)U.push(A[F]?C[F]:null)}return n(E),{data:T,maskData:w,noDataValues:U}}}function yn(e,t,n,o,u){if(n<2)return e;const l=new o(t*n);if(u)for(let f=0,s=0;f<t;f++)for(let i=0,r=f;i<n;i++,r+=t)l[r]=e[s++];else for(let f=0,s=0;f<t;f++)for(let i=0,r=f;i<n;i++,r+=t)l[s++]=e[r];return l}function Vt(e,t={}){const n=t.inputOffset??0,o=e instanceof Uint8Array?e.subarray(n):new Uint8Array(e,n),u=_e.getBlobInfo(o),{data:l,maskData:f,noDataValues:s}=_e.decode(o,u),{width:i,height:r,bandCount:a,depthCount:h,dataType:p,maskCount:g,statistics:b}=u,v=Ft[p],x=new v.ctor(l.buffer),c=[],d=[],m=i*r,y=m*h;for(let E=0;E<a;E++){const k=x.subarray(E*y,(E+1)*y);if(t.returnInterleaved)c.push(k);else{const P=yn(k,m,h,v.ctor,!0);c.push(P)}d.push(f.subarray(E*y,(E+1)*y))}const w=g===0?null:g===1?d[0]:new Uint8Array(m);if(g>1){w.set(d[0]);for(let E=1;E<d.length;E++){const k=d[E];for(let P=0;P<m;P++)w[P]=w[P]&k[P]}}const{noDataValue:S}=t,T=S!=null&&v.range[0]<=S&&v.range[1]>=S;if(g>0&&T)for(let E=0;E<a;E++){const k=c[E],P=d[E]||w;for(let M=0;M<m;M++)P[M]===0&&(k[M]=S)}const A=g===a&&a>1?d:null,{pixelType:I}=v;return{width:i,height:r,bandCount:a,pixelType:I,depthCount:h,statistics:b,pixels:c,mask:w,bandMasks:A,noDataValues:s}}function wn(e,t,n,o=!0){if(t%4!=0||n%4!=0){const u=new ArrayBuffer(4*Math.ceil(n/4)),l=new Uint8Array(u),f=new Uint8Array(e,t,n);if(o)for(let s=0;s<l.length;s+=4)l[s]=f[s+3],l[s+1]=f[s+2],l[s+2]=f[s+1],l[s+3]=f[s];else l.set(f);return new Uint32Array(l.buffer)}if(o){const u=new Uint8Array(e,t,n),l=new Uint8Array(u.length);for(let f=0;f<l.length;f+=4)l[f]=u[f+3],l[f+1]=u[f+2],l[f+2]=u[f+1],l[f+3]=u[f];return new Uint32Array(l.buffer)}return new Uint32Array(e,t,n/4)}function Et(){const e=[];for(let t=0;t<=257;t++)e[t]=[t];return e}function kt(e,t){for(let n=0;n<t.length;n++)e.push(t[n])}const Ee=new Set;function ft(e,t,n,o=!0){const u=wn(e,t,n,o);let l=9,f=Et(),s=32,i=f.length,r=[],a=1,h=u[0],p=0;const g=u.length,b=8*(4*g-n),v=[];for(;h!=null;){if(s>=l)s-=l,p=h>>>32-l,h<<=l;else{p=h>>>32-s,h=u[a++];const c=l-s;s=32-c,p=(p<<c)+(h>>>s),h<<=c}if(p===257)break;if(p===256){l=9,f=Et(),i=f.length,r=[];continue}const x=f[p];if(x==null){if(p>f.length)throw new Error("data integrity issue: code does not exist on code page");r.push(r[0]),f[i++]=r.slice(),kt(v,r)}else kt(v,x),r.push(x[0]),r.length>1&&(f[i++]=r.slice()),r=x.slice();if(Ee.has(i)&&l++,s===0&&(h=u[a++],s=32),a>g||a===g&&s<=b)break}return new Uint8Array(v)}Ee.add(511),Ee.add(1023),Ee.add(2047),Ee.add(4095),Ee.add(8191);const Pt=(e,t)=>{const n=t.width*t.height,o=t.pixelType;return Math.floor(e.byteLength/(n*$t(o)))},$t=e=>{let t=1;switch(e){case Uint8Array:case Int8Array:t=1;break;case Uint16Array:case Int16Array:t=2;break;case Uint32Array:case Int32Array:case Float32Array:t=4;break;case Float64Array:t=8}return t},bn=(e,t)=>{if(8*e.byteLength<t)return null;const n=new Uint8Array(e,0,Math.ceil(t/8)),o=new Uint8Array(t);let u=0,l=0,f=0,s=0;for(f=0;f<n.length-1;f++)for(l=n[f],s=7;s>=0;s--)o[u++]=l>>s&1;for(s=7;u<t-1;)l=n[n.length-1],o[u++]=l>>s&1,s--;return o};let vn=class{static decode(t,n){const o=n.pixelType,u=[],l=n.width*n.height,f=Pt(t,n),{bandIds:s,format:i}=n,r=s&&s.length||Pt(t,n),a=t.byteLength-t.byteLength%(l*$t(o)),h=new o(t,0,l*f);let p,g,b,v,x=null;if(i==="bip")for(p=0;p<r;p++){for(b=new o(l),v=s?s[p]:p,g=0;g<l;g++)b[g]=h[g*f+v];u.push(b)}else if(i==="bsq")for(p=0;p<r;p++)v=s?s[p]:p,u.push(h.subarray(v*l,(v+1)*l));return a<t.byteLength-1&&(x=bn(t.slice(a),l)),{pixels:u,mask:x}}};function Sn(e,t){let n=0,o="",u=0,l=0;const f=e.length;for(;n<f;)l=e[n++],u=l>>4,u<8?u=1:u===15?(u=4,l=(7&l)<<18|(63&e[n++])<<12|(63&e[n++])<<6|63&e[n++]):u===14?(u=3,l=(15&l)<<12|(63&e[n++])<<6|63&e[n++]):(u=2,l=(31&l)<<6|63&e[n++]),(l!==0||t)&&(o+=String.fromCharCode(l));return o}const dt=(()=>{const e=[];return e[254]="NEWSUBFILETYPE",e[255]="SUBFILETYPE",e[256]="IMAGEWIDTH",e[257]="IMAGELENGTH",e[258]="BITSPERSAMPLE",e[259]="COMPRESSION",e[262]="PHOTOMETRICINTERPRETATION",e[263]="THRESHHOLDING",e[264]="CELLWIDTH",e[265]="CELLLENGTH",e[266]="FILLORDER",e[269]="DOCUMENTNAME",e[270]="IMAGEDESCRIPTION",e[271]="MAKE",e[272]="MODEL",e[273]="STRIPOFFSETS",e[274]="ORIENTATION",e[277]="SAMPLESPERPIXEL",e[278]="ROWSPERSTRIP",e[279]="STRIPBYTECOUNTS",e[280]="MINSAMPLEVALUE",e[281]="MAXSAMPLEVALUE",e[282]="XRESOLUTION",e[283]="YRESOLUTION",e[284]="PLANARCONFIGURATION",e[285]="PAGENAME",e[286]="XPOSITION",e[287]="YPOSITION",e[288]="FREEOFFSETS",e[289]="FREEBYTECOUNTS",e[290]="GRAYRESPONSEUNIT",e[291]="GRAYRESPONSECURVE",e[292]="T4OPTIONS",e[293]="T6OPTIONS",e[296]="RESOLUTIONUNIT",e[297]="PAGENUMBER",e[300]="COLORRESPONSEUNIT",e[301]="TRANSFERFUNCTION",e[305]="SOFTWARE",e[306]="DATETIME",e[315]="ARTIST",e[316]="HOSTCOMPUTER",e[317]="PREDICTOR",e[318]="WHITEPOINT",e[319]="PRIMARYCHROMATICITIES",e[320]="COLORMAP",e[321]="HALFTONEHINTS",e[322]="TILEWIDTH",e[323]="TILELENGTH",e[324]="TILEOFFSETS",e[325]="TILEBYTECOUNTS",e[326]="BADFAXLINES",e[327]="CLEANFAXDATA",e[328]="CONSECUTIVEBADFAXLINES",e[330]="SUBIFD",e[332]="INKSET",e[333]="INKNAMES",e[334]="NUMBEROFINKS",e[336]="DOTRANGE",e[337]="TARGETPRINTER",e[338]="EXTRASAMPLES",e[339]="SAMPLEFORMAT",e[340]="SMINSAMPLEVALUE",e[341]="SMAXSAMPLEVALUE",e[342]="TRANSFERRANGE",e[347]="JPEGTABLES",e[512]="JPEGPROC",e[513]="JPEGIFOFFSET",e[514]="JPEGIFBYTECOUNT",e[515]="JPEGRESTARTINTERVAL",e[517]="JPEGLOSSLESSPREDICTORS",e[518]="JPEGPOINTTRANSFORM",e[519]="JPEGQTABLES",e[520]="JPEGDCTABLES",e[521]="JPEGACTABLES",e[529]="YCBCRCOEFFICIENTS",e[530]="YCBCRSUBSAMPLING",e[531]="YCBCRPOSITIONING",e[532]="REFERENCEBLACKWHITE",e[700]="XMP",e[33550]="GEOPIXELSCALE",e[33922]="GEOTIEPOINTS",e[33432]="COPYRIGHT",e[42112]="GDAL_METADATA",e[42113]="GDAL_NODATA",e[50844]="RPCCOEFFICIENT",e[34264]="GEOTRANSMATRIX",e[34735]="GEOKEYDIRECTORY",e[34736]="GEODOUBLEPARAMS",e[34737]="GEOASCIIPARAMS",e[34665]="EXIFIFD",e[34853]="GPSIFD",e[40965]="INTEROPERABILITYIFD",e})(),Tn=(()=>{const e=dt.slice();return e[36864]="ExifVersion",e[40960]="FlashpixVersion",e[40961]="ColorSpace",e[42240]="Gamma",e[37121]="ComponentsConfiguration",e[37122]="CompressedBitsPerPixel",e[40962]="PixelXDimension",e[40963]="PixelYDimension",e[37500]="MakerNote",e[37510]="UserComment",e[40964]="RelatedSoundFile",e[36867]="DateTimeOriginal",e[36868]="DateTimeDigitized",e[36880]="OffsetTime",e[36881]="OffsetTimeOriginal",e[36882]="OffsetTimeDigitized",e[37520]="SubSecTime",e[37521]="SubSecTimeOriginal",e[37522]="SubSecTimeDigitized",e[37888]="Temperature",e[37889]="Humidity",e[37890]="Pressure",e[37891]="WaterDepth",e[37892]="Acceleration",e[37893]="CameraElevationAngle",e[42016]="ImageUniqueID",e[42032]="CameraOwnerName",e[42033]="BodySerialNumber",e[42034]="LensSpecification",e[42035]="LensMake",e[42036]="LensModel",e[42037]="LensSerialNumber",e[33434]="ExposureTime",e[33437]="FNumber",e[34850]="ExposureProgram",e[34852]="SpectralSensitivity",e[34855]="PhotographicSensitivity",e[34856]="OECF",e[34864]="SensitivityType",e[34865]="StandardOutputSensitivity",e[34866]="RecommendedExposureIndex",e[34867]="ISOSpeed",e[34868]="ISOSpeedLatitudeyyy",e[34869]="ISOSpeedLatitudezzz",e[37377]="ShutterSpeedValue",e[37378]="ApertureValue",e[37379]="BrightnessValue",e[37380]="ExposureBiasValue",e[37381]="MaxApertureValue",e[37382]="SubjectDistance",e[37383]="MeteringMode",e[37384]="LightSource",e[37385]="Flash",e[37386]="FocalLength",e[37396]="SubjectArea",e[41483]="FlashEnergy",e[41484]="SpatialFrequencyResponse",e[41486]="FocalPlaneXResolution",e[41487]="FocalPlaneYResolution",e[41488]="FocalPlaneResolutionUnit",e[41492]="SubjectLocation",e[41493]="ExposureIndex",e[41495]="SensingMethod",e[41728]="FileSource",e[41729]="SceneType",e[41730]="CFAPattern",e[41985]="CustomRendered",e[41986]="ExposureMode",e[41987]="WhiteBalance",e[41988]="DigitalZoomRatio",e[41989]="FocalLengthIn35mmFilm",e[41990]="SceneCaptureType",e[41991]="GainControl",e[41992]="Contrast",e[41993]="Saturation",e[41994]="Sharpness",e[41995]="DeviceSettingDescription",e[41996]="SubjectDistanceRange",e})(),xn=["GPSVersionID","GPSLatitudeRef","GPSLatitude","GPSLongitudeRef","GPSLongitude","GPSAltitudeRef","GPSAltitude","GPSTimeStamp","GPSSatellites","GPSStatus","GPSMeasureMode","GPSDOP","GPSSpeedRef","GPSSpeed","GPSTrackRef","GPSTrack","GPSImgDirectionRef","GPSImgDirection","GPSMapDatum","GPSDestLatitudeRef","GPSDestLatitude","GPSDestLongitudeRef","GPSDestLongitude","GPSDestBearingRef","GPSDestBearing","GPSDestDistanceRef","GPSDestDistance","GPSProcessingMethod","GPSAreaInformation","GPSDateStamp","GPSDifferential","GPSHPositioningError"],In=(()=>{const e=[];return e[1024]="GTModelTypeGeoKey",e[1025]="GTRasterTypeGeoKey",e[1026]="GTCitationGeoKey",e[2048]="GeographicTypeGeoKey",e[2049]="GeogCitationGeoKey",e[2050]="GeogGeodeticDatumGeoKey",e[2051]="GeogPrimeMeridianGeoKey",e[2052]="GeogLinearUnitsGeoKey",e[2053]="GeogLinearUnitSizeGeoKey",e[2054]="GeogAngularUnitsGeoKey",e[2055]="GeogAngularUnitSizeGeoKey",e[2056]="GeogEllipsoidGeoKey",e[2057]="GeogSemiMajorAxisGeoKey",e[2058]="GeogSemiMinorAxisGeoKey",e[2059]="GeogInvFlatteningGeoKey",e[2061]="GeogPrimeMeridianLongGeoKey",e[2060]="GeogAzimuthUnitsGeoKey",e[3072]="ProjectedCSTypeGeoKey",e[3073]="PCSCitationGeoKey",e[3074]="ProjectionGeoKey",e[3075]="ProjCoordTransGeoKey",e[3076]="ProjLinearUnitsGeoKey",e[3077]="ProjLinearUnitSizeGeoKey",e[3078]="ProjStdParallel1GeoKey",e[3079]="ProjStdParallel2GeoKey",e[3080]="ProjNatOriginLongGeoKey",e[3081]="ProjNatOriginLatGeoKey",e[3082]="ProjFalseEastingGeoKey",e[3083]="ProjFalseNorthingGeoKey",e[3084]="ProjFalseOriginLongGeoKey",e[3085]="ProjFalseOriginLatGeoKey",e[3086]="ProjFalseOriginEastingGeoKey",e[3087]="ProjFalseOriginNorthingGeoKey",e[3088]="ProjCenterLongGeoKey",e[3090]="ProjCenterEastingGeoKey",e[3091]="ProjCenterNorthingGeoKey",e[3092]="ProjScaleAtNatOriginGeoKey",e[3093]="ProjScaleAtCenterGeoKey",e[3094]="ProjAzimuthAngleGeoKey",e[3095]="ProjStraightVertPoleLongGeoKey",e[4096]="VerticalCSTypeGeoKey",e[4097]="VerticalCitationGeoKey",e[4098]="VerticalDatumGeoKey",e[4099]="VerticalUnitsGeoKey",e})(),An=(e,t)=>{let n=(t||dt)[e];return n===void 0&&(n="unknown"+String(e)),n},nt=new Map;nt.set("EXIFIFD",Tn),nt.set("GPSIFD",xn);const Pe={TIFF_TAGS:dt,ifdTags:nt,GEO_KEYS:In,getTagName:An},pt=(()=>{const e=new ArrayBuffer(4),t=new Uint8Array(e);return new Uint32Array(e)[0]=1,t[0]===1})(),Mt=[0,1,1,2,4,8,1,1,2,4,8,4,8,-1,-1,-1,8,8,8],Me=4294967296,En=new Set([1,5,6,7,8,34712,34887]);function mt(e,t){let n="unknown";return e===3?n=t===64?"f64":"f32":e===1?t===1?n="u1":t===2?n="u2":t===4?n="u4":t<=8?n="u8":t<=16?n="u16":t<=32&&(n="u32"):e===2&&(t<=8?n="s8":t<=16?n="s16":t<=32&&(n="s32")),n}function je(e){let t=null;switch(e?e.toLowerCase():"f32"){case"u1":case"u2":case"u4":case"u8":t=Uint8Array;break;case"u16":t=Uint16Array;break;case"u32":t=Uint32Array;break;case"s8":t=Int8Array;break;case"s16":t=Int16Array;break;case"s32":t=Int32Array;break;case"f64":t=Float64Array;break;default:t=Float32Array}return t}function kn(e,t){return{x:t[0]*e.x+t[1]*e.y+t[2],y:t[3]*e.x+t[4]*e.y+t[5]}}function _t(e,t){return e.get(t)?.values}function xe(e,t){return e.get(t)?.values}function Ct(e,t){return e.get(t)?.values?.[0]}function j(e,t){return e.get(t)?.values?.[0]}function Ye(e,t,n,o=0,u=Pe.TIFF_TAGS,l=4){const f=l===8,s=f?yt(new DataView(e,n,8),0,t):new DataView(e,n,2).getUint16(0,t),i=4+2*l,r=f?8:2,a=r+s*i;if(n+a>e.byteLength)return{success:!1,ifd:null,nextIFD:null,requiredBufferSize:a};const h=n+a+4<=e.byteLength?$e(new DataView(e,n+a,l===8?8:4),0,t,l===8):null,p=n+r,g=new Map;let b,v,x,c,d,m=0,y=0;for(let w=0;w<s;w++){v=new DataView(e,p+i*w,i),x=v.getUint16(0,t),d=v.getUint16(2,t),c=Pe.getTagName(x,u);const S=[];l===2?(m=v.getUint16(4,t),y=v.getUint16(6,t)):l===4?(m=v.getUint32(4,t),y=v.getUint32(8,t)):l===8&&(m=$e(v,4,t,!0),y=$e(v,12,t,!0),S.push(v.getUint32(12,t)),S.push(v.getUint32(16,t))),b={id:x,type:d,valueCount:m,valueOffset:y,valueOffsets:S,values:null},Un(e,t,b,o,!1,l),g.set(c,b)}return{success:!0,ifd:g,nextIFD:h,requiredBufferSize:a}}const Pn=(e,t)=>Vt(e,{inputOffset:t}).pixels[0];function rt(e,t){if(t!==1&&t!==2&&t!==4)return e;const n=new Uint8Array(e),o=8/t,u=new Uint8Array(e.byteLength*o);let l=0;const f=2**t-1;for(let s=0;s<n.length;s++){const i=n[s];for(let r=0;r<o;r++)u[l++]=i<<t*r>>>8-t&f}return u.buffer}function it(e,t,n){const o=new Nt;o.parse(e),o.colorTransform=n===6?-1:0;const u=o.getData(o.width,o.height,t!==1);return new Uint8Array(u.buffer)}function st(e){const t=new Ge(e).getBytes(),n=new ArrayBuffer(t.length),o=new Uint8Array(n);return o.set(t),o}async function at(e,t,n,o,u){const l=pt===t,f=j(n,"BITSPERSAMPLE"),s=j(n,"SAMPLESPERPIXEL")??1,i=j(n,"PHOTOMETRICINTERPRETATION"),r=j(n,"SAMPLEFORMAT")??1,a=mt(r,f),h=j(n,"COMPRESSION")??1,p=je(a);let g,b,v;if(h===34887)return await Bt(),Pn(e,o);if(h===1)g=e.slice(o,o+u),b=new Uint8Array(g);else if(h===8||h===32946)b=new Uint8Array(e,o,u),b=st(b),g=b.buffer;else if(h===6)b=new Uint8Array(e,o,u),b=it(b,s,i),g=b.buffer;else if(h===7){const m=n.get("JPEGTABLES").values,y=m.length-2;b=new Uint8Array(y+u-2);for(let S=0;S<y;S++)b[S]=m[S];const w=new Uint8Array(e,o+2,u-2);for(let S=0;S<w.length;S++)b[y+S]=w[S];b=it(b,s,i),g=b.buffer}else{if(h!==5)throw new Error("tiff-decode: unsupport compression "+h);b=ft(e,o,u,t),g=b.buffer}if(g=rt(g,f),a==="u8"||a==="s8"||l)v=new p(g);else{g=new ArrayBuffer(b.length);const m=new Uint8Array(g);switch(a){case"u16":case"s16":for(let y=0;y<b.length;y+=2)m[y]=b[y+1],m[y+1]=b[y];break;case"u32":case"s32":case"f32":for(let y=0;y<b.length;y+=4)m[y]=b[y+3],m[y+1]=b[y+2],m[y+2]=b[y+1],m[y+3]=b[y]}v=new p(g)}const x=j(n,"PREDICTOR")??1,c=j(n,"TILEWIDTH"),d=j(n,"TILELENGTH");if(x>1&&(h===5||h===8||h===32946)&&c&&d){const m=ze(n),y=new p(v.length);y.set(v),v=Fn(y,d,c,r===3&&x===3,m?1:s)}return v}async function Mn(e,t,n){const o=xe(n,"TILEOFFSETS");if(o===void 0)return null;const u=xe(n,"TILEBYTECOUNTS"),{width:l,height:f,pixelType:s,tileWidth:i,tileHeight:r}=gt([n]),a=ze(n,t),h=j(n,"SAMPLESPERPIXEL")||t.planes,p=l*f,g=j(n,"BITSPERSAMPLE"),b=(j(n,"COMPRESSION")??1)===34887,v=je(s),x=[];for(let L=0;L<h;L++)x.push(new v(p));let c,d,m,y,w,S,T,A,I,E,k,P,M;const R=Math.ceil(l/i);if(g%8==0){if(b&&a&&h>1){const L=Math.round(o.length/h);for(c=0;c<L;c++){S=Math.floor(c/R)*r,T=c%R*i,A=S*l+T;for(let U=0;U<h;U++){const C=c*h+U;if(u[C]!==0)for(m=await at(e,t.littleEndian,n,o[C],u[C]),E=0,I=A,P=Math.min(i,l-T),k=Math.min(r,f-S),M=x[U],y=0;y<k;y++)for(I=A+y*l,E=y*i,w=0;w<P;w++,I++,E++)M[I]=m[E]}}}else for(c=0;c<o.length;c++)if(u[c]!==0)for(S=Math.floor(c/R)*r,T=c%R*i,A=S*l+T,m=await at(e,t.littleEndian,n,o[c],u[c]),E=0,I=A,P=Math.min(i,l-T),k=Math.min(r,f-S),d=0;d<h;d++)if(M=x[d],a||b)for(y=0;y<k;y++)for(I=A+y*l,E=i*r*d+y*i,w=0;w<P;w++,I++,E++)M[I]=m[E];else for(y=0;y<k;y++)for(I=A+y*l,E=y*i*h+d,w=0;w<P;w++,I++,E+=h)M[I]=m[E]}return{width:l,height:f,pixelType:s,pixels:x}}const Cn=(e,t,n)=>{const o=pt===t.littleEndian,u=xe(n,"STRIPOFFSETS");if(u===void 0)return null;const{width:l,height:f,pixelType:s}=gt([n]),i=j(n,"SAMPLESPERPIXEL")||t.planes,r=j(n,"PHOTOMETRICINTERPRETATION"),a=l*f,h=j(n,"BITSPERSAMPLE"),p=je(s),g=new p(a*i),b=xe(n,"STRIPBYTECOUNTS"),v=j(n,"ROWSPERSTRIP"),x=j(n,"COMPRESSION")??1;let c,d,m,y,w,S,T,A,I,E=v;if(h%8==0)for(c=0;c<u.length;c++){if(w=c*(v*l)*i,E=(c+1)*v>f?f-c*v:v,s==="u8"||s==="s8"||o)x===8||x===32946?(T=new Uint8Array(e,u[c],b[c]),T=st(T),S=T.buffer):x===6?(T=new Uint8Array(e,u[c],b[c]),T=it(T,i,r),S=T.buffer):x===5?(T=ft(e,u[c],b[c],t.littleEndian),S=T.buffer):(b[c]!==E*l*i*h/8&&console.log("strip byte counts is different than expected"),S=e.slice(u[c],u[c]+b[c])),S=rt(S,h),y=new p(S);else{switch(x===6||x===8||x===32946?(T=new Uint8Array(e,u[c],b[c]),A=st(T),S=A.buffer):(b[c]!==E*l*i*h/8&&console.log("strip byte counts is different than expected"),S=new ArrayBuffer(b[c]),T=new Uint8Array(e,u[c],b[c]),A=new Uint8Array(S)),s){case"u16":case"s16":for(m=0;m<T.length;m+=2)A[m]=T[m+1],A[m+1]=T[m];break;case"u32":case"s32":case"f32":for(m=0;m<T.length;m+=4)A[m]=T[m+3],A[m+1]=T[m+2],A[m+2]=T[m+1],A[m+3]=T[m]}S=rt(S,h),y=new p(S)}g.set(y,w)}const k=[];if(i===1)k.push(g);else for(c=0;c<i;c++){for(I=new p(a),d=0;d<a;d++)I[d]=g[d*i+c];k.push(I)}return{width:l,height:f,pixelType:s,pixels:k}},Ln=(e,t,n)=>{if(!(e&&e.length>0&&t&&n))return null;let o,u,l;const f=e[0].length,s=e.length,i=new Uint8Array(f);for(let r=0;r<s;r++)if(o=e[r],u=t[r],l=n[r],r===0)for(let a=0;a<f;a++)i[a]=o[a]<u||o[a]>l?0:1;else for(let a=0;a<f;a++)i[a]&&(i[a]=o[a]<u||o[a]>l?0:1);return i},On=e=>{if(!e)return null;const t=e.match(/<Item(.*?)Item>/gi);if(!t||t.length===0)return null;const n=new Map;let o,u,l,f,s;for(let c=0;c<t.length;c++)o=t[c],u=o.slice(6,o.indexOf(">")),f=o.indexOf("sample="),f>-1&&(s=o.slice(f+8,o.indexOf('"',f+8))),f=o.indexOf("name="),f>-1&&(u=o.slice(f+6,o.indexOf('"',f+6))),u&&(l=o.slice(o.indexOf(">")+1,o.indexOf("</Item>")).trim(),s!=null?n.has(u)?n.get(u)[s]=l:n.set(u,[l]):n.set(u,l)),s=null;const i=n.get("STATISTICS_MINIMUM"),r=n.get("STATISTICS_MAXIMUM"),a=n.get("STATISTICS_MEAN"),h=n.get("STATISTICS_STDDEV");let p=null;if(i&&r){p=[];for(let c=0;c<i.length;c++)p.push({min:parseFloat(i[c]),max:parseFloat(r[c]),avg:a&&parseFloat(a[c]),stddev:h&&parseFloat(h[c])})}const g=n.get("BandName"),b=n.get("WavelengthMin"),v=n.get("WavelengthMax");let x=null;if(g){x=[];for(let c=0;c<g.length;c++)x.push({BandName:g[c],WavelengthMin:b&&parseFloat(b[c]),WavelengthMax:v&&parseFloat(v[c])})}return{statistics:p,bandProperties:x,dataType:n.get("DataType"),rawMetadata:n}};function Un(e,t,n,o=0,u=!1,l=4){if(n.values)return!0;const f=n.type,s=n.valueCount;let i=n.valueOffset,r=[];const a=Mt[f],h=8*a,p=s*a,g=s*Mt[f]*8;let b,v;const x=l===8?64:32,c=n.valueOffsets;if(g>x&&p>(u?e.byteLength:e?e.byteLength-i+o:0))return n.offlineOffsetSize=[i,p],n.values=null,!1;if(g<=x){if(!t)if(x<=32)i>>>=32-g;else{const d=c?.length?c[0]:i>>>0,m=c?.length?c[1]:Math.round((i-d)/Me);g<=32?(i=d>>>32-g,c[0]=i):(i=d*2**(32-g)+(m>>>32-g),c[0]=d,c[1]=m>>>32-g)}if(s===1&&h===x)r=[i];else if(x===64){const d=c?.length?c[0]:i>>>0,m=c?.length?c[1]:Math.round((i-d)/Me);let y=d,w=32;for(v=1;v<=s;v++){const S=32-h*v%32;if(w<h){const T=y<<S>>>32-w,A=m<<32-w>>>32-w;y=m,r.push(T+A*2**(h-w)),w-=32-(h-w)}else r.push(y<<S>>>32-h),w-=h;w===0&&(w=32,y=m)}}else for(v=1;v<=s;v++){const d=32-h*v;r.push(i<<d>>>32-h)}}else{i-=o,u&&(i=0);for(let d=i;d<i+p;d+=a){switch(f){case 1:case 2:case 7:b=new DataView(e,d,1).getUint8(0);break;case 3:b=new DataView(e,d,2).getUint16(0,t);break;case 4:case 13:b=new DataView(e,d,4).getUint32(0,t);break;case 5:b=new DataView(e,d,4).getUint32(0,t)/new DataView(e,d+4,4).getUint32(0,t);break;case 6:b=new DataView(e,d,1).getInt8(0);break;case 8:b=new DataView(e,d,2).getInt16(0,t);break;case 9:b=new DataView(e,d,4).getInt32(0,t);break;case 10:b=new DataView(e,d,4).getInt32(0,t)/new DataView(e,d+4,4).getInt32(0,t);break;case 11:b=new DataView(e,d,4).getFloat32(0,t);break;case 12:b=new DataView(e,d,8).getFloat64(0,t);break;case 16:case 18:b=yt(new DataView(e,d,8),0,t);break;case 17:b=Dn(new DataView(e,d,8),0,t);break;default:b=null}r.push(b)}}if(f===2){let d="";const m=r;for(r=[],v=0;v<m.length;v++)m[v]===0&&d!==""?(r.push(d),d=""):d+=String.fromCharCode(m[v]);d===""&&r.length!==0||r.push(d)}return n.values=r,!0}function gt(e){const t=e[0],n=j(t,"TILEWIDTH"),o=j(t,"TILELENGTH"),u=j(t,"IMAGEWIDTH"),l=j(t,"IMAGELENGTH"),f=j(t,"BITSPERSAMPLE"),s=j(t,"SAMPLESPERPIXEL"),i=j(t,"SAMPLEFORMAT")??1,r=mt(i,f),a=ze(t),h=_t(t,"GDAL_NODATA");let p=null;h?.length&&(p=h.map(D=>parseFloat(D)),p.some(D=>isNaN(D))&&(p=null));const g=j(t,"COMPRESSION")??1;let b;switch(g){case 1:b="NONE";break;case 2:case 3:case 4:case 32771:b="CCITT";break;case 5:b="LZW";break;case 6:case 7:b="JPEG";break;case 32773:b="PACKBITS";break;case 8:case 32946:b="DEFLATE";break;case 34712:b="JPEG2000";break;case 34887:b="LERC";break;default:b=String(g)}let v=!0,x="";En.has(g)||(v=!1,x+="unsupported tag compression "+g),i>3&&(v=!1,x+="unsupported tag sampleFormat "+i),f!==1&&f!==2&&f!==4&&f%8!=0&&(v=!1,x+="unsupported tag bitsPerSample "+f);const c=Ct(t,"GEOASCIIPARAMS");let d;if(c){const D=c.split("|").find(z=>z.includes("ESRI PE String = ")),O=D?D.replace("ESRI PE String = ",""):"";d=O.startsWith("COMPD_CS")||O.startsWith("PROJCS")||O.startsWith("GEOGCS")?{wkid:null,wkt:O}:null}const m=xe(t,"GEOTIEPOINTS"),y=xe(t,"GEOPIXELSCALE"),w=xe(t,"GEOTRANSMATRIX"),S=t.has("GEOKEYDIRECTORY")?t.get("GEOKEYDIRECTORY").data:null;let T,A,I=!1,E=!1;if(S){I=j(S,"GTRasterTypeGeoKey")===2;const D=j(S,"GTModelTypeGeoKey");if(D===2){const O=j(S,"GeographicTypeGeoKey");O>=1024&&O<=32766&&(d={wkid:O}),d||O!==32767||(E=!0,d={wkid:4326})}else if(D===1){const O=j(S,"ProjectedCSTypeGeoKey");O>=1024&&O<=32766&&(d={wkid:O})}}if(y&&m&&m.length>=6?(T=[y[0],0,m[3]-m[0]*y[0],0,-Math.abs(y[1]),m[4]-m[1]*y[1]],I&&(T[2]-=.5*T[0]+.5*T[1],T[5]-=.5*T[3]+.5*T[4])):w&&w.length===16&&(T=I?[w[0],w[1],w[3]-.5*w[0],w[4],w[5],w[7]-.5*w[5]]:[w[0],w[1],w[3],w[4],w[5],w[7]]),T){const D=[{x:0,y:l},{x:0,y:0},{x:u,y:l},{x:u,y:0}];let O,z=Number.POSITIVE_INFINITY,V=Number.POSITIVE_INFINITY,$=Number.NEGATIVE_INFINITY,_=Number.NEGATIVE_INFINITY;for(let X=0;X<D.length;X++)O=kn(D[X],T),z=O.x>z?z:O.x,$=O.x<$?$:O.x,V=O.y>V?V:O.y,_=O.y<_?_:O.y;A={xmin:z,xmax:$,ymin:V,ymax:_,spatialReference:d}}else A={xmin:-.5,ymin:.5-l,xmax:u-.5,ymax:.5,spatialReference:d};E&&(A.xmax-A.xmin>400||Math.max(Math.abs(A.xmin),Math.abs(A.xmax))>361)&&(d=null,A.spatialReference=null);const k=jt(e);let P,M,R,L,U;if(k.length>0){R=Math.round(Math.log(u/j(k[0],"IMAGEWIDTH"))/Math.LN2);const D=k[k.length-1];L=Math.round(Math.log(u/j(D,"IMAGEWIDTH"))/Math.LN2),P=j(D,"TILEWIDTH"),M=j(D,"TILELENGTH")}P=L!=null&&L>0?P||n:null,M=L!=null&&L>0?M||o:null,n&&(U=[{maxCol:Math.ceil(u/n)-1,maxRow:Math.ceil(l/o)-1,minRow:0,minCol:0}],k.forEach(D=>{U.push({maxCol:Math.ceil(j(D,"IMAGEWIDTH")/j(D,"TILEWIDTH"))-1,maxRow:Math.ceil(j(D,"IMAGELENGTH")/j(D,"TILELENGTH"))-1,minRow:0,minCol:0})}));const C=Ct(e[0],"GDAL_METADATA"),F=On(C);return x+=" "+Wt({width:u,height:l,tileWidth:n,tileHeight:o,planes:s,ifds:e}),{width:u,height:l,tileWidth:n,tileHeight:o,planes:s,isBSQ:a,pixelType:r,compression:b,noData:p,hasMaskBand:zt(e).length===k.length+1,isSupported:v,message:x,extent:A,isPseudoGeographic:E,affine:y?null:T,firstPyramidLevel:R,maximumPyramidLevel:L,pyramidBlockWidth:P,pyramidBlockHeight:M,tileBoundary:U,metadata:F}}function ze(e,t){const n=_t(e,"PLANARCONFIGURATION");return n?n[0]===2:!!t&&t.isBSQ}function jt(e){return e.filter(t=>j(t,"NEWSUBFILETYPE")===1)}function zt(e){return e.filter(t=>{const n=(4&(j(t,"NEWSUBFILETYPE")??0))==4,o=j(t,"PHOTOMETRICINTERPRETATION")===4;return n&&o})}function Rn(e){const{littleEndian:t,isBigTiff:n,firstIFDPos:o}=Gn(e);let u=o;const l=[];do{const f=Nn(e,t,u,0,Pe.TIFF_TAGS,n?8:4);if(!f.success)break;l.push(f.ifd),u=f.nextIFD}while(u>0);return{...gt(l),littleEndian:t,isBigTiff:n,ifds:l,pyramidIFDs:jt(l),maskIFDs:zt(l)}}function yt(e,t,n){const o=e.getUint32(t,n),u=e.getUint32(t+4,n);return n?u*Me+o:o*Me+u}function Dn(e,t,n){let o=n?e.getInt32(t,n):e.getUint32(t,n),u=n?e.getUint32(t+4,n):e.getInt32(t+4,n);const l=(n?o:u)>=0?1:-1;return n?o*=l:u*=l,l*(n?u*Me+o:o*Me+u)}function $e(e,t,n,o){return o?yt(e,t,n):e.getUint32(t,n)}function Gn(e){const t=new DataView(e,0,16),n=t.getUint16(0,!1);let o=null;if(n===18761)o=!0;else{if(n!==19789)throw new Error("unexpected endianess byte");o=!1}const u=t.getUint16(2,o);if(u!==42&&u!==43)throw new Error("unexpected tiff identifier");let l=4;const f=u===43;if(f){const s=t.getUint16(l,o);if(l+=2,s!==8)throw new Error("unsupported bigtiff version");if(t.getUint16(l,o)!==0)throw new Error("unsupported bigtiff version");l+=2}return{littleEndian:o,isBigTiff:f,firstIFDPos:$e(t,l,o,f)}}function Nn(e,t,n,o=0,u=Pe.TIFF_TAGS,l=4){const f=Ye(e,t,n,o,u,l);let s;const i=f.ifd;if(i){if(Pe.ifdTags.forEach((r,a)=>{i.has(a)&&(s=i.get(a),s.data=Ye(e,t,s.valueOffset-o,o,r).ifd)}),i.has("GEOKEYDIRECTORY")){s=i.get("GEOKEYDIRECTORY");const r=s.values;if(r&&r.length>4){const a=r[0]+"."+r[1]+"."+r[2];s.data=Ye(e,t,s.valueOffset+6-o,o,Pe.GEO_KEYS,2).ifd,s.data&&s.data.set("GEOTIFFVersion",{id:0,type:2,valueCount:1,valueOffset:null,values:[a]})}}if(i.has("XMP")){s=i.get("XMP");const r=s.values;typeof r[0]=="number"&&s.type===7&&(s.values=[Sn(new Uint8Array(r))])}}return f}function Wt(e){const{width:t,height:n,tileHeight:o,tileWidth:u}=e,l=e.planes,f=u?u*o:t*n,s=j(e.ifds[0],"BITSPERSAMPLE");let i="";return f*l>2**30/(s>8?s/8:1)&&(i=u?"tiled tiff exceeding 1 gigabits per tile is not supported":"scanline tiff exceeding 1 gigabits is not supported"),i}function Fn(e,t,n,o,u){const l=o?4:1,f=n*l*u;o&&(e=new Uint8Array(e.buffer));for(let r=0;r<t;r++){const a=r*f;for(let h=u;h<f;h++)e[a+h]+=e[a+h-u]}if(!o)return e;const s=new Uint8Array(e.length),i=n*u;for(let r=0;r<t;r++){const a=r*f;for(let h=0;h<i;h++)for(let p=0;p<l;p++)s[a+h*l+p]=e[a+h+(l-p-1)*i]}return new Float32Array(s.buffer)}async function Bn(e,t){const{headerInfo:n,ifd:o,offsets:u,sizes:l}=t,f=[];for(let I=0;I<u.length;I++){const E=await at(e,n.littleEndian,o,u[I],l[I]||e.byteLength);f.push(E)}const s=ze(o,n),i=j(o,"BITSPERSAMPLE"),r=mt(j(o,"SAMPLEFORMAT")??1,i),a=j(o,"SAMPLESPERPIXEL")||n.planes,h=je(r),p=j(o,"TILEWIDTH"),g=j(o,"TILELENGTH"),b=j(o,"COMPRESSION")??1,v=p*g;let x;const c=[];let d=f[0];const m=b===34887;for(let I=0;I<a;I++){if(x=new h(v),f.length===a)d=f[I],d.length===v&&(x=d);else if(d.length)if(s||m)x=d.length===v?d:d.slice(v*I,v*(I+1));else for(let E=0;E<v;E++)x[E]=d[E*a+I];c.push(x)}const y=n.noData?n.noData[0]:t.noDataValue,w=n.metadata?n.metadata.statistics:null,S=w?w.map(I=>I.min):null,T=w?w.map(I=>I.max):null,A={pixelType:r,width:p,height:g,pixels:c,noDataValue:y};return y!=null?ht(A,y):S&&T&&t.applyMinMaxConstraint&&(A.mask=Ln(c,S,T)),A}async function Vn(e,t={}){const n=t.pyramidLevel||0,o=t.headerInfo||Rn(e),{ifds:u,noData:l}=o;if(u.length===0)throw new Error("no valid image file directory");const f=Wt(o);if(f)throw f;let s=null;const i=n===-1?u[u.length-1]:u[n],r=l??t.noDataValue;return s=o.tileWidth?await Mn(e,o,i):await Cn(e,o,i),s&&(r!=null&&ht(s,r),s)}var $n=function(e){var t,n,o,u,l,f;function s(i){var r,a,h,p,g,b,v,x,c,d,m,y,w;for(this.data=i,this.pos=8,this.palette=[],this.imgData=[],this.transparency={},this.animation=null,this.text={},g=null;;){switch(r=this.readUInt32(),x=function(){var S,T;for(T=[],S=0;S<4;++S)T.push(String.fromCharCode(this.data[this.pos++]));return T}.call(this).join(""),x){case"IHDR":this.width=this.readUInt32(),this.height=this.readUInt32(),this.bits=this.data[this.pos++],this.colorType=this.data[this.pos++],this.compressionMethod=this.data[this.pos++],this.filterMethod=this.data[this.pos++],this.interlaceMethod=this.data[this.pos++];break;case"acTL":this.animation={numFrames:this.readUInt32(),numPlays:this.readUInt32()||1/0,frames:[]};break;case"PLTE":this.palette=this.read(r);break;case"fcTL":g&&this.animation.frames.push(g),this.pos+=4,g={width:this.readUInt32(),height:this.readUInt32(),xOffset:this.readUInt32(),yOffset:this.readUInt32()},p=this.readUInt16(),h=this.readUInt16()||100,g.delay=1e3*p/h,g.disposeOp=this.data[this.pos++],g.blendOp=this.data[this.pos++],g.data=[];break;case"IDAT":case"fdAT":for(x==="fdAT"&&(this.pos+=4,r-=4),i=g?.data||this.imgData,m=0;0<=r?m<r:m>r;0<=r?++m:--m)i.push(this.data[this.pos++]);break;case"tRNS":switch(this.transparency={},this.colorType){case 3:if(this.transparency.indexed=this.read(r),(c=255-this.transparency.indexed.length)>0)for(y=0;0<=c?y<c:y>c;0<=c?++y:--y)this.transparency.indexed.push(255);break;case 0:this.transparency.grayscale=this.read(r)[0];break;case 2:this.transparency.rgb=this.read(r)}break;case"tEXt":b=(d=this.read(r)).indexOf(0),v=String.fromCharCode.apply(String,d.slice(0,b)),this.text[v]=String.fromCharCode.apply(String,d.slice(b+1));break;case"IEND":return g&&this.animation.frames.push(g),this.colors=function(){switch(this.colorType){case 0:case 3:case 4:return 1;case 2:case 6:return 3}}.call(this),this.hasAlphaChannel=(w=this.colorType)===4||w===6,a=this.colors+(this.hasAlphaChannel?1:0),this.pixelBitlength=this.bits*a,this.colorSpace=function(){switch(this.colors){case 1:return"DeviceGray";case 3:return"DeviceRGB"}}.call(this),void(this.imgData=new Uint8Array(this.imgData));default:this.pos+=r}if(this.pos+=4,this.pos>this.data.length)throw new Error("Incomplete or corrupt PNG file")}}return s.load=function(i,r,a){var h;return typeof r=="function"&&(a=r),(h=new XMLHttpRequest).open("GET",i,!0),h.responseType="arraybuffer",h.onload=function(){var p;return p=new s(new Uint8Array(h.response||h.mozResponseArrayBuffer)),typeof r?.getContext=="function"&&p.render(r),typeof a=="function"?a(p):void 0},h.send(null)},n=1,o=2,t=0,s.prototype.read=function(i){var r,a;for(a=[],r=0;0<=i?r<i:r>i;0<=i?++r:--r)a.push(this.data[this.pos++]);return a},s.prototype.readUInt32=function(){return this.data[this.pos++]<<24|this.data[this.pos++]<<16|this.data[this.pos++]<<8|this.data[this.pos++]},s.prototype.readUInt16=function(){return this.data[this.pos++]<<8|this.data[this.pos++]},s.prototype.decodePixels=function(i){var r,a,h,p,g,b,v,x,c,d,m,y,w,S,T,A,I,E,k,P,M,R,L;if(i==null&&(i=this.imgData),i.length===0)return new Uint8Array(0);for(i=(i=new Ge(i)).getBytes(),A=(y=this.pixelBitlength/8)*this.width,w=new Uint8Array(A*this.height),b=i.length,T=0,S=0,a=0;S<b;){switch(i[S++]){case 0:for(p=k=0;k<A;p=k+=1)w[a++]=i[S++];break;case 1:for(p=P=0;P<A;p=P+=1)r=i[S++],g=p<y?0:w[a-y],w[a++]=(r+g)%256;break;case 2:for(p=M=0;M<A;p=M+=1)r=i[S++],h=(p-p%y)/y,I=T&&w[(T-1)*A+h*y+p%y],w[a++]=(I+r)%256;break;case 3:for(p=R=0;R<A;p=R+=1)r=i[S++],h=(p-p%y)/y,g=p<y?0:w[a-y],I=T&&w[(T-1)*A+h*y+p%y],w[a++]=(r+Math.floor((g+I)/2))%256;break;case 4:for(p=L=0;L<A;p=L+=1)r=i[S++],h=(p-p%y)/y,g=p<y?0:w[a-y],T===0?I=E=0:(I=w[(T-1)*A+h*y+p%y],E=h&&w[(T-1)*A+(h-1)*y+p%y]),v=g+I-E,x=Math.abs(v-g),d=Math.abs(v-I),m=Math.abs(v-E),c=x<=d&&x<=m?g:d<=m?I:E,w[a++]=(r+c)%256;break;default:throw new Error("Invalid filter algorithm: "+i[S-1])}T++}return w},s.prototype.decodePalette=function(){var i,r,a,h,p,g,b,v,x;for(a=this.palette,g=this.transparency.indexed||[],p=new Uint8Array((g.length||0)+a.length),h=0,a.length,i=0,r=b=0,v=a.length;b<v;r=b+=3)p[h++]=a[r],p[h++]=a[r+1],p[h++]=a[r+2],p[h++]=(x=g[i++])!=null?x:255;return p},s.prototype.copyToImageData=function(i,r){var a,h,p,g,b,v,x,c,d,m,y;if(h=this.colors,d=null,a=this.hasAlphaChannel,this.palette.length&&(d=(y=this._decodedPalette)!=null?y:this._decodedPalette=this.decodePalette(),h=4,a=!0),c=(p=i.data||i).length,b=d||r,g=v=0,h===1)for(;g<c;)x=d?4*r[g/4]:v,m=b[x++],p[g++]=m,p[g++]=m,p[g++]=m,p[g++]=a?b[x++]:this.transparency.grayscale&&this.transparency.grayscale===m?0:255,v=x;else for(;g<c;)x=d?4*r[g/4]:v,p[g++]=b[x++],p[g++]=b[x++],p[g++]=b[x++],p[g++]=a?b[x++]:this.transparency.rgb&&this.transparency.rgb[1]===b[x-3]&&this.transparency.rgb[3]===b[x-2]&&this.transparency.rgb[5]===b[x-1]?0:255,v=x},s.prototype.decode=function(){var i;return i=new Uint8Array(this.width*this.height*4),this.copyToImageData(i,this.decodePixels()),i},l=e.document&&e.document.createElement("canvas"),f=l&&l.getContext("2d"),u=function(i){var r;return f.width=i.width,f.height=i.height,f.clearRect(0,0,i.width,i.height),f.putImageData(i,0,0),(r=new Image).src=l.toDataURL(),r},s.prototype.decodeFrames=function(i){var r,a,h,p,g,b,v,x;if(this.animation){for(x=[],a=g=0,b=(v=this.animation.frames).length;g<b;a=++g)r=v[a],h=i.createImageData(r.width,r.height),p=this.decodePixels(new Uint8Array(r.data)),this.copyToImageData(h,p),r.imageData=h,x.push(r.image=u(h));return x}},s.prototype.renderFrame=function(i,r){var a,h,p;return a=(h=this.animation.frames)[r],p=h[r-1],r===0&&i.clearRect(0,0,this.width,this.height),p?.disposeOp===n?i.clearRect(p.xOffset,p.yOffset,p.width,p.height):p?.disposeOp===o&&i.putImageData(p.imageData,p.xOffset,p.yOffset),a.blendOp===t&&i.clearRect(a.xOffset,a.yOffset,a.width,a.height),i.drawImage(a.image,a.xOffset,a.yOffset)},s.prototype.animate=function(i){var r,a,h,p,g,b,v=this;return a=0,b=this.animation,p=b.numFrames,h=b.frames,g=b.numPlays,(r=function(){var x,c;if(x=a++%p,c=h[x],v.renderFrame(i,x),p>1&&a/p<g)return v.animation._timeout=setTimeout(r,c.delay)})()},s.prototype.stopAnimation=function(){var i;return clearTimeout((i=this.animation)!=null?i._timeout:void 0)},s.prototype.render=function(i){var r,a;return i._png&&i._png.stopAnimation(),i._png=this,i.width=this.width,i.height=this.height,r=i.getContext("2d"),this.animation?(this.decodeFrames(r),this.animate(r)):(a=r.createImageData(this.width,this.height),this.copyToImageData(a,this.decodePixels()),r.putImageData(a,0,0))},s}(self);const _n=new Set(["jpg","png","bmp","gif"]);async function jn(e,t){if(!pt)throw new ye("rasterCoded:decode","lerc decoder is not supported on big endian platform");await Bt();const{offset:n}=t,{width:o,height:u,pixelType:l,statistics:f,depthCount:s,noDataValues:i,bandMasks:r,pixels:a,mask:h}=Vt(e,{inputOffset:n,returnInterleaved:t.returnInterleaved});return new ie({width:o,height:u,pixelType:l.toLowerCase(),pixels:a,mask:h,statistics:f,bandMasks:r,depthCount:s,noDataValues:i})}async function zn(e,t){const n=await Vn(e,{...t,noDataValue:null});Ve(n);const o=new ie({width:n.width,height:n.height,pixels:n.pixels,pixelType:n.pixelType.toLowerCase(),mask:n.mask,statistics:null});return o.updateStatistics(),o}async function Wn(e,t){const n=await Bn(e,t.customOptions),o=new ie({width:n.width,height:n.height,pixels:n.pixels,pixelType:n.pixelType.toLowerCase(),mask:n.mask,statistics:null});return o.updateStatistics(),o}function Ht(e,t){const n=t.pixelType||"u8",o=ie.getPixelArrayConstructor(n),u=n==="u8"?e:new o(e.buffer),l=[],f=t.planes||1;if(f===1)l.push(u);else for(let i=0;i<f;i++){const r=(t.width||1)*(t.height||e.length),a=new o(r);for(let h=0;h<r;h++)a[h]=u[h*f+i];l.push(a)}const s=new ie({width:t.width||1,height:t.height||e.length,pixels:l,pixelType:n,statistics:null});return s.updateStatistics(),s}function Hn(e,t){return Ht(new Ge(new Uint8Array(e)).getBytes(),t)}function qn(e,t){return Ht(ft(e,t.offset,t.eof,!t.isInputBigEndian),t)}function Kn(e,t,n){const{pixelTypeCtor:o}=Qn(t.pixelType),u=(0,vn.decode)(e,{width:t.width,height:t.height,pixelType:o,format:n}),l=new ie({width:t.width,height:t.height,pixels:u.pixels,pixelType:t.pixelType,mask:u.mask,statistics:null});return l.updateStatistics(),l}function Jn(e,t){const n=pn.decode(e,t.hasNoZlibMask??void 0),o=new ie({width:n.width,height:n.height,pixels:n.pixels,pixelType:"U8",mask:n.mask,statistics:null});return o.updateStatistics(),o}function Yn(e,t){const n=new Uint8Array(e),o=new $n(n),{width:u,height:l}=t,f=u*l,s=o.decode();let i,r=0,a=0;const h=new Uint8Array(f);for(r=0;r<f;r++)h[r]=s[4*r+3];const p=new ie({width:u,height:l,pixels:[],pixelType:"U8",mask:h,statistics:[]});for(r=0;r<3;r++){for(i=new Uint8Array(f),a=0;a<f;a++)i[a]=s[4*a+r];p.addData({pixels:i})}return p.updateStatistics(),p}async function Xn(e,t,n,o){const u=new dn,l={applyJpegMask:!1,format:t,...n},f=await u.decode(e,l,o),s=new ie(f);return s.updateStatistics(),s}function qt(e){if(e==null)throw new ye("rasterCodec:decode","parameter encodeddata is required.");const t=new Uint8Array(e,0,10);let n="";return t[0]===255&&t[1]===216?n="jpg":t[0]===137&&t[1]===80&&t[2]===78&&t[3]===71?n="png":t[0]===67&&t[1]===110&&t[2]===116&&t[3]===90&&t[4]===73&&t[5]===109&&t[6]===97&&t[7]===103&&t[8]===101&&t[9]===32?n="lerc":t[0]===76&&t[1]===101&&t[2]===114&&t[3]===99&&t[4]===50&&t[5]===32?n="lerc2":t[0]===73&&t[1]===73&&t[2]===42&&t[3]===0||t[0]===77&&t[1]===77&&t[2]===0&&t[3]===42||t[0]===73&&t[1]===73&&t[2]===43&&t[3]===0||t[0]===77&&t[1]===77&&t[2]===0&&t[3]===43?n="tiff":t[0]===71&&t[1]===73&&t[2]===70?n="gif":t[0]===66&&t[1]===77?n="bmp":String.fromCharCode.apply(null,t).toLowerCase().includes("error")&&(n="error"),n}function Zn(e){let t=null;switch(e){case"lerc":case"lerc2":t=jn;break;case"jpg":t=Jn;break;case"png":t=Yn;break;case"bsq":case"bip":t=(n,o)=>Kn(n,o,e);break;case"tiff":t=zn;break;case"deflate":t=Hn;break;case"lzw":t=qn;break;case"error":t=()=>{throw new ye("rasterCodec:decode","input data contains error")};break;default:t=()=>{throw new ye("rasterCodec:decode","unsupported raster format")}}return t}function Qn(e){let t=null,n=null;switch(e?e.toLowerCase():"f32"){case"u1":case"u2":case"u4":case"u8":n=255,t=Uint8Array;break;case"u16":n=n||65535,t=Uint16Array;break;case"u32":n=n||2**32-1,t=Uint32Array;break;case"s8":n=n||-128,t=Int8Array;break;case"s16":n=n||-32768,t=Int16Array;break;case"s32":n=n||0-2**31,t=Int32Array;break;default:t=Float32Array}return{pixelTypeCtor:t,noDataValue:n}}function er(e,t=1){if(!e)return;const{pixels:n,width:o,height:u,mask:l}=e;if(!n||n.length===0)return;const f=n.length,s=o-1,i=u-1,r=[];let a,h,p,g,b,v,x=null;const c=ie.getPixelArrayConstructor(e.pixelType);if(t===0){for(a=0;a<f;a++){for(b=n[a],v=new c(s*i),h=0;h<i;h++)for(g=h*o,p=0;p<s;p++)v[h*s+p]=b[g+p];r.push(v)}if(l!=null)for(x=new Uint8Array(s*i),h=0;h<i;h++)for(g=h*o,p=0;p<s;p++)x[h*s+p]=l[g+p]}else{for(a=0;a<f;a++){for(b=n[a],v=new c(s*i),h=0;h<i;h++)for(g=h*o,p=0;p<s;p++)v[h*s+p]=(b[g+p]+b[g+p+1]+b[g+o+p]+b[g+o+p+1])/4;r.push(v)}if(l)for(x=new Uint8Array(s*i),h=0;h<i;h++)for(g=h*o,p=0;p<s;p++)x[h*s+p]=Math.min.apply(null,[l[g+p],l[g+p+1],l[g+o+p],l[g+o+p+1]])}e.width=s,e.height=i,e.mask=x,e.pixels=r}function Lr(e){let t=qt(e);return t==="lerc2"?t="lerc":t==="error"&&(t=""),t}async function Or(e,t={},n){if(e==null)throw new ye("rasterCodec:decode","missing encodeddata parameter.");let o=t.format&&t.format.toLowerCase();if(!(o!=="bsq"&&o!=="bip"||t.width!=null&&t.height!=null))throw new ye("rasterCodec:decode","requires width and height in options parameter.");if(o==="tiff"&&t.customOptions)return Wn(e,t);if((!o||o!=="bsq"&&o!=="bip"&&o!=="deflate"&&o!=="lzw")&&(o=qt(e)),t.useCanvas&&_n.has(o))return Xn(e,o,t,n);const u=Zn(o);t.isPoint&&((t={...t}).width!=null&&t.width++,t.height!=null&&t.height++);const l=await u(e,t);return l&&(o!=="jpg"&&t.noDataValue!=null&&l.depthCount===1&&ht(l,t.noDataValue,{customFloatTolerance:t.tolerance}),t.isPoint&&er(l),l)}var ot;function Se(e){return e=Number(e),isNaN(e)?void 0:e}let he=ot=class extends De{constructor(){super(...arguments),this.name=null,this.minWavelength=void 0,this.maxWavelength=void 0,this.radianceBias=void 0,this.radianceGain=void 0,this.reflectanceBias=void 0,this.reflectanceGain=void 0,this.solarIrradiance=void 0}clone(){return new ot({name:this.name,minWavelength:this.minWavelength,maxWavelength:this.maxWavelength,radianceBias:this.radianceBias,radianceGain:this.radianceGain,reflectanceBias:this.reflectanceBias,reflectanceGain:this.reflectanceGain,solarIrradiance:this.solarIrradiance})}};G([B({json:{name:"BandName",write:!0}})],he.prototype,"name",void 0),G([B({json:{name:"WavelengthMin",read:{reader:Se},write:!0}})],he.prototype,"minWavelength",void 0),G([B({json:{name:"WavelengthMax",read:{reader:Se},write:!0}})],he.prototype,"maxWavelength",void 0),G([B({json:{name:"RadianceBias",read:{reader:Se},write:!0}})],he.prototype,"radianceBias",void 0),G([B({json:{name:"RadianceGain",read:{reader:Se},write:!0}})],he.prototype,"radianceGain",void 0),G([B({json:{name:"ReflectanceBias",read:{reader:Se},write:!0}})],he.prototype,"reflectanceBias",void 0),G([B({json:{name:"ReflectanceGain",read:{reader:Se},write:!0}})],he.prototype,"reflectanceGain",void 0),G([B({json:{name:"SolarIrradiance",read:{reader:Se},write:!0}})],he.prototype,"solarIrradiance",void 0),he=ot=G([Re("esri.layers.support.RasterBandInfo")],he);const Lt=he;var lt;function Oe(e){return e=Number(e),isNaN(e)?void 0:e}let oe=lt=class extends De{constructor(){super(...arguments),this.acquisitionDate=void 0,this.cloudCover=void 0,this.productName=void 0,this.sensorName=null,this.sensorAzimuth=void 0,this.sensorElevation=void 0,this.sunAzimuth=void 0,this.sunElevation=void 0}readAcquisitionDate(e){return new Date(e)}writeAcquisitionDate(e,t){t.AcquisitionDate=e.getTime()}clone(){return new lt({acquisitionDate:this.acquisitionDate,cloudCover:this.cloudCover,productName:this.productName,sensorName:this.sensorName,sensorAzimuth:this.sensorAzimuth,sensorElevation:this.sensorElevation,sunAzimuth:this.sunAzimuth,sunElevation:this.sunElevation})}};G([B({json:{name:"AcquisitionDate",write:!0}})],oe.prototype,"acquisitionDate",void 0),G([nn("acquisitionDate")],oe.prototype,"readAcquisitionDate",null),G([rn("acquisitionDate")],oe.prototype,"writeAcquisitionDate",null),G([B({json:{name:"CloudCover",read:{reader:Oe},write:!0}})],oe.prototype,"cloudCover",void 0),G([B({json:{name:"ProductName",write:!0}})],oe.prototype,"productName",void 0),G([B({json:{name:"SensorName",write:!0}})],oe.prototype,"sensorName",void 0),G([B({json:{name:"SensorAzimuth",read:{reader:Oe},write:!0}})],oe.prototype,"sensorAzimuth",void 0),G([B({json:{name:"SensorElevation",read:{reader:Oe},write:!0}})],oe.prototype,"sensorElevation",void 0),G([B({json:{name:"SunAzimuth",read:{reader:Oe},write:!0}})],oe.prototype,"sunAzimuth",void 0),G([B({json:{name:"SunElevation",read:{reader:Oe},write:!0}})],oe.prototype,"sunElevation",void 0),oe=lt=G([Re("esri.layers.support.RasterSensorInfo")],oe);const tr=oe;var ct;let ee=ct=class extends De{constructor(){super(...arguments),this.blockWidth=void 0,this.blockHeight=void 0,this.compression=null,this.origin=null,this.firstPyramidLevel=null,this.maximumPyramidLevel=null,this.pyramidScalingFactor=2,this.pyramidBlockWidth=null,this.pyramidBlockHeight=null,this.isVirtualTileInfo=!1,this.tileInfo=null,this.transposeInfo=null,this.blockBoundary=null}clone(){return new ct({blockWidth:this.blockWidth,blockHeight:this.blockHeight,compression:this.compression,origin:te(this.origin),firstPyramidLevel:this.firstPyramidLevel,maximumPyramidLevel:this.maximumPyramidLevel,pyramidResolutions:te(this.pyramidResolutions),pyramidScalingFactor:this.pyramidScalingFactor,pyramidBlockWidth:this.pyramidBlockWidth,pyramidBlockHeight:this.pyramidBlockHeight,isVirtualTileInfo:this.isVirtualTileInfo,tileInfo:te(this.tileInfo),transposeInfo:te(this.transposeInfo),blockBoundary:te(this.blockBoundary)})}};G([B({type:Number,json:{write:!0}})],ee.prototype,"blockWidth",void 0),G([B({type:Number,json:{write:!0}})],ee.prototype,"blockHeight",void 0),G([B({type:String,json:{write:!0}})],ee.prototype,"compression",void 0),G([B({type:sn,json:{write:!0}})],ee.prototype,"origin",void 0),G([B({type:Number,json:{write:!0}})],ee.prototype,"firstPyramidLevel",void 0),G([B({type:Number,json:{write:!0}})],ee.prototype,"maximumPyramidLevel",void 0),G([B({json:{write:!0}})],ee.prototype,"pyramidResolutions",void 0),G([B({type:Number,json:{write:!0}})],ee.prototype,"pyramidScalingFactor",void 0),G([B({type:Number,json:{write:!0}})],ee.prototype,"pyramidBlockWidth",void 0),G([B({type:Number,json:{write:!0}})],ee.prototype,"pyramidBlockHeight",void 0),G([B({type:Boolean,json:{write:!0}})],ee.prototype,"isVirtualTileInfo",void 0),G([B({json:{write:!0}})],ee.prototype,"tileInfo",void 0),G([B()],ee.prototype,"transposeInfo",void 0),G([B()],ee.prototype,"blockBoundary",void 0),ee=ct=G([Re("esri.layers.support.RasterStorageInfo")],ee);const nr=ee;var ut;let J=ut=class extends De{constructor(e){super(e),this.attributeTable=null,this.bandCount=null,this.colormap=null,this.extent=null,this.format=void 0,this.height=null,this.width=null,this.histograms=null,this.keyProperties={},this.multidimensionalInfo=null,this.noDataValue=null,this.pixelSize=null,this.pixelType=null,this.isPseudoSpatialReference=!1,this.spatialReference=null,this.statistics=null,this.storageInfo=null,this.transform=null}get bandInfos(){const e=this.keyProperties.BandProperties;if(!e?.length){const n=[];for(let o=1;o<=this.bandCount;o++)n.push(new Lt({name:"band_"+o}));return n}const t=e.map(n=>Lt.fromJSON(n));for(let n=0;n<t.length;n++)t[n].name=t[n].name??"band_"+(n+1);return t}get dataType(){const e=this.keyProperties?.DataType?.toLowerCase()??"generic";return e==="stdtime"?"standard-time":e}get nativeExtent(){return this._get("nativeExtent")||this.extent}set nativeExtent(e){e&&this._set("nativeExtent",e)}get nativePixelSize(){if(this.transform==null||!this.transform.affectsPixelSize)return this.pixelSize;const e=this.nativeExtent;return{x:e.width/this.width,y:e.height/this.height}}get hasMultidimensionalTranspose(){return!!this.storageInfo?.transposeInfo}get sensorInfo(){if(this.keyProperties?.SensorName)return tr.fromJSON(this.keyProperties)}clone(){return new ut({attributeTable:te(this.attributeTable),bandCount:this.bandCount,colormap:te(this.colormap),extent:te(this.extent),nativePixelSize:te(this.nativePixelSize),format:this.format,height:this.height,width:this.width,histograms:te(this.histograms),keyProperties:te(this.keyProperties),multidimensionalInfo:te(this.multidimensionalInfo),noDataValue:this.noDataValue,pixelSize:te(this.pixelSize),pixelType:this.pixelType,isPseudoSpatialReference:this.isPseudoSpatialReference,spatialReference:te(this.spatialReference),statistics:te(this.statistics),storageInfo:te(this.storageInfo),transform:te(this.transform)})}};G([B({json:{write:!0}})],J.prototype,"attributeTable",void 0),G([B({json:{write:!0}})],J.prototype,"bandCount",void 0),G([B({readOnly:!0})],J.prototype,"bandInfos",null),G([B({json:{write:!0}})],J.prototype,"colormap",void 0),G([B({type:String,readOnly:!0})],J.prototype,"dataType",null),G([B({type:wt,json:{write:!0}})],J.prototype,"extent",void 0),G([B({type:wt,json:{write:!0}})],J.prototype,"nativeExtent",null),G([B({json:{write:!0}})],J.prototype,"nativePixelSize",null),G([B({json:{write:!0}})],J.prototype,"format",void 0),G([B({json:{write:!0}})],J.prototype,"height",void 0),G([B({json:{write:!0}})],J.prototype,"width",void 0),G([B({json:{write:!0}})],J.prototype,"hasMultidimensionalTranspose",null),G([B({json:{write:!0}})],J.prototype,"histograms",void 0),G([B({json:{write:!0}})],J.prototype,"keyProperties",void 0),G([B({json:{write:!0}})],J.prototype,"multidimensionalInfo",void 0),G([B({json:{write:!0}})],J.prototype,"noDataValue",void 0),G([B({json:{write:!0}})],J.prototype,"pixelSize",void 0),G([B({json:{write:!0}})],J.prototype,"pixelType",void 0),G([B()],J.prototype,"isPseudoSpatialReference",void 0),G([B({readOnly:!0})],J.prototype,"sensorInfo",null),G([B({type:an,json:{write:!0}})],J.prototype,"spatialReference",void 0),G([B({json:{write:!0}})],J.prototype,"statistics",void 0),G([B({type:nr,json:{write:!0}})],J.prototype,"storageInfo",void 0),G([B({json:{write:!0}})],J.prototype,"transform",void 0),J=ut=G([Re("esri.layers.support.RasterInfo")],J);const rr=J,re=1,ke=1/111e3;function Kt(e){let{altitude:t,azimuth:n}=e;const{hillshadeType:o,pixelSizePower:u=1,pixelSizeFactor:l=1,scalingType:f,isGCS:s,resolution:i}=e,r=o==="multi-directional"?2*e.zFactor:e.zFactor,{x:a,y:h}=i;let p=r/(8*a),g=r/(8*h);if(s&&r>.001&&(p/=ke,g/=ke),f==="adjusted")if(s){const P=a*ke,M=h*ke;p=(r+P**u*l)/(8*P),g=(r+M**u*l)/(8*M)}else p=(r+a**u*l)/(8*a),g=(r+h**u*l)/(8*h);let b=(90-t)*Math.PI/180,v=Math.cos(b),x=(360-n+90)*Math.PI/180,c=Math.sin(b)*Math.cos(x),d=Math.sin(b)*Math.sin(x);const m=[315,270,225,360,180,0],y=[60,60,60,60,60,90],w=new Float32Array([3,5,3,2,1,4]),S=w.reduce((P,M)=>P+M),T=w.map(P=>P/S),A=o==="multi-directional"?m.length:1,I=new Float32Array(6),E=new Float32Array(6),k=new Float32Array(6);if(o==="multi-directional")for(let P=0;P<A;P++)t=y[P],n=m[P],b=(90-t)*Math.PI/180,v=Math.cos(b),x=(360-n+90)*Math.PI/180,c=Math.sin(b)*Math.cos(x),d=Math.sin(b)*Math.sin(x),I[P]=v,E[P]=c,k[P]=d;else I.fill(v),E.fill(c),k.fill(d);return{resolution:i,factor:[p,g],sinZcosA:c,sinZsinA:d,cosZ:v,sinZcosAs:E,sinZsinAs:k,cosZs:I,weights:T,hillshadeType:["traditional","multi-directional"].indexOf(o)}}function We(e,t){const{width:n,height:o}=e,u=n*o,l=new Uint8Array(u),f=e.mask!=null;let s;if(f){s=new Uint8Array(e.mask);for(let S=0;S<s.length;S++)s[S]&&(l[S]=1,s[S]=1)}const i=e.pixels[0],r=new Float32Array(u),a=new Float32Array(u);let h,p=0;if(t){const{resolution:S}=t,T=S?(S.x+S.y)/2:1;p=200*t.zFactor/(T*T),h=new Float32Array(u)}const g=t?.curvatureType;let b,v,x,c,d,m,y,w;for(let S=re;S<o-re;S++){const T=S*n;for(let A=re;A<n-re;A++){const I=T+A;if(!s||s[I]!==0){if(s){if(s[I-n-1]+s[I-n]+s[I-n+1]+s[I-1]+s[I+1]+s[I+n-1]+s[I+n]+s[I+n+1]<7){l[I]=0;continue}b=s[I-n-1]?i[I-n-1]:i[I],v=s[I-n]?i[I-n]:i[I],x=s[I-n+1]?i[I-n+1]:i[I],c=s[I-1]?i[I-1]:i[I],d=s[I+1]?i[I+1]:i[I],m=s[I+n-1]?i[I+n-1]:i[I],y=s[I+n]?i[I+n]:i[I],w=s[I+n+1]?i[I+n+1]:i[I]}else b=i[I-n-1],v=i[I-n],x=i[I-n+1],c=i[I-1],d=i[I+1],m=i[I+n-1],y=i[I+n],w=i[I+n+1];if(r[I]=x+d+d+w-(b+c+c+m),a[I]=m+y+y+w-(b+v+v+x),h!=null){const E=i[I],k=.5*(c+d)-E,P=.5*(v+y)-E;if(g==="standard")h[I]=-p*(k+P);else{const M=(-b+x+m-w)/4,R=(-c+d)/2,L=(v-y)/2,U=R*R,C=L*L,F=U+C;F&&(h[I]=g==="profile"?p*(k*U+P*C+M*R*L)/F:-p*(k*C+P*U-M*R*L)/F)}}}}}return{outMask:f?l:null,dzxs:r,dzys:a,curvatures:h}}function He(e,t,n){for(let o=0;o<n;o++)e[o*t]=e[o*t+1],e[(o+1)*t-1]=e[(o+1)*t-2];for(let o=1;o<t-1;o++)e[o]=e[o+t],e[o+(n-1)*t]=e[o+(n-2)*t]}function ir(e,t){if(!Ie(e))return e;const{factor:n,sinZcosA:o,sinZsinA:u,cosZ:l,sinZcosAs:f,sinZsinAs:s,cosZs:i,weights:r}=Kt(t),[a,h]=n,p=t.hillshadeType==="traditional",{width:g,height:b}=e,v=new Uint8Array(g*b),{dzxs:x,dzys:c,outMask:d}=We(e);for(let m=re;m<b-re;m++){const y=m*g;for(let w=re;w<g-re;w++){const S=y+w;if(!d||d[S]){const T=x[S]*a,A=c[S]*h,I=Math.sqrt(1+T*T+A*A);let E=0;if(p){let k=255*(l+u*A-o*T)/I;k<0&&(k=0),E=k}else{const k=s.length;for(let P=0;P<k;P++){let M=255*(i[P]+s[P]*A-f[P]*T)/I;M<0&&(M=0),E+=M*r[P]}}v[S]=255&E}}}return He(v,g,b),new ie({width:g,height:b,pixels:[v],mask:d,pixelType:"u8",validPixelCount:e.validPixelCount,statistics:[{minValue:0,maxValue:255}]})}function sr(e,t,n,o){if(!Ie(e)||!Ie(t))return;const{min:u,max:l}=o,f=e.pixels[0],{pixels:s,mask:i}=t,r=s[0],a=255.00001/(l-u),h=new Uint8ClampedArray(r.length),p=new Uint8ClampedArray(r.length),g=new Uint8ClampedArray(r.length),b=n.length-1;for(let v=0;v<r.length;v++){if(i&&i[v]===0)continue;const x=Math.floor((r[v]-u)*a),[c,d]=n[x<0?0:x>b?b:x],m=f[v],y=m*d,w=y*(1-Math.abs(c%2-1)),S=m-y;switch(Math.floor(c)){case 0:h[v]=y+S,p[v]=w+S,g[v]=S;break;case 1:h[v]=w+S,p[v]=y+S,g[v]=S;break;case 2:h[v]=S,p[v]=y+S,g[v]=w+S;break;case 3:h[v]=S,p[v]=w+S,g[v]=y+S;break;case 4:h[v]=w+S,p[v]=S,g[v]=y+S;break;case 5:case 6:h[v]=y+S,p[v]=S,g[v]=w+S}}e.pixels=[h,p,g],e.updateStatistics()}function Ur(e,t){if(!Ie(e))return e;const n=t.zFactor,o=t.pixelSizePower??1,u=t.pixelSizeFactor??1,l=t.slopeType,f=t.isGCS,{x:s,y:i}=t.resolution;let r=n/(8*s),a=n/(8*i);f&&Math.abs(n-1)<1e-4&&(r/=ke,a/=ke),l==="adjusted"&&(r=(n+s**o*u)/(8*s),a=(n+i**o*u)/(8*i));const{dzxs:h,dzys:p,outMask:g}=We(e),{width:b,height:v}=e,x=new Float32Array(b*v);for(let d=re;d<v-re;d++){const m=d*b;for(let y=re;y<b-re;y++){const w=m+y;if(!g||g[w]){const S=h[w]*r,T=p[w]*a,A=Math.sqrt(S*S+T*T);x[m+y]=l==="percent-rise"?100*A:57.2957795*Math.atan(A)}}}He(x,b,v);const c=new ie({width:b,height:v,pixels:[x],mask:g,pixelType:"f32",validPixelCount:e.validPixelCount});return c.updateStatistics(),c}function Rr(e,t={}){if(!Ie(e))return e;const{resolution:n}=t,o=n?1/n.x:1,u=n?1/n.y:1,{dzxs:l,dzys:f,outMask:s}=We(e),{width:i,height:r}=e,a=new Float32Array(i*r);for(let h=re;h<r-re;h++){const p=h*i;for(let g=re;g<i-re;g++){const b=p+g;if(!s||s[b]){const v=l[b]*o,x=f[b]*u;let c=-1;v===0&&x===0||(c=90-57.29578*Math.atan2(x,-v),c<0&&(c+=360),c===360?c=0:c>360&&(c%=360)),a[p+g]=c}}}return He(a,i,r),new ie({width:i,height:r,pixels:[a],mask:s,pixelType:"f32",validPixelCount:e.validPixelCount,statistics:[{minValue:-1,maxValue:360}]})}function Dr(e,t){if(!Ie(e))return e;const{curvatures:n,outMask:o}=We(e,t),{width:u,height:l}=e;He(n,u,l);const f=new ie({width:u,height:l,pixels:[n],mask:o,pixelType:"f32",validPixelCount:e.validPixelCount});return f.updateStatistics(),f}const Xe=1,ar=[.299,.587,.114];function Jt(e,t=256){t=Math.min(t,256);const{size:n,counts:o}=e,u=new Uint8Array(n),l=o.reduce((a,h)=>a+h/t,0);let f=0,s=0,i=0,r=l;for(let a=0;a<n;a++)if(i+=o[a],!(a<n-1&&i+o[a+1]<r)){for(;f<t-1&&r<i;)f++,r+=l;for(let h=s;h<=a;h++)u[h]=f;s=a+1}for(let a=s;a<n;a++)u[a]=t-1;return u}function Ot(e){const{minCutOff:t,maxCutOff:n,gamma:o,pixelType:u,rounding:l}=e,f=e.outMin||0,s=e.outMax||255;if(!["u8","u16","s8","s16"].includes(u))return null;const i=t.length;let r,a,h=0;u==="s8"?h=-127:u==="s16"&&(h=-32767);let p=256;["u16","s16"].includes(u)&&(p=65536);const g=[],b=[],v=s-f;for(r=0;r<i;r++)b[r]=n[r]-t[r],g[r]=b[r]===0?0:v/b[r];let x;const c=[];let d,m,y;if(o&&o.length>=i){const w=Yt(i,o);for(r=0;r<i;r++){for(y=[],a=0;a<p;a++)if(b[r]!==0)if(d=a+h,x=(d-t[r])/b[r],m=1,o[r]>1&&(m-=(1/v)**(x*w[r])),d<n[r]&&d>t[r]){const S=m*v*x**(1/o[r])+f;y[a]=l==="floor"?Math.floor(S):l==="round"?Math.round(S):S}else d>=n[r]?y[a]=s:y[a]=f;else y[a]=f;c[r]=y}}else for(r=0;r<i;r++){for(y=[],a=0;a<p;a++)if(d=a+h,d<=t[r])y[a]=f;else if(d>=n[r])y[a]=s;else{const w=(d-t[r])*g[r]+f;y[a]=l==="floor"?Math.floor(w):l==="round"?Math.round(w):w}c[r]=y}if(e.contrastOffset!=null){const w=or(e.contrastOffset,e.brightnessOffset);for(r=0;r<i;r++)for(y=c[r],a=0;a<p;a++)y[a]=w[y[a]]}return{lut:c,offset:h}}function or(e,t){const n=Math.min(Math.max(e,-100),100),o=Math.min(Math.max(t??0,-100),100),u=255,l=128;let f=0,s=0;const i=new Uint8Array(256);for(f=0;f<256;f++)n>0&&n<100?s=(200*f-100*u+2*u*o)/(2*(100-n))+l:n<=0&&n>-100?s=(200*f-100*u+2*u*o)*(100+n)/2e4+l:n===100?(s=200*f-100*u+(u+1)*(100-n)+2*u*o,s=s>0?u:0):n===-100&&(s=l),i[f]=s>u?u:s<0?0:s;return i}function lr(e,t,n){const o=[];for(let u=0;u<t.length;u++){let l=0,f=0,s=0;"min"in t[u]?{min:l,max:f,avg:s}=t[u]:[l,f,s]=t[u];let i=s??0;e!=="u8"&&(i=255*(i-l)/(f-l)),n&&(i*=ar[u]),o.push(cr(i))}return o}function cr(e){if(e<=0||e>=255)return Xe;let t=0;e!==150&&(t=e<=150?45*Math.cos(.01047*e):17*Math.sin(.021*e));const n=255,o=e+t,u=Math.log(e/n),l=Math.log(o/n);if(l===0)return Xe;const f=u/l;return isNaN(f)?Xe:Math.min(9.9,Math.max(.01,f))}function ur(e,t,n,o){let u=1/0,l=-1/0,f=0,s=0;const i=e.length;for(let c=0;c<i;c++){const d=e[c];t&&!t[c]||(u=d<u?d:u,l=d>l?d:l,f+=d,s++)}if(s===0)return{statistics:{min:0,max:0,avg:0,stddev:0},histogram:null};const r=f/s;let a=0;for(let c=0;c<i;c++)t&&!t[c]||(a+=(e[c]-r)**2);const h=t?t.filter(c=>c).length:i,p={min:u,max:l,avg:r,stddev:h<=1?0:Math.sqrt(a/(h-1))};if(!o)return{statistics:p,histogram:null};if(["u8","s8","u4","u2","u1"].includes(n)){const c=l-u+1,d=new Uint32Array(c);for(let m=0;m<i;m++)t&&!t[m]||d[e[m]-u]++;return{statistics:p,histogram:{min:u-.5,max:l+.5,size:c,counts:d}}}const g=256,b=new Uint32Array(g),v=(l-u)/g;if(v===0)return{statistics:p,histogram:{min:u,max:l,size:1,counts:new Uint32Array(1).fill(s)}};const x=new Uint32Array(g+1);for(let c=0;c<i;c++)t&&!t[c]||x[Math.floor((e[c]-u)/v)]++;for(let c=0;c<g-1;c++)b[c]=x[c];return b[g-1]=x[g-1]+x[g],{statistics:p,histogram:{min:u,max:l,size:g,counts:b}}}function Gr(e){const{pixels:t,mask:n,pixelType:o,bandMasks:u}=e,l=t.map((f,s)=>ur(f,u?.[s]??n,o,!0));return{statistics:l.map(({statistics:f})=>f),histograms:l.map(({histogram:f})=>f)}}function hr(e){if(e==null||!e.pixels?.length)return null;const{pixels:t,mask:n,bandMasks:o,pixelType:u}=e,l=e.width*e.height,f=t.length;let s,i,r,a,h;const p=[],g=[];let b,v,x,c,d,m,y,w,S,T;const A=256;for(a=0;a<f;a++){b=new Uint32Array(A),x=t[a];const I=o?.[a]??n;if(u==="u8")if(s=-.5,i=255.5,I)for(h=0;h<l;h++)I[h]&&b[x[h]]++;else for(h=0;h<l;h++)b[x[h]]++;else{let E=!1;e.statistics||(e.updateStatistics(),E=!0);const k=e.statistics;if(s=k[a].minValue,i=k[a].maxValue,r=(i-s)/A,r===0){!k||e.validPixelCount||E||e.updateStatistics();const P=(e.validPixelCount||e.width*e.height)/A;for(let M=0;M<A;M++)b[M]=Math.round(P*(M+1))-Math.round(P*M)}else{for(v=new Uint32Array(A+1),h=0;h<l;h++)I&&!I[h]||v[Math.floor((x[h]-s)/r)]++;for(h=0;h<A-1;h++)b[h]=v[h];b[A-1]=v[A-1]+v[A]}}for(p.push({min:s,max:i,size:A,counts:b}),c=0,d=0,w=0,h=0;h<A;h++)c+=b[h],d+=h*b[h];for(S=d/c,h=0;h<A;h++)w+=b[h]*(h-S)**2;T=Math.sqrt(w/(c-1)),r=(i-s)/A,m=(S+.5)*r+s,y=T*r,g.push({min:s,max:i,avg:m,stddev:y})}return{statistics:g,histograms:p}}function Nr(e){const t=[];for(let n=0;n<e.length;n++){const{min:o,max:u,size:l,counts:f}=e[n];let s=0,i=0;for(let b=0;b<l;b++)s+=f[b],i+=b*f[b];const r=i/s;let a=0;for(let b=0;b<l;b++)a+=f[b]*(b-r)**2;const h=(u-o)/l,p=(r+.5)*h+o,g=Math.sqrt(a/(s-1))*h;t.push({min:o,max:u,avg:p,stddev:g})}return t}function Ue(e,t){const{pixelBlock:n,bandIds:o,returnHistogramLut:u,rasterInfo:l}=t;let f=null,s=null,i=e.stretchType;if(typeof i=="number"&&(i=cn[i]),e.dra)if(i==="minMax"&&n!=null&&n.statistics)f=n.statistics.map(E=>[E.minValue,E.maxValue,0,0]);else{const E=hr(n);f=E!=null?E.statistics:null,s=E!=null?E.histograms:null}else f=e.statistics?.length>0?e.statistics:l.statistics,s="histograms"in e?e.histograms:void 0,s||(s=l.histograms);i!=="percentClip"&&i!=="histogramEqualization"||s?.length||(i="minMax");const r=f?.length||s?.length||l.bandCount,a=[],h=[];let p,g,b,v,x,c,d,m,y;f&&!Array.isArray(f[0])&&(f=f.map(E=>[E.min,E.max,E.avg,E.stddev]));const[w,S]=hn(l.pixelType);if(!f?.length){for(f=[],m=0;m<r;m++)f.push([w,S,1,1]);i==="standardDeviation"&&(i="minMax")}switch(i){case"none":for(m=0;m<r;m++)a[m]=w,h[m]=S;break;case"minMax":for(m=0;m<r;m++){const E=f[m];a[m]=E[0],h[m]=E[1]}break;case"standardDeviation":for(m=0;m<r;m++){const E=f[m];a[m]=E[2]-e.numberOfStandardDeviations*E[3],h[m]=E[2]+e.numberOfStandardDeviations*E[3],a[m]<E[0]&&(a[m]=E[0]),h[m]>E[1]&&(h[m]=E[1])}break;case"histogramEqualization":for(Ve(s),m=0;m<r;m++)a[m]=s[m].min,h[m]=s[m].max;break;case"percentClip":for(Ve(s),m=0;m<s.length;m++){for(p=s[m],x=new Uint32Array(p.size),v=[...p.counts],v.length>=20&&(v[0]=v[1]=v[2]=v[v.length-1]=v[v.length-2]=0),b=0,g=(p.max-p.min)/p.size,d=p.min===-.5&&g===1?.5:0,y=0;y<p.size;y++)b+=v[y],x[y]=b;for(c=(e.minPercent||0)*b/100,a[m]=p.min+d,y=0;y<p.size;y++)if(x[y]>c){a[m]=p.min+g*(y+d);break}for(c=(1-(e.maxPercent||0)/100)*b,h[m]=p.max+d,y=p.size-2;y>=0;y--)if(x[y]<c){h[m]=p.min+g*(y+2-d);break}if(h[m]<a[m]){const E=a[m];a[m]=h[m],h[m]=E}}break;default:for(m=0;m<r;m++){const E=f[m];a[m]=E[0],h[m]=E[1]}}let T,A,I;return i==="histogramEqualization"?(Ve(s),A=s[0].size||256,T=0,u&&(I=s.map(E=>Jt(E)))):(A=e.max||255,T=e.min||0),fr({minCutOff:a,maxCutOff:h,outMax:A,outMin:T,histogramLut:I},o)}function fr(e,t){if(t==null||t.length===0)return e;const n=Math.max.apply(null,t),{minCutOff:o,maxCutOff:u,outMin:l,outMax:f,histogramLut:s}=e;return o.length===t.length||o.length<=n?e:{minCutOff:t.map(i=>o[i]),maxCutOff:t.map(i=>u[i]),histogramLut:s?t.map(i=>s[i]):null,outMin:l,outMax:f}}function Yt(e,t){const n=new Float32Array(e);for(let o=0;o<e;o++)t[o]>1?t[o]>2?n[o]=6.5+(t[o]-2)**2.5:n[o]=6.5+100*(2-t[o])**4:n[o]=1;return n}function Ze(e,t){if(e==null||!e.pixels?.length)return e;const{mask:n,bandMasks:o,width:u,height:l,pixels:f}=e,{minCutOff:s,maxCutOff:i,gamma:r}=t,a=t.outMin||0,h=t.outMax||255,p=u*l,g=t.outputPixelType||"u8",b=e.pixels.map(()=>ie.createEmptyBand(g,p)),v=b.length,x=h-a,c=[],d=[];for(let T=0;T<v;T++)d[T]=i[T]-s[T],c[T]=d[T]===0?0:x/d[T];const m=g.startsWith("u")||g.startsWith("s"),y=r&&r.length>=v,w=!!t.isRenderer;if(y){const T=Yt(v,r);for(let A=0;A<v;A++){const I=o?.[A]??n;for(let E=0;E<p;E++)if(I==null||I[E]){if(d[A]===0){b[A][E]=a;continue}const k=f[A][E],P=(k-s[A])/d[A];let M=1;if(r[A]>1&&(M-=(1/x)**(P*T[A])),k<i[A]&&k>s[A]){const R=M*x*P**(1/r[A])+a;b[A][E]=w?Math.floor(R):m?Math.round(R):R}else k>=i[A]?b[A][E]=h:b[A][E]=a}}}else for(let T=0;T<v;T++){const A=o?.[T]??n;for(let I=0;I<p;I++)if(A==null||A[I]){const E=f[T][I];if(E<i[T]&&E>s[T]){const k=(E-s[T])*c[T]+a;b[T][I]=w?Math.floor(k):m?Math.round(k):k}else E>=i[T]?b[T][I]=h:b[T][I]=a}}const S=new ie({width:u,height:l,mask:n,bandMasks:o,pixels:b,pixelType:g});return S.updateStatistics(),S}function dr(e){return["u8","s8"].includes(e.pixelType)&&e.statistics?.[0]?.min!=null&&e.statistics[0]?.max!=null&&e.bandCount===1}function pr(e,t){const{attributeTable:n,bandCount:o}=e;return n==null&&dr(e)?!0:!(n==null||o>1||t&&n.fields.find(u=>u.name.toLowerCase()===t.toLowerCase())==null)}function mr(e){const{bandCount:t,dataType:n,pixelType:o}=e;return n==="elevation"||n==="generic"&&t===1&&(o==="s16"||o==="s32"||o==="f32"||o==="f64")}function gr(e,t=!1){const{bandCount:n,colormap:o,pixelType:u}=e;return n===1&&(!!o?.length||!t&&u==="u8")}function Fr(e,t=!1){const{attributeTable:n,bandCount:o}=e;return o===1&&(!t||n!=null||e.histograms!=null)}function Br(e){const{dataType:t}=e;return t==="vector-uv"||t==="vector-magdir"}function Vr(e){const{dataType:t}=e;return t==="vector-uv"||t==="vector-magdir"}let Te=class extends De{constructor(e){super(e)}bind(){const{rendererJSON:e}=this;if(!e)return{success:!1};let t;switch(this.lookup={rendererJSON:{}},e.type){case"uniqueValue":t=this._updateUVRenderer(e);break;case"rasterColormap":t=this._updateColormapRenderer(e);break;case"rasterStretch":t=this._updateStretchRenderer(e);break;case"classBreaks":t=this._updateClassBreaksRenderer(e);break;case"rasterShadedRelief":t=this._updateShadedReliefRenderer(e);break;case"vectorField":t=this._updateVectorFieldRenderer();break;case"flowRenderer":t=this._updateFlowRenderer()}return t}symbolize(e){let t=e&&e.pixelBlock;if(!Ut(t))return t;if(e.simpleStretchParams&&this.rendererJSON.type==="rasterStretch")return this.simpleStretch(t,e.simpleStretchParams);try{let n;switch(t.pixels.length>3&&(t=t.extractBands([0,1,2])),this.rendererJSON.type){case"uniqueValue":case"rasterColormap":n=this._symbolizeColormap(t);break;case"classBreaks":n=this._symbolizeClassBreaks(t);break;case"rasterStretch":n=this._symbolizeStretch(t,e.bandIds);break;case"rasterShadedRelief":{const o=e.extent,u=o.spatialReference.isGeographic,l={x:(o.xmax-o.xmin)/t.width,y:(o.ymax-o.ymin)/t.height};n=this._symbolizeShadedRelief(t,{isGCS:u,resolution:l});break}}return n}catch(n){return Qe.getLogger(this).error("symbolize",n.message),t}}simpleStretch(e,t){if(!Ut(e))return e;try{return e.pixels.length>3&&(e=e.extractBands([0,1,2])),Ze(e,{...t,isRenderer:!0})}catch(n){return Qe.getLogger(this).error("symbolize",n.message),e}}generateWebGLParameters(e){if(["uniqueValue","rasterColormap","classBreaks"].includes(this.rendererJSON.type)){const{indexedColormap:f,offset:s}=this.lookup.colormapLut||{};return{colormap:f,colormapOffset:s,type:"lut"}}const{pixelBlock:t,isGCS:n,resolution:o,bandIds:u}=e,{rendererJSON:l}=this;return l.type==="rasterStretch"?this._generateStretchWebGLParams(t,l,u):l.type==="rasterShadedRelief"?this._generateShadedReliefWebGLParams(l,n,o??void 0):l.type==="vectorField"?this._generateVectorFieldWebGLParams(l):null}_isLUTChanged(e){if(!this.lookup||!this.lookup.rendererJSON)return!0;if("colorRamp"in this.rendererJSON){const t=this.rendererJSON.colorRamp;return e?JSON.stringify(t)!==JSON.stringify(this.lookup.rendererJSON.colorRamp):(this.rendererJSON,this.lookup.rendererJSON,JSON.stringify(this.rendererJSON)!==JSON.stringify(this.lookup.rendererJSON))}return JSON.stringify(this.rendererJSON)!==JSON.stringify(this.lookup.rendererJSON)}_symbolizeColormap(e){return this._isLUTChanged()&&!this.bind().success?e:qe(e,this.lookup.colormapLut)}_symbolizeClassBreaks(e){const{canUseIndexedLUT:t}=this._analyzeClassBreaks(this.rendererJSON);return this._isLUTChanged()&&!this.bind().success?e:t?qe(e,this.lookup.colormapLut):un(e,this.lookup.remapLut??[])}_symbolizeStretch(e,t){const{rasterInfo:n}=this,{pixelType:o,bandCount:u}=n,l=this.rendererJSON,f=["u8","u16","s8","s16"].includes(o);let s,i;const{dra:r}=l,{gamma:a}=this.lookup;if(l.stretchType==="histogramEqualization"){const h=r?null:this.lookup?.histogramLut,p=Ue(l,{rasterInfo:n,pixelBlock:e,bandIds:t,returnHistogramLut:!h}),g=Ze(e,{...p,gamma:a,isRenderer:!0});i=bt(g,{lut:r?p.histogramLut:h,offset:0})}else if(f){if(r){const h=Ue(l,{rasterInfo:n,pixelBlock:e,bandIds:t});s=Ot({pixelType:o,...h,gamma:a,rounding:"floor"})}else if(this._isLUTChanged()){if(!this.bind().success)return e;s=this.lookup?this.lookup.stretchLut:null}else s=this.lookup?this.lookup.stretchLut:null;if(!s)return e;u>1&&t!=null&&t.length===e?.pixels.length&&s?.lut.length===u&&(s={lut:t.map(h=>s.lut[h]),offset:s.offset}),i=bt(e,s)}else{const h=Ue(l,{rasterInfo:n,pixelBlock:e,bandIds:t});i=Ze(e,{...h,gamma:a,isRenderer:!0})}if(l.colorRamp){if(this._isLUTChanged(!0)&&!this.bind().success)return e;i=qe(i,this.lookup?.colormapLut)}return i}_symbolizeShadedRelief(e,t){const n=this.rendererJSON,o={...n,...t},u=ir(e,o);if(!n.colorRamp)return u;let l;if(this._isLUTChanged(!0)){if(!this.bind().success)return u;l=this.lookup?this.lookup.hsvMap:null}else l=this.lookup?this.lookup.hsvMap:null;if(!l)return u;const f=this.rasterInfo.statistics?.[0]??{min:0,max:8e3};return sr(u,e,l,f),u}_isVectorFieldData(){const{bandCount:e,dataType:t}=this.rasterInfo;return e===2&&(t==="vector-magdir"||t==="vector-uv")}_updateVectorFieldRenderer(){return this._isVectorFieldData()?{success:!0}:{success:!1,error:`Unsupported data type "${this.rasterInfo.dataType}"; VectorFieldRenderer only supports "vector-magdir" and "vector-uv".`}}_updateFlowRenderer(){return this._isVectorFieldData()?{success:!0}:{success:!1,error:`Unsupported data type "${this.rasterInfo.dataType}"; FlowRenderer only supports "vector-magdir" and "vector-uv".`}}_updateUVRenderer(e){const{bandCount:t,attributeTable:n,pixelType:o}=this.rasterInfo,u=e.field1;if(!u)return{success:!1,error:"Unsupported renderer; missing UniqueValueRenderer.field."};const l=e.defaultSymbol,f=t===1&&["u8","s8"].includes(o);if(!pr(this.rasterInfo,u)&&!f)return{success:!1,error:"Unsupported data; UniqueValueRenderer is only supported on single band data with a valid raster attribute table."};const s=[];if(n!=null){const r=n.fields.find(a=>a.name.toLowerCase()==="value");if(!r)return{success:!1,error:"Unsupported data; the data's raster attribute table does not have a value field."};n.features.forEach(a=>{const h=e.uniqueValueInfos?.find(g=>String(g.value)===String(a.attributes[u])),p=h?.symbol?.color;p?s.push([a.attributes[r.name]].concat(p)):l&&s.push([a.attributes[r.name]].concat(l.color))})}else{if(u.toLowerCase()!=="value")return{success:!1,error:'Unsupported renderer; UniqueValueRenderer.field must be "Value" when raster attribute table is not availalbe.'};e.uniqueValueInfos?.forEach(r=>{const a=r?.symbol?.color;a?s.push([parseInt(""+r.value,10)].concat(a)):l&&s.push([parseInt(""+r.value,10)].concat(l?.color))})}if(s.length===0)return{success:!1,error:"Invalid UniqueValueRenderer. Cannot find matching records in the raster attribute table."};const i=Le({colormap:s});return this.lookup={rendererJSON:e,colormapLut:i},this.canRenderInWebGL=!0,{success:!0}}_updateColormapRenderer(e){if(!gr(this.rasterInfo))return{success:!1,error:"Unsupported data; the data source does not have a colormap."};const t=e.colormapInfos.map(o=>[o.value].concat(o.color)).sort((o,u)=>o[0]-u[0]);if(!t||t.length===0)return{success:!1,error:"Unsupported renderer; ColormapRenderer must have meaningful colormapInfos."};const n=Le({colormap:t});return this.lookup={rendererJSON:e,colormapLut:n},this.canRenderInWebGL=!0,{success:!0}}_updateShadedReliefRenderer(e){if(!mr(this.rasterInfo))return{success:!1,error:`Unsupported data type "${this.rasterInfo.dataType}"; ShadedReliefRenderer only supports "elevation", or single band float/s16 data.`};if(e.colorRamp){const t=vt(e.colorRamp,{interpolateAlpha:!0}),n=Le({colormap:t}),o=[],u=n.indexedColormap;for(let l=0;l<u.length;l+=4){const f=fn({r:u[l],g:u[l+1],b:u[l+2]});o.push([f.h/60,f.s/100,255*f.v/100])}this.lookup={rendererJSON:e,colormapLut:n,hsvMap:o}}else this.lookup=null;return this.canRenderInWebGL=!0,{success:!0}}_analyzeClassBreaks(e){const{attributeTable:t,pixelType:n}=this.rasterInfo,o=t!=null?t.fields.find(f=>f.name.toLowerCase()==="value"):null,u=t!=null?t.fields.find(f=>f.name.toLowerCase()===e.field.toLowerCase()):null,l=o!=null&&u!==null;return{canUseIndexedLUT:["u8","u16","s8","s16"].includes(n)||l,tableValueField:o,tableBreakField:u}}_updateClassBreaksRenderer(e){const{attributeTable:t}=this.rasterInfo,{canUseIndexedLUT:n,tableValueField:o,tableBreakField:u}=this._analyzeClassBreaks(e),l=e.classBreakInfos;if(!l?.length)return{success:!1,error:"Unsupported renderer; missing or invalid ClassBreaksRenderer.classBreakInfos."};const f=l.sort((h,p)=>h.classMaxValue-p.classMaxValue),s=f[f.length-1];let i=e.minValue;if(!n){const h=[];for(let p=0;p<f.length;p++)h.push({value:f[p].classMinValue??i,mappedColor:f[p].symbol.color}),i=f[p].classMaxValue;return h.push({value:s.classMaxValue,mappedColor:s.symbol.color}),this.lookup={rendererJSON:e,remapLut:h},this.canRenderInWebGL=!1,{success:!0}}const r=[];if(t!=null&&o!=null&&u!==null&&o!==u){const h=o.name,p=u.name,g=f[f.length-1],{classMaxValue:b}=g;i=e.minValue;for(const v of t.features){const x=v.attributes[h],c=v.attributes[p],d=c===b?g:c<i?null:f.find(({classMaxValue:m})=>m>c);d&&r.push([x].concat(d.symbol.color))}}else{i=Math.floor(e.minValue);for(let h=0;h<f.length;h++){const p=f[h];for(let g=i;g<p.classMaxValue;g++)r.push([g].concat(p.symbol.color));i=Math.ceil(p.classMaxValue)}s.classMaxValue===i&&r.push([s.classMaxValue].concat(s.symbol.color))}const a=Le({colormap:r,fillUnspecified:!1});return this.lookup={rendererJSON:e,colormapLut:a},this.canRenderInWebGL=!0,{success:!0}}_isHistogramRequired(e){return e==="percentClip"||e==="histogramEqualization"}_isValidRasterStatistics(e){return e!=null&&e.length>0&&e[0].min!=null&&e[0].max!=null}_updateStretchRenderer(e){let{stretchType:t,dra:n}=e;if(!(t==="none"||e.statistics?.length||this._isValidRasterStatistics(this.rasterInfo.statistics)||n))return{success:!1,error:"Unsupported renderer; StretchRenderer.statistics is required when dynamic range adjustment is not used."};const o=e.histograms||this.rasterInfo.histograms;!this._isHistogramRequired(e.stretchType)||o?.length||n||(t="minMax");const{computeGamma:u,useGamma:l,colorRamp:f}=e;let{gamma:s}=e;if(l&&u&&!s?.length){const a=e.statistics?.length?e.statistics:this.rasterInfo.statistics;s=lr(this.rasterInfo.pixelType,a)}const i=this.rasterInfo.pixelType,r=!n&&["u8","u16","s8","s16"].includes(i);if(t==="histogramEqualization"){const a=o.map(h=>Jt(h));this.lookup={rendererJSON:e,histogramLut:a}}else if(r){const a=Ue(e,{rasterInfo:this.rasterInfo}),h=Ot({pixelType:i,...a,gamma:l?s:null,rounding:"floor"});this.lookup={rendererJSON:e,stretchLut:h}}if(f){const a=vt(f,{interpolateAlpha:!0});this.lookup||(this.lookup={rendererJSON:e}),this.lookup.colormapLut=Le({colormap:a}),this.lookup.rendererJSON=e}return this.lookup.gamma=l&&s?.length?s:null,this.canRenderInWebGL=!0,{success:!0}}_generateStretchWebGLParams(e,t,n){let o=null,u=null;const l=this.lookup&&this.lookup.colormapLut;t.colorRamp&&l&&(o=l.indexedColormap,u=l.offset),t.stretchType==="histogramEqualization"&&(t={...t,stretchType:"minMax"});const{gamma:f}=this.lookup,s=!!(t.useGamma&&f&&f.some(m=>m!==1)),{minCutOff:i,maxCutOff:r,outMin:a,outMax:h}=Ue(t,{rasterInfo:this.rasterInfo,pixelBlock:e,bandIds:n});let p=0;e!=null&&(p=e.getPlaneCount(),p===2&&((e=e.clone()).statistics=[e.statistics[0]],e.pixels=[e.pixels[0]]));const{bandCount:g}=this.rasterInfo,b=Math.min(3,n?.length||p||g,g),v=new Float32Array(b),x=o||s?1:255;let c;for(c=0;c<i.length;c++)v[c]=r[c]===i[c]?0:(h-a)/(r[c]-i[c])/x;const d=new Float32Array(b);if(s&&f)for(c=0;c<b;c++)f[c]>1?f[c]>2?d[c]=6.5+(f[c]-2)**2.5:d[c]=6.5+100*(2-f[c])**4:d[c]=1;return{bandCount:b,outMin:a/x,outMax:h/x,minCutOff:i,maxCutOff:r,factor:v,useGamma:s,gamma:s?f:[1,1,1],gammaCorrection:s?d:[1,1,1],colormap:o,colormapOffset:u,stretchType:t.stretchType,type:"stretch"}}_generateShadedReliefWebGLParams(e,t=!1,n={x:0,y:0}){let o=null,u=null;const l=this.lookup&&this.lookup.colormapLut;e.colorRamp&&l&&(o=l.indexedColormap,u=l.offset);const f={...e,isGCS:t,resolution:n},s=Kt(f),i=this.rasterInfo.statistics?.[0];return{...s,minValue:i?.min??0,maxValue:i?.max??8e3,hillshadeType:e.hillshadeType==="traditional"?0:1,type:"hillshade",colormap:o,colormapOffset:u}}_generateVectorFieldWebGLParams(e){const{style:t,inputUnit:n,outputUnit:o,visualVariables:u,symbolTileSize:l,flowRepresentation:f}=e;let s;const i=this.rasterInfo.statistics?.[0].min??0,r=this.rasterInfo.statistics?.[0].max??50,a=u?.find(c=>c.type==="sizeInfo")??{type:"sizeInfo",field:"Magnitude",maxDataValue:r,maxSize:.8*l,minDataValue:i,minSize:.2*l},h=a.minDataValue??i,p=a.maxDataValue??r,g=a.maxSize!=null&&a.minSize!=null?[a.minSize/l,a.maxSize/l]:[.2,.8];if(t==="wind_speed"){const c=(g[0]+g[1])/2;g[0]=g[1]=c}const b=h!=null&&p!=null?[h,p]:null;if(t==="classified_arrow")if(h!=null&&p!=null&&a!=null){s=[];const c=(a.maxDataValue-a.minDataValue)/5;for(let d=0;d<6;d++)s.push(a.minDataValue+c*d)}else s=[0,1e-6,3.5,7,10.5,14];const v=f==="flow_to"==(t==="ocean_current_kn"||t==="ocean_current_m")?0:Math.PI,x=u?.find(c=>c.type==="rotationInfo");return{breakValues:s,dataRange:b,inputUnit:n,outputUnit:o,symbolTileSize:l,symbolPercentRange:g,style:t||"single_arrow",rotation:v,rotationType:this.rasterInfo.storageInfo?.tileInfo&&this.rasterInfo.dataType==="vector-uv"?"geographic":x?.rotationType||e.rotationType,type:"vectorField"}}};function Ut(e){return Ie(e)&&e.validPixelCount!==0}G([B({json:{write:!0}})],Te.prototype,"rendererJSON",void 0),G([B({type:rr,json:{write:!0}})],Te.prototype,"rasterInfo",void 0),G([B({json:{write:!0}})],Te.prototype,"lookup",void 0),G([B()],Te.prototype,"canRenderInWebGL",void 0),Te=G([Re("esri.renderers.support.RasterSymbolizer")],Te);const $r=Te,Ae=Qe.getLogger("esri.views.2d.engine.flow.dataUtils"),yr=10;async function _r(e,t,n,o){const u=performance.now(),l=wr(t,n),f=performance.now(),s=vr(t,l,n.width,n.height),i=performance.now(),r=Tr(s,!0),a=performance.now(),h=e==="Streamlines"?xr(r,yr):Ir(r),p=performance.now();return on("esri-2d-profiler")&&(Ae.info("I.1","_createFlowFieldFromData (ms)",Math.round(f-u)),Ae.info("I.2","_getStreamlines (ms)",Math.round(i-f)),Ae.info("I.3","createAnimatedLinesData (ms)",Math.round(a-i)),Ae.info("I.4","create{Streamlines|Particles}Mesh (ms)",Math.round(p-a)),Ae.info("I.5","createFlowMesh (ms)",Math.round(p-u)),Ae.info("I.6","Mesh size (bytes)",h.vertexData.buffer.byteLength+h.indexData.buffer.byteLength)),await Promise.resolve(),ln(o),h}function wr(e,t){const n=Sr(t.data,t.width,t.height,e.smoothing);return e.interpolate?(o,u)=>{const l=Math.floor(o),f=Math.floor(u);if(l<0||l>=t.width)return[0,0];if(f<0||f>=t.height)return[0,0];const s=o-l,i=u-f,r=l,a=f,h=l<t.width-1?l+1:l,p=f<t.height-1?f+1:f,g=n[2*(a*t.width+r)],b=n[2*(a*t.width+h)],v=n[2*(p*t.width+r)],x=n[2*(p*t.width+h)],c=n[2*(a*t.width+r)+1],d=n[2*(a*t.width+h)+1];return[(g*(1-i)+v*i)*(1-s)+(b*(1-i)+x*i)*s,(c*(1-i)+n[2*(p*t.width+r)+1]*i)*(1-s)+(d*(1-i)+n[2*(p*t.width+h)+1]*i)*s]}:(o,u)=>{const l=Math.round(o),f=Math.round(u);return l<0||l>=t.width||f<0||f>=t.height?[0,0]:[n[2*(f*t.width+l)],n[2*(f*t.width+l)+1]]}}function br(e,t,n,o,u,l,f,s,i){const r=[];let a=n,h=o,p=0,[g,b]=t(a,h);g*=e.velocityScale,b*=e.velocityScale;const v=Math.sqrt(g*g+b*b);let x,c;r.push({x:a,y:h,t:p,speed:v});for(let d=0;d<e.verticesPerLine;d++){let[m,y]=t(a,h);m*=e.velocityScale,y*=e.velocityScale;const w=Math.sqrt(m*m+y*y);if(w<e.minSpeedThreshold)return r;const S=m/w,T=y/w;if(a+=S*e.segmentLength,h+=T*e.segmentLength,p+=e.segmentLength/w,Math.acos(S*x+T*c)>e.maxTurnAngle)return r;if(e.collisions){const A=Math.round(a*i),I=Math.round(h*i);if(A<0||A>f-1||I<0||I>s-1)return r;const E=l[I*f+A];if(E!==-1&&E!==u)return r;l[I*f+A]=u}r.push({x:a,y:h,t:p,speed:w}),x=S,c=T}return r}function vr(e,t,n,o){const u=[],l=new Dt,f=1/Math.max(e.lineCollisionWidth,1),s=Math.round(n*f),i=Math.round(o*f),r=new Int32Array(s*i);for(let h=0;h<r.length;h++)r[h]=-1;const a=[];for(let h=0;h<o;h+=e.lineSpacing)for(let p=0;p<n;p+=e.lineSpacing)a.push({x:p,y:h,sort:l.getFloat()});a.sort((h,p)=>h.sort-p.sort);for(const{x:h,y:p}of a)if(l.getFloat()<e.density){const g=br(e,t,h,p,u.length,r,s,i,f);if(g.length<2)continue;u.push(g)}return u}function Sr(e,t,n,o){if(o===0)return e;const u=Math.round(3*o),l=new Array(2*u+1);let f=0;for(let r=-u;r<=u;r++){const a=Math.exp(-r*r/(o*o));l[r+u]=a,f+=a}for(let r=-u;r<=u;r++)l[r+u]/=f;const s=new Float32Array(e.length);for(let r=0;r<n;r++)for(let a=0;a<t;a++){let h=0,p=0;for(let g=-u;g<=u;g++){if(a+g<0||a+g>=t)continue;const b=l[g+u];h+=b*e[2*(r*t+(a+g))],p+=b*e[2*(r*t+(a+g))+1]}s[2*(r*t+a)]=h,s[2*(r*t+a)+1]=p}const i=new Float32Array(e.length);for(let r=0;r<t;r++)for(let a=0;a<n;a++){let h=0,p=0;for(let g=-u;g<=u;g++){if(a+g<0||a+g>=n)continue;const b=l[g+u];h+=b*s[2*((a+g)*t+r)],p+=b*s[2*((a+g)*t+r)+1]}i[2*(a*t+r)]=h,i[2*(a*t+r)+1]=p}return i}function Tr(e,t){const n=new Dt,o=e.reduce((i,r)=>i+r.length,0),u=new Float32Array(4*o),l=new Array(e.length);let f=0,s=0;for(const i of e){const r=f;for(const a of i)u[4*f]=a.x,u[4*f+1]=a.y,u[4*f+2]=a.t,u[4*f+3]=a.speed,f++;l[s++]={startVertex:r,numberOfVertices:i.length,totalTime:i[i.length-1].t,timeSeed:t?n.getFloat():0}}return{lineVertices:u,lineDescriptors:l}}function xr(e,t){const{lineVertices:o,lineDescriptors:u}=e;let l=0,f=0;for(const g of u)l+=2*g.numberOfVertices,f+=6*(g.numberOfVertices-1);const s=new Float32Array(l*9),i=new Uint32Array(f);let r=0,a=0;function h(){i[a++]=r-2,i[a++]=r,i[a++]=r-1,i[a++]=r,i[a++]=r+1,i[a++]=r-1}function p(g,b,v,x,c,d,m,y){const w=r*9;let S=0;s[w+S++]=g,s[w+S++]=b,s[w+S++]=1,s[w+S++]=v,s[w+S++]=d,s[w+S++]=m,s[w+S++]=x/2,s[w+S++]=c/2,s[w+S++]=y,r++,s[w+S++]=g,s[w+S++]=b,s[w+S++]=-1,s[w+S++]=v,s[w+S++]=d,s[w+S++]=m,s[w+S++]=-x/2,s[w+S++]=-c/2,s[w+S++]=y,r++}for(const g of u){const{totalTime:b,timeSeed:v}=g;let x=null,c=null,d=null,m=null,y=null,w=null;for(let S=0;S<g.numberOfVertices;S++){const T=o[4*(g.startVertex+S)],A=o[4*(g.startVertex+S)+1],I=o[4*(g.startVertex+S)+2],E=o[4*(g.startVertex+S)+3];let k=null,P=null,M=null,R=null;if(S>0){k=T-x,P=A-c;const L=Math.sqrt(k*k+P*P);if(k/=L,P/=L,S>1){let U=k+y,C=P+w;const F=Math.sqrt(U*U+C*C);U/=F,C/=F;const D=Math.min(1/(U*k+C*P),t);U*=D,C*=D,M=-C,R=U}else M=-P,R=k;M!==null&&R!==null&&(p(x,c,d,M,R,b,v,E),h())}x=T,c=A,d=I,y=k,w=P,m=E}p(x,c,d,-w,y,b,v,m)}return{vertexData:s,indexData:i}}function Ir(e){const{lineVertices:u,lineDescriptors:l}=e;let f=0,s=0;for(const L of l){const U=L.numberOfVertices-1;f+=4*U*2,s+=6*U*2}const i=new Float32Array(f*16),r=new Uint32Array(s);let a,h,p,g,b,v,x,c,d,m,y,w,S,T,A=0,I=0;function E(){r[I++]=A-8,r[I++]=A-7,r[I++]=A-6,r[I++]=A-7,r[I++]=A-5,r[I++]=A-6,r[I++]=A-4,r[I++]=A-3,r[I++]=A-2,r[I++]=A-3,r[I++]=A-1,r[I++]=A-2}function k(L,U,C,F,D,O,z,V,$,_,X,ne,pe,me){const K=A*16;let H=0;for(const ce of[1,2])for(const fe of[1,2,3,4])i[K+H++]=L,i[K+H++]=U,i[K+H++]=C,i[K+H++]=F,i[K+H++]=z,i[K+H++]=V,i[K+H++]=$,i[K+H++]=_,i[K+H++]=ce,i[K+H++]=fe,i[K+H++]=pe,i[K+H++]=me,i[K+H++]=D/2,i[K+H++]=O/2,i[K+H++]=X/2,i[K+H++]=ne/2,A++}function P(L,U){let C=d+y,F=m+w;const D=Math.sqrt(C*C+F*F);C/=D,F/=D;const O=d*C+m*F;C/=O,F/=O;let z=y+S,V=w+T;const $=Math.sqrt(z*z+V*V);z/=$,V/=$;const _=y*z+w*V;z/=_,V/=_,k(a,h,p,g,-F,C,b,v,x,c,-V,z,L,U),E()}function M(L,U,C,F,D,O){if(d=y,m=w,y=S,w=T,d==null&&m==null&&(d=y,m=w),b!=null&&v!=null){S=L-b,T=U-v;const z=Math.sqrt(S*S+T*T);S/=z,T/=z}d!=null&&m!=null&&P(D,O),a=b,h=v,p=x,g=c,b=L,v=U,x=C,c=F}function R(L,U){d=y,m=w,y=S,w=T,d==null&&m==null&&(d=y,m=w),d!=null&&m!=null&&P(L,U)}for(const L of l){a=null,h=null,p=null,g=null,b=null,v=null,x=null,c=null,d=null,m=null,y=null,w=null,S=null,T=null;const{totalTime:U,timeSeed:C}=L;for(let F=0;F<L.numberOfVertices;F++)M(u[4*(L.startVertex+F)],u[4*(L.startVertex+F)+1],u[4*(L.startVertex+F)+2],u[4*(L.startVertex+F)+3],U,C);R(U,C)}return{vertexData:i,indexData:r}}export{Nn as B,ze as D,$r as L,Ze as M,zt as N,Lr as P,gt as R,jt as U,rr as a,Sn as b,pt as c,Pe as d,mr as e,Un as f,Nr as g,hr as h,Vr as i,Or as j,Rr as k,ke as l,Gr as m,nr as n,Br as o,Dr as p,Ur as q,Fr as r,_r as s,pr as t,gr as u,Gn as v,Ue as w,Ot as x,Yt as y};
