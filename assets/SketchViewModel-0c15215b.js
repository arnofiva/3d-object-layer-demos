import{aD as c,aE as d,aW as Y,b1 as de,nW as D,jX as ue,jW as ye,sg as me,mk as re,aA as ge,aF as S,au as $,bi as se,iB as ve,aT as q,cT as j,ch as _e,cU as fe,g_ as Ee,g$ as be,ce as Oe,dY as J,cr as U,aV as C,du as Ge,aC as F,ay as X,c$ as Te,dm as we,eX as Se,eY as Ae,eZ as Re,qg as Pe,l1 as Q,dG as f,az as G,d1 as ee,cd as Ce,aB as Me,dw as te,gc as Ie,cy as W,rZ as k}from"./main-79e5ed80.js";import{h as De}from"./GraphicsLayer-6532b5a8.js";import{l as Z,i as K}from"./elevationInfoUtils-287337e4.js";import{z as Ue}from"./geodesicUtils-04ddd9a4.js";import{m as ne,k as ke,e as v,P as He}from"./SnappingManager-e561e372.js";function B(e){switch(e){case y.SUPPORTED:break;case y.GRAPHICS_LAYER_MISSING:return"not owned by a graphics layer";case y.GEOMETRY_MISSING:return"no geometry";case y.GEOMETRY_TYPE_UNSUPPORTED:return"the geometry type is not supported";case y.ELEVATION_MODE_UNSUPPORTED:return"the elevation mode is not supported";case y.SYMBOL_TYPE_UNSUPPORTED:return"the symbol type is not supported"}return""}var y;(function(e){e[e.SUPPORTED=0]="SUPPORTED",e[e.GRAPHICS_LAYER_MISSING=1]="GRAPHICS_LAYER_MISSING",e[e.GEOMETRY_MISSING=2]="GEOMETRY_MISSING",e[e.GEOMETRY_TYPE_UNSUPPORTED=3]="GEOMETRY_TYPE_UNSUPPORTED",e[e.ELEVATION_MODE_UNSUPPORTED=4]="ELEVATION_MODE_UNSUPPORTED",e[e.SYMBOL_TYPE_UNSUPPORTED=5]="SYMBOL_TYPE_UNSUPPORTED"})(y||(y={}));function xe(e){if(e.layer?.type!=="graphics")return y.GRAPHICS_LAYER_MISSING;if(e.geometry==null)return y.GEOMETRY_MISSING;switch(e.geometry.type){case"polygon":case"point":case"polyline":case"mesh":break;default:return y.GEOMETRY_TYPE_UNSUPPORTED}return Z(e)!=="on-the-ground"&&K(e)?y.ELEVATION_MODE_UNSUPPORTED:y.SUPPORTED}var z;let A=z=class extends Y{constructor(...e){super(...e),this.center=null,this.geodesic=!1,this.numberOfPoints=60,this.radius=1e3,this.radiusUnit="meters"}normalizeCtorArgs(e,t){let a;if(e&&e.center)a=e;else{if(e&&e.rings)return super.normalizeCtorArgs(e,t);a={center:e}}return{...super.normalizeCtorArgs(),...a,...t}}initialize(){const e=this.center,t=this.numberOfPoints;if(this.hasZ=e?.hasZ??!1,this.rings.length!==0||!e)return;const a=de(this.radius,this.radiusUnit,"meters"),o=e.spatialReference;let i,r="geographic";if(o.isWebMercator?r="webMercator":((o.wkid&&D[o.wkid])!=null||o.wkt&&o.wkt.indexOf("PROJCS")===0)&&(r="projected"),this.geodesic){let l;switch(r){case"webMercator":l=ue(e);break;case"projected":console.error("Creating a geodesic circle requires the center to be specified in web mercator or geographic coordinate system");break;case"geographic":l=e}i=this._createGeodesicCircle(l,a,t),r==="webMercator"&&(i=ye(i))}else{let l;r==="webMercator"||r==="projected"?l=a/this._convert2Meters(1,e.spatialReference):r==="geographic"&&(l=me(a,"meters",re(e.spatialReference).radius)),i=this._createPlanarCircle(e,l,t)}this.spatialReference=i.spatialReference,this.addRing(i.rings[0])}clone(){const{center:e,numberOfPoints:t,radius:a,radiusUnit:o,geodesic:i}=this;return new z({center:e?.clone(),numberOfPoints:t,radius:a,radiusUnit:o,geodesic:i})}_createGeodesicCircle(e,t,a){let o=0;const i=[];for(;o<360;){const r=[0,0],l=[e.x,e.y];Ue(r,l,o,t),this.hasZ&&r.push(e.z),i.push(r),o+=360/a}return i.push(i[0]),new Y(i)}_createPlanarCircle(e,t,a){const o=[],i=2*Math.PI/a;for(let r=0;r<a;++r){const l=i*r,s=[e.x+Math.cos(-l)*t,e.y+Math.sin(-l)*t];this.hasZ&&s.push(e.z),o.push(s)}return o.push(o[0]),new Y({spatialReference:e.spatialReference,rings:[o]})}_convert2Meters(e,t){let a;if(t.wkid&&D[t.wkid]!=null)a=D.values[D[t.wkid]];else{const o=t.wkt,i=o.lastIndexOf(",")+1,r=o.lastIndexOf("]]");a=parseFloat(o.substring(i,r))}return e*a}};c([d({type:ge})],A.prototype,"center",void 0),c([d()],A.prototype,"geodesic",void 0),c([d()],A.prototype,"numberOfPoints",void 0),c([d()],A.prototype,"radius",void 0),c([d()],A.prototype,"radiusUnit",void 0),A=z=c([S("esri.geometry.Circle")],A);const Le=A;function H(e){return pe(e).result}function Ze(e){return pe(e).geometry}function pe(e){if(e.layer?.type!=="graphics")return{result:y.GRAPHICS_LAYER_MISSING,geometry:null};const{geometry:t}=e;if(t==null)return{result:y.GEOMETRY_MISSING,geometry:null};if(Z(e)!=="on-the-ground"&&K(e))return{result:y.ELEVATION_MODE_UNSUPPORTED,geometry:null};const a=t.type;return a!=="point"&&a!=="mesh"&&a!=="polyline"&&(a!=="polygon"||e.geometry instanceof Le)?{result:y.GEOMETRY_TYPE_UNSUPPORTED,geometry:null}:{result:y.SUPPORTED,geometry:t}}function Ne(e){if(e.layer?.type!=="graphics")return y.GRAPHICS_LAYER_MISSING;if(e.geometry==null)return y.GEOMETRY_MISSING;switch(e.geometry.type){case"point":break;case"polygon":case"polyline":case"multipoint":case"extent":case"mesh":return y.SUPPORTED;default:return y.GEOMETRY_TYPE_UNSUPPORTED}const t=e.symbol!=null&&e.symbol.type==="point-3d"&&e.symbol.symbolLayers;return t&&t.length>0&&t.some(a=>a.type==="object")?Z(e)!=="on-the-ground"&&K(e)?y.ELEVATION_MODE_UNSUPPORTED:y.SUPPORTED:y.SYMBOL_TYPE_UNSUPPORTED}function oe(e,t,a){if(!t||!e||!e.map)return;const{map:o}=e,i=o.layers.find(r=>r===t);i||o.add(t,a),i&&a!=null&&o.layers.reorder(i,a)}function Ke(e,t){return e.allLayerViews.find(a=>{const o=a.layer;return o===t||"sublayers"in o&&o.sublayers!=null&&o.sublayers.includes(t)})}let N=class extends ${constructor(t){super(t),this.enabled=!1}};c([d({type:Boolean,nonNullable:!0})],N.prototype,"enabled",void 0),N=c([S("esri.views.interactive.sketch.SketchLabelOptions")],N);const le=N;let I=class extends ${constructor(e){super(e),this.mode="absolute-height"}toJSON(){return{mode:this.mode}}};c([d({type:String,nonNullable:!0})],I.prototype,"mode",void 0),I=c([S("esri.widgets.Sketch.SketchTooltipOptions.ElevationOptions")],I);let O=class extends ${constructor(){super(...arguments),this.distance=!0,this.elevation=!0,this.size=!0,this.scale=!0,this.rotation=!0,this.orientation=!0,this.totalLength=!0,this.area=!0,this.radius=!0,this.helpMessage=!1}toJSON(){return{distance:this.distance,size:this.size,scale:this.scale,rotation:this.rotation,orientation:this.orientation,totalLength:this.totalLength,area:this.area,radius:this.radius}}};c([d({type:Boolean,nonNullable:!0})],O.prototype,"distance",void 0),c([d({type:Boolean,nonNullable:!0})],O.prototype,"elevation",void 0),c([d({type:Boolean,nonNullable:!0})],O.prototype,"size",void 0),c([d({type:Boolean,nonNullable:!0})],O.prototype,"scale",void 0),c([d({type:Boolean,nonNullable:!0})],O.prototype,"rotation",void 0),c([d({type:Boolean,nonNullable:!0})],O.prototype,"orientation",void 0),c([d({type:Boolean,nonNullable:!0})],O.prototype,"totalLength",void 0),c([d({type:Boolean,nonNullable:!0})],O.prototype,"area",void 0),c([d({type:Boolean,nonNullable:!0})],O.prototype,"radius",void 0),c([d({type:Boolean,nonNullable:!0})],O.prototype,"helpMessage",void 0),O=c([S("esri.widgets.Sketch.SketchTooltipOptions.VisibleElements")],O);let R=class extends ${constructor(e){super(e),this.enabled=!1,this.elevation=new I,this.visibleElements=new O,this.visualVariables=null}toJSON(){return{enabled:this.enabled,elevation:this.elevation,visibleElements:this.visibleElements}}};c([d({type:Boolean,nonNullable:!0})],R.prototype,"enabled",void 0),c([d({type:I,nonNullable:!0})],R.prototype,"elevation",void 0),c([d({type:O,nonNullable:!0})],R.prototype,"visibleElements",void 0),c([d()],R.prototype,"visualVariables",void 0),R=c([S("esri.widgets.Sketch.SketchTooltipOptions")],R);const he=R;let E=class extends se.EventedAccessor{constructor(e){super(e),this.cancelled=!1,this.history={undo:[],redo:[]},this.type=null}get tool(){if(!this.activeComponent)return null;switch(this.activeComponent.type){case"graphic-mover":case"move-3d":return"move";case"box":case"transform-3d":return"transform";case"reshape":case"reshape-3d":return"reshape";case"draw-2d":case"draw-3d":return this.activeComponent.geometryType;default:ve(this.activeComponent)}return null}addToHistory(e){this.history.redo=[],this.history.undo.push(e)}resetHistory(){this.history.redo=[],this.history.undo=[]}canUndo(){return this.history.undo.length>0}canRedo(){return this.history.redo.length>0}complete(){this._reset(),this.onEnd(),this.emit("complete")}cancel(){this.cancelled=!0,this.complete()}_reset(){this.activeComponent?.reset()}refreshComponent(){const e=this.activeComponent;e&&(e.type!=="box"&&e.type!=="reshape"&&e.type!=="graphic-mover"||e.refresh())}set undo(e){this._set("undo",()=>{this.canUndo()&&e()})}set redo(e){this._set("redo",()=>{this.canRedo()&&e()})}};c([d()],E.prototype,"activeComponent",void 0),c([d()],E.prototype,"cancelled",void 0),c([d()],E.prototype,"history",void 0),c([d()],E.prototype,"tool",null),c([d()],E.prototype,"type",void 0),c([d()],E.prototype,"canUndo",null),c([d()],E.prototype,"canRedo",null),c([d()],E.prototype,"onEnd",void 0),c([d()],E.prototype,"undo",null),c([d()],E.prototype,"redo",null),c([d()],E.prototype,"toggleTool",void 0),c([d()],E.prototype,"addToSelection",void 0),c([d()],E.prototype,"removeFromSelection",void 0),E=c([S("esri.widgets.Sketch.support.OperationHandle")],E);let V=class extends E{};c([d()],V.prototype,"activeComponent",void 0),V=c([S("esri.widgets.Sketch.support.CreateOperationHandle")],V);let w=class extends E{};c([d()],w.prototype,"activeComponent",void 0),w=c([S("esri.widgets.Sketch.support.UpdateOperationHandle")],w);const ae={defaultZ:0},M={reshapeOptions:{edgeOperation:"split",shapeOperation:"move",vertexOperation:"move"},enableMoveAllGraphics:!0,enableRotation:!0,enableScaling:!0,multipleSelectionEnabled:!0,preserveAspectRatio:!1,toggleToolOnClick:!0,enableZ:!0,highlightOptions:{enabled:!0},tool:"transform"};let m=class extends se.EventedAccessor{constructor(e){super(e),this._numUpdating=0,this._handles=new q,this._internalGraphicsLayer=new De({listMode:"hide",internal:!0,title:"SVM Internal"}),this._operationHandle=null,this._viewHandles=new q,this.activeFillSymbol=null,this.activeLineSymbol=null,this.activeVertexSymbol=null,this.allowDeleteKey=!0,this.labelOptions=new le,this.layer=null,this.pointSymbol=new j({style:"circle",size:6,color:[255,255,255],outline:{color:[50,50,50],width:1}}),this.polygonSymbol=new _e({color:[150,150,150,.2],outline:{color:[50,50,50],width:2}}),this.polylineSymbol=new fe({color:[130,130,130,1],width:2}),this.meshSymbol=new Ee({symbolLayers:[new be]}),this._snappingManager=null,this.tooltipOptions=new he,this.updateGraphics=new Oe,this.updateOnGraphicClick=!0,this.vertexSymbol=new j({style:"circle",size:6,color:[255,255,255],outline:{color:[50,50,50],width:1}}),this._moduleLoaderAbortController=null,this._viewReadyAbortController=null,this._originalPopupEnabled=null,this.defaultCreateOptions=ae,this.defaultUpdateOptions=M,this.snappingOptions=new ne}initialize(){this._handles.add([J(()=>this.view?.map?.layers,"change",e=>{e.removed.includes(this.layer)&&this.cancel()}),J(()=>this.layer?.graphics,"change",e=>{if(this._operationHandle!=null)for(const t of e.removed)this.updateGraphics.includes(t)&&(this.updateGraphics.length>1?this._operationHandle.removeFromSelection(t):this._operationHandle.cancel())}),U(()=>this.layer?.elevationInfo??null,e=>{e!==this._internalGraphicsLayer.elevationInfo&&(this.cancel(),this._internalGraphicsLayer.elevationInfo=e)},W),U(()=>this.view,e=>{C(this._snappingManager),e&&(this._snappingManager=new He({view:e,options:this.snappingOptions}),e.type==="2d"?G(()=>import("./editingTools-460ef0a9.js"),["./editingTools-460ef0a9.js","./main-79e5ed80.js","./main-7772480e.css","./SnappingVisualizer2D-38632613.js","./settings-e9a73c67.js","./SnappingManager-e561e372.js","./elevationInfoUtils-287337e4.js","./geometry2dUtils-9d16f4f8.js","./viewUtils-ca2c33e3.js","./SnappingContext-d538137b.js","./PointSnappingHint-b8c54ed3.js","./editPlaneUtils-9f9a13c6.js","./getDefaultUnitForView-33179f7a.js","./unitFormatUtils-b50d8ff8.js","./GraphicsLayer-6532b5a8.js","./geometryEngine-547e4a01.js","./geometryEngineBase-d69ff1ad.js","./hydrated-e6cbef23.js","./helpMessageUtils-4b0262c8.js","./centroid-b0bb7e76.js","./dragEventPipeline-491faa8f.js","./drawUtils-f091ac1a.js","./automaticLengthMeasurementUtils-dacc4f51.js","./euclideanLengthMeasurementUtils-8f8f7aa9.js","./measurementUtils-c24c5920.js","./geodesicUtils-04ddd9a4.js","./automaticAreaMeasurementUtils-9241464c.js","./euclideanAreaMeasurementUtils-00f3f32f.js","./dehydratedFeatureComparison-d30367d4.js","./EditGeometryOperations-73b5f5f7.js","./SnappingOperation-e7779836.js","./analysisThemeUtils-558736fc.js","./colorUtils-fa6b524d.js","./colorUtils-c0f43caf.js","./GraphicManipulator-f9349a2c.js","./drapedUtils-2204a7de.js"],import.meta.url):e.type==="3d"&&(G(()=>import("./editingTools-9a428745.js"),["./editingTools-9a428745.js","./main-79e5ed80.js","./main-7772480e.css","./elevationInfoUtils-287337e4.js","./analysisThemeUtils-558736fc.js","./colorUtils-fa6b524d.js","./colorUtils-c0f43caf.js","./getDefaultUnitForView-33179f7a.js","./unitFormatUtils-b50d8ff8.js","./TextOverlayItem-ebd9edd4.js","./automaticLengthMeasurementUtils-dacc4f51.js","./euclideanLengthMeasurementUtils-8f8f7aa9.js","./measurementUtils-c24c5920.js","./geometryEngine-547e4a01.js","./geometryEngineBase-d69ff1ad.js","./hydrated-e6cbef23.js","./geodesicUtils-04ddd9a4.js","./viewUtils-ca2c33e3.js","./VerticesVisualElement-7ac51104.js","./RightAngleQuadVisualElement-46e9d25f.js","./LineVisualElement-edcd3279.js","./VisualElementResources-345e70b2.js","./PointVisualElement-62697d84.js","./SnappingManager-e561e372.js","./geometry2dUtils-9d16f4f8.js","./SnappingContext-d538137b.js","./PointSnappingHint-b8c54ed3.js","./manipulatorUtils-1c1ed0c0.js","./ImageMaterial-0a3b496e.js","./GraphicState-6c6134a1.js","./editPlaneUtils-9f9a13c6.js","./GraphicsLayer-6532b5a8.js","./helpMessageUtils-4b0262c8.js","./centroid-b0bb7e76.js","./dragEventPipeline-491faa8f.js","./drawUtils-f091ac1a.js","./automaticAreaMeasurementUtils-9241464c.js","./euclideanAreaMeasurementUtils-00f3f32f.js","./dehydratedFeatureComparison-d30367d4.js","./EditGeometryOperations-73b5f5f7.js","./SnappingOperation-e7779836.js","./manipulatorUtils-cf589e3d.js","./Factory-ee11222a.js","./GraphicManipulator-f9349a2c.js","./drapedUtils-2204a7de.js","./TranslateTooltipInfos-b9e3d07e.js","./MeshTransform-d557c89a.js","./sliceToolUtils-46cb6f04.js","./ExtentTooltipInfos-92f53513.js"],import.meta.url),G(()=>import("./GraphicsLayerView3D-810caf12.js"),["./GraphicsLayerView3D-810caf12.js","./main-79e5ed80.js","./main-7772480e.css","./LayerView3D-af974166.js","./queryForSymbologySnapping-be0451bb.js","./elevationInfoUtils-287337e4.js","./GraphicsProcessor-2061d640.js","./Graphics3DScaleVisibility-eaf5a046.js","./rendererConversion-22515807.js","./optimizedFeatureQueryEngineAdapter-f5f88773.js","./centroid-3dcadaf5.js","./PooledRBush-506b9510.js","./quickselect-d16016af.js","./projectExtentUtils-d31b5a37.js","./LayerView-535107ac.js"],import.meta.url)))},W),U(()=>this.view?.spatialReference,(e,t)=>{e&&t&&!e.equals(t)&&this.cancel()})]),ke(this)}destroy(){this.cancel(),this._handles=C(this._handles),this._viewHandles=C(this._viewHandles),this._removeDefaultLayer(),this._snappingManager=C(this._snappingManager),this._set("view",null),this.emit("destroy")}get _defaultUpdateTool(){return this.view?.type==="3d"?"move":"transform"}get updating(){return this._numUpdating>0||this._snappingManager!=null&&this._snappingManager.updating}get activeTool(){return this._operationHandle?.tool??null}get activeComponent(){return this._operationHandle?.activeComponent??null}get createGraphic(){return this.activeComponent==null||this.activeComponent.type!=="draw-3d"&&this.activeComponent.type!=="draw-2d"?this._get("createGraphic"):this.activeComponent.graphic}get defaultCreateOptions(){return this._get("defaultCreateOptions")}set defaultCreateOptions(e){this._set("defaultCreateOptions",{...ae,...e})}get defaultUpdateOptions(){return this._get("defaultUpdateOptions")}set defaultUpdateOptions(e){this._set("defaultUpdateOptions",{...M,...e,reshapeOptions:{...M.reshapeOptions,...e?.reshapeOptions},highlightOptions:{...M.highlightOptions,...e?.highlightOptions}})}set snappingOptions(e){this._snappingManager!=null&&(this._snappingManager.options=e),this._set("snappingOptions",e)}get state(){const e=!(!this.view?.ready||!this.layer),t=this._operationHandle;return e&&t?"active":e?"ready":"disabled"}get view(){return this._get("view")}set view(e){const t=this._get("view");if(t){const{container:o,map:i}=t;o&&(t.cursor=null),i&&i.remove(this._internalGraphicsLayer),this._viewHandles.removeAll(),this.cancel()}const a="view-ready";this._handles.remove(a),e&&this._handles.add(Ge(()=>e.ready,o=>{this._viewHandles.removeAll(),o&&this._viewHandles.add(this._generateViewHandles(e))},W),a),this._set("view",e)}cancel(){this._moduleLoaderAbortController=F(this._moduleLoaderAbortController),this._viewReadyAbortController=F(this._viewReadyAbortController),this._operationHandle&&this._operationHandle.cancel()}complete(){this._operationHandle&&this._operationHandle.complete()}delete(){const{state:e,updateGraphics:t}=this;if(e==="active"&&t.length){const{activeTool:a,layer:o}=this,i=t.toArray();o.removeMany(i),this.cancel(),this._emitDeleteEvent({graphics:i,tool:a})}}duplicate(){if(this.state==="active"&&this.updateGraphics.length){const e=this.updateGraphics.map(t=>t.clone()).toArray();return this.layer.addMany(e),this.emit("duplicate",{graphics:e,type:"duplicate"}),e}return[]}async create(e,t){this.cancel(),await this._waitViewReady();const{view:a,layer:o}=this;if(!a||this.state==="disabled")throw o||this._logMissingLayer(),X();if(a.activeTool!=null&&(a.activeTool=null),!e)return void this._logError("sketch:missing-parameter","Missing parameter 'tool'.");oe(a,this._internalGraphicsLayer);const i=await this._setupCreateOperation(e,t);if(i==null||this.destroyed)return void a.map.remove(this._internalGraphicsLayer);const r=()=>{if(i===this._operationHandle){const l=this.createGraphic,s=this._operationHandle.cancelled;this._operationHandle.destroy(),this._operationHandle=null,this._set("createGraphic",null),this.view&&this.view.map&&this.view.map.remove(this._internalGraphicsLayer),i.cancelled||l==null||o.add(l),this.emit("create",{graphic:l,state:s?"cancel":"complete",tool:e,toolEventInfo:null,type:"create"})}};i.on("complete",r),this._operationHandle=i,a.ready&&a.focus()}async update(e,t){this.cancel(),await this._waitViewReady();const{layer:a,view:o,state:i}=this;if(!o||i==="disabled")throw a||this._logMissingLayer(),X();o.activeTool!=null&&(o.activeTool=null);const r=Array.isArray(e)?e:[e];if(e==null||!r||!r.length)return void this._logError("sketch:missing-parameter","Missing parameter 'graphics'.");if(r.some(s=>s.layer!==a?(this._logError("sketch:invalid-parameter","Parameter 'graphics' contains one or more graphics missing from the supplied GraphicsLayer."),!0):s.geometry==null&&(this._logError("sketch:invalid-parameter","Parameter 'graphics' contains one or more graphics with an unsupported geometry."),!0)))return;const l=await this._setupUpdateOperation(r,t);this.destroyed||l==null||_(l)||(oe(o,this._internalGraphicsLayer),this._setUpdateOperationHandle(l,t),this.emit("update",{graphics:r,state:"start",aborted:!1,tool:l.tool,toolEventInfo:null,type:"update"}))}async _updateSpatialReference(e){const t=this.view;if(t){this._beginAsyncOperation(),e=Array.isArray(e)?e:[e];for(const a of e)a.geometry==null||a.geometry.type==="mesh"||Te(a.geometry.spatialReference,t.spatialReference)||(we(a.geometry.spatialReference,t.spatialReference)||Se()||await Ae(),a.geometry=Re(a.geometry,t.spatialReference));this._endAsyncOperation()}else this._logMissingView()}undo(){this.canUndo()&&this._operationHandle?.undo()}redo(){this.canRedo()&&this._operationHandle?.redo()}canUndo(){return!(!this._operationHandle||!this._operationHandle.canUndo())}canRedo(){return!(!this._operationHandle||!this._operationHandle.canRedo())}toggleUpdateTool(){this._operationHandle&&this._operationHandle.toggleTool&&this._operationHandle.toggleTool()}async _getFirstHit(e){const t=this.view;if(!t)return this._logMissingView(),null;if(t.type==="2d"){const i=[];t.map.allLayers.forEach(l=>{l.type!=="vector-tile"&&l.type!=="imagery"||i.push(l)});const r=await t.hitTest(e,{exclude:i});return Pe(r.results)}const a=[t.map.ground];t.map.allLayers.forEach(i=>{i.type==="integrated-mesh"&&a.push(i)});const o=await t.hitTest(e,{exclude:a});if(o.results.length>0){const i=o.results[0];if(i!=null&&i.type==="graphic"&&i.graphic&&(!o.ground.mapPoint||t.map.ground.opacity<1||o.ground.distance-(i.distance??0)>-Math.min(3*o.ground.distance,t.viewingMode==="global"?re(t.renderCoordsHelper.spatialReference).radius/t.renderCoordsHelper.unitInMeters:Number.POSITIVE_INFINITY)))return i}return null}_generateViewHandles(e){return[e.on("immediate-click",async t=>{const a=this.state==="active"&&this._operationHandle?.type==="create";if(this.state==="disabled"||a||!this.updateOnGraphicClick)return;this._beginAsyncOperation();const o=await t.async(()=>this._getFirstHit(Q(t)));let i=null;if(o!=null){const r=o.graphic;this.updateGraphics.includes(r)||r.layer===this.layer?(t.stopPropagation(),i=r):e.type!=="2d"||this._isComponentGraphic(r)||this.state!=="active"||this.cancel()}else this.state==="active"&&this.cancel();i==null||this.updateGraphics.includes(i)||await this.update([i],{...this.defaultUpdateOptions,reshapeOptions:{...this.defaultUpdateOptions.reshapeOptions}}),this._endAsyncOperation()},f.WIDGET)]}async _setupCreateOperation(e,t){const a=this.view;if(!a)return this._logMissingView(),null;const o={hasZ:a.type==="3d",...this.defaultCreateOptions,...t},i=await this._setupDrawGraphicTool(e,a,o);return i==null?null:(a.tools.add(i),a.activeTool=i,this._setupCreateOperationHandle(i))}async _setupDrawGraphicTool(e,t,a){if(e==="multipoint"&&t.type==="3d")return this._logError("sketch:create","Multipoint geometries are not supported in SceneView."),null;if(!t)return this._logMissingView(),null;const o=e!=="rectangle",i=e!=="rectangle",r={view:t,mode:e==="rectangle"||e==="circle"?"hybrid":"click",...a,snapToScene:!1,geometryType:e,graphicSymbol:this._getGraphicSymbolFromTool(e),snappingManager:this._snappingManager,forceUniformSize:i,centered:o};return t.type==="2d"?this._makeDrawGraphicTool2D(r):this._makeDrawGraphicTool3D(r)}async _makeDrawGraphicTool2D(e){const t=await this._requireModule(G(()=>import("./editingTools-460ef0a9.js"),["./editingTools-460ef0a9.js","./main-79e5ed80.js","./main-7772480e.css","./SnappingVisualizer2D-38632613.js","./settings-e9a73c67.js","./SnappingManager-e561e372.js","./elevationInfoUtils-287337e4.js","./geometry2dUtils-9d16f4f8.js","./viewUtils-ca2c33e3.js","./SnappingContext-d538137b.js","./PointSnappingHint-b8c54ed3.js","./editPlaneUtils-9f9a13c6.js","./getDefaultUnitForView-33179f7a.js","./unitFormatUtils-b50d8ff8.js","./GraphicsLayer-6532b5a8.js","./geometryEngine-547e4a01.js","./geometryEngineBase-d69ff1ad.js","./hydrated-e6cbef23.js","./helpMessageUtils-4b0262c8.js","./centroid-b0bb7e76.js","./dragEventPipeline-491faa8f.js","./drawUtils-f091ac1a.js","./automaticLengthMeasurementUtils-dacc4f51.js","./euclideanLengthMeasurementUtils-8f8f7aa9.js","./measurementUtils-c24c5920.js","./geodesicUtils-04ddd9a4.js","./automaticAreaMeasurementUtils-9241464c.js","./euclideanAreaMeasurementUtils-00f3f32f.js","./dehydratedFeatureComparison-d30367d4.js","./EditGeometryOperations-73b5f5f7.js","./SnappingOperation-e7779836.js","./analysisThemeUtils-558736fc.js","./colorUtils-fa6b524d.js","./colorUtils-c0f43caf.js","./GraphicManipulator-f9349a2c.js","./drapedUtils-2204a7de.js"],import.meta.url));return _(t)||this.destroyed?null:new t.module.DrawGraphicTool2D({...e,activeVertexSymbol:this.activeVertexSymbol,regularVerticesSymbol:this.vertexSymbol,activeLineSymbol:this.activeLineSymbol,activeFillSymbol:$e(e.geometryType)?this.activeFillSymbol:null,tooltipOptions:this.tooltipOptions})}async _makeDrawGraphicTool3D(e){const t=await this._requireModule(G(()=>import("./editingTools-9a428745.js"),["./editingTools-9a428745.js","./main-79e5ed80.js","./main-7772480e.css","./elevationInfoUtils-287337e4.js","./analysisThemeUtils-558736fc.js","./colorUtils-fa6b524d.js","./colorUtils-c0f43caf.js","./getDefaultUnitForView-33179f7a.js","./unitFormatUtils-b50d8ff8.js","./TextOverlayItem-ebd9edd4.js","./automaticLengthMeasurementUtils-dacc4f51.js","./euclideanLengthMeasurementUtils-8f8f7aa9.js","./measurementUtils-c24c5920.js","./geometryEngine-547e4a01.js","./geometryEngineBase-d69ff1ad.js","./hydrated-e6cbef23.js","./geodesicUtils-04ddd9a4.js","./viewUtils-ca2c33e3.js","./VerticesVisualElement-7ac51104.js","./RightAngleQuadVisualElement-46e9d25f.js","./LineVisualElement-edcd3279.js","./VisualElementResources-345e70b2.js","./PointVisualElement-62697d84.js","./SnappingManager-e561e372.js","./geometry2dUtils-9d16f4f8.js","./SnappingContext-d538137b.js","./PointSnappingHint-b8c54ed3.js","./manipulatorUtils-1c1ed0c0.js","./ImageMaterial-0a3b496e.js","./GraphicState-6c6134a1.js","./editPlaneUtils-9f9a13c6.js","./GraphicsLayer-6532b5a8.js","./helpMessageUtils-4b0262c8.js","./centroid-b0bb7e76.js","./dragEventPipeline-491faa8f.js","./drawUtils-f091ac1a.js","./automaticAreaMeasurementUtils-9241464c.js","./euclideanAreaMeasurementUtils-00f3f32f.js","./dehydratedFeatureComparison-d30367d4.js","./EditGeometryOperations-73b5f5f7.js","./SnappingOperation-e7779836.js","./manipulatorUtils-cf589e3d.js","./Factory-ee11222a.js","./GraphicManipulator-f9349a2c.js","./drapedUtils-2204a7de.js","./TranslateTooltipInfos-b9e3d07e.js","./MeshTransform-d557c89a.js","./sliceToolUtils-46cb6f04.js","./ExtentTooltipInfos-92f53513.js"],import.meta.url));if(_(t)||this.destroyed)return null;const{elevationInfo:a}=this.layer;return new t.module.DrawGraphicTool3D({...e,elevationInfo:a,snapToScene:a==null||a.mode==="absolute-height",labelOptions:this.labelOptions,tooltipOptions:this.tooltipOptions})}_setupCreateOperationHandle(e){const t=this.view;if(!t)return this._logMissingView(),null;let a=null;const o=e.forceUniformSize,i=e.centered,r=[t.on("key-down",s=>{if(s.key===v.pan)s.stopPropagation(),s.repeat||(e.enabled=!1);else if(s.key===v.complete)s.stopPropagation(),e.completeCreateOperation();else if(s.key!==v.vertexAdd||s.repeat)s.key===v.undo?(s.stopPropagation(),l.undo()):s.key===v.redo?(s.stopPropagation(),l.redo()):s.key!==v.constraint||e.geometryType!=="rectangle"&&e.geometryType!=="circle"||s.repeat?s.key===v.center&&(s.repeat||(e.centered=!i,s.stopPropagation())):(e.forceUniformSize=!o,s.stopPropagation());else{const p=e.drawOperation.geometryType;p!=="polyline"&&p!=="polygon"&&p!=="multipoint"||(s.stopPropagation(),e.drawOperation.commitStagedVertex())}},f.WIDGET),t.on("key-up",s=>{s.key===v.pan?e.enabled=!0:s.key!==v.constraint||e.geometryType!=="rectangle"&&e.geometryType!=="circle"?s.key===v.center&&(e.centered=i,s.stopPropagation()):(e.forceUniformSize=o,s.stopPropagation())},f.WIDGET),e.on("vertex-add",s=>{switch(a=a==null?"start":"active",s.operation){case"apply":this.emit("create",{graphic:e.graphic,state:a,tool:this.activeTool,toolEventInfo:s,type:"create"});break;case"undo":this._emitUndoEvent({graphics:[e.graphic],tool:e.geometryType});break;case"redo":this._emitRedoEvent({graphics:[e.graphic],tool:e.geometryType})}}),e.on("cursor-update",s=>{e.drawOperation.numCommittedVertices>0&&this.emit("create",{graphic:e.graphic,state:"active",tool:this.activeTool,toolEventInfo:{coordinates:s.vertices[0].coordinates,type:"cursor-update"},type:"create"})}),e.on("vertex-remove",s=>{switch(s.operation){case"apply":this.emit("create",{graphic:e.graphic,state:"active",tool:this.activeTool,toolEventInfo:s,type:"create"});break;case"undo":this._emitUndoEvent({graphics:[e.graphic],tool:e.geometryType});break;case"redo":this._emitRedoEvent({graphics:[e.graphic],tool:e.geometryType})}}),e.on("complete",s=>{this._set("createGraphic",s.graphic),a="complete",s.aborted?l&&l.cancel():l&&l.complete()}),U(()=>this._getGraphicSymbolFromTool(e.geometryType),s=>{e.graphicSymbol=s})],l=new V({activeComponent:e,tool:e.geometryType,type:"create",onEnd:()=>{r.forEach(s=>s.remove()),r.length=0,t.tools?.remove(e)},undo:()=>{e.canUndo&&e.undo()},redo:()=>{e.canRedo&&e.redo()},canUndo:()=>e.canUndo,canRedo:()=>e.canRedo});return l}_getGraphicSymbolFromTool(e){switch(e){case"point":case"multipoint":return this.pointSymbol;case"polyline":return this.polylineSymbol;case"circle":case"rectangle":case"polygon":return this.polygonSymbol;case"mesh":return this.meshSymbol}}async _setupUpdateOperation(e,t){const{layer:a,view:o}=this;if(!o)return this._logMissingView(),null;const i={tool:this._defaultUpdateTool,...this.defaultUpdateOptions,...t,reshapeOptions:{...this.defaultUpdateOptions.reshapeOptions,...t?.reshapeOptions},highlightOptions:{...this.defaultUpdateOptions.highlightOptions,...t?.highlightOptions}};let r=i.tool;for(const l of e)a.remove(l),a.add(l);if(o.type==="3d"){if(e.length===0)return null;switch(r){case"move":return this._setupMove3DOperation(e,i,o,r);case"reshape":{if(e.length>1)return this._logError("sketch:reshape-multiple","Reshape operation does not support multiple graphics."),null;const l=H(e[0]);return l===y.SUPPORTED?this._setupReshape3DOperation(e[0],i,o):(this._logError("sketch:reshape",`Reshape operation not supported for provided graphic(s) (${B(l)}).`),null)}case"transform":return this._setupGraphicTransform3DOperation(e,i,o)}}switch(r){case"move":return this._setupMove2DOperation(e,i,o);case"reshape":{if(e.length>1)return this._logError("sketch:reshape-multiple","Reshape operation does not support multiple graphics."),null;const l=H(e[0]);return l===y.SUPPORTED?this._setupTransformOrReshape2DOperation(e,r,i,o):(this._logError("sketch:reshape",`Reshape operation not supported for provided graphic(s) (${B(l)}).`),null)}case"transform":if(e.length===1){const l=e[0].geometry?.type;l!=="point"&&l!=="multipoint"||(r="reshape")}return this._setupTransformOrReshape2DOperation(e,r,i,o)}}async _setupMove3DOperation(e,t,a,o,i=!1){for(const n of e){const h=xe(n);if(h!==y.SUPPORTED)return this._logError("sketch:move",`Move operation not supported for provided graphic(s) (${B(h)}).`),null}const r=await this._requireModule(G(()=>import("./editingTools-9a428745.js"),["./editingTools-9a428745.js","./main-79e5ed80.js","./main-7772480e.css","./elevationInfoUtils-287337e4.js","./analysisThemeUtils-558736fc.js","./colorUtils-fa6b524d.js","./colorUtils-c0f43caf.js","./getDefaultUnitForView-33179f7a.js","./unitFormatUtils-b50d8ff8.js","./TextOverlayItem-ebd9edd4.js","./automaticLengthMeasurementUtils-dacc4f51.js","./euclideanLengthMeasurementUtils-8f8f7aa9.js","./measurementUtils-c24c5920.js","./geometryEngine-547e4a01.js","./geometryEngineBase-d69ff1ad.js","./hydrated-e6cbef23.js","./geodesicUtils-04ddd9a4.js","./viewUtils-ca2c33e3.js","./VerticesVisualElement-7ac51104.js","./RightAngleQuadVisualElement-46e9d25f.js","./LineVisualElement-edcd3279.js","./VisualElementResources-345e70b2.js","./PointVisualElement-62697d84.js","./SnappingManager-e561e372.js","./geometry2dUtils-9d16f4f8.js","./SnappingContext-d538137b.js","./PointSnappingHint-b8c54ed3.js","./manipulatorUtils-1c1ed0c0.js","./ImageMaterial-0a3b496e.js","./GraphicState-6c6134a1.js","./editPlaneUtils-9f9a13c6.js","./GraphicsLayer-6532b5a8.js","./helpMessageUtils-4b0262c8.js","./centroid-b0bb7e76.js","./dragEventPipeline-491faa8f.js","./drawUtils-f091ac1a.js","./automaticAreaMeasurementUtils-9241464c.js","./euclideanAreaMeasurementUtils-00f3f32f.js","./dehydratedFeatureComparison-d30367d4.js","./EditGeometryOperations-73b5f5f7.js","./SnappingOperation-e7779836.js","./manipulatorUtils-cf589e3d.js","./Factory-ee11222a.js","./GraphicManipulator-f9349a2c.js","./drapedUtils-2204a7de.js","./TranslateTooltipInfos-b9e3d07e.js","./MeshTransform-d557c89a.js","./sliceToolUtils-46cb6f04.js","./ExtentTooltipInfos-92f53513.js"],import.meta.url));if(_(r))return r;const l=new r.module.GraphicMoveTool({view:a,enableZ:t.enableZ,snappingManager:this._snappingManager,tooltipOptions:this.tooltipOptions});a.tools.add(l),l.graphics.addMany(e),i||this.updateGraphics.addMany(e);const s=[],p=new w({activeComponent:l,tool:o,type:"update",onEnd:()=>{s.forEach(n=>n.remove()),s.length=0,a.tools?.remove(l),l.destroyed||l.destroy()},undo:()=>{x(p,this.updateGraphics.toArray()),this._emitUndoEvent({graphics:this.updateGraphics.toArray(),tool:o})},redo:()=>{L(p,this.updateGraphics.toArray()),this._emitRedoEvent({graphics:this.updateGraphics.toArray(),tool:o})},addToSelection:n=>{this.updateGraphics.push(n),l.graphics.push(n),this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{added:[n],removed:[],type:"selection-change"},type:"update"})},removeFromSelection:n=>{const h=this.updateGraphics.indexOf(n);p.history.undo.forEach(u=>u.updates.splice(h,1)),p.history.redo.forEach(u=>u.updates.splice(h,1)),this.updateGraphics.remove(n),this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{added:[],removed:[n],type:"selection-change"},type:"update"}),this.updateGraphics.length!==0?l.graphics.remove(n):p.complete()},toggleTool:async()=>{if(this.updateGraphics.length!==1||t.toggleToolOnClick===!1||o!=="transform")return;const n=this.updateGraphics.at(0);if(H(n)!==y.SUPPORTED)return;p.onEnd(),p.destroy();const h=await this._setupReshape3DOperation(n,t,a,!0);_(h)||this._setUpdateOperationHandle(h,t)}});return s.push(...this._getHandlesForComponent(p,t),a.on("immediate-click",n=>this._getCommonUpdateOperationClickHandlers(p,n,t),f.WIDGET),a.on("key-down",n=>{this._getCommonUpdateOperationKeyDownHandlers(p,n)},f.WIDGET)),p}_setupGraphicTransform3DOperation(e,t,a,o=!1){if(e.length===1&&Ne(e[0])===y.SUPPORTED){const i=e[0],r=i.geometry;if(r!=null&&(r.type==="point"||r.type==="mesh"))return this._setupPointTransform3DOperation(i,t,a);if(r!=null&&(r.type==="polygon"||r.type==="polyline"))return this._setupPolyTransform3DOperation(i,t,a,o)}return this._setupMove3DOperation(e,t,a,"transform",o)}async _setupPointTransform3DOperation(e,t,a){const o="transform",{enableRotation:i,enableScaling:r,enableZ:l}=t,s=await this._requireModule(G(()=>import("./editingTools-9a428745.js"),["./editingTools-9a428745.js","./main-79e5ed80.js","./main-7772480e.css","./elevationInfoUtils-287337e4.js","./analysisThemeUtils-558736fc.js","./colorUtils-fa6b524d.js","./colorUtils-c0f43caf.js","./getDefaultUnitForView-33179f7a.js","./unitFormatUtils-b50d8ff8.js","./TextOverlayItem-ebd9edd4.js","./automaticLengthMeasurementUtils-dacc4f51.js","./euclideanLengthMeasurementUtils-8f8f7aa9.js","./measurementUtils-c24c5920.js","./geometryEngine-547e4a01.js","./geometryEngineBase-d69ff1ad.js","./hydrated-e6cbef23.js","./geodesicUtils-04ddd9a4.js","./viewUtils-ca2c33e3.js","./VerticesVisualElement-7ac51104.js","./RightAngleQuadVisualElement-46e9d25f.js","./LineVisualElement-edcd3279.js","./VisualElementResources-345e70b2.js","./PointVisualElement-62697d84.js","./SnappingManager-e561e372.js","./geometry2dUtils-9d16f4f8.js","./SnappingContext-d538137b.js","./PointSnappingHint-b8c54ed3.js","./manipulatorUtils-1c1ed0c0.js","./ImageMaterial-0a3b496e.js","./GraphicState-6c6134a1.js","./editPlaneUtils-9f9a13c6.js","./GraphicsLayer-6532b5a8.js","./helpMessageUtils-4b0262c8.js","./centroid-b0bb7e76.js","./dragEventPipeline-491faa8f.js","./drawUtils-f091ac1a.js","./automaticAreaMeasurementUtils-9241464c.js","./euclideanAreaMeasurementUtils-00f3f32f.js","./dehydratedFeatureComparison-d30367d4.js","./EditGeometryOperations-73b5f5f7.js","./SnappingOperation-e7779836.js","./manipulatorUtils-cf589e3d.js","./Factory-ee11222a.js","./GraphicManipulator-f9349a2c.js","./drapedUtils-2204a7de.js","./TranslateTooltipInfos-b9e3d07e.js","./MeshTransform-d557c89a.js","./sliceToolUtils-46cb6f04.js","./ExtentTooltipInfos-92f53513.js"],import.meta.url));if(_(s))return s;const p=new s.module.GraphicTransformTool({graphic:e,view:a,enableRotation:i,enableScaling:r,enableZ:l,snappingManager:this._snappingManager,tooltipOptions:this.tooltipOptions});a.tools.add(p),this.updateGraphics.add(e);const n=[],h=new w({activeComponent:p,tool:o,type:"update",onEnd:()=>{n.forEach(u=>u.remove()),n.length=0,a.tools?.remove(p),p.destroyed||p.destroy()},undo:()=>{x(h,this.updateGraphics.toArray()),this._emitUndoEvent({graphics:this.updateGraphics.toArray(),tool:o})},redo:()=>{L(h,this.updateGraphics.toArray()),this._emitRedoEvent({graphics:this.updateGraphics.toArray(),tool:o})},addToSelection:async u=>{this.updateGraphics.add(u),this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{added:[u],removed:[],type:"selection-change"},type:"update"}),h.onEnd(),h.destroy();const b=await this._setupMove3DOperation(this.updateGraphics.toArray(),t,a,"transform",!0);_(b)||this._setUpdateOperationHandle(b,t)},removeFromSelection:u=>{this.updateGraphics.remove(u),this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{added:[],removed:[u],type:"selection-change"},type:"update"}),h.complete()},toggleTool:()=>{}});return n.push(...this._getHandlesForComponent(h,t),a.on("immediate-click",u=>this._getCommonUpdateOperationClickHandlers(h,u,t),f.WIDGET),a.on("key-down",u=>{this._getCommonUpdateOperationKeyDownHandlers(h,u)},f.WIDGET)),h}async _setupPolyTransform3DOperation(e,t,a,o=!1){const i="transform",{enableRotation:r,enableScaling:l,enableZ:s,preserveAspectRatio:p}=t,n=await this._requireModule(G(()=>import("./editingTools-9a428745.js"),["./editingTools-9a428745.js","./main-79e5ed80.js","./main-7772480e.css","./elevationInfoUtils-287337e4.js","./analysisThemeUtils-558736fc.js","./colorUtils-fa6b524d.js","./colorUtils-c0f43caf.js","./getDefaultUnitForView-33179f7a.js","./unitFormatUtils-b50d8ff8.js","./TextOverlayItem-ebd9edd4.js","./automaticLengthMeasurementUtils-dacc4f51.js","./euclideanLengthMeasurementUtils-8f8f7aa9.js","./measurementUtils-c24c5920.js","./geometryEngine-547e4a01.js","./geometryEngineBase-d69ff1ad.js","./hydrated-e6cbef23.js","./geodesicUtils-04ddd9a4.js","./viewUtils-ca2c33e3.js","./VerticesVisualElement-7ac51104.js","./RightAngleQuadVisualElement-46e9d25f.js","./LineVisualElement-edcd3279.js","./VisualElementResources-345e70b2.js","./PointVisualElement-62697d84.js","./SnappingManager-e561e372.js","./geometry2dUtils-9d16f4f8.js","./SnappingContext-d538137b.js","./PointSnappingHint-b8c54ed3.js","./manipulatorUtils-1c1ed0c0.js","./ImageMaterial-0a3b496e.js","./GraphicState-6c6134a1.js","./editPlaneUtils-9f9a13c6.js","./GraphicsLayer-6532b5a8.js","./helpMessageUtils-4b0262c8.js","./centroid-b0bb7e76.js","./dragEventPipeline-491faa8f.js","./drawUtils-f091ac1a.js","./automaticAreaMeasurementUtils-9241464c.js","./euclideanAreaMeasurementUtils-00f3f32f.js","./dehydratedFeatureComparison-d30367d4.js","./EditGeometryOperations-73b5f5f7.js","./SnappingOperation-e7779836.js","./manipulatorUtils-cf589e3d.js","./Factory-ee11222a.js","./GraphicManipulator-f9349a2c.js","./drapedUtils-2204a7de.js","./TranslateTooltipInfos-b9e3d07e.js","./MeshTransform-d557c89a.js","./sliceToolUtils-46cb6f04.js","./ExtentTooltipInfos-92f53513.js"],import.meta.url));if(_(n))return n;const h=new n.module.ExtentTransformTool({graphic:e,view:a,enableRotation:r,enableScaling:l,enableZ:s,preserveAspectRatio:p,tooltipOptions:this.tooltipOptions});a.tools.add(h),o||this.updateGraphics.add(e);const u=[],b=new w({activeComponent:h,tool:i,type:"update",onEnd:()=>{u.forEach(g=>g.remove()),u.length=0,a.tools?.remove(h),h.destroyed||h.destroy()},canUndo:()=>h.canUndo,undo:()=>{h.undo(),this._emitUndoEvent({graphics:this.updateGraphics.toArray(),tool:i})},canRedo:()=>h.canRedo,redo:()=>{h.redo(),this._emitRedoEvent({graphics:this.updateGraphics.toArray(),tool:i})},addToSelection:async g=>{this.updateGraphics.add(g),this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{added:[g],removed:[],type:"selection-change"},type:"update"}),b.onEnd(),b.destroy();const P=await this._setupMove3DOperation(this.updateGraphics.toArray(),t,a,"transform",!0);_(P)||this._setUpdateOperationHandle(P,t)},removeFromSelection:g=>{this.updateGraphics.remove(g),this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{added:[],removed:[g],type:"selection-change"},type:"update"}),b.complete()},toggleTool:async()=>{if(this.updateGraphics.length!==1||t.toggleToolOnClick===!1)return;const g=this.updateGraphics.at(0);if(H(g)!==y.SUPPORTED)return;b.onEnd(),b.destroy();const P=await this._setupReshape3DOperation(g,t,a,!0);_(P)||this._setUpdateOperationHandle(P,t)}});return u.push(...this._getHandlesForComponent(b,t),a.on("immediate-click",g=>this._getCommonUpdateOperationClickHandlers(b,g,t),f.WIDGET),a.on("key-down",g=>this._getCommonUpdateOperationKeyDownHandlers(b,g),f.WIDGET),a.on("key-down",g=>{g.key!==v.constraint||g.repeat||(h.preserveAspectRatio=!h.preserveAspectRatio,g.stopPropagation())},f.WIDGET),a.on("key-up",g=>{g.key===v.constraint&&(h.preserveAspectRatio=!h.preserveAspectRatio,g.stopPropagation())},f.WIDGET)),b}async _setupMove2DOperation(e,t,a){const o="move";this.updateGraphics.addMany(e),await this._updateSpatialReference(e);const i=await this._getGraphicMover(e,t,a);if(_(i))return i;const r=new w({activeComponent:i,tool:o,type:"update",onEnd:()=>{this._displayDefaultCursor(),p.forEach(n=>n.remove()),s.forEach(n=>n.remove()),p=[],s=[],i.destroy(),this._internalGraphicsLayer?.removeMany([...this.updateGraphics.toArray()])},undo:()=>{const n=this.updateGraphics.toArray();x(r,n),r.refreshComponent(),this._emitUndoEvent({graphics:n,tool:o})},redo:()=>{const n=this.updateGraphics.toArray();L(r,n),r.refreshComponent(),this._emitRedoEvent({graphics:n,tool:o})},addToSelection:async n=>{await this._updateSpatialReference(n),this.updateGraphics.push(n),i.graphics=this.updateGraphics.toArray(),this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{added:[n],removed:[],type:"selection-change"},type:"update"})},removeFromSelection:n=>{const h=this.updateGraphics.indexOf(n);r.history.undo.forEach(b=>b.updates.splice(h,1)),r.history.redo.forEach(b=>b.updates.splice(h,1)),this.updateGraphics.remove(n);const u=this.updateGraphics.toArray();this.emit("update",{graphics:u,state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{added:[],removed:[n],type:"selection-change"},type:"update"}),this.updateGraphics.length!==0?i.graphics=u:r.complete()}});let l=!1,s=[a.on("immediate-click",n=>this._getCommonUpdateOperationClickHandlers(r,n,t),f.WIDGET),a.on("key-down",n=>{this._getCommonUpdateOperationKeyDownHandlers(r,n),n.key!==v.constraint||n.repeat||(l=!0,i.enableMoveAllGraphics=!i.enableMoveAllGraphics)},f.WIDGET),a.on("key-up",n=>{n.key===v.constraint&&l&&(l=!1,i.enableMoveAllGraphics=!i.enableMoveAllGraphics)},f.WIDGET)],p=this._getHandlesForComponent(r,t);return r}async _setupReshape3DOperation(e,t,a,o=!1){const i="reshape",r=await this._requireModule(G(()=>import("./editingTools-9a428745.js"),["./editingTools-9a428745.js","./main-79e5ed80.js","./main-7772480e.css","./elevationInfoUtils-287337e4.js","./analysisThemeUtils-558736fc.js","./colorUtils-fa6b524d.js","./colorUtils-c0f43caf.js","./getDefaultUnitForView-33179f7a.js","./unitFormatUtils-b50d8ff8.js","./TextOverlayItem-ebd9edd4.js","./automaticLengthMeasurementUtils-dacc4f51.js","./euclideanLengthMeasurementUtils-8f8f7aa9.js","./measurementUtils-c24c5920.js","./geometryEngine-547e4a01.js","./geometryEngineBase-d69ff1ad.js","./hydrated-e6cbef23.js","./geodesicUtils-04ddd9a4.js","./viewUtils-ca2c33e3.js","./VerticesVisualElement-7ac51104.js","./RightAngleQuadVisualElement-46e9d25f.js","./LineVisualElement-edcd3279.js","./VisualElementResources-345e70b2.js","./PointVisualElement-62697d84.js","./SnappingManager-e561e372.js","./geometry2dUtils-9d16f4f8.js","./SnappingContext-d538137b.js","./PointSnappingHint-b8c54ed3.js","./manipulatorUtils-1c1ed0c0.js","./ImageMaterial-0a3b496e.js","./GraphicState-6c6134a1.js","./editPlaneUtils-9f9a13c6.js","./GraphicsLayer-6532b5a8.js","./helpMessageUtils-4b0262c8.js","./centroid-b0bb7e76.js","./dragEventPipeline-491faa8f.js","./drawUtils-f091ac1a.js","./automaticAreaMeasurementUtils-9241464c.js","./euclideanAreaMeasurementUtils-00f3f32f.js","./dehydratedFeatureComparison-d30367d4.js","./EditGeometryOperations-73b5f5f7.js","./SnappingOperation-e7779836.js","./manipulatorUtils-cf589e3d.js","./Factory-ee11222a.js","./GraphicManipulator-f9349a2c.js","./drapedUtils-2204a7de.js","./TranslateTooltipInfos-b9e3d07e.js","./MeshTransform-d557c89a.js","./sliceToolUtils-46cb6f04.js","./ExtentTooltipInfos-92f53513.js"],import.meta.url));if(_(r))return r;const l=t.reshapeOptions,s=new r.module.GraphicReshapeTool({view:a,graphic:e,enableZVertex:t.enableZ&&l?.vertexOperation==="move",enableZShape:t.enableZ&&l?.shapeOperation==="move",enableMoveGraphic:l?.shapeOperation==="move"||l?.shapeOperation==="move-xy",enableMidpoints:l?.edgeOperation==="split",enableEdgeOffset:l?.edgeOperation==="offset",snappingManager:this._snappingManager,labelOptions:this.labelOptions,tooltipOptions:this.tooltipOptions});a.tools.add(s),o||this.updateGraphics.add(e);const p=[],n=new w({activeComponent:s,tool:i,type:"update",onEnd:()=>{p.forEach(h=>h.remove()),p.length=0,a.tools?.remove(s),s.destroyed||s.destroy()},canUndo:()=>s.canUndo,undo:()=>{s.undo(),this._emitUndoEvent({graphics:this.updateGraphics.toArray(),tool:i})},canRedo:()=>s.canRedo,redo:()=>{s.redo(),this._emitRedoEvent({graphics:this.updateGraphics.toArray(),tool:i})},addToSelection:async h=>{this.updateGraphics.add(h),this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{added:[h],removed:[],type:"selection-change"},type:"update"}),n.onEnd(),n.destroy();const u=await this._setupMove3DOperation(this.updateGraphics.toArray(),t,a,"transform",!0);_(u)||this._setUpdateOperationHandle(u,t)},removeFromSelection:h=>{this.updateGraphics.remove(h),this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{added:[],removed:[h],type:"selection-change"},type:"update"}),n.complete()},toggleTool:async()=>{if(t.toggleToolOnClick===!1)return;n.onEnd(),n.destroy();const h=await this._setupGraphicTransform3DOperation(this.updateGraphics.toArray(),t,a,!0);_(h)||this._setUpdateOperationHandle(h,t)}});return p.push(...this._getHandlesForComponent(n,t),a.on("immediate-click",h=>this._getCommonUpdateOperationClickHandlers(n,h,t),f.WIDGET),a.on("key-down",h=>{this._getCommonUpdateOperationKeyDownHandlers(n,h)},f.WIDGET)),n}async _setupTransformOrReshape2DOperation(e,t,a,o){this.updateGraphics.addMany(e),await this._updateSpatialReference(e);const i=t==="transform"?await this._getBox(e,a,o):await this._getReshape(e,a,o);if(_(i))return i;const r=new w({activeComponent:i,type:"update",onEnd:()=>{s.forEach(p=>p.remove()),l.forEach(p=>p.remove()),s=[],l=[],r.activeComponent&&!r.activeComponent.destroyed&&r.activeComponent.destroy(),this._internalGraphicsLayer.removeMany(this.updateGraphics.toArray())},undo:()=>{x(r,this.updateGraphics.toArray()),r.refreshComponent(),this._emitUndoEvent({graphics:this.updateGraphics.toArray(),tool:r.tool})},redo:()=>{L(r,this.updateGraphics.toArray()),r.refreshComponent(),this._emitRedoEvent({graphics:this.updateGraphics.toArray(),tool:r.tool})},addToSelection:async p=>{let n=r.activeComponent;if(n?.type==="reshape"){const h=[...this.updateGraphics,p];this.updateGraphics.removeAll(),r.onEnd(),r.destroy();const u=await this._setupMove2DOperation(h,a,o);if(_(u))return;this._setUpdateOperationHandle(u,a)}else this.updateGraphics.add(p),n.graphics=this.updateGraphics.toArray(),n.refresh(),r.resetHistory();this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{added:[p],removed:[],type:"selection-change"},type:"update"})},removeFromSelection:async p=>{const n=this.updateGraphics.indexOf(p);r.history.undo.forEach(u=>u.updates.splice(n,1)),r.history.redo.forEach(u=>u.updates.splice(n,1)),this.updateGraphics.remove(p);const h=this.updateGraphics.toArray();if(h.length===0)r.complete();else{const u=h[0].geometry;h.length!==1||u==null||u.type!=="point"&&u.type!=="multipoint"?r.activeComponent.graphics=h:r.toggleTool()}this.emit("update",{graphics:h,state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{added:[],removed:[p],type:"selection-change"},type:"update"})},toggleTool:async()=>{if(this.updateGraphics.length>1)return;const p=this.updateGraphics.at(0),n=p.geometry;if(n!=null&&(r.tool==="reshape"&&(n.type==="point"||n.type==="multipoint")||r.tool==="transform"&&n.type==="extent"))return;let h=null;r.tool==="transform"?h=await this._getReshape([p],a,o):r.tool==="reshape"&&(h=await this._getBox([p],a,o)),_(h)||(r.activeComponent?.destroy(),r.activeComponent=h,r.activeComponent&&(s.forEach(u=>u.remove()),s=this._getHandlesForComponent(r,a)))}});let l=[o.on("immediate-click",p=>this._getCommonUpdateOperationClickHandlers(r,p,a),f.WIDGET),o.on("key-down",p=>{if(this._getCommonUpdateOperationKeyDownHandlers(r,p),p.key===v.constraint&&!p.repeat&&r){const n=r.activeComponent;n&&n.type==="box"&&(n.preserveAspectRatio=!n.preserveAspectRatio)}},f.WIDGET),o.on("key-up",p=>{if(p.key===v.constraint&&r){const n=r.activeComponent;n&&n.type==="box"&&(n.preserveAspectRatio=!n.preserveAspectRatio)}},f.WIDGET)],s=this._getHandlesForComponent(r,a);return r}async _getGraphicMover(e,t,a){const{enableMoveAllGraphics:o,highlightOptions:i}=t,r=await this._requireModule(G(()=>import("./GraphicMover-8a00d1d0.js").then(l=>l.G),["./GraphicMover-8a00d1d0.js","./main-79e5ed80.js","./main-7772480e.css","./GraphicsLayer-6532b5a8.js","./drawUtils-f091ac1a.js","./GraphicManipulator-f9349a2c.js","./elevationInfoUtils-287337e4.js","./drapedUtils-2204a7de.js"],import.meta.url));return _(r)?r:new r.module.default({enableMoveAllGraphics:o,highlightsEnabled:!!i?.enabled,indicatorsEnabled:!1,graphics:e,view:a,callbacks:{onGraphicMoveStart:({dx:l,dy:s,graphic:p})=>{this._displayGrabbingCursor(),this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{dx:l,dy:s,mover:p,type:"move-start"},type:"update"})},onGraphicMove:({dx:l,dy:s,graphic:p})=>this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{dx:l,dy:s,mover:p,type:"move"},type:"update"}),onGraphicMoveStop:({dx:l,dy:s,graphic:p})=>{this._displayPointerCursor(),this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{dx:l,dy:s,mover:p,type:"move-stop"},type:"update"})},onGraphicPointerOver:()=>this._displayPointerCursor(),onGraphicPointerOut:()=>this._displayDefaultCursor()}})}async _getBox(e,t,a){const{enableRotation:o,enableScaling:i,highlightOptions:r,preserveAspectRatio:l}=t,s=await this._requireModule(G(()=>import("./Box-56959072.js"),["./Box-56959072.js","./main-79e5ed80.js","./main-7772480e.css","./getDefaultUnitForView-33179f7a.js","./unitFormatUtils-b50d8ff8.js","./drawUtils-f091ac1a.js","./GraphicMover-8a00d1d0.js","./GraphicsLayer-6532b5a8.js","./GraphicManipulator-f9349a2c.js","./elevationInfoUtils-287337e4.js","./drapedUtils-2204a7de.js","./settings-e9a73c67.js","./ExtentTooltipInfos-92f53513.js","./automaticLengthMeasurementUtils-dacc4f51.js","./euclideanLengthMeasurementUtils-8f8f7aa9.js","./measurementUtils-c24c5920.js","./geometryEngine-547e4a01.js","./geometryEngineBase-d69ff1ad.js","./hydrated-e6cbef23.js","./geodesicUtils-04ddd9a4.js","./TranslateTooltipInfos-b9e3d07e.js","./SnappingManager-e561e372.js","./geometry2dUtils-9d16f4f8.js","./viewUtils-ca2c33e3.js"],import.meta.url));return _(s)?s:new s.module.default({graphics:e,enableRotation:o,enableScaling:i,highlightsEnabled:!!r?.enabled,preserveAspectRatio:l,layer:this._internalGraphicsLayer,view:a,tooltipOptions:this.tooltipOptions,callbacks:{onMoveStart:p=>this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{...p},type:"update"}),onMove:p=>this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{...p},type:"update"}),onMoveStop:p=>this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{...p},type:"update"}),onScaleStart:p=>this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{...p},type:"update"}),onScale:p=>this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{...p},type:"update"}),onScaleStop:p=>this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{...p},type:"update"}),onRotateStart:p=>this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{...p},type:"update"}),onRotate:p=>this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{...p},type:"update"}),onRotateStop:p=>this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{...p},type:"update"})}})}async _getReshape(e,t,a){const o=t.reshapeOptions?.edgeOperation==="split",i=t.reshapeOptions?.shapeOperation==="move",r=!!t.highlightOptions?.enabled,l=await this._requireModule(G(()=>import("./Reshape-87338a65.js"),["./Reshape-87338a65.js","./main-79e5ed80.js","./main-7772480e.css","./getDefaultUnitForView-33179f7a.js","./unitFormatUtils-b50d8ff8.js","./GraphicsLayer-6532b5a8.js","./SnappingVisualizer2D-38632613.js","./settings-e9a73c67.js","./SnappingManager-e561e372.js","./elevationInfoUtils-287337e4.js","./geometry2dUtils-9d16f4f8.js","./viewUtils-ca2c33e3.js","./SnappingContext-d538137b.js","./PointSnappingHint-b8c54ed3.js","./drawUtils-f091ac1a.js","./GraphicMover-8a00d1d0.js","./GraphicManipulator-f9349a2c.js","./drapedUtils-2204a7de.js","./EditGeometryOperations-73b5f5f7.js","./automaticLengthMeasurementUtils-dacc4f51.js","./euclideanLengthMeasurementUtils-8f8f7aa9.js","./measurementUtils-c24c5920.js","./geometryEngine-547e4a01.js","./geometryEngineBase-d69ff1ad.js","./hydrated-e6cbef23.js","./geodesicUtils-04ddd9a4.js","./TranslateTooltipInfos-b9e3d07e.js","./automaticAreaMeasurementUtils-9241464c.js","./euclideanAreaMeasurementUtils-00f3f32f.js"],import.meta.url));return _(l)?l:new l.module.default({enableMidpoints:o,enableMovement:i,graphic:e[0],highlightsEnabled:r,layer:this._internalGraphicsLayer,snappingManager:this._snappingManager,tooltipOptions:this.tooltipOptions,view:a,callbacks:{onReshapeStart:s=>this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{...s},type:"update"}),onReshape:s=>this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{...s},type:"update"}),onReshapeStop:({mover:s,type:p})=>this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{mover:s,type:p},type:"update"}),onMoveStart:({dx:s,dy:p,mover:n,type:h})=>this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{dx:s,dy:p,mover:n,type:h},type:"update"}),onMove:({dx:s,dy:p,mover:n,type:h})=>this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{dx:s,dy:p,mover:n,type:h},type:"update"}),onMoveStop:({dx:s,dy:p,mover:n,type:h})=>this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{dx:s,dy:p,mover:n,type:h},type:"update"}),onVertexAdd:({added:s,type:p,vertices:n})=>{const h=s.map(u=>ee(u.geometry));this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{added:h,vertices:n,type:p},type:"update"})},onVertexRemove:({removed:s,type:p,vertices:n})=>{const h=s.map(u=>ee(u.geometry));this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{removed:h,vertices:n,type:p},type:"update"})}}})}_getHandlesForComponent(e,t){const a=e.activeComponent;if(!a)return[];switch(a.type){case"graphic-mover":return[a.on("graphic-click",({graphic:o,viewEvent:i})=>{i.native?.shiftKey&&(i.stopPropagation(),e.removeFromSelection(o))}),a.on("graphic-move-start",o=>e.addToHistory(T(o.allGraphics)))];case"box":return[a.on("graphic-click",o=>this._onTransformOrReshape2DGraphicClick(e,t,o)),a.on("move-start",o=>e.addToHistory(T(o.graphics))),a.on("rotate-start",o=>e.addToHistory(T(o.graphics))),a.on("scale-start",o=>e.addToHistory(T(o.graphics)))];case"reshape":return[a.on("graphic-click",o=>this._onTransformOrReshape2DGraphicClick(e,t,o)),a.on("move-start",o=>e.addToHistory(T([o.mover]))),a.on("reshape-start",o=>e.addToHistory(T([o.graphic]))),a.on("vertex-add",o=>e.addToHistory(T([o.oldGraphic]))),a.on("vertex-remove",o=>e.addToHistory(T([o.oldGraphic])))];case"move-3d":return[a.on("graphic-move-start",o=>{e.addToHistory(T(o.allGraphics)),this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{dx:0,dy:0,mover:o.allGraphics.length>0?o.allGraphics[0]:null,type:"move-start"},type:"update"})}),a.on("graphic-move",o=>{this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{dx:o.dx,dy:o.dy,mover:o.allGraphics.length>0?o.allGraphics[0]:null,type:"move"},type:"update"})}),a.on("graphic-move-stop",o=>{this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{dx:0,dy:0,mover:o.allGraphics.length>0?o.allGraphics[0]:null,type:"move-stop"},type:"update"})}),a.on("immediate-click",o=>{o.shiftKey?this._toggleSelection([o.graphic],e,t):e.toggleTool()})];case"transform-3d":return[a.on("record-undo",({record:o})=>{e.addToHistory({updates:[o]})}),a.on("graphic-translate-start",o=>{this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{mover:o.graphic,dx:o.dxScreen,dy:o.dyScreen,type:"move-start"},type:"update"})}),a.on("graphic-translate-stop",o=>{this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{mover:o.graphic,dx:o.dxScreen,dy:o.dyScreen,type:"move-stop"},type:"update"})}),a.on("graphic-rotate-start",o=>{this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{mover:o.graphic,angle:o.angle,type:"rotate-start"},type:"update"})}),a.on("graphic-rotate-stop",o=>{this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{mover:o.graphic,angle:o.angle,type:"rotate-stop"},type:"update"})}),a.on("graphic-scale-start",o=>{this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{mover:o.graphic,xScale:o.xScale,yScale:o.yScale,type:"scale-start"},type:"update"})}),a.on("graphic-scale-stop",o=>{this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{mover:o.graphic,xScale:o.xScale,yScale:o.yScale,type:"scale-stop"},type:"update"})}),a.on("graphic-translate",o=>{this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{mover:o.graphic,dx:o.dxScreen,dy:o.dyScreen,type:"move"},type:"update"})}),a.on("graphic-rotate",o=>{this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{mover:o.graphic,angle:o.angle,type:"rotate"},type:"update"})}),a.on("graphic-scale",o=>{this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{mover:o.graphic,xScale:o.xScale,yScale:o.yScale,type:"scale"},type:"update"})}),a.on("immediate-click",o=>{o.shiftKey?this._toggleSelection([o.graphic],e,t):e.toggleTool()})];case"reshape-3d":return[a.on("reshape",o=>{this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:o,type:"update"})}),a.on("move",o=>{this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:o,type:"update"})}),a.on("vertex-add",o=>{this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:o,type:"update"})}),a.on("vertex-remove",o=>{this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:o,type:"update"})}),a.on("immediate-click",o=>{o.shiftKey?this._toggleSelection([o.graphic],e,t):e.toggleTool()})]}}_onTransformOrReshape2DGraphicClick(e,t,a){const{graphic:o,viewEvent:i}=a;return i.native?.shiftKey&&o.layer===this.layer?(i.stopPropagation(),e.removeFromSelection(o)):t.toggleToolOnClick?(i.stopPropagation(),e.toggleTool()):void 0}_setUpdateOperationHandle(e,t){this._operationHandle=e;const a=this.view?.map;this._disablePopup(t);const o=()=>{if(e===this._operationHandle){const i=this.updateGraphics.toArray(),r=this._operationHandle.tool;this._operationHandle.destroy(),this._operationHandle=null,this._internalGraphicsLayer.removeMany(this.updateGraphics.toArray()),this.updateGraphics.removeAll(),a&&a.remove(this._internalGraphicsLayer),this._restorePopup(t),this.emit("update",{graphics:i,state:"complete",aborted:e.cancelled,tool:r,toolEventInfo:null,type:"update"})}};e.on("complete",o)}async _getCommonUpdateOperationClickHandlers(e,t,a){const o=Q(t),i=await t.async(()=>this._getFirstHit(o));if(i==null)return void e.complete();if(t.native.shiftKey&&this._toggleSelection([i.graphic],e,a))return void t.stopPropagation();this.updateGraphics.includes(i.graphic)?t.stopPropagation():e.complete()}_toggleSelection(e,t,a){const o=!!a.multipleSelectionEnabled;return e.some(i=>i!=null&&!(!o||i.layer!==this.layer)&&(this.updateGraphics.includes(i)?t.removeFromSelection(i):t.addToSelection(i),!0))}_getCommonUpdateOperationKeyDownHandlers(e,t){if(!e)return;const a=t.key;a===v.undo&&e.canUndo()?(t.stopPropagation(),e.undo()):a===v.redo&&e.canRedo()?(t.stopPropagation(),e.redo()):a===v.cancel?(t.stopPropagation(),e.cancel()):this.allowDeleteKey&&v.delete.includes(a)&&this._onDeleteKey(t)}_onDeleteKey(e){if(!this._operationHandle||this._operationHandle.type!=="update")return;const t=this.activeComponent,a=this.updateGraphics.toArray();t!=null&&t.type!=="reshape-3d"&&(t.type!=="reshape"||a.length===1&&a[0].geometry?.type==="point")&&(e.stopPropagation(),this.delete())}_removeDefaultLayer(){this._internalGraphicsLayer&&(this.view?.map?.remove(this._internalGraphicsLayer),this._internalGraphicsLayer=C(this._internalGraphicsLayer))}_isComponentGraphic(e){const{activeComponent:t}=this;return!(!e||t==null)&&(e.attributes&&e.attributes.esriSketchTool||t.type==="draw-2d"&&t.graphic===e||(t.type==="box"||t.type==="reshape")&&t.isUIGraphic(e))}_displayPointerCursor(){this.view&&this.view.container&&this.view.cursor!=="pointer"&&(this.view.cursor="pointer")}_displayGrabbingCursor(){this.view&&this.view.container&&this.view.cursor!=="grabbing"&&(this.view.cursor="grabbing")}_displayDefaultCursor(){this.view&&this.view.container&&this.view.cursor!==null&&(this.view.cursor=null)}_logError(e,t,a){Ce.getLogger(this).error(new Me(e,t,a))}async _requireModule(e){const t=new AbortController;this._moduleLoaderAbortController=t;const a=await e;return this._moduleLoaderAbortController!==t||t.signal.aborted?{requireError:"aborted"}:{module:a}}_emitUndoEvent(e){this.emit("undo",{...e,type:"undo"})}_emitRedoEvent(e){this.emit("redo",{...e,type:"redo"})}_emitDeleteEvent(e){this.emit("delete",{...e,type:"delete"})}get test(){return{operationHandle:this._operationHandle,defaultUpdateOptions:M}}wait(){return te(()=>!this.updating)}_beginAsyncOperation(){this._numUpdating+=1,this.notifyChange("updating")}_endAsyncOperation(){this._numUpdating-=1,this.notifyChange("updating")}_disablePopupEnabled(e){return this.view?.type!=="3d"||this.updateOnGraphicClick||(e?.toggleToolOnClick??!1)}_disablePopup(e){this._disablePopupEnabled(e)&&this.view&&this._originalPopupEnabled==null&&(this._originalPopupEnabled=this.view.popupEnabled,this.view.popupEnabled=!1)}_restorePopup(e){this._disablePopupEnabled(e)&&this.view&&this._originalPopupEnabled!=null&&(this.view.popupEnabled=this._originalPopupEnabled,this._originalPopupEnabled=null)}async _waitViewReady(){const e=this.view;e?(F(this._viewReadyAbortController),this._viewReadyAbortController=new AbortController,await Ie(te(()=>e?.ready),this._viewReadyAbortController.signal)):this._logMissingView()}_logMissingView(){this._logError("sketch:missing-property",ie("view"))}_logMissingLayer(){this._logError(Ve,ie("layer"))}};c([d()],m.prototype,"updating",null),c([d()],m.prototype,"_operationHandle",void 0),c([d({readOnly:!0})],m.prototype,"activeTool",null),c([d()],m.prototype,"activeFillSymbol",void 0),c([d()],m.prototype,"activeLineSymbol",void 0),c([d()],m.prototype,"activeVertexSymbol",void 0),c([d()],m.prototype,"allowDeleteKey",void 0),c([d({readOnly:!0})],m.prototype,"createGraphic",null),c([d()],m.prototype,"defaultCreateOptions",null),c([d()],m.prototype,"defaultUpdateOptions",null),c([d({type:le,nonNullable:!0})],m.prototype,"labelOptions",void 0),c([d()],m.prototype,"layer",void 0),c([d({types:k})],m.prototype,"pointSymbol",void 0),c([d({types:k})],m.prototype,"polygonSymbol",void 0),c([d({types:k})],m.prototype,"polylineSymbol",void 0),c([d()],m.prototype,"meshSymbol",void 0),c([d({type:ne,nonNullable:!0})],m.prototype,"snappingOptions",null),c([d()],m.prototype,"_snappingManager",void 0),c([d({readOnly:!0})],m.prototype,"state",null),c([d({type:he,nonNullable:!0})],m.prototype,"tooltipOptions",void 0),c([d({readOnly:!0})],m.prototype,"updateGraphics",void 0),c([d()],m.prototype,"updateOnGraphicClick",void 0),c([d({types:k})],m.prototype,"vertexSymbol",void 0),c([d({value:null})],m.prototype,"view",null),m=c([S("esri.widgets.Sketch.SketchViewModel")],m);const Ve="sketch:missing-property",ie=e=>`Property '${e}' is missing on SketchViewModel.`;function $e(e){return e==="polygon"||e==="rectangle"||e==="circle"}function x(e,t){ce("undo",e.history.undo,e.history.redo,t)}function L(e,t){ce("redo",e.history.redo,e.history.undo,t)}function ce(e,t,a,o){const i=t.pop();if(!i)return;const r=i.updates,l=[];o.forEach((s,p)=>{const n=r[p];n!=null&&("geometry"in n&&n.geometry!=null&&(l.push({geometry:s.geometry}),s.geometry=n.geometry),"symbol"in n&&n.symbol!=null&&(l.push({symbol:s.symbol}),s.symbol=n.symbol),"undo"in n&&(l.push(n),n[e](s)))}),a.push({updates:l})}function T(e){return{updates:e.map(t=>({geometry:t.geometry}))}}function _(e){return"requireError"in e&&e.requireError==="aborted"}const Je=m;export{y as P,Je as a,le as c,Ke as e,Ze as l,Le as m,H as n,xe as o,he as p,oe as r};
