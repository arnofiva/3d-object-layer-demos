import{np as E,az as d,bS as I,nq as x,nr as C,bd as f,ns as $,b3 as V,nt as p,nu as B,dB as M}from"./index-cdda5707.js";const N=/^-?(\d+)(\.(\d+))?$/i;function O(t,n){return t-n}function R(t,n){let e,o;return e=Number(t.toFixed(n)),e<t?o=e+1/10**n:(o=e,e-=1/10**n),e=Number(e.toFixed(n)),o=Number(o.toFixed(n)),[e,o]}function S(t,n,e,o,a){const l=U(t,n,e,o),i=l.previous==null||l.previous<=a,r=l.next==null||l.next<=a;return i&&r||l.previous+l.next<=2*a}function v(t){const n=String(t),e=n.match(N);if(e&&e[1])return{integer:e[1].split("").length,fractional:e[3]?e[3].split("").length:0};if(n.toLowerCase().includes("e")){const o=n.split("e"),a=o[0],l=o[1];if(a&&l){const i=Number(a);let r=Number(l);const c=r>0;c||(r=Math.abs(r));const s=v(i);return c?(s.integer+=r,r>s.fractional?s.fractional=0:s.fractional-=r):(s.fractional+=r,r>s.integer?s.integer=1:s.integer-=r),s}}return{integer:0,fractional:0}}function U(t,n,e,o){const a={previous:null,next:null};if(e!=null){const l=t-e,i=n-e-l;a.previous=Math.floor(Math.abs(100*i/l))}if(o!=null){const l=o-t,i=o-n-l;a.next=Math.floor(Math.abs(100*i/l))}return a}function T(t,n={}){const e=t.slice(0),{tolerance:o=2,strictBounds:a=!1,indexes:l=e.map((i,r)=>r)}=n;l.sort(O);for(let i=0;i<l.length;i++){const r=l[i],c=e[r],s=r===0?null:e[r-1],A=r===e.length-1?null:e[r+1],m=v(c).fractional;if(m){let g,h=0,w=!1;for(;h<=m&&!w;){const b=R(c,h);g=a&&i===0?b[1]:b[0],w=S(c,g,s,A,o),h++}w&&(e[r]=g)}}return e}const _={maximumFractionDigits:20};function q(t){return E(t,_)}const Q="<",k=">",j=C("short-date");function K(t,n,e,o){let a="";n===0?a=`${Q} `:n===e&&(a=`${k} `);let l=null;return l=o?x(t,j):q(t),a+l}const X=["data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAUCAYAAACNiR0NAAAACXBIWXMAAAAAAAAAAAHqZRakAAAANUlEQVQ4jWPMy8v7z0BFwMLAwMAwcdIkqhiWn5fHwEQVk5DAqIGjBo4aOGrgqIEQwEjtKgAATl0Hu6JrzFUAAAAASUVORK5CYII=","data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAUCAYAAACNiR0NAAAACXBIWXMAAAAAAAAAAAHqZRakAAAANUlEQVQ4jWPMy8v7z0BFwMLAwMAwaeIkqhiWl5/HwEQVk5DAqIGjBo4aOGrgqIEQwEjtKgAATl0Hu6sKxboAAAAASUVORK5CYII=","data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAUCAYAAACNiR0NAAAACXBIWXMAAAAAAAAAAAHqZRakAAAANUlEQVQ4jWPMy8v7z0BFwMLAwMAwadJEqhiWl5fPwEQVk5DAqIGjBo4aOGrgqIEQwEjtKgAATl0Hu75+IUcAAAAASUVORK5CYII="];async function L(t){if(!("visualVariables"in t)||!t.visualVariables)return null;const n=t.visualVariables.find(i=>i.type==="color");if(!n)return null;let e=null,o=null;if(n.stops){if(n.stops.length===1)return n.stops[0].color;e=n.stops[0].value,o=n.stops[n.stops.length-1].value}const a=e!=null&&o!=null?e+(o-e)/2:0,{getColor:l}=await d(()=>import("./index-cdda5707.js").then(i=>i.zg),["./index-cdda5707.js","./index-7772480e.css"],import.meta.url);return l(n,a)??null}async function Y(t,n){const e=t.trailCap,o=t.trailWidth||1,a=n||await L(t)||t.color;return new I({cap:e,color:a,width:o})}function J(t){return t!=null&&typeof t=="object"&&"min"in t&&"max"in t}const W=new f([64,64,64]);function y(t,n){const e=[],o=t.length-1;return t.length===5?e.push(0,2,4):e.push(0,o),t.map((a,l)=>e.includes(l)?K(a,l,o,n):null)}async function F(t,n,e){let o=!1,a=[],l=[];if(t.stops){const s=t.stops;a=s.map(A=>A.value),o=s.some(A=>!!A.label),o&&(l=s.map(A=>A.label))}const i=a[0],r=a[a.length-1];if(i==null&&r==null)return null;const c=o?null:y(a,e??!1);return(await Promise.all(a.map(async(s,A)=>({value:s,color:t.type==="opacity"?await G(s,t,n):(await d(()=>import("./index-cdda5707.js").then(m=>m.zg),["./index-cdda5707.js","./index-7772480e.css"],import.meta.url)).getColor(t,s),label:o?l[A]:c?.[A]??""})))).reverse()}async function G(t,n,e){const o=new f(e??W),a=(await d(()=>import("./index-cdda5707.js").then(l=>l.zg),["./index-cdda5707.js","./index-7772480e.css"],import.meta.url)).getOpacity(n,t);return a!=null&&(o.a=a),o}function Z(t){let n=!1,e=[],o=[];e=t.map(r=>r.value),n=t.some(r=>!!r.label),n&&(o=t.map(r=>r.label??""));const a=e[0],l=e[e.length-1];if(a==null&&l==null)return null;const i=n?null:y(e,!1);return e.map((r,c)=>({value:r,color:P(r,t),label:n?o[c]:i?.[c]??""})).reverse()}function P(t,n){const{startIndex:e,endIndex:o,weight:a}=z(t,n);if(e===o)return n[e].color;const l=f.blendColors(n[e].color,n[o].color,a);return new f(l)}function z(t,n){let e=0,o=n.length-1;return n.some((a,l)=>t<a.value?(o=l,!0):(e=l,!1)),{startIndex:e,endIndex:o,weight:(t-n[e].value)/(n[o].value-n[e].value)}}function tt(t,n){let e=[];if(t&&t.type==="multipart")t.colorRamps.reverse().forEach((o,a)=>{a===0?e.push({value:n.max,color:new f(o.toColor),label:"high"}):e.push({value:null,color:new f(o.toColor),label:""}),a===t.colorRamps.length-1?e.push({value:n.min,color:new f(o.fromColor),label:"low"}):e.push({value:null,color:new f(o.fromColor),label:""})});else{let o,a;t&&t.type==="algorithmic"?(o=t.fromColor,a=t.toColor):(o=[0,0,0,1],a=[255,255,255,1]),e=[{value:n.max,color:new f(a),label:"high"},{value:n.min,color:new f(o),label:"low"}]}return e}function H(t){if(!t.colorStops)return[];const n=[...t.colorStops].filter(o=>o.color?.a>0);let e=n.length-1;if(n&&n[0]){const o=n[e];o&&o.ratio!==1&&(n.push(new $({ratio:1,color:o.color})),e++)}return n.map((o,a)=>{let l="";return a===0?l=t.legendOptions?.minLabel||"low":a===e&&(l=t.legendOptions?.maxLabel||"high"),{color:o.color,label:l,ratio:o.ratio}}).reverse()}V.getLogger("esri.renderers.support.utils");async function u(t,n,e){M(t,n,()=>[]).push(...e)}async function et(t){const n=new Map;if(!t)return n;if("visualVariables"in t&&t.visualVariables){const e=t.visualVariables.filter(o=>o.type==="color");for(const o of e){const a=(await F(o)??[]).map(l=>l.color);await u(n,o.field||o.valueExpression,a)}}if(t.type==="heatmap"){const e=H(t).map(o=>o.color);await u(n,t.field||t.valueExpression,e)}else if(t.type==="pie-chart"){for(const e of t.attributes)await u(n,e.field||e.valueExpression,[e.color]);await u(n,"default",[t?.othersCategory?.color,p(t.backgroundFillSymbol,null)])}else if(t.type==="dot-density"){for(const e of t.attributes)await u(n,e.field||e.valueExpression,[e.color]);await u(n,"default",[t.backgroundColor])}else if(t.type==="unique-value")if(t.authoringInfo?.type==="predominance")for(const e of t.uniqueValueInfos??[])await u(n,e.value.toString(),[p(e.symbol,null)]);else{const e=(t.uniqueValueInfos??[]).map(r=>p(r.symbol,null)),{field:o,field2:a,field3:l,valueExpression:i}=t;(o||i)&&await u(n,o||i,e),a&&await u(n,a,e),l&&await u(n,l,e)}else if(t.type==="class-breaks"){const e=t.classBreakInfos.map(l=>p(l.symbol,null)),{field:o,valueExpression:a}=t;await u(n,o??a,e)}else t.type==="simple"&&await u(n,"default",[p(t.symbol,null)]);return"defaultSymbol"in t&&t.defaultSymbol&&await u(n,"default",[p(t.defaultSymbol,null)]),n.forEach((e,o)=>{const a=B(e.filter(Boolean),(l,i)=>JSON.stringify(l)===JSON.stringify(i));n.set(o,a)}),n}export{Y as a,Q as b,P as c,Z as d,tt as e,L as f,F as g,et as h,v as i,U as l,K as n,k as o,J as p,H as r,X as s,T as u};
