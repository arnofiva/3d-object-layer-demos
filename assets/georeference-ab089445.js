import{cd as B,h7 as x,h8 as m,h9 as F,ha as C,hb as N,hc as h,d5 as W,g6 as v,dl as b,dm as E,hd as d,he as L,b_ as O,bO as Z,hf as S,hg as k,hh as y,hi as D,hj as H,bZ as I,hk as J,hl as K,hm as Q,hn as X,ho as Y,b1 as U,hp as V,hq as nn,hr as en}from"./main-79e5ed80.js";import{m as tn}from"./MeshGeoreferencedRelativeVertexSpace-4cbafb45.js";import{m as rn,p as on}from"./MeshLocalVertexSpace-0353b8cf.js";import{N as an}from"./MeshTransform-d557c89a.js";function T(n,t){return n.isGeographic||n.isWebMercator&&(t?.geographic??!0)}function bn(n,t,e){const r=!n.isGeoreferenced;e?.geographic!=null&&e.geographic!==r&&B.getLogger(t).warnOnce(`Specifying the 'geographic' parameter (${e.geographic}) for a Mesh vertex space of type "${n.type}" is not supported. This parameter will be ignored.`)}function A(n,t,e){return T(t.spatialReference,e)?fn(n,t,e):un(n,t,e)}function _(n,t,e,r){const{position:a,normal:o,tangent:i}=n;if(!t.isRelative)return{position:a,normal:o,tangent:i};const s=e?.localMatrix??m;return A({position:h(new Float64Array(a.length),a,s),normal:o!=null?nn(o,new Float32Array(o.length),s):null,tangent:i!=null?en(i,new Float32Array(i.length),s):null},t.getOriginPoint(r),{geographic:!t.isGeoreferenced})}function ln(n,t,e){if(e?.useTransform){const{position:r,normal:a,tangent:o}=n,{x:i,y:s,z:c}=t,l=Z(i,s,c??0);return{vertexAttributes:{position:r,normal:a,tangent:o},vertexSpace:e.geographic??1?new rn({origin:l}):new tn({origin:l}),transform:new an}}return{vertexAttributes:A(n,t,e),vertexSpace:new on,transform:null}}function w(n,t,e){return T(t.spatialReference,e)?mn(n,t,e):j(n,t,e)}function sn(n,t,e,r,a){if(!t.isRelative)return w(n,r,a);const{spatialReference:o}=r,i=_(n,t,e,o);return r.equals(t.getOriginPoint(o))?j(i,r,a):w(i,r,a)}function cn({positions:n,transform:t,vertexSpace:e,inSpatialReference:r,outSpatialReference:a,outPositions:o,local:i}){const s=e.isRelative?e.origin:x,c=e.isRelative?t?.localMatrix??m:m;if(e.isGeoreferenced){const u=o??F(n.length);if(C(c,m)?N(u,n):h(u,n,c),!W(s,x)){const[G,P,q]=s;for(let p=0;p<u.length;p+=3)u[p]+=G,u[p+1]+=P,u[p+2]+=q}return v(u,r,0,u,a,0,u.length/3),u}const l=b(r),$=!i&&E(r,l)?l:r;d(r,s,f,$),L(f,f,c);const g=o??F(n.length);return h(g,n,f),v(g,$,0,g,a,0,g.length/3),g}function un(n,t,e){const r=new Float64Array(n.position.length),a=n.position,o=t.x,i=t.y,s=t.z??0,c=R(e?e.unit:null,t.spatialReference);for(let l=0;l<a.length;l+=3)r[l]=a[l]*c+o,r[l+1]=a[l+1]*c+i,r[l+2]=a[l+2]*c+s;return{position:r,normal:n.normal,tangent:n.tangent}}function fn(n,t,e){const r=t.spatialReference,a=z(t,e,f),o=new Float64Array(n.position.length),i=gn(n.position,a,r,o),s=S(M,a);return{position:i,normal:pn(i,o,n.normal,s,r),tangent:hn(i,o,n.tangent,s,r)}}function gn(n,t,e,r){h(r,n,t);const a=new Float64Array(n.length);return k(r,a,e)}function pn(n,t,e,r,a){if(e==null)return null;const o=new Float32Array(e.length);return y(o,e,r),D(o,n,t,a,o),o}function hn(n,t,e,r,a){if(e==null)return null;const o=new Float32Array(e.length);y(o,e,r,4);for(let i=3;i<o.length;i+=4)o[i]=e[i];return H(o,n,t,a,o),o}function j(n,t,e){const r=new Float64Array(n.position.length),a=n.position,o=t.x,i=t.y,s=t.z??0,c=R(e?e.unit:null,t.spatialReference);for(let l=0;l<a.length;l+=3)r[l]=(a[l]-o)/c,r[l+1]=(a[l+1]-i)/c,r[l+2]=(a[l+2]-s)/c;return{position:r,normal:n.normal,tangent:n.tangent}}function mn(n,t,e){const r=t.spatialReference;z(t,e,f);const a=I(Rn,f),o=new Float64Array(n.position.length),i=yn(n.position,r,a,o),s=S(M,a);return{position:i,normal:wn(n.normal,n.position,o,r,s),tangent:An(n.tangent,n.position,o,r,s)}}function z(n,t,e){d(n.spatialReference,[n.x,n.y,n.z??0],e,b(n.spatialReference));const r=R(t?t.unit:null,n.spatialReference);return J(e,e,[r,r,r]),e}function yn(n,t,e,r){const a=K(n,t,r),o=new Float64Array(a.length);return h(o,a,e),o}function wn(n,t,e,r,a){if(n==null)return null;const o=Q(n,t,e,r,new Float32Array(n.length));return y(o,o,a),o}function An(n,t,e,r,a){if(n==null)return null;const o=X(n,t,e,r,new Float32Array(n.length));return y(o,o,a,4),o}function R(n,t){if(n==null)return 1;const e=Y(t);return 1/U(e,"meters",n)}const f=O(),Rn=O(),M=V(),dn=Object.freeze(Object.defineProperty({__proto__:null,georeference:A,georeferenceApplyTransform:_,georeferenceByTransform:ln,project:cn,ungeoreference:w,ungeoreferenceByTransform:sn},Symbol.toStringTag,{value:"Module"}));export{w as D,sn as E,cn as I,A as O,_ as T,dn as g,bn as o,ln as q,T as r};
