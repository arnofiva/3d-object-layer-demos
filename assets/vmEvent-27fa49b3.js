import{cd as B,a$ as d,lT as p,cc as Z,lU as J,lV as K,lW as _,lX as j,lY as L,hG as W,lZ as h,l_ as X,l$ as ee,a_ as te,m0 as ne,m1 as m,cD as re,m2 as ae,m3 as b,m4 as ie,m5 as oe,m6 as se,m7 as $,m8 as le,m9 as ue,ma as fe,b2 as ce}from"./main-79e5ed80.js";const de="esri.widgets.Feature.support.featureUtils",I=B.getLogger(de),pe=/href=(""|'')/gi,me=/(\{([^\{\r\n]+)\})/g,ye=/\'/g,D=/^\s*expression\//i,ge=/(\n)/gi,he=/[\u00A0-\u9999<>\&]/gim,be=/href\s*=\s*(?:\"([^\"]+)\"|\'([^\']+)\')/gi,$e=/^(?:mailto:|tel:)/,q="relationships/",F=K("short-date-short-time");function Ke(e){if(e!=null)return e.get("sourceLayer")||e.get("layer")}async function We(e,t){return typeof e=="function"?e(t):e}function Xe(e=""){if(e)return!$e.test(e.trim().toLowerCase())}function Ie(e){return!!e&&D.test(e)}function Fe(e,t){if(!Ie(t)||!e)return null;const n=t.replace(D,"").toLowerCase();let r=null;return e.some(a=>a.name.toLowerCase()===n&&(r=a,!0)),r}function et(e,t){const n=Fe(t,e?.fieldName);return n?n.title||null:e?e.label||e.fieldName:null}function Ee(e,t){const n=t.get(e.toLowerCase());return`{${n&&n.fieldName||e}}`}function Te(e){return e.replaceAll(pe,"")}function M(e,t){const n=g(t,e);return n?n.name:e}function tt(e,t){return e&&e.map(n=>M(n,t))}function g(e,t){return e&&typeof e.getField=="function"&&t?e.getField(t)??null:null}function U(e){return`${e}`.trim()}function nt({attributes:e,globalAttributes:t,layer:n,text:r,expressionAttributes:a,fieldInfoMap:i}){return r?Ne({formattedAttributes:t,template:Oe(r,{...t,...a,...e},n),fieldInfoMap:i}):""}function Ne({formattedAttributes:e,template:t,fieldInfoMap:n}){return U(Te(d(d(t,r=>Ee(r,n)),e)))}function we(e,t,n=!1){const r=t[e];if(typeof r=="string"){const a="%27",i=(n?encodeURIComponent(r):r).replaceAll(ye,a);t[e]=i}}function ve(e,t=!1){const n={...e};return Object.keys(n).forEach(r=>we(r,n,t)),n}function xe(e,t,n){const r=(t=U(t))&&t[0]!=="{";return d(e,ve(n,r||!1))}function Ae(e,t){return e.replaceAll(me,(n,r,a)=>{const i=g(t,a);return i?`{${i.name}}`:r})}function Oe(e,t,n){const r=Ae(e,n);return r&&r.replaceAll(be,(a,i,o)=>xe(a,i||o,t))}function Ce(e,t){if(typeof e=="string"&&t&&t.dateFormat==null&&(t.places!=null||t.digitSeparator!=null)){const n=Number(e);if(!isNaN(n))return n}return e}function E(e){return e!=null&&typeof e=="object"&&"layer"in e&&!!e.layer}function Re(e){return e!=null&&typeof e=="object"&&"type"in e&&e.type==="map-image"}function _e(e){return e!=null&&typeof e=="object"&&"fieldsIndex"in e&&"geometryType"in e&&"getField"in e&&"load"in e&&"loaded"in e&&"objectIdField"in e&&"spatialReference"in e&&"type"in e&&e.type==="feature"&&"when"in e}function je(e){return e!=null&&typeof e=="object"&&"createQuery"in e&&"queryFeatureCount"in e&&"queryObjectIds"in e&&"queryRelatedFeatures"in e&&"queryRelatedFeaturesCount"in e&&"relationships"in e}function S(e){return _e(e)&&je(e)}function rt(e){return!!e&&typeof e=="object"&&"sourceLayer"in e&&S(e.sourceLayer)}function Le(e,t){const{fieldInfos:n,fieldName:r,preventPlacesFormatting:a,layer:i}=t,o=De(n,r),s=o?.clone(),l=g(i,r);if(s&&!h(r)){const c=l?.type;if(c==="date"||c==="date-only"||c==="time-only"||c==="timestamp-offset"||s.format?.dateFormat){const f=s.format??new X;if(f.dateFormat??(f.dateFormat=c==="date-only"?"short-date":"short-date-short-time"),typeof e=="number"){const z=!E(i)&&ee(i)&&i.datesInUnknownTimezone||E(i)&&Re(i.layer)&&i.layer.datesInUnknownTimezone;return f.formatDate(e,z)}switch(c){case"date-only":return f.formatDateOnly(e);case"time-only":return f.formatTimeOnly(e);case"timestamp-offset":return f.formatTimestamp(e)}}}const u=s?.format;return typeof e=="string"&&h(r)&&u?u.formatRasterPixelValue(e):typeof(e=Ce(e,u))=="string"||e==null||u==null?G(e):a?te(e,{...ne(u),minimumFractionDigits:0,maximumFractionDigits:20}):u.formatNumber(e)}function De(e,t){if(e&&e.length&&t)return e.find(n=>n.fieldName?.toLowerCase()===t.toLowerCase())}function qe({fieldName:e,graphic:t,layer:n}){if(V(e)||!n||typeof n.getFeatureType!="function")return null;const{typeIdField:r}=n;if(!r||e!==r)return null;const a=n.getFeatureType(t);return a?a.name:null}function Me({fieldName:e,value:t,graphic:n,layer:r}){if(V(e)||!r||typeof r.getFieldDomain!="function")return null;const a=n&&r.getFieldDomain(e,{feature:n});return a&&a.type==="coded-value"?a.getName(t):null}function at(e,t){const{creatorField:n,creationDateField:r,editorField:a,editDateField:i}=e;if(!t)return;const o=t[i];if(typeof o=="number"){const l=t[a];return{type:"edit",date:p(o,F),user:l}}const s=t[r];if(typeof s=="number"){const l=t[n];return{type:"create",date:p(s,F),user:l}}return null}function it(e,t){const n=new Map;return e&&e.forEach(r=>{const a=M(r.fieldName,t);r.fieldName=a,n.set(a.toLowerCase(),r)}),n}function ot(e){const t=[];if(!e)return t;const{fieldInfos:n,content:r}=e;return n&&t.push(...n),r&&Array.isArray(r)&&r.forEach(a=>{if(a.type==="fields"){const i=a&&a.fieldInfos;i&&t.push(...i)}}),t}function st(e){return e.replaceAll(he,t=>`&#${t.charCodeAt(0)};`)}function G(e){return typeof e=="string"?e.replaceAll(ge,'<br class="esri-text-new-line" />'):e}function P(e){const{value:t,fieldName:n,fieldInfos:r,fieldInfoMap:a,layer:i,graphic:o}=e;if(t==null)return"";const s=Me({fieldName:n,value:t,graphic:o,layer:i});if(s)return s;const l=qe({fieldName:n,graphic:o,layer:i});if(l)return l;if(a.get(n.toLowerCase()))return Le(t,{fieldInfos:r||Array.from(a.values()),fieldName:n,layer:i});switch(i?.fieldsIndex?.get(n)?.type){case"date":return p(t);case"date-only":return L(t);case"time-only":return j(t);case"timestamp-offset":return _(t)}return G(t)}function lt({fieldInfos:e,attributes:t,layer:n,graphic:r,fieldInfoMap:a,relatedInfos:i}){const o={};return i?.forEach(s=>Pe({attributes:o,relatedInfo:s,fieldInfoMap:a,fieldInfos:e,layer:n})),t&&Object.keys(t).forEach(s=>{const l=t[s];o[s]=P({fieldName:s,fieldInfos:e,fieldInfoMap:a,layer:n,value:l,graphic:r})}),o}async function Ue(e,t){const{layer:n,graphic:r,outFields:a,objectIds:i,returnGeometry:o,spatialReference:s}=e,l=i[0];if(typeof l!="number"&&typeof l!="string"){const c="Could not query required fields for the specified feature. The feature's ID is invalid.",f={layer:n,graphic:r,objectId:l,requiredFields:a};return I.warn(c,f),null}if(!Z(n)?.operations?.supportsQuery){const c="The specified layer cannot be queried. The following fields will not be available.",f={layer:n,graphic:r,requiredFields:a,returnGeometry:o};return I.warn(c,f),null}const u=n.createQuery();return u.objectIds=i,u.outFields=a?.length?a:[n.objectIdField],u.returnGeometry=!!o,u.returnZ=!!o,u.returnM=!!o,u.outSpatialReference=s,(await n.queryFeatures(u,t)).features[0]}async function Se(e){if(!e.expressionInfos?.length)return!1;const t=await W(),{arcadeUtils:{hasGeometryFunctions:n}}=t;return n(e)}async function ut({graphic:e,popupTemplate:t,layer:n,spatialReference:r},a){if(!n||!t||(typeof n.load=="function"&&await n.load(a),!e.attributes))return;const i=e.attributes[n.objectIdField];if(i==null)return;const o=[i],s=await t.getRequiredFields(n.fieldsIndex),l=J(s,e),u=l?[]:s,c=t.returnGeometry||await Se(t);if(l&&!c)return;const f=await Ue({layer:n,graphic:e,outFields:u,objectIds:o,returnGeometry:c,spatialReference:r},a);f&&(f.geometry&&(e.geometry=f.geometry),f.attributes&&(e.attributes={...e.attributes,...f.attributes}))}function V(e=""){return!!e&&e.includes(q)}function Ge(e){return e?`${q}${e.layerId}/${e.fieldName}`:""}function T({attributes:e,graphic:t,relatedInfo:n,fieldInfos:r,fieldInfoMap:a,layer:i}){e&&t&&n&&Object.keys(t.attributes).forEach(o=>{const s=Ge({layerId:n.relation.id.toString(),fieldName:o}),l=t.attributes[o];e[s]=P({fieldName:s,fieldInfos:r,fieldInfoMap:a,layer:i,value:l,graphic:t})})}function Pe({attributes:e,relatedInfo:t,fieldInfoMap:n,fieldInfos:r,layer:a}){e&&t&&(t.relatedFeatures&&t.relatedFeatures&&t.relatedFeatures.forEach(i=>T({attributes:e,graphic:i,relatedInfo:t,fieldInfoMap:n,fieldInfos:r,layer:a})),t.relatedStatsFeatures&&t.relatedStatsFeatures&&t.relatedStatsFeatures.forEach(i=>T({attributes:e,graphic:i,relatedInfo:t,fieldInfoMap:n,fieldInfos:r,layer:a})))}const N=e=>{if(!e)return!1;const t=e.toUpperCase();return t.includes("CURRENT_TIMESTAMP")||t.includes("CURRENT_DATE")||t.includes("CURRENT_TIME")},k=({layer:e,method:t,query:n,definitionExpression:r})=>{if(!e.capabilities?.query?.supportsCacheHint||t==="attachments")return;const a=n.where!=null?n.where:null,i=n.geometry!=null?n.geometry:null;N(r)||N(a)||i?.type==="extent"||n.resultType==="tile"||(n.cacheHint=!0)},ft=({query:e,layer:t,method:n})=>{k({layer:t,method:n,query:e,definitionExpression:`${t.definitionExpression} ${t.serviceDefinitionExpression}`})},ct=({queryPayload:e,layer:t,method:n})=>{k({layer:t,method:n,query:e,definitionExpression:`${t.definitionExpression} ${t.serviceDefinitionExpression}`})};function dt(e,t,n){return e&&t&&n?w(e.allLayers,t,n)||w(e.allTables,t,n):null}function w(e,t,n){return e.filter(S).find(r=>r!==t&&r.url===t.url&&r.layerId===n.relatedTableId)}const Ve=e=>e?.type==="field",H=e=>e?.type==="group",ke=e=>e?.type==="relationship",pt=e=>!H(e)&&e.group!=null,He=e=>e.type==="field",mt=e=>e.type==="group",yt=e=>e.type==="relationship",Q=e=>e.reduce((t,n)=>H(n)?[...t,...n.inputs]:[...t,n],[]),gt=e=>Q(e).filter(Ve),ht=e=>Q(e).filter(ke),v=(e,t)=>e!=null&&e.input?.type===t,bt=e=>e!=null&&(v(e,"text-box")||v(e,"text-area")),$t=({domain:e,inputType:t="text-box",dataType:n})=>n==="number"&&t==="text-box"&&(!e||e.type!=="coded-value"),It=e=>"items"in e,x={typeFieldName:null,types:[]};function Ft(e,t,n){const r=Object.keys(t).filter(o=>m(e,o)),a=r.map(o=>t[o]),i=r.map(o=>n.get(o)).filter(re);return ze(e,Qe(a,i))}function Qe(e,t){const n=t.map((r,a)=>{let i=e[a];if(r.domain&&r.domain.type==="coded-value"){const o=r.domain.codedValues.find(s=>s.code===i);o?.name&&(i=o.name)}return ae(r)&&(i=Ye(r,i)),[r.name,i]});return Object.fromEntries(n)}function Ye(e,t){if(!e||t==null)return null;switch(e.type){case"date":return p(t);case"date-only":return L(t);case"time-only":return j(t);case"timestamp-offset":return _(t);default:return null}}const Et=new Set(["date-only","time-only","timestamp-offset"]);function ze(e,t){return d(d(e,n=>`{${n.toLowerCase()}}`),Object.fromEntries(Object.entries(t).map(([n,r])=>[n.toLowerCase(),r])))}const Tt=e=>e?e.type==="subtype-sublayer"?{typeFieldName:e.parent?.subtypeField,types:e.parent?.subtypes??[]}:"types"in e&&e.types?{typeFieldName:e.typeIdField,types:e.types.map(({id:t,name:n,domains:r})=>({code:t,name:n,domains:r}))}:x:x,Nt=(e,t)=>{if(!e)return!0;const{operations:n}=e;switch(t){case"INSERT":return n.supportsAdd;case"UPDATE":case"DELETE":return n.supportsUpdate;default:return!0}};var y;(function(e){e.TOO_SHORT="length-validation-error::too-short"})(y||(y={}));const A={type:"number"},O={type:"number",intlOptions:{notation:"scientific"}},C={type:"date",intlOptions:{day:"2-digit",month:"2-digit",year:"numeric",hour:"numeric",minute:"numeric",second:"numeric"}};function R(e){return e>=1e7||e<=-1e7}const wt=(e,t)=>{const{dataType:n,domain:r,error:a,field:i,minLength:o,value:s,required:l}=e;if(!t||!a)return null;if(l&&s===null)return t.validationErrors.cannotBeNull;if(a===b.VALUE_OUT_OF_RANGE||a===ie.OUT_OF_RANGE){const u=oe(r)||se(i);return $(t.validationErrors.outsideRange,u,{format:{max:n==="date"?C:R(u.max)?O:A,min:n==="date"?C:R(u.min)?O:A}})}return a===b.INVALID_CODED_VALUE?t.validationErrors.invalidCodedValue:a===le.INVALID_TYPE?t.validationErrors.invalidType:a===y.TOO_SHORT?$(t.validationErrors.tooShort,{min:o}):null},vt=e=>{if(!e)return;const t=e.layer,n=t&&"geometryType"in t?t.geometryType:void 0,r=e.geometry?.type;return r==="polyline"||n==="polyline"?"line":r||n||"table"},xt=e=>{const t=[];if(e.formTemplate){const{description:n,title:r}=e.formTemplate;e.fields?.forEach(a=>{const i=r&&m(r,a.name),o=n&&m(n,a.name);(i||o)&&t.push(a.name)})}return t};function At(e){return"formTemplate"in e&&e.formTemplate?(e.formTemplate.elements?.filter(He)??[]).some(({fieldName:t})=>!e.fieldsIndex.get(t)):!1}const Be={heading:"esri-widget__heading"};function Ot({level:e,class:t,...n},r){const a=Y(e);return ue(`h${a}`,{...n,class:fe(Be.heading,t),role:"heading","aria-level":String(a)},r)}function Y(e){return ce(Math.ceil(e),1,6)}function Ct(e,t=1){return Y(e+t)}function Rt(e){return t=>{t.hasOwnProperty("_delegatedEventNames")||(t._delegatedEventNames=t._delegatedEventNames?t._delegatedEventNames.slice():[]);const n=t._delegatedEventNames,r=Array.isArray(e)?e:Ze(e);n.push(...r)}}function Ze(e){return e.split(",").map(t=>t.trim())}export{tt as $,Xe as A,xt as B,Ke as C,yt as D,pt as E,Qe as F,nt as G,v as H,Ye as I,wt as J,vt as K,Ft as L,Ie as M,bt as N,He as O,It as P,Et as Q,y as S,ke as T,M as U,Tt as V,S as W,rt as X,At as Y,$t as _,Nt as a,et as b,st as c,at as d,De as e,Ue as f,ut as g,lt as h,it as i,ft as j,Ne as k,G as l,ct as m,Ot as n,ot as o,V as p,We as q,Rt as r,Ct as s,Ve as t,gt as u,ht as v,dt as w,mt as x,H as y,Ae as z};
