import{b3 as B,i0 as x,i1 as m,hC as F,i2 as N,i3 as W,i4 as h,ca as q,fK as v,cr as b,cs as E,i5 as d,i6 as H,cI as S,cz as I,i7 as z,i8 as K,i9 as y,ia as L,ib as k,cH as D,ic as J,id as Q,ie as X,ig as Y,ih as Z,ii as U,ij as V,ik as nn,il as en}from"./index-cdda5707.js";import{m as tn}from"./MeshGeoreferencedRelativeVertexSpace-78553062.js";import{m as rn,p as on}from"./MeshLocalVertexSpace-7526bf91.js";import{N as an}from"./MeshTransform-24e5f7d8.js";function O(n,t){return n.isGeographic||n.isWebMercator&&(t?.geographic??!0)}function bn(n,t,e){const r=!n.isGeoreferenced;e?.geographic!=null&&e.geographic!==r&&B.getLogger(t).warnOnce(`Specifying the 'geographic' parameter (${e.geographic}) for a Mesh vertex space of type "${n.type}" is not supported. This parameter will be ignored.`)}function A(n,t,e){return O(t.spatialReference,e)?fn(n,t,e):un(n,t,e)}function T(n,t,e,r){const{position:i,normal:o,tangent:a}=n;if(!t.isRelative)return{position:i,normal:o,tangent:a};const l=e?.localMatrix??m;return A({position:h(new Float64Array(i.length),i,l),normal:o!=null?nn(o,new Float32Array(o.length),l):null,tangent:a!=null?en(a,new Float32Array(a.length),l):null},t.getOriginPoint(r),{geographic:!t.isGeoreferenced})}function sn(n,t,e){if(e?.useTransform){const{position:r,normal:i,tangent:o}=n,{x:a,y:l,z:c}=t,s=I(a,l,c??0);return{vertexAttributes:{position:r,normal:i,tangent:o},vertexSpace:e.geographic??1?new rn({origin:s}):new tn({origin:s}),transform:new an}}return{vertexAttributes:A(n,t,e),vertexSpace:new on,transform:null}}function w(n,t,e){return O(t.spatialReference,e)?mn(n,t,e):j(n,t,e)}function ln(n,t,e,r,i){if(!t.isRelative)return w(n,r,i);const{spatialReference:o}=r,a=T(n,t,e,o);return r.equals(t.getOriginPoint(o))?j(a,r,i):w(a,r,i)}function cn({positions:n,transform:t,vertexSpace:e,inSpatialReference:r,outSpatialReference:i,outPositions:o,local:a}){const l=e.isRelative?e.origin:x,c=e.isRelative?t?.localMatrix??m:m;if(e.isGeoreferenced){const u=o??F(n.length);if(N(c,m)?W(u,n):h(u,n,c),!q(l,x)){const[C,G,P]=l;for(let p=0;p<u.length;p+=3)u[p]+=C,u[p+1]+=G,u[p+2]+=P}return v(u,r,0,u,i,0,u.length/3),u}const s=b(r),$=!a&&E(r,s)?s:r;d(r,l,f,$),H(f,f,c);const g=o??F(n.length);return h(g,n,f),v(g,$,0,g,i,0,g.length/3),g}function un(n,t,e){const r=new Float64Array(n.position.length),i=n.position,o=t.x,a=t.y,l=t.z??0,c=R(e?e.unit:null,t.spatialReference);for(let s=0;s<i.length;s+=3)r[s]=i[s]*c+o,r[s+1]=i[s+1]*c+a,r[s+2]=i[s+2]*c+l;return{position:r,normal:n.normal,tangent:n.tangent}}function fn(n,t,e){const r=t.spatialReference,i=M(t,e,f),o=new Float64Array(n.position.length),a=gn(n.position,i,r,o),l=z(_,i);return{position:a,normal:pn(a,o,n.normal,l,r),tangent:hn(a,o,n.tangent,l,r)}}function gn(n,t,e,r){h(r,n,t);const i=new Float64Array(n.length);return K(r,i,e)}function pn(n,t,e,r,i){if(e==null)return null;const o=new Float32Array(e.length);return y(o,e,r),L(o,n,t,i,o),o}function hn(n,t,e,r,i){if(e==null)return null;const o=new Float32Array(e.length);y(o,e,r,4);for(let a=3;a<o.length;a+=4)o[a]=e[a];return k(o,n,t,i,o),o}function j(n,t,e){const r=new Float64Array(n.position.length),i=n.position,o=t.x,a=t.y,l=t.z??0,c=R(e?e.unit:null,t.spatialReference);for(let s=0;s<i.length;s+=3)r[s]=(i[s]-o)/c,r[s+1]=(i[s+1]-a)/c,r[s+2]=(i[s+2]-l)/c;return{position:r,normal:n.normal,tangent:n.tangent}}function mn(n,t,e){const r=t.spatialReference;M(t,e,f);const i=D(Rn,f),o=new Float64Array(n.position.length),a=yn(n.position,r,i,o),l=z(_,i);return{position:a,normal:wn(n.normal,n.position,o,r,l),tangent:An(n.tangent,n.position,o,r,l)}}function M(n,t,e){d(n.spatialReference,[n.x,n.y,n.z??0],e,b(n.spatialReference));const r=R(t?t.unit:null,n.spatialReference);return J(e,e,[r,r,r]),e}function yn(n,t,e,r){const i=Q(n,t,r),o=new Float64Array(i.length);return h(o,i,e),o}function wn(n,t,e,r,i){if(n==null)return null;const o=X(n,t,e,r,new Float32Array(n.length));return y(o,o,i),o}function An(n,t,e,r,i){if(n==null)return null;const o=Y(n,t,e,r,new Float32Array(n.length));return y(o,o,i,4),o}function R(n,t){if(n==null)return 1;const e=Z(t);return 1/U(e,"meters",n)}const f=S(),Rn=S(),_=V(),dn=Object.freeze(Object.defineProperty({__proto__:null,georeference:A,georeferenceApplyTransform:T,georeferenceByTransform:sn,project:cn,ungeoreference:w,ungeoreferenceByTransform:ln},Symbol.toStringTag,{value:"Module"}));export{w as D,ln as E,cn as I,A as O,T,dn as g,bn as o,sn as q,O as r};
