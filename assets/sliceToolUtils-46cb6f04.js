import{bN as it,lr as rt,aD as x,aE as G,e0 as X,gN as Re,aA as nt,b0 as ve,ih as ke,aF as ot,bl as at,ci as f,dT as ct,p2 as ie,kr as lt,ks as dt,en as Ne,ku as Pe,oB as Se,ky as ut,kG as gt,az as ht,kI as pt,kJ as bt,kK as ft,kL as mt,pt as _t,kD as J,k0 as $t,kR as Tt,pu as Ot,kj as re,kW as wt,pv as At,kY as Ct,kZ as Et,jY as It,jZ as Rt,oK as vt,ki as _,kk as Le,hP as kt,oS as de,nc as Nt,kp as c,bs as S,nk as ze,nh as L,bg as ne,iE as b,lo as p,pw as we,nR as Z,hk as Xe,he as q,px as Ye,kl as O,p4 as qe,ko as Y,o_ as v,bh as oe,eO as U,py as Pt,bO as P,km as Q,kF as ee,kn as St,p3 as Ue,pz as ye,b_ as be,gQ as Me,pA as Ve,pB as xe,pC as We,pD as Lt,pE as Ze,nm as H,eN as k,nP as Ut,pF as yt,pG as me,pH as Mt,pI as Vt,bT as xt,db as Wt,mb as Gt,k5 as Ke,d4 as Ht,nK as Je,pJ as _e,pK as Ge,nN as Bt,pL as Ft,cd as jt}from"./main-79e5ed80.js";import{i as B,u as Qe}from"./analysisThemeUtils-558736fc.js";import{b as Dt,u as zt,r as Xt}from"./LineVisualElement-edcd3279.js";import{N as Yt,$ as et,e as C,U as qt,R as Zt}from"./manipulatorUtils-1c1ed0c0.js";let w=class extends it(at){constructor(t){super(t),this.type="plane",this.position=null,this.heading=0,this.tilt=0,this.width=10,this.height=10}equals(t){return this.heading===t.heading&&this.tilt===t.tilt&&rt(this.position,t.position)&&this.width===t.width&&this.height===t.height}};x([G({readOnly:!0,json:{read:!1,write:!0}})],w.prototype,"type",void 0),x([G({type:nt}),X()],w.prototype,"position",void 0),x([G({type:Number,nonNullable:!0,range:{min:0,max:360}}),X(),Re(e=>ve.normalize(ke(e),0,!0))],w.prototype,"heading",void 0),x([G({type:Number,nonNullable:!0,range:{min:0,max:360}}),X(),Re(e=>ve.normalize(ke(e),0,!0))],w.prototype,"tilt",void 0),x([G({type:Number,nonNullable:!0}),X()],w.prototype,"width",void 0),x([G({type:Number,nonNullable:!0}),X()],w.prototype,"height",void 0),w=x([ot("esri.analysis.SlicePlane")],w);const Kt=w;let Jt=class{constructor(){this.color=B()}},Qt=class{constructor(){this.color=new f([0,0,0,.04]),this.gridColor=B(.5),this.outlineColor=B(.7)}},es=class{constructor(){this.color=B()}},ts=class{constructor(){this.color=B(.5),this.contrastColor=Qe()}},ss=class{constructor(){this.color=Qe(),this.outlineColor=B()}},is=class{constructor(){this.callouts=new Jt,this.plane=new Qt,this.resizeManipulators=new es,this.rotateManipulators=new ts,this.shiftManipulator=new ss}},ae=new is;const Bs=ct("mac")?"Meta":"Control",Fs="Shift",rs=2,ns=1.15,os=1.15,js=2500,Ds=.02,as=Math.cos(ie(45)),He=Math.cos(ie(5)),zs=.95,Xs=.3,Ys=2,cs=1,ls=3,tt=11,$e=22.5,se=40,Be=48,ds=2.25,us=4,Fe=1,gs=.3,hs=6,ps=4,je=1600,bs=.4;function fs(e){const t=new lt,{vertex:i,fragment:s,attributes:n,varyings:o}=t;return dt(i,e),n.add(Ne.POSITION,"vec3"),n.add(Ne.UV0,"vec2"),o.add("vUV","vec2"),i.code.add(Pe`void main(void) {
vUV = uv0;
gl_Position = proj * view * vec4(position, 1.0);
}`),s.uniforms.add(new Se("backgroundColor",r=>r.backgroundColor),new Se("gridColor",r=>r.gridColor),new ut("gridWidth",r=>r.gridWidth)),s.code.add(Pe`void main() {
const float LINE_WIDTH = 1.0;
vec2 uvScaled = vUV * gridWidth;
vec2 gridUV = (fract(uvScaled + 0.5) - 0.5) / (LINE_WIDTH * fwidth(uvScaled));
vec2 grid = (1.0 - step(0.5, gridUV)) * step(-0.5, gridUV);
grid.x *= step(0.5, uvScaled.x) * step(uvScaled.x, gridWidth - 0.5);
grid.y *= step(0.5, uvScaled.y) * step(uvScaled.y, gridWidth - 0.5);
float gridFade = max(grid.x, grid.y);
float gridAlpha = gridColor.a * gridFade;
fragColor =
vec4(backgroundColor.rgb * backgroundColor.a, backgroundColor.a) * (1.0 - gridAlpha) +
vec4(gridColor.rgb, 1.0) * gridAlpha;
}`),t}const ms=Object.freeze(Object.defineProperty({__proto__:null,build:fs},Symbol.toStringTag,{value:"Module"}));class _s extends Ot{constructor(){super(...arguments),this.backgroundColor=re(1,0,0,.5),this.gridColor=re(0,1,0,.5),this.gridWidth=4}}class ue extends pt{initializeProgram(t){return new bt(t.rctx,ue.shader.get().build(this.configuration),ft)}initializePipeline(){return mt({blending:_t(J.ONE,J.ONE,J.ONE_MINUS_SRC_ALPHA,J.ONE_MINUS_SRC_ALPHA),depthTest:{func:$t.LESS},colorWrite:Tt})}}ue.shader=new gt(ms,()=>ht(()=>import("./SlicePlaneMaterial.glsl-48be1bee.js"),["./SlicePlaneMaterial.glsl-48be1bee.js","./main-79e5ed80.js","./main-7772480e.css","./analysisThemeUtils-558736fc.js","./colorUtils-fa6b524d.js","./colorUtils-c0f43caf.js","./LineVisualElement-edcd3279.js","./manipulatorUtils-1c1ed0c0.js","./ImageMaterial-0a3b496e.js"],import.meta.url));class $s extends wt{constructor(t){super(t,new Os),this._configuration=new At}createBufferWriter(){return new Ct(Et)}requiresSlot(t,i){return i===It.Color&&t===Rt.TRANSPARENT_DEPTH_WRITE_DISABLED_MATERIAL}createGLMaterial(t){return new Ts(t)}getConfiguration(){return this._configuration}}class Ts extends vt{constructor(t){super(t),this.ensureTechnique(ue,null)}beginSlot(){return this.technique}}class Os extends _s{constructor(){super(...arguments),this.renderOccluded=_.Occlude}}class ws extends Dt{constructor(t){super(t),this._material=null,this._renderOccluded=_.OccludeAndTransparent,this._gridWidth=1,this._gridColor=re(1,0,0,1),this._backgroundColor=re(1,0,0,1),this.applyProps(t)}get renderOccluded(){return this._renderOccluded}set renderOccluded(t){t!==this._renderOccluded&&(this._renderOccluded=t,this._updateMaterial())}get gridWidth(){return this._gridWidth}set gridWidth(t){this._gridWidth!==t&&(this._gridWidth=t,this._updateMaterial())}get gridColor(){return this._gridColor}set gridColor(t){Le(this._gridColor,t),this._updateMaterial()}get backgroundColor(){return this._backgroundColor}set backgroundColor(t){Le(this._backgroundColor,t),this._updateMaterial()}createExternalResources(){this._material=new $s(this._materialParameters)}destroyExternalResources(){this._material=null}forEachExternalMaterial(t){this._material!=null&&t(this._material)}createGeometries(t){if(this._material!=null){const i=kt(this._material);t.addGeometry(i)}}get _materialParameters(){return{backgroundColor:this._backgroundColor,gridWidth:this._gridWidth,gridColor:this._gridColor,renderOccluded:this._renderOccluded}}_updateMaterial(){this._material!=null&&this._material.setParameters(this._materialParameters)}}function qs(e,t,i,s,n,o,r,a){return As(t,r.worldUpAtPosition(e,c.get()),n,o,a.basis1,a.basis2),p(a.basis1,a.basis1,i),p(a.basis2,a.basis2,s),S(a.origin,e),Ze(a.basis2,a.basis1,a.origin,a.plane),a}function As(e,t,i,s,n,o){const r=H(e,t),a=c.get(),d=c.get();switch(s===N.HORIZONTAL_OR_VERTICAL?Math.abs(r)>as?N.HORIZONTAL:N.VERTICAL:s){case N.VERTICAL:{const h=Math.abs(r)<=He?e:i.viewUp;k(a,h,t),S(d,t);break}case N.HORIZONTAL:k(a,i.viewUp,t),k(d,t,a);break;case N.TILTED:{const h=Math.abs(r)<=He?t:i.viewUp;k(a,h,e),k(d,e,a);break}}const g=k(c.get(),a,d);H(g,i.viewForward)>0&&p(d,d,-1),U(n,a),U(o,d)}function Cs(e,t,i){const s=t.worldUpAtPosition(e.origin,c.get()),n=e.basis1,o=Ee(e,s),r=Math.round(o/F)*F;return _e(e,r-o,n,i)}function Zs(e,t,i,s,n,o){const r=S(c.get(),n.origin);b(r,r,p(c.get(),n.basis1,e.direction[0]<0?1:-1)),b(r,r,p(c.get(),n.basis2,e.direction[1]<0?1:-1));const a=L(n.basis1),d=L(n.basis2),g=O(c.get(),i,r),h=O(c.get(),t,r);let u=0,l=0;if(Ce(e)){const T=Te(n),ge=Te(o);u=a-.5*e.direction[0]*H(n.basis1,h)/a,l=d-.5*e.direction[1]*H(n.basis2,h)/d;const j=ge/T;u*=j,l*=j}const $=u+.5*e.direction[0]*H(n.basis1,g)/a,m=l+.5*e.direction[1]*H(n.basis2,g)/d,y=p(c.get(),n.basis1,$/a),I=p(c.get(),n.basis2,m/d);($<=0||De(o.origin,y,s)<=je)&&S(y,o.basis1),(m<=0||De(o.origin,I,s)<=je)&&S(I,o.basis2);const R=S(c.get(),r);return b(R,R,p(c.get(),y,e.direction[0]<0?-1:1)),b(R,R,p(c.get(),I,e.direction[1]<0?-1:1)),Ut(R,y,I,o)}function Ks(e,t){return bs*Math.min(t.width,t.height)*t.computeRenderPixelSizeAt(e)}function Js(e,t,i,s){const n=k(c.get(),t,i);return k(n,n,t),ze(e,n,s)}function Qs(e,t){return Yt(e.basis1,e.basis2,e.origin,t)}function ei(e,t,i,s){const n=t.worldUpAtPosition(e.origin,c.get()),o=c.get();switch(i){case ce.HEADING:S(o,n);break;case ce.TILT:S(o,e.basis1)}return ze(e.origin,o,s)}function ti(e,t,i,s){const n=Ae(i,E.NEGATIVE_X),o=Z.get();yt(o,t,n.edge*Math.PI/2);const r=U(c.get(),n.basis);let a=p(c.get(),r,n.direction*s.computeScreenPixelSizeAt(n.position)*se);b(a,a,n.position);const d=s.projectToRenderScreen(a,me(c.get())),g=Es(s,d);Mt(s,d,te),U(te.direction,te.direction);const h=c.get();!g&&Vt(i,te,h)&&(a=h),o[12]=0,o[13]=0,o[14]=0,e.modelTransform=o,e.renderLocation=xt(a),g?e.state|=le:e.state&=~le}function Es(e,t){const[i,s,n,o]=e.viewport,r=Math.min(n,o)/16;let a=!0;return t[0]<i+r?(t[0]=i+r,a=!1):t[0]>i+n-r&&(t[0]=i+n-r,a=!1),t[1]<s+r?(t[1]=s+r,a=!1):t[1]>s+o-r&&(t[1]=s+o-r,a=!1),a}function si(e,t,i,s){const n=L(s.basis1),o=L(s.basis2),r=st(s),a=Te(s),d=ne(c.get(),0,0,0);b(d,p(c.get(),s.basis1,t.direction[0]),p(c.get(),s.basis2,t.direction[1])),b(d,s.origin,d);let g=0,h=1;if(Ce(t))t.direction[0]===1&&t.direction[1]===-1?g=F:t.direction[0]===1&&t.direction[1]===1?g=Math.PI:t.direction[0]===-1&&t.direction[1]===1&&(g=3*Math.PI/2),h=a;else{const l=t.direction[0]!==0?1:2;g=l===1?F:0,h=(l===1?o:n)-r}const u=we(Z.get(),g);Xe(u,u,ne(c.get(),h,h,h)),q(u,i,u),u[12]=0,u[13]=0,u[14]=0,e.modelTransform=u,e.renderLocation=d}function ii(e,t,i,s){const n=s.worldUpAtPosition(i.origin,c.get()),o=Ae(i,E.POSITIVE_X),r=we(Z.get(),o.edge*Math.PI/2);Ye(r,r,-Ee(i,n)),q(r,t,r),r[12]=0,r[13]=0,r[14]=0,e.modelTransform=r,e.renderLocation=o.position}function ri(e,t,i){const s=Ae(i,E.POSITIVE_Y),n=we(Z.get(),s.edge*Math.PI/2);Ye(n,n,F),q(n,t,n),n[12]=0,n[13]=0,n[14]=0,e.modelTransform=n,e.renderLocation=s.position}var E;function Ae(e,t){switch(t){case E.POSITIVE_X:return{basis:e.basis1,direction:1,position:b(c.get(),e.origin,e.basis1),edge:t};case E.POSITIVE_Y:return{basis:e.basis2,direction:1,position:b(c.get(),e.origin,e.basis2),edge:t};case E.NEGATIVE_X:return{basis:e.basis1,direction:-1,position:O(c.get(),e.origin,e.basis1),edge:t};case E.NEGATIVE_Y:return{basis:e.basis2,direction:-1,position:O(c.get(),e.origin,e.basis2),edge:t}}}function De(e,t,i){const s=i.projectToRenderScreen(b(c.get(),e,t),me(c.get())),n=i.projectToRenderScreen(O(c.get(),e,t),me(c.get()));return Wt(O(s,s,n))}function st(e){const t=L(e.basis1),i=L(e.basis2);return gs*Math.min(t,i)}function Te(e){return st(e)}function Ce(e){return e.direction[0]!==0&&e.direction[1]!==0}function ni(e,t){const i=t.offsetMode===Oe.CENTER_ON_CALLOUT?se:0,s=[P(i,0,-Be/2),P(i,0,Be/2)],n=vs(s,!0),o=(u,l)=>Is(s,u,l,t),r=o(0,!1),a=o(ds,!0),d=new qe({color:f.toUnitRGBA(t.calloutColor),renderOccluded:_.OccludeAndTransparent}),g=Y(d,[[i,0,0],[i-se,0,0]]),h=Y(d,[[i,0,0],[i-se,0,0]]);return new et({view:e,renderObjects:[...r.normal.map(u=>new C(u,v.Unfocused|A)),...a.normal.map(u=>new C(u,v.Unfocused|A)),new C(g,v.Unfocused|A|le),...r.focused.map(u=>new C(u,v.Focused|A)),...a.focused.map(u=>new C(u,v.Focused|A)),new C(h,v.Focused|A|le)],autoScaleRenderObjects:!1,collisionType:{type:"line",paths:[n]},collisionPriority:1,radius:tt,state:A})}function oi(e,t){const i=Zt(e,{calloutColor:f.toUnitRGBA(ae.callouts.color),customStateMask:A,texture:t});return i.state=A,i}function ai(e){const t=[[-1,-1,0],[1,-1,0],[1,1,0],[-1,1,0],[-1,-1,0]];return new zt({view:e,attached:!1,color:f.toUnitRGBA(ae.plane.outlineColor),width:cs,renderOccluded:_.OccludeAndTransparent,geometry:[t]})}function ci(e){return new ws({view:e,attached:!1,backgroundColor:f.toUnitRGBA(ae.plane.color),gridColor:f.toUnitRGBA(ae.plane.gridColor),gridWidth:4,renderOccluded:_.OccludeAndTransparent})}function li(e,t,i){const s=Ce(t),n=s?[P(1,0,0),P(0,0,0),P(0,1,0)]:[P(1,0,0),P(-1,0,0)],o=f.toUnitRGBA(i.color),r=m=>new St({color:o,width:m,renderOccluded:_.OccludeAndTransparent}),a=()=>new qe({color:o,renderOccluded:_.OccludeAndTransparent}),d=s?us:Fe,g=d*rs,h=Fe,u=m=>m>1?r(m):a(),l=[new C(Y(u(d),n),v.Unfocused|fe),new C(Y(u(g),n),v.Focused|fe),new C(Y(u(h),n),Ns)],$=new et({view:e,renderObjects:l,collisionType:{type:"line",paths:[n]},radius:s?hs:ps,...qt});return $.state=fe,$}function Is(e,t,i,s){const n=f.blendColors(s.color,s.outlineColor,.4),o=f.blendColors(s.color,s.outlineColor,.14),r=new Q({color:f.toUnitRGBA(s.color),cullFace:ee.Back,renderOccluded:_.Opaque}),a=new Q({color:f.toUnitRGBA(n),cullFace:ee.Back,renderOccluded:_.Opaque}),d=new Q({color:f.toUnitRGBA(o),cullFace:ee.Back,renderOccluded:_.Opaque}),g=new Q({color:f.toUnitRGBA(s.outlineColor),transparent:!0,writeDepth:!1,cullFace:ee.Front,renderOccluded:_.Transparent}),h=u=>{const l=e.slice(0),$=O(c.get(),l[0],l[1]);U($,$);const m=O(c.get(),l[l.length-1],l[l.length-2]);if(U(m,m),t>0){const z=p(oe(),m,-t);l[l.length-1]=b(z,z,l[l.length-1]);const W=p(oe(),$,-t);l[0]=b(W,W,l[0])}const y=u?os:1,I=$e*y,R=tt*y,T=Ue(Z.get());if(t>0){const z=I/4,W=ne(c.get(),0,z,0),K=1+t/z;ye(T,T,W),Xe(T,T,ne(c.get(),K,K,K)),ye(T,T,p(W,W,-1/K))}const ge=Ue(be()),j=P(0,1,0),M=Me(be(),Ve(xe.get(),j,m));M[12]=l[l.length-1][0],M[13]=l[l.length-1][1],M[14]=l[l.length-1][2],q(M,M,T);const Ie=Rs(ls*(u?ns:1)+t,l,i?g:d);Ie.transformation=ge;const D=[Ie],he=We(i?g:r,I,R,24,!1,!1,!0);he.transformation=M,D.push(he);const pe=We(i?g:a,I,R,24,!1,!0,!1);pe.transformation=M,D.push(pe);const V=Me(be(),Ve(xe.get(),j,$));return V[12]=l[0][0],V[13]=l[0][1],V[14]=l[0][2],q(V,V,T),D.push(he.instantiate({transformation:V})),D.push(pe.instantiate({transformation:V})),D};return{normal:h(!1),focused:h(!0)}}function Rs(e,t,i){const s=[];for(let o=0;o<12;o++){const r=o/12*2*Math.PI;s.push([Math.cos(r)*e,Math.sin(r)*e])}return Lt(i,s,t,[],[],!1)}function vs(e,t){const i=O(oe(),e[e.length-1],e[e.length-2]);if(U(i,i),p(i,i,$e),b(i,i,e[e.length-1]),t){const s=O(oe(),e[0],e[1]);return U(s,s),p(s,s,$e),b(s,s,e[0]),[s,...e,i]}return[...e,i]}function di(e,t,i,s=new Kt){if(e==null)return null;const{renderCoordsHelper:n}=t,o=n.fromRenderCoords(e.origin,t.spatialReference);if(o==null)return null;const r=Gt(o,i);if(r==null)return null;s.position=r;const a=2*L(e.basis1),d=2*L(e.basis2),g=Ke.renderUnitScaleFactor(t.spatialReference,i);s.width=a*g,s.height=d*g;const h=n.worldUpAtPosition(e.origin,c.get());return s.tilt=Ht(Ee(e,h)),s.heading=n.headingAtPosition(e.origin,e.basis1)-90,s}function Ee(e,t){return Pt(t,e.basis2,e.basis1)+F}function ks(e,t,i,s,n,o,r=Je()){return o.toRenderCoords(e,r.origin)?(o.worldBasisAtPosition(r.origin,Ge.X,r.basis1),o.worldBasisAtPosition(r.origin,Ge.Y,r.basis2),Ze(r.basis2,r.basis1,r.origin,r.plane),_e(r,-ie(t),Bt(r),r),_e(r,ie(i),r.basis1,r),p(r.basis1,r.basis1,s/2),p(r.basis2,r.basis2,n/2),Ft(r),r):(jt.getLogger("esri.views.3d.analysis.Slice.sliceToolUtils").error(`Failed to project slice plane position, projection from ${e.spatialReference.wkid} is not supported`),null)}function ui(e,t){if(e==null||e.position==null)return null;const i=Xt(e.position,t.spatialReference,t.elevationProvider);if(i==null)return null;const s=Ke.renderUnitScaleFactor(e.position.spatialReference,t.spatialReference),n=e.width*s,o=e.height*s;return{position:i,heading:e.heading,tilt:e.tilt,renderWidth:n,renderHeight:o}}function gi(e,t,i,s=Je()){if(e==null)return null;const n=ks(e.position,e.heading,e.tilt,e.renderWidth,e.renderHeight,t.renderCoordsHelper,s);return i.tiltEnabled||n==null||Cs(n,t.renderCoordsHelper,n),n}(function(e){e[e.POSITIVE_X=0]="POSITIVE_X",e[e.POSITIVE_Y=1]="POSITIVE_Y",e[e.NEGATIVE_X=2]="NEGATIVE_X",e[e.NEGATIVE_Y=3]="NEGATIVE_Y"})(E||(E={}));const A=de.Custom1;var ce,N;(function(e){e[e.HEADING=1]="HEADING",e[e.TILT=2]="TILT"})(ce||(ce={})),function(e){e[e.HORIZONTAL_OR_VERTICAL=0]="HORIZONTAL_OR_VERTICAL",e[e.HORIZONTAL=1]="HORIZONTAL",e[e.VERTICAL=2]="VERTICAL",e[e.TILTED=3]="TILTED"}(N||(N={}));const le=de.Custom2,te=Nt(),F=Math.PI/2,fe=de.Custom1,Ns=de.Custom2;var Oe;function hi(e){return(e.type==="building-scene-3d"?e:null)!=null}(function(e){e[e.CENTER_ON_CALLOUT=0]="CENTER_ON_CALLOUT",e[e.CENTER_ON_ARROW=1]="CENTER_ON_ARROW"})(Oe||(Oe={}));export{Ce as $,hi as A,ti as B,ri as D,si as F,Js as G,ei as H,ni as J,oi as K,Ys as M,Oe as O,ai as Q,Ks as S,fe as T,ii as X,ae as a,ci as b,Fs as c,gi as d,li as e,Bs as f,Xs as g,Kt as h,N as i,A as j,Qs as k,ui as l,js as m,zs as n,Ds as o,ce as p,cs as q,di as r,le as s,fs as t,qs as v,Ns as w,Zs as y,Te as z};
