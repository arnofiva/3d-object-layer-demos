import{aA as B,pL as fe,pM as Ke,pN as et,bQ as T,cL as _e,pw as se,lW as N,nm as He,kM as b,ek as Fe,ej as ue,pm as tt,pO as it,fN as xe,bz as ne,cp as nt,b9 as ot,pP as Ue,b0 as We,dD as rt,aW as st,pQ as at,fE as Le,lV as E,pR as lt,ew as pt,pS as ct,aD as s,aE as l,aF as G,cW as ht,cY as de,pT as oe,cZ as re,d1 as ut,bm as A,aV as R,b6 as dt,aM as gt,pU as J,pV as ge,lu as yt,bu as te,bi as mt,pW as vt,d0 as ft,pX as _t,d4 as xt,hb as we,gU as wt,lZ as Tt,bl as bt,hj as Te,hk as Ae,h9 as Ne,kp as Ot,cz as Mt,iN as Q,pY as be,i0 as Oe,pZ as Me,nP as Ye,lN as U,ne as q,pJ as Se,p_ as St,p$ as Vt,bY as It,lM as ae,lO as Ve,kQ as w,nh as Ie,px as $t,ce as le}from"./index-cdda5707.js";import{m as V,U as Y,r as $e,s as Ce}from"./getDefaultUnitForView-399249e8.js";import{simplify as Ct,distance as Pt}from"./geometryEngine-56bd014d.js";import{l as Rt,d as pe,C as Gt}from"./dragEventPipeline-4a965366.js";import{t as j,p as Et,s as ce,d as zt,a as X}from"./automaticLengthMeasurementUtils-caefc58e.js";import{o as Pe}from"./automaticAreaMeasurementUtils-6d9b4370.js";import{r as Re}from"./dehydratedFeatureComparison-860c6b48.js";import{w as Dt,_ as Zt,p as kt,l as Ht,t as Ft,a as Ut,s as Wt,c as Lt}from"./EditGeometryOperations-36bcef90.js";import{e as Ge}from"./SnappingContext-c96cf417.js";import{p as At,f as Nt}from"./SnappingOperation-3825d76a.js";function ie(t,e,i=null){return i!=null?[t,e,i]:[t,e]}function v(t,e,i=null){return i!=null?{x:t,y:e,z:i}:{x:t,y:e}}let je=class{constructor(e){this.spatialReference=e}mapToLocalMultiple(e){return e.map(i=>this.mapToLocal(i)).filter(ne)}get doUnnormalization(){return!1}};class Yt extends je{constructor(e,i,n=null){super(i),this._defaultZ=n,this.transform=fe(),this.transformInv=fe(),this.transform=Ke(e),et(this.transformInv,this.transform)}makeMapPoint(e,i){return ie(e,i,this._defaultZ)}mapToLocal(e){return v(this.transform[0]*e[0]+this.transform[2]*e[1]+this.transform[4],this.transform[1]*e[0]+this.transform[3]*e[1]+this.transform[5])}localToMap(e){return ie(this.transformInv[0]*e.x+this.transformInv[2]*e.y+this.transformInv[4],this.transformInv[1]*e.x+this.transformInv[3]*e.y+this.transformInv[5],this._defaultZ)}}let jt=class extends je{constructor(e,i){super(e.spatialReference),this.view=e,this.defaultZ=null,this.pWS=T(),this.tangentFrameUpWS=T(),this.tangentFrameRightWS=T(),this.tangentFrameForwardWS=T(),this.localFrameRightWS=T(),this.localFrameUpWS=T(),this.worldToLocalTransform=_e(),this.localToWorldTransform=_e(),this.scale=1,this.scale=e.resolution,this.referenceMapPoint=i,this.defaultZ=i.hasZ?i.z:null;const n=e.state.camera.viewRight;this.view.renderCoordsHelper.toRenderCoords(this.referenceMapPoint,this.pWS),this.view.renderCoordsHelper.worldBasisAtPosition(this.pWS,se.X,this.tangentFrameRightWS),this.view.renderCoordsHelper.worldBasisAtPosition(this.pWS,se.Y,this.tangentFrameUpWS),this.view.renderCoordsHelper.worldBasisAtPosition(this.pWS,se.Z,this.tangentFrameForwardWS);const o=T();N(o,this.tangentFrameForwardWS,He(n,this.tangentFrameForwardWS)),b(this.localFrameRightWS,n,o),Fe(this.localFrameRightWS,this.localFrameRightWS),ue(this.localFrameUpWS,this.tangentFrameForwardWS,this.localFrameRightWS),tt(this.worldToLocalTransform,this.localFrameRightWS,this.tangentFrameRightWS),it(this.localToWorldTransform,this.worldToLocalTransform)}get doUnnormalization(){return this.view.viewingMode==="global"}makeMapPoint(e,i){return ie(e,i,this.defaultZ)}mapToLocal(e){const i=T();this.view.renderCoordsHelper.toRenderCoords(new B({x:e[0],y:e[1],spatialReference:this.spatialReference}),i),xe(i,i,this.worldToLocalTransform);const n=this.view.renderCoordsHelper.fromRenderCoords(i,this.view.spatialReference);return n!=null?v(n.x/this.scale,n.y/this.scale):null}localToMap(e){const i=T();this.view.renderCoordsHelper.toRenderCoords(new B({x:e.x*this.scale,y:e.y*this.scale,spatialReference:this.spatialReference}),i),xe(i,i,this.localToWorldTransform);const n=this.view.renderCoordsHelper.fromRenderCoords(i,this.view.spatialReference);return n!=null?ie(n.x,n.y,this.defaultZ):null}};function Ee(t,e){if(t.type==="2d")return new Yt(t.state.transform,t.spatialReference,e.length>2?e[2]:null);if(t.type==="3d"){const i=e.length>2?new B({x:e[0],y:e[1],z:e[2],spatialReference:t.spatialReference}):new B({x:e[0],y:e[1],spatialReference:t.spatialReference});return new jt(t,i)}return null}function k(t,e){const i=new B({x:t[0],y:t[1],spatialReference:e});return t.length>2&&(i.z=t[2]),i}function qt(t,e){return new nt({points:t,spatialReference:e})}function ze(t,e,i){const n=new ot({paths:t,spatialReference:e});return i&&Ue(n),n}function H(t,e,i,n=!0){const o=We(t);o.forEach(p=>{const a=p[0],c=p[p.length-1];rt(a,c)&&p.length!==1||p.push(p[0])});let r=new st({rings:o,spatialReference:e});return r.rings.forEach(p=>{at(p,!1,!1)||p.reverse()}),i&&Ue(r),n&&r.isSelfIntersecting&&Le(e)&&(r=Ct(r)),r}function De(t,e,i){const n=e.mapToLocalMultiple(t),o=[],r={x:n[0].x,y:n[0].y},p={x:n[1].x,y:n[1].y},a=Math.round(p.x-r.x),c=Math.round(p.y-r.y),g=Math.max(Math.abs(a),Math.abs(c));if(i){const u={x:r.x+g,y:r.y+g},m={x:r.x-g,y:r.y-g};o.push(v(u.x,m.y),v(m.x,m.y),v(m.x,u.y),v(u.x,u.y))}else{const u={x:a>0?r.x+g:r.x-g,y:c>0?r.y+g:r.y-g};o.push(v(r.x,r.y),v(u.x,r.y),v(u.x,u.y),v(r.x,u.y))}return qe(H([o.map(u=>e.localToMap(u)).filter(ne)],e.spatialReference,e.doUnnormalization,!0),o,e)}function Qt(t,e,i){let n=e.mapToLocalMultiple(t);if(n.length===1){const c=n[0];n=[v(c.x-48,c.y+48),v(c.x+48,c.y-48),v(c.x+48,c.y-48),v(c.x-48,c.y+48)]}const o=[],r={x:n[0].x,y:n[0].y},p={x:n[1].x,y:n[1].y};if(i){const a=Math.round(p.x-r.x),c=Math.round(p.y-r.y);o.push(v(r.x-a,r.y-c),v(p.x,r.y-c),v(p.x,p.y),v(r.x-a,p.y))}else o.push(v(r.x,r.y),v(p.x,r.y),v(p.x,p.y),v(r.x,p.y));return qe(H([o.map(a=>e.localToMap(a)).filter(ne)],e.spatialReference,e.doUnnormalization,!0),o,e)}function qe(t,e,i){const n=K(e[3],e[2],i),o=K(e[1],e[2],i),r=K(e[0],e[1],i),p=K(e[0],e[3],i);return{geometry:t,midpoints:n!=null&&o!=null&&r!=null&&p!=null?{top:n,right:o,bottom:r,left:p}:null}}function K(t,e,i){W[0]=t.x,W[1]=t.y,W[2]=0,L[0]=e.x,L[1]=e.y,L[2]=0,E(W,W,L,.5),ee.x=W[0],ee.y=L[1],ee.z=L[2];const n=i.localToMap(ee);return n!=null?k(n,i.spatialReference):null}const ee=v(0,0,0),W=T(),L=T();function Ze(t,e,i,n){const o=e.mapToLocalMultiple(t);let r=null,p=null;if(i)r=o[0],p=o[1];else{const y=o[0],x=o[1],O=Math.round(x.x-y.x),F=Math.round(x.y-y.y),M=Math.max(Math.abs(O),Math.abs(F));r=v(O>0?y.x+M/2:y.x-M/2,F>0?y.y+M/2:y.y-M/2),p=v(Math.abs(O)>Math.abs(F)?r.x-M/2:r.x,Math.abs(O)>Math.abs(F)?r.y:r.y-M/2)}const a=e.localToMap(r),c=e.localToMap(p);if(a==null||c==null)return null;e.doUnnormalization&&lt([[a,c]],e.spatialReference);const g=k(a,e.spatialReference),u=k(c,e.spatialReference),m=pt(e.spatialReference);let f=0;if(Le(e.spatialReference))f=m*Pt(g,u,null);else{const y=r.x-p.x,x=r.y-p.y;f=m*Math.sqrt(y*y+x*x)*(n||1)}const h=new ct({center:g,radius:f,radiusUnit:"meters",spatialReference:e.spatialReference});return{geometry:H(h.rings,h.spatialReference,!1),center:g,edge:u}}function Bt(t,e,i){const n=e.mapToLocalMultiple(t),o=n[0],r=n[1],p=Math.round(r.x-o.x),a=Math.round(r.y-o.y),c=v(i?o.x:o.x+p/2,i?o.y:o.y+a/2),g=i?p:p/2,u=i?a:a/2,m=60,f=[],h=2*Math.PI/m;function y(I){const Je=Math.cos(I),Xe=Math.sin(I);return v(g*Je+c.x,u*Xe+c.y)}for(let I=0;I<m;I++)f.push(y(I*h));f.push(f[0]);const{spatialReference:x,doUnnormalization:O}=e,F=H([f.map(I=>e.localToMap(I)).filter(ne)],x,O,!1),M=e.localToMap(y(Math.PI/2)),ye=e.localToMap(y(0)),me=e.localToMap(y(-Math.PI/2)),ve=e.localToMap(y(Math.PI));return{geometry:F,midpoints:M!=null&&ye!=null&&me!=null&&ve!=null?{top:k(M,x),right:k(ye,x),bottom:k(me,x),left:k(ve,x)}:null}}let z=class extends j{constructor(t){super(t),this.type="draw-point"}};s([l()],z.prototype,"type",void 0),s([l()],z.prototype,"elevation",void 0),s([l()],z.prototype,"viewType",void 0),s([l()],z.prototype,"helpMessage",void 0),z=s([G("esri.views.interactive.tooltip.DrawPointTooltipInfo")],z);let $=class extends j{constructor(t){super(t),this.type="draw-polyline",this.totalLength=V}};s([l()],$.prototype,"type",void 0),s([l()],$.prototype,"elevation",void 0),s([l()],$.prototype,"totalLength",void 0),s([l()],$.prototype,"viewType",void 0),s([l()],$.prototype,"helpMessage",void 0),$=s([G("esri.views.interactive.tooltip.DrawPolylineTooltipInfo")],$);let C=class extends j{constructor(t){super(t),this.type="draw-polygon",this.area=Y}};s([l()],C.prototype,"type",void 0),s([l()],C.prototype,"elevation",void 0),s([l()],C.prototype,"area",void 0),s([l()],C.prototype,"viewType",void 0),s([l()],C.prototype,"helpMessage",void 0),C=s([G("esri.views.interactive.tooltip.DrawPolygonTooltipInfo")],C);let D=class extends j{constructor(e){super(e),this.type="draw-mesh"}};s([l()],D.prototype,"type",void 0),s([l()],D.prototype,"elevation",void 0),s([l()],D.prototype,"viewType",void 0),s([l()],D.prototype,"helpMessage",void 0),D=s([G("esri.views.interactive.tooltip.DrawMeshTooltipInfo")],D);let Z=class extends j{constructor(t){super(t),this.type="draw-rectangle",this.xSize=V,this.ySize=V,this.area=Y}};s([l()],Z.prototype,"type",void 0),s([l()],Z.prototype,"xSize",void 0),s([l()],Z.prototype,"ySize",void 0),s([l()],Z.prototype,"area",void 0),Z=s([G("esri.views.interactive.tooltip.DrawRectangleTooltipInfo")],Z);let P=class extends j{constructor(t){super(t),this.type="draw-circle",this.radius=null,this.xSize=null,this.ySize=null,this.area=Y}};s([l()],P.prototype,"type",void 0),s([l()],P.prototype,"radius",void 0),s([l()],P.prototype,"xSize",void 0),s([l()],P.prototype,"ySize",void 0),s([l()],P.prototype,"area",void 0),P=s([G("esri.views.interactive.tooltip.DrawCircleTooltipInfo")],P);class Jt{constructor(){this.regularVertices=null,this.activeVertex=null,this.full=null,this.outline=null,this.circle=null,this.rectangle=null}}let d=class extends ht(de.EventedMixin(Rt)){constructor(e){super(e),this._graphic=null,this._createOperationGeometry=null,this.defaultZ=0,this.geometryType=null,this.hasZ=!0,this.labelOptions=new oe,this.geometryToPlace=null,this.mode=null,this.snappingManager=null,this.snapToScene=!1,this.tooltip=null,this.tooltipOptions=new re}initialize(){this.internalGraphicsLayer=new ut({listMode:"hide",internal:!0}),this.view.map.layers.add(this.internalGraphicsLayer),this.drawOperation=this.makeDrawOperation(),this.handles.add([this.drawOperation.on("vertex-add",e=>this.onVertexAdd(e)),this.drawOperation.on("vertex-remove",e=>this.onVertexRemove(e)),this.drawOperation.on("vertex-update",e=>this.onVertexUpdate(e)),this.drawOperation.on("cursor-update",e=>this.onCursorUpdate(e)),this.drawOperation.on("complete",e=>this.onComplete(e)),A(()=>this.tooltipOptions.enabled,e=>{this.tooltip=e?new zt({view:this.view,info:this._tooltipInfo}):R(this.tooltip)},te),A(()=>this._tooltipInfo,e=>{this.tooltip!=null&&(this.tooltip.info=e)},te)]),this.finishToolCreation()}destroy(){this.drawOperation=R(this.drawOperation),this.tooltip=R(this.tooltip),this._destroyAllVisualisations(),this.view.map.remove(this.internalGraphicsLayer),this.internalGraphicsLayer=R(this.internalGraphicsLayer),this._set("view",null)}get _defaultElevation(){return $e(this.defaultZ,"meters")}get canRedo(){return this.drawOperation.canRedo}get canUndo(){return this.drawOperation.canUndo}set centered(e){this._set("centered",e),this._updateGraphic()}set enabled(e){this.drawOperation.interactive=e,this._set("enabled",e)}set forceUniformSize(e){this._set("forceUniformSize",e),this._updateGraphic()}get graphic(){return this._graphic}set graphicSymbol(e){this._set("graphicSymbol",e),this._graphic!=null&&(this._graphic.symbol=e)}get updating(){return this.drawOperation?.updating??!1}completeCreateOperation(){this.drawOperation.complete()}onInputEvent(e){this.drawOperation.onInputEvent(e)}redo(){this.drawOperation.redo()}reset(){}undo(){this.drawOperation.undo()}_destroyAllVisualisations(){this.handles.remove(S.outline),this.handles.remove(S.regularVertices),this.handles.remove(S.activeVertex),this.handles.remove(he)}_createOrUpdateGraphic(e){if(this._graphic!=null)return this._updateGraphicGeometry(this._graphic,e),this._graphic;const i=this._graphic=new dt({...this.graphicProperties,symbol:this.graphicSymbol});return this._updateGraphicGeometry(i,e),this.internalGraphicsLayer.add(i),this.handles.add(this.initializeGraphic(i)),this.notifyChange("graphic"),this.handles.add(gt(()=>{this.internalGraphicsLayer.remove(i),R(i),this._graphic===i&&(this._graphic=null)}),he),i}_updateGraphicGeometry(e,i){e.geometry=i}_getCreateOperationGeometry(e={operationComplete:!1}){const{drawOperation:i}=this;if(i==null||i.numVertices===0)return null;const{coordinateHelper:n,view:o}=i,r=i.stagedVertex,p=i.committedVertices,a=p.slice(),c=r!=null;c&&a.push(n.pointToArray(r));const g=c?n.pointToArray(r):p.splice(-1)[0],u=a.length,m=o.spatialReference,f=o.type==="3d"&&o.viewingMode==="global",h=new Jt;switch(this.geometryType){case"point":case"mesh":h.regularVertices=p,h.activeVertex=g,h.full=n.arrayToPoint(a[0]);break;case"multipoint":h.regularVertices=p,h.activeVertex=g,u>0&&(h.full=qt(a,m));break;case"polyline":h.regularVertices=p,h.activeVertex=g,u>0&&(h.full=ze([a],m,f));break;case"polygon":h.regularVertices=p,h.activeVertex=g,u>0&&(h.full=H([a],m,f,!0));break;case"circle":if(u>0){const y=Ee(o,a[0]);if(u===1&&e.operationComplete){const x=a[0],O=y.makeMapPoint(x[0]+ke*o.resolution,x[1]);h.circle=Ze([x,O],y,!0),h.full=h.circle!=null?h.circle.geometry:null}else u===2&&(this.forceUniformSize?(h.circle=Ze(a,y,this.centered),h.full=h.circle!=null?h.circle.geometry:null):(h.rectangle=Bt(a,y,this.centered),h.full=h.rectangle.geometry))}break;case"rectangle":if(u>0){const y=Ee(o,a[0]);if(u===1&&e.operationComplete){const x=a[0],O=y.makeMapPoint(x[0]+ke*o.resolution,x[1]);h.rectangle=De([x,O],y,!0),h.full=h.rectangle.geometry}else u===2&&(h.rectangle=this.forceUniformSize?De(a,y,this.centered):Qt(a,y,this.centered),h.full=h.rectangle.geometry)}break;default:return null}switch(this.geometryType){case"point":case"multipoint":break;case"polyline":h.outline=u>1?ze([a],m,f):null;break;case"polygon":h.outline=u>1?H([a],m,f):null;break;case"circle":case"rectangle":h.outline=h.full?.type==="polygon"?H(h.full.rings,m,f):null}return h}initializeGraphic(e){return null}onComplete(e){this._updateGraphic();let i=null;if(this.drawOperation.isCompleted){const n=this._getCreateOperationGeometry({operationComplete:!0});n!=null&&(i=this._createOrUpdateGraphic(n.full).clone())}this._createOperationGeometry=null,this.emit("complete",{graphic:i,...e})}onCursorUpdate(e){this._updateGraphic(),this.emit("cursor-update",e)}onDeactivate(){this.drawOperation.isCompleted||this.drawOperation.cancel()}onVertexAdd(e){this._updateGraphic(),this.emit("vertex-add",e)}onVertexRemove(e){this._updateGraphic(),this.emit("vertex-remove",e)}onVertexUpdate(e){this._updateGraphic(),this.emit("vertex-update",e)}_updateGraphic(){const e=this._getCreateOperationGeometry();this._createOperationGeometry=e,e!=null?(e.outline!=null?this.handles.add(this.onOutlineChanged(e.outline),S.outline):this.handles.remove(S.outline),e.regularVertices!=null?this.handles.add(this.onRegularVerticesChanged(e.regularVertices),S.regularVertices):this.handles.remove(S.regularVertices),e.activeVertex!=null?this.handles.add(this.onActiveVertexChanged(e.activeVertex),S.activeVertex):this.handles.remove(S.activeVertex),e.full!=null?this._createOrUpdateGraphic(e.full):this.handles.remove(he)):this._destroyAllVisualisations()}get _tooltipInfo(){const{drawOperation:e}=this;if(!e)return null;switch(this.geometryType){case"point":return this._drawPointTooltipInfo;case"polyline":return this._drawPolylineTooltipInfo;case"polygon":return this._drawPolygonTooltipInfo;case"rectangle":return this._drawRectangleTooltipInfo;case"circle":return this._drawCircleTooltipInfo;case"mesh":return this._drawMeshTooltipInfo;default:return null}}get _drawPointTooltipInfo(){const{view:e,graphic:i}=this,n=i?.geometry;return n?.type!=="point"||e.type==="2d"&&this.defaultZ===0?null:new z({tooltipOptions:this.tooltipOptions,elevation:this._elevationTooltipDetail,viewType:e.type,helpMessage:J("point",n,e)})}get _drawPolylineTooltipInfo(){const e=this._createOperationGeometry,i=e!=null?e.full:null;if(i?.type!=="polyline")return null;const n=Et(i,this._elevationMode),{view:o}=this;return new $({tooltipOptions:this.tooltipOptions,elevation:this._elevationTooltipDetail,totalLength:n??V,viewType:o.type,helpMessage:J("polyline",i,o)})}get _drawPolygonTooltipInfo(){const e=this._createOperationGeometry,i=e!=null?e.full:null;if(i?.type!=="polygon")return null;const n=Pe(i,this._elevationMode),{view:o}=this;return new C({tooltipOptions:this.tooltipOptions,elevation:this._elevationTooltipDetail,area:n??Y,viewType:o.type,helpMessage:J("polygon",i,o)})}get _drawMeshTooltipInfo(){const{view:e,graphic:i}=this,n=i?.geometry;return n?.type!=="mesh"||e.type==="2d"&&this.defaultZ===0?null:new D({tooltipOptions:this.tooltipOptions,elevation:this._elevationTooltipDetail,viewType:e.type,helpMessage:J("mesh",n,e)})}get _drawRectangleTooltipInfo(){return this.drawOperation==null?null:new Z({tooltipOptions:this.tooltipOptions,xSize:this._xSize??V,ySize:this._ySize??V,area:this._fullGeometryArea??Y})}get _drawCircleTooltipInfo(){if(this.drawOperation==null)return null;const e=this.forceUniformSize;return new P({tooltipOptions:this.tooltipOptions,radius:e?this._circleRadius??V:null,xSize:e?null:this._xSize??V,ySize:e?null:this._ySize??V,area:this._fullGeometryArea??Y})}get _circleRadius(){const e=this._createOperationGeometry;return e!=null&&e.circle!=null&&e.circle.center!=null&&e.circle.edge!=null?ce(e.circle.center,e.circle.edge,this._elevationMode):null}get _xSize(){const e=this._createOperationGeometry;if(e?.rectangle==null)return null;const{midpoints:i}=e.rectangle;return i!=null?ce(i.left,i.right,this._elevationMode):null}get _ySize(){const e=this._createOperationGeometry;if(e?.rectangle==null)return null;const{midpoints:i}=e.rectangle;return i!=null?ce(i.top,i.bottom,this._elevationMode):null}get _fullGeometryArea(){const e=this._createOperationGeometry,i=e!=null?e.full:null;return i?.type!=="polygon"?null:Pe(i,this._elevationMode)}get _elevationTooltipDetail(){return{mode:this.drawOperation.elevationInfo.mode,...this._vertexTooltipElevation}}get _vertexTooltipElevation(){const{tooltipOptions:e,view:i,drawOperation:n}=this;if(n==null)return this._defaultElevation;const o=n.stagedVertex??n.lastVertex;if(o==null||i.type==="2d")return this._defaultElevation;const r={mode:e.elevation.mode,offset:0},p=(ge(i,o,n.elevationInfo,r)??0)*yt(o.spatialReference);return $e(p,"meters")}get _elevationMode(){return this.drawOperation.isDraped?"on-the-ground":"absolute-height"}};s([l()],d.prototype,"_createOperationGeometry",void 0),s([l()],d.prototype,"_defaultElevation",null),s([l({value:!0})],d.prototype,"centered",null),s([l({nonNullable:!0})],d.prototype,"defaultZ",void 0),s([l()],d.prototype,"drawOperation",void 0),s([l({value:!0})],d.prototype,"enabled",null),s([l({value:!0})],d.prototype,"forceUniformSize",null),s([l({constructOnly:!0})],d.prototype,"geometryType",void 0),s([l()],d.prototype,"graphic",null),s([l({constructOnly:!0})],d.prototype,"graphicProperties",void 0),s([l()],d.prototype,"graphicSymbol",null),s([l({constructOnly:!0})],d.prototype,"hasZ",void 0),s([l({constructOnly:!0,type:oe})],d.prototype,"labelOptions",void 0),s([l({constructOnly:!0})],d.prototype,"geometryToPlace",void 0),s([l({constructOnly:!0})],d.prototype,"mode",void 0),s([l()],d.prototype,"snappingManager",void 0),s([l()],d.prototype,"snapToScene",void 0),s([l()],d.prototype,"tooltip",void 0),s([l({constructOnly:!0,type:re})],d.prototype,"tooltipOptions",void 0),s([l({readOnly:!0})],d.prototype,"type",void 0),s([l({readOnly:!0})],d.prototype,"updating",null),s([l({constructOnly:!0,nonNullable:!0})],d.prototype,"view",void 0),s([l()],d.prototype,"_tooltipInfo",null),s([l()],d.prototype,"_drawPointTooltipInfo",null),s([l()],d.prototype,"_drawPolylineTooltipInfo",null),s([l()],d.prototype,"_drawPolygonTooltipInfo",null),s([l()],d.prototype,"_drawMeshTooltipInfo",null),s([l()],d.prototype,"_drawRectangleTooltipInfo",null),s([l()],d.prototype,"_drawCircleTooltipInfo",null),s([l()],d.prototype,"_circleRadius",null),s([l()],d.prototype,"_xSize",null),s([l()],d.prototype,"_ySize",null),s([l()],d.prototype,"_fullGeometryArea",null),s([l()],d.prototype,"_elevationTooltipDetail",null),s([l()],d.prototype,"_vertexTooltipElevation",null),s([l()],d.prototype,"_elevationMode",null),d=s([G("esri.views.draw.DrawGraphicTool")],d);const he="create-operation-graphic",S={outline:"outline-visual",regularVertices:"regular-vertices-visual",activeVertex:"active-vertex-visual"};function vi(t){switch(t){case"point":case"polyline":case"polygon":case"multipoint":return t;case"circle":case"rectangle":return"segment";case"mesh":return"point"}}const ke=48,Qe="click";class Xt{constructor({grabbableForEvent:e}){this.events=new de,this.interactive=!0,this.selectable=!1,this.cursor=null,this.grabbable=!0,this.grabbableForEvent=e}intersectionDistance(e,i){return 0}attach(){}detach(){}onElevationChange(){}onViewChange(){}}let _=class extends de.EventedMixin(mt){constructor(t){super(t),this._createOperationCompleted=!1,this._pointerDownStates=new Set,this._stagedScreenPoint=null,this._stagedPointerType=null,this.isDraped=!0,this.labelOptions=new oe,this.tooltipOptions=new re,this.cursor=null,this.loading=!1,this.snapToSceneEnabled=null,this.lastVertex=null,t.elevationInfo==null&&(this.elevationInfo=vt(!!t.hasZ))}initialize(){const{geometryType:t,view:e}=this,i=e.spatialReference,n="viewingMode"in e.state?e.state.viewingMode:ft.Local,o=t==="segment"||t==="multipoint"?"polyline":t;this.coordinateHelper=Dt(this.hasZ,this.hasM,i),this._editGeometryOperations=new Zt(new kt(o,this.coordinateHelper)),this._snappingOperation=new At({view:e,constrainResult:a=>a==null?a:this._getEffectiveDrawSurface()?.constrainZ(a)}),this.addHandles([A(()=>this.stagedVertex,a=>{a!=null&&this.emit("cursor-update",{updated:null,vertices:[{componentIndex:0,vertexIndex:this._activeComponent.vertices.length,coordinates:this.coordinateHelper.pointToArray(a)}],operation:"apply",type:"vertex-update"})},{sync:!0,equals:(a,c)=>Tt(a,c,Re)}),A(()=>this.view.viewpoint,(a,c)=>{a&&c&&bt(a,c)&&this._onViewpointChange()})]),this._activeComponent=new Ht(i,n),this._editGeometryOperations.data.components.push(this._activeComponent);const r=this.segmentLabels;r!=null&&(r.context={view:e,editGeometryOperations:this._editGeometryOperations,elevationInfo:this.elevationInfo,labelOptions:this.labelOptions},this.addHandles([A(()=>this.labelOptions.enabled,a=>{r.visible=a},te),this.on("cursor-update",()=>{const a=this.stagedVertex;r.stagedVertex=a!=null?this.coordinateHelper.pointToVector(a):null})])),this.addHandles(this._editGeometryOperations.on(["vertex-add","vertex-update","vertex-remove"],a=>{const c=a.vertices.map(f=>({componentIndex:0,vertexIndex:f.index,coordinates:this.coordinateHelper.vectorToArray(f.pos)})),g=c.map(f=>f.coordinates);switch(a.type){case"vertex-add":this.emit(a.type,{...a,added:g,vertices:c});break;case"vertex-update":this.emit(a.type,{...a,updated:g,vertices:c});break;case"vertex-remove":this.emit(a.type,{...a,removed:g,vertices:c})}const u=this._activeComponent.getLastVertex(),m=u!=null?this.coordinateHelper.vectorToDehydratedPoint(u.pos):null;m!=null&&this.lastVertex!=null&&Re(this.lastVertex,m)||(this.lastVertex=m)}));const p=this._manipulator=new Xt({grabbableForEvent:a=>this.drawingMode!=="click"||a.pointerType==="touch"&&this._snappingEnabled&&this._pointerDownStates.size===1});this.manipulators.add(p),p.grabbable=t!=="point",this.addHandles([this._createManipulatorDragPipeline(p),p.events.on("immediate-click",a=>this._onImmediateClick(a)),p.events.on("immediate-double-click",a=>this._onImmediateDoubleClick(a)),A(()=>({cursor:this.cursor,loading:this.loading}),({cursor:a,loading:c})=>{p.cursor=c?"progress":a},te)]),_t(this,()=>{const a=this.view.inputManager.latestPointerType??"mouse",c=this._getSnappingContext(a);this.snappingManager!=null&&this.updatingHandles.addPromise(we(this._snappingOperation.resnap(this.snappingManager,c)))})}destroy(){R(this.segmentLabels),R(this._snappingOperation),this._editGeometryOperations=R(this._editGeometryOperations)}get _snappingEnabled(){return this.snappingManager!=null&&this.snappingManager.options.effectiveEnabled}get _requiresScenePoint(){const t=this._getEffectiveDrawSurface();return this.view.type==="3d"&&this.drawSurface!==t}get canRedo(){return this._editGeometryOperations.canRedo}get canUndo(){return this._editGeometryOperations.canUndo}get committedVertices(){return this._activeComponent.vertices.map(t=>this.coordinateHelper.vectorToArray(t.pos))}set drawingMode(t){this._set("drawingMode",t??Qe)}get interactive(){return this._manipulator.interactive}set interactive(t){this._manipulator.interactive=t}get isCompleted(){return this._createOperationCompleted}get numCommittedVertices(){return this._activeComponent.vertices.length}get numVertices(){return this.stagedVertex!=null?this._activeComponent.vertices.length+1:this._activeComponent.vertices.length}get snappingOptions(){return this.snappingManager!=null?this.snappingManager.options:null}get stagedVertex(){return this._snappingOperation.stagedPoint}set stagedVertex(t){this._snappingOperation.stagedPoint=We(t)}get updating(){return this.updatingHandles.updating}get vertices(){const t=this.committedVertices;return this.stagedVertex!=null&&t.push(this.coordinateHelper.pointToArray(this.stagedVertex)),t}cancel(){this.complete({aborted:!0})}commitStagedVertex(){if(this._snappingOperation.abort(),this.stagedVertex!=null){const{stagedVertex:t}=this;this.stagedVertex=null,this._editGeometryOperations.appendVertex(this.coordinateHelper.pointToVector(t))}}complete(t){const e=t&&t.aborted||!1;this._snappingOperation.abort(),this.snappingManager!=null&&this.snappingManager.doneSnapping(),this.geometryType==="segment"||this.geometryType==="point"?this.commitStagedVertex():this.stagedVertex=null;const i=this.geometryType==="multipoint"&&this.numVertices===0||this.geometryType==="polyline"&&this.numVertices<2||this.geometryType==="polygon"&&this.numVertices<3;this._createOperationCompleted=!i,(this.isCompleted||e)&&this.emit("complete",{vertices:this.vertices.map((n,o)=>({componentIndex:0,vertexIndex:o,coordinates:n})),aborted:e,type:"complete"})}onInputEvent(t){switch(t.type){case"pointer-down":this._pointerDownStates.add(t.pointerId);break;case"pointer-up":this._pointerDownStates.delete(t.pointerId)}switch(t.type){case"pointer-move":return this._onPointerMove(t);case"hold":return this._onHold(t)}}redo(){this._editGeometryOperations.redo()}undo(){this.snappingManager!=null&&this.snappingManager.doneSnapping(),this._editGeometryOperations.undo()}_closeOnClickVertexIndex(t){const e=this._activeComponent;if(this.geometryType==="polygon"&&e.vertices.length>2){if(this._vertexWithinPointerDistance(e.vertices[0].pos,t))return 0;if(this._vertexWithinPointerDistance(e.vertices[e.vertices.length-1].pos,t))return e.vertices.length-1}return null}_createManipulatorDragPipeline(t){switch(this.drawingMode){case"click":return this._createManipulatorDragPipelineClick(t);case"freehand":return this._createManipulatorDragPipelineFreehand(t);case"hybrid":return this._createManipulatorDragPipelineHybrid(t)}}_createManipulatorDragPipelineClick(t){return pe(t,(e,i,n,o)=>{const r=o==="touch"&&this._snappingEnabled;if(this.isCompleted||!r)return;const{snappingStep:p,cancelSnapping:a}=Nt({predicate:()=>r,snappingManager:this.snappingManager,snappingContext:new Ge({editGeometryOperations:this._editGeometryOperations,elevationInfo:this.elevationInfo,pointer:o,visualizer:this.snappingVisualizer}),updatingHandles:this.updatingHandles,useZ:!this._requiresScenePoint});n=n.next(c=>(r&&this.snappingManager!=null&&this.snappingManager.doneSnapping(),c)).next(a),i.next(this._screenToMapDragEventStep()).next(c=>(c.action==="start"&&(this.stagedVertex=c.mapStart,(this.geometryType==="segment"||r&&this.numVertices===0)&&this.commitStagedVertex()),c)).next(Gt(this.view,this.elevationInfo)).next(...p).next(c=>(r&&(this.stagedVertex=c.mapEnd,c.action==="end"&&this.commitStagedVertex()),c)).next(c=>(c.action==="end"&&(this.geometryType!=="segment"&&this.geometryType!=="point"||this.complete()),c))})}_createManipulatorDragPipelineFreehand(t){return pe(t,(e,i)=>{this.isCompleted||i.next(this._screenToMapDragEventStep()).next(n=>(n.action==="start"&&(this.stagedVertex==null&&(this.stagedVertex=n.mapStart),this.geometryType==="segment"&&this.commitStagedVertex()),n)).next(n=>{switch(n.action){case"start":case"update":this.stagedVertex=n.mapEnd,this.geometryType!=="polygon"&&this.geometryType!=="polyline"||this.commitStagedVertex();break;case"end":this.complete()}return n})})}_createManipulatorDragPipelineHybrid(t){return pe(t,(e,i)=>{this.isCompleted||i.next(this._screenToMapDragEventStep()).next(n=>(n.action==="start"&&(this.stagedVertex==null&&(this.stagedVertex=n.mapStart),this.commitStagedVertex()),n)).next(n=>{switch(n.action){case"start":case"update":this.stagedVertex=n.mapEnd,this.geometryType!=="polygon"&&this.geometryType!=="polyline"||this.commitStagedVertex();break;case"end":this.geometryType!=="segment"&&this.geometryType!=="point"||this.complete()}return n})})}get _drawAtFixedElevation(){return(this.geometryType==="segment"||this.geometryType==="polygon")&&this.numCommittedVertices>0}_getEffectiveDrawSurface(){if(this.elevationDrawSurface==null)return this.drawSurface;if(!this.coordinateHelper.hasZ())return this.elevationDrawSurface.defaultZ=null,this.elevationDrawSurface;let t=this.defaultZ,e=!1;return this.elevationInfo!=null&&this.elevationInfo.mode==="absolute-height"&&(e=!0),this.snapToSceneEnabled!=null&&(e=this.snapToSceneEnabled),this.elevationInfo!=null&&this.elevationInfo.mode==="on-the-ground"&&(e=!1),this._drawAtFixedElevation&&(t=this.coordinateHelper.getZ(this._activeComponent.vertices[0].pos),e=!1),e?this.drawSurface:(this.elevationDrawSurface.defaultZ=t,this.elevationDrawSurface)}_mapToScreen(t){return this._getEffectiveDrawSurface()?.mapToScreen(t)}_onHold(t){this._snappingOperation.abort(),this.drawingMode==="click"&&t.pointerType==="touch"&&this._snappingEnabled&&(this.stagedVertex=t.mapPoint),t.stopPropagation()}_onImmediateClick(t){if(t.pointerType==="mouse"&&t.button===2||this._manipulator.dragging)return;const e=this._activeComponent;if(this._closeOnClickVertexIndex(t.screenPoint)!=null)return t.stopPropagation(),void this.complete();const i=this._screenToMap(t.screenPoint);if(i!=null)switch(this.drawingMode){case"freehand":this.geometryType==="point"&&(this.stagedVertex!=null?this.commitStagedVertex():this._editGeometryOperations.appendVertex(this.coordinateHelper.pointToVector(i)),this.complete());break;case"click":case"hybrid":this._snappingOperation.abort(),this.stagedVertex!=null?this.commitStagedVertex():this._editGeometryOperations.appendVertex(this.coordinateHelper.pointToVector(i)),(this.geometryType==="point"||this.geometryType==="segment"&&e.vertices.length===2||this.geometryType==="segment"&&this.drawingMode==="hybrid"&&e.vertices.length===1)&&this.complete()}t.stopPropagation()}_onImmediateDoubleClick(t){this._manipulator.dragging||this.geometryType==="point"||(this.complete(),t.stopPropagation())}_onPointerMove(t){const e=xt(t.x,t.y);this._stagedScreenPoint=e,this._stagedPointerType=t.pointerType;const i=this._snappingOperation,n=this._manipulator;n.dragging||this._pointerDownStates.has(t.pointerId)||n.grabbing||!n.interactive?i.abort():(t.stopPropagation(),this._updateStagedVertexOnPointerMove(e,t.pointerType))}_onViewpointChange(){const t=this._manipulator;this._stagedScreenPoint&&!t.dragging&&!t.grabbing&&t.interactive?this._updateStagedVertexOnPointerMove(this._stagedScreenPoint,this._stagedPointerType??"mouse"):this._snappingOperation.abort()}_updateStagedVertexOnPointerMove(t,e){const i=this._snappingOperation,n=this._closeOnClickVertexIndex(t);if(n!=null)return this._closeOnVertex(n),void i.abort();const o=this._screenToMap(t),r=this._requiresScenePoint?this.drawSurface?.screenToMap(t):null;if(o==null)return this.cursor=null,void i.abort();this.cursor="crosshair";const p=this.snappingManager;if(p==null)return this.stagedVertex=o,void i.abort();const a=this._getSnappingContext(e);this.updatingHandles.addPromise(we(i.snap({point:o,scenePoint:r},p,a)))}_closeOnVertex(t){this.stagedVertex=null;const e={componentIndex:0,vertexIndex:t,coordinates:this.coordinateHelper.vectorToArray(this._activeComponent.vertices[t].pos)};this.emit("cursor-update",{updated:null,vertices:[e],operation:"apply",type:"vertex-update"})}_screenToMap(t){return this._getEffectiveDrawSurface()?.screenToMap(t)}_screenToMapDragEventStep(){let t=null;return e=>{if(e.action==="start"&&(t=this._screenToMap(e.screenStart)),t==null)return null;const i=this._screenToMap(e.screenEnd);return i!=null?{...e,mapStart:t,mapEnd:i}:null}}_vertexWithinPointerDistance(t,e){const n=this._mapToScreen(this.coordinateHelper.vectorToDehydratedPoint(t));return n!=null&&Kt(n,e,25)}_getSnappingContext(t){const e=this._drawAtFixedElevation?wt(this.elevationDrawSurface,({defaultZ:i})=>i):null;return new Ge({editGeometryOperations:this._editGeometryOperations,elevationInfo:this.elevationInfo,pointer:t,visualizer:this.snappingVisualizer,selfSnappingZ:e!=null?{value:e,elevationInfo:this.elevationInfo}:null})}};function Kt(t,e,i){const n=t.x-e.x,o=t.y-e.y;return n*n+o*o<=i}s([l()],_.prototype,"_snappingEnabled",null),s([l()],_.prototype,"defaultZ",void 0),s([l()],_.prototype,"isDraped",void 0),s([l({value:Qe})],_.prototype,"drawingMode",null),s([l({constructOnly:!0})],_.prototype,"elevationDrawSurface",void 0),s([l({constructOnly:!0})],_.prototype,"elevationInfo",void 0),s([l({constructOnly:!0,type:oe})],_.prototype,"labelOptions",void 0),s([l({constructOnly:!0,type:re})],_.prototype,"tooltipOptions",void 0),s([l({constructOnly:!0})],_.prototype,"geometryType",void 0),s([l({constructOnly:!0})],_.prototype,"hasM",void 0),s([l({constructOnly:!0})],_.prototype,"hasZ",void 0),s([l()],_.prototype,"cursor",void 0),s([l()],_.prototype,"loading",void 0),s([l({constructOnly:!0})],_.prototype,"manipulators",void 0),s([l({constructOnly:!0})],_.prototype,"drawSurface",void 0),s([l({constructOnly:!0})],_.prototype,"segmentLabels",void 0),s([l({constructOnly:!0})],_.prototype,"snappingManager",void 0),s([l({constructOnly:!0})],_.prototype,"snappingVisualizer",void 0),s([l()],_.prototype,"snapToSceneEnabled",void 0),s([l()],_.prototype,"_snappingOperation",void 0),s([l()],_.prototype,"stagedVertex",null),s([l()],_.prototype,"lastVertex",void 0),s([l()],_.prototype,"updating",null),s([l({constructOnly:!0})],_.prototype,"view",void 0),_=s([G("esri.views.draw.DrawOperation")],_);class fi{constructor(e,i,n,o=null){this._elevationInfo=e,this.defaultZ=i,this._view=n,this._excludeGraphics=o}screenToMap(e){if(this.defaultZ!=null)return this._view.sceneIntersectionHelper.intersectElevationFromScreen(Te(e.x,e.y),this._elevationInfo,this.defaultZ,this._excludeGraphics);const i=this._view.sceneIntersectionHelper.intersectElevationFromScreen(Te(e.x,e.y),this._elevationInfo,0,this._excludeGraphics);return i!=null&&(i.z=void 0),i}mapToScreen(e){const i=Ae(e.x,e.y,ge(this._view,e,this._elevationInfo),e.spatialReference);return this._view.toScreen(i)}constrainZ(e){const{defaultZ:i}=this;return i!=null&&e.z!==i&&((e=Ne(e)).z=i),e}}class _i{constructor(e,i,n=[]){this.view=e,this.elevationInfo=i,this.exclude=n}screenToMap(e){const i=this.view.toMap(e,{exclude:this.exclude});return i!=null&&(i.z=Ot(i,this.view,this.elevationInfo)),i}mapToScreen(e){let i=e;return this.elevationInfo!=null&&(i=Ae(e.x,e.y,ge(this.view,e,this.elevationInfo),e.spatialReference)),this.view.toScreen(i)}constrainZ(e){return e}}class xi{constructor(e,i=!1,n=0){this.view=e,this.hasZ=i,this.defaultZ=n,this.mapToScreen=o=>e.toScreen(o),this.screenToMap=i?o=>{const r=e.toMap(o);return r.z=n,r}:o=>e.toMap(o)}constrainZ(e){const{defaultZ:i}=this;return this.hasZ&&e.z!==i&&((e=Ne(e)).z=i),e}}function wi(t,e){return Be(t,e,!1)}function Ti(t,e){return Be(t,e,!0)}function Be(t,e,i){if(t instanceof Ft){if(t.operation instanceof Ut)return ei(t.operation,e,i),!0;if(t.operation instanceof Wt)return ti(t.operation,e,i),!0;if(t.operation instanceof Lt)return ii(t.operation,e,i),!0}return!1}function ei(t,e,i=!1){const n=i?-1:1,o=Mt(n*t.dx,n*t.dy,n*t.dz);Q(e.origin,e.origin,o)}function ti(t,e,i=!1){const n=i?-t.angle:t.angle;be(e.basis1,e.basis1,Oe,n),be(e.basis2,e.basis2,Oe,n)}function ii(t,e,i=!1){const n=i?1/t.factor1:t.factor1,o=i?1/t.factor2:t.factor2;N(e.basis1,e.basis1,n),N(e.basis2,e.basis2,o),Me(e.origin,e.origin,t.origin,t.axis1,n),Me(e.origin,e.origin,t.origin,t.axis2,o)}function bi(t,e,i,n){n||(n=Ye());const o=U(q.get(),t[1],-t[0]),r=U(q.get(),Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY),p=U(q.get(),Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY),a=q.get();e.components.forEach(u=>u.vertices.forEach(m=>{const f=m.pos;U(a,Se(t,f),Se(o,f)),St(r,r,a),Vt(p,p,a)}));const c=1e-6,g=U(q.get(),p[0]-r[0]<c?i/2:0,p[1]-r[1]<c?i/2:0);return It(r,r,g),ae(p,p,g),Ve(n.basis1,t,(p[0]-r[0])/2),Ve(n.basis2,o,(p[1]-r[1])/2),U(n.origin,r[0]*t[0]+r[1]*o[0],r[0]*t[1]+r[1]*o[1]),ae(n.origin,n.origin,n.basis1),ae(n.origin,n.origin,n.basis2),n}function Oi(t,e,i,n=0,o){o||(o=Ye()),e.toRenderCoords(t.origin,i,o.origin);const r=w.get();Q(r,t.origin,t.basis1),Q(r,r,t.basis2),e.toRenderCoords(r,i,r);const p=w.get();Q(p,t.origin,t.basis1),b(p,p,t.basis2),e.toRenderCoords(p,i,p);const a=w.get();b(a,t.origin,t.basis1),b(a,a,t.basis2),e.toRenderCoords(a,i,a);const c=w.get();b(c,t.origin,t.basis1),Q(c,c,t.basis2),e.toRenderCoords(c,i,c);const g=E(w.get(),r,p,.5);b(g,g,o.origin);const u=E(w.get(),a,c,.5);b(u,o.origin,u),E(o.basis1,g,u,.5);const m=E(w.get(),c,r,.5);b(m,m,o.origin);const f=E(w.get(),p,a,.5);b(f,o.origin,f),E(o.basis2,m,f,.5);const h=ue(w.get(),o.basis1,o.basis2),y=ue(h,h,o.basis1);return Fe(y,y),N(o.basis2,y,He(o.basis2,y)),N(o.basis1,o.basis1,1+n/Ie(o.basis1)),N(o.basis2,o.basis2,1+n/Ie(o.basis2)),$t(o),o}function Mi(t,e,i,n){const o=w.get();b(o,b(o,t.origin,t.basis1),t.basis2);const r=w.get();le(r,o,t.basis1,2);const p=w.get();le(p,r,t.basis2,2);const a=w.get();le(a,o,t.basis2,2),o[2]=r[2]=p[2]=a[2]=e;const c=n?"on-the-ground":"absolute-height",g=Ce(X(o,r,i,c),X(a,p,i,c)),u=Ce(X(r,p,i,c),X(o,a,i,c));return u==null||g==null?null:[g,u]}export{d as E,wi as F,Oi as G,vi as H,_ as I,Mi as M,Ti as S,bi as U,xi as c,_i as o,fi as r};
