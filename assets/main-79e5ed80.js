(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))i(s);new MutationObserver(s=>{for(const n of s)if(n.type==="childList")for(const o of n.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&i(o)}).observe(document,{childList:!0,subtree:!0});function r(s){const n={};return s.integrity&&(n.integrity=s.integrity),s.referrerPolicy&&(n.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?n.credentials="include":s.crossOrigin==="anonymous"?n.credentials="omit":n.credentials="same-origin",n}function i(s){if(s.ep)return;s.ep=!0;const n=r(s);fetch(s.href,n)}})();const FOe="modulepreload",UOe=function(t,e){return new URL(t,e).href},WJ={},ae=function(e,r,i){if(!r||r.length===0)return e();const s=document.getElementsByTagName("link");return Promise.all(r.map(n=>{if(n=UOe(n,i),n in WJ)return;WJ[n]=!0;const o=n.endsWith(".css"),a=o?'[rel="stylesheet"]':"";if(!!i)for(let h=s.length-1;h>=0;h--){const p=s[h];if(p.href===n&&(!o||p.rel==="stylesheet"))return}else if(document.querySelector(`link[href="${n}"]${a}`))return;const c=document.createElement("link");if(c.rel=o?"stylesheet":FOe,o||(c.as="script",c.crossOrigin=""),c.href=n,document.head.appendChild(c),o)return new Promise((h,p)=>{c.addEventListener("load",h),c.addEventListener("error",()=>p(new Error(`Unable to preload CSS for ${n}`)))})})).then(()=>e()).catch(n=>{const o=new Event("vite:preloadError",{cancelable:!0});if(o.payload=n,window.dispatchEvent(o),!o.defaultPrevented)throw n})};function u(t,e,r,i){var s,n=arguments.length,o=n<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,r):i;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(t,e,r,i);else for(var a=t.length-1;a>=0;a--)(s=t[a])&&(o=(n<3?s(o):n>3?s(e,r,o):s(e,r))||o);return n>3&&o&&Object.defineProperty(e,r,o),o}function aTt(t,e,r,i){function s(n){return n instanceof r?n:new r(function(o){o(n)})}return new(r||(r=Promise))(function(n,o){function a(h){try{c(i.next(h))}catch(p){o(p)}}function l(h){try{c(i.throw(h))}catch(p){o(p)}}function c(h){h.done?n(h.value):s(h.value).then(a,l)}c((i=i.apply(t,e||[])).next())})}let m3=class Wv{constructor(e=1){this._seed=e}set seed(e){this._seed=e??Math.random()*Wv._m}getInt(){return this._seed=(Wv._a*this._seed+Wv._c)%Wv._m,this._seed}getFloat(){return this.getInt()/(Wv._m-1)}getIntRange(e,r){return Math.round(this.getFloatRange(e,r))}getFloatRange(e,r){const i=r-e;return e+this.getInt()/Wv._m*i}};m3._m=2147483647,m3._a=48271,m3._c=0;const oF=1.5,kOe=1/oF,VOe=.5;function aF(t,e){return e?t.filter((r,i,s)=>s.findIndex(e.bind(null,r))===i):t.filter((r,i,s)=>s.indexOf(r)===i)}function Pg(t,e,r){if(t==null&&e==null)return!0;if(t==null||e==null||t.length!==e.length)return!1;if(r){for(let i=0;i<t.length;i++)if(!r(t[i],e[i]))return!1}else for(let i=0;i<t.length;i++)if(t[i]!==e[i])return!1;return!0}function oq(t,e){let r=t.length!==e.length;r&&(t.length=e.length);for(let i=0;i<e.length;++i)t[i]!==e[i]&&(t[i]=e[i],r=!0);return r}function zOe(t,e,r){let i,s;return r?(i=e.filter(n=>!t.some(o=>r(o,n))),s=t.filter(n=>!e.some(o=>r(o,n)))):(i=e.filter(n=>!t.includes(n)),s=t.filter(n=>!e.includes(n))),{added:i,removed:s}}function BOe(t){return t&&typeof t.length=="number"}function GOe(t,e){const r=t.length;if(r===0)return[];const i=[];for(let s=0;s<r;s+=e)i.push(t.slice(s,s+e));return i}const jOe=!!Array.prototype.fill;function lTt(t,e){if(jOe)return new Array(t).fill(e);const r=new Array(t);for(let i=0;i<t;i++)r[i]=e;return r}function HOe(t,e){e===void 0&&(e=t,t=0);const r=new Array(e-t);for(let i=t;i<e;i++)r[i-t]=i;return r}function hhe(t,e,r){const i=t.length;let s=0,n=i-1;for(;s<n;){const a=s+Math.floor((n-s)/2);e>t[a]?s=a+1:n=a}const o=t[s];return r?e>=t[i-1]?-1:o===e?s:s-1:o===e?s:-1}let dhe=class{constructor(){this.last=0}};const phe=new dhe;function Nk(t,e,r,i){i=i||phe;const s=Math.max(0,i.last-10);for(let o=s;o<r;++o)if(t[o]===e)return i.last=o,o;const n=Math.min(s,r);for(let o=0;o<n;++o)if(t[o]===e)return i.last=o,o;return-1}function dO(t,e,r,i){const s=r??t.length,n=Nk(t,e,s,i);if(n!==-1)return t[n]=t[s-1],r==null&&t.pop(),e}const jh=new Set;function qOe(t,e,r=t.length,i=e.length,s,n){if(i===0||r===0)return r;jh.clear();for(let a=0;a<i;++a)jh.add(e[a]);s=s||phe;const o=Math.max(0,s.last-10);for(let a=o;a<r;++a)if(jh.has(t[a])&&(n&&n.push(t[a]),jh.delete(t[a]),t[a]=t[r-1],--r,--a,jh.size===0||r===0))return jh.clear(),r;for(let a=0;a<o;++a)if(jh.has(t[a])&&(n&&n.push(t[a]),jh.delete(t[a]),t[a]=t[r-1],--r,--a,jh.size===0||r===0))return jh.clear(),r;return jh.clear(),r}function WOe(t,e){let r=0;for(let i=0;i<t.length;++i){const s=t[i];e(s,i)&&(t[r]=s,r++)}t.length=r}function ZOe(t){return t?(ZJ.seed=t,()=>ZJ.getFloat()):Math.random}function uTt(t,e){const r=ZOe(e);for(let i=t.length-1;i>0;i--){const s=Math.floor(r()*(i+1)),n=t[i];t[i]=t[s],t[s]=n}return t}const ZJ=new m3;function aq(t,e){const r=t.indexOf(e);return r!==-1?(t.splice(r,1),e):null}function hTt(t,e){const r=new Map,i=t.length;for(let s=0;s<i;s++){const n=t[s],o=e(n,s,t),a=r.get(o);a?a.push(n):r.set(o,[n])}return r}function xw(t,e){return t!=null}const XOe=[];let q0;function oe(t){return typeof q0[t]=="function"?q0[t]=q0[t](globalThis):q0[t]}q0=globalThis.dojoConfig?.has||globalThis.esriConfig?.has?{...globalThis.dojoConfig?.has,...globalThis.esriConfig?.has}:{},oe.add=(t,e,r,i)=>((i||q0[t]===void 0)&&(q0[t]=e),r&&oe(t)),oe.cache=q0,oe.add("esri-deprecation-warnings",!0),oe.add("esri-force-fullscreen-debug",!1),(()=>{oe.add("host-webworker",globalThis.WorkerGlobalScope!==void 0&&self instanceof globalThis.WorkerGlobalScope);const t=typeof window<"u"&&typeof location<"u"&&typeof document<"u"&&window.location===location&&window.document===document;if(oe.add("host-browser",t),oe.add("host-node",typeof globalThis.process=="object"&&globalThis.process.versions?.node&&globalThis.process.versions.v8),oe.add("dom",t),oe("host-browser")){const e=navigator,r=e.userAgent,i=e.appVersion,s=parseFloat(i);if(oe.add("wp",parseFloat(r.split("Windows Phone")[1])||void 0),oe.add("msapp",parseFloat(r.split("MSAppHost/")[1])||void 0),oe.add("khtml",i.includes("Konqueror")?s:void 0),oe.add("edge",parseFloat(r.split("Edge/")[1])||void 0),oe.add("opr",parseFloat(r.split("OPR/")[1])||void 0),oe.add("webkit",!oe("wp")&&!oe("edge")&&parseFloat(r.split("WebKit/")[1])||void 0),oe.add("chrome",!oe("edge")&&!oe("opr")&&parseFloat(r.split("Chrome/")[1])||void 0),oe.add("android",!oe("wp")&&parseFloat(r.split("Android ")[1])||void 0),oe.add("safari",!i.includes("Safari")||oe("wp")||oe("chrome")||oe("android")||oe("edge")||oe("opr")?void 0:parseFloat(i.split("Version/")[1])),oe.add("mac",i.includes("Macintosh")),!oe("wp")&&/(iPhone|iPod|iPad)/.test(r)){const n=RegExp.$1.replace(/P/,"p"),o=/OS ([\d_]+)/.test(r)?RegExp.$1:"1",a=parseFloat(o.replace(/_/,".").replaceAll("_",""));oe.add(n,a),oe.add("ios",a)}oe("webkit")||(!r.includes("Gecko")||oe("wp")||oe("khtml")||oe("edge")||oe.add("mozilla",s),oe("mozilla")&&oe.add("ff",parseFloat(r.split("Firefox/")[1]||r.split("Minefield/")[1])||void 0))}})(),(()=>{if(globalThis.navigator){const t=navigator.userAgent,e=/Android|webOS|iPhone|iPad|iPod|BlackBerry|Opera Mini|IEMobile/i.test(t),r=/iPhone/i.test(t);e&&oe.add("esri-mobile",e),r&&oe.add("esri-iPhone",r),oe.add("esri-geolocation",!!navigator.geolocation)}oe.add("esri-wasm","WebAssembly"in globalThis),oe.add("esri-shared-array-buffer",()=>{const t="SharedArrayBuffer"in globalThis,e=globalThis.crossOriginIsolated===!1;return t&&!e}),oe.add("wasm-simd",()=>{const t=[0,97,115,109,1,0,0,0,1,5,1,96,0,1,123,3,2,1,0,10,10,1,8,0,65,0,253,15,253,98,11];return WebAssembly.validate(new Uint8Array(t))}),oe.add("esri-atomics","Atomics"in globalThis),oe.add("esri-workers","Worker"in globalThis),oe.add("web-feat:cache","caches"in globalThis),oe.add("esri-workers-arraybuffer-transfer",!oe("safari")||Number(oe("safari"))>=12),oe.add("workers-pool-size",8),oe.add("featurelayer-simplify-thresholds",[.5,.5,.5,.5]),oe.add("featurelayer-simplify-payload-size-factors",[1,1,4]),oe.add("featurelayer-animation-enabled",!0),oe.add("featurelayer-snapshot-enabled",!0),oe.add("featurelayer-snapshot-point-min-threshold",8e4),oe.add("featurelayer-snapshot-point-max-threshold",4e5),oe.add("featurelayer-snapshot-point-coverage",.1),oe.add("featurelayer-advanced-symbols",!1),oe.add("featurelayer-pbf",!0),oe.add("featurelayer-pbf-statistics",!1),oe.add("feature-layers-workers",!0),oe.add("feature-polyline-generalization-factor",1),oe.add("mapview-transitions-duration",200),oe.add("mapview-srswitch-adjust-rotation-scale-threshold",24e6),oe.add("mapserver-pbf-version-support",10.81),oe.add("mapservice-popup-identify-max-tolerance",20),oe.add("heatmap-allow-raster-fallback",!1),oe.add("heatmap-force-raster",!1),oe("host-webworker")||oe("host-browser")&&(oe.add("esri-csp-restrictions",()=>{try{new Function}catch{return!0}return!1}),oe.add("esri-image-decode",()=>{if("decode"in new Image){const t=new Image;return t.src='data:image/svg+xml;charset=UTF-8,<svg version="1.1" xmlns="http://www.w3.org/2000/svg"></svg>',void t.decode().then(()=>{oe.add("esri-image-decode",!0,!0,!0)}).catch(()=>{oe.add("esri-image-decode",!1,!0,!0)})}return!1}),oe.add("esri-url-encodes-apostrophe",()=>{const t=window.document.createElement("a");return t.href="?'",t.href.includes("?%27")}))})();function DC(t){return t instanceof ArrayBuffer}function lq(t){return t?.constructor?.name==="Int8Array"}function W0(t){return t?.constructor?.name==="Uint8Array"}function fhe(t){return t?.constructor?.name==="Uint8ClampedArray"}function lF(t){return t?.constructor?.name==="Int16Array"}function cF(t){return t?.constructor?.name==="Uint16Array"}function uF(t){return t?.constructor?.name==="Int32Array"}function hF(t){return t?.constructor?.name==="Uint32Array"}function B2(t){return t?.constructor?.name==="Float32Array"}function G2(t){return t?.constructor?.name==="Float64Array"}function ip(t){return!("buffer"in t)}function Z0(t){return t!=null?ip(t)?8*t.length+12:t.byteLength+mhe:0}const mhe=145,du=1024;function YOe(t){return G2(t)||B2(t)||uF(t)||lF(t)||lq(t)}function JOe(t){return G2(t)||B2(t)}function QOe(t){return G2(t)?179769e303:B2(t)?3402823e32:hF(t)?4294967295:cF(t)?65535:W0(t)||fhe(t)?255:uF(t)?2147483647:lF(t)?32767:lq(t)?127:256}function dF(t,e){let r;if(e)for(r in t)t.hasOwnProperty(r)&&(t[r]===void 0?delete t[r]:t[r]instanceof Object&&dF(t[r],!0));else for(r in t)t.hasOwnProperty(r)&&t[r]===void 0&&delete t[r];return t}function K(t){if(!t||typeof t!="object"||typeof t=="function")return t;const e=_he(t);if(e!=null)return e;if(RD(t))return t.clone();if(ghe(t))return t.map(K);if(yhe(t))return t.clone();const r={};for(const i of Object.getOwnPropertyNames(t))r[i]=K(t[i]);return r}function Fk(t){if(!t||typeof t!="object"||typeof t=="function"||"HTMLElement"in globalThis&&t instanceof HTMLElement)return t;const e=_he(t);if(e!=null)return e;if(ghe(t)){let r=!0;const i=t.map(s=>{const n=Fk(s);return s!=null&&n==null&&(r=!1),n});return r?i:null}if(RD(t))return t.clone();if(t instanceof File||t instanceof Blob)return t;if(!yhe(t)){const r=new(Object.getPrototypeOf(t)).constructor;for(const i of Object.getOwnPropertyNames(t)){const s=t[i],n=Fk(s);if(s!=null&&n==null)return null;r[i]=n}return r}return null}function RD(t){return typeof t.clone=="function"}function ghe(t){return typeof t.map=="function"&&typeof t.forEach=="function"}function yhe(t){return typeof t.notifyChange=="function"&&typeof t.watch=="function"}function XJ(t){if(Object.prototype.toString.call(t)!=="[object Object]")return!1;const e=Object.getPrototypeOf(t);return e===null||e===Object.prototype}function _he(t){if(lq(t)||W0(t)||fhe(t)||lF(t)||cF(t)||uF(t)||hF(t)||B2(t)||G2(t))return t.slice();if(t instanceof Date)return new Date(t.getTime());if(t instanceof ArrayBuffer)return t.slice(0,t.byteLength);if(t instanceof Map){const e=new Map;for(const[r,i]of t)e.set(r,K(i));return e}if(t instanceof Set){const e=new Set;for(const r of t)e.add(K(r));return e}return null}function cq(t,e){return t===e||typeof t=="number"&&isNaN(t)&&typeof e=="number"&&isNaN(e)||typeof(t||{}).getTime=="function"&&typeof(e||{}).getTime=="function"&&t.getTime()===e.getTime()||!1}function vhe(t,e){return t===e||(t==null||typeof t=="string"?t===e:typeof t=="number"?t===e||typeof e=="number"&&isNaN(t)&&isNaN(e):t instanceof Date?e instanceof Date&&t.getTime()===e.getTime():Array.isArray(t)?Array.isArray(e)&&Pg(t,e):t instanceof Set?e instanceof Set&&eRe(t,e):t instanceof Map?e instanceof Map&&tRe(t,e):!!XJ(t)&&XJ(e)&&KOe(t,e))}function KOe(t,e){if(t===null||e===null)return!1;const r=Object.keys(t);if(e===null||Object.keys(e).length!==r.length)return!1;for(const i of r)if(t[i]!==e[i]||!Object.prototype.hasOwnProperty.call(e,i))return!1;return!0}function eRe(t,e){if(t.size!==e.size)return!1;for(const r of t)if(!e.has(r))return!1;return!0}function tRe(t,e){if(t.size!==e.size)return!1;for(const[r,i]of t){const s=e.get(r);if(s!==i||s===void 0&&!e.has(r))return!1}return!0}function bhe(t,e,r=!1){return xhe(t,e,r)}function ug(t,e){if(e!=null)return e[t]||whe(t.split("."),!1,e)}function Ha(t,e,r){const i=t.split("."),s=i.pop(),n=whe(i,!0,r);n&&s&&(n[s]=e)}function whe(t,e,r){let i=r;for(const s of t){if(i==null)return;if(!(s in i)){if(!e)return;i[s]={}}i=i[s]}return i}function xhe(t,e,r){return e?Object.keys(e).reduce((i,s)=>{let n=i[s],o=e[s];return n===o?i:n===void 0?(i[s]=K(o),i):(Array.isArray(o)||Array.isArray(i)?(n=n?Array.isArray(n)?i[s]=n.concat():i[s]=[n]:i[s]=[],o&&(Array.isArray(o)||(o=[o]),r?o.forEach(a=>{n.includes(a)||n.push(a)}):i[s]=o.concat())):o&&typeof o=="object"?i[s]=xhe(n,o,r):i.hasOwnProperty(s)&&!e.hasOwnProperty(s)||(i[s]=o),i)},t||{}):t}let Rr=class{constructor(e,r={ignoreUnknown:!1,useNumericKeys:!1}){this._jsonToAPI=e,this._options=r,this.apiValues=[],this.jsonValues=[],this._apiToJSON=this._invertMap(e),this.apiValues=this._getKeysSorted(this._apiToJSON),this.jsonValues=this._getKeysSorted(this._jsonToAPI),this.read=i=>this.fromJSON(i),this.write=(i,s,n)=>{const o=this.toJSON(i);o!==void 0&&Ha(n,o,s)},this.write.isJSONMapWriter=!0}toJSON(e){if(e==null)return null;if(this._apiToJSON.hasOwnProperty(e)){const r=this._apiToJSON[e];return this._options.useNumericKeys?+r:r}return this._options.ignoreUnknown?void 0:e}fromJSON(e){return e!=null&&this._jsonToAPI.hasOwnProperty(e)?this._jsonToAPI[e]:this._options.ignoreUnknown?void 0:e}_invertMap(e){const r={};for(const i in e)r[e[i]]=i;return r}_getKeysSorted(e){const r=[];for(const i in e)r.push(i);return r.sort(),r}};function Wa(){return function(t,e){return new Rr(t,{ignoreUnknown:!0,...e})}}let g3;const rRe=globalThis.esriConfig?.locale??globalThis.dojoConfig?.locale;function The(){return rRe??globalThis.navigator?.language??"en"}function _h(){return g3===void 0&&(g3=The()),g3}function pTt(t=_h()){return/^([a-zA-Z]{2,3})(?:[_\-]\w+)*$/.exec(t)?.[1].toLowerCase()}const y3=[];function She(t){return y3.push(t),{remove(){y3.splice(y3.indexOf(t),1)}}}const Uk=[];function uq(t){return Uk.push(t),{remove(){y3.splice(Uk.indexOf(t),1)}}}function iRe(){const t=The();g3!==t&&(g3=t,[...Uk].forEach(e=>{e.call(null,t)}),[...y3].forEach(e=>{e.call(null,t)}))}globalThis.addEventListener?.("languagechange",iRe);class Tw extends Error{}class sRe extends Tw{constructor(e){super(`Invalid DateTime: ${e.toMessage()}`)}}class nRe extends Tw{constructor(e){super(`Invalid Interval: ${e.toMessage()}`)}}class oRe extends Tw{constructor(e){super(`Invalid Duration: ${e.toMessage()}`)}}class NC extends Tw{}class Ehe extends Tw{constructor(e){super(`Invalid unit ${e}`)}}class ih extends Tw{}class dy extends Tw{constructor(){super("Zone is an abstract class")}}const He="numeric",sp="short",ou="long",PD={year:He,month:He,day:He},Che={year:He,month:sp,day:He},aRe={year:He,month:sp,day:He,weekday:sp},Ahe={year:He,month:ou,day:He},Ohe={year:He,month:ou,day:He,weekday:ou},Rhe={hour:He,minute:He},Phe={hour:He,minute:He,second:He},Mhe={hour:He,minute:He,second:He,timeZoneName:sp},Ihe={hour:He,minute:He,second:He,timeZoneName:ou},$he={hour:He,minute:He,hourCycle:"h23"},Lhe={hour:He,minute:He,second:He,hourCycle:"h23"},Dhe={hour:He,minute:He,second:He,hourCycle:"h23",timeZoneName:sp},Nhe={hour:He,minute:He,second:He,hourCycle:"h23",timeZoneName:ou},Fhe={year:He,month:He,day:He,hour:He,minute:He},Uhe={year:He,month:He,day:He,hour:He,minute:He,second:He},khe={year:He,month:sp,day:He,hour:He,minute:He},Vhe={year:He,month:sp,day:He,hour:He,minute:He,second:He},lRe={year:He,month:sp,day:He,weekday:sp,hour:He,minute:He},zhe={year:He,month:ou,day:He,hour:He,minute:He,timeZoneName:sp},Bhe={year:He,month:ou,day:He,hour:He,minute:He,second:He,timeZoneName:sp},Ghe={year:He,month:ou,day:He,weekday:ou,hour:He,minute:He,timeZoneName:ou},jhe={year:He,month:ou,day:He,weekday:ou,hour:He,minute:He,second:He,timeZoneName:ou};class yR{get type(){throw new dy}get name(){throw new dy}get ianaName(){return this.name}get isUniversal(){throw new dy}offsetName(e,r){throw new dy}formatOffset(e,r){throw new dy}offset(e){throw new dy}equals(e){throw new dy}get isValid(){throw new dy}}let k6=null;class pF extends yR{static get instance(){return k6===null&&(k6=new pF),k6}get type(){return"system"}get name(){return new Intl.DateTimeFormat().resolvedOptions().timeZone}get isUniversal(){return!1}offsetName(e,{format:r,locale:i}){return qhe(e,r,i)}formatOffset(e,r){return v3(this.offset(e),r)}offset(e){return-new Date(e).getTimezoneOffset()}equals(e){return e.type==="system"}get isValid(){return!0}}let R$={};function cRe(t){return R$[t]||(R$[t]=new Intl.DateTimeFormat("en-US",{hour12:!1,timeZone:t,year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit",second:"2-digit",era:"short"})),R$[t]}const uRe={year:0,month:1,day:2,era:3,hour:4,minute:5,second:6};function hRe(t,e){const r=t.format(e).replace(/\u200E/g,""),i=/(\d+)\/(\d+)\/(\d+) (AD|BC),? (\d+):(\d+):(\d+)/.exec(r),[,s,n,o,a,l,c,h]=i;return[o,s,n,a,l,c,h]}function dRe(t,e){const r=t.formatToParts(e),i=[];for(let s=0;s<r.length;s++){const{type:n,value:o}=r[s],a=uRe[n];n==="era"?i[a]=o:ii(a)||(i[a]=parseInt(o,10))}return i}let bP={};class Mg extends yR{static create(e){return bP[e]||(bP[e]=new Mg(e)),bP[e]}static resetCache(){bP={},R$={}}static isValidSpecifier(e){return this.isValidZone(e)}static isValidZone(e){if(!e)return!1;try{return new Intl.DateTimeFormat("en-US",{timeZone:e}).format(),!0}catch{return!1}}constructor(e){super(),this.zoneName=e,this.valid=Mg.isValidZone(e)}get type(){return"iana"}get name(){return this.zoneName}get isUniversal(){return!1}offsetName(e,{format:r,locale:i}){return qhe(e,r,i,this.name)}formatOffset(e,r){return v3(this.offset(e),r)}offset(e){const r=new Date(e);if(isNaN(r))return NaN;const i=cRe(this.name);let[s,n,o,a,l,c,h]=i.formatToParts?dRe(i,r):hRe(i,r);a==="BC"&&(s=-Math.abs(s)+1);const f=pq({year:s,month:n,day:o,hour:l===24?0:l,minute:c,second:h,millisecond:0});let m=+r;const y=m%1e3;return m-=y>=0?y:1e3+y,(f-m)/(60*1e3)}equals(e){return e.type==="iana"&&e.name===this.name}get isValid(){return this.valid}}let YJ={};function pRe(t,e={}){const r=JSON.stringify([t,e]);let i=YJ[r];return i||(i=new Intl.ListFormat(t,e),YJ[r]=i),i}let kk={};function Vk(t,e={}){const r=JSON.stringify([t,e]);let i=kk[r];return i||(i=new Intl.DateTimeFormat(t,e),kk[r]=i),i}let zk={};function fRe(t,e={}){const r=JSON.stringify([t,e]);let i=zk[r];return i||(i=new Intl.NumberFormat(t,e),zk[r]=i),i}let Bk={};function mRe(t,e={}){const{base:r,...i}=e,s=JSON.stringify([t,i]);let n=Bk[s];return n||(n=new Intl.RelativeTimeFormat(t,e),Bk[s]=n),n}let FC=null;function gRe(){return FC||(FC=new Intl.DateTimeFormat().resolvedOptions().locale,FC)}function yRe(t){const e=t.indexOf("-x-");e!==-1&&(t=t.substring(0,e));const r=t.indexOf("-u-");if(r===-1)return[t];{let i,s;try{i=Vk(t).resolvedOptions(),s=t}catch{const l=t.substring(0,r);i=Vk(l).resolvedOptions(),s=l}const{numberingSystem:n,calendar:o}=i;return[s,n,o]}}function _Re(t,e,r){return(r||e)&&(t.includes("-u-")||(t+="-u"),r&&(t+=`-ca-${r}`),e&&(t+=`-nu-${e}`)),t}function vRe(t){const e=[];for(let r=1;r<=12;r++){const i=gr.utc(2016,r,1);e.push(t(i))}return e}function bRe(t){const e=[];for(let r=1;r<=7;r++){const i=gr.utc(2016,11,13+r);e.push(t(i))}return e}function wP(t,e,r,i,s){const n=t.listingMode(r);return n==="error"?null:n==="en"?i(e):s(e)}function wRe(t){return t.numberingSystem&&t.numberingSystem!=="latn"?!1:t.numberingSystem==="latn"||!t.locale||t.locale.startsWith("en")||new Intl.DateTimeFormat(t.intl).resolvedOptions().numberingSystem==="latn"}class xRe{constructor(e,r,i){this.padTo=i.padTo||0,this.floor=i.floor||!1;const{padTo:s,floor:n,...o}=i;if(!r||Object.keys(o).length>0){const a={useGrouping:!1,...i};i.padTo>0&&(a.minimumIntegerDigits=i.padTo),this.inf=fRe(e,a)}}format(e){if(this.inf){const r=this.floor?Math.floor(e):e;return this.inf.format(r)}else{const r=this.floor?Math.floor(e):dq(e,3);return Wn(r,this.padTo)}}}class TRe{constructor(e,r,i){this.opts=i,this.originalZone=void 0;let s;if(this.opts.timeZone)this.dt=e;else if(e.zone.type==="fixed"){const o=-1*(e.offset/60),a=o>=0?`Etc/GMT+${o}`:`Etc/GMT${o}`;e.offset!==0&&Mg.create(a).valid?(s=a,this.dt=e):(s="UTC",this.dt=e.offset===0?e:e.setZone("UTC").plus({minutes:e.offset}),this.originalZone=e.zone)}else e.zone.type==="system"?this.dt=e:e.zone.type==="iana"?(this.dt=e,s=e.zone.name):(s="UTC",this.dt=e.setZone("UTC").plus({minutes:e.offset}),this.originalZone=e.zone);const n={...this.opts};n.timeZone=n.timeZone||s,this.dtf=Vk(r,n)}format(){return this.originalZone?this.formatToParts().map(({value:e})=>e).join(""):this.dtf.format(this.dt.toJSDate())}formatToParts(){const e=this.dtf.formatToParts(this.dt.toJSDate());return this.originalZone?e.map(r=>{if(r.type==="timeZoneName"){const i=this.originalZone.offsetName(this.dt.ts,{locale:this.dt.locale,format:this.opts.timeZoneName});return{...r,value:i}}else return r}):e}resolvedOptions(){return this.dtf.resolvedOptions()}}class SRe{constructor(e,r,i){this.opts={style:"long",...i},!r&&Hhe()&&(this.rtf=mRe(e,i))}format(e,r){return this.rtf?this.rtf.format(e,r):zRe(r,e,this.opts.numeric,this.opts.style!=="long")}formatToParts(e,r){return this.rtf?this.rtf.formatToParts(e,r):[]}}class Es{static fromOpts(e){return Es.create(e.locale,e.numberingSystem,e.outputCalendar,e.defaultToEN)}static create(e,r,i,s=!1){const n=e||Hn.defaultLocale,o=n||(s?"en-US":gRe()),a=r||Hn.defaultNumberingSystem,l=i||Hn.defaultOutputCalendar;return new Es(o,a,l,n)}static resetCache(){FC=null,kk={},zk={},Bk={}}static fromObject({locale:e,numberingSystem:r,outputCalendar:i}={}){return Es.create(e,r,i)}constructor(e,r,i,s){const[n,o,a]=yRe(e);this.locale=n,this.numberingSystem=r||o||null,this.outputCalendar=i||a||null,this.intl=_Re(this.locale,this.numberingSystem,this.outputCalendar),this.weekdaysCache={format:{},standalone:{}},this.monthsCache={format:{},standalone:{}},this.meridiemCache=null,this.eraCache={},this.specifiedLocale=s,this.fastNumbersCached=null}get fastNumbers(){return this.fastNumbersCached==null&&(this.fastNumbersCached=wRe(this)),this.fastNumbersCached}listingMode(){const e=this.isEnglish(),r=(this.numberingSystem===null||this.numberingSystem==="latn")&&(this.outputCalendar===null||this.outputCalendar==="gregory");return e&&r?"en":"intl"}clone(e){return!e||Object.getOwnPropertyNames(e).length===0?this:Es.create(e.locale||this.specifiedLocale,e.numberingSystem||this.numberingSystem,e.outputCalendar||this.outputCalendar,e.defaultToEN||!1)}redefaultToEN(e={}){return this.clone({...e,defaultToEN:!0})}redefaultToSystem(e={}){return this.clone({...e,defaultToEN:!1})}months(e,r=!1,i=!0){return wP(this,e,i,Xhe,()=>{const s=r?{month:e,day:"numeric"}:{month:e},n=r?"format":"standalone";return this.monthsCache[n][e]||(this.monthsCache[n][e]=vRe(o=>this.extract(o,s,"month"))),this.monthsCache[n][e]})}weekdays(e,r=!1,i=!0){return wP(this,e,i,Qhe,()=>{const s=r?{weekday:e,year:"numeric",month:"long",day:"numeric"}:{weekday:e},n=r?"format":"standalone";return this.weekdaysCache[n][e]||(this.weekdaysCache[n][e]=bRe(o=>this.extract(o,s,"weekday"))),this.weekdaysCache[n][e]})}meridiems(e=!0){return wP(this,void 0,e,()=>Khe,()=>{if(!this.meridiemCache){const r={hour:"numeric",hourCycle:"h12"};this.meridiemCache=[gr.utc(2016,11,13,9),gr.utc(2016,11,13,19)].map(i=>this.extract(i,r,"dayperiod"))}return this.meridiemCache})}eras(e,r=!0){return wP(this,e,r,ede,()=>{const i={era:e};return this.eraCache[e]||(this.eraCache[e]=[gr.utc(-40,1,1),gr.utc(2017,1,1)].map(s=>this.extract(s,i,"era"))),this.eraCache[e]})}extract(e,r,i){const s=this.dtFormatter(e,r),n=s.formatToParts(),o=n.find(a=>a.type.toLowerCase()===i);return o?o.value:null}numberFormatter(e={}){return new xRe(this.intl,e.forceSimple||this.fastNumbers,e)}dtFormatter(e,r={}){return new TRe(e,this.intl,r)}relFormatter(e={}){return new SRe(this.intl,this.isEnglish(),e)}listFormatter(e={}){return pRe(this.intl,e)}isEnglish(){return this.locale==="en"||this.locale.toLowerCase()==="en-us"||new Intl.DateTimeFormat(this.intl).resolvedOptions().locale.startsWith("en-us")}equals(e){return this.locale===e.locale&&this.numberingSystem===e.numberingSystem&&this.outputCalendar===e.outputCalendar}}let V6=null;class Ba extends yR{static get utcInstance(){return V6===null&&(V6=new Ba(0)),V6}static instance(e){return e===0?Ba.utcInstance:new Ba(e)}static parseSpecifier(e){if(e){const r=e.match(/^utc(?:([+-]\d{1,2})(?::(\d{2}))?)?$/i);if(r)return new Ba(mF(r[1],r[2]))}return null}constructor(e){super(),this.fixed=e}get type(){return"fixed"}get name(){return this.fixed===0?"UTC":`UTC${v3(this.fixed,"narrow")}`}get ianaName(){return this.fixed===0?"Etc/UTC":`Etc/GMT${v3(-this.fixed,"narrow")}`}offsetName(){return this.name}formatOffset(e,r){return v3(this.fixed,r)}get isUniversal(){return!0}offset(){return this.fixed}equals(e){return e.type==="fixed"&&e.fixed===this.fixed}get isValid(){return!0}}class ERe extends yR{constructor(e){super(),this.zoneName=e}get type(){return"invalid"}get name(){return this.zoneName}get isUniversal(){return!1}offsetName(){return null}formatOffset(){return""}offset(){return NaN}equals(){return!1}get isValid(){return!1}}function F0(t,e){if(ii(t)||t===null)return e;if(t instanceof yR)return t;if(CRe(t)){const r=t.toLowerCase();return r==="default"?e:r==="local"||r==="system"?pF.instance:r==="utc"||r==="gmt"?Ba.utcInstance:Ba.parseSpecifier(r)||Mg.create(t)}else return wb(t)?Ba.instance(t):typeof t=="object"&&t.offset&&typeof t.offset=="number"?t:new ERe(t)}let JJ=()=>Date.now(),QJ="system",KJ=null,eQ=null,tQ=null,rQ=60,iQ;class Hn{static get now(){return JJ}static set now(e){JJ=e}static set defaultZone(e){QJ=e}static get defaultZone(){return F0(QJ,pF.instance)}static get defaultLocale(){return KJ}static set defaultLocale(e){KJ=e}static get defaultNumberingSystem(){return eQ}static set defaultNumberingSystem(e){eQ=e}static get defaultOutputCalendar(){return tQ}static set defaultOutputCalendar(e){tQ=e}static get twoDigitCutoffYear(){return rQ}static set twoDigitCutoffYear(e){rQ=e%100}static get throwOnInvalid(){return iQ}static set throwOnInvalid(e){iQ=e}static resetCaches(){Es.resetCache(),Mg.resetCache()}}function ii(t){return typeof t>"u"}function wb(t){return typeof t=="number"}function fF(t){return typeof t=="number"&&t%1===0}function CRe(t){return typeof t=="string"}function ARe(t){return Object.prototype.toString.call(t)==="[object Date]"}function Hhe(){try{return typeof Intl<"u"&&!!Intl.RelativeTimeFormat}catch{return!1}}function ORe(t){return Array.isArray(t)?t:[t]}function sQ(t,e,r){if(t.length!==0)return t.reduce((i,s)=>{const n=[e(s),s];return i&&r(i[0],n[0])===i[0]?i:n},null)[1]}function RRe(t,e){return e.reduce((r,i)=>(r[i]=t[i],r),{})}function WS(t,e){return Object.prototype.hasOwnProperty.call(t,e)}function hg(t,e,r){return fF(t)&&t>=e&&t<=r}function PRe(t,e){return t-e*Math.floor(t/e)}function Wn(t,e=2){const r=t<0;let i;return r?i="-"+(""+-t).padStart(e,"0"):i=(""+t).padStart(e,"0"),i}function A0(t){if(!(ii(t)||t===null||t===""))return parseInt(t,10)}function hv(t){if(!(ii(t)||t===null||t===""))return parseFloat(t)}function hq(t){if(!(ii(t)||t===null||t==="")){const e=parseFloat("0."+t)*1e3;return Math.floor(e)}}function dq(t,e,r=!1){const i=10**e;return(r?Math.trunc:Math.round)(t*i)/i}function _R(t){return t%4===0&&(t%100!==0||t%400===0)}function _3(t){return _R(t)?366:365}function MD(t,e){const r=PRe(e-1,12)+1,i=t+(e-r)/12;return r===2?_R(i)?29:28:[31,null,31,30,31,30,31,31,30,31,30,31][r-1]}function pq(t){let e=Date.UTC(t.year,t.month-1,t.day,t.hour,t.minute,t.second,t.millisecond);return t.year<100&&t.year>=0&&(e=new Date(e),e.setUTCFullYear(t.year,t.month-1,t.day)),+e}function ID(t){const e=(t+Math.floor(t/4)-Math.floor(t/100)+Math.floor(t/400))%7,r=t-1,i=(r+Math.floor(r/4)-Math.floor(r/100)+Math.floor(r/400))%7;return e===4||i===3?53:52}function Gk(t){return t>99?t:t>Hn.twoDigitCutoffYear?1900+t:2e3+t}function qhe(t,e,r,i=null){const s=new Date(t),n={hourCycle:"h23",year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"};i&&(n.timeZone=i);const o={timeZoneName:e,...n},a=new Intl.DateTimeFormat(r,o).formatToParts(s).find(l=>l.type.toLowerCase()==="timezonename");return a?a.value:null}function mF(t,e){let r=parseInt(t,10);Number.isNaN(r)&&(r=0);const i=parseInt(e,10)||0,s=r<0||Object.is(r,-0)?-i:i;return r*60+s}function Whe(t){const e=Number(t);if(typeof t=="boolean"||t===""||Number.isNaN(e))throw new ih(`Invalid unit value ${t}`);return e}function $D(t,e){const r={};for(const i in t)if(WS(t,i)){const s=t[i];if(s==null)continue;r[e(i)]=Whe(s)}return r}function v3(t,e){const r=Math.trunc(Math.abs(t/60)),i=Math.trunc(Math.abs(t%60)),s=t>=0?"+":"-";switch(e){case"short":return`${s}${Wn(r,2)}:${Wn(i,2)}`;case"narrow":return`${s}${r}${i>0?`:${i}`:""}`;case"techie":return`${s}${Wn(r,2)}${Wn(i,2)}`;default:throw new RangeError(`Value format ${e} is out of range for property format`)}}function gF(t){return RRe(t,["hour","minute","second","millisecond"])}const MRe=["January","February","March","April","May","June","July","August","September","October","November","December"],Zhe=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],IRe=["J","F","M","A","M","J","J","A","S","O","N","D"];function Xhe(t){switch(t){case"narrow":return[...IRe];case"short":return[...Zhe];case"long":return[...MRe];case"numeric":return["1","2","3","4","5","6","7","8","9","10","11","12"];case"2-digit":return["01","02","03","04","05","06","07","08","09","10","11","12"];default:return null}}const Yhe=["Monday","Tuesday","Wednesday","Thursday","Friday","Saturday","Sunday"],Jhe=["Mon","Tue","Wed","Thu","Fri","Sat","Sun"],$Re=["M","T","W","T","F","S","S"];function Qhe(t){switch(t){case"narrow":return[...$Re];case"short":return[...Jhe];case"long":return[...Yhe];case"numeric":return["1","2","3","4","5","6","7"];default:return null}}const Khe=["AM","PM"],LRe=["Before Christ","Anno Domini"],DRe=["BC","AD"],NRe=["B","A"];function ede(t){switch(t){case"narrow":return[...NRe];case"short":return[...DRe];case"long":return[...LRe];default:return null}}function FRe(t){return Khe[t.hour<12?0:1]}function URe(t,e){return Qhe(e)[t.weekday-1]}function kRe(t,e){return Xhe(e)[t.month-1]}function VRe(t,e){return ede(e)[t.year<0?0:1]}function zRe(t,e,r="always",i=!1){const s={years:["year","yr."],quarters:["quarter","qtr."],months:["month","mo."],weeks:["week","wk."],days:["day","day","days"],hours:["hour","hr."],minutes:["minute","min."],seconds:["second","sec."]},n=["hours","minutes","seconds"].indexOf(t)===-1;if(r==="auto"&&n){const p=t==="days";switch(e){case 1:return p?"tomorrow":`next ${s[t][0]}`;case-1:return p?"yesterday":`last ${s[t][0]}`;case 0:return p?"today":`this ${s[t][0]}`}}const o=Object.is(e,-0)||e<0,a=Math.abs(e),l=a===1,c=s[t],h=i?l?c[1]:c[2]||c[1]:l?s[t][0]:t;return o?`${a} ${h} ago`:`in ${a} ${h}`}function nQ(t,e){let r="";for(const i of t)i.literal?r+=i.val:r+=e(i.val);return r}const BRe={D:PD,DD:Che,DDD:Ahe,DDDD:Ohe,t:Rhe,tt:Phe,ttt:Mhe,tttt:Ihe,T:$he,TT:Lhe,TTT:Dhe,TTTT:Nhe,f:Fhe,ff:khe,fff:zhe,ffff:Ghe,F:Uhe,FF:Vhe,FFF:Bhe,FFFF:jhe};class ka{static create(e,r={}){return new ka(e,r)}static parseFormat(e){let r=null,i="",s=!1;const n=[];for(let o=0;o<e.length;o++){const a=e.charAt(o);a==="'"?(i.length>0&&n.push({literal:s||/^\s+$/.test(i),val:i}),r=null,i="",s=!s):s||a===r?i+=a:(i.length>0&&n.push({literal:/^\s+$/.test(i),val:i}),i=a,r=a)}return i.length>0&&n.push({literal:s||/^\s+$/.test(i),val:i}),n}static macroTokenToFormatOpts(e){return BRe[e]}constructor(e,r){this.opts=r,this.loc=e,this.systemLoc=null}formatWithSystemDefault(e,r){return this.systemLoc===null&&(this.systemLoc=this.loc.redefaultToSystem()),this.systemLoc.dtFormatter(e,{...this.opts,...r}).format()}formatDateTime(e,r={}){return this.loc.dtFormatter(e,{...this.opts,...r}).format()}formatDateTimeParts(e,r={}){return this.loc.dtFormatter(e,{...this.opts,...r}).formatToParts()}formatInterval(e,r={}){return this.loc.dtFormatter(e.start,{...this.opts,...r}).dtf.formatRange(e.start.toJSDate(),e.end.toJSDate())}resolvedOptions(e,r={}){return this.loc.dtFormatter(e,{...this.opts,...r}).resolvedOptions()}num(e,r=0){if(this.opts.forceSimple)return Wn(e,r);const i={...this.opts};return r>0&&(i.padTo=r),this.loc.numberFormatter(i).format(e)}formatDateTimeFromString(e,r){const i=this.loc.listingMode()==="en",s=this.loc.outputCalendar&&this.loc.outputCalendar!=="gregory",n=(m,y)=>this.loc.extract(e,m,y),o=m=>e.isOffsetFixed&&e.offset===0&&m.allowZ?"Z":e.isValid?e.zone.formatOffset(e.ts,m.format):"",a=()=>i?FRe(e):n({hour:"numeric",hourCycle:"h12"},"dayperiod"),l=(m,y)=>i?kRe(e,m):n(y?{month:m}:{month:m,day:"numeric"},"month"),c=(m,y)=>i?URe(e,m):n(y?{weekday:m}:{weekday:m,month:"long",day:"numeric"},"weekday"),h=m=>{const y=ka.macroTokenToFormatOpts(m);return y?this.formatWithSystemDefault(e,y):m},p=m=>i?VRe(e,m):n({era:m},"era"),f=m=>{switch(m){case"S":return this.num(e.millisecond);case"u":case"SSS":return this.num(e.millisecond,3);case"s":return this.num(e.second);case"ss":return this.num(e.second,2);case"uu":return this.num(Math.floor(e.millisecond/10),2);case"uuu":return this.num(Math.floor(e.millisecond/100));case"m":return this.num(e.minute);case"mm":return this.num(e.minute,2);case"h":return this.num(e.hour%12===0?12:e.hour%12);case"hh":return this.num(e.hour%12===0?12:e.hour%12,2);case"H":return this.num(e.hour);case"HH":return this.num(e.hour,2);case"Z":return o({format:"narrow",allowZ:this.opts.allowZ});case"ZZ":return o({format:"short",allowZ:this.opts.allowZ});case"ZZZ":return o({format:"techie",allowZ:this.opts.allowZ});case"ZZZZ":return e.zone.offsetName(e.ts,{format:"short",locale:this.loc.locale});case"ZZZZZ":return e.zone.offsetName(e.ts,{format:"long",locale:this.loc.locale});case"z":return e.zoneName;case"a":return a();case"d":return s?n({day:"numeric"},"day"):this.num(e.day);case"dd":return s?n({day:"2-digit"},"day"):this.num(e.day,2);case"c":return this.num(e.weekday);case"ccc":return c("short",!0);case"cccc":return c("long",!0);case"ccccc":return c("narrow",!0);case"E":return this.num(e.weekday);case"EEE":return c("short",!1);case"EEEE":return c("long",!1);case"EEEEE":return c("narrow",!1);case"L":return s?n({month:"numeric",day:"numeric"},"month"):this.num(e.month);case"LL":return s?n({month:"2-digit",day:"numeric"},"month"):this.num(e.month,2);case"LLL":return l("short",!0);case"LLLL":return l("long",!0);case"LLLLL":return l("narrow",!0);case"M":return s?n({month:"numeric"},"month"):this.num(e.month);case"MM":return s?n({month:"2-digit"},"month"):this.num(e.month,2);case"MMM":return l("short",!1);case"MMMM":return l("long",!1);case"MMMMM":return l("narrow",!1);case"y":return s?n({year:"numeric"},"year"):this.num(e.year);case"yy":return s?n({year:"2-digit"},"year"):this.num(e.year.toString().slice(-2),2);case"yyyy":return s?n({year:"numeric"},"year"):this.num(e.year,4);case"yyyyyy":return s?n({year:"numeric"},"year"):this.num(e.year,6);case"G":return p("short");case"GG":return p("long");case"GGGGG":return p("narrow");case"kk":return this.num(e.weekYear.toString().slice(-2),2);case"kkkk":return this.num(e.weekYear,4);case"W":return this.num(e.weekNumber);case"WW":return this.num(e.weekNumber,2);case"o":return this.num(e.ordinal);case"ooo":return this.num(e.ordinal,3);case"q":return this.num(e.quarter);case"qq":return this.num(e.quarter,2);case"X":return this.num(Math.floor(e.ts/1e3));case"x":return this.num(e.ts);default:return h(m)}};return nQ(ka.parseFormat(r),f)}formatDurationFromString(e,r){const i=l=>{switch(l[0]){case"S":return"millisecond";case"s":return"second";case"m":return"minute";case"h":return"hour";case"d":return"day";case"w":return"week";case"M":return"month";case"y":return"year";default:return null}},s=l=>c=>{const h=i(c);return h?this.num(l.get(h),c.length):c},n=ka.parseFormat(r),o=n.reduce((l,{literal:c,val:h})=>c?l:l.concat(h),[]),a=e.shiftTo(...o.map(i).filter(l=>l));return nQ(n,s(a))}}class zd{constructor(e,r){this.reason=e,this.explanation=r}toMessage(){return this.explanation?`${this.reason}: ${this.explanation}`:this.reason}}const tde=/[A-Za-z_+-]{1,256}(?::?\/[A-Za-z0-9_+-]{1,256}(?:\/[A-Za-z0-9_+-]{1,256})?)?/;function j2(...t){const e=t.reduce((r,i)=>r+i.source,"");return RegExp(`^${e}$`)}function H2(...t){return e=>t.reduce(([r,i,s],n)=>{const[o,a,l]=n(e,s);return[{...r,...o},a||i,l]},[{},null,1]).slice(0,2)}function q2(t,...e){if(t==null)return[null,null];for(const[r,i]of e){const s=r.exec(t);if(s)return i(s)}return[null,null]}function rde(...t){return(e,r)=>{const i={};let s;for(s=0;s<t.length;s++)i[t[s]]=A0(e[r+s]);return[i,null,r+s]}}const ide=/(?:(Z)|([+-]\d\d)(?::?(\d\d))?)/,GRe=`(?:${ide.source}?(?:\\[(${tde.source})\\])?)?`,fq=/(\d\d)(?::?(\d\d)(?::?(\d\d)(?:[.,](\d{1,30}))?)?)?/,sde=RegExp(`${fq.source}${GRe}`),mq=RegExp(`(?:T${sde.source})?`),jRe=/([+-]\d{6}|\d{4})(?:-?(\d\d)(?:-?(\d\d))?)?/,HRe=/(\d{4})-?W(\d\d)(?:-?(\d))?/,qRe=/(\d{4})-?(\d{3})/,WRe=rde("weekYear","weekNumber","weekDay"),ZRe=rde("year","ordinal"),XRe=/(\d{4})-(\d\d)-(\d\d)/,nde=RegExp(`${fq.source} ?(?:${ide.source}|(${tde.source}))?`),YRe=RegExp(`(?: ${nde.source})?`);function yS(t,e,r){const i=t[e];return ii(i)?r:A0(i)}function JRe(t,e){return[{year:yS(t,e),month:yS(t,e+1,1),day:yS(t,e+2,1)},null,e+3]}function W2(t,e){return[{hours:yS(t,e,0),minutes:yS(t,e+1,0),seconds:yS(t,e+2,0),milliseconds:hq(t[e+3])},null,e+4]}function vR(t,e){const r=!t[e]&&!t[e+1],i=mF(t[e+1],t[e+2]),s=r?null:Ba.instance(i);return[{},s,e+3]}function bR(t,e){const r=t[e]?Mg.create(t[e]):null;return[{},r,e+1]}const QRe=RegExp(`^T?${fq.source}$`),KRe=/^-?P(?:(?:(-?\d{1,20}(?:\.\d{1,20})?)Y)?(?:(-?\d{1,20}(?:\.\d{1,20})?)M)?(?:(-?\d{1,20}(?:\.\d{1,20})?)W)?(?:(-?\d{1,20}(?:\.\d{1,20})?)D)?(?:T(?:(-?\d{1,20}(?:\.\d{1,20})?)H)?(?:(-?\d{1,20}(?:\.\d{1,20})?)M)?(?:(-?\d{1,20})(?:[.,](-?\d{1,20}))?S)?)?)$/;function ePe(t){const[e,r,i,s,n,o,a,l,c]=t,h=e[0]==="-",p=l&&l[0]==="-",f=(m,y=!1)=>m!==void 0&&(y||m&&h)?-m:m;return[{years:f(hv(r)),months:f(hv(i)),weeks:f(hv(s)),days:f(hv(n)),hours:f(hv(o)),minutes:f(hv(a)),seconds:f(hv(l),l==="-0"),milliseconds:f(hq(c),p)}]}const tPe={GMT:0,EDT:-4*60,EST:-5*60,CDT:-5*60,CST:-6*60,MDT:-6*60,MST:-7*60,PDT:-7*60,PST:-8*60};function gq(t,e,r,i,s,n,o){const a={year:e.length===2?Gk(A0(e)):A0(e),month:Zhe.indexOf(r)+1,day:A0(i),hour:A0(s),minute:A0(n)};return o&&(a.second=A0(o)),t&&(a.weekday=t.length>3?Yhe.indexOf(t)+1:Jhe.indexOf(t)+1),a}const rPe=/^(?:(Mon|Tue|Wed|Thu|Fri|Sat|Sun),\s)?(\d{1,2})\s(Jan|Feb|Mar|Apr|May|Jun|Jul|Aug|Sep|Oct|Nov|Dec)\s(\d{2,4})\s(\d\d):(\d\d)(?::(\d\d))?\s(?:(UT|GMT|[ECMP][SD]T)|([Zz])|(?:([+-]\d\d)(\d\d)))$/;function iPe(t){const[,e,r,i,s,n,o,a,l,c,h,p]=t,f=gq(e,s,i,r,n,o,a);let m;return l?m=tPe[l]:c?m=0:m=mF(h,p),[f,new Ba(m)]}function sPe(t){return t.replace(/\([^()]*\)|[\n\t]/g," ").replace(/(\s\s+)/g," ").trim()}const nPe=/^(Mon|Tue|Wed|Thu|Fri|Sat|Sun), (\d\d) (Jan|Feb|Mar|Apr|May|Jun|Jul|Aug|Sep|Oct|Nov|Dec) (\d{4}) (\d\d):(\d\d):(\d\d) GMT$/,oPe=/^(Monday|Tuesday|Wednesday|Thursday|Friday|Saturday|Sunday), (\d\d)-(Jan|Feb|Mar|Apr|May|Jun|Jul|Aug|Sep|Oct|Nov|Dec)-(\d\d) (\d\d):(\d\d):(\d\d) GMT$/,aPe=/^(Mon|Tue|Wed|Thu|Fri|Sat|Sun) (Jan|Feb|Mar|Apr|May|Jun|Jul|Aug|Sep|Oct|Nov|Dec) ( \d|\d\d) (\d\d):(\d\d):(\d\d) (\d{4})$/;function oQ(t){const[,e,r,i,s,n,o,a]=t;return[gq(e,s,i,r,n,o,a),Ba.utcInstance]}function lPe(t){const[,e,r,i,s,n,o,a]=t;return[gq(e,a,r,i,s,n,o),Ba.utcInstance]}const cPe=j2(jRe,mq),uPe=j2(HRe,mq),hPe=j2(qRe,mq),dPe=j2(sde),ode=H2(JRe,W2,vR,bR),pPe=H2(WRe,W2,vR,bR),fPe=H2(ZRe,W2,vR,bR),mPe=H2(W2,vR,bR);function gPe(t){return q2(t,[cPe,ode],[uPe,pPe],[hPe,fPe],[dPe,mPe])}function yPe(t){return q2(sPe(t),[rPe,iPe])}function _Pe(t){return q2(t,[nPe,oQ],[oPe,oQ],[aPe,lPe])}function vPe(t){return q2(t,[KRe,ePe])}const bPe=H2(W2);function wPe(t){return q2(t,[QRe,bPe])}const xPe=j2(XRe,YRe),TPe=j2(nde),SPe=H2(W2,vR,bR);function EPe(t){return q2(t,[xPe,ode],[TPe,SPe])}const CPe="Invalid Duration",ade={weeks:{days:7,hours:7*24,minutes:7*24*60,seconds:7*24*60*60,milliseconds:7*24*60*60*1e3},days:{hours:24,minutes:24*60,seconds:24*60*60,milliseconds:24*60*60*1e3},hours:{minutes:60,seconds:60*60,milliseconds:60*60*1e3},minutes:{seconds:60,milliseconds:60*1e3},seconds:{milliseconds:1e3}},APe={years:{quarters:4,months:12,weeks:52,days:365,hours:365*24,minutes:365*24*60,seconds:365*24*60*60,milliseconds:365*24*60*60*1e3},quarters:{months:3,weeks:13,days:91,hours:91*24,minutes:91*24*60,seconds:91*24*60*60,milliseconds:91*24*60*60*1e3},months:{weeks:4,days:30,hours:30*24,minutes:30*24*60,seconds:30*24*60*60,milliseconds:30*24*60*60*1e3},...ade},xu=146097/400,jw=146097/4800,OPe={years:{quarters:4,months:12,weeks:xu/7,days:xu,hours:xu*24,minutes:xu*24*60,seconds:xu*24*60*60,milliseconds:xu*24*60*60*1e3},quarters:{months:3,weeks:xu/28,days:xu/4,hours:xu*24/4,minutes:xu*24*60/4,seconds:xu*24*60*60/4,milliseconds:xu*24*60*60*1e3/4},months:{weeks:jw/7,days:jw,hours:jw*24,minutes:jw*24*60,seconds:jw*24*60*60,milliseconds:jw*24*60*60*1e3},...ade},Zv=["years","quarters","months","weeks","days","hours","minutes","seconds","milliseconds"],RPe=Zv.slice(0).reverse();function py(t,e,r=!1){const i={values:r?e.values:{...t.values,...e.values||{}},loc:t.loc.clone(e.loc),conversionAccuracy:e.conversionAccuracy||t.conversionAccuracy,matrix:e.matrix||t.matrix};return new ci(i)}function PPe(t){return t<0?Math.floor(t):Math.ceil(t)}function lde(t,e,r,i,s){const n=t[s][r],o=e[r]/n,a=Math.sign(o)===Math.sign(i[s]),l=!a&&i[s]!==0&&Math.abs(o)<=1?PPe(o):Math.trunc(o);i[s]+=l,e[r]-=l*n}function MPe(t,e){RPe.reduce((r,i)=>ii(e[i])?r:(r&&lde(t,e,r,e,i),i),null)}function IPe(t){const e={};for(const[r,i]of Object.entries(t))i!==0&&(e[r]=i);return e}class ci{constructor(e){const r=e.conversionAccuracy==="longterm"||!1;let i=r?OPe:APe;e.matrix&&(i=e.matrix),this.values=e.values,this.loc=e.loc||Es.create(),this.conversionAccuracy=r?"longterm":"casual",this.invalid=e.invalid||null,this.matrix=i,this.isLuxonDuration=!0}static fromMillis(e,r){return ci.fromObject({milliseconds:e},r)}static fromObject(e,r={}){if(e==null||typeof e!="object")throw new ih(`Duration.fromObject: argument expected to be an object, got ${e===null?"null":typeof e}`);return new ci({values:$D(e,ci.normalizeUnit),loc:Es.fromObject(r),conversionAccuracy:r.conversionAccuracy,matrix:r.matrix})}static fromDurationLike(e){if(wb(e))return ci.fromMillis(e);if(ci.isDuration(e))return e;if(typeof e=="object")return ci.fromObject(e);throw new ih(`Unknown duration argument ${e} of type ${typeof e}`)}static fromISO(e,r){const[i]=vPe(e);return i?ci.fromObject(i,r):ci.invalid("unparsable",`the input "${e}" can't be parsed as ISO 8601`)}static fromISOTime(e,r){const[i]=wPe(e);return i?ci.fromObject(i,r):ci.invalid("unparsable",`the input "${e}" can't be parsed as ISO 8601`)}static invalid(e,r=null){if(!e)throw new ih("need to specify a reason the Duration is invalid");const i=e instanceof zd?e:new zd(e,r);if(Hn.throwOnInvalid)throw new oRe(i);return new ci({invalid:i})}static normalizeUnit(e){const r={year:"years",years:"years",quarter:"quarters",quarters:"quarters",month:"months",months:"months",week:"weeks",weeks:"weeks",day:"days",days:"days",hour:"hours",hours:"hours",minute:"minutes",minutes:"minutes",second:"seconds",seconds:"seconds",millisecond:"milliseconds",milliseconds:"milliseconds"}[e&&e.toLowerCase()];if(!r)throw new Ehe(e);return r}static isDuration(e){return e&&e.isLuxonDuration||!1}get locale(){return this.isValid?this.loc.locale:null}get numberingSystem(){return this.isValid?this.loc.numberingSystem:null}toFormat(e,r={}){const i={...r,floor:r.round!==!1&&r.floor!==!1};return this.isValid?ka.create(this.loc,i).formatDurationFromString(this,e):CPe}toHuman(e={}){const r=Zv.map(i=>{const s=this.values[i];return ii(s)?null:this.loc.numberFormatter({style:"unit",unitDisplay:"long",...e,unit:i.slice(0,-1)}).format(s)}).filter(i=>i);return this.loc.listFormatter({type:"conjunction",style:e.listStyle||"narrow",...e}).format(r)}toObject(){return this.isValid?{...this.values}:{}}toISO(){if(!this.isValid)return null;let e="P";return this.years!==0&&(e+=this.years+"Y"),(this.months!==0||this.quarters!==0)&&(e+=this.months+this.quarters*3+"M"),this.weeks!==0&&(e+=this.weeks+"W"),this.days!==0&&(e+=this.days+"D"),(this.hours!==0||this.minutes!==0||this.seconds!==0||this.milliseconds!==0)&&(e+="T"),this.hours!==0&&(e+=this.hours+"H"),this.minutes!==0&&(e+=this.minutes+"M"),(this.seconds!==0||this.milliseconds!==0)&&(e+=dq(this.seconds+this.milliseconds/1e3,3)+"S"),e==="P"&&(e+="T0S"),e}toISOTime(e={}){if(!this.isValid)return null;const r=this.toMillis();if(r<0||r>=864e5)return null;e={suppressMilliseconds:!1,suppressSeconds:!1,includePrefix:!1,format:"extended",...e};const i=this.shiftTo("hours","minutes","seconds","milliseconds");let s=e.format==="basic"?"hhmm":"hh:mm";(!e.suppressSeconds||i.seconds!==0||i.milliseconds!==0)&&(s+=e.format==="basic"?"ss":":ss",(!e.suppressMilliseconds||i.milliseconds!==0)&&(s+=".SSS"));let n=i.toFormat(s);return e.includePrefix&&(n="T"+n),n}toJSON(){return this.toISO()}toString(){return this.toISO()}toMillis(){return this.as("milliseconds")}valueOf(){return this.toMillis()}plus(e){if(!this.isValid)return this;const r=ci.fromDurationLike(e),i={};for(const s of Zv)(WS(r.values,s)||WS(this.values,s))&&(i[s]=r.get(s)+this.get(s));return py(this,{values:i},!0)}minus(e){if(!this.isValid)return this;const r=ci.fromDurationLike(e);return this.plus(r.negate())}mapUnits(e){if(!this.isValid)return this;const r={};for(const i of Object.keys(this.values))r[i]=Whe(e(this.values[i],i));return py(this,{values:r},!0)}get(e){return this[ci.normalizeUnit(e)]}set(e){if(!this.isValid)return this;const r={...this.values,...$D(e,ci.normalizeUnit)};return py(this,{values:r})}reconfigure({locale:e,numberingSystem:r,conversionAccuracy:i,matrix:s}={}){const o={loc:this.loc.clone({locale:e,numberingSystem:r}),matrix:s,conversionAccuracy:i};return py(this,o)}as(e){return this.isValid?this.shiftTo(e).get(e):NaN}normalize(){if(!this.isValid)return this;const e=this.toObject();return MPe(this.matrix,e),py(this,{values:e},!0)}rescale(){if(!this.isValid)return this;const e=IPe(this.normalize().shiftToAll().toObject());return py(this,{values:e},!0)}shiftTo(...e){if(!this.isValid)return this;if(e.length===0)return this;e=e.map(o=>ci.normalizeUnit(o));const r={},i={},s=this.toObject();let n;for(const o of Zv)if(e.indexOf(o)>=0){n=o;let a=0;for(const c in i)a+=this.matrix[c][o]*i[c],i[c]=0;wb(s[o])&&(a+=s[o]);const l=Math.trunc(a);r[o]=l,i[o]=(a*1e3-l*1e3)/1e3;for(const c in s)Zv.indexOf(c)>Zv.indexOf(o)&&lde(this.matrix,s,c,r,o)}else wb(s[o])&&(i[o]=s[o]);for(const o in i)i[o]!==0&&(r[n]+=o===n?i[o]:i[o]/this.matrix[n][o]);return py(this,{values:r},!0).normalize()}shiftToAll(){return this.isValid?this.shiftTo("years","months","weeks","days","hours","minutes","seconds","milliseconds"):this}negate(){if(!this.isValid)return this;const e={};for(const r of Object.keys(this.values))e[r]=this.values[r]===0?0:-this.values[r];return py(this,{values:e},!0)}get years(){return this.isValid?this.values.years||0:NaN}get quarters(){return this.isValid?this.values.quarters||0:NaN}get months(){return this.isValid?this.values.months||0:NaN}get weeks(){return this.isValid?this.values.weeks||0:NaN}get days(){return this.isValid?this.values.days||0:NaN}get hours(){return this.isValid?this.values.hours||0:NaN}get minutes(){return this.isValid?this.values.minutes||0:NaN}get seconds(){return this.isValid?this.values.seconds||0:NaN}get milliseconds(){return this.isValid?this.values.milliseconds||0:NaN}get isValid(){return this.invalid===null}get invalidReason(){return this.invalid?this.invalid.reason:null}get invalidExplanation(){return this.invalid?this.invalid.explanation:null}equals(e){if(!this.isValid||!e.isValid||!this.loc.equals(e.loc))return!1;function r(i,s){return i===void 0||i===0?s===void 0||s===0:i===s}for(const i of Zv)if(!r(this.values[i],e.values[i]))return!1;return!0}}const Hw="Invalid Interval";function $Pe(t,e){return!t||!t.isValid?Qs.invalid("missing or invalid start"):!e||!e.isValid?Qs.invalid("missing or invalid end"):e<t?Qs.invalid("end before start",`The end of an interval must be after its start, but you had start=${t.toISO()} and end=${e.toISO()}`):null}class Qs{constructor(e){this.s=e.start,this.e=e.end,this.invalid=e.invalid||null,this.isLuxonInterval=!0}static invalid(e,r=null){if(!e)throw new ih("need to specify a reason the Interval is invalid");const i=e instanceof zd?e:new zd(e,r);if(Hn.throwOnInvalid)throw new nRe(i);return new Qs({invalid:i})}static fromDateTimes(e,r){const i=RE(e),s=RE(r),n=$Pe(i,s);return n??new Qs({start:i,end:s})}static after(e,r){const i=ci.fromDurationLike(r),s=RE(e);return Qs.fromDateTimes(s,s.plus(i))}static before(e,r){const i=ci.fromDurationLike(r),s=RE(e);return Qs.fromDateTimes(s.minus(i),s)}static fromISO(e,r){const[i,s]=(e||"").split("/",2);if(i&&s){let n,o;try{n=gr.fromISO(i,r),o=n.isValid}catch{o=!1}let a,l;try{a=gr.fromISO(s,r),l=a.isValid}catch{l=!1}if(o&&l)return Qs.fromDateTimes(n,a);if(o){const c=ci.fromISO(s,r);if(c.isValid)return Qs.after(n,c)}else if(l){const c=ci.fromISO(i,r);if(c.isValid)return Qs.before(a,c)}}return Qs.invalid("unparsable",`the input "${e}" can't be parsed as ISO 8601`)}static isInterval(e){return e&&e.isLuxonInterval||!1}get start(){return this.isValid?this.s:null}get end(){return this.isValid?this.e:null}get isValid(){return this.invalidReason===null}get invalidReason(){return this.invalid?this.invalid.reason:null}get invalidExplanation(){return this.invalid?this.invalid.explanation:null}length(e="milliseconds"){return this.isValid?this.toDuration(e).get(e):NaN}count(e="milliseconds"){if(!this.isValid)return NaN;const r=this.start.startOf(e),i=this.end.startOf(e);return Math.floor(i.diff(r,e).get(e))+(i.valueOf()!==this.end.valueOf())}hasSame(e){return this.isValid?this.isEmpty()||this.e.minus(1).hasSame(this.s,e):!1}isEmpty(){return this.s.valueOf()===this.e.valueOf()}isAfter(e){return this.isValid?this.s>e:!1}isBefore(e){return this.isValid?this.e<=e:!1}contains(e){return this.isValid?this.s<=e&&this.e>e:!1}set({start:e,end:r}={}){return this.isValid?Qs.fromDateTimes(e||this.s,r||this.e):this}splitAt(...e){if(!this.isValid)return[];const r=e.map(RE).filter(o=>this.contains(o)).sort(),i=[];let{s}=this,n=0;for(;s<this.e;){const o=r[n]||this.e,a=+o>+this.e?this.e:o;i.push(Qs.fromDateTimes(s,a)),s=a,n+=1}return i}splitBy(e){const r=ci.fromDurationLike(e);if(!this.isValid||!r.isValid||r.as("milliseconds")===0)return[];let{s:i}=this,s=1,n;const o=[];for(;i<this.e;){const a=this.start.plus(r.mapUnits(l=>l*s));n=+a>+this.e?this.e:a,o.push(Qs.fromDateTimes(i,n)),i=n,s+=1}return o}divideEqually(e){return this.isValid?this.splitBy(this.length()/e).slice(0,e):[]}overlaps(e){return this.e>e.s&&this.s<e.e}abutsStart(e){return this.isValid?+this.e==+e.s:!1}abutsEnd(e){return this.isValid?+e.e==+this.s:!1}engulfs(e){return this.isValid?this.s<=e.s&&this.e>=e.e:!1}equals(e){return!this.isValid||!e.isValid?!1:this.s.equals(e.s)&&this.e.equals(e.e)}intersection(e){if(!this.isValid)return this;const r=this.s>e.s?this.s:e.s,i=this.e<e.e?this.e:e.e;return r>=i?null:Qs.fromDateTimes(r,i)}union(e){if(!this.isValid)return this;const r=this.s<e.s?this.s:e.s,i=this.e>e.e?this.e:e.e;return Qs.fromDateTimes(r,i)}static merge(e){const[r,i]=e.sort((s,n)=>s.s-n.s).reduce(([s,n],o)=>n?n.overlaps(o)||n.abutsStart(o)?[s,n.union(o)]:[s.concat([n]),o]:[s,o],[[],null]);return i&&r.push(i),r}static xor(e){let r=null,i=0;const s=[],n=e.map(l=>[{time:l.s,type:"s"},{time:l.e,type:"e"}]),o=Array.prototype.concat(...n),a=o.sort((l,c)=>l.time-c.time);for(const l of a)i+=l.type==="s"?1:-1,i===1?r=l.time:(r&&+r!=+l.time&&s.push(Qs.fromDateTimes(r,l.time)),r=null);return Qs.merge(s)}difference(...e){return Qs.xor([this].concat(e)).map(r=>this.intersection(r)).filter(r=>r&&!r.isEmpty())}toString(){return this.isValid?`[${this.s.toISO()}  ${this.e.toISO()})`:Hw}toLocaleString(e=PD,r={}){return this.isValid?ka.create(this.s.loc.clone(r),e).formatInterval(this):Hw}toISO(e){return this.isValid?`${this.s.toISO(e)}/${this.e.toISO(e)}`:Hw}toISODate(){return this.isValid?`${this.s.toISODate()}/${this.e.toISODate()}`:Hw}toISOTime(e){return this.isValid?`${this.s.toISOTime(e)}/${this.e.toISOTime(e)}`:Hw}toFormat(e,{separator:r="  "}={}){return this.isValid?`${this.s.toFormat(e)}${r}${this.e.toFormat(e)}`:Hw}toDuration(e,r){return this.isValid?this.e.diff(this.s,e,r):ci.invalid(this.invalidReason)}mapEndpoints(e){return Qs.fromDateTimes(e(this.s),e(this.e))}}class xP{static hasDST(e=Hn.defaultZone){const r=gr.now().setZone(e).set({month:12});return!e.isUniversal&&r.offset!==r.set({month:6}).offset}static isValidIANAZone(e){return Mg.isValidZone(e)}static normalizeZone(e){return F0(e,Hn.defaultZone)}static months(e="long",{locale:r=null,numberingSystem:i=null,locObj:s=null,outputCalendar:n="gregory"}={}){return(s||Es.create(r,i,n)).months(e)}static monthsFormat(e="long",{locale:r=null,numberingSystem:i=null,locObj:s=null,outputCalendar:n="gregory"}={}){return(s||Es.create(r,i,n)).months(e,!0)}static weekdays(e="long",{locale:r=null,numberingSystem:i=null,locObj:s=null}={}){return(s||Es.create(r,i,null)).weekdays(e)}static weekdaysFormat(e="long",{locale:r=null,numberingSystem:i=null,locObj:s=null}={}){return(s||Es.create(r,i,null)).weekdays(e,!0)}static meridiems({locale:e=null}={}){return Es.create(e).meridiems()}static eras(e="short",{locale:r=null}={}){return Es.create(r,null,"gregory").eras(e)}static features(){return{relative:Hhe()}}}function aQ(t,e){const r=s=>s.toUTC(0,{keepLocalTime:!0}).startOf("day").valueOf(),i=r(e)-r(t);return Math.floor(ci.fromMillis(i).as("days"))}function LPe(t,e,r){const i=[["years",(l,c)=>c.year-l.year],["quarters",(l,c)=>c.quarter-l.quarter+(c.year-l.year)*4],["months",(l,c)=>c.month-l.month+(c.year-l.year)*12],["weeks",(l,c)=>{const h=aQ(l,c);return(h-h%7)/7}],["days",aQ]],s={},n=t;let o,a;for(const[l,c]of i)r.indexOf(l)>=0&&(o=l,s[l]=c(t,e),a=n.plus(s),a>e?(s[l]--,t=n.plus(s)):t=a);return[t,s,a,o]}function DPe(t,e,r,i){let[s,n,o,a]=LPe(t,e,r);const l=e-s,c=r.filter(p=>["hours","minutes","seconds","milliseconds"].indexOf(p)>=0);c.length===0&&(o<e&&(o=s.plus({[a]:1})),o!==s&&(n[a]=(n[a]||0)+l/(o-s)));const h=ci.fromObject(n,i);return c.length>0?ci.fromMillis(l,i).shiftTo(...c).plus(h):h}const yq={arab:"[-]",arabext:"[-]",bali:"[-]",beng:"[-]",deva:"[-]",fullwide:"[-]",gujr:"[-]",hanidec:"[|||||||||]",khmr:"[-]",knda:"[-]",laoo:"[-]",limb:"[-]",mlym:"[-]",mong:"[-]",mymr:"[-]",orya:"[-]",tamldec:"[-]",telu:"[-]",thai:"[-]",tibt:"[-]",latn:"\\d"},lQ={arab:[1632,1641],arabext:[1776,1785],bali:[6992,7001],beng:[2534,2543],deva:[2406,2415],fullwide:[65296,65303],gujr:[2790,2799],khmr:[6112,6121],knda:[3302,3311],laoo:[3792,3801],limb:[6470,6479],mlym:[3430,3439],mong:[6160,6169],mymr:[4160,4169],orya:[2918,2927],tamldec:[3046,3055],telu:[3174,3183],thai:[3664,3673],tibt:[3872,3881]},NPe=yq.hanidec.replace(/[\[|\]]/g,"").split("");function FPe(t){let e=parseInt(t,10);if(isNaN(e)){e="";for(let r=0;r<t.length;r++){const i=t.charCodeAt(r);if(t[r].search(yq.hanidec)!==-1)e+=NPe.indexOf(t[r]);else for(const s in lQ){const[n,o]=lQ[s];i>=n&&i<=o&&(e+=i-n)}}return parseInt(e,10)}else return e}function Hh({numberingSystem:t},e=""){return new RegExp(`${yq[t||"latn"]}${e}`)}const UPe="missing Intl.DateTimeFormat.formatToParts support";function Si(t,e=r=>r){return{regex:t,deser:([r])=>e(FPe(r))}}const kPe=String.fromCharCode(160),cde=`[ ${kPe}]`,ude=new RegExp(cde,"g");function VPe(t){return t.replace(/\./g,"\\.?").replace(ude,cde)}function cQ(t){return t.replace(/\./g,"").replace(ude," ").toLowerCase()}function qh(t,e){return t===null?null:{regex:RegExp(t.map(VPe).join("|")),deser:([r])=>t.findIndex(i=>cQ(r)===cQ(i))+e}}function uQ(t,e){return{regex:t,deser:([,r,i])=>mF(r,i),groups:e}}function TP(t){return{regex:t,deser:([e])=>e}}function zPe(t){return t.replace(/[\-\[\]{}()*+?.,\\\^$|#\s]/g,"\\$&")}function BPe(t,e){const r=Hh(e),i=Hh(e,"{2}"),s=Hh(e,"{3}"),n=Hh(e,"{4}"),o=Hh(e,"{6}"),a=Hh(e,"{1,2}"),l=Hh(e,"{1,3}"),c=Hh(e,"{1,6}"),h=Hh(e,"{1,9}"),p=Hh(e,"{2,4}"),f=Hh(e,"{4,6}"),m=v=>({regex:RegExp(zPe(v.val)),deser:([w])=>w,literal:!0}),_=(v=>{if(t.literal)return m(v);switch(v.val){case"G":return qh(e.eras("short",!1),0);case"GG":return qh(e.eras("long",!1),0);case"y":return Si(c);case"yy":return Si(p,Gk);case"yyyy":return Si(n);case"yyyyy":return Si(f);case"yyyyyy":return Si(o);case"M":return Si(a);case"MM":return Si(i);case"MMM":return qh(e.months("short",!0,!1),1);case"MMMM":return qh(e.months("long",!0,!1),1);case"L":return Si(a);case"LL":return Si(i);case"LLL":return qh(e.months("short",!1,!1),1);case"LLLL":return qh(e.months("long",!1,!1),1);case"d":return Si(a);case"dd":return Si(i);case"o":return Si(l);case"ooo":return Si(s);case"HH":return Si(i);case"H":return Si(a);case"hh":return Si(i);case"h":return Si(a);case"mm":return Si(i);case"m":return Si(a);case"q":return Si(a);case"qq":return Si(i);case"s":return Si(a);case"ss":return Si(i);case"S":return Si(l);case"SSS":return Si(s);case"u":return TP(h);case"uu":return TP(a);case"uuu":return Si(r);case"a":return qh(e.meridiems(),0);case"kkkk":return Si(n);case"kk":return Si(p,Gk);case"W":return Si(a);case"WW":return Si(i);case"E":case"c":return Si(r);case"EEE":return qh(e.weekdays("short",!1,!1),1);case"EEEE":return qh(e.weekdays("long",!1,!1),1);case"ccc":return qh(e.weekdays("short",!0,!1),1);case"cccc":return qh(e.weekdays("long",!0,!1),1);case"Z":case"ZZ":return uQ(new RegExp(`([+-]${a.source})(?::(${i.source}))?`),2);case"ZZZ":return uQ(new RegExp(`([+-]${a.source})(${i.source})?`),2);case"z":return TP(/[a-z_+-/]{1,256}?/i);case" ":return TP(/[^\S\n\r]/);default:return m(v)}})(t)||{invalidReason:UPe};return _.token=t,_}const GPe={year:{"2-digit":"yy",numeric:"yyyyy"},month:{numeric:"M","2-digit":"MM",short:"MMM",long:"MMMM"},day:{numeric:"d","2-digit":"dd"},weekday:{short:"EEE",long:"EEEE"},dayperiod:"a",dayPeriod:"a",hour:{numeric:"h","2-digit":"hh"},minute:{numeric:"m","2-digit":"mm"},second:{numeric:"s","2-digit":"ss"},timeZoneName:{long:"ZZZZZ",short:"ZZZ"}};function jPe(t,e){const{type:r,value:i}=t;if(r==="literal"){const o=/^\s+$/.test(i);return{literal:!o,val:o?" ":i}}const s=e[r];let n=GPe[r];if(typeof n=="object"&&(n=n[s]),n)return{literal:!1,val:n}}function HPe(t){return[`^${t.map(r=>r.regex).reduce((r,i)=>`${r}(${i.source})`,"")}$`,t]}function qPe(t,e,r){const i=t.match(e);if(i){const s={};let n=1;for(const o in r)if(WS(r,o)){const a=r[o],l=a.groups?a.groups+1:1;!a.literal&&a.token&&(s[a.token.val[0]]=a.deser(i.slice(n,n+l))),n+=l}return[i,s]}else return[i,{}]}function WPe(t){const e=n=>{switch(n){case"S":return"millisecond";case"s":return"second";case"m":return"minute";case"h":case"H":return"hour";case"d":return"day";case"o":return"ordinal";case"L":case"M":return"month";case"y":return"year";case"E":case"c":return"weekday";case"W":return"weekNumber";case"k":return"weekYear";case"q":return"quarter";default:return null}};let r=null,i;return ii(t.z)||(r=Mg.create(t.z)),ii(t.Z)||(r||(r=new Ba(t.Z)),i=t.Z),ii(t.q)||(t.M=(t.q-1)*3+1),ii(t.h)||(t.h<12&&t.a===1?t.h+=12:t.h===12&&t.a===0&&(t.h=0)),t.G===0&&t.y&&(t.y=-t.y),ii(t.u)||(t.S=hq(t.u)),[Object.keys(t).reduce((n,o)=>{const a=e(o);return a&&(n[a]=t[o]),n},{}),r,i]}let z6=null;function ZPe(){return z6||(z6=gr.fromMillis(1555555555555)),z6}function XPe(t,e){if(t.literal)return t;const r=ka.macroTokenToFormatOpts(t.val),i=pde(r,e);return i==null||i.includes(void 0)?t:i}function hde(t,e){return Array.prototype.concat(...t.map(r=>XPe(r,e)))}function dde(t,e,r){const i=hde(ka.parseFormat(r),t),s=i.map(o=>BPe(o,t)),n=s.find(o=>o.invalidReason);if(n)return{input:e,tokens:i,invalidReason:n.invalidReason};{const[o,a]=HPe(s),l=RegExp(o,"i"),[c,h]=qPe(e,l,a),[p,f,m]=h?WPe(h):[null,null,void 0];if(WS(h,"a")&&WS(h,"H"))throw new NC("Can't include meridiem when specifying 24-hour format");return{input:e,tokens:i,regex:l,rawMatches:c,matches:h,result:p,zone:f,specificOffset:m}}}function YPe(t,e,r){const{result:i,zone:s,specificOffset:n,invalidReason:o}=dde(t,e,r);return[i,s,n,o]}function pde(t,e){return t?ka.create(e,t).formatDateTimeParts(ZPe()).map(s=>jPe(s,t)):null}const fde=[0,31,59,90,120,151,181,212,243,273,304,334],mde=[0,31,60,91,121,152,182,213,244,274,305,335];function fh(t,e){return new zd("unit out of range",`you specified ${e} (of type ${typeof e}) as a ${t}, which is invalid`)}function gde(t,e,r){const i=new Date(Date.UTC(t,e-1,r));t<100&&t>=0&&i.setUTCFullYear(i.getUTCFullYear()-1900);const s=i.getUTCDay();return s===0?7:s}function yde(t,e,r){return r+(_R(t)?mde:fde)[e-1]}function _de(t,e){const r=_R(t)?mde:fde,i=r.findIndex(n=>n<e),s=e-r[i];return{month:i+1,day:s}}function jk(t){const{year:e,month:r,day:i}=t,s=yde(e,r,i),n=gde(e,r,i);let o=Math.floor((s-n+10)/7),a;return o<1?(a=e-1,o=ID(a)):o>ID(e)?(a=e+1,o=1):a=e,{weekYear:a,weekNumber:o,weekday:n,...gF(t)}}function hQ(t){const{weekYear:e,weekNumber:r,weekday:i}=t,s=gde(e,1,4),n=_3(e);let o=r*7+i-s-3,a;o<1?(a=e-1,o+=_3(a)):o>n?(a=e+1,o-=_3(e)):a=e;const{month:l,day:c}=_de(a,o);return{year:a,month:l,day:c,...gF(t)}}function B6(t){const{year:e,month:r,day:i}=t,s=yde(e,r,i);return{year:e,ordinal:s,...gF(t)}}function dQ(t){const{year:e,ordinal:r}=t,{month:i,day:s}=_de(e,r);return{year:e,month:i,day:s,...gF(t)}}function JPe(t){const e=fF(t.weekYear),r=hg(t.weekNumber,1,ID(t.weekYear)),i=hg(t.weekday,1,7);return e?r?i?!1:fh("weekday",t.weekday):fh("week",t.week):fh("weekYear",t.weekYear)}function QPe(t){const e=fF(t.year),r=hg(t.ordinal,1,_3(t.year));return e?r?!1:fh("ordinal",t.ordinal):fh("year",t.year)}function vde(t){const e=fF(t.year),r=hg(t.month,1,12),i=hg(t.day,1,MD(t.year,t.month));return e?r?i?!1:fh("day",t.day):fh("month",t.month):fh("year",t.year)}function bde(t){const{hour:e,minute:r,second:i,millisecond:s}=t,n=hg(e,0,23)||e===24&&r===0&&i===0&&s===0,o=hg(r,0,59),a=hg(i,0,59),l=hg(s,0,999);return n?o?a?l?!1:fh("millisecond",s):fh("second",i):fh("minute",r):fh("hour",e)}const G6="Invalid DateTime",pQ=864e13;function SP(t){return new zd("unsupported zone",`the zone "${t.name}" is not supported`)}function j6(t){return t.weekData===null&&(t.weekData=jk(t.c)),t.weekData}function AE(t,e){const r={ts:t.ts,zone:t.zone,c:t.c,o:t.o,loc:t.loc,invalid:t.invalid};return new gr({...r,...e,old:r})}function wde(t,e,r){let i=t-e*60*1e3;const s=r.offset(i);if(e===s)return[i,e];i-=(s-e)*60*1e3;const n=r.offset(i);return s===n?[i,s]:[t-Math.min(s,n)*60*1e3,Math.max(s,n)]}function fQ(t,e){t+=e*60*1e3;const r=new Date(t);return{year:r.getUTCFullYear(),month:r.getUTCMonth()+1,day:r.getUTCDate(),hour:r.getUTCHours(),minute:r.getUTCMinutes(),second:r.getUTCSeconds(),millisecond:r.getUTCMilliseconds()}}function P$(t,e,r){return wde(pq(t),e,r)}function mQ(t,e){const r=t.o,i=t.c.year+Math.trunc(e.years),s=t.c.month+Math.trunc(e.months)+Math.trunc(e.quarters)*3,n={...t.c,year:i,month:s,day:Math.min(t.c.day,MD(i,s))+Math.trunc(e.days)+Math.trunc(e.weeks)*7},o=ci.fromObject({years:e.years-Math.trunc(e.years),quarters:e.quarters-Math.trunc(e.quarters),months:e.months-Math.trunc(e.months),weeks:e.weeks-Math.trunc(e.weeks),days:e.days-Math.trunc(e.days),hours:e.hours,minutes:e.minutes,seconds:e.seconds,milliseconds:e.milliseconds}).as("milliseconds"),a=pq(n);let[l,c]=wde(a,r,t.zone);return o!==0&&(l+=o,c=t.zone.offset(l)),{ts:l,o:c}}function OE(t,e,r,i,s,n){const{setZone:o,zone:a}=r;if(t&&Object.keys(t).length!==0||e){const l=e||a,c=gr.fromObject(t,{...r,zone:l,specificOffset:n});return o?c:c.setZone(a)}else return gr.invalid(new zd("unparsable",`the input "${s}" can't be parsed as ${i}`))}function EP(t,e,r=!0){return t.isValid?ka.create(Es.create("en-US"),{allowZ:r,forceSimple:!0}).formatDateTimeFromString(t,e):null}function H6(t,e){const r=t.c.year>9999||t.c.year<0;let i="";return r&&t.c.year>=0&&(i+="+"),i+=Wn(t.c.year,r?6:4),e?(i+="-",i+=Wn(t.c.month),i+="-",i+=Wn(t.c.day)):(i+=Wn(t.c.month),i+=Wn(t.c.day)),i}function gQ(t,e,r,i,s,n){let o=Wn(t.c.hour);return e?(o+=":",o+=Wn(t.c.minute),(t.c.second!==0||!r)&&(o+=":")):o+=Wn(t.c.minute),(t.c.second!==0||!r)&&(o+=Wn(t.c.second),(t.c.millisecond!==0||!i)&&(o+=".",o+=Wn(t.c.millisecond,3))),s&&(t.isOffsetFixed&&t.offset===0&&!n?o+="Z":t.o<0?(o+="-",o+=Wn(Math.trunc(-t.o/60)),o+=":",o+=Wn(Math.trunc(-t.o%60))):(o+="+",o+=Wn(Math.trunc(t.o/60)),o+=":",o+=Wn(Math.trunc(t.o%60)))),n&&(o+="["+t.zone.ianaName+"]"),o}const xde={month:1,day:1,hour:0,minute:0,second:0,millisecond:0},KPe={weekNumber:1,weekday:1,hour:0,minute:0,second:0,millisecond:0},eMe={ordinal:1,hour:0,minute:0,second:0,millisecond:0},Tde=["year","month","day","hour","minute","second","millisecond"],tMe=["weekYear","weekNumber","weekday","hour","minute","second","millisecond"],rMe=["year","ordinal","hour","minute","second","millisecond"];function yQ(t){const e={year:"year",years:"year",month:"month",months:"month",day:"day",days:"day",hour:"hour",hours:"hour",minute:"minute",minutes:"minute",quarter:"quarter",quarters:"quarter",second:"second",seconds:"second",millisecond:"millisecond",milliseconds:"millisecond",weekday:"weekday",weekdays:"weekday",weeknumber:"weekNumber",weeksnumber:"weekNumber",weeknumbers:"weekNumber",weekyear:"weekYear",weekyears:"weekYear",ordinal:"ordinal"}[t.toLowerCase()];if(!e)throw new Ehe(t);return e}function _Q(t,e){const r=F0(e.zone,Hn.defaultZone),i=Es.fromObject(e),s=Hn.now();let n,o;if(ii(t.year))n=s;else{for(const c of Tde)ii(t[c])&&(t[c]=xde[c]);const a=vde(t)||bde(t);if(a)return gr.invalid(a);const l=r.offset(s);[n,o]=P$(t,l,r)}return new gr({ts:n,zone:r,loc:i,o})}function vQ(t,e,r){const i=ii(r.round)?!0:r.round,s=(o,a)=>(o=dq(o,i||r.calendary?0:2,!0),e.loc.clone(r).relFormatter(r).format(o,a)),n=o=>r.calendary?e.hasSame(t,o)?0:e.startOf(o).diff(t.startOf(o),o).get(o):e.diff(t,o).get(o);if(r.unit)return s(n(r.unit),r.unit);for(const o of r.units){const a=n(o);if(Math.abs(a)>=1)return s(a,o)}return s(t>e?-0:0,r.units[r.units.length-1])}function bQ(t){let e={},r;return t.length>0&&typeof t[t.length-1]=="object"?(e=t[t.length-1],r=Array.from(t).slice(0,t.length-1)):r=Array.from(t),[e,r]}class gr{constructor(e){const r=e.zone||Hn.defaultZone;let i=e.invalid||(Number.isNaN(e.ts)?new zd("invalid input"):null)||(r.isValid?null:SP(r));this.ts=ii(e.ts)?Hn.now():e.ts;let s=null,n=null;if(!i)if(e.old&&e.old.ts===this.ts&&e.old.zone.equals(r))[s,n]=[e.old.c,e.old.o];else{const a=r.offset(this.ts);s=fQ(this.ts,a),i=Number.isNaN(s.year)?new zd("invalid input"):null,s=i?null:s,n=i?null:a}this._zone=r,this.loc=e.loc||Es.create(),this.invalid=i,this.weekData=null,this.c=s,this.o=n,this.isLuxonDateTime=!0}static now(){return new gr({})}static local(){const[e,r]=bQ(arguments),[i,s,n,o,a,l,c]=r;return _Q({year:i,month:s,day:n,hour:o,minute:a,second:l,millisecond:c},e)}static utc(){const[e,r]=bQ(arguments),[i,s,n,o,a,l,c]=r;return e.zone=Ba.utcInstance,_Q({year:i,month:s,day:n,hour:o,minute:a,second:l,millisecond:c},e)}static fromJSDate(e,r={}){const i=ARe(e)?e.valueOf():NaN;if(Number.isNaN(i))return gr.invalid("invalid input");const s=F0(r.zone,Hn.defaultZone);return s.isValid?new gr({ts:i,zone:s,loc:Es.fromObject(r)}):gr.invalid(SP(s))}static fromMillis(e,r={}){if(wb(e))return e<-pQ||e>pQ?gr.invalid("Timestamp out of range"):new gr({ts:e,zone:F0(r.zone,Hn.defaultZone),loc:Es.fromObject(r)});throw new ih(`fromMillis requires a numerical input, but received a ${typeof e} with value ${e}`)}static fromSeconds(e,r={}){if(wb(e))return new gr({ts:e*1e3,zone:F0(r.zone,Hn.defaultZone),loc:Es.fromObject(r)});throw new ih("fromSeconds requires a numerical input")}static fromObject(e,r={}){e=e||{};const i=F0(r.zone,Hn.defaultZone);if(!i.isValid)return gr.invalid(SP(i));const s=Hn.now(),n=ii(r.specificOffset)?i.offset(s):r.specificOffset,o=$D(e,yQ),a=!ii(o.ordinal),l=!ii(o.year),c=!ii(o.month)||!ii(o.day),h=l||c,p=o.weekYear||o.weekNumber,f=Es.fromObject(r);if((h||a)&&p)throw new NC("Can't mix weekYear/weekNumber units with year/month/day or ordinals");if(c&&a)throw new NC("Can't mix ordinal dates with month/day");const m=p||o.weekday&&!h;let y,_,v=fQ(s,n);m?(y=tMe,_=KPe,v=jk(v)):a?(y=rMe,_=eMe,v=B6(v)):(y=Tde,_=xde);let w=!1;for(const M of y){const k=o[M];ii(k)?w?o[M]=_[M]:o[M]=v[M]:w=!0}const x=m?JPe(o):a?QPe(o):vde(o),T=x||bde(o);if(T)return gr.invalid(T);const S=m?hQ(o):a?dQ(o):o,[O,A]=P$(S,n,i),I=new gr({ts:O,zone:i,o:A,loc:f});return o.weekday&&h&&e.weekday!==I.weekday?gr.invalid("mismatched weekday",`you can't specify both a weekday of ${o.weekday} and a date of ${I.toISO()}`):I}static fromISO(e,r={}){const[i,s]=gPe(e);return OE(i,s,r,"ISO 8601",e)}static fromRFC2822(e,r={}){const[i,s]=yPe(e);return OE(i,s,r,"RFC 2822",e)}static fromHTTP(e,r={}){const[i,s]=_Pe(e);return OE(i,s,r,"HTTP",r)}static fromFormat(e,r,i={}){if(ii(e)||ii(r))throw new ih("fromFormat requires an input string and a format");const{locale:s=null,numberingSystem:n=null}=i,o=Es.fromOpts({locale:s,numberingSystem:n,defaultToEN:!0}),[a,l,c,h]=YPe(o,e,r);return h?gr.invalid(h):OE(a,l,i,`format ${r}`,e,c)}static fromString(e,r,i={}){return gr.fromFormat(e,r,i)}static fromSQL(e,r={}){const[i,s]=EPe(e);return OE(i,s,r,"SQL",e)}static invalid(e,r=null){if(!e)throw new ih("need to specify a reason the DateTime is invalid");const i=e instanceof zd?e:new zd(e,r);if(Hn.throwOnInvalid)throw new sRe(i);return new gr({invalid:i})}static isDateTime(e){return e&&e.isLuxonDateTime||!1}static parseFormatForOpts(e,r={}){const i=pde(e,Es.fromObject(r));return i?i.map(s=>s?s.val:null).join(""):null}static expandFormat(e,r={}){return hde(ka.parseFormat(e),Es.fromObject(r)).map(s=>s.val).join("")}get(e){return this[e]}get isValid(){return this.invalid===null}get invalidReason(){return this.invalid?this.invalid.reason:null}get invalidExplanation(){return this.invalid?this.invalid.explanation:null}get locale(){return this.isValid?this.loc.locale:null}get numberingSystem(){return this.isValid?this.loc.numberingSystem:null}get outputCalendar(){return this.isValid?this.loc.outputCalendar:null}get zone(){return this._zone}get zoneName(){return this.isValid?this.zone.name:null}get year(){return this.isValid?this.c.year:NaN}get quarter(){return this.isValid?Math.ceil(this.c.month/3):NaN}get month(){return this.isValid?this.c.month:NaN}get day(){return this.isValid?this.c.day:NaN}get hour(){return this.isValid?this.c.hour:NaN}get minute(){return this.isValid?this.c.minute:NaN}get second(){return this.isValid?this.c.second:NaN}get millisecond(){return this.isValid?this.c.millisecond:NaN}get weekYear(){return this.isValid?j6(this).weekYear:NaN}get weekNumber(){return this.isValid?j6(this).weekNumber:NaN}get weekday(){return this.isValid?j6(this).weekday:NaN}get ordinal(){return this.isValid?B6(this.c).ordinal:NaN}get monthShort(){return this.isValid?xP.months("short",{locObj:this.loc})[this.month-1]:null}get monthLong(){return this.isValid?xP.months("long",{locObj:this.loc})[this.month-1]:null}get weekdayShort(){return this.isValid?xP.weekdays("short",{locObj:this.loc})[this.weekday-1]:null}get weekdayLong(){return this.isValid?xP.weekdays("long",{locObj:this.loc})[this.weekday-1]:null}get offset(){return this.isValid?+this.o:NaN}get offsetNameShort(){return this.isValid?this.zone.offsetName(this.ts,{format:"short",locale:this.locale}):null}get offsetNameLong(){return this.isValid?this.zone.offsetName(this.ts,{format:"long",locale:this.locale}):null}get isOffsetFixed(){return this.isValid?this.zone.isUniversal:null}get isInDST(){return this.isOffsetFixed?!1:this.offset>this.set({month:1,day:1}).offset||this.offset>this.set({month:5}).offset}get isInLeapYear(){return _R(this.year)}get daysInMonth(){return MD(this.year,this.month)}get daysInYear(){return this.isValid?_3(this.year):NaN}get weeksInWeekYear(){return this.isValid?ID(this.weekYear):NaN}resolvedLocaleOptions(e={}){const{locale:r,numberingSystem:i,calendar:s}=ka.create(this.loc.clone(e),e).resolvedOptions(this);return{locale:r,numberingSystem:i,outputCalendar:s}}toUTC(e=0,r={}){return this.setZone(Ba.instance(e),r)}toLocal(){return this.setZone(Hn.defaultZone)}setZone(e,{keepLocalTime:r=!1,keepCalendarTime:i=!1}={}){if(e=F0(e,Hn.defaultZone),e.equals(this.zone))return this;if(e.isValid){let s=this.ts;if(r||i){const n=e.offset(this.ts),o=this.toObject();[s]=P$(o,n,e)}return AE(this,{ts:s,zone:e})}else return gr.invalid(SP(e))}reconfigure({locale:e,numberingSystem:r,outputCalendar:i}={}){const s=this.loc.clone({locale:e,numberingSystem:r,outputCalendar:i});return AE(this,{loc:s})}setLocale(e){return this.reconfigure({locale:e})}set(e){if(!this.isValid)return this;const r=$D(e,yQ),i=!ii(r.weekYear)||!ii(r.weekNumber)||!ii(r.weekday),s=!ii(r.ordinal),n=!ii(r.year),o=!ii(r.month)||!ii(r.day),a=n||o,l=r.weekYear||r.weekNumber;if((a||s)&&l)throw new NC("Can't mix weekYear/weekNumber units with year/month/day or ordinals");if(o&&s)throw new NC("Can't mix ordinal dates with month/day");let c;i?c=hQ({...jk(this.c),...r}):ii(r.ordinal)?(c={...this.toObject(),...r},ii(r.day)&&(c.day=Math.min(MD(c.year,c.month),c.day))):c=dQ({...B6(this.c),...r});const[h,p]=P$(c,this.o,this.zone);return AE(this,{ts:h,o:p})}plus(e){if(!this.isValid)return this;const r=ci.fromDurationLike(e);return AE(this,mQ(this,r))}minus(e){if(!this.isValid)return this;const r=ci.fromDurationLike(e).negate();return AE(this,mQ(this,r))}startOf(e){if(!this.isValid)return this;const r={},i=ci.normalizeUnit(e);switch(i){case"years":r.month=1;case"quarters":case"months":r.day=1;case"weeks":case"days":r.hour=0;case"hours":r.minute=0;case"minutes":r.second=0;case"seconds":r.millisecond=0;break}if(i==="weeks"&&(r.weekday=1),i==="quarters"){const s=Math.ceil(this.month/3);r.month=(s-1)*3+1}return this.set(r)}endOf(e){return this.isValid?this.plus({[e]:1}).startOf(e).minus(1):this}toFormat(e,r={}){return this.isValid?ka.create(this.loc.redefaultToEN(r)).formatDateTimeFromString(this,e):G6}toLocaleString(e=PD,r={}){return this.isValid?ka.create(this.loc.clone(r),e).formatDateTime(this):G6}toLocaleParts(e={}){return this.isValid?ka.create(this.loc.clone(e),e).formatDateTimeParts(this):[]}toISO({format:e="extended",suppressSeconds:r=!1,suppressMilliseconds:i=!1,includeOffset:s=!0,extendedZone:n=!1}={}){if(!this.isValid)return null;const o=e==="extended";let a=H6(this,o);return a+="T",a+=gQ(this,o,r,i,s,n),a}toISODate({format:e="extended"}={}){return this.isValid?H6(this,e==="extended"):null}toISOWeekDate(){return EP(this,"kkkk-'W'WW-c")}toISOTime({suppressMilliseconds:e=!1,suppressSeconds:r=!1,includeOffset:i=!0,includePrefix:s=!1,extendedZone:n=!1,format:o="extended"}={}){return this.isValid?(s?"T":"")+gQ(this,o==="extended",r,e,i,n):null}toRFC2822(){return EP(this,"EEE, dd LLL yyyy HH:mm:ss ZZZ",!1)}toHTTP(){return EP(this.toUTC(),"EEE, dd LLL yyyy HH:mm:ss 'GMT'")}toSQLDate(){return this.isValid?H6(this,!0):null}toSQLTime({includeOffset:e=!0,includeZone:r=!1,includeOffsetSpace:i=!0}={}){let s="HH:mm:ss.SSS";return(r||e)&&(i&&(s+=" "),r?s+="z":e&&(s+="ZZ")),EP(this,s,!0)}toSQL(e={}){return this.isValid?`${this.toSQLDate()} ${this.toSQLTime(e)}`:null}toString(){return this.isValid?this.toISO():G6}valueOf(){return this.toMillis()}toMillis(){return this.isValid?this.ts:NaN}toSeconds(){return this.isValid?this.ts/1e3:NaN}toUnixInteger(){return this.isValid?Math.floor(this.ts/1e3):NaN}toJSON(){return this.toISO()}toBSON(){return this.toJSDate()}toObject(e={}){if(!this.isValid)return{};const r={...this.c};return e.includeConfig&&(r.outputCalendar=this.outputCalendar,r.numberingSystem=this.loc.numberingSystem,r.locale=this.loc.locale),r}toJSDate(){return new Date(this.isValid?this.ts:NaN)}diff(e,r="milliseconds",i={}){if(!this.isValid||!e.isValid)return ci.invalid("created by diffing an invalid DateTime");const s={locale:this.locale,numberingSystem:this.numberingSystem,...i},n=ORe(r).map(ci.normalizeUnit),o=e.valueOf()>this.valueOf(),a=o?this:e,l=o?e:this,c=DPe(a,l,n,s);return o?c.negate():c}diffNow(e="milliseconds",r={}){return this.diff(gr.now(),e,r)}until(e){return this.isValid?Qs.fromDateTimes(this,e):this}hasSame(e,r){if(!this.isValid)return!1;const i=e.valueOf(),s=this.setZone(e.zone,{keepLocalTime:!0});return s.startOf(r)<=i&&i<=s.endOf(r)}equals(e){return this.isValid&&e.isValid&&this.valueOf()===e.valueOf()&&this.zone.equals(e.zone)&&this.loc.equals(e.loc)}toRelative(e={}){if(!this.isValid)return null;const r=e.base||gr.fromObject({},{zone:this.zone}),i=e.padding?this<r?-e.padding:e.padding:0;let s=["years","months","days","hours","minutes","seconds"],n=e.unit;return Array.isArray(e.unit)&&(s=e.unit,n=void 0),vQ(r,this.plus(i),{...e,numeric:"always",units:s,unit:n})}toRelativeCalendar(e={}){return this.isValid?vQ(e.base||gr.fromObject({},{zone:this.zone}),this,{...e,numeric:"auto",units:["years","months","days"],calendary:!0}):null}static min(...e){if(!e.every(gr.isDateTime))throw new ih("min requires all arguments be DateTimes");return sQ(e,r=>r.valueOf(),Math.min)}static max(...e){if(!e.every(gr.isDateTime))throw new ih("max requires all arguments be DateTimes");return sQ(e,r=>r.valueOf(),Math.max)}static fromFormatExplain(e,r,i={}){const{locale:s=null,numberingSystem:n=null}=i,o=Es.fromOpts({locale:s,numberingSystem:n,defaultToEN:!0});return dde(o,e,r)}static fromStringExplain(e,r,i={}){return gr.fromFormatExplain(e,r,i)}static get DATE_SHORT(){return PD}static get DATE_MED(){return Che}static get DATE_MED_WITH_WEEKDAY(){return aRe}static get DATE_FULL(){return Ahe}static get DATE_HUGE(){return Ohe}static get TIME_SIMPLE(){return Rhe}static get TIME_WITH_SECONDS(){return Phe}static get TIME_WITH_SHORT_OFFSET(){return Mhe}static get TIME_WITH_LONG_OFFSET(){return Ihe}static get TIME_24_SIMPLE(){return $he}static get TIME_24_WITH_SECONDS(){return Lhe}static get TIME_24_WITH_SHORT_OFFSET(){return Dhe}static get TIME_24_WITH_LONG_OFFSET(){return Nhe}static get DATETIME_SHORT(){return Fhe}static get DATETIME_SHORT_WITH_SECONDS(){return Uhe}static get DATETIME_MED(){return khe}static get DATETIME_MED_WITH_SECONDS(){return Vhe}static get DATETIME_MED_WITH_WEEKDAY(){return lRe}static get DATETIME_FULL(){return zhe}static get DATETIME_FULL_WITH_SECONDS(){return Bhe}static get DATETIME_HUGE(){return Ghe}static get DATETIME_HUGE_WITH_SECONDS(){return jhe}}function RE(t){if(gr.isDateTime(t))return t;if(t&&t.valueOf&&wb(t.valueOf()))return gr.fromJSDate(t);if(t&&typeof t=="object")return gr.fromObject(t);throw new ih(`Unknown datetime argument: ${t}, of type ${typeof t}`)}const iMe={year:void 0,month:void 0,day:void 0,weekday:void 0},sMe={hour:void 0,minute:void 0,second:void 0},nMe={timeZone:Intl.DateTimeFormat().resolvedOptions().timeZone},_q={timeZone:"Etc/UTC"},_p={year:"numeric",month:"numeric",day:"numeric"},PE={year:"numeric",month:"long",day:"numeric"},ME={year:"numeric",month:"short",day:"numeric"},IE={year:"numeric",month:"long",weekday:"long",day:"numeric"},Lu={hour:"numeric",minute:"numeric"},Wh={...Lu,second:"numeric"},Z2={"short-date":_p,"short-date-short-time":{..._p,...Lu},"short-date-short-time-24":{..._p,...Lu,hour12:!1},"short-date-long-time":{..._p,...Wh},"short-date-long-time-24":{..._p,...Wh,hour12:!1},"short-date-le":_p,"short-date-le-short-time":{..._p,...Lu},"short-date-le-short-time-24":{..._p,...Lu,hour12:!1},"short-date-le-long-time":{..._p,...Wh},"short-date-le-long-time-24":{..._p,...Wh,hour12:!1},"long-month-day-year":PE,"long-month-day-year-short-time":{...PE,...Lu},"long-month-day-year-short-time-24":{...PE,...Lu,hour12:!1},"long-month-day-year-long-time":{...PE,...Wh},"long-month-day-year-long-time-24":{...PE,...Wh,hour12:!1},"day-short-month-year":ME,"day-short-month-year-short-time":{...ME,...Lu},"day-short-month-year-short-time-24":{...ME,...Lu,hour12:!1},"day-short-month-year-long-time":{...ME,...Wh},"day-short-month-year-long-time-24":{...ME,...Wh,hour12:!1},"long-date":IE,"long-date-short-time":{...IE,...Lu},"long-date-short-time-24":{...IE,...Lu,hour12:!1},"long-date-long-time":{...IE,...Wh},"long-date-long-time-24":{...IE,...Wh,hour12:!1},"long-month-year":{month:"long",year:"numeric"},"short-month-year":{month:"short",year:"numeric"},year:{year:"numeric"},"short-time":Lu,"long-time":Wh},oMe=Wa()({shortDate:"short-date",shortDateShortTime:"short-date-short-time",shortDateShortTime24:"short-date-short-time-24",shortDateLongTime:"short-date-long-time",shortDateLongTime24:"short-date-long-time-24",shortDateLE:"short-date-le",shortDateLEShortTime:"short-date-le-short-time",shortDateLEShortTime24:"short-date-le-short-time-24",shortDateLELongTime:"short-date-le-long-time",shortDateLELongTime24:"short-date-le-long-time-24",longMonthDayYear:"long-month-day-year",longMonthDayYearShortTime:"long-month-day-year-short-time",longMonthDayYearShortTime24:"long-month-day-year-short-time-24",longMonthDayYearLongTime:"long-month-day-year-long-time",longMonthDayYearLongTime24:"long-month-day-year-long-time-24",dayShortMonthYear:"day-short-month-year",dayShortMonthYearShortTime:"day-short-month-year-short-time",dayShortMonthYearShortTime24:"day-short-month-year-short-time-24",dayShortMonthYearLongTime:"day-short-month-year-long-time",dayShortMonthYearLongTime24:"day-short-month-year-long-time-24",longDate:"long-date",longDateShortTime:"long-date-short-time",longDateShortTime24:"long-date-short-time-24",longDateLongTime:"long-date-long-time",longDateLongTime24:"long-date-long-time-24",longMonthYear:"long-month-year",shortMonthYear:"short-month-year",year:"year"}),Sde={ar:"ar-u-nu-latn-ca-gregory"};let Hk=new WeakMap,Ede=Z2["short-date-short-time"];function aMe(t){const e=t||Ede;let r=Hk.get(e);if(!r){const i=_h(),s=Sde[i]||i;r=new Intl.DateTimeFormat(s,e),Hk.set(e,r)}return r}function UC(t){return Z2[t]}function w_(t,e){return aMe(e).format(t)}function lMe(t,e=Z2["short-date"]){return w_(new Date(t),{...e,..._q,...sMe})}function cMe(t,e=Z2["short-time"]){return w_(new Date(`1970-01-01T${t}Z`),{...e,..._q,...iMe})}function uMe(t,e=Z2["short-date-short-time"]){const r=gr.fromISO(t,{setZone:!0}),i=_h(),s=Sde[i]??i;return r.toLocaleString({...nMe,...e},{locale:s})}uq(()=>{Hk=new WeakMap,Ede=Z2["short-date-short-time"]});function uc(t,e){return t!=null?e(t):null}function rc(t,e){return yF(t,e),t}function yF(t,e){if(t==null)throw new Error(e??"value is None")}function Me(t){return t?.destroy(),null}function Ue(t){return t?.dispose(),null}function Ii(t){return t?.remove(),null}function pu(t){return t?.abort(),null}function Ui(t){return t?.release(),null}function hMe(t,e,r){return t!=null&&e!=null?r!=null?r(t,e):t.equals(e):t===e}function X2(t){return null}function fTt(t,e){const r=new Array;for(const i of t)r.push(i!=null?e(i):null);return r}function mTt(t,e){for(const r of t)uc(r,e)}function gTt(t){return t}const dMe={ar:"ar-u-nu-latn"};let M$=new WeakMap,Cde={};function pMe(t){const e=t||Cde;if(!M$.has(e)){const r=_h(),i=dMe[_h()]||r;M$.set(e,new Intl.NumberFormat(i,t))}return M$.get(e)}function fMe(t={}){const e={};return t.digitSeparator!=null&&(e.useGrouping=t.digitSeparator),t.places!=null&&(e.minimumFractionDigits=e.maximumFractionDigits=t.places),e}function ZS(t,e){return Object.is(t,-0)&&(t=0),pMe(e).format(t)}uq(()=>{M$=new WeakMap,Cde={}});const Ur={analysisTheme:{accentColor:[255,127,0],textColor:"white"},apiKey:void 0,applicationName:"",applicationUrl:globalThis.location?.href,assetsPath:"",fontsUrl:"https://static.arcgis.com/fonts",geometryServiceUrl:"https://utility.arcgisonline.com/arcgis/rest/services/Geometry/GeometryServer",geoRSSServiceUrl:"https://utility.arcgis.com/sharing/rss",kmlServiceUrl:"https://utility.arcgis.com/sharing/kml",userPrivilegesApplied:!1,portalUrl:"https://www.arcgis.com",routeServiceUrl:"https://route-api.arcgis.com/arcgis/rest/services/World/Route/NAServer/Route_World",workers:{loaderConfig:{has:{},paths:{},map:{},packages:[]}},request:{crossOriginNoCorsDomains:null,httpsDomains:["arcgis.com","arcgisonline.com","esrikr.com","premiumservices.blackbridge.com","esripremium.accuweather.com","gbm.digitalglobe.com","firstlook.digitalglobe.com","msi.digitalglobe.com"],interceptors:[],maxUrlLength:2e3,priority:"high",proxyRules:[],proxyUrl:null,timeout:6e4,trustedServers:[],useIdentity:!0},log:{interceptors:[],level:null}};if(globalThis.esriConfig&&(bhe(Ur,globalThis.esriConfig,!0),delete Ur.has),!Ur.assetsPath){{const t="4.27";Ur.assetsPath=`https://js.arcgis.com/${t}/@arcgis/core/assets`}Ur.defaultAssetsPath=Ur.assetsPath}const mMe=/\{([^\}]+)\}/g;function wQ(t){return t??""}function _F(t,e){return t.replaceAll(mMe,typeof e=="object"?(r,i)=>wQ(ug(i,e)):(r,i)=>wQ(e(i)))}function yTt(t,e){return t.replaceAll(/([\.$?*|{}\(\)\[\]\\\/\+\-^])/g,r=>e&&e.includes(r)?r:`\\${r}`)}function vq(t){let e=0;for(let r=0;r<t.length;r++)e=(e<<5)-e+t.charCodeAt(r),e|=0;return e}function _Tt(t){return new DOMParser().parseFromString(t||"","text/html").body.innerText||""}function vTt(t,e){return new RegExp(`{${e}}`,"ig").test(t)}const xQ={info:0,warn:1,error:2,none:3};let Q=class Sa{constructor(e){this.level=null,this._module="",this._parent=null,this.writer=null,this._loggedMessages={error:new Map,warn:new Map,info:new Map},e.level!=null&&(this.level=e.level),e.writer!=null&&(this.writer=e.writer),this._module=e.module,Sa._loggers.set(this.module,this);const r=this.module.lastIndexOf(".");r!==-1&&(this._parent=Sa.getLogger(this.module.slice(0,r)))}get module(){return this._module}get parent(){return this._parent}error(...e){this._log("error","always",...e)}warn(...e){this._log("warn","always",...e)}info(...e){this._log("info","always",...e)}errorOnce(...e){this._log("error","once",...e)}warnOnce(...e){this._log("warn","once",...e)}infoOnce(...e){this._log("info","once",...e)}errorOncePerTick(...e){this._log("error","oncePerTick",...e)}warnOncePerTick(...e){this._log("warn","oncePerTick",...e)}infoOncePerTick(...e){this._log("info","oncePerTick",...e)}get test(){const e=this;return{loggedMessages:e._loggedMessages,clearLoggedWarnings:()=>e._loggedMessages.warn.clear()}}static get test(){return{resetLoggers(e=new Map){const r=Sa._loggers;return Sa._loggers=e,r},set throttlingDisabled(e){Sa._throttlingDisabled=e}}}static getLogger(e){return e=typeof e!="string"?e.declaredClass:e,Sa._loggers.get(e)||new Sa({module:e})}_log(e,r,...i){if(this._matchLevel(e)){if(r!=="always"&&!Sa._throttlingDisabled){const s=this._argsToKey(i),n=this._loggedMessages[e].get(s);if(r==="once"&&n!=null||r==="oncePerTick"&&n&&n>=Sa._tickCounter)return;this._loggedMessages[e].set(s,Sa._tickCounter),Sa._scheduleTickCounterIncrement()}for(const s of Ur.log.interceptors)if(s(e,this.module,...i))return;this._inheritedWriter()(e,this.module,...i)}}_parentWithMember(e,r){let i=this;for(;i!=null;){const s=i[e];if(s!=null)return s;i=i.parent}return r}_inheritedWriter(){return this._parentWithMember("writer",this._consoleWriter)}_consoleWriter(e,r,...i){console[e](`[${r}]`,...i)}_matchLevel(e){const r=Ur.log.level||"warn";return xQ[this._parentWithMember("level",r)]<=xQ[e]}_argsToKey(...e){return vq(JSON.stringify(e,(i,s)=>typeof s!="object"||Array.isArray(s)?s:"[Object]"))}static _scheduleTickCounterIncrement(){Sa._tickCounterScheduled||(Sa._tickCounterScheduled=!0,Promise.resolve().then(()=>{Sa._tickCounter++,Sa._tickCounterScheduled=!1}))}};Q._loggers=new Map,Q._tickCounter=0,Q._tickCounterScheduled=!1,Q._throttlingDisabled=!1;const Ade=Q.getLogger("esri.intl.substitute");function gMe(t,e,r={}){const{format:i={}}=r;return _F(t,s=>yMe(s,e,i))}function yMe(t,e,r){let i,s;const n=t.indexOf(":");if(n===-1?i=t.trim():(i=t.slice(0,n).trim(),s=t.slice(n+1).trim()),!i)return"";const o=ug(i,e);if(o==null)return"";const a=(s?r?.[s]:null)??r?.[i];return a?_Me(o,a):s?vMe(o,s):bq(o)}function _Me(t,e){switch(e.type){case"date":return w_(t,e.intlOptions);case"number":return ZS(t,e.intlOptions);default:return Ade.warn("missing format descriptor for key {key}"),bq(t)}}function vMe(t,e){switch(e.toLowerCase()){case"dateformat":return w_(t);case"numberformat":return ZS(t);default:return Ade.warn(`inline format is unsupported since 4.12: ${e}`),/^(dateformat|datestring)/i.test(e)?w_(t):/^numberformat/i.test(e)?ZS(t):bq(t)}}function bq(t){switch(typeof t){case"string":return t;case"number":return ZS(t);case"boolean":return""+t;default:return t instanceof Date?w_(t):""}}function bMe(t,e){return t.replaceAll(/\$\{([^\s\:\}]*)(?:\:([^\s\:\}]+))?\}/g,(r,i)=>i===""?"$":(ug(i,e)??"").toString())}let Ode=class{constructor(e,r,i){this.name=e,this.details=i,this.message=(r&&bMe(r,i))??""}toString(){return"["+this.name+"]: "+this.message}},F=class Rde extends Ode{constructor(e,r,i){super(e,r,i)}toJSON(){if(this.details!=null)try{return{name:this.name,message:this.message,details:JSON.parse(JSON.stringify(this.details,(e,r)=>{if(r&&typeof r=="object"&&typeof r.toJSON=="function")return r;try{return K(r)}catch{return"[object]"}}))}}catch(e){throw Q.getLogger("esri.core.Error").error(e),e}return{name:this.name,message:this.message,details:this.details}}static fromJSON(e){return new Rde(e.name,e.message,e.details)}};F.prototype.type="error";function wMe(t){return{setTimeout:(e,r)=>{const i=t.setTimeout(e,r);return{remove:()=>t.clearTimeout(i)}}}}const wR=wMe(globalThis);function vF(t){return t&&(typeof t.on=="function"||typeof t.addEventListener=="function")}function h_(t,e,r){if(!vF(t))throw new TypeError("target is not a Evented or EventTarget object");if("on"in t)return t.on(e,r);if(Array.isArray(e)){const i=e.slice();for(const s of i)t.addEventListener(s,r);return{remove(){for(const s of i)t.removeEventListener(s,r)}}}return t.addEventListener(e,r),{remove(){t.removeEventListener(e,r)}}}function Pde(t,e,r){if(!vF(t))throw new TypeError("target is not a Evented or EventTarget object");if("once"in t)return t.once(e,r);const i=h_(t,e,s=>{i.remove(),r.call(t,s)});return{remove(){i.remove()}}}const xMe={Win:"Meta",Scroll:"ScrollLock",Spacebar:" ",Down:"ArrowDown",Left:"ArrowLeft",Right:"ArrowRight",Up:"ArrowUp",Del:"Delete",Apps:"ContextMenu",Esc:"Escape",Multiply:"*",Add:"+",Subtract:"-",Decimal:".",Divide:"/"};function TMe({key:t}){return xMe[t]||t}function Dr(t="Aborted"){return new F("AbortError",t)}function Xt(t,e="Aborted"){if(sn(t))throw Dr(e)}function bF(t){return t!=null?"aborted"in t?t:t.signal:t}function sn(t){const e=bF(t);return e!=null&&e.aborted}function Lo(t){if(ms(t))throw t}function TQ(t){if(!ms(t))throw t}function nn(t,e){const r=bF(t);if(r!=null){if(!r.aborted)return Pde(r,"abort",()=>e());e()}}function wq(t,e){const r=bF(t);if(r!=null)return Xt(r),Pde(r,"abort",()=>e(Dr()))}function Mde(t,e){return bF(e)==null?t:new Promise((r,i)=>{let s=nn(e,()=>i(Dr()));const n=()=>s=Ii(s);t.then(n,n),t.then(r,i)})}function ms(t){return t?.name==="AbortError"}async function qk(t){try{return await t}catch(e){if(!ms(e))throw e;return}}async function wTt(t,e=Q.getLogger("esri")){try{return await t}catch(r){ms(r)||e.error(r)}}async function Yf(t){if(!t)return;if(typeof t.forEach!="function"){const r=Object.keys(t),i=r.map(o=>t[o]),s=await Yf(i),n={};return r.map((o,a)=>n[o]=s[a]),n}const e=t;return Promise.allSettled(e).then(r=>Array.from(e,(i,s)=>{const n=r[s];return n.status==="fulfilled"?{promise:i,value:n.value}:{promise:i,error:n.reason}}))}async function Wk(t){return(await Yf(t)).filter(e=>!!e.value).map(e=>e.value)}function pO(t,e=void 0,r){const i=new AbortController;return nn(r,()=>i.abort()),new Promise((s,n)=>{let o=setTimeout(()=>{o=0,s(e)},t);nn(i,()=>{o&&(clearTimeout(o),n(Dr()))})})}function bu(t){return t&&typeof t.then=="function"}function Zk(t){return bu(t)?t:Promise.resolve(t)}function xq(t,e=-1){let r,i,s,n,o=null;const a=(...l)=>{if(r){i=l,n&&n.reject(Dr()),n=qs();const f=n.promise;if(o){const m=o;o=null,m.abort()}return f}if(s=n||qs(),n=null,e>0){const f=new AbortController;r=Zk(t(...l,f.signal));const m=r;pO(e).then(()=>{r===m&&(n?f.abort():o=f)})}else r=1,r=Zk(t(...l));const c=()=>{const f=i;i=s=r=o=null,f!=null&&a(...f)},h=r,p=s;return h.then(c,c),h.then(p.resolve,p.reject),p.promise};return a}function qs(){let t,e;const r=new Promise((s,n)=>{t=s,e=n}),i=s=>{t(s)};return i.resolve=s=>t(s),i.reject=s=>e(s),i.timeout=(s,n)=>wR.setTimeout(()=>i.reject(n),s),i.promise=r,i}function xTt(t,e){return t.then(e,e)}async function SQ(t){await Promise.resolve(),Xt(t)}const EQ=/^([a-z]{2})(?:[-_]([A-Za-z]{2}))?$/,SMe={ar:!0,bg:!0,bs:!0,ca:!0,cs:!0,da:!0,de:!0,el:!0,en:!0,es:!0,et:!0,fi:!0,fr:!0,he:!0,hr:!0,hu:!0,id:!0,it:!0,ja:!0,ko:!0,lt:!0,lv:!0,nb:!0,nl:!0,pl:!0,"pt-BR":!0,"pt-PT":!0,ro:!0,ru:!0,sk:!0,sl:!0,sr:!0,sv:!0,th:!0,tr:!0,uk:!0,vi:!0,"zh-CN":!0,"zh-HK":!0,"zh-TW":!0};function CQ(t){return t in SMe}const kC=[],_S=new Map;function AQ(t){for(const e of _S.keys())$de(t.pattern,e)&&_S.delete(e)}function EMe(t){return kC.includes(t)||(AQ(t),kC.unshift(t)),{remove(){const e=kC.indexOf(t);e>-1&&(kC.splice(e,1),AQ(t))}}}async function Ide(t){const e=_h();_S.has(t)||_S.set(t,AMe(t,e));const r=_S.get(t);return r&&await OMe.add(r),r}function CMe(t){if(!EQ.test(t))return null;const e=EQ.exec(t);if(e===null)return null;const[,r,i]=e,s=r+(i?"-"+i.toUpperCase():"");return CQ(s)?s:CQ(r)?r:null}async function AMe(t,e){const r=[];for(const i of kC)if($de(i.pattern,t))try{return await i.fetchMessageBundle(t,e)}catch(s){r.push(s)}throw r.length?new F("intl:message-bundle-error",`Errors occurred while loading "${t}"`,{errors:r}):new F("intl:no-message-bundle-loader",`No loader found for message bundle "${t}"`)}function $de(t,e){return typeof t=="string"?e.startsWith(t):t.test(e)}uq(()=>{_S.clear()});const OMe=new class{constructor(){this._numLoading=0,this._dfd=null}async waitForAll(){this._dfd&&await this._dfd.promise}add(t){return this._increase(),t.then(()=>this._decrease(),()=>this._decrease()),this.waitForAll()}_increase(){this._numLoading++,this._dfd||(this._dfd=qs())}_decrease(){this._numLoading=Math.max(this._numLoading-1,0),this._dfd&&this._numLoading===0&&(this._dfd.resolve(),this._dfd=null)}},RMe=/^https:\/\/([a-z\d-]+)(\.maps([^.]*))?\.arcgis\.com/i,PMe={devext:{customBaseUrl:"mapsdevext.arcgis.com",portalHostname:"devext.arcgis.com"},qaext:{customBaseUrl:"mapsqa.arcgis.com",portalHostname:"qaext.arcgis.com"},www:{customBaseUrl:"maps.arcgis.com",portalHostname:"www.arcgis.com"}};function OQ(t){const e=t?.match(RMe);if(!e)return null;const[,r,i,s]=e;if(!r)return null;let n=null,o=null,a=null;const{devext:l,qaext:c,www:h}=PMe;if(i)if(n=r,s)switch(s.toLowerCase()){case"devext":({customBaseUrl:o,portalHostname:a}=l);break;case"qa":({customBaseUrl:o,portalHostname:a}=c);break;default:return null}else({customBaseUrl:o,portalHostname:a}=h);else switch(r.toLowerCase()){case"devext":({customBaseUrl:o,portalHostname:a}=l);break;case"qaext":({customBaseUrl:o,portalHostname:a}=c);break;case"www":({customBaseUrl:o,portalHostname:a}=h);break;default:return null}return{customBaseUrl:o,isPortal:!1,portalHostname:a,urlKey:n}}function Lde(t){return/\/(sharing|usrsvcs)\/(appservices|servers)\//i.test(t)}function MMe(t){const e=atob(t),r=new Uint8Array(e.length);for(let i=0;i<e.length;i++)r[i]=e.charCodeAt(i);return r.buffer}const IMe=Q.getLogger("esri.core.urlUtils"),Y2=Ur.request,RQ="esri/config: esriConfig.request.proxyUrl is not set.",Dde=/^\s*[a-z][a-z0-9-+.]*:(?![0-9])/i,Nde=/^\s*http:/i,$Me=/^\s*https:/i,LMe=/^\s*file:/i,DMe=/:\d+$/,NMe=/^https?:\/\/[^/]+\.arcgis.com\/sharing(\/|$)/i,FMe=new RegExp("^(([^:/?#]+):)?(//([^/?#]*))?([^?#]*)(\\?([^#]*))?(#(.*))?$"),UMe=new RegExp("^((([^\\[:]+):)?([^@]+)@)?(\\[([^\\]]+)\\]|([^\\[:]*))(:([0-9]+))?$");let tu=class{constructor(e=""){this.uri=e,this.scheme=null,this.authority=null,this.path=null,this.query=null,this.fragment=null,this.user=null,this.password=null,this.host=null,this.port=null;let r=this.uri.match(FMe);this.scheme=r[2]||(r[1]?"":null),this.authority=r[4]||(r[3]?"":null),this.path=r[5],this.query=r[7]||(r[6]?"":null),this.fragment=r[9]||(r[8]?"":null),this.authority!=null&&(r=this.authority.match(UMe),this.user=r[3]||null,this.password=r[4]||null,this.host=r[6]||r[7],this.port=r[9]||null)}toString(){return this.uri}};const CP={},kMe=new tu(Ur.applicationUrl);let Va=kMe;const VMe=zMe();let Tq=VMe;const Sq=()=>Va,STt=()=>Tq;function zMe(){const t=Va.path,e=t.substring(0,t.lastIndexOf(t.split("/")[t.split("/").length-1]));return`${`${Va.scheme}://${Va.host}${Va.port!=null?`:${Va.port}`:""}`}${e}`}function cn(t){if(!t)return null;const e={path:null,query:null},r=new tu(t),i=t.indexOf("?");return r.query===null?e.path=t:(e.path=t.substring(0,i),e.query=ub(r.query)),r.fragment&&(e.hash=r.fragment,r.query===null&&(e.path=e.path.substring(0,e.path.length-(r.fragment.length+1)))),e}function ub(t){const e=t.split("&"),r={};for(const i of e){if(!i)continue;const s=i.indexOf("=");let n,o;s<0?(n=decodeURIComponent(i),o=""):(n=decodeURIComponent(i.slice(0,s)),o=decodeURIComponent(i.slice(s+1)));let a=r[n];typeof a=="string"&&(a=r[n]=[a]),Array.isArray(a)?a.push(o):r[n]=o}return r}function PQ(t){return t&&typeof t=="object"&&"toJSON"in t&&typeof t.toJSON=="function"}function kb(t,e){return t?e&&typeof e=="function"?Object.keys(t).map(r=>encodeURIComponent(r)+"="+encodeURIComponent(e(r,t[r]))).join("&"):Object.keys(t).map(r=>{const i=t[r];if(i==null)return"";const s=encodeURIComponent(r)+"=",n=e&&e[r];return n?s+encodeURIComponent(n(i)):Array.isArray(i)?i.map(o=>PQ(o)?s+encodeURIComponent(JSON.stringify(o)):s+encodeURIComponent(o)).join("&"):PQ(i)?s+encodeURIComponent(JSON.stringify(i)):s+encodeURIComponent(i)}).filter(r=>r).join("&"):""}function BMe(t=!1){let e,r=Y2.proxyUrl;if(typeof t=="string"){e=ZMe(t);const i=xR(t);i&&(r=i.proxyUrl)}else e=!!t;if(!r)throw IMe.warn(RQ),new F("urlutils:proxy-not-set",RQ);return e&&Xk()&&(r=Pq(r)),cn(r)}function ETt(t){const e=xR(t);let r,i;if(e){const s=Eq(e.proxyUrl);r=s.path,i=s.query?ub(s.query):null}if(r){const s=cn(t);t=r+"?"+s.path;const n=kb({...i,...s.query});n&&(t=`${t}?${n}`)}return t}const $E={path:"",query:""};function Eq(t){const e=t.indexOf("?");return e!==-1?($E.path=t.slice(0,e),$E.query=t.slice(e+1)):($E.path=t,$E.query=null),$E}function Fde(t){return t=(t=DD(t=KMe(t=Eq(t).path),!0)).toLowerCase()}function GMe(t){const e={proxyUrl:t.proxyUrl,urlPrefix:Fde(t.urlPrefix)},r=Y2.proxyRules,i=e.urlPrefix;let s=r.length;for(let n=0;n<r.length;n++){const o=r[n].urlPrefix;if(i.indexOf(o)===0){if(i.length===o.length)return-1;s=n;break}o.indexOf(i)===0&&(s=n+1)}return r.splice(s,0,e),s}function xR(t){const e=Y2.proxyRules,r=Fde(t);for(let i=0;i<e.length;i++)if(r.indexOf(e[i].urlPrefix)===0)return e[i]}function jMe(t,e){if(!t||!e)return!1;t=LD(t),e=LD(e);const r=OQ(t),i=OQ(e);return r!=null&&i!=null?r.portalHostname===i.portalHostname:r==null&&i==null&&Ql(t,e,!0)}function Ude(t,e){return t=LD(t),e=LD(e),DD(t)===DD(e)}function LD(t){const e=(t=vh(t)).indexOf("/sharing");return e>0?t.substring(0,e):t.replace(/\/+$/,"")}function kde(t){const e=i=>i==null||i instanceof RegExp&&i.test(t)||typeof i=="string"&&t.startsWith(i),r=Y2.interceptors;if(r){for(const i of r)if(Array.isArray(i.urls)){if(i.urls.some(e))return i}else if(e(i.urls))return i}return null}function Ql(t,e,r=!1){if(!t||!e)return!1;const i=Jk(t),s=Jk(e);return!(!r&&i.scheme!==s.scheme)&&i.host!=null&&s.host!=null&&i.host.toLowerCase()===s.host.toLowerCase()&&i.port===s.port}function Cq(t){if(typeof t=="string"){if(!mc(t))return!0;t=Jk(t)}if(Ql(t,Va))return!0;const e=Y2.trustedServers||[];for(let r=0;r<e.length;r++){const i=HMe(e[r]);for(let s=0;s<i.length;s++)if(Ql(t,i[s]))return!0}return!1}function HMe(t){return CP[t]||(Rq(t)||Ff(t)?CP[t]=[new tu(_l(t))]:CP[t]=[new tu(`http://${t}`),new tu(`https://${t}`)]),CP[t]}function _l(t,e=Tq,r){return Ff(t)?r&&r.preserveProtocolRelative?t:Va.scheme==="http"&&Va.authority===Yd(t).slice(2)?`http:${t}`:`https:${t}`:Rq(t)?t:bc(t[0]==="/"?QMe(e):e,t)}function Aq(t,e=Tq,r){if(t==null||!mc(t))return t;const i=vh(t),s=i.toLowerCase(),n=vh(e).toLowerCase().replace(/\/+$/,""),o=r?vh(r).toLowerCase().replace(/\/+$/,""):null;if(o&&n.indexOf(o)!==0)return t;const a=(p,f,m)=>(m=p.indexOf(f,m))===-1?p.length:m;let l=a(s,"/",s.indexOf("//")+2),c=-1;for(;s.slice(0,l+1)===n.slice(0,l)+"/"&&(c=l+1,l!==s.length);)l=a(s,"/",l+1);if(c===-1||o&&c<o.length)return t;t=i.slice(c);const h=n.slice(c-1).replaceAll(/[^/]+/g,"").length;if(h>0)for(let p=0;p<h;p++)t=`../${t}`;else t=`./${t}`;return t}function vh(t){return t=rIe(t=tIe(t=eIe(t=_l(t=t.trim()))))}function bc(...t){const e=t.filter(xw);if(!e||!e.length)return;const r=[];if(mc(e[0])){const s=e[0],n=s.indexOf("//");n!==-1&&(r.push(s.slice(0,n+1)),YMe(e[0])&&(r[0]+="/"),e[0]=s.slice(n+2))}else e[0][0]==="/"&&r.push("");const i=e.reduce((s,n)=>n?s.concat(n.split("/")):s,[]);for(let s=0;s<i.length;s++){const n=i[s];n===".."&&r.length>0&&r[r.length-1]!==".."?r.pop():(!n&&s===i.length-1||n&&(n!=="."||r.length===0))&&r.push(n)}return r.join("/")}function Yd(t,e=!1){if(t==null||x_(t)||Jf(t))return null;let r=t.indexOf("://");if(r===-1&&Ff(t))r=2;else{if(r===-1)return null;r+=3}const i=t.indexOf("/",r);return i!==-1&&(t=t.slice(0,i)),e&&(t=DD(t,!0)),t}function mc(t){return Ff(t)||Rq(t)}function x_(t){return t!=null&&t.slice(0,5)==="blob:"}function Jf(t){return t!=null&&t.slice(0,5)==="data:"}function Oq(t){const e=Vb(t);return e&&e.isBase64?MMe(e.data):null}function q6(t){return btoa(String.fromCharCode.apply(null,t)).replaceAll("+","-").replaceAll("/","_").replace(/=+$/,"")}const qMe=/^data:(.*?)(;base64)?,(.*)$/;function Vb(t){const e=t.match(qMe);if(!e)return null;const[,r,i,s]=e;return{mediaType:r,isBase64:!!i,data:s}}function Vde(t){return t.isBase64?`data:${t.mediaType};base64,${t.data}`:`data:${t.mediaType},${t.data}`}function CTt(t){const e=Oq(t);if(!e)return null;const r=Vb(t);return new Blob([e],{type:r.mediaType})}function ATt(t,e){WMe(t,e)}function WMe(t,e){if(!t)return!1;const r=document.createElement("a");if(!("download"in r))return!1;const i=URL.createObjectURL(t);return r.download=e,r.href=i,r.style.display="none",document.body.appendChild(r),r.click(),document.body.removeChild(r),URL.revokeObjectURL(i),!0}function Ff(t){return t!=null&&t[0]==="/"&&t[1]==="/"}function Rq(t){return t!=null&&Dde.test(t)}function ZMe(t){return t!=null&&$Me.test(t)||Va.scheme==="https"&&Ff(t)}function XMe(t){return t!=null&&Nde.test(t)||Va.scheme==="http"&&Ff(t)}function YMe(t){return t!=null&&LMe.test(t)}function Pq(t){return Ff(t)?`https:${t}`:t.replace(Nde,"https:")}function JMe(){return Va.scheme==="http"}function Xk(){return Va.scheme==="https"}function DD(t,e=!1){return Ff(t)?t.slice(2):(t=t.replace(Dde,""),e&&t.length>1&&t[0]==="/"&&t[1]==="/"&&(t=t.slice(2)),t)}function QMe(t){const e=t.indexOf("//"),r=t.indexOf("/",e+2);return r===-1?t:t.slice(0,r)}function Mq(t){let e=0;if(mc(t)){const i=t.indexOf("//");i!==-1&&(e=i+2)}const r=t.lastIndexOf("/");return r<e?t:t.slice(0,r+1)}function OTt(t,e){if(!t)return"";const r=cn(t).path.replace(/\/+$/,""),i=r.substring(r.lastIndexOf("/")+1);if(!e?.length)return i;const s=new RegExp(`.(${e.join("|")})$`,"ig");return i.replace(s,"")}function KMe(t){return t&&t[t.length-1]==="/"?t:`${t}/`}function zde(t){return t.replace(/\/+$/,"")}function eIe(t){if(/^https?:\/\//i.test(t)){const e=Eq(t);t=(t=e.path.replaceAll(/\/{2,}/g,"/")).replace("/","//"),e.query&&(t+=`?${e.query}`)}return t}function tIe(t){return t.replace(/^(https?:\/\/)(arcgis\.com)/i,"$1www.$2")}function rIe(t){const e=Y2.httpsDomains;if(!XMe(t))return t;const r=t.indexOf("/",7);let i;if(i=r===-1?t:t.slice(0,r),i=i.toLowerCase().slice(7),DMe.test(i)){if(!i.endsWith(":80"))return t;i=i.slice(0,-3),t=t.replace(":80","")}return JMe()&&i===Va.authority&&!NMe.test(t)||(Xk()&&i===Va.authority||e&&e.some(s=>i===s||i.endsWith(`.${s}`))||Xk()&&!xR(t))&&(t=Pq(t)),t}function Yk(t,e,r){if(!(e&&r&&t&&mc(t)))return t;const i=t.indexOf("//"),s=t.indexOf("/",i+2),n=t.indexOf(":",i+2),o=Math.min(s<0?t.length:s,n<0?t.length:n);return t.slice(i+2,o).toLowerCase()!==e.toLowerCase()?t:`${t.slice(0,i+2)}${r}${t.slice(o)}`}function Jk(t){return typeof t=="string"?new tu(_l(t)):(t.scheme||(t.scheme=Va.scheme),t)}function Bde(t){return iIe.test(t)}function Gde(t,e){const r=cn(t),i=Object.keys(r.query||{});return i.length>0&&e&&e.warn("removeQueryParameters()",`Url query parameters are not supported, the following parameters have been removed: ${i.join(", ")}.`),r.path}function jde(t,e,r){const i=cn(t),s=i.query||{};return s[e]=String(r),`${i.path}?${kb(s)}`}function I$(t,e){const r=cn(t),i=r.query||{};for(const n in e)i[n]=e[n];const s=kb(i);return s?`${r.path}?${s}`:r.path}function Iq(t){if(t==null)return null;const e=t.match(Hde);return e?e[2]:null}function MQ(t){if(t==null)return null;const e=t.match(Hde);return e?{path:e[1],extension:e[2]}:{path:t,extension:null}}async function RTt(t){return typeof t=="string"?Vb(t)??{data:t}:new Promise((e,r)=>{const i=new FileReader;i.readAsDataURL(t),i.onload=()=>e(Vb(i.result)),i.onerror=s=>r(s)})}const Hde=/([^.]*)\.([^\/]*)$/,iIe=/(^data:image\/svg|\.svg$)/i,qde="20230615",Wde="1f5db620f7f53ad9484d45c023aeb6d5fbf0f873",sIe="4.27";let $q=sIe;$q="4.27.1";const nIe={async request(t,e){const{default:r}=await ae(()=>Promise.resolve().then(()=>Kde),void 0,import.meta.url),i=t.options,s=i.responseType;i.signal=e?.signal,i.responseType=s==="native"||s==="native-request-init"?"native-request-init":s&&["blob","json","text"].includes(s)&&kde(t.url)?.after?s:"array-buffer";const n=await r(t.url,i),o={data:n.data,httpStatus:n.httpStatus,ssl:n.ssl};switch(n.requestOptions?.responseType){case"native-request-init":return delete o.data.signal,o;case"blob":o.data=await o.data.arrayBuffer();break;case"json":o.data=new TextEncoder().encode(JSON.stringify(o.data)).buffer;break;case"text":o.data=new TextEncoder().encode(o.data).buffer}return{result:o,transferList:[o.data]}}};let Gt;function oIe(t){Gt=t}function PTt(t){const e=Gt?.findCredential(t);return e?.token?jde(t,"token",e.token):t}oe("host-webworker");const aIe=["elevation3d.arcgis.com","js.arcgis.com","jsdev.arcgis.com","jsqa.arcgis.com","static.arcgis.com"];function Zde(t){const e=Yd(t,!0);return!!e&&e.endsWith(".arcgis.com")&&!aIe.includes(e)&&!t.endsWith("/sharing/rest/generateToken")}function Xde(t,e,r=!1,i){return new Promise((s,n)=>{if(sn(i))return void n(IQ());let o=()=>{c(),n(new Error(`Unable to load ${e}`))},a=()=>{const h=t;c(),s(h)},l=()=>{if(!t)return;const h=t;c(),h.src="",n(IQ())};const c=()=>{oe("esri-image-decode")||(t.removeEventListener("error",o),t.removeEventListener("load",a)),o=null,a=null,t=null,i?.removeEventListener("abort",l),l=null,r&&URL.revokeObjectURL(e)};i?.addEventListener("abort",l),oe("esri-image-decode")?t.decode().then(a,o):(t.addEventListener("error",o),t.addEventListener("load",a))})}function IQ(){try{return new DOMException("Aborted","AbortError")}catch{const t=new Error;return t.name="AbortError",t}}const Yde="Timeout exceeded";function lIe(){return new Error(Yde)}function MTt(t){return typeof t=="object"&&!!t&&"message"in t&&t.message===Yde}function cIe(t){Ur.request.crossOriginNoCorsDomains||(Ur.request.crossOriginNoCorsDomains={});const e=Ur.request.crossOriginNoCorsDomains;for(let r of t)r=r.toLowerCase(),/^https?:\/\//.test(r)?e[Yd(r)??""]=0:(e[Yd("http://"+r)??""]=0,e[Yd("https://"+r)??""]=0)}function uIe(t){const e=Ur.request.crossOriginNoCorsDomains;if(e){let r=Yd(t);if(r)return r=r.toLowerCase(),!Ql(r,Sq())&&e[r]<Date.now()-36e5}return!1}async function hIe(t){const e=Ur.request.crossOriginNoCorsDomains,r=Yd(t);e&&r&&(e[r.toLowerCase()]=Date.now());const i=cn(t);t=i.path,i.query?.f==="json"&&(t+="?f=json");try{await fetch(t,{mode:"no-cors",credentials:"include"})}catch{}}async function qt(t,e){t instanceof URL&&(t=t.toString()),e?.query instanceof URLSearchParams&&(e.query=ub(e.query.toString().replaceAll("+"," ")));const r=Jf(t),i=x_(t);i||r||(t=vh(t));const s={url:t,requestOptions:{...e}};let n=kde(t);if(n){const c=await vIe(n,s);if(c!=null)return{data:c,getHeader:Lq,httpStatus:200,requestOptions:s.requestOptions,url:s.url};n.after||n.error||(n=null)}if(t=s.url,(e=s.requestOptions).responseType==="image"&&(oe("host-webworker")||oe("host-node")))throw Ef("request:invalid-parameters",new Error("responseType 'image' is not supported in Web Workers or Node environment"),s);if(e.method==="head"){if(e.body)throw Ef("request:invalid-parameters",new Error("body parameter cannot be set when method is 'head'"),s);if(r||i)throw Ef("request:invalid-parameters",new Error("data and blob URLs are not supported for method 'head'"),s)}if(await gIe(),ND)return ND.execute(t,e);const o=new AbortController;nn(e,()=>o.abort());const a={controller:o,credential:void 0,credentialToken:void 0,fetchOptions:void 0,hasToken:!1,interceptor:n,params:s,redoRequest:!1,useIdentity:Md.useIdentity,useProxy:!1,useSSL:!1,withCredentials:!1},l=await wIe(a);return n?.after?.(l),l}let ND;const Md=Ur.request,Jde="FormData"in globalThis,dIe=[499,498,403,401],pIe=["COM_0056","COM_0057","SB_0008"],fIe=[/\/arcgis\/tokens/i,/\/sharing(\/rest)?\/generatetoken/i,/\/rest\/info/i],Lq=()=>null,FD=Symbol();function mIe(t){const e=Yd(t);e&&!qt._corsServers.includes(e)&&qt._corsServers.push(e)}function $Q(t){const e=Yd(t);return!e||e.endsWith(".arcgis.com")||qt._corsServers.includes(e)||Cq(e)}function Ef(t,e,r,i){let s="Error";const n={url:r.url,requestOptions:r.requestOptions,getHeader:Lq,ssl:!1};if(e instanceof F)return e.details?(e.details=K(e.details),e.details.url=r.url,e.details.requestOptions=r.requestOptions):e.details=n,e;if(e){const o=i&&(c=>i.headers.get(c)),a=i?.status,l=e.message;l&&(s=l),o&&(n.getHeader=o),n.httpStatus=(e.httpCode!=null?e.httpCode:e.code)||a||0,n.subCode=e.subcode,n.messageCode=e.messageCode,typeof e.details=="string"?n.messages=[e.details]:n.messages=e.details,n.raw=FD in e?e[FD]:e}return ms(e)?Dr():new F(t,s,n)}async function gIe(){oe("host-webworker")?ND||(ND=await ae(()=>import("./request-bc45b546.js"),[],import.meta.url)):qt._abortableFetch||(qt._abortableFetch=globalThis.fetch.bind(globalThis))}async function Qk(){Gt||await ae(()=>Promise.resolve().then(()=>fHe),void 0,import.meta.url)}async function yIe(t){const e=t.params.url,r=t.params.requestOptions,i=t.controller.signal,s=r.body;let n=null,o=null;if(Jde&&"HTMLFormElement"in globalThis&&(s instanceof FormData?n=s:s instanceof HTMLFormElement&&(n=new FormData(s))),typeof s=="string"&&(o=s),t.fetchOptions={cache:r.cacheBust&&!("polyfill"in qt._abortableFetch)?"no-cache":"default",credentials:"same-origin",headers:r.headers||{},method:r.method==="head"?"HEAD":"GET",mode:"cors",priority:Md.priority,redirect:"follow",signal:i},(n||o)&&(t.fetchOptions.body=n||o),r.authMode==="anonymous"&&(t.useIdentity=!1),t.hasToken=!!(/token=/i.test(e)||r.query?.token||n?.get("token")),!t.hasToken&&Ur.apiKey&&Zde(e)&&(r.query||(r.query={}),r.query.token=Ur.apiKey,t.hasToken=!0),t.useIdentity&&!t.hasToken&&!t.credentialToken&&!Qde(e)&&!sn(i)){let a;r.authMode==="immediate"?(await Qk(),a=await Gt.getCredential(e,{signal:i}),t.credential=a):r.authMode==="no-prompt"?(await Qk(),a=await Gt.getCredential(e,{prompt:!1,signal:i}).catch(()=>{}),t.credential=a):Gt&&(a=Gt.findCredential(e)),a&&(t.credentialToken=a.token,t.useSSL=!!a.ssl)}}function Qde(t){return fIe.some(e=>e.test(t))}async function _Ie(t){let e=t.params.url;const r=t.params.requestOptions,i=t.fetchOptions??{},s=x_(e)||Jf(e),n=r.responseType||"json",o=s?0:r.timeout!=null?r.timeout:Md.timeout;let a=!1;if(!s){t.useSSL&&(e=Pq(e)),r.cacheBust&&i.cache==="default"&&(e=jde(e,"request.preventCache",Date.now()));let f={...r.query};t.credentialToken&&(f.token=t.credentialToken);let m=kb(f);oe("esri-url-encodes-apostrophe")&&(m=m.replaceAll("'","%27"));const y=e.length+1+m.length;let _;a=r.method==="delete"||r.method==="post"||r.method==="put"||!!r.body||y>Md.maxUrlLength;const v=r.useProxy||!!xR(e);if(v){const w=BMe(e);_=w.path,!a&&_.length+1+y>Md.maxUrlLength&&(a=!0),w.query&&(f={...w.query,...f})}if(i.method==="HEAD"&&(a||v)){if(a)throw y>Md.maxUrlLength?Ef("request:invalid-parameters",new Error("URL exceeds maximum length"),t.params):Ef("request:invalid-parameters",new Error("cannot use POST request when method is 'head'"),t.params);if(v)throw Ef("request:invalid-parameters",new Error("cannot use proxy when method is 'head'"),t.params)}a?(i.method=r.method==="delete"?"DELETE":r.method==="put"?"PUT":"POST",r.body?e=I$(e,f):(i.body=kb(f),i.headers||(i.headers={}),i.headers["Content-Type"]="application/x-www-form-urlencoded")):e=I$(e,f),v&&(t.useProxy=!0,e=`${_}?${e}`),f.token&&Jde&&i.body instanceof FormData&&!Lde(e)&&i.body.set("token",f.token),r.hasOwnProperty("withCredentials")?t.withCredentials=r.withCredentials:Ql(e,Sq())||(Cq(e)||Gt&&Gt.findServerInfo(e)?.webTierAuth)&&(t.withCredentials=!0),t.withCredentials&&(i.credentials="include",uIe(e)&&await hIe(a?I$(e,f):e))}let l,c,h=0,p=!1;o>0&&(h=setTimeout(()=>{p=!0,t.controller.abort()},o));try{if(r.responseType==="native-request-init")c=i,c.url=e;else if(r.responseType!=="image"||i.cache!=="default"||i.method!=="GET"||a||bIe(r.headers)||!s&&!t.useProxy&&Md.proxyUrl&&!$Q(e)){if(l=await qt._abortableFetch(e,i),t.useProxy||mIe(e),r.responseType==="native")c=l;else if(i.method!=="HEAD")if(l.ok){switch(n){case"array-buffer":c=await l.arrayBuffer();break;case"blob":case"image":c=await l.blob();break;default:c=await l.text()}if(h&&(clearTimeout(h),h=0),n==="json"||n==="xml"||n==="document")if(c)switch(n){case"json":c=JSON.parse(c);break;case"xml":c=LQ(c,"application/xml");break;case"document":c=LQ(c,"text/html")}else c=null;if(c){if(n==="array-buffer"||n==="blob"){const f=l.headers.get("Content-Type");if(f&&/application\/json|text\/plain/i.test(f)&&c[n==="blob"?"size":"byteLength"]<=750)try{const m=await new Response(c).json();m.error&&(c=m)}catch{}}n==="image"&&c instanceof Blob&&(c=await DQ(URL.createObjectURL(c),t,!0))}}else{c=await l.text();try{c=JSON.parse(c)}catch{}}}else c=await DQ(e,t)}catch(f){if(f.name==="AbortError")throw p?lIe():Dr("Request canceled");if(!(!l&&f instanceof TypeError&&Md.proxyUrl)||r.body||r.method==="delete"||r.method==="head"||r.method==="post"||r.method==="put"||t.useProxy||$Q(e))throw f;t.redoRequest=!0,GMe({proxyUrl:Md.proxyUrl,urlPrefix:Yd(e)??""})}finally{h&&clearTimeout(h)}return[l,c]}async function vIe(t,e){if(t.responseData!=null)return t.responseData;if(t.headers&&(e.requestOptions.headers={...e.requestOptions.headers,...t.headers}),t.query&&(e.requestOptions.query={...e.requestOptions.query,...t.query}),t.before){let r,i;try{i=await t.before(e)}catch(s){r=Ef("request:interceptor",s,e)}if((i instanceof Error||i instanceof F)&&(r=Ef("request:interceptor",i,e)),r)throw t.error&&t.error(r),r;return i}}function bIe(t){if(t){for(const e of Object.getOwnPropertyNames(t))if(t[e])return!0}return!1}function LQ(t,e){let r;try{r=new DOMParser().parseFromString(t,e)}catch{}if(!r||r.getElementsByTagName("parsererror").length)throw new SyntaxError("XML Parse error");return r}async function wIe(t){let e,r;await yIe(t);try{do[e,r]=await _Ie(t);while(!await xIe(t,e,r))}catch(n){const o=Ef("request:server",n,t.params,e);throw o.details.ssl=t.useSSL,t.interceptor?.error&&t.interceptor.error(o),o}const i=t.params.url;if(r&&/\/sharing\/rest\/(accounts|portals)\/self/i.test(i)){if(!t.hasToken&&!t.credentialToken&&r.user?.username&&!Cq(i)){const n=Yd(i,!0);n&&Md.trustedServers.push(n)}Array.isArray(r.authorizedCrossOriginNoCorsDomains)&&cIe(r.authorizedCrossOriginNoCorsDomains)}const s=t.credential;if(s&&Gt){let o=Gt.findServerInfo(s.server)?.owningSystemUrl;if(o){o=o.replace(/\/?$/,"/sharing");const a=Gt.findCredential(o,s.userId);a&&Gt._getIdenticalSvcIdx(o,a)===-1&&a.resources.unshift(o)}}return{data:r,getHeader:e?n=>e?.headers.get(n):Lq,httpStatus:e?.status??200,requestOptions:t.params.requestOptions,ssl:t.useSSL,url:t.params.url}}async function xIe(t,e,r){if(t.redoRequest)return t.redoRequest=!1,!1;const i=t.params.requestOptions;if(!e||i.responseType==="native"||i.responseType==="native-request-init")return!0;let s,n;if(r&&(r.error?s=r.error:r.status==="error"&&Array.isArray(r.messages)&&(s={...r},s[FD]=r,s.details=r.messages)),!s&&!e.ok)throw s=new Error(`Unable to load ${e.url} status: ${e.status}`),s[FD]=r,s;let o,a=null;s&&(n=Number(s.code),a=s.hasOwnProperty("subcode")?Number(s.subcode):null,o=s.messageCode,o=o?.toUpperCase());const l=i.authMode;if(n===403&&(a===4||s.message?.toLowerCase().includes("ssl")&&!s.message.toLowerCase().includes("permission"))){if(!t.useSSL)return t.useSSL=!0,!1}else if(!t.hasToken&&t.useIdentity&&(l!=="no-prompt"||n===498)&&n!==void 0&&dIe.includes(n)&&!Qde(t.params.url)&&(n!==403||o&&!pIe.includes(o)&&(a==null||a===2&&t.credentialToken))){await Qk();try{const c=await Gt.getCredential(t.params.url,{error:Ef("request:server",s,t.params),prompt:l!=="no-prompt",signal:t.controller.signal,token:t.credentialToken});return t.credential=c,t.credentialToken=c.token,t.useSSL=t.useSSL||c.ssl,!1}catch(c){if(l==="no-prompt")return t.credential=void 0,t.credentialToken=void 0,!1;s=c}}if(s)throw s;return!0}function DQ(t,e,r=!1){const i=e.controller.signal,s=new Image;return e.withCredentials?s.crossOrigin="use-credentials":s.crossOrigin="anonymous",s.alt="",s.fetchPriority=Md.priority,s.src=t,Xde(s,t,r,i)}qt._abortableFetch=null,qt._corsServers=["https://server.arcgisonline.com","https://services.arcgisonline.com"];const Kde=Object.freeze(Object.defineProperty({__proto__:null,default:qt},Symbol.toStringTag,{value:"Module"}));async function TIe(t,e,r,i){const s=e.exec(r);if(!s)throw new F("esri-intl:invalid-bundle",`Bundle id "${r}" is not compatible with the pattern "${e}"`);const n=s[1]?`${s[1]}/`:"",o=s[2],a=CMe(i),l=`${n}${o}.json`,c=a?`${n}${o}_${a}.json`:l;let h;try{h=await NQ(t(c))}catch(p){if(c===l)throw new F("intl:unknown-bundle",`Bundle "${r}" cannot be loaded`,{error:p});try{h=await NQ(t(l))}catch(f){throw new F("intl:unknown-bundle",`Bundle "${r}" cannot be loaded`,{error:f})}}return h}async function NQ(t){if(FQ.fetchBundleAsset!=null)return FQ.fetchBundleAsset(t);const e=await qt(t,{responseType:"text"});return JSON.parse(e.data)}let SIe=class{constructor({base:e="",pattern:r,location:i=new URL(window.location.href)}){let s;s=typeof i=="string"?n=>new URL(n,new URL(i,window.location.href)).href:i instanceof URL?n=>new URL(n,i).href:i,this.pattern=typeof r=="string"?new RegExp(`^${r}`):r,this.getAssetUrl=s,e=e?e.endsWith("/")?e:e+"/":"",this.matcher=new RegExp(`^${e}(?:(.*)/)?(.*)$`)}fetchMessageBundle(e,r){return TIe(this.getAssetUrl,this.matcher,e,r)}};function EIe(t){return new SIe(t)}const FQ={},CIe=Q.getLogger("esri.assets");function AIe(t,e){return qt(kr(t),e)}function kr(t){if(!Ur.assetsPath)throw CIe.errorOnce("The API assets location needs to be set using config.assetsPath. More information: https://arcg.is/1OzLe50"),new F("assets:path-not-set","config.assetsPath is not set");return bc(Ur.assetsPath,t)}EMe(EIe({pattern:"esri/",location:kr}));function $Tt(t){const e=[];return function*(){yield*e;for(const r of t)e.push(r),yield r}}function OIe(t,e){for(const r of t)if(r!=null&&e(r))return r}function Kk(t){return t!=null&&typeof t[Symbol.iterator]=="function"}let Oi=class eV{constructor(){this._groups=new Map}destroy(){this.removeAll()}get size(){let e=0;return this._groups.forEach(r=>{e+=r.length}),e}add(e,r){if(Kk(e)){const i=this._getOrCreateGroup(r);for(const s of e)this._isHandle(s)&&i.push(s)}else this._isHandle(e)&&this._getOrCreateGroup(r).push(e);return this}forEach(e,r){if(typeof e=="function")this._groups.forEach(i=>i.forEach(e));else{const i=this._getGroup(e);i&&r&&i.forEach(r)}}has(e){return this._groups.has(this._ensureGroupKey(e))}remove(e){if(typeof e!="string"&&Kk(e)){for(const r of e)this.remove(r);return this}return this.has(e)?(this._removeAllFromGroup(this._getGroup(e)),this._groups.delete(this._ensureGroupKey(e)),this):this}removeAll(){return this._groups.forEach(e=>this._removeAllFromGroup(e)),this._groups.clear(),this}_isHandle(e){return e&&(!!e.remove||e instanceof eV)}_getOrCreateGroup(e){if(this.has(e))return this._getGroup(e);const r=[];return this._groups.set(this._ensureGroupKey(e),r),r}_getGroup(e){return this._groups.get(this._ensureGroupKey(e))}_ensureGroupKey(e){return e||"_default_"}_removeAllFromGroup(e){for(const r of e)r instanceof eV?r.removeAll():r.remove()}};const epe=Symbol("Accessor-beforeDestroy");function XS(t){return bo(()=>t.forEach(e=>e!=null&&e.remove()))}function bo(t){return{remove:()=>{t&&(t(),t=void 0)}}}function LTt(t){return bo(()=>{const e=t();e?.remove()})}function DTt(t){return bo(()=>t?.abort())}function NTt(t){return bo(t!=null?()=>t.destroy():void 0)}function ua(t){return t.__accessor__??null}function RIe(t,e){return t!=null&&t.metadatas&&t.metadatas[e]!=null}function $$(t,e,r){return r?UD(t,e,{policy:r,path:""}):UD(t,e,null)}function UD(t,e,r){return e?Object.keys(e).reduce((i,s)=>{const n=s;let o=null,a="merge";if(r&&(o=r.path?`${r.path}.${s}`:s,a=r.policy(o)),a==="replace"||a==="replace-arrays"&&Array.isArray(i[n]))return i[n]=e[n],i;if(i[n]===void 0)return i[n]=K(e[n]),i;let l=i[n],c=e[n];if(l===c)return i;if(Array.isArray(c)||Array.isArray(i))l=l?Array.isArray(l)?i[n]=l.concat():i[n]=[l]:i[n]=[],c&&(Array.isArray(c)||(c=[c]),c.forEach(h=>{l.includes(h)||l.push(h)}));else if(c&&typeof c=="object")if(r){const h=r.path;r.path=o,i[n]=UD(l,c,r),r.path=h}else i[n]=UD(l,c,null);else i.hasOwnProperty(s)&&!e.hasOwnProperty(s)||(i[n]=c);return i},t||{}):t}function tpe(t){return Array.isArray(t)?t:t.split(".")}function UQ(t){return t.includes(",")?t.split(",").map(e=>e.trim()):[t.trim()]}function PIe(t){if(Array.isArray(t)){const e=[];for(const r of t)e.push(...UQ(r));return e}return UQ(t)}function rpe(t,e,r,i){const s=PIe(e);if(s.length!==1){const n=s.map(o=>i(t,o,r));return XS(n)}return i(t,s[0],r)}function Dq(t){let e=!1;return()=>{e||(e=!0,t())}}function ipe(t,e){const r=t[t.length-1]==="?"?t.slice(0,-1):t;if(e.getItemAt!=null||Array.isArray(e)){const s=parseInt(r,10);if(!isNaN(s))return Array.isArray(e)?e[s]:e.at(s)}const i=ua(e);return RIe(i,r)?i.get(r):e[r]}function spe(t,e,r){if(t==null)return t;const i=ipe(e[r],t);return!i&&r<e.length-1?void 0:r===e.length-1?i:spe(i,e,r+1)}function TR(t,e,r=0){return typeof e!="string"||e.includes(".")?spe(t,tpe(e),r):ipe(e,t)}function kD(t,e){return TR(t,e)}function kQ(t,e){return TR(e,t)!==void 0}function SR(t){let e=t.constructor.__accessorMetadata__;const r=Object.prototype.hasOwnProperty.call(t.constructor,"__accessorMetadata__");if(e){if(!r){e=Object.create(e);for(const i in e)e[i]=K(e[i]);Object.defineProperty(t.constructor,"__accessorMetadata__",{value:e,enumerable:!1,configurable:!0,writable:!0})}}else e={},Object.defineProperty(t.constructor,"__accessorMetadata__",{value:e,enumerable:!1,configurable:!0,writable:!0});return t.constructor.__accessorMetadata__}function ER(t,e){const r=SR(t);let i=r[e];return i||(i=r[e]={}),i}function MIe(t,e){return $$(t,e,$Ie)}const IIe=/^(?:[^.]+\.)?(?:value|type|(?:json\.type|json\.origins\.[^.]\.type))$/;function $Ie(t){return IIe.test(t)?"replace":"merge"}function LIe(t){return t&&t.release&&typeof t.release=="function"}function DIe(t){return t&&t.acquire&&typeof t.acquire=="function"}let Vo=class tV{constructor(e,r,i,s=1,n=0){if(this._ctor=e,this._acquireFunction=r,this._releaseFunction=i,this.allocationSize=s,this._pool=new Array(n),this._initialSize=n,this._ctor)for(let o=0;o<n;o++)this._pool[o]=new this._ctor;this.allocationSize=Math.max(s,1)}destroy(){this.prune(0)}acquire(...e){let r;if(tV.test.disabled)r=new this._ctor;else{if(this._pool.length===0){const i=this.allocationSize;for(let s=0;s<i;s++)this._pool[s]=new this._ctor}r=this._pool.pop()}return this._acquireFunction?this._acquireFunction(r,...e):DIe(r)&&r.acquire(...e),r}release(e){e&&!tV.test.disabled&&(this._releaseFunction?this._releaseFunction(e):LIe(e)&&e.release(),this._pool.push(e))}prune(e=this._initialSize){if(!(e>=this._pool.length)){for(let r=e;r<this._pool.length;++r){const i=this._pool[r];this._dispose(i)}this._pool.length=e}}_dispose(e){e.dispose&&typeof e.dispose=="function"&&e.dispose()}};Vo.test={disabled:!1};var ag;(function(t){t[t.INITIALIZING=0]="INITIALIZING",t[t.CONSTRUCTING=1]="CONSTRUCTING",t[t.CONSTRUCTED=2]="CONSTRUCTED"})(ag||(ag={}));let NIe=class{constructor(e,r){this._observers=e,this._observer=r}remove(){aq(this._observers,this._observer)}},npe=class{constructor(){this._observers=null,this.destroyed=!1}observe(e){if(this.destroyed||e.destroyed)return FIe;this._observers==null&&(this._observers=[]);const r=this._observers;let i=!1,s=!1;const n=r.length;for(let o=0;o<n;++o){const a=r[o];if(a.destroyed)s=!0;else if(a===e){i=!0;break}}return i||(r.push(e),s&&this._removeDestroyedObservers()),new NIe(r,e)}_removeDestroyedObservers(){const e=this._observers;if(!e||e.length===0)return;const r=e.length;let i=0;for(let s=0;s<r;++s){for(;s+i<r&&e[s+i].destroyed;)++i;if(i>0){if(!(s+i<r))break;e[s]=e[s+i]}}e.length=r-i}destroy(){if(this.destroyed)return;this.destroyed=!0;const e=this._observers;if(e!=null){for(const r of e)r.onCommitted();this._observers=null}}};const FIe=bo();var pr;(function(t){t[t.DEFAULTS=0]="DEFAULTS",t[t.COMPUTED=1]="COMPUTED",t[t.SERVICE=2]="SERVICE",t[t.PORTAL_ITEM=3]="PORTAL_ITEM",t[t.WEB_SCENE=4]="WEB_SCENE",t[t.WEB_MAP=5]="WEB_MAP",t[t.LINK_CHART=6]="LINK_CHART",t[t.USER=7]="USER"})(pr||(pr={}));const rV=pr.USER+1;function dg(t){switch(t){case"defaults":return pr.DEFAULTS;case"service":return pr.SERVICE;case"portal-item":return pr.PORTAL_ITEM;case"web-scene":return pr.WEB_SCENE;case"web-map":return pr.WEB_MAP;case"link-chart":return pr.LINK_CHART;case"user":return pr.USER;default:return null}}function VD(t){switch(t){case pr.DEFAULTS:return"defaults";case pr.SERVICE:return"service";case pr.PORTAL_ITEM:return"portal-item";case pr.WEB_SCENE:return"web-scene";case pr.WEB_MAP:return"web-map";case pr.LINK_CHART:return"link-chart";case pr.USER:return"user"}return void 0}function UIe(t){return VD(t)}var Ci;(function(t){t[t.Dirty=1]="Dirty",t[t.Overriden=2]="Overriden",t[t.Computing=4]="Computing",t[t.NonNullable=8]="NonNullable",t[t.HasDefaultValue=16]="HasDefaultValue",t[t.DepTrackingInitialized=32]="DepTrackingInitialized",t[t.AutoTracked=64]="AutoTracked",t[t.ExplicitlyTracking=128]="ExplicitlyTracking"})(Ci||(Ci={}));const zD={onObservableAccessed:()=>{},onTrackingEnd:()=>{}},VC=[];let b3=zD;function Ht(t){b3.onObservableAccessed(t)}let L$=!1,D$=!1;function Ig(t,e,r){if(L$)return Nq(t,e,r);ope(t);const i=e.call(r);return ape(),i}function kIe(t,e){return Ig(zD,t,e)}function Nq(t,e,r){const i=L$;L$=!0,ope(t);let s=null;try{s=e.call(r)}catch(n){D$&&Q.getLogger("esri.core.accessorSupport.tracking").error(n)}return ape(),L$=i,s}function ope(t){b3=t,VC.push(t)}function ape(){const t=VC.length;if(t>1){const e=VC.pop();b3=VC[t-2],e.onTrackingEnd()}else if(t===1){const e=VC.pop();b3=zD,e.onTrackingEnd()}else b3=zD}function lpe(t,e){const r=e.observerObject;if(r.flags&Ci.DepTrackingInitialized)return;const i=D$;D$=!1,r.flags&Ci.AutoTracked?Nq(e,e.metadata.get,t):cpe(t,e),D$=i}const VIe=[];function cpe(t,e){const r=e.observerObject;r.flags&Ci.ExplicitlyTracking||(r.flags|=Ci.ExplicitlyTracking,Nq(e,()=>{const i=e.metadata.dependsOn||VIe;for(const s of i)if(typeof s!="string"||s.includes(".")){const n=tpe(s);for(let o=0,a=t;o<n.length&&a!=null&&typeof a=="object";++o)a=VQ(a,n[o],o!==n.length-1)}else VQ(t,s,!1)}),r.flags&=~Ci.ExplicitlyTracking)}function VQ(t,e,r){const i=e[e.length-1]==="?"?e.slice(0,-1):e;if(t.getItemAt!=null||Array.isArray(t)){const n=parseInt(i,10);if(!isNaN(n))return Array.isArray(t)?t[n]:t.at(n)}const s=ua(t);if(s){const n=s.propertiesByName.get(i);n&&(Ht(n.observerObject),lpe(t,n))}return r?t[i]:void 0}let zQ=class{constructor(e,r){this.propertyName=e,this.metadata=r,this.observerObject=new zIe,this._accessed=null,this._handles=null,this.observerObject.flags=Ci.Dirty|(r.nonNullable?Ci.NonNullable:0)|(r.hasOwnProperty("value")?Ci.HasDefaultValue:0)|(r.get===void 0?Ci.DepTrackingInitialized:0)|(r.dependsOn===void 0?Ci.AutoTracked:0)}destroy(){this.observerObject.destroy(),this._accessed=null,this._clearObservationHandles()}getComputed(e){const r=this.observerObject;Ht(r);const i=e.store,s=this.propertyName,n=r.flags,o=i.get(s);if(n&Ci.Computing||~n&Ci.Dirty&&i.has(s))return o;r.flags|=Ci.Computing;const a=e.host;let l;n&Ci.AutoTracked?l=Ig(this,this.metadata.get,a):(cpe(a,this),l=this.metadata.get.call(a)),i.set(s,l,pr.COMPUTED);const c=i.get(s);return c===o?r.flags&=~Ci.Dirty:kIe(this.commit,this),r.flags&=~Ci.Computing,c}onObservableAccessed(e){if(e===this.observerObject)return;let r=this._accessed;if(r==null)r=[],this._accessed=r;else if(r.includes(e))return;r.push(e)}onTrackingEnd(){this._clearObservationHandles();const e=this.observerObject;e.flags|=Ci.DepTrackingInitialized;const r=this._accessed;if(r==null||r.length===0)return;let i=this._handles;i==null&&(i=[],this._handles=i);for(let s=0;s<r.length;++s)i.push(r[s].observe(e));r.length=0}notifyChange(){const e=this.observerObject;e.onInvalidated(),e.onCommitted()}invalidate(){this.observerObject.onInvalidated()}commit(){const e=this.observerObject;e.flags&=~Ci.Dirty,e.onCommitted()}_clearObservationHandles(){const e=this._handles;if(e!==null){for(let r=0;r<e.length;++r)e[r].remove();e.length=0}}},zIe=class extends npe{constructor(){super(...arguments),this.flags=0}onInvalidated(){~this.flags&Ci.Overriden&&(this.flags|=Ci.Dirty);const e=this._observers;if(e&&e.length>0)for(const r of e)r.onInvalidated()}onCommitted(){const e=this._observers;if(e&&e.length>0){const r=e.slice();for(const i of r)i.onCommitted()}}destroy(){this.flags&Ci.Dirty&&this.onCommitted(),super.destroy()}},BIe=class upe{constructor(){this._values=new Map,this.multipleOriginsSupported=!1}clone(e){const r=new upe;return this._values.forEach((i,s)=>{e&&e.has(s)||r.set(s,K(i))}),r}get(e){return this._values.get(e)}originOf(){return pr.USER}keys(){return[...this._values.keys()]}set(e,r){this._values.set(e,r)}delete(e){this._values.delete(e)}has(e){return this._values.has(e)}forEach(e){this._values.forEach(e)}};function AP(t,e,r){return t!==void 0}function BQ(t,e,r,i){return t!==void 0&&(!(r==null&&t.observerObject.flags&Ci.NonNullable)||(i.lifecycle,ag.INITIALIZING,!1))}function GIe(t){return t&&typeof t.destroy=="function"}Q.getLogger("esri.core.accessorSupport.Properties");let jIe=class{constructor(e){this.host=e,this.propertiesByName=new Map,this.ctorArgs=null,this.destroyed=!1,this.lifecycle=ag.INITIALIZING,this.store=new BIe,this._origin=pr.USER;const r=this.host.constructor.__accessorMetadata__;for(const i in r){const s=new zQ(i,r[i]);this.propertiesByName.set(i,s)}this.metadatas=r}initialize(){this.lifecycle=ag.CONSTRUCTING}constructed(){this.lifecycle=ag.CONSTRUCTED}destroy(){this.destroyed=!0;for(const[e,r]of this.propertiesByName){if(r.metadata.autoDestroy){const i=this.internalGet(e);i&&GIe(i)&&(i.destroy(),~r.observerObject.flags&Ci.NonNullable&&this._internalSet(r,null))}r.destroy()}}get initialized(){return this.lifecycle!==ag.INITIALIZING}get(e){const r=this.propertiesByName.get(e);if(r.metadata.get)return r.getComputed(this);Ht(r.observerObject);const i=this.store;return i.has(e)?i.get(e):r.metadata.value}originOf(e){const r=this.store.originOf(e);if(r===void 0){const i=this.propertiesByName.get(e);if(i!==void 0&&i.observerObject.flags&Ci.HasDefaultValue)return"defaults"}return VD(r)}has(e){return!!this.propertiesByName.has(e)&&this.store.has(e)}keys(){return[...this.propertiesByName.keys()]}internalGet(e){const r=this.propertiesByName.get(e);if(AP(r))return this.store.has(e)?this.store.get(e):r.metadata.value}internalSet(e,r){const i=this.propertiesByName.get(e);AP(i)&&this._internalSet(i,r)}getDependsInfo(e,r,i){const s=this.propertiesByName.get(r);if(!AP(s))return"";const n=new Set,o=Ig({onObservableAccessed:l=>n.add(l),onTrackingEnd:()=>{}},()=>s.metadata.get?.call(e));let a=`${i}${e.declaredClass.split(".").pop()}.${r}: ${o}
`;if(n.size===0)return a;i+="  ";for(const l of n)l instanceof zQ&&(a+=`${i}${l.propertyName}: undefined
`);return a}setAtOrigin(e,r,i){const s=this.propertiesByName.get(e);if(AP(s))return this._setAtOrigin(s,r,i)}isOverridden(e){const r=this.propertiesByName.get(e);return r!==void 0&&!!(r.observerObject.flags&Ci.Overriden)}clearOverride(e){const r=this.propertiesByName.get(e),i=r?.observerObject;i&&i.flags&Ci.Overriden&&(i.flags&=~Ci.Overriden,r.notifyChange())}override(e,r){const i=this.propertiesByName.get(e);if(!BQ(i,e,r,this))return;const s=i.metadata.cast;if(s){const n=this._cast(s,r),{valid:o,value:a}=n;if(W6.release(n),!o)return;r=a}i.observerObject.flags|=Ci.Overriden,this._internalSet(i,r)}set(e,r){const i=this.propertiesByName.get(e);if(!BQ(i,e,r,this))return;const s=i.metadata.cast;if(s){const o=this._cast(s,r),{valid:a,value:l}=o;if(W6.release(o),!a)return;r=l}const n=i.metadata.set;n?n.call(this.host,r):this._internalSet(i,r)}setDefaultOrigin(e){this._origin=dg(e)}getDefaultOrigin(){return VD(this._origin)}notifyChange(e){const r=this.propertiesByName.get(e);r!==void 0&&r.notifyChange()}invalidate(e){const r=this.propertiesByName.get(e);r!==void 0&&r.invalidate()}commit(e){const r=this.propertiesByName.get(e);r!==void 0&&r.commit()}_internalSet(e,r){const i=this.lifecycle!==ag.INITIALIZING?this._origin:pr.DEFAULTS;this._setAtOrigin(e,r,i)}_setAtOrigin(e,r,i){const s=this.store,n=e.propertyName;s.has(n,i)&&cq(r,s.get(n))&&~e.observerObject.flags&Ci.Overriden&&i===s.originOf(n)||(e.invalidate(),s.set(n,r,i),e.commit(),lpe(this.host,e))}_cast(e,r){const i=W6.acquire();return i.valid=!0,i.value=r,e&&(i.value=e.call(this.host,r,i)),i}},HIe=class{constructor(){this.value=null,this.valid=!0}acquire(){this.valid=!0}release(){this.value=null}};const W6=new Vo(HIe);function BD(t,e,r){if(t&&e)if(typeof e=="object")for(const i of Object.getOwnPropertyNames(e))BD(t,i,e[i]);else{if(e.includes(".")){const s=e.split("."),n=s.splice(s.length-1,1)[0];return void BD(kD(t,s),n,r)}const i=t.__accessor__;i!=null&&qIe(e,i),t[e]=r}}function qIe(t,e){if(oe("esri-unknown-property-errors")&&!WIe(t,e))throw new F("set:unknown-property",ZIe(t,e))}function WIe(t,e){return e.metadatas[t]!=null}function ZIe(t,e){return"setting unknown property '"+t+"' on instance of "+e.host.declaredClass}let XIe;function YIe(){return XIe}function JIe(t){t.length=0}let oc=class{constructor(e=50,r=50){this._pool=new Vo(Array,void 0,JIe,r,e)}acquire(){return this._pool.acquire()}release(e){this._pool.release(e)}prune(){this._pool.prune(0)}static acquire(){return Z6.acquire()}static release(e){return Z6.release(e)}static prune(){Z6.prune()}};const Z6=new oc(100);let hpe=class extends Vo{constructor(){super(...arguments),this._set=new Set}destroy(){super.destroy(),this._set=X2(this._set)}acquire(...e){const r=super.acquire(...e);return this._set.delete(r),r}release(e){e&&!this._set.has(e)&&(super.release(e),this._set.add(e))}_dispose(e){this._set.delete(e),super._dispose(e)}};const OP=[];function YS(t){OP.push(t),OP.length===1&&queueMicrotask(()=>{const e=OP.slice();OP.length=0;for(const r of e)r()})}let pg=class{constructor(e,r=30){this.name=e,this._counter=0,this._samples=new Array(r)}record(e){e!=null&&(this._samples[++this._counter%this._samples.length]=e)}get median(){return this._samples.slice().sort((e,r)=>e-r)[Math.floor(this._samples.length/2)]}get average(){return this._samples.reduce((e,r)=>e+r,0)/this._samples.length}get last(){return this._samples[this._counter%this._samples.length]}};var iV;(function(t){const e=(n,o,a,l)=>{let c=o,h=o;const p=a>>>1,f=n[c-1];for(;h<=p;){h=c<<1,h<a&&l(n[h-1],n[h])<0&&++h;const m=n[h-1];if(l(m,f)<=0)break;n[c-1]=m,c=h}n[c-1]=f},r=(n,o)=>n<o?-1:n>o?1:0;function i(n,o,a,l){o===void 0&&(o=0),a===void 0&&(a=n.length),l===void 0&&(l=r);for(let h=a>>>1;h>o;h--)e(n,h,a,l);const c=o+1;for(let h=a-1;h>o;h--){const p=n[o];n[o]=n[h],n[h]=p,e(n,c,h,l)}}function*s(n,o,a,l){o===void 0&&(o=0),a===void 0&&(a=n.length),l===void 0&&(l=r);for(let h=a>>>1;h>o;h--)e(n,h,a,l),yield;const c=o+1;for(let h=a-1;h>o;h--){const p=n[o];n[o]=n[h],n[h]=p,e(n,c,h,l),yield}}t.sort=i,t.iterableSort=s})(iV||(iV={}));const GQ=iV,QIe=1.5,KIe=1.1;let kt=class{constructor(e){this.data=[],this._length=0,this._allocator=void 0,this._deallocator=()=>null,this._shrink=()=>{},this._hint=new dhe,e&&(e.initialSize&&(this.data=new Array(e.initialSize)),e.allocator&&(this._allocator=e.allocator),e.deallocator!==void 0&&(this._deallocator=e.deallocator),e.shrink&&(this._shrink=()=>jQ(this)))}toArray(){return this.data.slice(0,this.length)}filter(e){const r=new Array;for(let i=0;i<this._length;i++){const s=this.data[i];e(s)&&r.push(s)}return r}at(e){if((e=Math.trunc(e)||0)<0&&(e+=this._length),!(e<0||e>=this._length))return this.data[e]}includes(e,r){const i=this.data.indexOf(e,r);return i!==-1&&i<this.length}get length(){return this._length}set length(e){if(e>this._length){if(this._allocator){for(;this._length<e;)this.data[this._length++]=this._allocator(this.data[this._length]);return}this._length=e}else{if(this._deallocator)for(let r=e;r<this._length;++r)this.data[r]=this._deallocator(this.data[r]);this._length=e,this._shrink()}}clear(){this.length=0}prune(){this.clear(),this.data=[]}push(e){this.data[this._length++]=e}pushArray(e,r=e.length){for(let i=0;i<r;i++)this.data[this._length++]=e[i]}fill(e,r){for(let i=0;i<r;i++)this.data[this._length++]=e}pushNew(){this._allocator&&(this.data[this.length]=this._allocator(this.data[this.length]));const e=this.data[this._length];return++this._length,e}unshift(e){this.data.unshift(e),this._length++,jQ(this)}pop(){if(this.length===0)return;const e=this.data[this.length-1];return this.length=this.length-1,this._shrink(),e}remove(e){const r=Nk(this.data,e,this.length,this._hint);if(r!==-1)return this.data.splice(r,1),this.length=this.length-1,e}removeUnordered(e){return this.removeUnorderedIndex(Nk(this.data,e,this.length,this._hint))}removeUnorderedIndex(e){if(!(e>=this.length||e<0))return this.swapElements(e,this.length-1),this.pop()}removeUnorderedMany(e,r=e.length,i){this.length=qOe(this.data,e,this.length,r,this._hint,i),this._shrink()}front(){if(this.length!==0)return this.data[0]}back(){if(this.length!==0)return this.data[this.length-1]}swapElements(e,r){if(e>=this.length||r>=this.length||e===r)return;const i=this.data[e];this.data[e]=this.data[r],this.data[r]=i}sort(e){GQ.sort(this.data,0,this.length,e)}iterableSort(e){return GQ.iterableSort(this.data,0,this.length,e)}some(e,r){for(let i=0;i<this.length;++i)if(e.call(r,this.data[i],i,this.data))return!0;return!1}find(e,r){for(let i=0;i<this.length;++i){const s=this.data[i];if(e.call(r,s,i))return s}}filterInPlace(e,r){let i=0;for(let s=0;s<this._length;++s){const n=this.data[s];e.call(r,n,s,this.data)&&(this.data[s]=this.data[i],this.data[i]=n,i++)}if(this._deallocator)for(let s=i;s<this._length;s++)this.data[s]=this._deallocator(this.data[s]);return this._length=i,this._shrink(),this}forAll(e,r){const i=this.length,s=this.data;for(let n=0;n<i;++n)e.call(r,s[n],n,s)}forEach(e,r){for(let i=0;i<this.length;++i)e.call(r,this.data[i],i,this.data)}map(e,r){const i=new Array(this.length);for(let s=0;s<this.length;++s)i[s]=e.call(r,this.data[s],s,this.data);return i}reduce(e,r){let i=r;for(let s=0;s<this.length;++s)i=e(i,this.data[s],s,this.data);return i}has(e){const r=this.length,i=this.data;for(let s=0;s<r;++s)if(i[s]===e)return!0;return!1}};function jQ(t){t.data.length>QIe*t.length&&(t.data.length=Math.floor(t.length*KIe))}function WTt(t){return t}function dpe(t){return 1e3*t}function Fq(t){return .001*t}function e$e(){return performance.now()}let t$e=class{constructor(e){this.phases=e,this.paused=!1,this.ticks=-1,this.removed=!1}},r$e=class{constructor(e){this.callback=e,this.isActive=!0}remove(){this.isActive=!1}},sV=0,nV=0;const LE={time:0,deltaTime:0,elapsedFrameTime:0,frameDuration:0},oV=["prepare","preRender","render","postRender","update","finish"],aV=[],zb=new kt;let i$e=class{constructor(e){this._task=e}remove(){this._task.removed=!0}pause(){this._task.paused=!0}resume(){this._task.paused=!1}};const GD={frameTasks:zb,willDispatch:!1,clearFrameTasks:s$e,dispatch:mpe,executeFrameTasks:o$e};function J2(t){const e=new r$e(t);return aV.push(e),GD.willDispatch||(GD.willDispatch=!0,YS(mpe)),e}function JS(t){const e=new t$e(t);return zb.push(e),jD==null&&(sV=performance.now(),jD=requestAnimationFrame(ppe)),new i$e(e)}let jD=null;function s$e(t=!1){zb.forAll(e=>{e.removed=!0}),t&&fpe()}function n$e(t){nV=Math.max(0,t)}function ppe(){const t=performance.now();jD=null,jD=zb.length>0?requestAnimationFrame(ppe):null,GD.executeFrameTasks(t)}function o$e(t){const e=t-sV;sV=t;const r=nV>0?nV:1e3/60,i=Math.max(0,e-r);LE.time=t,LE.frameDuration=r-i;for(let s=0;s<oV.length;s++){const n=performance.now(),o=oV[s];zb.forAll(a=>{a.paused||a.removed||(s===0&&a.ticks++,a.phases[o]&&(LE.elapsedFrameTime=performance.now()-t,LE.deltaTime=a.ticks===0?0:e,a.phases[o]?.call(a,LE)))}),a$e[s].record(performance.now()-n)}fpe(),l$e.record(performance.now()-t)}const RP=new kt;function fpe(){zb.forAll(t=>{t.removed&&RP.push(t)}),zb.removeUnorderedMany(RP.data,RP.length),RP.clear()}function mpe(){for(;aV.length;){const t=aV.shift();t.isActive&&t.callback()}GD.willDispatch=!1}function JTt(t=1,e){const r=qs(),i=()=>{sn(e)?r.reject(Dr()):t===0?r():(--t,YS(()=>i()))};return i(),r.promise}const a$e=oV.map(t=>new pg(t)),l$e=new pg("total");function N$(t,e){for(const r of t.entries())if(e(r[0]))return!0;return!1}let c$e=0;const u$e=0;function gc(){return++c$e}let wF=class{constructor(e){this._accessed=[],this._handles=[],this._observerObject=new h$e(e),HQ.register(this,new WeakRef(this._observerObject),this)}destroy(){HQ.unregister(this._observerObject),this._accessed.length=0,this._observerObject?.destroy(),this.clear()}onObservableAccessed(e){const r=this._accessed;r.includes(e)||r.push(e)}onTrackingEnd(){const e=this._handles,r=this._accessed,i=this._observerObject;for(let s=0;s<r.length;++s)e.push(r[s].observe(i));r.length=0}clear(){const e=this._handles;for(let r=0;r<e.length;++r)e[r].remove();e.length=0}},h$e=class{constructor(e){this._notify=e,this._invalidCount=0,this.destroyed=!1}onInvalidated(){this._invalidCount++}onCommitted(){if(this.destroyed)return;const e=this._invalidCount;if(e===1)return this._invalidCount=0,void this._notify();this._invalidCount=e>0?e-1:0}destroy(){this.destroyed=!0,this._notify=d$e}};const HQ=new FinalizationRegistry(t=>{t.deref()?.destroy()});function d$e(){}let vS=!1;const HD=[];function gpe(t,e){let r=new wF(n),i=null,s=!1;function n(){if(!r||s)return;if(vS)return void vpe(n);const a=i;r.clear(),vS=!0,s=!0,i=Ig(r,t),s=!1,vS=!1,e(i,a),bpe()}function o(){r&&(r.destroy(),r=null,i=null)}return s=!0,i=Ig(r,t),s=!1,{remove:o}}function ype(t,e){let r=new wF(s),i=null;function s(){e(i,o)}function n(){r&&(r.destroy(),r=null),i=null}function o(){return r?(r.clear(),i=Ig(r,t),i):null}return o(),{remove:n}}function _pe(t){let e=new wF(i),r=!1;function i(){e&&!r&&(vS?vpe(i):(e.clear(),vS=!0,r=!0,Ig(e,t),r=!1,vS=!1,bpe()))}function s(){e&&(e.destroy(),e=null)}return r=!0,Ig(e,t),r=!1,{remove:s}}function vpe(t){HD.includes(t)||HD.unshift(t)}function bpe(){for(;HD.length;)HD.pop()()}var w3;(function(t){t[t.Untracked=0]="Untracked",t[t.Tracked=1]="Tracked"})(w3||(w3={}));let fO=class{constructor(){this.uid=gc(),this.removed=!1,this.type=null,this.oldValue=null,this.callback=null,this.getValue=null,this.target=null,this.path=null,this.equals=null}static acquireUntracked(e,r,i,s,n){return this.pool.acquire(w3.Untracked,e,r,i,s,n,cq)}static acquireTracked(e,r,i,s){return this.pool.acquire(w3.Tracked,e,r,i,null,null,s)}notify(e,r){this.type===w3.Untracked?this.callback.call(this.target,e,r,this.path,this.target):this.callback.call(null,e,r,void 0,void 0)}acquire(e,r,i,s,n,o,a){this.uid=gc(),this.removed=!1,this.type=e,this.oldValue=r,this.callback=i,this.getValue=s,this.target=n,this.path=o,this.equals=a}release(){this.target=this.path=this.oldValue=this.callback=this.getValue=null,this.uid=gc(),this.removed=!0}};fO.pool=new hpe(fO);const F$=new oc,yg=new Set;let qD;function WD(t){yg.delete(t),yg.add(t),qD||(qD=J2(m$e))}function p$e(t){if(t.removed)return;const e=t.oldValue,r=t.getValue();t.equals(e,r)||(t.oldValue=r,t.notify(r,e))}function f$e(t){for(const e of yg.values())e.target===t&&(e.removed=!0)}function m$e(){let t=10;for(;qD&&t--;){qD=null;const e=g$e(),r=F$.acquire();for(const i of e){const s=i.uid;p$e(i),s===i.uid&&i.removed&&r.push(i)}for(const i of yg)i.removed&&(r.push(i),yg.delete(i));for(const i of r)fO.pool.release(i);F$.release(r),F$.release(e),lV.forEach(i=>i())}}function g$e(){const t=F$.acquire();t.length=yg.size;let e=0;for(const r of yg)t[e]=r,++e;return yg.clear(),t}const lV=new Set;function wpe(t){return lV.add(t),{remove(){lV.delete(t)}}}function y$e(t,e,r){let i=rpe(t,e,r,(s,n,o)=>{let a,l,c=ype(()=>TR(s,n),(h,p)=>{s.__accessor__.destroyed||a&&a.uid!==l?i.remove():(a||(a=fO.acquireUntracked(h,o,p,s,n),l=a.uid),WD(a))});return{remove:Dq(()=>{c.remove(),a&&(a.uid!==l||a.removed||(a.removed=!0,WD(a)),a=null),i=c=null})}});return i}function _$e(t,e,r){const i=rpe(t,e,r,(s,n,o)=>{let a=!1;return gpe(()=>TR(s,n),(l,c)=>{s.__accessor__.destroyed?i.remove():a||(a=!0,cq(c,l)||o.call(s,l,c,n,s),a=!1)})});return i}function v$e(t,e,r,i=!1){return!t.__accessor__||t.__accessor__.destroyed?{remove(){}}:i?_$e(t,e,r):y$e(t,e,r)}function b$e(t,e,r){let i,s,n=ype(t,(o,a)=>{i&&i.uid!==s?n.remove():(i||(i=fO.acquireTracked(o,e,a,r),s=i.uid),WD(i))});return{remove:Dq(()=>{n.remove(),i&&(i.uid!==s||i.removed||(i.removed=!0,WD(i)),i=null),n=null})}}function w$e(t,e,r){let i=!1;return gpe(t,(s,n)=>{i||(i=!0,r(n,s)||e(s,n),i=!1)})}function x$e(t,e,r=!1,i=vhe){return r?w$e(t,e,i):b$e(t,e,i)}function qQ(t){return N$(yg,e=>e.oldValue===t)}function No(t,e){for(const[r,i]of t)if(e(i,r))return!0;return!1}function tSt(t,e){for(const[r,i]of t)if(e(i,r))return i;return null}function xpe(t,e,r){const i=t.get(e);if(i!==void 0)return i;const s=r();return t.set(e,s),s}const bS=Q.getLogger("esri.core.accessorSupport.ensureTypes");function T$e(t){return t==null?t:new Date(t)}function S$e(t){return t==null?t:!!t}function CR(t){return t==null?t:t.toString()}function sh(t){return t==null?t:(t=parseFloat(t),isNaN(t)?0:t)}function Uq(t){return t==null?t:Math.round(parseFloat(t))}function Tpe(t){return t&&t.constructor&&t.constructor.__accessorMetadata__!==void 0}function ZD(t,e){return e!=null&&t&&!(e instanceof t)}function Spe(t){return t&&"isCollection"in t}function WQ(t){return t&&t.Type?typeof t.Type=="function"?t.Type:t.Type.base:null}function E$e(t,e){if(!e||!e.constructor||!Spe(e.constructor))return cV(t,e)?e:new t(e);const r=WQ(t.prototype.itemType),i=WQ(e.constructor.prototype.itemType);return r?i?r===i?e:r.prototype.isPrototypeOf(i.prototype)?new t(e):(cV(t,e),e):new t(e):e}function cV(t,e){return!!Tpe(e)&&(bS.error("Accessor#set","Assigning an instance of '"+(e.declaredClass||"unknown")+"' which is not a subclass of '"+xF(t)+"'"),!0)}function Bb(t,e){return e==null?e:Spe(t)?E$e(t,e):ZD(t,e)?cV(t,e)?e:new t(e):e}function xF(t){return t&&t.prototype&&t.prototype.declaredClass||"unknown"}const C$e=new WeakMap;function A$e(t){switch(t){case Number:return sh;case Xi:return Uq;case Boolean:return S$e;case String:return CR;case Date:return T$e;default:return xpe(C$e,t,()=>Bb.bind(null,t))}}function Zs(t,e){const r=A$e(t);return arguments.length===1?r:r(e)}function mO(t,e,r){return arguments.length===1?mO.bind(null,t):e&&(Array.isArray(e)?e.map(i=>t(i,r)):[t(e,r)])}function O$e(t,e){return arguments.length===1?mO(r=>Zs(t,r)):mO(r=>Zs(t,r),e)}function Epe(t,e,r){return e!==0&&Array.isArray(r)?r.map(i=>Epe(t,e-1,i)):t(r)}function XD(t,e,r){if(arguments.length===2)return n=>XD(t,e,n);if(!r)return r;r=Epe(t,e,r);let i=e,s=r;for(;i>0&&Array.isArray(s);)i--,s=s[0];if(s!==void 0)for(let n=0;n<i;n++)r=[r];return r}function R$e(t,e,r){return arguments.length===2?XD(i=>Zs(t,i),e):XD(i=>Zs(t,i),e,r)}function Cpe(t){return!!Array.isArray(t)&&!t.some(e=>{const r=typeof e;return!(r==="string"||r==="number"||r==="function"&&t.length>1)})}function uV(t,e){if(arguments.length===2)return uV(t).call(null,e);const r=new Set,i=t.filter(a=>typeof a!="function"),s=t.filter(a=>typeof a=="function");for(const a of t)typeof a!="string"&&typeof a!="number"||r.add(a);let n=null,o=null;return(a,l)=>{if(a==null)return a;const c=typeof a,h=c==="string"||c==="number";return h&&(r.has(a)||s.some(p=>c==="string"&&p===String||c==="number"&&p===Number))||c==="object"&&s.some(p=>!ZD(a,p))?a:(h&&i.length?(n||(n=i.map(p=>typeof p=="string"?`'${p}'`:`${p}`).join(", ")),bS.error("Accessor#set",`'${a}' is not a valid value for this property, only the following values are valid: ${n}`)):typeof a=="object"&&s.length?(o||(o=s.map(p=>xF(p)).join(", ")),bS.error("Accessor#set",`'${a}' is not a valid value for this property, value must be one of ${o}`)):bS.error("Accessor#set",`'${a}' is not a valid value for this property`),l&&(l.valid=!1),null)}}function np(t,e){if(arguments.length===2)return np(t).call(null,e);const r={},i=[],s=[];for(const l in t.typeMap){const c=t.typeMap[l];r[l]=Zs(c),i.push(xF(c)),s.push(l)}const n=()=>`'${i.join("', '")}'`,o=()=>`'${s.join("', '")}'`,a=typeof t.key=="string"?l=>l[t.key]:t.key;return l=>{if(t.base&&!ZD(t.base,l)||l==null)return l;const c=a(l)||t.defaultKeyValue,h=r[c];if(!h)return bS.error("Accessor#set",`Invalid property value, value needs to be one of ${n()}, or a plain object that can autocast (having .type = ${o()})`),null;if(!ZD(t.typeMap[c],l))return l;if(typeof t.key=="string"&&!Tpe(l)){const p={};for(const f in l)f!==t.key&&(p[f]=l[f]);return h(p)}return h(l)}}let Xi=class{};const iSt={native:t=>({type:"native",value:t}),array:t=>({type:"array",value:t}),oneOf:t=>({type:"one-of",values:t})};function P$e(t){if(!t||!("type"in t))return!1;switch(t.type){case"native":case"array":case"one-of":return!0}return!1}function Ape(t){switch(t.type){case"native":return Zs(t.value);case"array":return mO(Ape(t.value));case"one-of":return M$e(t);default:return null}}function M$e(t){let e=null;return(r,i)=>dV(r,t)?r:(e==null&&(e=hV(t)),bS.error("Accessor#set",`Invalid property value, value needs to be of type ${e}`),i&&(i.valid=!1),null)}function hV(t){switch(t.type){case"native":switch(t.value){case Number:return"number";case String:return"string";case Boolean:return"boolean";case Xi:return"integer";case Date:return"date";default:return xF(t.value)}case"array":return`array of ${hV(t.value)}`;case"one-of":{const e=t.values.map(r=>hV(r));return`one of ${e.slice(0,e.length-1)} or ${e[e.length-1]}`}}return"unknown"}function dV(t,e){if(t==null)return!0;switch(e.type){case"native":switch(e.value){case Number:case Xi:return typeof t=="number";case Boolean:return typeof t=="boolean";case String:return typeof t=="string"}return t instanceof e.value;case"array":return!!Array.isArray(t)&&!t.some(r=>!dV(r,e.value));case"one-of":return e.values.some(r=>dV(t,r))}}function d(t={}){return(e,r)=>{if(e===Function.prototype)throw new Error(`Inappropriate use of @property() on a static field: ${e.name}.${r}. Accessor does not support static properties.`);const i=Object.getOwnPropertyDescriptor(e,r),s=ER(e,r);i&&(i.get||i.set?(s.get=i.get||s.get,s.set=i.set||s.set):"value"in i&&("value"in t&&Q.getLogger("esri.core.accessorSupport.decorators.property").warn(`@property() will redefine the value of "${r}" on "${e.constructor.name}" already defined in the metadata`,t),s.value=t.value=i.value)),t.readOnly!=null&&(s.readOnly=t.readOnly);const n=t.aliasOf;if(n){const l=typeof n=="string"?n:n.source,c=typeof n=="string"?null:n.overridable===!0;let h;s.dependsOn=[l],s.get=function(){let p=kD(this,l);if(typeof p=="function"){h||(h=l.split(".").slice(0,-1).join("."));const f=kD(this,h);f&&(p=p.bind(f))}return p},s.readOnly||(s.set=c?function(p){this._override(r,p)}:function(p){BD(this,l,p)})}const o=t.type,a=t.types;s.cast||(o?s.cast=I$e(o):a&&(Array.isArray(a)?s.cast=mO(np(a[0])):s.cast=np(a))),MIe(s,t),t.range&&(s.cast=$$e(s.cast,t.range))}}function kq(t,e,r){const i=ER(t,r);i.json||(i.json={});let s=i.json;return e!==void 0&&(s.origins||(s.origins={}),s.origins[e]||(s.origins[e]={}),s=s.origins[e]),s}function I$e(t){let e=0,r=t;if(P$e(t))return Ape(t);for(;Array.isArray(r)&&r.length===1&&typeof r[0]!="string"&&typeof r[0]!="number";)r=r[0],e++;const i=r;if(Cpe(i))return e===0?uV(i):XD(uV(i),e);if(e===1)return O$e(i);if(e>1)return R$e(i,e);const s=t;return s.from?s.from:Zs(s)}function $$e(t,e){return r=>{let i=+t(r);return e.step!=null&&(i=Math.round(i/e.step)*e.step),e.min!=null&&(i=Math.max(e.min,i)),e.max!=null&&(i=Math.min(e.max,i)),i}}function L$e(t){if(t.json&&t.json.origins){const e=t.json.origins,r={"web-document":["web-scene","web-map"]};for(const i in r)if(e[i]){const s=e[i];r[i].forEach(n=>{e[n]=s}),delete e[i]}}}let Sh=class extends Ode{constructor(e,r,i){super(e,r,i)}};Sh.prototype.type="warning";function Ope(t){return!!t&&t.prototype&&t.prototype.declaredClass&&t.prototype.declaredClass.indexOf("esri.core.Collection")===0}const pV=Q.getLogger("esri.core.accessorSupport.extensions.serializableProperty.reader");function ZQ(t,e,r){t&&(!r&&!e.read||e.read?.reader||e.read?.enabled===!1||F$e(t)&&Ha("read.reader",Q2(t),e))}function Q2(t){const e=t.ndimArray??0;if(e>1)return N$e(t);if(e===1)return XQ(t);if("type"in t&&Ppe(t.type)){const r=t.type.prototype?.itemType?.Type,i=XQ(typeof r=="function"?{type:r}:{types:r});return(s,n,o)=>{const a=i(s,n,o);return a&&new t.type(a)}}return Vq(t)}function Vq(t){return"type"in t?D$e(t.type):U$e(t.types)}function D$e(t){return t.prototype.read?(e,r,i)=>{if(e==null)return e;const s=typeof e;if(s!=="object")return void pV.error(`Expected JSON value of type 'object' to deserialize type '${t.prototype.declaredClass}', but got '${s}'`);const n=new t;return n.read(e,i),n}:t.fromJSON}function Rpe(t,e,r,i){return i!==0&&Array.isArray(e)?e.map(s=>Rpe(t,s,r,i-1)):t(e,void 0,r)}function N$e(t){const e=Vq(t),r=Rpe.bind(null,e),i=t.ndimArray??0;return(s,n,o)=>{if(s==null)return s;s=r(s,o,i);let a=i,l=s;for(;a>0&&Array.isArray(l);)a--,l=l[0];if(l!==void 0)for(let c=0;c<a;c++)s=[s];return s}}function XQ(t){const e=Vq(t);return(r,i,s)=>{if(r==null)return r;if(Array.isArray(r)){const o=[];for(const a of r){const l=e(a,void 0,s);l!==void 0&&o.push(l)}return o}const n=e(r,void 0,s);return n!==void 0?[n]:void 0}}function Ppe(t){if(!Ope(t))return!1;const e=t.prototype.itemType;return!(!e||!e.Type)&&(typeof e.Type=="function"?zq(e.Type):Mpe(e.Type))}function F$e(t){return"types"in t?Mpe(t.types):zq(t.type)}function zq(t){return!Array.isArray(t)&&!!t&&t.prototype&&("read"in t.prototype||"fromJSON"in t||Ppe(t))}function Mpe(t){for(const e in t.typeMap)if(!zq(t.typeMap[e]))return!1;return!0}function U$e(t){let e=null;const r=t.errorContext??"type";return(i,s,n)=>{if(i==null)return i;const o=typeof i;if(o!=="object")return void pV.error(`Expected JSON value of type 'object' to deserialize, but got '${o}'`);e||(e=k$e(t));const a=t.key;if(typeof a!="string")return;const l=i[a],c=l?e[l]:t.defaultKeyValue?t.typeMap[t.defaultKeyValue]:void 0;if(!c){const p=`Type '${l||"unknown"}' is not supported`;return n&&n.messages&&i&&n.messages.push(new Sh(`${r}:unsupported`,p,{definition:i,context:n})),void pV.error(p)}const h=new c;return h.read(i,n),h}}function k$e(t){const e={};for(const r in t.typeMap){const i=t.typeMap[r],s=SR(i.prototype);if(typeof t.key=="function")continue;const n=s[t.key];if(!n)continue;n.json?.type&&Array.isArray(n.json.type)&&n.json.type.length===1&&typeof n.json.type[0]=="string"&&(e[n.json.type[0]]=i);const o=n.json?.write;if(!o||!o.writer){e[r]=i;continue}const a=o.target,l=typeof a=="string"?a:t.key,c={};o.writer(r,c,l),c[l]&&(e[c[l]]=i)}return e}function V$e(t){if(t.json||(t.json={}),JQ(t.json),QQ(t.json),YQ(t.json),t.json.origins)for(const e in t.json.origins)JQ(t.json.origins[e]),QQ(t.json.origins[e]),YQ(t.json.origins[e]);return!0}function YQ(t){t.name&&(t.read&&typeof t.read=="object"?t.read.source===void 0&&(t.read.source=t.name):t.read={source:t.name},t.write&&typeof t.write=="object"?t.write.target===void 0&&(t.write.target=t.name):t.write={target:t.name})}function JQ(t){typeof t.read=="boolean"?t.read={enabled:t.read}:typeof t.read=="function"?t.read={enabled:!0,reader:t.read}:t.read&&typeof t.read=="object"&&t.read.enabled===void 0&&(t.read.enabled=!0)}function QQ(t){typeof t.write=="boolean"?t.write={enabled:t.write}:typeof t.write=="function"?t.write={enabled:!0,writer:t.write}:t.write&&typeof t.write=="object"&&t.write.enabled===void 0&&(t.write.enabled=!0)}function KQ(t,e){if(!e.write||e.write.writer||e.write.enabled===!1&&!e.write.overridePolicy)return;const r=t?.ndimArray??0;t&&(r===1||"type"in t&&Ope(t.type))?e.write.writer=G$e:r>1?e.write.writer=j$e(r):e.types?Array.isArray(e.types)?e.write.writer=B$e(e.types[0]):e.write.writer=z$e(e.types):e.write.writer=gO}function z$e(t){return(e,r,i,s)=>e?Ipe(e,t,s)?gO(e,r,i,s):void 0:gO(e,r,i,s)}function Ipe(t,e,r){for(const i in e.typeMap)if(t instanceof e.typeMap[i])return!0;if(r?.messages){const i=e.errorContext??"type",s=`Values of type '${(typeof e.key!="function"?t[e.key]:t.declaredClass)??"Unknown"}' cannot be written`;r&&r.messages&&t&&r.messages.push(new F(`${i}:unsupported`,s,{definition:t,context:r})),Q.getLogger("esri.core.accessorSupport.extensions.serializableProperty.writer").error(s)}return!1}function B$e(t){return(e,r,i,s)=>!e||!Array.isArray(e)?gO(e,r,i,s):gO(e.filter(n=>Ipe(n,t,s)),r,i,s)}function gO(t,e,r,i){Ha(r,YD(t,i),e)}function YD(t,e){return t&&typeof t.write=="function"?t.write({},e):t&&typeof t.toJSON=="function"?t.toJSON():typeof t=="number"?JD(t):t}function JD(t){return t===-1/0?-Number.MAX_VALUE:t===1/0?Number.MAX_VALUE:isNaN(t)?null:t}function G$e(t,e,r,i){let s;t===null?s=null:t&&typeof t.map=="function"?(s=t.map(n=>YD(n,i)),typeof s.toArray=="function"&&(s=s.toArray())):s=[YD(t,i)],Ha(r,s,e)}function $pe(t,e,r){return r!==0&&Array.isArray(t)?t.map(i=>$pe(i,e,r-1)):YD(t,e)}function j$e(t){return(e,r,i,s)=>{let n;if(e===null)n=null;else{n=$pe(e,s,t);let o=t,a=n;for(;o>0&&Array.isArray(a);)o--,a=a[0];if(a!==void 0)for(let l=0;l<o;l++)n=[n]}Ha(i,n,r)}}function H$e(t,e){return Bq(t,"any",e?.origin)}function fV(t,e){return Bq(t,"read",e?.origin)}function Lpe(t,e){return Bq(t,"write",e?.origin)}function Bq(t,e,r){let i=t?.json;if(i?.origins&&r){let s;s=r==="link-chart"?i.origins[r]&&(e==="any"||e in i.origins[r])?i.origins[r]:i.origins["web-map"]:i.origins[r],s&&(e==="any"||e in s)&&(i=s)}return i}function q$e(t){const e=W$e(t);if(t.json.origins)for(const r in t.json.origins){const i=t.json.origins[r],s=i.types?Z$e(i):e;ZQ(s,i,!1),i.types&&!i.write&&t.json.write&&t.json.write.enabled&&(i.write={...t.json.write}),KQ(s,i)}ZQ(e,t.json,!0),KQ(e,t.json)}function W$e(t){return t.json.types?mV(t.json):t.type?Dpe(t):mV(t)}function Z$e(t){return t.type?Dpe(t):mV(t)}function Dpe(t){if(!t.type)return;let e=0,r=t.type;for(;Array.isArray(r)&&!Cpe(r);)r=r[0],e++;return{type:r,ndimArray:e}}function mV(t){if(!t.types)return;let e=0,r=t.types;for(;Array.isArray(r);)r=r[0],e++;return{types:r,ndimArray:e}}function X$e(t){V$e(t)&&(L$e(t),q$e(t))}const X6=new Set,Y6=new Set;function R(t){return e=>{e.prototype.declaredClass=t,J$e(e);const r=[],i=[];let s=e.prototype;for(;s;)s.hasOwnProperty("initialize")&&!X6.has(s.initialize)&&(X6.add(s.initialize),r.push(s.initialize)),s.hasOwnProperty("destroy")&&!Y6.has(s.destroy)&&(Y6.add(s.destroy),i.push(s.destroy)),s=Object.getPrototypeOf(s);X6.clear(),Y6.clear();class n extends e{constructor(...a){if(super(...a),this.constructor===n&&typeof this.postscript=="function"){if(r.length&&Object.defineProperty(this,"initialize",{enumerable:!1,configurable:!0,value(){for(let l=r.length-1;l>=0;l--)r[l].call(this)}}),i.length){let l=!1;const c=this[epe];Object.defineProperty(this,"destroy",{enumerable:!1,configurable:!0,value(){if(!l){l=!0,c.call(this);for(let h=0;h<i.length;h++)i[h].call(this)}}})}this.postscript(...a)}}}return n.__accessorMetadata__=SR(e.prototype),n.prototype.declaredClass=t,n}}function Y$e(t,e){return e.get==null?function(){const r=this.__accessor__,i=r.propertiesByName.get(t);if(i===void 0)return;Ht(i.observerObject);const s=r.store;return s.has(t)?s.get(t):i.metadata.value}:function(){const r=this.__accessor__,i=r.propertiesByName.get(t);if(i!==void 0)return i.getComputed(r)}}function J$e(t){const e=t.prototype,r=SR(e),i={};for(const s of Object.getOwnPropertyNames(r)){const n=r[s];X$e(n),i[s]={enumerable:!0,configurable:!0,get:Y$e(s,n),set(o){const a=this.__accessor__;if(a!==void 0){if(!Object.isFrozen(this)){if(a.initialized&&n.readOnly)throw new TypeError(`[accessor] cannot assign to read-only property '${s}' of ${this.declaredClass}`);if(a.lifecycle===ag.CONSTRUCTED&&n.constructOnly)throw new TypeError(`[accessor] cannot assign to construct-only property '${s}' of ${this.declaredClass}`);a.set(s,o)}}else Object.defineProperty(this,s,{enumerable:!0,configurable:!0,writable:!0,value:o})}}}Object.defineProperties(t.prototype,i)}var Npe,Fpe;function Q$e(t){if(t==null)return{value:t};if(Array.isArray(t))return{type:[t[0]],value:null};switch(typeof t){case"object":return t.constructor?.__accessorMetadata__||t instanceof Date?{type:t.constructor,value:t}:t;case"boolean":return{type:Boolean,value:t};case"string":return{type:String,value:t};case"number":return{type:Number,value:t};case"function":return{type:t,value:null};default:return}}const Zy=Symbol("Accessor-Handles"),gV=Symbol("Accessor-Initialized");let Te=class Upe{static createSubclass(e={}){if(Array.isArray(e))throw new Error("Multi-inheritance unsupported since 4.16");const{properties:r,declaredClass:i,constructor:s}=e;delete e.declaredClass,delete e.properties,delete e.constructor;const n=this;class o extends n{constructor(...l){super(...l),this.inherited=null,s&&s.apply(this,l)}}SR(o.prototype);for(const a in e){const l=e[a];o.prototype[a]=typeof l=="function"?function(...c){const h=this.inherited;let p;this.inherited=function(...f){if(n.prototype[a])return n.prototype[a].apply(this,f)};try{p=l.apply(this,c)}catch(f){throw this.inherited=h,f}return this.inherited=h,p}:e[a]}for(const a in r){const l=Q$e(r[a]);d(l)(o.prototype,a)}return R(i)(o)}constructor(...e){if(this[Npe]=null,this[Fpe]=!1,this.constructor===Upe)throw new Error("[accessor] cannot instantiate Accessor. This can be fixed by creating a subclass of Accessor");const r=new jIe(this);Object.defineProperty(this,"__accessor__",{enumerable:!1,value:r}),e.length>0&&this.normalizeCtorArgs&&(r.ctorArgs=this.normalizeCtorArgs.apply(this,e)),eK.register(this,r.propertiesByName,this)}postscript(e){const r=this.__accessor__,i=r.ctorArgs||e;r.initialize(),i&&(this.set(i),r.ctorArgs=null),r.constructed(),this.initialize(),this[gV]=!0}initialize(){}[epe](){this[Zy]=Me(this[Zy])}destroy(){this.destroyed||(eK.unregister(this),f$e(this),this.__accessor__.destroy(),YIe()?.onInstanceDestroy(this))}get constructed(){return this.__accessor__&&this.__accessor__.initialized||!1}get initialized(){return this[gV]}get destroyed(){return this.__accessor__&&this.__accessor__.destroyed||!1}commitProperty(e){this.get(e)}get(e){return kD(this,e)}hasOwnProperty(e){return this.__accessor__?this.__accessor__.has(e):Object.prototype.hasOwnProperty.call(this,e)}keys(){return this.__accessor__?this.__accessor__.keys():[]}set(e,r){return BD(this,e,r),this}watch(e,r,i){return v$e(this,e,r,i)}own(e){this.addHandles(e)}addHandles(e,r){if(this.destroyed){const s=Array.isArray(e)?e:[e];for(const n of s)n.remove();return}let i=this[Zy];i==null&&(i=this[Zy]=new Oi),i.add(e,r)}removeHandles(e){const r=this[Zy];r?.remove(e)}removeAllHandles(){const e=this[Zy];e?.removeAll()}hasHandles(e){const r=this[Zy];return r!=null&&r.has(e)}_override(e,r){r===void 0?this.__accessor__.clearOverride(e):this.__accessor__.override(e,r)}_clearOverride(e){return this.__accessor__.clearOverride(e)}_overrideIfSome(e,r){r==null?this.__accessor__.clearOverride(e):this.__accessor__.override(e,r)}_isOverridden(e){return this.__accessor__.isOverridden(e)}notifyChange(e){this.__accessor__.notifyChange(e)}_get(e){return this.__accessor__.internalGet(e)}_set(e,r){return this.__accessor__.internalSet(e,r),this}};Npe=Zy,Fpe=gV;const eK=new FinalizationRegistry(t=>{for(const e of t.values())e.destroy()});function le(t,e,r={}){return Gq(t,e,r,kpe)}function Eh(t,e,r={}){return Gq(t,e,r,Vpe)}function Gq(t,e,r={},i){let s=null;const n=r.once?(o,a)=>{i(o)&&(Ii(s),e(o,a))}:(o,a)=>{i(o)&&e(o,a)};if(s=x$e(t,n,r.sync,r.equals),r.initial){const o=t();n(o,o)}return s}function Ga(t,e,r,i={}){let s=null,n=null,o=null;function a(){s&&n&&(n.remove(),i.onListenerRemove?.(s),s=null,n=null)}function l(h){i.once&&i.once&&Ii(o),r(h)}const c=le(t,(h,p)=>{a(),vF(h)&&(s=h,n=h_(h,e,l),i.onListenerAdd?.(h))},{sync:i.sync,initial:!0});return o=bo(()=>{c.remove(),a()}),o}function QS(t,e){return K$e(t,Vpe,e)}function K$e(t,e,r){if(sn(r))return Promise.reject(Dr());const i=t();if(e?.(i))return Promise.resolve(i);let s=null;function n(){s=Ii(s)}return new Promise((o,a)=>{s=XS([nn(r,()=>{n(),a(Dr())}),Gq(t,l=>{n(),o(l)},{sync:!1,once:!0},e??kpe)])})}function kpe(t){return!0}function Vpe(t){return!!t}function nSt(t,e,r={}){let i=!1;const s=le(t,(n,o)=>{i||e(n,o)},r);return{remove(){s.remove()},pause(){i=!0},resume(){i=!1}}}const jr={sync:!0},Vr={initial:!0},As={sync:!0,initial:!0};let Cf=class extends Te{constructor(){super(...arguments),this.updating=!1,this._handleId=0,this._handles=new Oi,this._scheduleHandleId=0,this._pendingPromises=new Set}destroy(){this.removeAll(),this._handles.destroy()}add(e,r,i={}){return this._installWatch(e,r,i,le)}addWhen(e,r,i={}){return this._installWatch(e,r,i,Eh)}addOnCollectionChange(e,r,{initial:i=!1,final:s=!1}={}){const n=++this._handleId;return this._handles.add([Ga(e,"after-changes",this._createSyncUpdatingCallback(),jr),Ga(e,"change",r,{onListenerAdd:i?o=>r({added:o.toArray(),removed:[]}):void 0,onListenerRemove:s?o=>r({added:[],removed:o.toArray()}):void 0})],n),bo(()=>this._handles.remove(n))}addPromise(e){if(e==null)return e;const r=++this._handleId;this._handles.add({remove:()=>{this._pendingPromises.delete(e)&&(this._pendingPromises.size!==0||this._handles.has(PP)||this._set("updating",!1))}},r),this._pendingPromises.add(e),this._set("updating",!0);const i=()=>this._handles.remove(r);return e.then(i,i),e}removeAll(){this._pendingPromises.clear(),this._handles.removeAll(),this._set("updating",!1)}_installWatch(e,r,i={},s){const n=++this._handleId;i.sync||this._installSyncUpdatingWatch(e,n);const o=s(e,r,i);return this._handles.add(o,n),bo(()=>this._handles.remove(n))}_installSyncUpdatingWatch(e,r){const i=this._createSyncUpdatingCallback(),s=le(e,i,{sync:!0,equals:()=>!1});return this._handles.add(s,r),s}_createSyncUpdatingCallback(){return()=>{this._handles.remove(PP),++this._scheduleHandleId;const e=this._scheduleHandleId;this._get("updating")||this._set("updating",!0),this._handles.add(J2(()=>{e===this._scheduleHandleId&&(this._set("updating",this._pendingPromises.size>0),this._handles.remove(PP))}),PP)}}};u([d({readOnly:!0})],Cf.prototype,"updating",void 0),Cf=u([R("esri.core.support.WatchUpdatingTracking")],Cf);const PP=-42,TF=t=>{let e=class extends t{constructor(){super(...arguments),this._handles=new Oi,this._updatingHandles=new Cf}destroy(){this.destroyed||(this._handles.destroy(),this._updatingHandles.destroy())}get handles(){return this._handles}get updatingHandles(){return this._updatingHandles}};return u([d({readOnly:!0})],e.prototype,"handles",null),u([d({readOnly:!0})],e.prototype,"updatingHandles",null),e=u([R("esri.core.HandleOwner")],e),e};let yO=class extends TF(Te){};yO=u([R("esri.core.HandleOwner")],yO);const eLe=Object.prototype.toString;function tLe(t){const e="__accessorMetadata__"in t?Zs(t):t;return function(...r){if(r.push(e),typeof r[2]=="number")throw new Error("Using @cast has parameter decorator is not supported since 4.16");return rLe.apply(this,r)}}function rLe(t,e,r,i){ER(t,e).cast=i}function iLe(t){return(e,r)=>{ER(e,t).cast=e[r]}}function yr(...t){if(t.length!==3||typeof t[1]!="string")return t.length===1&&eLe.call(t[0])==="[object Function]"?tLe(t[0]):t.length===1&&typeof t[0]=="string"?iLe(t[0]):void 0}var KS;function sLe(t,e){switch(t.type){case"range":{const r="range"in t?t.range[0]:t.minValue,i="range"in t?t.range[1]:t.maxValue;if(r!=null&&+e<r||i!=null&&+e>i)return KS.VALUE_OUT_OF_RANGE;break}case"coded-value":case"codedValue":if(t.codedValues==null||t.codedValues.every(r=>r==null||r.code!==e))return KS.INVALID_CODED_VALUE}return null}function nLe(t){if(!(!t||t.type!=="range"))return{min:"range"in t?t.range[0]:t.minValue,max:"range"in t?t.range[1]:t.maxValue}}(function(t){t.VALUE_OUT_OF_RANGE="domain-validation-error::value-out-of-range",t.INVALID_CODED_VALUE="domain-validation-error::invalid-coded-value"})(KS||(KS={}));let oLe=class zpe{constructor(){this._values=new Map,this.multipleOriginsSupported=!1}clone(e){const r=new zpe;return this._values.forEach((i,s)=>{e&&e.has(s)||r.set(s,K(i.value),i.origin)}),r}get(e,r){r=this._normalizeOrigin(r);const i=this._values.get(e);return r==null||i?.origin===r?i?.value:void 0}originOf(e){return this._values.get(e)?.origin??pr.USER}keys(e){e=this._normalizeOrigin(e);const r=[...this._values.keys()];return e==null?r:r.filter(i=>this._values.get(i)?.origin===e)}set(e,r,i){if((i=this._normalizeOrigin(i))===pr.DEFAULTS){const s=this._values.get(e);if(s&&s.origin!=null&&s.origin>i)return}this._values.set(e,new aLe(r,i))}delete(e,r){(r=this._normalizeOrigin(r))!=null&&this._values.get(e)?.origin!==r||this._values.delete(e)}has(e,r){return(r=this._normalizeOrigin(r))!=null?this._values.get(e)?.origin===r:this._values.has(e)}forEach(e){this._values.forEach(({value:r},i)=>e(r,i))}_normalizeOrigin(e){if(e!=null)return e===pr.DEFAULTS?e:pr.USER}},aLe=class{constructor(e,r){this.value=e,this.origin=r}};function Bpe(t,e,r){e.keys().forEach(s=>{r.set(s,e.get(s),pr.DEFAULTS)});const i=t.metadatas;Object.keys(i).forEach(s=>{t.internalGet(s)&&r.set(s,t.internalGet(s),pr.DEFAULTS)})}function lLe(t,e,r){if(!t||!t.read||t.read.enabled===!1||!t.read.source)return!1;const i=t.read.source;if(typeof i=="string"){if(i===e||i.includes(".")&&i.indexOf(e)===0&&kQ(i,r))return!0}else for(const s of i)if(s===e||s.includes(".")&&s.indexOf(e)===0&&kQ(s,r))return!0;return!1}function cLe(t){return t&&(!t.read||t.read.enabled!==!1&&!t.read.source)}function uLe(t,e,r,i,s){let n=fV(e[r],s);cLe(n)&&(t[r]=!0);for(const o of Object.getOwnPropertyNames(e))n=fV(e[o],s),lLe(n,r,i)&&(t[o]=!0)}function hLe(t,e,r,i){const s=r.metadatas,n=H$e(s[e],i),o=n?.default;if(o===void 0)return;const a=typeof o=="function"?o.call(t,e,i):o;a!==void 0&&r.set(e,a)}const Gpe={origin:"service"};function jpe(t,e,r=Gpe){if(!e||typeof e!="object")return;const i=ua(t),s=i.metadatas,n={};for(const o of Object.getOwnPropertyNames(e))uLe(n,s,o,e,r);i.setDefaultOrigin(r.origin);for(const o of Object.getOwnPropertyNames(n)){const a=fV(s[o],r).read,l=a&&a.source;let c;c=l&&typeof l=="string"?TR(e,l):e[o],a&&a.reader&&(c=a.reader.call(t,c,e,r)),c!==void 0&&i.set(o,c)}if(!r||!r.ignoreDefaults){i.setDefaultOrigin("defaults");for(const o of Object.getOwnPropertyNames(s))n[o]||hLe(t,o,i,r)}i.setDefaultOrigin("user")}function dLe(t,e,r,i=Gpe){const s={...i,messages:[]};r(s),s.messages?.forEach(n=>{n.type!=="warning"||t.loaded?i&&i.messages&&i.messages.push(n):t.loadWarnings.push(n)})}function pLe(t,e,r,i,s){const n={};return e.write?.writer?.call(t,i,n,r,s),n}function Hpe(t,e,r,i,s,n){if(!i||!i.write)return!1;const o=t.get(r);if(!s&&i.write.overridePolicy){const a=i.write.overridePolicy.call(t,o,r,n??void 0);a!==void 0&&(s=a)}if(s||(s=i.write),!s||s.enabled===!1)return!1;if((o===null&&!s.allowNull&&!s.writerEnsuresNonNull||o===void 0)&&s.isRequired){const a=new F("web-document-write:property-required",`Missing value for required property '${r}' on '${t.declaredClass}'`,{propertyName:r,target:t});return a&&n&&n.messages?n.messages.push(a):a&&!n&&Q.getLogger("esri.core.accessorSupport.write").error(a.name,a.message),!1}return!(o===void 0||o===null&&!s.allowNull&&!s.writerEnsuresNonNull||!s.alwaysWriteDefaults&&(!e.store.multipleOriginsSupported||e.store.originOf(r)===pr.DEFAULTS)&&fLe(t,r,n,i,o)||!s.ignoreOrigin&&n&&n.origin&&e.store.multipleOriginsSupported&&e.store.originOf(r)<dg(n.origin))}function fLe(t,e,r,i,s){const n=i.default;if(n===void 0)return!1;if(i.defaultEquals!=null)return i.defaultEquals(s);if(typeof n=="function"){if(Array.isArray(s)){const o=n.call(t,e,r??void 0);return Pg(o,s)}return!1}return n===s}function mLe(t,e,r,i){const s=ua(t),n=s.metadatas,o=Lpe(n[e],i);return!!o&&Hpe(t,s,e,o,r,i)}function qpe(t,e,r){if(t&&typeof t.toJSON=="function"&&(!t.toJSON.isDefaultToJSON||!t.write))return $$(e,t.toJSON(r));const i=ua(t),s=i.metadatas;for(const n in s){const o=Lpe(s[n],r);if(!Hpe(t,i,n,o,void 0,r))continue;const a=t.get(n),l=pLe(t,o,o.write&&typeof o.write.target=="string"?o.write.target:n,a,r);Object.keys(l).length>0&&(e=$$(e,l),r?.resources?.pendingOperations?.length&&r.resources.pendingOperations.push(Promise.all(r.resources.pendingOperations).then(()=>$$(e,l,()=>"replace-arrays"))),r&&r.writtenProperties&&r.writtenProperties.push({target:t,propName:n,oldOrigin:UIe(i.store.originOf(n)),newOrigin:r.origin}))}return e}const K2=t=>{let e=class extends t{constructor(...r){super(...r);const i=ua(this),s=i.store,n=new oLe;i.store=n,Bpe(i,s,n)}read(r,i){jpe(this,r,i)}write(r,i){return qpe(this,r??{},i)}toJSON(r){return this.write({},r)}static fromJSON(r,i){return gLe.call(this,r,i)}};return e=u([R("esri.core.JSONSupport")],e),e.prototype.toJSON.isDefaultToJSON=!0,e};function gLe(t,e){if(!t)return null;if(t.declaredClass)throw new Error("JSON object is already hydrated");const r=new this;return r.read(t,e),r}let de=class extends K2(Te){};de=u([R("esri.core.JSONSupport")],de);function Ee(t,e,r){let i,s;return e===void 0||Array.isArray(e)?(s=t,r=e,i=[void 0]):(s=e,i=Array.isArray(t)?t:[t]),(n,o)=>{const a=n.constructor.prototype;i.forEach(l=>{const c=kq(n,l,s);c.read&&typeof c.read=="object"||(c.read={}),c.read.reader=a[o],r&&(c.read.source=(c.read.source||[]).concat(r))})}}let jq=class{constructor(e,r,i,s){this.semiMajorAxis=e,this.flattening=r,this.outerAtmosphereRimWidth=i;const n=1-this.flattening;this.semiMinorAxis=this.semiMajorAxis*n,this.halfSemiMajorAxis=this.semiMajorAxis/2,this.halfCircumference=Math.PI*this.semiMajorAxis,this.metersPerDegree=this.halfCircumference/180,this.inverseFlattening=1/(1-this.flattening)-1,this.eccentricitySquared=s||2*this.flattening-this.flattening*this.flattening,this.meanRadiusSemiAxes=(2*this.semiMajorAxis+this.semiMinorAxis)/3}get radius(){return this.semiMajorAxis}};const nr=new jq(6378137,1/298.257223563,3e5,.006694379990137799),Af=new jq(3396190,1/169.8944472236118,23e4),$g=new jq(1737400,0,0);var hh;(function(t){t[t.CGCS2000=4490]="CGCS2000",t[t.GCSMARS2000=104971]="GCSMARS2000",t[t.GCSMARS2000_SPHERE=104905]="GCSMARS2000_SPHERE",t[t.GCSMOON2000=104903]="GCSMOON2000"})(hh||(hh={}));let g;const $={values:[1,.3048,.3048006096012192,.3047972654,.9143917962,.201166195164,.9143984146160287,.3047994715386762,20.11676512155263,20.11678249437587,.9143985307444408,.91439523,.3047997101815088,20.1168,20.116756,5e4,15e4],units:["Meter","Foot","Foot_US","Foot_Clarke","Yard_Clarke","Link_Clarke","Yard_Sears","Foot_Sears","Chain_Sears","Chain_Benoit_1895_B","Yard_Indian","Yard_Indian_1937","Foot_Gold_Coast","Chain","Chain_Sears_1922_Truncated","50_Kilometers","150_Kilometers"],2066:5,2136:12,2155:2,2157:0,2158:0,2159:12,2160:12,2204:2,2219:0,2220:0,2254:2,2255:2,2256:1,2265:1,2266:1,2267:2,2268:2,2269:1,2270:1,2271:2,2272:2,2273:1,2294:0,2295:0,2314:3,2899:2,2900:2,2901:1,2909:1,2910:1,2911:2,2912:2,2913:1,2914:1,2992:1,2993:0,2994:1,3080:1,3089:2,3090:0,3091:2,3102:2,3141:0,3142:0,3167:14,3359:2,3360:0,3361:1,3362:0,3363:2,3364:0,3365:2,3366:3,3404:2,3405:0,3406:0,3407:3,3439:0,3440:0,3479:1,3480:0,3481:1,3482:0,3483:1,3484:0,3485:2,3486:0,3487:2,3488:0,3489:0,3490:2,3491:0,3492:2,3493:0,3494:2,3495:0,3496:2,3497:0,3498:2,3499:0,3500:2,3501:0,3502:2,3503:0,3504:2,3505:0,3506:2,3507:0,3508:2,3509:0,3510:2,3511:0,3512:2,3513:0,3514:0,3515:2,3516:0,3517:2,3518:0,3519:2,3520:0,3521:2,3522:0,3523:2,3524:0,3525:2,3526:0,3527:2,3528:0,3529:2,3530:0,3531:2,3532:0,3533:2,3534:0,3535:2,3536:0,3537:2,3538:0,3539:2,3540:0,3541:2,3542:0,3543:2,3544:0,3545:2,3546:0,3547:2,3548:0,3549:2,3550:0,3551:2,3552:0,3553:2,3582:2,3583:0,3584:2,3585:0,3586:2,3587:0,3588:1,3589:0,3590:1,3591:0,3592:0,3593:1,3598:2,3599:0,3600:2,3605:1,3606:0,3607:0,3608:2,3609:0,3610:2,3611:0,3612:2,3613:0,3614:2,3615:0,3616:2,3617:0,3618:2,3619:0,3620:2,3621:0,3622:2,3623:0,3624:2,3625:0,3626:2,3627:0,3628:2,3629:0,3630:2,3631:0,3632:2,3633:0,3634:1,3635:0,3636:1,3640:2,3641:0,3642:2,3643:0,3644:1,3645:0,3646:1,3647:0,3648:1,3649:0,3650:2,3651:0,3652:2,3653:0,3654:2,3655:0,3656:1,3657:0,3658:2,3659:0,3660:2,3661:0,3662:2,3663:0,3664:2,3668:2,3669:0,3670:2,3671:0,3672:2,3673:0,3674:2,3675:0,3676:1,3677:2,3678:0,3679:1,3680:2,3681:0,3682:1,3683:2,3684:0,3685:0,3686:2,3687:0,3688:2,3689:0,3690:2,3691:0,3692:2,3696:2,3697:0,3698:2,3699:0,3700:2,3793:0,3794:0,3812:0,3854:0,3857:0,3920:0,3978:0,3979:0,3991:2,3992:2,4026:0,4037:0,4038:0,4071:0,4082:0,4083:0,4087:0,4088:0,4217:2,4414:0,4415:0,4417:0,4434:0,4437:0,4438:2,4439:2,4462:0,4467:0,4471:0,4474:0,4559:0,4647:0,4822:0,4826:0,4839:0,5018:0,5041:0,5042:0,5048:0,5167:0,5168:0,5221:0,5223:0,5234:0,5235:0,5243:0,5247:0,5266:0,5316:0,5320:0,5321:0,5325:0,5337:0,5361:0,5362:0,5367:0,5382:0,5383:0,5396:0,5456:0,5457:0,5469:0,5472:4,5490:0,5513:0,5514:0,5523:0,5559:0,5588:1,5589:3,5596:0,5627:0,5629:0,5641:0,5643:0,5644:0,5646:2,5654:2,5655:2,5659:0,5700:0,5825:0,5836:0,5837:0,5839:0,5842:0,5844:0,5858:0,5879:0,5880:0,5887:0,5890:0,6128:1,6129:1,6141:1,6204:0,6210:0,6211:0,6307:0,6312:0,6316:0,6362:0,6391:1,6405:1,6406:0,6407:1,6408:0,6409:1,6410:0,6411:2,6412:0,6413:2,6414:0,6415:0,6416:2,6417:0,6418:2,6419:0,6420:2,6421:0,6422:2,6423:0,6424:2,6425:0,6426:2,6427:0,6428:2,6429:0,6430:2,6431:0,6432:2,6433:0,6434:2,6435:0,6436:2,6437:0,6438:2,6439:0,6440:0,6441:2,6442:0,6443:2,6444:0,6445:2,6446:0,6447:2,6448:0,6449:2,6450:0,6451:2,6452:0,6453:2,6454:0,6455:2,6456:0,6457:2,6458:0,6459:2,6460:0,6461:2,6462:0,6463:2,6464:0,6465:2,6466:0,6467:2,6468:0,6469:2,6470:0,6471:2,6472:0,6473:2,6474:0,6475:2,6476:0,6477:2,6478:0,6479:2,6484:2,6485:0,6486:2,6487:0,6488:2,6489:0,6490:2,6491:0,6492:2,6493:0,6494:1,6495:0,6496:1,6497:0,6498:0,6499:1,6500:0,6501:2,6502:0,6503:2,6504:0,6505:2,6506:0,6507:2,6508:0,6509:0,6510:2,6515:1,6516:0,6518:0,6519:2,6520:0,6521:2,6522:0,6523:2,6524:0,6525:2,6526:0,6527:2,6528:0,6529:2,6530:0,6531:2,6532:0,6533:2,6534:0,6535:2,6536:0,6537:2,6538:0,6539:2,6540:0,6541:2,6542:0,6543:2,6544:0,6545:1,6546:0,6547:1,6548:0,6549:2,6550:0,6551:2,6552:0,6553:2,6554:0,6555:2,6556:0,6557:1,6558:0,6559:1,6560:0,6561:1,6562:0,6563:2,6564:0,6565:2,6566:0,6567:0,6568:2,6569:0,6570:1,6571:0,6572:2,6573:0,6574:2,6575:0,6576:2,6577:0,6578:2,6582:2,6583:0,6584:2,6585:0,6586:2,6587:0,6588:2,6589:0,6590:2,6591:0,6592:0,6593:2,6594:0,6595:2,6596:0,6597:2,6598:0,6599:2,6600:0,6601:2,6602:0,6603:2,6605:2,6606:0,6607:2,6608:0,6609:2,6610:0,6611:0,6612:2,6613:0,6614:2,6615:0,6616:2,6617:0,6618:2,6633:2,6646:0,6703:0,6784:0,6785:1,6786:0,6787:1,6788:0,6789:1,6790:0,6791:1,6792:0,6793:1,6794:0,6795:1,6796:0,6797:1,6798:0,6799:1,6800:0,6801:1,6802:0,6803:1,6804:0,6805:1,6806:0,6807:1,6808:0,6809:1,6810:0,6811:1,6812:0,6813:1,6814:0,6815:1,6816:0,6817:1,6818:0,6819:1,6820:0,6821:1,6822:0,6823:1,6824:0,6825:1,6826:0,6827:1,6828:0,6829:1,6830:0,6831:1,6832:0,6833:1,6834:0,6835:1,6836:0,6837:1,6838:0,6839:1,6840:0,6841:1,6842:0,6843:1,6844:0,6845:1,6846:0,6847:1,6848:0,6849:1,6850:0,6851:1,6852:0,6853:1,6854:0,6855:1,6856:0,6857:1,6858:0,6859:1,6860:0,6861:1,6862:0,6863:1,6867:0,6868:1,6870:0,6875:0,6876:0,6879:0,6880:2,6884:0,6885:1,6886:0,6887:1,6915:0,6922:0,6923:2,6924:0,6925:2,6962:0,6984:0,6991:0,7128:2,7131:0,7132:2,7142:0,7257:0,7258:2,7259:0,7260:2,7261:0,7262:2,7263:0,7264:2,7265:0,7266:2,7267:0,7268:2,7269:0,7270:2,7271:0,7272:2,7273:0,7274:2,7275:0,7276:2,7277:0,7278:2,7279:0,7280:2,7281:0,7282:2,7283:0,7284:2,7285:0,7286:2,7287:0,7288:2,7289:0,7290:2,7291:0,7292:2,7293:0,7294:2,7295:0,7296:2,7297:0,7298:2,7299:0,7300:2,7301:0,7302:2,7303:0,7304:2,7305:0,7306:2,7307:0,7308:2,7309:0,7310:2,7311:0,7312:2,7313:0,7314:2,7315:0,7316:2,7317:0,7318:2,7319:0,7320:2,7321:0,7322:2,7323:0,7324:2,7325:0,7326:2,7327:0,7328:2,7329:0,7330:2,7331:0,7332:2,7333:0,7334:2,7335:0,7336:2,7337:0,7338:2,7339:0,7340:2,7341:0,7342:2,7343:0,7344:2,7345:0,7346:2,7347:0,7348:2,7349:0,7350:2,7351:0,7352:2,7353:0,7354:2,7355:0,7356:2,7357:0,7358:2,7359:0,7360:2,7361:0,7362:2,7363:0,7364:2,7365:0,7366:2,7367:0,7368:2,7369:0,7370:2,7877:0,7878:0,7882:0,7883:0,7887:0,7899:0,7991:0,7992:0,8035:2,8036:2,8058:0,8059:0,8082:0,8083:0,8088:0,8090:0,8091:2,8092:0,8093:2,8095:0,8096:2,8097:0,8098:2,8099:0,8100:2,8101:0,8102:2,8103:0,8104:2,8105:0,8106:2,8107:0,8108:2,8109:0,8110:2,8111:0,8112:2,8113:0,8114:2,8115:0,8116:2,8117:0,8118:2,8119:0,8120:2,8121:0,8122:2,8123:0,8124:2,8125:0,8126:2,8127:0,8128:2,8129:0,8130:2,8131:0,8132:2,8133:0,8134:2,8135:0,8136:2,8137:0,8138:2,8139:0,8140:2,8141:0,8142:2,8143:0,8144:2,8145:0,8146:2,8147:0,8148:2,8149:0,8150:2,8151:0,8152:2,8153:0,8154:2,8155:0,8156:2,8157:0,8158:2,8159:0,8160:2,8161:0,8162:2,8163:0,8164:2,8165:0,8166:2,8167:0,8168:2,8169:0,8170:2,8171:0,8172:2,8173:0,8177:2,8179:0,8180:2,8181:0,8182:2,8184:0,8185:2,8187:0,8189:2,8191:0,8193:2,8196:0,8197:2,8198:0,8200:2,8201:0,8202:2,8203:0,8204:2,8205:0,8206:2,8207:0,8208:2,8209:0,8210:2,8212:0,8213:2,8214:0,8216:2,8218:0,8220:2,8222:0,8224:2,8225:0,8226:2,8311:0,8312:1,8313:0,8314:1,8315:0,8316:1,8317:0,8318:1,8319:0,8320:1,8321:0,8322:1,8323:0,8324:1,8325:0,8326:1,8327:0,8328:1,8329:0,8330:1,8331:0,8332:1,8333:0,8334:1,8335:0,8336:1,8337:0,8338:1,8339:0,8340:1,8341:0,8342:1,8343:0,8344:1,8345:0,8346:1,8347:0,8348:1,8352:0,8353:0,8379:0,8380:2,8381:0,8382:2,8383:0,8384:2,8385:0,8387:2,8391:0,8395:0,8433:0,8441:0,8455:0,8456:0,8531:2,8682:0,8686:0,8687:0,8692:0,8693:0,8826:0,8903:0,8950:0,8951:0,9039:0,9040:0,9141:0,9149:0,9150:0,9191:0,9221:0,9222:0,9249:0,9250:0,9252:0,9254:0,9265:0,9284:0,9285:0,9300:0,9354:0,9367:0,9373:0,9377:0,9387:0,9391:0,9456:0,9473:0,9498:0,9674:0,9678:0,9680:0,9709:0,9712:0,9713:0,9716:0,9741:0,9748:2,9749:2,9761:0,9766:0,9793:0,9794:0,9869:0,9874:0,9875:0,9880:0,9943:0,9945:0,9947:0,9967:0,9972:0,9977:0,20042:0,20050:1,20499:0,20538:0,20539:0,20790:0,20791:0,21291:0,21292:0,21500:0,21817:0,21818:0,22032:0,22033:0,22091:0,22092:0,22239:0,22240:0,22332:0,22337:0,22338:0,22391:0,22392:0,22639:0,22700:0,22739:0,22770:0,22780:0,22832:0,23090:0,23095:0,23239:0,23240:0,23433:0,23700:0,24047:0,24048:0,24100:3,24200:0,24305:0,24306:0,24382:10,24383:0,24500:0,24547:0,24548:0,24571:9,24600:0,25e3:0,25231:0,25884:0,25932:0,26237:0,26331:0,26332:0,26432:0,26591:0,26592:0,26632:0,26692:0,27120:0,27200:0,27291:6,27292:6,27429:0,27492:0,27493:0,27500:0,27700:0,28232:0,28600:0,28991:0,28992:0,29100:0,29101:0,29220:0,29221:0,29333:0,29635:0,29636:0,29701:0,29738:0,29739:0,29849:0,29850:0,29871:8,29872:7,29873:0,29874:0,30200:5,30339:0,30340:0,30591:0,30592:0,30791:0,30792:0,30800:0,31028:0,31121:0,31154:0,31170:0,31171:0,31370:0,31528:0,31529:0,31600:0,31700:0,31838:0,31839:0,31900:0,31901:0,32061:0,32062:0,32098:0,32099:2,32100:0,32104:0,32161:0,32766:0,53048:0,53049:0,54090:0,54091:0,65061:2,65062:2,65161:0,65163:0,102041:2,102064:11,102068:15,102069:16,102118:2,102119:1,102120:2,102121:2,102217:2,102218:0,102219:2,102220:2,102378:1,102379:1,102380:0,102381:1,102589:2,102599:2,102600:2,102604:2,102647:0,102704:2,102705:2,102706:0,102731:0,102732:0,102759:1,102760:1,102761:2,102762:0,102763:2,102764:0,102765:0,102766:2,102970:1,102974:2,102993:0,102994:0,102995:2,102996:2,103015:0,103016:2,103017:0,103018:2,103025:0,103026:0,103027:2,103028:2,103035:0,103036:0,103037:2,103038:2,103039:0,103040:0,103041:2,103042:2,103043:0,103044:0,103045:2,103046:2,103047:0,103048:0,103049:2,103050:2,103051:0,103052:2,103053:0,103054:2,103055:0,103056:2,103057:0,103058:0,103059:2,103060:2,103061:0,103062:0,103063:2,103064:2,103069:2,103070:0,103071:0,103072:2,103073:2,103086:0,103087:0,103088:2,103089:2,103094:1,103095:0,103096:2,103103:0,103104:2,103105:0,103106:2,103121:0,103122:2,103123:0,103124:0,103125:1,103126:1,103127:0,103128:0,103129:2,103130:2,103131:0,103132:0,103133:2,103134:2,103135:0,103136:0,103137:1,103138:1,103139:0,103140:2,103141:0,103142:2,103143:0,103144:2,103145:0,103146:1,103147:0,103148:0,103149:2,103150:2,103151:0,103152:2,103172:0,103173:2,103174:0,103175:0,103176:2,103177:2,103178:0,103179:0,103180:2,103181:2,103182:0,103183:0,103184:2,103185:2,103228:0,103229:0,103230:2,103231:2,103250:0,103251:2,103252:0,103253:2,103260:0,103261:0,103262:2,103263:2,103270:0,103271:0,103272:2,103273:2,103274:0,103275:0,103276:2,103277:2,103278:0,103279:0,103280:2,103281:2,103282:0,103283:0,103284:2,103285:2,103286:0,103287:2,103288:0,103289:2,103290:0,103291:2,103292:0,103293:0,103294:2,103295:2,103296:0,103297:0,103298:2,103299:2,103376:2,103377:0,103378:0,103379:2,103380:2,103393:0,103394:0,103395:2,103396:2,103472:0,103473:1,103474:0,103475:2,103482:0,103483:2,103484:0,103485:2,103500:0,103501:2,103502:0,103503:0,103504:1,103505:1,103506:0,103507:0,103508:2,103509:2,103510:0,103511:0,103512:2,103513:2,103514:0,103515:2,103516:0,103517:2,103518:0,103519:2,103520:0,103521:1,103522:0,103523:0,103524:2,103525:2,103526:0,103527:2,103561:2,103562:2,103563:0,103564:0,103565:2,103566:2,103567:0,103568:0,103569:2,103570:2,103584:0,103585:2,103586:0,103587:2,103588:1,103589:0,103590:2,103591:1,103592:0,103593:2,103594:1,103695:2};for(g=2e3;g<=2045;g++)$[g]=0;for(g=2056;g<=2065;g++)$[g]=0;for(g=2067;g<=2135;g++)$[g]=0;for(g=2137;g<=2154;g++)$[g]=0;for(g=2161;g<=2170;g++)$[g]=0;for(g=2172;g<=2193;g++)$[g]=0;for(g=2195;g<=2198;g++)$[g]=0;for(g=2200;g<=2203;g++)$[g]=0;for(g=2205;g<=2217;g++)$[g]=0;for(g=2222;g<=2224;g++)$[g]=1;for(g=2225;g<=2250;g++)$[g]=2;for(g=2251;g<=2253;g++)$[g]=1;for(g=2257;g<=2264;g++)$[g]=2;for(g=2274;g<=2279;g++)$[g]=2;for(g=2280;g<=2282;g++)$[g]=1;for(g=2283;g<=2289;g++)$[g]=2;for(g=2290;g<=2292;g++)$[g]=0;for(g=2308;g<=2313;g++)$[g]=0;for(g=2315;g<=2491;g++)$[g]=0;for(g=2494;g<=2866;g++)$[g]=0;for(g=2867;g<=2869;g++)$[g]=1;for(g=2870;g<=2888;g++)$[g]=2;for(g=2891;g<=2895;g++)$[g]=2;for(g=2896;g<=2898;g++)$[g]=1;for(g=2902;g<=2908;g++)$[g]=2;for(g=2915;g<=2920;g++)$[g]=2;for(g=2921;g<=2923;g++)$[g]=1;for(g=2924;g<=2930;g++)$[g]=2;for(g=2931;g<=2962;g++)$[g]=0;for(g=2964;g<=2968;g++)$[g]=2;for(g=2969;g<=2973;g++)$[g]=0;for(g=2975;g<=2991;g++)$[g]=0;for(g=2995;g<=3051;g++)$[g]=0;for(g=3054;g<=3079;g++)$[g]=0;for(g=3081;g<=3088;g++)$[g]=0;for(g=3092;g<=3101;g++)$[g]=0;for(g=3106;g<=3138;g++)$[g]=0;for(g=3146;g<=3151;g++)$[g]=0;for(g=3153;g<=3166;g++)$[g]=0;for(g=3168;g<=3172;g++)$[g]=0;for(g=3174;g<=3203;g++)$[g]=0;for(g=3294;g<=3358;g++)$[g]=0;for(g=3367;g<=3403;g++)$[g]=0;for(g=3408;g<=3416;g++)$[g]=0;for(g=3417;g<=3438;g++)$[g]=2;for(g=3441;g<=3446;g++)$[g]=2;for(g=3447;g<=3450;g++)$[g]=0;for(g=3451;g<=3459;g++)$[g]=2;for(g=3460;g<=3478;g++)$[g]=0;for(g=3554;g<=3559;g++)$[g]=0;for(g=3560;g<=3570;g++)$[g]=2;for(g=3571;g<=3581;g++)$[g]=0;for(g=3594;g<=3597;g++)$[g]=0;for(g=3601;g<=3604;g++)$[g]=0;for(g=3637;g<=3639;g++)$[g]=0;for(g=3665;g<=3667;g++)$[g]=0;for(g=3693;g<=3695;g++)$[g]=0;for(g=3701;g<=3727;g++)$[g]=0;for(g=3728;g<=3739;g++)$[g]=2;for(g=3740;g<=3751;g++)$[g]=0;for(g=3753;g<=3760;g++)$[g]=2;for(g=3761;g<=3773;g++)$[g]=0;for(g=3775;g<=3777;g++)$[g]=0;for(g=3779;g<=3781;g++)$[g]=0;for(g=3783;g<=3785;g++)$[g]=0;for(g=3788;g<=3791;g++)$[g]=0;for(g=3797;g<=3802;g++)$[g]=0;for(g=3814;g<=3816;g++)$[g]=0;for(g=3825;g<=3829;g++)$[g]=0;for(g=3832;g<=3841;g++)$[g]=0;for(g=3844;g<=3852;g++)$[g]=0;for(g=3873;g<=3885;g++)$[g]=0;for(g=3890;g<=3893;g++)$[g]=0;for(g=3907;g<=3912;g++)$[g]=0;for(g=3942;g<=3950;g++)$[g]=0;for(g=3968;g<=3970;g++)$[g]=0;for(g=3973;g<=3976;g++)$[g]=0;for(g=3986;g<=3989;g++)$[g]=0;for(g=3994;g<=3997;g++)$[g]=0;for(g=4048;g<=4051;g++)$[g]=0;for(g=4056;g<=4063;g++)$[g]=0;for(g=4093;g<=4096;g++)$[g]=0;for(g=4390;g<=4398;g++)$[g]=0;for(g=4399;g<=4413;g++)$[g]=2;for(g=4418;g<=4433;g++)$[g]=2;for(g=4455;g<=4457;g++)$[g]=2;for(g=4484;g<=4489;g++)$[g]=0;for(g=4491;g<=4554;g++)$[g]=0;for(g=4568;g<=4589;g++)$[g]=0;for(g=4652;g<=4656;g++)$[g]=0;for(g=4766;g<=4800;g++)$[g]=0;for(g=5014;g<=5016;g++)$[g]=0;for(g=5069;g<=5072;g++)$[g]=0;for(g=5105;g<=5130;g++)$[g]=0;for(g=5173;g<=5188;g++)$[g]=0;for(g=5253;g<=5259;g++)$[g]=0;for(g=5269;g<=5275;g++)$[g]=0;for(g=5292;g<=5311;g++)$[g]=0;for(g=5329;g<=5331;g++)$[g]=0;for(g=5343;g<=5349;g++)$[g]=0;for(g=5355;g<=5357;g++)$[g]=0;for(g=5387;g<=5389;g++)$[g]=0;for(g=5459;g<=5463;g++)$[g]=0;for(g=5479;g<=5482;g++)$[g]=0;for(g=5518;g<=5520;g++)$[g]=0;for(g=5530;g<=5539;g++)$[g]=0;for(g=5550;g<=5552;g++)$[g]=0;for(g=5562;g<=5583;g++)$[g]=0;for(g=5623;g<=5625;g++)$[g]=2;for(g=5631;g<=5639;g++)$[g]=0;for(g=5649;g<=5653;g++)$[g]=0;for(g=5663;g<=5680;g++)$[g]=0;for(g=5682;g<=5685;g++)$[g]=0;for(g=5875;g<=5877;g++)$[g]=0;for(g=5896;g<=5899;g++)$[g]=0;for(g=5921;g<=5940;g++)$[g]=0;for(g=6050;g<=6125;g++)$[g]=0;for(g=6244;g<=6275;g++)$[g]=0;for(g=6328;g<=6348;g++)$[g]=0;for(g=6350;g<=6356;g++)$[g]=0;for(g=6366;g<=6372;g++)$[g]=0;for(g=6381;g<=6387;g++)$[g]=0;for(g=6393;g<=6404;g++)$[g]=0;for(g=6480;g<=6483;g++)$[g]=0;for(g=6511;g<=6514;g++)$[g]=0;for(g=6579;g<=6581;g++)$[g]=0;for(g=6619;g<=6624;g++)$[g]=0;for(g=6625;g<=6627;g++)$[g]=2;for(g=6628;g<=6632;g++)$[g]=0;for(g=6634;g<=6637;g++)$[g]=0;for(g=6669;g<=6692;g++)$[g]=0;for(g=6707;g<=6709;g++)$[g]=0;for(g=6720;g<=6723;g++)$[g]=0;for(g=6732;g<=6738;g++)$[g]=0;for(g=6931;g<=6933;g++)$[g]=0;for(g=6956;g<=6959;g++)$[g]=0;for(g=7005;g<=7007;g++)$[g]=0;for(g=7057;g<=7070;g++)$[g]=2;for(g=7074;g<=7082;g++)$[g]=0;for(g=7109;g<=7118;g++)$[g]=0;for(g=7119;g<=7127;g++)$[g]=1;for(g=7374;g<=7376;g++)$[g]=0;for(g=7528;g<=7586;g++)$[g]=0;for(g=7587;g<=7645;g++)$[g]=2;for(g=7692;g<=7696;g++)$[g]=0;for(g=7755;g<=7787;g++)$[g]=0;for(g=7791;g<=7795;g++)$[g]=0;for(g=7799;g<=7801;g++)$[g]=0;for(g=7803;g<=7805;g++)$[g]=0;for(g=7825;g<=7831;g++)$[g]=0;for(g=7845;g<=7859;g++)$[g]=0;for(g=8013;g<=8032;g++)$[g]=0;for(g=8065;g<=8068;g++)$[g]=1;for(g=8518;g<=8529;g++)$[g]=2;for(g=8533;g<=8536;g++)$[g]=2;for(g=8538;g<=8540;g++)$[g]=2;for(g=8677;g<=8679;g++)$[g]=0;for(g=8836;g<=8840;g++)$[g]=0;for(g=8857;g<=8859;g++)$[g]=0;for(g=8908;g<=8910;g++)$[g]=0;for(g=9154;g<=9159;g++)$[g]=0;for(g=9205;g<=9218;g++)$[g]=0;for(g=9271;g<=9273;g++)$[g]=0;for(g=9295;g<=9297;g++)$[g]=0;for(g=9356;g<=9360;g++)$[g]=0;for(g=9404;g<=9407;g++)$[g]=0;for(g=9476;g<=9482;g++)$[g]=0;for(g=9487;g<=9494;g++)$[g]=0;for(g=9697;g<=9699;g++)$[g]=0;for(g=9821;g<=9865;g++)$[g]=0;for(g=20002;g<=20032;g++)$[g]=0;for(g=20047;g<=20049;g++)$[g]=0;for(g=20062;g<=20092;g++)$[g]=0;for(g=20135;g<=20138;g++)$[g]=0;for(g=20248;g<=20258;g++)$[g]=0;for(g=20348;g<=20358;g++)$[g]=0;for(g=20436;g<=20440;g++)$[g]=0;for(g=20822;g<=20824;g++)$[g]=0;for(g=20904;g<=20932;g++)$[g]=0;for(g=20934;g<=20936;g++)$[g]=0;for(g=21004;g<=21032;g++)$[g]=0;for(g=21035;g<=21037;g++)$[g]=0;for(g=21095;g<=21097;g++)$[g]=0;for(g=21148;g<=21150;g++)$[g]=0;for(g=21207;g<=21264;g++)$[g]=0;for(g=21307;g<=21364;g++)$[g]=0;for(g=21413;g<=21423;g++)$[g]=0;for(g=21453;g<=21463;g++)$[g]=0;for(g=21473;g<=21483;g++)$[g]=0;for(g=21780;g<=21782;g++)$[g]=0;for(g=21891;g<=21894;g++)$[g]=0;for(g=21896;g<=21899;g++)$[g]=0;for(g=22171;g<=22177;g++)$[g]=0;for(g=22181;g<=22187;g++)$[g]=0;for(g=22191;g<=22197;g++)$[g]=0;for(g=22207;g<=22222;g++)$[g]=0;for(g=22234;g<=22236;g++)$[g]=0;for(g=22243;g<=22250;g++)$[g]=0;for(g=22262;g<=22265;g++)$[g]=0;for(g=22307;g<=22322;g++)$[g]=0;for(g=22348;g<=22357;g++)$[g]=0;for(g=22407;g<=22422;g++)$[g]=0;for(g=22462;g<=22465;g++)$[g]=0;for(g=22521;g<=22525;g++)$[g]=0;for(g=22607;g<=22622;g++)$[g]=0;for(g=22641;g<=22646;g++)$[g]=0;for(g=22648;g<=22657;g++)$[g]=0;for(g=22707;g<=22722;g++)$[g]=0;for(g=22762;g<=22765;g++)$[g]=0;for(g=22991;g<=22994;g++)$[g]=0;for(g=23028;g<=23038;g++)$[g]=0;for(g=23830;g<=23853;g++)$[g]=0;for(g=23866;g<=23872;g++)$[g]=0;for(g=23877;g<=23884;g++)$[g]=0;for(g=23886;g<=23894;g++)$[g]=0;for(g=23946;g<=23948;g++)$[g]=0;for(g=24311;g<=24313;g++)$[g]=0;for(g=24342;g<=24347;g++)$[g]=0;for(g=24370;g<=24374;g++)$[g]=10;for(g=24375;g<=24381;g++)$[g]=0;for(g=24718;g<=24721;g++)$[g]=0;for(g=24817;g<=24821;g++)$[g]=0;for(g=24877;g<=24882;g++)$[g]=0;for(g=24891;g<=24893;g++)$[g]=0;for(g=25391;g<=25395;g++)$[g]=0;for(g=25828;g<=25838;g++)$[g]=0;for(g=26191;g<=26195;g++)$[g]=0;for(g=26391;g<=26393;g++)$[g]=0;for(g=26701;g<=26722;g++)$[g]=0;for(g=26729;g<=26799;g++)$[g]=2;for(g=26801;g<=26803;g++)$[g]=2;for(g=26811;g<=26813;g++)$[g]=2;for(g=26847;g<=26870;g++)$[g]=2;for(g=26891;g<=26899;g++)$[g]=0;for(g=26901;g<=26923;g++)$[g]=0;for(g=26929;g<=26946;g++)$[g]=0;for(g=26948;g<=26998;g++)$[g]=0;for(g=27037;g<=27040;g++)$[g]=0;for(g=27205;g<=27232;g++)$[g]=0;for(g=27258;g<=27260;g++)$[g]=0;for(g=27391;g<=27398;g++)$[g]=0;for(g=27561;g<=27564;g++)$[g]=0;for(g=27571;g<=27574;g++)$[g]=0;for(g=27581;g<=27584;g++)$[g]=0;for(g=27591;g<=27594;g++)$[g]=0;for(g=28191;g<=28193;g++)$[g]=0;for(g=28348;g<=28358;g++)$[g]=0;for(g=28402;g<=28432;g++)$[g]=0;for(g=28462;g<=28492;g++)$[g]=0;for(g=29118;g<=29122;g++)$[g]=0;for(g=29168;g<=29172;g++)$[g]=0;for(g=29177;g<=29185;g++)$[g]=0;for(g=29187;g<=29195;g++)$[g]=0;for(g=29900;g<=29903;g++)$[g]=0;for(g=30161;g<=30179;g++)$[g]=0;for(g=30491;g<=30494;g++)$[g]=0;for(g=30729;g<=30732;g++)$[g]=0;for(g=31251;g<=31259;g++)$[g]=0;for(g=31265;g<=31268;g++)$[g]=0;for(g=31275;g<=31279;g++)$[g]=0;for(g=31281;g<=31297;g++)$[g]=0;for(g=31461;g<=31469;g++)$[g]=0;for(g=31491;g<=31495;g++)$[g]=0;for(g=31917;g<=31922;g++)$[g]=0;for(g=31965;g<=32e3;g++)$[g]=0;for(g=32001;g<=32003;g++)$[g]=2;for(g=32005;g<=32031;g++)$[g]=2;for(g=32033;g<=32060;g++)$[g]=2;for(g=32064;g<=32067;g++)$[g]=2;for(g=32074;g<=32077;g++)$[g]=2;for(g=32081;g<=32086;g++)$[g]=0;for(g=32107;g<=32130;g++)$[g]=0;for(g=32133;g<=32159;g++)$[g]=0;for(g=32164;g<=32167;g++)$[g]=2;for(g=32180;g<=32199;g++)$[g]=0;for(g=32201;g<=32260;g++)$[g]=0;for(g=32301;g<=32360;g++)$[g]=0;for(g=32601;g<=32662;g++)$[g]=0;for(g=32664;g<=32667;g++)$[g]=2;for(g=32701;g<=32761;g++)$[g]=0;for(g=53001;g<=53004;g++)$[g]=0;for(g=53008;g<=53019;g++)$[g]=0;for(g=53021;g<=53032;g++)$[g]=0;for(g=53034;g<=53037;g++)$[g]=0;for(g=53042;g<=53046;g++)$[g]=0;for(g=53074;g<=53080;g++)$[g]=0;for(g=54001;g<=54004;g++)$[g]=0;for(g=54008;g<=54019;g++)$[g]=0;for(g=54021;g<=54032;g++)$[g]=0;for(g=54034;g<=54037;g++)$[g]=0;for(g=54042;g<=54046;g++)$[g]=0;for(g=54048;g<=54053;g++)$[g]=0;for(g=54074;g<=54080;g++)$[g]=0;for(g=54098;g<=54101;g++)$[g]=0;for(g=102001;g<=102040;g++)$[g]=0;for(g=102042;g<=102063;g++)$[g]=0;for(g=102065;g<=102067;g++)$[g]=0;for(g=102070;g<=102117;g++)$[g]=0;for(g=102122;g<=102216;g++)$[g]=0;for(g=102221;g<=102377;g++)$[g]=0;for(g=102382;g<=102388;g++)$[g]=0;for(g=102389;g<=102398;g++)$[g]=2;for(g=102399;g<=102444;g++)$[g]=0;for(g=102445;g<=102447;g++)$[g]=2;for(g=102448;g<=102458;g++)$[g]=0;for(g=102459;g<=102468;g++)$[g]=2;for(g=102469;g<=102499;g++)$[g]=0;for(g=102500;g<=102519;g++)$[g]=1;for(g=102520;g<=102524;g++)$[g]=0;for(g=102525;g<=102529;g++)$[g]=2;for(g=102530;g<=102588;g++)$[g]=0;for(g=102590;g<=102598;g++)$[g]=0;for(g=102601;g<=102603;g++)$[g]=0;for(g=102605;g<=102628;g++)$[g]=0;for(g=102629;g<=102646;g++)$[g]=2;for(g=102648;g<=102700;g++)$[g]=2;for(g=102701;g<=102703;g++)$[g]=0;for(g=102707;g<=102730;g++)$[g]=2;for(g=102733;g<=102758;g++)$[g]=2;for(g=102767;g<=102900;g++)$[g]=0;for(g=102901;g<=102933;g++)$[g]=2;for(g=102934;g<=102950;g++)$[g]=13;for(g=102951;g<=102955;g++)$[g]=0;for(g=102961;g<=102963;g++)$[g]=0;for(g=102965;g<=102969;g++)$[g]=0;for(g=102971;g<=102973;g++)$[g]=0;for(g=102975;g<=102989;g++)$[g]=0;for(g=102990;g<=102992;g++)$[g]=1;for(g=102997;g<=103002;g++)$[g]=0;for(g=103003;g<=103008;g++)$[g]=2;for(g=103009;g<=103011;g++)$[g]=0;for(g=103012;g<=103014;g++)$[g]=2;for(g=103019;g<=103021;g++)$[g]=0;for(g=103022;g<=103024;g++)$[g]=2;for(g=103029;g<=103031;g++)$[g]=0;for(g=103032;g<=103034;g++)$[g]=2;for(g=103065;g<=103068;g++)$[g]=0;for(g=103074;g<=103076;g++)$[g]=0;for(g=103077;g<=103079;g++)$[g]=1;for(g=103080;g<=103082;g++)$[g]=0;for(g=103083;g<=103085;g++)$[g]=2;for(g=103090;g<=103093;g++)$[g]=0;for(g=103097;g<=103099;g++)$[g]=0;for(g=103100;g<=103102;g++)$[g]=2;for(g=103107;g<=103109;g++)$[g]=0;for(g=103110;g<=103112;g++)$[g]=2;for(g=103113;g<=103116;g++)$[g]=0;for(g=103117;g<=103120;g++)$[g]=2;for(g=103153;g<=103157;g++)$[g]=0;for(g=103158;g<=103162;g++)$[g]=2;for(g=103163;g<=103165;g++)$[g]=0;for(g=103166;g<=103168;g++)$[g]=1;for(g=103169;g<=103171;g++)$[g]=2;for(g=103186;g<=103188;g++)$[g]=0;for(g=103189;g<=103191;g++)$[g]=2;for(g=103192;g<=103195;g++)$[g]=0;for(g=103196;g<=103199;g++)$[g]=2;for(g=103200;g<=103224;g++)$[g]=0;for(g=103225;g<=103227;g++)$[g]=1;for(g=103232;g<=103237;g++)$[g]=0;for(g=103238;g<=103243;g++)$[g]=2;for(g=103244;g<=103246;g++)$[g]=0;for(g=103247;g<=103249;g++)$[g]=2;for(g=103254;g<=103256;g++)$[g]=0;for(g=103257;g<=103259;g++)$[g]=2;for(g=103264;g<=103266;g++)$[g]=0;for(g=103267;g<=103269;g++)$[g]=2;for(g=103300;g<=103375;g++)$[g]=0;for(g=103381;g<=103383;g++)$[g]=0;for(g=103384;g<=103386;g++)$[g]=1;for(g=103387;g<=103389;g++)$[g]=0;for(g=103390;g<=103392;g++)$[g]=2;for(g=103397;g<=103399;g++)$[g]=0;for(g=103400;g<=103471;g++)$[g]=2;for(g=103476;g<=103478;g++)$[g]=0;for(g=103479;g<=103481;g++)$[g]=2;for(g=103486;g<=103488;g++)$[g]=0;for(g=103489;g<=103491;g++)$[g]=2;for(g=103492;g<=103495;g++)$[g]=0;for(g=103496;g<=103499;g++)$[g]=2;for(g=103528;g<=103543;g++)$[g]=0;for(g=103544;g<=103548;g++)$[g]=2;for(g=103549;g<=103551;g++)$[g]=0;for(g=103552;g<=103554;g++)$[g]=1;for(g=103555;g<=103557;g++)$[g]=2;for(g=103558;g<=103560;g++)$[g]=0;for(g=103571;g<=103573;g++)$[g]=0;for(g=103574;g<=103576;g++)$[g]=2;for(g=103577;g<=103580;g++)$[g]=0;for(g=103581;g<=103583;g++)$[g]=2;for(g=103595;g<=103694;g++)$[g]=0;for(g=103696;g<=103699;g++)$[g]=0;for(g=103700;g<=103793;g++)$[g]=2;for(g=103794;g<=103890;g++)$[g]=0;for(g=103891;g<=103896;g++)$[g]=2;for(g=103900;g<=103971;g++)$[g]=2;for(g=103972;g<=103977;g++)$[g]=0;for(g=112e3;g<=112101;g++)$[g]=0;const yLe={102113:!0,102100:!0,3857:!0,3785:!0},_Le={4326:!0,3785:!0,3857:!0,102113:!0,102100:!0,104905:!0,104971:!0},tK='PROJCS["WGS_1984_Web_Mercator_Auxiliary_Sphere",GEOGCS["GCS_WGS_1984",DATUM["D_WGS_1984",SPHEROID["WGS_1984",6378137.0,298.257223563]],PRIMEM["Greenwich",0.0],UNIT["Degree",0.0174532925199433]],PROJECTION["Mercator_Auxiliary_Sphere"],PARAMETER["False_Easting",0.0],PARAMETER["False_Northing",0.0],PARAMETER["Central_Meridian",{Central_Meridian}],PARAMETER["Standard_Parallel_1",0.0],PARAMETER["Auxiliary_Sphere_Type",0.0],UNIT["Meter",1.0]]',MP=[-20037508342788905e-9,20037508342788905e-9],IP=[-20037508342787e-6,20037508342787e-6],Wpe={102113:{wkTemplate:'PROJCS["WGS_1984_Web_Mercator",GEOGCS["GCS_WGS_1984_Major_Auxiliary_Sphere",DATUM["D_WGS_1984_Major_Auxiliary_Sphere",SPHEROID["WGS_1984_Major_Auxiliary_Sphere",6378137.0,0.0]],PRIMEM["Greenwich",0.0],UNIT["Degree",0.0174532925199433]],PROJECTION["Mercator"],PARAMETER["False_Easting",0.0],PARAMETER["False_Northing",0.0],PARAMETER["Central_Meridian",{Central_Meridian}],PARAMETER["Standard_Parallel_1",0.0],UNIT["Meter",1.0]]',valid:MP,origin:IP,dx:1e-5},102100:{wkTemplate:tK,valid:MP,origin:IP,dx:1e-5},3785:{wkTemplate:'PROJCS["WGS_1984_Web_Mercator",GEOGCS["GCS_WGS_1984_Major_Auxiliary_Sphere",DATUM["D_WGS_1984_Major_Auxiliary_Sphere",SPHEROID["WGS_1984_Major_Auxiliary_Sphere",6378137.0,0.0]],PRIMEM["Greenwich",0.0],UNIT["Degree",0.0174532925199433]],PROJECTION["Mercator"],PARAMETER["False_Easting",0.0],PARAMETER["False_Northing",0.0],PARAMETER["Central_Meridian",{Central_Meridian}],PARAMETER["Standard_Parallel_1",0.0],UNIT["Meter",1.0]]',valid:MP,origin:IP,dx:1e-5},3857:{wkTemplate:tK,valid:MP,origin:IP,dx:1e-5},4326:{wkTemplate:'GEOGCS["GCS_WGS_1984",DATUM["D_WGS_1984",SPHEROID["WGS_1984",6378137.0,298.257223563]],PRIMEM["Greenwich",{Central_Meridian}],UNIT["Degree",0.0174532925199433]]',altTemplate:'PROJCS["WGS_1984_Plate_Carree",GEOGCS["GCS_WGS_1984",DATUM["D_WGS_1984",SPHEROID["WGS_1984",6378137.0,298.257223563]],PRIMEM["Greenwich",0.0],UNIT["Degree",0.0174532925199433]],PROJECTION["Plate_Carree"],PARAMETER["False_Easting",0.0],PARAMETER["False_Northing",0.0],PARAMETER["Central_Meridian",{Central_Meridian}],UNIT["Degrees",111319.491]]',valid:[-180,180],origin:[-180,90],dx:1e-5},104971:{wkTemplate:'GEOGCS["Mars_2000_(Sphere)",DATUM["Mars_2000_(Sphere)",SPHEROID["Mars_2000_(Sphere)",3396190.0,0.0]],PRIMEM["Reference_Meridian",0.0],UNIT["Degree",0.0174532925199433]]',valid:[-180,180],origin:[-180,90],dx:1e-5},104905:{wkTemplate:'GEOGCS["GCS_Mars_2000",DATUM["D_Mars_2000",SPHEROID["Mars_2000_IAU_IAG",3396190.0,169.8944472236118]],PRIMEM["Reference_Meridian",0.0],UNIT["Degree",0.0174532925199433]]',valid:[-180,180],origin:[-180,90],dx:1e-5}};function Rn(t,e){return t===e||t!=null&&e!=null&&(t.wkid!=null||e.wkid!=null?t.wkid===e.wkid||Gb(t)&&Gb(e)||e.latestWkid!=null&&t.wkid===e.latestWkid||t.latestWkid!=null&&e.wkid===t.latestWkid:!(!t.wkt||!e.wkt)&&t.wkt.toUpperCase()===e.wkt.toUpperCase())}function d_(t){return aa(t)&&t.wkid&&Wpe[t.wkid]||null}function Zpe(t){return!!aa(t)&&(t.wkid?$[t.wkid]==null:!!t.wkt&&!!/^\s*GEOGCS/i.test(t.wkt))}function _O(t){return!(Qf(t)||Kf(t))}function vO(t){return aa(t)&&t.wkid===4326}function Xpe(t){return aa(t)&&t.wkid===hh.CGCS2000}function Gb(t){return aa(t)&&t.wkid!=null&&yLe[t.wkid]===!0}function bO(t){return aa(t)&&t.wkid===32662}function Hq(t){return t===hh.GCSMARS2000||t===hh.GCSMARS2000_SPHERE}function Qf(t){return aa(t)&&t.wkid!=null&&Hq(t.wkid)}function qq(t){return t===hh.GCSMOON2000}function Kf(t){return aa(t)&&t.wkid!=null&&qq(t.wkid)}function vLe(t){return aa(t)&&t.wkid!=null&&_Le[t.wkid]===!0}function aa(t){return t!=null&&(t.wkid!=null&&t.wkid>=2e3||t.wkt!=null)}const bLe={wkid:4326,wkt:_F(Wpe[4326].wkTemplate,{Central_Meridian:"0.0"})},wLe={wkid:102100,latestWkid:3857},xLe={wkid:32662};function Wq(t){return{wkt:`GEOCCS["Spherical geocentric",
    DATUM["Not specified",
      SPHEROID["Sphere",${t.radius},0]],
    PRIMEM["Greenwich",0.0,
      AUTHORITY["EPSG","8901"]],
    UNIT["m",1.0],
    AXIS["Geocentric X",OTHER],
    AXIS["Geocentric Y",EAST],
    AXIS["Geocentric Z",NORTH]
  ]`}}const Ype=Wq(nr),Zq=Wq(Af),Xq=Wq($g),Jpe={wkt:`GEOCCS["WGS 84",
  DATUM["WGS_1984",
    SPHEROID["WGS 84",${nr.radius},298.257223563,
      AUTHORITY["EPSG","7030"]],
    AUTHORITY["EPSG","6326"]],
  PRIMEM["Greenwich",0,
    AUTHORITY["EPSG","8901"]],
  UNIT["m",1.0,
    AUTHORITY["EPSG","9001"]],
  AXIS["Geocentric X",OTHER],
  AXIS["Geocentric Y",OTHER],
  AXIS["Geocentric Z",NORTH],
  AUTHORITY["EPSG","4978"]
]`};function Nr(t){return t!=null&&(Qf(t)||Rn(t,Zq))?Af:t!=null&&(Kf(t)||Rn(t,Xq))?$g:nr}function hSt(t){return Hq(t)?Af:qq(t)?$g:nr}const Yq=39.37,TLe=nr.radius*Math.PI/200,Qpe=/UNIT\[([^\]]+)\]\]$/i,xb=$,Kpe=/UNIT\[([^\]]+)\]/i,SLe=new Set([4261,4305,4807,4810,4811,4812,4816,4819,4821,4901,4902,37225,104139,104140]),ELe=Wa()({meter:"meters",foot:"feet",foot_us:"us-feet",foot_clarke:"clarke-feet",yard_clarke:"clarke-yards",link_clarke:"clarke-links",yard_sears:"sears-yards",foot_sears:"sears-feet",chain_sears:"sears-chains",chain_benoit_1895_b:"benoit-1895-b-chains",yard_indian:"indian-yards",yard_indian_1937:"indian-1937-yards",foot_gold_coast:"gold-coast-feet",chain_sears_1922_truncated:"sears-1922-truncated-chains","50_kilometers":"50-kilometers","150_kilometers":"150-kilometers"}),vp=t=>t*t,fy=t=>t*t*t,wO={length:{baseUnit:"meters",units:{millimeters:{inBaseUnits:.001},centimeters:{inBaseUnits:.01},decimeters:{inBaseUnits:.1},meters:{inBaseUnits:1},kilometers:{inBaseUnits:1e3},inches:{inBaseUnits:.0254},feet:{inBaseUnits:.3048},yards:{inBaseUnits:.9144},miles:{inBaseUnits:1609.344},"nautical-miles":{inBaseUnits:1852},"us-feet":{inBaseUnits:1200/3937}}},area:{baseUnit:"square-meters",units:{"square-millimeters":{inBaseUnits:vp(.001)},"square-centimeters":{inBaseUnits:vp(.01)},"square-decimeters":{inBaseUnits:vp(.1)},"square-meters":{inBaseUnits:1},"square-kilometers":{inBaseUnits:vp(1e3)},"square-inches":{inBaseUnits:vp(.0254)},"square-feet":{inBaseUnits:vp(.3048)},"square-yards":{inBaseUnits:vp(.9144)},"square-miles":{inBaseUnits:vp(1609.344)},"square-us-feet":{inBaseUnits:vp(1200/3937)},acres:{inBaseUnits:.0015625*vp(1609.344)},ares:{inBaseUnits:100},hectares:{inBaseUnits:1e4}}},volume:{baseUnit:"liters",units:{liters:{inBaseUnits:1},"cubic-millimeters":{inBaseUnits:1e3*fy(.001)},"cubic-centimeters":{inBaseUnits:1e3*fy(.01)},"cubic-decimeters":{inBaseUnits:1e3*fy(.1)},"cubic-meters":{inBaseUnits:1e3},"cubic-kilometers":{inBaseUnits:1e3*fy(1e3)},"cubic-inches":{inBaseUnits:1e3*fy(.0254)},"cubic-feet":{inBaseUnits:1e3*fy(.3048)},"cubic-yards":{inBaseUnits:1e3*fy(.9144)},"cubic-miles":{inBaseUnits:1e3*fy(1609.344)}}},angle:{baseUnit:"radians",units:{radians:{inBaseUnits:1},degrees:{inBaseUnits:Math.PI/180}}}},CLe=(()=>{const t={};for(const e in wO)for(const r in wO[e].units)t[r]=e;return t})();function ALe(t,e,r){return t*wO[r].units[e].inBaseUnits}function OLe(t,e,r){return t/wO[r].units[e].inBaseUnits}const efe=["metric","imperial","inches","feet","yards","miles","nautical-miles","us-feet","meters","kilometers"],RLe=new Map([["meters","square-meters"],["feet","square-feet"],["us-feet","square-us-feet"]]);function yV(t){const e=CLe[t];if(!e)throw new Error("unknown type");return e}function rK(t,e=null){return e=e||yV(t),wO[e].baseUnit===t}function Io(t,e,r){if(e===r)return t;const i=yV(e);if(i!==yV(r))throw new Error("incompatible units");const s=rK(e,i)?t:ALe(t,e,i);return rK(r,i)?s:OLe(s,r,i)}function dSt(t,e,r){switch(r){case"metric":return PLe(t,e);case"imperial":return ILe(t,e);default:return r}}function pSt(t,e,r){switch(r){case"metric":return MLe(t,e);case"imperial":return $Le(t,e);default:return r}}function PLe(t,e){const r=Io(t,e,"meters");return Math.abs(r)<3e3?"meters":"kilometers"}function MLe(t,e){const r=Io(t,e,"meters");return Math.abs(r)<1e5?"meters":"kilometers"}function ILe(t,e){const r=Io(t,e,"feet");return Math.abs(r)<1e3?"feet":"miles"}function $Le(t,e){const r=Io(t,e,"feet");return Math.abs(r)<1e5?"feet":"miles"}function fSt(t,e){const r=Io(t,e,"square-meters");return Math.abs(r)<3e6?"square-meters":"square-kilometers"}function mSt(t,e){const r=Io(t,e,"square-feet");return Math.abs(r)<1e6?"square-feet":"square-miles"}function LLe(t,e,r){return Io(t,e,"meters")/(r*Math.PI/180)}function tfe(t){return ELe.fromJSON(t.toLowerCase())||null}function xO(t){if(t!=null&&!_O(t))return 1;const e=Za(t);return e>1e5?1:e}function rfe(t){return Za(t)>=Nr(t).metersPerDegree?"meters":AR(t)}function Za(t,e=nr.metersPerDegree){return DLe(t,!0)??e}function DLe(t,e=!1){const r=t!=null?t.wkid:null,i=t!=null?t.wkt:null;let s=null;if(r){if(Hq(r))return Af.metersPerDegree;if(qq(r))return $g.metersPerDegree;s=xb.values[xb[r]],!s&&e&&SLe.has(r)&&(s=TLe)}else i&&(nfe(i)?s=sK(Qpe.exec(i),s):sfe(i)&&(s=sK(Kpe.exec(i),s)));return s}function iK(t){return t.isGeographic?1:Za(t)}function sK(t,e){return t&&t[1]?ife(t[1]):e}function ife(t){return parseFloat(t.split(",")[1])}function AR(t){const e=t!=null?t.wkid:null,r=t!=null?t.wkt:null;let i=null;if(e)i=xb.units[xb[e]];else if(r){const s=nfe(r)?Qpe:sfe(r)?Kpe:null;if(s){const n=s.exec(r);n&&n[1]&&(i=FLe(n[1]))}}return i!=null?tfe(i):null}function gSt(t){const e=AR(t);return e!=null&&efe.includes(e)?e:null}function ySt(t){const e=rfe(t);return e!=null&&efe.includes(e)?e:null}function _St(t){const e=AR(t);return e==null?null:RLe.get(e)}function sfe(t){return/^GEOCCS/i.test(t)}function nfe(t){return/^PROJCS/i.test(t)}const NLe=1e-7;function FLe(t){const e=/[\\"\\']{1}([^\\"\\']+)/.exec(t);let r=e&&e[1];if(!r||!xb.units.includes(r)){const i=ife(t);r=null;const s=xb.values;for(let n=0;n<s.length;++n)if(Math.abs(i-s[n])<NLe){r=xb.units[n];break}}return r}function vSt(t){const e=AR(t);if(e==null)return null;switch(e){case"feet":case"us-feet":case"clarke-feet":case"clarke-yards":case"clarke-links":case"sears-yards":case"sears-feet":case"sears-chains":case"benoit-1895-b-chains":case"indian-yards":case"indian-1937-yards":case"gold-coast-feet":case"sears-1922-truncated-chains":return"imperial";case"50-kilometers":case"150-kilometers":case"meters":return"metric"}return null}const ULe={esriAcres:"acres",esriAres:"ares",esriHectares:"hectares",esriSquareCentimeters:"square-centimeters",esriSquareDecimeters:"square-decimeters",esriSquareFeet:"square-feet",esriSquareInches:"square-inches",esriSquareKilometers:"square-kilometers",esriSquareMeters:"square-meters",esriSquareMiles:"square-miles",esriSquareMillimeters:"square-millimeters",esriSquareUsFeet:"square-us-feet",esriSquareYards:"square-yards"},kLe={esriCentimeters:"centimeters",esriDecimeters:"decimeters",esriFeet:"feet",esriInches:"inches",esriKilometers:"kilometers",esriMeters:"meters",esriMiles:"miles",esriMillimeters:"millimeters",esriNauticalMiles:"nautical-miles",esriYards:"yards"},VLe={esriDUDecimalDegrees:"degrees",esriDURadians:"radians"},zLe=Wa()(ULe),BLe=Wa()(kLe),bSt=Wa()(VLe);function Fe(t,e,r){let i,s;return e===void 0?(s=t,i=[void 0]):typeof e!="string"?(s=t,i=[void 0],r=e):(s=e,i=Array.isArray(t)?t:[t]),(n,o)=>{const a=n.constructor.prototype;for(const l of i){const c=kq(n,l,s);c.write&&typeof c.write=="object"||(c.write={}),r&&(c.write.target=r),c.write.writer=a[o]}}}var kp;let _i=kp=class extends de{static fromJSON(t){if(!t)return null;if(t.wkid){if(t.wkid===102100)return kp.WebMercator;if(t.wkid===4326)return kp.WGS84}const e=new kp;return e.read(t),e}constructor(t){super(t),this.latestWkid=null,this.wkid=null,this.wkt=null,this.vcsWkid=null,this.latestVcsWkid=null,this.imageCoordinateSystem=null}normalizeCtorArgs(t){return t&&typeof t=="object"?t:{[typeof t=="string"?"wkt":"wkid"]:t}}get isWGS84(){return vO(this)}get isWebMercator(){return Gb(this)}get isGeographic(){return Zpe(this)}get isWrappable(){return vLe(this)}get metersPerUnit(){return Za(this)}get unit(){return AR(this)||(this.isGeographic?"degrees":null)}writeWkt(t,e){this.wkid||(e.wkt=t)}clone(){if(this===kp.WGS84)return kp.WGS84;if(this===kp.WebMercator)return kp.WebMercator;const t=new kp;return this.wkid!=null?(t.wkid=this.wkid,this.latestWkid!=null&&(t.latestWkid=this.latestWkid),this.vcsWkid!=null&&(t.vcsWkid=this.vcsWkid),this.latestVcsWkid!=null&&(t.latestVcsWkid=this.latestVcsWkid)):this.wkt!=null&&(t.wkt=this.wkt),this.imageCoordinateSystem&&(t.imageCoordinateSystem=K(this.imageCoordinateSystem)),t}equals(t){if(t==null)return!1;if(this.imageCoordinateSystem||t.imageCoordinateSystem){if(this.imageCoordinateSystem==null||t.imageCoordinateSystem==null)return!1;const{id:e,referenceServiceName:r}=t.imageCoordinateSystem,{geodataXform:i}=t.imageCoordinateSystem,s=this.imageCoordinateSystem;return e==null||i?JSON.stringify(s)===JSON.stringify(t.imageCoordinateSystem):r?s.id===e&&s.referenceServiceName===r:s.id===e}return Rn(this,t)}toJSON(t){return this.write(void 0,t)}};_i.GCS_NAD_1927=null,_i.WGS84=null,_i.WebMercator=null,_i.PlateCarree=null,u([d({readOnly:!0})],_i.prototype,"isWGS84",null),u([d({readOnly:!0})],_i.prototype,"isWebMercator",null),u([d({readOnly:!0})],_i.prototype,"isGeographic",null),u([d({readOnly:!0})],_i.prototype,"isWrappable",null),u([d({type:Xi,json:{write:!0}})],_i.prototype,"latestWkid",void 0),u([d({readOnly:!0})],_i.prototype,"metersPerUnit",null),u([d({readOnly:!0})],_i.prototype,"unit",null),u([d({type:Xi,json:{write:!0,origins:{"web-scene":{write:{overridePolicy(){return{isRequired:this.wkt==null}}}}}}})],_i.prototype,"wkid",void 0),u([d({type:String,json:{origins:{"web-scene":{write:{overridePolicy(){return{isRequired:this.wkid==null}}}}}}})],_i.prototype,"wkt",void 0),u([Fe("wkt"),Fe("web-scene","wkt")],_i.prototype,"writeWkt",null),u([d({type:Xi,json:{write:!0}})],_i.prototype,"vcsWkid",void 0),u([d({type:Xi,json:{write:!0}})],_i.prototype,"latestVcsWkid",void 0),u([d()],_i.prototype,"imageCoordinateSystem",void 0),_i=kp=u([R("esri.geometry.SpatialReference")],_i),_i.prototype.toJSON.isDefaultToJSON=!0,_i.GCS_NAD_1927=new _i({wkid:4267,wkt:'GEOGCS["GCS_North_American_1927",DATUM["D_North_American_1927",SPHEROID["Clarke_1866",6378206.4,294.9786982]],PRIMEM["Greenwich",0.0],UNIT["Degree",0.0174532925199433]]'}),_i.WGS84=new _i(bLe),_i.WebMercator=new _i(wLe),_i.PlateCarree=new _i(xLe),Object.freeze&&(Object.freeze(_i.GCS_NAD_1927),Object.freeze(_i.WGS84),Object.freeze(_i.WebMercator));const je=_i;let Vp=class extends de{constructor(...e){super(...e),this.type=null,this.hasM=!1,this.hasZ=!1,this.spatialReference=je.WGS84}get cache(){return this.commitProperty("spatialReference"),{}}get extent(){return null}readSpatialReference(e,r){if(e instanceof je)return e;if(e!=null){const i=new je;return i.read(e,r),i}return e}clone(){return console.warn(".clone() is not implemented for "+this.declaredClass),null}clearCache(){this.notifyChange("cache")}getCacheValue(e){return this.cache[e]}setCacheValue(e,r){this.cache[e]=r}};u([d()],Vp.prototype,"type",void 0),u([d({readOnly:!0})],Vp.prototype,"cache",null),u([d({readOnly:!0})],Vp.prototype,"extent",null),u([d({type:Boolean,json:{write:{overridePolicy:t=>({enabled:t})}}})],Vp.prototype,"hasM",void 0),u([d({type:Boolean,json:{write:{overridePolicy:t=>({enabled:t})}}})],Vp.prototype,"hasZ",void 0),u([d({type:je,json:{write:!0},value:je.WGS84})],Vp.prototype,"spatialReference",void 0),u([Ee("spatialReference")],Vp.prototype,"readSpatialReference",null),Vp=u([R("esri.geometry.Geometry")],Vp);const q_=Vp;function GLe(t,e){const r=t.x-e.x,i=t.y-e.y,s=t.hasZ&&e.hasZ?t.z-e.z:0;return Math.sqrt(r*r+i*i+s*s)}const jLe=57.29577951308232,HLe=.017453292519943;function nK(t){return t*jLe}function oK(t){return t*HLe}function aK(t){return t/nr.radius}function QD(t){return Math.PI/2-2*Math.atan(Math.exp(-t/nr.radius))}function _V(t){return t.wkid!=null||t.wkt!=null}const J6=[0,0];function KD(t,e,r,i,s){const n=t,o=s;if(o.spatialReference=r,"x"in n&&"x"in o)[o.x,o.y]=e(n.x,n.y,J6,i);else if("xmin"in n&&"xmin"in o)[o.xmin,o.ymin]=e(n.xmin,n.ymin,J6,i),[o.xmax,o.ymax]=e(n.xmax,n.ymax,J6,i);else if("paths"in n&&"paths"in o||"rings"in n&&"rings"in o){const a="paths"in n?n.paths:n.rings,l=[];let c;for(let h=0;h<a.length;h++){const p=a[h];c=[],l.push(c);for(let f=0;f<p.length;f++)c.push(e(p[f][0],p[f][1],[0,0],i)),p[f].length>2&&c[f].push(p[f][2]),p[f].length>3&&c[f].push(p[f][3])}"paths"in o?o.paths=l:o.rings=l}else if("points"in n&&"points"in o){const a=n.points,l=[];for(let c=0;c<a.length;c++)l[c]=e(a[c][0],a[c][1],[0,0],i),a[c].length>2&&l[c].push(a[c][2]),a[c].length>3&&l[c].push(a[c][3]);o.points=l}return s}function p_(t,e){const r=t&&(_V(t)?t:t.spatialReference),i=e&&(_V(e)?e:e.spatialReference);return!(t&&"type"in t&&t.type==="mesh"||e&&"type"in e&&e.type==="mesh"||!r||!i)&&(!!Rn(i,r)||Gb(i)&&vO(r)||Gb(r)&&vO(i))}function Sw(t,e){if(t==null)return null;const r=t.spatialReference,i=e&&(_V(e)?e:e.spatialReference);return p_(r,i)?Rn(r,i)?K(t):Gb(i)?KD(t,KT,je.WebMercator,!1,K(t)):vO(i)?KD(t,x3,je.WGS84,!1,K(t)):null:null}function KT(t,e,r=[0,0]){e>89.99999?e=89.99999:e<-89.99999&&(e=-89.99999);const i=oK(e);return r[0]=oK(t)*nr.radius,r[1]=nr.halfSemiMajorAxis*Math.log((1+Math.sin(i))/(1-Math.sin(i))),r}function x3(t,e,r=[0,0],i=!1){const s=nK(t/nr.radius);return r[0]=i?s:s-360*Math.floor((s+180)/360),r[1]=nK(Math.PI/2-2*Math.atan(Math.exp(-e/nr.radius))),r}function T3(t,e=!1,r=K(t)){return KD(t,KT,je.WebMercator,e,r)}function zC(t,e=!1,r=K(t)){return KD(t,x3,je.WGS84,e,r)}var U$;const DE=[0,0];function lK(t){return t&&(t.declaredClass==="esri.geometry.SpatialReference"||t.wkid!=null)}let ol=U$=class extends q_{static copy(t,e){e._set("x",t._get("x")),e._set("y",t._get("y")),e._set("z",t._get("z")),e._set("m",t._get("m"));const r=t._get("spatialReference");e._set("spatialReference",Object.isFrozen(r)?r:r.clone())}constructor(...t){super(...t),this.x=0,this.y=0,this.z=void 0,this.m=void 0,this.type="point"}normalizeCtorArgs(t,e,r,i,s){let n;if(Array.isArray(t))n=t,s=e,t=n[0],e=n[1],r=n[2],i=n[3];else if(t&&typeof t=="object"){if(n=t,t=n.x!=null?n.x:n.longitude,e=n.y!=null?n.y:n.latitude,r=n.z,i=n.m,(s=n.spatialReference)&&s.declaredClass!=="esri.geometry.SpatialReference"&&(s=new je(s)),n.longitude!=null||n.latitude!=null){if(n.longitude==null)Q.getLogger(this).warn(".longitude=","Latitude was defined without longitude");else if(n.latitude==null)Q.getLogger(this).warn(".latitude=","Longitude was defined without latitude");else if(!n.declaredClass&&s&&s.isWebMercator){const a=KT(n.longitude,n.latitude,DE);t=a[0],e=a[1]}}}else lK(r)?(s=r,r=null):lK(i)&&(s=i,i=null);const o={x:t,y:e};return o.x==null&&o.y!=null?Q.getLogger(this).warn(".y=","Y coordinate was defined without an X coordinate"):o.y==null&&o.x!=null&&Q.getLogger(this).warn(".x=","X coordinate was defined without a Y coordinate"),s!=null&&(o.spatialReference=s),r!=null&&(o.z=r),i!=null&&(o.m=i),o}get cache(){return this.commitProperty("x"),this.commitProperty("y"),this.commitProperty("z"),this.commitProperty("m"),this.commitProperty("spatialReference"),{}}get hasM(){return this.m!==void 0}set hasM(t){t!==(this._get("m")!==void 0)&&(this._set("m",t?0:void 0),this._set("hasM",t))}get hasZ(){return this.z!==void 0}set hasZ(t){t!==(this._get("z")!==void 0)&&(this._set("z",t?0:void 0),this._set("hasZ",t))}get latitude(){const{spatialReference:t,x:e,y:r}=this;if(t){if(t.isWebMercator)return x3(e,r,DE)[1];if(t.isGeographic)return r}return null}set latitude(t){const{spatialReference:e,x:r}=this;t!=null&&e&&(e.isWebMercator?this._set("y",KT(r,t,DE)[1]):e.isGeographic&&this._set("y",t),this._set("latitude",t))}get longitude(){const{x:t,y:e,spatialReference:r}=this;if(r){if(r.isWebMercator)return x3(t,e,DE)[0];if(r.isGeographic)return t}return null}set longitude(t){const{y:e,spatialReference:r}=this;t!=null&&r&&(r.isWebMercator?this._set("x",KT(t,e,DE)[0]):r.isGeographic&&this._set("x",t),this._set("longitude",t))}writeX(t,e,r){e[r]=isNaN(t)?"NaN":t}readX(t){return typeof t=="string"?NaN:t}clone(){const t=new U$;return t.x=this.x,t.y=this.y,t.z=this.z,t.m=this.m,t.spatialReference=this.spatialReference,t}copy(t){return U$.copy(t,this),this}equals(t){if(t==null)return!1;const{x:e,y:r,z:i,m:s,spatialReference:n}=this,{z:o,m:a}=t;let{x:l,y:c,spatialReference:h}=t;if(!n.equals(h))if(n.isWebMercator&&h.isWGS84)[l,c]=KT(l,c),h=n;else{if(!n.isWGS84||!h.isWebMercator)return!1;[l,c]=x3(l,c),h=n}return e===l&&r===c&&i===o&&s===a&&n.wkid===h.wkid}offset(t,e,r){return this.x+=t,this.y+=e,r!=null&&(this.z=(this.z??0)+r),this}normalize(){if(!this.spatialReference)return this;const t=d_(this.spatialReference);if(!t)return this;let e=this.x;const[r,i]=t.valid,s=2*i;let n;return e>i?(n=Math.ceil(Math.abs(e-i)/s),e-=n*s):e<r&&(n=Math.ceil(Math.abs(e-r)/s),e+=n*s),this._set("x",e),this}distance(t){return GLe(this,t)}toArray(){const t=this.hasZ,e=this.hasM;return t&&e?[this.x,this.y,this.z,this.m]:t?[this.x,this.y,this.z]:e?[this.x,this.y,this.m]:[this.x,this.y]}toJSON(t){return this.write({},t)}};u([d({readOnly:!0})],ol.prototype,"cache",null),u([d({type:Boolean,json:{read:!1,write:{enabled:!1,overridePolicy:null}}})],ol.prototype,"hasM",null),u([d({type:Boolean,json:{read:!1,write:{enabled:!1,overridePolicy:null}}})],ol.prototype,"hasZ",null),u([d({type:Number})],ol.prototype,"latitude",null),u([d({type:Number})],ol.prototype,"longitude",null),u([d({type:Number,json:{type:[Number,String],write:{isRequired:!0,allowNull:!0}}}),yr(t=>isNaN(t)?t:sh(t))],ol.prototype,"x",void 0),u([Fe("x")],ol.prototype,"writeX",null),u([Ee("x")],ol.prototype,"readX",null),u([d({type:Number,json:{write:!0}})],ol.prototype,"y",void 0),u([d({type:Number,json:{write:{overridePolicy(){return{enabled:this.hasZ}}}}})],ol.prototype,"z",void 0),u([d({type:Number,json:{write:{overridePolicy(){return{enabled:this.hasM}}}}})],ol.prototype,"m",void 0),ol=U$=u([R("esri.geometry.Point")],ol),ol.prototype.toJSON.isDefaultToJSON=!0;const pt=ol,Q6=[0,0];function Jq(t,e){return e!=null&&$a(t,e.x,e.y,e.z)}function xSt(t,e){if(!e.points||e.points.length)return!1;for(const r of e.points)if(!e2(t,r))return!1;return!0}function qLe(t,e){const{xmin:r,ymin:i,zmin:s,xmax:n,ymax:o,zmax:a}=e;return t.hasZ&&e.hasZ?$a(t,r,i,s)&&$a(t,r,o,s)&&$a(t,n,o,s)&&$a(t,n,i,s)&&$a(t,r,i,a)&&$a(t,r,o,a)&&$a(t,n,o,a)&&$a(t,n,i,a):$a(t,r,i)&&$a(t,r,o)&&$a(t,n,o)&&$a(t,n,i)}function e2(t,e){return $a(t,e[0],e[1])}function WLe(t,e){return $a(t,e[0],e[1],e[2])}function $a(t,e,r,i){return e>=t.xmin&&e<=t.xmax&&r>=t.ymin&&r<=t.ymax&&(i==null||!t.hasZ||i>=t.zmin&&i<=t.zmax)}function ZLe(t,e){return Q6[1]=e.y,Q6[0]=e.x,XLe(t,Q6)}function XLe(t,e){return ofe(t.rings,e)}function ofe(t,e){if(!t)return!1;if(YLe(t))return cK(!1,t,e);let r=!1;for(let i=0,s=t.length;i<s;i++)r=cK(r,t[i],e);return r}function YLe(t){return!Array.isArray(t[0][0])}function cK(t,e,r){const[i,s]=r;let n=t,o=0;for(let a=0,l=e.length;a<l;a++){o++,o===l&&(o=0);const[c,h]=e[a],[p,f]=e[o];(h<s&&f>=s||f<s&&h>=s)&&c+(s-h)/(f-h)*(p-c)<i&&(n=!n)}return n}function JLe(t,e){return Jq(t,e)}function QLe(t,e){const r=t.hasZ&&e.hasZ;let i,s,n;if(t.xmin<=e.xmin){if(i=e.xmin,t.xmax<i)return!1}else if(i=t.xmin,e.xmax<i)return!1;if(t.ymin<=e.ymin){if(s=e.ymin,t.ymax<s)return!1}else if(s=t.ymin,e.ymax<s)return!1;if(r&&e.hasZ){if(t.zmin<=e.zmin){if(n=e.zmin,t.zmax<n)return!1}else if(n=t.zmin,e.zmax<n)return!1}return!0}function KLe(t,e){const{points:r,hasZ:i}=e,s=i?WLe:e2;for(const n of r)if(s(t,n))return!0;return!1}const jb=[0,0],Hb=[0,0],qb=[0,0],Wb=[0,0],eDe=[jb,Hb,qb,Wb],afe=[[qb,jb],[jb,Hb],[Hb,Wb],[Wb,qb]];function tDe(t,e){return rDe(t,e.rings)}function rDe(t,e){jb[0]=t.xmin,jb[1]=t.ymax,Hb[0]=t.xmax,Hb[1]=t.ymax,qb[0]=t.xmin,qb[1]=t.ymin,Wb[0]=t.xmax,Wb[1]=t.ymin;for(const r of eDe)if(ofe(e,r))return!0;for(const r of e){if(!r.length)continue;let i=r[0];if(e2(t,i))return!0;for(let s=1;s<r.length;s++){const n=r[s];if(e2(t,n)||lfe(i,n,afe))return!0;i=n}}return!1}function iDe(t,e){jb[0]=t.xmin,jb[1]=t.ymax,Hb[0]=t.xmax,Hb[1]=t.ymax,qb[0]=t.xmin,qb[1]=t.ymin,Wb[0]=t.xmax,Wb[1]=t.ymin;const r=e.paths;for(const i of r){if(!r.length)continue;let s=i[0];if(e2(t,s))return!0;for(let n=1;n<i.length;n++){const o=i[n];if(e2(t,o)||lfe(s,o,afe))return!0;s=o}}return!1}const Eo=[0,0];function sDe(t){for(let e=0;e<t.length;e++){const r=t[e];for(let s=0;s<r.length-1;s++){const n=r[s],o=r[s+1];for(let a=e+1;a<t.length;a++)for(let l=0;l<t[a].length-1;l++){const c=t[a][l],h=t[a][l+1];if(vV(n,o,c,h,Eo)&&!(Eo[0]===n[0]&&Eo[1]===n[1]||Eo[0]===c[0]&&Eo[1]===c[1]||Eo[0]===o[0]&&Eo[1]===o[1]||Eo[0]===h[0]&&Eo[1]===h[1]))return!0}}const i=r.length;if(!(i<=4))for(let s=0;s<i-3;s++){let n=i-1;s===0&&(n=i-2);const o=r[s],a=r[s+1];for(let l=s+2;l<n;l++){const c=r[l],h=r[l+1];if(vV(o,a,c,h,Eo)&&!(Eo[0]===o[0]&&Eo[1]===o[1]||Eo[0]===c[0]&&Eo[1]===c[1]||Eo[0]===a[0]&&Eo[1]===a[1]||Eo[0]===h[0]&&Eo[1]===h[1]))return!0}}}return!1}function lfe(t,e,r){for(let i=0;i<r.length;i++)if(vV(t,e,r[i][0],r[i][1]))return!0;return!1}function vV(t,e,r,i,s){const[n,o]=t,[a,l]=e,[c,h]=r,[p,f]=i,m=p-c,y=n-c,_=a-n,v=f-h,w=o-h,x=l-o,T=v*_-m*x;if(T===0)return!1;const S=(m*w-v*y)/T,O=(_*w-x*y)/T;return S>=0&&S<=1&&O>=0&&O<=1&&(s&&(s[0]=n+S*(a-n),s[1]=o+S*(l-o)),!0)}function nDe(t){switch(t){case"esriGeometryEnvelope":case"extent":return QLe;case"esriGeometryMultipoint":case"multipoint":return KLe;case"esriGeometryPoint":case"point":return JLe;case"esriGeometryPolygon":case"polygon":return tDe;case"esriGeometryPolyline":case"polyline":return iDe}}var Du;function oDe(t){return t&&(t.declaredClass==="esri.geometry.SpatialReference"||t.wkid!=null)}function my(t,e,r){return e==null?r:r==null?e:t(e,r)}let so=Du=class extends q_{constructor(...t){super(...t),this.type="extent",this.xmin=0,this.ymin=0,this.mmin=void 0,this.zmin=void 0,this.xmax=0,this.ymax=0,this.mmax=void 0,this.zmax=void 0}normalizeCtorArgs(t,e,r,i,s){return oDe(t)?{spatialReference:t,xmin:0,ymin:0,xmax:0,ymax:0}:typeof t=="object"?(t.spatialReference=t.spatialReference==null?je.WGS84:t.spatialReference,t):{xmin:t,ymin:e,xmax:r,ymax:i,spatialReference:s??je.WGS84}}static fromBounds(t,e){return new Du({xmin:t[0],ymin:t[1],xmax:t[2],ymax:t[3],spatialReference:e})}static fromPoint(t){return new Du({xmin:t.x,ymin:t.y,zmin:t.z,xmax:t.x,ymax:t.y,zmax:t.z,spatialReference:t.spatialReference})}get cache(){return this.commitProperty("xmin"),this.commitProperty("ymin"),this.commitProperty("zmin"),this.commitProperty("mmin"),this.commitProperty("xmax"),this.commitProperty("ymax"),this.commitProperty("zmax"),this.commitProperty("mmax"),this.commitProperty("spatialReference"),{}}get center(){const t=new pt({x:.5*(this.xmin+this.xmax),y:.5*(this.ymin+this.ymax),spatialReference:this.spatialReference});return this.hasZ&&(t.z=.5*(this.zmin+this.zmax)),this.hasM&&(t.m=.5*(this.mmin+this.mmax)),t}get extent(){return this.clone()}get hasM(){return this.mmin!=null&&this.mmax!=null}get hasZ(){return this.zmin!=null&&this.zmax!=null}get height(){return Math.abs(this.ymax-this.ymin)}get width(){return Math.abs(this.xmax-this.xmin)}centerAt(t){const e=this.center;return t.z!=null&&this.hasZ?this.offset(t.x-e.x,t.y-e.y,t.z-e.z):this.offset(t.x-e.x,t.y-e.y)}clone(){const t=new Du;return t.xmin=this.xmin,t.ymin=this.ymin,t.xmax=this.xmax,t.ymax=this.ymax,t.spatialReference=this.spatialReference,this.zmin!=null&&(t.zmin=this.zmin,t.zmax=this.zmax),this.mmin!=null&&(t.mmin=this.mmin,t.mmax=this.mmax),t}contains(t){if(!t)return!1;const e=this.spatialReference,r=t.spatialReference;return e&&r&&!e.equals(r)&&p_(e,r)&&(t=e.isWebMercator?T3(t):zC(t,!0)),t.type==="point"?Jq(this,t):t.type==="extent"&&qLe(this,t)}equals(t){if(this===t)return!0;if(t==null)return!1;const e=this.spatialReference,r=t.spatialReference;return e&&r&&!e.equals(r)&&p_(e,r)&&(t=e.isWebMercator?T3(t):zC(t,!0)),this.xmin===t.xmin&&this.ymin===t.ymin&&this.zmin===t.zmin&&this.mmin===t.mmin&&this.xmax===t.xmax&&this.ymax===t.ymax&&this.zmax===t.zmax&&this.mmax===t.mmax}expand(t){const e=.5*(1-t),r=this.width*e,i=this.height*e;if(this.xmin+=r,this.ymin+=i,this.xmax-=r,this.ymax-=i,this.hasZ){const s=(this.zmax-this.zmin)*e;this.zmin+=s,this.zmax-=s}if(this.hasM){const s=(this.mmax-this.mmin)*e;this.mmin+=s,this.mmax-=s}return this}intersects(t){if(t==null)return!1;t.type==="mesh"&&(t=t.extent);const e=this.spatialReference,r=t.spatialReference;return e&&r&&!Rn(e,r)&&p_(e,r)&&(t=e.isWebMercator?T3(t):zC(t,!0)),nDe(t.type)(this,t)}normalize(){const t=this._normalize(!1,!0);return Array.isArray(t)?t:[t]}offset(t,e,r){return this.xmin+=t,this.ymin+=e,this.xmax+=t,this.ymax+=e,r!=null&&(this.zmin+=r,this.zmax+=r),this}shiftCentralMeridian(){return this._normalize(!0)}union(t){return this===t||(this.xmin=Math.min(this.xmin,t.xmin),this.ymin=Math.min(this.ymin,t.ymin),this.xmax=Math.max(this.xmax,t.xmax),this.ymax=Math.max(this.ymax,t.ymax),(this.hasZ||t.hasZ)&&(this.zmin=my(Math.min,this.zmin,t.zmin),this.zmax=my(Math.max,this.zmax,t.zmax)),(this.hasM||t.hasM)&&(this.mmin=my(Math.min,this.mmin,t.mmin),this.mmax=my(Math.max,this.mmax,t.mmax))),this}intersection(t){return this===t?this:t!=null&&this.intersects(t)?(this.xmin=Math.max(this.xmin,t.xmin),this.ymin=Math.max(this.ymin,t.ymin),this.xmax=Math.min(this.xmax,t.xmax),this.ymax=Math.min(this.ymax,t.ymax),(this.hasZ||t.hasZ)&&(this.zmin=my(Math.max,this.zmin,t.zmin),this.zmax=my(Math.min,this.zmax,t.zmax)),(this.hasM||t.hasM)&&(this.mmin=my(Math.max,this.mmin,t.mmin),this.mmax=my(Math.min,this.mmax,t.mmax)),this):null}toJSON(t){return this.write({},t)}_shiftCM(t=d_(this.spatialReference)){if(!t||!this.spatialReference)return this;const e=this.spatialReference,r=this._getCM(t);if(r){const i=e.isWebMercator?zC(r):r;this.xmin-=r.x,this.xmax-=r.x,e.isWebMercator||(i.x=this._normalizeX(i.x,t).x),this.spatialReference=new je(_F((e.isWGS84?t.altTemplate:null)??t.wkTemplate,{Central_Meridian:i.x}))}return this}_getCM(t){let e=null;const[r,i]=t.valid,s=this.xmin,n=this.xmax;return s>=r&&s<=i&&n>=r&&n<=i||(e=this.center),e}_normalize(t,e,r){const i=this.spatialReference;if(!i)return this;const s=r??d_(i);if(s==null)return this;const n=this._getParts(s).map(l=>l.extent);if(n.length<2)return n[0]||this;if(n.length>2)return t?this._shiftCM(s):this.set({xmin:s.valid[0],xmax:s.valid[1]});if(t)return this._shiftCM(s);if(e)return n;let o=!0,a=!0;return n.forEach(l=>{l.hasZ||(o=!1),l.hasM||(a=!1)}),{rings:n.map(l=>{const c=[[l.xmin,l.ymin],[l.xmin,l.ymax],[l.xmax,l.ymax],[l.xmax,l.ymin],[l.xmin,l.ymin]];if(o){const h=(l.zmax-l.zmin)/2;for(let p=0;p<c.length;p++)c[p].push(h)}if(a){const h=(l.mmax-l.mmin)/2;for(let p=0;p<c.length;p++)c[p].push(h)}return c}),hasZ:o,hasM:a,spatialReference:i}}_getParts(t){let e=this.cache._parts;if(!e){e=[];const{ymin:s,ymax:n,spatialReference:o}=this,a=this.width,l=this.xmin,c=this.xmax;let h;t=t||d_(o);const[p,f]=t.valid;h=this._normalizeX(this.xmin,t);const m=h.x,y=h.frameId;h=this._normalizeX(this.xmax,t);const _=h.x,v=h.frameId,w=m===_&&a>0;if(a>2*f){const x=new Du(l<c?m:_,s,f,n,o),T=new Du(p,s,l<c?_:m,n,o),S=new Du(0,s,f,n,o),O=new Du(p,s,0,n,o),A=[],I=[];x.contains(S)&&A.push(y),x.contains(O)&&I.push(y),T.contains(S)&&A.push(v),T.contains(O)&&I.push(v);for(let M=y+1;M<v;M++)A.push(M),I.push(M);e.push({extent:x,frameIds:[y]},{extent:T,frameIds:[v]},{extent:S,frameIds:A},{extent:O,frameIds:I})}else m>_||w?e.push({extent:new Du(m,s,f,n,o),frameIds:[y]},{extent:new Du(p,s,_,n,o),frameIds:[v]}):e.push({extent:new Du(m,s,_,n,o),frameIds:[y]});this.cache._parts=e}const r=this.hasZ,i=this.hasM;if(r||i){const s={};r&&(s.zmin=this.zmin,s.zmax=this.zmax),i&&(s.mmin=this.mmin,s.mmax=this.mmax);for(let n=0;n<e.length;n++)e[n].extent.set(s)}return e}_normalizeX(t,e){const[r,i]=e.valid,s=2*i;let n,o=0;return t>i?(n=Math.ceil(Math.abs(t-i)/s),t-=n*s,o=n):t<r&&(n=Math.ceil(Math.abs(t-r)/s),t+=n*s,o=-n),{x:t,frameId:o}}};u([d({readOnly:!0})],so.prototype,"cache",null),u([d({readOnly:!0})],so.prototype,"center",null),u([d({readOnly:!0})],so.prototype,"extent",null),u([d({readOnly:!0,json:{write:{enabled:!1,overridePolicy:null}}})],so.prototype,"hasM",null),u([d({readOnly:!0,json:{write:{enabled:!1,overridePolicy:null}}})],so.prototype,"hasZ",null),u([d({readOnly:!0})],so.prototype,"height",null),u([d({readOnly:!0})],so.prototype,"width",null),u([d({type:Number,json:{type:[Number,String],write:{enabled:!0,allowNull:!0}}})],so.prototype,"xmin",void 0),u([d({type:Number,json:{write:!0}})],so.prototype,"ymin",void 0),u([d({type:Number,json:{origins:{"web-scene":{write:!1}},write:{overridePolicy(){return{enabled:this.hasM}}}}})],so.prototype,"mmin",void 0),u([d({type:Number,json:{origins:{"web-scene":{write:!1}},write:{overridePolicy(){return{enabled:this.hasZ}}}}})],so.prototype,"zmin",void 0),u([d({type:Number,json:{write:!0}})],so.prototype,"xmax",void 0),u([d({type:Number,json:{write:!0}})],so.prototype,"ymax",void 0),u([d({type:Number,json:{origins:{"web-scene":{write:!1}},write:{overridePolicy(){return{enabled:this.hasM}}}}})],so.prototype,"mmax",void 0),u([d({type:Number,json:{origins:{"web-scene":{write:!1}},write:{overridePolicy(){return{enabled:this.hasZ}}}}})],so.prototype,"zmax",void 0),so=Du=u([R("esri.geometry.Extent")],so),so.prototype.toJSON.isDefaultToJSON=!0;const _r=so;function t2(t,e,r=!1){let{hasM:i,hasZ:s}=t;Array.isArray(e)?e.length!==4||i||s?e.length===3&&r&&!i?(s=!0,i=!1):e.length===3&&i&&s&&(i=!1,s=!1):(i=!0,s=!0):(s=!s&&e.hasZ&&(!i||e.hasM),i=!i&&e.hasM&&(!s||e.hasZ)),t.hasZ=s,t.hasM=i}var bV;function uK(t){return(e,r)=>e==null?r:r==null?e:t(e,r)}function aDe(t){return t&&(t.declaredClass==="esri.geometry.SpatialReference"||t.wkid!=null)}let Xy=bV=class extends q_{constructor(...t){super(...t),this.points=[],this.type="multipoint"}normalizeCtorArgs(t,e){if(!t&&!e)return{};const r={};Array.isArray(t)?(r.points=t,r.spatialReference=e):aDe(t)?r.spatialReference=t:(t.points&&(r.points=t.points),t.spatialReference&&(r.spatialReference=t.spatialReference),t.hasZ&&(r.hasZ=t.hasZ),t.hasM&&(r.hasM=t.hasM));const i=r.points&&r.points[0];return i&&(r.hasZ===void 0&&r.hasM===void 0?(r.hasZ=i.length>2,r.hasM=!1):r.hasZ===void 0?r.hasZ=i.length>3:r.hasM===void 0&&(r.hasM=i.length>3)),r}get cache(){return this.commitProperty("points"),this.commitProperty("hasZ"),this.commitProperty("hasM"),this.commitProperty("spatialReference"),{}}get extent(){const t=this.points;if(!t.length)return null;const e=new _r,r=this.hasZ,i=this.hasM,s=r?3:2,n=t[0],o=uK(Math.min),a=uK(Math.max);let l,c,h,p,[f,m]=n,[y,_]=n;for(let v=0,w=t.length;v<w;v++){const x=t[v],[T,S]=x;if(f=o(f,T),m=o(m,S),y=a(y,T),_=a(_,S),r&&x.length>2){const O=x[2];l=o(l,O),h=a(h,O)}if(i&&x.length>s){const O=x[s];c=o(c,O),p=a(p,O)}}return e.xmin=f,e.ymin=m,e.xmax=y,e.ymax=_,e.spatialReference=this.spatialReference,r?(e.zmin=l,e.zmax=h):(e.zmin=void 0,e.zmax=void 0),i?(e.mmin=c,e.mmax=p):(e.mmin=void 0,e.mmax=void 0),e}writePoints(t,e){e.points=K(this.points)}addPoint(t){return t2(this,t),Array.isArray(t)?this.points.push(t):this.points.push(t.toArray()),this.notifyChange("points"),this}clone(){const t={points:K(this.points),spatialReference:this.spatialReference};return this.hasZ&&(t.hasZ=!0),this.hasM&&(t.hasM=!0),new bV(t)}getPoint(t){if(!this._validateInputs(t))return null;const e=this.points[t],r={x:e[0],y:e[1],spatialReference:this.spatialReference};let i=2;return this.hasZ&&(r.z=e[2],i=3),this.hasM&&(r.m=e[i]),new pt(r)}removePoint(t){if(!this._validateInputs(t))return null;const e=new pt(this.points.splice(t,1)[0],this.spatialReference);return this.notifyChange("points"),e}setPoint(t,e){return this._validateInputs(t)?(t2(this,e),Array.isArray(e)||(e=e.toArray()),this.points[t]=e,this.notifyChange("points"),this):this}toJSON(t){return this.write({},t)}_validateInputs(t){return t!=null&&t>=0&&t<this.points.length}};u([d({readOnly:!0})],Xy.prototype,"cache",null),u([d()],Xy.prototype,"extent",null),u([d({type:[[Number]],json:{write:{isRequired:!0}}})],Xy.prototype,"points",void 0),u([Fe("points")],Xy.prototype,"writePoints",null),Xy=bV=u([R("esri.geometry.Multipoint")],Xy),Xy.prototype.toJSON.isDefaultToJSON=!0;const OR=Xy;function TSt(t){const e=[];for(t.reset();t.nextPath();){const r=[];for(;t.nextPoint();)r.push([t.x,t.y]);e.push(r)}return t.reset(),e}function lDe(t){const e=[];for(;t.nextPoint();)e.push([t.x,t.y]);return t.seekPathStart(),e}function SSt(t){if(!t)return null;if(Array.isArray(t))return t;const e=t.hasZ,r=t.hasM;if(t.type==="point")return r&&e?[t.x,t.y,t.z,t.m]:e?[t.x,t.y,t.z]:r?[t.x,t.y,t.m]:[t.x,t.y];if(t.type==="polygon")return t.rings.slice(0);if(t.type==="polyline")return t.paths.slice(0);if(t.type==="multipoint")return t.points.slice(0);if(t.type==="extent"){const i=t.clone().normalize();if(!i)return null;let s=!1,n=!1;return i.forEach(o=>{o.hasZ&&(s=!0),o.hasM&&(n=!0)}),i.map(o=>{const a=[[o.xmin,o.ymin],[o.xmin,o.ymax],[o.xmax,o.ymax],[o.xmax,o.ymin],[o.xmin,o.ymin]];if(s&&o.hasZ){const l=.5*(o.zmax-o.zmin);for(let c=0;c<a.length;c++)a[c].push(l)}if(n&&o.hasM){const l=.5*(o.mmax-o.mmin);for(let c=0;c<a.length;c++)a[c].push(l)}return a})}return null}function SF(t,e){const r=e[0]-t[0],i=e[1]-t[1];if(t.length>2&&e.length>2){const s=t[2]-e[2];return Math.sqrt(r*r+i*i+s*s)}return Math.sqrt(r*r+i*i)}function cfe(t,e,r){const i=t[0]+r*(e[0]-t[0]),s=t[1]+r*(e[1]-t[1]);return t.length>2&&e.length>2?[i,s,t[2]+r*(e[2]-t[2])]:[i,s]}function ESt(t,e,r,i){const[s,n]=e,[o,a]=r[i],[l,c]=r[i+1],h=l-o,p=c-a,f=h*h+p*p,m=(s-o)*h+(n-a)*p,y=Math.min(1,Math.max(0,m/f));return t[0]=o+h*y,t[1]=a+p*y,t}function CSt(t,e,r){let i,s,n,o,a=!1,l=1/0;for(r.reset();r.nextPath();)if(r.nextPoint())for(i=r.x,s=r.y;r.nextPoint();)n=r.x,o=r.y,s>e!=o>e&&t<(n-i)*(e-s)/(o-s)+i&&(a=!a),l=Math.min(l,cDe(t,e,i,s,n,o)),i=n,s=o;return l===0?0:(a?1:-1)*Math.sqrt(l)}function cDe(t,e,r,i,s,n){let o=r,a=i,l=s-o,c=n-a;if(l!==0||c!==0){const h=((t-o)*l+(e-a)*c)/(l*l+c*c);h>1?(o=s,a=n):h>0&&(o+=l*h,a+=c*h)}return l=t-o,c=e-a,l*l+c*c}function ufe(t,e){return cfe(t,e,.5)}function hfe(t){const e=t.length;let r=0;for(let i=0;i<e-1;++i)r+=SF(t[i],t[i+1]);return r}function dfe(t,e){if(e<=0)return t[0];const r=t.length;let i=0;for(let s=0;s<r-1;++s){const n=SF(t[s],t[s+1]);if(e-i<n){const o=(e-i)/n;return cfe(t[s],t[s+1],o)}i+=n}return t[r-1]}function Qq(t,e,r){const i=t.length;let s=0,n=0,o=0;for(let a=0;a<i;a++){const l=t[a],c=t[(a+1)%i];let h=2;s+=l[0]*c[1]-c[0]*l[1],l.length>2&&c.length>2&&r&&(n+=l[0]*c[2]-c[0]*l[2],h=3),l.length>h&&c.length>h&&e&&(o+=l[0]*c[h]-c[0]*l[h])}return s<=0&&n<=0&&o<=0}function uDe(t){const e=t.length;return e>2&&Pg(t[0],t[e-1])}function ASt(t){if("rings"in t&&(hDe(t),t.rings.length>0&&!Qq(t.rings[0],t.hasM??!1,t.hasZ??!1)))for(const e of t.rings)e.reverse()}function hDe(t){if("rings"in t)for(const e of t.rings)uDe(e)||e.push(e[0].slice())}function OSt(t){return t.type!=="polygon"&&t.type!=="polyline"||dDe(t.type==="polygon"?t.rings:t.paths,t.spatialReference),t}function dDe(t,e){const r=d_(e);if(!r)return;const i=r.valid[0],s=r.valid[1],n=s-i;for(const o of t){let a=1/0,l=-1/0;for(const h of o){const p=pDe(h[0],i,s);a=Math.min(a,p),l=Math.max(l,p),h[0]=p}const c=l-a;n-c<c&&o.forEach(h=>{h[0]<0&&(h[0]+=n)})}}function pDe(t,e,r){const i=r-e;return t<e?r-(e-t)%i:t>r?e+(t-e)%i:t}function RSt(t){if(!t||t.length<3)return 0;let e=0;const r=t.length-1;for(let i=0;i<r;i++)e+=(t[i][0]-t[i+1][0])*(t[i][1]+t[i+1][1]);return e+=(t[r][0]-t[0][0])*(t[r][1]+t[0][1]),-.5*e}function pfe(t){if(!t||t.numPoints<3)return 0;let e,r,i=0;if(t.seekPathStart(),!t.nextPoint())return 0;e=t.x,r=t.y;const s=e,n=r;for(;t.nextPoint();)i+=(e-t.x)*(r+t.y),e=t.x,r=t.y;return i+=(e-s)*(r+n),-.5*i}function PSt(t,e){if(t===e)return!0;if(t.type!==e.type)return!1;if(t.type==="point"||t.type==="mesh"||t.type==="extent")return!0;if(t.type==="multipoint")return t.points.length===e.points.length;const[r,i]=t.type==="polyline"?[t.paths,e.paths]:[t.rings,e.rings];return r.length===i.length&&r.every((s,n)=>s.length===i[n].length)}function MSt(t){return t?t.hasZ?[t.xmax-t.xmin/2,t.ymax-t.ymin/2,t.zmax-t.zmin/2]:[t.xmax-t.xmin/2,t.ymax-t.ymin/2]:null}function fDe(t){return t?ffe(t.rings,t.hasZ??!1):null}function ffe(t,e){if(!t||!t.length)return null;const r=[],i=[],s=e?[1/0,-1/0,1/0,-1/0,1/0,-1/0]:[1/0,-1/0,1/0,-1/0];for(let n=0,o=t.length;n<o;n++){const a=mfe(t[n],e,s);a&&i.push(a)}if(i.sort((n,o)=>{let a=n[2]-o[2];return a===0&&e&&(a=n[4]-o[4]),a}),i.length&&(r[0]=i[0][0],r[1]=i[0][1],e&&(r[2]=i[0][3]),(r[0]<s[0]||r[0]>s[1]||r[1]<s[2]||r[1]>s[3]||e&&(r[2]<s[4]||r[2]>s[5]))&&(r.length=0)),!r.length){const n=t[0]&&t[0].length?mDe(t[0],e):null;if(!n)return null;r[0]=n[0],r[1]=n[1],e&&n.length>2&&(r[2]=n[2])}return r}function mfe(t,e,r){let i=0,s=0,n=0,o=0,a=0;const l=t.length?t[0][0]:0,c=t.length?t[0][1]:0,h=t.length&&e?t[0][2]:0;for(let f=0;f<t.length;f++){const m=t[f],y=t[(f+1)%t.length],[_,v,w]=m,x=_-l,T=v-c,[S,O,A]=y,I=S-l,M=O-c,k=x*M-I*T;if(o+=k,i+=(x+I)*k,s+=(T+M)*k,e&&m.length>2&&y.length>2){const L=w-h,D=A-h,U=x*D-I*L;n+=(L+D)*U,a+=U}_<r[0]&&(r[0]=_),_>r[1]&&(r[1]=_),v<r[2]&&(r[2]=v),v>r[3]&&(r[3]=v),e&&(w<r[4]&&(r[4]=w),w>r[5]&&(r[5]=w))}if(o>0&&(o*=-1),a>0&&(a*=-1),!o)return null;o*=.5,a*=.5;const p=[i/(6*o)+l,s/(6*o)+c,o];return e&&(r[4]===r[5]||a===0?(p[3]=(r[4]+r[5])/2,p[4]=0):(p[3]=n/(6*a)+h,p[4]=a)),p}function mDe(t,e){const r=e?[0,0,0]:[0,0],i=e?[0,0,0]:[0,0];let s=0,n=0,o=0,a=0;for(let l=0,c=t.length;l<c-1;l++){const h=t[l],p=t[l+1];if(h&&p){r[0]=h[0],r[1]=h[1],i[0]=p[0],i[1]=p[1],e&&h.length>2&&p.length>2&&(r[2]=h[2],i[2]=p[2]);const f=SF(r,i);if(f){s+=f;const m=ufe(h,p);n+=f*m[0],o+=f*m[1],e&&m.length>2&&(a+=f*m[2])}}}return s>0?e?[n/s,o/s,a/s]:[n/s,o/s]:t.length?t[0]:null}function gDe(t){const{hasZ:e,numPaths:r}=t;if(r===0)return null;const i=[],s=[],n=e?[Number.POSITIVE_INFINITY,Number.NEGATIVE_INFINITY,Number.POSITIVE_INFINITY,Number.NEGATIVE_INFINITY,Number.POSITIVE_INFINITY,Number.NEGATIVE_INFINITY]:[Number.POSITIVE_INFINITY,Number.NEGATIVE_INFINITY,Number.POSITIVE_INFINITY,Number.NEGATIVE_INFINITY];for(t.reset();t.nextPath();){const o=mfe(lDe(t),t.hasZ,n);o&&s.push(o)}if(s.sort((o,a)=>{let l=o[2]-a[2];return l===0&&e&&(l=o[4]-a[4]),l}),s.length&&(i[0]=s[0][0],i[1]=s[0][1],e&&(i[2]=s[0][3]),(i[0]<n[0]||i[0]>n[1]||i[1]<n[2]||i[1]>n[3]||e&&(i[2]<n[4]||i[2]>n[5]))&&(i.length=0)),!i.length){t.reset(),t.nextPath();const o=t.numPoints?yDe(t):null;if(!o)return null;i[0]=o[0],i[1]=o[1],e&&o.length>2&&(i[2]=o[2])}return i}function yDe(t){const{hasZ:e}=t,r=e?[0,0,0]:[0,0],i=e?[0,0,0]:[0,0];let s=0,n=0,o=0,a=0;if(t.nextPoint()){let l=t.x,c=t.y,h=t.z;for(;t.nextPoint();){const p=t.x,f=t.y,m=t.z;r[0]=l,r[1]=c,i[0]=p,i[1]=f,e&&(r[2]=h,i[2]=m);const y=SF(r,i);if(y){s+=y;const _=ufe(r,i);n+=y*_[0],o+=y*_[1],e&&_.length>2&&(a+=y*_[2])}l=p,c=f,h=m}}return s>0?e?[n/s,o/s,a/s]:[n/s,o/s]:t.numPoints?(t.seekPathStart(),t.nextPoint(),[t.x,t.y]):null}const _De=1e-6;function ISt(t){let e=0;for(t.reset();t.nextPath();)e+=pfe(t);if(e<_De){const s=gDe(t);return s?[s[0],s[1]]:null}const r=[0,0];if(t.reset(),!t.nextPath()||!t.nextPoint())return null;const i=[t.x,t.y];for(t.reset();t.nextPath();)bDe(r,i,t);return r[0]*=1/e,r[1]*=1/e,r[0]+=i[0],r[1]+=i[1],r}const vDe=1/3;function bDe(t,e,r){if(!t||!r||r.numPoints<3)return null;r.nextPoint();const i=r.x,s=r.y;r.nextPoint();let n,o=r.x-i,a=r.y-s,l=0,c=0;for(;r.nextPoint();)l=r.x-i,c=r.y-s,n=.5*vDe*(l*a-c*o),t[0]+=n*(o+l),t[1]+=n*(a+c),o=l,a=c;const h=pfe(r),p=[i,s];return p[0]-=e[0],p[1]-=e[1],p[0]*=h,p[1]*=h,t[0]+=p[0],t[1]+=p[1],t}function C(){return[0,0,0]}function $s(t){return[t[0],t[1],t[2]]}function Oe(t,e,r){return[t,e,r]}function Fa(t){const e=C(),r=Math.min(3,t.length);for(let i=0;i<r;++i)e[i]=t[i];return e}function Kq(t,e){return new Float64Array(t,e,3)}function gfe(){return C()}function yfe(){return Oe(1,1,1)}function _fe(){return Oe(1,0,0)}function vfe(){return Oe(0,1,0)}function eW(){return Oe(0,0,1)}const ja=gfe(),fg=yfe(),bfe=_fe(),wfe=vfe(),tW=eW();Object.freeze(Object.defineProperty({__proto__:null,ONES:fg,UNIT_X:bfe,UNIT_Y:wfe,UNIT_Z:tW,ZEROS:ja,clone:$s,create:C,createView:Kq,fromArray:Fa,fromValues:Oe,ones:yfe,unitX:_fe,unitY:vfe,unitZ:eW,zeros:gfe},Symbol.toStringTag,{value:"Module"}));let rW=1e-6;function Xa(){return rW}function wDe(t){rW=t}const RR=Math.random,xDe=Math.PI/180,TDe=180/Math.PI;function EF(t){return t*xDe}function SDe(t){return t*TDe}function EDe(t,e){return Math.abs(t-e)<=rW*Math.max(1,Math.abs(t),Math.abs(e))}Object.freeze(Object.defineProperty({__proto__:null,RANDOM:RR,equals:EDe,getEpsilon:Xa,setEpsilon:wDe,toDegree:SDe,toRadian:EF},Symbol.toStringTag,{value:"Module"}));function Ce(t){const e=t[0],r=t[1],i=t[2];return Math.sqrt(e*e+r*r+i*i)}function ie(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t}function se(t,e,r,i){return t[0]=e,t[1]=r,t[2]=i,t}function ce(t,e,r){return t[0]=e[0]+r[0],t[1]=e[1]+r[1],t[2]=e[2]+r[2],t}function he(t,e,r){return t[0]=e[0]-r[0],t[1]=e[1]-r[1],t[2]=e[2]-r[2],t}function CF(t,e,r){return t[0]=e[0]*r[0],t[1]=e[1]*r[1],t[2]=e[2]*r[2],t}function eN(t,e,r){return t[0]=e[0]/r[0],t[1]=e[1]/r[1],t[2]=e[2]/r[2],t}function CDe(t,e){return t[0]=Math.ceil(e[0]),t[1]=Math.ceil(e[1]),t[2]=Math.ceil(e[2]),t}function xfe(t,e){return t[0]=Math.floor(e[0]),t[1]=Math.floor(e[1]),t[2]=Math.floor(e[2]),t}function tN(t,e){return t[0]=Math.abs(e[0]),t[1]=Math.abs(e[1]),t[2]=Math.abs(e[2]),t}function Tfe(t,e){return t[0]=Math.sign(e[0]),t[1]=Math.sign(e[1]),t[2]=Math.sign(e[2]),t}function iW(t,e,r){return t[0]=Math.min(e[0],r[0]),t[1]=Math.min(e[1],r[1]),t[2]=Math.min(e[2],r[2]),t}function ADe(t,e,r){return t[0]=Math.max(e[0],r[0]),t[1]=Math.max(e[1],r[1]),t[2]=Math.max(e[2],r[2]),t}function ODe(t,e){return t[0]=Math.round(e[0]),t[1]=Math.round(e[1]),t[2]=Math.round(e[2]),t}function te(t,e,r){return t[0]=e[0]*r,t[1]=e[1]*r,t[2]=e[2]*r,t}function hb(t,e,r,i){return t[0]=e[0]+r[0]*i,t[1]=e[1]+r[1]*i,t[2]=e[2]+r[2]*i,t}function di(t,e){const r=e[0]-t[0],i=e[1]-t[1],s=e[2]-t[2];return Math.sqrt(r*r+i*i+s*s)}function yo(t,e){const r=e[0]-t[0],i=e[1]-t[1],s=e[2]-t[2];return r*r+i*i+s*s}function na(t){const e=t[0],r=t[1],i=t[2];return e*e+r*r+i*i}function ca(t,e){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t}function RDe(t,e){return t[0]=1/e[0],t[1]=1/e[1],t[2]=1/e[2],t}function me(t,e){const r=e[0],i=e[1],s=e[2];let n=r*r+i*i+s*s;return n>0&&(n=1/Math.sqrt(n),t[0]=e[0]*n,t[1]=e[1]*n,t[2]=e[2]*n),t}function fe(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]}function at(t,e,r){const i=e[0],s=e[1],n=e[2],o=r[0],a=r[1],l=r[2];return t[0]=s*l-n*a,t[1]=n*o-i*l,t[2]=i*a-s*o,t}function Br(t,e,r,i){const s=e[0],n=e[1],o=e[2];return t[0]=s+i*(r[0]-s),t[1]=n+i*(r[1]-n),t[2]=o+i*(r[2]-o),t}function PDe(t,e,r,i,s,n){const o=n*n,a=o*(2*n-3)+1,l=o*(n-2)+n,c=o*(n-1),h=o*(3-2*n);return t[0]=e[0]*a+r[0]*l+i[0]*c+s[0]*h,t[1]=e[1]*a+r[1]*l+i[1]*c+s[1]*h,t[2]=e[2]*a+r[2]*l+i[2]*c+s[2]*h,t}function MDe(t,e,r,i,s,n){const o=1-n,a=o*o,l=n*n,c=a*o,h=3*n*a,p=3*l*o,f=l*n;return t[0]=e[0]*c+r[0]*h+i[0]*p+s[0]*f,t[1]=e[1]*c+r[1]*h+i[1]*p+s[1]*f,t[2]=e[2]*c+r[2]*h+i[2]*p+s[2]*f,t}function IDe(t,e){e=e||1;const r=RR,i=2*r()*Math.PI,s=2*r()-1,n=Math.sqrt(1-s*s)*e;return t[0]=Math.cos(i)*n,t[1]=Math.sin(i)*n,t[2]=s*e,t}function $e(t,e,r){const i=e[0],s=e[1],n=e[2];return t[0]=r[0]*i+r[4]*s+r[8]*n+r[12],t[1]=r[1]*i+r[5]*s+r[9]*n+r[13],t[2]=r[2]*i+r[6]*s+r[10]*n+r[14],t}function hc(t,e,r){const i=e[0],s=e[1],n=e[2];return t[0]=i*r[0]+s*r[3]+n*r[6],t[1]=i*r[1]+s*r[4]+n*r[7],t[2]=i*r[2]+s*r[5]+n*r[8],t}function yc(t,e,r){const i=r[0],s=r[1],n=r[2],o=r[3],a=e[0],l=e[1],c=e[2];let h=s*c-n*l,p=n*a-i*c,f=i*l-s*a,m=s*f-n*p,y=n*h-i*f,_=i*p-s*h;const v=2*o;return h*=v,p*=v,f*=v,m*=2,y*=2,_*=2,t[0]=a+h+m,t[1]=l+p+y,t[2]=c+f+_,t}function $De(t,e,r,i){const s=[],n=[];return s[0]=e[0]-r[0],s[1]=e[1]-r[1],s[2]=e[2]-r[2],n[0]=s[0],n[1]=s[1]*Math.cos(i)-s[2]*Math.sin(i),n[2]=s[1]*Math.sin(i)+s[2]*Math.cos(i),t[0]=n[0]+r[0],t[1]=n[1]+r[1],t[2]=n[2]+r[2],t}function LDe(t,e,r,i){const s=[],n=[];return s[0]=e[0]-r[0],s[1]=e[1]-r[1],s[2]=e[2]-r[2],n[0]=s[2]*Math.sin(i)+s[0]*Math.cos(i),n[1]=s[1],n[2]=s[2]*Math.cos(i)-s[0]*Math.sin(i),t[0]=n[0]+r[0],t[1]=n[1]+r[1],t[2]=n[2]+r[2],t}function DDe(t,e,r,i){const s=[],n=[];return s[0]=e[0]-r[0],s[1]=e[1]-r[1],s[2]=e[2]-r[2],n[0]=s[0]*Math.cos(i)-s[1]*Math.sin(i),n[1]=s[0]*Math.sin(i)+s[1]*Math.cos(i),n[2]=s[2],t[0]=n[0]+r[0],t[1]=n[1]+r[1],t[2]=n[2]+r[2],t}function Sfe(t,e){ie($P,t),ie(LP,e),me($P,$P),me(LP,LP);const r=fe($P,LP);return r>1?0:r<-1?Math.PI:Math.acos(r)}const $P=C(),LP=C();function NDe(t){return"vec3("+t[0]+", "+t[1]+", "+t[2]+")"}function la(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]}function T_(t,e){if(t===e)return!0;const r=t[0],i=t[1],s=t[2],n=e[0],o=e[1],a=e[2],l=Xa();return Math.abs(r-n)<=l*Math.max(1,Math.abs(r),Math.abs(n))&&Math.abs(i-o)<=l*Math.max(1,Math.abs(i),Math.abs(o))&&Math.abs(s-a)<=l*Math.max(1,Math.abs(s),Math.abs(a))}function Hg(t,e,r){const i=r[0]-e[0],s=r[1]-e[1],n=r[2]-e[2];let o=i*i+s*s+n*n;return o>0?(o=1/Math.sqrt(o),t[0]=i*o,t[1]=s*o,t[2]=n*o,t):(t[0]=0,t[1]=0,t[2]=0,t)}const Cn=he,FDe=CF,UDe=eN,PR=di,AF=yo,Kl=Ce,wV=na,hK=Object.freeze(Object.defineProperty({__proto__:null,abs:tN,add:ce,angle:Sfe,bezier:MDe,ceil:CDe,copy:ie,cross:at,direction:Hg,dist:PR,distance:di,div:UDe,divide:eN,dot:fe,equals:T_,exactEquals:la,floor:xfe,hermite:PDe,inverse:RDe,len:Kl,length:Ce,lerp:Br,max:ADe,min:iW,mul:FDe,multiply:CF,negate:ca,normalize:me,random:IDe,rotateX:$De,rotateY:LDe,rotateZ:DDe,round:ODe,scale:te,scaleAndAdd:hb,set:se,sign:Tfe,sqrDist:AF,sqrLen:wV,squaredDistance:yo,squaredLength:na,str:NDe,sub:Cn,subtract:he,transformMat3:hc,transformMat4:$e,transformQuat:yc},Symbol.toStringTag,{value:"Module"}));function mh(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t}function bi(t,e,r,i,s){return t[0]=e,t[1]=r,t[2]=i,t[3]=s,t}function sW(t,e,r){return t[0]=e[0]+r[0],t[1]=e[1]+r[1],t[2]=e[2]+r[2],t[3]=e[3]+r[3],t}function Efe(t,e,r){return t[0]=e[0]-r[0],t[1]=e[1]-r[1],t[2]=e[2]-r[2],t[3]=e[3]-r[3],t}function Cfe(t,e,r){return t[0]=e[0]*r[0],t[1]=e[1]*r[1],t[2]=e[2]*r[2],t[3]=e[3]*r[3],t}function Afe(t,e,r){return t[0]=e[0]/r[0],t[1]=e[1]/r[1],t[2]=e[2]/r[2],t[3]=e[3]/r[3],t}function kDe(t,e){return t[0]=Math.ceil(e[0]),t[1]=Math.ceil(e[1]),t[2]=Math.ceil(e[2]),t[3]=Math.ceil(e[3]),t}function VDe(t,e){return t[0]=Math.floor(e[0]),t[1]=Math.floor(e[1]),t[2]=Math.floor(e[2]),t[3]=Math.floor(e[3]),t}function zDe(t,e,r){return t[0]=Math.min(e[0],r[0]),t[1]=Math.min(e[1],r[1]),t[2]=Math.min(e[2],r[2]),t[3]=Math.min(e[3],r[3]),t}function BDe(t,e,r){return t[0]=Math.max(e[0],r[0]),t[1]=Math.max(e[1],r[1]),t[2]=Math.max(e[2],r[2]),t[3]=Math.max(e[3],r[3]),t}function GDe(t,e){return t[0]=Math.round(e[0]),t[1]=Math.round(e[1]),t[2]=Math.round(e[2]),t[3]=Math.round(e[3]),t}function Zb(t,e,r){return t[0]=e[0]*r,t[1]=e[1]*r,t[2]=e[2]*r,t[3]=e[3]*r,t}function jDe(t,e,r,i){return t[0]=e[0]+r[0]*i,t[1]=e[1]+r[1]*i,t[2]=e[2]+r[2]*i,t[3]=e[3]+r[3]*i,t}function Ofe(t,e){const r=e[0]-t[0],i=e[1]-t[1],s=e[2]-t[2],n=e[3]-t[3];return Math.sqrt(r*r+i*i+s*s+n*n)}function rN(t,e){const r=e[0]-t[0],i=e[1]-t[1],s=e[2]-t[2],n=e[3]-t[3];return r*r+i*i+s*s+n*n}function nW(t){const e=t[0],r=t[1],i=t[2],s=t[3];return Math.sqrt(e*e+r*r+i*i+s*s)}function oW(t){const e=t[0],r=t[1],i=t[2],s=t[3];return e*e+r*r+i*i+s*s}function HDe(t,e){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t[3]=-e[3],t}function qDe(t,e){return t[0]=1/e[0],t[1]=1/e[1],t[2]=1/e[2],t[3]=1/e[3],t}function Rfe(t,e){const r=e[0],i=e[1],s=e[2],n=e[3];let o=r*r+i*i+s*s+n*n;return o>0&&(o=1/Math.sqrt(o),t[0]=r*o,t[1]=i*o,t[2]=s*o,t[3]=n*o),t}function Pfe(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]+t[3]*e[3]}function OF(t,e,r,i){const s=e[0],n=e[1],o=e[2],a=e[3];return t[0]=s+i*(r[0]-s),t[1]=n+i*(r[1]-n),t[2]=o+i*(r[2]-o),t[3]=a+i*(r[3]-a),t}function WDe(t,e){const r=RR;let i,s,n,o,a,l;e=e||1;do i=2*r()-1,s=2*r()-1,a=i*i+s*s;while(a>=1);do n=2*r()-1,o=2*r()-1,l=n*n+o*o;while(l>=1);const c=Math.sqrt((1-a)/l);return t[0]=e*i,t[1]=e*s,t[2]=e*n*c,t[3]=e*o*c,t}function su(t,e,r){const i=e[0],s=e[1],n=e[2],o=e[3];return t[0]=r[0]*i+r[4]*s+r[8]*n+r[12]*o,t[1]=r[1]*i+r[5]*s+r[9]*n+r[13]*o,t[2]=r[2]*i+r[6]*s+r[10]*n+r[14]*o,t[3]=r[3]*i+r[7]*s+r[11]*n+r[15]*o,t}function ZDe(t,e,r){const i=e[0],s=e[1],n=e[2],o=r[0],a=r[1],l=r[2],c=r[3],h=c*i+a*n-l*s,p=c*s+l*i-o*n,f=c*n+o*s-a*i,m=-o*i-a*s-l*n;return t[0]=h*c+m*-o+p*-l-f*-a,t[1]=p*c+m*-a+f*-o-h*-l,t[2]=f*c+m*-l+h*-a-p*-o,t[3]=e[3],t}function XDe(t){return"vec4("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+")"}function wS(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]}function iN(t,e){const r=t[0],i=t[1],s=t[2],n=t[3],o=e[0],a=e[1],l=e[2],c=e[3],h=Xa();return Math.abs(r-o)<=h*Math.max(1,Math.abs(r),Math.abs(o))&&Math.abs(i-a)<=h*Math.max(1,Math.abs(i),Math.abs(a))&&Math.abs(s-l)<=h*Math.max(1,Math.abs(s),Math.abs(l))&&Math.abs(n-c)<=h*Math.max(1,Math.abs(n),Math.abs(c))}const YDe=Efe,JDe=Cfe,QDe=Afe,KDe=Ofe,eNe=rN,tNe=nW,rNe=oW,Mfe=Object.freeze(Object.defineProperty({__proto__:null,add:sW,ceil:kDe,copy:mh,dist:KDe,distance:Ofe,div:QDe,divide:Afe,dot:Pfe,equals:iN,exactEquals:wS,floor:VDe,inverse:qDe,len:tNe,length:nW,lerp:OF,max:BDe,min:zDe,mul:JDe,multiply:Cfe,negate:HDe,normalize:Rfe,random:WDe,round:GDe,scale:Zb,scaleAndAdd:jDe,set:bi,sqrDist:eNe,sqrLen:rNe,squaredDistance:rN,squaredLength:oW,str:XDe,sub:YDe,subtract:Efe,transformMat4:su,transformQuat:ZDe},Symbol.toStringTag,{value:"Module"})),dK=new Float32Array(1);function iNe(t){--t;for(let e=1;e<32;e<<=1)t|=t>>e;return t+1}function ge(t,e,r){return Math.min(Math.max(t,e),r)}function Xb(t){return(t&t-1)==0}function $St(t){return t--,t|=t>>1,t|=t>>2,t|=t>>4,t|=t>>8,t|=t>>16,++t}function LSt(t){return 10**Math.ceil(Math.LOG10E*Math.log(t))}function wt(t,e,r){return t+(e-t)*r}function Dt(t){return t*Math.PI/180}function qa(t){return 180*t/Math.PI}function xV(t,e=1e-6){return(t<0?-1:1)/Math.max(Math.abs(t),e)}function Pn(t){return Math.acos(ge(t,-1,1))}function Ch(t){return Math.asin(ge(t,-1,1))}function xS(t,e,r=1e-6){return t===e?!0:!Number.isFinite(t)||!Number.isFinite(e)?!1:(t>e?t-e:e-t)<=r}const sN=new DataView(new ArrayBuffer(Float64Array.BYTES_PER_ELEMENT));function TV(t){return sN.setFloat64(0,t),sN.getBigInt64(0)}function sNe(t){return sN.setBigInt64(0,t),sN.getFloat64(0)}const k$=BigInt("1000000"),nNe=Ife(1);function Ife(t){const e=TV(t=Math.abs(t)),r=sNe(e<=k$?k$:e-k$);return Math.abs(t-r)}function DSt(t,e,r=nNe){if(t===e)return!0;if(!Number.isFinite(t)||!Number.isFinite(e))return!1;if(r!=null&&Ife(Math.min(Math.abs(t),Math.abs(e)))<r)return Math.abs(t-e)<=r;const i=TV(t),s=TV(e);return i<0!=s<0?!1:!((i<s?s-i:i-s)>k$)}function oNe(t,e,r=1e-6){if(t===e)return!0;if(!Number.isFinite(t)||!Number.isFinite(e))return!1;const i=Math.abs(t-e),s=Math.abs(t),n=Math.abs(e);if(t===0||e===0||s<1e-12&&n<1e-12){if(i>.01*r)return!1}else if(i/(s+n)>r)return!1;return!0}function aNe(t){return $fe(Math.max(-SV,Math.min(t,SV)))}function $fe(t){return dK[0]=t,dK[0]}function TO(t,e,r){const i=ge((r-t)/(e-t),0,1);return i*i*(3-2*i)}function pK(t,e){const r=Ce(t),i=Ch(t[2]/r),s=Math.atan2(t[1]/r,t[0]/r);return se(e,r,i,s),e}function NSt(t,e,r){return bi(t,e[0],e[1],e[2],e[3]*r)}function FSt(t){const e=t[0]*t[0]+t[1]*t[1]+t[2]*t[2],r=t[3]*t[3]+t[4]*t[4]+t[5]*t[5],i=t[6]*t[6]+t[7]*t[7]+t[8]*t[8];return!(xS(e,1)&&xS(r,1)&&xS(i,1))}const SV=$fe(34028234663852886e22);function Ut(t=hNe){return[t[0],t[1],t[2],t[3]]}function USt(t){return[t[0],t[1],t[2],t[3]]}function Lg(t,e){return t!==e&&(t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3]),t}function aW(t,e,r,i,s=Ut()){return s[0]=t,s[1]=e,s[2]=r,s[3]=i,s}function Lfe(t,e=Ut()){return e[0]=t.xmin,e[1]=t.ymin,e[2]=t.xmax,e[3]=t.ymax,e}function RF(t,e){return new _r({xmin:t[0],ymin:t[1],xmax:t[2],ymax:t[3],spatialReference:e})}function TS(t,e){e[0]<t[0]&&(t[0]=e[0]),e[0]>t[2]&&(t[2]=e[0]),e[1]<t[1]&&(t[1]=e[1]),e[1]>t[3]&&(t[3]=e[1])}function f_(t,e,r){if(e!=null)if("length"in e)AV(e)?(r[0]=Math.min(t[0],e[0]),r[1]=Math.min(t[1],e[1]),r[2]=Math.max(t[2],e[2]),r[3]=Math.max(t[3],e[3])):e.length!==2&&e.length!==3||(r[0]=Math.min(t[0],e[0]),r[1]=Math.min(t[1],e[1]),r[2]=Math.max(t[2],e[0]),r[3]=Math.max(t[3],e[1]));else switch(e.type){case"extent":r[0]=Math.min(t[0],e.xmin),r[1]=Math.min(t[1],e.ymin),r[2]=Math.max(t[2],e.xmax),r[3]=Math.max(t[3],e.ymax);break;case"point":r[0]=Math.min(t[0],e.x),r[1]=Math.min(t[1],e.y),r[2]=Math.max(t[2],e.x),r[3]=Math.max(t[3],e.y)}else Lg(r,t)}function K6(t,e,r=t){const i=e.length;let s=t[0],n=t[1],o=t[2],a=t[3];for(let l=0;l<i;l++){const c=e[l];s=Math.min(s,c[0]),n=Math.min(n,c[1]),o=Math.max(o,c[0]),a=Math.max(a,c[1])}return r[0]=s,r[1]=n,r[2]=o,r[3]=a,r}function EV(t){for(let e=0;e<4;e++)if(!isFinite(t[e]))return!1;return!0}function ru(t){return t==null||t[0]>=t[2]?0:t[2]-t[0]}function op(t){return t[1]>=t[3]?0:t[3]-t[1]}function Dfe(t){return ru(t)*op(t)}function lW(t,e=[0,0]){return e[0]=(t[0]+t[2])/2,e[1]=(t[1]+t[3])/2,e}function Nfe(t,e){return PF(t,e[0],e[1])}function fK(t,e){const r=e[3],i=.5*(t[0]+t[2]),s=Math.abs(e[0]-i),n=.5*(t[2]-t[0]);if(s>r+n)return!1;const o=.5*(t[1]+t[3]),a=.5*(t[3]-t[1]),l=Math.abs(e[1]-o);if(l>r+a)return!1;if(s<n||l<a)return!0;const c=s-n,h=l-a;return c*c+h*h<=r*r}function kSt(t,e,r){const i=t[0],s=t[1],n=t[2],o=t[3],{x:a,y:l}=e,{x:c,y:h}=r,p=(v,w)=>(h-l)*v+(a-c)*w+(c*l-a*h)<0,f=p(i,o),m=p(n,o),y=p(n,s),_=p(i,s);return!(f===m&&m===y&&y===_&&_===f||a<i&&c<i||a>n&&c>n||l>o&&h>o||l<s&&h<s)}function VSt(t,e){return PF(t,e.x,e.y)}function PF(t,e,r){return e>=t[0]&&r>=t[1]&&e<=t[2]&&r<=t[3]}function lNe(t,e,r){return e[0]>=t[0]-r&&e[1]>=t[1]-r&&e[0]<=t[2]+r&&e[1]<=t[3]+r}function MR(t,e){return Math.max(e[0],t[0])<=Math.min(e[2],t[2])&&Math.max(e[1],t[1])<=Math.min(e[3],t[3])}function mK(t,e){return e[0]>=t[0]&&e[2]<=t[2]&&e[1]>=t[1]&&e[3]<=t[3]}function CV(t,e,r){if(e==null)return Lg(r,t);const i=e[0],s=e[1],n=e[2],o=e[3];return r[0]=ge(t[0],i,n),r[1]=ge(t[1],s,o),r[2]=ge(t[2],i,n),r[3]=ge(t[3],s,o),r}function cNe(t,e){const r=(t[0]+t[2])/2,i=(t[1]+t[3])/2,s=Math.max(Math.abs(e[0]-r)-ru(t)/2,0),n=Math.max(Math.abs(e[1]-i)-op(t)/2,0);return Math.sqrt(s*s+n*n)}function nN(t,e,r,i=t){return i[0]=t[0]+e,i[1]=t[1]+r,i[2]=t[2]+e,i[3]=t[3]+r,i}function wc(t){return t?Lg(t,OV):Ut(OV)}function AV(t){return t!=null&&t.length===4}function uNe(t){return!(ru(t)!==0&&isFinite(t[0])||op(t)!==0&&isFinite(t[1]))}function Tb(t,e){return AV(t)&&AV(e)?t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]:t===e}const zSt=[-1/0,-1/0,1/0,1/0],OV=[1/0,1/0,-1/0,-1/0],hNe=[0,0,0,0];function Ffe(t){return t.xmin!==void 0&&t.ymin!==void 0&&t.xmax!==void 0&&t.ymax!==void 0}function Ufe(t){return t.points!==void 0}function kfe(t){return t.x!==void 0&&t.y!==void 0}function Vfe(t){return t.paths!==void 0}function zfe(t){return t.rings!==void 0}function Bfe(t){function e(r,i){return r==null?i:i==null?r:t(r,i)}return e}const X0=Bfe(Math.min),Y0=Bfe(Math.max);function BSt(t,e){return Vfe(e)?r2(t,e.paths,!1,!1):zfe(e)?r2(t,e.rings,!1,!1):Ufe(e)?cW(t,e.points,!1,!1,!1,!1):Ffe(e)?Gfe(t,e):(kfe(e)&&(t[0]=e.x,t[1]=e.y,t[2]=e.x,t[3]=e.y),t)}function GSt(t){let e,r,i,s;for(t.reset(),e=i=1/0,r=s=-1/0;t.nextPath();){const n=dNe(t);e=Math.min(n[0],e),i=Math.min(n[1],i),r=Math.max(n[2],r),s=Math.max(n[3],s)}return Ut([e,i,r,s])}function dNe(t){let e,r,i,s;for(e=i=1/0,r=s=-1/0;t.nextPoint();)e=Math.min(t.x,e),i=Math.min(t.y,i),r=Math.max(t.x,r),s=Math.max(t.y,s);return Ut([e,i,r,s])}function jSt(t,e){return Vfe(e)?r2(t,e.paths,!0,!1):zfe(e)?r2(t,e.rings,!0,!1):Ufe(e)?cW(t,e.points,!0,!1,!0,!1):Ffe(e)?Gfe(t,e,!0,!1,!0,!1):(kfe(e)&&(t[0]=e.x,t[1]=e.y,t[2]=e.z,t[3]=e.x,t[4]=e.y,t[5]=e.z),t)}function r2(t,e,r,i){const s=r?3:2;if(!e.length||!e[0].length)return null;let n,o,a,l,[c,h]=e[0][0],[p,f]=e[0][0];for(let m=0;m<e.length;m++){const y=e[m];for(let _=0;_<y.length;_++){const v=y[_],[w,x]=v;if(c=X0(c,w),h=X0(h,x),p=Y0(p,w),f=Y0(f,x),r&&v.length>2){const T=v[2];n=X0(n,T),o=Y0(o,T)}if(i&&v.length>s){const T=v[s];a=X0(n,T),l=Y0(o,T)}}}return r?i?(t[0]=c,t[1]=h,t[2]=n,t[3]=a,t[4]=p,t[5]=f,t[6]=o,t[7]=l,t.length=8,t):(t[0]=c,t[1]=h,t[2]=n,t[3]=p,t[4]=f,t[5]=o,t.length=6,t):i?(t[0]=c,t[1]=h,t[2]=a,t[3]=p,t[4]=f,t[5]=l,t.length=6,t):(t[0]=c,t[1]=h,t[2]=p,t[3]=f,t.length=4,t)}function Gfe(t,e,r,i,s,n){const o=e.xmin,a=e.xmax,l=e.ymin,c=e.ymax;let h=e.zmin,p=e.zmax,f=e.mmin,m=e.mmax;return s?(h=h||0,p=p||0,n?(f=f||0,m=m||0,t[0]=o,t[1]=l,t[2]=h,t[3]=f,t[4]=a,t[5]=c,t[6]=p,t[7]=m,t):(t[0]=o,t[1]=l,t[2]=h,t[3]=a,t[4]=c,t[5]=p,t)):n?(f=f||0,m=m||0,t[0]=o,t[1]=l,t[2]=f,t[3]=a,t[4]=c,t[5]=m,t):(t[0]=o,t[1]=l,t[2]=a,t[3]=c,t)}function cW(t,e,r,i,s,n){const o=r?3:2,a=i&&n,l=r&&s;if(!e.length||!e[0].length)return null;let c,h,p,f,[m,y]=e[0],[_,v]=e[0];for(let w=0;w<e.length;w++){const x=e[w],[T,S]=x;if(m=X0(m,T),y=X0(y,S),_=Y0(_,T),v=Y0(v,S),l&&x.length>2){const O=x[2];c=X0(c,O),h=Y0(h,O)}if(a&&x.length>o){const O=x[o];p=X0(c,O),f=Y0(h,O)}}return s?(c=c||0,h=h||0,n?(p=p||0,f=f||0,t[0]=m,t[1]=y,t[2]=c,t[3]=p,t[4]=_,t[5]=v,t[6]=h,t[7]=f,t):(t[0]=m,t[1]=y,t[2]=c,t[3]=_,t[4]=v,t[5]=h,t)):n?(p=p||0,f=f||0,t[0]=m,t[1]=y,t[2]=p,t[3]=_,t[4]=v,t[5]=f,t):(t[0]=m,t[1]=y,t[2]=_,t[3]=v,t)}function pNe(t){return t.xmin!==void 0&&t.ymin!==void 0&&t.xmax!==void 0&&t.ymax!==void 0}function fNe(t){return t.points!==void 0}function mNe(t){return t.x!==void 0&&t.y!==void 0}function gNe(t){return t.paths!==void 0}function yNe(t){return t.rings!==void 0}const uW=[];function jfe(t,e,r,i){return{xmin:t,ymin:e,xmax:r,ymax:i}}function Hfe(t,e,r,i,s,n){return{xmin:t,ymin:e,zmin:r,xmax:i,ymax:s,zmax:n}}function qfe(t,e,r,i,s,n){return{xmin:t,ymin:e,mmin:r,xmax:i,ymax:s,mmax:n}}function Wfe(t,e,r,i,s,n,o,a){return{xmin:t,ymin:e,zmin:r,mmin:i,xmax:s,ymax:n,zmax:o,mmax:a}}function hW(t,e=!1,r=!1){return e?r?Wfe(t[0],t[1],t[2],t[3],t[4],t[5],t[6],t[7]):Hfe(t[0],t[1],t[2],t[3],t[4],t[5]):r?qfe(t[0],t[1],t[2],t[3],t[4],t[5]):jfe(t[0],t[1],t[2],t[3])}function HSt(t){return t?pNe(t)?t:mNe(t)?vNe(t):yNe(t)?Zfe(t):gNe(t)?Xfe(t):fNe(t)?_Ne(t):null:null}function _Ne(t){const{hasZ:e,hasM:r,points:i}=t;return hW(cW(uW,i,e??!1,r??!1),e,r)}function vNe(t){const{x:e,y:r,z:i,m:s}=t,n=s!=null;return i!=null?n?Wfe(e,r,i,s,e,r,i,s):Hfe(e,r,i,e,r,i):n?qfe(e,r,s,e,r,s):jfe(e,r,e,r)}function Zfe(t){const{hasZ:e,hasM:r,rings:i}=t,s=r2(uW,i,e??!1,r??!1);return s?hW(s,e,r):null}function Xfe(t){const{hasZ:e,hasM:r,paths:i}=t,s=r2(uW,i,e??!1,r??!1);return s?hW(s,e,r):null}var V$;function gK(t){return!Array.isArray(t[0])}let zp=V$=class extends q_{static fromExtent(t){const e=t.clone().normalize(),r=t.spatialReference;let i=!1,s=!1;for(const o of e)o.hasZ&&(i=!0),o.hasM&&(s=!0);const n={rings:e.map(o=>{const a=[[o.xmin,o.ymin],[o.xmin,o.ymax],[o.xmax,o.ymax],[o.xmax,o.ymin],[o.xmin,o.ymin]];if(i&&o.hasZ){const l=o.zmin+.5*(o.zmax-o.zmin);for(let c=0;c<a.length;c++)a[c].push(l)}if(s&&o.hasM){const l=o.mmin+.5*(o.mmax-o.mmin);for(let c=0;c<a.length;c++)a[c].push(l)}return a}),spatialReference:r};return i&&(n.hasZ=!0),s&&(n.hasM=!0),new V$(n)}constructor(...t){super(...t),this.rings=[],this.type="polygon"}normalizeCtorArgs(t,e){let r,i,s=null,n=null;return t&&!Array.isArray(t)?(s=t.rings??null,e||(t.spatialReference?e=t.spatialReference:t.rings||(e=t)),r=t.hasZ,i=t.hasM):s=t,s=s||[],e=e||je.WGS84,s.length&&s[0]&&s[0][0]!=null&&typeof s[0][0]=="number"&&(s=[s]),n=s[0]&&s[0][0],n&&(r===void 0&&i===void 0?(r=n.length>2,i=n.length>3):r===void 0?r=i?n.length>3:n.length>2:i===void 0&&(i=r?n.length>3:n.length>2)),{rings:s,spatialReference:e,hasZ:r,hasM:i}}get cache(){return this.commitProperty("rings"),this.commitProperty("hasZ"),this.commitProperty("hasM"),this.commitProperty("spatialReference"),{}}get centroid(){const t=fDe(this);if(!t||isNaN(t[0])||isNaN(t[1])||this.hasZ&&isNaN(t[2]))return null;const e=new pt;return e.x=t[0],e.y=t[1],e.spatialReference=this.spatialReference,this.hasZ&&(e.z=t[2]),e}get extent(){const{spatialReference:t}=this,e=Zfe(this);if(!e)return null;const r=new _r(e);return r.spatialReference=t,r}get isSelfIntersecting(){return sDe(this.rings)}writeRings(t,e){e.rings=K(this.rings)}addRing(t){if(!t)return;const e=this.rings,r=e.length;if(gK(t)){const i=[];for(let s=0,n=t.length;s<n;s++)i[s]=t[s].toArray();e[r]=i}else e[r]=t.concat();return this.notifyChange("rings"),this}clone(){const t=new V$;return t.spatialReference=this.spatialReference,t.rings=K(this.rings),t.hasZ=this.hasZ,t.hasM=this.hasM,t}equals(t){if(this===t)return!0;if(t==null)return!1;const e=this.spatialReference,r=t.spatialReference;if(e!=null!=(r!=null)||e!=null&&r!=null&&!e.equals(r)||this.rings.length!==t.rings.length)return!1;const i=([s,n,o,a],[l,c,h,p])=>s===l&&n===c&&(o==null&&h==null||o===h)&&(a==null&&p==null||a===p);for(let s=0;s<this.rings.length;s++){const n=this.rings[s],o=t.rings[s];if(!Pg(n,o,i))return!1}return!0}contains(t){if(!t)return!1;const e=Sw(t,this.spatialReference);return ZLe(this,e??t)}isClockwise(t){let e;return e=gK(t)?t.map(r=>this.hasZ?this.hasM?[r.x,r.y,r.z,r.m]:[r.x,r.y,r.z]:[r.x,r.y]):t,Qq(e,this.hasM,this.hasZ)}getPoint(t,e){if(!this._validateInputs(t,e))return null;const r=this.rings[t][e],i=this.hasZ,s=this.hasM;return i&&!s?new pt(r[0],r[1],r[2],void 0,this.spatialReference):s&&!i?new pt(r[0],r[1],void 0,r[2],this.spatialReference):i&&s?new pt(r[0],r[1],r[2],r[3],this.spatialReference):new pt(r[0],r[1],this.spatialReference)}insertPoint(t,e,r){return this._validateInputs(t,e,!0)?(t2(this,r),Array.isArray(r)||(r=r.toArray()),this.rings[t].splice(e,0,r),this.notifyChange("rings"),this):this}removePoint(t,e){if(!this._validateInputs(t,e))return null;const r=new pt(this.rings[t].splice(e,1)[0],this.spatialReference);return this.notifyChange("rings"),r}removeRing(t){if(!this._validateInputs(t,null))return null;const e=this.rings.splice(t,1)[0],r=this.spatialReference,i=e.map(s=>new pt(s,r));return this.notifyChange("rings"),i}setPoint(t,e,r){return this._validateInputs(t,e)?(t2(this,r),Array.isArray(r)||(r=r.toArray()),this.rings[t][e]=r,this.notifyChange("rings"),this):this}_validateInputs(t,e,r=!1){if(t==null||t<0||t>=this.rings.length)return!1;if(e!=null){const i=this.rings[t];if(r&&(e<0||e>i.length)||!r&&(e<0||e>=i.length))return!1}return!0}toJSON(t){return this.write({},t)}};u([d({readOnly:!0})],zp.prototype,"cache",null),u([d({readOnly:!0})],zp.prototype,"centroid",null),u([d({readOnly:!0})],zp.prototype,"extent",null),u([d({readOnly:!0})],zp.prototype,"isSelfIntersecting",null),u([d({type:[[[Number]]],json:{write:{isRequired:!0}}})],zp.prototype,"rings",void 0),u([Fe("rings")],zp.prototype,"writeRings",null),zp=V$=u([R("esri.geometry.Polygon")],zp),zp.prototype.toJSON.isDefaultToJSON=!0;const Jd=zp;var RV;function bNe(t){return!Array.isArray(t[0])}let Yy=RV=class extends q_{constructor(...t){super(...t),this.paths=[],this.type="polyline"}normalizeCtorArgs(t,e){let r,i,s=null,n=null;return t&&!Array.isArray(t)?(s=t.paths??null,e||(t.spatialReference?e=t.spatialReference:t.paths||(e=t)),r=t.hasZ,i=t.hasM):s=t,s=s||[],e=e||je.WGS84,s.length&&s[0]&&s[0][0]!=null&&typeof s[0][0]=="number"&&(s=[s]),n=s[0]&&s[0][0],n&&(r===void 0&&i===void 0?(r=n.length>2,i=!1):r===void 0?r=!i&&n.length>3:i===void 0&&(i=!r&&n.length>3)),{paths:s,spatialReference:e,hasZ:r,hasM:i}}get cache(){return this.commitProperty("paths"),this.commitProperty("hasZ"),this.commitProperty("hasM"),this.commitProperty("spatialReference"),{}}get extent(){const{spatialReference:t}=this,e=Xfe(this);if(!e)return null;const r=new _r(e);return r.spatialReference=t,r}writePaths(t,e){e.paths=K(this.paths)}addPath(t){if(!t)return;const e=this.paths,r=e.length;if(bNe(t)){const i=[];for(let s=0,n=t.length;s<n;s++)i[s]=t[s].toArray();e[r]=i}else e[r]=t.concat();return this.notifyChange("paths"),this}clone(){const t=new RV;return t.spatialReference=this.spatialReference,t.paths=K(this.paths),t.hasZ=this.hasZ,t.hasM=this.hasM,t}getPoint(t,e){if(!this._validateInputs(t,e))return null;const r=this.paths[t][e],i=this.hasZ,s=this.hasM;return i&&!s?new pt(r[0],r[1],r[2],void 0,this.spatialReference):s&&!i?new pt(r[0],r[1],void 0,r[2],this.spatialReference):i&&s?new pt(r[0],r[1],r[2],r[3],this.spatialReference):new pt(r[0],r[1],this.spatialReference)}insertPoint(t,e,r){return this._validateInputs(t,e,!0)?(t2(this,r),Array.isArray(r)||(r=r.toArray()),this.paths[t].splice(e,0,r),this.notifyChange("paths"),this):this}removePath(t){if(!this._validateInputs(t,null))return null;const e=this.paths.splice(t,1)[0],r=this.spatialReference,i=e.map(s=>new pt(s,r));return this.notifyChange("paths"),i}removePoint(t,e){if(!this._validateInputs(t,e))return null;const r=new pt(this.paths[t].splice(e,1)[0],this.spatialReference);return this.notifyChange("paths"),r}setPoint(t,e,r){return this._validateInputs(t,e)?(t2(this,r),Array.isArray(r)||(r=r.toArray()),this.paths[t][e]=r,this.notifyChange("paths"),this):this}_validateInputs(t,e,r=!1){if(t==null||t<0||t>=this.paths.length)return!1;if(e!=null){const i=this.paths[t];if(r&&(e<0||e>i.length)||!r&&(e<0||e>=i.length))return!1}return!0}toJSON(t){return this.write({},t)}};u([d({readOnly:!0})],Yy.prototype,"cache",null),u([d({readOnly:!0})],Yy.prototype,"extent",null),u([d({type:[[[Number]]],json:{write:{isRequired:!0}}})],Yy.prototype,"paths",void 0),u([Fe("paths")],Yy.prototype,"writePaths",null),Yy=RV=u([R("esri.geometry.Polyline")],Yy),Yy.prototype.toJSON.isDefaultToJSON=!0;const MF=Yy,Yfe=Wa()({esriGeometryPoint:"point",esriGeometryMultipoint:"multipoint",esriGeometryPolyline:"polyline",esriGeometryPolygon:"polygon"}),yK=Wa()({esriGeometryPoint:"point",esriGeometryMultipoint:"multipoint",esriGeometryPolyline:"polyline",esriGeometryPolygon:"polygon",esriGeometryEnvelope:"extent",mesh:"mesh"});function Jfe(t){return t.xmin!==void 0&&t.ymin!==void 0&&t.xmax!==void 0&&t.ymax!==void 0}function dW(t){return t.points!==void 0}function pW(t){return t.x!==void 0&&t.y!==void 0}function fW(t){return t.paths!==void 0}function SS(t){return t.rings!==void 0}function S_(t){return t==null?null:t instanceof q_?t:pW(t)?pt.fromJSON(t):fW(t)?MF.fromJSON(t):SS(t)?Jd.fromJSON(t):dW(t)?OR.fromJSON(t):Jfe(t)?_r.fromJSON(t):null}function mW(t){return t?pW(t)?"esriGeometryPoint":fW(t)?"esriGeometryPolyline":SS(t)?"esriGeometryPolygon":Jfe(t)?"esriGeometryEnvelope":dW(t)?"esriGeometryMultipoint":null:null}const wNe={esriGeometryPoint:pt,esriGeometryPolyline:MF,esriGeometryPolygon:Jd,esriGeometryEnvelope:_r,esriGeometryMultipoint:OR};function xNe(t){return t&&wNe[t]||null}const Ew={base:q_,key:"type",typeMap:{extent:_r,multipoint:OR,point:pt,polyline:MF,polygon:Jd}};np(Ew);const TNe=Q.getLogger("esri.support.arcadeOnDemand");let eU;function E_(){return eU||(eU=(async()=>{const t=await ae(()=>import("./arcadeUtils-e351a840.js").then(e=>e.au),["./arcadeUtils-e351a840.js","./ArcadeDate-5405c860.js","./executionError-e8d36121.js","./ImmutableArray-ee1d0ce7.js","./number-2aff8d5a.js","./arcadeTimeUtils-34a08cd2.js","./centroid-b0bb7e76.js","./hash-6f442295.js"],import.meta.url);return{arcade:t.arcade,arcadeUtils:t,Dictionary:t.Dictionary,Feature:t.arcadeFeature}})()),eU}const SNe=(t,e,r)=>gW.create(t,e,r,null,["$feature"],[]),ENe=(t,e,r)=>gW.create(t,e,r,null,["$feature","$view"],[]),CNe=(t,e,r,i)=>gW.create(t,e,r,i,["$feature","$view"],[]);let gW=class Qfe{constructor(e,r,i,s,n,o,a){this.services=null,this.script=e,this.evaluate=s;const l=Array.isArray(o)?o:o.fields;this.fields=l,this._syntaxTree=i,this._arcade=r,this._arcadeFeature=n,this._spatialReference=a,this._referencesGeometry=r.scriptTouchesGeometry(this._syntaxTree),this._referencesScale=this._arcade.referencesMember(this._syntaxTree,"scale")}static async create(e,r,i,s,n,o){const{arcade:a,Feature:l,Dictionary:c}=await E_(),h=je.fromJSON(r);let p;try{p=a.parseScript(e,o)}catch(M){return TNe.error(new F("arcade-bad-expression","Failed to parse arcade script",{script:e,error:M})),null}const f=n.reduce((M,k)=>({...M,[k]:null}),{});let m=null;s!=null&&(m=new c(s),m.immutable=!0,f.$config=null);const y=a.scriptUsesGeometryEngine(p),_=y&&a.enableGeometrySupport(),v=a.scriptUsesFeatureSet(p)&&a.enableFeatureSetSupport(),w=a.scriptIsAsync(p),x=w&&a.enableAsyncSupport(),T={vars:f,spatialReference:h,useAsync:!!x};await Promise.all([_,v,x]);const S=new Set;await a.loadDependentModules(S,p,null,w,y);const O=new c;O.immutable=!1,O.setField("scale",0);const A=a.compileScript(p,T),I=(M,k)=>("$view"in M&&M.$view&&(O.setField("scale",typeof M.$view=="object"&&"scale"in M.$view?M.$view.scale:void 0),M.$view=O),m&&(M.$config=m),A({vars:M,spatialReference:h,services:k}));return new Qfe(e,a,p,I,new l,i,h)}repurposeFeature(e){return e.geometry&&!e.geometry.spatialReference&&(e.geometry.spatialReference=this._spatialReference),this._arcadeFeature.repurposeFromGraphicLikeObject(e.geometry,e.attributes,{fields:this.fields}),this._arcadeFeature}referencesGeometry(){return this._referencesGeometry}referencesScale(){return this._referencesScale}};const ANe=/^([0-9_])/,ONe=/[^a-z0-9_\u0080-\uffff]+/gi;function RNe(t){return t==null?null:t.trim().replaceAll(ONe,"_").replace(ANe,"F$1")||null}const PNe=["field","field2","field3","normalizationField","rotationInfo.field","proportionalSymbolInfo.field","proportionalSymbolInfo.normalizationField","colorInfo.field","colorInfo.normalizationField"],MNe=["field","normalizationField"];function oN(t,e){if(t!=null&&e!=null){for(const r of Array.isArray(t)?t:[t])if(_K(PNe,r,e),"visualVariables"in r&&r.visualVariables)for(const i of r.visualVariables)_K(MNe,i,e)}}function _K(t,e,r){if(t)for(const i of t){const s=ug(i,e),n=s&&typeof s!="function"&&r.get(s);n&&Ha(i,n.name,e)}}function Kfe(t,e){if(t!=null&&e?.fields?.length)if("startField"in t){const r=e.get(t.startField),i=e.get(t.endField);t.startField=r?.name??null,t.endField=i?.name??null}else{const r=e.get(t.startTimeField),i=e.get(t.endTimeField);t.startTimeField=r?.name??null,t.endTimeField=i?.name??null}}const tU=new Set;function IF(t,e){return t&&e?(tU.clear(),SO(tU,t,e),Array.from(tU).sort()):[]}function SO(t,e,r){if(r)if(e?.fields?.length)if(r.includes("*"))for(const{name:i}of e.fields)t.add(i);else for(const i of r)au(t,e,i);else{if(r.includes("*"))return t.clear(),void t.add("*");for(const i of r)i!=null&&t.add(i)}}function au(t,e,r){if(typeof r=="string")if(e){const i=e.get(r);i&&t.add(i.name)}else t.add(r)}function INe(t,e){return e==null||t==null?[]:e.includes("*")?(t.fields??[]).map(r=>r.name):e}async function Cl(t,e,r){if(!r)return;const{arcadeUtils:i}=await E_(),s=i.extractFieldNames(r,e?.fields?.map(n=>n.name));for(const n of s)au(t,e,n)}async function eme(t,e,r){if(r&&r!=="1=1"){const{WhereClause:i}=await ae(()=>import("./WhereClause-ae8c5a06.js").then(n=>n.W),["./WhereClause-ae8c5a06.js","./executionError-e8d36121.js"],import.meta.url),s=i.create(r,e);if(!s.isStandardized)throw new F("fieldUtils:collectFilterFields","Where clause is not standardized",{where:r});SO(t,e,s.fieldNames)}}function $Ne({displayField:t,fields:e}){return t||(e&&e.length?rU(e,"name-or-title")||rU(e,"unique-identifier")||rU(e,"type-or-category")||LNe(e):null)}function LNe(t){for(const e of t){if(!e||!e.name)continue;const r=e.name.toLowerCase();if(r.includes("name")||r.includes("title"))return e.name}return null}function rU(t,e){for(const r of t)if(r&&r.valueType&&r.valueType===e)return r.name;return null}async function qSt(t,e){if(!e)return;const r=e.elevationInfo?.featureExpressionInfo;return r?r.collectRequiredFields(t,e.fieldsIndex):void 0}function DNe(t,e,r){r.onStatisticExpression?Cl(t,e,r.onStatisticExpression.expression):t.add(r.onStatisticField)}async function WSt(t,e,r){if(!e||!r||!("fields"in r))return;const i=[],s=r.popupTemplate;i.push(NNe(t,e,s)),r.fields&&i.push(...r.fields.map(async n=>DNe(t,e.fieldsIndex,n))),await Promise.all(i)}async function NNe(t,e,r){const i=[];r?.expressionInfos&&i.push(...r.expressionInfos.map(n=>Cl(t,e.fieldsIndex,n.expression)));const s=r?.content;if(Array.isArray(s))for(const n of s)n.type==="expression"&&n.expressionInfo&&i.push(Cl(t,e.fieldsIndex,n.expressionInfo.expression));await Promise.all(i)}async function ZSt(t,e,r){e&&(e.timeInfo&&r!=null&&r.timeExtent&&SO(t,e.fieldsIndex,[e.timeInfo.startField,e.timeInfo.endField]),e.floorInfo&&SO(t,e.fieldsIndex,[e.floorInfo.floorField]),r!=null&&r.where!=null&&await eme(t,e.fieldsIndex,r.where))}async function XSt(t,e,r){e&&r&&await Promise.all(r.map(i=>FNe(t,e,i)))}async function FNe(t,e,r){e&&r&&(r.valueExpression?await Cl(t,e.fieldsIndex,r.valueExpression):r.field&&au(t,e.fieldsIndex,r.field))}function UNe(t){return t?IF(t.fieldsIndex,tme(t)):[]}function kNe(t){if(!t)return[];const e=t.geometryFieldsInfo;return e?IF(t.fieldsIndex,[e.shapeAreaField,e.shapeLengthField]):[]}const VNe=["oid","global-id","guid"],zNe=["oid","global-id"],BNe=[/^fnode_$/i,/^tnode_$/i,/^lpoly_$/i,/^rpoly_$/i,/^poly_$/i,/^subclass$/i,/^subclass_$/i,/^rings_ok$/i,/^rings_nok$/i,/shape/i,/perimeter/i,/objectid/i,/_i$/i];function GNe(t){const e=new Set;rme(t).forEach(i=>e.add(i)),kNe(t).forEach(i=>e.add(i.toLowerCase()));const r=t&&"infoFor3D"in t?t.infoFor3D:void 0;return r&&(Object.values(r.assetMapFieldRoles).forEach(i=>e.add(i.toLowerCase())),Object.values(r.transformFieldRoles).forEach(i=>e.add(i.toLowerCase()))),Array.from(e)}function tme(t){if(!t)return[];const e="editFieldsInfo"in t&&t.editFieldsInfo;if(!e)return[];const{creationDateField:r,creatorField:i,editDateField:s,editorField:n}=e;return[r,i,s,n].filter(Boolean)}function rme(t){return tme(t).map(e=>e.toLowerCase())}function jNe(t,e){return t.editable&&!VNe.includes(t.type)&&!rme(e).includes(t.name?.toLowerCase()??"")}function HNe(t,e){const r=t.name?.toLowerCase()??"";return!(e?.objectIdField!=null&&r===e.objectIdField.toLowerCase()||e?.globalIdField!=null&&r===e.globalIdField.toLowerCase()||GNe(e).includes(r)||zNe.includes(t.type)||BNe.some(i=>i.test(r)))}async function YSt(t,e){const{labelingInfo:r,fieldsIndex:i}=e;r&&r.length&&await Promise.all(r.map(s=>qNe(t,i,s)))}async function qNe(t,e,r){if(!r)return;const i=r.getLabelExpression(),s=r.where;if(i.type==="arcade")await Cl(t,e,i.expression);else{const n=i.expression.match(/{[^}]*}/g);n&&n.forEach(o=>{au(t,e,o.slice(1,-1))})}await eme(t,e,s)}function WNe(t){const e=t.defaultValue;return e!==void 0&&nme(t,e)?e:t.nullable?null:void 0}function ime(t){return typeof t=="number"&&!isNaN(t)&&isFinite(t)}function ZNe(t){return t===null||ime(t)}const yW="isInteger"in Number?Number.isInteger:t=>typeof t=="number"&&isFinite(t)&&Math.floor(t)===t;function XNe(t){return t===null||yW(t)}function sme(t){return t!=null&&typeof t=="string"}function YNe(t){return t===null||sme(t)}function JNe(){return!0}function nme(t,e){let r;switch(t.type){case"date":case"integer":case"long":case"small-integer":case"esriFieldTypeDate":case"esriFieldTypeInteger":case"esriFieldTypeLong":case"esriFieldTypeSmallInteger":r=t.nullable?XNe:yW;break;case"double":case"single":case"esriFieldTypeSingle":case"esriFieldTypeDouble":r=t.nullable?ZNe:ime;break;case"string":case"esriFieldTypeString":r=t.nullable?YNe:sme;break;default:r=JNe}return arguments.length===1?r:r(e)}const QNe=["integer","small-integer","single","double"],KNe=new Set([...QNe,"esriFieldTypeInteger","esriFieldTypeSmallInteger","esriFieldTypeSingle","esriFieldTypeDouble"]),e4e=["date","date-only","time-only","timestamp-offset"],t4e=new Set([...e4e,"esriFieldTypeDate","esriFieldTypeDateOnly","esriFieldTypeTimeOnly","esriFieldTypeTimestampOffset"]);function $F(t){return t!=null&&KNe.has(t.type)}function JSt(t){return t!=null&&(t.type==="string"||t.type==="esriFieldTypeString")}function QSt(t){return t!=null&&t4e.has(t.type)}var aN,lN;function KSt(t){return t==null||typeof t=="number"&&isNaN(t)?null:t}function e2t(t,e){return t==null||t.nullable&&e===null?null:$F(t)&&!r4e(t.type,Number(e))?aN.OUT_OF_RANGE:nme(t,e)?t.domain?sLe(t.domain,e):null:lN.INVALID_TYPE}function r4e(t,e){const r=typeof t=="string"?_W(t):t;if(!r)return!1;const i=r.min,s=r.max;return r.isInteger?yW(e)&&e>=i&&e<=s:e>=i&&e<=s}function t2t(t){return nLe(t.domain)||($F(t)?_W(t.type):void 0)}function _W(t){switch(t){case"esriFieldTypeSmallInteger":case"small-integer":return i4e;case"esriFieldTypeInteger":case"integer":return s4e;case"esriFieldTypeBigInteger":case"big-integer":return n4e;case"esriFieldTypeSingle":case"single":return o4e;case"esriFieldTypeDouble":case"double":return a4e}}(function(t){t.OUT_OF_RANGE="numeric-range-validation-error::out-of-range"})(aN||(aN={})),function(t){t.INVALID_TYPE="type-validation-error::invalid-type"}(lN||(lN={}));const i4e={min:-32768,max:32767,isInteger:!0},s4e={min:-2147483648,max:2147483647,isInteger:!0},n4e={min:-Number.MAX_SAFE_INTEGER,max:Number.MAX_SAFE_INTEGER,isInteger:!0},o4e={min:-34e37,max:12e37,isInteger:!1},a4e={min:-Number.MAX_VALUE,max:Number.MAX_VALUE,isInteger:!1};function r2t(t,e,r){switch(t){case KS.INVALID_CODED_VALUE:return`Value ${r} is not in the coded domain - field: ${e.name}, domain: ${JSON.stringify(e.domain)}`;case KS.VALUE_OUT_OF_RANGE:return`Value ${r} is out of the range of valid values - field: ${e.name}, domain: ${JSON.stringify(e.domain)}`;case lN.INVALID_TYPE:return`Value ${r} is not a valid value for the field type - field: ${e.name}, type: ${e.type}, nullable: ${e.nullable}`;case aN.OUT_OF_RANGE:{const{min:i,max:s}=_W(e.type);return`Value ${r} is out of range for the number type - field: ${e.name}, type: ${e.type}, value range is ${i} to ${s}`}}}function i2t(t,e){return!l4e(t,e,null)}function l4e(t,e,r){if(!e||!e.attributes||!t){if(r!=null)for(const n of t??[])r.add(n);return!0}const i=e.attributes;let s=!1;for(const n of t)if(!(n in i)){if(s=!0,r==null)break;r.add(n)}return s}function c4e(t){return!!t&&["raster.itempixelvalue","raster.servicepixelvalue"].some(e=>t.toLowerCase().startsWith(e))}var cN;(function(t){t[t.KILOBYTES=1024]="KILOBYTES",t[t.MEGABYTES=1048576]="MEGABYTES",t[t.GIGABYTES=1073741824]="GIGABYTES"})(cN||(cN={}));let C_=class{constructor(e,r){this.min=e,this.max=r,this.range=r-e}ndiff(e,r=0){return Math.ceil((e-r)/this.range)*this.range+r}_normalize(e,r,i,s=0,n=!1){return(i-=s)<e?i+=this.ndiff(e-i):i>r&&(i-=this.ndiff(i-r)),n&&i===r&&(i=e),i+s}normalize(e,r=0,i=!1){return this._normalize(this.min,this.max,e,r,i)}clamp(e,r=0){return ge(e-r,this.min,this.max)+r}monotonic(e,r,i){return e<r?r:r+this.ndiff(e-r,i)}minimalMonotonic(e,r,i){return this._normalize(e,e+this.range,r,i)}center(e,r,i){return r=this.monotonic(e,r,i),this.normalize((e+r)/2,i)}diff(e,r,i){return this.monotonic(e,r,i)-e}shortestSignedDiff(e,r){e=this.normalize(e);const i=(r=this.normalize(r))-e,s=r<e?this.minimalMonotonic(e,r)-e:r-this.minimalMonotonic(r,e);return Math.abs(i)<Math.abs(s)?i:s}contains(e,r,i){return r=this.minimalMonotonic(e,r),(i=this.minimalMonotonic(e,i))>e&&i<r}};function vW(t){for(const e in t){const r=t[e];r instanceof Function&&(t[e]=r.bind(t))}return t}const u4e=vW(new C_(0,2*Math.PI)),A_=vW(new C_(-Math.PI,Math.PI)),bW=vW(new C_(0,360));function LF(t){return typeof t=="string"?document.getElementById(t):t??null}function ome(t){for(;t.hasChildNodes();)t.removeChild(t.firstChild)}function vK(t,e){const r=e.parentNode;r&&r.insertBefore(t,e)}function bK(t,e){for(;;){const r=t.firstChild;if(!r)break;e.appendChild(r)}}function n2t(t){t.parentNode&&t.parentNode.removeChild(t)}let z$=class ame{constructor(){this._emitter=new ame.EventEmitter(this)}emit(e,r){return this._emitter.emit(e,r)}on(e,r){return this._emitter.on(e,r)}once(e,r){return this._emitter.once(e,r)}hasEventListener(e){return this._emitter.hasEventListener(e)}};(function(t){class e{constructor(s=null){this._target=s,this._listenersMap=null}clear(){this._listenersMap?.clear(),this._listenersMap=null}destroy(){this.clear()}emit(s,n){const o=this._listenersMap&&this._listenersMap.get(s);if(!o)return!1;const a=this._target||this;return[...o].forEach(l=>{l.call(a,n)}),o.length>0}on(s,n){if(Array.isArray(s)){const a=s.map(l=>this.on(l,n));return XS(a)}if(s.includes(","))throw new TypeError("Evented.on() with a comma delimited string of event types is not supported");this._listenersMap||(this._listenersMap=new Map);const o=this._listenersMap.get(s)||[];return o.push(n),this._listenersMap.set(s,o),{remove:()=>{const a=this._listenersMap&&this._listenersMap.get(s)||[],l=a.indexOf(n);l>=0&&a.splice(l,1)}}}once(s,n){const o=this.on(s,a=>{o.remove(),n.call(null,a)});return o}hasEventListener(s){const n=this._listenersMap&&this._listenersMap.get(s);return n!=null&&n.length>0}}t.EventEmitter=e,t.EventedMixin=i=>{let s=class extends i{constructor(){super(...arguments),this._emitter=new e}destroy(){this._emitter.clear()}emit(n,o){return this._emitter.emit(n,o)}on(n,o){return this._emitter.on(n,o)}once(n,o){return this._emitter.once(n,o)}hasEventListener(n){return this._emitter.hasEventListener(n)}};return s=u([R("esri.core.Evented")],s),s};let r=class extends Te{constructor(){super(...arguments),this._emitter=new z$.EventEmitter(this)}destroy(){this._emitter.clear()}emit(i,s){return this._emitter.emit(i,s)}on(i,s){return this._emitter.on(i,s)}once(i,s){return this._emitter.once(i,s)}hasEventListener(i){return this._emitter.hasEventListener(i)}};r=u([R("esri.core.Evented")],r),t.EventedAccessor=r})(z$||(z$={}));const os=z$;var O0;(function(t){t[t.PENDING=0]="PENDING",t[t.RESOLVED=1]="RESOLVED",t[t.REJECTED=2]="REJECTED"})(O0||(O0={}));let h4e=class{constructor(){this._resolver=qs(),this._status=O0.PENDING,this._resolvingPromises=[],this._resolver.promise.then(()=>{this._status=O0.RESOLVED,this._cleanUp()},()=>{this._status=O0.REJECTED,this._cleanUp()}),this.promise=this._resolver.promise}destroy(){this._cleanUp()}addResolvingPromise(e){this._resolvingPromises.push(e),this._tryResolve()}isResolved(){return this._status===O0.RESOLVED}isRejected(){return this._status===O0.REJECTED}isFulfilled(){return this._status!==O0.PENDING}abort(){this._resolver.reject(Dr())}_cleanUp(){this._allPromise=null,this._resolvingPromises=null}_tryResolve(){if(this.isFulfilled())return;const e=qs(),r=[...this._resolvingPromises,e.promise],i=this._allPromise=Promise.all(r);i.then(()=>{this.isFulfilled()||this._allPromise!==i||this._resolver.resolve()},s=>{this.isFulfilled()||this._allPromise!==i||ms(s)||this._resolver.reject(s)}),e.resolve()}};const DF=t=>{let e=class extends t{constructor(...r){super(...r),this._promiseProps=new h4e,this.addResolvingPromise(Promise.resolve())}destroy(){this._promiseProps?.destroy()}isResolved(){return this._promiseProps.isResolved()}isRejected(){return this._promiseProps.isRejected()}isFulfilled(){return this._promiseProps.isFulfilled()}when(r,i){return this._promiseProps.promise.then(()=>this).then(r,i)}catch(r){return this.when(null,r)}addResolvingPromise(r){r&&!this._promiseProps.isFulfilled()&&this._promiseProps.addResolvingPromise("_promiseProps"in r?r.when():r)}};return e=u([R("esri.core.Promise")],e),e};let uN=class extends DF(Te){};uN=u([R("esri.core.Promise")],uN);const d4e="randomUUID"in crypto;function NF(){if(d4e)return crypto.randomUUID();const t=crypto.getRandomValues(new Uint16Array(8));t[3]=4095&t[3]|16384,t[4]=16383&t[4]|32768;const e=r=>t[r].toString(16).padStart(4,"0");return e(0)+e(1)+"-"+e(2)+"-"+e(3)+"-"+e(4)+"-"+e(5)+e(6)+e(7)}function l2t(){return`{${NF()}}`}/*!
 * @esri/arcgis-html-sanitizer - v3.0.1 - Tue Nov 15 2022 09:46:54 GMT-0800 (Pacific Standard Time)
 * Copyright (c) 2022 - Environmental Systems Research Institute, Inc.
 * Apache-2.0
 * 
 * js-xss
 * Copyright (c) 2012-2018 Zongmin Lei() <leizongmin@gmail.com>
 * http://ucdok.com
 * MIT License, see https://github.com/leizongmin/js-xss/blob/master/LICENSE for details
 */var p4e=function(t){if(typeof t!="object"||t===null||Object.prototype.toString.call(t)!=="[object Object]")return!1;var e=Object.getPrototypeOf(t);if(e===null)return!0;for(;Object.getPrototypeOf(e)!==null;)e=Object.getPrototypeOf(e);return Object.getPrototypeOf(t)===e},W1={exports:{}},Xs={},EO={exports:{}},Cw={};function lme(){var t={};return t["align-content"]=!1,t["align-items"]=!1,t["align-self"]=!1,t["alignment-adjust"]=!1,t["alignment-baseline"]=!1,t.all=!1,t["anchor-point"]=!1,t.animation=!1,t["animation-delay"]=!1,t["animation-direction"]=!1,t["animation-duration"]=!1,t["animation-fill-mode"]=!1,t["animation-iteration-count"]=!1,t["animation-name"]=!1,t["animation-play-state"]=!1,t["animation-timing-function"]=!1,t.azimuth=!1,t["backface-visibility"]=!1,t.background=!0,t["background-attachment"]=!0,t["background-clip"]=!0,t["background-color"]=!0,t["background-image"]=!0,t["background-origin"]=!0,t["background-position"]=!0,t["background-repeat"]=!0,t["background-size"]=!0,t["baseline-shift"]=!1,t.binding=!1,t.bleed=!1,t["bookmark-label"]=!1,t["bookmark-level"]=!1,t["bookmark-state"]=!1,t.border=!0,t["border-bottom"]=!0,t["border-bottom-color"]=!0,t["border-bottom-left-radius"]=!0,t["border-bottom-right-radius"]=!0,t["border-bottom-style"]=!0,t["border-bottom-width"]=!0,t["border-collapse"]=!0,t["border-color"]=!0,t["border-image"]=!0,t["border-image-outset"]=!0,t["border-image-repeat"]=!0,t["border-image-slice"]=!0,t["border-image-source"]=!0,t["border-image-width"]=!0,t["border-left"]=!0,t["border-left-color"]=!0,t["border-left-style"]=!0,t["border-left-width"]=!0,t["border-radius"]=!0,t["border-right"]=!0,t["border-right-color"]=!0,t["border-right-style"]=!0,t["border-right-width"]=!0,t["border-spacing"]=!0,t["border-style"]=!0,t["border-top"]=!0,t["border-top-color"]=!0,t["border-top-left-radius"]=!0,t["border-top-right-radius"]=!0,t["border-top-style"]=!0,t["border-top-width"]=!0,t["border-width"]=!0,t.bottom=!1,t["box-decoration-break"]=!0,t["box-shadow"]=!0,t["box-sizing"]=!0,t["box-snap"]=!0,t["box-suppress"]=!0,t["break-after"]=!0,t["break-before"]=!0,t["break-inside"]=!0,t["caption-side"]=!1,t.chains=!1,t.clear=!0,t.clip=!1,t["clip-path"]=!1,t["clip-rule"]=!1,t.color=!0,t["color-interpolation-filters"]=!0,t["column-count"]=!1,t["column-fill"]=!1,t["column-gap"]=!1,t["column-rule"]=!1,t["column-rule-color"]=!1,t["column-rule-style"]=!1,t["column-rule-width"]=!1,t["column-span"]=!1,t["column-width"]=!1,t.columns=!1,t.contain=!1,t.content=!1,t["counter-increment"]=!1,t["counter-reset"]=!1,t["counter-set"]=!1,t.crop=!1,t.cue=!1,t["cue-after"]=!1,t["cue-before"]=!1,t.cursor=!1,t.direction=!1,t.display=!0,t["display-inside"]=!0,t["display-list"]=!0,t["display-outside"]=!0,t["dominant-baseline"]=!1,t.elevation=!1,t["empty-cells"]=!1,t.filter=!1,t.flex=!1,t["flex-basis"]=!1,t["flex-direction"]=!1,t["flex-flow"]=!1,t["flex-grow"]=!1,t["flex-shrink"]=!1,t["flex-wrap"]=!1,t.float=!1,t["float-offset"]=!1,t["flood-color"]=!1,t["flood-opacity"]=!1,t["flow-from"]=!1,t["flow-into"]=!1,t.font=!0,t["font-family"]=!0,t["font-feature-settings"]=!0,t["font-kerning"]=!0,t["font-language-override"]=!0,t["font-size"]=!0,t["font-size-adjust"]=!0,t["font-stretch"]=!0,t["font-style"]=!0,t["font-synthesis"]=!0,t["font-variant"]=!0,t["font-variant-alternates"]=!0,t["font-variant-caps"]=!0,t["font-variant-east-asian"]=!0,t["font-variant-ligatures"]=!0,t["font-variant-numeric"]=!0,t["font-variant-position"]=!0,t["font-weight"]=!0,t.grid=!1,t["grid-area"]=!1,t["grid-auto-columns"]=!1,t["grid-auto-flow"]=!1,t["grid-auto-rows"]=!1,t["grid-column"]=!1,t["grid-column-end"]=!1,t["grid-column-start"]=!1,t["grid-row"]=!1,t["grid-row-end"]=!1,t["grid-row-start"]=!1,t["grid-template"]=!1,t["grid-template-areas"]=!1,t["grid-template-columns"]=!1,t["grid-template-rows"]=!1,t["hanging-punctuation"]=!1,t.height=!0,t.hyphens=!1,t.icon=!1,t["image-orientation"]=!1,t["image-resolution"]=!1,t["ime-mode"]=!1,t["initial-letters"]=!1,t["inline-box-align"]=!1,t["justify-content"]=!1,t["justify-items"]=!1,t["justify-self"]=!1,t.left=!1,t["letter-spacing"]=!0,t["lighting-color"]=!0,t["line-box-contain"]=!1,t["line-break"]=!1,t["line-grid"]=!1,t["line-height"]=!1,t["line-snap"]=!1,t["line-stacking"]=!1,t["line-stacking-ruby"]=!1,t["line-stacking-shift"]=!1,t["line-stacking-strategy"]=!1,t["list-style"]=!0,t["list-style-image"]=!0,t["list-style-position"]=!0,t["list-style-type"]=!0,t.margin=!0,t["margin-bottom"]=!0,t["margin-left"]=!0,t["margin-right"]=!0,t["margin-top"]=!0,t["marker-offset"]=!1,t["marker-side"]=!1,t.marks=!1,t.mask=!1,t["mask-box"]=!1,t["mask-box-outset"]=!1,t["mask-box-repeat"]=!1,t["mask-box-slice"]=!1,t["mask-box-source"]=!1,t["mask-box-width"]=!1,t["mask-clip"]=!1,t["mask-image"]=!1,t["mask-origin"]=!1,t["mask-position"]=!1,t["mask-repeat"]=!1,t["mask-size"]=!1,t["mask-source-type"]=!1,t["mask-type"]=!1,t["max-height"]=!0,t["max-lines"]=!1,t["max-width"]=!0,t["min-height"]=!0,t["min-width"]=!0,t["move-to"]=!1,t["nav-down"]=!1,t["nav-index"]=!1,t["nav-left"]=!1,t["nav-right"]=!1,t["nav-up"]=!1,t["object-fit"]=!1,t["object-position"]=!1,t.opacity=!1,t.order=!1,t.orphans=!1,t.outline=!1,t["outline-color"]=!1,t["outline-offset"]=!1,t["outline-style"]=!1,t["outline-width"]=!1,t.overflow=!1,t["overflow-wrap"]=!1,t["overflow-x"]=!1,t["overflow-y"]=!1,t.padding=!0,t["padding-bottom"]=!0,t["padding-left"]=!0,t["padding-right"]=!0,t["padding-top"]=!0,t.page=!1,t["page-break-after"]=!1,t["page-break-before"]=!1,t["page-break-inside"]=!1,t["page-policy"]=!1,t.pause=!1,t["pause-after"]=!1,t["pause-before"]=!1,t.perspective=!1,t["perspective-origin"]=!1,t.pitch=!1,t["pitch-range"]=!1,t["play-during"]=!1,t.position=!1,t["presentation-level"]=!1,t.quotes=!1,t["region-fragment"]=!1,t.resize=!1,t.rest=!1,t["rest-after"]=!1,t["rest-before"]=!1,t.richness=!1,t.right=!1,t.rotation=!1,t["rotation-point"]=!1,t["ruby-align"]=!1,t["ruby-merge"]=!1,t["ruby-position"]=!1,t["shape-image-threshold"]=!1,t["shape-outside"]=!1,t["shape-margin"]=!1,t.size=!1,t.speak=!1,t["speak-as"]=!1,t["speak-header"]=!1,t["speak-numeral"]=!1,t["speak-punctuation"]=!1,t["speech-rate"]=!1,t.stress=!1,t["string-set"]=!1,t["tab-size"]=!1,t["table-layout"]=!1,t["text-align"]=!0,t["text-align-last"]=!0,t["text-combine-upright"]=!0,t["text-decoration"]=!0,t["text-decoration-color"]=!0,t["text-decoration-line"]=!0,t["text-decoration-skip"]=!0,t["text-decoration-style"]=!0,t["text-emphasis"]=!0,t["text-emphasis-color"]=!0,t["text-emphasis-position"]=!0,t["text-emphasis-style"]=!0,t["text-height"]=!0,t["text-indent"]=!0,t["text-justify"]=!0,t["text-orientation"]=!0,t["text-overflow"]=!0,t["text-shadow"]=!0,t["text-space-collapse"]=!0,t["text-transform"]=!0,t["text-underline-position"]=!0,t["text-wrap"]=!0,t.top=!1,t.transform=!1,t["transform-origin"]=!1,t["transform-style"]=!1,t.transition=!1,t["transition-delay"]=!1,t["transition-duration"]=!1,t["transition-property"]=!1,t["transition-timing-function"]=!1,t["unicode-bidi"]=!1,t["vertical-align"]=!1,t.visibility=!1,t["voice-balance"]=!1,t["voice-duration"]=!1,t["voice-family"]=!1,t["voice-pitch"]=!1,t["voice-range"]=!1,t["voice-rate"]=!1,t["voice-stress"]=!1,t["voice-volume"]=!1,t.volume=!1,t["white-space"]=!1,t.widows=!1,t.width=!0,t["will-change"]=!1,t["word-break"]=!0,t["word-spacing"]=!0,t["word-wrap"]=!0,t["wrap-flow"]=!1,t["wrap-through"]=!1,t["writing-mode"]=!1,t["z-index"]=!1,t}function f4e(t,e,r){}function m4e(t,e,r){}var g4e=/javascript\s*\:/img;function y4e(t,e){return g4e.test(e)?"":e}Cw.whiteList=lme();Cw.getDefaultWhiteList=lme;Cw.onAttr=f4e;Cw.onIgnoreAttr=m4e;Cw.safeAttrValue=y4e;var _4e={indexOf:function(t,e){var r,i;if(Array.prototype.indexOf)return t.indexOf(e);for(r=0,i=t.length;r<i;r++)if(t[r]===e)return r;return-1},forEach:function(t,e,r){var i,s;if(Array.prototype.forEach)return t.forEach(e,r);for(i=0,s=t.length;i<s;i++)e.call(r,t[i],i,t)},trim:function(t){return String.prototype.trim?t.trim():t.replace(/(^\s*)|(\s*$)/g,"")},trimRight:function(t){return String.prototype.trimRight?t.trimRight():t.replace(/(\s*$)/g,"")}},NE=_4e;function v4e(t,e){t=NE.trimRight(t),t[t.length-1]!==";"&&(t+=";");var r=t.length,i=!1,s=0,n=0,o="";function a(){if(!i){var h=NE.trim(t.slice(s,n)),p=h.indexOf(":");if(p!==-1){var f=NE.trim(h.slice(0,p)),m=NE.trim(h.slice(p+1));if(f){var y=e(s,o.length,f,m,h);y&&(o+=y+"; ")}}}s=n+1}for(;n<r;n++){var l=t[n];if(l==="/"&&t[n+1]==="*"){var c=t.indexOf("*/",n+2);if(c===-1)break;n=c+1,s=n+1,i=!1}else l==="("?i=!0:l===")"?i=!1:l===";"?i||a():l===`
`&&a()}return NE.trim(o)}var b4e=v4e,DP=Cw,w4e=b4e;function wK(t){return t==null}function x4e(t){var e={};for(var r in t)e[r]=t[r];return e}function cme(t){t=x4e(t||{}),t.whiteList=t.whiteList||DP.whiteList,t.onAttr=t.onAttr||DP.onAttr,t.onIgnoreAttr=t.onIgnoreAttr||DP.onIgnoreAttr,t.safeAttrValue=t.safeAttrValue||DP.safeAttrValue,this.options=t}cme.prototype.process=function(t){if(t=t||"",t=t.toString(),!t)return"";var e=this,r=e.options,i=r.whiteList,s=r.onAttr,n=r.onIgnoreAttr,o=r.safeAttrValue,a=w4e(t,function(l,c,h,p,f){var m=i[h],y=!1;if(m===!0?y=m:typeof m=="function"?y=m(p):m instanceof RegExp&&(y=m.test(p)),y!==!0&&(y=!1),p=o(h,p),!!p){var _={position:c,sourcePosition:l,source:f,isWhite:y};if(y){var v=s(h,p,_);return wK(v)?h+":"+p:v}else{var v=n(h,p,_);if(!wK(v))return v}}});return a};var T4e=cme;(function(t,e){var r=Cw,i=T4e;function s(o,a){var l=new i(a);return l.process(o)}e=t.exports=s,e.FilterCSS=i;for(var n in r)e[n]=r[n]})(EO,EO.exports);var wW={indexOf:function(t,e){var r,i;if(Array.prototype.indexOf)return t.indexOf(e);for(r=0,i=t.length;r<i;r++)if(t[r]===e)return r;return-1},forEach:function(t,e,r){var i,s;if(Array.prototype.forEach)return t.forEach(e,r);for(i=0,s=t.length;i<s;i++)e.call(r,t[i],i,t)},trim:function(t){return String.prototype.trim?t.trim():t.replace(/(^\s*)|(\s*$)/g,"")},spaceIndex:function(t){var e=/\s|\n|\t/,r=e.exec(t);return r?r.index:-1}},S4e=EO.exports.FilterCSS,E4e=EO.exports.getDefaultWhiteList,hN=wW;function ume(){return{a:["target","href","title"],abbr:["title"],address:[],area:["shape","coords","href","alt"],article:[],aside:[],audio:["autoplay","controls","crossorigin","loop","muted","preload","src"],b:[],bdi:["dir"],bdo:["dir"],big:[],blockquote:["cite"],br:[],caption:[],center:[],cite:[],code:[],col:["align","valign","span","width"],colgroup:["align","valign","span","width"],dd:[],del:["datetime"],details:["open"],div:[],dl:[],dt:[],em:[],figcaption:[],figure:[],font:["color","size","face"],footer:[],h1:[],h2:[],h3:[],h4:[],h5:[],h6:[],header:[],hr:[],i:[],img:["src","alt","title","width","height"],ins:["datetime"],li:[],mark:[],nav:[],ol:[],p:[],pre:[],s:[],section:[],small:[],span:[],sub:[],summary:[],sup:[],strong:[],strike:[],table:["width","border","align","valign"],tbody:["align","valign"],td:["width","rowspan","colspan","align","valign"],tfoot:["align","valign"],th:["width","rowspan","colspan","align","valign"],thead:["align","valign"],tr:["rowspan","align","valign"],tt:[],u:[],ul:[],video:["autoplay","controls","crossorigin","loop","muted","playsinline","poster","preload","src","height","width"]}}var hme=new S4e;function C4e(t,e,r){}function A4e(t,e,r){}function O4e(t,e,r){}function R4e(t,e,r){}function dme(t){return t.replace(M4e,"&lt;").replace(I4e,"&gt;")}function P4e(t,e,r,i){if(r=_me(r),e==="href"||e==="src"){if(r=hN.trim(r),r==="#")return"#";if(!(r.substr(0,7)==="http://"||r.substr(0,8)==="https://"||r.substr(0,7)==="mailto:"||r.substr(0,4)==="tel:"||r.substr(0,11)==="data:image/"||r.substr(0,6)==="ftp://"||r.substr(0,2)==="./"||r.substr(0,3)==="../"||r[0]==="#"||r[0]==="/"))return""}else if(e==="background"){if(NP.lastIndex=0,NP.test(r))return""}else if(e==="style"){if(xK.lastIndex=0,xK.test(r)||(TK.lastIndex=0,TK.test(r)&&(NP.lastIndex=0,NP.test(r))))return"";i!==!1&&(i=i||hme,r=i.process(r))}return r=vme(r),r}var M4e=/</g,I4e=/>/g,$4e=/"/g,L4e=/&quot;/g,D4e=/&#([a-zA-Z0-9]*);?/gim,N4e=/&colon;?/gim,F4e=/&newline;?/gim,NP=/((j\s*a\s*v\s*a|v\s*b|l\s*i\s*v\s*e)\s*s\s*c\s*r\s*i\s*p\s*t\s*|m\s*o\s*c\s*h\s*a):/gi,xK=/e\s*x\s*p\s*r\s*e\s*s\s*s\s*i\s*o\s*n\s*\(.*/gi,TK=/u\s*r\s*l\s*\(.*/gi;function pme(t){return t.replace($4e,"&quot;")}function fme(t){return t.replace(L4e,'"')}function mme(t){return t.replace(D4e,function(r,i){return i[0]==="x"||i[0]==="X"?String.fromCharCode(parseInt(i.substr(1),16)):String.fromCharCode(parseInt(i,10))})}function gme(t){return t.replace(N4e,":").replace(F4e," ")}function yme(t){for(var e="",r=0,i=t.length;r<i;r++)e+=t.charCodeAt(r)<32?" ":t.charAt(r);return hN.trim(e)}function _me(t){return t=fme(t),t=mme(t),t=gme(t),t=yme(t),t}function vme(t){return t=pme(t),t=dme(t),t}function U4e(){return""}function k4e(t,e){typeof e!="function"&&(e=function(){});var r=!Array.isArray(t);function i(o){return r?!0:hN.indexOf(t,o)!==-1}var s=[],n=!1;return{onIgnoreTag:function(o,a,l){if(i(o))if(l.isClosing){var c="[/removed]",h=l.position+c.length;return s.push([n!==!1?n:l.position,h]),n=!1,c}else return n||(n=l.position),"[removed]";else return e(o,a,l)},remove:function(o){var a="",l=0;return hN.forEach(s,function(c){a+=o.slice(l,c[0]),l=c[1]}),a+=o.slice(l),a}}}function V4e(t){for(var e="",r=0;r<t.length;){var i=t.indexOf("<!--",r);if(i===-1){e+=t.slice(r);break}e+=t.slice(r,i);var s=t.indexOf("-->",i);if(s===-1)break;r=s+3}return e}function z4e(t){var e=t.split("");return e=e.filter(function(r){var i=r.charCodeAt(0);return i===127?!1:i<=31?i===10||i===13:!0}),e.join("")}Xs.whiteList=ume();Xs.getDefaultWhiteList=ume;Xs.onTag=C4e;Xs.onIgnoreTag=A4e;Xs.onTagAttr=O4e;Xs.onIgnoreTagAttr=R4e;Xs.safeAttrValue=P4e;Xs.escapeHtml=dme;Xs.escapeQuote=pme;Xs.unescapeQuote=fme;Xs.escapeHtmlEntities=mme;Xs.escapeDangerHtml5Entities=gme;Xs.clearNonPrintableCharacter=yme;Xs.friendlyAttrValue=_me;Xs.escapeAttrValue=vme;Xs.onIgnoreTagStripAll=U4e;Xs.StripTagBody=k4e;Xs.stripCommentTag=V4e;Xs.stripBlankChar=z4e;Xs.cssFilter=hme;Xs.getDefaultCSSWhiteList=E4e;var FF={},R0=wW;function B4e(t){var e=R0.spaceIndex(t),r;return e===-1?r=t.slice(1,-1):r=t.slice(1,e+1),r=R0.trim(r).toLowerCase(),r.slice(0,1)==="/"&&(r=r.slice(1)),r.slice(-1)==="/"&&(r=r.slice(0,-1)),r}function G4e(t){return t.slice(0,2)==="</"}function j4e(t,e,r){var i="",s=0,n=!1,o=!1,a=0,l=t.length,c="",h="";e:for(a=0;a<l;a++){var p=t.charAt(a);if(n===!1){if(p==="<"){n=a;continue}}else if(o===!1){if(p==="<"){i+=r(t.slice(s,a)),n=a,s=a;continue}if(p===">"){i+=r(t.slice(s,n)),h=t.slice(n,a+1),c=B4e(h),i+=e(n,i.length,c,h,G4e(h)),s=a+1,n=!1;continue}if(p==='"'||p==="'")for(var f=1,m=t.charAt(a-f);m.trim()===""||m==="=";){if(m==="="){o=p;continue e}m=t.charAt(a-++f)}}else if(p===o){o=!1;continue}}return s<t.length&&(i+=r(t.substr(s))),i}var H4e=/[^a-zA-Z0-9\\_:.-]/gim;function q4e(t,e){var r=0,i=0,s=[],n=!1,o=t.length;function a(f,m){if(f=R0.trim(f),f=f.replace(H4e,"").toLowerCase(),!(f.length<1)){var y=e(f,m||"");y&&s.push(y)}}for(var l=0;l<o;l++){var c=t.charAt(l),h,p;if(n===!1&&c==="="){n=t.slice(r,l),r=l+1,i=t.charAt(r)==='"'||t.charAt(r)==="'"?r:Z4e(t,l+1);continue}if(n!==!1&&l===i){if(p=t.indexOf(c,l+1),p===-1)break;h=R0.trim(t.slice(i+1,p)),a(n,h),n=!1,l=p,r=l+1;continue}if(/\s|\n|\t/.test(c))if(t=t.replace(/\s|\n|\t/g," "),n===!1)if(p=W4e(t,l),p===-1){h=R0.trim(t.slice(r,l)),a(h),n=!1,r=l+1;continue}else{l=p-1;continue}else if(p=X4e(t,l-1),p===-1){h=R0.trim(t.slice(r,l)),h=SK(h),a(n,h),n=!1,r=l+1;continue}else continue}return r<t.length&&(n===!1?a(t.slice(r)):a(n,SK(R0.trim(t.slice(r))))),R0.trim(s.join(" "))}function W4e(t,e){for(;e<t.length;e++){var r=t[e];if(r!==" ")return r==="="?e:-1}}function Z4e(t,e){for(;e<t.length;e++){var r=t[e];if(r!==" ")return r==="'"||r==='"'?e:-1}}function X4e(t,e){for(;e>0;e--){var r=t[e];if(r!==" ")return r==="="?e:-1}}function Y4e(t){return t[0]==='"'&&t[t.length-1]==='"'||t[0]==="'"&&t[t.length-1]==="'"}function SK(t){return Y4e(t)?t.substr(1,t.length-2):t}FF.parseTag=j4e;FF.parseAttr=q4e;var J4e=EO.exports.FilterCSS,Rd=Xs,bme=FF,Q4e=bme.parseTag,K4e=bme.parseAttr,B$=wW;function FP(t){return t==null}function eFe(t){var e=B$.spaceIndex(t);if(e===-1)return{html:"",closing:t[t.length-2]==="/"};t=B$.trim(t.slice(e+1,-1));var r=t[t.length-1]==="/";return r&&(t=B$.trim(t.slice(0,-1))),{html:t,closing:r}}function tFe(t){var e={};for(var r in t)e[r]=t[r];return e}function rFe(t){var e={};for(var r in t)Array.isArray(t[r])?e[r.toLowerCase()]=t[r].map(function(i){return i.toLowerCase()}):e[r.toLowerCase()]=t[r];return e}function wme(t){t=tFe(t||{}),t.stripIgnoreTag&&(t.onIgnoreTag&&console.error('Notes: cannot use these two options "stripIgnoreTag" and "onIgnoreTag" at the same time'),t.onIgnoreTag=Rd.onIgnoreTagStripAll),t.whiteList||t.allowList?t.whiteList=rFe(t.whiteList||t.allowList):t.whiteList=Rd.whiteList,t.onTag=t.onTag||Rd.onTag,t.onTagAttr=t.onTagAttr||Rd.onTagAttr,t.onIgnoreTag=t.onIgnoreTag||Rd.onIgnoreTag,t.onIgnoreTagAttr=t.onIgnoreTagAttr||Rd.onIgnoreTagAttr,t.safeAttrValue=t.safeAttrValue||Rd.safeAttrValue,t.escapeHtml=t.escapeHtml||Rd.escapeHtml,this.options=t,t.css===!1?this.cssFilter=!1:(t.css=t.css||{},this.cssFilter=new J4e(t.css))}wme.prototype.process=function(t){if(t=t||"",t=t.toString(),!t)return"";var e=this,r=e.options,i=r.whiteList,s=r.onTag,n=r.onIgnoreTag,o=r.onTagAttr,a=r.onIgnoreTagAttr,l=r.safeAttrValue,c=r.escapeHtml,h=e.cssFilter;r.stripBlankChar&&(t=Rd.stripBlankChar(t)),r.allowCommentTag||(t=Rd.stripCommentTag(t));var p=!1;r.stripIgnoreTagBody&&(p=Rd.StripTagBody(r.stripIgnoreTagBody,n),n=p.onIgnoreTag);var f=Q4e(t,function(m,y,_,v,w){var x={sourcePosition:m,position:y,isClosing:w,isWhite:Object.prototype.hasOwnProperty.call(i,_)},T=s(_,v,x);if(!FP(T))return T;if(x.isWhite){if(x.isClosing)return"</"+_+">";var S=eFe(v),O=i[_],A=K4e(S.html,function(I,M){var k=B$.indexOf(O,I)!==-1,L=o(_,I,M,k);return FP(L)?k?(M=l(_,I,M,h),M?I+'="'+M+'"':I):(L=a(_,I,M,k),FP(L)?void 0:L):L});return v="<"+_,A&&(v+=" "+A),S.closing&&(v+=" /"),v+=">",v}else return T=n(_,v,x),FP(T)?c(v):T},c);return p&&(f=p.remove(f)),f};var iFe=wme;(function(t,e){var r=Xs,i=FF,s=iFe;function n(a,l){var c=new s(l);return c.process(a)}e=t.exports=n,e.filterXSS=n,e.FilterXSS=s,function(){for(var a in r)e[a]=r[a];for(var l in i)e[l]=i[l]}();function o(){return typeof self<"u"&&typeof DedicatedWorkerGlobalScope<"u"&&self instanceof DedicatedWorkerGlobalScope}o()&&(self.filterXSS=t.exports)})(W1,W1.exports);var sFe=function(){function t(e,r){var i=this;this.arcgisWhiteList={a:["href","style","target"],abbr:["title"],audio:["autoplay","controls","loop","muted","preload"],b:[],br:[],dd:["style"],div:["align","style"],dl:["style"],dt:["style"],em:[],figcaption:["style"],figure:["style"],font:["color","face","size","style"],h1:["style"],h2:["style"],h3:["style"],h4:["style"],h5:["style"],h6:["style"],hr:[],i:[],img:["alt","border","height","src","style","width"],li:[],ol:[],p:["style"],source:["media","src","type"],span:["style"],strong:[],sub:["style"],sup:["style"],table:["border","cellpadding","cellspacing","height","style","width"],tbody:[],tr:["align","height","style","valign"],td:["align","colspan","height","nowrap","rowspan","style","valign","width"],th:["align","colspan","height","nowrap","rowspan","style","valign","width"],u:[],ul:[],video:["autoplay","controls","height","loop","muted","poster","preload","width"]},this.allowedProtocols=["http","https","mailto","iform","tel","flow","lfmobile","arcgis-navigator","arcgis-appstudio-player","arcgis-survey123","arcgis-collector","arcgis-workforce","arcgis-explorer","arcgis-trek2there","arcgis-quickcapture","mspbi","comgooglemaps","pdfefile","pdfehttp","pdfehttps","boxapp","boxemm","awb","awbs","gropen","radarscope"],this.arcgisFilterOptions={allowCommentTag:!0,safeAttrValue:function(n,o,a,l){return n==="a"&&o==="href"||(n==="img"||n==="source")&&o==="src"?i.sanitizeUrl(a):W1.exports.safeAttrValue(n,o,a,l)}},this._entityMap={"&":"&#x38;","<":"&#x3C;",">":"&#x3E;",'"':"&#x22;","'":"&#x27;","/":"&#x2F;"};var s;e&&!r?s=e:e&&r?(s=Object.create(this.arcgisFilterOptions),Object.keys(e).forEach(function(n){n==="whiteList"?s.whiteList=i._extendObjectOfArrays([i.arcgisWhiteList,e.whiteList||{}]):s[n]=e[n]})):(s=Object.create(this.arcgisFilterOptions),s.whiteList=this.arcgisWhiteList),this.xssFilterOptions=s,this._xssFilter=new W1.exports.FilterXSS(s)}return t.prototype.sanitize=function(e,r){switch(r===void 0&&(r={}),typeof e){case"number":return isNaN(e)||!isFinite(e)?null:e;case"boolean":return e;case"string":return this._xssFilter.process(e);case"object":return this._iterateOverObject(e,r);default:return r.allowUndefined&&typeof e>"u"?void 0:null}},t.prototype.sanitizeUrl=function(e,r){var i=(r??{}).isProtocolRequired,s=i===void 0?!0:i,n=this._trim(e.substring(0,e.indexOf(":"))),o=e==="/",a=/^#/.test(e),l=n&&this.allowedProtocols.indexOf(n.toLowerCase())>-1;return o||a||l?W1.exports.escapeAttrValue(e):!n&&!s?W1.exports.escapeAttrValue("https://".concat(e)):""},t.prototype.sanitizeHTMLAttribute=function(e,r,i,s){return typeof this.xssFilterOptions.safeAttrValue=="function"?this.xssFilterOptions.safeAttrValue(e,r,i,s):W1.exports.safeAttrValue(e,r,i,s)},t.prototype.validate=function(e,r){r===void 0&&(r={});var i=this.sanitize(e,r);return{isValid:e===i,sanitized:i}},t.prototype.encodeHTML=function(e){var r=this;return String(e).replace(/[&<>"'\/]/g,function(i){return r._entityMap[i]})},t.prototype.encodeAttrValue=function(e){var r=/^[a-zA-Z0-9]$/;return String(e).replace(/[\x00-\xFF]/g,function(i,s){return r.test(i)?i:"&#x".concat(Number(e.charCodeAt(s)).toString(16),";")})},t.prototype._extendObjectOfArrays=function(e){var r={};return e.forEach(function(i){Object.keys(i).forEach(function(s){Array.isArray(i[s])&&Array.isArray(r[s])?r[s]=r[s].concat(i[s]):r[s]=i[s]})}),r},t.prototype._iterateOverObject=function(e,r){var i=this;r===void 0&&(r={});try{var s=!1,n=void 0;if(Array.isArray(e))n=e.reduce(function(a,l){var c=i.validate(l,r);return c.isValid?a.concat([l]):(s=!0,a.concat([c.sanitized]))},[]);else if(p4e(e)){var o=Object.keys(e);n=o.reduce(function(a,l){var c=e[l],h=i.validate(c,r);return h.isValid?a[l]=c:(s=!0,a[l]=h.sanitized),a},{})}else return r.allowUndefined&&typeof e>"u"?void 0:null;return s?n:e}catch{return null}},t.prototype._trim=function(e){return String.prototype.trim?e.trim():e.replace(/(^\s*)|(\s*$)/g,"")},t}();const UF=new Map;function xme(){UF.clear()}function nFe(t){return UF.get(t)}function oFe(t,e){UF.set(t,e)}function iU(t){UF.delete(t)}var Yb,i2,aFe=function(t){if("WebkitTransition"in t.style)Yb="webkitTransitionEnd",i2="webkitAnimationEnd";else{if(!("transition"in t.style))throw new Error("Your browser is not supported!");Yb="transitionend",i2="animationend"}},Tme=function(t){Yb||aFe(t)},lFe=function(t,e){return e===void 0&&(e=t+"-active"),function(r){Tme(r);var i=!1,s=function(n){i||(i=!0,r.removeEventListener(Yb,s),r.removeEventListener(i2,s),r.classList.remove(t),r.classList.remove(e))};r.classList.add(t),r.addEventListener(Yb,s),r.addEventListener(i2,s),requestAnimationFrame(function(){r.classList.add(e)})}},cFe=function(t,e){return e===void 0&&(e=t+"-active"),function(r,i){Tme(r);var s=!1,n=function(o){s||(s=!0,r.removeEventListener(Yb,n),r.removeEventListener(i2,n),i())};r.classList.add(t),r.addEventListener(Yb,n),r.addEventListener(i2,n),requestAnimationFrame(function(){r.classList.add(e)})}};const uFe=Q.getLogger("esri.widgets.support.widgetUtils");function hFe(t){const e=oc.acquire();for(let i=0;i<arguments.length;i++){const s=arguments[i],n=typeof s;if(n==="string")e.push(s);else if(Array.isArray(s))e.push.apply(e,s);else if(n==="object")for(const o in s)s[o]&&e.push(o)}const r=e.join(" ");return oc.release(e),r}(()=>{const t=new Map,e=new ResizeObserver(i=>{xme();for(const s of i)t.get(s.target)?.(s)}),r=(i,s,n)=>(t.has(i)&&uFe.error("Already observing element",i),t.set(i,s),e.observe(i,n),bo(()=>{e.unobserve(i),t.delete(i)}));return(i,s,n)=>{let o=null;return le(()=>typeof i=="function"?i():i,a=>{o?.remove(),a&&(o=r(a,s,n))},As)}})();function Sme(t){const e=t?.closest("[dir]");return e!==null&&e instanceof HTMLElement&&e.dir==="rtl"||document.dir==="rtl"}function c2t(t){return Sme(t)?"rtl":"ltr"}function u2t(t){const e="data-node-ref";this[t.getAttribute(e)]=null}function EK(t){const e="data-node-ref";this[t.getAttribute(e)]=t}function h2t(t,e){return(t==="enter"?lFe:cFe)(e)}const dFe=["dd","dl","dt","h1","h2","h3","h4","h5","h6","sub","sup","animate","animatetransform","circle","clippath","defs","ellipse","g","image","line","lineargradient","marker","mask","path","pattern","polygon","polyline","radialgradient","rect","stop","svg","switch","symbol","text","textpath","tspan","use"],pFe=dFe.reduce((t,e)=>(t[e]=[],t),{}),fFe=["align","alink","alt","bgcolor","border","cellpadding","cellspacing","class","color","cols","colspan","coords","d","dir","face","height","hspace","ismap","lang","marginheight","marginwidth","multiple","nohref","noresize","noshade","nowrap","ref","rel","rev","rows","rowspan","scrolling","shape","span","summary","tabindex","title","usemap","valign","value","vlink","vspace","width"],Eme=new sFe({whiteList:pFe,onTagAttr:(t,e,r)=>{const i=`${e}="${r}"`;if(fFe.includes(e))return i},stripIgnoreTag:!0,stripIgnoreTagBody:["script","style"]},!0);function mFe(t){return t==="Enter"||t===" "}const Cme="http://www.w3.org/",kF=`${Cme}2000/svg`,Ame=`${Cme}1999/xlink`;let CK=[],xW=(t,e)=>{let r={};return Object.keys(t).forEach(i=>{r[i]=t[i]}),e&&Object.keys(e).forEach(i=>{r[i]=e[i]}),r},TW=(t,e)=>t.vnodeSelector===e.vnodeSelector&&(t.properties&&e.properties?t.properties.key===e.properties.key&&t.properties.bind===e.properties.bind:!t.properties&&!e.properties),Ome=t=>{if(typeof t!="string")throw new Error("Style values must be strings")},gFe=(t,e,r)=>{if(e.vnodeSelector!==""){for(let i=r;i<t.length;i++)if(TW(t[i],e))return i}return-1},sU=(t,e,r,i)=>{let s=t[e];if(s.vnodeSelector==="")return;let n=s.properties;if(!(n&&(n.key===void 0?n.bind:n.key))){for(let o=0;o<t.length;o++)if(o!==e){let a=t[o];if(TW(a,s))throw new Error(`${r.vnodeSelector} had a ${s.vnodeSelector} child ${i==="added"?i:"removed"}, but there is now more than one. You must add unique key properties to make them distinguishable.`)}}},yFe=t=>{if(t.properties){let e=t.properties.enterAnimation;e&&e(t.domNode,t.properties)}},PV=[],MV=!1,Rme=t=>{(t.children||[]).forEach(Rme),t.properties&&t.properties.afterRemoved&&t.properties.afterRemoved.apply(t.properties.bind||t.properties,[t.domNode])},AK=()=>{MV=!1,PV.forEach(Rme),PV.length=0},OK=t=>{PV.push(t),MV||(MV=!0,typeof window<"u"&&"requestIdleCallback"in window?window.requestIdleCallback(AK,{timeout:16}):setTimeout(AK,16))},RK=t=>{let e=t.domNode;if(t.properties){let r=t.properties.exitAnimation;if(r)return e.style.pointerEvents="none",void r(e,()=>{e.parentNode&&(e.parentNode.removeChild(e),OK(t))},t.properties)}e.parentNode&&(e.parentNode.removeChild(e),OK(t))},_Fe=(t,e,r)=>{if(!e)return;let i=r.eventHandlerInterceptor,s=Object.keys(e),n=s.length;for(let o=0;o<n;o++){let a=s[o],l=e[a];if(a==="className")throw new Error('Property "className" is not supported, use "class".');if(a==="class")IV(t,l,!0);else if(a==="classes"){let c=Object.keys(l),h=c.length;for(let p=0;p<h;p++){let f=c[p];l[f]&&t.classList.add(f)}}else if(a==="styles"){let c=Object.keys(l),h=c.length;for(let p=0;p<h;p++){let f=c[p],m=l[f];m&&(Ome(m),r.styleApplyer(t,f,m))}}else if(a!=="key"&&l!=null){let c=typeof l;c==="function"?(a.lastIndexOf("on",0)===0&&(i&&(l=i(a,l,t,e)),a==="oninput"&&function(){let h=l;l=function(p){h.apply(this,[p]),p.target["oninput-value"]=p.target.value}}()),t[a]=l):r.namespace===kF?a==="href"?t.setAttributeNS(Ame,a,l):t.setAttribute(a,l):c==="string"&&a!=="value"?a==="innerHTML"?t[a]=Eme.sanitize(l):Pme(t)&&a in t?t[a]=l:t.setAttribute(a,l):t[a]=l}}};function Pme(t){if(!(t instanceof Element&&t.tagName.includes("-")))return!1;const e=window.customElements.get(t.tagName.toLowerCase());return!!e&&t instanceof e}let dN,vFe=(t,e,r)=>{if(e)for(let i of e)eS(i,t,void 0,r)},Mme=(t,e,r)=>{vFe(t,e.children,r),e.text&&(t.textContent=e.text),_Fe(t,e.properties,r),e.properties&&e.properties.afterCreate&&e.properties.afterCreate.apply(e.properties.bind||e.properties,[t,r,e.vnodeSelector,e.properties,e.children])},eS=(t,e,r,i)=>{let s,n=0,o=t.vnodeSelector,a=e.ownerDocument;if(o==="")s=t.domNode=a.createTextNode(t.text),r!==void 0?e.insertBefore(s,r):e.appendChild(s);else{for(let l=0;l<=o.length;++l){let c=o.charAt(l);if(l===o.length||c==="."||c==="#"){let h=o.charAt(n-1),p=o.slice(n,l);h==="."?s.classList.add(p):h==="#"?s.id=p:(p==="svg"&&(i=xW(i,{namespace:kF})),i.namespace!==void 0?s=t.domNode=a.createElementNS(i.namespace,p):(s=t.domNode=t.domNode||a.createElement(p),p==="input"&&t.properties&&t.properties.type!==void 0&&s.setAttribute("type",t.properties.type)),r!==void 0?e.insertBefore(s,r):s.parentNode!==e&&e.appendChild(s)),n=l+1}}Mme(s,t,i)}},IV=(t,e,r)=>{e&&e.split(" ").forEach(i=>{i&&t.classList.toggle(i,r)})},bFe=(t,e,r,i)=>{if(!r)return;let s=!1,n=Object.keys(r),o=n.length;for(let a=0;a<o;a++){let l=n[a],c=r[l],h=e[l];if(l==="class")h!==c&&(IV(t,h,!1),IV(t,c,!0));else if(l==="classes"){let p=t.classList,f=Object.keys(c),m=f.length;for(let y=0;y<m;y++){let _=f[y],v=!!c[_];v!==!!h[_]&&(s=!0,v?p.add(_):p.remove(_))}}else if(l==="styles"){let p=Object.keys(c),f=p.length;for(let m=0;m<f;m++){let y=p[m],_=c[y];_!==h[y]&&(s=!0,_?(Ome(_),i.styleApplyer(t,y,_)):i.styleApplyer(t,y,""))}}else if(c||typeof h!="string"||(c=""),l==="value"){let p=t[l];p!==c&&(t["oninput-value"]?p===t["oninput-value"]:c!==h)&&(t[l]=c,t["oninput-value"]=void 0),c!==h&&(s=!0)}else if(c!==h){let p=typeof c;p==="function"&&i.eventHandlerInterceptor||(i.namespace===kF?l==="href"?t.setAttributeNS(Ame,l,c):t.setAttribute(l,c):p==="string"?l==="innerHTML"?t[l]=Eme.sanitize(c):l==="role"&&c===""?t.removeAttribute(l):Pme(t)&&l in t?t[l]=c:t.setAttribute(l,c):t[l]!==c&&(t[l]=c),s=!0)}}return s},wFe=(t,e,r,i,s)=>{if(r===i)return!1;i=i||CK;let n,o=(r=r||CK).length,a=i.length,l=0,c=0,h=!1;for(;c<a;){let p=l<o?r[l]:void 0,f=i[c];if(p!==void 0&&TW(p,f))h=dN(p,f,s)||h,l++;else{let m=gFe(r,f,l+1);if(m>=0){for(n=l;n<m;n++)RK(r[n]),sU(r,n,t,"removed");h=dN(r[m],f,s)||h,l=m+1}else eS(f,e,l<o?r[l].domNode:void 0,s),yFe(f),sU(i,c,t,"added")}c++}if(o>l)for(n=l;n<o;n++)RK(r[n]),sU(r,n,t,"removed");return h};dN=(t,e,r)=>{let i=t.domNode,s=!1;if(t===e)return!1;let n=!1;if(e.vnodeSelector===""){if(e.text!==t.text){let o=i.ownerDocument.createTextNode(e.text);return i.parentNode.replaceChild(o,i),e.domNode=o,s=!0,s}e.domNode=i}else e.vnodeSelector.lastIndexOf("svg",0)===0&&(r=xW(r,{namespace:kF})),t.text!==e.text&&(n=!0,e.text===void 0?i.removeChild(i.firstChild):i.textContent=e.text),e.domNode=i,n=wFe(e,i,t.children,e.children,r)||n,n=bFe(i,t.properties,e.properties,r)||n,e.properties&&e.properties.afterUpdate&&e.properties.afterUpdate.apply(e.properties.bind||e.properties,[i,r,e.vnodeSelector,e.properties,e.children]);return n&&e.properties&&e.properties.updateAnimation&&e.properties.updateAnimation(i,e.properties,t.properties),s};let FE=(t,e)=>({getLastRender:()=>t,update:r=>{if(t.vnodeSelector!==r.vnodeSelector)throw new Error("The selector for the root VNode may not be changed. (consider using dom.merge and add one extra level to the virtual DOM)");let i=t;t=r,dN(i,r,e)},domNode:t.domNode});const xFe={namespace:void 0,performanceLogger:()=>{},eventHandlerInterceptor:void 0,styleApplyer:(t,e,r)=>{e.charAt(0)==="-"?t.style.setProperty(e,r):t.style[e]=r}};let tT=t=>xW(xFe,t),J0={create:(t,e)=>(e=tT(e),eS(t,document.createElement("div"),void 0,e),FE(t,e)),append:(t,e,r)=>(r=tT(r),eS(e,t,void 0,r),FE(e,r)),insertBefore:(t,e,r)=>(r=tT(r),eS(e,t.parentNode,t,r),FE(e,r)),merge:(t,e,r)=>(r=tT(r),e.domNode=t,Mme(t,e,r),FE(e,r)),replace:(t,e,r)=>(r=tT(r),eS(e,t.parentNode,t,r),t.parentNode.removeChild(t),FE(e,r))},Ime,TFe=(t,e)=>{let r=[];for(;t&&t!==e;)r.push(t),t=t.parentNode;return r};Ime=Array.prototype.find?(t,e)=>t.find(e):(t,e)=>t.filter(e)[0];let SFe=(t,e)=>{let r=t;return e.forEach(i=>{r=r&&r.children?Ime(r.children,s=>s.domNode===i):void 0}),r},EFe=(t,e,r)=>{let i=function(s){r("domEvent",s);let n=e(),o=TFe(s.currentTarget,n.domNode);o.reverse();let a,l=SFe(n.getLastRender(),o);return t.scheduleRender(),l&&(a=l.properties[`on${s.type}`].apply(l.properties.bind||this,arguments)),r("domEventProcessed",s),a};return(s,n,o,a)=>i},PK=t=>{let e,r,i=tT(t),s=i.performanceLogger,n=!0,o=!1,a=[],l=[],c=(p,f,m)=>{let y,_=()=>y;i.eventHandlerInterceptor=EFe(e,_,s),y=p(f,m(),i),a.push(y),l.push(m)},h=()=>{if(r=void 0,n){n=!1,s("renderStart",void 0);for(let p=0;p<a.length;p++){let f=l[p]();s("rendered",void 0),a[p].update(f),s("patched",void 0)}s("renderDone",void 0),n=!0}};return e={renderNow:h,scheduleRender:()=>{r||o||(r=requestAnimationFrame(h))},stop:()=>{r&&(cancelAnimationFrame(r),r=void 0),o=!0},resume:()=>{o=!1,n=!0,e.scheduleRender()},append:(p,f)=>{c(J0.append,p,f)},insertBefore:(p,f)=>{c(J0.insertBefore,p,f)},merge:(p,f)=>{c(J0.merge,p,f)},replace:(p,f)=>{c(J0.replace,p,f)},detach:p=>{for(let f=0;f<l.length;f++)if(l[f]===p)return l.splice(f,1),a.splice(f,1)[0];throw new Error("renderFunction was not found")}},e};const CFe={handleInterceptedEvent:(t,e,r,i)=>(t.scheduleRender(),e.properties[`on${i.type}`].apply(e.properties.bind||r,[i]))},AFe={namespace:void 0,performanceLogger:()=>{},eventHandlerInterceptor:void 0,styleApplyer:(t,e,r)=>{t.style[e]=r}},OFe=t=>({...AFe,...t}),RFe=(t,e)=>{const r=[];for(;t&&t!==e;)r.push(t),t=t.parentNode;return r},PFe=(t,e)=>t.find(e),MK=(t,e,r=!1)=>{let i=t;return e.forEach((s,n)=>{const o=i?.children?PFe(i.children,a=>a.domNode===s):void 0;r&&!o&&n!==e.length-1||(i=o)}),i},MFe=t=>{let e;const r={...CFe,...t},i=OFe(r),s=i.performanceLogger;let n,o=!0,a=!1;const l=[],c=[],h=(f,m,y)=>{let _;i.eventHandlerInterceptor=(w,x,T,S)=>function(O){let A;s("domEvent",O);const I=RFe(O.currentTarget,_.domNode),M=I.some(L=>customElements.get(L?.tagName?.toLowerCase()));if(O.eventPhase===Event.CAPTURING_PHASE||!M)I.reverse(),A=MK(_.getLastRender(),I);else{const L=O.composedPath(),D=L.slice(L.indexOf(O.currentTarget),L.indexOf(_.domNode)).filter(U=>U.getRootNode()===U.ownerDocument).reverse();A=MK(_.getLastRender(),D,!0)}let k;return A&&(k=r.handleInterceptedEvent(e,A,this,O)),s("domEventProcessed",O),k},r.postProcessProjectionOptions?.(i);const v=y();_=f(m,v,i),l.push(_),c.push(y),r.afterFirstVNodeRendered&&r.afterFirstVNodeRendered(_,v)};let p=()=>{if(n=void 0,o){o=!1,s("renderStart",void 0);for(let f=0;f<l.length;f++){const m=c[f]();s("rendered",void 0),l[f].update(m),s("patched",void 0)}s("renderDone",void 0),o=!0}};return r.modifyDoRenderImplementation&&(p=r.modifyDoRenderImplementation(p,l,c)),e={renderNow:p,scheduleRender:()=>{n||a||(n=requestAnimationFrame(p))},stop:()=>{n&&(cancelAnimationFrame(n),n=void 0),a=!0},resume:()=>{a=!1,o=!0,e.scheduleRender()},append:(f,m)=>{h(J0.append,f,m)},insertBefore:(f,m)=>{h(J0.insertBefore,f,m)},merge:(f,m)=>{h(J0.merge,f,m)},replace:(f,m)=>{h(J0.replace,f,m)},detach:f=>{for(let m=0;m<c.length;m++)if(c[m]===f)return c.splice(m,1),l.splice(m,1)[0];throw new Error("renderFunction was not found")}},e},rT={allRenderFn:!1,cmpDidLoad:!0,cmpDidUnload:!1,cmpDidUpdate:!0,cmpDidRender:!0,cmpWillLoad:!0,cmpWillUpdate:!0,cmpWillRender:!0,connectedCallback:!0,disconnectedCallback:!0,element:!0,event:!0,hasRenderFn:!0,lifecycle:!0,hostListener:!0,hostListenerTargetWindow:!0,hostListenerTargetDocument:!0,hostListenerTargetBody:!0,hostListenerTargetParent:!1,hostListenerTarget:!0,member:!0,method:!0,mode:!0,observeAttribute:!0,prop:!0,propMutable:!0,reflect:!0,scoped:!0,shadowDom:!0,slot:!0,cssAnnotations:!0,state:!0,style:!0,svg:!0,updatable:!0,vdomAttribute:!0,vdomXlink:!0,vdomClass:!0,vdomFunctional:!0,vdomKey:!0,vdomListener:!0,vdomRef:!0,vdomPropOrAttr:!0,vdomRender:!0,vdomStyle:!0,vdomText:!0,watchCallback:!0,taskQueue:!0,hotModuleReplacement:!1,isDebug:!1,isDev:!1,isTesting:!1,hydrateServerSide:!1,hydrateClientSide:!1,lifecycleDOMEvents:!1,lazyLoad:!1,profile:!1,slotRelocation:!0,appendChildSlotFix:!1,cloneNodeFix:!1,hydratedAttribute:!1,hydratedClass:!0,safari10:!1,scriptDataOpts:!1,scopedSlotTextContentFix:!1,shadowDomShim:!1,slotChildNodesFix:!1,invisiblePrehydration:!0,propBoolean:!0,propNumber:!0,propString:!0,cssVarShim:!1,constructableCSS:!0,cmpShouldUpdate:!0,devTools:!1,dynamicImportShim:!1,shadowDelegatesFocus:!0,initializeNextTick:!1,asyncLoading:!1,asyncQueue:!1,transformTagName:!1,attachStyles:!0};let iT,$me,VF,Lme=!1,pN=!1,SW=!1,Wc=!1,IK=null,$V=!1;const IFe=t=>{const e=new URL(t,Ho.$resourcesUrl$);return e.origin!==LR.location.origin?e.href:e.pathname},$Fe=t=>Ho.$resourcesUrl$=t,Jb=(t,e="")=>()=>{},$K="http://www.w3.org/1999/xlink",LK={},LFe="http://www.w3.org/2000/svg",DFe="http://www.w3.org/1999/xhtml",NFe=t=>t!=null,EW=t=>(t=typeof t,t==="object"||t==="function");function FFe(t){var e,r,i;return(i=(r=(e=t.head)===null||e===void 0?void 0:e.querySelector('meta[name="csp-nonce"]'))===null||r===void 0?void 0:r.getAttribute("content"))!==null&&i!==void 0?i:void 0}const Dme=(t,e,...r)=>{let i=null,s=null,n=null,o=!1,a=!1;const l=[],c=p=>{for(let f=0;f<p.length;f++)i=p[f],Array.isArray(i)?c(i):i!=null&&typeof i!="boolean"&&((o=typeof t!="function"&&!EW(i))&&(i=String(i)),o&&a?l[l.length-1].$text$+=i:l.push(o?fN(null,i):i),a=o)};if(c(r),e){e.key&&(s=e.key),e.name&&(n=e.name);{const p=e.className||e.class;p&&(e.class=typeof p!="object"?p:Object.keys(p).filter(f=>p[f]).join(" "))}}if(typeof t=="function")return t(e===null?{}:e,l,VFe);const h=fN(t,null);return h.$attrs$=e,l.length>0&&(h.$children$=l),h.$key$=s,h.$name$=n,h},fN=(t,e)=>{const r={$flags$:0,$tag$:t,$text$:e,$elm$:null,$children$:null};return r.$attrs$=null,r.$key$=null,r.$name$=null,r},UFe={},kFe=t=>t&&t.$tag$===UFe,VFe={forEach:(t,e)=>t.map(DK).forEach(e),map:(t,e)=>t.map(DK).map(e).map(zFe)},DK=t=>({vattrs:t.$attrs$,vchildren:t.$children$,vkey:t.$key$,vname:t.$name$,vtag:t.$tag$,vtext:t.$text$}),zFe=t=>{if(typeof t.vtag=="function"){const r=Object.assign({},t.vattrs);return t.vkey&&(r.key=t.vkey),t.vname&&(r.name=t.vname),Dme(t.vtag,r,...t.vchildren||[])}const e=fN(t.vtag,t.vtext);return e.$attrs$=t.vattrs,e.$children$=t.vchildren,e.$key$=t.vkey,e.$name$=t.vname,e},BFe=t=>m5e.map(e=>e(t)).find(e=>!!e),GFe=(t,e)=>t!=null&&!EW(t)?e&4?t==="false"?!1:t===""||!!t:e&2?parseFloat(t):e&1?String(t):t:t,jFe=t=>t,d2t=(t,e,r)=>{const i=jFe(t);return{emit:s=>HFe(i,e,{bubbles:!!(r&4),composed:!!(r&2),cancelable:!!(r&1),detail:s})}},HFe=(t,e,r)=>{const i=Ho.ce(e,r);return t.dispatchEvent(i),i},NK=new WeakMap,qFe=(t,e,r)=>{let i=gN.get(t);_5e&&r?(i=i||new CSSStyleSheet,typeof i=="string"?i=e:i.replaceSync(e)):i=e,gN.set(t,i)},WFe=(t,e,r,i)=>{var s;let n=Nme(e,r);const o=gN.get(n);if(t=t.nodeType===11?t:Qd,o)if(typeof o=="string"){t=t.head||t;let a=NK.get(t),l;if(a||NK.set(t,a=new Set),!a.has(n)){{l=Qd.createElement("style"),l.innerHTML=o;const c=(s=Ho.$nonce$)!==null&&s!==void 0?s:FFe(Qd);c!=null&&l.setAttribute("nonce",c),t.insertBefore(l,t.querySelector("link"))}a&&a.add(n)}}else t.adoptedStyleSheets.includes(o)||(t.adoptedStyleSheets=[...t.adoptedStyleSheets,o]);return n},ZFe=t=>{const e=t.$cmpMeta$,r=t.$hostElement$,i=e.$flags$,s=Jb("attachStyles",e.$tagName$),n=WFe(r.shadowRoot?r.shadowRoot:r.getRootNode(),e,t.$modeName$);i&10&&(r["s-sc"]=n,r.classList.add(n+"-h"),i&2&&r.classList.add(n+"-s")),s()},Nme=(t,e)=>"sc-"+(e&&t.$flags$&32?t.$tagName$+"-"+e:t.$tagName$),FK=(t,e,r,i,s,n)=>{if(r!==i){let o=zK(t,e),a=e.toLowerCase();if(e==="class"){const l=t.classList,c=UK(r),h=UK(i);l.remove(...c.filter(p=>p&&!h.includes(p))),l.add(...h.filter(p=>p&&!c.includes(p)))}else if(e==="style"){for(const l in r)(!i||i[l]==null)&&(l.includes("-")?t.style.removeProperty(l):t.style[l]="");for(const l in i)(!r||i[l]!==r[l])&&(l.includes("-")?t.style.setProperty(l,i[l]):t.style[l]=i[l])}else if(e!=="key")if(e==="ref")i&&i(t);else if(!t.__lookupSetter__(e)&&e[0]==="o"&&e[1]==="n")e[2]==="-"?e=e.slice(3):zK(LR,a)?e=a.slice(2):e=a[2]+e.slice(3),r&&Ho.rel(t,e,r,!1),i&&Ho.ael(t,e,i,!1);else{const l=EW(i);if((o||l&&i!==null)&&!s)try{if(t.tagName.includes("-"))t[e]=i;else{const h=i??"";e==="list"?o=!1:(r==null||t[e]!=h)&&(t[e]=h)}}catch{}let c=!1;a!==(a=a.replace(/^xlink\:?/,""))&&(e=a,c=!0),i==null||i===!1?(i!==!1||t.getAttribute(e)==="")&&(c?t.removeAttributeNS($K,e):t.removeAttribute(e)):(!o||n&4||s)&&!l&&(i=i===!0?"":i,c?t.setAttributeNS($K,e,i):t.setAttribute(e,i))}}},XFe=/\s/,UK=t=>t?t.split(XFe):[],Fme=(t,e,r,i)=>{const s=e.$elm$.nodeType===11&&e.$elm$.host?e.$elm$.host:e.$elm$,n=t&&t.$attrs$||LK,o=e.$attrs$||LK;for(i in n)i in o||FK(s,i,n[i],void 0,r,e.$flags$);for(i in o)FK(s,i,n[i],o[i],r,e.$flags$)},mN=(t,e,r,i)=>{const s=e.$children$[r];let n=0,o,a,l;if(Lme||(SW=!0,s.$tag$==="slot"&&(iT&&i.classList.add(iT+"-s"),s.$flags$|=s.$children$?2:1)),s.$text$!==null)o=s.$elm$=Qd.createTextNode(s.$text$);else if(s.$flags$&1)o=s.$elm$=Qd.createTextNode("");else{if(Wc||(Wc=s.$tag$==="svg"),o=s.$elm$=Qd.createElementNS(Wc?LFe:DFe,s.$flags$&2?"slot-fb":s.$tag$),Wc&&s.$tag$==="foreignObject"&&(Wc=!1),Fme(null,s,Wc),NFe(iT)&&o["s-si"]!==iT&&o.classList.add(o["s-si"]=iT),s.$children$)for(n=0;n<s.$children$.length;++n)a=mN(t,s,n,o),a&&o.appendChild(a);s.$tag$==="svg"?Wc=!1:o.tagName==="foreignObject"&&(Wc=!0)}return o["s-hn"]=VF,s.$flags$&3&&(o["s-sr"]=!0,o["s-cr"]=$me,o["s-sn"]=s.$name$||"",l=t&&t.$children$&&t.$children$[r],l&&l.$tag$===s.$tag$&&t.$elm$&&CO(t.$elm$,!1)),o},CO=(t,e)=>{Ho.$flags$|=1;const r=t.childNodes;for(let i=r.length-1;i>=0;i--){const s=r[i];s["s-hn"]!==VF&&s["s-ol"]&&(Vme(s).insertBefore(s,CW(s)),s["s-ol"].remove(),s["s-ol"]=void 0,SW=!0),e&&CO(s,e)}Ho.$flags$&=-2},Ume=(t,e,r,i,s,n)=>{let o=t["s-cr"]&&t["s-cr"].parentNode||t,a;for(o.shadowRoot&&o.tagName===VF&&(o=o.shadowRoot);s<=n;++s)i[s]&&(a=mN(null,r,s,t),a&&(i[s].$elm$=a,o.insertBefore(a,CW(e))))},kme=(t,e,r,i,s)=>{for(;e<=r;++e)(i=t[e])&&(s=i.$elm$,Gme(i),pN=!0,s["s-ol"]?s["s-ol"].remove():CO(s,!0),s.remove())},YFe=(t,e,r,i)=>{let s=0,n=0,o=0,a=0,l=e.length-1,c=e[0],h=e[l],p=i.length-1,f=i[0],m=i[p],y,_;for(;s<=l&&n<=p;)if(c==null)c=e[++s];else if(h==null)h=e[--l];else if(f==null)f=i[++n];else if(m==null)m=i[--p];else if(UP(c,f))sT(c,f),c=e[++s],f=i[++n];else if(UP(h,m))sT(h,m),h=e[--l],m=i[--p];else if(UP(c,m))(c.$tag$==="slot"||m.$tag$==="slot")&&CO(c.$elm$.parentNode,!1),sT(c,m),t.insertBefore(c.$elm$,h.$elm$.nextSibling),c=e[++s],m=i[--p];else if(UP(h,f))(c.$tag$==="slot"||m.$tag$==="slot")&&CO(h.$elm$.parentNode,!1),sT(h,f),t.insertBefore(h.$elm$,c.$elm$),h=e[--l],f=i[++n];else{for(o=-1,a=s;a<=l;++a)if(e[a]&&e[a].$key$!==null&&e[a].$key$===f.$key$){o=a;break}o>=0?(_=e[o],_.$tag$!==f.$tag$?y=mN(e&&e[n],r,o,t):(sT(_,f),e[o]=void 0,y=_.$elm$),f=i[++n]):(y=mN(e&&e[n],r,n,t),f=i[++n]),y&&Vme(c.$elm$).insertBefore(y,CW(c.$elm$))}s>l?Ume(t,i[p+1]==null?null:i[p+1].$elm$,r,i,n,p):n>p&&kme(e,s,l)},UP=(t,e)=>t.$tag$===e.$tag$?t.$tag$==="slot"?t.$name$===e.$name$:t.$key$===e.$key$:!1,CW=t=>t&&t["s-ol"]||t,Vme=t=>(t["s-ol"]?t["s-ol"]:t).parentNode,sT=(t,e)=>{const r=e.$elm$=t.$elm$,i=t.$children$,s=e.$children$,n=e.$tag$,o=e.$text$;let a;o===null?(Wc=n==="svg"?!0:n==="foreignObject"?!1:Wc,n==="slot"||Fme(t,e,Wc),i!==null&&s!==null?YFe(r,i,e,s):s!==null?(t.$text$!==null&&(r.textContent=""),Ume(r,null,e,s,0,s.length-1)):i!==null&&kme(i,0,i.length-1),Wc&&n==="svg"&&(Wc=!1)):(a=r["s-cr"])?a.parentNode.textContent=o:t.$text$!==o&&(r.data=o)},zme=t=>{const e=t.childNodes;let r,i,s,n,o,a;for(i=0,s=e.length;i<s;i++)if(r=e[i],r.nodeType===1){if(r["s-sr"]){for(o=r["s-sn"],r.hidden=!1,n=0;n<s;n++)if(a=e[n].nodeType,e[n]["s-hn"]!==r["s-hn"]||o!==""){if(a===1&&o===e[n].getAttribute("slot")){r.hidden=!0;break}}else if(a===1||a===3&&e[n].textContent.trim()!==""){r.hidden=!0;break}}zme(r)}},Fd=[],Bme=t=>{let e,r,i,s,n,o,a=0;const l=t.childNodes,c=l.length;for(;a<c;a++){if(e=l[a],e["s-sr"]&&(r=e["s-cr"])&&r.parentNode)for(i=r.parentNode.childNodes,s=e["s-sn"],o=i.length-1;o>=0;o--)r=i[o],!r["s-cn"]&&!r["s-nr"]&&r["s-hn"]!==e["s-hn"]&&(kK(r,s)?(n=Fd.find(h=>h.$nodeToRelocate$===r),pN=!0,r["s-sn"]=r["s-sn"]||s,n?n.$slotRefNode$=e:Fd.push({$slotRefNode$:e,$nodeToRelocate$:r}),r["s-sr"]&&Fd.map(h=>{kK(h.$nodeToRelocate$,r["s-sn"])&&(n=Fd.find(p=>p.$nodeToRelocate$===r),n&&!h.$slotRefNode$&&(h.$slotRefNode$=n.$slotRefNode$))})):Fd.some(h=>h.$nodeToRelocate$===r)||Fd.push({$nodeToRelocate$:r}));e.nodeType===1&&Bme(e)}},kK=(t,e)=>t.nodeType===1?t.getAttribute("slot")===null&&e===""||t.getAttribute("slot")===e:t["s-sn"]===e?!0:e==="",Gme=t=>{t.$attrs$&&t.$attrs$.ref&&t.$attrs$.ref(null),t.$children$&&t.$children$.map(Gme)},JFe=(t,e)=>{const r=t.$hostElement$,i=t.$cmpMeta$,s=t.$vnode$||fN(null,null),n=kFe(e)?e:Dme(null,null,e);VF=r.tagName,i.$attrsToReflect$&&(n.$attrs$=n.$attrs$||{},i.$attrsToReflect$.map(([o,a])=>n.$attrs$[a]=r[o])),n.$tag$=null,n.$flags$|=4,t.$vnode$=n,n.$elm$=s.$elm$=r.shadowRoot||r,iT=r["s-sc"],$me=r["s-cr"],Lme=(i.$flags$&1)!==0,pN=!1,sT(s,n);{if(Ho.$flags$|=1,SW){Bme(n.$elm$);let o,a,l,c,h,p,f=0;for(;f<Fd.length;f++)o=Fd[f],a=o.$nodeToRelocate$,a["s-ol"]||(l=Qd.createTextNode(""),l["s-nr"]=a,a.parentNode.insertBefore(a["s-ol"]=l,a));for(f=0;f<Fd.length;f++)if(o=Fd[f],a=o.$nodeToRelocate$,o.$slotRefNode$){for(c=o.$slotRefNode$.parentNode,h=o.$slotRefNode$.nextSibling,l=a["s-ol"];l=l.previousSibling;)if(p=l["s-nr"],p&&p["s-sn"]===a["s-sn"]&&c===p.parentNode&&(p=p.nextSibling,!p||!p["s-nr"])){h=p;break}(!h&&c!==a.parentNode||a.nextSibling!==h)&&a!==h&&(!a["s-hn"]&&a["s-ol"]&&(a["s-hn"]=a["s-ol"].parentNode.nodeName),c.insertBefore(a,h))}else a.nodeType===1&&(a.hidden=!0)}pN&&zme(n.$elm$),Ho.$flags$&=-2,Fd.length=0}},QFe=(t,e)=>{},AW=(t,e)=>(t.$flags$|=16,QFe(t,t.$ancestorComponent$),w5e(()=>KFe(t,e))),KFe=(t,e)=>{const r=t.$hostElement$,i=Jb("scheduleUpdate",t.$cmpMeta$.$tagName$),s=r;let n;return e?n=ES(s,"componentWillLoad"):n=ES(s,"componentWillUpdate"),n=VK(n,()=>ES(s,"componentWillRender")),i(),VK(n,()=>e5e(t,s,e))},e5e=async(t,e,r)=>{const i=t.$hostElement$,s=Jb("update",t.$cmpMeta$.$tagName$);i["s-rc"],r&&ZFe(t);const n=Jb("render",t.$cmpMeta$.$tagName$);t5e(t,e,i),n(),s(),r5e(t)},t5e=(t,e,r)=>{try{IK=e,e=e.render&&e.render(),t.$flags$&=-17,t.$flags$|=2,(rT.hasRenderFn||rT.reflect)&&(rT.vdomRender||rT.reflect)&&(rT.hydrateServerSide||JFe(t,e))}catch(a){$R(a,t.$hostElement$)}return IK=null,null},r5e=t=>{const e=t.$cmpMeta$.$tagName$,r=t.$hostElement$,i=Jb("postUpdate",e),s=r;t.$ancestorComponent$,ES(s,"componentDidRender"),t.$flags$&64?(ES(s,"componentDidUpdate"),i()):(t.$flags$|=64,ES(s,"componentDidLoad"),i())},p2t=t=>{{const e=IR(t),r=e.$hostElement$.isConnected;return r&&(e.$flags$&18)===2&&AW(e,!1),r}},ES=(t,e,r)=>{if(t&&t[e])try{return t[e](r)}catch(i){$R(i)}},VK=(t,e)=>t&&t.then?t.then(e):e(),i5e=(t,e)=>IR(t).$instanceValues$.get(e),s5e=(t,e,r,i)=>{const s=IR(t),n=t,o=s.$instanceValues$.get(e),a=s.$flags$,l=n;r=GFe(r,i.$members$[e][0]);const c=Number.isNaN(o)&&Number.isNaN(r);if(r!==o&&!c){s.$instanceValues$.set(e,r);{if(i.$watchers$&&a&128){const p=i.$watchers$[e];p&&p.map(f=>{try{l[f](r,o,e)}catch(m){$R(m,n)}})}if((a&18)===2){if(l.componentShouldUpdate&&l.componentShouldUpdate(r,o,e)===!1)return;AW(s,!1)}}}},n5e=(t,e,r)=>{if(e.$members$){t.watchers&&(e.$watchers$=t.watchers);const i=Object.entries(e.$members$),s=t.prototype;i.map(([n,[o]])=>{(o&31||o&32)&&Object.defineProperty(s,n,{get(){return i5e(this,n)},set(a){s5e(this,n,a,e)},configurable:!0,enumerable:!0})});{const n=new Map;s.attributeChangedCallback=function(o,a,l){Ho.jmp(()=>{const c=n.get(o);if(this.hasOwnProperty(c))l=this[c],delete this[c];else if(s.hasOwnProperty(c)&&typeof this[c]=="number"&&this[c]==l)return;this[c]=l===null&&typeof this[c]=="boolean"?!1:l})},t.observedAttributes=i.filter(([o,a])=>a[0]&15).map(([o,a])=>{const l=a[1]||o;return n.set(l,o),a[0]&512&&e.$attrsToReflect$.push([o,l]),l})}}return t},o5e=async(t,e,r,i,s)=>{if(!(e.$flags$&32)&&(s=t.constructor,e.$flags$|=32,customElements.whenDefined(r.$tagName$).then(()=>e.$flags$|=128),s.style)){let o=s.style;typeof o!="string"&&(o=o[e.$modeName$=BFe(t)]);const a=Nme(r,e.$modeName$);if(!gN.has(a)){const l=Jb("registerStyles",r.$tagName$);qFe(a,o,!!(r.$flags$&1)),l()}}e.$ancestorComponent$,(()=>AW(e,!0))()},a5e=t=>{},l5e=t=>{if(!(Ho.$flags$&1)){const e=IR(t),r=e.$cmpMeta$,i=Jb("connectedCallback",r.$tagName$);e.$flags$&1?(jme(t,e,r.$listeners$),a5e(e.$lazyInstance$)):(e.$flags$|=1,r.$flags$&12&&c5e(t),r.$members$&&Object.entries(r.$members$).map(([s,[n]])=>{if(n&31&&t.hasOwnProperty(s)){const o=t[s];delete t[s],t[s]=o}}),o5e(t,e,r)),i()}},c5e=t=>{const e=t["s-cr"]=Qd.createComment("");e["s-cn"]=!0,t.insertBefore(e,t.firstChild)},u5e=t=>{if(!(Ho.$flags$&1)){const e=IR(t);e.$rmListeners$&&(e.$rmListeners$.map(r=>r()),e.$rmListeners$=void 0)}},f2t=(t,e)=>{const r={$flags$:e[0],$tagName$:e[1]};r.$members$=e[2],r.$listeners$=e[3],r.$watchers$=t.$watchers$,r.$attrsToReflect$=[];const i=t.prototype.connectedCallback,s=t.prototype.disconnectedCallback;return Object.assign(t.prototype,{__registerHost(){f5e(this,r)},connectedCallback(){l5e(this),i&&i.call(this)},disconnectedCallback(){u5e(this),s&&s.call(this)},__attachShadow(){this.attachShadow({mode:"open",delegatesFocus:!!(r.$flags$&16)})}}),t.is=r.$tagName$,n5e(t,r)},m2t=(t,e)=>e,jme=(t,e,r,i)=>{r&&r.map(([s,n,o])=>{const a=d5e(t,s),l=h5e(e,o),c=p5e(s);Ho.ael(a,n,l,c),(e.$rmListeners$=e.$rmListeners$||[]).push(()=>Ho.rel(a,n,l,c))})},h5e=(t,e)=>r=>{try{rT.lazyLoad||t.$hostElement$[e](r)}catch(i){$R(i)}},d5e=(t,e)=>e&4?Qd:e&8?LR:e&16?Qd.body:t,p5e=t=>g5e?{passive:(t&1)!==0,capture:(t&2)!==0}:(t&2)!==0,Hme=new WeakMap,IR=t=>Hme.get(t),f5e=(t,e)=>{const r={$flags$:0,$hostElement$:t,$cmpMeta$:e,$instanceValues$:new Map};return jme(t,r,e.$listeners$),Hme.set(t,r)},zK=(t,e)=>e in t,$R=(t,e)=>(0,console.error)(t,e),gN=new Map,m5e=[],LR=typeof window<"u"?window:{},Qd=LR.document||{head:{}},g2t=LR.HTMLElement||class{},Ho={$flags$:0,$resourcesUrl$:"",jmp:t=>t(),raf:t=>requestAnimationFrame(t),ael:(t,e,r,i)=>t.addEventListener(e,r,i),rel:(t,e,r,i)=>t.removeEventListener(e,r,i),ce:(t,e)=>new CustomEvent(t,e)},g5e=(()=>{let t=!1;try{Qd.addEventListener("e",null,Object.defineProperty({},"passive",{get(){t=!0}}))}catch{}return t})(),y5e=t=>Promise.resolve(t),_5e=(()=>{try{return new CSSStyleSheet,typeof new CSSStyleSheet().replaceSync=="function"}catch{}return!1})(),BK=[],qme=[],v5e=(t,e)=>r=>{t.push(r),$V||($V=!0,e&&Ho.$flags$&4?b5e(LV):Ho.raf(LV))},GK=t=>{for(let e=0;e<t.length;e++)try{t[e](performance.now())}catch(r){$R(r)}t.length=0},LV=()=>{GK(BK),GK(qme),($V=BK.length>0)&&Ho.raf(LV)},b5e=t=>y5e().then(t),w5e=v5e(qme,!0);/*!
 * All material copyright ESRI, All Rights Reserved, unless otherwise specified.
 * See https://github.com/Esri/calcite-components/blob/master/LICENSE.md for details.
 * v1.4.2
 */const Wme="calcite-mode-auto",Zme="calcite-mode-dark",x5e="calcite-mode-light",y2t={autoMode:Wme,darkMode:Zme,lightMode:x5e,rtl:"calcite--rtl",calciteAnimate:"calcite-animate",calciteAnimateIn:"calcite-animate__in",calciteAnimateInUp:"calcite-animate__in-up",calciteAnimateInDown:"calcite-animate__in-down",calciteAnimateInRight:"calcite-animate__in-right",calciteAnimateInLeft:"calcite-animate__in-left",calciteAnimateInScale:"calcite-animate__in-scale"};/*!
* tabbable 6.1.2
* @license MIT, https://github.com/focus-trap/tabbable/blob/master/LICENSE
*/var Xme=["input:not([inert])","select:not([inert])","textarea:not([inert])","a[href]:not([inert])","button:not([inert])","[tabindex]:not(slot):not([inert])","audio[controls]:not([inert])","video[controls]:not([inert])",'[contenteditable]:not([contenteditable="false"]):not([inert])',"details>summary:first-of-type:not([inert])","details:not([inert])"],yN=Xme.join(","),Yme=typeof Element>"u",Qb=Yme?function(){}:Element.prototype.matches||Element.prototype.msMatchesSelector||Element.prototype.webkitMatchesSelector,_N=!Yme&&Element.prototype.getRootNode?function(t){var e;return t==null||(e=t.getRootNode)===null||e===void 0?void 0:e.call(t)}:function(t){return t?.ownerDocument},vN=function t(e,r){var i;r===void 0&&(r=!0);var s=e==null||(i=e.getAttribute)===null||i===void 0?void 0:i.call(e,"inert"),n=s===""||s==="true",o=n||r&&e&&t(e.parentNode);return o},T5e=function(e){var r,i=e==null||(r=e.getAttribute)===null||r===void 0?void 0:r.call(e,"contenteditable");return i===""||i==="true"},Jme=function(e,r,i){if(vN(e))return[];var s=Array.prototype.slice.apply(e.querySelectorAll(yN));return r&&Qb.call(e,yN)&&s.unshift(e),s=s.filter(i),s},Qme=function t(e,r,i){for(var s=[],n=Array.from(e);n.length;){var o=n.shift();if(!vN(o,!1))if(o.tagName==="SLOT"){var a=o.assignedElements(),l=a.length?a:o.children,c=t(l,!0,i);i.flatten?s.push.apply(s,c):s.push({scopeParent:o,candidates:c})}else{var h=Qb.call(o,yN);h&&i.filter(o)&&(r||!e.includes(o))&&s.push(o);var p=o.shadowRoot||typeof i.getShadowRoot=="function"&&i.getShadowRoot(o),f=!vN(p,!1)&&(!i.shadowRootFilter||i.shadowRootFilter(o));if(p&&f){var m=t(p===!0?o.children:p.children,!0,i);i.flatten?s.push.apply(s,m):s.push({scopeParent:o,candidates:m})}else n.unshift.apply(n,o.children)}}return s},Kme=function(e,r){return e.tabIndex<0&&(r||/^(AUDIO|VIDEO|DETAILS)$/.test(e.tagName)||T5e(e))&&isNaN(parseInt(e.getAttribute("tabindex"),10))?0:e.tabIndex},S5e=function(e,r){return e.tabIndex===r.tabIndex?e.documentOrder-r.documentOrder:e.tabIndex-r.tabIndex},ege=function(e){return e.tagName==="INPUT"},E5e=function(e){return ege(e)&&e.type==="hidden"},C5e=function(e){var r=e.tagName==="DETAILS"&&Array.prototype.slice.apply(e.children).some(function(i){return i.tagName==="SUMMARY"});return r},A5e=function(e,r){for(var i=0;i<e.length;i++)if(e[i].checked&&e[i].form===r)return e[i]},O5e=function(e){if(!e.name)return!0;var r=e.form||_N(e),i=function(a){return r.querySelectorAll('input[type="radio"][name="'+a+'"]')},s;if(typeof window<"u"&&typeof window.CSS<"u"&&typeof window.CSS.escape=="function")s=i(window.CSS.escape(e.name));else try{s=i(e.name)}catch(o){return console.error("Looks like you have a radio button with a name attribute containing invalid CSS selector characters and need the CSS.escape polyfill: %s",o.message),!1}var n=A5e(s,e.form);return!n||n===e},R5e=function(e){return ege(e)&&e.type==="radio"},P5e=function(e){return R5e(e)&&!O5e(e)},M5e=function(e){var r,i=e&&_N(e),s=(r=i)===null||r===void 0?void 0:r.host,n=!1;if(i&&i!==e){var o,a,l;for(n=!!((o=s)!==null&&o!==void 0&&(a=o.ownerDocument)!==null&&a!==void 0&&a.contains(s)||e!=null&&(l=e.ownerDocument)!==null&&l!==void 0&&l.contains(e));!n&&s;){var c,h,p;i=_N(s),s=(c=i)===null||c===void 0?void 0:c.host,n=!!((h=s)!==null&&h!==void 0&&(p=h.ownerDocument)!==null&&p!==void 0&&p.contains(s))}}return n},jK=function(e){var r=e.getBoundingClientRect(),i=r.width,s=r.height;return i===0&&s===0},I5e=function(e,r){var i=r.displayCheck,s=r.getShadowRoot;if(getComputedStyle(e).visibility==="hidden")return!0;var n=Qb.call(e,"details>summary:first-of-type"),o=n?e.parentElement:e;if(Qb.call(o,"details:not([open]) *"))return!0;if(!i||i==="full"||i==="legacy-full"){if(typeof s=="function"){for(var a=e;e;){var l=e.parentElement,c=_N(e);if(l&&!l.shadowRoot&&s(l)===!0)return jK(e);e.assignedSlot?e=e.assignedSlot:!l&&c!==e.ownerDocument?e=c.host:e=l}e=a}if(M5e(e))return!e.getClientRects().length;if(i!=="legacy-full")return!0}else if(i==="non-zero-area")return jK(e);return!1},$5e=function(e){if(/^(INPUT|BUTTON|SELECT|TEXTAREA)$/.test(e.tagName))for(var r=e.parentElement;r;){if(r.tagName==="FIELDSET"&&r.disabled){for(var i=0;i<r.children.length;i++){var s=r.children.item(i);if(s.tagName==="LEGEND")return Qb.call(r,"fieldset[disabled] *")?!0:!s.contains(e)}return!0}r=r.parentElement}return!1},bN=function(e,r){return!(r.disabled||vN(r)||E5e(r)||I5e(r,e)||C5e(r)||$5e(r))},DV=function(e,r){return!(P5e(r)||Kme(r)<0||!bN(e,r))},L5e=function(e){var r=parseInt(e.getAttribute("tabindex"),10);return!!(isNaN(r)||r>=0)},D5e=function t(e){var r=[],i=[];return e.forEach(function(s,n){var o=!!s.scopeParent,a=o?s.scopeParent:s,l=Kme(a,o),c=o?t(s.candidates):a;l===0?o?r.push.apply(r,c):r.push(a):i.push({documentOrder:n,tabIndex:l,item:s,isScope:o,content:c})}),i.sort(S5e).reduce(function(s,n){return n.isScope?s.push.apply(s,n.content):s.push(n.content),s},[]).concat(r)},N5e=function(e,r){r=r||{};var i;return r.getShadowRoot?i=Qme([e],r.includeContainer,{filter:DV.bind(null,r),flatten:!1,getShadowRoot:r.getShadowRoot,shadowRootFilter:L5e}):i=Jme(e,r.includeContainer,DV.bind(null,r)),D5e(i)},_2t=function(e,r){r=r||{};var i;return r.getShadowRoot?i=Qme([e],r.includeContainer,{filter:bN.bind(null,r),flatten:!0,getShadowRoot:r.getShadowRoot}):i=Jme(e,r.includeContainer,bN.bind(null,r)),i},v2t=function(e,r){if(r=r||{},!e)throw new Error("No node provided");return Qb.call(e,yN)===!1?!1:DV(r,e)},F5e=Xme.concat("iframe").join(","),b2t=function(e,r){if(r=r||{},!e)throw new Error("No node provided");return Qb.call(e,F5e)===!1?!1:bN(r,e)};const U5e={getShadowRoot:!0};function w2t(t){return Array.isArray(t)?t:Array.from(t)}function x2t(t){const e="dir",r=`[${e}]`,i=k5e(t,r);return i?i.getAttribute(e):"ltr"}function T2t(t,e,r){const i=`[${e}]`,s=t.closest(i);return s?s.getAttribute(e):r}function OW(t){return t.getRootNode()}function S2t(t){const e=OW(t);return"host"in e?e:null}function tge(t){return t.host||null}function E2t(t,{selector:e,id:r}){function i(s){if(!s)return null;s.assignedSlot&&(s=s.assignedSlot);const n=OW(s),o=r?"getElementById"in n?n.getElementById(r):null:e?n.querySelector(e):null,a=tge(n);return o||(a?i(a):null)}return i(t)}function k5e(t,e){function r(i){return i?i.closest(e)||r(tge(OW(i))):null}return r(t)}function V5e(t,e){return rge(t,e)}function rge(t,e){if(!t)return;const r=e(t);if(r!==void 0)return r;const{parentNode:i}=t;return rge(i instanceof ShadowRoot?i.host:i,e)}function C2t(t,e){return!!V5e(e,r=>r===t?!0:void 0)}function z5e(t){return typeof t?.setFocus=="function"}async function A2t(t){if(t)return z5e(t)?t.setFocus():t.focus()}function O2t(t){t&&(N5e(t,U5e)[0]||t).focus()}const AO=":not([slot])";function R2t(t,e,r){e&&!Array.isArray(e)&&typeof e!="string"&&(r=e,e=null);const i=e?Array.isArray(e)?e.map(s=>`[slot="${s}"]`).join(","):`[slot="${e}"]`:AO;return r?.all?B5e(t,i,r):G5e(t,i,r)}function ige(t,e){return t?Array.from(t.children||[]).filter(r=>r?.matches(e)):[]}function B5e(t,e,r){let i=e===AO?ige(t,AO):Array.from(t.querySelectorAll(e));i=r&&r.direct===!1?i:i.filter(n=>n.parentElement===t),i=r?.matches?i.filter(n=>n?.matches(r.matches)):i;const s=r?.selector;return s?i.map(n=>Array.from(n.querySelectorAll(s))).reduce((n,o)=>[...n,...o],[]).filter(n=>!!n):i}function G5e(t,e,r){let i=e===AO?ige(t,AO)[0]||null:t.querySelector(e);i=r&&r.direct===!1||i?.parentElement===t?i:null,i=r?.matches?i?.matches(r.matches)?i:null:i;const s=r?.selector;return s?i?.querySelector(s):i}function P2t(t,e,r){if(typeof e=="string"&&e!=="")return e;if(e==="")return t[r]}function M2t(t){return(!!t).toString()}function I2t(t){return!!j5e(t).length}function j5e(t){return t.target.assignedElements({flatten:!0})}function $2t(t){return!!(t.isPrimary&&t.button===0)}/*!
 * All material copyright ESRI, All Rights Reserved, unless otherwise specified.
 * See https://github.com/Esri/calcite-components/blob/master/LICENSE.md for details.
 * v1.4.2
 */function HK(){const{classList:t}=document.body,e=window.matchMedia("(prefers-color-scheme: dark)").matches,r=()=>t.contains(Zme)||t.contains(Wme)&&e?"dark":"light",i=o=>document.body.dispatchEvent(new CustomEvent("calciteModeChange",{bubbles:!0,detail:{mode:o}})),s=o=>{n!==o&&i(o),n=o};let n=r();i(n),window.matchMedia("(prefers-color-scheme: dark)").addEventListener("change",o=>s(o.matches?"dark":"light")),new MutationObserver(()=>s(r())).observe(document.body,{attributes:!0,attributeFilter:["class"]})}function H5e(){typeof window<"u"&&typeof location<"u"&&typeof document<"u"&&window.location===location&&window.document===document&&(document.readyState==="interactive"?HK():document.addEventListener("DOMContentLoaded",()=>HK(),{once:!0}))}const q5e=H5e;q5e();let sge;function W5e(){try{IFe(".")}catch{$Fe(_l(kr(sge)))}}function L2t(t){const e=[];for(const r of Object.keys(t))customElements.get(`calcite-${r}`)||e.push(t[r]?.());return Promise.all(e)}sge="components/assets";const nge=Symbol("widget"),Z5e=Symbol("widget-test-data"),X5e=[],Y5e={},wN=new WeakMap;function oge(t,e){let r=e.children;if(r&&r.length)for(let s=0;s<r.length;++s)r[s]=oge(t,r[s]);else r=X5e;const i=e.vnodeSelector;if(RW(i)){const s=e.properties||Y5e,n=s.key||i;return{vnodeSelector:"div",properties:{key:n,afterCreate:J5e,afterUpdate:Q5e,afterRemoved:age,parentWidget:t,widgetConstructor:i,widgetProperties:{...s,key:n,children:r}},children:void 0,text:void 0,domNode:null}}return e}function J5e(t,e,r,{parentWidget:i,widgetConstructor:s,widgetProperties:n}){const o=new s(n);o.container=t,wN.set(t,o),o.afterCreate?.(o,t),i._internalHandles.add(bo(()=>age(t)))}function Q5e(t,e,r,{widgetProperties:i}){const s=wN.get(t);s&&(s.set(i),s.afterUpdate?.(s,t))}function age(t){const e=wN.get(t);e&&(e.afterRemoved?.(e,t),e.destroy(),wN.delete(t))}function RW(t){return typeof t=="function"&&t[nge]}const qK=new Set;function K5e(t){qK.add(t),t.finally(()=>qK.delete(t))}var lge;const e6e="esri.widgets.Widget";let t6e=0;const r6e={widgetIcon:"esri-icon-checkbox-unchecked"};function cge(t,e){for(const r in e)t[r]!=null&&(typeof t[r]=="object"&&typeof e[r]=="object"?cge(t[r],e?.[r]):t[r]=e[r]);return t}const i6e=MFe({postProcessProjectionOptions(t){const e=t.eventHandlerInterceptor,r=/capture$/i;t.eventHandlerInterceptor=(i,s,n,o)=>{const a=e?.(i,s,n,o),l=r.test(i);if(!((i=i.replace(r,"")).toLowerCase()in n)||l){const c=i[2].toLowerCase()+i.slice(3),h=m=>a?.call(n,m);n.addEventListener(c,h,l);const p=()=>n.removeEventListener(c,h,l),f=o.afterRemoved;o.afterRemoved=m=>{f?.(m),p()}}return a}},handleInterceptedEvent(t,e,r,i){const{eventPhase:s,type:n}=i,o=s===Event.CAPTURING_PHASE;let a=`on${n}${o?"capture":""}`;const l=e.properties;(l&&a in l||(a=`on${n[0].toUpperCase()}${n.slice(1)}${o?"Capture":""}`,l&&a in l))&&(xme(),t.scheduleRender(),l[a].call(l.bind||r,i))}});let nU=!1,Dn=class extends DF(os.EventedAccessor){constructor(e,r){super(e,r),this._attached=!1,this._internalHandles=new Oi,this._projector=i6e,this._readyForTrueRender=!1,this.iconClass=r6e.widgetIcon,this.icon=null,this.key=this,this._loadLocale=xq(async()=>{if(this._messageBundleProps&&this._messageBundleProps.length){const o=await Yf(this._messageBundleProps.map(async({bundlePath:a,propertyName:l})=>{if(this.destroyed)return;let c=await Ide(a);this.uiStrings&&Object.keys(this.uiStrings)&&(c=cge(K(c),this.uiStrings)),this[l]=c}));if(this.destroyed)return;for(const a of o)a.error&&Q.getLogger(this).error("widget-intl:locale-error",this.declaredClass,a.error)}await this.loadLocale()}),W5e();const i="esri-widget-uid-"+NF(),s=this.render.bind(this);this._trackingTarget=new wF(()=>this.scheduleRender());const n=()=>{if(!this._readyForTrueRender||this.destroyed)return null;const o=s();let{properties:a}=o;a||(o.properties=a={});const{key:l}=a;l||(a.key=i),this.visible?a.styles||(a.styles={}):(a.class="",a.styles={display:"none"}),a.styles.display||(a.styles.display="");let c=0;return o.children?.forEach(h=>{if(RW(h.vnodeSelector))return;let{properties:p}=h;p||(h.properties=p={}),p.key||(p.key=`${this.id}--${c++}`)}),oge(this,o)};this.render=()=>{if(nU)return n();let o=nFe(this)??null;if(o)return o;this._trackingTarget.clear(),nU=!0;try{o=Ig(this._trackingTarget,n)}catch(a){throw console.error(a),a}finally{nU=!1}return o&&oFe(this,o),o},this.addResolvingPromise(this._resourcesFetch=this.beforeFirstRender().then(()=>{this._readyForTrueRender=!0,this._postInitialize()})),K5e(this._resourcesFetch)}normalizeCtorArgs(e,r){const i={...e};return r&&(i.container=r),i}postInitialize(){}beforeFirstRender(){return Promise.all([this.loadDependencies(),this._loadLocale()]).then(()=>{}).catch(TQ)}async loadDependencies(){}async loadLocale(){}destroy(){this.destroyed||(Me(this._trackingTarget),Me(this.viewModel),this._detach(this.container),this._set("container",null),this._internalHandles.destroy(),this._emitter.clear(),this.render=()=>null,this._projector=null,iU(this))}set container(e){this._get("container")||this._set("container",e)}castContainer(e){return LF(e)}get domNode(){return this.container}set domNode(e){this.container=e}get id(){return this._get("id")||this.get("container.id")||Date.now().toString(16)+"-widget-"+t6e++}set id(e){e&&this._set("id",e)}get label(){return this.declaredClass.split(".").pop()}set label(e){this._overrideIfSome("label",e)}get renderable(){return this._resourcesFetch}get visible(){return this._get("visible")}set visible(e){this._set("visible",e)}get[(lge=nge,Z5e)](){return{projector:this._projector}}render(){throw new Error("not implemented")}scheduleRender(){this.destroyed||(iU(this),this._projector.scheduleRender())}classes(...e){return hFe.apply(this,e)}renderNow(){iU(this),this._projector.renderNow()}_postInitialize(){if(this.destroyed)return;this.scheduleRender(),this._delegatedEventNames?.length&&this._internalHandles.add(le(()=>this.viewModel,(r,i)=>{i&&this._internalHandles.remove("delegated-events"),r&&vF(r)&&this._internalHandles.add(this._delegatedEventNames.map(s=>h_(r,s,n=>{this.emit(s,n)})),"delegated-events")},Vr)),this.postInitialize();const e=async()=>{await this._loadLocale().catch(TQ),this.scheduleRender()};this._internalHandles.add([She(e),le(()=>this.uiStrings,e),Eh(()=>this.container,r=>{this.destroyed||this._attach(r)},{initial:!0,once:!0})])}_attach(e){e&&(this._projector.merge(e,this.render),this._attached=!0)}_detach(e){this._attached&&(this._projector.detach(this.render),this._attached=!1),e?.parentNode?.removeChild(e)}};Dn[lge]=!0,u([d()],Dn.prototype,"_readyForTrueRender",void 0),u([d({value:null})],Dn.prototype,"container",null),u([yr("container")],Dn.prototype,"castContainer",null),u([d()],Dn.prototype,"iconClass",void 0),u([d()],Dn.prototype,"icon",void 0),u([d()],Dn.prototype,"id",null),u([d()],Dn.prototype,"label",null),u([d()],Dn.prototype,"renderable",null),u([d()],Dn.prototype,"uiStrings",void 0),u([d()],Dn.prototype,"viewModel",void 0),u([d({value:!0})],Dn.prototype,"visible",null),u([d()],Dn.prototype,"key",void 0),u([d()],Dn.prototype,"children",void 0),u([d()],Dn.prototype,"afterCreate",void 0),u([d()],Dn.prototype,"afterUpdate",void 0),u([d()],Dn.prototype,"afterRemoved",void 0),Dn=u([R(e6e)],Dn);const Aw=Dn,Vi=t=>{let e=class extends t{clone(){const r=rc(ua(this),"unable to clone instance of non-accessor class"),i=r.metadatas,s=r.store,n={},o=new Map;for(const l in i){const c=i[l],h=s?.originOf(l),p=c.clonable;if(c.readOnly||p===!1||h!==pr.USER&&h!==pr.DEFAULTS&&h!==pr.WEB_MAP&&h!==pr.WEB_SCENE)continue;const f=this[l];let m=null;m=typeof p=="function"?p(f):p==="reference"?f:Fk(f),f!=null&&m==null||(h===pr.DEFAULTS?o.set(l,m):n[l]=m)}const a=new(Object.getPrototypeOf(this)).constructor(n);if(o.size){const l=ua(a)?.store;if(l)for(const[c,h]of o)l.set(c,h,pr.DEFAULTS)}return a}};return e=u([R("esri.core.Clonable")],e),e};let WK=class extends Vi(Te){};WK=u([R("esri.core.Clonable")],WK);var ri;(function(t){t[t.ADD=1]="ADD",t[t.REMOVE=2]="REMOVE",t[t.MOVE=4]="MOVE"})(ri||(ri={}));function PW(t){return(e,r)=>{e[r]=t}}let zF=class extends npe{notify(){const e=this._observers;if(e&&e.length>0){const r=e.slice();for(const i of r)i.onInvalidated(),i.onCommitted()}}};var sg;let s6e=class{constructor(){this.target=null,this.cancellable=!1,this.defaultPrevented=!1,this.item=void 0,this.type=void 0}preventDefault(){this.cancellable&&(this.defaultPrevented=!0)}reset(e){this.defaultPrevented=!1,this.item=e}};const Tu=new Vo(s6e,void 0,t=>{t.item=null,t.target=null,t.defaultPrevented=!1,t.cancellable=!1}),n6e=()=>{};function oU(t){return t?t instanceof Z1?t.toArray():t.length?Array.prototype.slice.apply(t):[]:[]}function aU(t){if(t&&t.length)return t[0]}function o6e(t,e,r,i){const s=Math.min(t.length-r,e.length-i);let n=0;for(;n<s&&t[r+n]===e[i+n];)n++;return n}function uge(t,e,r,i){e&&e.forEach((s,n,o)=>{t.push(s),uge(t,r.call(i,s,n,o),r,i)})}const gy=new Set,yy=new Set,_y=new Set,lU=new Map;let a6e=0,Z1=sg=class extends os.EventedAccessor{static isCollection(t){return t!=null&&t instanceof sg}constructor(t){super(t),this._chgListeners=[],this._notifications=null,this._timer=null,this._observable=new zF,this.length=0,this._items=[],Object.defineProperty(this,"uid",{value:a6e++})}normalizeCtorArgs(t){return t?Array.isArray(t)||t instanceof sg?{items:t}:t:{}}destroy(){this._removeAllRaw()}*[Symbol.iterator](){yield*this.items}get items(){return Ht(this._observable),this._items}set items(t){this._emitBeforeChanges(ri.ADD)||(this._splice(0,this.length,oU(t)),this._emitAfterChanges(ri.ADD))}hasEventListener(t){return t==="change"?this._chgListeners.length>0:this._emitter.hasEventListener(t)}on(t,e){if(t==="change"){const r=this._chgListeners,i={removed:!1,callback:e};return r.push(i),this._notifications&&this._notifications.push({listeners:r.slice(),items:this._items.slice(),changes:[]}),{remove(){this.remove=n6e,i.removed=!0,r.splice(r.indexOf(i),1)}}}return this._emitter.on(t,e)}once(t,e){const r=this.on(t,e);return{remove(){r.remove()}}}add(t,e){if(Ht(this._observable),this._emitBeforeChanges(ri.ADD))return this;const r=this.getNextIndex(e??null);return this._splice(r,0,[t]),this._emitAfterChanges(ri.ADD),this}addMany(t,e=this._items.length){if(Ht(this._observable),!t||!t.length)return this;if(this._emitBeforeChanges(ri.ADD))return this;const r=this.getNextIndex(e);return this._splice(r,0,oU(t)),this._emitAfterChanges(ri.ADD),this}at(t){if(Ht(this._observable),(t=Math.trunc(t)||0)<0&&(t+=this.length),!(t<0||t>=this.length))return this._items[t]}removeAll(){if(Ht(this._observable),!this.length||this._emitBeforeChanges(ri.REMOVE))return[];const t=this._removeAllRaw();return this._emitAfterChanges(ri.REMOVE),t}_removeAllRaw(){return this.length===0?[]:this._splice(0,this.length)||[]}clone(){return Ht(this._observable),this._createNewInstance({items:this._items.map(K)})}concat(...t){Ht(this._observable);const e=t.map(oU);return this._createNewInstance({items:this._items.concat(...e)})}drain(t,e){if(Ht(this._observable),!this.length||this._emitBeforeChanges(ri.REMOVE))return;const r=this._splice(0,this.length),i=r.length;for(let s=0;s<i;s++)t.call(e,r[s],s,r);this._emitAfterChanges(ri.REMOVE)}every(t,e){return Ht(this._observable),this._items.every(t,e)}filter(t,e){let r;return Ht(this._observable),r=arguments.length===2?this._items.filter(t,e):this._items.filter(t),this._createNewInstance({items:r})}find(t,e){return Ht(this._observable),this._items.find(t,e)}findIndex(t,e){return Ht(this._observable),this._items.findIndex(t,e)}flatten(t,e){Ht(this._observable);const r=[];return uge(r,this,t,e),new sg(r)}forEach(t,e){return Ht(this._observable),this._items.forEach(t,e)}getItemAt(t){return Ht(this._observable),this._items[t]}getNextIndex(t){Ht(this._observable);const e=this.length;return(t=t??e)<0?t=0:t>e&&(t=e),t}includes(t,e=0){return Ht(this._observable),this._items.includes(t,e)}indexOf(t,e=0){return Ht(this._observable),this._items.indexOf(t,e)}join(t=","){return Ht(this._observable),this._items.join(t)}lastIndexOf(t,e=this.length-1){return Ht(this._observable),this._items.lastIndexOf(t,e)}map(t,e){Ht(this._observable);const r=this._items.map(t,e);return new sg({items:r})}reorder(t,e=this.length-1){Ht(this._observable);const r=this.indexOf(t);if(r!==-1){if(e<0?e=0:e>=this.length&&(e=this.length-1),r!==e){if(this._emitBeforeChanges(ri.MOVE))return t;this._splice(r,1),this._splice(e,0,[t]),this._emitAfterChanges(ri.MOVE)}return t}}pop(){if(Ht(this._observable),!this.length||this._emitBeforeChanges(ri.REMOVE))return;const t=aU(this._splice(this.length-1,1));return this._emitAfterChanges(ri.REMOVE),t}push(...t){return Ht(this._observable),this._emitBeforeChanges(ri.ADD)||(this._splice(this.length,0,t),this._emitAfterChanges(ri.ADD)),this.length}reduce(t,e){Ht(this._observable);const r=this._items;return arguments.length===2?r.reduce(t,e):r.reduce(t)}reduceRight(t,e){Ht(this._observable);const r=this._items;return arguments.length===2?r.reduceRight(t,e):r.reduceRight(t)}remove(t){return Ht(this._observable),this.removeAt(this.indexOf(t))}removeAt(t){if(Ht(this._observable),t<0||t>=this.length||this._emitBeforeChanges(ri.REMOVE))return;const e=aU(this._splice(t,1));return this._emitAfterChanges(ri.REMOVE),e}removeMany(t){if(Ht(this._observable),!t||!t.length||this._emitBeforeChanges(ri.REMOVE))return[];const e=t instanceof sg?t.toArray():t,r=this._items,i=[],s=e.length;for(let n=0;n<s;n++){const o=e[n],a=r.indexOf(o);if(a>-1){const l=1+o6e(e,r,n+1,a+1),c=this._splice(a,l);c&&c.length>0&&i.push.apply(i,c),n+=l-1}}return this._emitAfterChanges(ri.REMOVE),i}reverse(){if(Ht(this._observable),this._emitBeforeChanges(ri.MOVE))return this;const t=this._splice(0,this.length);return t&&(t.reverse(),this._splice(0,0,t)),this._emitAfterChanges(ri.MOVE),this}shift(){if(Ht(this._observable),!this.length||this._emitBeforeChanges(ri.REMOVE))return;const t=aU(this._splice(0,1));return this._emitAfterChanges(ri.REMOVE),t}slice(t=0,e=this.length){return Ht(this._observable),this._createNewInstance({items:this._items.slice(t,e)})}some(t,e){return Ht(this._observable),this._items.some(t,e)}sort(t){if(Ht(this._observable),!this.length||this._emitBeforeChanges(ri.MOVE))return this;const e=this._splice(0,this.length);return arguments.length?e.sort(t):e.sort(),this._splice(0,0,e),this._emitAfterChanges(ri.MOVE),this}splice(t,e,...r){Ht(this._observable);const i=(e?ri.REMOVE:0)|(r.length?ri.ADD:0);if(this._emitBeforeChanges(i))return[];const s=this._splice(t,e,r)||[];return this._emitAfterChanges(i),s}toArray(){return Ht(this._observable),this._items.slice()}toJSON(){return Ht(this._observable),this.toArray()}toLocaleString(){return Ht(this._observable),this._items.toLocaleString()}toString(){return Ht(this._observable),this._items.toString()}unshift(...t){return Ht(this._observable),!t.length||this._emitBeforeChanges(ri.ADD)||(this._splice(0,0,t),this._emitAfterChanges(ri.ADD)),this.length}_createNewInstance(t){return new this.constructor(t)}_splice(t,e,r){const i=this._items,s=this.itemType;let n,o;if(!this._notifications&&this.hasEventListener("change")&&(this._notifications=[{listeners:this._chgListeners.slice(),items:this._items.slice(),changes:[]}],this._timer&&this._timer.remove(),this._timer=J2(()=>this._dispatchChange())),e){if(o=i.splice(t,e),this.hasEventListener("before-remove")){const a=Tu.acquire();a.target=this,a.cancellable=!0;for(let l=0,c=o.length;l<c;l++)n=o[l],a.reset(n),this.emit("before-remove",a),a.defaultPrevented&&(o.splice(l,1),i.splice(t,0,n),t+=1,l-=1,c-=1);Tu.release(a)}if(this.length=this._items.length,this.hasEventListener("after-remove")){const a=Tu.acquire();a.target=this,a.cancellable=!1;const l=o.length;for(let c=0;c<l;c++)a.reset(o[c]),this.emit("after-remove",a);Tu.release(a)}}if(r&&r.length){if(s){const h=[];for(const p of r){const f=s.ensureType(p);f==null&&p!=null||h.push(f)}r=h}const a=this.hasEventListener("before-add"),l=this.hasEventListener("after-add"),c=t===this.length;if(a||l){const h=Tu.acquire();h.target=this,h.cancellable=!0;const p=Tu.acquire();p.target=this,p.cancellable=!1;for(const f of r)a?(h.reset(f),this.emit("before-add",h),h.defaultPrevented||(c?i.push(f):i.splice(t++,0,f),this._set("length",i.length),l&&(p.reset(f),this.emit("after-add",p)))):(c?i.push(f):i.splice(t++,0,f),this._set("length",i.length),p.reset(f),this.emit("after-add",p));Tu.release(p),Tu.release(h)}else{if(c)for(const h of r)i.push(h);else i.splice(t,0,...r);this._set("length",i.length)}}return(r&&r.length||o&&o.length)&&this._notifyChangeEvent(r,o),o}_emitBeforeChanges(t){let e=!1;if(this.hasEventListener("before-changes")){const r=Tu.acquire();r.target=this,r.cancellable=!0,r.type=t,this.emit("before-changes",r),e=r.defaultPrevented,Tu.release(r)}return e}_emitAfterChanges(t){if(this.hasEventListener("after-changes")){const e=Tu.acquire();e.target=this,e.cancellable=!1,e.type=t,this.emit("after-changes",e),Tu.release(e)}this._observable.notify()}_notifyChangeEvent(t,e){this.hasEventListener("change")&&this._notifications&&this._notifications[this._notifications.length-1].changes.push({added:t,removed:e})}_dispatchChange(){if(this._timer&&(this._timer.remove(),this._timer=null),!this._notifications)return;const t=this._notifications;this._notifications=null;for(const e of t){const r=e.changes;gy.clear(),yy.clear(),_y.clear();for(const{added:l,removed:c}of r){if(l)if(_y.size===0&&yy.size===0)for(const h of l)gy.add(h);else for(const h of l)yy.has(h)?(_y.add(h),yy.delete(h)):_y.has(h)||gy.add(h);if(c)if(_y.size===0&&gy.size===0)for(const h of c)yy.add(h);else for(const h of c)gy.has(h)?gy.delete(h):(_y.delete(h),yy.add(h))}const i=oc.acquire();gy.forEach(l=>{i.push(l)});const s=oc.acquire();yy.forEach(l=>{s.push(l)});const n=this._items,o=e.items,a=oc.acquire();if(_y.forEach(l=>{o.indexOf(l)!==n.indexOf(l)&&a.push(l)}),e.listeners&&(i.length||s.length||a.length)){const l={target:this,added:i,removed:s,moved:a},c=e.listeners.length;for(let h=0;h<c;h++){const p=e.listeners[h];p.removed||p.callback.call(this,l)}}oc.release(i),oc.release(s),oc.release(a)}gy.clear(),yy.clear(),_y.clear()}};Z1.ofType=t=>{if(!t)return sg;if(lU.has(t))return lU.get(t);let e=null;if(typeof t=="function")e=t.prototype.declaredClass;else if(t.base)e=t.base.prototype.declaredClass;else for(const i in t.typeMap){const s=t.typeMap[i].prototype.declaredClass;e?e+=` | ${s}`:e=s}let r=class extends sg{};return u([PW({Type:t,ensureType:typeof t=="function"?Zs(t):np(t)})],r.prototype,"itemType",void 0),r=u([R(`esri.core.Collection<${e}>`)],r),lU.set(t,r),r},u([d()],Z1.prototype,"length",void 0),u([d()],Z1.prototype,"items",null),Z1=sg=u([R("esri.core.Collection")],Z1);const Pt=Z1;let G$=class extends de{constructor(e){super(e),this.type=null}};u([d({type:["attachments","custom","fields","media","text","expression","relationship"],readOnly:!0,json:{read:!1,write:!0}})],G$.prototype,"type",void 0),G$=u([R("esri.popup.content.Content")],G$);const W_=G$;var NV;let Xv=NV=class extends W_{constructor(t){super(t),this.description=null,this.displayType="auto",this.title=null,this.type="attachments"}clone(){return new NV({description:this.description,displayType:this.displayType,title:this.title})}};u([d({type:String,json:{write:!0}})],Xv.prototype,"description",void 0),u([d({type:["auto","preview","list"],json:{write:!0}})],Xv.prototype,"displayType",void 0),u([d({type:String,json:{write:!0}})],Xv.prototype,"title",void 0),u([d({type:["attachments"],readOnly:!0,json:{read:!1,write:!0}})],Xv.prototype,"type",void 0),Xv=NV=u([R("esri.popup.content.AttachmentsContent")],Xv);const OO=Xv;var FV;let Yv=FV=class extends W_{constructor(t){super(t),this.creator=null,this.destroyer=null,this.outFields=null,this.type="custom"}clone(){return new FV({creator:this.creator,destroyer:this.destroyer,outFields:Array.isArray(this.outFields)?K(this.outFields):null})}};u([d()],Yv.prototype,"creator",void 0),u([d()],Yv.prototype,"destroyer",void 0),u([d()],Yv.prototype,"outFields",void 0),u([d({type:["custom"],readOnly:!0})],Yv.prototype,"type",void 0),Yv=FV=u([R("esri.popup.content.CustomContent")],Yv);const l6e=Yv;var UV;let nT=UV=class extends de{constructor(t){super(t),this.title=null,this.expression=null,this.returnType="dictionary"}clone(){return new UV({title:this.title,expression:this.expression})}};u([d({type:String,json:{write:!0}})],nT.prototype,"title",void 0),u([d({type:String,json:{write:!0}})],nT.prototype,"expression",void 0),u([d({type:["dictionary"],readOnly:!0,json:{read:!1,write:!0}})],nT.prototype,"returnType",void 0),nT=UV=u([R("esri.popup.ElementExpressionInfo")],nT);const c6e=nT;var kV;let BC=kV=class extends W_{constructor(t){super(t),this.expressionInfo=null,this.type="expression"}clone(){return new kV({expressionInfo:this.expressionInfo?.clone()})}};u([d({type:c6e,json:{write:!0}})],BC.prototype,"expressionInfo",void 0),u([d({type:["expression"],readOnly:!0,json:{read:!1,write:!0}})],BC.prototype,"type",void 0),BC=kV=u([R("esri.popup.content.ExpressionContent")],BC);const MW=BC;function tt(t,e={}){const r=t instanceof Rr?t:new Rr(t,e),i={type:e?.ignoreUnknown??1?r.apiValues:String,json:{type:r.jsonValues,read:!e?.readOnly&&{reader:r.read},write:{writer:r.write}}};return e?.readOnly!==void 0&&(i.readOnly=!!e.readOnly),e?.default!==void 0&&(i.json.default=e.default),e?.name!==void 0&&(i.json.name=e.name),e?.nonNullable!==void 0&&(i.nonNullable=e.nonNullable),d(i)}let oT=class extends Vi(de){constructor(e){super(e),this.dateFormat=null,this.digitSeparator=!1,this.places=null}formatNumber(e){return ZS(e,fMe(this))}formatDate(e,r=!1){return this.dateFormat?w_(e,{...UC(this.dateFormat),...r&&_q}):this.formatNumber(e)}formatDateOnly(e){const r=(this.dateFormat&&UC(this.dateFormat))??void 0;return lMe(e,r)}formatTimeOnly(e){const r=(this.dateFormat&&UC(this.dateFormat))??void 0;return cMe(e,r)}formatTimestamp(e){const r=(this.dateFormat&&UC(this.dateFormat))??void 0;return uMe(e,r)}formatRasterPixelValue(e){return e.includes("-")?e:e.trim().includes(",")?this._formatDelimitedString(e,",",", "):e.trim().includes(";")?this._formatDelimitedString(e,";","; "):e.trim().includes(" ")?this._formatDelimitedString(e," "," "):this.formatNumber(Number(e))}_formatDelimitedString(e,r,i){return e&&r&&i?e.trim().split(r).map(s=>this.formatNumber(Number(s))).join(i):e}};u([tt(oMe)],oT.prototype,"dateFormat",void 0),u([d({type:Boolean,json:{write:!0}})],oT.prototype,"digitSeparator",void 0),u([d({type:Xi,json:{write:!0}})],oT.prototype,"places",void 0),oT=u([R("esri.popup.support.FieldInfoFormat")],oT);const GC=oT;var VV;let nd=VV=class extends de{constructor(t){super(t),this.fieldName=null,this.format=null,this.isEditable=!0,this.label=null,this.stringFieldOption="text-box",this.statisticType=null,this.tooltip=null,this.visible=!0}clone(){return new VV({fieldName:this.fieldName,format:this.format?K(this.format):null,isEditable:this.isEditable,label:this.label,stringFieldOption:this.stringFieldOption,statisticType:this.statisticType,tooltip:this.tooltip,visible:this.visible})}};u([d({type:String,json:{write:!0}})],nd.prototype,"fieldName",void 0),u([d({type:GC,json:{write:!0}})],nd.prototype,"format",void 0),u([d({type:Boolean,json:{write:{alwaysWriteDefaults:!0},default:!0}})],nd.prototype,"isEditable",void 0),u([d({type:String,json:{write:!0}})],nd.prototype,"label",void 0),u([tt(new Rr({richtext:"rich-text",textarea:"text-area",textbox:"text-box"}),{default:"text-box"})],nd.prototype,"stringFieldOption",void 0),u([d({type:["count","sum","min","max","avg","stddev","var"],json:{write:!0}})],nd.prototype,"statisticType",void 0),u([d({type:String,json:{write:!0}})],nd.prototype,"tooltip",void 0),u([d({type:Boolean,json:{write:!0}})],nd.prototype,"visible",void 0),nd=VV=u([R("esri.popup.FieldInfo")],nd);const IW=nd;var zV;let Am=zV=class extends W_{constructor(t){super(t),this.attributes=null,this.description=null,this.fieldInfos=null,this.title=null,this.type="fields"}writeFieldInfos(t,e){e.fieldInfos=t&&t.map(r=>r.toJSON())}clone(){return new zV(K({attributes:this.attributes,description:this.description,fieldInfos:this.fieldInfos,title:this.title}))}};u([d({type:Object,json:{write:!0}})],Am.prototype,"attributes",void 0),u([d({type:String,json:{write:!0}})],Am.prototype,"description",void 0),u([d({type:[IW]})],Am.prototype,"fieldInfos",void 0),u([Fe("fieldInfos")],Am.prototype,"writeFieldInfos",null),u([d({type:String,json:{write:!0}})],Am.prototype,"title",void 0),u([d({type:["fields"],readOnly:!0,json:{read:!1,write:!0}})],Am.prototype,"type",void 0),Am=zV=u([R("esri.popup.content.FieldsContent")],Am);const RO=Am;let Jv=class extends de{constructor(e){super(e),this.altText=null,this.caption="",this.title="",this.type=null}};u([d({type:String,json:{write:!0}})],Jv.prototype,"altText",void 0),u([d({type:String,json:{write:!0}})],Jv.prototype,"caption",void 0),u([d({type:String,json:{write:!0}})],Jv.prototype,"title",void 0),u([d({type:["image","bar-chart","column-chart","line-chart","pie-chart"],readOnly:!0,json:{read:!1,write:!0}})],Jv.prototype,"type",void 0),Jv=u([R("esri.popup.content.mixins.MediaInfo")],Jv);const $W=Jv;var BV;let aT=BV=class extends Te{constructor(t){super(t),this.fieldName=null,this.tooltip=null,this.value=null}clone(){return new BV({fieldName:this.fieldName,tooltip:this.tooltip,value:this.value})}};u([d()],aT.prototype,"fieldName",void 0),u([d()],aT.prototype,"tooltip",void 0),u([d()],aT.prototype,"value",void 0),aT=BV=u([R("esri.popup.content.support.ChartMediaInfoValueSeries")],aT);const u6e=aT;var GV;let Qv=GV=class extends de{constructor(t){super(t),this.fields=[],this.normalizeField=null,this.series=[],this.tooltipField=null}clone(){return new GV({fields:K(this.fields),normalizeField:this.normalizeField,tooltipField:this.tooltipField})}};u([d({type:[String],json:{write:!0}})],Qv.prototype,"fields",void 0),u([d({type:String,json:{write:!0}})],Qv.prototype,"normalizeField",void 0),u([d({type:[u6e],json:{read:!1}})],Qv.prototype,"series",void 0),u([d({type:String,json:{write:!0}})],Qv.prototype,"tooltipField",void 0),Qv=GV=u([R("esri.popup.content.support.ChartMediaInfoValue")],Qv);const h6e=Qv;let jC=class extends $W{constructor(e){super(e),this.type=null,this.value=null}};u([d({type:["bar-chart","column-chart","line-chart","pie-chart"],readOnly:!0,json:{read:!1,write:!0}})],jC.prototype,"type",void 0),u([d({type:h6e,json:{write:!0}})],jC.prototype,"value",void 0),jC=u([R("esri.popup.content.mixins.ChartMediaInfo")],jC);const BF=jC,GF=Wa()({barchart:"bar-chart",columnchart:"column-chart",linechart:"line-chart",piechart:"pie-chart"});var jV;let j$=jV=class extends BF{constructor(t){super(t),this.type="bar-chart"}clone(){return new jV({altText:this.altText,title:this.title,caption:this.caption,value:this.value?this.value.clone():null})}};u([d({type:["bar-chart"],readOnly:!0,json:{type:["barchart"],read:!1,write:GF.write}})],j$.prototype,"type",void 0),j$=jV=u([R("esri.popup.content.BarChartMediaInfo")],j$);const hge=j$;var HV;let H$=HV=class extends BF{constructor(t){super(t),this.type="column-chart"}clone(){return new HV({altText:this.altText,title:this.title,caption:this.caption,value:this.value?this.value.clone():null})}};u([d({type:["column-chart"],readOnly:!0,json:{type:["columnchart"],read:!1,write:GF.write}})],H$.prototype,"type",void 0),H$=HV=u([R("esri.popup.content.ColumnChartMediaInfo")],H$);const dge=H$;var qV;let HC=qV=class extends de{constructor(t){super(t),this.linkURL=null,this.sourceURL=null}clone(){return new qV({linkURL:this.linkURL,sourceURL:this.sourceURL})}};u([d({type:String,json:{write:!0}})],HC.prototype,"linkURL",void 0),u([d({type:String,json:{write:!0}})],HC.prototype,"sourceURL",void 0),HC=qV=u([R("esri.popup.content.support.ImageMediaInfoValue")],HC);const d6e=HC;var WV;let lT=WV=class extends $W{constructor(t){super(t),this.refreshInterval=null,this.type="image",this.value=null}clone(){return new WV({altText:this.altText,title:this.title,caption:this.caption,refreshInterval:this.refreshInterval,value:this.value?this.value.clone():null})}};u([d({type:Number,json:{write:!0}})],lT.prototype,"refreshInterval",void 0),u([d({type:["image"],readOnly:!0,json:{read:!1,write:!0}})],lT.prototype,"type",void 0),u([d({type:d6e,json:{write:!0}})],lT.prototype,"value",void 0),lT=WV=u([R("esri.popup.content.ImageMediaInfo")],lT);const pge=lT;var ZV;let q$=ZV=class extends BF{constructor(t){super(t),this.type="line-chart"}clone(){return new ZV({altText:this.altText,title:this.title,caption:this.caption,value:this.value?this.value.clone():null})}};u([d({type:["line-chart"],readOnly:!0,json:{type:["linechart"],read:!1,write:GF.write}})],q$.prototype,"type",void 0),q$=ZV=u([R("esri.popup.content.LineChartMediaInfo")],q$);const fge=q$;var XV;let W$=XV=class extends BF{constructor(t){super(t),this.type="pie-chart"}clone(){return new XV({altText:this.altText,title:this.title,caption:this.caption,value:this.value?this.value.clone():null})}};u([d({type:["pie-chart"],readOnly:!0,json:{type:["piechart"],read:!1,write:GF.write}})],W$.prototype,"type",void 0),W$=XV=u([R("esri.popup.content.PieChartMediaInfo")],W$);const mge=W$,gge={base:$W,key:"type",defaultKeyValue:"image",typeMap:{"bar-chart":hge,"column-chart":dge,"line-chart":fge,"pie-chart":mge,image:pge}};var YV;let od=YV=class extends W_{constructor(t){super(t),this.activeMediaInfoIndex=null,this.attributes=null,this.description=null,this.mediaInfos=null,this.title=null,this.type="media"}readMediaInfos(t){return t&&t.map(e=>e.type==="image"?pge.fromJSON(e):e.type==="barchart"?hge.fromJSON(e):e.type==="columnchart"?dge.fromJSON(e):e.type==="linechart"?fge.fromJSON(e):e.type==="piechart"?mge.fromJSON(e):void 0).filter(Boolean)}writeMediaInfos(t,e){e.mediaInfos=t&&t.map(r=>r.toJSON())}clone(){return new YV(K({activeMediaInfoIndex:this.activeMediaInfoIndex,attributes:this.attributes,description:this.description,mediaInfos:this.mediaInfos,title:this.title}))}};u([d()],od.prototype,"activeMediaInfoIndex",void 0),u([d({type:Object,json:{write:!0}})],od.prototype,"attributes",void 0),u([d({type:String,json:{write:!0}})],od.prototype,"description",void 0),u([d({types:[gge]})],od.prototype,"mediaInfos",void 0),u([Ee("mediaInfos")],od.prototype,"readMediaInfos",null),u([Fe("mediaInfos")],od.prototype,"writeMediaInfos",null),u([d({type:String,json:{write:!0}})],od.prototype,"title",void 0),u([d({type:["media"],readOnly:!0,json:{read:!1,write:!0}})],od.prototype,"type",void 0),od=YV=u([R("esri.popup.content.MediaContent")],od);const xN=od;var JV;let qC=JV=class extends de{constructor(t){super(t),this.field=null,this.order=null}clone(){return new JV({field:this.field,order:this.order})}};u([d({type:String,json:{write:!0}})],qC.prototype,"field",void 0),u([d({type:["asc","desc"],json:{write:!0}})],qC.prototype,"order",void 0),qC=JV=u([R("esri.popup.support.RelatedRecordsInfoFieldOrder")],qC);const LW=qC;let Bp=class extends Vi(W_){constructor(e){super(e),this.description=null,this.displayCount=null,this.displayType="list",this.orderByFields=null,this.relationshipId=null,this.title=null,this.type="relationship"}};u([d({type:String,json:{write:!0}})],Bp.prototype,"description",void 0),u([d({type:Number,json:{type:Xi,write:!0}})],Bp.prototype,"displayCount",void 0),u([d({type:["list"],json:{write:!0}})],Bp.prototype,"displayType",void 0),u([d({type:[LW],json:{write:!0}})],Bp.prototype,"orderByFields",void 0),u([d({type:Number,json:{type:Xi,write:!0}})],Bp.prototype,"relationshipId",void 0),u([d({type:String,json:{write:!0}})],Bp.prototype,"title",void 0),u([d({type:["relationship"],readOnly:!0,json:{read:!1,write:!0}})],Bp.prototype,"type",void 0),Bp=u([R("esri.popup.content.RelationshipContent")],Bp);const TN=Bp;var QV;let WC=QV=class extends W_{constructor(t){super(t),this.text=null,this.type="text"}clone(){return new QV({text:this.text})}};u([d({type:String,json:{write:!0}})],WC.prototype,"text",void 0),u([d({type:["text"],readOnly:!0,json:{read:!1,write:!0}})],WC.prototype,"type",void 0),WC=QV=u([R("esri.popup.content.TextContent")],WC);const SN=WC,p6e={base:null,key:"type",typeMap:{attachment:OO,media:xN,text:SN,expression:MW,field:RO,relationship:TN}};var KV;let Kv=KV=class extends de{constructor(t){super(t),this.name=null,this.title=null,this.expression=null,this.returnType=null}clone(){return new KV({name:this.name,title:this.title,expression:this.expression,returnType:this.returnType})}};u([d({type:String,json:{write:!0}})],Kv.prototype,"name",void 0),u([d({type:String,json:{write:!0}})],Kv.prototype,"title",void 0),u([d({type:String,json:{write:!0}})],Kv.prototype,"expression",void 0),u([d({type:["string","number"],json:{write:!0}})],Kv.prototype,"returnType",void 0),Kv=KV=u([R("esri.popup.ExpressionInfo")],Kv);const f6e=Kv;var ez;let ZC=ez=class extends de{constructor(t){super(t),this.returnTopmostRaster=null,this.showNoDataRecords=null}clone(){return new ez({showNoDataRecords:this.showNoDataRecords,returnTopmostRaster:this.returnTopmostRaster})}};u([d({type:Boolean,json:{write:!0}})],ZC.prototype,"returnTopmostRaster",void 0),u([d({type:Boolean,json:{write:!0}})],ZC.prototype,"showNoDataRecords",void 0),ZC=ez=u([R("esri.popup.LayerOptions")],ZC);const m6e=ZC;var tz;let XC=tz=class extends de{constructor(t){super(t),this.showRelatedRecords=null,this.orderByFields=null}clone(){return new tz({showRelatedRecords:this.showRelatedRecords,orderByFields:this.orderByFields?K(this.orderByFields):null})}};u([d({type:Boolean,json:{write:!0}})],XC.prototype,"showRelatedRecords",void 0),u([d({type:[LW],json:{write:!0}})],XC.prototype,"orderByFields",void 0),XC=tz=u([R("esri.popup.RelatedRecordsInfo")],XC);const g6e=XC;let yge=0;const DW=t=>{let e=class extends t{constructor(...r){super(...r),Object.defineProperty(this,"uid",{writable:!1,configurable:!1,value:Date.now().toString(16)+"-object-"+yge++})}};return e=u([R("esri.core.Identifiable")],e),e},j2t=t=>{let e=class extends t{constructor(...r){super(...r),Object.defineProperty(this,"uid",{writable:!1,configurable:!1,value:yge++})}};return e=u([R("esri.core.NumericIdentifiable")],e),e};let ZK=class extends DW(class{}){};ZK=u([R("esri.core.Identifiable")],ZK);var rz;let Nu=rz=class extends DW(Te){constructor(t){super(t),this.active=!1,this.className=null,this.disabled=!1,this.icon=null,this.id=null,this.indicator=!1,this.title=null,this.type=null,this.visible=!0}clone(){return new rz({active:this.active,className:this.className,disabled:this.disabled,icon:this.icon,id:this.id,indicator:this.indicator,title:this.title,visible:this.visible})}};u([d()],Nu.prototype,"active",void 0),u([d()],Nu.prototype,"className",void 0),u([d()],Nu.prototype,"disabled",void 0),u([d()],Nu.prototype,"icon",void 0),u([d()],Nu.prototype,"id",void 0),u([d()],Nu.prototype,"indicator",void 0),u([d()],Nu.prototype,"title",void 0),u([d()],Nu.prototype,"type",void 0),u([d()],Nu.prototype,"visible",void 0),Nu=rz=u([R("esri.support.actions.ActionBase")],Nu);const NW=Nu;var iz;let Z$=iz=class extends NW{constructor(t){super(t),this.image=null,this.type="button"}clone(){return new iz({active:this.active,className:this.className,disabled:this.disabled,icon:this.icon,id:this.id,indicator:this.indicator,title:this.title,visible:this.visible,image:this.image})}};u([d()],Z$.prototype,"image",void 0),Z$=iz=u([R("esri.support.Action.ActionButton")],Z$);const y6e=Z$;var sz;let YC=sz=class extends NW{constructor(t){super(t),this.image=null,this.type="toggle",this.value=!1}clone(){return new sz({active:this.active,className:this.className,disabled:this.disabled,icon:this.icon,id:this.id,indicator:this.indicator,title:this.title,visible:this.visible,image:this.image,value:this.value})}};u([d()],YC.prototype,"image",void 0),u([d()],YC.prototype,"value",void 0),YC=sz=u([R("esri.support.Action.ActionToggle")],YC);const _6e=YC,v6e="esri.PopupTemplate",b6e=Q.getLogger(v6e),UE="relationships/",XK="expression/",w6e=Pt.ofType({key:"type",defaultKeyValue:"button",base:NW,typeMap:{button:y6e,toggle:_6e}}),x6e={base:W_,key:"type",typeMap:{media:xN,custom:l6e,text:SN,attachments:OO,fields:RO,expression:MW,relationship:TN}},T6e=["attachments","fields","media","text","expression","relationship"];let no=class extends Vi(de){constructor(){super(...arguments),this.actions=null,this.content="",this.expressionInfos=null,this.fieldInfos=null,this.layerOptions=null,this.lastEditInfoEnabled=!0,this.outFields=null,this.overwriteActions=!1,this.returnGeometry=!1,this.title=""}castContent(e){return Array.isArray(e)?e.map(r=>np(x6e,r)):typeof e=="string"||typeof e=="function"||e instanceof HTMLElement||bu(e)?e:(b6e.error("content error","unsupported content value",{value:e}),null)}readContent(e,r){const{popupElements:i}=r;return Array.isArray(i)&&i.length>0?this._readPopupInfoElements(r.description,r.mediaInfos,i):this._readPopupInfo(r)}writeContent(e,r,i,s){typeof e!="string"?Array.isArray(e)&&(r.popupElements=e.filter(n=>T6e.includes(n.type)).map(n=>n&&n.toJSON(s)),r.popupElements.forEach(n=>{n.type==="attachments"?this._writeAttachmentContent(r):n.type==="media"?this._writeMediaContent(n,r):n.type==="text"?this._writeTextContent(n,r):n.type==="relationship"&&this._writeRelationshipContent(n,r)})):r.description=e}writeFieldInfos(e,r,i,s){const{content:n}=this,o=Array.isArray(n)?n:null;if(e){const a=o?o.filter(c=>c.type==="fields"):[],l=a.length&&a.every(c=>c.fieldInfos?.length);r.fieldInfos=e.filter(Boolean).map(c=>{const h=c.toJSON(s);return l&&(h.visible=!1),h})}if(o)for(const a of o)a.type==="fields"&&this._writeFieldsContent(a,r)}writeLayerOptions(e,r,i,s){r[i]=!e||e.showNoDataRecords===null&&e.returnTopmostRaster===null?null:e.toJSON(s)}writeTitle(e,r){r.title=e||""}async collectRequiredFields(e,r){const i=this.expressionInfos||[];await this._collectExpressionInfoFields(e,r,[...i,...this._getContentExpressionInfos(this.content,i)]),SO(e,r,[...this.outFields||[],...this._getActionsFields(this.actions),...this._getTitleFields(this.title),...this._getContentFields(this.content)])}async getRequiredFields(e){const r=new Set;return await this.collectRequiredFields(r,e),[...r].sort()}_writeFieldsContent(e,r){if(!Array.isArray(e.fieldInfos)||!e.fieldInfos.length)return;const i=K(e.fieldInfos);Array.isArray(r.fieldInfos)?i.forEach(s=>{const n=r.fieldInfos.find(o=>o.fieldName.toLowerCase()===s.fieldName.toLowerCase());n?n.visible=!0:r.fieldInfos.push(s)}):r.fieldInfos=i}_writeAttachmentContent(e){e.showAttachments||(e.showAttachments=!0)}_writeRelationshipContent(e,r){const i=e.orderByFields?.map(n=>this._toFieldOrderJSON(n,e.relationshipId))||[],s=[...r.relatedRecordsInfo?.orderByFields||[],...i];r.relatedRecordsInfo={showRelatedRecords:!0,...s?.length&&{orderByFields:s}}}_writeTextContent(e,r){!r.description&&e.text&&(r.description=e.text)}_writeMediaContent(e,r){if(!Array.isArray(e.mediaInfos)||!e.mediaInfos.length)return;const i=K(e.mediaInfos);Array.isArray(r.mediaInfos)?r.mediaInfos=[...r.mediaInfos,...i]:r.mediaInfos=i}_readPopupInfoElements(e,r,i){const s={description:!1,mediaInfos:!1};return i.map(n=>n.type==="media"?(n.mediaInfos||!r||s.mediaInfos||(n.mediaInfos=r,s.mediaInfos=!0),xN.fromJSON(n)):n.type==="text"?(n.text||!e||s.description||(n.text=e,s.description=!0),SN.fromJSON(n)):n.type==="attachments"?OO.fromJSON(n):n.type==="fields"?RO.fromJSON(n):n.type==="expression"?MW.fromJSON(n):n.type==="relationship"?TN.fromJSON(n):void 0).filter(Boolean)}_toRelationshipContent(e){const{field:r,order:i}=e;if(!r?.startsWith(UE))return null;const s=r.replace(UE,"").split("/");if(s.length!==2)return null;const n=parseInt(s[0],10),o=s[1];return typeof n=="number"&&o?TN.fromJSON({relationshipId:n,orderByFields:[{field:o,order:i}]}):null}_toFieldOrderJSON(e,r){const{order:i,field:s}=e;return{field:`${UE}${r}/${s}`,order:i}}_readPopupInfo({description:e,mediaInfos:r,showAttachments:i,relatedRecordsInfo:s={showRelatedRecords:!1}}){const n=[];e?n.push(new SN({text:e})):n.push(new RO),Array.isArray(r)&&r.length&&n.push(xN.fromJSON({mediaInfos:r})),i&&n.push(OO.fromJSON({displayType:"auto"}));const{showRelatedRecords:o,orderByFields:a}=s;return o&&a?.length&&a.forEach(l=>{const c=this._toRelationshipContent(l);c&&n.push(c)}),n.length?n:e}_getContentElementFields(e){const r=e?.type;if(r==="attachments")return[...this._extractFieldNames(e.title),...this._extractFieldNames(e.description)];if(r==="custom")return e.outFields||[];if(r==="fields")return[...this._extractFieldNames(e.title),...this._extractFieldNames(e.description),...this._getFieldInfoFields(e.fieldInfos??this.fieldInfos)];if(r==="media"){const i=e.mediaInfos||[];return[...this._extractFieldNames(e.title),...this._extractFieldNames(e.description),...i.reduce((s,n)=>[...s,...this._getMediaInfoFields(n)],[])]}return r==="text"?this._extractFieldNames(e.text):[]}_getMediaInfoFields(e){const{caption:r,title:i,value:s}=e,n=s||{},{fields:o,normalizeField:a,tooltipField:l,sourceURL:c,linkURL:h}=n,p=[...this._extractFieldNames(i),...this._extractFieldNames(r),...this._extractFieldNames(c),...this._extractFieldNames(h),...o??[]];return a&&p.push(a),l&&p.push(l),p}_getContentExpressionInfos(e,r){return Array.isArray(e)?e.reduce((i,s)=>[...i,...s.type==="expression"&&s.expressionInfo?[s.expressionInfo]:[]],r):[]}_getContentFields(e){return typeof e=="string"?this._extractFieldNames(e):Array.isArray(e)?e.reduce((r,i)=>[...r,...this._getContentElementFields(i)],[]):[]}async _collectExpressionInfoFields(e,r,i){i&&await Promise.all(i.map(s=>Cl(e,r,s.expression)))}_getFieldInfoFields(e){return e?e.filter(r=>r.visible===void 0||!!r.visible).map(r=>r.fieldName).filter(r=>!r.startsWith(UE)&&!r.startsWith(XK)):[]}_getActionsFields(e){return e?e.toArray().reduce((r,i)=>[...r,...this._getActionFields(i)],[]):[]}_getActionFields(e){const{className:r,title:i,type:s}=e,n=s==="button"||s==="toggle"?e.image:"";return[...this._extractFieldNames(i),...this._extractFieldNames(r),...this._extractFieldNames(n)]}_getTitleFields(e){return typeof e=="string"?this._extractFieldNames(e):[]}_extractFieldNames(e){if(!e||typeof e!="string")return[];const r=/{[^}]*}/g,i=e.match(r);if(!i)return[];const s=/\{(\w+):.+\}/,n=i.filter(o=>!(o.indexOf(`{${UE}`)===0||o.indexOf(`{${XK}`)===0)).map(o=>o.replace(s,"{$1}"));return n?n.map(o=>o.slice(1,-1)):[]}};u([d({type:w6e})],no.prototype,"actions",void 0),u([d()],no.prototype,"content",void 0),u([yr("content")],no.prototype,"castContent",null),u([Ee("content",["description","fieldInfos","popupElements","mediaInfos","showAttachments","relatedRecordsInfo"])],no.prototype,"readContent",null),u([Fe("content",{popupElements:{type:Pt.ofType(p6e)},showAttachments:{type:Boolean},mediaInfos:{type:Pt.ofType(gge)},description:{type:String},relatedRecordsInfo:{type:g6e}})],no.prototype,"writeContent",null),u([d({type:[f6e],json:{write:!0}})],no.prototype,"expressionInfos",void 0),u([d({type:[IW]})],no.prototype,"fieldInfos",void 0),u([Fe("fieldInfos")],no.prototype,"writeFieldInfos",null),u([d({type:m6e})],no.prototype,"layerOptions",void 0),u([Fe("layerOptions")],no.prototype,"writeLayerOptions",null),u([d({type:Boolean,json:{read:{source:"showLastEditInfo"},write:{target:"showLastEditInfo"},default:!0}})],no.prototype,"lastEditInfoEnabled",void 0),u([d()],no.prototype,"outFields",void 0),u([d()],no.prototype,"overwriteActions",void 0),u([d()],no.prototype,"returnGeometry",void 0),u([d({json:{type:String}})],no.prototype,"title",void 0),u([Fe("title")],no.prototype,"writeTitle",null),no=u([R("esri.PopupTemplate")],no);const eE=no,EN={transparent:[0,0,0,0],black:[0,0,0,1],silver:[192,192,192,1],gray:[128,128,128,1],white:[255,255,255,1],maroon:[128,0,0,1],red:[255,0,0,1],purple:[128,0,128,1],fuchsia:[255,0,255,1],green:[0,128,0,1],lime:[0,255,0,1],olive:[128,128,0,1],yellow:[255,255,0,1],navy:[0,0,128,1],blue:[0,0,255,1],teal:[0,128,128,1],aqua:[0,255,255,1],aliceblue:[240,248,255,1],antiquewhite:[250,235,215,1],aquamarine:[127,255,212,1],azure:[240,255,255,1],beige:[245,245,220,1],bisque:[255,228,196,1],blanchedalmond:[255,235,205,1],blueviolet:[138,43,226,1],brown:[165,42,42,1],burlywood:[222,184,135,1],cadetblue:[95,158,160,1],chartreuse:[127,255,0,1],chocolate:[210,105,30,1],coral:[255,127,80,1],cornflowerblue:[100,149,237,1],cornsilk:[255,248,220,1],crimson:[220,20,60,1],cyan:[0,255,255,1],darkblue:[0,0,139,1],darkcyan:[0,139,139,1],darkgoldenrod:[184,134,11,1],darkgray:[169,169,169,1],darkgreen:[0,100,0,1],darkgrey:[169,169,169,1],darkkhaki:[189,183,107,1],darkmagenta:[139,0,139,1],darkolivegreen:[85,107,47,1],darkorange:[255,140,0,1],darkorchid:[153,50,204,1],darkred:[139,0,0,1],darksalmon:[233,150,122,1],darkseagreen:[143,188,143,1],darkslateblue:[72,61,139,1],darkslategray:[47,79,79,1],darkslategrey:[47,79,79,1],darkturquoise:[0,206,209,1],darkviolet:[148,0,211,1],deeppink:[255,20,147,1],deepskyblue:[0,191,255,1],dimgray:[105,105,105,1],dimgrey:[105,105,105,1],dodgerblue:[30,144,255,1],firebrick:[178,34,34,1],floralwhite:[255,250,240,1],forestgreen:[34,139,34,1],gainsboro:[220,220,220,1],ghostwhite:[248,248,255,1],gold:[255,215,0,1],goldenrod:[218,165,32,1],greenyellow:[173,255,47,1],grey:[128,128,128,1],honeydew:[240,255,240,1],hotpink:[255,105,180,1],indianred:[205,92,92,1],indigo:[75,0,130,1],ivory:[255,255,240,1],khaki:[240,230,140,1],lavender:[230,230,250,1],lavenderblush:[255,240,245,1],lawngreen:[124,252,0,1],lemonchiffon:[255,250,205,1],lightblue:[173,216,230,1],lightcoral:[240,128,128,1],lightcyan:[224,255,255,1],lightgoldenrodyellow:[250,250,210,1],lightgray:[211,211,211,1],lightgreen:[144,238,144,1],lightgrey:[211,211,211,1],lightpink:[255,182,193,1],lightsalmon:[255,160,122,1],lightseagreen:[32,178,170,1],lightskyblue:[135,206,250,1],lightslategray:[119,136,153,1],lightslategrey:[119,136,153,1],lightsteelblue:[176,196,222,1],lightyellow:[255,255,224,1],limegreen:[50,205,50,1],linen:[250,240,230,1],magenta:[255,0,255,1],mediumaquamarine:[102,205,170,1],mediumblue:[0,0,205,1],mediumorchid:[186,85,211,1],mediumpurple:[147,112,219,1],mediumseagreen:[60,179,113,1],mediumslateblue:[123,104,238,1],mediumspringgreen:[0,250,154,1],mediumturquoise:[72,209,204,1],mediumvioletred:[199,21,133,1],midnightblue:[25,25,112,1],mintcream:[245,255,250,1],mistyrose:[255,228,225,1],moccasin:[255,228,181,1],navajowhite:[255,222,173,1],oldlace:[253,245,230,1],olivedrab:[107,142,35,1],orange:[255,165,0,1],orangered:[255,69,0,1],orchid:[218,112,214,1],palegoldenrod:[238,232,170,1],palegreen:[152,251,152,1],paleturquoise:[175,238,238,1],palevioletred:[219,112,147,1],papayawhip:[255,239,213,1],peachpuff:[255,218,185,1],peru:[205,133,63,1],pink:[255,192,203,1],plum:[221,160,221,1],powderblue:[176,224,230,1],rebeccapurple:[102,51,153,1],rosybrown:[188,143,143,1],royalblue:[65,105,225,1],saddlebrown:[139,69,19,1],salmon:[250,128,114,1],sandybrown:[244,164,96,1],seagreen:[46,139,87,1],seashell:[255,245,238,1],sienna:[160,82,45,1],skyblue:[135,206,235,1],slateblue:[106,90,205,1],slategray:[112,128,144,1],slategrey:[112,128,144,1],snow:[255,250,250,1],springgreen:[0,255,127,1],steelblue:[70,130,180,1],tan:[210,180,140,1],thistle:[216,191,216,1],tomato:[255,99,71,1],turquoise:[64,224,208,1],violet:[238,130,238,1],wheat:[245,222,179,1],whitesmoke:[245,245,245,1],yellowgreen:[154,205,50,1]};function _ge(t){return!!EN[t]||!!EN[t.toLowerCase()]}function FW(t){return EN[t]??EN[t.toLowerCase()]}function S6e(t){return[...FW(t)]}function cU(t,e,r){r<0&&++r,r>1&&--r;const i=6*r;return i<1?t+(e-t)*i:2*r<1?e:3*r<2?t+(e-t)*(2/3-r)*6:t}function vge(t,e,r,i=1){const s=(t%360+360)%360/360,n=r<=.5?r*(e+1):r+e-r*e,o=2*r-n;return[Math.round(255*cU(o,n,s+1/3)),Math.round(255*cU(o,n,s)),Math.round(255*cU(o,n,s-1/3)),i]}function E6e(t){const e=t.length>5,r=e?8:4,i=(1<<r)-1,s=e?1:17,n=e?t.length===9:t.length===5;let o=+("0x"+t.substr(1));if(isNaN(o))return null;const a=[0,0,0,1];let l;return n&&(l=o&i,o>>=r,a[3]=s*l/255),l=o&i,o>>=r,a[2]=s*l,l=o&i,o>>=r,a[1]=s*l,l=o&i,o>>=r,a[0]=s*l,a}function kP(t){return ge(Uq(t),0,255)}function VP(t,e,r){return t=Number(t),isNaN(t)?r:t<e?e:t>r?r:t}let X$=class Yo{static blendColors(e,r,i,s=new Yo){return s.r=Math.round(e.r+(r.r-e.r)*i),s.g=Math.round(e.g+(r.g-e.g)*i),s.b=Math.round(e.b+(r.b-e.b)*i),s.a=e.a+(r.a-e.a)*i,s._sanitize()}static fromRgb(e,r){const i=e.toLowerCase().match(/^(rgba?|hsla?)\(([\s\.\-,%0-9]+)\)/);if(i){const s=i[2].split(/\s*,\s*/),n=i[1];if(n==="rgb"&&s.length===3||n==="rgba"&&s.length===4){const o=s[0];if(o.charAt(o.length-1)==="%"){const a=s.map(l=>2.56*parseFloat(l));return s.length===4&&(a[3]=parseFloat(s[3])),Yo.fromArray(a,r)}return Yo.fromArray(s.map(a=>parseFloat(a)),r)}if(n==="hsl"&&s.length===3||n==="hsla"&&s.length===4)return Yo.fromArray(vge(parseFloat(s[0]),parseFloat(s[1])/100,parseFloat(s[2])/100,parseFloat(s[3])),r)}return null}static fromHex(e,r=new Yo){if(e.length!==4&&e.length!==7||e[0]!=="#")return null;const i=e.length===4?4:8,s=(1<<i)-1;let n=+("0x"+e.substr(1));return isNaN(n)?null:(["b","g","r"].forEach(o=>{const a=n&s;n>>=i,r[o]=i===4?17*a:a}),r.a=1,r)}static fromArray(e,r=new Yo){return r._set(Number(e[0]),Number(e[1]),Number(e[2]),Number(e[3])),isNaN(r.a)&&(r.a=1),r._sanitize()}static fromString(e,r){const i=_ge(e)?FW(e):null;return i&&Yo.fromArray(i,r)||Yo.fromRgb(e,r)||Yo.fromHex(e,r)}static fromJSON(e){return e&&new Yo([e[0],e[1],e[2],e[3]/255])}static toUnitRGB(e){return e!=null?[e.r/255,e.g/255,e.b/255]:null}static toUnitRGBA(e){return e!=null?[e.r/255,e.g/255,e.b/255,e.a!=null?e.a:1]:null}constructor(e){this.r=255,this.g=255,this.b=255,this.a=1,e&&this.setColor(e)}get isBright(){return .299*this.r+.587*this.g+.114*this.b>=127}setColor(e){return typeof e=="string"?Yo.fromString(e,this):Array.isArray(e)?Yo.fromArray(e,this):(this._set(e.r??0,e.g??0,e.b??0,e.a??1),e instanceof Yo||this._sanitize()),this}toRgb(){return[this.r,this.g,this.b]}toRgba(){return[this.r,this.g,this.b,this.a]}toHex(){const e=this.r.toString(16),r=this.g.toString(16),i=this.b.toString(16);return`#${e.length<2?"0"+e:e}${r.length<2?"0"+r:r}${i.length<2?"0"+i:i}`}toCss(e=!1){const r=this.r+", "+this.g+", "+this.b;return e?`rgba(${r}, ${this.a})`:`rgb(${r})`}toString(){return this.toCss(!0)}toJSON(){return this.toArray()}toArray(e=Yo.AlphaMode.ALWAYS){const r=kP(this.r),i=kP(this.g),s=kP(this.b);return e===Yo.AlphaMode.ALWAYS||this.a!==1?[r,i,s,kP(255*this.a)]:[r,i,s]}clone(){return new Yo(this.toRgba())}hash(){return this.r<<24|this.g<<16|this.b<<8|255*this.a}equals(e){return e!=null&&e.r===this.r&&e.g===this.g&&e.b===this.b&&e.a===this.a}_sanitize(){return this.r=Math.round(VP(this.r,0,255)),this.g=Math.round(VP(this.g,0,255)),this.b=Math.round(VP(this.b,0,255)),this.a=VP(this.a,0,1),this}_set(e,r,i,s){this.r=e,this.g=r,this.b=i,this.a=s}};X$.prototype.declaredClass="esri.Color",function(t){var e;(e=t.AlphaMode||(t.AlphaMode={}))[e.ALWAYS=0]="ALWAYS",e[e.UNLESS_OPAQUE=1]="UNLESS_OPAQUE"}(X$||(X$={}));const ze=X$,YK=new Rr({esriSMS:"simple-marker",esriPMS:"picture-marker",esriSLS:"simple-line",esriSFS:"simple-fill",esriPFS:"picture-fill",esriTS:"text",esriSHD:"shield-label-symbol",PointSymbol3D:"point-3d",LineSymbol3D:"line-3d",PolygonSymbol3D:"polygon-3d",WebStyleSymbol:"web-style",MeshSymbol3D:"mesh-3d",LabelSymbol3D:"label-3d",CIMSymbolReference:"cim"});let C6e=0,cT=class extends de{constructor(e){super(e),this.id="sym"+C6e++,this.type=null,this.color=new ze([0,0,0,1])}readColor(e){return e&&e[0]!=null?[e[0],e[1],e[2],e[3]/255]:e}async collectRequiredFields(e,r){}hash(){return JSON.stringify(this.toJSON())}clone(){}};u([d({type:YK.apiValues,readOnly:!0,json:{read:!1,write:{ignoreOrigin:!0,writer:YK.write}}})],cT.prototype,"type",void 0),u([d({type:ze,json:{write:{allowNull:!0}}})],cT.prototype,"color",void 0),u([Ee("color")],cT.prototype,"readColor",null),cT=u([R("esri.symbols.Symbol")],cT);const Sc=cT;var nz;let Jy=nz=class extends Sc{constructor(t){super(t),this.data=null,this.type="cim"}readData(t,e){return e}writeData(t,e){Object.assign(e,t)}async collectRequiredFields(t,e){if(this.data?.type==="CIMSymbolReference"){const r=this.data.primitiveOverrides;if(r){const i=r.map(s=>{const n=s.valueExpressionInfo;return Cl(t,e,n.expression)});await Promise.all(i)}}}clone(){return new nz({data:K(this.data)})}hash(){return vq(JSON.stringify(this.data)).toString()}};u([d({json:{write:!1}})],Jy.prototype,"color",void 0),u([d({json:{write:!0}})],Jy.prototype,"data",void 0),u([Ee("data",["symbol"])],Jy.prototype,"readData",null),u([Fe("data",{})],Jy.prototype,"writeData",null),u([tt({CIMSymbolReference:"cim"},{readOnly:!0})],Jy.prototype,"type",void 0),Jy=nz=u([R("esri.symbols.CIMSymbol")],Jy);const tE=Jy;let uT=class extends de{constructor(e){super(e),this.enabled=!0,this.type=null,this.ignoreDrivers=!1}writeEnabled(e,r,i){e||(r[i]=e)}};u([d({type:Boolean,json:{read:{source:"enable"},write:{target:"enable"}}})],uT.prototype,"enabled",void 0),u([Fe("enabled")],uT.prototype,"writeEnabled",null),u([d({type:["icon","object","line","path","fill","water","extrude","text"],readOnly:!0})],uT.prototype,"type",void 0),uT=u([R("esri.symbols.Symbol3DLayer")],uT);const em=uT,A6e=/^-?(\d+(\.\d+)?)\s*((px)|(pt))?$/i,O6e="screenUtils.toPt: input not recognized!",bge=96;function Ms(t){return t?t/72*bge:0}function fu(t){return t?72*t/bge:0}function Jr(t){if(typeof t=="string"){const e=t.match(A6e);if(e){const r=Number(e[1]),i=e[3]&&e[3].toLowerCase(),s=t.charAt(0)==="-",n=i==="px"?fu(r):r;return s?-n:n}return console.warn(O6e),null}return t}function Ah(t=0,e=0){return{x:t,y:e}}function Zi(t=0,e=0){return[t,e]}function wge(t=0,e=0){return[t,e]}function zo(t=0,e=0,r=0){return[t,e,r]}function X2t(t){return t}function Y2t(t){return t}function J2t(t){return t}function ff(t,e){return e?(e[0]=t.x,e[1]=t.y,e.length>2&&(e[2]=0),e):[t.x,t.y]}function jF(t){const e=Uq(100*(1-t));return Math.max(0,Math.min(e,100))}function s2(t){const e=1-t/100;return Math.max(0,Math.min(e,1))}function R6e(t,e){const r=e.transparency!=null?s2(e.transparency):1,i=e.color;return i&&Array.isArray(i)?new ze([i[0]||0,i[1]||0,i[2]||0,r]):null}function P6e(t,e){e.color=t.toJSON().slice(0,3);const r=jF(t.a);r!==0&&(e.transparency=r)}const qg={type:ze,json:{type:[Xi],default:null,read:{source:["color","transparency"],reader:R6e},write:{target:{color:{type:[Xi]},transparency:{type:Xi}},writer:P6e}}},Uf={type:Number,cast:Jr,json:{write:!0}};let e1=class extends de{constructor(e){super(e),this.color=new ze([0,0,0,1]),this.extensionLength=0,this.size=fu(1)}clone(){}cloneProperties(){return{color:K(this.color),size:this.size,extensionLength:this.extensionLength}}};u([d({type:["solid","sketch"],readOnly:!0,json:{read:!0,write:{ignoreOrigin:!0}}})],e1.prototype,"type",void 0),u([d(qg)],e1.prototype,"color",void 0),u([d({...Uf,json:{write:{overridePolicy:t=>({enabled:!!t})}}})],e1.prototype,"extensionLength",void 0),u([d(Uf)],e1.prototype,"size",void 0),e1=u([R("esri.symbols.edges.Edges3D")],e1);const UW=e1;var oz;let Y$=oz=class extends UW{constructor(t){super(t),this.type="sketch"}clone(){return new oz(this.cloneProperties())}};u([tt({sketch:"sketch"},{readOnly:!0})],Y$.prototype,"type",void 0),Y$=oz=u([R("esri.symbols.edges.SketchEdges3D")],Y$);const M6e=Y$;var az;let J$=az=class extends UW{constructor(t){super(t),this.type="solid"}clone(){return new az(this.cloneProperties())}};u([tt({solid:"solid"},{readOnly:!0})],J$.prototype,"type",void 0),J$=az=u([R("esri.symbols.support.SolidEdges3D")],J$);const I6e=J$,xge={types:{key:"type",base:UW,typeMap:{solid:I6e,sketch:M6e}},json:{write:!0}};var lz;let lu=lz=class extends de{constructor(t){super(t),this.color=null}clone(){const t={color:this.color!=null?this.color.clone():null};return new lz(t)}};u([d(qg)],lu.prototype,"color",void 0),lu=lz=u([R("esri.symbols.support.Symbol3DMaterial")],lu);var cz;let Qy=cz=class extends em{constructor(t){super(t),this.type="extrude",this.size=1,this.material=null,this.castShadows=!0,this.edges=null}clone(){return new cz({edges:this.edges&&this.edges.clone(),enabled:this.enabled,material:this.material!=null?this.material.clone():null,castShadows:this.castShadows,size:this.size})}};u([tt({Extrude:"extrude"},{readOnly:!0})],Qy.prototype,"type",void 0),u([d({type:Number,json:{write:{enabled:!0,isRequired:!0}},nonNullable:!0})],Qy.prototype,"size",void 0),u([d({type:lu,json:{write:!0}})],Qy.prototype,"material",void 0),u([d({type:Boolean,nonNullable:!0,json:{write:!0,default:!0}})],Qy.prototype,"castShadows",void 0),u([d(xge)],Qy.prototype,"edges",void 0),Qy=cz=u([R("esri.symbols.ExtrudeSymbol3DLayer")],Qy);const Tge=Qy;let JC=class extends Sc{constructor(e){super(e),this.type="simple-line",this.width=.75}hash(){return`${this.type}.${this.width}`}};u([tt({esriSLS:"simple-line"},{readOnly:!0})],JC.prototype,"type",void 0),u([d({type:Number,cast:Jr,json:{write:!0}})],JC.prototype,"width",void 0),JC=u([R("esri.symbols.LineSymbol")],JC);const $6e=JC,L6e=["begin","end","begin-end"],Sge=["arrow","circle","square","diamond","cross","x"];var uz;let Gp=uz=class extends de{constructor(t){super(t),this.placement="begin-end",this.type="line-marker",this.style="arrow"}writeStyle(t,e,r,i){e[r]=i?.origin==="web-map"?"arrow":t}set color(t){this._set("color",t)}readColor(t){return t&&t[0]!=null?[t[0],t[1],t[2],t[3]/255]:t}writeColor(t,e,r,i){i?.origin==="web-map"||(e[r]=t)}clone(){return new uz({color:K(this.color),placement:this.placement,style:this.style})}hash(){return`${this.placement}.${this.color?.hash()}.${this.style}`}};u([d({type:["begin","end","begin-end"],json:{write:!0}})],Gp.prototype,"placement",void 0),u([tt({"line-marker":"line-marker"},{readOnly:!0}),d({json:{origins:{"web-map":{write:!1}}}})],Gp.prototype,"type",void 0),u([d({type:Sge})],Gp.prototype,"style",void 0),u([Fe("style")],Gp.prototype,"writeStyle",null),u([d({type:ze,value:null,json:{write:{allowNull:!0}}})],Gp.prototype,"color",null),u([Ee("color")],Gp.prototype,"readColor",null),u([Fe("color")],Gp.prototype,"writeColor",null),Gp=uz=u([R("esri.symbols.LineSymbolMarker")],Gp);const D6e=Gp;var hz;const uU=new Rr({esriSLSSolid:"solid",esriSLSDash:"dash",esriSLSDot:"dot",esriSLSDashDot:"dash-dot",esriSLSDashDotDot:"long-dash-dot-dot",esriSLSNull:"none",esriSLSInsideFrame:"inside-frame",esriSLSShortDash:"short-dash",esriSLSShortDot:"short-dot",esriSLSShortDashDot:"short-dash-dot",esriSLSShortDashDotDot:"short-dash-dot-dot",esriSLSLongDash:"long-dash",esriSLSLongDashDot:"long-dash-dot"});let Om=hz=class extends $6e{constructor(...t){super(...t),this.type="simple-line",this.style="solid",this.cap="round",this.join="round",this.marker=null,this.miterLimit=2}normalizeCtorArgs(t,e,r,i,s,n){if(t&&typeof t!="string")return t;const o={};return t!=null&&(o.style=t),e!=null&&(o.color=e),r!=null&&(o.width=Jr(r)),i!=null&&(o.cap=i),s!=null&&(o.join=s),n!=null&&(o.miterLimit=Jr(n)),o}clone(){return new hz({color:K(this.color),style:this.style,width:this.width,cap:this.cap,join:this.join,miterLimit:this.miterLimit,marker:this.marker?.clone()})}hash(){return`${super.hash()}.${this.color?.hash()}.${this.style}.${this.cap}.${this.join}.${this.miterLimit}.${this.marker?.hash()}`}};u([tt({esriSLS:"simple-line"},{readOnly:!0})],Om.prototype,"type",void 0),u([d({type:uU.apiValues,json:{read:uU.read,write:uU.write}})],Om.prototype,"style",void 0),u([d({type:["butt","round","square"],json:{write:{overridePolicy:(t,e,r)=>({enabled:t!=="round"&&(r==null||r.origin==null)})}}})],Om.prototype,"cap",void 0),u([d({type:["miter","round","bevel"],json:{write:{overridePolicy:(t,e,r)=>({enabled:t!=="round"&&(r==null||r.origin==null)})}}})],Om.prototype,"join",void 0),u([d({types:{key:"type",base:null,defaultKeyValue:"line-marker",typeMap:{"line-marker":D6e}},json:{write:!0,origins:{"web-scene":{write:!1}}}})],Om.prototype,"marker",void 0),u([d({type:Number,json:{read:!1,write:!1}})],Om.prototype,"miterLimit",void 0),Om=hz=u([R("esri.symbols.SimpleLineSymbol")],Om);const wu=Om,eEt=Object.freeze(Object.defineProperty({__proto__:null,default:wu},Symbol.toStringTag,{value:"Module"}));let QC=class extends Sc{constructor(e){super(e),this.outline=null,this.type=null}hash(){return`${this.type}.${this.outline&&this.outline.hash()}`}};u([d({types:{key:"type",base:null,defaultKeyValue:"simple-line",typeMap:{"simple-line":wu}},json:{default:null,write:!0}})],QC.prototype,"outline",void 0),u([d({type:["simple-fill","picture-fill"],readOnly:!0})],QC.prototype,"type",void 0),QC=u([R("esri.symbols.FillSymbol")],QC);const Ege=QC;let Q$=class extends de{constructor(e){super(e)}clone(){}};u([d({type:["style"],readOnly:!0,json:{read:!0,write:{ignoreOrigin:!0}}})],Q$.prototype,"type",void 0),Q$=u([R("esri.symbols.patterns.LinePattern3D")],Q$);const Cge=Q$,N6e=["dash","dash-dot","dot","long-dash","long-dash-dot","long-dash-dot-dot","none","short-dash","short-dash-dot","short-dash-dot-dot","short-dot","solid"];var dz;const F6e=Wa()({dash:"dash","dash-dot":"dash-dot","dash-dot-dot":"long-dash-dot-dot",dot:"dot","long-dash":"long-dash","long-dash-dot":"long-dash-dot",null:"none","short-dash":"short-dash","short-dash-dot":"short-dash-dot","short-dash-dot-dot":"short-dash-dot-dot","short-dot":"short-dot",solid:"solid"});let KC=dz=class extends Cge{constructor(t){super(t),this.type="style",this.style="solid"}clone(){const t={style:this.style};return new dz(t)}};u([d({type:["style"]})],KC.prototype,"type",void 0),u([tt(F6e),d({type:N6e})],KC.prototype,"style",void 0),KC=dz=u([R("esri.symbols.patterns.LineStylePattern3D")],KC);const kW=KC;let K$=class extends de{constructor(e){super(e)}clone(){}};u([d({type:["style"],readOnly:!0,json:{read:!0,write:{ignoreOrigin:!0}}})],K$.prototype,"type",void 0),K$=u([R("esri.symbols.patterns.Pattern3D")],K$);const Age=K$,U6e=["backward-diagonal","cross","diagonal-cross","forward-diagonal","horizontal","none","solid","vertical"];var pz;let eA=pz=class extends Age{constructor(t){super(t),this.type="style",this.style="solid"}clone(){const t={style:this.style};return new pz(t)}};u([d({type:["style"]})],eA.prototype,"type",void 0),u([d({type:U6e,json:{read:!0,write:!0}})],eA.prototype,"style",void 0),eA=pz=u([R("esri.symbols.patterns.StylePattern3D")],eA);const Oge=eA,k6e={types:{key:"type",base:Age,typeMap:{style:Oge}},json:{write:!0}},Rge={types:{key:"type",base:Cge,typeMap:{style:kW}},json:{write:!0}},S3=new ze("white");new ze("black");const V6e=new ze([255,255,255,0]);function z6e(t){return t.r===0&&t.g===0&&t.b===0}var fz;let E3=fz=class extends lu{constructor(t){super(t),this.colorMixMode=null}clone(){const t={color:this.color!=null?this.color.clone():null,colorMixMode:this.colorMixMode};return new fz(t)}};u([tt({multiply:"multiply",replace:"replace",tint:"tint"})],E3.prototype,"colorMixMode",void 0),E3=fz=u([R("esri.symbols.support.Symbol3DFillMaterial")],E3);function pn(t=Lge){return[t[0],t[1],t[2],t[3],t[4],t[5]]}function Kb(t,e,r,i,s,n,o=pn()){return o[0]=t,o[1]=e,o[2]=r,o[3]=i,o[4]=s,o[5]=n,o}function sEt(t,e){const r=isFinite(t[2])||isFinite(t[5]);return new _r(r?{xmin:t[0],xmax:t[3],ymin:t[1],ymax:t[4],zmin:t[2],zmax:t[5],spatialReference:e}:{xmin:t[0],xmax:t[3],ymin:t[1],ymax:t[4],spatialReference:e})}function n2(t,e){t[0]=Math.min(t[0],e[0]),t[1]=Math.min(t[1],e[1]),t[2]=Math.min(t[2],e[2]),t[3]=Math.max(t[3],e[3]),t[4]=Math.max(t[4],e[4]),t[5]=Math.max(t[5],e[5])}function B6e(t,e){t[0]=Math.min(t[0],e[0]),t[1]=Math.min(t[1],e[1]),t[3]=Math.max(t[3],e[2]),t[4]=Math.max(t[4],e[3])}function kf(t,e){t[0]=Math.min(t[0],e[0]),t[1]=Math.min(t[1],e[1]),t[2]=Math.min(t[2],e[2]),t[3]=Math.max(t[3],e[0]),t[4]=Math.max(t[4],e[1]),t[5]=Math.max(t[5],e[2])}function nu(t,e,r=0,i=e.length/3){let s=t[0],n=t[1],o=t[2],a=t[3],l=t[4],c=t[5];for(let h=0;h<i;h++)s=Math.min(s,e[r+3*h]),n=Math.min(n,e[r+3*h+1]),o=Math.min(o,e[r+3*h+2]),a=Math.max(a,e[r+3*h]),l=Math.max(l,e[r+3*h+1]),c=Math.max(c,e[r+3*h+2]);t[0]=s,t[1]=n,t[2]=o,t[3]=a,t[4]=l,t[5]=c}function hU(t,e,r){const i=e.length;let s=t[0],n=t[1],o=t[2],a=t[3],l=t[4],c=t[5];if(r)for(let h=0;h<i;h++){const p=e[h];s=Math.min(s,p[0]),n=Math.min(n,p[1]),o=Math.min(o,p[2]),a=Math.max(a,p[0]),l=Math.max(l,p[1]),c=Math.max(c,p[2])}else for(let h=0;h<i;h++){const p=e[h];s=Math.min(s,p[0]),n=Math.min(n,p[1]),a=Math.max(a,p[0]),l=Math.max(l,p[1])}t[0]=s,t[1]=n,t[2]=o,t[3]=a,t[4]=l,t[5]=c}function G6e(t){for(let e=0;e<6;e++)if(!isFinite(t[e]))return!1;return!0}function Ow(t){return t[0]>=t[3]?0:t[3]-t[0]}function Rw(t){return t[1]>=t[4]?0:t[4]-t[1]}function Z_(t){return t[2]>=t[5]?0:t[5]-t[2]}function Pge(t){const e=Ow(t),r=Z_(t),i=Rw(t);return Math.sqrt(e*e+r*r+i*i)}function Bd(t,e=[0,0,0]){return e[0]=t[0]+Ow(t)/2,e[1]=t[1]+Rw(t)/2,e[2]=t[2]+Z_(t)/2,e}function zP(t,e=[0,0,0]){return e[0]=Ow(t),e[1]=Rw(t),e[2]=Z_(t),e}function VW(t,e){return e[0]>=t[0]&&e[1]>=t[1]&&e[2]>=t[2]&&e[0]<=t[3]&&e[1]<=t[4]&&e[2]<=t[5]}function nEt(t,e){return e[0]>=t[0]&&e[1]>=t[1]&&e[2]>=t[2]&&e[3]<=t[3]&&e[4]<=t[4]&&e[5]<=t[5]}function j6e(t,e){return Math.max(e[0],t[0])<=Math.min(e[3],t[3])&&Math.max(e[1],t[1])<=Math.min(e[4],t[4])&&Math.max(e[2],t[2])<=Math.min(e[5],t[5])}function Gd(t,e){return e==null||j6e(t,e)}function Mge(t,e,r,i,s=t){return s[0]=t[0]+e,s[1]=t[1]+r,s[2]=t[2]+i,s[3]=t[3]+e,s[4]=t[4]+r,s[5]=t[5]+i,s}function oEt(t,e,r=t){const i=t[0]+Ow(t)/2,s=t[1]+Rw(t)/2,n=t[2]+Z_(t)/2;return r[0]=i+(t[0]-i)*e,r[1]=s+(t[1]-s)*e,r[2]=n+(t[2]-n)*e,r[3]=i+(t[3]-i)*e,r[4]=s+(t[4]-s)*e,r[5]=n+(t[5]-n)*e,r}function aEt(t,e){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e}function Ige(t,e,r=t){return r[0]=e[0],r[1]=e[1],r[2]=e[2],r!==t&&(r[3]=t[3],r[4]=t[4],r[5]=t[5]),r}function $ge(t,e,r=t){return r[3]=e[0],r[4]=e[1],r[5]=e[2],r!==t&&(r[0]=t[0],r[1]=t[1],r[2]=t[2]),t}function HF(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t}function xi(t){return t?HF(t,JK):pn(JK)}function zW(t,e){return e||(e=Ut()),e[0]=t[0],e[1]=t[1],e[2]=t[3],e[3]=t[4],e}function lEt(t,e){return t[0]=e[0],t[1]=e[1],t[2]=Number.NEGATIVE_INFINITY,t[3]=e[2],t[4]=e[3],t[5]=Number.POSITIVE_INFINITY,t}function H6e(t,e,r,i,s){return t[0]=e,t[1]=r,t[2]=Number.NEGATIVE_INFINITY,t[3]=i,t[4]=s,t[5]=Number.POSITIVE_INFINITY,t}function mz(t){return t.length===6}function BW(t){return Ow(t)===0&&Rw(t)===0&&Z_(t)===0}function cEt(t,e,r){if(t==null||e==null)return t===e;if(!mz(t)||!mz(e))return!1;if(r){for(let i=0;i<t.length;i++)if(!r(t[i],e[i]))return!1}else for(let i=0;i<t.length;i++)if(t[i]!==e[i])return!1;return!0}function q6e(t,e,r,i,s,n){return Kb(t,e,r,i,s,n,W6e)}const uEt=[-1/0,-1/0,-1/0,1/0,1/0,1/0],JK=[1/0,1/0,1/0,-1/0,-1/0,-1/0],Lge=[0,0,0,0,0,0],W6e=pn();function dU(t,{isPrimitive:e,width:r,depth:i,height:s}){const n=e?10:1;if(r==null&&s==null&&i==null)return[n*t[0],n*t[1],n*t[2]];const o=Oe(r,i,s);let a;for(let l=0;l<3;l++){const c=o[l];if(c!=null){a=c/t[l];break}}for(let l=0;l<3;l++)o[l]==null&&(o[l]=t[l]*a);return o}const Z6e=Kb(-.5,-.5,-.5,.5,.5,.5),X6e=Kb(-.5,-.5,0,.5,.5,1),Y6e=Kb(-.5,-.5,0,.5,.5,.5);function J6e(t){switch(t){case"sphere":case"cube":case"diamond":return Z6e;case"cylinder":case"cone":case"inverted-cone":return X6e;case"tetrahedron":return Y6e;default:return}}const GW=["butt","square","round"],Q6e=[...GW,"none"],Dge=["miter","bevel","round"];var gz;let t1=gz=class extends de{constructor(t){super(t),this.color=new ze([0,0,0,1]),this.size=fu(1),this.pattern=null,this.patternCap="butt"}clone(){const t={color:this.color!=null?this.color.clone():null,size:this.size,pattern:this.pattern!=null?this.pattern.clone():null,patternCap:this.patternCap};return new gz(t)}};u([d(qg)],t1.prototype,"color",void 0),u([d(Uf)],t1.prototype,"size",void 0),u([d(Rge)],t1.prototype,"pattern",void 0),u([d({type:GW,json:{default:"butt",write:{overridePolicy(){return{enabled:this.pattern!=null}}}}})],t1.prototype,"patternCap",void 0),t1=gz=u([R("esri.symbols.support.Symbol3DOutline")],t1);var eL;let Rm=eL=class extends em{constructor(t){super(t),this.type="fill",this.material=null,this.pattern=null,this.castShadows=!0,this.outline=null,this.edges=null}clone(){const t={edges:this.edges!=null?this.edges.clone():null,enabled:this.enabled,material:this.material!=null?this.material.clone():null,pattern:this.pattern!=null?this.pattern.clone():null,castShadows:this.castShadows,outline:this.outline!=null?this.outline.clone():null};return new eL(t)}static fromSimpleFillSymbol(t){const e=t.outline&&t.outline.style&&t.outline.style!=="inside-frame"&&t.outline.style!=="solid"?new kW({style:t.outline.style}):null,r={size:t.outline?.width??0,color:(t.outline?.color??S3).clone(),pattern:e};return e&&t.outline?.cap&&(r.patternCap=t.outline.cap),new eL({material:new E3({color:(t.color??V6e).clone()}),pattern:t.style&&t.style!=="solid"?new Oge({style:t.style}):null,outline:r})}};u([tt({Fill:"fill"},{readOnly:!0})],Rm.prototype,"type",void 0),u([d({type:E3,json:{write:!0}})],Rm.prototype,"material",void 0),u([d(k6e)],Rm.prototype,"pattern",void 0),u([d({type:Boolean,nonNullable:!0,json:{write:!0,default:!0}})],Rm.prototype,"castShadows",void 0),u([d({type:t1,json:{write:!0}})],Rm.prototype,"outline",void 0),u([d(xge)],Rm.prototype,"edges",void 0),Rm=eL=u([R("esri.symbols.FillSymbol3DLayer")],Rm);const DR=Rm,K6e=["none","underline","line-through"],eUe=["normal","italic","oblique"],tUe=["normal","lighter","bold","bolder"],Nge={type:Number,cast:t=>{const e=sh(t);return e===0?1:ge(e,.1,4)},nonNullable:!0},rUe=["left","right","center"],iUe=["baseline","top","middle","bottom"],Fge={type:rUe,nonNullable:!0},Uge={type:iUe,nonNullable:!0},hEt=8;var yz;let Pm=yz=class extends de{constructor(t){super(t),this.decoration="none",this.family="sans-serif",this.size=9,this.style="normal",this.weight="normal"}castSize(t){return Jr(t)}clone(){return new yz({decoration:this.decoration,family:this.family,size:this.size,style:this.style,weight:this.weight})}hash(){return`${this.decoration}.${this.family}.${this.size}.${this.style}.${this.weight}`}};u([d({type:K6e,json:{default:"none",write:!0}})],Pm.prototype,"decoration",void 0),u([d({type:String,json:{write:!0}})],Pm.prototype,"family",void 0),u([d({type:Number,json:{write:{overridePolicy:(t,e,r)=>({enabled:!r||!r.textSymbol3D})}}})],Pm.prototype,"size",void 0),u([yr("size")],Pm.prototype,"castSize",null),u([d({type:eUe,json:{default:"normal",write:!0}})],Pm.prototype,"style",void 0),u([d({type:tUe,json:{default:"normal",write:!0}})],Pm.prototype,"weight",void 0),Pm=yz=u([R("esri.symbols.Font")],Pm);const qF=Pm;function Dg(t,e){const r=e&&e.url&&e.url.path;if(t&&r&&(t=_l(t,r,{preserveProtocolRelative:!0}),e.portalItem&&e.readResourcePaths)){const i=Aq(t,e.portalItem.itemUrl);i!=null&&sUe.test(i)&&e.readResourcePaths.push(e.portalItem.resourceFromPath(i).path)}return _z(t,e&&e.portal)}function Ng(t,e,r=o2.YES){if(t==null)return t;!mc(t)&&e&&e.blockedRelativeUrls&&e.blockedRelativeUrls.push(t);let i=_l(t);if(e){const s=e.verifyItemRelativeUrls&&e.verifyItemRelativeUrls.rootPath||e.url&&e.url.path;if(s){const n=_z(s,e.portal),o=_z(i,e.portal);i=Aq(o,n,n),i!=null&&i!==o&&i!==t&&e.verifyItemRelativeUrls&&e.verifyItemRelativeUrls.writtenUrls.push(i)}}return i=Bge(i,e?.portal),mc(i)&&(i=vh(i)),e?.resources&&e?.portalItem&&!mc(i)&&!Jf(i)&&r===o2.YES&&e.resources.toKeep.push({resource:e.portalItem.resourceFromPath(i),compress:!1}),i}function WF(t,e,r){return Dg(t,r)}function O_(t,e,r,i){const s=Ng(t,i);s!==void 0&&(e[r]=s)}const kge=/\/items\/([^\/]+)\/resources\/(.*)/,sUe=/^\.\/resources\//;function Vge(t){return(t?.match(kge)??null)?.[1]??null}function zge(t){const e=t?.match(kge)??null;if(e==null)return null;const r=e[2],i=r.lastIndexOf("/");if(i===-1){const{path:o,extension:a}=MQ(r);return{prefix:null,filename:o,extension:a}}const{path:s,extension:n}=MQ(r.slice(i+1));return{prefix:r.slice(0,i),filename:s,extension:n}}function Bge(t,e){return e&&!e.isPortal&&e.urlKey&&e.customBaseUrl?Yk(t,`${e.urlKey}.${e.customBaseUrl}`,e.portalHostname):t}function _z(t,e){if(!e||e.isPortal||!e.urlKey||!e.customBaseUrl)return t;const r=`${e.urlKey}.${e.customBaseUrl}`,i=Sq();return Ql(i,`${i.scheme}://${r}`)?Yk(t,e.portalHostname,r):Yk(t,r,e.portalHostname)}var o2;(function(t){t[t.YES=0]="YES",t[t.NO=1]="NO"})(o2||(o2={}));const nUe=Object.freeze(Object.defineProperty({__proto__:null,get MarkKeep(){return o2},ensureMainOnlineDomain:Bge,fromJSON:Dg,itemIdFromResourceUrl:Vge,prefixAndFilenameFromResourceUrl:zge,read:WF,toJSON:Ng,write:O_},Symbol.toStringTag,{value:"Module"}));var vz;const oUe=Wa()({circle:"circle",square:"square",cross:"cross",x:"x",kite:"kite",triangle:"triangle"});let r1=vz=class extends de{constructor(t){super(t)}readHref(t,e,r){return t?Dg(t,r):e.dataURI}writeHref(t,e,r,i){t&&(Jf(t)?e.dataURI=t:(e.href=Ng(t,i),mc(e.href)&&(e.href=vh(e.href))))}clone(){return new vz({href:this.href,primitive:this.primitive})}};u([d({type:String,json:{write:!0,read:{source:["href","dataURI"]}}})],r1.prototype,"href",void 0),u([Ee("href")],r1.prototype,"readHref",null),u([Fe("href",{href:{type:String},dataURI:{type:String}})],r1.prototype,"writeHref",null),u([tt(oUe)],r1.prototype,"primitive",void 0),r1=vz=u([R("esri.symbols.support.IconSymbol3DLayerResource")],r1);const aUe="circle";var bz;let tS=bz=class extends Te{constructor(){super(...arguments),this.x=0,this.y=0}clone(){return new bz({x:this.x,y:this.y})}};u([d({type:Number})],tS.prototype,"x",void 0),u([d({type:Number})],tS.prototype,"y",void 0),tS=bz=u([R("esri.symbols.support.Symbol3DAnchorPosition2D")],tS);var wz;let tA=wz=class extends de{constructor(t){super(t),this.color=new ze([0,0,0,1]),this.size=fu(1)}clone(){const t={color:this.color!=null?this.color.clone():null,size:this.size};return new wz(t)}};u([d(qg)],tA.prototype,"color",void 0),u([d(Uf)],tA.prototype,"size",void 0),tA=wz=u([R("esri.symbols.support.Symbol3DIconOutline")],tA);var hT;const Gge="esri.symbols.IconSymbol3DLayer";let jp=hT=class extends em{constructor(t){super(t),this.material=null,this.resource=null,this.type="icon",this.size=12,this.anchor="center",this.anchorPosition=null,this.outline=null}clone(){return new hT({anchor:this.anchor,anchorPosition:this.anchorPosition&&this.anchorPosition.clone(),enabled:this.enabled,material:this.material!=null?this.material.clone():null,outline:this.outline!=null?this.outline.clone():null,resource:this.resource&&this.resource.clone(),size:this.size})}static fromSimpleMarkerSymbol(t){const e=t.color||S3,r=QK(t),i=t.outline&&t.outline.width>0?{size:t.outline.width,color:(t.outline.color||S3).clone()}:null;return new hT({size:t.size,resource:{primitive:cUe(t.style)},material:{color:e},outline:i,anchor:r?"relative":void 0,anchorPosition:r})}static fromPictureMarkerSymbol(t){const e=!t.color||z6e(t.color)?S3:t.color,r=QK(t);return new hT({size:t.width<=t.height?t.height:t.width,resource:{href:t.url},material:{color:e.clone()},anchor:r?"relative":void 0,anchorPosition:r})}static fromCIMSymbol(t){return new hT({resource:{href:Vde({mediaType:"application/json",data:JSON.stringify(t.data)})}})}};function QK(t){const e="width"in t?t.width:t.size,r="height"in t?t.height:t.size,i=KK(t.xoffset),s=KK(t.yoffset);return(i||s)&&e&&r?{x:-i/e,y:s/r}:null}function KK(t){return isFinite(t)?t:0}u([d({type:lu,json:{write:!0}})],jp.prototype,"material",void 0),u([d({type:r1,json:{write:!0}})],jp.prototype,"resource",void 0),u([tt({Icon:"icon"},{readOnly:!0})],jp.prototype,"type",void 0),u([d(Uf)],jp.prototype,"size",void 0),u([tt({center:"center",left:"left",right:"right",top:"top",bottom:"bottom",topLeft:"top-left",topRight:"top-right",bottomLeft:"bottom-left",bottomRight:"bottom-right",relative:"relative"}),d({json:{default:"center"}})],jp.prototype,"anchor",void 0),u([d({type:tS,json:{type:[Number],read:{reader:t=>new tS({x:t[0],y:t[1]})},write:{writer:(t,e)=>{e.anchorPosition=[t.x,t.y]},overridePolicy(){return{enabled:this.anchor==="relative"}}}}})],jp.prototype,"anchorPosition",void 0),u([d({type:tA,json:{write:!0}})],jp.prototype,"outline",void 0),jp=hT=u([R(Gge)],jp);const lUe={circle:"circle",cross:"cross",diamond:"kite",square:"square",x:"x",triangle:"triangle",path:null};function cUe(t){return lUe[t]||(Q.getLogger(Gge).warn(`${t} cannot be mapped to Icon symbol. Fallback to "circle"`),"circle")}const Q0=jp;function ew(t,e,r=Pt){return e||(e=new r),e===t||(e.removeAll(),uUe(t)?e.addMany(t):t&&e.add(t)),e}function jge(t){return t}function uUe(t){return t&&(Array.isArray(t)||"items"in t&&Array.isArray(t.items))}const hUe="not-loaded",dUe="loading",pUe="failed",eee="loaded",Hge=t=>{let e=class extends t{constructor(...r){super(...r),this._loadController=null,this.loadError=null,this.loadStatus="not-loaded",this._set("loadWarnings",[]),this.addResolvingPromise(new Promise(i=>{const s=this.load.bind(this);this.load=n=>{const o=new Promise((a,l)=>{const c=wq(n,l);this.destroyed&&l(new F("load:instance-destroyed",`Instance of '${this.declaredClass||this.constructor.name}' is already destroyed`,{instance:this})),this.when(a,l).finally(()=>{c&&c.remove()})});if(this.loadStatus===hUe){this._set("loadStatus",dUe);const a=this._loadController=new AbortController;s({signal:a.signal}),nn(a.signal,()=>{this._promiseProps.abort()})}return i(),o}})),this.when(()=>{this._set("loadStatus",eee),this._loadController=null},i=>{this._set("loadStatus",pUe),this._set("loadError",i),this._loadController=null})}destroy(){this._loadController=pu(this._loadController),this._set("loadError",null),this._set("loadWarnings",[])}get loaded(){return this.loadStatus===eee}get loadWarnings(){return this._get("loadWarnings")}load(){return null}cancelLoad(){return this.isFulfilled()||(this._set("loadError",new F("load:cancelled","Cancelled")),this._loadController?.abort()),this}};return u([d({readOnly:!0})],e.prototype,"loaded",null),u([d({readOnly:!0})],e.prototype,"loadError",void 0),u([d({clonable:!1})],e.prototype,"loadStatus",void 0),u([d({type:[Sh],readOnly:!0})],e.prototype,"loadWarnings",null),e=u([R("esri.core.Loadable")],e),e};let rA=class extends Hge(uN){};rA=u([R("esri.core.Loadable")],rA),function(t){function e(r){return!(!r||!r.load)}t.LoadableMixin=Hge,t.isLoadable=e}(rA||(rA={}));const Fg=rA;let BP;function fUe(t){return BP&&!BP.destroyed||(BP=t()),BP}var xz;const mUe=new Rr({avgRating:"avg-rating",numRatings:"num-ratings",numComments:"num-comments",numViews:"num-views"});let Fu=xz=class extends Te{constructor(t){super(t),this.categories=null,this.disableExtraQuery=!1,this.extent=null,this.filter=null,this.num=10,this.query=null,this.sortField=null,this.start=1}get sortOrder(){return this._get("sortOrder")||"asc"}set sortOrder(t){t!=="asc"&&t!=="desc"||this._set("sortOrder",t)}clone(){return new xz({categories:this.categories?K(this.categories):null,disableExtraQuery:this.disableExtraQuery,extent:this.extent?this.extent.clone():null,filter:this.filter,num:this.num,query:this.query,sortField:this.sortField,sortOrder:this.sortOrder,start:this.start})}toRequestOptions(t,e){let r=[];this.categories&&(r=this.categories.map(o=>Array.isArray(o)?JSON.stringify(o):o));let i="";if(this.extent){const o=Sw(this.extent,je.WGS84);o!=null&&(i=`${o.xmin},${o.ymin},${o.xmax},${o.ymax}`)}let s=this.query;!this.disableExtraQuery&&t.extraQuery&&(s="("+s+")"+t.extraQuery);const n={categories:r,bbox:i,q:s,filter:this.filter,num:this.num,sortField:null,sortOrder:null,start:this.start};return this.sortField&&(n.sortField=this.sortField.split(",").map(o=>mUe.toJSON(o.trim())).join(","),n.sortOrder=this.sortOrder),{query:{...e,...n}}}};u([d()],Fu.prototype,"categories",void 0),u([d()],Fu.prototype,"disableExtraQuery",void 0),u([d({type:_r})],Fu.prototype,"extent",void 0),u([d()],Fu.prototype,"filter",void 0),u([d()],Fu.prototype,"num",void 0),u([d()],Fu.prototype,"query",void 0),u([d()],Fu.prototype,"sortField",void 0),u([d()],Fu.prototype,"sortOrder",null),u([d()],Fu.prototype,"start",void 0),Fu=xz=u([R("esri.portal.PortalQueryParams")],Fu);const mf=Fu;let i1=class extends Te{constructor(e){super(e),this.nextQueryParams=null,this.queryParams=null,this.results=null,this.total=null}};u([d()],i1.prototype,"nextQueryParams",void 0),u([d()],i1.prototype,"queryParams",void 0),u([d()],i1.prototype,"results",void 0),u([d()],i1.prototype,"total",void 0),i1=u([R("esri.portal.PortalQueryResult")],i1);const gUe=i1;let Mm=class extends de{constructor(e){super(e),this.created=null,this.id=null,this.portal=null,this.title=null,this.username=null}get url(){const e=this.get("portal.restUrl");return e?`${e}/content/users/${this.username}/${this.id}`:null}toJSON(){throw new F("internal:not-yet-implemented","PortalFolder.toJSON is not yet implemented")}};u([d({type:Date})],Mm.prototype,"created",void 0),u([d()],Mm.prototype,"id",void 0),u([d()],Mm.prototype,"portal",void 0),u([d()],Mm.prototype,"title",void 0),u([d({readOnly:!0})],Mm.prototype,"url",null),u([d()],Mm.prototype,"username",void 0),Mm=u([R("esri.portal.PortalFolder")],Mm);const yUe=Mm;let oo=class extends de{constructor(e){super(e),this.access=null,this.created=null,this.description=null,this.id=null,this.isInvitationOnly=!1,this.modified=null,this.owner=null,this.portal=null,this.snippet=null,this.sortField=null,this.sortOrder=null,this.tags=null,this.title=null}get thumbnailUrl(){const e=this.url,r=this.thumbnail;return e&&r&&this.portal?this.portal?.normalizeUrl(`${e}/info/${r}?f=json`):null}get url(){const e=this.get("portal.restUrl");return e?e+"/community/groups/"+this.id:null}fetchCategorySchema(e){return rc(this.portal).request(this.url+"/categorySchema",e).then(r=>{const i=r.categorySchema||[];return i.some(s=>s.source==="contentCategorySetsGroupQuery.LivingAtlas")?this._fetchCategorySchemaSet("LivingAtlas",e):i})}fetchMembers(e){return rc(this.portal).request(this.url+"/users",e)}getThumbnailUrl(e){let r=this.thumbnailUrl;return r&&e&&(r+=`&w=${e}`),r}toJSON(){throw new F("internal:not-yet-implemented","PortalGroup.toJSON is not yet implemented")}queryItems(e,r){let i=Zs(mf,e);const s=rc(this.portal);return parseFloat(s.currentVersion)>5?(i=i||new mf,s.queryPortal(`/content/groups/${this.id}/search`,i,"PortalItem",r)):(i=i?i.clone():new mf,i.query="group:"+this.id+(i.query?" "+i.query:""),s.queryItems(i,r))}_fetchCategorySchemaSet(e,r){const i=rc(this.portal);return i.fetchSelf(i.authMode,!0,r).then(s=>{const n=s.contentCategorySetsGroupQuery;if(n){const o=new mf;return o.disableExtraQuery=!0,o.num=1,o.query=n,i.queryGroups(o,r)}throw new F("portal-group:fetchCategorySchema","contentCategorySetsGroupQuery value not found")}).then(s=>{if(s.total){const n=s.results[0],o=new mf;return o.num=1,o.query=`typekeywords:"${e}"`,n.queryItems(o,r)}throw new F("portal-group:fetchCategorySchema","contentCategorySetsGroupQuery group not found")}).then(s=>s.total?s.results[0].fetchData("json",r).then(n=>{const o=n&&n.categorySchema;return o&&o.length?o:[]}):[])}};u([d()],oo.prototype,"access",void 0),u([d({type:Date})],oo.prototype,"created",void 0),u([d()],oo.prototype,"description",void 0),u([d()],oo.prototype,"id",void 0),u([d()],oo.prototype,"isInvitationOnly",void 0),u([d({type:Date})],oo.prototype,"modified",void 0),u([d()],oo.prototype,"owner",void 0),u([d()],oo.prototype,"portal",void 0),u([d()],oo.prototype,"snippet",void 0),u([d()],oo.prototype,"sortField",void 0),u([d()],oo.prototype,"sortOrder",void 0),u([d()],oo.prototype,"tags",void 0),u([d()],oo.prototype,"thumbnail",void 0),u([d({readOnly:!0})],oo.prototype,"thumbnailUrl",null),u([d()],oo.prototype,"title",void 0),u([d({readOnly:!0})],oo.prototype,"url",null),oo=u([R("esri.portal.PortalGroup")],oo);const Tz=oo,_Ue=Object.freeze(Object.defineProperty({__proto__:null,default:Tz},Symbol.toStringTag,{value:"Module"}));var Sz;let ls=Sz=class extends de{constructor(...t){super(...t),this.access=null,this.created=null,this.culture=null,this.description=null,this.email=null,this.fullName=null,this.modified=null,this.orgId=null,this.portal=null,this.preferredView=null,this.privileges=null,this.region=null,this.role=null,this.roleId=null,this.sourceJSON=null,this.units=null,this.username=null,this.userType=null}get thumbnailUrl(){const t=this.url,e=this.thumbnail;return t&&e?this.portal.normalizeUrl(`${t}/info/${e}?f=json`):null}get userContentUrl(){const t=this.get("portal.restUrl");return t?`${t}/content/users/${this.username}`:null}get url(){const t=this.get("portal.restUrl");return t?`${t}/community/users/${this.username}`:null}addItem(t){const e=t&&t.item,r=t&&t.data,i=t&&t.folder,s={method:"post"};e&&(s.query=e.createPostQuery(),r!=null&&(typeof r=="string"?s.query.text=r:typeof r=="object"&&(s.query.text=JSON.stringify(r))));let n=this.userContentUrl;return i&&(n+="/"+(typeof i=="string"?i:i.id)),this.portal.request(n+"/addItem",s).then(o=>(e.id=o.id,e.portal=this.portal,e.loaded?e.reload():e.load()))}deleteItem(t){let e=this.userContentUrl;return t.ownerFolder&&(e+="/"+t.ownerFolder),this.portal.request(e+`/items/${t.id}/delete`,{method:"post"}).then(()=>{t.id=null,t.portal=null})}deleteItems(t){const e=this.userContentUrl+"/deleteItems",r=t.map(i=>i.id);if(r.length){const i={method:"post",query:{items:r.join(",")}};return this.portal.request(e,i).then(()=>{t.forEach(s=>{s.id=null,s.portal=null})})}return Promise.resolve(void 0)}fetchFolders(){const t={query:{num:1}};return this.portal.request(this.userContentUrl??"",t).then(e=>{let r;return r=e&&e.folders?e.folders.map(i=>{const s=yUe.fromJSON(i);return s.portal=this.portal,s}):[],r})}fetchGroups(){return this.portal.request(this.url??"").then(t=>{let e;return e=t&&t.groups?t.groups.map(r=>{const i=Tz.fromJSON(r);return i.portal=this.portal,i}):[],e})}fetchItems(t){const e=t??{};let r,i=this.userContentUrl??"";return e.folder&&(i+="/"+e.folder.id),ae(()=>Promise.resolve().then(()=>b_e),void 0,import.meta.url).then(({default:s})=>{r=s;const n={folders:!1,num:e.num||10,start:e.start||1,sortField:e.sortField||"created",sortOrder:e.sortOrder||"asc"};return this.portal.request(i,{query:n})}).then(s=>{let n;return s&&s.items?(n=s.items.map(o=>{const a=r.fromJSON(o);return a.portal=this.portal,a}),Promise.all(n.map(o=>o.load())).catch(o=>o).then(()=>({items:n,nextStart:s.nextStart,total:s.total}))):{items:[],nextStart:-1,total:0}})}fetchTags(){return this.portal.request(this.url+"/tags").then(t=>t.tags)}getThumbnailUrl(t){let e=this.thumbnailUrl;return e&&t&&(e+=`&w=${t}`),e}queryFavorites(t){return this.favGroupId?(this._favGroup||(this._favGroup=new Tz({id:this.favGroupId,portal:this.portal})),this._favGroup.queryItems(t)):Promise.reject(new F("internal:unknown","Unknown internal error",{internalError:"Unknown favGroupId"}))}toJSON(){throw new F("internal:not-yet-implemented","PortalGroup.toJSON is not yet implemented")}static fromJSON(t){if(!t)return null;if(t.declaredClass)throw new Error("JSON object is already hydrated");const e=new Sz;return e.sourceJSON=t,e.read(t),e}};u([d()],ls.prototype,"access",void 0),u([d({type:Date})],ls.prototype,"created",void 0),u([d()],ls.prototype,"culture",void 0),u([d()],ls.prototype,"description",void 0),u([d()],ls.prototype,"email",void 0),u([d()],ls.prototype,"favGroupId",void 0),u([d()],ls.prototype,"fullName",void 0),u([d({type:Date})],ls.prototype,"modified",void 0),u([d()],ls.prototype,"orgId",void 0),u([d()],ls.prototype,"portal",void 0),u([d()],ls.prototype,"preferredView",void 0),u([d()],ls.prototype,"privileges",void 0),u([d()],ls.prototype,"region",void 0),u([d()],ls.prototype,"role",void 0),u([d()],ls.prototype,"roleId",void 0),u([d()],ls.prototype,"sourceJSON",void 0),u([d()],ls.prototype,"thumbnail",void 0),u([d({readOnly:!0})],ls.prototype,"thumbnailUrl",null),u([d()],ls.prototype,"units",void 0),u([d({readOnly:!0})],ls.prototype,"userContentUrl",null),u([d({readOnly:!0})],ls.prototype,"url",null),u([d()],ls.prototype,"username",void 0),u([d()],ls.prototype,"userType",void 0),ls=Sz=u([R("esri.portal.PortalUser")],ls);const jW=ls,vUe=Object.freeze(Object.defineProperty({__proto__:null,default:jW},Symbol.toStringTag,{value:"Module"}));var Im;let GP;const tee={PortalGroup:()=>ae(()=>Promise.resolve().then(()=>_Ue),void 0,import.meta.url),PortalItem:()=>ae(()=>Promise.resolve().then(()=>b_e),void 0,import.meta.url),PortalUser:()=>ae(()=>Promise.resolve().then(()=>vUe),void 0,import.meta.url)};let Ie=Im=class extends K2(Fg){constructor(t){super(t),this._esriIdCredentialCreateHandle=null,this.access=null,this.allSSL=!1,this.authMode="auto",this.authorizedCrossOriginDomains=null,this.basemapGalleryGroupQuery=null,this.basemapGalleryGroupQuery3D=null,this.bingKey=null,this.canListApps=!1,this.canListData=!1,this.canListPreProvisionedItems=!1,this.canProvisionDirectPurchase=!1,this.canSearchPublic=!0,this.canShareBingPublic=!1,this.canSharePublic=!1,this.canSignInArcGIS=!1,this.canSignInIDP=!1,this.colorSetsGroupQuery=null,this.commentsEnabled=!1,this.created=null,this.culture=null,this.customBaseUrl=null,this.defaultBasemap=null,this.defaultDevBasemap=null,this.defaultExtent=null,this.defaultVectorBasemap=null,this.description=null,this.devBasemapGalleryGroupQuery=null,this.eueiEnabled=null,this.featuredGroups=null,this.featuredItemsGroupQuery=null,this.galleryTemplatesGroupQuery=null,this.livingAtlasGroupQuery=null,this.hasCategorySchema=!1,this.helperServices=null,this.homePageFeaturedContent=null,this.homePageFeaturedContentCount=null,this.httpPort=null,this.httpsPort=null,this.id=null,this.ipCntryCode=null,this.isPortal=!1,this.isReadOnly=!1,this.layerTemplatesGroupQuery=null,this.maxTokenExpirationMinutes=null,this.modified=null,this.name=null,this.portalHostname=null,this.portalMode=null,this.portalProperties=null,this.region=null,this.rotatorPanels=null,this.showHomePageDescription=!1,this.sourceJSON=null,this.supportsHostedServices=!1,this.symbolSetsGroupQuery=null,this.templatesGroupQuery=null,this.units=null,this.url=Ur.portalUrl,this.urlKey=null,this.user=null,this.use3dBasemaps=!0,this.useStandardizedQuery=!1,this.useVectorBasemaps=!1,this.vectorBasemapGalleryGroupQuery=null}normalizeCtorArgs(t){return typeof t=="string"?{url:t}:t}destroy(){ree.unregister(this),this.defaultBasemap=Me(this.defaultBasemap),this.defaultDevBasemap=Me(this.defaultDevBasemap),this.defaultVectorBasemap=Me(this.defaultVectorBasemap),this._esriIdCredentialCreateHandle=Ii(this._esriIdCredentialCreateHandle)}readAuthorizedCrossOriginDomains(t){if(t)for(const e of t)Ur.request.trustedServers.includes(e)||Ur.request.trustedServers.push(e);return t}readDefaultBasemap(t){return this._readBasemap(t)}readDefaultDevBasemap(t){return this._readBasemap(t)}readDefaultVectorBasemap(t){return this._readBasemap(t)}get extraQuery(){const t=!(this.user&&this.user.orgId)||this.canSearchPublic;return this.id&&!t?` AND orgid:${this.id}`:null}get isOrganization(){return!!this.access}get itemPageUrl(){return this.url?`${this.url}/home/item.html`:null}get restUrl(){let t=this.url;if(t){const e=t.indexOf("/sharing");t=e>0?t.substring(0,e):this.url.replace(/\/+$/,""),t+="/sharing/rest"}return t}get thumbnailUrl(){const t=this.restUrl,e=this.thumbnail;return t&&e?this._normalizeSSL(t+"/portals/self/resources/"+e):null}readUrlKey(t){return t&&t.toLowerCase()}readUser(t){let e=null;return t&&(e=jW.fromJSON(t),e.portal=this),e}load(t){const e=ae(()=>Promise.resolve().then(()=>Ije),void 0,import.meta.url).then(({default:r})=>{Xt(t),GP=r}).then(()=>this.sourceJSON?this.sourceJSON:this.fetchSelf(this.authMode,!1,t)).then(r=>{if(Gt){const i=Gt;this.credential=i.findCredential(this.restUrl),this.credential||this.authMode!==Im.AUTH_MODE_AUTO||(this._esriIdCredentialCreateHandle?.remove(),this._esriIdCredentialCreateHandle=i.on("credential-create",bUe(new WeakRef(this))),ree.register(this,this._esriIdCredentialCreateHandle,this))}this.sourceJSON=r,this.read(r)});return this.addResolvingPromise(e),Promise.resolve(this)}async createElevationLayers(){await this.load();const t=this._getHelperService("defaultElevationLayers"),e=(await ae(()=>import("./ElevationLayer-a2ac5b02.js"),["./ElevationLayer-a2ac5b02.js","./ArcGISCachedService-ca4b2177.js","./TileInfoTilemapCache-cb2cb64a.js","./TilemapCache-92e9a460.js"],import.meta.url)).default;return t?t.map(r=>new e({id:r.id,url:r.url})):[]}async fetchBasemaps(t,e){const r=await this._fetchBasemaps(t,e);if(e?.include3d===!0&&this.use3dBasemaps!==!1){const i=await this._fetchBasemaps3D(t,e);r.unshift(...i)}return r}fetchCategorySchema(t){return this.hasCategorySchema?this.request(this.restUrl+"/portals/self/categorySchema",t).then(e=>e.categorySchema):sn(t)?Promise.reject(Dr()):Promise.resolve([])}fetchFeaturedGroups(t){const e=this.featuredGroups,r=new mf;if(r.num=100,r.sortField="title",e&&e.length){const i=[];for(const s of e)i.push(`(title:"${s.title}" AND owner:${s.owner})`);return r.query=i.join(" OR "),this.queryGroups(r,t).then(s=>s.results)}return sn(t)?Promise.reject(Dr()):Promise.resolve([])}fetchRegions(t){const e=this.user?.culture||this.culture||_h();return this.request(this.restUrl+"/portals/regions",{...t,query:{culture:e}})}fetchSettings(t){const e=this.user?.culture||this.culture||_h();return this.request(this.restUrl+"/portals/self/settings",{...t,query:{culture:e}})}static getDefault(){return fUe(()=>new Im)}queryGroups(t,e){return this.queryPortal("/community/groups",t,"PortalGroup",e)}queryItems(t,e){return this.queryPortal("/search",t,"PortalItem",e)}queryUsers(t,e){return t.sortField||(t.sortField="username"),this.queryPortal("/community/users",t,"PortalUser",e)}fetchSelf(t=this.authMode,e=!1,r){const i=this.restUrl+"/portals/self",s={authMode:t,query:{culture:_h().toLowerCase()},...r};return s.authMode==="auto"&&(s.authMode="no-prompt"),e&&(s.query.default=!0),this.request(i,s)}queryPortal(t,e,r,i){const s=Zs(mf,e),n=o=>this.request(this.restUrl+t,{...s.toRequestOptions(this),...i}).then(a=>{const l=s.clone();return l.start=a.nextStart,new gUe({nextQueryParams:l,queryParams:s,total:a.total,results:Im._resultsToTypedArray(o,{portal:this},a,i)})}).then(a=>Promise.all(a.results.map(l=>typeof l.when=="function"?l.when():a)).then(()=>a,l=>(Lo(l),a)));return r&&tee[r]?tee[r]().then(({default:o})=>(Xt(i),n(o))):n()}signIn(){if(this.authMode===Im.AUTH_MODE_ANONYMOUS)return Promise.reject(new F("portal:invalid-auth-mode",`Current "authMode"' is "${this.authMode}"`));if(this.loadStatus==="failed")return Promise.reject(this.loadError);const t=e=>Promise.resolve().then(()=>this.loadStatus==="not-loaded"?(e||(this.authMode="immediate"),this.load().then(()=>null)):this.loadStatus==="loading"?this.load().then(()=>this.credential?null:(this.credential=e,this.fetchSelf("immediate"))):this.user&&this.credential===e?null:(this.credential=e,this.fetchSelf("immediate"))).then(r=>{r&&(this.sourceJSON=r,this.read(r))});return Gt?Gt.getCredential(this.restUrl).then(e=>t(e)):t(this.credential)}normalizeUrl(t){const e=this.credential&&this.credential.token;return this._normalizeSSL(e?t+(t.includes("?")?"&":"?")+"token="+e:t)}requestToTypedArray(t,e,r){return this.request(t,e).then(i=>{const s=Im._resultsToTypedArray(r,{portal:this},i);return Promise.all(s.map(n=>typeof n.when=="function"?n.when():i)).then(()=>s,()=>s)})}request(t,e={}){const r={f:"json",...e.query},{authMode:i=this.authMode===Im.AUTH_MODE_ANONYMOUS?"anonymous":"auto",body:s=null,cacheBust:n=!1,method:o="auto",responseType:a="json",signal:l}=e,c={authMode:i,body:s,cacheBust:n,method:o,query:r,responseType:a,timeout:0,signal:l};return qt(this._normalizeSSL(t),c).then(h=>h.data)}toJSON(){throw new F("internal:not-yet-implemented","Portal.toJSON is not yet implemented")}static fromJSON(t){if(!t)return null;if(t.declaredClass)throw new Error("JSON object is already hydrated");return new Im({sourceJSON:t})}_getHelperService(t){const e=this.helperServices&&this.helperServices[t];if(!e)throw new F("portal:service-not-found",`The \`helperServices\` do not include an entry named "${t}"`);return e}async _fetchBasemaps(t,e){const r=new mf;r.query=t||(Ur.apiKey&&Zde(this.url)?this.devBasemapGalleryGroupQuery:this.useVectorBasemaps?this.vectorBasemapGalleryGroupQuery:this.basemapGalleryGroupQuery),r.disableExtraQuery=!0;const i=await this.queryGroups(r,e);if(!i.total)return[];const s=i.results[0];r.num=100,r.query='type:"Web Map" -type:"Web Application"',r.sortField=s.sortField||"name",r.sortOrder=s.sortOrder||"desc";const n=await s.queryItems(r,e);return n.total?n.results.filter(o=>o.type==="Web Map").map(o=>new GP({portalItem:o})):[]}async _fetchBasemaps3D(t,e){const r=t||this.basemapGalleryGroupQuery3D;if(!r)return[];const i=new mf({query:r,disableExtraQuery:!0}),s=await this.queryGroups(i,e);if(!s.total)return[];const n=s.results[0];i.num=100,i.query='type:"Web Scene"',i.sortField=n.sortField||"name",i.sortOrder=n.sortOrder||"desc";const o=await n.queryItems(i,e);return o.total?o.results.filter(a=>a.type==="Web Scene").map(a=>new GP({portalItem:a})):[]}_normalizeSSL(t){return t.replace(/^http:/i,"https:").replace(":7080",":7443")}_readBasemap(t){if(t){const e=GP.fromJSON(t);return e.portalItem={portal:this},e}return null}static _resultsToTypedArray(t,e,r,i){let s=[];if(r){const n=i!=null?i.signal:null;s=r.listings||r.notifications||r.userInvitations||r.tags||r.items||r.groups||r.comments||r.provisions||r.results||r.relatedItems||r,(t||e)&&(s=s.map(o=>{const a=Object.assign(t?t.fromJSON(o):o,e);return typeof a.load=="function"&&a.load(n),a}))}else s=[];return s}};Ie.AUTH_MODE_ANONYMOUS="anonymous",Ie.AUTH_MODE_AUTO="auto",Ie.AUTH_MODE_IMMEDIATE="immediate",u([d()],Ie.prototype,"access",void 0),u([d()],Ie.prototype,"allSSL",void 0),u([d()],Ie.prototype,"authMode",void 0),u([d()],Ie.prototype,"authorizedCrossOriginDomains",void 0),u([Ee("authorizedCrossOriginDomains")],Ie.prototype,"readAuthorizedCrossOriginDomains",null),u([d()],Ie.prototype,"basemapGalleryGroupQuery",void 0),u([d({json:{name:"3DBasemapGalleryGroupQuery"}})],Ie.prototype,"basemapGalleryGroupQuery3D",void 0),u([d()],Ie.prototype,"bingKey",void 0),u([d()],Ie.prototype,"canListApps",void 0),u([d()],Ie.prototype,"canListData",void 0),u([d()],Ie.prototype,"canListPreProvisionedItems",void 0),u([d()],Ie.prototype,"canProvisionDirectPurchase",void 0),u([d()],Ie.prototype,"canSearchPublic",void 0),u([d()],Ie.prototype,"canShareBingPublic",void 0),u([d()],Ie.prototype,"canSharePublic",void 0),u([d()],Ie.prototype,"canSignInArcGIS",void 0),u([d()],Ie.prototype,"canSignInIDP",void 0),u([d()],Ie.prototype,"colorSetsGroupQuery",void 0),u([d()],Ie.prototype,"commentsEnabled",void 0),u([d({type:Date})],Ie.prototype,"created",void 0),u([d()],Ie.prototype,"credential",void 0),u([d()],Ie.prototype,"culture",void 0),u([d()],Ie.prototype,"currentVersion",void 0),u([d()],Ie.prototype,"customBaseUrl",void 0),u([d()],Ie.prototype,"defaultBasemap",void 0),u([Ee("defaultBasemap")],Ie.prototype,"readDefaultBasemap",null),u([d()],Ie.prototype,"defaultDevBasemap",void 0),u([Ee("defaultDevBasemap")],Ie.prototype,"readDefaultDevBasemap",null),u([d({type:_r})],Ie.prototype,"defaultExtent",void 0),u([d()],Ie.prototype,"defaultVectorBasemap",void 0),u([Ee("defaultVectorBasemap")],Ie.prototype,"readDefaultVectorBasemap",null),u([d()],Ie.prototype,"description",void 0),u([d()],Ie.prototype,"devBasemapGalleryGroupQuery",void 0),u([d()],Ie.prototype,"eueiEnabled",void 0),u([d({readOnly:!0})],Ie.prototype,"extraQuery",null),u([d()],Ie.prototype,"featuredGroups",void 0),u([d()],Ie.prototype,"featuredItemsGroupQuery",void 0),u([d()],Ie.prototype,"galleryTemplatesGroupQuery",void 0),u([d()],Ie.prototype,"livingAtlasGroupQuery",void 0),u([d()],Ie.prototype,"hasCategorySchema",void 0),u([d()],Ie.prototype,"helpBase",void 0),u([d()],Ie.prototype,"helperServices",void 0),u([d()],Ie.prototype,"helpMap",void 0),u([d()],Ie.prototype,"homePageFeaturedContent",void 0),u([d()],Ie.prototype,"homePageFeaturedContentCount",void 0),u([d()],Ie.prototype,"httpPort",void 0),u([d()],Ie.prototype,"httpsPort",void 0),u([d()],Ie.prototype,"id",void 0),u([d()],Ie.prototype,"ipCntryCode",void 0),u([d({readOnly:!0})],Ie.prototype,"isOrganization",null),u([d()],Ie.prototype,"isPortal",void 0),u([d()],Ie.prototype,"isReadOnly",void 0),u([d({readOnly:!0})],Ie.prototype,"itemPageUrl",null),u([d()],Ie.prototype,"layerTemplatesGroupQuery",void 0),u([d()],Ie.prototype,"maxTokenExpirationMinutes",void 0),u([d({type:Date})],Ie.prototype,"modified",void 0),u([d()],Ie.prototype,"name",void 0),u([d()],Ie.prototype,"portalHostname",void 0),u([d()],Ie.prototype,"portalMode",void 0),u([d()],Ie.prototype,"portalProperties",void 0),u([d()],Ie.prototype,"region",void 0),u([d({readOnly:!0})],Ie.prototype,"restUrl",null),u([d()],Ie.prototype,"rotatorPanels",void 0),u([d()],Ie.prototype,"showHomePageDescription",void 0),u([d()],Ie.prototype,"sourceJSON",void 0),u([d()],Ie.prototype,"staticImagesUrl",void 0),u([d({json:{name:"2DStylesGroupQuery"}})],Ie.prototype,"stylesGroupQuery2d",void 0),u([d({json:{name:"stylesGroupQuery"}})],Ie.prototype,"stylesGroupQuery3d",void 0),u([d()],Ie.prototype,"supportsHostedServices",void 0),u([d()],Ie.prototype,"symbolSetsGroupQuery",void 0),u([d()],Ie.prototype,"templatesGroupQuery",void 0),u([d()],Ie.prototype,"thumbnail",void 0),u([d({readOnly:!0})],Ie.prototype,"thumbnailUrl",null),u([d()],Ie.prototype,"units",void 0),u([d()],Ie.prototype,"url",void 0),u([d()],Ie.prototype,"urlKey",void 0),u([Ee("urlKey")],Ie.prototype,"readUrlKey",null),u([d()],Ie.prototype,"user",void 0),u([Ee("user")],Ie.prototype,"readUser",null),u([d()],Ie.prototype,"use3dBasemaps",void 0),u([d()],Ie.prototype,"useStandardizedQuery",void 0),u([d()],Ie.prototype,"useVectorBasemaps",void 0),u([d()],Ie.prototype,"vectorBasemapGalleryGroupQuery",void 0),Ie=Im=u([R("esri.portal.Portal")],Ie);const Qn=Ie,ree=new FinalizationRegistry(t=>{t.remove()});function bUe(t){const e=Gt;return()=>{const r=t.deref();r&&e.findCredential(r.restUrl)&&r.signIn().catch(()=>{})}}let s1=class extends Vi(de){constructor(e){super(e),this.type="style",this.placement="begin-end",this.style="arrow",this.color=null}equals(e){return e!=null&&e.placement===this.placement&&e.style===this.style&&(this.color==null&&e.color==null||this.color!=null&&e.color!=null&&this.color.toJSON()===e.color.toJSON())}};u([d({type:["style"],readOnly:!0,json:{read:!0,write:{ignoreOrigin:!0}}})],s1.prototype,"type",void 0),u([d({type:L6e,json:{default:"begin-end",write:!0}})],s1.prototype,"placement",void 0),u([d({type:Sge,json:{default:"arrow",write:!0}})],s1.prototype,"style",void 0),u([d({type:ze,json:{type:[Xi],default:null,write:!0}})],s1.prototype,"color",void 0),s1=u([R("esri.symbols.LineStyleMarker3D")],s1);const Ez=s1;var tL;let Hp=tL=class extends em{constructor(t){super(t),this.material=null,this.type="line",this.join="miter",this.cap="butt",this.size=fu(1),this.pattern=null,this.marker=null}clone(){const t={enabled:this.enabled,material:this.material!=null?this.material.clone():null,size:this.size,join:this.join,cap:this.cap,pattern:this.pattern!=null?this.pattern.clone():null,marker:this.marker!=null?this.marker.clone():null};return new tL(t)}static fromSimpleLineSymbol(t){const e={enabled:!0,size:t.width??fu(1),cap:t.cap||"butt",join:t.join||"miter",pattern:t.style&&t.style!=="inside-frame"?new kW({style:t.style}):null,material:new lu({color:(t.color||S3).clone()}),marker:t.marker?new Ez({placement:t.marker.placement,style:t.marker.style,color:t.marker.color?.clone()??null}):null};return new tL(e)}};u([d({type:lu,json:{write:!0}})],Hp.prototype,"material",void 0),u([tt({Line:"line"},{readOnly:!0})],Hp.prototype,"type",void 0),u([d({type:Dge,json:{write:!0,default:"miter"}})],Hp.prototype,"join",void 0),u([d({type:GW,json:{write:!0,default:"butt"}})],Hp.prototype,"cap",void 0),u([d(Uf)],Hp.prototype,"size",void 0),u([d(Rge)],Hp.prototype,"pattern",void 0),u([d({types:{key:"type",base:Ez,typeMap:{style:Ez}},json:{write:!0}})],Hp.prototype,"marker",void 0),Hp=tL=u([R("esri.symbols.LineSymbol3DLayer")],Hp);const NR=Hp;var Cz;const wUe=Wa()({sphere:"sphere",cylinder:"cylinder",cube:"cube",cone:"cone",diamond:"diamond",tetrahedron:"tetrahedron",invertedCone:"inverted-cone"});let iA=Cz=class extends de{clone(){return new Cz({href:this.href,primitive:this.primitive})}};u([d({type:String,json:{read:WF,write:O_}})],iA.prototype,"href",void 0),u([tt(wUe)],iA.prototype,"primitive",void 0),iA=Cz=u([R("esri.symbols.support.ObjectSymbol3DLayerResource")],iA);const qge="sphere";var Az;let X1=Az=class extends Te{constructor(){super(...arguments),this.x=0,this.y=0,this.z=0}clone(){return new Az({x:this.x,y:this.y,z:this.z})}};u([d({type:Number})],X1.prototype,"x",void 0),u([d({type:Number})],X1.prototype,"y",void 0),u([d({type:Number})],X1.prototype,"z",void 0),X1=Az=u([R("esri.symbols.support.Symbol3DAnchorPosition3D")],X1);var Oz;let Ea=Oz=class extends em{constructor(t){super(t),this.material=null,this.castShadows=!0,this.resource=null,this.type="object",this.width=void 0,this.height=void 0,this.depth=void 0,this.anchor=void 0,this.anchorPosition=void 0,this.heading=void 0,this.tilt=void 0,this.roll=void 0}clone(){return new Oz({heading:this.heading,tilt:this.tilt,roll:this.roll,anchor:this.anchor,anchorPosition:this.anchorPosition&&this.anchorPosition.clone(),depth:this.depth,enabled:this.enabled,height:this.height,material:this.material!=null?this.material.clone():null,castShadows:this.castShadows,resource:this.resource&&this.resource.clone(),width:this.width})}get isPrimitive(){return!this.resource||typeof this.resource.href!="string"}};u([d({type:lu,json:{write:!0}})],Ea.prototype,"material",void 0),u([d({type:Boolean,nonNullable:!0,json:{write:!0,default:!0}})],Ea.prototype,"castShadows",void 0),u([d({type:iA,json:{write:!0}})],Ea.prototype,"resource",void 0),u([tt({Object:"object"},{readOnly:!0})],Ea.prototype,"type",void 0),u([d({type:Number,json:{write:!0}})],Ea.prototype,"width",void 0),u([d({type:Number,json:{write:!0}})],Ea.prototype,"height",void 0),u([d({type:Number,json:{write:!0}})],Ea.prototype,"depth",void 0),u([tt({center:"center",top:"top",bottom:"bottom",origin:"origin",relative:"relative"}),d({json:{default:"origin"}})],Ea.prototype,"anchor",void 0),u([d({type:X1,json:{type:[Number],read:{reader:t=>new X1({x:t[0],y:t[1],z:t[2]})},write:{writer:(t,e)=>{e.anchorPosition=[t.x,t.y,t.z]},overridePolicy(){return{enabled:this.anchor==="relative"}}}}})],Ea.prototype,"anchorPosition",void 0),u([d({type:Number,json:{write:!0}})],Ea.prototype,"heading",void 0),u([d({type:Number,json:{write:!0}})],Ea.prototype,"tilt",void 0),u([d({type:Number,json:{write:!0}})],Ea.prototype,"roll",void 0),u([d({readOnly:!0})],Ea.prototype,"isPrimitive",null),Ea=Oz=u([R("esri.symbols.ObjectSymbol3DLayer")],Ea);const HW=Ea;var Rz;let al=Rz=class extends em{constructor(t){super(t),this.material=null,this.castShadows=!0,this.type="path",this.profile="circle",this.join="miter",this.cap="butt",this.width=void 0,this.height=void 0,this.anchor="center",this.profileRotation="all"}readWidth(t,e){return t??(e.height==null&&e.size!=null?e.size:void 0)}readHeight(t,e){return t??(e.width==null&&e.size!=null?e.size:void 0)}clone(){return new Rz({enabled:this.enabled,material:this.material!=null?this.material.clone():null,castShadows:this.castShadows,profile:this.profile,join:this.join,cap:this.cap,width:this.width,height:this.height,profileRotation:this.profileRotation,anchor:this.anchor})}};u([d({type:lu,json:{write:!0}})],al.prototype,"material",void 0),u([d({type:Boolean,nonNullable:!0,json:{write:!0,default:!0}})],al.prototype,"castShadows",void 0),u([tt({Path:"path"},{readOnly:!0})],al.prototype,"type",void 0),u([d({type:["circle","quad"],json:{write:!0,default:"circle"}})],al.prototype,"profile",void 0),u([d({type:Dge,json:{write:!0,default:"miter"}})],al.prototype,"join",void 0),u([d({type:Q6e,json:{write:!0,default:"butt"}})],al.prototype,"cap",void 0),u([d({type:Number,json:{write:{enabled:!0,target:{width:{type:Number},size:{type:Number}}}}})],al.prototype,"width",void 0),u([Ee("width",["width","size","height"])],al.prototype,"readWidth",null),u([d({type:Number,json:{write:!0}})],al.prototype,"height",void 0),u([Ee("height",["height","size","width"])],al.prototype,"readHeight",null),u([d({type:["center","bottom","top"],json:{write:!0,default:"center"}})],al.prototype,"anchor",void 0),u([d({type:["heading","all"],json:{write:!0,default:"all"}})],al.prototype,"profileRotation",void 0),al=Rz=u([R("esri.symbols.PathSymbol3DLayer")],al);const qW=al;var Pz;let rS=Pz=class extends de{constructor(){super(...arguments),this.color=new ze([0,0,0,1]),this.size=0}clone(){const t={color:K(this.color),size:this.size};return new Pz(t)}};u([d(qg)],rS.prototype,"color",void 0),u([d(Uf)],rS.prototype,"size",void 0),rS=Pz=u([R("esri.symbols.support.Symbol3DHalo")],rS);let C3=class extends Vi(de){constructor(e){super(e),this.color=null}};u([d(qg)],C3.prototype,"color",void 0),C3=u([R("esri.symbols.support.Symbol3DTextBackground")],C3);var rL;let Vl=rL=class extends em{constructor(t){super(t),this._userSize=void 0,this.halo=null,this.horizontalAlignment="center",this.lineHeight=1,this.material=null,this.background=null,this.text=null,this.type="text",this.verticalAlignment="baseline"}get font(){return this._get("font")||null}set font(t){t!=null&&this._userSize!=null&&(t.size=this._userSize),this._set("font",t)}writeFont(t,e,r,i){const s={...i,textSymbol3D:!0};e.font=t.write({},s),delete e.font.size}get size(){return this._userSize!=null?this._userSize:this.font!=null&&this.font.size!=null?this.font.size:9}set size(t){this._userSize=t,this.font!=null&&(this.font.size=this._userSize),this.notifyChange("size")}clone(){const t=new rL({enabled:this.enabled,font:this.font&&K(this.font),halo:this.halo&&K(this.halo),horizontalAlignment:this.horizontalAlignment,lineHeight:this.lineHeight,material:this.material!=null?this.material.clone():null,text:this.text,verticalAlignment:this.verticalAlignment,background:K(this.background)});return t._userSize=this._userSize,t}static fromTextSymbol(t){return new rL({font:t.font!=null?t.font.clone():new qF,halo:xUe(t.haloColor,t.haloSize),horizontalAlignment:t.horizontalAlignment,lineHeight:t.lineHeight,material:t.color?new lu({color:t.color.clone()}):null,text:t.text,verticalAlignment:t.verticalAlignment,background:t.backgroundColor?new C3({color:t.backgroundColor.clone()}):null})}};function xUe(t,e){return t&&e!=null&&e>0?new rS({color:K(t),size:e}):null}u([d({type:qF,json:{write:!0}})],Vl.prototype,"font",null),u([Fe("font")],Vl.prototype,"writeFont",null),u([d({type:rS,json:{write:!0}})],Vl.prototype,"halo",void 0),u([d({...Fge,json:{default:"center",write:!0}})],Vl.prototype,"horizontalAlignment",void 0),u([d({...Nge,json:{default:1,write:!0}})],Vl.prototype,"lineHeight",void 0),u([d({type:lu,json:{write:!0}})],Vl.prototype,"material",void 0),u([d({type:C3,json:{write:!0}})],Vl.prototype,"background",void 0),u([d(Uf)],Vl.prototype,"size",null),u([d({type:String,json:{write:!0}})],Vl.prototype,"text",void 0),u([tt({Text:"text"},{readOnly:!0})],Vl.prototype,"type",void 0),u([d({...Uge,json:{default:"baseline",write:!0}})],Vl.prototype,"verticalAlignment",void 0),Vl=rL=u([R("esri.symbols.TextSymbol3DLayer")],Vl);const Pw=Vl;var Mz;let Ky=Mz=class extends em{constructor(t){super(t),this.color=Iz.clone(),this.type="water",this.waterbodySize="medium",this.waveDirection=null,this.waveStrength="moderate"}clone(){return new Mz({color:K(this.color),waterbodySize:this.waterbodySize,waveDirection:this.waveDirection,waveStrength:this.waveStrength})}};u([d({type:ze,nonNullable:!0,json:{type:[Xi],write:(t,e,r)=>e[r]=t.toArray(ze.AlphaMode.UNLESS_OPAQUE),default:()=>Iz.clone(),defaultEquals:t=>t.toCss(!0)===Iz.toCss(!0)}})],Ky.prototype,"color",void 0),u([tt({Water:"water"},{readOnly:!0})],Ky.prototype,"type",void 0),u([d({type:["small","medium","large"],json:{write:!0,default:"medium"}})],Ky.prototype,"waterbodySize",void 0),u([d({type:Number,json:{write:!0,default:null}})],Ky.prototype,"waveDirection",void 0),u([d({type:["calm","rippled","slight","moderate"],json:{write:!0,default:"moderate"}})],Ky.prototype,"waveStrength",void 0),Ky=Mz=u([R("esri.symbols.WaterSymbol3DLayer")],Ky);const Iz=new ze([0,119,190]),Wge=Ky;var $z;let n1=$z=class extends Te{constructor(t){super(t),this.name=null,this.styleUrl=null,this.styleName=null,this.portal=null}clone(){return new $z({name:this.name,styleUrl:this.styleUrl,styleName:this.styleName,portal:this.portal})}};u([d({type:String})],n1.prototype,"name",void 0),u([d({type:String})],n1.prototype,"styleUrl",void 0),u([d({type:String})],n1.prototype,"styleName",void 0),u([d({type:Qn})],n1.prototype,"portal",void 0),n1=$z=u([R("esri.symbols.support.StyleOrigin")],n1);const PO=n1;var Lz;let Sb=Lz=class extends Te{constructor(){super(...arguments),this.url=""}clone(){return new Lz({url:this.url})}};u([d({type:String})],Sb.prototype,"url",void 0),Sb=Lz=u([R("esri.symbols.support.Thumbnail")],Sb);const Zge={icon:Q0,object:HW,line:NR,path:qW,fill:DR,extrude:Tge,text:Pw,water:Wge},TUe=Pt.ofType({base:em,key:"type",typeMap:Zge,errorContext:"symbol-layer"});let qp=class extends Sc{constructor(e){super(e),this.styleOrigin=null,this.thumbnail=null,this.type=null;const r=this.__accessor__&&this.__accessor__.metadatas&&this.__accessor__.metadatas.symbolLayers,i=r&&r.type||Pt;this._set("symbolLayers",new i)}get color(){return null}set color(e){this.constructed&&Q.getLogger(this).error("Symbol3D does not support colors on the symbol level. Colors may be set on individual symbol layer materials instead.")}set symbolLayers(e){ew(e,this._get("symbolLayers"))}readStyleOrigin(e,r,i){if(e.styleUrl&&e.name){const s=Dg(e.styleUrl,i);return new PO({styleUrl:s,name:e.name})}if(e.styleName&&e.name)return new PO({portal:i&&i.portal||Qn.getDefault(),styleName:e.styleName,name:e.name});i&&i.messages&&i.messages.push(new Sh("symbol3d:incomplete-style-origin","Style origin requires either a 'styleUrl' or 'styleName' and a 'name' property",{context:i,definition:e}))}writeStyleOrigin(e,r,i,s){if(e.styleUrl&&e.name){let n=Ng(e.styleUrl,s);mc(n)&&(n=vh(n)),r.styleOrigin={styleUrl:n,name:e.name}}else e.styleName&&e.name&&(e.portal&&s&&s.portal&&!Ude(e.portal.restUrl,s.portal.restUrl)?s&&s.messages&&s.messages.push(new Sh("symbol:cross-portal","The symbol style origin cannot be persisted because it refers to an item on a different portal than the one being saved to.",{symbol:this})):r.styleOrigin={styleName:e.styleName,name:e.name})}normalizeCtorArgs(e){return e instanceof em||e&&Zge[e.type]?{symbolLayers:[e]}:Array.isArray(e)?{symbolLayers:e}:e}};u([d({json:{read:!1,write:!1}})],qp.prototype,"color",null),u([d({type:TUe,nonNullable:!0,json:{write:!0}}),yr(jge)],qp.prototype,"symbolLayers",null),u([d({type:PO})],qp.prototype,"styleOrigin",void 0),u([Ee("styleOrigin")],qp.prototype,"readStyleOrigin",null),u([Fe("styleOrigin",{"styleOrigin.styleUrl":{type:String},"styleOrigin.styleName":{type:String},"styleOrigin.name":{type:String}})],qp.prototype,"writeStyleOrigin",null),u([d({type:Sb,json:{read:!1}})],qp.prototype,"thumbnail",void 0),u([d({type:["point-3d","line-3d","polygon-3d","mesh-3d","label-3d"],readOnly:!0})],qp.prototype,"type",void 0),qp=u([R("esri.symbols.Symbol3D")],qp);const rE=qp;let sA=class extends de{constructor(e){super(e),this.visible=!0}clone(){}};u([d({type:["line"],readOnly:!0,json:{read:!1,write:{ignoreOrigin:!0}}})],sA.prototype,"type",void 0),u([d({readOnly:!0})],sA.prototype,"visible",void 0),sA=u([R("esri.symbols.callouts.Callout3D")],sA);const Xge=sA;var Dz;let iL=Dz=class extends de{constructor(){super(...arguments),this.color=new ze("white")}clone(){return new Dz({color:K(this.color)})}};u([d(qg)],iL.prototype,"color",void 0),iL=Dz=u([R("esri.symbols.callouts.LineCallout3DBorder")],iL);const Yge=iL;Object.freeze(Object.defineProperty({__proto__:null,default:Yge},Symbol.toStringTag,{value:"Module"}));var Nz;let e0=Nz=class extends Xge{constructor(t){super(t),this.type="line",this.color=new ze([0,0,0,1]),this.size=fu(1),this.border=null}get visible(){return this.size>0&&this.color!=null&&this.color.a>0}clone(){return new Nz({color:K(this.color),size:this.size,border:K(this.border)})}};u([tt({line:"line"},{readOnly:!0})],e0.prototype,"type",void 0),u([d(qg)],e0.prototype,"color",void 0),u([d(Uf)],e0.prototype,"size",void 0),u([d({type:Yge,json:{write:!0}})],e0.prototype,"border",void 0),u([d({readOnly:!0})],e0.prototype,"visible",null),e0=Nz=u([R("esri.symbols.callouts.LineCallout3D")],e0);const SUe=e0;function WW(t){if(!t)return!1;const e=t.verticalOffset;return!!e&&!(e.screenLength<=0||e.maxWorldLength!=null&&e.maxWorldLength<=0)}function Jge(t){if(!t||!t.supportsCallout||!t.supportsCallout())return!1;const e=t.callout;return!!e&&!!e.visible&&!!WW(t)}function ZW(t){return t.type==="point-3d"||t.type==="label-3d"}function Qge(t){return t.horizontalAlignment==="center"}const Kge={types:{key:"type",base:Xge,typeMap:{line:SUe}},json:{write:!0}};var Fz;let dT=Fz=class extends de{constructor(t){super(t),this.screenLength=0,this.minWorldLength=0,this.maxWorldLength=null}clone(){return new Fz({screenLength:this.screenLength,minWorldLength:this.minWorldLength,maxWorldLength:this.maxWorldLength})}};u([d(Uf)],dT.prototype,"screenLength",void 0),u([d({type:Number,nonNullable:!0,json:{write:!0,default:0}})],dT.prototype,"minWorldLength",void 0),u([d({type:Number,json:{write:!0}})],dT.prototype,"maxWorldLength",void 0),dT=Fz=u([R("esri.symbols.support.Symbol3DVerticalOffset")],dT);const eye=dT;var sL;const tye=Pt.ofType({base:null,key:"type",typeMap:{text:Pw}});let t0=sL=class extends rE{constructor(t){super(t),this.verticalOffset=null,this.callout=null,this.styleOrigin=null,this.symbolLayers=new tye,this.type="label-3d"}supportsCallout(){return!0}hasVisibleCallout(){return Jge(this)}hasVisibleVerticalOffset(){return WW(this)}clone(){return new sL({styleOrigin:K(this.styleOrigin),symbolLayers:K(this.symbolLayers),thumbnail:K(this.thumbnail),callout:K(this.callout),verticalOffset:K(this.verticalOffset)})}static fromTextSymbol(t){return new sL({symbolLayers:[Pw.fromTextSymbol(t)]})}};u([d({type:eye,json:{write:!0}})],t0.prototype,"verticalOffset",void 0),u([d(Kge)],t0.prototype,"callout",void 0),u([d({json:{read:!1,write:!1}})],t0.prototype,"styleOrigin",void 0),u([d({type:tye})],t0.prototype,"symbolLayers",void 0),u([tt({LabelSymbol3D:"label-3d"},{readOnly:!0})],t0.prototype,"type",void 0),t0=sL=u([R("esri.symbols.LabelSymbol3D")],t0);const ZF=t0;var nL;const rye=Pt.ofType({base:null,key:"type",typeMap:{line:NR,path:qW}}),EUe=Pt.ofType({base:null,key:"type",typeMap:{line:NR,path:qW}});let nA=nL=class extends rE{constructor(t){super(t),this.symbolLayers=new rye,this.type="line-3d"}clone(){return new nL({styleOrigin:K(this.styleOrigin),symbolLayers:K(this.symbolLayers),thumbnail:K(this.thumbnail)})}static fromSimpleLineSymbol(t){return new nL({symbolLayers:[NR.fromSimpleLineSymbol(t)]})}};u([d({type:rye,json:{type:EUe}})],nA.prototype,"symbolLayers",void 0),u([tt({LineSymbol3D:"line-3d"},{readOnly:!0})],nA.prototype,"type",void 0),nA=nL=u([R("esri.symbols.LineSymbol3D")],nA);const XF=nA;let r0=class extends Sc{constructor(e){super(e),this.angle=0,this.type=null,this.xoffset=0,this.yoffset=0,this.size=9}hash(){return`${this.type}.${this.angle}.${this.size}.${this.xoffset}.${this.yoffset}`}};u([d({type:Number,json:{read:t=>t&&-1*t,write:(t,e)=>e.angle=t&&-1*t}})],r0.prototype,"angle",void 0),u([d({type:["simple-marker","picture-marker"],readOnly:!0})],r0.prototype,"type",void 0),u([d({type:Number,cast:Jr,json:{write:!0}})],r0.prototype,"xoffset",void 0),u([d({type:Number,cast:Jr,json:{write:!0}})],r0.prototype,"yoffset",void 0),u([d({type:Number,cast:t=>t==="auto"?t:Jr(t),json:{write:!0}})],r0.prototype,"size",void 0),r0=u([R("esri.symbols.MarkerSymbol")],r0);const iye=r0;var oL;const sye=Pt.ofType({base:null,key:"type",typeMap:{fill:DR}});let oA=oL=class extends rE{constructor(t){super(t),this.symbolLayers=new sye,this.type="mesh-3d"}clone(){return new oL({styleOrigin:K(this.styleOrigin),symbolLayers:K(this.symbolLayers),thumbnail:K(this.thumbnail)})}static fromSimpleFillSymbol(t){return new oL({symbolLayers:[DR.fromSimpleFillSymbol(t)]})}};u([d({type:sye})],oA.prototype,"symbolLayers",void 0),u([tt({MeshSymbol3D:"mesh-3d"},{readOnly:!0})],oA.prototype,"type",void 0),oA=oL=u([R("esri.symbols.MeshSymbol3D")],oA);const YF=oA;function CUe(t,e,r){return e.imageData?Vde({mediaType:e.contentType||"image/png",isBase64:!0,data:e.imageData}):nye(e.url,r)}function nye(t,e){return OUe(e)&&!mc(t)&&e?.layer?.parsedUrl?bc(e.layer.parsedUrl.path,"images",t):Dg(t,e)}function AUe(t,e,r,i){if(Jf(t)){const s=Vb(t);if(!s)return;e.contentType=s.mediaType,e.imageData=s.data,r&&r.imageData===e.imageData&&r.url&&O_(r.url,e,"url",i)}else O_(t,e,"url",i)}const oye={json:{read:{source:["imageData","url"],reader:CUe},write:{writer(t,e,r,i){AUe(t,e,this.source,i)}}}},aye={readOnly:!0,json:{read:{source:["imageData","url"],reader(t,e,r){const i={};return e.imageData&&(i.imageData=e.imageData),e.contentType&&(i.contentType=e.contentType),e.url&&(i.url=nye(e.url,r)),i}}}};function OUe(t){return!(t==null||t.origin!=="service"&&t.origin!=="portal-item"||t.layer?.type!=="feature"&&t.layer?.type!=="stream")}var Uz;let Uu=Uz=class extends Ege{constructor(...t){super(...t),this.type="picture-fill",this.url=null,this.xscale=1,this.yscale=1,this.width=12,this.height=12,this.xoffset=0,this.yoffset=0,this.source=null}normalizeCtorArgs(t,e,r,i){if(t&&typeof t!="string"&&t.imageData==null)return t;const s={};return t&&(s.url=t),e&&(s.outline=e),r!=null&&(s.width=Jr(r)),i!=null&&(s.height=Jr(i)),s}clone(){const t=new Uz({color:K(this.color),height:this.height,outline:this.outline&&this.outline.clone(),url:this.url,width:this.width,xoffset:this.xoffset,xscale:this.xscale,yoffset:this.yoffset,yscale:this.yscale});return t._set("source",K(this.source)),t}hash(){return`${super.hash()}.${this.color?.hash()}.${this.height}.${this.url}.${this.width}.${this.xoffset}.${this.xscale}.${this.yoffset}.${this.yscale}`}};u([tt({esriPFS:"picture-fill"},{readOnly:!0})],Uu.prototype,"type",void 0),u([d(oye)],Uu.prototype,"url",void 0),u([d({type:Number,json:{write:!0}})],Uu.prototype,"xscale",void 0),u([d({type:Number,json:{write:!0}})],Uu.prototype,"yscale",void 0),u([d({type:Number,cast:Jr,json:{write:!0}})],Uu.prototype,"width",void 0),u([d({type:Number,cast:Jr,json:{write:!0}})],Uu.prototype,"height",void 0),u([d({type:Number,cast:Jr,json:{write:!0}})],Uu.prototype,"xoffset",void 0),u([d({type:Number,cast:Jr,json:{write:!0}})],Uu.prototype,"yoffset",void 0),u([d(aye)],Uu.prototype,"source",void 0),Uu=Uz=u([R("esri.symbols.PictureFillSymbol")],Uu);const lye=Uu;var kz;let ad=kz=class extends iye{constructor(...t){super(...t),this.color=null,this.type="picture-marker",this.url=null,this.source=null,this.height=12,this.width=12,this.size=null}normalizeCtorArgs(t,e,r){if(t&&typeof t!="string"&&t.imageData==null)return t;const i={};return t&&(i.url=t),e!=null&&(i.width=Jr(e)),r!=null&&(i.height=Jr(r)),i}readHeight(t,e){return e.size||t}readWidth(t,e){return e.size||t}clone(){const t=new kz({angle:this.angle,height:this.height,url:this.url,width:this.width,xoffset:this.xoffset,yoffset:this.yoffset});return t._set("source",K(this.source)),t}hash(){return`${super.hash()}.${this.height}.${this.url}.${this.width}`}};u([d({json:{write:!1}})],ad.prototype,"color",void 0),u([tt({esriPMS:"picture-marker"},{readOnly:!0})],ad.prototype,"type",void 0),u([d(oye)],ad.prototype,"url",void 0),u([d(aye)],ad.prototype,"source",void 0),u([d({type:Number,cast:Jr,json:{write:!0}})],ad.prototype,"height",void 0),u([Ee("height",["height","size"])],ad.prototype,"readHeight",null),u([d({type:Number,cast:Jr,json:{write:!0}})],ad.prototype,"width",void 0),u([d({json:{write:!1}})],ad.prototype,"size",void 0),ad=kz=u([R("esri.symbols.PictureMarkerSymbol")],ad);const JF=ad;var o1;const cye=Pt.ofType({base:null,key:"type",typeMap:{icon:Q0,object:HW,text:Pw}});let a1=o1=class extends rE{constructor(t){super(t),this.verticalOffset=null,this.callout=null,this.symbolLayers=new cye,this.type="point-3d"}supportsCallout(){if((this.symbolLayers?this.symbolLayers.length:0)<1)return!1;for(const t of this.symbolLayers.items)switch(t.type){case"icon":case"text":case"object":continue;default:return!1}return!0}hasVisibleCallout(){return Jge(this)}hasVisibleVerticalOffset(){return WW(this)}clone(){return new o1({verticalOffset:K(this.verticalOffset),callout:K(this.callout),styleOrigin:K(this.styleOrigin),symbolLayers:K(this.symbolLayers),thumbnail:K(this.thumbnail)})}static fromSimpleMarkerSymbol(t){return new o1({symbolLayers:[Q0.fromSimpleMarkerSymbol(t)]})}static fromPictureMarkerSymbol(t){return new o1({symbolLayers:[Q0.fromPictureMarkerSymbol(t)]})}static fromCIMSymbol(t){if(t.data?.symbol?.type!=="CIMPointSymbol")return null;const r=t.data.symbol;return new o1(r?.callout?{symbolLayers:[Q0.fromCIMSymbol(t)],callout:{type:"line",size:.5,color:[0,0,0]},verticalOffset:{screenLength:40}}:{symbolLayers:[Q0.fromCIMSymbol(t)]})}static fromTextSymbol(t){return new o1({symbolLayers:[Pw.fromTextSymbol(t)]})}};u([d({type:eye,json:{write:!0}})],a1.prototype,"verticalOffset",void 0),u([d(Kge)],a1.prototype,"callout",void 0),u([d({type:cye,json:{origins:{"web-scene":{write:!0}}}})],a1.prototype,"symbolLayers",void 0),u([tt({PointSymbol3D:"point-3d"},{readOnly:!0})],a1.prototype,"type",void 0),a1=o1=u([R("esri.symbols.PointSymbol3D")],a1);const K0=a1;var aA;const uye=Pt.ofType({base:null,key:"type",typeMap:{extrude:Tge,fill:DR,icon:Q0,line:NR,object:HW,text:Pw,water:Wge}});let lA=aA=class extends rE{constructor(t){super(t),this.symbolLayers=new uye,this.type="polygon-3d"}clone(){return new aA({styleOrigin:K(this.styleOrigin),symbolLayers:K(this.symbolLayers),thumbnail:K(this.thumbnail)})}static fromJSON(t){const e=new aA;if(e.read(t),e.symbolLayers.length===2&&e.symbolLayers.at(0).type==="fill"&&e.symbolLayers.at(1).type==="line"){const r=e.symbolLayers.at(0),i=e.symbolLayers.at(1);!i.enabled||t.symbolLayers&&t.symbolLayers[1]&&t.symbolLayers[1].enable===!1||(r.outline={size:i.size,color:i.material!=null?i.material.color:null}),e.symbolLayers.removeAt(1)}return e}static fromSimpleFillSymbol(t){return new aA({symbolLayers:[DR.fromSimpleFillSymbol(t)]})}};u([d({type:uye,json:{write:!0}})],lA.prototype,"symbolLayers",void 0),u([tt({PolygonSymbol3D:"polygon-3d"},{readOnly:!0})],lA.prototype,"type",void 0),lA=aA=u([R("esri.symbols.PolygonSymbol3D")],lA);const FR=lA;var Vz;const pU=new Rr({esriSFSSolid:"solid",esriSFSNull:"none",esriSFSHorizontal:"horizontal",esriSFSVertical:"vertical",esriSFSForwardDiagonal:"forward-diagonal",esriSFSBackwardDiagonal:"backward-diagonal",esriSFSCross:"cross",esriSFSDiagonalCross:"diagonal-cross"});let l1=Vz=class extends Ege{constructor(...t){super(...t),this.color=new ze([0,0,0,.25]),this.outline=new wu,this.type="simple-fill",this.style="solid"}normalizeCtorArgs(t,e,r){if(t&&typeof t!="string")return t;const i={};return t&&(i.style=t),e&&(i.outline=e),r&&(i.color=r),i}clone(){return new Vz({color:K(this.color),outline:this.outline&&this.outline.clone(),style:this.style})}hash(){return`${super.hash()}${this.style}.${this.color&&this.color.hash()}`}};u([d()],l1.prototype,"color",void 0),u([d()],l1.prototype,"outline",void 0),u([tt({esriSFS:"simple-fill"},{readOnly:!0})],l1.prototype,"type",void 0),u([d({type:pU.apiValues,json:{read:pU.read,write:pU.write}})],l1.prototype,"style",void 0),l1=Vz=u([R("esri.symbols.SimpleFillSymbol")],l1);const X_=l1,wEt=Object.freeze(Object.defineProperty({__proto__:null,default:X_},Symbol.toStringTag,{value:"Module"}));var zz;const fU=new Rr({esriSMSCircle:"circle",esriSMSSquare:"square",esriSMSCross:"cross",esriSMSX:"x",esriSMSDiamond:"diamond",esriSMSTriangle:"triangle",esriSMSPath:"path"});let Wp=zz=class extends iye{constructor(...t){super(...t),this.color=new ze([255,255,255,.25]),this.type="simple-marker",this.size=12,this.style="circle",this.outline=new wu}normalizeCtorArgs(t,e,r,i){if(t&&typeof t!="string")return t;const s={};return t&&(s.style=t),e!=null&&(s.size=Jr(e)),r&&(s.outline=r),i&&(s.color=i),s}writeColor(t,e){t&&this.style!=="x"&&this.style!=="cross"&&(e.color=t.toJSON()),t===null&&(e.color=null)}set path(t){this.style="path",this._set("path",t)}clone(){return new zz({angle:this.angle,color:K(this.color),outline:this.outline&&this.outline.clone(),path:this.path,size:this.size,style:this.style,xoffset:this.xoffset,yoffset:this.yoffset})}hash(){return`${super.hash()}.${this.color&&this.color.hash()}.${this.path}.${this.style}.${this.outline?.hash()}`}};u([d()],Wp.prototype,"color",void 0),u([Fe("color")],Wp.prototype,"writeColor",null),u([tt({esriSMS:"simple-marker"},{readOnly:!0})],Wp.prototype,"type",void 0),u([d()],Wp.prototype,"size",void 0),u([d({type:fU.apiValues,json:{read:fU.read,write:fU.write}})],Wp.prototype,"style",void 0),u([d({type:String,json:{write:!0}})],Wp.prototype,"path",null),u([d({types:{key:"type",base:null,defaultKeyValue:"simple-line",typeMap:{"simple-line":wu}},json:{default:null,write:!0}})],Wp.prototype,"outline",void 0),Wp=zz=u([R("esri.symbols.SimpleMarkerSymbol")],Wp);const Wg=Wp,xEt=Object.freeze(Object.defineProperty({__proto__:null,default:Wg},Symbol.toStringTag,{value:"Module"}));var Bz;let _s=Bz=class extends Sc{constructor(...t){super(...t),this.backgroundColor=null,this.borderLineColor=null,this.borderLineSize=null,this.font=new qF,this.horizontalAlignment="center",this.kerning=!0,this.haloColor=null,this.haloSize=null,this.rightToLeft=null,this.rotated=!1,this.text="",this.type="text",this.verticalAlignment="baseline",this.xoffset=0,this.yoffset=0,this.angle=0,this.width=null,this.lineWidth=192,this.lineHeight=1}normalizeCtorArgs(t,e,r){if(t&&typeof t!="string")return t;const i={};return t&&(i.text=t),e&&(i.font=e),r&&(i.color=r),i}writeLineWidth(t,e,r,i){i&&typeof i!="string"?i.origin:e[r]=t}castLineWidth(t){return Jr(t)}writeLineHeight(t,e,r,i){i&&typeof i!="string"?i.origin:e[r]=t}clone(){return new Bz({angle:this.angle,backgroundColor:K(this.backgroundColor),borderLineColor:K(this.borderLineColor),borderLineSize:this.borderLineSize,color:K(this.color),font:this.font&&this.font.clone(),haloColor:K(this.haloColor),haloSize:this.haloSize,horizontalAlignment:this.horizontalAlignment,kerning:this.kerning,lineHeight:this.lineHeight,lineWidth:this.lineWidth,rightToLeft:this.rightToLeft,rotated:this.rotated,text:this.text,verticalAlignment:this.verticalAlignment,width:this.width,xoffset:this.xoffset,yoffset:this.yoffset})}hash(){return`${this.backgroundColor&&this.backgroundColor.hash()}.${this.borderLineColor}.${this.borderLineSize}.${this.color?.hash()}.${this.font&&this.font.hash()}.${this.haloColor&&this.haloColor.hash()}.${this.haloSize}.${this.horizontalAlignment}.${this.kerning}.${this.rightToLeft}.${this.rotated}.${this.text}.${this.verticalAlignment}.${this.width}.${this.xoffset}.${this.yoffset}.${this.lineHeight}.${this.lineWidth}.${this.angle}`}};u([d({type:ze,json:{write:!0}})],_s.prototype,"backgroundColor",void 0),u([d({type:ze,json:{write:!0}})],_s.prototype,"borderLineColor",void 0),u([d({type:Number,json:{write:!0},cast:Jr})],_s.prototype,"borderLineSize",void 0),u([d({type:qF,json:{write:!0}})],_s.prototype,"font",void 0),u([d({...Fge,json:{write:!0}})],_s.prototype,"horizontalAlignment",void 0),u([d({type:Boolean,json:{write:!0}})],_s.prototype,"kerning",void 0),u([d({type:ze,json:{write:!0}})],_s.prototype,"haloColor",void 0),u([d({type:Number,cast:Jr,json:{write:!0}})],_s.prototype,"haloSize",void 0),u([d({type:Boolean,json:{write:!0}})],_s.prototype,"rightToLeft",void 0),u([d({type:Boolean,json:{write:!0}})],_s.prototype,"rotated",void 0),u([d({type:String,json:{write:!0}})],_s.prototype,"text",void 0),u([tt({esriTS:"text"},{readOnly:!0})],_s.prototype,"type",void 0),u([d({...Uge,json:{write:!0}})],_s.prototype,"verticalAlignment",void 0),u([d({type:Number,cast:Jr,json:{write:!0}})],_s.prototype,"xoffset",void 0),u([d({type:Number,cast:Jr,json:{write:!0}})],_s.prototype,"yoffset",void 0),u([d({type:Number,json:{read:t=>t&&-1*t,write:(t,e)=>e.angle=t&&-1*t}})],_s.prototype,"angle",void 0),u([d({type:Number,json:{write:!0}})],_s.prototype,"width",void 0),u([d({type:Number})],_s.prototype,"lineWidth",void 0),u([Fe("lineWidth")],_s.prototype,"writeLineWidth",null),u([yr("lineWidth")],_s.prototype,"castLineWidth",null),u([d(Nge)],_s.prototype,"lineHeight",void 0),u([Fe("lineHeight")],_s.prototype,"writeLineHeight",null),_s=Bz=u([R("esri.symbols.TextSymbol")],_s);const iE=_s;var Gz;let ld=Gz=class extends Sc{constructor(t){super(t),this.styleName=null,this.portal=null,this.styleUrl=null,this.thumbnail=null,this.name=null,this.type="web-style"}get _fetchCacheKey(){const t=this.portal!=null?this.portal:Qn.getDefault(),e=t.user?t.user.username:null;return`${this.styleName}:${this.styleUrl}:${this.name}:${e}:${t.url}`}read(t,e){this.portal=e?.portal,super.read(t,e)}clone(){return new Gz({name:this.name,styleUrl:this.styleUrl,styleName:this.styleName,portal:this.portal})}fetchSymbol(t){return this._fetchSymbol("webRef",t)}fetchCIMSymbol(t){return this._fetchSymbol("cimRef",t)}async _fetchSymbol(t,e){const r=e!=null?e.cache:null,i=r?this._fetchCacheKey:null;if(r!=null){const a=i&&r.get(i);if(a)return a.clone()}const{resolveWebStyleSymbol:s}=await ae(()=>Promise.resolve().then(()=>_Ge),void 0,import.meta.url);Xt(e);const n=s(this,{portal:this.portal},t,e);n.catch(a=>{Q.getLogger(this).error("#fetchSymbol()","Failed to create symbol from style",a)});const o=await n;return t==="webRef"&&o.type==="point-3d"||t==="cimRef"&&o.type==="cim"?(r?.set(i,o.clone()),o):null}};u([d({json:{write:!1}})],ld.prototype,"color",void 0),u([d({type:String,json:{write:!0}})],ld.prototype,"styleName",void 0),u([d({type:Qn,json:{write:!1}})],ld.prototype,"portal",void 0),u([d({type:String,json:{read:WF,write:O_}})],ld.prototype,"styleUrl",void 0),u([d({type:Sb,json:{read:!1}})],ld.prototype,"thumbnail",void 0),u([d({type:String,json:{write:!0}})],ld.prototype,"name",void 0),u([tt({styleSymbolReference:"web-style"},{readOnly:!0})],ld.prototype,"type",void 0),u([d()],ld.prototype,"_fetchCacheKey",null),ld=Gz=u([R("esri.symbols.WebStyleSymbol")],ld);const Mw=ld;function QF(t){if(!t)return!1;switch(t.type){case"picture-fill":case"picture-marker":case"simple-fill":case"simple-line":case"simple-marker":case"text":case"cim":return!0;default:return!1}}function R_(t){if(!t)return!1;switch(t.type){case"label-3d":case"line-3d":case"mesh-3d":case"point-3d":case"polygon-3d":return!0;default:return!1}}const Eb={base:Sc,key:"type",typeMap:{"simple-fill":X_,"picture-fill":lye,"picture-marker":JF,"simple-line":wu,"simple-marker":Wg,text:iE,"label-3d":ZF,"line-3d":XF,"mesh-3d":YF,"point-3d":K0,"polygon-3d":FR,"web-style":Mw,cim:tE},errorContext:"symbol"},RUe={base:Sc,key:"type",typeMap:{"picture-marker":JF,"simple-marker":Wg,text:iE,"web-style":Mw,cim:tE},errorContext:"symbol"},PUe=Q2({types:Eb}),hye={base:Sc,key:"type",typeMap:{"simple-fill":X_,"picture-fill":lye,"picture-marker":JF,"simple-line":wu,"simple-marker":Wg,text:iE,"line-3d":XF,"mesh-3d":YF,"point-3d":K0,"polygon-3d":FR,"web-style":Mw,cim:tE},errorContext:"symbol"},MUe={base:Sc,key:"type",typeMap:{text:iE,"label-3d":ZF},errorContext:"symbol"},iee={base:Sc,key:"type",typeMap:{"line-3d":XF,"mesh-3d":YF,"point-3d":K0,"polygon-3d":FR,"web-style":Mw,cim:tE},errorContext:"symbol"},IUe={base:Sc,key:"type",typeMap:{"label-3d":ZF},errorContext:"symbol"},dye=np(Eb);var jz;function $Ue(t){if(!t)return null;const e={};for(const r in t){const i=S_(t[r]);i&&(e[r]=i)}return Object.keys(e).length!==0?e:null}function LUe(t){if(t==null)return null;const e={};for(const r in t){const i=t[r];i&&(e[r]=i.toJSON())}return Object.keys(e).length!==0?e:null}let zl=jz=class extends Vi(de){constructor(...t){super(...t),this.isAggregate=!1,this.layer=null,this.popupTemplate=null,this.sourceLayer=null,Object.defineProperty(this,"uid",{value:gc(),configurable:!0})}normalizeCtorArgs(t,e,r,i){return t&&!t.declaredClass?t:{geometry:t,symbol:e,attributes:r,popupTemplate:i}}set aggregateGeometries(t){const e=this._get("aggregateGeometries");JSON.stringify(e)!==JSON.stringify(t)&&this._set("aggregateGeometries",t)}set attributes(t){const e=this._get("attributes");e!==t&&(this._set("attributes",t),this._notifyLayer("attributes",e,t))}set geometry(t){const e=this._get("geometry");e!==t&&(this._set("geometry",t),this._notifyLayer("geometry",e,t))}set symbol(t){const e=this._get("symbol");e!==t&&(this._set("symbol",t),this._notifyLayer("symbol",e,t))}set visible(t){const e=this._get("visible");e!==t&&(this._set("visible",t),this._notifyLayer("visible",e,t))}cloneShallow(){return new jz({aggregateGeometries:this.aggregateGeometries,attributes:this.attributes,geometry:this.geometry,isAggregate:this.isAggregate,layer:this.layer,popupTemplate:this.popupTemplate,sourceLayer:this.sourceLayer,symbol:this.symbol,visible:this.visible})}getEffectivePopupTemplate(t=!1){if(this.popupTemplate)return this.popupTemplate;for(const e of[this.sourceLayer,this.layer])if(e){if("popupTemplate"in e&&e.popupTemplate)return e.popupTemplate;if(t&&"defaultPopupTemplate"in e&&e.defaultPopupTemplate!=null)return e.defaultPopupTemplate}return null}getAttribute(t){return this.attributes?.[t]}setAttribute(t,e){if(this.attributes){const r=this.getAttribute(t);this.attributes[t]=e,this._notifyLayer("attributes",r,e,t)}else this.attributes={[t]:e},this._notifyLayer("attributes",void 0,e,t)}getObjectId(){return this.sourceLayer&&"objectIdField"in this.sourceLayer&&this.sourceLayer.objectIdField?this.getAttribute(this.sourceLayer.objectIdField):null}toJSON(){return{aggregateGeometries:LUe(this.aggregateGeometries),geometry:this.geometry!=null?this.geometry.toJSON():null,symbol:this.symbol!=null?this.symbol.toJSON():null,attributes:{...this.attributes},popupTemplate:this.popupTemplate&&this.popupTemplate.toJSON()}}notifyGeometryChanged(){this._notifyLayer("geometry",this.geometry,this.geometry)}notifyMeshTransformChanged(t={}){const{geometry:e}=this;if(e?.type==="mesh"){const r={origin:e.origin,transform:e.transform};this._notifyLayer("origin-transform",r,r,t.action)}}_notifyLayer(t,e,r,i){if(!this.layer||!("graphicChanged"in this.layer))return;const s={graphic:this,property:t,oldValue:e,newValue:r};t==="origin-transform"&&(s.action=i),t==="attributes"&&(s.attributeName=i),this.layer.graphicChanged(s)}};u([d({value:null,json:{read:$Ue}})],zl.prototype,"aggregateGeometries",null),u([d({value:null})],zl.prototype,"attributes",null),u([d({value:null,types:Ew,json:{read:S_}})],zl.prototype,"geometry",null),u([d({type:Boolean})],zl.prototype,"isAggregate",void 0),u([d({clonable:"reference"})],zl.prototype,"layer",void 0),u([d({type:eE})],zl.prototype,"popupTemplate",void 0),u([d({clonable:"reference"})],zl.prototype,"sourceLayer",void 0),u([d({value:null,types:Eb})],zl.prototype,"symbol",null),u([d({type:Boolean,value:!0})],zl.prototype,"visible",null),zl=jz=u([R("esri.Graphic")],zl),function(t){t.generateUID=gc}(zl||(zl={}));const Oh=zl;var Hz;let Co=Hz=class extends de{constructor(t){super(t),this.attachmentTypes=null,this.attachmentsWhere=null,this.cacheHint=void 0,this.keywords=null,this.globalIds=null,this.name=null,this.num=null,this.objectIds=null,this.returnMetadata=!1,this.size=null,this.start=null,this.where=null}writeStart(t,e){e.resultOffset=this.start,e.resultRecordCount=this.num||10}clone(){return new Hz(K({attachmentTypes:this.attachmentTypes,attachmentsWhere:this.attachmentsWhere,cacheHint:this.cacheHint,keywords:this.keywords,where:this.where,globalIds:this.globalIds,name:this.name,num:this.num,objectIds:this.objectIds,returnMetadata:this.returnMetadata,size:this.size,start:this.start}))}};u([d({type:[String],json:{write:!0}})],Co.prototype,"attachmentTypes",void 0),u([d({type:String,json:{read:{source:"attachmentsDefinitionExpression"},write:{target:"attachmentsDefinitionExpression"}}})],Co.prototype,"attachmentsWhere",void 0),u([d({type:Boolean,json:{write:!0}})],Co.prototype,"cacheHint",void 0),u([d({type:[String],json:{write:!0}})],Co.prototype,"keywords",void 0),u([d({type:[Number],json:{write:!0}})],Co.prototype,"globalIds",void 0),u([d({json:{write:!0}})],Co.prototype,"name",void 0),u([d({type:Number,json:{read:{source:"resultRecordCount"}}})],Co.prototype,"num",void 0),u([d({type:[Number],json:{write:!0}})],Co.prototype,"objectIds",void 0),u([d({type:Boolean,json:{default:!1,write:!0}})],Co.prototype,"returnMetadata",void 0),u([d({type:[Number],json:{write:!0}})],Co.prototype,"size",void 0),u([d({type:Number,json:{read:{source:"resultOffset"}}})],Co.prototype,"start",void 0),u([Fe("start"),Fe("num")],Co.prototype,"writeStart",null),u([d({type:String,json:{read:{source:"definitionExpression"},write:{target:"definitionExpression"}}})],Co.prototype,"where",void 0),Co=Hz=u([R("esri.rest.support.AttachmentQuery")],Co),Co.from=Zs(Co);const DUe=Co;function TEt(t){return t!=null&&typeof t=="object"&&"type"in t&&t.type==="feature"}function A3(t){const e=t?.type;return e==="base-tile"||e==="tile"||e==="elevation"||e==="imagery-tile"||e==="base-elevation"||e==="open-street-map"||e==="wcs"||e==="web-tile"||e==="wmts"||e==="vector-tile"}function a2(t){return t!=null&&"type"in t&&t.type==="group"}const SEt={Point:"SceneLayer","3DObject":"SceneLayer",IntegratedMesh:"IntegratedMeshLayer",PointCloud:"PointCloudLayer",Building:"BuildingSceneLayer"};function pye(t){const e=t?.type;return e==="building-scene"||e==="integrated-mesh"||e==="point-cloud"||e==="scene"}function see(t){return t?.type==="voxel"}function nee(t){return t?.type==="imagery-tile"}function fye(t){return t!=null&&t.parent!=null&&"declaredClass"in t.parent&&t.parent.declaredClass==="esri.Basemap"&&t.parent.baseLayers.includes(t)}function XW(t){return t?.type==="feature"&&!t.url&&t.source?.type==="memory"}function EEt(t){return t?.type==="feature"&&t.source?.type==="feature-layer"}function NUe(t){if(t.activeLayer){const e=t.activeLayer.tileMatrixSet;if(e)return e;const r=t.activeLayer.tileMatrixSets;if(r)return r}return null}async function mye(t,e){const r=Gt?.findServerInfo(t);if(r?.currentVersion!=null)return r.owningSystemUrl||null;const i=t.toLowerCase().indexOf("/rest/services");if(i===-1)return null;const s=`${t.substring(0,i)}/rest/info`,n=e!=null?e.signal:null,{data:o}=await qt(s,{query:{f:"json"},responseType:"json",signal:n});return o?.owningSystemUrl||null}function FUe(t){if(!("capabilities"in t))return!1;switch(t.type){case"csv":case"feature":case"geojson":case"imagery":case"knowledge-graph-sublayer":case"ogc-feature":case"oriented-imagery":case"scene":case"subtype-group":case"subtype-sublayer":case"wfs":return!0;default:return!1}}function CEt(t){return t!=null&&typeof t=="object"&&"isTable"in t&&!!t.isTable}function UUe(t){return FUe(t)?"effectiveCapabilities"in t?t.effectiveCapabilities:t.capabilities:null}function kUe(t){if(!("editingEnabled"in t))return!1;switch(t.type){case"csv":case"feature":case"geojson":case"oriented-imagery":case"scene":case"subtype-group":case"subtype-sublayer":return!0;default:return!1}}function VUe(t){return!!kUe(t)&&("effectiveEditingEnabled"in t?t.effectiveEditingEnabled:t.editingEnabled)}function sE(t){return(e,r)=>{e.hasOwnProperty("_messageBundleProps")||(e._messageBundleProps=e._messageBundleProps?e._messageBundleProps.slice():[]),e._messageBundleProps.push({bundlePath:t,propertyName:r})}}var zUe=function(t){return{vnodeSelector:"",properties:void 0,children:void 0,text:t.toString(),domNode:null}},gye=function(t,e){for(var r=0,i=t.length;r<i;r++){var s=t[r];Array.isArray(s)?gye(s,e):s!=null&&s!==!1&&(s.hasOwnProperty("vnodeSelector")||(s=zUe(s)),e.push(s))}},BUe=function(t,e){for(var r=[],i=2;i<arguments.length;i++)r[i-2]=arguments[i];if(r.length===1&&typeof r[0]=="string")return{vnodeSelector:t,properties:e||void 0,children:void 0,text:r[0],domNode:null};var s=[];return gye(r,s),{vnodeSelector:t,properties:e||void 0,children:s,text:void 0,domNode:null}};function Gr(t,e,...r){return typeof t!="function"||RW(t)?BUe(t,e,...r):t(e,...r)}function AEt(t){}function GUe(t){return()=>t}const oee=new Set;function jUe(t,e,r=!1){r&&oee.has(e)||(r&&oee.add(e),t.warn(` DEPRECATED - ${e}`))}function OEt(t,e,r={}){if(oe("esri-deprecation-warnings")){const{moduleName:i}=r;MO(t,`Function: ${(i?i+"::":"")+e+"()"}`,r)}}function jd(t,e,r={}){if(oe("esri-deprecation-warnings")){const{moduleName:i}=r;MO(t,`Property: ${(i?i+"::":"")+e}`,r)}}function MO(t,e,r={}){if(oe("esri-deprecation-warnings")){const{replacement:i,version:s,see:n,warnOnce:o}=r;let a=e;i&&(a+=`
	 Replacement: ${i}`),s&&(a+=`
	 Version: ${s}`),n&&(a+=`
	 See ${n} for more details.`),jUe(t,a,o)}}var qz;let c1=qz=class extends de{constructor(t){super(t),this.expression=null,this.name=null,this.returnType="boolean",this.title=null}clone(){return new qz({name:this.name,title:this.title,expression:this.expression,returnType:this.returnType})}};u([d({type:String,json:{write:!0}})],c1.prototype,"expression",void 0),u([d({type:String,json:{write:!0}})],c1.prototype,"name",void 0),u([d({type:["boolean","date","number","string"],json:{write:!0}})],c1.prototype,"returnType",void 0),u([d({type:String,json:{write:!0}})],c1.prototype,"title",void 0),c1=qz=u([R("esri.form.ExpressionInfo")],c1);const HUe=c1;let u1=class extends de{constructor(e){super(e),this.description=null,this.label=null,this.type=null,this.visibilityExpression=null}};u([d({type:String,json:{write:!0}})],u1.prototype,"description",void 0),u([d({type:String,json:{write:!0}})],u1.prototype,"label",void 0),u([d()],u1.prototype,"type",void 0),u([d({type:String,json:{write:!0}})],u1.prototype,"visibilityExpression",void 0),u1=u([R("esri.form.elements.Element")],u1);const l2=u1;var Wz;let aL=Wz=class extends de{constructor(t){super(t),this.type=null}clone(){return new Wz({type:this.type})}};u([d({type:["attachment","audio","document","image","signature","video"],json:{write:!0}})],aL.prototype,"type",void 0),aL=Wz=u([R("esri.form.elements.inputs.AttachmentInput")],aL);const qUe=aL;var Zz;let h1=Zz=class extends l2{constructor(t){super(t),this.attachmentKeyword=null,this.editable=!0,this.input=null,this.type="attachment"}clone(){return new Zz({attachmentKeyword:this.attachmentKeyword,description:this.description,editable:this.editable,input:this.input,label:this.label,visibilityExpression:this.visibilityExpression})}};u([d({type:String,json:{write:!0}})],h1.prototype,"attachmentKeyword",void 0),u([d({type:Boolean,json:{write:!0}})],h1.prototype,"editable",void 0),u([d({type:qUe,json:{read:{source:"inputType"},write:{target:"inputType"}}})],h1.prototype,"input",void 0),u([d({type:["attachment"],json:{read:!1,write:!0}})],h1.prototype,"type",void 0),h1=Zz=u([R("esri.form.elements.AttachmentElement")],h1);const aee=h1;let lL=class extends de{constructor(e){super(e),this.type=null}};u([d()],lL.prototype,"type",void 0),lL=u([R("esri.form.elements.inputs.Input")],lL);const nE=lL;let cA=class extends nE{constructor(e){super(e),this.maxLength=null,this.minLength=0}};u([d({type:Number,json:{write:!0}})],cA.prototype,"maxLength",void 0),u([d({type:Number,json:{write:!0}})],cA.prototype,"minLength",void 0),cA=u([R("esri.form.elements.inputs.TextInput")],cA);const YW=cA;var Xz;let cL=Xz=class extends YW{constructor(t){super(t),this.type="barcode-scanner"}clone(){return new Xz({maxLength:this.maxLength,minLength:this.minLength})}};u([d({type:["barcode-scanner"],json:{read:!1,write:!0}})],cL.prototype,"type",void 0),cL=Xz=u([R("esri.form.elements.inputs.BarcodeScannerInput")],cL);const WUe=cL;var Yz;let pT=Yz=class extends nE{constructor(t){super(t),this.noValueOptionLabel=null,this.showNoValueOption=!0,this.type="combo-box"}clone(){return new Yz({showNoValueOption:this.showNoValueOption,noValueOptionLabel:this.noValueOptionLabel})}};u([d({type:String,json:{write:!0}})],pT.prototype,"noValueOptionLabel",void 0),u([d({type:Boolean,json:{write:!0}})],pT.prototype,"showNoValueOption",void 0),u([d({type:["combo-box"],json:{read:!1,write:!0}})],pT.prototype,"type",void 0),pT=Yz=u([R("esri.form.elements.inputs.ComboBoxInput")],pT);const ZUe=pT;var Jz;function lee(t){return t!=null?new Date(t):null}function cee(t){return t?t.getTime():null}let cd=Jz=class extends nE{constructor(t){super(t),this.includeTime=!1,this.max=null,this.min=null,this.type="datetime-picker"}readMax(t,e){return lee(e.max)}writeMax(t,e){e.max=cee(t)}readMin(t,e){return lee(e.min)}writeMin(t,e){e.min=cee(t)}clone(){return new Jz({includeTime:this.includeTime,max:this.max,min:this.min})}};u([d({type:Boolean,json:{write:!0}})],cd.prototype,"includeTime",void 0),u([d({type:Date,json:{type:Number,write:!0}})],cd.prototype,"max",void 0),u([Ee("max")],cd.prototype,"readMax",null),u([Fe("max")],cd.prototype,"writeMax",null),u([d({type:Date,json:{type:Number,write:!0}})],cd.prototype,"min",void 0),u([Ee("min")],cd.prototype,"readMin",null),u([Fe("min")],cd.prototype,"writeMin",null),u([d({type:["datetime-picker"],json:{read:!1,write:!0}})],cd.prototype,"type",void 0),cd=Jz=u([R("esri.form.elements.inputs.DateTimePickerInput")],cd);const XUe=cd;var Qz;let fT=Qz=class extends nE{constructor(t){super(t),this.noValueOptionLabel=null,this.showNoValueOption=!0,this.type="radio-buttons"}clone(){return new Qz({noValueOptionLabel:this.noValueOptionLabel,showNoValueOption:this.showNoValueOption})}};u([d({type:String,json:{write:!0}})],fT.prototype,"noValueOptionLabel",void 0),u([d({type:Boolean,json:{write:!0}})],fT.prototype,"showNoValueOption",void 0),u([d({type:["radio-buttons"],json:{read:!1,write:!0}})],fT.prototype,"type",void 0),fT=Qz=u([R("esri.form.elements.inputs.RadioButtonsInput")],fT);const YUe=fT;var Kz;let mT=Kz=class extends nE{constructor(t){super(t),this.offValue=null,this.onValue=null,this.type="switch"}clone(){return new Kz({offValue:this.offValue,onValue:this.onValue})}};u([d({type:[String,Number],json:{write:!0}})],mT.prototype,"offValue",void 0),u([d({type:[String,Number],json:{write:!0}})],mT.prototype,"onValue",void 0),u([d({type:["switch"],json:{read:!1,write:!0}})],mT.prototype,"type",void 0),mT=Kz=u([R("esri.form.elements.inputs.SwitchInput")],mT);const JUe=mT;var eB;let uL=eB=class extends YW{constructor(t){super(t),this.type="text-area"}clone(){return new eB({maxLength:this.maxLength,minLength:this.minLength})}};u([d({type:["text-area"],json:{read:!1,write:!0}})],uL.prototype,"type",void 0),uL=eB=u([R("esri.form.elements.inputs.TextAreaInput")],uL);const QUe=uL;var tB;let hL=tB=class extends YW{constructor(t){super(t),this.type="text-box"}clone(){return new tB({maxLength:this.maxLength,minLength:this.minLength})}};u([d({type:["text-box"],json:{read:!1,write:!0}})],hL.prototype,"type",void 0),hL=tB=u([R("esri.form.elements.inputs.TextBoxInput")],hL);const KUe=hL,e8e={base:nE,key:"type",typeMap:{"barcode-scanner":WUe,"combo-box":ZUe,"datetime-picker":XUe,"radio-buttons":YUe,switch:JUe,"text-area":QUe,"text-box":KUe}};var rB;let uA=rB=class extends de{constructor(t){super(t),this.name=null,this.code=null}clone(){return new rB({name:this.name,code:this.code})}};u([d({type:String,json:{write:!0}})],uA.prototype,"name",void 0),u([d({type:[String,Number],json:{write:!0}})],uA.prototype,"code",void 0),uA=rB=u([R("esri.layers.support.CodedValue")],uA);const t8e=new Rr({inherited:"inherited",codedValue:"coded-value",range:"range"});let hA=class extends de{constructor(e){super(e),this.name=null,this.type=null}};u([d({type:String,json:{write:!0}})],hA.prototype,"name",void 0),u([tt(t8e)],hA.prototype,"type",void 0),hA=u([R("esri.layers.support.Domain")],hA);const KF=hA;var iB;let dA=iB=class extends KF{constructor(t){super(t),this.codedValues=null,this.type="coded-value"}getName(t){let e=null;if(this.codedValues){const r=String(t);this.codedValues.some(i=>(String(i.code)===r&&(e=i.name),!!e))}return e}clone(){return new iB({codedValues:K(this.codedValues),name:this.name})}};u([d({type:[uA],json:{write:!0}})],dA.prototype,"codedValues",void 0),u([tt({codedValue:"coded-value"})],dA.prototype,"type",void 0),dA=iB=u([R("esri.layers.support.CodedValueDomain")],dA);const yye=dA;var sB;let dL=sB=class extends KF{constructor(t){super(t),this.type="inherited"}clone(){return new sB}};u([tt({inherited:"inherited"})],dL.prototype,"type",void 0),dL=sB=u([R("esri.layers.support.InheritedDomain")],dL);const _ye=dL;var nB;let gT=nB=class extends KF{constructor(t){super(t),this.maxValue=null,this.minValue=null,this.type="range"}clone(){return new nB({maxValue:this.maxValue,minValue:this.minValue,name:this.name})}};u([d({type:Number,json:{type:[Number],read:{source:"range",reader:(t,e)=>e.range&&e.range[1]},write:{enabled:!1,overridePolicy(){return{enabled:this.maxValue!=null&&this.minValue==null}},target:"range",writer(t,e,r){e[r]=[this.minValue||0,t]}}}})],gT.prototype,"maxValue",void 0),u([d({type:Number,json:{type:[Number],read:{source:"range",reader:(t,e)=>e.range&&e.range[0]},write:{target:"range",writer(t,e,r){e[r]=[t,this.maxValue||0]}}}})],gT.prototype,"minValue",void 0),u([tt({range:"range"})],gT.prototype,"type",void 0),gT=nB=u([R("esri.layers.support.RangeDomain")],gT);const vye=gT,bye={key:"type",base:KF,typeMap:{range:vye,"coded-value":yye,inherited:_ye}};function JW(t){if(!t||!t.type)return null;switch(t.type){case"range":return vye.fromJSON(t);case"codedValue":return yye.fromJSON(t);case"inherited":return _ye.fromJSON(t)}return null}var oB;const wye="esri.form.elements.FieldElement",uee=Q.getLogger(wye);let ku=oB=class extends l2{constructor(t){super(t),this.domain=null,this.editableExpression=null,this.fieldName=null,this.hint=null,this.input=null,this.requiredExpression=null,this.type="field",this.valueExpression=null}get editable(){return jd(uee,"editable",{replacement:"editableExpression",version:"4.26",warnOnce:!0}),this._get("editable")??!0}set editable(t){jd(uee,"editable",{replacement:"editableExpression",version:"4.26",warnOnce:!0}),this._set("editable",t)}clone(){return new oB({description:this.description,domain:this.domain,editable:this.editable,editableExpression:this.editableExpression,fieldName:this.fieldName,hint:this.hint,input:this.input,label:this.label,requiredExpression:this.requiredExpression,valueExpression:this.valueExpression,visibilityExpression:this.visibilityExpression})}};u([d({types:bye,json:{read:{reader:JW},write:!0}})],ku.prototype,"domain",void 0),u([d({type:Boolean,json:{write:!0}})],ku.prototype,"editable",null),u([d({type:String,json:{write:!0}})],ku.prototype,"editableExpression",void 0),u([d({type:String,json:{write:!0}})],ku.prototype,"fieldName",void 0),u([d({type:String,json:{write:!0}})],ku.prototype,"hint",void 0),u([d({types:e8e,json:{read:{source:"inputType"},write:{target:"inputType"}}})],ku.prototype,"input",void 0),u([d({type:String,json:{write:!0}})],ku.prototype,"requiredExpression",void 0),u([d({type:String,json:{read:!1,write:!0}})],ku.prototype,"type",void 0),u([d({type:String,json:{write:!0}})],ku.prototype,"valueExpression",void 0),ku=oB=u([R(wye)],ku);const hee=ku;var aB;let $m=aB=class extends l2{constructor(t){super(t),this.displayCount=null,this.displayType="list",this.editableExpression=null,this.orderByFields=null,this.relationshipId=null,this.type="relationship"}clone(){return new aB({description:this.description,displayCount:this.displayCount,displayType:this.displayType,editableExpression:this.editableExpression,label:this.label,orderByFields:K(this.orderByFields),relationshipId:this.relationshipId,visibilityExpression:this.visibilityExpression})}};u([d({type:Number,json:{write:!0}})],$m.prototype,"displayCount",void 0),u([d({type:["list"],json:{write:!0}})],$m.prototype,"displayType",void 0),u([d({type:String,json:{write:!0}})],$m.prototype,"editableExpression",void 0),u([d({type:[LW],json:{write:!0}})],$m.prototype,"orderByFields",void 0),u([d({type:Number,json:{write:!0}})],$m.prototype,"relationshipId",void 0),u([d({type:["relationship"],json:{read:!1,write:!0}})],$m.prototype,"type",void 0),$m=aB=u([R("esri.form.elements.RelationshipElement")],$m);const dee=$m;function xye(t){return{typesWithGroup:{base:l2,key:"type",typeMap:{attachment:aee,field:hee,group:t,relationship:dee}},typesWithoutGroup:{base:l2,key:"type",typeMap:{attachment:aee,field:hee,relationship:dee}}}}function Tye(t,e,r=!0){if(!t)return null;const i=r?e.typesWithGroup.typeMap:e.typesWithoutGroup.typeMap;return t.filter(s=>i[s.type]).map(s=>i[s.type].fromJSON(s))}function Sye(t,e,r=!0){if(!t)return null;const i=r?e.typesWithGroup.typeMap:e.typesWithoutGroup.typeMap;return t.filter(s=>i[s.type]).map(s=>s.toJSON())}function Eye(t,e,r=!0){return t?t.map(i=>np(r?e.typesWithGroup:e.typesWithoutGroup,i)):null}var lB;let lf=lB=class extends l2{constructor(t){super(t),this.elements=null,this.initialState="expanded",this.type="group"}castElements(t){return Eye(t,mU,!1)}readElements(t,e){return Tye(e.formElements,mU,!1)}writeElements(t,e){e.formElements=Sye(t,mU,!1)}clone(){return new lB({description:this.description,elements:K(this.elements),initialState:this.initialState,label:this.label,visibilityExpression:this.visibilityExpression})}};u([d({json:{write:!0}})],lf.prototype,"elements",void 0),u([yr("elements")],lf.prototype,"castElements",null),u([Ee("elements",["formElements"])],lf.prototype,"readElements",null),u([Fe("elements")],lf.prototype,"writeElements",null),u([d({type:["collapsed","expanded"],json:{write:!0}})],lf.prototype,"initialState",void 0),u([d({type:String,json:{read:!1,write:!0}})],lf.prototype,"type",void 0),lf=lB=u([R("esri.form.elements.GroupElement")],lf);const mU=xye(lf),r8e=lf;var cB;const gU=xye(r8e);let ud=cB=class extends de{constructor(t){super(t),this.description=null,this.elements=null,this.expressionInfos=null,this.preserveFieldValuesWhenHidden=!1,this.title=null}castElements(t){return Eye(t,gU)}readElements(t,e){return Tye(e.formElements,gU)}writeElements(t,e){e.formElements=Sye(t,gU)}clone(){return new cB({description:this.description,expressionInfos:K(this.expressionInfos),elements:K(this.elements),title:this.title,preserveFieldValuesWhenHidden:this.preserveFieldValuesWhenHidden})}};u([d({type:String,json:{write:!0}})],ud.prototype,"description",void 0),u([d({json:{write:!0}})],ud.prototype,"elements",void 0),u([yr("elements")],ud.prototype,"castElements",null),u([Ee("elements",["formElements"])],ud.prototype,"readElements",null),u([Fe("elements")],ud.prototype,"writeElements",null),u([d({type:[HUe],json:{write:!0}})],ud.prototype,"expressionInfos",void 0),u([d({type:Boolean,json:{default:!1,write:!0}})],ud.prototype,"preserveFieldValuesWhenHidden",void 0),u([d({type:String,json:{write:!0}})],ud.prototype,"title",void 0),ud=cB=u([R("esri.form.FormTemplate")],ud);const i8e=ud,s8e=[["binary","application/octet-stream","bin",""]];function $Et(t){return UR(t?.supportedFormats??[]).flatMap(eZ).map(e=>`.${e}`)}function LEt(t){const e={};for(const r of UR(t?.supportedFormats??[])){const i=KW(r),s=eZ(r).map(n=>`.${n}`);e[i]??(e[i]=[]),e[i].push(...s)}return[{description:"3D Models",accept:e}]}function n8e(t,e){return QW(l8e(t,e))}function o8e(t,e){return QW(c8e(t,e))}function DEt(t,e){return KW(a8e(t,e))}function UR(t){return[...s8e,...t]}function a8e(t,e){return UR(e).find(r=>QW(r)===t)}function l8e(t,e){return UR(e).find(r=>KW(r)===t)}function c8e(t,e){const r=t.toLowerCase();return UR(e).find(i=>eZ(i).some(s=>r.endsWith(s)))}function QW(t){return t?.[0]}function KW(t){return t?.[1]}function eZ(t){return t?.[2].split(",")??[]}function NEt(t){return t.tables?.find(e=>e.role==="assetMaps")}function u8e(t){return!(!(t&&typeof t=="object"&&"loaded"in t&&t.loaded&&UUe(t)?.operations?.supportsEditing&&"type"in t)||"editingEnabled"in t&&!VUe(t)||t.type==="scene"&&!h8e(t))}function h8e(t){const e=t.infoFor3D;if(!e)return!0;const{supportedFormats:r,queryFormats:i}=e,s=n8e("model/gltf-binary",r)??o8e("glb",r);return s!=null&&i.includes(s)}const Cye={mapserver:"MapServer",imageserver:"ImageServer",featureserver:"FeatureServer",sceneserver:"SceneServer",streamserver:"StreamServer",vectortileserver:"VectorTileServer"},Aye=Object.values(Cye),Oye=new RegExp(`^((?:https?:)?\\/\\/\\S+?\\/rest\\/services\\/(.+?)\\/(${Aye.join("|")}))(?:\\/(?:layers\\/)?(\\d+))?`,"i"),d8e=new RegExp(`^((?:https?:)?\\/\\/\\S+?\\/([^\\/\\n]+)\\/(${Aye.join("|")}))(?:\\/(?:layers\\/)?(\\d+))?`,"i"),p8e=/(.*?)\/(?:layers\/)?(\d+)\/?$/i;function FEt(t){return!!Oye.test(t)}function Iw(t){if(t==null)return null;const e=cn(t),r=e.path.match(Oye)||e.path.match(d8e);if(!r)return null;const[,i,s,n,o]=r,a=s.indexOf("/");return{title:e5(a!==-1?s.slice(a+1):s),serverType:Cye[n.toLowerCase()],sublayer:o!=null&&o!==""?parseInt(o,10):null,url:{path:i}}}function f8e(t){const e=cn(t).path.match(p8e);return e?{serviceUrl:e[1],sublayerId:Number(e[2])}:null}function e5(t){return(t=t.replaceAll(/\s*[/_]+\s*/g," "))[0].toUpperCase()+t.slice(1)}function Rye(t,e){const r=[];if(t){const i=Iw(t);i!=null&&i.title&&r.push(i.title)}if(e){const i=e5(e);r.push(i)}if(r.length===2){if(r[0].toLowerCase().includes(r[1].toLowerCase()))return r[0];if(r[1].toLowerCase().includes(r[0].toLowerCase()))return r[1]}return r.join(" - ")}function tZ(t){if(!t)return!1;const e=".arcgis.com/",r="//services",i="//tiles",s="//features",n=(t=t.toLowerCase()).includes(e),o=t.includes(r)||t.includes(i)||t.includes(s);return n&&o}function m8e(t,e){return t&&zde(Gde(t,e))}function Pye(t){let{url:e}=t;if(!e)return{url:e};e=Gde(e,t.logger);const r=cn(e),i=Iw(r.path);let s;if(i!=null)i.sublayer!=null&&t.layer.layerId==null&&(s=i.sublayer),e=i.url.path;else if(t.nonStandardUrlAllowed){const n=f8e(r.path);n!=null&&(e=n.serviceUrl,s=n.sublayerId)}return{url:zde(e),layerId:s}}function Mye(t,e,r,i,s){O_(e,i,"url",s),i.url&&t.layerId!=null&&(i.url=bc(i.url,r,t.layerId.toString()))}function UEt(t){if(!t)return!1;const e=t.toLowerCase(),r=e.includes("/services/"),i=e.includes("/mapserver/wmsserver"),s=e.includes("/imageserver/wmsserver"),n=e.includes("/wmsserver");return r&&(i||s||n)}var uB;let pA=uB=class extends de{constructor(t){super(t),this.minValue=0,this.maxValue=0}clone(){return new uB({minValue:this.minValue,maxValue:this.maxValue})}};u([d({type:Number,json:{write:!0}})],pA.prototype,"minValue",void 0),u([d({type:Number,json:{write:!0}})],pA.prototype,"maxValue",void 0),pA=uB=u([R("esri.renderer.support.AuthoringInfoClassBreakInfo")],pA);var hB;let P0=hB=class extends de{constructor(t){super(t),this.field="",this.normalizationField="",this.label="",this.classBreakInfos=[]}clone(){return new hB({field:this.field,normalizationField:this.normalizationField,label:this.label,classBreakInfos:K(this.classBreakInfos)})}};u([d({type:String,json:{write:!0}})],P0.prototype,"field",void 0),u([d({type:String,json:{write:!0}})],P0.prototype,"normalizationField",void 0),u([d({type:String,json:{write:!0}})],P0.prototype,"label",void 0),u([d({type:[pA],json:{write:!0}})],P0.prototype,"classBreakInfos",void 0),P0=hB=u([R("esri.renderers.support.AuthoringInfoFieldInfo")],P0);var dB;const jP=new Rr({percentTotal:"percent-of-total",ratio:"ratio",percent:"percent"}),HP=new Rr({sizeInfo:"size",colorInfo:"color",transparencyInfo:"opacity",rotationInfo:"rotation"}),pee={key:t=>typeof t=="number"?"number":"string",typeMap:{number:Number,string:String},base:null},fee=["high-to-low","above-and-below","centered-on","extremes"],mee=[...new Set(["high-to-low","above-and-below","centered-on","extremes","90-10","above","below","high-to-low","above-and-below","90-10","above","below"])],gee=["seconds","minutes","hours","days","months","years"];let Bl=dB=class extends de{constructor(t){super(t),this.endTime=null,this.field=null,this.maxSliderValue=null,this.minSliderValue=null,this.startTime=null,this.type=null,this.units=null}castEndTime(t){return typeof t=="string"||typeof t=="number"?t:null}castStartTime(t){return typeof t=="string"||typeof t=="number"?t:null}get style(){return this.type==="color"?this._get("style"):null}set style(t){this._set("style",t)}get theme(){return this.type==="color"||this.type==="size"?this._get("theme")||"high-to-low":null}set theme(t){this._set("theme",t)}clone(){return new dB({endTime:this.endTime,field:this.field,maxSliderValue:this.maxSliderValue,minSliderValue:this.minSliderValue,startTime:this.startTime,style:this.style,theme:this.theme,type:this.type,units:this.units})}};u([d({types:pee,json:{write:!0}})],Bl.prototype,"endTime",void 0),u([yr("endTime")],Bl.prototype,"castEndTime",null),u([d({type:String,json:{write:!0}})],Bl.prototype,"field",void 0),u([d({type:Number,json:{write:!0}})],Bl.prototype,"maxSliderValue",void 0),u([d({type:Number,json:{write:!0}})],Bl.prototype,"minSliderValue",void 0),u([d({types:pee,json:{write:!0}})],Bl.prototype,"startTime",void 0),u([yr("startTime")],Bl.prototype,"castStartTime",null),u([d({type:jP.apiValues,value:null,json:{type:jP.jsonValues,read:jP.read,write:jP.write}})],Bl.prototype,"style",null),u([d({type:mee,value:null,json:{type:mee,origins:{"web-scene":{type:fee,write:{writer:(t,e)=>{fee.includes(t)&&(e.theme=t)}}}},write:!0}})],Bl.prototype,"theme",null),u([d({type:HP.apiValues,json:{type:HP.jsonValues,read:HP.read,write:HP.write}})],Bl.prototype,"type",void 0),u([d({type:gee,json:{type:gee,write:!0}})],Bl.prototype,"units",void 0),Bl=dB=u([R("esri.renderers.support.AuthoringInfoVisualVariable")],Bl);const g8e=Bl;let pL=class extends de{constructor(e){super(e),this.type=null}};u([d({readOnly:!0,json:{read:!1,write:!0}})],pL.prototype,"type",void 0),pL=u([R("esri.rest.support.ColorRamp")],pL);const rZ=pL;var pB;let d1=pB=class extends rZ{constructor(t){super(t),this.algorithm=null,this.fromColor=null,this.toColor=null,this.type="algorithmic"}clone(){return new pB({fromColor:K(this.fromColor),toColor:K(this.toColor),algorithm:this.algorithm})}};u([tt({esriCIELabAlgorithm:"cie-lab",esriHSVAlgorithm:"hsv",esriLabLChAlgorithm:"lab-lch"})],d1.prototype,"algorithm",void 0),u([d({type:ze,json:{type:[Xi],write:!0}})],d1.prototype,"fromColor",void 0),u([d({type:ze,json:{type:[Xi],write:!0}})],d1.prototype,"toColor",void 0),u([d({type:["algorithmic"]})],d1.prototype,"type",void 0),d1=pB=u([R("esri.rest.support.AlgorithmicColorRamp")],d1);const iZ=d1;var fB;let fA=fB=class extends rZ{constructor(t){super(t),this.colorRamps=null,this.type="multipart"}clone(){return new fB({colorRamps:K(this.colorRamps)})}};u([d({type:[iZ],json:{write:!0}})],fA.prototype,"colorRamps",void 0),u([d({type:["multipart"]})],fA.prototype,"type",void 0),fA=fB=u([R("esri.rest.support.MultipartColorRamp")],fA);const Iye=fA,y8e={key:"type",base:rZ,typeMap:{algorithmic:iZ,multipart:Iye}};function _8e(t){return t&&t.type?t.type==="algorithmic"?iZ.fromJSON(t):t.type==="multipart"?Iye.fromJSON(t):null:null}var mB;const dv=new Rr({esriClassifyDefinedInterval:"defined-interval",esriClassifyEqualInterval:"equal-interval",esriClassifyManual:"manual",esriClassifyNaturalBreaks:"natural-breaks",esriClassifyQuantile:"quantile",esriClassifyStandardDeviation:"standard-deviation"}),qP=new Rr({pieChart:"pie-chart",classedSize:"class-breaks-size",classedColor:"class-breaks-color",univariateColorSize:"univariate-color-size",relationship:"relationship",predominance:"predominance",dotDensity:"dot-density",flow:"flow"}),yee=new Rr({classedSize:"class-breaks-size",classedColor:"class-breaks-color",univariateColorSize:"univariate-color-size",relationship:"relationship",predominance:"predominance",dotDensity:"dot-density"}),_ee=["inches","feet","yards","miles","nautical-miles","millimeters","centimeters","decimeters","meters","kilometers","decimal-degrees"],v8e=["high-to-low","above-and-below","above","below","90-10"],b8e=["flow-line","wave-front"],w8e=["caret","circle-caret","arrow","circle-arrow","plus-minus","circle-plus-minus","square","circle","triangle","happy-sad","thumb","custom"];let Gs=mB=class extends de{constructor(t){super(t),this.colorRamp=null,this.fadeRatio=null,this.isAutoGenerated=!1,this.lengthUnit=null,this.maxSliderValue=null,this.minSliderValue=null,this.visualVariables=null}get classificationMethod(){const t=this._get("classificationMethod"),e=this.type;return e&&e!=="relationship"?e==="class-breaks-size"||e==="class-breaks-color"?t||"manual":null:t}set classificationMethod(t){this._set("classificationMethod",t)}readColorRamp(t){return t?_8e(t):void 0}get fields(){return this.type&&this.type!=="predominance"?null:this._get("fields")}set fields(t){this._set("fields",t)}get field1(){return this.type&&this.type!=="relationship"?null:this._get("field1")}set field1(t){this._set("field1",t)}get field2(){return this.type&&this.type!=="relationship"?null:this._get("field2")}set field2(t){this._set("field2",t)}get flowTheme(){return this.type==="flow"?this._get("flowTheme"):null}set flowTheme(t){this._set("flowTheme",t)}get focus(){return this.type&&this.type!=="relationship"?null:this._get("focus")}set focus(t){this._set("focus",t)}get numClasses(){return this.type&&this.type!=="relationship"?null:this._get("numClasses")}set numClasses(t){this._set("numClasses",t)}get statistics(){return this.type==="univariate-color-size"&&this.univariateTheme==="above-and-below"?this._get("statistics"):null}set statistics(t){this._set("statistics",t)}get standardDeviationInterval(){const t=this.type;return t&&t!=="relationship"&&t!=="class-breaks-size"&&t!=="class-breaks-color"||this.classificationMethod&&this.classificationMethod!=="standard-deviation"?null:this._get("standardDeviationInterval")}set standardDeviationInterval(t){this._set("standardDeviationInterval",t)}get type(){return this._get("type")}set type(t){let e=t;t==="classed-size"?e="class-breaks-size":t==="classed-color"&&(e="class-breaks-color"),this._set("type",e)}get univariateSymbolStyle(){return this.type==="univariate-color-size"&&this.univariateTheme==="above-and-below"?this._get("univariateSymbolStyle"):null}set univariateSymbolStyle(t){this._set("univariateSymbolStyle",t)}get univariateTheme(){return this.type==="univariate-color-size"?this._get("univariateTheme"):null}set univariateTheme(t){this._set("univariateTheme",t)}clone(){return new mB({classificationMethod:this.classificationMethod,colorRamp:K(this.colorRamp),fadeRatio:K(this.fadeRatio),fields:this.fields&&this.fields.slice(0),field1:K(this.field1),field2:K(this.field2),isAutoGenerated:this.isAutoGenerated,focus:this.focus,numClasses:this.numClasses,maxSliderValue:this.maxSliderValue,minSliderValue:this.minSliderValue,lengthUnit:this.lengthUnit,statistics:this.statistics,standardDeviationInterval:this.standardDeviationInterval,type:this.type,visualVariables:this.visualVariables&&this.visualVariables.map(t=>t.clone()),univariateSymbolStyle:this.univariateSymbolStyle,univariateTheme:this.univariateTheme,flowTheme:this.flowTheme})}};u([d({type:dv.apiValues,value:null,json:{type:dv.jsonValues,read:dv.read,write:dv.write,origins:{"web-document":{default:"manual",type:dv.jsonValues,read:dv.read,write:dv.write}}}})],Gs.prototype,"classificationMethod",null),u([d({types:y8e,json:{write:!0}})],Gs.prototype,"colorRamp",void 0),u([Ee("colorRamp")],Gs.prototype,"readColorRamp",null),u([d({json:{write:!0,origins:{"web-scene":{write:!1,read:!1}}}})],Gs.prototype,"fadeRatio",void 0),u([d({type:[String],value:null,json:{write:!0}})],Gs.prototype,"fields",null),u([d({type:P0,value:null,json:{write:!0}})],Gs.prototype,"field1",null),u([d({type:P0,value:null,json:{write:!0}})],Gs.prototype,"field2",null),u([d({type:b8e,value:null,json:{write:!0,origins:{"web-scene":{write:!1}}}})],Gs.prototype,"flowTheme",null),u([d({type:["HH","HL","LH","LL"],value:null,json:{write:!0}})],Gs.prototype,"focus",null),u([d({type:Boolean,json:{write:!0,default:!1,origins:{"web-scene":{write:!1}}}})],Gs.prototype,"isAutoGenerated",void 0),u([d({type:Number,value:null,json:{type:Xi,write:!0}})],Gs.prototype,"numClasses",null),u([d({type:_ee,json:{type:_ee,read:!1,write:!1,origins:{"web-scene":{read:!0,write:!0}}}})],Gs.prototype,"lengthUnit",void 0),u([d({type:Number,json:{write:!0,origins:{"web-scene":{write:!1,read:!1}}}})],Gs.prototype,"maxSliderValue",void 0),u([d({type:Number,json:{write:!0,origins:{"web-scene":{write:!1,read:!1}}}})],Gs.prototype,"minSliderValue",void 0),u([d({type:Object,value:null,json:{write:!0,origins:{"web-scene":{write:!1,read:!1}}}})],Gs.prototype,"statistics",null),u([d({type:[.25,.33,.5,1],value:null,json:{type:[.25,.33,.5,1],write:!0}})],Gs.prototype,"standardDeviationInterval",null),u([d({type:qP.apiValues,value:null,json:{type:qP.jsonValues,read:qP.read,write:qP.write,origins:{"web-scene":{type:yee.jsonValues,write:{writer:yee.write,overridePolicy:t=>({enabled:t!=="flow"})}}}}})],Gs.prototype,"type",null),u([d({type:[g8e],json:{write:!0}})],Gs.prototype,"visualVariables",void 0),u([d({type:w8e,value:null,json:{write:!0,origins:{"web-scene":{write:!1}}}})],Gs.prototype,"univariateSymbolStyle",null),u([d({type:v8e,value:null,json:{write:!0,origins:{"web-scene":{write:!1}}}})],Gs.prototype,"univariateTheme",null),Gs=mB=u([R("esri.renderers.support.AuthoringInfo")],Gs);const sZ=Gs,yU=new Rr({simple:"simple",uniqueValue:"unique-value",classBreaks:"class-breaks",heatmap:"heatmap",dotDensity:"dot-density",dictionary:"dictionary",pieChart:"pie-chart"},{ignoreUnknown:!0});let mA=class extends de{constructor(e){super(e),this.authoringInfo=null,this.type=null}async getRequiredFields(e){if(!this.collectRequiredFields)return[];const r=new Set;return await this.collectRequiredFields(r,e),Array.from(r).sort()}getSymbol(e,r){}async getSymbolAsync(e,r){}getSymbols(){return[]}getAttributeHash(){return JSON.stringify(this)}getMeshHash(){return JSON.stringify(this)}};u([d({type:sZ,json:{write:!0}})],mA.prototype,"authoringInfo",void 0),u([d({type:yU.apiValues,readOnly:!0,json:{type:yU.jsonValues,read:!1,write:{writer:yU.write,ignoreOrigin:!0}}})],mA.prototype,"type",void 0),mA=u([R("esri.renderers.Renderer")],mA);const Zg=mA;function x8e(t){return t.match(T8e)?.[1]?.replace(/\\'/g,"'")??null}const T8e=/^hash\(\$feature\['((\\'|[^'])+)'\]\) \* 8\.381e-8$/;var gB;let CS=gB=class extends de{constructor(){super(...arguments),this.title=null}clone(){return new gB({title:this.title})}};u([d({type:String,json:{write:!0}})],CS.prototype,"title",void 0),CS=gB=u([R("esri.renderers.support.LegendOptions")],CS);var yB;let fL=yB=class extends CS{constructor(){super(...arguments),this.showLegend=null}clone(){return new yB({title:this.title,showLegend:this.showLegend})}};u([d({type:Boolean,json:{write:!0}})],fL.prototype,"showLegend",void 0),fL=yB=u([R("esri.renderers.visualVariables.support.VisualVariableLegendOptions")],fL);const $ye=fL,_U=new Rr({colorInfo:"color",transparencyInfo:"opacity",rotationInfo:"rotation",sizeInfo:"size"});let hd=class extends de{constructor(e){super(e),this.index=null,this.type=null,this.field=null,this.valueExpression=null,this.valueExpressionTitle=null,this.legendOptions=null}castField(e){return e==null?e:typeof e=="function"?(Q.getLogger(this).error(".field: field must be a string value"),null):CR(e)}get arcadeRequired(){return!!this.valueExpression}clone(){}getAttributeHash(){return`${this.type}-${this.field}-${this.valueExpression}`}};u([d()],hd.prototype,"index",void 0),u([d({type:_U.apiValues,readOnly:!0,json:{read:_U.read,write:_U.write}})],hd.prototype,"type",void 0),u([d({type:String,json:{write:!0}})],hd.prototype,"field",void 0),u([yr("field")],hd.prototype,"castField",null),u([d({type:String,json:{write:!0}})],hd.prototype,"valueExpression",void 0),u([d({type:String,json:{write:!0}})],hd.prototype,"valueExpressionTitle",void 0),u([d({readOnly:!0})],hd.prototype,"arcadeRequired",null),u([d({type:$ye,json:{write:!0}})],hd.prototype,"legendOptions",void 0),hd=u([R("esri.renderers.visualVariables.VisualVariable")],hd);const kR=hd;var _B;let p1=_B=class extends de{constructor(t){super(t),this.color=null,this.label=null,this.value=null}writeValue(t,e,r){e[r]=t??0}clone(){return new _B({color:this.color&&this.color.clone(),label:this.label,value:this.value})}};u([d({type:ze,json:{type:[Xi],write:!0}})],p1.prototype,"color",void 0),u([d({type:String,json:{write:!0}})],p1.prototype,"label",void 0),u([d({type:Number,json:{write:{writerEnsuresNonNull:!0}}})],p1.prototype,"value",void 0),u([Fe("value")],p1.prototype,"writeValue",null),p1=_B=u([R("esri.renderers.visualVariables.support.ColorStop")],p1);const S8e=p1;var vB;let f1=vB=class extends kR{constructor(t){super(t),this.type="color",this.normalizationField=null}get cache(){return{ipData:this._interpolateData(),hasExpression:!!this.valueExpression,compiledFunc:null}}set stops(t){t&&Array.isArray(t)&&(t=t.filter(e=>!!e)).sort((e,r)=>e.value-r.value),this._set("stops",t)}clone(){return new vB({field:this.field,normalizationField:this.normalizationField,valueExpression:this.valueExpression,valueExpressionTitle:this.valueExpressionTitle,stops:this.stops&&this.stops.map(t=>t.clone()),legendOptions:this.legendOptions&&this.legendOptions.clone()})}getAttributeHash(){return`${super.getAttributeHash()}-${this.normalizationField}`}_interpolateData(){return this.stops&&this.stops.map(t=>t.value||0)}};u([d({readOnly:!0})],f1.prototype,"cache",null),u([d({type:["color"],json:{type:["colorInfo"]}})],f1.prototype,"type",void 0),u([d({type:String,json:{write:!0}})],f1.prototype,"normalizationField",void 0),u([d({type:[S8e],json:{write:!0}})],f1.prototype,"stops",null),f1=vB=u([R("esri.renderers.visualVariables.ColorVariable")],f1);const Lye=f1;var bB;let i0=bB=class extends de{constructor(t){super(t),this.label=null,this.opacity=null,this.value=null}readOpacity(t,e){return s2(e.transparency)}writeOpacity(t,e,r){e[r]=jF(t)}clone(){return new bB({label:this.label,opacity:this.opacity,value:this.value})}};u([d({type:String,json:{write:!0}})],i0.prototype,"label",void 0),u([d({type:Number,json:{type:Xi,write:{target:"transparency"}}})],i0.prototype,"opacity",void 0),u([Ee("opacity",["transparency"])],i0.prototype,"readOpacity",null),u([Fe("opacity")],i0.prototype,"writeOpacity",null),u([d({type:Number,json:{write:!0}})],i0.prototype,"value",void 0),i0=bB=u([R("esri.renderers.visualVariables.support.OpacityStop")],i0);const E8e=i0;var wB;let m1=wB=class extends kR{constructor(t){super(t),this.type="opacity",this.normalizationField=null}get cache(){return{ipData:this._interpolateData(),hasExpression:!!this.valueExpression,compiledFunc:null}}set stops(t){t&&Array.isArray(t)&&(t=t.filter(e=>!!e)).sort((e,r)=>e.value-r.value),this._set("stops",t)}clone(){return new wB({field:this.field,normalizationField:this.normalizationField,valueExpression:this.valueExpression,valueExpressionTitle:this.valueExpressionTitle,stops:this.stops&&this.stops.map(t=>t.clone()),legendOptions:this.legendOptions&&this.legendOptions.clone()})}getAttributeHash(){return`${super.getAttributeHash()}-${this.normalizationField}`}_interpolateData(){return this.stops&&this.stops.map(t=>t.value||0)}};u([d({readOnly:!0})],m1.prototype,"cache",null),u([d({type:["opacity"],json:{type:["transparencyInfo"]}})],m1.prototype,"type",void 0),u([d({type:String,json:{write:!0}})],m1.prototype,"normalizationField",void 0),u([d({type:[E8e],json:{write:!0}})],m1.prototype,"stops",null),m1=wB=u([R("esri.renderers.visualVariables.OpacityVariable")],m1);const Dye=m1;var xB;let Lm=xB=class extends kR{constructor(t){super(t),this.axis=null,this.type="rotation",this.rotationType="geographic",this.valueExpressionTitle=null}get cache(){return{hasExpression:!!this.valueExpression,compiledFunc:null}}writeValueExpressionTitleWebScene(t,e,r,i){if(i&&i.messages){const s=`visualVariables[${this.index}]`;i.messages.push(new F("property:unsupported",this.type+"VisualVariable.valueExpressionTitle is not supported in Web Scene. Please remove this property to save the Web Scene.",{instance:this,propertyName:s+".valueExpressionTitle",context:i}))}}clone(){return new xB({axis:this.axis,rotationType:this.rotationType,field:this.field,valueExpression:this.valueExpression,valueExpressionTitle:this.valueExpressionTitle,legendOptions:this.legendOptions&&this.legendOptions.clone()})}};u([d({readOnly:!0})],Lm.prototype,"cache",null),u([d({type:["heading","tilt","roll"],json:{origins:{"web-scene":{default:"heading",write:!0}}}})],Lm.prototype,"axis",void 0),u([d({type:["rotation"],json:{type:["rotationInfo"]}})],Lm.prototype,"type",void 0),u([d({type:["geographic","arithmetic"],json:{write:!0,origins:{"web-document":{write:!0,default:"geographic"}}}})],Lm.prototype,"rotationType",void 0),u([d({type:String,json:{write:!0}})],Lm.prototype,"valueExpressionTitle",void 0),u([Fe("web-scene","valueExpressionTitle")],Lm.prototype,"writeValueExpressionTitleWebScene",null),Lm=xB=u([R("esri.renderers.visualVariables.RotationVariable")],Lm);const Nye=Lm;var TB;let yT=TB=class extends de{constructor(t){super(t),this.label=null,this.size=null,this.value=null}clone(){return new TB({label:this.label,size:this.size,value:this.value})}};u([d({type:String,json:{write:!0}})],yT.prototype,"label",void 0),u([d({type:Number,cast:Jr,json:{write:!0}})],yT.prototype,"size",void 0),u([d({type:Number,json:{write:!0}})],yT.prototype,"value",void 0),yT=TB=u([R("esri.renderers.visualVariables.support.SizeStop")],yT);const _T=yT;var SB;let mL=SB=class extends $ye{constructor(){super(...arguments),this.customValues=null}clone(){return new SB({title:this.title,showLegend:this.showLegend,customValues:this.customValues&&this.customValues.slice(0)})}};u([d({type:[Number],json:{write:!0}})],mL.prototype,"customValues",void 0),mL=SB=u([R("esri.renderers.visualVariables.support.SizeVariableLegendOptions")],mL);const C8e=mL;var _g,fo;function e_(t){return t&&t.declaredClass==="esri.renderers.visualVariables.SizeVariable"}function IO(t){return t!=null&&!isNaN(t)&&isFinite(t)}function Fye(t){return t.valueExpression?_g.Expression:t.field&&typeof t.field=="string"?_g.Field:_g.Unknown}function A8e(t,e){const r=e||Fye(t),i=t.valueUnit||"unknown";return r===_g.Unknown?fo.Constant:t.stops?fo.Stops:t.minSize!=null&&t.maxSize!=null&&t.minDataValue!=null&&t.maxDataValue!=null?fo.ClampedLinear:i==="unknown"?t.minSize!=null&&t.minDataValue!=null?t.minSize&&t.minDataValue?fo.Proportional:fo.Additive:fo.Identity:fo.RealWorldSize}(function(t){t.Unknown="unknown",t.Expression="expression",t.Field="field"})(_g||(_g={})),function(t){t.Unknown="unknown",t.Stops="stops",t.ClampedLinear="clamped-linear",t.Proportional="proportional",t.Additive="additive",t.Constant="constant",t.Identity="identity",t.RealWorldSize="real-world-size"}(fo||(fo={}));const c2={unknown:1,inches:Io(1,"meters","inches"),feet:Io(1,"meters","feet"),"us-feet":Io(1,"meters","us-feet"),yards:Io(1,"meters","yards"),miles:Io(1,"meters","miles"),"nautical-miles":Io(1,"meters","nautical-miles"),millimeters:Io(1,"meters","millimeters"),centimeters:Io(1,"meters","centimeters"),decimeters:Io(1,"meters","decimeters"),meters:Io(1,"meters","meters"),kilometers:Io(1,"meters","kilometers"),"decimal-degrees":1/LLe(1,"meters",nr.radius)},P_=Q.getLogger("esri.renderers.visualVariables.support.visualVariableUtils"),vee=new Oh,gL=Math.PI,Uye=/^\s*(return\s+)?\$view\.scale\s*(;)?\s*$/i;function kye(t,e,r){const i="visualVariables"in t&&t.visualVariables?t.visualVariables.find(y=>y.type==="color"):t;if(!i)return;if(i.declaredClass!=="esri.renderers.visualVariables.ColorVariable")return void P_.warn("The visualVariable should be an instance of esri.renderers.visualVariables.ColorVariable");const s=typeof e=="number",n=s?null:e,o=n&&n.attributes;let a=s?e:null;const l=i.field,{ipData:c,hasExpression:h}=i.cache;let p=i.cache.compiledFunc;if(!l&&!h){const y=i.stops;return y&&y[0]&&y[0].color}if(typeof a!="number")if(h){if(r==null||r.arcade==null)return void P_.error("Use of arcade expressions requires an arcade context");const y={viewingMode:r.viewingMode,scale:r.scale,spatialReference:r.spatialReference},_=r.arcade.arcadeUtils,v=_.getViewInfo(y),w=_.createExecContext(n,v);if(!p){const x=_.createSyntaxTree(i.valueExpression);p=_.createFunction(x),i.cache.compiledFunc=p}a=_.executeFunction(p,w)}else o&&(a=o[l]);const f=i.normalizationField,m=o!=null&&f!=null?parseFloat(o[f]):void 0;if(a!=null&&(!f||s||!isNaN(m)&&m!==0)){isNaN(m)||s||(a/=m);const y=oZ(a,c);if(y){const _=y[0],v=y[1],w=_===v?i.stops[_].color:ze.blendColors(i.stops[_].color,i.stops[v].color,y[2],r?.color);return new ze(w)}}}function Vye(t,e,r){const i="visualVariables"in t&&t.visualVariables?t.visualVariables.find(y=>y.type==="opacity"):t;if(!i)return;if(i.declaredClass!=="esri.renderers.visualVariables.OpacityVariable")return void P_.warn("The visualVariable should be an instance of esri.renderers.visualVariables.OpacityVariable");const s=typeof e=="number",n=s?null:e,o=n&&n.attributes;let a=s?e:null;const l=i.field,{ipData:c,hasExpression:h}=i.cache;let p=i.cache.compiledFunc;if(!l&&!h){const y=i.stops;return y&&y[0]&&y[0].opacity}if(typeof a!="number")if(h){if(r==null||r.arcade==null)return void P_.error("Use of arcade expressions requires an arcade context");const y={viewingMode:r.viewingMode,scale:r.scale,spatialReference:r.spatialReference},_=r.arcade.arcadeUtils,v=_.getViewInfo(y),w=_.createExecContext(n,v);if(!p){const x=_.createSyntaxTree(i.valueExpression);p=_.createFunction(x),i.cache.compiledFunc=p}a=_.executeFunction(p,w)}else o&&(a=o[l]);const f=i.normalizationField,m=o!=null&&f!=null?parseFloat(o[f]):void 0;if(a!=null&&(!f||s||!isNaN(m)&&m!==0)){isNaN(m)||s||(a/=m);const y=oZ(a,c);if(y){const _=y[0],v=y[1];if(_===v)return i.stops[_].opacity;{const w=i.stops[_].opacity;return w+(i.stops[v].opacity-w)*y[2]}}}}function zye(t,e,r){const i="visualVariables"in t&&t.visualVariables?t.visualVariables.find(m=>m.type==="rotation"):t;if(!i)return;if(i.declaredClass!=="esri.renderers.visualVariables.RotationVariable")return void P_.warn("The visualVariable should be an instance of esri.renderers.visualVariables.RotationVariable");const s=i.axis||"heading",n=s==="heading"&&i.rotationType==="arithmetic"?90:0,o=s==="heading"&&i.rotationType==="arithmetic"?-1:1,a=typeof e=="number"?null:e,l=a&&a.attributes,c=i.field,{hasExpression:h}=i.cache;let p=i.cache.compiledFunc,f=0;if(!c&&!h)return f;if(h){if(r==null||r.arcade==null)return void P_.error("Use of arcade expressions requires an arcade context");const m={viewingMode:r.viewingMode,scale:r.scale,spatialReference:r.spatialReference},y=r.arcade.arcadeUtils,_=y.getViewInfo(m),v=y.createExecContext(a,_);if(!p){const w=y.createSyntaxTree(i.valueExpression);p=y.createFunction(w),i.cache.compiledFunc=p}f=y.executeFunction(p,v)}else l&&(f=l[c]||0);return f=typeof f!="number"||isNaN(f)?null:n+o*f,f}function O8e(t,e,r){const i=typeof e=="number",s=i?null:e,n=s&&s.attributes;let o=i?e:null;const{isScaleDriven:a}=t.cache;let l=t.cache.compiledFunc;if(a){const h=r?.scale,p=r?.view;o=h==null||p==="3d"?R8e(t):h}else if(!i)switch(t.inputValueType){case _g.Expression:{if(r==null||r.arcade==null)return void P_.error("Use of arcade expressions requires an arcade context");const h={viewingMode:r.viewingMode,scale:r.scale,spatialReference:r.spatialReference},p=r.arcade.arcadeUtils,f=p.getViewInfo(h),m=p.createExecContext(s,f);if(!l){const y=p.createSyntaxTree(t.valueExpression);l=p.createFunction(y),t.cache.compiledFunc=l}o=p.executeFunction(l,m);break}case _g.Field:n&&(o=n[t.field]);break;case _g.Unknown:o=null}if(!IO(o))return null;if(i||!t.normalizationField)return o;const c=n?parseFloat(n[t.normalizationField]):null;return IO(c)&&c!==0?o/c:null}function R8e(t){let e=null,r=null;const i=t.stops;return i?(e=i[0].value,r=i[i.length-1].value):(e=t.minDataValue||0,r=t.maxDataValue||0),(e+r)/2}function t5(t,e,r){const i="visualVariables"in t&&t.visualVariables?t.visualVariables.find(n=>n.type==="size"):t;if(!i)return;if(i.declaredClass!=="esri.renderers.visualVariables.SizeVariable")return void P_.warn("The visualVariable should be an instance of esri.renderers.visualVariables.SizeVariable");const s=Gye(O8e(i,e,r),i,e,r,i.cache.ipData);return s==null||isNaN(s)?0:s}function _c(t,e,r){return t==null?null:e_(t)?t5(t,e,r):IO(t)?t:null}function Bye(t,e,r){return IO(r)&&t>r?r:IO(e)&&t<e?e:t}function P8e(t,e,r,i){return t+((_c(e.minSize,r,i)||e.minDataValue)??0)}function M8e(t,e,r){const i=t.stops;let s=i&&i.length&&i[0].size;return s==null&&(s=t.minSize),_c(s,e,r)}function I8e(t,e,r,i){const s=(t-e.minDataValue)/(e.maxDataValue-e.minDataValue),n=_c(e.minSize,r,i),o=_c(e.maxSize,r,i),a=i?.shape;if(t<=e.minDataValue)return n;if(t>=e.maxDataValue)return o;if(n==null||o==null)return null;if(e.scaleBy==="area"&&a){const l=a==="circle",c=l?gL*(n/2)**2:n*n,h=c+s*((l?gL*(o/2)**2:o*o)-c);return l?2*Math.sqrt(h/gL):Math.sqrt(h)}return n+s*(o-n)}function $8e(t,e,r,i){const s=i?.shape,n=t/e.minDataValue,o=_c(e.minSize,r,i),a=_c(e.maxSize,r,i);let l=null;return l=s==="circle"?2*Math.sqrt(n*(o/2)**2):s==="square"||s==="diamond"||s==="image"?Math.sqrt(n*o**2):n*o,Bye(l,o,a)}function L8e(t,e,r,i,s){const[n,o,a]=oZ(t,s);if(n===o)return _c(e.stops?.[n].size,r,i);{const l=_c(e.stops?.[n].size,r,i);return l+(_c(e.stops?.[o].size,r,i)-l)*a}}function D8e(t,e,r,i){const s=(i!=null&&i.resolution?i.resolution:1)*c2[e.valueUnit],n=_c(e.minSize,r,i),o=_c(e.maxSize,r,i),{valueRepresentation:a}=e;let l=null;return l=a==="area"?2*Math.sqrt(t/gL)/s:a==="radius"||a==="distance"?2*t/s:t/s,Bye(l,n,o)}function Gye(t,e,r,i,s){switch(e.transformationType){case fo.Additive:return P8e(t,e,r,i);case fo.Constant:return M8e(e,r,i);case fo.ClampedLinear:return I8e(t,e,r,i);case fo.Proportional:return $8e(t,e,r,i);case fo.Stops:return L8e(t,e,r,i,s);case fo.RealWorldSize:return D8e(t,e,r,i);case fo.Identity:return t;case fo.Unknown:return null}}function N8e(t,e,r){const{isScaleDriven:i}=t.cache;if(!(i&&r==="3d"||e))return null;const s={scale:e,view:r};let n=_c(t.minSize,vee,s),o=_c(t.maxSize,vee,s);if(n!=null||o!=null){if(n>o){const a=o;o=n,n=a}return{minSize:n,maxSize:o}}}function nZ(t,e,r){if(!t.visualVariables)return;const i=[],s=[],n=[],o=[],a=[];for(const l of t.visualVariables)switch(l.type){case"color":s.push(l);break;case"opacity":n.push(l);break;case"rotation":a.push(l);break;case"size":o.push(l)}return s.forEach(l=>{const c=kye(l,e,r);i.push({variable:l,value:c})}),n.forEach(l=>{const c=Vye(l,e,r);i.push({variable:l,value:c})}),a.forEach(l=>{const c=zye(l,e,r);i.push({variable:l,value:c})}),o.forEach(l=>{const c=t5(l,e,r);i.push({variable:l,value:c})}),i.filter(l=>l.value!=null)}function oZ(t,e){if(!e)return;let r=0,i=e.length-1;return e.some((s,n)=>t<s?(i=n,!0):(r=n,!1)),[r,i,(t-e[r])/(e[i]-e[r])]}function F8e(t,e,r){const i=["proportional","proportional","proportional"];for(const s of t){const n=s.useSymbolValue?"symbol-value":t5(s,e,r);switch(s.axis){case"width":i[0]=n;break;case"depth":i[1]=n;break;case"height":i[2]=n;break;case"width-and-depth":i[0]=n,i[1]=n;break;case"all":case void 0:case null:i[0]=n,i[1]=n,i[2]=n;break;default:s.axis}}return i}const BEt=Object.freeze(Object.defineProperty({__proto__:null,getAllSizes:F8e,getColor:kye,getOpacity:Vye,getRotationAngle:zye,getSize:t5,getSizeForValue:Gye,getSizeFromNumberOrVariable:_c,getSizeRangeAtScale:N8e,getVisualVariableValues:nZ,viewScaleRE:Uye},Symbol.toStringTag,{value:"Module"}));var EB;const WP=new Rr({width:"width",depth:"depth",height:"height",widthAndDepth:"width-and-depth",all:"all"}),CB=new Rr({unknown:"unknown",inch:"inches",foot:"feet",yard:"yards",mile:"miles","nautical-mile":"nautical-miles",millimeter:"millimeters",centimeter:"centimeters",decimeter:"decimeters",meter:"meters",kilometer:"kilometers","decimal-degree":"decimal-degrees"});function bee(t){if(t!=null)return typeof t=="string"||typeof t=="number"?Jr(t):t.type==="size"?e_(t)?t:(delete(t={...t}).type,new li(t)):void 0}function wee(t,e,r){if(typeof t!="object")return t;const i=new li;return i.read(t,r),i}let li=EB=class extends kR{constructor(t){super(t),this.axis=null,this.legendOptions=null,this.normalizationField=null,this.scaleBy=null,this.target=null,this.type="size",this.useSymbolValue=null,this.valueExpression=null,this.valueRepresentation=null,this.valueUnit=null}get cache(){return{ipData:this._interpolateData(),hasExpression:!!this.valueExpression,compiledFunc:null,isScaleDriven:this.valueExpression!=null&&Uye.test(this.valueExpression)}}set expression(t){Q.getLogger(this).warn("'expression' is deprecated since version 4.2. Use 'valueExpression' instead. The only supported expression is 'view.scale'."),t==="view.scale"?(this.valueExpression="$view.scale",this._set("expression",t)):this._set("expression",null)}set index(t){e_(this.maxSize)&&(this.maxSize.index=`visualVariables[${t}].maxSize`),e_(this.minSize)&&(this.minSize.index=`visualVariables[${t}].minSize`),this._set("index",t)}get inputValueType(){return Fye(this)}set maxDataValue(t){t&&this.stops&&(Q.getLogger(this).warn("cannot set maxDataValue when stops is not null."),t=null),this._set("maxDataValue",t)}set maxSize(t){t&&this.stops&&(Q.getLogger(this).warn("cannot set maxSize when stops is not null."),t=null),this._set("maxSize",t)}castMaxSize(t){return bee(t)}readMaxSize(t,e,r){return wee(t,e,r)}set minDataValue(t){t&&this.stops&&(Q.getLogger(this).warn("cannot set minDataValue when stops is not null."),t=null),this._set("minDataValue",t)}set minSize(t){t&&this.stops&&(Q.getLogger(this).warn("cannot set minSize when stops is not null."),t=null),this._set("minSize",t)}castMinSize(t){return bee(t)}readMinSize(t,e,r){return wee(t,e,r)}get arcadeRequired(){return!!this.valueExpression||this.minSize!=null&&typeof this.minSize=="object"&&this.minSize.arcadeRequired||this.maxSize!=null&&typeof this.maxSize=="object"&&this.maxSize.arcadeRequired}set stops(t){this.minDataValue==null&&this.maxDataValue==null&&this.minSize==null&&this.maxSize==null?t&&Array.isArray(t)&&(t=t.filter(e=>!!e)).sort((e,r)=>e.value-r.value):t&&(Q.getLogger(this).warn("cannot set stops when one of minDataValue, maxDataValue, minSize or maxSize is not null."),t=null),this._set("stops",t)}get transformationType(){return A8e(this,this.inputValueType)}readValueExpression(t,e){return t||e.expression&&"$view.scale"}writeValueExpressionWebScene(t,e,r,i){if(t==="$view.scale"){if(i&&i.messages){const s=this.index,n=typeof s=="string"?s:`visualVariables[${s}]`;i.messages.push(new F("property:unsupported",this.type+"VisualVariable.valueExpression = '$view.scale' is not supported in Web Scene. Please remove this property to save the Web Scene.",{instance:this,propertyName:n+".valueExpression",context:i}))}}else e[r]=t}readValueUnit(t){return t?CB.read(t):null}clone(){return new EB({axis:this.axis,field:this.field,valueExpression:this.valueExpression,valueExpressionTitle:this.valueExpressionTitle,maxDataValue:this.maxDataValue,maxSize:e_(this.maxSize)?this.maxSize.clone():this.maxSize,minDataValue:this.minDataValue,minSize:e_(this.minSize)?this.minSize.clone():this.minSize,normalizationField:this.normalizationField,stops:this.stops&&this.stops.map(t=>t.clone()),target:this.target,useSymbolValue:this.useSymbolValue,valueRepresentation:this.valueRepresentation,valueUnit:this.valueUnit,legendOptions:this.legendOptions&&this.legendOptions.clone()})}flipSizes(){if(this.transformationType===fo.ClampedLinear){const{minSize:t,maxSize:e}=this;return this.minSize=e,this.maxSize=t,this}if(this.transformationType===fo.Stops){const t=this.stops;if(!t)return this;const e=t.map(i=>i.size).reverse(),r=t.length;for(let i=0;i<r;i++)t[i].size=e[i];return this}return this}getAttributeHash(){return`${super.getAttributeHash()}-${this.target}-${this.normalizationField}`}_interpolateData(){return this.stops&&this.stops.map(t=>t.value||0)}};u([d({readOnly:!0})],li.prototype,"cache",null),u([d({type:WP.apiValues,json:{type:WP.jsonValues,origins:{"web-map":{read:!1}},read:WP.read,write:WP.write}})],li.prototype,"axis",void 0),u([d({type:String,value:null,json:{read:!1}})],li.prototype,"expression",null),u([d()],li.prototype,"index",null),u([d({type:String,readOnly:!0})],li.prototype,"inputValueType",null),u([d({type:C8e,json:{write:!0}})],li.prototype,"legendOptions",void 0),u([d({type:Number,value:null,json:{write:!0}})],li.prototype,"maxDataValue",null),u([d({type:Number,value:null,json:{write:!0}})],li.prototype,"maxSize",null),u([yr("maxSize")],li.prototype,"castMaxSize",null),u([Ee("maxSize")],li.prototype,"readMaxSize",null),u([d({type:Number,value:null,json:{write:!0}})],li.prototype,"minDataValue",null),u([d({type:Number,value:null,json:{write:!0}})],li.prototype,"minSize",null),u([yr("minSize")],li.prototype,"castMinSize",null),u([Ee("minSize")],li.prototype,"readMinSize",null),u([d({type:String,json:{write:!0}})],li.prototype,"normalizationField",void 0),u([d({readOnly:!0})],li.prototype,"arcadeRequired",null),u([d({type:String})],li.prototype,"scaleBy",void 0),u([d({type:[_T],value:null,json:{write:!0}})],li.prototype,"stops",null),u([d({type:["outline"],json:{write:!0}})],li.prototype,"target",void 0),u([d({type:String,readOnly:!0})],li.prototype,"transformationType",null),u([d({type:["size"],json:{type:["sizeInfo"]}})],li.prototype,"type",void 0),u([d({type:Boolean,json:{write:!0,origins:{"web-map":{read:!1}}}})],li.prototype,"useSymbolValue",void 0),u([d({type:String,json:{write:!0}})],li.prototype,"valueExpression",void 0),u([Ee("valueExpression",["valueExpression","expression"])],li.prototype,"readValueExpression",null),u([Fe("web-scene","valueExpression")],li.prototype,"writeValueExpressionWebScene",null),u([d({type:["radius","diameter","area","width","distance"],json:{write:!0}})],li.prototype,"valueRepresentation",void 0),u([d({type:CB.apiValues,json:{write:CB.write,origins:{"web-map":{read:!1},"web-scene":{write:!0},"portal-item":{write:!0}}}})],li.prototype,"valueUnit",void 0),u([Ee("valueUnit")],li.prototype,"readValueUnit",null),li=EB=u([R("esri.renderers.visualVariables.SizeVariable")],li);const r5=li,U8e={color:Lye,size:r5,opacity:Dye,rotation:Nye},k8e=new Rr({colorInfo:"color",transparencyInfo:"opacity",rotationInfo:"rotation",sizeInfo:"size"}),V8e=/^\[([^\]]+)\]$/i;let yL=class extends Te{constructor(){super(...arguments),this.colorVariables=null,this.opacityVariables=null,this.rotationVariables=null,this.sizeVariables=null}set visualVariables(e){if(this._resetVariables(),(e=e&&e.filter(r=>!!r))&&e.length){for(const r of e)switch(r.type){case"color":this.colorVariables.push(r);break;case"opacity":this.opacityVariables.push(r);break;case"rotation":this.rotationVariables.push(r);break;case"size":this.sizeVariables.push(r)}this.sizeVariables.length&&this.sizeVariables.some(r=>!!r.target)&&e.sort((r,i)=>{let s=null;return s=r.target===i.target?0:r.target?1:-1,s});for(let r=0;r<e.length;r++)e[r].index=r;this._set("visualVariables",e)}else this._set("visualVariables",e)}readVariables(e,r,i){const{rotationExpression:s,rotationType:n}=r,o=s&&s.match(V8e),a=o&&o[1];if(a&&(e||(e=[]),e.push({type:"rotationInfo",rotationType:n,field:a})),e)return e.map(l=>{const c=k8e.read(l.type),h=U8e[c];h||(Q.getLogger(this).warn(`Unknown variable type: ${c}`),i&&i.messages&&i.messages.push(new Sh("visual-variable:unsupported",`visualVariable of type '${c}' is not supported`,{definition:l,context:i})));const p=new h;return p.read(l,i),p})}writeVariables(e,r){const i=[];for(const s of e){const n=s.toJSON(r);n&&i.push(n)}return i}_resetVariables(){this.colorVariables=[],this.opacityVariables=[],this.rotationVariables=[],this.sizeVariables=[]}};u([d()],yL.prototype,"visualVariables",null),yL=u([R("esri.renderers.visualVariables.VisualVariableFactory")],yL);const z8e=yL,B8e={base:kR,key:"type",typeMap:{opacity:Dye,color:Lye,rotation:Nye,size:r5}},oE=t=>{let e=class extends t{constructor(){super(...arguments),this._vvFactory=new z8e}set visualVariables(r){this._vvFactory.visualVariables=r,this._set("visualVariables",this._vvFactory.visualVariables)}readVisualVariables(r,i,s){return this._vvFactory.readVariables(r,i,s)}writeVisualVariables(r,i,s,n){i[s]=this._vvFactory.writeVariables(r,n)}get arcadeRequiredForVisualVariables(){if(!this.visualVariables)return!1;for(const r of this.visualVariables)if(r.arcadeRequired)return!0;return!1}hasVisualVariables(r,i){return r?this.getVisualVariablesForType(r,i).length>0:this.getVisualVariablesForType("size",i).length>0||this.getVisualVariablesForType("color",i).length>0||this.getVisualVariablesForType("opacity",i).length>0||this.getVisualVariablesForType("rotation",i).length>0}getVisualVariablesForType(r,i){const s=this.visualVariables;return s?s.filter(n=>n.type===r&&(typeof i=="string"?n.target===i:i!==!1||!n.target)):[]}async collectVVRequiredFields(r,i){let s=[];this.visualVariables&&(s=s.concat(this.visualVariables));for(const n of s)n&&(n.field&&au(r,i,n.field),n.normalizationField&&au(r,i,n.normalizationField),n.valueExpression&&(G8e(n.valueExpression,r,i)||await Cl(r,i,n.valueExpression)))}};return u([d({types:[B8e],value:null,json:{write:!0}})],e.prototype,"visualVariables",null),u([Ee("visualVariables",["visualVariables","rotationType","rotationExpression"])],e.prototype,"readVisualVariables",null),u([Fe("visualVariables")],e.prototype,"writeVisualVariables",null),e=u([R("esri.renderers.mixins.VisualVariablesMixin")],e),e};function G8e(t,e,r){const i=x8e(t);return i!=null&&(au(e,r,i),!0)}const kE={retainId:!1,ignoreDrivers:!1,hasLabelingContext:!0};function j8e(t,e=kE){if(!t)return{symbol:null};const{retainId:r=kE.retainId,ignoreDrivers:i=kE.ignoreDrivers,hasLabelingContext:s=kE.hasLabelingContext,retainCIM:n=kE.retainCIM}=e;let o=null;if(R_(t)||t instanceof Mw)o=t.clone();else if(t.type==="cim"){const a=t.data?.symbol?.type;if(a!=="CIMPointSymbol")return{error:new F("symbol-conversion:unsupported-cim-symbol",`CIM symbol of type '${a||"unknown"}' is unsupported in 3D`,{symbol:t})};o=n?t.clone():K0.fromCIMSymbol(t)}else if(t instanceof wu)o=XF.fromSimpleLineSymbol(t);else if(t instanceof Wg)o=K0.fromSimpleMarkerSymbol(t);else if(t instanceof JF)o=K0.fromPictureMarkerSymbol(t);else if(t instanceof X_)o=e.geometryType&&e.geometryType==="mesh"?YF.fromSimpleFillSymbol(t):FR.fromSimpleFillSymbol(t);else{if(!(t instanceof iE))return{error:new F("symbol-conversion:unsupported-2d-symbol",`2D symbol of type '${t.type||t.declaredClass}' is unsupported in 3D`,{symbol:t})};o=s?ZF.fromTextSymbol(t):K0.fromTextSymbol(t)}return r&&o&&o.type!=="cim"&&(o.id=t.id),i&&R_(o)&&o.symbolLayers.forEach(a=>a.ignoreDrivers=!0),{symbol:o}}function CN(t,e,r,i){const s=jye(t,{},{context:i,isLabelSymbol:!1});s!=null&&(e[r]=s)}function xee(t,e,r,i){const s=jye(t,{},{context:i,isLabelSymbol:!0});s!=null&&(e[r]=s)}function Tee(t){return t instanceof rE||t instanceof Mw}function jye(t,e,r){if(t==null)return null;const{context:i,isLabelSymbol:s}=r,n=i?.origin,o=i?.messages;if(n==="web-scene"&&!Tee(t)){const a=j8e(t,{retainCIM:!0,hasLabelingContext:s});return a.symbol!=null?a.symbol.write(e,i):(o?.push(new F("symbol:unsupported",`Symbols of type '${t.declaredClass}' are not supported in scenes. Use 3D symbology instead when working with WebScene and SceneView`,{symbol:t,context:i,error:a.error})),null)}return(n==="web-map"||n==="portal-item"&&!pye(i?.layer))&&Tee(t)?(o?.push(new F("symbol:unsupported",`Symbols of type '${t.declaredClass}' are not supported in web maps and portal items. Use 2D symbology and CIMSymbol instead when working with MapView`,{symbol:t,context:i})),null):t.write(e,i)}function Hye(t,e){return PUe(t,null,e)}const aE={types:hye,json:{write:{writer:CN},origins:{"web-scene":{types:iee,write:{writer:CN},read:{reader:Q2({types:iee})}}}}},qye={types:{base:Sc,key:"type",typeMap:{"simple-fill":Eb.typeMap["simple-fill"],"picture-fill":Eb.typeMap["picture-fill"],"polygon-3d":Eb.typeMap["polygon-3d"]}},json:{write:{writer:CN},origins:{"web-scene":{type:FR,write:{writer:CN}}}}},_L={cast:t=>t==null||typeof t=="string"||typeof t=="number"?t:`${t}`,json:{type:String,write:{writer:(t,e)=>{e.value=t?.toString()}}}};var AB;let s0=AB=class extends de{constructor(t){super(t),this.description=null,this.label=null,this.minValue=null,this.maxValue=0,this.symbol=null}clone(){return new AB({description:this.description,label:this.label,minValue:this.minValue,maxValue:this.maxValue,symbol:this.symbol?this.symbol.clone():null})}getMeshHash(){const t=JSON.stringify(this.symbol);return`${this.minValue}.${this.maxValue}.${t}`}};u([d({type:String,json:{write:!0}})],s0.prototype,"description",void 0),u([d({type:String,json:{write:!0}})],s0.prototype,"label",void 0),u([d({type:Number,json:{read:{source:"classMinValue"},write:{target:"classMinValue"}}})],s0.prototype,"minValue",void 0),u([d({type:Number,json:{read:{source:"classMaxValue"},write:{target:"classMaxValue"}}})],s0.prototype,"maxValue",void 0),u([d(aE)],s0.prototype,"symbol",void 0),s0=AB=u([R("esri.renderers.support.ClassBreakInfo")],s0);const AN=s0;var OB;const Wye="log",vL="percent-of-total",bL="field",ZP=new Rr({esriNormalizeByLog:Wye,esriNormalizeByPercentOfTotal:vL,esriNormalizeByField:bL}),H8e=Zs(AN);let Nn=OB=class extends oE(Zg){constructor(t){super(t),this._compiledValueExpression={valueExpression:null,compiledFunction:null},this.backgroundFillSymbol=null,this.classBreakInfos=null,this.defaultLabel=null,this.defaultSymbol=null,this.field=null,this.isMaxInclusive=!0,this.legendOptions=null,this.normalizationField=null,this.normalizationTotal=null,this.type="class-breaks",this.valueExpression=null,this.valueExpressionTitle=null,this._set("classBreakInfos",[])}readClassBreakInfos(t,e,r){if(!Array.isArray(t))return;let i=e.minValue;return t.map(s=>{const n=new AN;return n.read(s,r),n.minValue==null&&(n.minValue=i),n.maxValue==null&&(n.maxValue=n.minValue),i=n.maxValue,n})}writeClassBreakInfos(t,e,r,i){const s=t.map(n=>n.write({},i));this._areClassBreaksConsecutive()&&s.forEach(n=>delete n.classMinValue),e[r]=s}castField(t){return t==null?t:typeof t=="function"?(Q.getLogger(this).error(".field: field must be a string value"),null):CR(t)}get minValue(){return this.classBreakInfos&&this.classBreakInfos[0]&&this.classBreakInfos[0].minValue||0}get normalizationType(){let t=this._get("normalizationType");const e=!!this.normalizationField,r=this.normalizationTotal!=null;return e||r?(t=e&&bL||r&&vL||null,e&&r&&Q.getLogger(this).warn("warning: both normalizationField and normalizationTotal are set!")):t!==bL&&t!==vL||(t=null),t}set normalizationType(t){this._set("normalizationType",t)}addClassBreakInfo(t,e,r){let i=null;i=typeof t=="number"?new AN({minValue:t,maxValue:e,symbol:dye(r)}):H8e(K(t)),this.classBreakInfos.push(i),this.classBreakInfos.length===1&&this.notifyChange("minValue")}removeClassBreakInfo(t,e){const r=this.classBreakInfos.length;for(let i=0;i<r;i++){const s=[this.classBreakInfos[i].minValue,this.classBreakInfos[i].maxValue];if(s[0]===t&&s[1]===e){this.classBreakInfos.splice(i,1);break}}}getBreakIndex(t,e){return!this.valueExpression||e!=null&&e.arcade!=null||Q.getLogger(this).warn(""),this.valueExpression?this._getBreakIndexForExpression(t,e):this._getBreakIndexForField(t)}async getClassBreakInfo(t,e){let r=e;!this.valueExpression||e!=null&&e.arcade!=null||(r={...r,arcade:await E_()});const i=this.getBreakIndex(t,r);return i!==-1?this.classBreakInfos[i]:null}getSymbol(t,e){if(this.valueExpression&&(e==null||e.arcade==null))return void Q.getLogger(this).error("#getSymbol()","Please use getSymbolAsync if valueExpression is used");const r=this.getBreakIndex(t,e);return r>-1?this.classBreakInfos[r].symbol:this.defaultSymbol}async getSymbolAsync(t,e){let r=e;if(this.valueExpression&&(e==null||e.arcade==null)){const s=await E_(),{arcadeUtils:n}=s;n.hasGeometryOperations(this.valueExpression)&&await n.enableGeometryOperations(),r={...r,arcade:s}}const i=this.getBreakIndex(t,r);return i>-1?this.classBreakInfos[i].symbol:this.defaultSymbol}getSymbols(){const t=[];return this.classBreakInfos.forEach(e=>{e.symbol&&t.push(e.symbol)}),this.defaultSymbol&&t.push(this.defaultSymbol),t}getAttributeHash(){return this.visualVariables&&this.visualVariables.reduce((t,e)=>t+e.getAttributeHash(),"")}getMeshHash(){const t=JSON.stringify(this.backgroundFillSymbol),e=JSON.stringify(this.defaultSymbol),r=`${this.normalizationField}.${this.normalizationType}.${this.normalizationTotal}`;return`${t}.${e}.${this.classBreakInfos.reduce((i,s)=>i+s.getMeshHash(),"")}.${r}.${this.field}.${this.valueExpression}`}get arcadeRequired(){return this.arcadeRequiredForVisualVariables||!!this.valueExpression}clone(){return new OB({field:this.field,backgroundFillSymbol:this.backgroundFillSymbol&&this.backgroundFillSymbol.clone(),defaultLabel:this.defaultLabel,defaultSymbol:this.defaultSymbol&&this.defaultSymbol.clone(),valueExpression:this.valueExpression,valueExpressionTitle:this.valueExpressionTitle,classBreakInfos:K(this.classBreakInfos),isMaxInclusive:this.isMaxInclusive,normalizationField:this.normalizationField,normalizationTotal:this.normalizationTotal,normalizationType:this.normalizationType,visualVariables:K(this.visualVariables),legendOptions:K(this.legendOptions),authoringInfo:this.authoringInfo&&this.authoringInfo.clone()})}async collectRequiredFields(t,e){const r=[this.collectVVRequiredFields(t,e),this.collectSymbolFields(t,e)];await Promise.all(r)}async collectSymbolFields(t,e){const r=[...this.getSymbols().map(i=>i.collectRequiredFields(t,e)),Cl(t,e,this.valueExpression)];au(t,e,this.field),au(t,e,this.normalizationField),await Promise.all(r)}_getBreakIndexForExpression(t,e){const{viewingMode:r,scale:i,spatialReference:s,arcade:n}=e??{},{valueExpression:o}=this;let a=this._compiledValueExpression.valueExpression===o?this._compiledValueExpression.compiledFunction:null;const l=n.arcadeUtils;if(!a){const h=l.createSyntaxTree(o);a=l.createFunction(h),this._compiledValueExpression.compiledFunction=a}this._compiledValueExpression.valueExpression=o;const c=l.executeFunction(a,l.createExecContext(t,l.getViewInfo({viewingMode:r,scale:i,spatialReference:s})));return this._getBreakIndexfromInfos(c)}_getBreakIndexForField(t){const e=this.field,r=t.attributes,i=this.normalizationType;let s=parseFloat(r[e]);if(i){const n=this.normalizationTotal,o=parseFloat(this.normalizationField?r[this.normalizationField]:void 0);if(i===Wye)s=Math.log(s)*Math.LOG10E;else if(i!==vL||n==null||isNaN(n)){if(i===bL&&!isNaN(o)){if(isNaN(s)||isNaN(o))return-1;s/=o}}else s=s/n*100}return this._getBreakIndexfromInfos(s)}_getBreakIndexfromInfos(t){const e=this.isMaxInclusive;if(t!=null&&typeof t=="number"&&!isNaN(t))for(let r=0;r<this.classBreakInfos.length;r++){const i=[this.classBreakInfos[r].minValue,this.classBreakInfos[r].maxValue];if(i[0]<=t&&(e?t<=i[1]:t<i[1]))return r}return-1}_areClassBreaksConsecutive(){const t=this.classBreakInfos,e=t.length;for(let r=1;r<e;r++)if(t[r-1].maxValue!==t[r].minValue)return!1;return!0}};u([d(qye)],Nn.prototype,"backgroundFillSymbol",void 0),u([d({type:[AN]})],Nn.prototype,"classBreakInfos",void 0),u([Ee("classBreakInfos")],Nn.prototype,"readClassBreakInfos",null),u([Fe("classBreakInfos")],Nn.prototype,"writeClassBreakInfos",null),u([d({type:String,json:{write:!0}})],Nn.prototype,"defaultLabel",void 0),u([d(aE)],Nn.prototype,"defaultSymbol",void 0),u([d({type:String,json:{write:!0}})],Nn.prototype,"field",void 0),u([yr("field")],Nn.prototype,"castField",null),u([d({type:Boolean})],Nn.prototype,"isMaxInclusive",void 0),u([d({type:CS,json:{write:!0}})],Nn.prototype,"legendOptions",void 0),u([d({type:Number,readOnly:!0,value:null,json:{read:!1,write:{overridePolicy(){return this.classBreakInfos.length!==0&&this._areClassBreaksConsecutive()?{enabled:!0}:{enabled:!1}}}}})],Nn.prototype,"minValue",null),u([d({type:String,json:{write:!0}})],Nn.prototype,"normalizationField",void 0),u([d({type:Number,cast:t=>sh(t),json:{write:!0}})],Nn.prototype,"normalizationTotal",void 0),u([d({type:ZP.apiValues,value:null,json:{type:ZP.jsonValues,read:ZP.read,write:ZP.write}})],Nn.prototype,"normalizationType",null),u([tt({classBreaks:"class-breaks"})],Nn.prototype,"type",void 0),u([d({type:String,json:{write:!0}})],Nn.prototype,"valueExpression",void 0),u([d({type:String,json:{write:!0}})],Nn.prototype,"valueExpressionTitle",void 0),Nn=OB=u([R("esri.renderers.ClassBreaksRenderer")],Nn);const Zye=Nn,wL=-3;var ng;(function(t){t[t.ALL=0]="ALL",t[t.SOME=1]="SOME"})(ng||(ng={}));let q8e=class{constructor(e,r,i){this.name=e,this._storage=r,this.id=W8e+++":",this.size=0,this.maxSize=0,this._removeFunc=!1,this._hit=0,this._miss=0,this._storage.register(this),i&&(this._storage.registerRemoveFunc(this.id,i),this._removeFunc=!0)}destroy(){this._storage.clear(this),this._removeFunc&&this._storage.deregisterRemoveFunc(this.id),this._storage.deregister(this),this._storage=null}get hitRate(){return this._hit/(this._hit+this._miss)}get sizeAll(){return this._storage.size}resetHitRate(){this._hit=this._miss=0}put(e,r,i,s=0){this._storage.put(this,e,r,i,s)}get(e){const r=this._storage.get(this,e);return r===void 0?++this._miss:++this._hit,r}pop(e){const r=this._storage.pop(this,e);return r===void 0?++this._miss:++this._hit,r}updateSize(e,r,i){this._storage.updateSize(this,e,r,i)}clear(){this._storage.clear(this)}clearAll(){this._storage.clearAll()}get performanceInfo(){return this._storage.performanceInfo}resetStats(){this._storage.resetStats()}},Xye=class{get size(){return this._size}constructor(e=10485760){this._maxSize=e,this._db=new Map,this._size=0,this._hit=0,this._miss=0,this._removeFuncs=new kt,this._users=new kt}destroy(){this.clearAll(),this._removeFuncs.clear(),this._users.clear(),this._db=null}register(e){this._users.push(e)}deregister(e){this._users.removeUnordered(e)}registerRemoveFunc(e,r){this._removeFuncs.push([e,r])}deregisterRemoveFunc(e){this._removeFuncs.filterInPlace(r=>r[0]!==e)}get maxSize(){return this._maxSize}set maxSize(e){this._maxSize=Math.max(e,0),this._checkSizeLimits()}put(e,r,i,s,n){r=e.id+r;const o=this._db.get(r);if(o&&(this._size-=o.size,e.size-=o.size,this._db.delete(r),o.entry!==i&&this._notifyRemove(r,o.entry,ng.ALL)),s>this._maxSize)return void this._notifyRemove(r,i,ng.ALL);if(i===void 0)return void console.warn("Refusing to cache undefined entry ");if(!s||s<0)return void console.warn("Refusing to cache entry with invalid size "+s);const a=1+Math.max(n,wL)-wL;this._db.set(r,{entry:i,size:s,lifetime:a,lives:a}),this._size+=s,e.size+=s,this._checkSizeLimits()}updateSize(e,r,i,s){r=e.id+r;const n=this._db.get(r);if(n&&n.entry===i){for(this._size-=n.size,e.size-=n.size;s>this._maxSize;){const o=this._notifyRemove(r,i,ng.SOME);if(!(o!=null&&o>0))return void this._db.delete(r);s=o}n.size=s,this._size+=s,e.size+=s,this._checkSizeLimits()}}pop(e,r){r=e.id+r;const i=this._db.get(r);if(i)return this._size-=i.size,e.size-=i.size,this._db.delete(r),++this._hit,i.entry;++this._miss}get(e,r){r=e.id+r;const i=this._db.get(r);if(i!==void 0)return this._db.delete(r),i.lives=i.lifetime,this._db.set(r,i),++this._hit,i.entry;++this._miss}get performanceInfo(){const e={Size:Math.round(this._size/1048576)+"/"+Math.round(this._maxSize/1048576)+"MB","Hit rate":Math.round(100*this._getHitRate())+"%",Entries:this._db.size.toString()},r={},i=new Array;this._db.forEach((o,a)=>{const l=o.lifetime;i[l]=(i[l]||0)+o.size,this._users.forAll(c=>{const{id:h,name:p}=c;if(a.startsWith(h)){const f=r[p]||0;r[p]=f+o.size}})});const s={};this._users.forAll(o=>{const a=o.name;if("hitRate"in o&&typeof o.hitRate=="number"&&!isNaN(o.hitRate)&&o.hitRate>0){const l=r[a]||0;r[a]=l,s[a]=Math.round(100*o.hitRate)+"%"}else s[a]="0%"});const n=Object.keys(r);n.sort((o,a)=>r[a]-r[o]),n.forEach(o=>e[o]=Math.round(r[o]/2**20)+"MB / "+s[o]);for(let o=i.length-1;o>=0;--o){const a=i[o];a&&(e["Priority "+(o+wL-1)]=Math.round(a/this._size*100)+"%")}return e}resetStats(){this._hit=this._miss=0,this._users.forAll(e=>e.resetHitRate())}clear(e){const r=e.id;this._db.forEach((i,s)=>{s.startsWith(r)&&(this._size-=i.size,this._db.delete(s),this._notifyRemove(s,i.entry,ng.ALL))}),e.size=0}clearAll(){this._db.forEach((e,r)=>this._notifyRemove(r,e.entry,ng.ALL)),this._users.forEach(e=>e.size=0),this._size=0,this._db.clear()}_getHitRate(){return this._hit/(this._hit+this._miss)}_notifyRemove(e,r,i){let s;return this._removeFuncs.some(n=>{if(e.startsWith(n[0])){const o=n[1](r,i);return typeof o=="number"&&(s=o),!0}return!1}),s}_checkSizeLimits(){if(this._size>this._maxSize){for(const[e,r]of this._db)if(this._purgeItem(e,r),this._size<=.9*this.maxSize)return}this._users.forEach(e=>{if(e.maxSize>0&&e.size>e.maxSize){for(const[r,i]of this._db)if(r.startsWith(e.id)&&(this._purgeItem(r,i,e),e.size<=.9*e.maxSize))return}})}_purgeItem(e,r,i=this._users.find(s=>e.startsWith(s.id))){if(this._db.delete(e),r.lives<=1){this._size-=r.size,i&&(i.size-=r.size);const s=this._notifyRemove(e,r.entry,ng.SOME);s!=null&&s>0&&(this._size+=s,i&&(i.size+=s),r.lives=r.lifetime,r.size=s,this._db.set(e,r))}else--r.lives,this._db.set(e,r)}},W8e=0,Yye=class{constructor(e,r){this._storage=new Xye,this.id="",this.name="",this.size=0,this._storage.maxSize=e,this._storage.register(this),r&&this._storage.registerRemoveFunc("",r)}destroy(){this._storage.deregister(this),this._storage.destroy()}put(e,r,i=1){this._storage.put(this,e,r,i,1)}pop(e){return this._storage.pop(this,e)}get(e){return this._storage.get(this,e)}clear(){this._storage.clearAll()}get maxSize(){return this._storage.maxSize}set maxSize(e){this._storage.maxSize=e}resetHitRate(){}},tw=class{constructor(e,r,i=""){this.major=e,this.minor=r,this._context=i}lessThan(e,r){return this.major<e||e===this.major&&this.minor<r}since(e,r){return!this.lessThan(e,r)}validate(e){if(this.major!==e.major){const r=this._context&&this._context+":",i=this._context&&this._context+" ";throw new F(r+"unsupported-version",`Required major ${i}version is '${this.major}', but got '\${version.major}.\${version.minor}'`,{version:e})}}clone(){return new tw(this.major,this.minor,this._context)}static parse(e,r=""){const[i,s]=e.split("."),n=/^\s*\d+\s*$/;if(!i||!i.match||!n.test(i))throw new F((r&&r+":")+"invalid-version","Expected major version to be a number, but got '${version}'",{version:e});if(!s||!s.match||!n.test(s))throw new F((r&&r+":")+"invalid-version","Expected minor version to be a number, but got '${version}'",{version:e});const o=parseInt(i,10),a=parseInt(s,10);return new tw(o,a,r)}};function Z8e(t){return t.type==="date"||t.type==="esriFieldTypeDate"||t.type==="date-only"||t.type==="esriFieldTypeDateOnly"||t.type==="timestamp-offset"||t.type==="esriFieldTypeTimestampOffset"}function See(t){return t.type==="oid"||t.type==="esriFieldTypeOID"}function Eee(t){return t.type==="global-id"||t.type==="esriFieldTypeGlobalID"}let aZ=class{constructor(e=[]){if(this.fields=[],this._fieldsMap=new Map,this._normalizedFieldsMap=new Map,this._dateFieldsSet=new Set,this._numericFieldsSet=new Set,this.dateFields=[],this.numericFields=[],this._requiredFields=null,!e)return;this.fields=e;const r=[];for(const i of e){const s=i?.name,n=Aee(i?.name);if(s&&n){const o=Cee(s);this._fieldsMap.set(s,i),this._fieldsMap.set(o,i),this._normalizedFieldsMap.set(n,i),r.push(o),Z8e(i)?(this.dateFields.push(i),this._dateFieldsSet.add(i)):$F(i)&&(this._numericFieldsSet.add(i),this.numericFields.push(i)),See(i)||Eee(i)||(i.editable=i.editable==null||!!i.editable,i.nullable=i.nullable==null||!!i.nullable)}}r.sort(),this.uid=r.join(",")}destroy(){this._fieldsMap.clear()}get requiredFields(){if(!this._requiredFields){this._requiredFields=[];for(const e of this.fields)See(e)||Eee(e)||e.nullable||WNe(e)!==void 0||this._requiredFields.push(e)}return this._requiredFields}has(e){return this.get(e)!=null}get(e){if(!e)return;let r=this._fieldsMap.get(e);return r||(r=this._fieldsMap.get(Cee(e))??this._normalizedFieldsMap.get(Aee(e)),r&&this._fieldsMap.set(e,r),r)}isDateField(e){return this._dateFieldsSet.has(this.get(e))}isNumericField(e){return this._numericFieldsSet.has(this.get(e))}normalizeFieldName(e){const r=this.get(e);if(r)return r.name??void 0}};function Cee(t){return t.trim().toLowerCase()}function Aee(t){return RNe(t)?.toLowerCase()??""}const Oee="esri.renderers.support.DictionaryLoader",X8e={type:"CIMSimpleLineCallout",lineSymbol:{type:"CIMLineSymbol",symbolLayers:[{type:"CIMSolidStroke",width:.5,color:[0,0,0,255]}]}};let lZ=class{constructor(e,r,i){this.config=null,this.fieldMap=null,this.url=null,this._ongoingRequests=new Map,this._symbolCache=new Yye(100),this._dictionaryVersion=null,this._fieldIndex=null,this._dictionaryPromise=null,this.url=e,this.config=r,this.fieldMap=i}getSymbolFields(){return this._symbolFields}async getSymbolAsync(e,r){let i;this._dictionaryPromise||(this._dictionaryPromise=this.fetchResources(r));try{i=await this._dictionaryPromise}catch(y){if(ms(y))return this._dictionaryPromise=null,null}const s=this._dictionaryVersion&&this._dictionaryVersion.since(4,0),n={};if(this.fieldMap)for(const y of this._symbolFields){const _=this._getFieldName(this.fieldMap[y]);n[y]=_?s?e.attributes[_]:""+e.attributes[_]:""}let o=null;try{o=i?.(n,r)}catch{return null}if(!o||typeof o!="string")return null;const a=vq(o).toString(),l=this._symbolCache.get(a);if(l)return l.catch(()=>{this._symbolCache.pop(a)}),l;const c=o.split(";"),h=[],p=[];for(const y of c)if(y)if(y.includes("po:")){const _=y.substr(3).split("|");if(_.length===3){const v=_[0],w=_[1];let x=_[2];if(w==="DashTemplate")x=x.split(" ").map(T=>Number(T));else if(w==="Color"){const T=new ze(x).toRgba();x=[T[0],T[1],T[2],255*T[3]]}else x=Number(x);p.push({primitiveName:v,propertyName:w,value:x})}}else if(y.includes("|")){for(const _ of y.split("|"))if(this._itemNames.has(_)){h.push(_);break}}else this._itemNames.has(y)&&h.push(y);const f=e.geometry==null||!e.geometry.hasZ&&e.geometry.type==="point",m=this._cimPartsToCIMSymbol(h,p,f,r);return this._symbolCache.put(a,m,1),m}async fetchResources(e){if(this._dictionaryPromise)return this._dictionaryPromise;if(!this.url)return void Q.getLogger(Oee).error("no valid URL!");const r=qt(this.url+"/resources/styles/dictionary-info.json",{responseType:"json",query:{f:"json"},signal:e!=null?e.signal:null}),[{data:i}]=await Promise.all([r,E_()]);if(!i)throw this._dictionaryPromise=null,new F("esri.renderers.DictionaryRenderer","Bad dictionary data!");const{authoringInfo:s,dictionary_version:n,expression:o,itemsNames:a}=i,l=o;let c=!1;n&&(this._dictionaryVersion=tw.parse(n),c=this._dictionaryVersion.since(4,0)),this._refSymbolUrlTemplate=this.url+"/"+i.cimRefTemplateUrl,this._itemNames=new Set(a),this._symbolFields=s.symbol;const h={};if(this.config){const m=this.config;for(const y in m)h[y]=m[y]}if(s.configuration)for(const m of s.configuration)h.hasOwnProperty(m.name)||(h[m.name]=m.value);const p=[];if(e!=null&&e.fields&&this.fieldMap)for(const m of this._symbolFields){const y=this.fieldMap[m],_=e.fields.filter(v=>v.name.toLowerCase()===y?.toLowerCase());_.length>0&&p.push({..._[0],type:c?_[0].type:"esriFieldTypeString"})}p.length>0&&(this._fieldIndex=new aZ(p));const f=CNe(l,e!=null?e.spatialReference:null,p,h).then(m=>{const y={scale:0};return(_,v)=>{if(m==null)return null;const w=m.repurposeFeature({geometry:null,attributes:_});return y.scale=v!=null?v.scale??void 0:void 0,m.evaluate({$feature:w,$view:y},m.services)}}).catch(m=>(Q.getLogger(Oee).error("Creating dictinoary expression failed:",m),null));return this._dictionaryPromise=f,f}async _cimPartsToCIMSymbol(e,r,i,s){const n=new Array(e.length);for(let l=0;l<e.length;l++)n[l]=this._getSymbolPart(e[l],s);const o=await Promise.all(n),a=this.fieldMap;if(a)for(const l of o)Jye(l,a);return new tE({data:this._combineSymbolParts(o,r,i)})}async _getSymbolPart(e,r){if(this._ongoingRequests.has(e))return this._ongoingRequests.get(e).then(n=>n.data);const i=this._refSymbolUrlTemplate.replaceAll(/\{itemName\}/gi,e),s=qt(i,{responseType:"json",query:{f:"json"},...r});this._ongoingRequests.set(e,s);try{return(await s).data}catch(n){throw this._ongoingRequests.delete(e),n}}_combineSymbolParts(e,r,i){if(!e||e.length===0)return null;const s={...e[0]};if(e.length>1){s.symbolLayers=[];for(const n of e){const o=n;s.symbolLayers.unshift(...o.symbolLayers)}}return i&&(s.callout=X8e),{type:"CIMSymbolReference",symbol:s,primitiveOverrides:r}}_getFieldName(e){if(this._fieldIndex!==null){const r=this._fieldIndex.get(e);return r?r.name:e}return e}};function Jye(t,e){if(!t)return;const r=t.symbolLayers;if(!r)return;let i=r.length;for(;i--;){const s=r[i];s&&s.enable!==!1&&s.type==="CIMVectorMarker"&&Y8e(s,e)}}function Y8e(t,e){const r=t.markerGraphics;if(r)for(const i of r){if(!i)continue;const s=i.symbol;if(s)switch(s.type){case"CIMPointSymbol":case"CIMLineSymbol":case"CIMPolygonSymbol":Jye(s,e);break;case"CIMTextSymbol":s.fieldMap=e}}}const YEt=Object.freeze(Object.defineProperty({__proto__:null,DictionaryLoader:lZ},Symbol.toStringTag,{value:"Module"}));var RB;let dd=RB=class extends oE(Zg){constructor(t){super(t),this.config=null,this.fieldMap=null,this.scaleExpression=null,this.scaleExpressionTitle=null,this.url=null,this.type="dictionary"}get _loader(){return new lZ(this.url,this.config,this.fieldMap)}writeData(t,e){t&&(e.scalingExpressionInfo={expression:t,returnType:"number"})}writeVisualVariables(t,e,r,i){i?.origin||super.writeVisualVariables(t,e,r,i)}clone(){return new RB({config:K(this.config),scaleExpression:this.scaleExpression,scaleExpressionTitle:this.scaleExpressionTitle,fieldMap:K(this.fieldMap),url:K(this.url),visualVariables:K(this.visualVariables)})}async getSymbolAsync(t,e){return this._loader.getSymbolAsync(t,e)}async collectRequiredFields(t,e){await this.collectVVRequiredFields(t,e),this.scaleExpression&&await Cl(t,e,this.scaleExpression);for(const r in this.fieldMap){const i=this.fieldMap[r];e.has(i)&&t.add(i)}}get arcadeRequired(){return!0}getSymbol(){return null}getSymbols(){return[]}getAttributeHash(){return this.visualVariables&&this.visualVariables.reduce((t,e)=>t+e.getAttributeHash(),"")}getMeshHash(){return`${this.url}-${JSON.stringify(this.fieldMap)}`}getSymbolFields(){return this._loader.getSymbolFields()}};u([d({type:lZ})],dd.prototype,"_loader",null),u([d({type:Object,json:{read:{source:"configuration"},write:{target:"configuration"}}})],dd.prototype,"config",void 0),u([d({type:Object,json:{write:!0}})],dd.prototype,"fieldMap",void 0),u([d({type:String,json:{read:{source:"scalingExpressionInfo.expression"},write:!0}})],dd.prototype,"scaleExpression",void 0),u([Fe("scaleExpression")],dd.prototype,"writeData",null),u([d({type:String,json:{read:{source:"scalingExpressionInfo.title"},write:{target:"scalingExpressionInfo.title",overridePolicy(t){return{enabled:!!t&&!!this.scaleExpression}}}}})],dd.prototype,"scaleExpressionTitle",void 0),u([d({type:String,json:{write:!0}})],dd.prototype,"url",void 0),u([Fe("visualVariables")],dd.prototype,"writeVisualVariables",null),dd=RB=u([R("esri.renderers.DictionaryRenderer")],dd);const J8e=dd;var PB;let Dm=PB=class extends de{constructor(t){super(t),this.color=null,this.field=null,this.label=null,this.valueExpression=null,this.valueExpressionTitle=null}castField(t){return t==null?t:typeof t=="function"?(Q.getLogger(this).error(".field: field must be a string value"),null):CR(t)}getAttributeHash(){return`${this.field}-${this.valueExpression}`}clone(){return new PB({color:this.color&&this.color.clone(),field:this.field,label:this.label,valueExpression:this.valueExpression,valueExpressionTitle:this.valueExpressionTitle})}};u([d({type:ze,json:{type:[Number],write:!0}})],Dm.prototype,"color",void 0),u([d({type:String,json:{write:!0}})],Dm.prototype,"field",void 0),u([yr("field")],Dm.prototype,"castField",null),u([d({type:String,json:{write:!0}})],Dm.prototype,"label",void 0),u([d({type:String,json:{write:!0}})],Dm.prototype,"valueExpression",void 0),u([d({type:String,json:{write:!0}})],Dm.prototype,"valueExpressionTitle",void 0),Dm=PB=u([R("esri.renderers.support.AttributeColorInfo")],Dm);const Qye=Dm;var MB;let xL=MB=class extends de{constructor(){super(...arguments),this.unit=null}clone(){return new MB({unit:this.unit})}};u([d({type:String,json:{write:!0}})],xL.prototype,"unit",void 0),xL=MB=u([R("esri.renderers.support.DotDensityLegendOptions")],xL);const Q8e=xL;var IB;let Gl=IB=class extends oE(Zg){constructor(t){super(t),this.attributes=null,this.backgroundColor=new ze([0,0,0,0]),this.dotBlendingEnabled=!0,this.dotShape="square",this.dotSize=1,this.legendOptions=null,this.outline=new wu,this.dotValue=null,this.referenceScale=null,this.seed=1,this.type="dot-density"}calculateDotValue(t){if(this.referenceScale==null)return this.dotValue;const e=t/this.referenceScale*this.dotValue;return e<1?1:e}getSymbol(){return new X_({outline:this.outline})}async getSymbolAsync(){return this.getSymbol()}getSymbols(){return[this.getSymbol()]}getAttributeHash(){return this.attributes?.reduce((t,e)=>t+e.getAttributeHash(),"")??""}getMeshHash(){return JSON.stringify(this.outline)}clone(){return new IB({attributes:K(this.attributes),backgroundColor:K(this.backgroundColor),dotBlendingEnabled:K(this.dotBlendingEnabled),dotShape:K(this.dotShape),dotSize:K(this.dotSize),dotValue:K(this.dotValue),legendOptions:K(this.legendOptions),outline:K(this.outline),referenceScale:K(this.referenceScale),visualVariables:K(this.visualVariables),authoringInfo:this.authoringInfo&&this.authoringInfo.clone()})}getControllerHash(){return`${this.attributes?.map(e=>e.field||e.valueExpression||"")}-${this.outline&&JSON.stringify(this.outline.toJSON())||""}`}async collectRequiredFields(t,e){await this.collectVVRequiredFields(t,e);for(const r of this.attributes??[])r.valueExpression&&await Cl(t,e,r.valueExpression),r.field&&t.add(r.field)}};u([d({type:[Qye],json:{write:!0}})],Gl.prototype,"attributes",void 0),u([d({type:ze,json:{write:!0}})],Gl.prototype,"backgroundColor",void 0),u([d({type:Boolean,json:{write:!0}})],Gl.prototype,"dotBlendingEnabled",void 0),u([d({type:String,json:{write:!1}})],Gl.prototype,"dotShape",void 0),u([d({type:Number,json:{write:!0}})],Gl.prototype,"dotSize",void 0),u([d({type:Q8e,json:{write:!0}})],Gl.prototype,"legendOptions",void 0),u([d({type:wu,json:{default:null,write:!0}})],Gl.prototype,"outline",void 0),u([d({type:Number,json:{write:!0}})],Gl.prototype,"dotValue",void 0),u([d({type:Number,json:{write:!0}})],Gl.prototype,"referenceScale",void 0),u([d({type:Number,json:{write:!0}})],Gl.prototype,"seed",void 0),u([tt({dotDensity:"dot-density"})],Gl.prototype,"type",void 0),Gl=IB=u([R("esri.renderers.DotDensityRenderer")],Gl);const K8e=Gl;var $B;let gA=$B=class extends de{constructor(t){super(t),this.color=null,this.ratio=null}clone(){return new $B({color:this.color,ratio:this.ratio})}};u([d({type:ze,json:{type:[Xi],default:null,write:!0}})],gA.prototype,"color",void 0),u([d({type:Number,json:{write:!0}})],gA.prototype,"ratio",void 0),gA=$B=u([R("esri.renderers.support.HeatmapColorStop")],gA);const TL=gA;let vT=class extends Vi(de){constructor(){super(...arguments),this.minLabel=null,this.maxLabel=null,this.title=null}};u([d({type:String,json:{write:!0}})],vT.prototype,"minLabel",void 0),u([d({type:String,json:{write:!0}})],vT.prototype,"maxLabel",void 0),u([d({type:String,json:{write:!0}})],vT.prototype,"title",void 0),vT=u([R("esri.renderers.support.HeatmapLegendOptions")],vT);function Wt(){return[0,0,0,0]}function VR(t){return[t[0],t[1],t[2],t[3]]}function Lt(t,e,r,i){return[t,e,r,i]}function cZ(t){const e=Wt(),r=Math.min(4,t.length);for(let i=0;i<r;++i)e[i]=t[i];return e}function Kye(t,e){return new Float64Array(t,e,4)}function e0e(){return Wt()}function t0e(){return Lt(1,1,1,1)}function r0e(){return Lt(1,0,0,0)}function i0e(){return Lt(0,1,0,0)}function s0e(){return Lt(0,0,1,0)}function n0e(){return Lt(0,0,0,1)}const Of=e0e(),dh=t0e(),e9e=r0e(),t9e=i0e(),r9e=s0e(),i9e=n0e();Object.freeze(Object.defineProperty({__proto__:null,ONES:dh,UNIT_W:i9e,UNIT_X:e9e,UNIT_Y:t9e,UNIT_Z:r9e,ZEROS:Of,clone:VR,create:Wt,createView:Kye,fromArray:cZ,fromValues:Lt,ones:t0e,unitW:n0e,unitX:r0e,unitY:i0e,unitZ:s0e,zeros:e0e},Symbol.toStringTag,{value:"Module"}));const uZ=2.4;function s9e(t){return fu(t*uZ)}function n9e(t){return Ms(t)/uZ}function o9e(t,e,r,i){let{color:s,ratio:n}=e,{color:o,ratio:a}=r;a===n&&(a===1?n-=1e-6:a+=1e-6);const l=ge((i-n)/(a-n),0,1);OF(t,s.toArray(),o.toArray(),l)}function QEt(t){const r=new Uint8ClampedArray(2048);if(t=t.filter(({ratio:a})=>a>=0&&a<=1).sort((a,l)=>a.ratio-l.ratio).map(({color:a,ratio:l})=>({color:a,ratio:Math.max(l,.001)})),t.length<1)return r;let i=t[0],s=t[0],n=1;const o=Wt();for(let a=0;a<512;a++){const l=(a+.5)/512;for(;l>s.ratio&&n<t.length;)i=s,s=t[n++];o9e(o,i,s,l),r.set(o,4*a)}return r}function KEt(t,e,r,i){const{radius:s,fieldOffset:n,field:o}=e,a=Math.round(Ms(s)),l=new Float64Array(r*i);let c,h=Number.NEGATIVE_INFINITY;const p=l9e(o,n),f=new Set;for(const m of t){const y=m.getCursor();for(;y.next();){const _=y.getObjectId();if(f.has(_))continue;f.add(_);const v=y.readLegacyPointGeometry(),w=128;if(v.x<-w||v.x>=r+w||v.y<-w||v.y>i+w)continue;const x=+p(y),T=Math.max(0,Math.round(v.x)-a),S=Math.max(0,Math.round(v.y)-a),O=Math.min(i,Math.round(v.y)+a),A=Math.min(r,Math.round(v.x)+a);for(let I=S;I<O;I++)for(let M=T;M<A;M++){const k=I*r+M,L=a9e(v.x-M,v.y-I,a);c=l[k]+=L*x,c>h&&(h=c)}}}return{matrix:l.buffer,max:h}}function a9e(t,e,r){const i=Math.sqrt(t**2+e**2)/r;return i>1?0:3/(Math.PI*r**2)*(1-i**2)**2}function eCt(t,e){return typeof t=="function"?t:t?typeof e=="string"?r=>-1*+r[t]:r=>+r[t]+e:()=>1}function l9e(t,e){return t!=null?typeof e=="string"?r=>-1*+r.readAttribute(t):r=>+r.readAttribute(t)+e:r=>1}var LB;const o0e="esri.renderers.HeatmapRenderer",c9e=Q.getLogger(o0e);function Ree(t){if(t!=null){const{maxDensity:e,minDensity:r,radius:i}=t;if(e!=null||r!=null||i!=null){const{blurRadius:s,maxPixelIntensity:n,minPixelIntensity:o,...a}=t;return a}}return t}let ao=LB=class extends Zg{constructor(t){super(t),this.authoringInfo=null,this.colorStops=[new TL({ratio:0,color:new ze("rgba(255, 140, 0, 0)")}),new TL({ratio:.75,color:new ze("rgba(255, 140, 0, 1)")}),new TL({ratio:.9,color:new ze("rgba(255, 0,   0, 1)")})],this.field=null,this.fieldOffset=0,this.legendOptions=null,this.maxDensity=.04,this.minDensity=0,this.radius=18,this.referenceScale=0,this.type="heatmap",this.valueExpression=null,this.valueExpressionTitle=null,this._warnedProps={blurRadius:!1,maxPixelIntensity:!1,minPixelIntensity:!1}}normalizeCtorArgs(t){return Ree(t)}get blurRadius(){return n9e(this.radius)}set blurRadius(t){const e=this.maxPixelIntensity,r=this.minPixelIntensity;this._set("radius",s9e(t)),this._warnAboutDeprecatedGaussianBlurProp("blurRadius","radius"),this._set("maxDensity",e*this._pixelIntensityToDensity),this._set("minDensity",r*this._pixelIntensityToDensity)}get maxPixelIntensity(){return this.maxDensity/this._pixelIntensityToDensity}set maxPixelIntensity(t){this._set("maxDensity",t*this._pixelIntensityToDensity),this._warnAboutDeprecatedGaussianBlurProp("maxPixelIntensity","maxDensity")}get minPixelIntensity(){return this.minDensity/this._pixelIntensityToDensity}set minPixelIntensity(t){this._set("minDensity",t*this._pixelIntensityToDensity),this._warnAboutDeprecatedGaussianBlurProp("minPixelIntensity","minDensity")}get _pixelIntensityToDensity(){return 24/(uZ**2*this.blurRadius**4)}_warnAboutDeprecatedGaussianBlurProp(t,e){this._warnedProps[t]||ua(this).getDefaultOrigin()==="user"&&(this._warnedProps[t]=!0,J2(()=>{jd(c9e,t,{replacement:`${String(e)} (suggested value: ${this._get(e)})`,version:"4.24"})}))}read(t,e){t=Ree(t),super.read(t,e)}getSymbol(){return new Wg}async getSymbolAsync(){return this.getSymbol()}getSymbols(){return[this.getSymbol()]}async collectRequiredFields(t,e){const r=this.field,i=this.valueExpression;r&&typeof r=="string"&&await au(t,e,r),i&&typeof i=="string"&&await Cl(t,e,i)}getAttributeHash(){return null}getMeshHash(){return`${JSON.stringify(this.colorStops)}.${this.blurRadius}.${this.field}`}clone(){return new LB({authoringInfo:this.authoringInfo&&this.authoringInfo.clone(),colorStops:K(this.colorStops),field:this.field,legendOptions:K(this.legendOptions),maxDensity:this.maxDensity,minDensity:this.minDensity,radius:this.radius,referenceScale:this.referenceScale,valueExpression:this.valueExpression,valueExpressionTitle:this.valueExpressionTitle})}};u([d({type:sZ,json:{write:!0,origins:{"web-scene":{write:!1,read:!1}}}})],ao.prototype,"authoringInfo",void 0),u([d({type:Number,json:{origins:{"portal-item":{write:!0},"web-map":{write:!0}}}})],ao.prototype,"blurRadius",null),u([d({type:[TL],json:{write:!0}})],ao.prototype,"colorStops",void 0),u([d({type:String,json:{write:!0}})],ao.prototype,"field",void 0),u([d({type:Number,json:{write:{overridePolicy:(t,e,r)=>({enabled:r==null})},origins:{"web-scene":{write:!1}}}})],ao.prototype,"fieldOffset",void 0),u([d({type:vT,json:{write:!0}})],ao.prototype,"legendOptions",void 0),u([d({type:Number,json:{write:!0}})],ao.prototype,"maxDensity",void 0),u([d({type:Number,json:{origins:{"portal-item":{write:!0},"web-map":{write:!0}}}})],ao.prototype,"maxPixelIntensity",null),u([d({type:Number,json:{write:!0}})],ao.prototype,"minDensity",void 0),u([d({type:Number,json:{origins:{"portal-item":{write:!0},"web-map":{write:!0}}}})],ao.prototype,"minPixelIntensity",null),u([d({type:Number,cast:Jr,json:{write:!0}})],ao.prototype,"radius",void 0),u([d({type:Number,range:{min:0},json:{default:0,write:!0}})],ao.prototype,"referenceScale",void 0),u([tt({heatmap:"heatmap"})],ao.prototype,"type",void 0),u([d({type:String,json:{write:!0,origins:{"web-document":{write:!1},"portal-item":{write:!1}}}})],ao.prototype,"valueExpression",void 0),u([d({type:String})],ao.prototype,"valueExpressionTitle",void 0),u([d({readOnly:!0})],ao.prototype,"_pixelIntensityToDensity",null),ao=LB=u([R(o0e)],ao);const a0e=ao;let Y1=class extends Vi(de){constructor(){super(...arguments),this.color=new ze([0,0,0,0]),this.label=null,this.threshold=0}};u([d({type:ze,json:{write:!0}})],Y1.prototype,"color",void 0),u([d({type:String,json:{write:!0}})],Y1.prototype,"label",void 0),u([d({type:Number,range:{min:0,max:1},json:{write:!0}})],Y1.prototype,"threshold",void 0),Y1=u([R("esri.renderers.support.OthersCategory")],Y1);let SL=class extends Vi(de){constructor(){super(...arguments),this.title=null}};u([d({type:String,json:{write:!0}})],SL.prototype,"title",void 0),SL=u([R("esri.renderers.support.PieChartLegendOptions")],SL);let Fc=class extends oE(Vi(Zg)){constructor(e){super(e),this.attributes=null,this.backgroundFillSymbol=null,this.defaultColor=new ze([0,0,0,0]),this.defaultLabel=null,this.holePercentage=0,this.othersCategory=new Y1,this.legendOptions=null,this.outline=null,this.size=12,this.type="pie-chart"}getSymbol(){return new Wg({size:this.size?this.size/2+(this.outline?.width||0):0})}async getSymbolAsync(){return this.getSymbol()}getSymbols(){return[this.getSymbol(),this.backgroundFillSymbol].filter(xw)}getAttributeHash(){return this.visualVariables&&this.visualVariables.reduce((e,r)=>e+r.getAttributeHash(),"")}getMeshHash(){return this.getSymbols().reduce((e,r)=>e+JSON.stringify(r),"")}async collectRequiredFields(e,r){await this.collectVVRequiredFields(e,r);for(const i of this.attributes)i.valueExpression&&await Cl(e,r,i.valueExpression),i.field&&e.add(i.field)}};u([d({type:[Qye],json:{write:!0}})],Fc.prototype,"attributes",void 0),u([d({type:X_,json:{default:null,write:!0}})],Fc.prototype,"backgroundFillSymbol",void 0),u([d({type:ze,json:{write:!0}})],Fc.prototype,"defaultColor",void 0),u([d({type:String,json:{write:!0}})],Fc.prototype,"defaultLabel",void 0),u([d({type:Number,range:{min:0,max:1},json:{write:!0}})],Fc.prototype,"holePercentage",void 0),u([d({type:Y1,json:{write:!0}})],Fc.prototype,"othersCategory",void 0),u([d({type:SL,json:{write:!0}})],Fc.prototype,"legendOptions",void 0),u([d({type:wu,json:{default:null,write:!0}})],Fc.prototype,"outline",void 0),u([d({type:Number,cast:Jr,json:{write:!0}})],Fc.prototype,"size",void 0),u([tt({pieChart:"pie-chart"})],Fc.prototype,"type",void 0),Fc=u([R("esri.renderers.PieChartRenderer")],Fc);const u9e=Fc;var DB;let g1=DB=class extends oE(Zg){constructor(t){super(t),this.description=null,this.label=null,this.symbol=null,this.type="simple"}async collectRequiredFields(t,e){await Promise.all([this.collectSymbolFields(t,e),this.collectVVRequiredFields(t,e)])}async collectSymbolFields(t,e){await Promise.all(this.getSymbols().map(r=>r.collectRequiredFields(t,e)))}getSymbol(t,e){return this.symbol}async getSymbolAsync(t,e){return this.symbol}getSymbols(){return this.symbol?[this.symbol]:[]}getAttributeHash(){return this.visualVariables&&this.visualVariables.reduce((t,e)=>t+e.getAttributeHash(),"")}getMeshHash(){return this.getSymbols().reduce((t,e)=>t+JSON.stringify(e),"")}get arcadeRequired(){return this.arcadeRequiredForVisualVariables}clone(){return new DB({description:this.description,label:this.label,symbol:this.symbol&&this.symbol.clone(),visualVariables:K(this.visualVariables),authoringInfo:this.authoringInfo&&this.authoringInfo.clone()})}};u([d({type:String,json:{write:!0}})],g1.prototype,"description",void 0),u([d({type:String,json:{write:!0}})],g1.prototype,"label",void 0),u([d(aE)],g1.prototype,"symbol",void 0),u([tt({simple:"simple"})],g1.prototype,"type",void 0),g1=DB=u([R("esri.renderers.SimpleRenderer")],g1);const i5=g1,h9e=["esri.Color","esri.portal.Portal","esri.symbols.support.Symbol3DAnchorPosition2D","esri.symbols.support.Symbol3DAnchorPosition3D"];function NB(t){return t instanceof Te}function Pee(t){return t instanceof Pt?Object.keys(t.items):NB(t)?ua(t).keys():t?Object.keys(t):[]}function XP(t,e){return t instanceof Pt?t.items[e]:t[e]}function d9e(t,e){return!(!Array.isArray(t)||!Array.isArray(e))&&t.length!==e.length}function O3(t){return t?t.declaredClass:null}function l0e(t,e){const r=t.diff;if(r&&typeof r=="function")return r(t,e);const i=Pee(t),s=Pee(e);if(i.length===0&&s.length===0)return;if(!i.length||!s.length||d9e(t,e))return{type:"complete",oldValue:t,newValue:e};const n=s.filter(p=>!i.includes(p)),o=i.filter(p=>!s.includes(p)),a=i.filter(p=>s.includes(p)&&XP(t,p)!==XP(e,p)).concat(n,o).sort(),l=O3(t);if(l&&h9e.includes(l)&&a.length)return{type:"complete",oldValue:t,newValue:e};let c;const h=NB(t)&&NB(e);for(const p of a){const f=XP(t,p),m=XP(e,p);let y;if((h||typeof f!="function"&&typeof m!="function")&&f!==m&&(f!=null||m!=null)){if(r&&r[p]&&typeof r[p]=="function")y=r[p]?.(f,m);else if(f instanceof Date&&m instanceof Date){if(f.getTime()===m.getTime())continue;y={type:"complete",oldValue:f,newValue:m}}else y=typeof f=="object"&&typeof m=="object"&&O3(f)===O3(m)?l0e(f,m):{type:"complete",oldValue:f,newValue:m};y!=null&&(c!=null?c.diff[p]=y:c={type:"partial",diff:{[p]:y}})}}return c}function p9e(t,e){if(t==null)return!1;const r=e.split(".");let i=t;for(const s of r){if(i.type==="complete")return!0;if(i.type!=="partial")return!1;{const n=i.diff[s];if(!n)return!1;i=n}}return!0}function sCt(t,e){for(const r of e)if(p9e(t,r))return!0;return!1}function f9e(t,e){if(typeof t!="function"&&typeof e!="function"&&(t!=null||e!=null))return t==null||e==null||typeof t=="object"&&typeof e=="object"&&O3(t)!==O3(e)?{type:"complete",oldValue:t,newValue:e}:l0e(t,e)}function YP(t){if(t==null)return!0;switch(t.type){case"complete":return!1;case"collection":{const e=t;for(const r of e.added)if(!YP(r))return!1;for(const r of e.removed)if(!YP(r))return!1;for(const r of e.changed)if(!YP(r))return!1;return!0}case"partial":for(const e in t.diff)if(!YP(t.diff[e]))return!1;return!0}}let bT=class extends Vi(de){constructor(e){super(e),this.value=null,this.value2=null,this.value3=null}};u([d(_L)],bT.prototype,"value",void 0),u([d(_L)],bT.prototype,"value2",void 0),u([d(_L)],bT.prototype,"value3",void 0),bT=u([R("esri.renderers.support.UniqueValue")],bT);const AS=bT;let n0=class extends Vi(de){constructor(e){super(e),this.description=null,this.label=null,this.symbol=null,this.values=null}castValues(e){if(e==null)return null;const r=typeof(e=Array.isArray(e)?e:[e])[0];return r==="string"||r==="number"?e.map(i=>new AS({value:i})):r==="object"?e[0]instanceof AS?e:e.map(i=>new AS(i)):null}};u([d({type:String,json:{write:!0}})],n0.prototype,"description",void 0),u([d({type:String,json:{write:!0}})],n0.prototype,"label",void 0),u([d(aE)],n0.prototype,"symbol",void 0),u([d({type:[AS],json:{type:[[String]],read:{reader:t=>t?t.map(e=>new AS({value:e[0],value2:e[1],value3:e[2]})):null},write:{writer:(t,e)=>{const r=[];for(const i of t){const s=[i.value,i.value2,i.value3].filter(xw).map(n=>n.toString());r.push(s)}e.values=r}}}})],n0.prototype,"values",void 0),u([yr("values")],n0.prototype,"castValues",null),n0=u([R("esri.renderers.support.UniqueValueClass")],n0);const c0e=n0;let yA=class extends Vi(de){constructor(e){super(e),this.heading=null,this.classes=null}};u([d({type:String,json:{write:!0}})],yA.prototype,"heading",void 0),u([d({type:[c0e],json:{write:!0}})],yA.prototype,"classes",void 0),yA=u([R("esri.renderers.support.UniqueValueGroup")],yA);const FB=yA;var UB;let y1=UB=class extends de{constructor(t){super(t),this.description=null,this.label=null,this.symbol=null,this.value=null}clone(){return new UB({value:this.value,description:this.description,label:this.label,symbol:this.symbol?this.symbol.clone():null})}getMeshHash(){const t=JSON.stringify(this.symbol&&this.symbol.toJSON());return`${this.value}.${t}`}};u([d({type:String,json:{write:!0}})],y1.prototype,"description",void 0),u([d({type:String,json:{write:!0}})],y1.prototype,"label",void 0),u([d(aE)],y1.prototype,"symbol",void 0),u([d(_L)],y1.prototype,"value",void 0),y1=UB=u([R("esri.renderers.support.UniqueValueInfo")],y1);const R3=y1,m9e=()=>!!oe("enable-feature:force-wosr"),lCt=()=>!!oe("enable-feature:direct-3d-object-feature-layer-display"),g9e=()=>oe.add("enable-feature:direct-3d-object-feature-layer-display",!0,!0,!0),y9e=()=>oe.add("enable-feature:direct-3d-object-feature-layer-display",!1,!0,!0),cCt=()=>!!oe("enable-i3s-patching"),_9e=()=>oe.add("enable-i3s-patching",!0,!0,!0),v9e=()=>oe.add("enable-i3s-patching",!1,!0,!0),Mee=()=>!!oe("enable-feature:SceneLayer-editing"),b9e=(t="i3s-patching")=>{switch(v9e(),y9e(),oe.add("enable-feature:SceneLayer-editing",!0,!0,!0),t){case"feature-layer-view":g9e();break;case"i3s-patching":_9e()}};b9e("i3s-patching");let vU={};async function w9e(t,e){try{return{data:(await dZ(t,e)).data,baseUrl:Mq(t),styleUrl:t}}catch(r){return Lo(r),null}}function x9e(t,e,r){const i=e.portal!=null?e.portal:Qn.getDefault();let s;const n=`${i.url} - ${i.user&&i.user.username} - ${t}`;return vU[n]||(vU[n]=T9e(t,i,r).then(o=>(s=o,o.fetchData())).then(o=>({data:o,baseUrl:s.itemUrl??"",styleName:t}))),vU[n]}function T9e(t,e,r){return e.load(r).then(()=>{const i=new mf({disableExtraQuery:!0,query:`owner:${Iee} AND type:${$ee} AND typekeywords:"${t}"`});return e.queryItems(i,r)}).then(({results:i})=>{let s=null;const n=t.toLowerCase();if(i&&Array.isArray(i)){for(const o of i)if(o.typeKeywords?.some(l=>l.toLowerCase()===n)&&o.type===$ee&&o.owner===Iee){s=o;break}}if(!s)throw new F("symbolstyleutils:style-not-found",`The style '${t}' could not be found`,{styleName:t});return s.load(r)})}function hZ(t,e,r){return t&&t.styleUrl!=null?w9e(t.styleUrl,r):t&&t.styleName!=null?x9e(t.styleName,e,r):Promise.reject(new F("symbolstyleutils:style-url-and-name-missing","Either styleUrl or styleName is required to resolve a style"))}function u0e(t){return t===null||t.type==="CIMSymbolReference"?t:{type:"CIMSymbolReference",symbol:t}}function h0e(t,e,r=["gltf"]){if(e==="cimRef")return t.cimRef;if(t.formatInfos&&!m9e())for(const i of r){const s=t.formatInfos.find(n=>n.type===i);if(s)return s.href}return t.webRef}function dZ(t,e){const r={responseType:"json",query:{f:"json"},...e};return qt(vh(t),r)}const Iee="esri_en",$ee="Style",S9e="https://cdn.arcgis.com/sharing/rest/content/items/220936cc6ed342c9937abd8f180e7d1e/resources/styles/cim/{SymbolName}.json?f=json";var _A;const d0e="esri.renderers.UniqueValueRenderer",vy=Q.getLogger(d0e),Lee="uvInfos-watcher",Dee="uvGroups-watcher",E9e=",",C9e=Zs(R3);function A9e(t){const{field1:e,field2:r,field3:i,fieldDelimiter:s,uniqueValueInfos:n,valueExpression:o}=t,a=!(!e||!r);return[{classes:(n??[]).map(l=>{const{symbol:c,label:h,value:p,description:f}=l,[m,y,_]=a?p?.toString()?.split(s||"")||[]:[p],v=[];return(e||o)&&v.push(m),r&&v.push(y),i&&v.push(_),{symbol:c,label:h,values:[v],description:f}})}]}let vs=_A=class extends oE(Zg){constructor(t){super(t),this._valueInfoMap={},this._isDefaultSymbolDerived=!1,this._isInfosSource=null,this.type="unique-value",this.backgroundFillSymbol=null,this.orderByClassesEnabled=!1,this.valueExpressionTitle=null,this.legendOptions=null,this.defaultLabel=null,this.portal=null,this.styleOrigin=null,this.diff={uniqueValueInfos(e,r){if(!e&&!r)return;if(!e||!r)return{type:"complete",oldValue:e,newValue:r};let i=!1;const s={type:"collection",added:[],removed:[],changed:[],unchanged:[]};for(let n=0;n<r.length;n++){const o=e.find(a=>a.value===r[n].value);o?f9e(o,r[n])?(s.changed.push({type:"complete",oldValue:o,newValue:r[n]}),i=!0):s.unchanged.push({oldValue:o,newValue:r[n]}):(s.added.push(r[n]),i=!0)}for(let n=0;n<e.length;n++)r.find(o=>o.value===e[n].value)||(s.removed.push(e[n]),i=!0);return i?s:void 0}},this._set("uniqueValueInfos",[]),this._set("uniqueValueGroups",[])}get _cache(){return{compiledFunc:null}}set field(t){this._set("field",t),this._updateFieldDelimiter(),this._updateUniqueValues()}castField(t){return t==null||typeof t=="function"?t:CR(t)}writeField(t,e,r,i){typeof t=="string"?e[r]=t:i&&i.messages?i.messages.push(new F("property:unsupported","UniqueValueRenderer.field set to a function cannot be written to JSON")):vy.error(".field: cannot write field to JSON since it's not a string value")}set field2(t){this._set("field2",t),this._updateFieldDelimiter(),this._updateUniqueValues()}set field3(t){this._set("field3",t),this._updateUniqueValues()}set valueExpression(t){this._set("valueExpression",t),this._updateUniqueValues()}set defaultSymbol(t){this._isDefaultSymbolDerived=!1,this._set("defaultSymbol",t)}set fieldDelimiter(t){this._set("fieldDelimiter",t),this._updateUniqueValues()}readPortal(t,e,r){return r.portal||Qn.getDefault()}readStyleOrigin(t,e,r){if(e.styleName)return Object.freeze({styleName:e.styleName});if(e.styleUrl){const i=Dg(e.styleUrl,r);return Object.freeze({styleUrl:i})}}writeStyleOrigin(t,e,r,i){t.styleName?e.styleName=t.styleName:t.styleUrl&&(e.styleUrl=Ng(t.styleUrl,i))}set uniqueValueGroups(t){this.styleOrigin?vy.error("#uniqueValueGroups=","Cannot modify unique value groups of a UniqueValueRenderer created from a web style"):(this._set("uniqueValueGroups",t),this._updateInfosFromGroups(),this._isInfosSource=!1,this._watchUniqueValueGroups())}set uniqueValueInfos(t){this.styleOrigin?vy.error("#uniqueValueInfos=","Cannot modify unique value infos of a UniqueValueRenderer created from a web style"):(this._set("uniqueValueInfos",t),this._updateValueInfoMap(),this._updateGroupsFromInfos(),this._isInfosSource=!0,this._watchUniqueValueInfos())}addUniqueValueInfo(t,e){if(this.styleOrigin)return void vy.error("#addUniqueValueInfo()","Cannot modify unique value infos of a UniqueValueRenderer created from a web style");let r;r=typeof t=="object"?C9e(t):new R3({value:t,symbol:dye(e)}),this.uniqueValueInfos?.push(r),this._valueInfoMap[r.value]=r,this._updateGroupsFromInfos(),this._isInfosSource=!0,this._watchUniqueValueInfos()}removeUniqueValueInfo(t){if(this.styleOrigin)return void vy.error("#removeUniqueValueInfo()","Cannot modify unique value infos of a UniqueValueRenderer created from a web style");const e=this.uniqueValueInfos;if(e){for(let r=0;r<e.length;r++)if(e[r].value===t+""){delete this._valueInfoMap[t],e.splice(r,1);break}}this._updateGroupsFromInfos(),this._isInfosSource=!0,this._watchUniqueValueInfos()}async getUniqueValueInfo(t,e){let r=e;return!this.valueExpression||e!=null&&e.arcade!=null||(r={...r,arcade:await E_()}),this._getUniqueValueInfo(t,r)}getSymbol(t,e){if(this.valueExpression&&(e==null||e.arcade==null))return void vy.error("#getSymbol()","Please use getSymbolAsync if valueExpression is used");const r=this._getUniqueValueInfo(t,e);return r&&r.symbol||this.defaultSymbol}async getSymbolAsync(t,e){let r=e;if(this.valueExpression&&(r==null||r.arcade==null)){const s=await E_(),{arcadeUtils:n}=s;n.hasGeometryOperations(this.valueExpression)&&await n.enableGeometryOperations(),r={...r,arcade:s}}const i=this._getUniqueValueInfo(t,r);return i&&i.symbol||this.defaultSymbol}getSymbols(){const t=[];for(const e of this.uniqueValueInfos??[])e.symbol&&t.push(e.symbol);return this.defaultSymbol&&t.push(this.defaultSymbol),t}getAttributeHash(){return this.visualVariables&&this.visualVariables.reduce((t,e)=>t+e.getAttributeHash(),"")}getMeshHash(){const t=JSON.stringify(this.backgroundFillSymbol),e=JSON.stringify(this.defaultSymbol),r=this.uniqueValueInfos?.reduce((i,s)=>i+s.getMeshHash(),"");return`${t}.${e}.${r}.${`${this.field}.${this.field2}.${this.field3}.${this.fieldDelimiter}`}.${this.valueExpression}`}clone(){const t=new _A({field:this.field,field2:this.field2,field3:this.field3,defaultLabel:this.defaultLabel,defaultSymbol:K(this.defaultSymbol),orderByClassesEnabled:this.orderByClassesEnabled,valueExpression:this.valueExpression,valueExpressionTitle:this.valueExpressionTitle,fieldDelimiter:this.fieldDelimiter,visualVariables:K(this.visualVariables),legendOptions:K(this.legendOptions),authoringInfo:this.authoringInfo&&this.authoringInfo.clone(),backgroundFillSymbol:K(this.backgroundFillSymbol)});this._isDefaultSymbolDerived&&(t._isDefaultSymbolDerived=!0),t._set("portal",this.portal);const e=K(this.uniqueValueInfos),r=K(this.uniqueValueGroups);return this.styleOrigin&&(t._set("styleOrigin",Object.freeze(K(this.styleOrigin))),Object.freeze(e),Object.freeze(r)),t._set("uniqueValueInfos",e),t._updateValueInfoMap(),t._set("uniqueValueGroups",r),t._isInfosSource=this._isInfosSource,t._watchUniqueValueInfosAndGroups(),t}get arcadeRequired(){return this.arcadeRequiredForVisualVariables||!!this.valueExpression}async collectRequiredFields(t,e){const r=[this.collectVVRequiredFields(t,e),this.collectSymbolFields(t,e)];await Promise.all(r)}async collectSymbolFields(t,e){const r=[...this.getSymbols().map(i=>i.collectRequiredFields(t,e)),Cl(t,e,this.valueExpression)];au(t,e,this.field),au(t,e,this.field2),au(t,e,this.field3),await Promise.all(r)}populateFromStyle(){return hZ(this.styleOrigin,{portal:this.portal}).then(t=>{const e=[];return this._valueInfoMap={},t&&t.data&&Array.isArray(t.data.items)&&t.data.items.forEach(r=>{const i=new Mw({styleUrl:t.styleUrl,styleName:t.styleName,portal:this.portal,name:r.name});this.defaultSymbol||r.name!==t.data.defaultItem||(this.defaultSymbol=i,this._isDefaultSymbolDerived=!0);const s=new R3({value:r.name,symbol:i});e.push(s),this._valueInfoMap[r.name]=s}),this._set("uniqueValueInfos",Object.freeze(e)),this._updateGroupsFromInfos(!0),this._isInfosSource=null,this._watchUniqueValueInfos(),!this.defaultSymbol&&this.uniqueValueInfos?.length&&(this.defaultSymbol=this.uniqueValueInfos[0].symbol,this._isDefaultSymbolDerived=!0),this})}_updateFieldDelimiter(){this.field&&this.field2&&!this.fieldDelimiter&&this._set("fieldDelimiter",E9e)}_updateUniqueValues(){this._isInfosSource!=null&&(this._isInfosSource?this._updateGroupsFromInfos():this._updateInfosFromGroups())}_updateValueInfoMap(){this._valueInfoMap={};const{uniqueValueInfos:t}=this;if(t)for(const e of t)this._valueInfoMap[e.value+""]=e}_watchUniqueValueInfosAndGroups(){this._watchUniqueValueInfos(),this._watchUniqueValueGroups()}_watchUniqueValueInfos(){this.removeHandles(Lee);const{uniqueValueInfos:t}=this;if(t){const e=[];for(const r of t)e.push(le(()=>({symbol:r.symbol,value:r.value,label:r.label,description:r.description}),(i,s)=>{i!==s&&(this._updateGroupsFromInfos(),this._isInfosSource=!0)},{sync:!0}));this.addHandles(e,Lee)}}_watchUniqueValueGroups(){this.removeHandles(Dee);const{uniqueValueGroups:t}=this;if(t){const e=[];for(const r of t){e.push(le(()=>({classes:r.classes}),(i,s)=>{i!==s&&(this._updateInfosFromGroups(),this._isInfosSource=!1)},{sync:!0}));for(const i of r.classes??[])e.push(le(()=>({symbol:i.symbol,values:i.values,label:i.label,description:i.description}),(s,n)=>{s!==n&&(this._updateInfosFromGroups(),this._isInfosSource=!1)},{sync:!0}))}this.addHandles(e,Dee)}}_updateInfosFromGroups(){if(!this.uniqueValueGroups)return this._set("uniqueValueInfos",null),this._updateValueInfoMap(),void this._watchUniqueValueInfos();const t=[],{field:e,field2:r,field3:i,fieldDelimiter:s,uniqueValueGroups:n,valueExpression:o}=this;if(!e&&!o)return this._set("uniqueValueInfos",t),this._updateValueInfoMap(),void this._watchUniqueValueInfos();const a=!(!e||!r);for(const l of n)for(const c of l.classes??[]){const{symbol:h,label:p,values:f,description:m}=c;for(const y of f??[]){const{value:_,value2:v,value3:w}=y,x=[_];r&&x.push(v),i&&x.push(w);const T=a?x.join(s||""):x[0];t.push(new R3({symbol:h,label:p,value:T,description:m}))}}this._set("uniqueValueInfos",t),this._updateValueInfoMap(),this._watchUniqueValueInfos()}_updateGroupsFromInfos(t=!1){if(!this.uniqueValueInfos)return this._set("uniqueValueGroups",null),void this._watchUniqueValueGroups();const{field:e,field2:r,valueExpression:i,fieldDelimiter:s,uniqueValueInfos:n}=this;if(!e&&!i||!n.length)return this._set("uniqueValueGroups",[]),void this._watchUniqueValueGroups();const o=!(!e||!r),a=n.map(c=>{const{symbol:h,label:p,value:f,description:m}=c,[y,_,v]=o?f?.toString()?.split(s||"")||[]:[f];return new c0e({symbol:h,label:p,description:m,values:[new AS({value:y,value2:_,value3:v})]})}),l=[new FB({classes:a})];t&&Object.freeze(l),this._set("uniqueValueGroups",l),this._watchUniqueValueGroups()}_getUniqueValueInfo(t,e){return this.valueExpression?this._getUnqiueValueInfoForExpression(t,e):this._getUnqiueValueInfoForFields(t)}_getUnqiueValueInfoForExpression(t,e){const{viewingMode:r,scale:i,spatialReference:s,arcade:n}=e??{};let o=this._cache.compiledFunc;const a=n.arcadeUtils;if(!o){const c=a.createSyntaxTree(this.valueExpression);o=a.createFunction(c),this._cache.compiledFunc=o}const l=a.executeFunction(o,a.createExecContext(t,a.getViewInfo({viewingMode:r,scale:i,spatialReference:s})));return this._valueInfoMap[l+""]}_getUnqiueValueInfoForFields(t){const e=this.field,r=t.attributes;let i;if(typeof e!="function"&&this.field2){const s=this.field2,n=this.field3,o=[];e&&o.push(r[e]),s&&o.push(r[s]),n&&o.push(r[n]),i=o.join(this.fieldDelimiter||"")}else typeof e=="function"?i=e(t):e&&(i=r[e]);return this._valueInfoMap[i+""]}static fromPortalStyle(t,e){const r=new _A(e&&e.properties);r._set("styleOrigin",Object.freeze({styleName:t})),r._set("portal",e&&e.portal||Qn.getDefault());const i=r.populateFromStyle();return i.catch(s=>{vy.error(`#fromPortalStyle('${t}'[, ...])`,"Failed to create unique value renderer from style name",s)}),i}static fromStyleUrl(t,e){const r=new _A(e&&e.properties);r._set("styleOrigin",Object.freeze({styleUrl:t}));const i=r.populateFromStyle();return i.catch(s=>{vy.error(`#fromStyleUrl('${t}'[, ...])`,"Failed to create unique value renderer from style URL",s)}),i}};u([d({readOnly:!0})],vs.prototype,"_cache",null),u([tt({uniqueValue:"unique-value"})],vs.prototype,"type",void 0),u([d(qye)],vs.prototype,"backgroundFillSymbol",void 0),u([d({value:null,json:{type:String,read:{source:"field1"},write:{target:"field1"}}})],vs.prototype,"field",null),u([yr("field")],vs.prototype,"castField",null),u([Fe("field")],vs.prototype,"writeField",null),u([d({type:String,value:null,json:{write:!0}})],vs.prototype,"field2",null),u([d({type:String,value:null,json:{write:!0}})],vs.prototype,"field3",null),u([d({type:Boolean,json:{name:"drawInClassOrder",default:!1,write:!0,origins:{"web-scene":{write:!1}}}})],vs.prototype,"orderByClassesEnabled",void 0),u([d({type:String,value:null,json:{write:!0}})],vs.prototype,"valueExpression",null),u([d({type:String,json:{write:!0}})],vs.prototype,"valueExpressionTitle",void 0),u([d({type:CS,json:{write:!0}})],vs.prototype,"legendOptions",void 0),u([d({type:String,json:{write:!0}})],vs.prototype,"defaultLabel",void 0),u([d(bhe({...aE},{json:{write:{overridePolicy(){return{enabled:!this._isDefaultSymbolDerived}}},origins:{"web-scene":{write:{overridePolicy(){return{enabled:!this._isDefaultSymbolDerived}}}}}}}))],vs.prototype,"defaultSymbol",null),u([d({type:String,value:null,json:{write:!0}})],vs.prototype,"fieldDelimiter",null),u([d({type:Qn,readOnly:!0})],vs.prototype,"portal",void 0),u([Ee("portal",["styleName"])],vs.prototype,"readPortal",null),u([d({readOnly:!0,json:{write:{enabled:!1,overridePolicy:()=>({enabled:!0})}}})],vs.prototype,"styleOrigin",void 0),u([Ee("styleOrigin",["styleName","styleUrl"])],vs.prototype,"readStyleOrigin",null),u([Fe("styleOrigin",{styleName:{type:String},styleUrl:{type:String}})],vs.prototype,"writeStyleOrigin",null),u([d({type:[FB],json:{read:{source:["uniqueValueGroups","uniqueValueInfos"],reader:(t,e,r)=>(e.uniqueValueGroups||A9e(e)).map(i=>FB.fromJSON(i,r))},write:{overridePolicy(){return this.styleOrigin?{enabled:!1}:{enabled:!0}}}}})],vs.prototype,"uniqueValueGroups",null),u([d({type:[R3],json:{read:!1,write:{overridePolicy(){return this.styleOrigin?{enabled:!1}:{enabled:!0}}}}})],vs.prototype,"uniqueValueInfos",null),vs=_A=u([R(d0e)],vs);const pZ=vs,s5={key:"type",base:Zg,typeMap:{heatmap:a0e,simple:i5,"unique-value":pZ,"class-breaks":Zye,"dot-density":K8e,dictionary:J8e,"pie-chart":u9e},errorContext:"renderer"},p0e={key:"type",base:Zg,typeMap:{simple:i5,"unique-value":pZ,"class-breaks":Zye,heatmap:a0e},errorContext:"renderer"};function uCt(t,e){return $O(t,null,e)}const O9e=Q2({types:s5});function $O(t,e,r){return t?t&&(t.styleName||t.styleUrl)&&t.type!=="uniqueValue"?(r&&r.messages&&r.messages.push(new Sh("renderer:unsupported","Only UniqueValueRenderer can be referenced from a web style, but found '"+t.type+"'",{definition:t,context:r})),null):O9e(t,e,r):null}let R9e=class f0e{constructor(){this._propertyOriginMap=new Map,this._originStores=new Array(rV),this._values=new Map,this.multipleOriginsSupported=!0}clone(e){const r=new f0e,i=this._originStores[pr.DEFAULTS];i&&i.forEach((s,n)=>{r.set(n,K(s),pr.DEFAULTS)});for(let s=pr.SERVICE;s<rV;s++){const n=this._originStores[s];n&&n.forEach((o,a)=>{e&&e.has(a)||r.set(a,K(o),s)})}return r}get(e,r){const i=r===void 0?this._values:this._originStores[r];return i?i.get(e):void 0}keys(e){const r=e==null?this._values:this._originStores[e];return r?[...r.keys()]:[]}set(e,r,i=pr.USER){let s=this._originStores[i];if(s||(s=new Map,this._originStores[i]=s),s.set(e,r),!this._values.has(e)||this._propertyOriginMap.get(e)<=i){const n=this._values.get(e);return this._values.set(e,r),this._propertyOriginMap.set(e,i),n!==r}return!1}delete(e,r=pr.USER){const i=this._originStores[r];if(!i)return;const s=i.get(e);if(i.delete(e),this._values.has(e)&&this._propertyOriginMap.get(e)===r){this._values.delete(e);for(let n=r-1;n>=0;n--){const o=this._originStores[n];if(o&&o.has(e)){this._values.set(e,o.get(e)),this._propertyOriginMap.set(e,n);break}}}return s}has(e,r){const i=r===void 0?this._values:this._originStores[r];return!!i&&i.has(e)}revert(e,r){for(;r>0&&!this.has(e,r);)--r;const i=this._originStores[r],s=i&&i.get(e),n=this._values.get(e);return this._values.set(e,s),this._propertyOriginMap.set(e,r),n!==s}originOf(e){return this._propertyOriginMap.get(e)||pr.DEFAULTS}forEach(e){this._values.forEach(e)}};const m0e=t=>{let e=class extends t{constructor(...r){super(...r);const i=ua(this),s=i.store,n=new R9e;i.store=n,Bpe(i,s,n)}read(r,i){jpe(this,r,i)}getAtOrigin(r,i){const s=bU(this),n=dg(i);if(typeof r=="string")return s.get(r,n);const o={};return r.forEach(a=>{o[a]=s.get(a,n)}),o}originOf(r){return VD(this.originIdOf(r))}originIdOf(r){return bU(this).originOf(r)}revert(r,i){const s=bU(this),n=dg(i),o=ua(this);let a;a=typeof r=="string"?r==="*"?s.keys(n):[r]:r,a.forEach(l=>{o.invalidate(l),s.revert(l,n),o.commit(l)})}};return e=u([R("esri.core.ReadOnlyMultiOriginJSONSupport")],e),e};function bU(t){return ua(t).store}let Nee=class extends m0e(Te){};Nee=u([R("esri.core.ReadOnlyMultiOriginJSONSupport")],Nee);const P9e=t=>{let e=class extends t{constructor(...r){super(...r)}clear(r,i="user"){return wU(this).delete(r,dg(i))}write(r,i){return qpe(this,r=r||{},i),r}setAtOrigin(r,i,s){ua(this).setAtOrigin(r,i,dg(s))}removeOrigin(r){const i=wU(this),s=dg(r),n=i.keys(s);for(const o of n)i.originOf(o)===s&&i.set(o,i.get(o,s),pr.USER)}updateOrigin(r,i){const s=wU(this),n=dg(i),o=this.get(r);for(let a=n+1;a<rV;++a)s.delete(r,a);s.set(r,o,n)}toJSON(r){return this.write({},r)}};return e=u([R("esri.core.WriteableMultiOriginJSONSupport")],e),e.prototype.toJSON.isDefaultToJSON=!0,e};function wU(t){return ua(t).store}const fZ=t=>{let e=class extends P9e(m0e(t)){constructor(...r){super(...r)}};return e=u([R("esri.core.MultiOriginJSONSupport")],e),e};let Fee=class extends fZ(Te){};Fee=u([R("esri.core.MultiOriginJSONSupport")],Fee);async function M9e(t,e){const{WhereClause:r}=await ae(()=>import("./WhereClause-ae8c5a06.js").then(i=>i.W),["./WhereClause-ae8c5a06.js","./executionError-e8d36121.js"],import.meta.url);return r.create(t,e)}function I9e(t,e){return t!=null?e!=null?`(${t}) AND (${e})`:t:e}async function $9e(t){const e="portalItem"in t?t:{portalItem:t},{fromItem:r}=await ae(()=>import("./portalLayers-f0dc6cde.js"),["./portalLayers-f0dc6cde.js","./lazyLayerLoader-e6afee2b.js","./layersLoader-85ab12d6.js","./fetchService-c1f8267d.js","./jsonContext-b0a6edd6.js"],import.meta.url);try{return await r(e)}catch(i){const s=e&&e.portalItem,n=s&&s.id||"unset",o=s&&s.portal&&s.portal.url||Ur.portalUrl;throw Q.getLogger("esri.layers.support.fromPortalItem").error("#fromPortalItem()","Failed to create layer from portal item (portal: '"+o+"', id: '"+n+"')",i),i}}let L9e=0,lo=class extends os.EventedMixin(DW(Fg)){constructor(){super(...arguments),this.attributionDataUrl=null,this.fullExtent=new _r(-180,-90,180,90,je.WGS84),this.id=Date.now().toString(16)+"-layer-"+L9e++,this.legendEnabled=!0,this.listMode="show",this.opacity=1,this.parent=null,this.popupEnabled=!0,this.attributionVisible=!0,this.spatialReference=je.WGS84,this.title=null,this.type=null,this.url=null,this.visible=!0}static async fromArcGISServerUrl(e){const r=typeof e=="string"?{url:e}:e;return(await ae(()=>import("./arcgisLayers-78bde0ab.js"),["./arcgisLayers-78bde0ab.js","./fetchService-c1f8267d.js","./lazyLayerLoader-e6afee2b.js"],import.meta.url)).fromUrl(r)}static fromPortalItem(e){return $9e(e)}initialize(){this.when().catch(e=>{ms(e)||Q.getLogger(this).error("#load()",`Failed to load layer (title: '${this.title??"no title"}', id: '${this.id??"no id"}')`,{error:e})})}destroy(){if(this.parent){const e=this,r=this.parent;"layers"in r&&r.layers.includes(e)?r.layers.remove(e):"tables"in r&&r.tables.includes(e)?r.tables.remove(e):"baseLayers"in r&&r.baseLayers.includes(e)?r.baseLayers.remove(e):"baseLayers"in r&&r.referenceLayers.includes(e)&&r.referenceLayers.remove(e)}}get hasAttributionData(){return this.attributionDataUrl!=null}get parsedUrl(){return cn(this.url)}async fetchAttributionData(){const e=this.attributionDataUrl;if(this.hasAttributionData&&e)return(await qt(e,{query:{f:"json"},responseType:"json"})).data;throw new F("layer:no-attribution-data","Layer does not have attribution data")}};u([d({type:String})],lo.prototype,"attributionDataUrl",void 0),u([d({type:_r})],lo.prototype,"fullExtent",void 0),u([d({readOnly:!0})],lo.prototype,"hasAttributionData",null),u([d({type:String,clonable:!1})],lo.prototype,"id",void 0),u([d({type:Boolean,nonNullable:!0})],lo.prototype,"legendEnabled",void 0),u([d({type:["show","hide","hide-children"]})],lo.prototype,"listMode",void 0),u([d({type:Number,range:{min:0,max:1},nonNullable:!0})],lo.prototype,"opacity",void 0),u([d({clonable:!1})],lo.prototype,"parent",void 0),u([d({readOnly:!0})],lo.prototype,"parsedUrl",null),u([d({type:Boolean})],lo.prototype,"popupEnabled",void 0),u([d({type:Boolean})],lo.prototype,"attributionVisible",void 0),u([d({type:je})],lo.prototype,"spatialReference",void 0),u([d({type:String})],lo.prototype,"title",void 0),u([d({readOnly:!0,json:{read:!1}})],lo.prototype,"type",void 0),u([d()],lo.prototype,"url",void 0),u([d({type:Boolean,nonNullable:!0})],lo.prototype,"visible",void 0),lo=u([R("esri.layers.Layer")],lo);const mZ=lo;let kB=class{constructor(e=r=>r.values().next().value){this._peeker=e,this._observable=new zF,this._items=new Set}get length(){return Ht(this._observable),this._items.size}clear(){this.length!==0&&(this._items.clear(),this._observable.notify())}last(){if(this.length===0)return;let e;for(e of this._items);return e}peek(){if(this.length!==0)return this._peeker(this._items)}push(e){this.contains(e)||(this._items.add(e),this._observable.notify())}contains(e){return Ht(this._observable),this._items.has(e)}pop(){if(this.length===0)return;const e=this.peek();return this._items.delete(e),this._observable.notify(),e}popLast(){if(this.length===0)return;const e=this.last();return this._items.delete(e),this._observable.notify(),e}remove(e){this.contains(e)&&(this._items.delete(e),this._observable.notify())}filter(e){const r=this.length;return this._items.forEach(i=>{e(i)||this._items.delete(i)}),r!==this._items.size&&this._observable.notify(),this}*[Symbol.iterator](){Ht(this._observable),yield*this._items}};const D9e={statsWorker:()=>ae(()=>import("./statsWorker-c4acdf4b.js"),["./statsWorker-c4acdf4b.js","./utils-a3586684.js","./generateRendererUtils-0f364d1e.js"],import.meta.url),geometryEngineWorker:()=>ae(()=>import("./geometryEngineWorker-92957f4f.js"),["./geometryEngineWorker-92957f4f.js","./geometryEngineJSON-2c998778.js","./geometryEngineBase-d69ff1ad.js","./json-48e3ea08.js"],import.meta.url),CSVSourceWorker:()=>ae(()=>import("./CSVSourceWorker-362928fd.js"),["./CSVSourceWorker-362928fd.js","./json-48e3ea08.js","./FeatureStore-48143fe8.js","./BoundsStore-d475102f.js","./PooledRBush-506b9510.js","./quickselect-d16016af.js","./optimizedFeatureQueryEngineAdapter-f5f88773.js","./centroid-3dcadaf5.js","./QueryEngine-360bd3bb.js","./normalizeUtils-996b11fe.js","./normalizeUtilsCommon-4aa2ad72.js","./WhereClause-ae8c5a06.js","./executionError-e8d36121.js","./QueryEngineCapabilities-42e44ded.js","./utils-a3586684.js","./generateRendererUtils-0f364d1e.js","./number-2aff8d5a.js","./clientSideDefaults-8aeb911a.js"],import.meta.url),EdgeProcessingWorker:()=>ae(()=>import("./EdgeProcessingWorker-1e5c1006.js"),[],import.meta.url),ElevationSamplerWorker:()=>ae(()=>import("./ElevationSamplerWorker-64fb18c8.js"),["./ElevationSamplerWorker-64fb18c8.js","./PooledRBush-506b9510.js","./quickselect-d16016af.js","./georeference-ab089445.js","./MeshGeoreferencedRelativeVertexSpace-4cbafb45.js","./MeshLocalVertexSpace-0353b8cf.js","./MeshTransform-d557c89a.js"],import.meta.url),FeatureServiceSnappingSourceWorker:()=>ae(()=>import("./FeatureServiceSnappingSourceWorker-0f49f1d1.js"),["./FeatureServiceSnappingSourceWorker-0f49f1d1.js","./FeatureStore-48143fe8.js","./BoundsStore-d475102f.js","./PooledRBush-506b9510.js","./quickselect-d16016af.js","./optimizedFeatureQueryEngineAdapter-f5f88773.js","./centroid-3dcadaf5.js","./QueryEngine-360bd3bb.js","./normalizeUtils-996b11fe.js","./normalizeUtilsCommon-4aa2ad72.js","./WhereClause-ae8c5a06.js","./executionError-e8d36121.js","./json-48e3ea08.js","./QueryEngineCapabilities-42e44ded.js","./utils-a3586684.js","./generateRendererUtils-0f364d1e.js","./symbologySnappingCandidates-67dc9cb4.js","./pbfQueryUtils-93c2b136.js","./pbf-725ddaf6.js","./query-2b60d096.js"],import.meta.url),GeoJSONSourceWorker:()=>ae(()=>import("./GeoJSONSourceWorker-adb3dde2.js"),["./GeoJSONSourceWorker-adb3dde2.js","./FeatureStore-48143fe8.js","./BoundsStore-d475102f.js","./PooledRBush-506b9510.js","./quickselect-d16016af.js","./optimizedFeatureQueryEngineAdapter-f5f88773.js","./centroid-3dcadaf5.js","./QueryEngine-360bd3bb.js","./normalizeUtils-996b11fe.js","./normalizeUtilsCommon-4aa2ad72.js","./WhereClause-ae8c5a06.js","./executionError-e8d36121.js","./json-48e3ea08.js","./QueryEngineCapabilities-42e44ded.js","./utils-a3586684.js","./generateRendererUtils-0f364d1e.js","./geojson-2e35dfdf.js","./clientSideDefaults-8aeb911a.js","./sourceUtils-fdf97eb6.js"],import.meta.url),LercWorker:()=>ae(()=>import("./LercWorker-4913d4e9.js"),[],import.meta.url),MemorySourceWorker:()=>ae(()=>import("./MemorySourceWorker-5815e842.js"),["./MemorySourceWorker-5815e842.js","./objectIdUtils-967fafff.js","./FeatureStore-48143fe8.js","./BoundsStore-d475102f.js","./PooledRBush-506b9510.js","./quickselect-d16016af.js","./optimizedFeatureQueryEngineAdapter-f5f88773.js","./centroid-3dcadaf5.js","./QueryEngine-360bd3bb.js","./normalizeUtils-996b11fe.js","./normalizeUtilsCommon-4aa2ad72.js","./WhereClause-ae8c5a06.js","./executionError-e8d36121.js","./json-48e3ea08.js","./QueryEngineCapabilities-42e44ded.js","./utils-a3586684.js","./generateRendererUtils-0f364d1e.js","./clientSideDefaults-8aeb911a.js","./sourceUtils-fdf97eb6.js"],import.meta.url),PBFDecoderWorker:()=>ae(()=>import("./PBFDecoderWorker-82d7103a.js"),["./PBFDecoderWorker-82d7103a.js","./pbfQueryUtils-93c2b136.js","./pbf-725ddaf6.js"],import.meta.url),Pipeline:()=>ae(()=>import("./Pipeline-63ec8e64.js").then(t=>t.P),["./Pipeline-63ec8e64.js","./QueryEngine-360bd3bb.js","./normalizeUtils-996b11fe.js","./normalizeUtilsCommon-4aa2ad72.js","./WhereClause-ae8c5a06.js","./executionError-e8d36121.js","./json-48e3ea08.js","./QueryEngineCapabilities-42e44ded.js","./utils-a3586684.js","./generateRendererUtils-0f364d1e.js","./StreamFeatureManager-696fe8d3.js","./quickselect-d16016af.js","./ArcadeDate-5405c860.js","./arcadeTimeUtils-34a08cd2.js","./centroid-3dcadaf5.js","./ogcFeatureUtils-78ccef17.js","./geojson-2e35dfdf.js","./clientSideDefaults-8aeb911a.js","./query-2b60d096.js","./pbfQueryUtils-93c2b136.js","./pbf-725ddaf6.js","./createConnection-c5247714.js","./definitions-40cbc24b.js","./TileInfoView-81874107.js","./number-e491b09e.js","./geohashUtils-77d8429b.js"],import.meta.url),PointCloudWorker:()=>ae(()=>import("./PointCloudWorker-2b7a7073.js"),["./PointCloudWorker-2b7a7073.js","./PointCloudWorkerUtil-6fa19a78.js","./PointCloudUniqueValueRenderer-737725b8.js"],import.meta.url),RasterWorker:()=>ae(()=>import("./RasterWorker-87a9a8ff.js"),["./RasterWorker-87a9a8ff.js","./vectorFieldUtils-d080e5ba.js","./colorUtils-c0f43caf.js","./pixelRangeUtils-04f58c28.js","./dataUtils-f5232864.js","./utils-db5d6c34.js","./rasterProjectionHelper-e968ac1d.js"],import.meta.url),SceneLayerSnappingSourceWorker:()=>ae(()=>import("./SceneLayerSnappingSourceWorker-50ab3a31.js"),[],import.meta.url),SceneLayerWorker:()=>ae(()=>import("./SceneLayerWorker-335e8e8a.js").then(t=>t.a),["./SceneLayerWorker-335e8e8a.js","./MeshGeoreferencedRelativeVertexSpace-4cbafb45.js","./MeshLocalVertexSpace-0353b8cf.js","./I3SNode-7e746cc9.js"],import.meta.url),WFSSourceWorker:()=>ae(()=>import("./WFSSourceWorker-0cb7cffd.js"),["./WFSSourceWorker-0cb7cffd.js","./FeatureStore-48143fe8.js","./BoundsStore-d475102f.js","./PooledRBush-506b9510.js","./quickselect-d16016af.js","./optimizedFeatureQueryEngineAdapter-f5f88773.js","./centroid-3dcadaf5.js","./QueryEngine-360bd3bb.js","./normalizeUtils-996b11fe.js","./normalizeUtilsCommon-4aa2ad72.js","./WhereClause-ae8c5a06.js","./executionError-e8d36121.js","./json-48e3ea08.js","./QueryEngineCapabilities-42e44ded.js","./utils-a3586684.js","./generateRendererUtils-0f364d1e.js","./geojson-2e35dfdf.js","./sourceUtils-fdf97eb6.js","./wfsUtils-7f61c558.js","./xmlUtils-444cb4c0.js"],import.meta.url),WorkerTileHandler:()=>ae(()=>import("./WorkerTileHandler-86bb2a9e.js"),["./WorkerTileHandler-86bb2a9e.js","./TileClipper-ae6eca9e.js","./StyleRepository-3a6b235e.js","./colorUtils-c0f43caf.js","./definitions-40cbc24b.js","./Rect-98da58d6.js","./pbf-725ddaf6.js","./TurboLine-f3d4479f.js","./BidiEngine-9a40f2f4.js"],import.meta.url)};var Do;(function(t){t[t.HANDSHAKE=0]="HANDSHAKE",t[t.OPEN=1]="OPEN",t[t.OPENED=2]="OPENED",t[t.RESPONSE=3]="RESPONSE",t[t.INVOKE=4]="INVOKE",t[t.ABORT=5]="ABORT",t[t.CLOSE=6]="CLOSE",t[t.OPEN_PORT=7]="OPEN_PORT",t[t.ON=8]="ON"})(Do||(Do={}));let N9e=0;function g0e(){return N9e++}function F9e(t){return t&&typeof t=="object"&&("result"in t||"transferList"in t)}function LO(t){return t?typeof t=="string"?JSON.stringify({name:"message",message:t}):t.toJSON?JSON.stringify(t):JSON.stringify({name:t.name,message:t.message,details:t.details||{stack:t.stack}}):null}function gZ(t,e,r,i){if(e.type===Do.OPEN_PORT)return void t.postMessage(e,[e.port]);if(e.type!==Do.INVOKE&&e.type!==Do.RESPONSE)return void t.postMessage(e);let s;if(F9e(r)?(s=Uee(r.transferList),e.data=r.result):(s=Uee(i),e.data=r),s){if(oe("ff")){for(const n of s)if("byteLength"in n&&n.byteLength>267386880){const o="Worker call with large ArrayBuffer would crash Firefox";switch(e.type){case Do.INVOKE:throw o;case Do.RESPONSE:return void gZ(t,{type:Do.RESPONSE,jobId:e.jobId,error:LO(o)})}}}t.postMessage(e,s)}else t.postMessage(e)}function DO(t){if(!t)return null;const e=t.data;return e?typeof e=="string"?JSON.parse(e):e:null}function Uee(t){if(!t||!t.length)return null;if(oe("esri-workers-arraybuffer-transfer"))return t;const e=t.filter(r=>!U9e(r));return e.length?e:null}function U9e(t){return t instanceof ArrayBuffer||t?.constructor?.name==="ArrayBuffer"}const{CLOSE:kee,ABORT:Vee,INVOKE:zee,RESPONSE:VE,OPEN_PORT:Bee,ON:k9e}=Do,V9e=2;let z9e=class{constructor(e){this._timer=null,this._cancelledJobIds=new Set,this._invokeMessages=[],this._invoke=e,this._timer=null,this._process=this._process.bind(this)}push(e){e.type===Do.ABORT?this._cancelledJobIds.add(e.jobId):(this._invokeMessages.push(e),this._timer===null&&(this._timer=setTimeout(this._process,0)))}clear(){this._invokeMessages.length=0,this._cancelledJobIds.clear(),this._timer=null}_process(){this._timer=null;for(const e of this._invokeMessages)this._cancelledJobIds.has(e.jobId)||this._invoke(e);this._cancelledJobIds.clear(),this._invokeMessages.length=0}},M_=class wT{static connect(e){const r=new MessageChannel;let i;i=typeof e=="function"?new e:"default"in e&&typeof e.default=="function"?new e.default:e;const s=new wT(r.port1,{channel:r,client:i},()=>null);return typeof i=="object"&&"remoteClient"in i&&(i.remoteClient=s),wT.clients.set(s,i),r.port2}static loadWorker(e){const r=D9e[e];return r?r():Promise.resolve(null)}constructor(e,r,i){this._port=e,this._getNextJob=i,this._outJobs=new Map,this._inJobs=new Map,this._invokeQueue=new z9e(s=>this._onInvokeMessage(s)),this._client=r.client,this._onMessage=this._onMessage.bind(this),this._channel=r.channel,this._schedule=r.schedule,this._port.addEventListener("message",this._onMessage),this._port.start()}close(){this._post({type:kee}),this._close()}isBusy(){return this._outJobs.size>0}invoke(e,r,i){const s=i?.signal,n=i?.transferList;if(!this._port)return Promise.reject(new F("worker:port-closed",`Cannot call invoke('${e}'), port is closed`,{methodName:e,data:r}));const o=g0e();return new Promise((a,l)=>{if(sn(s))return this._processWork(),void l(Dr());const c=nn(s,()=>{const p=this._outJobs.get(o);p&&(this._outJobs.delete(o),this._processWork(),Ii(p.abortHandle),this._post({type:Vee,jobId:o}),l(Dr()))}),h={resolve:a,reject:l,abortHandle:c,debugInfo:e};this._outJobs.set(o,h),this._post({type:zee,jobId:o,methodName:e,abortable:s!=null},r,n)})}on(e,r){const i=new MessageChannel;function s(n){r(n.data)}return this._port.postMessage({type:Do.ON,eventType:e,port:i.port2},[i.port2]),i.port1.addEventListener("message",s),i.port1.start(),{remove(){i.port1.postMessage({type:Do.CLOSE}),i.port1.close(),i.port1.removeEventListener("message",s)}}}jobAdded(){this._processWork()}openPort(){const e=new MessageChannel;return this._post({type:Bee,port:e.port2}),e.port1}_processWork(){if(this._outJobs.size>=V9e)return;const e=this._getNextJob();if(!e)return;const{methodName:r,data:i,invokeOptions:s,resolver:n}=e;this.invoke(r,i,s).then(o=>n.resolve(o)).catch(o=>n.reject(o))}_close(){this._channel&&(this._channel=void 0),this._port.removeEventListener("message",this._onMessage),this._port.close(),this._outJobs.forEach(e=>{Ii(e.abortHandle),e.reject(Dr(`Worker closing, aborting job calling '${e.debugInfo}'`))}),this._inJobs.clear(),this._outJobs.clear(),this._invokeQueue.clear(),this._port=null,this._client=null,this._schedule=null}_onMessage(e){this._schedule!=null?this._schedule(()=>this._processMessage(e)):this._processMessage(e)}_processMessage(e){const r=DO(e);if(r)switch(r.type){case VE:this._onResponseMessage(r);break;case zee:this._invokeQueue.push(r);break;case Vee:this._onAbortMessage(r);break;case kee:this._onCloseMessage();break;case Bee:this._onOpenPortMessage(r);break;case k9e:this._onOnMessage(r)}}_onAbortMessage(e){const r=this._inJobs,i=e.jobId,s=r.get(i);this._invokeQueue.push(e),s&&(s.controller&&s.controller.abort(),r.delete(i))}_onCloseMessage(){const e=this._client;this._close(),e&&"destroy"in e&&wT.clients.get(this)===e&&e.destroy(),wT.clients.delete(this),e?.remoteClient&&(e.remoteClient=null)}_onInvokeMessage(e){const{methodName:r,jobId:i,data:s,abortable:n}=e,o=n?new AbortController:null,a=this._inJobs;let l,c=this._client,h=c[r];try{if(!h&&r&&r.includes(".")){const p=r.split(".");for(let f=0;f<p.length-1;f++)c=c[p[f]],h=c[p[f+1]]}if(typeof h!="function")throw new TypeError(`${r} is not a function`);l=h.call(c,s,{client:this,signal:o?o.signal:null})}catch(p){return void this._post({type:VE,jobId:i,error:LO(p)})}bu(l)?(a.set(i,{controller:o,promise:l}),l.then(p=>{a.has(i)&&(a.delete(i),this._post({type:VE,jobId:i},p))},p=>{a.has(i)&&(a.delete(i),ms(p)||this._post({type:VE,jobId:i,error:LO(p||{message:`Error encountered at method ${r}`})}))})):this._post({type:VE,jobId:i},l)}_onOpenPortMessage(e){new wT(e.port,{client:this._client},()=>null)}_onOnMessage(e){const{port:r}=e,i=this._client.on(e.eventType,n=>{r.postMessage(n)}),s=h_(e.port,"message",n=>{DO(n)?.type===Do.CLOSE&&(s.remove(),i.remove(),r.close())})}_onResponseMessage(e){const{jobId:r,error:i,data:s}=e,n=this._outJobs;if(!n.has(r))return;const o=n.get(r);n.delete(r),this._processWork(),Ii(o.abortHandle),i?o.reject(F.fromJSON(JSON.parse(i))):o.resolve(s)}_post(e,r,i){return gZ(this._port,e,r,i)}};M_.kernelInfo={buildDate:qde,fullVersion:$q,revision:Wde},M_.clients=new Map;let B9e=class{constructor(){this._inUseClients=new Array,this._clients=new Array,this._clientPromises=new Array,this._ongoingJobsQueue=new kB}destroy(){this.close()}get closed(){return!this._clients||!this._clients.length}open(e,r){return new Promise((i,s)=>{let n=!0;const o=a=>{Xt(r.signal),n&&(n=!1,a())};this._clients.length=e.length,this._clientPromises.length=e.length,this._inUseClients.length=e.length;for(let a=0;a<e.length;++a){const l=e[a];bu(l)?this._clientPromises[a]=l.then(c=>(this._clients[a]=new M_(c,r,()=>this._ongoingJobsQueue.pop()??null),o(i),this._clients[a]),()=>(o(s),null)):(this._clients[a]=new M_(l,r,()=>this._ongoingJobsQueue.pop()??null),this._clientPromises[a]=Promise.resolve(this._clients[a]),o(i))}})}broadcast(e,r,i){const s=new Array(this._clientPromises.length);for(let n=0;n<this._clientPromises.length;++n){const o=this._clientPromises[n];s[n]=o.then(a=>a?.invoke(e,r,i))}return s}close(){let e;for(;e=this._ongoingJobsQueue.pop();)e.resolver.reject(Dr(`Worker closing, aborting job calling '${e.methodName}'`));for(const r of this._clientPromises)r.then(i=>i?.close());this._clients.length=0,this._clientPromises.length=0,this._inUseClients.length=0}invoke(e,r,i){let s;Array.isArray(i)?(Q.getLogger("esri.core.workers.Connection").warn("invoke()","The transferList parameter is deprecated, use the options object instead"),s={transferList:i}):s=i;const n=qs();this._ongoingJobsQueue.push({methodName:e,data:r,invokeOptions:s,resolver:n});for(let o=0;o<this._clientPromises.length;o++){const a=this._clients[o];a?a.jobAdded():this._clientPromises[o].then(l=>l?.jobAdded())}return n.promise}on(e,r){return Promise.all(this._clientPromises).then(()=>XS(this._clients.map(i=>i.on(e,r))))}openPorts(){return new Promise(e=>{const r=new Array(this._clientPromises.length);let i=r.length;for(let s=0;s<this._clientPromises.length;++s)this._clientPromises[s].then(n=>{n&&(r[s]=n.openPort()),--i==0&&e(r)})})}get test(){return{numClients:this._clients.length}}};const G9e={};function j9e(t){const e={async:t.async,isDebug:t.isDebug,locale:t.locale,baseUrl:t.baseUrl,has:{...t.has},map:{...t.map},packages:t.packages&&t.packages.concat()||[],paths:{...t.paths}};return t.hasOwnProperty("async")||(e.async=!0),t.hasOwnProperty("isDebug")||(e.isDebug=!1),t.baseUrl||(e.baseUrl=G9e.baseUrl),e}let H9e=class{constructor(){const e=document.createDocumentFragment();["addEventListener","dispatchEvent","removeEventListener"].forEach(r=>{this[r]=(...i)=>e[r](...i)})}},EL=class{constructor(){this._dispatcher=new H9e,this._workerPostMessage({type:Do.HANDSHAKE})}terminate(){}get onmessage(){return this._onmessageHandler}set onmessage(e){this._onmessageHandler&&this.removeEventListener("message",this._onmessageHandler),this._onmessageHandler=e,e&&this.addEventListener("message",e)}get onmessageerror(){return this._onmessageerrorHandler}set onmessageerror(e){this._onmessageerrorHandler&&this.removeEventListener("messageerror",this._onmessageerrorHandler),this._onmessageerrorHandler=e,e&&this.addEventListener("messageerror",e)}get onerror(){return this._onerrorHandler}set onerror(e){this._onerrorHandler&&this.removeEventListener("error",this._onerrorHandler),this._onerrorHandler=e,e&&this.addEventListener("error",e)}postMessage(e){YS(()=>{this._workerMessageHandler(new MessageEvent("message",{data:e}))})}dispatchEvent(e){return this._dispatcher.dispatchEvent(e)}addEventListener(e,r,i){this._dispatcher.addEventListener(e,r,i)}removeEventListener(e,r,i){this._dispatcher.removeEventListener(e,r,i)}_workerPostMessage(e){YS(()=>{this.dispatchEvent(new MessageEvent("message",{data:e}))})}async _workerMessageHandler(e){const r=DO(e);if(r&&r.type===Do.OPEN){const{modulePath:i,jobId:s}=r;let n=await M_.loadWorker(i);n||(n=await ae(()=>import(i),[],import.meta.url));const o=M_.connect(n);this._workerPostMessage({type:Do.OPENED,jobId:s,data:o})}}};const VB=Q.getLogger("esri.core.workers.workerFactory"),{HANDSHAKE:q9e}=Do,W9e='let globalId=0;const outgoing=new Map,configuration=JSON.parse("{CONFIGURATION}");self.esriConfig=configuration.esriConfig;const workerPath=self.esriConfig.workers.workerPath,HANDSHAKE=0,OPEN=1,OPENED=2,RESPONSE=3,INVOKE=4,ABORT=5;function createAbortError(){const e=new Error("Aborted");return e.name="AbortError",e}function receiveMessage(e){return e&&e.data?"string"==typeof e.data?JSON.parse(e.data):e.data:null}function invokeStaticMessage(e,o,r){const t=r&&r.signal,n=globalId++;return new Promise(((r,s)=>{if(t){if(t.aborted)return s(createAbortError());t.addEventListener("abort",(()=>{outgoing.get(n)&&(outgoing.delete(n),self.postMessage({type:ABORT,jobId:n}),s(createAbortError()))}))}outgoing.set(n,{resolve:r,reject:s}),self.postMessage({type:INVOKE,jobId:n,methodName:e,abortable:null!=t,data:o})}))}let workerRevisionChecked=!1;function checkWorkerRevision(e){if(!workerRevisionChecked&&e.kernelInfo){workerRevisionChecked=!0;const{revision:o,fullVersion:r}=configuration.kernelInfo,{revision:t,fullVersion:n,version:s}=e.kernelInfo;esriConfig.assetsPath!==esriConfig.defaultAssetsPath&&o!==t&&console.warn(`Version mismatch detected between ArcGIS Maps SDK for JavaScript modules and assets. For more information visit https://bit.ly/3QnsuSo.\\nModules version: ${r}\\nAssets version: ${n??s}\\nAssets path: ${esriConfig.assetsPath}`)}}function messageHandler(e){const o=receiveMessage(e);if(!o)return;const r=o.jobId;switch(o.type){case OPEN:let n;function t(e){const o=n.connect(e);self.postMessage({type:OPENED,jobId:r,data:o},[o])}"function"==typeof define&&define.amd?require([workerPath],(e=>{n=e.default||e,checkWorkerRevision(n),n.loadWorker(o.modulePath).then((e=>e||new Promise((e=>{require([o.modulePath],e)})))).then(t)})):"System"in self&&"function"==typeof System.import?System.import(workerPath).then((e=>(n=e.default,checkWorkerRevision(n),n.loadWorker(o.modulePath)))).then((e=>e||System.import(o.modulePath))).then(t):esriConfig.workers.useDynamicImport?import(workerPath).then((e=>{n=e.default||e,checkWorkerRevision(n),n.loadWorker(o.modulePath).then((e=>e||import(o.modulePath))).then(t)})):(self.RemoteClient||importScripts(workerPath),n=self.RemoteClient.default||self.RemoteClient,checkWorkerRevision(n),n.loadWorker(o.modulePath).then(t));break;case RESPONSE:if(outgoing.has(r)){const s=outgoing.get(r);outgoing.delete(r),o.error?s.reject(JSON.parse(o.error)):s.resolve(o.data)}}}self.dojoConfig=configuration.loaderConfig,esriConfig.workers.loaderUrl&&(self.importScripts(esriConfig.workers.loaderUrl),"function"==typeof require&&"function"==typeof require.config&&require.config(configuration.loaderConfig)),self.addEventListener("message",messageHandler),self.postMessage({type:0});';let JP,QP;const Gee="Failed to create Worker. Fallback to execute module in main thread";async function Z9e(){if(!oe("esri-workers")||(oe("mozilla"),0))return jee(new EL);if(!JP&&!QP)try{const e=W9e.split('"{CONFIGURATION}"').join(`'${X9e()}'`);JP=URL.createObjectURL(new Blob([e],{type:"text/javascript"}))}catch(e){QP=e||{}}let t;if(JP)try{t=new Worker(JP,{name:"esri-worker-"+Y9e++})}catch{VB.warn(Gee,QP),t=new EL}else VB.warn(Gee,QP),t=new EL;return jee(t)}async function jee(t){return new Promise(e=>{function r(s){const n=DO(s);n&&n.type===q9e&&(t.removeEventListener("message",r),t.removeEventListener("error",i),e(t))}function i(s){s.preventDefault(),t.removeEventListener("message",r),t.removeEventListener("error",i),VB.warn("Failed to create Worker. Fallback to execute module in main thread",s),(t=new EL).addEventListener("message",r),t.addEventListener("error",i)}t.addEventListener("message",r),t.addEventListener("error",i)})}function X9e(){let t;if(Ur.default!=null){const s={...Ur};delete s.default,t=JSON.parse(JSON.stringify(s))}else t=JSON.parse(JSON.stringify(Ur));t.assetsPath=_l(t.assetsPath),t.defaultAssetsPath=t.defaultAssetsPath?_l(t.defaultAssetsPath):void 0,t.request.interceptors=[],t.log.interceptors=[],t.locale=_h(),t.has={"esri-csp-restrictions":oe("esri-csp-restrictions"),"esri-2d-debug":!1,"esri-2d-update-debug":oe("esri-2d-update-debug"),"esri-2d-log-updating":oe("esri-2d-log-updating"),"featurelayer-pbf":oe("featurelayer-pbf"),"featurelayer-simplify-thresholds":oe("featurelayer-simplify-thresholds"),"featurelayer-simplify-payload-size-factors":oe("featurelayer-simplify-payload-size-factors"),"featurelayer-simplify-mobile-factor":oe("featurelayer-simplify-mobile-factor"),"esri-atomics":oe("esri-atomics"),"esri-shared-array-buffer":oe("esri-shared-array-buffer"),"esri-tiles-debug":oe("esri-tiles-debug"),"esri-workers-arraybuffer-transfer":oe("esri-workers-arraybuffer-transfer"),"feature-polyline-generalization-factor":oe("feature-polyline-generalization-factor"),"host-webworker":1,"polylabel-placement-enabled":oe("polylabel-placement-enabled")},t.workers.loaderUrl&&(t.workers.loaderUrl=_l(t.workers.loaderUrl)),t.workers.workerPath?t.workers.workerPath=_l(t.workers.workerPath):t.workers.workerPath=_l(kr("esri/core/workers/RemoteClient.js")),t.workers.useDynamicImport=!1;const e=Ur.workers.loaderConfig,r=j9e({baseUrl:e?.baseUrl,locale:_h(),has:{"csp-restrictions":1,"dojo-test-sniff":0,"host-webworker":1,...e?.has},map:{...e?.map},paths:{...e?.paths},packages:e?.packages||[]});return JSON.stringify({esriConfig:t,loaderConfig:r,kernelInfo:{buildDate:qde,fullVersion:$q,revision:Wde}})}let Y9e=0;const{ABORT:Hee,INVOKE:J9e,OPEN:Q9e,OPENED:K9e,RESPONSE:zE}=Do;let eke=class y0e{static async create(e){const r=await Z9e();return new y0e(r,e)}constructor(e,r){this._outJobs=new Map,this._inJobs=new Map,this.worker=e,this.id=r,e.addEventListener("message",this._onMessage.bind(this)),e.addEventListener("error",i=>{i.preventDefault(),Q.getLogger("esri.core.workers.WorkerOwner").error(i)})}terminate(){this.worker.terminate()}async open(e,r={}){const{signal:i}=r,s=g0e();return new Promise((n,o)=>{const a={resolve:n,reject:o,abortHandle:wq(i,()=>{this._outJobs.delete(s),this._post({type:Hee,jobId:s})})};this._outJobs.set(s,a),this._post({type:Q9e,jobId:s,modulePath:e})})}_onMessage(e){const r=DO(e);if(r)switch(r.type){case K9e:this._onOpenedMessage(r);break;case zE:this._onResponseMessage(r);break;case Hee:this._onAbortMessage(r);break;case J9e:this._onInvokeMessage(r)}}_onAbortMessage(e){const r=this._inJobs,i=e.jobId,s=r.get(i);s&&(s.controller&&s.controller.abort(),r.delete(i))}_onInvokeMessage(e){const{methodName:r,jobId:i,data:s,abortable:n}=e,o=n?new AbortController:null,a=this._inJobs,l=nIe[r];let c;try{if(typeof l!="function")throw new TypeError(`${r} is not a function`);c=l.call(null,s,{signal:o?o.signal:null})}catch(h){return void this._post({type:zE,jobId:i,error:LO(h)})}bu(c)?(a.set(i,{controller:o,promise:c}),c.then(h=>{a.has(i)&&(a.delete(i),this._post({type:zE,jobId:i},h))},h=>{a.has(i)&&(a.delete(i),h||(h={message:"Error encountered at method"+r}),ms(h)||this._post({type:zE,jobId:i,error:LO(h||{message:`Error encountered at method ${r}`})}))})):this._post({type:zE,jobId:i},c)}_onOpenedMessage(e){const{jobId:r,data:i}=e,s=this._outJobs.get(r);s&&(this._outJobs.delete(r),Ii(s.abortHandle),s.resolve(i))}_onResponseMessage(e){const{jobId:r,error:i,data:s}=e,n=this._outJobs.get(r);n&&(this._outJobs.delete(r),Ii(n.abortHandle),i?n.reject(F.fromJSON(JSON.parse(i))):n.resolve(s))}_post(e,r,i){return gZ(this.worker,e,r,i)}};const qee=oe("host-browser")?Math.min(navigator.hardwareConcurrency-1,oe("workers-pool-size")):0;let db=oe("esri-mobile")?Math.min(qee,3):qee;db||(db=oe("safari")&&oe("mac")?7:2);let Wee=0;const CL=[];function tke(){v0e()}async function KP(t,e){const r=new B9e;return await r.open(t,e),r}async function _0e(t,e={}){if(typeof t!="string")throw new F("workers:undefined-module","modulePath is missing");let r=e.strategy||"distributed";if(oe("host-webworker")&&!oe("esri-workers")&&(r="local"),r==="local"){let i=await M_.loadWorker(t);i||(i=await ae(()=>import(t),[],import.meta.url)),Xt(e.signal);const s=e.client||i;return KP([M_.connect(i)],{...e,client:s})}if(await v0e(),Xt(e.signal),r==="dedicated"){const i=Wee++%db;return KP([await CL[i].open(t,e)],e)}if(e.maxNumWorkers&&e.maxNumWorkers>0){const i=Math.min(e.maxNumWorkers,db);if(i<db){const s=new Array(i);for(let n=0;n<i;++n){const o=Wee++%db;s[n]=CL[o].open(t,e)}return KP(s,e)}}return KP(CL.map(i=>i.open(t,e)),e)}let eM=null;async function v0e(){if(eM)return eM;new AbortController;const t=[];for(let e=0;e<db;e++){const r=eke.create(e).then(i=>(CL[e]=i,i));t.push(r)}return eM=Promise.all(t),eM}function Zee(t,e,r){if(t.hasM==null||t.hasZ)for(const i of e)for(const s of i)s.length>2&&(s[2]*=r)}function rke(t,e,r){if(!t&&!e||!r)return;const i=xO(r);Xee(t,r,i),Xee(e,r,i)}function Xee(t,e,r){if(t)for(const i of t)ike(i.geometry,e,r)}function ike(t,e,r){if(t==null||!t.spatialReference||Rn(t.spatialReference,e))return;const i=xO(t.spatialReference)/r;if(i!==1){if("x"in t)t.z!=null&&(t.z*=i);else if("rings"in t)Zee(t,t.rings,i);else if("paths"in t)Zee(t,t.paths,i);else if("points"in t&&(t.hasM==null||t.hasZ))for(const s of t.points)s.length>2&&(s[2]*=i)}}function b0e(t,e,r){if(e==null||r==null||r.vcsWkid||Rn(e,r))return null;const i=xO(e)/xO(r);if(i===1)return null;switch(t){case"point":case"esriGeometryPoint":return s=>ske(s,i);case"polyline":case"esriGeometryPolyline":return s=>oke(s,i);case"polygon":case"esriGeometryPolygon":return s=>nke(s,i);case"multipoint":case"esriGeometryMultipoint":return s=>ake(s,i);case"extent":case"esriGeometryEnvelope":return s=>lke(s,i);default:return null}}function ske(t,e){t&&t.z!=null&&(t.z*=e)}function nke(t,e){if(t)for(const r of t.rings)for(const i of r)i.length>2&&(i[2]*=e)}function oke(t,e){if(t)for(const r of t.paths)for(const i of r)i.length>2&&(i[2]*=e)}function ake(t,e){if(t)for(const r of t.points)r.length>2&&(r[2]*=e)}function lke(t,e){t&&t.zmin!=null&&t.zmax!=null&&(t.zmin*=e,t.zmax*=e)}function Yee(t,e,r){if(!r||!r.features||!r.hasZ)return;const i=b0e(r.geometryType,e,t.outSpatialReference);if(i!=null)for(const s of r.features)i(s.geometry)}const cke=new Rr({esriFieldTypeSmallInteger:"small-integer",esriFieldTypeInteger:"integer",esriFieldTypeSingle:"single",esriFieldTypeDouble:"double",esriFieldTypeLong:"long",esriFieldTypeString:"string",esriFieldTypeDate:"date",esriFieldTypeOID:"oid",esriFieldTypeGeometry:"geometry",esriFieldTypeBlob:"blob",esriFieldTypeRaster:"raster",esriFieldTypeGUID:"guid",esriFieldTypeGlobalID:"global-id",esriFieldTypeXML:"xml",esriFieldTypeBigInteger:"big-integer",esriFieldTypeDateOnly:"date-only",esriFieldTypeTimeOnly:"time-only",esriFieldTypeTimestampOffset:"timestamp-offset"});var zB;const uke=new Rr({binary:"binary",coordinate:"coordinate",countOrAmount:"count-or-amount",dateAndTime:"date-and-time",description:"description",locationOrPlaceName:"location-or-place-name",measurement:"measurement",nameOrTitle:"name-or-title",none:"none",orderedOrRanked:"ordered-or-ranked",percentageOrRatio:"percentage-or-ratio",typeOrCategory:"type-or-category",uniqueIdentifier:"unique-identifier"});let Ca=zB=class extends de{constructor(t){super(t),this.alias=null,this.defaultValue=void 0,this.description=null,this.domain=null,this.editable=!0,this.length=-1,this.name=null,this.nullable=!0,this.type=null,this.valueType=null,this.visible=!0}readDescription(t,{description:e}){let r=null;try{r=e?JSON.parse(e):null}catch{}return r?.value??null}readValueType(t,{description:e}){let r=null;try{r=e?JSON.parse(e):null}catch{}return r?uke.fromJSON(r.fieldValueType):null}clone(){return new zB({alias:this.alias,defaultValue:this.defaultValue,description:this.description,domain:this.domain&&this.domain.clone()||null,editable:this.editable,length:this.length,name:this.name,nullable:this.nullable,type:this.type,valueType:this.valueType,visible:this.visible})}};u([d({type:String,json:{write:!0}})],Ca.prototype,"alias",void 0),u([d({type:[String,Number],json:{write:{allowNull:!0}}})],Ca.prototype,"defaultValue",void 0),u([d()],Ca.prototype,"description",void 0),u([Ee("description")],Ca.prototype,"readDescription",null),u([d({types:bye,json:{read:{reader:JW},write:!0}})],Ca.prototype,"domain",void 0),u([d({type:Boolean,json:{write:!0}})],Ca.prototype,"editable",void 0),u([d({type:Xi,json:{write:!0}})],Ca.prototype,"length",void 0),u([d({type:String,json:{write:!0}})],Ca.prototype,"name",void 0),u([d({type:Boolean,json:{write:!0}})],Ca.prototype,"nullable",void 0),u([tt(cke)],Ca.prototype,"type",void 0),u([d()],Ca.prototype,"valueType",void 0),u([Ee("valueType",["description"])],Ca.prototype,"readValueType",null),u([d({type:Boolean,json:{read:!1}})],Ca.prototype,"visible",void 0),Ca=zB=u([R("esri.layers.support.Field")],Ca);const n5=Ca;var BB;const GB=new Rr({esriGeometryPoint:"point",esriGeometryMultipoint:"multipoint",esriGeometryPolyline:"polyline",esriGeometryPolygon:"polygon",esriGeometryEnvelope:"extent",mesh:"mesh","":null});let Ao=BB=class extends de{constructor(t){super(t),this.displayFieldName=null,this.exceededTransferLimit=!1,this.features=[],this.fields=null,this.geometryType=null,this.hasM=!1,this.hasZ=!1,this.queryGeometry=null,this.spatialReference=null}readFeatures(t,e){const r=je.fromJSON(e.spatialReference),i=[];for(let s=0;s<t.length;s++){const n=t[s],o=Oh.fromJSON(n),a=n.geometry&&n.geometry.spatialReference;o.geometry==null||a||(o.geometry.spatialReference=r);const l=n.aggregateGeometries,c=o.aggregateGeometries;if(l&&c!=null)for(const h in c){const p=c[h],f=l[h],m=f?.spatialReference;p==null||m||(p.spatialReference=r)}i.push(o)}return i}writeGeometryType(t,e,r,i){if(t)return void GB.write(t,e,r,i);const{features:s}=this;if(s){for(const n of s)if(n&&n.geometry!=null)return void GB.write(n.geometry.type,e,r,i)}}readQueryGeometry(t,e){if(!t)return null;const r=!!t.spatialReference,i=S_(t);return i&&!r&&e.spatialReference&&(i.spatialReference=je.fromJSON(e.spatialReference)),i}writeSpatialReference(t,e){if(t)return void(e.spatialReference=t.toJSON());const{features:r}=this;if(r){for(const i of r)if(i&&i.geometry!=null&&i.geometry.spatialReference)return void(e.spatialReference=i.geometry.spatialReference.toJSON())}}clone(){return new BB(this.cloneProperties())}cloneProperties(){return K({displayFieldName:this.displayFieldName,exceededTransferLimit:this.exceededTransferLimit,features:this.features,fields:this.fields,geometryType:this.geometryType,hasM:this.hasM,hasZ:this.hasZ,queryGeometry:this.queryGeometry,spatialReference:this.spatialReference,transform:this.transform})}toJSON(t){const e=this.write();if(e.features&&Array.isArray(t)&&t.length>0)for(let r=0;r<e.features.length;r++){const i=e.features[r];if(i.geometry){const s=t&&t[r];i.geometry=s&&s.toJSON()||i.geometry}}return e}quantize(t){const{scale:[e,r],translate:[i,s]}=t,n=c=>Math.round((c-i)/e),o=c=>Math.round((s-c)/r),a=this.features,l=this._getQuantizationFunction(this.geometryType,n,o);for(let c=0,h=a.length;c<h;c++)l?.(a[c].geometry)||(a.splice(c,1),c--,h--);return this.transform=t,this}unquantize(){const{geometryType:t,features:e,transform:r}=this;if(!r)return this;const{translate:[i,s],scale:[n,o]}=r,a=f=>f*n+i,l=f=>s-f*o;let c=null,h=null;if(this.hasZ&&r?.scale?.[2]!=null){const{translate:[,,f],scale:[,,m]}=r;c=y=>y*m+f}if(this.hasM&&r?.scale?.[3]!=null){const{translate:[,,,f],scale:[,,,m]}=r;h=y=>y==null?y:y*m+f}const p=this._getHydrationFunction(t,a,l,c,h);for(const{geometry:f}of e)f!=null&&p&&p(f);return this.transform=null,this}_quantizePoints(t,e,r){let i,s;const n=[];for(let o=0,a=t.length;o<a;o++){const l=t[o];if(o>0){const c=e(l[0]),h=r(l[1]);c===i&&h===s||(n.push([c-i,h-s]),i=c,s=h)}else i=e(l[0]),s=r(l[1]),n.push([i,s])}return n.length>0?n:null}_getQuantizationFunction(t,e,r){return t==="point"?i=>(i.x=e(i.x),i.y=r(i.y),i):t==="polyline"||t==="polygon"?i=>{const s=SS(i)?i.rings:i.paths,n=[];for(let o=0,a=s.length;o<a;o++){const l=s[o],c=this._quantizePoints(l,e,r);c&&n.push(c)}return n.length>0?(SS(i)?i.rings=n:i.paths=n,i):null}:t==="multipoint"?i=>{const s=this._quantizePoints(i.points,e,r);return s&&s.length>0?(i.points=s,i):null}:t==="extent"?i=>i:null}_getHydrationFunction(t,e,r,i,s){return t==="point"?n=>{n.x=e(n.x),n.y=r(n.y),i&&(n.z=i(n.z))}:t==="polyline"||t==="polygon"?n=>{const o=SS(n)?n.rings:n.paths;let a,l;for(let c=0,h=o.length;c<h;c++){const p=o[c];for(let f=0,m=p.length;f<m;f++){const y=p[f];f>0?(a+=y[0],l+=y[1]):(a=y[0],l=y[1]),y[0]=e(a),y[1]=r(l)}}if(i&&s)for(let c=0,h=o.length;c<h;c++){const p=o[c];for(let f=0,m=p.length;f<m;f++){const y=p[f];y[2]=i(y[2]),y[3]=s(y[3])}}else if(i)for(let c=0,h=o.length;c<h;c++){const p=o[c];for(let f=0,m=p.length;f<m;f++){const y=p[f];y[2]=i(y[2])}}else if(s)for(let c=0,h=o.length;c<h;c++){const p=o[c];for(let f=0,m=p.length;f<m;f++){const y=p[f];y[2]=s(y[2])}}}:t==="extent"?n=>{n.xmin=e(n.xmin),n.ymin=r(n.ymin),n.xmax=e(n.xmax),n.ymax=r(n.ymax),i&&n.zmax!=null&&n.zmin!=null&&(n.zmax=i(n.zmax),n.zmin=i(n.zmin)),s&&n.mmax!=null&&n.mmin!=null&&(n.mmax=s(n.mmax),n.mmin=s(n.mmin))}:t==="multipoint"?n=>{const o=n.points;let a,l;for(let c=0,h=o.length;c<h;c++){const p=o[c];c>0?(a+=p[0],l+=p[1]):(a=p[0],l=p[1]),p[0]=e(a),p[1]=r(l)}if(i&&s)for(let c=0,h=o.length;c<h;c++){const p=o[c];p[2]=i(p[2]),p[3]=s(p[3])}else if(i)for(let c=0,h=o.length;c<h;c++){const p=o[c];p[2]=i(p[2])}else if(s)for(let c=0,h=o.length;c<h;c++){const p=o[c];p[2]=s(p[2])}}:null}};u([d({type:String,json:{write:!0}})],Ao.prototype,"displayFieldName",void 0),u([d({type:Boolean,json:{write:{overridePolicy:t=>({enabled:t})}}})],Ao.prototype,"exceededTransferLimit",void 0),u([d({type:[Oh],json:{write:!0}})],Ao.prototype,"features",void 0),u([Ee("features")],Ao.prototype,"readFeatures",null),u([d({type:[n5],json:{write:!0}})],Ao.prototype,"fields",void 0),u([d({type:["point","multipoint","polyline","polygon","extent","mesh"],json:{read:{reader:GB.read}}})],Ao.prototype,"geometryType",void 0),u([Fe("geometryType")],Ao.prototype,"writeGeometryType",null),u([d({type:Boolean,json:{write:{overridePolicy:t=>({enabled:t})}}})],Ao.prototype,"hasM",void 0),u([d({type:Boolean,json:{write:{overridePolicy:t=>({enabled:t})}}})],Ao.prototype,"hasZ",void 0),u([d({types:Ew,json:{write:!0}})],Ao.prototype,"queryGeometry",void 0),u([Ee("queryGeometry")],Ao.prototype,"readQueryGeometry",null),u([d({type:je,json:{write:!0}})],Ao.prototype,"spatialReference",void 0),u([Fe("spatialReference")],Ao.prototype,"writeSpatialReference",null),u([d({json:{write:!0}})],Ao.prototype,"transform",void 0),Ao=BB=u([R("esri.rest.support.FeatureSet")],Ao),Ao.prototype.toJSON.isDefaultToJSON=!0;const w0e=Ao;let hke=0;const x0e="esri.layers.graphics.sources.MemorySource",xU=Q.getLogger(x0e);let Km=class extends Fg.LoadableMixin(DF(TF(Pt))){constructor(e){super(e),this._idToClientGraphic=null,this.type="memory"}load(e){const r=e!=null?e.signal:null;return this.addResolvingPromise(this._startWorker(r)),Promise.resolve(this)}destroy(){this._connection?.close(),this._connection=null}get _workerGeometryType(){const e=this.layer?.geometryType;return e?this._geometryTypeRequiresClientGraphicMapping(e)?"polygon":e:null}applyEdits(e){return this.load().then(()=>this._applyEdits(e))}openPorts(){return this.load().then(()=>this._connection.openPorts())}async queryFeatures(e,r={}){await this.load(r);const i=await this._connection.invoke("queryFeatures",e?e.toJSON():null,r);Yee(e,this.layer.spatialReference,i);const s=w0e.fromJSON(i);if(!this._requiresClientGraphicMapping())return s;const n=this.layer.objectIdField;for(const o of s.features){const a=o.attributes[n],l=this._idToClientGraphic.get(a);l&&(o.geometry=l.geometry)}return s.geometryType=this.layer.geometryType,s}async queryFeaturesJSON(e,r={}){if(this._requiresClientGraphicMapping())throw new F("query-features-json:unsupported","Cannot query in JSON format for client only geometry types (mesh and extent)");await this.load(r);const i=await this._connection.invoke("queryFeatures",e?e.toJSON():null,r);return Yee(e,this.layer.spatialReference,i),i}queryFeatureCount(e,r={}){return this.load(r).then(()=>this._connection.invoke("queryFeatureCount",e?e.toJSON():null,r))}queryObjectIds(e,r={}){return this.load(r).then(()=>this._connection.invoke("queryObjectIds",e?e.toJSON():null,r))}queryExtent(e,r={}){return this.load(r).then(()=>this._connection.invoke("queryExtent",e?e.toJSON():null,r)).then(i=>({count:i.count,extent:_r.fromJSON(i.extent)}))}querySnapping(e,r={}){return this.load(r).then(()=>this._connection.invoke("querySnapping",e,r))}async _applyEdits(e){if(!this._connection)throw new F("feature-layer-source:edit-failure","Memory source not loaded");const r=this.layer.objectIdField;let i=null;const s=[],n=[];await Promise.all([this._prepareClientMapping(e.addFeatures,null),this._prepareClientMapping(e.updateFeatures,null)]);const o=h=>"objectId"in h&&h.objectId!=null?h.objectId:"attributes"in h&&h.attributes[r]!=null?h.attributes[r]:null;if(e.addFeatures&&(i=this._prepareAddFeatures(e.addFeatures)),e.deleteFeatures)for(const h of e.deleteFeatures){const p=o(h);p!=null&&s.push(p)}const a=e.updateFeatures&&this._idToClientGraphic?new Map:null;if(e.updateFeatures){for(const h of e.updateFeatures)if(n.push(this._serializeFeature(h)),a){const p=o(h);p!=null&&a.set(p,h)}}rke(i?i.features:null,n,this.layer.spatialReference);const{fullExtent:l,featureEditResults:c}=await this._connection.invoke("applyEdits",{adds:i?i.features:[],updates:n,deletes:s});return this.fullExtent=l,i&&i.finish(c.uidToObjectId),this._updateClientGraphicIds(a,c),this._createEditsResult(c)}async _prepareClientMapping(e,r){if(this._layerOrSourceGeometryType!=="mesh"||e==null)return;const i=[];for(const{geometry:s}of e)s==null||s.type!=="mesh"||s.hasExtent||s.loaded||i.push(s.load({signal:r}));i.length&&await Promise.all(i)}_updateClientGraphicIds(e,r){if(this._idToClientGraphic){if(e)for(const i of r.updateResults){if(!i.success)continue;const s=e.get(i.objectId);s!=null&&this._addIdToClientGraphic(s)}for(const i of r.deleteResults)i.success&&this._idToClientGraphic.delete(i.objectId)}}_createEditsResult(e){return{addFeatureResults:e.addResults?e.addResults.map(this._createFeatureEditResult,this):[],updateFeatureResults:e.updateResults?e.updateResults.map(this._createFeatureEditResult,this):[],deleteFeatureResults:e.deleteResults?e.deleteResults.map(this._createFeatureEditResult,this):[],addAttachmentResults:[],updateAttachmentResults:[],deleteAttachmentResults:[]}}_createFeatureEditResult(e){const r=e.success===!0?null:e.error||{code:void 0,description:void 0};return{objectId:e.objectId,globalId:e.globalId,error:r?new F("feature-layer-source:edit-failure",r.description,{code:r.code}):null}}_prepareAddFeatures(e){const r=new Map,i=new Array(e.length);let s=null;for(let o=0;o<e.length;o++){const a=e[o],l=this._serializeFeature(a);s||a.geometry==null||(s=a.geometry.type),i[o]=l,r.set(`${l.uid}`,a)}const n=this;return{features:i,inferredGeometryType:s,finish(o){const a=n.sourceJSON.objectIdField;for(const l in o){const c=o[l],h=r.get(l);h&&(h.attributes||(h.attributes={}),c===-1?delete h.attributes[a]:h.attributes[a]=c,n._addIdToClientGraphic(h))}}}}_addIdToClientGraphic(e){if(!this._idToClientGraphic)return;const r=this.sourceJSON.objectIdField,i=e.attributes&&e.attributes[r];i!=null&&this._idToClientGraphic.set(i,e)}get _layerOrSourceGeometryType(){return this.layer?.geometryType??this.sourceJSON?.geometryType}_requiresClientGraphicMapping(){return this._geometryTypeRequiresClientGraphicMapping(this._layerOrSourceGeometryType)}_geometryRequiresClientGraphicMapping(e){return this._geometryTypeRequiresClientGraphicMapping(e.type)}_geometryTypeRequiresClientGraphicMapping(e){return e==="mesh"||e==="multipatch"||e==="extent"}_serializeFeature(e){const{attributes:r}=e,i=this._geometryForSerialization(e),s=(hke++).toString();return i?{uid:s,geometry:i.toJSON(),attributes:r}:{uid:s,attributes:r}}_geometryForSerialization(e){const{geometry:r}=e;return r==null?null:this._geometryRequiresClientGraphicMapping(r)?r.extent?Jd.fromExtent(r.extent):null:r}async _startWorker(e){this._connection=await _0e("MemorySourceWorker",{strategy:oe("feature-layers-workers")?"dedicated":"local",signal:e});const{fields:r,spatialReference:i,objectIdField:s,hasM:n,hasZ:o,timeInfo:a}=this.layer,l=this.layer.originOf("spatialReference")==="defaults";await this._prepareClientMapping(this.items,e);const c=this._prepareAddFeatures(this.items);this.handles.add(this.on("before-changes",m=>{xU.error("Source modifications will not propagate after layer has been loaded. Please use .applyEdits() instead"),m.preventDefault()}));const h={features:c.features,fields:r&&r.map(m=>m.toJSON()),geometryType:yK.toJSON(this._workerGeometryType),hasM:this._layerOrSourceGeometryType!=="mesh"&&n,hasZ:this._layerOrSourceGeometryType==="mesh"||o,objectIdField:s,spatialReference:l?null:i&&i.toJSON(),timeInfo:a?a.toJSON():null},p=await this._connection.invoke("load",h,{signal:e});for(const m of p.warnings)xU.warn(m.message,{layer:this.layer,warning:m});p.featureErrors.length&&xU.warn(`Encountered ${p.featureErrors.length} validation errors while loading features`,p.featureErrors);const f=p.layerDefinition;this._geometryTypeRequiresClientGraphicMapping(c.inferredGeometryType)&&(f.geometryType=yK.toJSON(c.inferredGeometryType)),this.sourceJSON=f,this._requiresClientGraphicMapping()&&(this._idToClientGraphic=new Map),c.finish(p.assignedObjectIds)}};u([PW({Type:Oh,ensureType:Zs(Oh)})],Km.prototype,"itemType",void 0),u([d()],Km.prototype,"type",void 0),u([d({constructOnly:!0})],Km.prototype,"layer",void 0),u([d({readOnly:!0})],Km.prototype,"_workerGeometryType",null),u([d()],Km.prototype,"sourceJSON",void 0),Km=u([R(x0e)],Km);function dke(t){return"portalItem"in t}const T0e=t=>{let e=class extends t{get apiKey(){return this._isOverridden("apiKey")?this._get("apiKey"):dke(this)?this.portalItem?.apiKey:null}set apiKey(r){r!=null?this._override("apiKey",r):(this._clearOverride("apiKey"),this.clear("apiKey","user"))}};return u([d({type:String})],e.prototype,"apiKey",null),e=u([R("esri.layers.mixins.APIKeyMixin")],e),e},S0e=t=>{let e=class extends t{get title(){if(this._get("title")&&this.originOf("title")!=="defaults")return this._get("title");if(this.url){const r=Iw(this.url);if(r!=null&&r.title)return r.title}return this._get("title")||""}set title(r){this._set("title",r)}set url(r){this._set("url",m8e(r,Q.getLogger(this)))}};return u([d()],e.prototype,"title",null),u([d({type:String})],e.prototype,"url",null),e=u([R("esri.layers.mixins.ArcGISService")],e),e};function o5(){const t=new Float32Array(16);return t[0]=1,t[5]=1,t[10]=1,t[15]=1,t}function pke(t){const e=new Float32Array(16);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e}function fke(t,e,r,i,s,n,o,a,l,c,h,p,f,m,y,_){const v=new Float32Array(16);return v[0]=t,v[1]=e,v[2]=r,v[3]=i,v[4]=s,v[5]=n,v[6]=o,v[7]=a,v[8]=l,v[9]=c,v[10]=h,v[11]=p,v[12]=f,v[13]=m,v[14]=y,v[15]=_,v}function mke(t,e){return new Float32Array(t,e,16)}const gke=o5();Object.freeze(Object.defineProperty({__proto__:null,IDENTITY:gke,clone:pke,create:o5,createView:mke,fromValues:fke},Symbol.toStringTag,{value:"Module"}));function Ls(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t}function tm(t,e,r,i,s,n,o,a,l,c,h,p,f,m,y,_,v){return t[0]=e,t[1]=r,t[2]=i,t[3]=s,t[4]=n,t[5]=o,t[6]=a,t[7]=l,t[8]=c,t[9]=h,t[10]=p,t[11]=f,t[12]=m,t[13]=y,t[14]=_,t[15]=v,t}function Rh(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function xc(t,e){if(t===e){const r=e[1],i=e[2],s=e[3],n=e[6],o=e[7],a=e[11];t[1]=e[4],t[2]=e[8],t[3]=e[12],t[4]=r,t[6]=e[9],t[7]=e[13],t[8]=i,t[9]=n,t[11]=e[14],t[12]=s,t[13]=o,t[14]=a}else t[0]=e[0],t[1]=e[4],t[2]=e[8],t[3]=e[12],t[4]=e[1],t[5]=e[5],t[6]=e[9],t[7]=e[13],t[8]=e[2],t[9]=e[6],t[10]=e[10],t[11]=e[14],t[12]=e[3],t[13]=e[7],t[14]=e[11],t[15]=e[15];return t}function lE(t,e){return On(t,e)||Rh(t),t}function On(t,e){const r=e[0],i=e[1],s=e[2],n=e[3],o=e[4],a=e[5],l=e[6],c=e[7],h=e[8],p=e[9],f=e[10],m=e[11],y=e[12],_=e[13],v=e[14],w=e[15],x=r*a-i*o,T=r*l-s*o,S=r*c-n*o,O=i*l-s*a,A=i*c-n*a,I=s*c-n*l,M=h*_-p*y,k=h*v-f*y,L=h*w-m*y,D=p*v-f*_,U=p*w-m*_,X=f*w-m*v;let W=x*X-T*U+S*D+O*L-A*k+I*M;return W?(W=1/W,t[0]=(a*X-l*U+c*D)*W,t[1]=(s*U-i*X-n*D)*W,t[2]=(_*I-v*A+w*O)*W,t[3]=(f*A-p*I-m*O)*W,t[4]=(l*L-o*X-c*k)*W,t[5]=(r*X-s*L+n*k)*W,t[6]=(v*S-y*I-w*T)*W,t[7]=(h*I-f*S+m*T)*W,t[8]=(o*U-a*L+c*M)*W,t[9]=(i*L-r*U-n*M)*W,t[10]=(y*A-_*S+w*x)*W,t[11]=(p*S-h*A-m*x)*W,t[12]=(a*k-o*D-l*M)*W,t[13]=(r*D-i*k+s*M)*W,t[14]=(_*T-y*O-v*x)*W,t[15]=(h*O-p*T+f*x)*W,t):null}function yke(t,e){const r=e[0],i=e[1],s=e[2],n=e[3],o=e[4],a=e[5],l=e[6],c=e[7],h=e[8],p=e[9],f=e[10],m=e[11],y=e[12],_=e[13],v=e[14],w=e[15];return t[0]=a*(f*w-m*v)-p*(l*w-c*v)+_*(l*m-c*f),t[1]=-(i*(f*w-m*v)-p*(s*w-n*v)+_*(s*m-n*f)),t[2]=i*(l*w-c*v)-a*(s*w-n*v)+_*(s*c-n*l),t[3]=-(i*(l*m-c*f)-a*(s*m-n*f)+p*(s*c-n*l)),t[4]=-(o*(f*w-m*v)-h*(l*w-c*v)+y*(l*m-c*f)),t[5]=r*(f*w-m*v)-h*(s*w-n*v)+y*(s*m-n*f),t[6]=-(r*(l*w-c*v)-o*(s*w-n*v)+y*(s*c-n*l)),t[7]=r*(l*m-c*f)-o*(s*m-n*f)+h*(s*c-n*l),t[8]=o*(p*w-m*_)-h*(a*w-c*_)+y*(a*m-c*p),t[9]=-(r*(p*w-m*_)-h*(i*w-n*_)+y*(i*m-n*p)),t[10]=r*(a*w-c*_)-o*(i*w-n*_)+y*(i*c-n*a),t[11]=-(r*(a*m-c*p)-o*(i*m-n*p)+h*(i*c-n*a)),t[12]=-(o*(p*v-f*_)-h*(a*v-l*_)+y*(a*f-l*p)),t[13]=r*(p*v-f*_)-h*(i*v-s*_)+y*(i*f-s*p),t[14]=-(r*(a*v-l*_)-o*(i*v-s*_)+y*(i*l-s*a)),t[15]=r*(a*f-l*p)-o*(i*f-s*p)+h*(i*l-s*a),t}function _ke(t){const e=t[0],r=t[1],i=t[2],s=t[3],n=t[4],o=t[5],a=t[6],l=t[7],c=t[8],h=t[9],p=t[10],f=t[11],m=t[12],y=t[13],_=t[14],v=t[15];return(e*o-r*n)*(p*v-f*_)-(e*a-i*n)*(h*v-f*y)+(e*l-s*n)*(h*_-p*y)+(r*a-i*o)*(c*v-f*m)-(r*l-s*o)*(c*_-p*m)+(i*l-s*a)*(c*y-h*m)}function si(t,e,r){const i=e[0],s=e[1],n=e[2],o=e[3],a=e[4],l=e[5],c=e[6],h=e[7],p=e[8],f=e[9],m=e[10],y=e[11],_=e[12],v=e[13],w=e[14],x=e[15];let T=r[0],S=r[1],O=r[2],A=r[3];return t[0]=T*i+S*a+O*p+A*_,t[1]=T*s+S*l+O*f+A*v,t[2]=T*n+S*c+O*m+A*w,t[3]=T*o+S*h+O*y+A*x,T=r[4],S=r[5],O=r[6],A=r[7],t[4]=T*i+S*a+O*p+A*_,t[5]=T*s+S*l+O*f+A*v,t[6]=T*n+S*c+O*m+A*w,t[7]=T*o+S*h+O*y+A*x,T=r[8],S=r[9],O=r[10],A=r[11],t[8]=T*i+S*a+O*p+A*_,t[9]=T*s+S*l+O*f+A*v,t[10]=T*n+S*c+O*m+A*w,t[11]=T*o+S*h+O*y+A*x,T=r[12],S=r[13],O=r[14],A=r[15],t[12]=T*i+S*a+O*p+A*_,t[13]=T*s+S*l+O*f+A*v,t[14]=T*n+S*c+O*m+A*w,t[15]=T*o+S*h+O*y+A*x,t}function Al(t,e,r){const i=r[0],s=r[1],n=r[2];if(e===t)t[12]=e[0]*i+e[4]*s+e[8]*n+e[12],t[13]=e[1]*i+e[5]*s+e[9]*n+e[13],t[14]=e[2]*i+e[6]*s+e[10]*n+e[14],t[15]=e[3]*i+e[7]*s+e[11]*n+e[15];else{const o=e[0],a=e[1],l=e[2],c=e[3],h=e[4],p=e[5],f=e[6],m=e[7],y=e[8],_=e[9],v=e[10],w=e[11];t[0]=o,t[1]=a,t[2]=l,t[3]=c,t[4]=h,t[5]=p,t[6]=f,t[7]=m,t[8]=y,t[9]=_,t[10]=v,t[11]=w,t[12]=o*i+h*s+y*n+e[12],t[13]=a*i+p*s+_*n+e[13],t[14]=l*i+f*s+v*n+e[14],t[15]=c*i+m*s+w*n+e[15]}return t}function a5(t,e,r){const i=r[0],s=r[1],n=r[2];return t[0]=e[0]*i,t[1]=e[1]*i,t[2]=e[2]*i,t[3]=e[3]*i,t[4]=e[4]*s,t[5]=e[5]*s,t[6]=e[6]*s,t[7]=e[7]*s,t[8]=e[8]*n,t[9]=e[9]*n,t[10]=e[10]*n,t[11]=e[11]*n,t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t}function dc(t,e,r,i){let s,n,o,a,l,c,h,p,f,m,y,_,v,w,x,T,S,O,A,I,M,k,L,D,U=i[0],X=i[1],W=i[2],G=Math.sqrt(U*U+X*X+W*W);return G<Xa()?null:(G=1/G,U*=G,X*=G,W*=G,s=Math.sin(r),n=Math.cos(r),o=1-n,a=e[0],l=e[1],c=e[2],h=e[3],p=e[4],f=e[5],m=e[6],y=e[7],_=e[8],v=e[9],w=e[10],x=e[11],T=U*U*o+n,S=X*U*o+W*s,O=W*U*o-X*s,A=U*X*o-W*s,I=X*X*o+n,M=W*X*o+U*s,k=U*W*o+X*s,L=X*W*o-U*s,D=W*W*o+n,t[0]=a*T+p*S+_*O,t[1]=l*T+f*S+v*O,t[2]=c*T+m*S+w*O,t[3]=h*T+y*S+x*O,t[4]=a*A+p*I+_*M,t[5]=l*A+f*I+v*M,t[6]=c*A+m*I+w*M,t[7]=h*A+y*I+x*M,t[8]=a*k+p*L+_*D,t[9]=l*k+f*L+v*D,t[10]=c*k+m*L+w*D,t[11]=h*k+y*L+x*D,e!==t&&(t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t)}function u2(t,e,r){const i=Math.sin(r),s=Math.cos(r),n=e[4],o=e[5],a=e[6],l=e[7],c=e[8],h=e[9],p=e[10],f=e[11];return e!==t&&(t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[4]=n*s+c*i,t[5]=o*s+h*i,t[6]=a*s+p*i,t[7]=l*s+f*i,t[8]=c*s-n*i,t[9]=h*s-o*i,t[10]=p*s-a*i,t[11]=f*s-l*i,t}function l5(t,e,r){const i=Math.sin(r),s=Math.cos(r),n=e[0],o=e[1],a=e[2],l=e[3],c=e[8],h=e[9],p=e[10],f=e[11];return e!==t&&(t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[0]=n*s-c*i,t[1]=o*s-h*i,t[2]=a*s-p*i,t[3]=l*s-f*i,t[8]=n*i+c*s,t[9]=o*i+h*s,t[10]=a*i+p*s,t[11]=l*i+f*s,t}function h2(t,e,r){const i=Math.sin(r),s=Math.cos(r),n=e[0],o=e[1],a=e[2],l=e[3],c=e[4],h=e[5],p=e[6],f=e[7];return e!==t&&(t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[0]=n*s+c*i,t[1]=o*s+h*i,t[2]=a*s+p*i,t[3]=l*s+f*i,t[4]=c*s-n*i,t[5]=h*s-o*i,t[6]=p*s-a*i,t[7]=f*s-l*i,t}function zR(t,e){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=e[0],t[13]=e[1],t[14]=e[2],t[15]=1,t}function vke(t,e){return t[0]=e[0],t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=e[1],t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=e[2],t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function mu(t,e,r){if(e===0)return Rh(t);let i,s,n,o=r[0],a=r[1],l=r[2],c=Math.sqrt(o*o+a*a+l*l);return c<Xa()?null:(c=1/c,o*=c,a*=c,l*=c,i=Math.sin(e),s=Math.cos(e),n=1-s,t[0]=o*o*n+s,t[1]=a*o*n+l*i,t[2]=l*o*n-a*i,t[3]=0,t[4]=o*a*n-l*i,t[5]=a*a*n+s,t[6]=l*a*n+o*i,t[7]=0,t[8]=o*l*n+a*i,t[9]=a*l*n-o*i,t[10]=l*l*n+s,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t)}function E0e(t,e){const r=Math.sin(e),i=Math.cos(e);return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=i,t[6]=r,t[7]=0,t[8]=0,t[9]=-r,t[10]=i,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function bke(t,e){const r=Math.sin(e),i=Math.cos(e);return t[0]=i,t[1]=0,t[2]=-r,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=r,t[9]=0,t[10]=i,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function C0e(t,e){const r=Math.sin(e),i=Math.cos(e);return t[0]=i,t[1]=r,t[2]=0,t[3]=0,t[4]=-r,t[5]=i,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function A0e(t,e,r){const i=e[0],s=e[1],n=e[2],o=e[3],a=i+i,l=s+s,c=n+n,h=i*a,p=i*l,f=i*c,m=s*l,y=s*c,_=n*c,v=o*a,w=o*l,x=o*c;return t[0]=1-(m+_),t[1]=p+x,t[2]=f-w,t[3]=0,t[4]=p-x,t[5]=1-(h+_),t[6]=y+v,t[7]=0,t[8]=f+w,t[9]=y-v,t[10]=1-(h+m),t[11]=0,t[12]=r[0],t[13]=r[1],t[14]=r[2],t[15]=1,t}function wke(t,e){const r=xke,i=-e[0],s=-e[1],n=-e[2],o=e[3],a=e[4],l=e[5],c=e[6],h=e[7],p=i*i+s*s+n*n+o*o;return p>0?(r[0]=2*(a*o+h*i+l*n-c*s)/p,r[1]=2*(l*o+h*s+c*i-a*n)/p,r[2]=2*(c*o+h*n+a*s-l*i)/p):(r[0]=2*(a*o+h*i+l*n-c*s),r[1]=2*(l*o+h*s+c*i-a*n),r[2]=2*(c*o+h*n+a*s-l*i)),A0e(t,e,r),t}const xke=C();function jB(t,e){return t[0]=e[12],t[1]=e[13],t[2]=e[14],t}function O0e(t,e){const r=e[0],i=e[1],s=e[2],n=e[4],o=e[5],a=e[6],l=e[8],c=e[9],h=e[10];return t[0]=Math.sqrt(r*r+i*i+s*s),t[1]=Math.sqrt(n*n+o*o+a*a),t[2]=Math.sqrt(l*l+c*c+h*h),t}function Tke(t,e){const r=e[0]+e[5]+e[10];let i=0;return r>0?(i=2*Math.sqrt(r+1),t[3]=.25*i,t[0]=(e[6]-e[9])/i,t[1]=(e[8]-e[2])/i,t[2]=(e[1]-e[4])/i):e[0]>e[5]&&e[0]>e[10]?(i=2*Math.sqrt(1+e[0]-e[5]-e[10]),t[3]=(e[6]-e[9])/i,t[0]=.25*i,t[1]=(e[1]+e[4])/i,t[2]=(e[8]+e[2])/i):e[5]>e[10]?(i=2*Math.sqrt(1+e[5]-e[0]-e[10]),t[3]=(e[8]-e[2])/i,t[0]=(e[1]+e[4])/i,t[1]=.25*i,t[2]=(e[6]+e[9])/i):(i=2*Math.sqrt(1+e[10]-e[0]-e[5]),t[3]=(e[1]-e[4])/i,t[0]=(e[8]+e[2])/i,t[1]=(e[6]+e[9])/i,t[2]=.25*i),t}function Ske(t,e,r,i){const s=e[0],n=e[1],o=e[2],a=e[3],l=s+s,c=n+n,h=o+o,p=s*l,f=s*c,m=s*h,y=n*c,_=n*h,v=o*h,w=a*l,x=a*c,T=a*h,S=i[0],O=i[1],A=i[2];return t[0]=(1-(y+v))*S,t[1]=(f+T)*S,t[2]=(m-x)*S,t[3]=0,t[4]=(f-T)*O,t[5]=(1-(p+v))*O,t[6]=(_+w)*O,t[7]=0,t[8]=(m+x)*A,t[9]=(_-w)*A,t[10]=(1-(p+y))*A,t[11]=0,t[12]=r[0],t[13]=r[1],t[14]=r[2],t[15]=1,t}function Eke(t,e,r,i,s){const n=e[0],o=e[1],a=e[2],l=e[3],c=n+n,h=o+o,p=a+a,f=n*c,m=n*h,y=n*p,_=o*h,v=o*p,w=a*p,x=l*c,T=l*h,S=l*p,O=i[0],A=i[1],I=i[2],M=s[0],k=s[1],L=s[2],D=(1-(_+w))*O,U=(m+S)*O,X=(y-T)*O,W=(m-S)*A,G=(1-(f+w))*A,Y=(v+x)*A,P=(y+T)*I,V=(v-x)*I,z=(1-(f+_))*I;return t[0]=D,t[1]=U,t[2]=X,t[3]=0,t[4]=W,t[5]=G,t[6]=Y,t[7]=0,t[8]=P,t[9]=V,t[10]=z,t[11]=0,t[12]=r[0]+M-(D*M+W*k+P*L),t[13]=r[1]+k-(U*M+G*k+V*L),t[14]=r[2]+L-(X*M+Y*k+z*L),t[15]=1,t}function Cke(t,e){const r=e[0],i=e[1],s=e[2],n=e[3],o=r+r,a=i+i,l=s+s,c=r*o,h=i*o,p=i*a,f=s*o,m=s*a,y=s*l,_=n*o,v=n*a,w=n*l;return t[0]=1-p-y,t[1]=h+w,t[2]=f-v,t[3]=0,t[4]=h-w,t[5]=1-c-y,t[6]=m+_,t[7]=0,t[8]=f+v,t[9]=m-_,t[10]=1-c-p,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function R0e(t,e,r,i,s,n,o){const a=1/(r-e),l=1/(s-i),c=1/(n-o);return t[0]=2*n*a,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=2*n*l,t[6]=0,t[7]=0,t[8]=(r+e)*a,t[9]=(s+i)*l,t[10]=(o+n)*c,t[11]=-1,t[12]=0,t[13]=0,t[14]=o*n*2*c,t[15]=0,t}function Ake(t,e,r,i,s){const n=1/Math.tan(e/2);let o;return t[0]=n/r,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=n,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=-1,t[12]=0,t[13]=0,t[15]=0,s!=null&&s!==1/0?(o=1/(i-s),t[10]=(s+i)*o,t[14]=2*s*i*o):(t[10]=-1,t[14]=-2*i),t}function Oke(t,e,r,i){const s=Math.tan(e.upDegrees*Math.PI/180),n=Math.tan(e.downDegrees*Math.PI/180),o=Math.tan(e.leftDegrees*Math.PI/180),a=Math.tan(e.rightDegrees*Math.PI/180),l=2/(o+a),c=2/(s+n);return t[0]=l,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=c,t[6]=0,t[7]=0,t[8]=-(o-a)*l*.5,t[9]=(s-n)*c*.5,t[10]=i/(r-i),t[11]=-1,t[12]=0,t[13]=0,t[14]=i*r/(r-i),t[15]=0,t}function P0e(t,e,r,i,s,n,o){const a=1/(e-r),l=1/(i-s),c=1/(n-o);return t[0]=-2*a,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=-2*l,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=2*c,t[11]=0,t[12]=(e+r)*a,t[13]=(s+i)*l,t[14]=(o+n)*c,t[15]=1,t}function c5(t,e,r,i){const s=e[0],n=e[1],o=e[2];let a=s-r[0],l=n-r[1],c=o-r[2];const h=Xa();if(Math.abs(a)<h&&Math.abs(l)<h&&Math.abs(c)<h)return void Rh(t);let p=1/Math.sqrt(a*a+l*l+c*c);a*=p,l*=p,c*=p;const f=i[0],m=i[1],y=i[2];let _=m*c-y*l,v=y*a-f*c,w=f*l-m*a;p=Math.sqrt(_*_+v*v+w*w),p?(p=1/p,_*=p,v*=p,w*=p):(_=0,v=0,w=0);let x=l*w-c*v,T=c*_-a*w,S=a*v-l*_;p=Math.sqrt(x*x+T*T+S*S),p?(p=1/p,x*=p,T*=p,S*=p):(x=0,T=0,S=0),t[0]=_,t[1]=x,t[2]=a,t[3]=0,t[4]=v,t[5]=T,t[6]=l,t[7]=0,t[8]=w,t[9]=S,t[10]=c,t[11]=0,t[12]=-(_*s+v*n+w*o),t[13]=-(x*s+T*n+S*o),t[14]=-(a*s+l*n+c*o),t[15]=1}function M0e(t,e,r,i){const s=e[0],n=e[1],o=e[2],a=i[0],l=i[1],c=i[2];let h=s-r[0],p=n-r[1],f=o-r[2],m=h*h+p*p+f*f;m>0&&(m=1/Math.sqrt(m),h*=m,p*=m,f*=m);let y=l*f-c*p,_=c*h-a*f,v=a*p-l*h;return m=y*y+_*_+v*v,m>0&&(m=1/Math.sqrt(m),y*=m,_*=m,v*=m),t[0]=y,t[1]=_,t[2]=v,t[3]=0,t[4]=p*v-f*_,t[5]=f*y-h*v,t[6]=h*_-p*y,t[7]=0,t[8]=h,t[9]=p,t[10]=f,t[11]=0,t[12]=s,t[13]=n,t[14]=o,t[15]=1,t}function Rke(t){return"mat4("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+", "+t[4]+", "+t[5]+", "+t[6]+", "+t[7]+", "+t[8]+", "+t[9]+", "+t[10]+", "+t[11]+", "+t[12]+", "+t[13]+", "+t[14]+", "+t[15]+")"}function Pke(t){return Math.sqrt(t[0]**2+t[1]**2+t[2]**2+t[3]**2+t[4]**2+t[5]**2+t[6]**2+t[7]**2+t[8]**2+t[9]**2+t[10]**2+t[11]**2+t[12]**2+t[13]**2+t[14]**2+t[15]**2)}function Mke(t,e,r){return t[0]=e[0]+r[0],t[1]=e[1]+r[1],t[2]=e[2]+r[2],t[3]=e[3]+r[3],t[4]=e[4]+r[4],t[5]=e[5]+r[5],t[6]=e[6]+r[6],t[7]=e[7]+r[7],t[8]=e[8]+r[8],t[9]=e[9]+r[9],t[10]=e[10]+r[10],t[11]=e[11]+r[11],t[12]=e[12]+r[12],t[13]=e[13]+r[13],t[14]=e[14]+r[14],t[15]=e[15]+r[15],t}function I0e(t,e,r){return t[0]=e[0]-r[0],t[1]=e[1]-r[1],t[2]=e[2]-r[2],t[3]=e[3]-r[3],t[4]=e[4]-r[4],t[5]=e[5]-r[5],t[6]=e[6]-r[6],t[7]=e[7]-r[7],t[8]=e[8]-r[8],t[9]=e[9]-r[9],t[10]=e[10]-r[10],t[11]=e[11]-r[11],t[12]=e[12]-r[12],t[13]=e[13]-r[13],t[14]=e[14]-r[14],t[15]=e[15]-r[15],t}function Ike(t,e,r){return t[0]=e[0]*r,t[1]=e[1]*r,t[2]=e[2]*r,t[3]=e[3]*r,t[4]=e[4]*r,t[5]=e[5]*r,t[6]=e[6]*r,t[7]=e[7]*r,t[8]=e[8]*r,t[9]=e[9]*r,t[10]=e[10]*r,t[11]=e[11]*r,t[12]=e[12]*r,t[13]=e[13]*r,t[14]=e[14]*r,t[15]=e[15]*r,t}function $ke(t,e,r,i){return t[0]=e[0]+r[0]*i,t[1]=e[1]+r[1]*i,t[2]=e[2]+r[2]*i,t[3]=e[3]+r[3]*i,t[4]=e[4]+r[4]*i,t[5]=e[5]+r[5]*i,t[6]=e[6]+r[6]*i,t[7]=e[7]+r[7]*i,t[8]=e[8]+r[8]*i,t[9]=e[9]+r[9]*i,t[10]=e[10]+r[10]*i,t[11]=e[11]+r[11]*i,t[12]=e[12]+r[12]*i,t[13]=e[13]+r[13]*i,t[14]=e[14]+r[14]*i,t[15]=e[15]+r[15]*i,t}function $0e(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]&&t[4]===e[4]&&t[5]===e[5]&&t[6]===e[6]&&t[7]===e[7]&&t[8]===e[8]&&t[9]===e[9]&&t[10]===e[10]&&t[11]===e[11]&&t[12]===e[12]&&t[13]===e[13]&&t[14]===e[14]&&t[15]===e[15]}function yZ(t,e){if(t===e)return!0;const r=t[0],i=t[1],s=t[2],n=t[3],o=t[4],a=t[5],l=t[6],c=t[7],h=t[8],p=t[9],f=t[10],m=t[11],y=t[12],_=t[13],v=t[14],w=t[15],x=e[0],T=e[1],S=e[2],O=e[3],A=e[4],I=e[5],M=e[6],k=e[7],L=e[8],D=e[9],U=e[10],X=e[11],W=e[12],G=e[13],Y=e[14],P=e[15],V=Xa();return Math.abs(r-x)<=V*Math.max(1,Math.abs(r),Math.abs(x))&&Math.abs(i-T)<=V*Math.max(1,Math.abs(i),Math.abs(T))&&Math.abs(s-S)<=V*Math.max(1,Math.abs(s),Math.abs(S))&&Math.abs(n-O)<=V*Math.max(1,Math.abs(n),Math.abs(O))&&Math.abs(o-A)<=V*Math.max(1,Math.abs(o),Math.abs(A))&&Math.abs(a-I)<=V*Math.max(1,Math.abs(a),Math.abs(I))&&Math.abs(l-M)<=V*Math.max(1,Math.abs(l),Math.abs(M))&&Math.abs(c-k)<=V*Math.max(1,Math.abs(c),Math.abs(k))&&Math.abs(h-L)<=V*Math.max(1,Math.abs(h),Math.abs(L))&&Math.abs(p-D)<=V*Math.max(1,Math.abs(p),Math.abs(D))&&Math.abs(f-U)<=V*Math.max(1,Math.abs(f),Math.abs(U))&&Math.abs(m-X)<=V*Math.max(1,Math.abs(m),Math.abs(X))&&Math.abs(y-W)<=V*Math.max(1,Math.abs(y),Math.abs(W))&&Math.abs(_-G)<=V*Math.max(1,Math.abs(_),Math.abs(G))&&Math.abs(v-Y)<=V*Math.max(1,Math.abs(v),Math.abs(Y))&&Math.abs(w-P)<=V*Math.max(1,Math.abs(w),Math.abs(P))}function _Z(t){const e=Xa(),r=t[0],i=t[1],s=t[2],n=t[4],o=t[5],a=t[6],l=t[8],c=t[9],h=t[10];return Math.abs(1-(r*r+n*n+l*l))<=e&&Math.abs(1-(i*i+o*o+c*c))<=e&&Math.abs(1-(s*s+a*a+h*h))<=e}function u5(t){return t[0]===1&&t[1]===0&&t[2]===0&&t[4]===0&&t[5]===1&&t[6]===0&&t[8]===0&&t[9]===0&&t[10]===1}const Lke=si,Dke=I0e;Object.freeze(Object.defineProperty({__proto__:null,add:Mke,adjoint:yke,copy:Ls,determinant:_ke,equals:yZ,exactEquals:$0e,frob:Pke,fromQuat:Cke,fromQuat2:wke,fromRotation:mu,fromRotationTranslation:A0e,fromRotationTranslationScale:Ske,fromRotationTranslationScaleOrigin:Eke,fromScaling:vke,fromTranslation:zR,fromXRotation:E0e,fromYRotation:bke,fromZRotation:C0e,frustum:R0e,getRotation:Tke,getScaling:O0e,getTranslation:jB,hasIdentityRotation:u5,identity:Rh,invert:On,invertOrIdentity:lE,isOrthoNormal:_Z,lookAt:c5,mul:Lke,multiply:si,multiplyScalar:Ike,multiplyScalarAndAdd:$ke,ortho:P0e,perspective:Ake,perspectiveFromFieldOfView:Oke,rotate:dc,rotateX:u2,rotateY:l5,rotateZ:h2,scale:a5,set:tm,str:Rke,sub:Dke,subtract:I0e,targetTo:M0e,translate:Al,transpose:xc},Symbol.toStringTag,{value:"Module"}));const Nke=(t,e)=>{const r=tm(t,e,0,0,0,0,e,0,0,0,0,e,0,0,0,0,1);return xc(r,r)},Fke=(t,e)=>{const r=tm(t,e,0,0,.5-.5*e,0,e,0,.5-.5*e,0,0,e,.5-.5*e,0,0,0,1);return xc(r,r)},Uke=(t,e)=>{const r=1-e,i=tm(t,.2126+.7874*r,.7152-.7152*r,.0722-.0722*r,0,.2126-.2126*r,.7152+.2848*r,.0722-.0722*r,0,.2126-.2126*r,.7152-.7152*r,.0722+.9278*r,0,0,0,0,1);return xc(i,i)},kke=(t,e)=>{const r=Math.sin(e*Math.PI/180),i=Math.cos(e*Math.PI/180),s=tm(t,.213+.787*i-.213*r,.715-.715*i-.715*r,.072-.072*i+.928*r,0,.213-.213*i+.143*r,.715+.285*i+.14*r,.072-.072*i-.283*r,0,.213-.213*i-.787*r,.715-.715*i+.715*r,.072+.928*i+.072*r,0,0,0,0,1);return xc(s,s)},Vke=(t,e)=>{const r=1-2*e,i=tm(t,r,0,0,e,0,r,0,e,0,0,r,e,0,0,0,1);return xc(i,i)},zke=(t,e)=>{const r=tm(t,.213+.787*e,.715-.715*e,.072-.072*e,0,.213-.213*e,.715+.285*e,.072-.072*e,0,.213-.213*e,.715-.715*e,.072+.928*e,0,0,0,0,1);return xc(r,r)},Bke=(t,e)=>{const r=1-e,i=tm(t,.393+.607*r,.769-.769*r,.189-.189*r,0,.349-.349*r,.686+.314*r,.168-.168*r,0,.272-.272*r,.534-.534*r,.131+.869*r,0,0,0,0,1);return xc(i,i)};let L0e=class D0e{constructor(e,r,i){this.strength=e,this.radius=r,this.threshold=i,this.type="bloom"}interpolate(e,r,i){this.strength=ic(e.strength,r.strength,i),this.radius=ic(e.radius,r.radius,i),this.threshold=ic(e.threshold,r.threshold,i)}clone(){return new D0e(this.strength,this.radius,this.threshold)}toJSON(){return{type:"bloom",radius:P3(this.radius),strength:this.strength,threshold:this.threshold}}},N0e=class F0e{constructor(e){this.radius=e,this.type="blur"}interpolate(e,r,i){this.radius=Math.round(ic(e.radius,r.radius,i))}clone(){return new F0e(this.radius)}toJSON(){return{type:"blur",radius:P3(this.radius)}}},HB=class U0e{constructor(e,r){this.type=e,this.amount=r,this.type!=="invert"&&this.type!=="grayscale"&&this.type!=="sepia"||(this.amount=Math.min(this.amount,1))}get colorMatrix(){return this._colorMatrix||this._updateMatrix(),this._colorMatrix}interpolate(e,r,i){this.amount=ic(e.amount,r.amount,i),this._updateMatrix()}clone(){return new U0e(this.type,this.amount)}toJSON(){return{type:this.type,amount:this.amount}}_updateMatrix(){const e=this._colorMatrix||o5();switch(this.type){case"brightness":this._colorMatrix=Nke(e,this.amount);break;case"contrast":this._colorMatrix=Fke(e,this.amount);break;case"grayscale":this._colorMatrix=Uke(e,this.amount);break;case"invert":this._colorMatrix=Vke(e,this.amount);break;case"saturate":this._colorMatrix=zke(e,this.amount);break;case"sepia":this._colorMatrix=Bke(e,this.amount)}}},k0e=class V0e{constructor(e,r,i,s){this.offsetX=e,this.offsetY=r,this.blurRadius=i,this.color=s,this.type="drop-shadow"}interpolate(e,r,i){this.offsetX=ic(e.offsetX,r.offsetX,i),this.offsetY=ic(e.offsetY,r.offsetY,i),this.blurRadius=ic(e.blurRadius,r.blurRadius,i),this.color[0]=Math.round(ic(e.color[0],r.color[0],i)),this.color[1]=Math.round(ic(e.color[1],r.color[1],i)),this.color[2]=Math.round(ic(e.color[2],r.color[2],i)),this.color[3]=ic(e.color[3],r.color[3],i)}clone(){return new V0e(this.offsetX,this.offsetY,this.blurRadius,[...this.color])}toJSON(){const e=[...this.color];return e[3]*=255,{type:"drop-shadow",xoffset:P3(this.offsetX),yoffset:P3(this.offsetY),blurRadius:P3(this.blurRadius),color:e}}},z0e=class B0e{constructor(e){this.angle=e,this.type="hue-rotate"}get colorMatrix(){return this._colorMatrix||this._updateMatrix(),this._colorMatrix}interpolate(e,r,i){this.angle=ic(e.angle,r.angle,i),this._updateMatrix()}clone(){return new B0e(this.angle)}toJSON(){return{type:"hue-rotate",angle:this.angle}}_updateMatrix(){const e=this._colorMatrix||o5();this._colorMatrix=kke(e,this.angle)}},G0e=class j0e{constructor(e){this.amount=e,this.type="opacity",this.amount=Math.min(this.amount,1)}interpolate(e,r,i){this.amount=ic(e.amount,r.amount,i)}clone(){return new j0e(this.amount)}toJSON(){return{type:"opacity",amount:this.amount}}};function ic(t,e,r){return t+(e-t)*r}function P3(t){return Math.round(1e3*fu(t))/1e3}function Gke(t){switch(t.type){case"grayscale":case"sepia":case"invert":return new HB(t.type,0);case"saturate":case"brightness":case"contrast":return new HB(t.type,1);case"opacity":return new G0e(1);case"hue-rotate":return new z0e(0);case"blur":return new N0e(0);case"drop-shadow":return new k0e(0,0,0,[...FW("transparent")]);case"bloom":return new L0e(0,0,1)}}var bCt=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function BR(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}function jke(t,e){const r=t.length>e.length?t:e;return(t.length>e.length?e:t).every((i,s)=>i.type===r[s].type)}function Hke(t,e){const r=t.length>e.length?t:e,i=t.length>e.length?e:t;for(let s=i.length;s<r.length;s++)i.push(Gke(r[s]))}function qke(t){const e=t[0];return!!e&&"type"in e}var Jee,Qee,qB={exports:{}};qB.exports,Qee=function(){function t(s,n){function o(){this.constructor=s}o.prototype=n.prototype,s.prototype=new o}function e(s,n,o,a){var l=Error.call(this,s);return Object.setPrototypeOf&&Object.setPrototypeOf(l,e.prototype),l.expected=n,l.found=o,l.location=a,l.name="SyntaxError",l}function r(s,n,o){return o=o||" ",s.length>n?s:(n-=s.length,s+(o+=o.repeat(n)).slice(0,n))}function i(s,n){var o,a={},l=(n=n!==void 0?n:{}).grammarSource,c={start:lm},h=lm,p="none",f=")",m=",",y="(",_="%",v="px",w="cm",x="mm",T="in",S="pt",O="pc",A="deg",I="rad",M="grad",k="turn",L="#",D=".",U="e",X=/^[ \t\n\r]/,W=/^[a-z\-]/,G=/^[0-9a-fA-F]/,Y=/^[+\-]/,P=/^[0-9]/,V=Ya("none"),z=$n("none",!1),H=$n(")",!1),Z=$n(",",!1),J=Ya("whitespace"),re=sv([" ","	",`
`,"\r"],!1,!1),ye=Ya("function"),Ne=$n("(",!1),yt=Ya("identifier"),Ot=sv([["a","z"],"-"],!1,!1),lt=Ya("percentage"),_t=$n("%",!1),_e=Ya("length"),Ae=$n("px",!1),xt=$n("cm",!1),ve=$n("mm",!1),Be=$n("in",!1),qe=$n("pt",!1),ft=$n("pc",!1),ct=Ya("angle"),Ge=$n("deg",!1),vt=$n("rad",!1),cr=$n("grad",!1),rr=$n("turn",!1),fi=Ya("number"),rt=Ya("color"),it=$n("#",!1),mt=sv([["0","9"],["a","f"],["A","F"]],!1,!1),Yt=sv(["+","-"],!1,!1),ir=sv([["0","9"]],!1,!1),Hr=$n(".",!1),mi=$n("e",!1),Jt=function(){return[]},gi=function(j,pe){return{type:"function",name:j,parameters:pe||[]}},Di=function(j,pe){return pe.length>0?CE(j,pe,3):[j]},zr=function(j){return{type:"quantity",value:j.value,unit:j.unit}},xr=function(j){return{type:"color",colorType:j.type,value:j.value}},Bi=function(j){return j},ys=function(){return Pl()},Mr=function(j){return{value:j,unit:"%"}},ti=function(j){return{value:j,unit:"px"}},qr=function(j){return{value:j,unit:"cm"}},fr=function(j){return{value:j,unit:"mm"}},ai=function(j){return{value:j,unit:"in"}},zs=function(j){return{value:j,unit:"pt"}},Kn=function(j){return{value:j,unit:"pc"}},eo=function(j){return{value:j,unit:"deg"}},mn=function(j){return{value:j,unit:"rad"}},gn=function(j){return{value:j,unit:"grad"}},Gi=function(j){return{value:j,unit:"turn"}},yn=function(j){return{value:j,unit:null}},Wr=function(){return{type:"hex",value:Pl()}},Mn=function(j){return{type:"function",value:j}},So=function(){return{type:"named",value:Pl()}},fa=function(){return parseFloat(Pl())},ne=0,Ti=0,Bh=[{line:1,column:1}],In=0,Gh=[],Qe=0;if("startRule"in n){if(!(n.startRule in c))throw new Error(`Can't start parsing from rule "`+n.startRule+'".');h=c[n.startRule]}function Pl(){return s.substring(Ti,ne)}function $n(j,pe){return{type:"literal",text:j,ignoreCase:pe}}function sv(j,pe,Se){return{type:"class",parts:j,inverted:pe,ignoreCase:Se}}function nv(){return{type:"end"}}function Ya(j){return{type:"other",description:j}}function am(j){var pe,Se=Bh[j];if(Se)return Se;for(pe=j-1;!Bh[pe];)pe--;for(Se={line:(Se=Bh[pe]).line,column:Se.column};pe<j;)s.charCodeAt(pe)===10?(Se.line++,Se.column=1):Se.column++,pe++;return Bh[j]=Se,Se}function ov(j,pe,Se){var ur=am(j),Bs=am(pe),yi={source:l,start:{offset:j,line:ur.line,column:ur.column},end:{offset:pe,line:Bs.line,column:Bs.column}};return Se&&l&&typeof l.offset=="function"&&(yi.start=l.offset(yi.start),yi.end=l.offset(yi.end)),yi}function Qt(j){ne<In||(ne>In&&(In=ne,Gh=[]),Gh.push(j))}function ly(j,pe,Se){return new e(e.buildMessage(j,pe),j,pe,Se)}function lm(){var j;return(j=cy())===a&&(j=ma()),j}function cy(){var j,pe;return Qe++,j=ne,Qi(),s.substr(ne,4)===p?(pe=p,ne+=4):(pe=a,Qe===0&&Qt(z)),pe!==a?(Qi(),Ti=j,j=Jt()):(ne=j,j=a),Qe--,j===a&&Qe===0&&Qt(V),j}function ma(){var j,pe;if(j=[],(pe=Ml())!==a)for(;pe!==a;)j.push(pe),pe=Ml();else j=a;return j}function Ml(){var j,pe,Se,ur;return j=ne,Qi(),(pe=uy())!==a?(Qi(),(Se=yp())===a&&(Se=null),Qi(),s.charCodeAt(ne)===41?(ur=f,ne++):(ur=a,Qe===0&&Qt(H)),ur!==a?(Qi(),Ti=j,j=gi(pe,Se)):(ne=j,j=a)):(ne=j,j=a),j}function yp(){var j,pe,Se,ur,Bs,yi,ga,uv;if(j=ne,(pe=Ln())!==a){for(Se=[],ur=ne,Bs=Qi(),s.charCodeAt(ne)===44?(yi=m,ne++):(yi=a,Qe===0&&Qt(Z)),yi===a&&(yi=null),ga=Qi(),(uv=Ln())!==a?ur=Bs=[Bs,yi,ga,uv]:(ne=ur,ur=a);ur!==a;)Se.push(ur),ur=ne,Bs=Qi(),s.charCodeAt(ne)===44?(yi=m,ne++):(yi=a,Qe===0&&Qt(Z)),yi===a&&(yi=null),ga=Qi(),(uv=Ln())!==a?ur=Bs=[Bs,yi,ga,uv]:(ne=ur,ur=a);Ti=j,j=Di(pe,Se)}else ne=j,j=a;return j}function Ln(){var j,pe;return j=ne,(pe=lv())===a&&(pe=Gw())===a&&(pe=cv())===a&&(pe=hy()),pe!==a&&(Ti=j,pe=zr(pe)),(j=pe)===a&&(j=ne,(pe=vP())!==a&&(Ti=j,pe=xr(pe)),j=pe),j}function Qi(){var j,pe;for(Qe++,j=[],X.test(s.charAt(ne))?(pe=s.charAt(ne),ne++):(pe=a,Qe===0&&Qt(re));pe!==a;)j.push(pe),X.test(s.charAt(ne))?(pe=s.charAt(ne),ne++):(pe=a,Qe===0&&Qt(re));return Qe--,pe=a,Qe===0&&Qt(J),j}function uy(){var j,pe,Se;return Qe++,j=ne,(pe=av())!==a?(s.charCodeAt(ne)===40?(Se=y,ne++):(Se=a,Qe===0&&Qt(Ne)),Se!==a?(Ti=j,j=Bi(pe)):(ne=j,j=a)):(ne=j,j=a),Qe--,j===a&&(pe=a,Qe===0&&Qt(ye)),j}function av(){var j,pe,Se;if(Qe++,j=ne,pe=[],W.test(s.charAt(ne))?(Se=s.charAt(ne),ne++):(Se=a,Qe===0&&Qt(Ot)),Se!==a)for(;Se!==a;)pe.push(Se),W.test(s.charAt(ne))?(Se=s.charAt(ne),ne++):(Se=a,Qe===0&&Qt(Ot));else pe=a;return pe!==a&&(Ti=j,pe=ys()),Qe--,(j=pe)===a&&(pe=a,Qe===0&&Qt(yt)),j}function lv(){var j,pe,Se;return Qe++,j=ne,Qi(),(pe=Ja())!==a?(s.charCodeAt(ne)===37?(Se=_,ne++):(Se=a,Qe===0&&Qt(_t)),Se!==a?(Ti=j,j=Mr(pe)):(ne=j,j=a)):(ne=j,j=a),Qe--,j===a&&Qe===0&&Qt(lt),j}function Gw(){var j,pe,Se;return Qe++,j=ne,Qi(),(pe=Ja())!==a?(s.substr(ne,2)===v?(Se=v,ne+=2):(Se=a,Qe===0&&Qt(Ae)),Se!==a?(Ti=j,j=ti(pe)):(ne=j,j=a)):(ne=j,j=a),j===a&&(j=ne,Qi(),(pe=Ja())!==a?(s.substr(ne,2)===w?(Se=w,ne+=2):(Se=a,Qe===0&&Qt(xt)),Se!==a?(Ti=j,j=qr(pe)):(ne=j,j=a)):(ne=j,j=a),j===a&&(j=ne,Qi(),(pe=Ja())!==a?(s.substr(ne,2)===x?(Se=x,ne+=2):(Se=a,Qe===0&&Qt(ve)),Se!==a?(Ti=j,j=fr(pe)):(ne=j,j=a)):(ne=j,j=a),j===a&&(j=ne,Qi(),(pe=Ja())!==a?(s.substr(ne,2)===T?(Se=T,ne+=2):(Se=a,Qe===0&&Qt(Be)),Se!==a?(Ti=j,j=ai(pe)):(ne=j,j=a)):(ne=j,j=a),j===a&&(j=ne,Qi(),(pe=Ja())!==a?(s.substr(ne,2)===S?(Se=S,ne+=2):(Se=a,Qe===0&&Qt(qe)),Se!==a?(Ti=j,j=zs(pe)):(ne=j,j=a)):(ne=j,j=a),j===a&&(j=ne,Qi(),(pe=Ja())!==a?(s.substr(ne,2)===O?(Se=O,ne+=2):(Se=a,Qe===0&&Qt(ft)),Se!==a?(Ti=j,j=Kn(pe)):(ne=j,j=a)):(ne=j,j=a)))))),Qe--,j===a&&Qe===0&&Qt(_e),j}function cv(){var j,pe,Se;return Qe++,j=ne,(pe=Ja())!==a?(s.substr(ne,3)===A?(Se=A,ne+=3):(Se=a,Qe===0&&Qt(Ge)),Se!==a?(Ti=j,j=eo(pe)):(ne=j,j=a)):(ne=j,j=a),j===a&&(j=ne,(pe=Ja())!==a?(s.substr(ne,3)===I?(Se=I,ne+=3):(Se=a,Qe===0&&Qt(vt)),Se!==a?(Ti=j,j=mn(pe)):(ne=j,j=a)):(ne=j,j=a),j===a&&(j=ne,(pe=Ja())!==a?(s.substr(ne,4)===M?(Se=M,ne+=4):(Se=a,Qe===0&&Qt(cr)),Se!==a?(Ti=j,j=gn(pe)):(ne=j,j=a)):(ne=j,j=a),j===a&&(j=ne,(pe=Ja())!==a?(s.substr(ne,4)===k?(Se=k,ne+=4):(Se=a,Qe===0&&Qt(rr)),Se!==a?(Ti=j,j=Gi(pe)):(ne=j,j=a)):(ne=j,j=a)))),Qe--,j===a&&(pe=a,Qe===0&&Qt(ct)),j}function hy(){var j,pe;return Qe++,j=ne,Qi(),(pe=Ja())!==a?(Ti=j,j=yn(pe)):(ne=j,j=a),Qe--,j===a&&Qe===0&&Qt(fi),j}function vP(){var j,pe,Se,ur;if(Qe++,j=ne,s.charCodeAt(ne)===35?(pe=L,ne++):(pe=a,Qe===0&&Qt(it)),pe!==a){if(Se=[],G.test(s.charAt(ne))?(ur=s.charAt(ne),ne++):(ur=a,Qe===0&&Qt(mt)),ur!==a)for(;ur!==a;)Se.push(ur),G.test(s.charAt(ne))?(ur=s.charAt(ne),ne++):(ur=a,Qe===0&&Qt(mt));else Se=a;Se!==a?(Ti=j,j=Wr()):(ne=j,j=a)}else ne=j,j=a;return j===a&&(j=ne,(pe=Ml())!==a&&(Ti=j,pe=Mn(pe)),(j=pe)===a&&(j=ne,(pe=av())!==a&&(Ti=j,pe=So()),j=pe)),Qe--,j===a&&(pe=a,Qe===0&&Qt(rt)),j}function Ja(){var j,pe,Se,ur,Bs,yi,ga;for(j=ne,Y.test(s.charAt(ne))?(s.charAt(ne),ne++):Qe===0&&Qt(Yt),pe=ne,Se=[],P.test(s.charAt(ne))?(ur=s.charAt(ne),ne++):(ur=a,Qe===0&&Qt(ir));ur!==a;)Se.push(ur),P.test(s.charAt(ne))?(ur=s.charAt(ne),ne++):(ur=a,Qe===0&&Qt(ir));if(s.charCodeAt(ne)===46?(ur=D,ne++):(ur=a,Qe===0&&Qt(Hr)),ur!==a){if(Bs=[],P.test(s.charAt(ne))?(yi=s.charAt(ne),ne++):(yi=a,Qe===0&&Qt(ir)),yi!==a)for(;yi!==a;)Bs.push(yi),P.test(s.charAt(ne))?(yi=s.charAt(ne),ne++):(yi=a,Qe===0&&Qt(ir));else Bs=a;Bs!==a?pe=Se=[Se,ur,Bs]:(ne=pe,pe=a)}else ne=pe,pe=a;if(pe===a)if(pe=[],P.test(s.charAt(ne))?(Se=s.charAt(ne),ne++):(Se=a,Qe===0&&Qt(ir)),Se!==a)for(;Se!==a;)pe.push(Se),P.test(s.charAt(ne))?(Se=s.charAt(ne),ne++):(Se=a,Qe===0&&Qt(ir));else pe=a;if(pe!==a){if(Se=ne,s.charCodeAt(ne)===101?(ur=U,ne++):(ur=a,Qe===0&&Qt(mi)),ur!==a){if(Y.test(s.charAt(ne))?(Bs=s.charAt(ne),ne++):(Bs=a,Qe===0&&Qt(Yt)),Bs===a&&(Bs=null),yi=[],P.test(s.charAt(ne))?(ga=s.charAt(ne),ne++):(ga=a,Qe===0&&Qt(ir)),ga!==a)for(;ga!==a;)yi.push(ga),P.test(s.charAt(ne))?(ga=s.charAt(ne),ne++):(ga=a,Qe===0&&Qt(ir));else yi=a;yi!==a?Se=ur=[ur,Bs,yi]:(ne=Se,Se=a)}else ne=Se,Se=a;Se===a&&(Se=null),Ti=j,j=fa()}else ne=j,j=a;return j}function EE(j,pe){return j.map(function(Se){return Se[pe]})}function CE(j,pe,Se){return[j].concat(EE(pe,Se))}if((o=h())!==a&&ne===s.length)return o;throw o!==a&&ne<s.length&&Qt(nv()),ly(Gh,In<s.length?s.charAt(In):null,In<s.length?ov(In,In+1):ov(In,In))}return t(e,Error),e.prototype.format=function(s){var n="Error: "+this.message;if(this.location){var o,a=null;for(o=0;o<s.length;o++)if(s[o].source===this.location.source){a=s[o].text.split(/\r\n|\n|\r/g);break}var l=this.location.start,c=this.location.source&&typeof this.location.source.offset=="function"?this.location.source.offset(l):l,h=this.location.source+":"+c.line+":"+c.column;if(a){var p=this.location.end,f=r("",c.line.toString().length," "),m=a[l.line-1],y=(l.line===p.line?p.column:m.length+1)-l.column||1;n+=`
 --> `+h+`
`+f+` |
`+c.line+" | "+m+`
`+f+" | "+r("",l.column-1," ")+r("",y,"^")}else n+=`
 at `+h}return n},e.buildMessage=function(s,n){var o={literal:function(m){return'"'+l(m.text)+'"'},class:function(m){var y=m.parts.map(function(_){return Array.isArray(_)?c(_[0])+"-"+c(_[1]):c(_)});return"["+(m.inverted?"^":"")+y.join("")+"]"},any:function(){return"any character"},end:function(){return"end of input"},other:function(m){return m.description}};function a(m){return m.charCodeAt(0).toString(16).toUpperCase()}function l(m){return m.replace(/\\/g,"\\\\").replace(/"/g,'\\"').replace(/\0/g,"\\0").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/[\x00-\x0F]/g,function(y){return"\\x0"+a(y)}).replace(/[\x10-\x1F\x7F-\x9F]/g,function(y){return"\\x"+a(y)})}function c(m){return m.replace(/\\/g,"\\\\").replace(/\]/g,"\\]").replace(/\^/g,"\\^").replace(/-/g,"\\-").replace(/\0/g,"\\0").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/[\x00-\x0F]/g,function(y){return"\\x0"+a(y)}).replace(/[\x10-\x1F\x7F-\x9F]/g,function(y){return"\\x"+a(y)})}function h(m){return o[m.type](m)}function p(m){var y,_,v=m.map(h);if(v.sort(),v.length>0){for(y=1,_=1;y<v.length;y++)v[y-1]!==v[y]&&(v[_]=v[y],_++);v.length=_}switch(v.length){case 1:return v[0];case 2:return v[0]+" or "+v[1];default:return v.slice(0,-1).join(", ")+", or "+v[v.length-1]}}function f(m){return m?'"'+l(m)+'"':"end of input"}return"Expected "+p(s)+" but "+f(n)+" found."},{SyntaxError:e,parse:i}},(Jee=qB).exports&&(Jee.exports=Qee());var Wke=qB.exports;function H0e(t){if(!t||t.length===0)return null;if(typeof t=="string"){const r=Kee(t);return r&&r.length!==0?r:null}const e=t.map(r=>{if(!Number.isFinite(r.scale)||r.scale<=0)throw new F("effect:invalid-scale","scale must be finite and greater than 0",{stop:r});return{scale:r.scale,effects:Kee(r.value)}});e.sort((r,i)=>i.effects.length-r.effects.length);for(let r=0;r<e.length-1;r++){if(!jke(e[r].effects,e[r+1].effects))throw new F("effect:interpolation-impossible","Cannot interpolate by scale between 2 lists of mixed effects",{a:e[r].effects,b:e[r+1].effects});Hke(e[r].effects,e[r+1].effects)}return e.sort((r,i)=>i.scale-r.scale),e}function Kee(t){let e;if(!t)return[];try{e=Wke.parse(t)}catch(r){throw new F("effect:invalid-syntax","Invalid effect syntax",{value:t,error:r})}return e.map(r=>Zke(r))}function Zke(t){try{switch(t.name){case"grayscale":case"sepia":case"saturate":case"invert":case"brightness":case"contrast":return Xke(t);case"opacity":return Yke(t);case"hue-rotate":return Jke(t);case"blur":return Qke(t);case"drop-shadow":return Kke(t);case"bloom":return eVe(t)}}catch(e){throw e.details.filter=t,e}throw new F("effect:unknown-effect",`Effect '${t.name}' is not supported`,{effect:t})}function Xke(t){let e=1;return cE(t.parameters,1),t.parameters.length===1&&(e=Id(t.parameters[0])),new HB(t.name,e)}function Yke(t){let e=1;return cE(t.parameters,1),t.parameters.length===1&&(e=Id(t.parameters[0])),new G0e(e)}function Jke(t){let e=0;return cE(t.parameters,1),t.parameters.length===1&&(e=oVe(t.parameters[0])),new z0e(e)}function Qke(t){let e=0;return cE(t.parameters,1),t.parameters.length===1&&(e=wZ(t.parameters[0]),GR(e,t.parameters[0])),new N0e(e)}function Kke(t){const e=[];let r=null;for(const i of t.parameters)if(i.type==="color"){if(e.length&&Object.freeze(e),r)throw new F("effect:type-error","Accepts only one color",{});r=aVe(i)}else{const s=wZ(i);if(Object.isFrozen(e))throw new F("effect:type-error","<length> parameters not consecutive",{lengths:e});e.push(s),e.length===3&&GR(s,i)}if(e.length<2||e.length>3)throw new F("effect:type-error",`Expected <length>{2,3}, Actual: <length>{${e.length}}`,{lengths:e});return new k0e(e[0],e[1],e[2]||0,r||q0e("black"))}function eVe(t){let e=1,r=0,i=0;return cE(t.parameters,3),t.parameters[0]&&(e=Id(t.parameters[0])),t.parameters[1]&&(r=wZ(t.parameters[1]),GR(r,t.parameters[1])),t.parameters[2]&&(i=Id(t.parameters[2])),new L0e(e,r,i)}function cE(t,e){if(t.length>e)throw new F("effect:type-error",`Function supports up to ${e} parameters, Actual: ${t.length}`,{parameters:t})}function h5(t){if(t.type==="color")return"<color>";if(t.unit){if(t.unit in bZ)return"<length>";if(t.unit in vZ)return"<angle>";if(t.unit==="%")return"<percentage>"}return"<double>"}function GR(t,e){if(t<0)throw new F("effect:type-error",`Negative values are not allowed, Actual: ${t}`,{term:e})}function tVe(t){if(t.type!=="quantity"||t.unit!==null)throw new F("effect:type-error",`Expected <double>, Actual: ${h5(t)}`,{term:t})}function rVe(t){if(t.type!=="quantity"||t.unit!==null&&t.unit!=="%")throw new F("effect:type-error",`Expected <double> or <percentage>, Actual: ${h5(t)}`,{term:t})}const vZ={deg:1,grad:.9,rad:180/Math.PI,turn:360};function iVe(t){if(t.type!=="quantity"||!(t.value===0&&t.unit===null||t.unit&&vZ[t.unit]!=null))throw new F("effect:type-error",`Expected <angle>, Actual: ${h5(t)}`,{term:t})}const bZ={px:1,cm:96/2.54,mm:96/2.54/10,in:96,pc:16,pt:96/72};function sVe(t){if(t.type!=="quantity"||!(t.value===0&&t.unit===null||t.unit&&bZ[t.unit]!=null))throw new F("effect:type-error",`Expected <length>, Actual: ${h5(t)}`,{term:t})}function Id(t){rVe(t);const e=t.value;return GR(e,t),t.unit==="%"?.01*e:e}function nVe(t){return tVe(t),GR(t.value,t),t.value}function oVe(t){return iVe(t),t.value*vZ[t.unit]||0}function wZ(t){return sVe(t),t.value*bZ[t.unit]||0}function aVe(t){switch(t.colorType){case"hex":return E6e(t.value);case"named":return q0e(t.value);case"function":return uVe(t.value)}}function q0e(t){if(!_ge(t))throw new F("effect:unknown-color",`color '${t}' isn't valid`,{namedColor:t});return S6e(t)}const lVe=/^rgba?/i,cVe=/^hsla?/i;function uVe(t){if(cE(t.parameters,4),lVe.test(t.name))return[Id(t.parameters[0]),Id(t.parameters[1]),Id(t.parameters[2]),t.parameters[3]?Id(t.parameters[3]):1];if(cVe.test(t.name))return vge(nVe(t.parameters[0]),Id(t.parameters[1]),Id(t.parameters[2]),t.parameters[3]?Id(t.parameters[3]):1);throw new F("effect:syntax-error",`Invalid color function '${t.name}'`,{colorFunction:t})}function xZ(t,e,r){try{return dVe(t)}catch(i){r?.messages?.push(i)}return null}function TZ(t,e,r,i){try{const s=hVe(t);Ha(r,s,e)}catch(s){i.messages&&i.messages.push(s)}}function hVe(t){const e=H0e(t);return e?qke(e)?e.map(r=>r.toJSON()):e.map(({scale:r,effects:i})=>({scale:r,value:i.map(s=>s.toJSON())})):null}function dVe(t){if(!t||t.length===0)return null;if(pVe(t)){const e=[];for(const r of t)e.push({scale:r.scale,value:WB(r.value)});return e}return WB(t)}function pVe(t){const e=t[0];return!!e&&"scale"in e}function WB(t){if(!t||!t.length)return"";const e=[];for(const r of t){let i=[];switch(r.type){case"grayscale":case"sepia":case"saturate":case"invert":case"brightness":case"contrast":case"opacity":i=[cm(r,"amount")];break;case"blur":i=[cm(r,"radius","pt")];break;case"hue-rotate":i=[cm(r,"angle","deg")];break;case"drop-shadow":i=[cm(r,"xoffset","pt"),cm(r,"yoffset","pt"),cm(r,"blurRadius","pt"),fVe(r,"color")];break;case"bloom":i=[cm(r,"strength"),cm(r,"radius","pt"),cm(r,"threshold")]}const s=`${r.type}(${i.filter(Boolean).join(" ")})`;H0e(s),e.push(s)}return e.join(" ")}function cm(t,e,r){if(t[e]==null)throw new F("effect:missing-parameter",`Missing parameter '${e}' in ${t.type} effect`,{effect:t});return r?t[e]+r:""+t[e]}function fVe(t,e){if(t[e]==null)throw new F("effect:missing-parameter",`Missing parameter '${e}' in ${t.type} effect`,{effect:t});const r=t[e];return`rgba(${r[0]||0}, ${r[1]||0}, ${r[2]||0}, ${r[3]/255||0})`}const ete={read:{reader:xZ},write:{allowNull:!0,writer:TZ}},mVe=t=>{let e=class extends t{constructor(){super(...arguments),this.blendMode="normal",this.effect=null}};return u([d({type:["average","color-burn","color-dodge","color","darken","destination-atop","destination-in","destination-out","destination-over","difference","exclusion","hard-light","hue","invert","lighten","lighter","luminosity","minus","multiply","normal","overlay","plus","reflect","saturation","screen","soft-light","source-atop","source-in","source-out","vivid-light","xor"],nonNullable:!0,json:{read:!1,write:!1,origins:{"web-map":{read:!0,write:!0},"portal-item":{read:!0,write:!0}}}})],e.prototype,"blendMode",void 0),u([d({json:{read:!1,write:!1,origins:{"web-map":ete,"portal-item":ete}}})],e.prototype,"effect",void 0),e=u([R("esri.layers.mixins.BlendLayer")],e),e},gVe=t=>{let e=class extends t{constructor(){super(...arguments),this.customParameters=null}};return u([d({type:Object,json:{write:{overridePolicy:r=>({enabled:!!(r&&Object.keys(r).length>0)})}}})],e.prototype,"customParameters",void 0),e=u([R("esri.layers.mixins.CustomParametersMixin")],e),e},W0e=new os.EventEmitter;function wCt(t,e,r=!1){const i=qs();return r=e==null||r,W0e.emit("apply-edits",{serviceUrl:t,layerId:e,mayReceiveServiceEdits:r,result:i.promise}),i}const Z0e="esri.layers.mixins.EditBusLayer",X0e=Symbol(Z0e);function xCt(t){return t!=null&&typeof t=="object"&&X0e in t}const Y0e=t=>{var e;let r=class extends t{constructor(...i){super(...i),this[e]=!0,this.when().then(()=>{this.own([W0e.on("apply-edits",s=>{const{serviceUrl:n,layerId:o,mayReceiveServiceEdits:a,result:l}=s,c=n===this.url,h=o!=null&&this.layerId!=null&&o===this.layerId;if(!c||!h&&!a)return;const p=l.then(f=>{if(h&&(f.addedFeatures.length||f.updatedFeatures.length||f.deletedFeatures.length||f.addedAttachments.length||f.updatedAttachments.length||f.deletedAttachments.length))return this.emit("edits",K(f)),f;const m=f.editedFeatures?.find(({layerId:y})=>y===this.layerId);if(m){const{adds:y,updates:_,deletes:v}=m.editedFeatures,w={edits:null,addedAttachments:[],deletedAttachments:[],updatedAttachments:[],addedFeatures:y?y.map(({attributes:x})=>({objectId:this.objectIdField&&x[this.objectIdField],globalId:this.globalIdField&&x[this.globalIdField]})):[],deletedFeatures:v?v.map(({attributes:x})=>({objectId:this.objectIdField&&x[this.objectIdField],globalId:this.globalIdField&&x[this.globalIdField]})):[],updatedFeatures:_?_.map(({current:{attributes:x}})=>({objectId:this.objectIdField&&x[this.objectIdField],globalId:this.globalIdField&&x[this.globalIdField]})):[],editedFeatures:K(f.editedFeatures),exceededTransferLimit:!1};return this.emit("edits",w),w}return{edits:null,addedAttachments:[],deletedAttachments:[],updatedAttachments:[],addedFeatures:[],deletedFeatures:[],updatedFeatures:[],editedFeatures:K(f.editedFeatures),exceededTransferLimit:!1}});this.emit("apply-edits",{result:p})})])},()=>{})}};return e=X0e,r=u([R(Z0e)],r),r},tte={milliseconds:1,seconds:1e3,minutes:6e4,hours:36e5,days:864e5,weeks:6048e5,months:26784e5,years:31536e6,decades:31536e7,centuries:31536e8},yVe={milliseconds:{getter:"getMilliseconds",setter:"setMilliseconds",multiplier:1},seconds:{getter:"getSeconds",setter:"setSeconds",multiplier:1},minutes:{getter:"getMinutes",setter:"setMinutes",multiplier:1},hours:{getter:"getHours",setter:"setHours",multiplier:1},days:{getter:"getDate",setter:"setDate",multiplier:1},weeks:{getter:"getDate",setter:"setDate",multiplier:7},months:{getter:"getMonth",setter:"setMonth",multiplier:1},years:{getter:"getFullYear",setter:"setFullYear",multiplier:1},decades:{getter:"getFullYear",setter:"setFullYear",multiplier:10},centuries:{getter:"getFullYear",setter:"setFullYear",multiplier:100}};function _Ve(t,e){const r=new Date(t,e+1,1);return r.setDate(0),r.getDate()}function Cb(t,e,r){const i=new Date(t.getTime());if(e&&r){const s=yVe[r],{getter:n,setter:o,multiplier:a}=s;if(r==="months"){const l=_Ve(i.getFullYear(),i.getMonth()+e);i.getDate()>l&&i.setDate(l)}i[o](i[n]()+e*a)}return i}function rte(t,e){switch(e){case"milliseconds":return new Date(t.getTime());case"seconds":return new Date(t.getFullYear(),t.getMonth(),t.getDate(),t.getHours(),t.getMinutes(),t.getSeconds());case"minutes":return new Date(t.getFullYear(),t.getMonth(),t.getDate(),t.getHours(),t.getMinutes());case"hours":return new Date(t.getFullYear(),t.getMonth(),t.getDate(),t.getHours());case"days":return new Date(t.getFullYear(),t.getMonth(),t.getDate());case"weeks":return new Date(t.getFullYear(),t.getMonth(),t.getDate()-t.getDay());case"months":return new Date(t.getFullYear(),t.getMonth(),1);case"years":return new Date(t.getFullYear(),0,1);case"decades":return new Date(t.getFullYear()-t.getFullYear()%10,0,1);case"centuries":return new Date(t.getFullYear()-t.getFullYear()%100,0,1);default:return new Date}}function vVe(t,e,r){return t===0?0:t*tte[e]/tte[r]}var pd;let Hc=pd=class extends de{static get allTime(){return ite}static get empty(){return bVe}constructor(t){super(t),this.end=null,this.start=null}readEnd(t,e){return e.end!=null?new Date(e.end):null}writeEnd(t,e){e.end=t?t.getTime():null}get isAllTime(){return this.equals(pd.allTime)}get isEmpty(){return this.equals(pd.empty)}readStart(t,e){return e.start!=null?new Date(e.start):null}writeStart(t,e){e.start=t?t.getTime():null}clone(){return new pd({end:this.end,start:this.start})}equals(t){if(!t)return!1;const e=this.start!=null?this.start.getTime():this.start,r=this.end!=null?this.end.getTime():this.end,i=t.start!=null?t.start.getTime():t.start,s=t.end!=null?t.end.getTime():t.end;return e===i&&r===s}expandTo(t){if(this.isEmpty||this.isAllTime)return this.clone();const e=uc(this.start,i=>rte(i,t)),r=uc(this.end,i=>{const s=rte(i,t);return i.getTime()===s.getTime()?s:Cb(s,1,t)});return new pd({start:e,end:r})}intersection(t){if(!t)return this.clone();if(this.isEmpty||t.isEmpty)return pd.empty;if(this.isAllTime)return t.clone();if(t.isAllTime)return this.clone();const e=this.start?.getTime()??-1/0,r=this.end?.getTime()??1/0,i=t.start?.getTime()??-1/0,s=t.end?.getTime()??1/0;let n,o;if(i>=e&&i<=r?n=i:e>=i&&e<=s&&(n=e),r>=i&&r<=s?o=r:s>=e&&s<=r&&(o=s),n!=null&&o!=null&&!isNaN(n)&&!isNaN(o)){const a=new pd;return a.start=n===-1/0?null:new Date(n),a.end=o===1/0?null:new Date(o),a}return pd.empty}offset(t,e){if(this.isEmpty||this.isAllTime)return this.clone();const r=new pd,{start:i,end:s}=this;return i!=null&&(r.start=Cb(i,t,e)),s!=null&&(r.end=Cb(s,t,e)),r}union(t){if(!t||t.isEmpty)return this.clone();if(this.isEmpty)return t.clone();if(this.isAllTime||t.isAllTime)return ite.clone();const e=this.start!=null&&t.start!=null?new Date(Math.min(this.start.getTime(),t.start.getTime())):null,r=this.end!=null&&t.end!=null?new Date(Math.max(this.end.getTime(),t.end.getTime())):null;return new pd({start:e,end:r})}};u([d({type:Date,json:{write:{allowNull:!0}}})],Hc.prototype,"end",void 0),u([Ee("end")],Hc.prototype,"readEnd",null),u([Fe("end")],Hc.prototype,"writeEnd",null),u([d({readOnly:!0,json:{read:!1}})],Hc.prototype,"isAllTime",null),u([d({readOnly:!0,json:{read:!1}})],Hc.prototype,"isEmpty",null),u([d({type:Date,json:{write:{allowNull:!0}}})],Hc.prototype,"start",void 0),u([Ee("start")],Hc.prototype,"readStart",null),u([Fe("start")],Hc.prototype,"writeStart",null),Hc=pd=u([R("esri.TimeExtent")],Hc);const ite=new Hc,bVe=new Hc({start:void 0,end:void 0}),rm=Hc;var ZB;let xT=ZB=class extends de{constructor(t){super(t),this.type="map-layer"}clone(){const{mapLayerId:t,gdbVersion:e}=this;return new ZB({mapLayerId:t,gdbVersion:e})}};u([tt({mapLayer:"map-layer"})],xT.prototype,"type",void 0),u([d({type:Xi,json:{write:!0}})],xT.prototype,"mapLayerId",void 0),u([d({type:String,json:{write:!0}})],xT.prototype,"gdbVersion",void 0),xT=ZB=u([R("esri.layers.support.source.MapLayerSource")],xT);var XB;let Nm=XB=class extends de{constructor(t){super(t),this.type="query-table"}clone(){const{workspaceId:t,query:e,oidFields:r,spatialReference:i,geometryType:s}=this,n={workspaceId:t,query:e,oidFields:r,spatialReference:i?.clone()??void 0,geometryType:s};return new XB(n)}};u([tt({queryTable:"query-table"})],Nm.prototype,"type",void 0),u([d({type:String,json:{write:!0}})],Nm.prototype,"workspaceId",void 0),u([d({type:String,json:{write:!0}})],Nm.prototype,"query",void 0),u([d({type:String,json:{write:!0}})],Nm.prototype,"oidFields",void 0),u([d({type:je,json:{write:!0}})],Nm.prototype,"spatialReference",void 0),u([tt(Yfe)],Nm.prototype,"geometryType",void 0),Nm=XB=u([R("esri.layers.support.source.QueryTableDataSource")],Nm);var YB;let TT=YB=class extends de{constructor(t){super(t),this.type="raster"}clone(){const{workspaceId:t,dataSourceName:e}=this;return new YB({workspaceId:t,dataSourceName:e})}};u([tt({raster:"raster"})],TT.prototype,"type",void 0),u([d({type:String,json:{write:!0}})],TT.prototype,"dataSourceName",void 0),u([d({type:String,json:{write:!0}})],TT.prototype,"workspaceId",void 0),TT=YB=u([R("esri.layers.support.source.RasterDataSource")],TT);var JB;let _1=JB=class extends de{constructor(t){super(t),this.type="table"}clone(){const{workspaceId:t,gdbVersion:e,dataSourceName:r}=this;return new JB({workspaceId:t,gdbVersion:e,dataSourceName:r})}};u([tt({table:"table"})],_1.prototype,"type",void 0),u([d({type:String,json:{write:!0}})],_1.prototype,"workspaceId",void 0),u([d({type:String,json:{write:!0}})],_1.prototype,"gdbVersion",void 0),u([d({type:String,json:{write:!0}})],_1.prototype,"dataSourceName",void 0),_1=JB=u([R("esri.layers.support.source.TableDataSource")],_1);var QB,KB;const wVe=Wa()({esriLeftInnerJoin:"left-inner-join",esriLeftOuterJoin:"left-outer-join"});let Uc=QB=class extends de{constructor(t){super(t),this.type="join-table"}readLeftTableSource(t,e,r){return ste()(t,e,r)}castLeftTableSource(t){return np(e7(),t)}readRightTableSource(t,e,r){return ste()(t,e,r)}castRightTableSource(t){return np(e7(),t)}clone(){const{leftTableKey:t,rightTableKey:e,leftTableSource:r,rightTableSource:i,joinType:s}=this,n={leftTableKey:t,rightTableKey:e,leftTableSource:r?.clone()??void 0,rightTableSource:i?.clone()??void 0,joinType:s};return new QB(n)}};u([tt({joinTable:"join-table"})],Uc.prototype,"type",void 0),u([d({type:String,json:{write:!0}})],Uc.prototype,"leftTableKey",void 0),u([d({type:String,json:{write:!0}})],Uc.prototype,"rightTableKey",void 0),u([d({json:{write:!0}})],Uc.prototype,"leftTableSource",void 0),u([Ee("leftTableSource")],Uc.prototype,"readLeftTableSource",null),u([yr("leftTableSource")],Uc.prototype,"castLeftTableSource",null),u([d({json:{write:!0}})],Uc.prototype,"rightTableSource",void 0),u([Ee("rightTableSource")],Uc.prototype,"readRightTableSource",null),u([yr("rightTableSource")],Uc.prototype,"castRightTableSource",null),u([tt(wVe)],Uc.prototype,"joinType",void 0),Uc=QB=u([R("esri.layers.support.source.JoinTableDataSource")],Uc);let TU=null;function ste(){return TU||(TU=Q2({types:e7()})),TU}let SU=null;function e7(){return SU||(SU={key:"type",base:null,typeMap:{"data-layer":$d,"map-layer":xT}}),SU}const xVe={key:"type",base:null,typeMap:{"join-table":Uc,"query-table":Nm,raster:TT,table:_1}};let $d=KB=class extends de{constructor(t){super(t),this.type="data-layer"}clone(){const{fields:t,dataSource:e}=this;return new KB({fields:t,dataSource:e})}};u([tt({dataLayer:"data-layer"})],$d.prototype,"type",void 0),u([d({type:[n5],json:{write:!0}})],$d.prototype,"fields",void 0),u([d({types:xVe,json:{write:!0}})],$d.prototype,"dataSource",void 0),$d=KB=u([R("esri.layers.support.source.DataLayerSource")],$d),$d.from=Zs($d);let v1=class extends Vi(de){constructor(e){super(e),this.onFields=null,this.operator=null,this.searchTerm=null,this.searchType=null}};u([d({type:[String],json:{write:{enabled:!0,overridePolicy(){return{enabled:this.onFields!=null&&this.onFields.length>0}}}}})],v1.prototype,"onFields",void 0),u([d({type:String,json:{write:!0}})],v1.prototype,"operator",void 0),u([d({type:String,json:{write:!0}})],v1.prototype,"searchTerm",void 0),u([d({type:String,json:{write:!0}})],v1.prototype,"searchType",void 0),v1=u([R("esri.rest.support.FullTextSearch")],v1);const TVe=v1;var t7;const nte=new Rr({upperLeft:"upper-left",lowerLeft:"lower-left"});let b1=t7=class extends de{constructor(t){super(t),this.extent=null,this.mode="view",this.originPosition="upper-left",this.tolerance=1}clone(){return new t7(K({extent:this.extent,mode:this.mode,originPosition:this.originPosition,tolerance:this.tolerance}))}};u([d({type:_r,json:{write:{overridePolicy(){return{enabled:this.mode==="view"}}}}})],b1.prototype,"extent",void 0),u([d({type:["view","edit"],json:{write:!0}})],b1.prototype,"mode",void 0),u([d({type:String,json:{read:nte.read,write:nte.write}})],b1.prototype,"originPosition",void 0),u([d({type:Number,json:{write:{overridePolicy(){return{enabled:this.mode==="view"}}}}})],b1.prototype,"tolerance",void 0),b1=t7=u([R("esri.rest.support.QuantizationParameters")],b1);const SVe=b1;var r7;const ote=new Rr({count:"count",sum:"sum",min:"min",max:"max",avg:"avg",stddev:"stddev",var:"var",exceedslimit:"exceedslimit",percentile_cont:"percentile-continuous",percentile_disc:"percentile-discrete",EnvelopeAggregate:"envelope-aggregate",CentroidAggregate:"centroid-aggregate",ConvexHullAggregate:"convex-hull-aggregate"});let fd=r7=class extends de{constructor(t){super(t),this.maxPointCount=void 0,this.maxRecordCount=void 0,this.maxVertexCount=void 0,this.onStatisticField=null,this.outStatisticFieldName=null,this.statisticType=null,this.statisticParameters=null}writeStatisticParameters(t,e){this.statisticType!=="percentile-continuous"&&this.statisticType!=="percentile-discrete"||(e.statisticParameters=K(t))}clone(){return new r7({maxPointCount:this.maxPointCount,maxRecordCount:this.maxRecordCount,maxVertexCount:this.maxVertexCount,onStatisticField:this.onStatisticField,outStatisticFieldName:this.outStatisticFieldName,statisticType:this.statisticType,statisticParameters:K(this.statisticParameters)})}};u([d({type:Number,json:{write:!0}})],fd.prototype,"maxPointCount",void 0),u([d({type:Number,json:{write:!0}})],fd.prototype,"maxRecordCount",void 0),u([d({type:Number,json:{write:!0}})],fd.prototype,"maxVertexCount",void 0),u([d({type:String,json:{write:!0}})],fd.prototype,"onStatisticField",void 0),u([d({type:String,json:{write:!0}})],fd.prototype,"outStatisticFieldName",void 0),u([d({type:String,json:{read:{source:"statisticType",reader:ote.read},write:{target:"statisticType",writer:ote.write}}})],fd.prototype,"statisticType",void 0),u([d({type:Object})],fd.prototype,"statisticParameters",void 0),u([Fe("statisticParameters")],fd.prototype,"writeStatisticParameters",null),fd=r7=u([R("esri.rest.support.StatisticDefinition")],fd);const EVe=fd;var OS;const CVe=new Rr({esriSpatialRelIntersects:"intersects",esriSpatialRelContains:"contains",esriSpatialRelCrosses:"crosses",esriSpatialRelDisjoint:"disjoint",esriSpatialRelEnvelopeIntersects:"envelope-intersects",esriSpatialRelIndexIntersects:"index-intersects",esriSpatialRelOverlaps:"overlaps",esriSpatialRelTouches:"touches",esriSpatialRelWithin:"within",esriSpatialRelRelation:"relation"}),AVe=new Rr({esriSRUnit_Meter:"meters",esriSRUnit_Kilometer:"kilometers",esriSRUnit_Foot:"feet",esriSRUnit_StatuteMile:"miles",esriSRUnit_NauticalMile:"nautical-miles",esriSRUnit_USNauticalMile:"us-nautical-miles"});let Mt=OS=class extends de{static from(t){return Bb(OS,t)}constructor(t){super(t),this.aggregateIds=null,this.cacheHint=void 0,this.compactGeometryEnabled=!1,this.datumTransformation=null,this.defaultSpatialReferenceEnabled=!1,this.distance=void 0,this.dynamicDataSource=void 0,this.formatOf3DObjects=null,this.fullText=null,this.gdbVersion=null,this.geometry=null,this.geometryPrecision=void 0,this.groupByFieldsForStatistics=null,this.having=null,this.historicMoment=null,this.maxAllowableOffset=void 0,this.maxRecordCountFactor=1,this.multipatchOption=null,this.num=void 0,this.objectIds=null,this.orderByFields=null,this.outFields=null,this.outSpatialReference=null,this.outStatistics=null,this.parameterValues=null,this.pixelSize=null,this.quantizationParameters=null,this.rangeValues=null,this.relationParameter=null,this.resultType=null,this.returnCentroid=!1,this.returnDistinctValues=!1,this.returnExceededLimitFeatures=!0,this.returnGeometry=!1,this.returnQueryGeometry=!1,this.returnM=void 0,this.returnZ=void 0,this.sourceSpatialReference=null,this.spatialRelationship="intersects",this.start=void 0,this.sqlFormat=null,this.text=null,this.timeExtent=null,this.timeReferenceUnknownClient=!1,this.units=null,this.where=null}castDatumTransformation(t){return typeof t=="number"||typeof t=="object"?t:null}writeHistoricMoment(t,e){e.historicMoment=t&&t.getTime()}writeParameterValues(t,e){if(t){const r={};for(const i in t){const s=t[i];Array.isArray(s)?r[i]=s.map(n=>n instanceof Date?n.getTime():n):s instanceof Date?r[i]=s.getTime():r[i]=s}e.parameterValues=r}}writeStart(t,e){e.resultOffset=this.start,e.resultRecordCount=this.num||10,e.where="1=1"}writeWhere(t,e){e.where=t||"1=1"}clone(){return new OS(K({aggregateIds:this.aggregateIds,cacheHint:this.cacheHint,compactGeometryEnabled:this.compactGeometryEnabled,datumTransformation:this.datumTransformation,defaultSpatialReferenceEnabled:this.defaultSpatialReferenceEnabled,distance:this.distance,fullText:this.fullText,formatOf3DObjects:this.formatOf3DObjects,gdbVersion:this.gdbVersion,geometry:this.geometry,geometryPrecision:this.geometryPrecision,groupByFieldsForStatistics:this.groupByFieldsForStatistics,having:this.having,historicMoment:this.historicMoment!=null?new Date(this.historicMoment.getTime()):null,maxAllowableOffset:this.maxAllowableOffset,maxRecordCountFactor:this.maxRecordCountFactor,multipatchOption:this.multipatchOption,num:this.num,objectIds:this.objectIds,orderByFields:this.orderByFields,outFields:this.outFields,outSpatialReference:this.outSpatialReference,outStatistics:this.outStatistics,parameterValues:this.parameterValues,pixelSize:this.pixelSize,quantizationParameters:this.quantizationParameters,rangeValues:this.rangeValues,relationParameter:this.relationParameter,resultType:this.resultType,returnDistinctValues:this.returnDistinctValues,returnGeometry:this.returnGeometry,returnCentroid:this.returnCentroid,returnExceededLimitFeatures:this.returnExceededLimitFeatures,returnQueryGeometry:this.returnQueryGeometry,returnM:this.returnM,returnZ:this.returnZ,dynamicDataSource:this.dynamicDataSource,sourceSpatialReference:this.sourceSpatialReference,spatialRelationship:this.spatialRelationship,start:this.start,sqlFormat:this.sqlFormat,text:this.text,timeExtent:this.timeExtent,timeReferenceUnknownClient:this.timeReferenceUnknownClient,units:this.units,where:this.where}))}};Mt.MAX_MAX_RECORD_COUNT_FACTOR=5,u([d({json:{write:!0}})],Mt.prototype,"aggregateIds",void 0),u([d({type:Boolean,json:{write:!0}})],Mt.prototype,"cacheHint",void 0),u([d({type:Boolean,json:{default:!1,write:!0}})],Mt.prototype,"compactGeometryEnabled",void 0),u([d({json:{write:!0}})],Mt.prototype,"datumTransformation",void 0),u([yr("datumTransformation")],Mt.prototype,"castDatumTransformation",null),u([d({type:Boolean,json:{default:!1,write:!0}})],Mt.prototype,"defaultSpatialReferenceEnabled",void 0),u([d({type:Number,json:{write:{overridePolicy:t=>({enabled:t>0})}}})],Mt.prototype,"distance",void 0),u([d({type:$d,json:{write:!0}})],Mt.prototype,"dynamicDataSource",void 0),u([d({type:String,json:{write:!0}})],Mt.prototype,"formatOf3DObjects",void 0),u([d({type:[TVe],json:{write:{enabled:!0,overridePolicy(){return{enabled:this.fullText!=null&&this.fullText.length>0}}}}})],Mt.prototype,"fullText",void 0),u([d({type:String,json:{write:!0}})],Mt.prototype,"gdbVersion",void 0),u([d({types:Ew,json:{read:S_,write:!0}})],Mt.prototype,"geometry",void 0),u([d({type:Number,json:{write:!0}})],Mt.prototype,"geometryPrecision",void 0),u([d({type:[String],json:{write:!0}})],Mt.prototype,"groupByFieldsForStatistics",void 0),u([d({type:String,json:{write:!0}})],Mt.prototype,"having",void 0),u([d({type:Date})],Mt.prototype,"historicMoment",void 0),u([Fe("historicMoment")],Mt.prototype,"writeHistoricMoment",null),u([d({type:Number,json:{write:!0}})],Mt.prototype,"maxAllowableOffset",void 0),u([d({type:Number,cast:t=>t<1?1:t>OS.MAX_MAX_RECORD_COUNT_FACTOR?OS.MAX_MAX_RECORD_COUNT_FACTOR:t,json:{write:{overridePolicy:t=>({enabled:t>1})}}})],Mt.prototype,"maxRecordCountFactor",void 0),u([d({type:["xyFootprint"],json:{write:!0}})],Mt.prototype,"multipatchOption",void 0),u([d({type:Number,json:{read:{source:"resultRecordCount"}}})],Mt.prototype,"num",void 0),u([d({json:{write:!0}})],Mt.prototype,"objectIds",void 0),u([d({type:[String],json:{write:!0}})],Mt.prototype,"orderByFields",void 0),u([d({type:[String],json:{write:!0}})],Mt.prototype,"outFields",void 0),u([d({type:je,json:{name:"outSR",write:!0}})],Mt.prototype,"outSpatialReference",void 0),u([d({type:[EVe],json:{write:{enabled:!0,overridePolicy(){return{enabled:this.outStatistics!=null&&this.outStatistics.length>0}}}}})],Mt.prototype,"outStatistics",void 0),u([d({json:{write:!0}})],Mt.prototype,"parameterValues",void 0),u([Fe("parameterValues")],Mt.prototype,"writeParameterValues",null),u([d({type:pt,json:{write:!0}})],Mt.prototype,"pixelSize",void 0),u([d({type:SVe,json:{write:!0}})],Mt.prototype,"quantizationParameters",void 0),u([d({type:[Object],json:{write:!0}})],Mt.prototype,"rangeValues",void 0),u([d({type:String,json:{read:{source:"relationParam"},write:{target:"relationParam",overridePolicy(){return{enabled:this.spatialRelationship==="relation"}}}}})],Mt.prototype,"relationParameter",void 0),u([d({type:String,json:{write:!0}})],Mt.prototype,"resultType",void 0),u([d({type:Boolean,json:{default:!1,write:!0}})],Mt.prototype,"returnCentroid",void 0),u([d({type:Boolean,json:{default:!1,write:!0}})],Mt.prototype,"returnDistinctValues",void 0),u([d({type:Boolean,json:{default:!0,write:!0}})],Mt.prototype,"returnExceededLimitFeatures",void 0),u([d({type:Boolean,json:{write:!0}})],Mt.prototype,"returnGeometry",void 0),u([d({type:Boolean,json:{default:!1,write:!0}})],Mt.prototype,"returnQueryGeometry",void 0),u([d({type:Boolean,json:{default:!1,write:!0}})],Mt.prototype,"returnM",void 0),u([d({type:Boolean,json:{write:{overridePolicy:t=>({enabled:t})}}})],Mt.prototype,"returnZ",void 0),u([d({type:je,json:{write:!0}})],Mt.prototype,"sourceSpatialReference",void 0),u([tt(CVe,{ignoreUnknown:!1,name:"spatialRel"})],Mt.prototype,"spatialRelationship",void 0),u([d({type:Number,json:{read:{source:"resultOffset"}}})],Mt.prototype,"start",void 0),u([Fe("start"),Fe("num")],Mt.prototype,"writeStart",null),u([d({type:String,json:{write:!0}})],Mt.prototype,"sqlFormat",void 0),u([d({type:String,json:{write:!0}})],Mt.prototype,"text",void 0),u([d({type:rm,json:{write:!0}})],Mt.prototype,"timeExtent",void 0),u([d({type:Boolean,json:{default:!1,write:!0}})],Mt.prototype,"timeReferenceUnknownClient",void 0),u([tt(AVe,{ignoreUnknown:!1}),d({json:{write:{overridePolicy(t){return{enabled:!!t&&this.distance!=null&&this.distance>0}}}}})],Mt.prototype,"units",void 0),u([d({type:String,json:{write:{overridePolicy(t){return{enabled:t!=null||this.start!=null&&this.start>0}}}}})],Mt.prototype,"where",void 0),u([Fe("where")],Mt.prototype,"writeWhere",null),Mt=OS=u([R("esri.rest.support.Query")],Mt);const Y_=Mt;var i7;const EU=new Rr({esriSpatialRelIntersects:"intersects",esriSpatialRelContains:"contains",esriSpatialRelCrosses:"crosses",esriSpatialRelDisjoint:"disjoint",esriSpatialRelEnvelopeIntersects:"envelope-intersects",esriSpatialRelIndexIntersects:"index-intersects",esriSpatialRelOverlaps:"overlaps",esriSpatialRelTouches:"touches",esriSpatialRelWithin:"within",esriSpatialRelRelation:"relation"}),CU=new Rr({esriSRUnit_Meter:"meters",esriSRUnit_Kilometer:"kilometers",esriSRUnit_Foot:"feet",esriSRUnit_StatuteMile:"miles",esriSRUnit_NauticalMile:"nautical-miles",esriSRUnit_USNauticalMile:"us-nautical-miles"});let Zp=i7=class extends de{constructor(t){super(t),this.where=null,this.geometry=null,this.spatialRelationship="intersects",this.distance=void 0,this.objectIds=null,this.units=null,this.timeExtent=null}createQuery(t={}){const{where:e,geometry:r,spatialRelationship:i,timeExtent:s,objectIds:n,units:o,distance:a}=this;return new Y_({geometry:K(r),objectIds:K(n),spatialRelationship:i,timeExtent:K(s),where:e,units:o,distance:a,...t})}clone(){const{where:t,geometry:e,spatialRelationship:r,timeExtent:i,objectIds:s,units:n,distance:o}=this;return new i7({geometry:K(e),objectIds:K(s),spatialRelationship:r,timeExtent:K(i),where:t,units:n,distance:o})}};u([d({type:String,json:{write:!0}})],Zp.prototype,"where",void 0),u([d({types:Ew,json:{write:!0}})],Zp.prototype,"geometry",void 0),u([d({type:EU.apiValues,json:{name:"spatialRel",read:{reader:EU.read},write:{allowNull:!1,writer:EU.write,overridePolicy(){return{enabled:this.geometry!=null}}}}})],Zp.prototype,"spatialRelationship",void 0),u([d({type:Number,json:{write:{overridePolicy(t){return{enabled:t!=null&&this.geometry!=null}}}}})],Zp.prototype,"distance",void 0),u([d({type:[Number],json:{write:!0}})],Zp.prototype,"objectIds",void 0),u([d({type:CU.apiValues,json:{read:CU.read,write:{writer:CU.write,overridePolicy(t){return{enabled:t!=null&&this.geometry!=null}}}}})],Zp.prototype,"units",void 0),u([d({type:rm,json:{write:!0}})],Zp.prototype,"timeExtent",void 0),Zp=i7=u([R("esri.layers.support.FeatureFilter")],Zp);const OVe=Zp;var s7;const ate={read:{reader:xZ},write:{writer:TZ,overridePolicy(){return{allowNull:this.excludedEffect!=null,isRequired:this.excludedEffect==null}}}},lte={read:{reader:xZ},write:{writer:TZ,overridePolicy(){return{allowNull:this.includedEffect!=null,isRequired:this.includedEffect==null}}}},cte={name:"showExcludedLabels",default:!0};let w1=s7=class extends de{constructor(t){super(t),this.filter=null,this.includedEffect=null,this.excludedEffect=null,this.excludedLabelsVisible=!1}write(t,e){const r=super.write(t,e);if(e?.origin){if(r.filter){const i=Object.keys(r.filter);if(i.length>1||i[0]!=="where")return e.messages?.push(new F("web-document-write:unsupported-feature-effect","Invalid feature effect 'filter'. A filter can only contain a 'where' property",{layer:e.layer,effect:this})),null}if("showExcludedLabels"in r)return e.messages?.push(new F("web-document-write:unsupported-feature-effect","Invalid value for property 'excludedLabelsVisible' which should always be 'true'",{layer:e.layer,effect:this})),null}return r}clone(){return new s7({filter:this.filter!=null?this.filter.clone():null,includedEffect:this.includedEffect,excludedEffect:this.excludedEffect,excludedLabelsVisible:this.excludedLabelsVisible})}};u([d({type:OVe,json:{write:{allowNull:!0,writer(t,e,r,i){const s=t?.write({},i);s&&Object.keys(s).length!==0?Ha(r,s,e):Ha(r,null,e)}}}})],w1.prototype,"filter",void 0),u([d({json:{write:!0,origins:{"web-map":ate,"portal-item":ate}}})],w1.prototype,"includedEffect",void 0),u([d({json:{write:!0,origins:{"web-map":lte,"portal-item":lte}}})],w1.prototype,"excludedEffect",void 0),u([d({type:Boolean,json:{write:!0,name:"showExcludedLabels",origins:{"web-map":cte,"portal-item":cte}}})],w1.prototype,"excludedLabelsVisible",void 0),w1=s7=u([R("esri.layers.support.FeatureEffect")],w1);const RVe=w1,ute={write:{allowNull:!0}},PVe=t=>{let e=class extends t{constructor(){super(...arguments),this.featureEffect=null}};return u([d({type:RVe,json:{origins:{"web-map":ute,"portal-item":ute}}})],e.prototype,"featureEffect",void 0),e=u([R("esri.layers.mixins.FeatureEffectLayer")],e),e};var vA;const ON=Wa()({orthometric:"gravity-related-height",gravity_related_height:"gravity-related-height",ellipsoidal:"ellipsoidal"}),J0e=ON.jsonValues.slice();dO(J0e,"orthometric");const M3=Wa()({meter:"meters",foot:"feet","us-foot":"us-feet","clarke-foot":"clarke-feet","clarke-yard":"clarke-yards","clarke-link":"clarke-links","sears-yard":"sears-yards","sears-foot":"sears-feet","sears-chain":"sears-chains","benoit-1895-b-chain":"benoit-1895-b-chains","indian-yard":"indian-yards","indian-1937-yard":"indian-1937-yards","gold-coast-foot":"gold-coast-feet","sears-1922-truncated-chain":"sears-1922-truncated-chains","50-kilometers":"50-kilometers","150-kilometers":"150-kilometers"});let md=vA=class extends de{constructor(t){super(t),this.heightModel="gravity-related-height",this.heightUnit="meters",this.vertCRS=null}writeHeightModel(t,e,r){return ON.write(t,e,r)}readHeightModel(t,e,r){return ON.read(t)||(r&&r.messages&&r.messages.push(MVe(t,{context:r})),null)}readHeightUnit(t,e,r){return M3.read(t)||(r&&r.messages&&r.messages.push(hte(t,{context:r})),null)}readHeightUnitService(t,e,r){return tfe(t)||M3.read(t)||(r&&r.messages&&r.messages.push(hte(t,{context:r})),null)}readVertCRS(t,e){return e.vertCRS||e.ellipsoid||e.geoid}clone(){return new vA({heightModel:this.heightModel,heightUnit:this.heightUnit,vertCRS:this.vertCRS})}equals(t){return!!t&&(this===t||this.heightModel===t.heightModel&&this.heightUnit===t.heightUnit&&this.vertCRS===t.vertCRS)}static deriveUnitFromSR(t,e){const r=rfe(e);return new vA({heightModel:t.heightModel,heightUnit:r,vertCRS:t.vertCRS})}write(t,e){return e={origin:"web-scene",...e},super.write(t,e)}static fromJSON(t){if(!t)return null;const e=new vA;return e.read(t,{origin:"web-scene"}),e}};function hte(t,e){return new Sh("height-unit:unsupported",`Height unit of value '${t}' is not supported`,e)}function MVe(t,e){return new Sh("height-model:unsupported",`Height model of value '${t}' is not supported`,e)}u([d({type:ON.apiValues,constructOnly:!0,json:{origins:{"web-scene":{type:J0e,default:"ellipsoidal"}}}})],md.prototype,"heightModel",void 0),u([Fe("web-scene","heightModel")],md.prototype,"writeHeightModel",null),u([Ee(["web-scene","service"],"heightModel")],md.prototype,"readHeightModel",null),u([d({type:M3.apiValues,constructOnly:!0,json:{origins:{"web-scene":{type:M3.jsonValues,write:M3.write}}}})],md.prototype,"heightUnit",void 0),u([Ee("web-scene","heightUnit")],md.prototype,"readHeightUnit",null),u([Ee("service","heightUnit")],md.prototype,"readHeightUnitService",null),u([d({type:String,constructOnly:!0,json:{origins:{"web-scene":{write:!0}}}})],md.prototype,"vertCRS",void 0),u([Ee("service","vertCRS",["vertCRS","ellipsoid","geoid"])],md.prototype,"readVertCRS",null),md=vA=u([R("esri.geometry.HeightModelInfo")],md);const $w=md;function IVe(t){if(!t)return t;const{start:e,end:r}=t;return new rm({start:e!=null?Cb(e,-e.getTimezoneOffset(),"minutes"):e,end:r!=null?Cb(r,-r.getTimezoneOffset(),"minutes"):r})}function $Ve(t){if(!t)return t;const{start:e,end:r}=t;return new rm({start:e!=null?Cb(e,e.getTimezoneOffset(),"minutes"):e,end:r!=null?Cb(r,r.getTimezoneOffset(),"minutes"):r})}var n7;let bA=n7=class extends de{constructor(t){super(t)}async collectRequiredFields(t,e){return Cl(t,e,this.expression)}clone(){return new n7({expression:this.expression,title:this.title})}equals(t){return this.expression===t.expression&&this.title===t.title}};u([d({type:String,json:{write:!0}})],bA.prototype,"expression",void 0),u([d({type:String,json:{write:!0}})],bA.prototype,"title",void 0),bA=n7=u([R("esri.layers.support.FeatureExpressionInfo")],bA);const dte=bA;function LVe(t){return!!t&&c2[t]!=null}function DVe(t){return 1/(c2[t]||1)}function NVe(){const t=Object.keys(c2);return t.sort(),t}const FVe=NVe();var o7;const tM=Wa()({onTheGround:"on-the-ground",relativeToGround:"relative-to-ground",relativeToScene:"relative-to-scene",absoluteHeight:"absolute-height"}),pte=new Rr({foot:"feet",kilometer:"kilometers",meter:"meters",mile:"miles","us-foot":"us-feet",yard:"yards"});let Fm=o7=class extends de{constructor(t){super(t),this.offset=null}readFeatureExpressionInfo(t,e){return t??(e.featureExpression&&e.featureExpression.value===0?{expression:"0"}:void 0)}writeFeatureExpressionInfo(t,e,r,i){e[r]=t.write({},i),t.expression==="0"&&(e.featureExpression={value:0})}get mode(){const{offset:t,featureExpressionInfo:e}=this;return this._isOverridden("mode")?this._get("mode"):t!=null||e?"relative-to-ground":"on-the-ground"}set mode(t){this._override("mode",t)}set unit(t){this._set("unit",t)}write(t,e){return this.offset||this.mode||this.featureExpressionInfo||this.unit?super.write(t,e):null}clone(){return new o7({mode:this.mode,offset:this.offset,featureExpressionInfo:this.featureExpressionInfo?this.featureExpressionInfo.clone():void 0,unit:this.unit})}equals(t){return this.mode===t.mode&&this.offset===t.offset&&this.unit===t.unit&&hMe(this.featureExpressionInfo,t.featureExpressionInfo)}};u([d({type:dte,json:{write:!0}})],Fm.prototype,"featureExpressionInfo",void 0),u([Ee("featureExpressionInfo",["featureExpressionInfo","featureExpression"])],Fm.prototype,"readFeatureExpressionInfo",null),u([Fe("featureExpressionInfo",{featureExpressionInfo:{type:dte},"featureExpression.value":{type:[0]}})],Fm.prototype,"writeFeatureExpressionInfo",null),u([d({type:tM.apiValues,nonNullable:!0,json:{type:tM.jsonValues,read:tM.read,write:{writer:tM.write,isRequired:!0}}})],Fm.prototype,"mode",null),u([d({type:Number,json:{write:!0}})],Fm.prototype,"offset",void 0),u([d({type:FVe,json:{type:String,read:pte.read,write:pte.write}})],Fm.prototype,"unit",null),Fm=o7=u([R("esri.layers.support.ElevationInfo")],Fm);const UVe=Fm,Q0e={type:Boolean,value:!0,json:{origins:{service:{read:!1,write:!1},"web-map":{read:!1,write:!1}},name:"screenSizePerspective",write:!0}},d5={type:Boolean,value:!0,json:{name:"disablePopup",read:{reader:(t,e)=>!e.disablePopup},write:{enabled:!0,writer(t,e,r){e[r]=!t}}}},p5={type:Boolean,value:!0,nonNullable:!0,json:{name:"showLabels",write:!0}},K0e={type:String,json:{origins:{"portal-item":{write:!1}},write:{isRequired:!0,ignoreOrigin:!0,writer:O_}}},e_e={type:Boolean,value:!0,nonNullable:!0,json:{origins:{service:{read:{enabled:!1}}},name:"showLegend",write:!0}},t_e={value:null,type:UVe,json:{origins:{service:{name:"elevationInfo",write:!0}},name:"layerDefinition.elevationInfo",write:!0}};function SCt(t){return{type:t,readOnly:!0,json:{origins:{service:{read:!0}},read:!1}}}const r_e={write:!0,read:!0},a7={type:Number,json:{origins:{"web-document":r_e,"portal-item":{write:!0}}}},kVe={...a7,json:{...a7.json,origins:{"web-document":{...r_e,write:{enabled:!0,target:{opacity:{type:Number},"layerDefinition.drawingInfo.transparency":{type:Number}}}}},read:{source:["layerDefinition.drawingInfo.transparency","drawingInfo.transparency"],reader:(t,e,r)=>r&&r.origin!=="service"||!e.drawingInfo||e.drawingInfo.transparency===void 0?e.layerDefinition&&e.layerDefinition.drawingInfo&&e.layerDefinition.drawingInfo.transparency!==void 0?s2(e.layerDefinition.drawingInfo.transparency):void 0:s2(e.drawingInfo.transparency)}}},ECt={type:rm,readOnly:!0,get(){if(!this.layer?.timeInfo)return null;const{datesInUnknownTimezone:t,timeOffset:e,useViewTime:r}=this.layer,i=this.view?.timeExtent;let s=this.layer.timeExtent;t&&(s=$Ve(s));let n=r?i&&s?i.intersection(s):i||s:s;if(!n||n.isEmpty||n.isAllTime)return n;e&&(n=n.offset(-e.value,e.unit)),t&&(n=IVe(n));const o=this._get("timeExtent");return n.equals(o)?o:n}},CCt={type:_r,readOnly:!0,json:{origins:{service:{read:{source:["fullExtent","spatialReference"],reader:(t,e)=>{const r=_r.fromJSON(t);return e.spatialReference!=null&&typeof e.spatialReference=="object"&&(r.spatialReference=je.fromJSON(e.spatialReference)),r}}}},read:!1}},i_e={type:String,json:{origins:{service:{read:!1},"portal-item":{read:!1}}}},VVe={type:Number,json:{origins:{service:{write:{enabled:!1}}},read:{source:"layerDefinition.minScale"},write:{target:"layerDefinition.minScale"}}},zVe={type:Number,json:{origins:{service:{write:{enabled:!1}}},read:{source:"layerDefinition.maxScale"},write:{target:"layerDefinition.maxScale"}}},s_e={json:{write:{ignoreOrigin:!0},origins:{"web-map":{read:!1,write:!1}}}},fte=new Map([["AUS Central Standard Time","Australia/Darwin"],["AUS Eastern Standard Time","Australia/Sydney"],["Afghanistan Standard Time","Asia/Kabul"],["Alaskan Standard Time","America/Anchorage"],["Aleutian Standard Time","America/Adak"],["Altai Standard Time","Asia/Barnaul"],["Arab Standard Time","Asia/Riyadh"],["Arabian Standard Time","Asia/Dubai"],["Arabic Standard Time","Asia/Baghdad"],["Argentina Standard Time","America/Buenos_Aires"],["Astrakhan Standard Time","Europe/Astrakhan"],["Atlantic Standard Time","America/Halifax"],["Aus Central W. Standard Time","Australia/Eucla"],["Azerbaijan Standard Time","Asia/Baku"],["Azores Standard Time","Atlantic/Azores"],["Bahia Standard Time","America/Bahia"],["Bangladesh Standard Time","Asia/Dhaka"],["Belarus Standard Time","Europe/Minsk"],["Bougainville Standard Time","Pacific/Bougainville"],["Canada Central Standard Time","America/Regina"],["Cape Verde Standard Time","Atlantic/Cape_Verde"],["Caucasus Standard Time","Asia/Yerevan"],["Cen. Australia Standard Time","Australia/Adelaide"],["Central America Standard Time","America/Guatemala"],["Central Asia Standard Time","Asia/Almaty"],["Central Brazilian Standard Time","America/Cuiaba"],["Central Europe Standard Time","Europe/Budapest"],["Central European Standard Time","Europe/Warsaw"],["Central Pacific Standard Time","Pacific/Guadalcanal"],["Central Standard Time","America/Chicago"],["Central Standard Time (Mexico)","America/Mexico_City"],["Chatham Islands Standard Time","Pacific/Chatham"],["China Standard Time","Asia/Shanghai"],["Cuba Standard Time","America/Havana"],["Dateline Standard Time","Etc/GMT+12"],["E. Africa Standard Time","Africa/Nairobi"],["E. Australia Standard Time","Australia/Brisbane"],["E. Europe Standard Time","Europe/Chisinau"],["E. South America Standard Time","America/Sao_Paulo"],["Easter Island Standard Time","Pacific/Easter"],["Eastern Standard Time","America/New_York"],["Eastern Standard Time (Mexico)","America/Cancun"],["Egypt Standard Time","Africa/Cairo"],["Ekaterinburg Standard Time","Asia/Yekaterinburg"],["FLE Standard Time","Europe/Kiev"],["Fiji Standard Time","Pacific/Fiji"],["GMT Standard Time","Europe/London"],["GTB Standard Time","Europe/Bucharest"],["Georgian Standard Time","Asia/Tbilisi"],["Greenland Standard Time","America/Godthab"],["Greenwich Standard Time","Atlantic/Reykjavik"],["Haiti Standard Time","America/Port-au-Prince"],["Hawaiian Standard Time","Pacific/Honolulu"],["India Standard Time","Asia/Calcutta"],["Iran Standard Time","Asia/Tehran"],["Israel Standard Time","Asia/Jerusalem"],["Jordan Standard Time","Asia/Amman"],["Kaliningrad Standard Time","Europe/Kaliningrad"],["Korea Standard Time","Asia/Seoul"],["Libya Standard Time","Africa/Tripoli"],["Line Islands Standard Time","Pacific/Kiritimati"],["Lord Howe Standard Time","Australia/Lord_Howe"],["Magadan Standard Time","Asia/Magadan"],["Magallanes Standard Time","America/Punta_Arenas"],["Marquesas Standard Time","Pacific/Marquesas"],["Mauritius Standard Time","Indian/Mauritius"],["Middle East Standard Time","Asia/Beirut"],["Montevideo Standard Time","America/Montevideo"],["Morocco Standard Time","Africa/Casablanca"],["Mountain Standard Time","America/Denver"],["Mountain Standard Time (Mexico)","America/Mazatlan"],["Myanmar Standard Time","Asia/Rangoon"],["N. Central Asia Standard Time","Asia/Novosibirsk"],["Namibia Standard Time","Africa/Windhoek"],["Nepal Standard Time","Asia/Katmandu"],["New Zealand Standard Time","Pacific/Auckland"],["Newfoundland Standard Time","America/St_Johns"],["Norfolk Standard Time","Pacific/Norfolk"],["North Asia East Standard Time","Asia/Irkutsk"],["North Asia Standard Time","Asia/Krasnoyarsk"],["North Korea Standard Time","Asia/Pyongyang"],["Omsk Standard Time","Asia/Omsk"],["Pacific SA Standard Time","America/Santiago"],["Pacific Standard Time","America/Los_Angeles"],["Pacific Standard Time (Mexico)","America/Tijuana"],["Pakistan Standard Time","Asia/Karachi"],["Paraguay Standard Time","America/Asuncion"],["Qyzylorda Standard Time","Asia/Qyzylorda"],["Romance Standard Time","Europe/Paris"],["Russia Time Zone 10","Asia/Srednekolymsk"],["Russia Time Zone 11","Asia/Kamchatka"],["Russia Time Zone 3","Europe/Samara"],["Russian Standard Time","Europe/Moscow"],["SA Eastern Standard Time","America/Cayenne"],["SA Pacific Standard Time","America/Bogota"],["SA Western Standard Time","America/La_Paz"],["SE Asia Standard Time","Asia/Bangkok"],["Saint Pierre Standard Time","America/Miquelon"],["Sakhalin Standard Time","Asia/Sakhalin"],["Samoa Standard Time","Pacific/Apia"],["Sao Tome Standard Time","Africa/Sao_Tome"],["Saratov Standard Time","Europe/Saratov"],["Singapore Standard Time","Asia/Singapore"],["South Africa Standard Time","Africa/Johannesburg"],["South Sudan Standard Time","Africa/Juba"],["Sri Lanka Standard Time","Asia/Colombo"],["Sudan Standard Time","Africa/Khartoum"],["Syria Standard Time","Asia/Damascus"],["Taipei Standard Time","Asia/Taipei"],["Tasmania Standard Time","Australia/Hobart"],["Tocantins Standard Time","America/Araguaina"],["Tokyo Standard Time","Asia/Tokyo"],["Tomsk Standard Time","Asia/Tomsk"],["Tonga Standard Time","Pacific/Tongatapu"],["Transbaikal Standard Time","Asia/Chita"],["Turkey Standard Time","Europe/Istanbul"],["Turks And Caicos Standard Time","America/Grand_Turk"],["US Eastern Standard Time","America/Indianapolis"],["US Mountain Standard Time","America/Phoenix"],["UTC","Etc/GMT"],["UTC+01","Etc/GMT-1"],["UTC+02","Etc/GMT-2"],["UTC+03","Etc/GMT-3"],["UTC+04","Etc/GMT-4"],["UTC+05","Etc/GMT-5"],["UTC+06","Etc/GMT-6"],["UTC+07","Etc/GMT-7"],["UTC+08","Etc/GMT-8"],["UTC+09","Etc/GMT-9"],["UTC+10","Etc/GMT-10"],["UTC+11","Etc/GMT-11"],["UTC+12","Etc/GMT-12"],["UTC+13","Etc/GMT-13"],["UTC+14","Etc/GMT-14"],["UTC-01","Etc/GMT+1"],["UTC-02","Etc/GMT+2"],["UTC-03","Etc/GMT+3"],["UTC-04","Etc/GMT+4"],["UTC-05","Etc/GMT+5"],["UTC-06","Etc/GMT+6"],["UTC-07","Etc/GMT+7"],["UTC-08","Etc/GMT+8"],["UTC-09","Etc/GMT+9"],["UTC-10","Etc/GMT+10"],["UTC-11","Etc/GMT+11"],["UTC-12","Etc/GMT+12"],["Ulaanbaatar Standard Time","Asia/Ulaanbaatar"],["Venezuela Standard Time","America/Caracas"],["Vladivostok Standard Time","Asia/Vladivostok"],["Volgograd Standard Time","Europe/Volgograd"],["W. Australia Standard Time","Australia/Perth"],["W. Central Africa Standard Time","Africa/Lagos"],["W. Europe Standard Time","Europe/Berlin"],["W. Mongolia Standard Time","Asia/Hovd"],["West Asia Standard Time","Asia/Tashkent"],["West Bank Standard Time","Asia/Hebron"],["West Pacific Standard Time","Pacific/Port_Moresby"],["Yakutsk Standard Time","Asia/Yakutsk"],["Yukon Standard Time","America/Whitehorse"]]);function BVe(t,e="system"){if(!t||!fte.has(t.timeZone))return e;const r=fte.get(t.timeZone);return jVe(t.timeZone)||t.respectsDaylightSaving?r:GVe(r)}function GVe(t){const e=gr.local().setZone(t),r=Math.min(e.set({month:1,day:1}).offset,e.set({month:5}).offset);return r===0?"Etc/UTC":`Etc/GMT${Ba.instance(-r).formatOffset(0,"narrow")}`}function jVe(t){return t.startsWith("UTC")}let o0=class extends Vi(de){constructor(e){super(e),this.legacy=null,this.timeZone="system"}readLegacy(e,r){const{timeZone:i,respectsDaylightSaving:s}=r;return{timeZone:i,respectsDaylightSaving:s}}readTimeZone(e,r){return"timeZoneIANA"in r?r.timeZoneIANA:BVe(r)}writeTimeZone(e,r){r.timeZoneIANA=e}equals(e){return e!=null&&this.timeZone!=null&&e.timeZone!=null&&this.timeZone===e.timeZone}};u([d()],o0.prototype,"legacy",void 0),u([Ee("legacy",["timeZone"])],o0.prototype,"readLegacy",null),u([d({type:String,nonNullable:!0})],o0.prototype,"timeZone",void 0),u([Ee("timeZone",["timeZone","timeZoneIANA","respectsDaylightSaving"])],o0.prototype,"readTimeZone",null),u([Fe("timeZone")],o0.prototype,"writeTimeZone",null),o0=u([R("esri.time.TimeReference")],o0);const d2=o0;let Um=class extends Vi(de){constructor(e){super(e),this.creatorField=null,this.creationDateField=null,this.editorField=null,this.editDateField=null,this.realm=null,this.dateFieldsTimeReference=null}};u([d()],Um.prototype,"creatorField",void 0),u([d()],Um.prototype,"creationDateField",void 0),u([d()],Um.prototype,"editorField",void 0),u([d()],Um.prototype,"editDateField",void 0),u([d()],Um.prototype,"realm",void 0),u([d({type:d2})],Um.prototype,"dateFieldsTimeReference",void 0),Um=u([R("esri.layers.support.EditFieldsInfo")],Um);const HVe=Um;let cf=class extends Vi(de){constructor(e){super(e)}};u([d({constructOnly:!0,json:{write:!0}})],cf.prototype,"name",void 0),u([d({constructOnly:!0,json:{write:!0}})],cf.prototype,"fields",void 0),u([d({constructOnly:!0,json:{write:!0}})],cf.prototype,"isAscending",void 0),u([d({constructOnly:!0,json:{write:!0}})],cf.prototype,"indexType",void 0),u([d({constructOnly:!0,json:{write:!0}})],cf.prototype,"isUnique",void 0),u([d({constructOnly:!0,json:{write:!0}})],cf.prototype,"description",void 0),cf=u([R("esri.layers.support.FeatureIndex")],cf);var l7;let Ds=l7=class extends de{constructor(t){super(t),this.cacheHint=void 0,this.dynamicDataSource=void 0,this.gdbVersion=null,this.geometryPrecision=void 0,this.historicMoment=null,this.maxAllowableOffset=void 0,this.objectIds=null,this.orderByFields=null,this.outFields=null,this.outSpatialReference=null,this.relationshipId=void 0,this.start=void 0,this.num=void 0,this.returnGeometry=!1,this.returnM=void 0,this.returnZ=void 0,this.where=null}_writeHistoricMoment(t,e){e.historicMoment=t&&t.getTime()}writeStart(t,e){e.resultOffset=this.start,e.resultRecordCount=this.num||10,this.start>0&&this.where==null&&(e.definitionExpression="1=1")}clone(){return new l7(K({cacheHint:this.cacheHint,dynamicDataSource:this.dynamicDataSource,gdbVersion:this.gdbVersion,geometryPrecision:this.geometryPrecision,historicMoment:this.historicMoment&&new Date(this.historicMoment.getTime()),maxAllowableOffset:this.maxAllowableOffset,objectIds:this.objectIds,orderByFields:this.orderByFields,outFields:this.outFields,outSpatialReference:this.outSpatialReference,relationshipId:this.relationshipId,start:this.start,num:this.num,returnGeometry:this.returnGeometry,where:this.where,returnZ:this.returnZ,returnM:this.returnM}))}};u([d({type:Boolean,json:{write:!0}})],Ds.prototype,"cacheHint",void 0),u([d({type:$d,json:{write:!0}})],Ds.prototype,"dynamicDataSource",void 0),u([d({type:String,json:{write:!0}})],Ds.prototype,"gdbVersion",void 0),u([d({type:Number,json:{write:!0}})],Ds.prototype,"geometryPrecision",void 0),u([d({type:Date})],Ds.prototype,"historicMoment",void 0),u([Fe("historicMoment")],Ds.prototype,"_writeHistoricMoment",null),u([d({type:Number,json:{write:!0}})],Ds.prototype,"maxAllowableOffset",void 0),u([d({type:[Number],json:{write:!0}})],Ds.prototype,"objectIds",void 0),u([d({type:[String],json:{write:!0}})],Ds.prototype,"orderByFields",void 0),u([d({type:[String],json:{write:!0}})],Ds.prototype,"outFields",void 0),u([d({type:je,json:{read:{source:"outSR"},write:{target:"outSR"}}})],Ds.prototype,"outSpatialReference",void 0),u([d({json:{write:!0}})],Ds.prototype,"relationshipId",void 0),u([d({type:Number,json:{read:{source:"resultOffset"}}})],Ds.prototype,"start",void 0),u([Fe("start"),Fe("num")],Ds.prototype,"writeStart",null),u([d({type:Number,json:{read:{source:"resultRecordCount"}}})],Ds.prototype,"num",void 0),u([d({json:{write:!0}})],Ds.prototype,"returnGeometry",void 0),u([d({type:Boolean,json:{write:{overridePolicy:t=>({enabled:t})}}})],Ds.prototype,"returnM",void 0),u([d({type:Boolean,json:{write:{overridePolicy:t=>({enabled:t})}}})],Ds.prototype,"returnZ",void 0),u([d({type:String,json:{read:{source:"definitionExpression"},write:{target:"definitionExpression"}}})],Ds.prototype,"where",void 0),Ds=l7=u([R("esri.rest.support.RelationshipQuery")],Ds),Ds.from=Zs(Ds);const SZ=Ds,PCt=Object.freeze(Object.defineProperty({__proto__:null,default:SZ},Symbol.toStringTag,{value:"Module"})),c7=new Rr({esriGeometryPoint:"point",esriGeometryMultipoint:"multipoint",esriGeometryPolyline:"polyline",esriGeometryPolygon:"polygon",esriGeometryMultiPatch:"multipatch"});async function qVe(t,e,r,i){const s=await J_(t);if(await EZ(t,e,i),!s.addAttachment)throw new F(i,"Layer source does not support addAttachment capability");return s.addAttachment(e,r)}function EZ(t,e,r){const{attributes:i}=e,{objectIdField:s}=t;return t.get("capabilities.data.supportsAttachment")?e?i?s&&i[s]?Promise.resolve():Promise.reject(new F(r,`feature is missing the identifying attribute ${s}`)):Promise.reject(new F(r,"'attributes' are required on a feature to query attachments")):Promise.reject(new F(r,"A feature is required to add/delete/update attachments")):Promise.reject(new F(r,"this layer doesn't support attachments"))}async function WVe(t,e,r,i,s){const n=await J_(t);if(await EZ(t,e,s),!n.updateAttachment)throw new F(s,"Layer source does not support updateAttachment capability");return n.updateAttachment(e,r,i)}async function ZVe(t,e,r){const{applyEdits:i}=await ae(()=>import("./editingSupport-9c55cbd4.js"),["./editingSupport-9c55cbd4.js","./normalizeUtils-996b11fe.js","./normalizeUtilsCommon-4aa2ad72.js"],import.meta.url),s=await t.load();return i(s,s.source,e,r)}async function XVe(t,e,r){const{uploadAssets:i}=await ae(()=>import("./editingSupport-9c55cbd4.js"),["./editingSupport-9c55cbd4.js","./normalizeUtils-996b11fe.js","./normalizeUtilsCommon-4aa2ad72.js"],import.meta.url),s=await t.load();return i(s,s.source,e,r)}async function YVe(t,e,r,i){const s=await J_(t);if(await EZ(t,e,i),!s.deleteAttachments)throw new F(i,"Layer source does not support deleteAttachments capability");return s.deleteAttachments(e,r)}async function JVe(t,e,r){const i=(await t.load({signal:e?.signal})).source;if(!i.fetchRecomputedExtents)throw new F(r,"Layer source does not support fetchUpdates capability");return i.fetchRecomputedExtents(e)}async function QVe(t,e,r,i){e=DUe.from(e),await t.load();const s=t.source,n=t.capabilities;if(!n?.data?.supportsAttachment)throw new F(i,"this layer doesn't support attachments");const{attachmentTypes:o,objectIds:a,globalIds:l,num:c,size:h,start:p,where:f}=e;if(!n?.operations?.supportsQueryAttachments&&(o?.length>0||l?.length>0||h?.length>0||c||p||f))throw new F(i,"when 'capabilities.operations.supportsQueryAttachments' is false, only objectIds is supported",e);if(!(a?.length||l?.length||f))throw new F(i,"'objectIds', 'globalIds', or 'where' are required to perform attachment query",e);if(!s.queryAttachments)throw new F(i,"Layer source does not support queryAttachments capability",e);return s.queryAttachments(e)}async function KVe(t,e,r,i){const s=await J_(t);if(!s.queryObjectIds)throw new F(i,"Layer source does not support queryObjectIds capability");return s.queryObjectIds(Y_.from(e)??t.createQuery(),r)}async function eze(t,e,r,i){const s=await J_(t);if(!s.queryFeatureCount)throw new F(i,"Layer source does not support queryFeatureCount capability");return s.queryFeatureCount(Y_.from(e)??t.createQuery(),r)}async function tze(t,e,r,i){const s=await J_(t);if(!s.queryExtent)throw new F(i,"Layer source does not support queryExtent capability");return s.queryExtent(Y_.from(e)??t.createQuery(),r)}async function rze(t,e,r,i){const s=await J_(t);if(!s.queryRelatedFeatures)throw new F(i,"Layer source does not support queryRelatedFeatures capability");return s.queryRelatedFeatures(SZ.from(e),r)}async function ize(t,e,r,i){const s=await J_(t);if(!s.queryRelatedFeaturesCount)throw new F(i,"Layer source does not support queryRelatedFeaturesCount capability");return s.queryRelatedFeaturesCount(SZ.from(e),r)}async function sze(t){const e=t.source;if(e?.refresh)try{const{dataChanged:r,updates:i}=await e.refresh();if(i!=null&&(t.sourceJSON={...t.sourceJSON,...i},t.read(i,{origin:"service",url:t.parsedUrl})),r)return!0}catch{}if(t.definitionExpression)try{return(await M9e(t.definitionExpression,t.fieldsIndex)).hasDateFunctions}catch{}return!1}function nze(t){const e=new Y_,r=t.get("capabilities.data"),i=t.get("capabilities.query");e.historicMoment=t.historicMoment,e.gdbVersion=t.gdbVersion,e.returnGeometry=!0,i&&(e.compactGeometryEnabled=i.supportsCompactGeometry,e.defaultSpatialReferenceEnabled=i.supportsDefaultSpatialReference),r&&(r.supportsZ&&t.returnZ!=null&&(e.returnZ=t.returnZ),r.supportsM&&t.returnM!=null&&(e.returnM=t.returnM)),e.outFields=["*"];const{timeOffset:s,timeExtent:n}=t;return e.timeExtent=s!=null&&n!=null?n.offset(-s.value,s.unit):n||null,e.multipatchOption=t.geometryType==="multipatch"?"xyFootprint":null,e}function n_e(t){const{globalIdField:e,fields:r}=t;if(e)return e;if(r){for(const i of r)if(i.type==="esriFieldTypeGlobalID")return i.name}}function o_e(t){const{objectIdField:e,fields:r}=t;if(e)return e;if(r){for(const i of r)if(i.type==="esriFieldTypeOID")return i.name}}function oze(t){return t.currentVersion?t.currentVersion:t.hasOwnProperty("capabilities")||t.hasOwnProperty("drawingInfo")||t.hasOwnProperty("hasAttachments")||t.hasOwnProperty("htmlPopupType")||t.hasOwnProperty("relationships")||t.hasOwnProperty("timeInfo")||t.hasOwnProperty("typeIdField")||t.hasOwnProperty("types")?10:9.3}async function J_(t){return(await t.load()).source}async function aze(t,e){if(!Gt||Gt.findCredential(t))return;let r;try{const i=await mye(t,e);i&&(r=await Gt.checkSignInStatus(`${i}/sharing`))}catch{}if(r)try{const i=e!=null?e.signal:null;await Gt.getCredential(t,{signal:i})}catch{}}async function lze(t,e){const r=t.parsedUrl?.path;r&&cze(t)&&await aze(r,e)}function cze(t){const e=t.editFieldsInfo;return!(!e?.creatorField&&!e?.editorField)||(t.userHasUpdateItemPrivileges?t.hasUpdateItemRestrictions:!!t.userHasFullEditingPrivileges&&t.hasFullEditingRestrictions)}function uze(t){return!t.sourceJSON?.isMultiServicesView&&(t.userHasUpdateItemPrivileges||t.editingEnabled)}const AU=Q2({types:hye});function CZ(t,e){if(t.defaultSymbol)return t.types&&t.types.length?new pZ({defaultSymbol:AU(t.defaultSymbol,t,e),field:t.typeIdField,uniqueValueInfos:t.types.map(r=>({id:r.id,symbol:AU(r.symbol,r,e)}))}):new i5({symbol:AU(t.defaultSymbol,t,e)})}let ST=class extends Vi(de){constructor(e){super(e),this.shapeAreaField=null,this.shapeLengthField=null,this.units=null}};u([d({type:String,json:{read:{source:"shapeAreaFieldName"}}})],ST.prototype,"shapeAreaField",void 0),u([d({type:String,json:{read:{source:"shapeLengthFieldName"}}})],ST.prototype,"shapeLengthField",void 0),u([d({type:String,json:{read:t=>zLe.read(t)||BLe.read(t)}})],ST.prototype,"units",void 0),ST=u([R("esri.layers.support.GeometryFieldsInfo")],ST);const hze=ST;var u7;let ET=u7=class extends de{constructor(t){super(t),this.floorField=null,this.viewAllMode=!1,this.viewAllLevelIds=new Pt}clone(){return new u7({floorField:this.floorField,viewAllMode:this.viewAllMode,viewAllLevelIds:this.viewAllLevelIds})}};u([d({type:String,json:{write:!0}})],ET.prototype,"floorField",void 0),u([d({json:{read:!1,write:!1}})],ET.prototype,"viewAllMode",void 0),u([d({json:{read:!1,write:!1}})],ET.prototype,"viewAllLevelIds",void 0),ET=u7=u([R("esri.layers.support.LayerFloorInfo")],ET);const a_e=ET,mte=new Rr({esriRelCardinalityOneToOne:"one-to-one",esriRelCardinalityOneToMany:"one-to-many",esriRelCardinalityManyToMany:"many-to-many"}),gte=new Rr({esriRelRoleOrigin:"origin",esriRelRoleDestination:"destination"});let Vu=class extends Vi(de){constructor(e){super(e),this.cardinality=null,this.composite=null,this.id=null,this.keyField=null,this.keyFieldInRelationshipTable=null,this.name=null,this.relatedTableId=null,this.relationshipTableId=null,this.role=null}};u([d({json:{read:mte.read,write:mte.write}})],Vu.prototype,"cardinality",void 0),u([d({json:{read:!0,write:!0}})],Vu.prototype,"composite",void 0),u([d({json:{read:!0,write:!0}})],Vu.prototype,"id",void 0),u([d({json:{read:!0,write:!0}})],Vu.prototype,"keyField",void 0),u([d({json:{read:!0,write:!0}})],Vu.prototype,"keyFieldInRelationshipTable",void 0),u([d({json:{read:!0,write:!0}})],Vu.prototype,"name",void 0),u([d({json:{read:!0,write:!0}})],Vu.prototype,"relatedTableId",void 0),u([d({json:{read:!0,write:!0}})],Vu.prototype,"relationshipTableId",void 0),u([d({json:{read:gte.read,write:gte.write}})],Vu.prototype,"role",void 0),Vu=u([R("esri.layers.support.Relationship")],Vu);const dze=Vu,pze={name:"supportsName",size:"supportsSize",contentType:"supportsContentType",keywords:"supportsKeywords",exifInfo:"supportsExifInfo"};function Nt(t,e,r){return!!l_e(t,e,r)}function rM(t,e,r){return l_e(t,e,r)}function l_e(t,e,r){return t&&t.hasOwnProperty(e)?t[e]:r}function fze(t){const e=t?.supportedSpatialAggregationStatistics?.map(r=>r.toLowerCase());return{envelope:!!e?.includes("envelopeaggregate"),centroid:!!e?.includes("centroidaggregate"),convexHull:!!e?.includes("convexhullaggregate")}}function jR(t,e){return!!t?.supportedOperationsWithCacheHint?.map(i=>i.toLowerCase())?.includes(e.toLowerCase())}function c_e(t,e){return{analytics:mze(t),attachment:gze(t),data:yze(t),metadata:_ze(t),operations:vze(t.capabilities,t,e),query:bze(t,e),queryRelated:wze(t),queryTopFeatures:xze(t),editing:Tze(t)}}function mze(t){return{supportsCacheHint:jR(t.advancedQueryCapabilities,"queryAnalytics")}}function gze(t){const e=t.attachmentProperties,r={supportsName:!1,supportsSize:!1,supportsContentType:!1,supportsKeywords:!1,supportsExifInfo:!1,supportsCacheHint:jR(t.advancedQueryCapabilities,"queryAttachments"),supportsResize:Nt(t,"supportsAttachmentsResizing",!1)};return e&&Array.isArray(e)&&e.forEach(i=>{const s=pze[i.name];s&&(r[s]=!!i.isEnabled)}),r}function yze(t){return{isVersioned:Nt(t,"isDataVersioned",!1),supportsAttachment:Nt(t,"hasAttachments",!1),supportsM:Nt(t,"hasM",!1),supportsZ:Nt(t,"hasZ",!1)}}function _ze(t){return{supportsAdvancedFieldProperties:Nt(t,"supportsFieldDescriptionProperty",!1)}}function vze(t,e,r){const i=t?t.toLowerCase().split(",").map(f=>f.trim()):[],s=r?Iw(r):null,n=i.includes(s!=null&&s.serverType==="MapServer"?"data":"query"),o=i.includes("editing")&&!e.datesInUnknownTimezone;let a=o&&i.includes("create"),l=o&&i.includes("delete"),c=o&&i.includes("update");const h=i.includes("changetracking"),p=e.advancedQueryCapabilities;return o&&!(a||l||c)&&(a=l=c=!0),{supportsCalculate:Nt(e,"supportsCalculate",!1),supportsTruncate:Nt(e,"supportsTruncate",!1),supportsValidateSql:Nt(e,"supportsValidateSql",!1),supportsAdd:a,supportsDelete:l,supportsEditing:o,supportsChangeTracking:h,supportsQuery:n,supportsQueryAnalytics:Nt(p,"supportsQueryAnalytic",!1),supportsQueryAttachments:Nt(p,"supportsQueryAttachments",!1),supportsQueryTopFeatures:Nt(p,"supportsTopFeaturesQuery",!1),supportsResizeAttachments:Nt(e,"supportsAttachmentsResizing",!1),supportsSync:i.includes("sync"),supportsUpdate:c,supportsExceedsLimitStatistics:Nt(e,"supportsExceedsLimitStatistics",!1),supportsAsyncConvert3D:Nt(e,"supportsAsyncConvert3D",!1)}}function bze(t,e){const r=t.advancedQueryCapabilities,i=t.ownershipBasedAccessControlForFeatures,s=t.archivingInfo,n=t.currentVersion,o=e?.includes("MapServer"),a=!o||n>=oe("mapserver-pbf-version-support"),l=tZ(e),c=new Set((t.supportedQueryFormats??"").split(",").map(h=>h.toLowerCase().trim()));return{supportsStatistics:Nt(r,"supportsStatistics",t.supportsStatistics),supportsPercentileStatistics:Nt(r,"supportsPercentileStatistics",!1),supportsSpatialAggregationStatistics:Nt(r,"supportsSpatialAggregationStatistics",!1),supportedSpatialAggregationStatistics:fze(r),supportsCentroid:Nt(r,"supportsReturningGeometryCentroid",!1),supportsDistance:Nt(r,"supportsQueryWithDistance",!1),supportsDistinct:Nt(r,"supportsDistinct",t.supportsAdvancedQueries),supportsExtent:Nt(r,"supportsReturningQueryExtent",!1),supportsGeometryProperties:Nt(r,"supportsReturningGeometryProperties",!1),supportsHavingClause:Nt(r,"supportsHavingClause",!1),supportsOrderBy:Nt(r,"supportsOrderBy",t.supportsAdvancedQueries),supportsPagination:Nt(r,"supportsPagination",!1),supportsQuantization:Nt(t,"supportsCoordinatesQuantization",!1),supportsQuantizationEditMode:Nt(t,"supportsQuantizationEditMode",!1),supportsQueryGeometry:Nt(t,"supportsReturningQueryGeometry",!1),supportsResultType:Nt(r,"supportsQueryWithResultType",!1),supportsMaxRecordCountFactor:Nt(r,"supportsMaxRecordCountFactor",!1),supportsSqlExpression:Nt(r,"supportsSqlExpression",!1),supportsStandardizedQueriesOnly:Nt(t,"useStandardizedQueries",!1),supportsTopFeaturesQuery:Nt(r,"supportsTopFeaturesQuery",!1),supportsQueryByOthers:Nt(i,"allowOthersToQuery",!0),supportsHistoricMoment:Nt(s,"supportsQueryWithHistoricMoment",!1),supportsFormatPBF:a&&c.has("pbf"),supportsDisjointSpatialRelationship:Nt(r,"supportsDisjointSpatialRel",!1),supportsCacheHint:Nt(r,"supportsQueryWithCacheHint",!1)||jR(r,"query"),supportsDefaultSpatialReference:Nt(r,"supportsDefaultSR",!1),supportsCompactGeometry:l,supportsFullTextSearch:Nt(r,"supportsFullTextSearch",!1),maxRecordCountFactor:rM(t,"maxRecordCountFactor",void 0),maxRecordCount:rM(t,"maxRecordCount",void 0),standardMaxRecordCount:rM(t,"standardMaxRecordCount",void 0),tileMaxRecordCount:rM(t,"tileMaxRecordCount",void 0)}}function wze(t){const e=t.advancedQueryCapabilities,r=Nt(e,"supportsAdvancedQueryRelated",!1);return{supportsPagination:Nt(e,"supportsQueryRelatedPagination",!1),supportsCount:r,supportsOrderBy:r,supportsCacheHint:jR(e,"queryRelated")}}function xze(t){return{supportsCacheHint:jR(t.advancedQueryCapabilities,"queryTopFilter")}}function Tze(t){const e=t.ownershipBasedAccessControlForFeatures,r=t?t.advancedEditingCapabilities:void 0;return{supportsGeometryUpdate:Nt(t,"allowGeometryUpdates",!0),supportsGlobalId:Nt(t,"supportsApplyEditsWithGlobalIds",!1),supportsReturnServiceEditsInSourceSpatialReference:Nt(t,"supportsReturnServiceEditsInSourceSR",!1),supportsRollbackOnFailure:Nt(t,"supportsRollbackOnFailureParameter",!1),supportsUpdateWithoutM:Nt(t,"allowUpdateWithoutMValues",!1),supportsUploadWithItemId:Nt(t,"supportsAttachmentsByUploadId",!1),supportsDeleteByAnonymous:Nt(e,"allowAnonymousToDelete",!0),supportsDeleteByOthers:Nt(e,"allowOthersToDelete",!0),supportsUpdateByAnonymous:Nt(e,"allowAnonymousToUpdate",!0),supportsUpdateByOthers:Nt(e,"allowOthersToUpdate",!0),supportsAsyncApplyEdits:Nt(r,"supportsAsyncApplyEdits",!1)}}const Sze=t=>{let e=class extends t{constructor(){super(...arguments),this.capabilities=null,this.copyright=null,this.dateFieldsTimeReference=null,this.datesInUnknownTimezone=!1,this.displayField=null,this.definitionExpression=null,this.editFieldsInfo=null,this.editingInfo=null,this.elevationInfo=null,this.floorInfo=null,this.fullExtent=null,this.gdbVersion=null,this.geometryFieldsInfo=null,this.geometryType=null,this.hasM=void 0,this.hasZ=void 0,this.heightModelInfo=null,this.historicMoment=null,this.isTable=!1,this.layerId=void 0,this.minScale=0,this.maxScale=0,this.globalIdField=null,this.objectIdField=null,this.preferredTimeReference=null,this.relationships=null,this.sourceJSON=null,this.returnM=void 0,this.returnZ=void 0,this.serviceDefinitionExpression=null,this.serviceItemId=null,this.spatialReference=je.WGS84,this.subtypeField=null,this.trackIdField=null,this.indexes=new(Pt.ofType(cf)),this.version=void 0}readCapabilitiesFromService(r,i){return c_e(i,this.url)}get effectiveCapabilities(){const r=this.capabilities;if(!r)return null;const i=K(r),{operations:s,editing:n}=i;return this.sourceJSON?.isMultiServicesView?(this.userHasUpdateItemPrivileges&&(s.supportsQuery=!0),i):this.userHasUpdateItemPrivileges?(s.supportsAdd=s.supportsDelete=s.supportsEditing=s.supportsQuery=s.supportsUpdate=n.supportsDeleteByOthers=n.supportsGeometryUpdate=n.supportsUpdateByOthers=!0,i):(this.userHasFullEditingPrivileges&&s.supportsEditing&&(s.supportsAdd=s.supportsDelete=s.supportsUpdate=n.supportsGeometryUpdate=!0),i)}get hasFullEditingRestrictions(){const r=this.capabilities;if(!r||this.sourceJSON?.isMultiServicesView)return!1;const{operations:i,editing:s}=r;return i.supportsEditing&&!(i.supportsAdd&&i.supportsDelete&&i.supportsUpdate&&s.supportsGeometryUpdate)}get hasUpdateItemRestrictions(){const r=this.capabilities;if(!r)return!1;const{operations:i,editing:s}=r;return this.sourceJSON?.isMultiServicesView?!i.supportsQuery:!(i.supportsAdd&&i.supportsDelete&&i.supportsEditing&&i.supportsQuery&&i.supportsUpdate&&s.supportsDeleteByOthers&&s.supportsGeometryUpdate&&s.supportsUpdateByOthers)}readEditingInfo(r,i){const{editingInfo:s}=i;return s?{lastEditDate:s.lastEditDate!=null?new Date(s.lastEditDate):null}:null}readIsTableFromService(r,i){return i.type==="Table"}readMinScale(r,i){return i.effectiveMinScale||r||0}readMaxScale(r,i){return i.effectiveMaxScale||r||0}readGlobalIdFieldFromService(r,i){return n_e(i)}readObjectIdFieldFromService(r,i){return o_e(i)}readServiceDefinitionExpression(r,i){return i.definitionQuery||i.definitionExpression}set url(r){const i=Pye({layer:this,url:r,nonStandardUrlAllowed:!0,logger:Q.getLogger(this)});this._set("url",i.url),i.layerId!=null&&this._set("layerId",i.layerId)}writeUrl(r,i,s,n){Mye(this,r,null,i,n)}readVersion(r,i){return oze(i)}};return u([d({readOnly:!0,json:{read:!1,origins:{service:{read:{source:["advancedQueryCapabilities","allowGeometryUpdates","allowUpdateWithoutMValues","archivingInfo","capabilities","datesInUnknownTimezone","hasAttachments","hasM","hasZ","maxRecordCount","maxRecordCountFactor","ownershipBasedAccessControlForFeatures","standardMaxRecordCount","supportedQueryFormats","supportsAdvancedQueries","supportsApplyEditsWithGlobalIds","supportsAttachmentsByUploadId","supportsAttachmentsResizing","supportsCalculate","supportsCoordinatesQuantization","supportsExceedsLimitStatistics","supportsFieldDescriptionProperty","supportsQuantizationEditMode","supportsRollbackOnFailureParameter","supportsStatistics","supportsTruncate","supportsValidateSql","tileMaxRecordCount","useStandardizedQueries"]}}}}})],e.prototype,"capabilities",void 0),u([Ee("service","capabilities")],e.prototype,"readCapabilitiesFromService",null),u([d({readOnly:!0})],e.prototype,"effectiveCapabilities",null),u([d({readOnly:!0})],e.prototype,"hasFullEditingRestrictions",null),u([d({readOnly:!0})],e.prototype,"hasUpdateItemRestrictions",null),u([d({type:String,json:{origins:{service:{read:{source:"copyrightText"}}}}})],e.prototype,"copyright",void 0),u([d({type:d2})],e.prototype,"dateFieldsTimeReference",void 0),u([d({type:Boolean})],e.prototype,"datesInUnknownTimezone",void 0),u([d({type:String,json:{origins:{service:{read:{source:"displayField"}}}}})],e.prototype,"displayField",void 0),u([d({type:String,json:{origins:{service:{read:!1,write:!1}},name:"layerDefinition.definitionExpression",write:{enabled:!0,allowNull:!0}}})],e.prototype,"definitionExpression",void 0),u([d({readOnly:!0,type:HVe})],e.prototype,"editFieldsInfo",void 0),u([d({readOnly:!0})],e.prototype,"editingInfo",void 0),u([Ee("editingInfo")],e.prototype,"readEditingInfo",null),u([d((()=>{const r=K(t_e),i=r.json.origins;return i["web-map"]={read:!1,write:!1},i["portal-item"]={read:!1,write:!1},r})())],e.prototype,"elevationInfo",void 0),u([d({type:a_e,json:{read:{source:"layerDefinition.floorInfo"},write:{target:"layerDefinition.floorInfo"}}})],e.prototype,"floorInfo",void 0),u([d({type:_r,json:{origins:{service:{read:{source:"extent"}}}}})],e.prototype,"fullExtent",void 0),u([d()],e.prototype,"gdbVersion",void 0),u([d({readOnly:!0,type:hze,json:{read:{source:"geometryProperties"}}})],e.prototype,"geometryFieldsInfo",void 0),u([d({type:["point","polygon","polyline","multipoint","multipatch","mesh"],json:{origins:{service:{read:c7.read}}}})],e.prototype,"geometryType",void 0),u([d({type:Boolean,json:{origins:{service:{read:!0}}}})],e.prototype,"hasM",void 0),u([d({type:Boolean,json:{origins:{service:{read:!0}}}})],e.prototype,"hasZ",void 0),u([d({readOnly:!0,type:$w})],e.prototype,"heightModelInfo",void 0),u([d({type:Date})],e.prototype,"historicMoment",void 0),u([d({readOnly:!0})],e.prototype,"isTable",void 0),u([Ee("service","isTable",["type"])],e.prototype,"readIsTableFromService",null),u([d({type:Number,json:{origins:{service:{read:{source:"id"}},"portal-item":{read:!1,write:{target:"id"}}},read:!1}})],e.prototype,"layerId",void 0),u([d(VVe)],e.prototype,"minScale",void 0),u([Ee("service","minScale",["minScale","effectiveMinScale"])],e.prototype,"readMinScale",null),u([d(zVe)],e.prototype,"maxScale",void 0),u([Ee("service","maxScale",["maxScale","effectiveMaxScale"])],e.prototype,"readMaxScale",null),u([d({type:String})],e.prototype,"globalIdField",void 0),u([Ee("service","globalIdField",["globalIdField","fields"])],e.prototype,"readGlobalIdFieldFromService",null),u([d({type:String})],e.prototype,"objectIdField",void 0),u([Ee("service","objectIdField",["objectIdField","fields"])],e.prototype,"readObjectIdFieldFromService",null),u([d({type:d2})],e.prototype,"preferredTimeReference",void 0),u([d({type:[dze],readOnly:!0})],e.prototype,"relationships",void 0),u([d()],e.prototype,"sourceJSON",void 0),u([d({type:Boolean})],e.prototype,"returnM",void 0),u([d({type:Boolean})],e.prototype,"returnZ",void 0),u([d({readOnly:!0})],e.prototype,"serviceDefinitionExpression",void 0),u([Ee("service","serviceDefinitionExpression",["definitionQuery","definitionExpression"])],e.prototype,"readServiceDefinitionExpression",null),u([d({type:String,readOnly:!0,json:{read:!1,origins:{service:{read:!0}}}})],e.prototype,"serviceItemId",void 0),u([d({type:je,json:{origins:{service:{read:{source:"extent.spatialReference"}}}}})],e.prototype,"spatialReference",void 0),u([d({type:String,readOnly:!0,json:{origins:{service:{read:!0}}}})],e.prototype,"subtypeField",void 0),u([d({type:String,json:{read:{source:"timeInfo.trackIdField"}}})],e.prototype,"trackIdField",void 0),u([d({readOnly:!0,json:{write:!1}})],e.prototype,"serverGens",void 0),u([d({type:Pt.ofType(cf),readOnly:!0})],e.prototype,"indexes",void 0),u([d(K0e)],e.prototype,"url",null),u([Fe("url")],e.prototype,"writeUrl",null),u([d({json:{origins:{service:{read:!0}},read:!1}})],e.prototype,"version",void 0),u([Ee("service","version",["currentVersion","capabilities","drawingInfo","hasAttachments","htmlPopupType","relationships","timeInfo","typeIdField","types"])],e.prototype,"readVersion",null),e=u([R("esri.layers.mixins.FeatureLayerBase")],e),e};let CT=class extends Vi(de){constructor(e){super(e),this.expression=null,this.title=null,this.returnType=null}};u([d({type:String,json:{write:!0}})],CT.prototype,"expression",void 0),u([d({type:String,json:{write:!0}})],CT.prototype,"title",void 0),u([d({type:String,json:{write:!0}})],CT.prototype,"returnType",void 0),CT=u([R("esri.layers.support.ExpressionInfo")],CT);const AZ=CT;var h7;let km=h7=class extends de{constructor(t){super(t),this.isAutoGenerated=!1,this.name=null,this.alias=null,this.onStatisticField=null,this.onStatisticExpression=null,this.statisticType=null}clone(){return new h7({name:this.name,alias:this.alias,isAutoGenerated:this.isAutoGenerated,onStatisticExpression:K(this.onStatisticExpression),onStatisticField:this.onStatisticField,statisticType:this.statisticType})}};u([d({type:Boolean,json:{write:!0}})],km.prototype,"isAutoGenerated",void 0),u([d({type:String,json:{write:!0}})],km.prototype,"name",void 0),u([d({type:String,json:{write:!0}})],km.prototype,"alias",void 0),u([d({type:String,json:{write:!0}})],km.prototype,"onStatisticField",void 0),u([d({type:AZ,json:{write:!0}})],km.prototype,"onStatisticExpression",void 0),u([d({type:String,json:{write:!0}})],km.prototype,"statisticType",void 0),km=h7=u([R("esri.layers.support.AggregateField")],km);const rw=km;let vg=class extends de{constructor(){super(...arguments),this.type=null}};u([d({type:["selection","cluster","binning"],readOnly:!0,json:{read:!1,write:!0}})],vg.prototype,"type",void 0),vg=u([R("esri.layers.support.FeatureReduction")],vg);const OZ="__begin__",RZ="__end__",Eze=new RegExp(OZ,"ig"),Cze=new RegExp(RZ,"ig"),yte=new RegExp("^"+OZ,"i"),_te=new RegExp(RZ+"$","i"),RN='"',Aze=RN+" + ",Oze=" + "+RN;function Rze(t){return t.replaceAll(new RegExp("\\[","g"),"{").replaceAll(new RegExp("\\]","g"),"}")}function Pze(t){return t.replaceAll(new RegExp("\\{","g"),"[").replaceAll(new RegExp("\\}","g"),"]")}function f5(t){const e={expression:"",type:"none"};return t.labelExpressionInfo?t.labelExpressionInfo.value?(e.expression=t.labelExpressionInfo.value,e.type="conventional"):t.labelExpressionInfo.expression&&(e.expression=t.labelExpressionInfo.expression,e.type="arcade"):t.labelExpression!=null&&(e.expression=Rze(t.labelExpression),e.type="conventional"),e}function Mze(t){const e=f5(t);if(!e)return null;switch(e.type){case"conventional":return d7(e.expression);case"arcade":return e.expression}return null}function Ize(t){const e=f5(t);if(!e)return null;switch(e.type){case"conventional":return Lze(e.expression);case"arcade":return PZ(e.expression)}return null}function d7(t){let e;return t?(e=_F(t,r=>OZ+'$feature["'+r+'"]'+RZ),e=yte.test(e)?e.replace(yte,""):RN+e,e=_te.test(e)?e.replace(_te,""):e+RN,e=e.replaceAll(Eze,Aze).replaceAll(Cze,Oze)):e='""',e}const $ze=/^\s*\{([^}]+)\}\s*$/i;function Lze(t){const e=t?.match($ze);return e&&e[1].trim()||null}const Dze=/^\s*(?:(?:\$feature\.(\w+))|(?:\$feature\[(["'])([\w\s]+)(\2)\]));?\s*$/i,Nze=/^\s*(?:(?:\$feature\.(\w+))|(?:\$feature\[(["'])([\w\s]+)(\2)\]));?\s*(?:DomainName\(\s*\$feature\s*,\s*(["'])(\1|\3)(\5)\s*\));?\s*$/i,Fze=/^\s*(?:DomainName\(\s*\$feature\s*,\s*(["'])([\w\s]+)(\1)\s*\));?\s*$/i;function PZ(t){if(!t)return null;let e=Dze.exec(t)||Nze.exec(t);return e?e[1]||e[3]:(e=Fze.exec(t),e?e[2]:null)}var p7;let a0=p7=class extends de{constructor(){super(...arguments),this.expression=null,this.title=null,this.value=null}readExpression(t,e){return e.value?d7(e.value):t}writeExpression(t,e,r){this.value!=null&&(t=d7(this.value)),t!=null&&(e[r]=t)}clone(){return new p7({expression:this.expression,title:this.title,value:this.value})}};u([d({type:String,json:{write:{writerEnsuresNonNull:!0}}})],a0.prototype,"expression",void 0),u([Ee("expression",["expression","value"])],a0.prototype,"readExpression",null),u([Fe("expression")],a0.prototype,"writeExpression",null),u([d({type:String,json:{write:!0,origins:{"web-scene":{write:!1}}}})],a0.prototype,"title",void 0),u([d({json:{read:!1,write:!1}})],a0.prototype,"value",void 0),a0=p7=u([R("esri.layers.support.LabelExpressionInfo")],a0);const u_e=a0,h_e=[252,146,31,255],DCt=[153,153,153,255],Uze={type:"esriSMS",style:"esriSMSCircle",size:6,color:h_e,outline:{type:"esriSLS",style:"esriSLSSolid",width:.75,color:[153,153,153,255]}},kze={type:"esriSLS",style:"esriSLSSolid",width:.75,color:h_e},Vze={type:"esriSFS",style:"esriSFSSolid",color:[252,146,31,196],outline:{type:"esriSLS",style:"esriSLSSolid",width:.75,color:[255,255,255,191]}},zze={type:"esriTS",color:[255,255,255,255],font:{family:"arial-unicode-ms",size:10,weight:"bold"},horizontalAlignment:"center",kerning:!0,haloColor:[0,0,0,255],haloSize:1,rotated:!1,text:"",xoffset:0,yoffset:0,angle:0},Bze={type:"esriSMS",style:"esriSMSCircle",color:[0,0,0,255],outline:null,size:10.5},Gze={type:"esriSLS",style:"esriSLSSolid",color:[0,0,0,255],width:1.5},jze={type:"esriSFS",style:"esriSFSSolid",color:[0,0,0,255],outline:null},Hze=Wg.fromJSON(Uze),qze=wu.fromJSON(kze),Wze=X_.fromJSON(Vze),Zze=iE.fromJSON(zze);function NCt(t){if(t==null)return null;switch(t.type){case"mesh":return null;case"point":case"multipoint":return Hze;case"polyline":return qze;case"polygon":case"extent":return Wze}return null}Wg.fromJSON(Bze);wu.fromJSON(Gze);X_.fromJSON(jze);var f7;const iM=new Rr({esriServerPointLabelPlacementAboveCenter:"above-center",esriServerPointLabelPlacementAboveLeft:"above-left",esriServerPointLabelPlacementAboveRight:"above-right",esriServerPointLabelPlacementBelowCenter:"below-center",esriServerPointLabelPlacementBelowLeft:"below-left",esriServerPointLabelPlacementBelowRight:"below-right",esriServerPointLabelPlacementCenterCenter:"center-center",esriServerPointLabelPlacementCenterLeft:"center-left",esriServerPointLabelPlacementCenterRight:"center-right",esriServerLinePlacementAboveAfter:"above-after",esriServerLinePlacementAboveAlong:"above-along",esriServerLinePlacementAboveBefore:"above-before",esriServerLinePlacementAboveStart:"above-start",esriServerLinePlacementAboveEnd:"above-end",esriServerLinePlacementBelowAfter:"below-after",esriServerLinePlacementBelowAlong:"below-along",esriServerLinePlacementBelowBefore:"below-before",esriServerLinePlacementBelowStart:"below-start",esriServerLinePlacementBelowEnd:"below-end",esriServerLinePlacementCenterAfter:"center-after",esriServerLinePlacementCenterAlong:"center-along",esriServerLinePlacementCenterBefore:"center-before",esriServerLinePlacementCenterStart:"center-start",esriServerLinePlacementCenterEnd:"center-end",esriServerPolygonPlacementAlwaysHorizontal:"always-horizontal"},{ignoreUnknown:!0});function sM(t,e,r){return{enabled:!pye(r?.layer)}}function d_e(t){return!t||t.origin!=="service"&&t.layer?.type!=="map-image"}function Xze(t){return t?.type==="map-image"}function p_e(t){return!!Xze(t)&&!!t.capabilities?.exportMap?.supportsArcadeExpressionForLabeling}function Yze(t){return d_e(t)||p_e(t?.layer)}let Ys=f7=class extends de{static evaluateWhere(t,e){const r=(i,s,n)=>{switch(s){case"=":return i==n;case"<>":return i!=n;case">":return i>n;case">=":return i>=n;case"<":return i<n;case"<=":return i<=n}return!1};try{if(t==null)return!0;const i=t.split(" ");if(i.length===3)return r(e[i[0]],i[1],i[2]);if(i.length===7){const s=r(e[i[0]],i[1],i[2]),n=i[3],o=r(e[i[4]],i[5],i[6]);switch(n){case"AND":return s&&o;case"OR":return s||o}}return!1}catch{console.log("Error.: can't parse = "+t)}}constructor(t){super(t),this.type="label",this.name=null,this.allowOverrun=!1,this.deconflictionStrategy="static",this.labelExpression=null,this.labelExpressionInfo=null,this.labelPlacement=null,this.labelPosition="curved",this.maxScale=0,this.minScale=0,this.repeatLabel=!0,this.repeatLabelDistance=null,this.symbol=Zze,this.useCodedValues=void 0,this.where=null}readLabelExpression(t,e){const r=e.labelExpressionInfo;if(!r||!r.value&&!r.expression)return t}writeLabelExpression(t,e,r){if(this.labelExpressionInfo){if(this.labelExpressionInfo.value!=null)t=Pze(this.labelExpressionInfo.value);else if(this.labelExpressionInfo.expression!=null){const i=PZ(this.labelExpressionInfo.expression);i&&(t="["+i+"]")}}t!=null&&(e[r]=t)}writeLabelExpressionInfo(t,e,r,i){if(t==null&&this.labelExpression!=null&&d_e(i))t=new u_e({expression:this.getLabelExpressionArcade()});else if(!t)return;const s=t.toJSON(i);s.expression&&(e[r]=s)}writeMaxScale(t,e){(t||this.minScale)&&(e.maxScale=t)}writeMinScale(t,e){(t||this.maxScale)&&(e.minScale=t)}getLabelExpression(){return f5(this)}getLabelExpressionArcade(){return Mze(this)}getLabelExpressionSingleField(){return Ize(this)}hash(){return JSON.stringify(this)}clone(){return new f7({allowOverrun:this.allowOverrun,deconflictionStrategy:this.deconflictionStrategy,labelExpression:this.labelExpression,labelExpressionInfo:K(this.labelExpressionInfo),labelPosition:this.labelPosition,labelPlacement:this.labelPlacement,maxScale:this.maxScale,minScale:this.minScale,name:this.name,repeatLabel:this.repeatLabel,repeatLabelDistance:this.repeatLabelDistance,symbol:K(this.symbol),where:this.where,useCodedValues:this.useCodedValues})}};u([d({type:String,json:{write:!0}})],Ys.prototype,"name",void 0),u([d({type:Boolean,json:{write:!0,default:!1,origins:{"web-scene":{write:!1},"portal-item":{default:!1,write:{overridePolicy:sM}}}}})],Ys.prototype,"allowOverrun",void 0),u([d({type:String,json:{write:!0,default:"static",origins:{"web-scene":{write:!1},"portal-item":{default:"static",write:{overridePolicy:sM}}}}})],Ys.prototype,"deconflictionStrategy",void 0),u([d({type:String,json:{write:{overridePolicy(t,e,r){return this.labelExpressionInfo&&r?.origin==="service"&&p_e(r.layer)?{enabled:!1}:{allowNull:!0}}}}})],Ys.prototype,"labelExpression",void 0),u([Ee("labelExpression")],Ys.prototype,"readLabelExpression",null),u([Fe("labelExpression")],Ys.prototype,"writeLabelExpression",null),u([d({type:u_e,json:{write:{overridePolicy:(t,e,r)=>Yze(r)?{allowNull:!0}:{enabled:!1}}}})],Ys.prototype,"labelExpressionInfo",void 0),u([Fe("labelExpressionInfo")],Ys.prototype,"writeLabelExpressionInfo",null),u([d({type:iM.apiValues,json:{type:iM.jsonValues,read:iM.read,write:iM.write}})],Ys.prototype,"labelPlacement",void 0),u([d({type:["curved","parallel"],json:{write:!0,origins:{"web-map":{write:!1},"web-scene":{write:!1},"portal-item":{write:!1}}}})],Ys.prototype,"labelPosition",void 0),u([d({type:Number})],Ys.prototype,"maxScale",void 0),u([Fe("maxScale")],Ys.prototype,"writeMaxScale",null),u([d({type:Number})],Ys.prototype,"minScale",void 0),u([Fe("minScale")],Ys.prototype,"writeMinScale",null),u([d({type:Boolean,json:{write:!0,origins:{"web-scene":{write:!1},"portal-item":{write:{overridePolicy:sM}}}}})],Ys.prototype,"repeatLabel",void 0),u([d({type:Number,cast:Jr,json:{write:!0,origins:{"web-scene":{write:!1},"portal-item":{write:{overridePolicy:sM}}}}})],Ys.prototype,"repeatLabelDistance",void 0),u([d({types:MUe,json:{origins:{"web-scene":{types:IUe,write:xee,default:null}},write:xee,default:null}})],Ys.prototype,"symbol",void 0),u([d({type:Boolean,json:{write:!0}})],Ys.prototype,"useCodedValues",void 0),u([d({type:String,json:{write:!0}})],Ys.prototype,"where",void 0),Ys=f7=u([R("esri.layers.support.LabelClass")],Ys);const HR=Ys;var m7;const Jze="esri.layers.support.FeatureReductionBinning";let ll=m7=class extends vg{constructor(t){super(t),this.type="binning",this.binType="geohash",this.fixedBinLevel=3,this.labelingInfo=null,this.labelsVisible=!0,this.maxScale=0,this.popupEnabled=!0,this.popupTemplate=null,this.fields=[],this.renderer=null}writeFields(t,e,r){const i=t.filter(s=>s.statisticType!=="avg_angle").map(s=>s.toJSON());Ha(r,i,e)}readRenderer(t,e,r){const i=e.drawingInfo?.renderer;return i?$O(i,e,r)??void 0:CZ(e,r)}clone(){return new m7({fields:K(this.fields),fixedBinLevel:this.fixedBinLevel,labelingInfo:K(this.labelingInfo),labelsVisible:this.labelsVisible,maxScale:this.maxScale,popupEnabled:this.popupEnabled,popupTemplate:K(this.popupTemplate),renderer:K(this.renderer)})}};u([tt({binning:"binning"})],ll.prototype,"type",void 0),u([tt({geohash:"geohash"})],ll.prototype,"binType",void 0),u([d({type:Number,range:{min:1,max:9},json:{write:!0}})],ll.prototype,"fixedBinLevel",void 0),u([d({type:[HR],json:{read:{source:"drawingInfo.labelingInfo"},write:{target:"drawingInfo.labelingInfo"}}})],ll.prototype,"labelingInfo",void 0),u([d(p5)],ll.prototype,"labelsVisible",void 0),u([d({type:Number,json:{default:0,name:"visibilityInfo.maxScale"}})],ll.prototype,"maxScale",void 0),u([d(d5)],ll.prototype,"popupEnabled",void 0),u([d({type:eE,json:{name:"popupInfo",write:!0}})],ll.prototype,"popupTemplate",void 0),u([d({type:[rw],json:{write:!0}})],ll.prototype,"fields",void 0),u([Fe("fields")],ll.prototype,"writeFields",null),u([d({types:s5,json:{write:{target:"drawingInfo.renderer"}}})],ll.prototype,"renderer",void 0),u([Ee("renderer",["drawingInfo.renderer"])],ll.prototype,"readRenderer",null),ll=m7=u([R(Jze)],ll);const f_e=ll;var g7;const Qze="esri.layers.support.FeatureReductionCluster";function vte(t){return t.type==="simple"&&!t.visualVariables?.length}let Fn=g7=class extends de{constructor(t){super(t),this.type="cluster",this.clusterRadius=Jr("80px"),this.clusterMinSize=Jr("12px"),this.clusterMaxSize=Jr("50px"),this.maxScale=0,this.popupEnabled=!0,this.popupTemplate=null,this.renderer=null,this.symbol=null,this.labelingInfo=null,this.labelsVisible=!0,this.fields=null}readRenderer(t,e,r){const i=e.drawingInfo?.renderer;return i?.authoringInfo?.isAutoGenerated?null:i?vte(i)?null:$O(i,e,r)??void 0:CZ(e,r)}readSymbol(t,e,r){const i=e.drawingInfo?.renderer;return i?.authoringInfo?.isAutoGenerated?null:i&&vte(i)?$O(i,e,r)?.symbol:null}writeSymbol(t,e,r,i){const s=this.renderer?.authoringInfo?.isAutoGenerated;if(!this.renderer||s){const n=new i5({symbol:t});e.drawingInfo={renderer:n.write({},i)}}}writeFields(t,e,r){const i=t.filter(s=>s.statisticType!=="avg_angle").map(s=>s.toJSON());Ha(r,i,e)}readFields(t,e,r){return t.filter(i=>!i.isAutoGenerated).map(i=>rw.fromJSON(i))}clone(){return new g7({clusterRadius:this.clusterRadius,clusterMinSize:this.clusterMinSize,clusterMaxSize:this.clusterMaxSize,labelingInfo:K(this.labelingInfo),labelsVisible:this.labelsVisible,fields:K(this.fields),maxScale:this.maxScale,renderer:K(this.renderer),symbol:K(this.symbol),popupEnabled:this.popupEnabled,popupTemplate:K(this.popupTemplate)})}};u([d({type:["cluster"],readOnly:!0,json:{write:!0}})],Fn.prototype,"type",void 0),u([d({type:Number,cast:t=>t==="auto"?t:Jr(t),json:{write:!0}})],Fn.prototype,"clusterRadius",void 0),u([d({type:Number,cast:Jr,json:{write:!0}})],Fn.prototype,"clusterMinSize",void 0),u([d({type:Number,cast:Jr,json:{write:!0}})],Fn.prototype,"clusterMaxSize",void 0),u([d({type:Number,json:{default:0,name:"visibilityInfo.maxScale"}})],Fn.prototype,"maxScale",void 0),u([d(d5)],Fn.prototype,"popupEnabled",void 0),u([d({type:eE,json:{read:{source:"popupInfo"},write:{target:"popupInfo"}}})],Fn.prototype,"popupTemplate",void 0),u([d({types:s5,json:{write:{target:"drawingInfo.renderer"}}})],Fn.prototype,"renderer",void 0),u([Ee("renderer",["drawingInfo.renderer"])],Fn.prototype,"readRenderer",null),u([d({types:RUe})],Fn.prototype,"symbol",void 0),u([Ee("symbol",["drawingInfo.renderer"])],Fn.prototype,"readSymbol",null),u([Fe("symbol")],Fn.prototype,"writeSymbol",null),u([d({type:[HR],json:{read:{source:"drawingInfo.labelingInfo"},write:{target:"drawingInfo.labelingInfo"}}})],Fn.prototype,"labelingInfo",void 0),u([d(p5)],Fn.prototype,"labelsVisible",void 0),u([d({type:[rw],json:{write:!0}})],Fn.prototype,"fields",void 0),u([Fe("fields")],Fn.prototype,"writeFields",null),u([Ee("fields")],Fn.prototype,"readFields",null),Fn=g7=u([R(Qze)],Fn);const m_e=Fn;var y7;let AL=y7=class extends vg{constructor(t){super(t),this.type="selection"}clone(){return new y7}};u([d({type:["selection"]})],AL.prototype,"type",void 0),AL=y7=u([R("esri.layers.support.FeatureReductionSelection")],AL);const _7=AL,bte={key:"type",base:vg,typeMap:{cluster:m_e,binning:f_e}},Kze={types:{key:"type",base:vg,typeMap:{selection:_7,cluster:m_e,binning:f_e}},json:{name:"layerDefinition.featureReduction",write:{allowNull:!0},origins:{"web-map":{types:bte},"portal-item":{types:bte},"web-scene":{types:{key:"type",base:vg,typeMap:{selection:_7}}}}}},qw={Base64:0,Hex:1,String:2,Raw:3},RS=8,g_e=(1<<RS)-1;function t_(t,e){const r=(65535&t)+(65535&e);return(t>>16)+(e>>16)+(r>>16)<<16|65535&r}function eBe(t){const e=[];for(let r=0,i=t.length*RS;r<i;r+=RS)e[r>>5]|=(t.charCodeAt(r/RS)&g_e)<<r%32;return e}function tBe(t){const e=[];for(let r=0,i=32*t.length;r<i;r+=RS)e.push(String.fromCharCode(t[r>>5]>>>r%32&g_e));return e.join("")}function rBe(t){const e="0123456789abcdef",r=[];for(let i=0,s=4*t.length;i<s;i++)r.push(e.charAt(t[i>>2]>>i%4*8+4&15)+e.charAt(t[i>>2]>>i%4*8&15));return r.join("")}function iBe(t){const e="=",r="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",i=[];for(let s=0,n=4*t.length;s<n;s+=3){const o=(t[s>>2]>>s%4*8&255)<<16|(t[s+1>>2]>>(s+1)%4*8&255)<<8|t[s+2>>2]>>(s+2)%4*8&255;for(let a=0;a<4;a++)8*s+6*a>32*t.length?i.push(e):i.push(r.charAt(o>>6*(3-a)&63))}return i.join("")}function sBe(t,e){return t<<e|t>>>32-e}function m5(t,e,r,i,s,n){return t_(sBe(t_(t_(e,t),t_(i,n)),s),r)}function ya(t,e,r,i,s,n,o){return m5(e&r|~e&i,t,e,s,n,o)}function _a(t,e,r,i,s,n,o){return m5(e&i|r&~i,t,e,s,n,o)}function va(t,e,r,i,s,n,o){return m5(e^r^i,t,e,s,n,o)}function ba(t,e,r,i,s,n,o){return m5(r^(e|~i),t,e,s,n,o)}function nBe(t,e){t[e>>5]|=128<<e%32,t[14+(e+64>>>9<<4)]=e;let r=1732584193,i=-271733879,s=-1732584194,n=271733878;for(let o=0;o<t.length;o+=16){const a=r,l=i,c=s,h=n;r=ya(r,i,s,n,t[o],7,-680876936),n=ya(n,r,i,s,t[o+1],12,-389564586),s=ya(s,n,r,i,t[o+2],17,606105819),i=ya(i,s,n,r,t[o+3],22,-1044525330),r=ya(r,i,s,n,t[o+4],7,-176418897),n=ya(n,r,i,s,t[o+5],12,1200080426),s=ya(s,n,r,i,t[o+6],17,-1473231341),i=ya(i,s,n,r,t[o+7],22,-45705983),r=ya(r,i,s,n,t[o+8],7,1770035416),n=ya(n,r,i,s,t[o+9],12,-1958414417),s=ya(s,n,r,i,t[o+10],17,-42063),i=ya(i,s,n,r,t[o+11],22,-1990404162),r=ya(r,i,s,n,t[o+12],7,1804603682),n=ya(n,r,i,s,t[o+13],12,-40341101),s=ya(s,n,r,i,t[o+14],17,-1502002290),i=ya(i,s,n,r,t[o+15],22,1236535329),r=_a(r,i,s,n,t[o+1],5,-165796510),n=_a(n,r,i,s,t[o+6],9,-1069501632),s=_a(s,n,r,i,t[o+11],14,643717713),i=_a(i,s,n,r,t[o],20,-373897302),r=_a(r,i,s,n,t[o+5],5,-701558691),n=_a(n,r,i,s,t[o+10],9,38016083),s=_a(s,n,r,i,t[o+15],14,-660478335),i=_a(i,s,n,r,t[o+4],20,-405537848),r=_a(r,i,s,n,t[o+9],5,568446438),n=_a(n,r,i,s,t[o+14],9,-1019803690),s=_a(s,n,r,i,t[o+3],14,-187363961),i=_a(i,s,n,r,t[o+8],20,1163531501),r=_a(r,i,s,n,t[o+13],5,-1444681467),n=_a(n,r,i,s,t[o+2],9,-51403784),s=_a(s,n,r,i,t[o+7],14,1735328473),i=_a(i,s,n,r,t[o+12],20,-1926607734),r=va(r,i,s,n,t[o+5],4,-378558),n=va(n,r,i,s,t[o+8],11,-2022574463),s=va(s,n,r,i,t[o+11],16,1839030562),i=va(i,s,n,r,t[o+14],23,-35309556),r=va(r,i,s,n,t[o+1],4,-1530992060),n=va(n,r,i,s,t[o+4],11,1272893353),s=va(s,n,r,i,t[o+7],16,-155497632),i=va(i,s,n,r,t[o+10],23,-1094730640),r=va(r,i,s,n,t[o+13],4,681279174),n=va(n,r,i,s,t[o],11,-358537222),s=va(s,n,r,i,t[o+3],16,-722521979),i=va(i,s,n,r,t[o+6],23,76029189),r=va(r,i,s,n,t[o+9],4,-640364487),n=va(n,r,i,s,t[o+12],11,-421815835),s=va(s,n,r,i,t[o+15],16,530742520),i=va(i,s,n,r,t[o+2],23,-995338651),r=ba(r,i,s,n,t[o],6,-198630844),n=ba(n,r,i,s,t[o+7],10,1126891415),s=ba(s,n,r,i,t[o+14],15,-1416354905),i=ba(i,s,n,r,t[o+5],21,-57434055),r=ba(r,i,s,n,t[o+12],6,1700485571),n=ba(n,r,i,s,t[o+3],10,-1894986606),s=ba(s,n,r,i,t[o+10],15,-1051523),i=ba(i,s,n,r,t[o+1],21,-2054922799),r=ba(r,i,s,n,t[o+8],6,1873313359),n=ba(n,r,i,s,t[o+15],10,-30611744),s=ba(s,n,r,i,t[o+6],15,-1560198380),i=ba(i,s,n,r,t[o+13],21,1309151649),r=ba(r,i,s,n,t[o+4],6,-145523070),n=ba(n,r,i,s,t[o+11],10,-1120210379),s=ba(s,n,r,i,t[o+2],15,718787259),i=ba(i,s,n,r,t[o+9],21,-343485551),r=t_(r,a),i=t_(i,l),s=t_(s,c),n=t_(n,h)}return[r,i,s,n]}function y_e(t,e=qw.Hex){const r=e||qw.Base64,i=nBe(eBe(t),t.length*RS);switch(r){case qw.Raw:return i;case qw.Hex:return rBe(i);case qw.String:return tBe(i);case qw.Base64:return iBe(i)}}var v7;let wA=v7=class extends r5{writeLevels(t,e,r){for(const i in t){const s=this.levels[i];return void(e.stops=s)}}clone(){return new v7({axis:this.axis,field:this.field,valueExpression:this.valueExpression,valueExpressionTitle:this.valueExpressionTitle,maxDataValue:this.maxDataValue,maxSize:e_(this.maxSize)?this.maxSize.clone():this.maxSize,minDataValue:this.minDataValue,minSize:e_(this.minSize)?this.minSize.clone():this.minSize,normalizationField:this.normalizationField,stops:this.stops&&this.stops.map(t=>t.clone()),target:this.target,useSymbolValue:this.useSymbolValue,valueRepresentation:this.valueRepresentation,valueUnit:this.valueUnit,legendOptions:this.legendOptions&&this.legendOptions.clone(),levels:K(this.levels)})}};u([d()],wA.prototype,"levels",void 0),u([Fe("levels")],wA.prototype,"writeLevels",null),wA=v7=u([R("esri.views.2d.engine.LevelDependentSizeVariable")],wA);const oBe=Q.getLogger("esri.views.2d.layers.support.clusterUtils");oe.add("esri-cluster-arcade-enabled",!0);const aBe=oe("esri-cluster-arcade-enabled"),lBe=(t,e,r,i,s)=>{const n=e.clone();if(!dBe(n))return n;if(n.authoringInfo||(n.authoringInfo=new sZ),n.authoringInfo.isAutoGenerated=!0,"visualVariables"in n){const o=(n.visualVariables||[]).filter(l=>l.valueExpression!=="$view.scale"),a=cBe(o);o.forEach(l=>{l.type==="rotation"?l.field?l.field=pv(t,l.field,"avg_angle","number"):l.valueExpression&&(l.field=BE(t,l.valueExpression,"avg_angle","number"),l.valueExpression=null):l.normalizationField?(l.field=pv(t,l.field,"avg_norm","number",l.normalizationField),l.normalizationField=null):l.field?l.field=pv(t,l.field,"avg","number"):l.valueExpression&&(l.field=BE(t,l.valueExpression,"avg","number"),l.valueExpression=null)}),a==null&&!uBe(o)&&s&&(o.push(hBe(r,i)),n.dynamicClusterSize=!0),n.visualVariables=o}switch(n.type){case"simple":break;case"pie-chart":for(const o of n.attributes)o.field?o.field=pv(t,o.field,"sum","number"):o.valueExpression&&(o.field=BE(t,o.valueExpression,"sum","number"),o.valueExpression=null);break;case"unique-value":n.field?n.field=pv(t,n.field,"mode","string"):n.valueExpression&&(n.field=BE(t,n.valueExpression,"mode","string"),n.valueExpression=null);break;case"class-breaks":n.normalizationField?(n.field=pv(t,n.field,"avg_norm","number",n.normalizationField),n.normalizationField=null):n.field?n.field=pv(t,n.field,"avg","number"):n.valueExpression&&(n.field=BE(t,n.valueExpression,"avg","number"),n.valueExpression=null)}return n},cBe=t=>{for(const e of t)if(e.type==="size")return e;return null},uBe=t=>{for(const e of t)if(e.field==="cluster_count")return!0;return!1},hBe=(t,e)=>{const r=[new _T({value:0,size:0}),new _T({value:1})];if(e==null)return new r5({field:"cluster_count",stops:[...r,new _T({value:2,size:0})]});const i=Object.keys(e).reduce((s,n)=>({...s,[n]:[...r,new _T({value:Math.max(2,e[n].minValue),size:t.clusterMinSize}),new _T({value:Math.max(3,e[n].maxValue),size:t.clusterMaxSize})]}),{});return new wA({field:"cluster_count",levels:i})},dBe=t=>{const e=r=>oBe.error(new F("Unsupported-renderer",r,{renderer:t}));if(!t)return!1;switch(t.type){case"unique-value":if(t.field2||t.field3)return e("FeatureReductionCluster does not support multi-field UniqueValueRenderers"),!1;break;case"class-breaks":if(t.normalizationField){const r=t.normalizationType;if(r!=="field")return e(`FeatureReductionCluster does not support a normalizationType of ${r}`),!1}break;case"simple":case"pie-chart":break;default:return e(`FeatureReductionCluster does not support renderers of type ${t.type}`),!1}if(!aBe){if("valueExpression"in t&&t.valueExpression)return e("FeatureReductionCluster does not currently support renderer.valueExpression. Support will be added in a future release"),!1;if(("visualVariables"in t&&t.visualVariables||[]).some(r=>!(!("valueExpression"in r)||!r.valueExpression)))return e("FeatureReductionCluster does not currently support visualVariables with a valueExpression. Support will be added in a future release"),!1}return!0};function pBe(t,e,r){switch(t){case"sum":return`cluster_sum_${e}`;case"avg":case"avg_angle":return`cluster_avg_${e}`;case"mode":return`cluster_type_${e}`;case"avg_norm":{const i=r,s="field",n=e.toLowerCase()+",norm:"+s+","+i.toLowerCase();return"cluster_avg_"+y_e(n)}}}function BE(t,e,r,i){const s=y_e(e),n=r==="mode"?`cluster_type_${s}`:r==="sum"?`cluster_sum_${s}`:`cluster_avg_${s}`;return t.some(o=>o.name===n)||t.push(new rw({name:n,isAutoGenerated:!0,onStatisticExpression:new AZ({expression:e,returnType:i}),statisticType:r})),n}function pv(t,e,r,i,s){if(e==="cluster_count"||t.some(o=>o.name===e))return e;const n=pBe(r,e,s);return t.some(o=>o.name===n)||(r==="avg_norm"?t.push(new rw({name:n,isAutoGenerated:!0,onStatisticExpression:new AZ({expression:`$feature.${e} / $feature.${s}`,returnType:i}),statisticType:"avg"})):t.push(new rw({name:n,isAutoGenerated:!0,onStatisticField:e,statisticType:r}))),n}const fBe=t=>{let e=class extends t{constructor(...r){super(...r),this.own(this.watch("renderer",()=>{if(this.featureReduction){const i=this._normalizeFeatureReduction(this.featureReduction);this._set("featureReduction",i)}},!0))}set featureReduction(r){const i=this._normalizeFeatureReduction(r);this._set("featureReduction",i)}set renderer(r){}_normalizeFeatureReduction(r){if(r?.type!=="cluster")return r;const i=r.clone(),s=[new rw({name:"cluster_count",isAutoGenerated:!0,statisticType:"count"})],n=(i.fields??[]).filter(a=>!a.isAutoGenerated);if(r.renderer&&!r.renderer.authoringInfo?.isAutoGenerated)return i.fields=[...s,...n],i;if(r.symbol)return i.fields=[...s,...n],i.renderer=null,i;if(!this.renderer)return r;const o=lBe(s,this.renderer,r,null,!1);return i.fields=[...s,...n],i.renderer=o,i}};return u([d(Kze)],e.prototype,"featureReduction",null),e=u([R("esri.layers.mixins.FeatureReductionLayer")],e),e},wte={ArcGISAnnotationLayer:!0,ArcGISDimensionLayer:!0,ArcGISFeatureLayer:!0,ArcGISImageServiceLayer:!0,ArcGISImageServiceVectorLayer:!0,ArcGISMapServiceLayer:!0,ArcGISStreamLayer:!0,ArcGISTiledImageServiceLayer:!0,ArcGISTiledMapServiceLayer:!0,BingMapsAerial:!0,BingMapsHybrid:!0,BingMapsRoad:!0,CSV:!0,GeoRSS:!0,GeoJSON:!0,GroupLayer:!0,KML:!0,MediaLayer:!0,OGCFeatureLayer:!0,OrientedImageryLayer:!0,SubtypeGroupLayer:!0,VectorTileLayer:!0,WFS:!0,WMS:!0,WebTiledLayer:!0},xte={ArcGISImageServiceLayer:!0,ArcGISImageServiceVectorLayer:!0,ArcGISMapServiceLayer:!0,ArcGISTiledImageServiceLayer:!0,ArcGISTiledMapServiceLayer:!0,OpenStreetMap:!0,VectorTileLayer:!0,WMS:!0,WebTiledLayer:!0,BingMapsAerial:!0,BingMapsRoad:!0,BingMapsHybrid:!0},Tte={ArcGISFeatureLayer:!0},mBe={"web-scene/operational-layers":{ArcGISDimensionLayer:!0,ArcGISFeatureLayer:!0,ArcGISImageServiceLayer:!0,ArcGISMapServiceLayer:!0,ArcGISSceneServiceLayer:!0,ArcGISTiledElevationServiceLayer:!0,ArcGISTiledImageServiceLayer:!0,ArcGISTiledMapServiceLayer:!0,BuildingSceneLayer:!0,GroupLayer:!0,IntegratedMeshLayer:!0,OGCFeatureLayer:!0,PointCloudLayer:!0,WebTiledLayer:!0,CSV:!0,GeoJSON:!0,VectorTileLayer:!0,WFS:!0,WMS:!0,KML:!0,RasterDataLayer:!0,Voxel:!0,LineOfSightLayer:!0},"web-scene/basemap":{ArcGISTiledImageServiceLayer:!0,ArcGISTiledMapServiceLayer:!0,WebTiledLayer:!0,OpenStreetMap:!0,VectorTileLayer:!0,ArcGISImageServiceLayer:!0,WMS:!0,ArcGISMapServiceLayer:!0,ArcGISSceneServiceLayer:!0},"web-scene/ground":{ArcGISTiledElevationServiceLayer:!0,RasterDataElevationLayer:!0},"web-map/operational-layers":wte,"web-map/basemap":xte,"web-map/tables":Tte,"link-chart/operational-layers":{...wte,LinkChartLayer:!0},"link-chart/basemap":xte,"link-chart/tables":Tte,"portal-item/operational-layers":{ArcGISFeatureLayer:!0,ArcGISSceneServiceLayer:!0,PointCloudLayer:!0,BuildingSceneLayer:!0,IntegratedMeshLayer:!0,OrientedImageryLayer:!0}},__e=t=>{let e=class extends t{constructor(){super(...arguments),this.title=null}writeListMode(r,i,s,n){(n&&n.layerContainerType==="ground"||r&&mLe(this,s,{},n))&&(i[s]=r)}writeOperationalLayerType(r,i,s,n){!r||n&&n.layerContainerType==="tables"||(i.layerType=r)}writeTitle(r,i){i.title=r??"Layer"}read(r,i){i&&(i.layer=this),dLe(this,r,s=>super.read(r,s),i)}write(r,i){if(i?.origin){const o=`${i.origin}/${i.layerContainerType||"operational-layers"}`;let l=!!mBe[o]?.[this.operationalLayerType];if(this.operationalLayerType==="ArcGISTiledElevationServiceLayer"&&o==="web-scene/operational-layers"&&(l=!1),this.operationalLayerType==="ArcGISDimensionLayer"&&o==="web-map/operational-layers"&&(l=!1),!l)return i.messages?.push(new F("layer:unsupported",`Layers (${this.title}, ${this.id}) of type '${this.declaredClass}' are not supported in the context of '${o}'`,{layer:this})),null}const s=super.write(r,{...i,layer:this}),n=!!i&&!!i.messages&&!!i.messages.filter(o=>o instanceof F&&o.name==="web-document-write:property-required").length;return x_(s?.url)?(i?.messages?.push(new F("layer:invalid-url",`Layer (${this.title}, ${this.id}) of type '${this.declaredClass}' using a Blob URL cannot be written to web scenes and web maps`,{layer:this})),null):!this.url&&n?null:s}beforeSave(){}};return u([d({type:String,json:{write:{ignoreOrigin:!0},origins:{"web-scene":{write:{isRequired:!0,ignoreOrigin:!0}},"portal-item":{write:!1}}}})],e.prototype,"id",void 0),u([d(s_e)],e.prototype,"listMode",void 0),u([Fe("listMode")],e.prototype,"writeListMode",null),u([d({type:String,readOnly:!0,json:{read:!1,write:{target:"layerType",ignoreOrigin:!0},origins:{"portal-item":{write:!1}}}})],e.prototype,"operationalLayerType",void 0),u([Fe("operationalLayerType")],e.prototype,"writeOperationalLayerType",null),u([d(a7)],e.prototype,"opacity",void 0),u([d({type:String,json:{write:{ignoreOrigin:!0,writerEnsuresNonNull:!0},origins:{"web-scene":{write:{isRequired:!0,ignoreOrigin:!0,writerEnsuresNonNull:!0}},"portal-item":{write:!1}}},value:"Layer"})],e.prototype,"title",void 0),u([Fe("title"),Fe(["web-scene"],"title")],e.prototype,"writeTitle",null),u([d({type:Boolean,json:{name:"visibility"}})],e.prototype,"visible",void 0),e=u([R("esri.layers.mixins.OperationalLayer")],e),e};var b7;const OU=new Rr({asc:"ascending",desc:"descending"});let AT=b7=class extends de{constructor(t){super(t),this.field=null,this.valueExpression=null,this.order="ascending"}clone(){return new b7({field:this.field,valueExpression:this.valueExpression,order:this.order})}};u([d({type:String,json:{write:!0}})],AT.prototype,"field",void 0),u([d({type:String,json:{write:!0}})],AT.prototype,"valueExpression",void 0),u([d({type:OU.apiValues,json:{read:OU.read,write:OU.write}})],AT.prototype,"order",void 0),AT=b7=u([R("esri.layers.support.OrderByInfo")],AT);const v_e=AT;function gBe(t,e,r){if(!t)return null;const i=t.find(n=>!!n.field);if(!i)return null;const s=new v_e;return s.read(i,r),[s]}function yBe(t,e,r,i){const s=t.find(n=>!!n.field);s&&Ha(r,[s.toJSON()],e)}const _Be=t=>{let e=class extends t{constructor(){super(...arguments),this.orderBy=null}};return u([d({type:[v_e],json:{origins:{"web-scene":{write:!1,read:!1}},read:{source:"layerDefinition.orderBy",reader:gBe},write:{target:"layerDefinition.orderBy",writer:yBe}}})],e.prototype,"orderBy",void 0),e=u([R("esri.layers.mixins.OrderedLayer")],e),e};function g5(t,e,r){return Yf(t.map((i,s)=>e.apply(r,[i,s])))}async function vBe(t,e,r){return(await Yf(t.map((i,s)=>e.apply(r,[i,s])))).map(i=>i.value)}function MZ(t){return{ok:!0,value:t}}function IZ(t){return{ok:!1,error:t}}function bBe(t){return t!=null&&t.ok===!0?t.value:null}function wBe(t){return t!=null&&t.ok===!1?t.error:null}async function gu(t){if(t==null)return{ok:!1,error:new Error("no promise provided")};try{return MZ(await t)}catch(e){return IZ(e)}}async function FCt(t){try{return MZ(await t)}catch(e){return Lo(e),IZ(e)}}function UCt(t){if(t.ok===!0)return t.value;throw t.error}function uE(t,e){return new l0(t,e)}let l0=class extends Te{get value(){return bBe(this._result)}get error(){return wBe(this._result)}get finished(){return this._result!=null}constructor(e,r){super({}),this._result=null,this._abortHandle=null,this.abort=()=>{this._abortController=pu(this._abortController)},this.remove=this.abort,this._abortController=new AbortController;const{signal:i}=this._abortController;this.promise=e(i),this.promise.then(s=>{this._result=MZ(s),this._cleanup()},s=>{this._result=IZ(s),this._cleanup()}),this._abortHandle=nn(r,this.abort)}normalizeCtorArgs(){return{}}destroy(){this.abort()}_cleanup(){this._abortHandle=Ii(this._abortHandle),this._abortController=null}};u([d()],l0.prototype,"value",null),u([d()],l0.prototype,"error",null),u([d()],l0.prototype,"finished",null),u([d()],l0.prototype,"promise",void 0),u([d()],l0.prototype,"_result",void 0),l0=u([R("esri.core.asyncUtils.ReactiveTask")],l0);let Vm=class extends Te{constructor(e){super(e),this.portalItem=null}normalizeCtorArgs(e){return e&&e.portalItem&&e.path?{...e,path:this._normalizePath(e.path,e.portalItem)}:e}set path(e){e!=null&&mc(e)?Q.getLogger(this).error("portalitemresource:invalid-path","A portal item resource path must be relative"):this._set("path",e)}_castPath(e){return this._normalizePath(e,this.portalItem)}get url(){return this.portalItem&&this.path?`${this.portalItem.itemUrl}/resources/${this.path}`:null}get cdnUrl(){return this.portalItem&&this.path?`${this.portalItem.itemCdnUrl}/resources/${this.path}`:null}get itemRelativeUrl(){return this.portalItem&&this.path?`./resources/${this.path}`:null}fetch(e="json",r){const i=this.cdnUrl;if(i==null)throw new F("portal-item-resource:fetch","Portal item resource does not refer to a valid item or path");return this.portalItem.portal.request(i,{responseType:e,query:{token:this.portalItem.apiKey},signal:r?.signal})}async update(e,r){const{addOrUpdateResource:i}=await ae(()=>Promise.resolve().then(()=>AA),void 0,import.meta.url);return i(this,"update",e,r)}hasPath(){return this.path!=null}_normalizePath(e,r){return e==null?e:(e=e.replace(/^\/+/,""),r!=null&&mc(e)&&(e=Aq(e,r.itemUrl)),e?.replace(/^\/+/,"").replace(/^(\.\/)?resources\//,""))}};u([d()],Vm.prototype,"portalItem",void 0),u([d({type:String,value:null})],Vm.prototype,"path",null),u([yr("path")],Vm.prototype,"_castPath",null),u([d({type:String,readOnly:!0})],Vm.prototype,"url",null),u([d({type:String,readOnly:!0})],Vm.prototype,"cdnUrl",null),u([d({type:String,readOnly:!0})],Vm.prototype,"itemRelativeUrl",null),Vm=u([R("esri.portal.PortalItemResource")],Vm);const xBe=Vm;let xA=class extends Te{constructor(e){super(e),this.created=null,this.rating=null}};u([d()],xA.prototype,"created",void 0),u([d()],xA.prototype,"rating",void 0),xA=u([R("esri.portal.PortalRating")],xA);const RU=xA;var x1;const TBe=new Set(["Map Service","Feature Service","Feature Collection","Scene Service","Image Service","Stream Service","Vector Tile Service","GeoJson","CSV","KML","WFS","WMTS","WMS","Feed"]),SBe=new Set(["KML","GeoJson","CSV"]);let ar=x1=class extends K2(Fg){static from(t){return Bb(x1,t)}constructor(t){super(t),this.access=null,this.accessInformation=null,this.apiKey=null,this.applicationProxies=null,this.avgRating=null,this.categories=null,this.created=null,this.culture=null,this.description=null,this.extent=null,this.groupCategories=null,this.id=null,this.isOrgItem=!1,this.itemControl=null,this.licenseInfo=null,this.modified=null,this.name=null,this.numComments=null,this.numRatings=null,this.numViews=null,this.owner=null,this.ownerFolder=null,this.portal=null,this.screenshots=null,this.size=null,this.snippet=null,this.sourceJSON=null,this.sourceUrl=null,this.spatialReference=null,this.tags=null,this.title=null,this.type=null,this.typeKeywords=null,this.url=null}destroy(){this.portal=null}get displayName(){const t=this.type,e=this.typeKeywords||[];let r=t;return t==="Feature Service"||t==="Feature Collection"?r=e.includes("Table")?"Table":e.includes("Route Layer")?"Route Layer":e.includes("Markup")?"Markup":"Feature Layer":t==="Image Service"?r=e.includes("Elevation 3D Layer")?"Elevation Layer":e.includes("Tiled Imagery")?"Tiled Imagery Layer":"Imagery Layer":t==="Scene Service"?r="Scene Layer":t==="Video Service"?r="Video Layer":t==="Scene Package"?r="Scene Layer Package":t==="Stream Service"?r="Feature Layer":t==="Geoprocessing Service"?r=e.includes("Web Tool")?"Tool":"Geoprocessing Service":t==="Geocoding Service"?r="Locator":t==="Geoenrichment Service"?r="GeoEnrichment Service":t==="Microsoft Powerpoint"?r="Microsoft PowerPoint":t==="GeoJson"?r="GeoJSON":t==="Globe Service"?r="Globe Layer":t==="Vector Tile Service"?r="Tile Layer":t==="netCDF"?r="NetCDF":t==="Map Service"?r=e.includes("Spatiotemporal")||!e.includes("Hosted Service")&&!e.includes("Tiled")||e.includes("Relational")?"Map Image Layer":"Tile Layer":t&&t.toLowerCase().includes("add in")?r=t.replaceAll(/(add in)/gi,"Add-In"):t==="datastore catalog service"?r="Big Data File Share":t==="Compact Tile Package"?r="Tile Package (tpkx)":t==="OGCFeatureServer"?r="OGC Feature Layer":t==="web mapping application"&&e.includes("configurableApp")?r="Instant App":t==="Insights Page"?r="Insights Report":t==="Excalibur Imagery Project"&&(r="Excalibur Project"),r}readExtent(t){return t&&t.length?new _r(t[0][0],t[0][1],t[1][0],t[1][1]):null}get iconUrl(){const t=this.type&&this.type.toLowerCase()||"",e=this.typeKeywords||[],r="esri/images/portal/",i="16";let s,n=!1,o=!1,a=!1,l=!1,c=!1,h=!1;return t.indexOf("service")>0||t==="feature collection"||t==="kml"||t==="wms"||t==="wmts"||t==="wfs"?(n=e.includes("Hosted Service"),t==="feature service"||t==="feature collection"||t==="kml"||t==="wfs"?(o=e.includes("Table"),a=e.includes("Route Layer"),l=e.includes("Markup"),c=e.includes("Spatiotemporal"),h=e.includes("UtilityNetwork"),s=c&&o?"spatiotemporaltable":o?"table":a?"routelayer":l?"markup":c?"spatiotemporal":n?"featureshosted":h?"utilitynetwork":"features"):s=t==="map service"||t==="wms"||t==="wmts"?n||e.includes("Tiled")||t==="wmts"?"maptiles":"mapimages":t==="scene service"?e.includes("Line")?"sceneweblayerline":e.includes("3DObject")?"sceneweblayermultipatch":e.includes("Point")?"sceneweblayerpoint":e.includes("IntegratedMesh")?"sceneweblayermesh":e.includes("PointCloud")?"sceneweblayerpointcloud":e.includes("Polygon")?"sceneweblayerpolygon":e.includes("Building")?"sceneweblayerbuilding":e.includes("Voxel")?"sceneweblayervoxel":"sceneweblayer":t==="image service"?e.includes("Elevation 3D Layer")?"elevationlayer":e.includes("Tiled Imagery")?"tiledimagerylayer":"imagery":t==="stream service"?"streamlayer":t==="video service"?e.includes("Live Stream")?"livestreamvideolayer":"videolayer":t==="vector tile service"?"vectortile":t==="datastore catalog service"?"datastorecollection":t==="geocoding service"?"geocodeservice":t==="geoprocessing service"?e.includes("Web Tool")?"tool":"layers":t==="geodata service"?"geodataservice":"layers"):s=t==="web map"||t==="cityengine web scene"?"maps":t==="web scene"?e.includes("ViewingMode-Local")?"webscenelocal":"websceneglobal":t==="web mapping application"&&e.includes("configurableApp")?"instantapps":t==="web mapping application"||t==="mobile application"||t==="application"||t==="operation view"||t==="desktop application"?"apps":t==="map document"||t==="map package"||t==="published map"||t==="scene document"||t==="globe document"||t==="basemap package"||t==="mobile basemap package"||t==="mobile map package"||t==="project package"||t==="project template"||t==="pro map"||t==="layout"||t==="layer"&&e.includes("ArcGIS Pro")||t==="explorer map"&&e.indexOf("Explorer Document")?"mapsgray":t==="service definition"||t==="csv"||t==="shapefile"||t==="cad drawing"||t==="geojson"||t==="netcdf"||t==="administrative report"?"datafiles":t==="explorer add in"||t==="desktop add in"||t==="windows viewer add in"||t==="windows viewer configuration"?"appsgray":t==="360 vr experience"?"360vr":t==="arcgis pro add in"||t==="arcgis pro configuration"?"addindesktop":t==="rule package"||t==="file geodatabase"||t==="sqlite geodatabase"||t==="csv collection"||t==="kml collection"||t==="windows mobile package"||t==="map template"||t==="desktop application template"||t==="gml"||t==="arcpad package"||t==="code sample"||t==="form"||t==="document link"||t==="earth configuration"||t==="operations dashboard add in"||t==="rules package"||t==="image"||t==="workflow manager package"||t==="explorer map"&&e.includes("Explorer Mapping Application")||e.includes("Document")?"datafilesgray":t==="network analysis service"||t==="geoprocessing service"||t==="geodata service"||t==="geometry service"||t==="geoprocessing package"||t==="locator package"||t==="geoprocessing sample"||t==="workflow manager service"?"toolsgray":t==="layer"||t==="layer package"||t==="explorer layer"?"layersgray":t==="scene package"?"scenepackage":t==="mobile scene package"?"mobilescenepackage":t==="tile package"||t==="compact tile package"?"tilepackage":t==="task file"?"taskfile":t==="report template"?"report-template":t==="statistical data collection"?"statisticaldatacollection":t==="insights workbook"?"workbook":t==="insights model"?"insightsmodel":t==="insights page"?"insightspage":t==="insights theme"?"insightstheme":t==="hub initiative"?"hubinitiative":t==="hubpage"?"hubpage":t==="hub event"?"hubevent":t==="hub site application"?"hubsite":t==="hub project"?"hubproject":t==="relational database connection"?"relationaldatabaseconnection":t==="big data file share"?"datastorecollection":t==="image collection"?"imagecollection":t==="style"?"style":t==="desktop style"?"desktopstyle":t==="dashboard"?"dashboard":t==="raster function template"?"rasterprocessingtemplate":t==="vector tile package"?"vectortilepackage":t==="ortho mapping project"?"orthomappingproject":t==="ortho mapping template"?"orthomappingtemplate":t==="solution"?"solutions":t==="geopackage"?"geopackage":t==="deep learning package"?"deeplearningpackage":t==="real time analytic"?"realtimeanalytics":t==="big data analytic"?"bigdataanalytics":t==="feed"?"feed":t==="excalibur imagery project"?"excaliburimageryproject":t==="notebook"?"notebook":t==="storymap"?"storymap":t==="survey123 add in"?"survey123addin":t==="mission"?"mission":t==="mission report"?"missionreport":t==="quickcapture project"?"quickcaptureproject":t==="pro report"?"proreport":t==="pro report template"?"proreporttemplate":t==="urban model"?"urbanmodel":t==="web experience"?"experiencebuilder":t==="web experience template"?"webexperiencetemplate":t==="experience builder widget"?"experiencebuilderwidget":t==="experience builder widget package"?"experiencebuilderwidgetpackage":t==="workflow"?"workflow":t==="insights script"?"insightsscript":t==="kernel gateway connection"?"kernelgatewayconnection":t==="hub initiative template"?"hubinitiativetemplate":t==="storymap theme"?"storymaptheme":t==="knowledge graph"?"knowledgegraph":t==="native application"?"nativeapp":t==="native application installer"?"nativeappinstaller":t==="link chart"?"linkchart":t==="investigation"?"investigation":t==="ogcfeatureserver"?"features":t==="pro project"?"proproject":t==="insights workbook package"?"insightsworkbookpackage":t==="apache parquet"?"apacheparquet":t==="notebook code snippets"||t==="notebook code snippet library"?"notebookcodesnippets":t==="suitability model"?"suitabilitymodel":t==="esri classifier definition"?"classifierdefinition":t==="esri classification schema"?"classificationschema":t==="insights data engineering workbook"?"dataengineeringworkbook":t==="insights data engineering model"?"dataengineeringmodel":t==="deep learning studio project"?"deeplearningproject":t==="discussion"?"discussion":t==="allsource project"?"allsourceproject":t==="api key"?"apikey":t==="data pipeline"?"datapipelines":"maps",s?kr(r+s+i+".png"):null}get isLayer(){return this.type!=null&&TBe.has(this.type)}get itemCdnUrl(){let t=this.itemUrl;return t&&Gt&&!Gt.findCredential(t)&&(t=Gt._normalizeAGOLorgDomain(t),t=t.replace(/^https?:\/\/www\.arcgis\.com/,"https://cdn.arcgis.com"),t=t.replace(/^https?:\/\/devext\.arcgis\.com/,"https://cdndev.arcgis.com"),t=t.replace(/^https?:\/\/qaext\.arcgis\.com/,"https://cdnqa.arcgis.com")),t}get itemPageUrl(){const t=this.portal?.itemPageUrl;return t&&this.id?`${t}?id=${this.id}`:null}get itemUrl(){const t=this.portal?.restUrl;return t&&this.id?`${t}/content/items/${this.id}`:null}get thumbnailUrl(){const t=this.itemUrl,e=this.thumbnail;return t&&e?this.portal?.normalizeUrl(`${t}/info/${e}?f=json`)??null:null}get userItemUrl(){const t=this.get("portal.restUrl");if(!t)return null;const e=this.owner||this.get("portal.user.username");return e?`${t}/content/users/${this.ownerFolder?`${e}/${this.ownerFolder}`:e}/items/${this.id}`:null}load(t){const e=this.portal??(this.portal=Qn.getDefault()),r=e.load(t).then(()=>this.sourceJSON?this.sourceJSON:this.id&&this.itemUrl?e.request(this.itemUrl,{signal:t!=null?t.signal:null,query:{token:this.apiKey}}):{}).then(i=>{this.sourceJSON=i,this.read(i)});return this.addResolvingPromise(r),Promise.resolve(this)}async addRating(t){const e={method:"post",query:{}};return t instanceof RU&&(t=t.rating),t==null||isNaN(t)||typeof t!="number"||(e.query.rating=t),this.portal?(await this.portal.request(this.itemUrl+"/addRating",e),new RU({rating:t,created:new Date})):null}clone(){const t={access:this.access,accessInformation:this.accessInformation,applicationProxies:K(this.applicationProxies),avgRating:this.avgRating,categories:K(this.categories),created:K(this.created),culture:this.culture,description:this.description,extent:K(this.extent),groupCategories:K(this.groupCategories),id:this.id,itemControl:this.itemControl,licenseInfo:this.licenseInfo,modified:K(this.modified),name:this.name,numComments:this.numComments,numRatings:this.numRatings,numViews:this.numViews,owner:this.owner,ownerFolder:this.ownerFolder,portal:this.portal,screenshots:K(this.screenshots),size:this.size,snippet:this.snippet,sourceUrl:this.sourceUrl,spatialReference:this.spatialReference,tags:K(this.tags),thumbnail:this.thumbnail,title:this.title,type:this.type,typeKeywords:K(this.typeKeywords),url:this.url};this.loaded&&(t.loadStatus="loaded");const e=new x1({sourceJSON:this.sourceJSON}).set(t);return e._set("isOrgItem",this.isOrgItem),e}createPostQuery(){const t=this.toJSON();for(const r of["tags","typeKeywords","categories"])t[r]=t[r]?.join(", ");const{extent:e}=t;return e&&(t.extent=JSON.stringify(e)),t}async deleteRating(){await rc(this.portal).request(this.itemUrl+"/deleteRating",{method:"post"})}fetchData(t="json",e){return rc(this.portal).request(this.itemUrl+"/data",{responseType:t,...e,query:{token:this.apiKey}})}async fetchRating(t){const e=await rc(this.portal).request(this.itemUrl+"/rating",{query:{token:this.apiKey},...t});return e.rating!=null?(e.created=new Date(e.created),new RU(e)):null}fetchRelatedItems(t,e){return rc(this.portal).requestToTypedArray(this.itemUrl+"/relatedItems",{query:{...t,token:this.apiKey},...e},x1)}getThumbnailUrl(t){let e=this.thumbnailUrl;return e&&t&&(e+=`&w=${t}`),e}reload(){return rc(this.portal).request(this.itemUrl??"",{cacheBust:!0,query:{token:this.apiKey}}).then(t=>(this.sourceJSON=t,this.read(t),this))}update(t){return this.id?this.load().then(()=>rc(this.portal).signIn()).then(()=>{const e=t&&t.data,r={method:"post"};r.query=this.createPostQuery();for(const i in r.query)r.query[i]===null&&(r.query[i]="");return r.query.clearEmptyFields=!0,e!=null&&(typeof e=="string"?r.query.text=e:typeof e=="object"&&(r.query.text=JSON.stringify(e))),this.portal.request(`${this.userItemUrl}/update`,r).then(()=>this.reload())}):Promise.reject(new F("portal:item-does-not-exist","The item does not exist yet and cannot be updated"))}async copy(t){if(!this.id)throw new F("portal:item-does-not-exist","The item does not exist yet");await this.load();const{portal:e,itemUrl:r}=this;await rc(e).signIn();const{copyResources:i,folder:s,tags:n,title:o}=t||{},a={method:"post",query:{copyPrivateResources:i==="all",folder:typeof s=="string"?s:s?.id,includeResources:!!i,tags:n?.join(","),title:o}},{itemId:l}=await e.request(`${r}/copy`,a);return new x1({id:l,portal:e})}updateThumbnail(t){return this.id?this.load().then(()=>this.portal.signIn()).then(()=>{const e=t.thumbnail,r=t.filename,i={method:"post"};if(typeof e=="string")Jf(e)?i.query={data:e}:i.query={url:_l(e)},r!=null&&(i.query.filename=r);else{const s=new FormData;r!=null?s.append("file",e,r):s.append("file",e),i.body=s}return this.portal.request(`${this.userItemUrl}/updateThumbnail`,i).then(()=>this.reload())}):Promise.reject(new F("portal:item-does-not-exist","The item does not exist yet and cannot be updated"))}async fetchResources(t={},e){const{fetchResources:r}=await ae(()=>Promise.resolve().then(()=>AA),void 0,import.meta.url);return r(this,t,e)}async addResource(t,e,r){const{addOrUpdateResource:i}=await ae(()=>Promise.resolve().then(()=>AA),void 0,import.meta.url);return t.portalItem=this,i(t,"add",e,r)}async removeResource(t,e){const{removeResource:r}=await ae(()=>Promise.resolve().then(()=>AA),void 0,import.meta.url);if(t.portalItem&&t.portalItem.itemUrl!==this.itemUrl)throw new F("removeresource:portal-item-mismatch","The portal item associated with the provided resource does not match the item");return r(this,t,e)}async removeAllResources(t){const{removeAllResources:e}=await ae(()=>Promise.resolve().then(()=>AA),void 0,import.meta.url);return e(this,t)}resourceFromPath(t){return new xBe({portalItem:this,path:t})}toJSON(){const t=this.extent,e={accessInformation:this.accessInformation,categories:K(this.categories),created:this.created&&this.created.getTime(),description:this.description,extent:t&&[[t.xmin,t.ymin],[t.xmax,t.ymax]],id:this.id,isOrgItem:this.isOrgItem,licenseInfo:this.licenseInfo,modified:this.modified&&this.modified.getTime(),name:this.name,owner:this.owner,ownerFolder:this.ownerFolder,snippet:this.snippet,sourceUrl:this.sourceUrl,spatialReference:this.spatialReference,tags:K(this.tags),thumbnail:this.thumbnail,title:this.title,type:this.type,typeKeywords:K(this.typeKeywords),url:this.url};return dF(e)}static fromJSON(t){if(!t)return null;if(t.declaredClass)throw new Error("JSON object is already hydrated");return new x1({sourceJSON:t})}_getPostQuery(){const t=this.toJSON();for(const e in t)e==="tags"&&t[e]!==null&&(t[e]=t[e].join(", ")),e==="typeKeywords"&&t[e]!==null&&(t[e]=t[e].join(", ")),e==="extent"&&t[e]&&(t[e]=JSON.stringify(t[e]));return t}};u([d({type:["private","shared","org","public"]})],ar.prototype,"access",void 0),u([d()],ar.prototype,"accessInformation",void 0),u([d({type:String})],ar.prototype,"apiKey",void 0),u([d({json:{read:{source:"appProxies"}}})],ar.prototype,"applicationProxies",void 0),u([d()],ar.prototype,"avgRating",void 0),u([d()],ar.prototype,"categories",void 0),u([d({type:Date})],ar.prototype,"created",void 0),u([d()],ar.prototype,"culture",void 0),u([d()],ar.prototype,"description",void 0),u([d({readOnly:!0})],ar.prototype,"displayName",null),u([d({type:_r})],ar.prototype,"extent",void 0),u([Ee("extent")],ar.prototype,"readExtent",null),u([d()],ar.prototype,"groupCategories",void 0),u([d({readOnly:!0})],ar.prototype,"iconUrl",null),u([d()],ar.prototype,"id",void 0),u([d({readOnly:!0})],ar.prototype,"isLayer",null),u([d({type:Boolean,readOnly:!0})],ar.prototype,"isOrgItem",void 0),u([d()],ar.prototype,"itemControl",void 0),u([d({readOnly:!0})],ar.prototype,"itemPageUrl",null),u([d({readOnly:!0})],ar.prototype,"itemUrl",null),u([d()],ar.prototype,"licenseInfo",void 0),u([d({type:Date})],ar.prototype,"modified",void 0),u([d()],ar.prototype,"name",void 0),u([d()],ar.prototype,"numComments",void 0),u([d()],ar.prototype,"numRatings",void 0),u([d()],ar.prototype,"numViews",void 0),u([d()],ar.prototype,"owner",void 0),u([d()],ar.prototype,"ownerFolder",void 0),u([d({type:Qn})],ar.prototype,"portal",void 0),u([d()],ar.prototype,"screenshots",void 0),u([d()],ar.prototype,"size",void 0),u([d()],ar.prototype,"snippet",void 0),u([d()],ar.prototype,"sourceJSON",void 0),u([d({type:String})],ar.prototype,"sourceUrl",void 0),u([d({type:String})],ar.prototype,"spatialReference",void 0),u([d()],ar.prototype,"tags",void 0),u([d()],ar.prototype,"thumbnail",void 0),u([d({readOnly:!0})],ar.prototype,"thumbnailUrl",null),u([d()],ar.prototype,"title",void 0),u([d()],ar.prototype,"type",void 0),u([d()],ar.prototype,"typeKeywords",void 0),u([d({type:String,json:{read(t,e){if(SBe.has(e.type)){const r=this.portal?.restUrl;t||(t=r&&this.id?`${r}/content/items/${this.id}/data`:null)}return t}}})],ar.prototype,"url",void 0),u([d({readOnly:!0})],ar.prototype,"userItemUrl",null),ar=x1=u([R("esri.portal.PortalItem")],ar);const Ab=ar,b_e=Object.freeze(Object.defineProperty({__proto__:null,default:Ab},Symbol.toStringTag,{value:"Module"}));let PU,ee=null;function w_e(){return!!ee}function EBe(){return!!oe("esri-wasm")}function x_e(){return PU||(PU=ae(()=>import("./pe-wasm-0baad576.js"),[],import.meta.url).then(t=>t.p).then(({default:t})=>t({locateFile:e=>kr(`esri/geometry/support/${e}`)})).then(t=>{S_e(t)}),PU)}var w7,Ts,x7;(function(t){function e(n,o,a){ee.ensureCache.prepare();const l=J1(a),c=a===l,h=ee.ensureFloat64(l),p=ee._pe_geog_to_proj(ee.getPointer(n),o,h);return p&&U0(a,o,h,c),p}function r(n,o,a,l){switch(l){case Ts.PE_TRANSFORM_P_TO_G:return i(n,o,a);case Ts.PE_TRANSFORM_G_TO_P:return e(n,o,a)}return 0}function i(n,o,a){return s(n,o,a,0)}function s(n,o,a,l){ee.ensureCache.prepare();const c=J1(a),h=a===c,p=ee.ensureFloat64(c),f=ee._pe_proj_to_geog_center(ee.getPointer(n),o,p,l);return f&&U0(a,o,p,h),f}t.geogToProj=e,t.projGeog=r,t.projToGeog=i,t.projToGeogCenter=s})(w7||(w7={})),function(t){function e(){t.PE_BUFFER_MAX=ee.PeDefs.prototype.PE_BUFFER_MAX,t.PE_NAME_MAX=ee.PeDefs.prototype.PE_NAME_MAX,t.PE_MGRS_MAX=ee.PeDefs.prototype.PE_MGRS_MAX,t.PE_USNG_MAX=ee.PeDefs.prototype.PE_USNG_MAX,t.PE_DD_MAX=ee.PeDefs.prototype.PE_DD_MAX,t.PE_DDM_MAX=ee.PeDefs.prototype.PE_DDM_MAX,t.PE_DMS_MAX=ee.PeDefs.prototype.PE_DMS_MAX,t.PE_UTM_MAX=ee.PeDefs.prototype.PE_UTM_MAX,t.PE_PARM_MAX=ee.PeDefs.prototype.PE_PARM_MAX,t.PE_TYPE_NONE=ee.PeDefs.prototype.PE_TYPE_NONE,t.PE_TYPE_GEOGCS=ee.PeDefs.prototype.PE_TYPE_GEOGCS,t.PE_TYPE_PROJCS=ee.PeDefs.prototype.PE_TYPE_PROJCS,t.PE_TYPE_GEOGTRAN=ee.PeDefs.prototype.PE_TYPE_GEOGTRAN,t.PE_TYPE_COORDSYS=ee.PeDefs.prototype.PE_TYPE_COORDSYS,t.PE_TYPE_UNIT=ee.PeDefs.prototype.PE_TYPE_UNIT,t.PE_TYPE_LINUNIT=ee.PeDefs.prototype.PE_TYPE_LINUNIT,t.PE_STR_OPTS_NONE=ee.PeDefs.prototype.PE_STR_OPTS_NONE,t.PE_STR_AUTH_NONE=ee.PeDefs.prototype.PE_STR_AUTH_NONE,t.PE_STR_AUTH_TOP=ee.PeDefs.prototype.PE_STR_AUTH_TOP,t.PE_STR_NAME_CANON=ee.PeDefs.prototype.PE_STR_NAME_CANON,t.PE_PARM_X0=ee.PeDefs.prototype.PE_PARM_X0,t.PE_PARM_ND=ee.PeDefs.prototype.PE_PARM_ND,t.PE_TRANSFORM_1_TO_2=ee.PeDefs.prototype.PE_TRANSFORM_1_TO_2,t.PE_TRANSFORM_2_TO_1=ee.PeDefs.prototype.PE_TRANSFORM_2_TO_1,t.PE_TRANSFORM_P_TO_G=ee.PeDefs.prototype.PE_TRANSFORM_P_TO_G,t.PE_TRANSFORM_G_TO_P=ee.PeDefs.prototype.PE_TRANSFORM_G_TO_P,t.PE_HORIZON_RECT=ee.PeDefs.prototype.PE_HORIZON_RECT,t.PE_HORIZON_POLY=ee.PeDefs.prototype.PE_HORIZON_POLY,t.PE_HORIZON_LINE=ee.PeDefs.prototype.PE_HORIZON_LINE,t.PE_HORIZON_DELTA=ee.PeDefs.prototype.PE_HORIZON_DELTA}t.init=e}(Ts||(Ts={})),function(t){const e={},r={},i=m=>{if(m){const y=m.getType();switch(y){case Ts.PE_TYPE_GEOGCS:m=ee.castObject(m,ee.PeGeogcs);break;case Ts.PE_TYPE_PROJCS:m=ee.castObject(m,ee.PeProjcs);break;case Ts.PE_TYPE_GEOGTRAN:m=ee.castObject(m,ee.PeGeogtran);break;default:y&Ts.PE_TYPE_UNIT&&(m=ee.castObject(m,ee.PeUnit))}}return m};function s(){ee.PeFactory.prototype.initialize(null)}function n(m){return o(Ts.PE_TYPE_COORDSYS,m)}function o(m,y){let _=null,v=e[m];if(v||(v={},e[m]=v),v.hasOwnProperty(String(y)))_=v[y];else{const w=ee.PeFactory.prototype.factoryByType(m,y);ee.compare(w,ee.NULL)||(_=w,v[y]=_)}return _=i(_),_}function a(m,y){let _=null,v=r[m];if(v||(v={},r[m]=v),v.hasOwnProperty(y))_=v[y];else{const w=ee.PeFactory.prototype.fromString(m,y);ee.compare(w,ee.NULL)||(_=w,v[y]=_)}return _=i(_),_}function l(m){return o(Ts.PE_TYPE_GEOGCS,m)}function c(m){return o(Ts.PE_TYPE_GEOGTRAN,m)}function h(m){return ee.PeFactory.prototype.getCode(m)}function p(m){return o(Ts.PE_TYPE_PROJCS,m)}function f(m){return o(Ts.PE_TYPE_UNIT,m)}t.initialize=s,t.coordsys=n,t.factoryByType=o,t.fromString=a,t.geogcs=l,t.geogtran=c,t.getCode=h,t.projcs=p,t.unit=f}(x7||(x7={}));let T_e=null;var PN,T7,S7,E7,MN,C7,IN,$N,A7;function S_e(t){function e(n,o,a){n[o]=a(n[o])}ee=t,Ts.init(),PN.init(),MN.init(),IN.init(),$N.init(),T_e=class extends ee.PeGCSExtent{destroy(){ee.destroy(this)}};const r=[ee.PeDatum,ee.PeGeogcs,ee.PeGeogtran,ee.PeObject,ee.PeParameter,ee.PePrimem,ee.PeProjcs,ee.PeSpheroid,ee.PeUnit];for(const n of r)e(n.prototype,"getName",o=>function(){return o.call(this,new Array(Ts.PE_NAME_MAX))});for(const n of[ee.PeGeogtran,ee.PeProjcs])e(n.prototype,"getParameters",o=>function(){const a=new Array(Ts.PE_PARM_MAX);let l=o.call(this);for(let c=0;c<a.length;c++){const h=ee.getValue(l,"*");a[c]=h?ee.wrapPointer(h,ee.PeParameter):null,l+=Int32Array.BYTES_PER_ELEMENT}return a});e(ee.PeHorizon.prototype,"getCoord",n=>function(){const o=this.getSize();if(!o)return null;const a=[];return U0(a,o,n.call(this)),a}),e(ee.PeGTlistExtendedEntry.prototype,"getEntries",n=>{const o=ee._pe_getPeGTlistExtendedGTsSize();return function(){let a=null;const l=n.call(this);if(!ee.compare(l,ee.NULL)){a=[l];const c=this.getSteps();if(c>1){const h=ee.getPointer(l);for(let p=1;p<c;p++)a.push(ee.wrapPointer(h+o*p,ee.PeGTlistExtendedGTs))}}return a}});const i=ee._pe_getPeHorizonSize(),s=n=>function(){let o=this._cache;if(o||(o=new Map,this._cache=o),o.has(n))return o.get(n);let a=null;const l=n.call(this);if(!ee.compare(l,ee.NULL)){a=[l];const c=l.getNump();if(c>1){const h=ee.getPointer(l);for(let p=1;p<c;p++)a.push(ee.wrapPointer(h+i*p,ee.PeHorizon))}}return o.set(n,a),a};e(ee.PeProjcs.prototype,"horizonGcsGenerate",s),e(ee.PeProjcs.prototype,"horizonPcsGenerate",s),ee.PeObject.prototype.toString=function(n=Ts.PE_STR_OPTS_NONE){ee.ensureCache.prepare();const o=ee.getPointer(this),a=ee.ensureInt8(new Array(Ts.PE_BUFFER_MAX));return ee.UTF8ToString(ee._pe_object_to_string_ext(o,n,a))}}function um(t){if(!t)return;const e=ee.getClass(t);if(!e)return;const r=ee.getCache(e);if(!r)return;const i=ee.getPointer(t);i&&delete r[i]}function nM(t,e){const r=[],i=new Array(e);for(let s=0;s<t;s++)r.push(ee.ensureInt8(i));return r}function J1(t){let e;return Array.isArray(t[0])?(e=[],t.forEach(r=>{e.push(r[0],r[1])})):e=t,e}function U0(t,e,r,i=!1){if(i)for(let s=0;s<2*e;s++)t[s]=ee.getValue(r+s*Float64Array.BYTES_PER_ELEMENT,"double");else{const s=t.length===0;for(let n=0;n<e;n++)s&&(t[n]=new Array(2)),t[n][0]=ee.getValue(r,"double"),t[n][1]=ee.getValue(r+Float64Array.BYTES_PER_ELEMENT,"double"),r+=2*Float64Array.BYTES_PER_ELEMENT}}(function(t){let e;function r(){t.PE_GTLIST_OPTS_COMMON=ee.PeGTlistExtended.prototype.PE_GTLIST_OPTS_COMMON,e=ee._pe_getPeGTlistExtendedEntrySize()}function i(s,n,o,a,l,c){let h=null;const p=new ee.PeInteger(c);try{const f=ee.PeGTlistExtended.prototype.getGTlist(s,n,o,a,l,p);if((c=p.val)&&(h=[f],c>1)){const m=ee.getPointer(f);for(let y=1;y<c;y++)h.push(ee.wrapPointer(m+e*y,ee.PeGTlistExtendedEntry))}}finally{ee.destroy(p)}return h}t.init=r,t.getGTlist=i})(PN||(PN={})),function(t){function e(r){if(r&&r.length){for(const i of r)um(i),i.getEntries().forEach(s=>{um(s);const n=s.getGeogtran();um(n),n.getParameters().forEach(um),[n.getGeogcs1(),n.getGeogcs2()].forEach(o=>{um(o);const a=o.getDatum();um(a),um(a.getSpheroid()),um(o.getPrimem()),um(o.getUnit())})});ee.PeGTlistExtendedEntry.prototype.Delete(r[0])}}t.destroy=e}(T7||(T7={})),function(t){function e(r,i,s,n,o){ee.ensureCache.prepare();const a=J1(s),l=s===a,c=ee.ensureFloat64(a);let h=0;n&&(h=ee.ensureFloat64(n));const p=ee._pe_geog_to_geog(ee.getPointer(r),i,c,h,o);return p&&U0(s,i,c,l),p}t.geogToGeog=e}(S7||(S7={})),function(t){const e=(c,h,p,f,m,y)=>{let _,v;switch(ee.ensureCache.prepare(),c){case"dd":_=ee._pe_geog_to_dd,v=Ts.PE_DD_MAX;break;case"ddm":_=ee._pe_geog_to_ddm,v=Ts.PE_DDM_MAX;break;case"dms":_=ee._pe_geog_to_dms,v=Ts.PE_DMS_MAX}let w=0;h&&(w=ee.getPointer(h));const x=J1(f),T=ee.ensureFloat64(x),S=nM(p,v),O=_(w,p,T,m,ee.ensureInt32(S));if(O)for(let A=0;A<p;A++)y[A]=ee.UTF8ToString(S[A]);return O},r=(c,h,p,f,m)=>{let y;switch(ee.ensureCache.prepare(),c){case"dd":y=ee._pe_dd_to_geog;break;case"ddm":y=ee._pe_ddm_to_geog;break;case"dms":y=ee._pe_dms_to_geog}let _=0;h&&(_=ee.getPointer(h));const v=f.map(S=>ee.ensureString(S)),w=ee.ensureInt32(v),x=ee.ensureFloat64(new Array(2*p)),T=y(_,p,w,x);return T&&U0(m,p,x),T};function i(c,h,p,f,m){return e("dms",c,h,p,f,m)}function s(c,h,p,f){return r("dms",c,h,p,f)}function n(c,h,p,f,m){return e("ddm",c,h,p,f,m)}function o(c,h,p,f){return r("ddm",c,h,p,f)}function a(c,h,p,f,m){return e("dd",c,h,p,f,m)}function l(c,h,p,f){return r("dd",c,h,p,f)}t.geogToDms=i,t.dmsToGeog=s,t.geogToDdm=n,t.ddmToGeog=o,t.geogToDd=a,t.ddToGeog=l}(E7||(E7={})),function(t){function e(){t.PE_MGRS_STYLE_NEW=ee.PeNotationMgrs.prototype.PE_MGRS_STYLE_NEW,t.PE_MGRS_STYLE_OLD=ee.PeNotationMgrs.prototype.PE_MGRS_STYLE_OLD,t.PE_MGRS_STYLE_AUTO=ee.PeNotationMgrs.prototype.PE_MGRS_STYLE_AUTO,t.PE_MGRS_180_ZONE_1_PLUS=ee.PeNotationMgrs.prototype.PE_MGRS_180_ZONE_1_PLUS,t.PE_MGRS_ADD_SPACES=ee.PeNotationMgrs.prototype.PE_MGRS_ADD_SPACES}function r(s,n,o,a,l,c,h){ee.ensureCache.prepare();let p=0;s&&(p=ee.getPointer(s));const f=J1(o),m=ee.ensureFloat64(f),y=nM(n,Ts.PE_MGRS_MAX),_=ee.ensureInt32(y),v=ee._pe_geog_to_mgrs_extended(p,n,m,a,l,c,_);if(v)for(let w=0;w<n;w++)h[w]=ee.UTF8ToString(y[w]);return v}function i(s,n,o,a,l){ee.ensureCache.prepare();let c=0;s&&(c=ee.getPointer(s));const h=o.map(y=>ee.ensureString(y)),p=ee.ensureInt32(h),f=ee.ensureFloat64(new Array(2*n)),m=ee._pe_mgrs_to_geog_extended(c,n,p,a,f);return m&&U0(l,n,f),m}t.init=e,t.geogToMgrsExtended=r,t.mgrsToGeogExtended=i}(MN||(MN={})),function(t){function e(i,s,n,o,a,l,c){ee.ensureCache.prepare();let h=0;i&&(h=ee.getPointer(i));const p=J1(n),f=ee.ensureFloat64(p),m=nM(s,Ts.PE_MGRS_MAX),y=ee.ensureInt32(m),_=ee._pe_geog_to_usng(h,s,f,o,a,l,y);if(_)for(let v=0;v<s;v++)c[v]=ee.UTF8ToString(m[v]);return _}function r(i,s,n,o){ee.ensureCache.prepare();let a=0;i&&(a=ee.getPointer(i));const l=n.map(f=>ee.ensureString(f)),c=ee.ensureInt32(l),h=ee.ensureFloat64(new Array(2*s)),p=ee._pe_usng_to_geog(a,s,c,h);return p&&U0(o,s,h),p}t.geogToUsng=e,t.usngToGeog=r}(C7||(C7={})),function(t){function e(){t.PE_UTM_OPTS_NONE=ee.PeNotationUtm.prototype.PE_UTM_OPTS_NONE,t.PE_UTM_OPTS_ADD_SPACES=ee.PeNotationUtm.prototype.PE_UTM_OPTS_ADD_SPACES,t.PE_UTM_OPTS_NS=ee.PeNotationUtm.prototype.PE_UTM_OPTS_NS}function r(s,n,o,a,l){ee.ensureCache.prepare();let c=0;s&&(c=ee.getPointer(s));const h=J1(o),p=ee.ensureFloat64(h),f=nM(n,Ts.PE_UTM_MAX),m=ee.ensureInt32(f),y=ee._pe_geog_to_utm(c,n,p,a,m);if(y)for(let _=0;_<n;_++)l[_]=ee.UTF8ToString(f[_]);return y}function i(s,n,o,a,l){ee.ensureCache.prepare();let c=0;s&&(c=ee.getPointer(s));const h=o.map(y=>ee.ensureString(y)),p=ee.ensureInt32(h),f=ee.ensureFloat64(new Array(2*n)),m=ee._pe_utm_to_geog(c,n,p,a,f);return m&&U0(l,n,f),m}t.init=e,t.geogToUtm=r,t.utmToGeog=i}(IN||(IN={})),function(t){const e=new Map;function r(){t.PE_PCSINFO_OPTION_NONE=ee.PePCSInfo.prototype.PE_PCSINFO_OPTION_NONE,t.PE_PCSINFO_OPTION_DOMAIN=ee.PePCSInfo.prototype.PE_PCSINFO_OPTION_DOMAIN,t.PE_POLE_OUTSIDE_BOUNDARY=ee.PePCSInfo.prototype.PE_POLE_OUTSIDE_BOUNDARY,t.PE_POLE_POINT=ee.PePCSInfo.prototype.PE_POLE_POINT}function i(s,n=t.PE_PCSINFO_OPTION_DOMAIN){let o=null,a=null;return e.has(s)&&(a=e.get(s),a[n]&&(o=a[n])),o||(o=ee.PePCSInfo.prototype.generate(s,n),a||(a=[],e.set(s,a)),a[n]=o),o}t.init=r,t.generate=i}($N||($N={})),function(t){function e(){return ee.PeVersion.prototype.version_string()}t.versionString=e}(A7||(A7={}));const CBe=Object.freeze(Object.defineProperty({__proto__:null,get PeCSTransformations(){return w7},get PeDefs(){return Ts},get PeFactory(){return x7},get PeGCSExtent(){return T_e},get PeGTTransformations(){return S7},get PeGTlistExtended(){return PN},get PeGTlistExtendedEntry(){return T7},get PeNotationDms(){return E7},get PeNotationMgrs(){return MN},get PeNotationUsng(){return C7},get PeNotationUtm(){return IN},get PePCSInfo(){return $N},get PeVersion(){return A7},_init:S_e,get _pe(){return ee},isLoaded:w_e,isSupported:EBe,load:x_e},Symbol.toStringTag,{value:"Module"})),BCt=Math.PI/180,GCt=/SPHEROID\[([^\]]+)]/i,by=nr.radius,Zh=nr.eccentricitySquared,ABe={a1:by*Zh,a2:by*Zh*by*Zh,a3:by*Zh*Zh/2,a4:by*Zh*by*Zh*2.5,a5:by*Zh+by*Zh*Zh/2,a6:1-Zh},jCt={4267:{a:63782064e-1,f:1/294.9786982},4269:{a:6378137,f:1/298.257222101},4326:{a:nr.radius,f:nr.flattening},104900:{a:2439700,f:0},104901:{a:6051e3,f:0},104902:{a:6051800,f:0},104903:{a:$g.radius,f:$g.flattening},104904:{a:3393400,f:1/192.0430107526882},104905:{a:Af.radius,f:Af.flattening},104906:{a:6200,f:0},104907:{a:11100,f:0},104908:{a:71492e3,f:.06487439154031222},104909:{a:8200,f:0},104910:{a:83500,f:0},104911:{a:1e4,f:0},104912:{a:2409300,f:0},104913:{a:15e3,f:0},104914:{a:4e4,f:0},104915:{a:1562090,f:0},104916:{a:2632345,f:0},104917:{a:85e3,f:0},104918:{a:1821460,f:0},104919:{a:5e3,f:0},104920:{a:12e3,f:0},104921:{a:3e4,f:3},104922:{a:18e3,f:0},104923:{a:14e3,f:0},104924:{a:49300,f:0},104925:{a:60268e3,f:1/10.2079945799458},104926:{a:16e3,f:0},104927:{a:9500,f:0},104928:{a:56e4,f:0},104929:{a:249400,f:0},104930:{a:59500,f:0},104931:{a:16e3,f:0},104932:{a:133e3,f:0},104933:{a:718e3,f:0},104934:{a:888e3,f:0},104935:{a:1986300,f:0},104936:{a:1e4,f:0},104937:{a:41900,f:0},104938:{a:11e4,f:0},104939:{a:50100,f:0},104940:{a:764e3,f:0},104941:{a:11e3,f:0},104942:{a:529800,f:0},104943:{a:2575e3,f:0},104944:{a:25559e3,f:1/43.61604095563141},104945:{a:578900,f:0},104946:{a:33e3,f:0},104947:{a:21e3,f:0},104948:{a:13e3,f:0},104949:{a:31e3,f:0},104950:{a:27e3,f:0},104951:{a:42e3,f:0},104952:{a:235800,f:0},104953:{a:761400,f:0},104954:{a:15e3,f:0},104955:{a:54e3,f:0},104956:{a:77e3,f:0},104957:{a:27e3,f:0},104958:{a:788900,f:0},104959:{a:584700,f:0},104960:{a:24764e3,f:.01708124697141011},104961:{a:74e3,f:0},104962:{a:79e3,f:0},104963:{a:104e3,f:.14423076923076922},104964:{a:29e3,f:0},104965:{a:17e4,f:0},104966:{a:208e3,f:0},104967:{a:4e4,f:0},104968:{a:1352600,f:0},104969:{a:1195e3,f:0},104970:{a:593e3,f:0},104971:{a:Af.radius,f:0},104972:{a:47e4,f:0},104973:{a:255e3,f:0},104974:{a:2439400,f:0}};let oM=0,MU=class O7{static fromGE(e){const r=new O7;return r._wkt=e.wkt,r._wkid=e.wkid,r._isInverse=e.isInverse,r}constructor(e){this.uid=oM++,e?(this._wkt=e.wkt!=null?e.wkt:null,this._wkid=e.wkid!=null?e.wkid:-1,this._isInverse=e.isInverse!=null&&e.isInverse===!0):(this._wkt=null,this._wkid=-1,this._isInverse=!1)}get wkt(){return this._wkt}set wkt(e){this._wkt=e,this.uid=oM++}get wkid(){return this._wkid}set wkid(e){this._wkid=e,this.uid=oM++}get isInverse(){return this._isInverse}set isInverse(e){this._isInverse=e,this.uid=oM++}getInverse(){const e=new O7;return e._wkt=this.wkt,e._wkid=this._wkid,e._isInverse=!this.isInverse,e}},LN=class TA{static cacheKey(e,r){return[e.wkid!==void 0&&e.wkid!==null?e.wkid.toString():"-1",e.wkt!==void 0&&e.wkt!==null?e.wkt.toString():"",r.wkid!==void 0&&r.wkid!==null?r.wkid.toString():"-1",r.wkt!==void 0&&r.wkt!==null?r.wkt.toString():""].join(",")}static fromGE(e){const r=new TA;let i="";for(const s of e.steps){const n=MU.fromGE(s);r.steps.push(n),i+=n.uid.toString()+","}return r._cachedProjection={},r._gtlistentry=null,r._chain=i,r}constructor(e){if(this.steps=[],this._cachedProjection={},this._chain="",this._gtlistentry=null,e&&e.steps)for(const r of e.steps)r instanceof MU?this.steps.push(r):this.steps.push(new MU({wkid:r.wkid,wkt:r.wkt,isInverse:r.isInverse}))}getInverse(){const e=new TA;e.steps=[];for(let r=this.steps.length-1;r>=0;r--){const i=this.steps[r];e.steps.push(i.getInverse())}return e}getGTListEntry(){let e="";for(const r of this.steps)e+=r.uid.toString()+",";return e!==this._chain&&(this._gtlistentry=null,this._cachedProjection={},this._chain=e),this._gtlistentry}assignCachedGe(e,r,i){this._cachedProjection[TA.cacheKey(e,r)]=i}getCachedGeTransformation(e,r){let i="";for(const n of this.steps)i+=n.uid.toString()+",";i!==this._chain&&(this._gtlistentry=null,this._cachedProjection={},this._chain=i);const s=this._cachedProjection[TA.cacheKey(e,r)];return s===void 0?null:s}},Kd=null,I_=null,I3=null,OL={};const E_e=new zF;function y5(){return!!Kd&&w_e()}function NO(t){return I3==null&&(I3=Promise.all([x_e(),ae(()=>import("./geometryEngineBase-d69ff1ad.js"),[],import.meta.url).then(e=>e.g),ae(()=>import("./hydrated-e6cbef23.js"),[],import.meta.url)])),I3.then(([,e,{hydratedAdapter:r}])=>{Xt(t),I_=r,Kd=e.default,Kd._enableProjection(CBe),E_e.notify()})}function Lw(t,e,r=null,i=null){return Array.isArray(t)?t.length===0?[]:R7(I_,t,t[0].spatialReference,e,r,i):R7(I_,[t],t.spatialReference,e,r,i)[0]}function R7(t,e,r,i,s=null,n=null){if(r==null||i==null)return e;if(Vf(r,i,s))return e.map(o=>$Z(o,r,i));if(s==null){const o=LN.cacheKey(r,i);OL[o]!==void 0?s=OL[o]:((s=A_e(r,i,void 0))==null&&(s=new LN),OL[o]=s)}if(Kd==null||t==null)throw new _5;return n!=null?Kd._project(t,e,r,i,s,n):Kd._project(t,e,r,i,s)}function OBe(t,e){const r=C_e([t],e);return r.pending!=null?{pending:r.pending,geometry:null}:r.geometries!=null?{pending:null,geometry:r.geometries[0]}:{pending:null,geometry:null}}function C_e(t,e){if(!y5()){for(const r of t)if(r!=null&&!Rn(r.spatialReference,e)&&aa(r.spatialReference)&&aa(e)&&!Vf(r.spatialReference,e))return Ht(E_e),{pending:NO(),geometries:null}}return{pending:null,geometries:t.map(r=>r==null?null:Rn(r.spatialReference,e)?r:aa(r.spatialReference)&&aa(e)?O_e(r,e):null)}}function A_e(t,e,r=null){if(t==null||e==null)return null;if(Kd==null||I_==null)throw new _5;const i=Kd._getTransformation(I_,t,e,r,r?.spatialReference);return i!==null?LN.fromGE(i):null}function RBe(t,e,r=null){if(Kd==null||I_==null)throw new _5;const i=Kd._getTransformationBySuitability(I_,t,e,r,r?.spatialReference);if(i!==null){const s=[];for(const n of i)s.push(LN.fromGE(n));return s}return[]}class _5 extends F{constructor(){super("projection:not-loaded","projection engine not fully loaded yet, please call load()")}}var q;function PBe(){Kd=null,I_=null,I3=null,OL={}}(function(t){t[t.UNKNOWN=0]="UNKNOWN",t[t.SPHERICAL_ECEF=1]="SPHERICAL_ECEF",t[t.WGS84=2]="WGS84",t[t.WEB_MERCATOR=3]="WEB_MERCATOR",t[t.WGS84_ECEF=4]="WGS84_ECEF",t[t.CGCS2000=5]="CGCS2000",t[t.WGS84_COMPARABLE_LON_LAT=6]="WGS84_COMPARABLE_LON_LAT",t[t.SPHERICAL_MARS_PCPF=7]="SPHERICAL_MARS_PCPF",t[t.GCSMARS2000=8]="GCSMARS2000",t[t.SPHERICAL_MOON_PCPF=9]="SPHERICAL_MOON_PCPF",t[t.GCSMOON2000=10]="GCSMOON2000",t[t.LON_LAT=11]="LON_LAT",t[t.PLATE_CARREE=12]="PLATE_CARREE"})(q||(q={}));const MBe={get loadPromise(){return I3}};function O_e(t,e){try{const r=Lw(t,e);if(r==null)return null;"xmin"in t&&"xmin"in r&&(r.zmin=t.zmin,r.zmax=t.zmax);const i=b0e(r.type,t.spatialReference,e);return i?.(r),r}catch(r){if(!(r instanceof _5))throw r;return null}}function Vf(t,e,r){return!r&&(!!Rn(t,e)||aa(t)&&aa(e)&&!!FZ(t,e,kZ))}async function R_e(t,e,r,i){if(y5())return SQ(i);if(Array.isArray(t)){for(const{source:s,dest:n,geographicTransformation:o}of t)if(!Vf(s,n,o))return NO(i)}else if(!Vf(t,e,r))return NO(i);return SQ(i)}function IBe(t,e){switch(FZ(t,e,kZ)){case Ei:return"copy3";case i_:return"wgs84ToSphericalECEF";case iw:return"wgs84ToWebMercator";case r_:return"wgs84ToPlateCarree";case n_:return"wgs84ToWGS84ECEF";case Ob:return"webMercatorToWGS84";case z_e:return"webMercatorToSphericalECEF";case B_e:return"webMercatorToWGS84ECEF";case G_e:return"webMercatorToPlateCarree";case o_:return"wgs84ECEFToWGS84";case W_e:return"wgs84ECEFToSphericalECEF";case Z_e:return"wgs84ECEFToWebMercator";case s_:return"sphericalECEFToWGS84";case H_e:return"sphericalECEFToWebMercator";case L7:return"sphericalMarsPCPFToMars2000";case $7:return"sphericalMoonPCPFToMoon2000";case q_e:return"sphericalECEFToWGS84ECEF";case I7:return"mars2000ToSphericalPCPF";case M7:return"moon2000ToSphericalPCPF";default:return null}}function $Z(t,e,r){return t?"x"in t?M_e(t,e,new pt,r,0):"xmin"in t?N_e(t,e,new _r,r,0):"rings"in t?D_e(t,e,new Jd,r,0):"paths"in t?$_e(t,e,new MF,r,0):"points"in t?I_e(t,e,new OR,r,0):null:null}function P_e(t,e,r=e.spatialReference,i=0){return r!=null&&t.spatialReference!=null&&M_e(t,t.spatialReference,e,r,i)!=null}function M_e(t,e,r,i,s){Fr[0]=t.x,Fr[1]=t.y;const n=t.z;return Fr[2]=n!==void 0?n:s,oi(Fr,e,0,Fr,i,0,1)?(r.x=Fr[0],r.y=Fr[1],r.spatialReference=i,n===void 0?(r.z=void 0,r.hasZ=!1):(r.z=Fr[2],r.hasZ=!0),t.m===void 0?(r.m=void 0,r.hasM=!1):(r.m=t.m,r.hasM=!0),r):null}function $Be(t,e,r=e.spatialReference,i=0){return t.spatialReference!=null&&r!=null&&I_e(t,t.spatialReference,e,r,i)!=null}function I_e(t,e,r,i,s){const{points:n,hasZ:o,hasM:a}=t,l=[],c=n.length,h=[];for(const p of n)h.push(p[0],p[1],o?p[2]:s);if(!oi(h,e,0,h,i,0,c))return null;for(let p=0;p<c;++p){const f=3*p,m=h[f],y=h[f+1];o&&a?l.push([m,y,h[f+2],n[p][3]]):o?l.push([m,y,h[f+2]]):a?l.push([m,y,n[p][2]]):l.push([m,y])}return r.points=l,r.spatialReference=i,r.hasZ=o,r.hasM=a,r}function LBe(t,e,r=e.spatialReference,i=0){return t.spatialReference!=null&&r!=null&&$_e(t,t.spatialReference,e,r,i)!=null}function $_e(t,e,r,i,s){const{paths:n,hasZ:o,hasM:a}=t,l=[];return k_e(n,o??!1,a??!1,e,l,i,s)?(r.paths=l,r.spatialReference=i,r.hasZ=o,r.hasM=a,r):null}function DBe({hasZ:t,spatialReference:e,paths:r},i,s=0){const n=zf(e,hE),o=gh[n][q.WGS84_COMPARABLE_LON_LAT];if(o==null)return!1;const a=t?l=>l:l=>se(Fr,l[0],l[1],s);for(const l of r){const c=[];for(const h of l){const p=[0,0,s];o(a(h),0,p,0),c.push(p)}i.push(c)}return!0}function NBe({hasZ:t,spatialReference:e,rings:r},i,s=0){const n=zf(e,hE),o=gh[n][q.WGS84_COMPARABLE_LON_LAT];if(o==null)return!1;const a=t?l=>l:l=>se(Fr,l[0],l[1],s);for(const l of r){const c=[];for(const h of l){const p=[0,0,s];o(a(h),0,p,0),c.push(p)}i.push(c)}return!0}function L_e(t,e,r=e.spatialReference,i=0){return t.spatialReference!=null&&r!=null&&D_e(t,t.spatialReference,e,r,i)!=null}function D_e(t,e,r,i,s){const{rings:n,hasZ:o,hasM:a}=t,l=[];return k_e(n,o??!1,a??!1,e,l,i,s)?(r.rings=l,r.spatialReference=i,r.hasZ=o,r.hasM=a,r):null}function FBe(t,e,r=e.spatialReference,i=0){return t.spatialReference!=null&&r!=null&&N_e(t,t.spatialReference,e,r,i)!=null}function N_e(t,e,r,i,s){const{xmin:n,ymin:o,xmax:a,ymax:l,hasZ:c,hasM:h}=t;return P7(n,o,c?t.zmin:s,e,Fr,i)?(r.xmin=Fr[0],r.ymin=Fr[1],c&&(r.zmin=Fr[2]),P7(a,l,c?t.zmax:s,e,Fr,i)?(r.xmax=Fr[0],r.ymax=Fr[1],c&&(r.zmax=Fr[2]),h&&(r.mmin=t.mmin,r.mmax=t.mmax),r.spatialReference=i,r):null):null}function Ug(t,e,r){if(e==null||r==null)return null;const i=new pt({spatialReference:r});return oi(t,e,0,Fr,r,0,1)?(i.x=Fr[0],i.y=Fr[1],i.z=Fr[2],i):null}function LZ(t,e,r){return oi(t,e,0,Fr,r.spatialReference,0,1)?(r.x=Fr[0],r.y=Fr[1],r.z=Fr[2],r):null}function wo(t,e,r,i=0){Fr[0]=t.x,Fr[1]=t.y;const s=t.z;return Fr[2]=s!==void 0?s:i,oi(Fr,t.spatialReference,0,e,r,0,1)}function P7(t,e,r,i,s,n){return ts[0]=t,ts[1]=e,ts[2]=r,oi(ts,i,0,s,n,0,1)}function Ws(t,e,r,i){return!(e==null||i==null||t.length<2)&&(t.length===2&&(ts[0]=t[0],ts[1]=t[1],ts[2]=0,t=ts),oi(t,e,0,r,i,0,1))}function F_e(t,e){Fr[0]=t.x,Fr[1]=t.y;const r=t.z;return Fr[2]=r!==void 0?r:0,U_e(Fr,t.spatialReference,e)}function U_e(t,e,r){return UBe(t,e,r)}function UBe(t,e,r){if(e==null)return!1;const i=zf(e,hE),s=gh[i][q.WGS84_COMPARABLE_LON_LAT];return s!=null&&(s(t,0,ts,0),r!==ts&&(r[0]=ts[0],r[1]=ts[1],r.length>2&&(r[2]=ts[2])),!0)}function oi(t,e,r,i,s,n,o=1){const a=FZ(e,s,kZ);if(a==null)return!1;if(a===Ei){if(t===i&&r===n)return!0;const c=r+3*o;for(let h=r,p=n;h<c;h++,p++)i[p]=t[h];return!0}const l=r+3*o;for(let c=r,h=n;c<l;c+=3,h+=3)a(t,c,i,h);return!0}function kBe(t,e,r,i,s){ie(Fr,t),ce(aM,t,e),Ws(Fr,r,Fr,s),Ws(aM,r,aM,s),he(i,aM,Fr),me(i,i)}function k_e(t,e,r,i,s,n,o=0){const a=new Array;for(const c of t)for(const h of c)a.push(h[0],h[1],e?h[2]:o);if(!oi(a,i,0,a,n,0,a.length/3))return!1;let l=0;s.length=0;for(const c of t){const h=new Array;for(const p of c)e&&r?h.push([a[l++],a[l++],a[l++],p[3]]):e?h.push([a[l++],a[l++],a[l++]]):r?(h.push([a[l++],a[l++],p[2]]),l++):(h.push([a[l++],a[l++]]),l++);s.push(h)}return!0}function VBe(t,e,r,i){if(e==null||i==null)return!1;const s=X_e(e,i,ZBe);if(s.projector===Ei)return r[0]=t[0],r[1]=t[1],r[2]=t[2],r[3]=t[3],!0;if(s.projector==null)return!1;const{source:n,dest:o}=s;if(o.spatialReferenceId===q.WEB_MERCATOR){const a=gh[n.spatialReferenceId][q.WGS84];return a!=null&&(a(t,0,Pd,0),iw(Pd,0,r,0),r[3]=Ste(Pd[1],t[2],t[3],nr.radius),!0)}if(n.spatialReferenceId!==q.WGS84&&n.spatialReferenceId!==q.CGCS2000||o.spatialReferenceId!==q.PLATE_CARREE){s.projector(t,0,r,0);const a=n.metersPerUnit??1,l=o.metersPerUnit??1;r[3]=t[3]*a/l}else{const a=gh[n.spatialReferenceId][q.SPHERICAL_ECEF],l=gh[q.SPHERICAL_ECEF][q.PLATE_CARREE];let c=t[3];a!=null&&l!=null&&(c=Ste(t[1],t[2],t[3],nr.radius)),s.projector(t,0,r,0),r[3]=c}return!0}function Ste(t,e,r,i){const s=i+e;if(s<i/2||r>s)return Number.MAX_VALUE;const n=Math.abs(Hd*t)+Math.asin(r/s);return n>=Math.PI/2?Number.MAX_VALUE:r/Math.cos(n)}function qR(t,e,r,i){return t!=null&&(Rn(e,i)?(Lg(r,t),!0):(ts[0]=t[0],ts[1]=t[1],ts[2]=0,!!oi(ts,e,0,ts,i,0,1)&&(r[0]=ts[0],r[1]=ts[1],ts[0]=t[2],ts[1]=t[3],ts[2]=0,!!oi(ts,e,0,ts,i,0,1)&&(r[2]=ts[0],r[3]=ts[1],!0))))}function zBe(t,e,r,i){if(e==null||i==null)return!1;const s=zf(e,hE),n=zf(i,Y_e);if(s===n&&s!==q.UNKNOWN||Rn(e,i))return r[0]=1,r[1]=1,r[2]=1,!0;if(s===q.SPHERICAL_ECEF){const o=Ce(t),a=o/Math.sqrt(t[0]*t[0]+t[1]*t[1]),l=o/nr.radius;if(n===q.WEB_MERCATOR)return r[0]=a*l,r[1]=a*l,r[2]=1,!0;if(n===q.WGS84||n===q.CGCS2000){const c=$3;return r[0]=c*a*l,r[1]=c*l,r[2]=1,!0}}else if(s===q.PLATE_CARREE){if(n===q.WGS84||n===q.CGCS2000)return r[0]=$3,r[1]=$3,r[2]=1,!0;if(n===q.WEB_MERCATOR){const o=t[1]/nr.radius;return r[0]=1,r[1]=1/Math.cos(o),r[2]=1,!0}}return!1}function Tl(t,e,r,i){if(t==null||i==null)return!1;const s=zf(t,hE),n=zf(i,Y_e);if(s===n&&!Ete(n)&&(s!==q.UNKNOWN||Rn(t,i)))return zR(r,e),!0;if(Ete(n)){const o=gh[s][q.LON_LAT],a=gh[q.LON_LAT][n];return o!=null&&a!=null&&(o(e,0,Pd,0),a(Pd,0,wy,0),DZ(Hd*Pd[0],Hd*Pd[1],r),r[12]=wy[0],r[13]=wy[1],r[14]=wy[2],!0)}if((n===q.WEB_MERCATOR||n===q.PLATE_CARREE)&&(s===q.WGS84||s===q.CGCS2000&&n===q.PLATE_CARREE||s===q.SPHERICAL_ECEF||s===q.WEB_MERCATOR)){const o=gh[s][q.LON_LAT],a=gh[q.LON_LAT][n];return o!=null&&a!=null&&(o(e,0,Pd,0),a(Pd,0,wy,0),s===q.SPHERICAL_ECEF?V_e(Hd*Pd[0],Hd*Pd[1],r):Rh(r),r[12]=wy[0],r[13]=wy[1],r[14]=wy[2],!0)}return!1}function Ete(t){return t===q.SPHERICAL_ECEF||t===q.SPHERICAL_MARS_PCPF||t===q.SPHERICAL_MOON_PCPF}function DZ(t,e,r){const i=Math.sin(t),s=Math.cos(t),n=Math.sin(e),o=Math.cos(e),a=r;return a[0]=-i,a[4]=-n*s,a[8]=o*s,a[12]=0,a[1]=s,a[5]=-n*i,a[9]=o*i,a[13]=0,a[2]=0,a[6]=o,a[10]=n,a[14]=0,a[3]=0,a[7]=0,a[11]=0,a[15]=1,a}function V_e(t,e,r){return DZ(t,e,r),xc(r,r),r}function zf(t,e){return t?e.spatialReference===t?e.spatialReferenceId:(e.spatialReference=t,"metersPerUnit"in e&&(e.metersPerUnit=Za(t,1)),t.wkt===Ype.wkt?e.spatialReferenceId=q.SPHERICAL_ECEF:vO(t)?e.spatialReferenceId=q.WGS84:Gb(t)?e.spatialReferenceId=q.WEB_MERCATOR:bO(t)?e.spatialReferenceId=q.PLATE_CARREE:t.wkt===Jpe.wkt?e.spatialReferenceId=q.WGS84_ECEF:t.wkid===hh.CGCS2000?e.spatialReferenceId=q.CGCS2000:t.wkt===Zq.wkt?e.spatialReferenceId=q.SPHERICAL_MARS_PCPF:t.wkt===Xq.wkt?e.spatialReferenceId=q.SPHERICAL_MOON_PCPF:Qf(t)?e.spatialReferenceId=q.GCSMARS2000:Kf(t)?e.spatialReferenceId=q.GCSMOON2000:e.spatialReferenceId=q.UNKNOWN):q.UNKNOWN}function Ei(t,e,r,i){t!==r&&(r[i++]=t[e++],r[i++]=t[e++],r[i]=t[e])}function Ob(t,e,r,i){r[i++]=p2*(t[e++]/nr.radius),r[i++]=p2*(Math.PI/2-2*Math.atan(Math.exp(-t[e++]/nr.radius))),r[i]=t[e]}function z_e(t,e,r,i){Ob(t,e,r,i),i_(r,i,r,i)}function B_e(t,e,r,i){Ob(t,e,r,i),n_(r,i,r,i)}function v5(t,e,r,i,s){const n=.4999999*Math.PI,o=ge(Hd*t[e+1],-n,n),a=Math.sin(o);r[i++]=Hd*t[e]*s.radius,r[i++]=s.halfSemiMajorAxis*Math.log((1+a)/(1-a)),r[i]=t[e+2]}function iw(t,e,r,i){v5(t,e,r,i,nr)}const Cte=nr.radius*Math.PI/180,$3=180/(nr.radius*Math.PI);function r_(t,e,r,i){r[i]=t[e]*Cte,r[i+1]=t[e+1]*Cte,r[i+2]=t[e+2]}function pb(t,e,r,i){r[i]=t[e]*$3,r[i+1]=t[e+1]*$3,r[i+2]=t[e+2]}function G_e(t,e,r,i){Ob(t,e,r,i),r_(r,i,r,i)}function BBe(t,e,r,i){o_(t,e,r,i),r_(r,i,r,i)}function GBe(t,e,r,i){s_(t,e,r,i),r_(r,i,r,i)}function jBe(t,e,r,i){pb(t,e,r,i),i_(r,i,r,i)}function HBe(t,e,r,i){pb(t,e,r,i),iw(r,i,r,i)}function qBe(t,e,r,i){pb(t,e,r,i),n_(r,i,r,i)}function $_(t){if(t==null)return!1;const e=zf(t,hE);return!!gh[e][q.WGS84_COMPARABLE_LON_LAT]}function j_e(t,e,r,i){const s=Math.cos(r);t[0]=Math.cos(e)*s*i,t[1]=Math.sin(e)*s*i,t[2]=Math.sin(r)*i}function NZ(t,e,r,i,s){const n=s+t[e+2],o=Hd*t[e+1],a=Hd*t[e],l=Math.cos(o);r[i++]=Math.cos(a)*l*n,r[i++]=Math.sin(a)*l*n,r[i]=Math.sin(o)*n}function M7(t,e,r,i){NZ(t,e,r,i,$g.radius)}function I7(t,e,r,i){NZ(t,e,r,i,Af.radius)}function i_(t,e,r,i){NZ(t,e,r,i,nr.radius)}function b5(t,e,r,i,s){const n=t[e],o=t[e+1],a=t[e+2],l=Math.sqrt(n*n+o*o+a*a),c=Ch(a/(l===0?1:l)),h=Math.atan2(o,n);r[i++]=p2*h,r[i++]=p2*c,r[i]=l-s}function $7(t,e,r,i){b5(t,e,r,i,$g.radius)}function L7(t,e,r,i){b5(t,e,r,i,Af.radius)}function s_(t,e,r,i){b5(t,e,r,i,nr.radius)}function H_e(t,e,r,i){s_(t,e,r,i),iw(r,i,r,i)}function q_e(t,e,r,i){s_(t,e,r,i),n_(r,i,r,i)}function WBe(t,e,r,i,s){const n=Hd*t[e],o=Hd*t[e+1],a=t[e+2],l=Math.sin(o),c=Math.cos(o),h=s.radius/Math.sqrt(1-s.eccentricitySquared*l*l);r[i++]=(h+a)*c*Math.cos(n),r[i++]=(h+a)*c*Math.sin(n),r[i++]=(h*(1-s.eccentricitySquared)+a)*l}function n_(t,e,r,i){WBe(t,e,r,i,nr)}function o_(t,e,r,i){const s=ABe,n=t[e],o=t[e+1],a=t[e+2];let l,c,h,p,f,m,y,_,v,w,x,T,S,O,A,I,M,k,L,D,U;l=Math.abs(a),c=n*n+o*o,h=Math.sqrt(c),p=c+a*a,f=Math.sqrt(p),D=Math.atan2(o,n),m=a*a/p,y=c/p,O=s.a2/f,A=s.a3-s.a4/f,y>.3?(_=l/f*(1+y*(s.a1+O+m*A)/f),L=Math.asin(_),w=_*_,v=Math.sqrt(1-w)):(v=h/f*(1-m*(s.a5-O-y*A)/f),L=Math.acos(v),w=1-v*v,_=Math.sqrt(w)),x=1-nr.eccentricitySquared*w,T=nr.radius/Math.sqrt(x),S=s.a6*T,O=h-T*v,A=l-S*_,M=v*O+_*A,I=v*A-_*O,k=I/(S/x+M),L+=k,U=M+I*k/2,a<0&&(L=-L),r[i++]=p2*D,r[i++]=p2*L,r[i]=U}function W_e(t,e,r,i){o_(t,e,r,i),i_(r,i,r,i)}function Z_e(t,e,r,i){o_(t,e,r,i),iw(r,i,r,i)}const gh={[q.WGS84]:{[q.CGCS2000]:null,[q.GCSMARS2000]:null,[q.GCSMOON2000]:null,[q.LON_LAT]:Ei,[q.WGS84_COMPARABLE_LON_LAT]:Ei,[q.SPHERICAL_ECEF]:i_,[q.SPHERICAL_MARS_PCPF]:null,[q.SPHERICAL_MOON_PCPF]:null,[q.UNKNOWN]:null,[q.WEB_MERCATOR]:iw,[q.PLATE_CARREE]:r_,[q.WGS84]:Ei,[q.WGS84_ECEF]:n_},[q.CGCS2000]:{[q.CGCS2000]:Ei,[q.GCSMARS2000]:null,[q.GCSMOON2000]:null,[q.LON_LAT]:Ei,[q.WGS84_COMPARABLE_LON_LAT]:Ei,[q.SPHERICAL_ECEF]:i_,[q.SPHERICAL_MARS_PCPF]:null,[q.SPHERICAL_MOON_PCPF]:null,[q.UNKNOWN]:null,[q.WEB_MERCATOR]:null,[q.PLATE_CARREE]:r_,[q.WGS84]:null,[q.WGS84_ECEF]:n_},[q.GCSMARS2000]:{[q.CGCS2000]:null,[q.GCSMARS2000]:Ei,[q.GCSMOON2000]:null,[q.LON_LAT]:Ei,[q.WGS84_COMPARABLE_LON_LAT]:null,[q.SPHERICAL_ECEF]:null,[q.SPHERICAL_MARS_PCPF]:I7,[q.SPHERICAL_MOON_PCPF]:null,[q.UNKNOWN]:null,[q.WEB_MERCATOR]:null,[q.PLATE_CARREE]:null,[q.WGS84]:null,[q.WGS84_ECEF]:null},[q.GCSMOON2000]:{[q.CGCS2000]:null,[q.GCSMARS2000]:null,[q.GCSMOON2000]:Ei,[q.LON_LAT]:Ei,[q.WGS84_COMPARABLE_LON_LAT]:null,[q.SPHERICAL_ECEF]:null,[q.SPHERICAL_MARS_PCPF]:null,[q.SPHERICAL_MOON_PCPF]:M7,[q.UNKNOWN]:null,[q.WEB_MERCATOR]:null,[q.PLATE_CARREE]:null,[q.WGS84]:null,[q.WGS84_ECEF]:null},[q.WEB_MERCATOR]:{[q.CGCS2000]:null,[q.GCSMARS2000]:null,[q.GCSMOON2000]:null,[q.LON_LAT]:Ob,[q.WGS84_COMPARABLE_LON_LAT]:Ob,[q.SPHERICAL_ECEF]:z_e,[q.SPHERICAL_MARS_PCPF]:null,[q.SPHERICAL_MOON_PCPF]:null,[q.UNKNOWN]:null,[q.WEB_MERCATOR]:Ei,[q.PLATE_CARREE]:G_e,[q.WGS84]:Ob,[q.WGS84_ECEF]:B_e},[q.WGS84_ECEF]:{[q.CGCS2000]:o_,[q.GCSMARS2000]:null,[q.GCSMOON2000]:null,[q.LON_LAT]:o_,[q.WGS84_COMPARABLE_LON_LAT]:o_,[q.SPHERICAL_ECEF]:W_e,[q.SPHERICAL_MARS_PCPF]:null,[q.SPHERICAL_MOON_PCPF]:null,[q.UNKNOWN]:null,[q.WEB_MERCATOR]:Z_e,[q.PLATE_CARREE]:BBe,[q.WGS84]:o_,[q.WGS84_ECEF]:Ei},[q.SPHERICAL_ECEF]:{[q.CGCS2000]:s_,[q.GCSMARS2000]:null,[q.GCSMOON2000]:null,[q.LON_LAT]:s_,[q.WGS84_COMPARABLE_LON_LAT]:s_,[q.SPHERICAL_ECEF]:Ei,[q.SPHERICAL_MARS_PCPF]:null,[q.SPHERICAL_MOON_PCPF]:null,[q.UNKNOWN]:null,[q.WEB_MERCATOR]:H_e,[q.PLATE_CARREE]:GBe,[q.WGS84]:s_,[q.WGS84_ECEF]:q_e},[q.SPHERICAL_MARS_PCPF]:{[q.CGCS2000]:null,[q.GCSMARS2000]:L7,[q.GCSMOON2000]:null,[q.LON_LAT]:L7,[q.WGS84_COMPARABLE_LON_LAT]:null,[q.SPHERICAL_ECEF]:null,[q.SPHERICAL_MARS_PCPF]:Ei,[q.SPHERICAL_MOON_PCPF]:null,[q.UNKNOWN]:null,[q.WEB_MERCATOR]:null,[q.PLATE_CARREE]:null,[q.WGS84]:null,[q.WGS84_ECEF]:null},[q.SPHERICAL_MOON_PCPF]:{[q.CGCS2000]:null,[q.GCSMARS2000]:null,[q.GCSMOON2000]:$7,[q.LON_LAT]:$7,[q.WGS84_COMPARABLE_LON_LAT]:null,[q.SPHERICAL_ECEF]:null,[q.SPHERICAL_MARS_PCPF]:null,[q.SPHERICAL_MOON_PCPF]:Ei,[q.UNKNOWN]:null,[q.WEB_MERCATOR]:null,[q.PLATE_CARREE]:null,[q.WGS84]:null,[q.WGS84_ECEF]:null},[q.UNKNOWN]:{[q.CGCS2000]:null,[q.GCSMARS2000]:null,[q.GCSMOON2000]:null,[q.LON_LAT]:null,[q.WGS84_COMPARABLE_LON_LAT]:null,[q.SPHERICAL_ECEF]:null,[q.SPHERICAL_MARS_PCPF]:null,[q.SPHERICAL_MOON_PCPF]:null,[q.UNKNOWN]:Ei,[q.WEB_MERCATOR]:null,[q.PLATE_CARREE]:null,[q.WGS84]:null,[q.WGS84_ECEF]:null},[q.LON_LAT]:{[q.CGCS2000]:Ei,[q.GCSMARS2000]:Ei,[q.GCSMOON2000]:Ei,[q.LON_LAT]:Ei,[q.WGS84_COMPARABLE_LON_LAT]:Ei,[q.SPHERICAL_ECEF]:i_,[q.SPHERICAL_MARS_PCPF]:I7,[q.SPHERICAL_MOON_PCPF]:M7,[q.UNKNOWN]:null,[q.WEB_MERCATOR]:iw,[q.PLATE_CARREE]:r_,[q.WGS84]:Ei,[q.WGS84_ECEF]:n_},[q.WGS84_COMPARABLE_LON_LAT]:{[q.CGCS2000]:null,[q.GCSMARS2000]:null,[q.GCSMOON2000]:null,[q.LON_LAT]:Ei,[q.WGS84_COMPARABLE_LON_LAT]:Ei,[q.SPHERICAL_ECEF]:i_,[q.SPHERICAL_MARS_PCPF]:null,[q.SPHERICAL_MOON_PCPF]:null,[q.UNKNOWN]:null,[q.WEB_MERCATOR]:null,[q.PLATE_CARREE]:r_,[q.WGS84]:Ei,[q.WGS84_ECEF]:n_},[q.PLATE_CARREE]:{[q.CGCS2000]:pb,[q.GCSMARS2000]:null,[q.GCSMOON2000]:null,[q.LON_LAT]:pb,[q.WGS84_COMPARABLE_LON_LAT]:pb,[q.SPHERICAL_ECEF]:jBe,[q.SPHERICAL_MARS_PCPF]:null,[q.SPHERICAL_MOON_PCPF]:null,[q.UNKNOWN]:null,[q.WEB_MERCATOR]:HBe,[q.PLATE_CARREE]:Ei,[q.WGS84]:pb,[q.WGS84_ECEF]:qBe}};function FZ(t,e,r=UZ()){return t==null||e==null?null:X_e(t,e,r).projector}function X_e(t,e,r){if(t==null||e==null||r.source.spatialReference===t&&r.dest.spatialReference===e)return r;const i=zf(t,r.source),s=zf(e,r.dest);return i===q.UNKNOWN&&s===q.UNKNOWN?Rn(t,e)?r.projector=Ei:r.projector=null:r.projector=gh[i][s],r}function UZ(){return{source:{spatialReference:null,spatialReferenceId:q.UNKNOWN,metersPerUnit:1},dest:{spatialReference:null,spatialReferenceId:q.UNKNOWN,metersPerUnit:1},projector:Ei}}const hE={spatialReference:null,spatialReferenceId:q.UNKNOWN},Y_e={spatialReference:null,spatialReferenceId:q.UNKNOWN},kZ=UZ(),ZBe=UZ(),Hd=Dt(1),p2=qa(1),ts=C(),Pd=C(),wy=C(),Fr=C(),aM=C(),HCt=Object.freeze(Object.defineProperty({__proto__:null,canProjectToWGS84ComparableLonLat:$_,canProjectWithoutEngine:Vf,computeENUToSphericalPCPFLocalRotation:DZ,computeSphericalPCPFToENULocalRotation:V_e,computeTranslationToOriginAndRotation:Tl,getProjectorName:IBe,getTransformation:A_e,getTransformations:RBe,initializeProjection:R_e,isLoaded:y5,load:NO,localLinearScaleFactors:zBe,lonLatToSphericalPCPF:j_e,lonLatToWebMercatorComparable:v5,project:Lw,projectBoundingRect:qR,projectBoundingSphere:VBe,projectBuffer:oi,projectDirection:kBe,projectExtent:FBe,projectMany:R7,projectMultipoint:$Be,projectOrLoad:OBe,projectOrLoadMany:C_e,projectPoint:P_e,projectPointToVector:wo,projectPointToWGS84ComparableLonLat:F_e,projectPolygon:L_e,projectPolygonToWGS84ComparableLonLat:NBe,projectPolyline:LBe,projectPolylineToWGS84ComparableLonLat:DBe,projectVectorToDehydratedPoint:LZ,projectVectorToPoint:Ug,projectVectorToVector:Ws,projectVectorToWGS84ComparableLonLat:U_e,projectWithoutEngine:$Z,projectXYZToVector:P7,sphericalPCPFtoLonLatElevation:b5,test:MBe,tryProjectWithZConversion:O_e,unload:PBe},Symbol.toStringTag,{value:"Module"}));async function XBe(t){const e=t.spatialReference;if(e.isWGS84)return t.clone();if(e.isWebMercator)return zC(t);const r=je.WGS84;return await R_e(e,r),Lw(t,r)}function qCt(t,e){if(!J_e(t,e)){const r=t.typeKeywords;r?r.push(e):t.typeKeywords=[e]}}function J_e(t,e){return!!t.typeKeywords?.includes(e)}function WCt(t){return J_e(t,YBe.HOSTED_SERVICE)}function ZCt(t,e){const r=t.typeKeywords;if(r){const i=r.indexOf(e);i>-1&&r.splice(i,1)}}async function XCt(t){const e=t.clone().normalize();let r;if(e.length>1)for(const i of e)r?i.width>r.width&&(r=i):r=i;else r=e[0];return XBe(r)}const YBe={DEVELOPER_BASEMAP:"DeveloperBasemap",JSAPI:"ArcGIS API for JavaScript",METADATA:"Metadata",MULTI_LAYER:"Multilayer",SINGLE_LAYER:"Singlelayer",TABLE:"Table",HOSTED_SERVICE:"Hosted Service"};function Ate(t){const{portal:e,isOrgItem:r,itemControl:i}=t,s=e.user?.privileges;let n=!s||s.includes("features:user:edit"),o=!!r&&!!s?.includes("features:user:fullEdit");const a=i==="update"||i==="admin";return a?o=n=!0:o&&(n=!0),{features:{edit:n,fullEdit:o},content:{updateItem:a}}}const Q_e=t=>{let e=class extends t{constructor(){super(...arguments),this.resourceReferences={portalItem:null,paths:[]},this.userHasEditingPrivileges=!0,this.userHasFullEditingPrivileges=!1,this.userHasUpdateItemPrivileges=!1}destroy(){this.portalItem=Me(this.portalItem),this.resourceReferences.portalItem=null,this.resourceReferences.paths.length=0}set portalItem(r){r!==this._get("portalItem")&&(this.removeOrigin("portal-item"),this._set("portalItem",r))}readPortalItem(r,i,s){if(i.itemId)return new Ab({id:i.itemId,portal:s&&s.portal})}writePortalItem(r,i){r&&r.id&&(i.itemId=r.id)}async loadFromPortal(r,i){if(this.portalItem&&this.portalItem.id)try{const{load:s}=await ae(()=>import("./layersLoader-85ab12d6.js"),["./layersLoader-85ab12d6.js","./fetchService-c1f8267d.js","./jsonContext-b0a6edd6.js"],import.meta.url);return Xt(i),await s({instance:this,supportedTypes:r.supportedTypes,validateItem:r.validateItem,supportsData:r.supportsData,layerModuleTypeMap:r.layerModuleTypeMap},i)}catch(s){throw ms(s)||Q.getLogger(this).warn(`Failed to load layer (${this.title}, ${this.id}) portal item (${this.portalItem.id})
  ${s}`),s}}async finishLoadEditablePortalLayer(r){this._set("userHasEditingPrivileges",await this._fetchUserHasEditingPrivileges(r).catch(i=>(Lo(i),!0)))}async _setUserPrivileges(r,i){if(!Ur.userPrivilegesApplied)return this.finishLoadEditablePortalLayer(i);if(this.url)try{const{features:{edit:s,fullEdit:n},content:{updateItem:o}}=await this._fetchUserPrivileges(r,i);this._set("userHasEditingPrivileges",s),this._set("userHasFullEditingPrivileges",n),this._set("userHasUpdateItemPrivileges",o)}catch(s){Lo(s)}}async _fetchUserPrivileges(r,i){let s=this.portalItem;if(!r||!s||!s.loaded||s.sourceUrl)return this._fetchFallbackUserPrivileges(i);const n=r===s.id;if(n&&s.portal.user)return Ate(s);let o,a;if(n)o=s.portal.url;else try{o=await mye(this.url,i)}catch(p){Lo(p)}if(!o||!jMe(o,s.portal.url))return this._fetchFallbackUserPrivileges(i);try{const p=i!=null?i.signal:null;a=await Gt?.getCredential(`${o}/sharing`,{prompt:!1,signal:p})}catch(p){Lo(p)}const l=!0,c=!1,h=!1;if(!a)return{features:{edit:l,fullEdit:c},content:{updateItem:h}};try{if(n?await s.reload():(s=new Ab({id:r,portal:{url:o}}),await s.load(i)),s.portal.user)return Ate(s)}catch(p){Lo(p)}return{features:{edit:l,fullEdit:c},content:{updateItem:h}}}async _fetchFallbackUserPrivileges(r){let i=!0;try{i=await this._fetchUserHasEditingPrivileges(r)}catch(s){Lo(s)}return{features:{edit:i,fullEdit:!1},content:{updateItem:!1}}}async _fetchUserHasEditingPrivileges(r){const i=this.url?Gt?.findCredential(this.url):null;if(!i)return!0;const s=lM.credential===i?lM.user:await this._fetchEditingUser(r);return lM.credential=i,lM.user=s,s==null||s.privileges==null||s.privileges.includes("features:user:edit")}async _fetchEditingUser(r){const i=this.portalItem?.portal?.user;if(i)return i;const s=Gt.findServerInfo(this.url??"");if(!s?.owningSystemUrl)return null;const n=`${s.owningSystemUrl}/sharing/rest`,o=Qn.getDefault();if(o&&o.loaded&&vh(o.restUrl)===vh(n))return o.user;const a=`${n}/community/self`,l=r!=null?r.signal:null,c=await gu(qt(a,{authMode:"no-prompt",query:{f:"json"},signal:l}));return c.ok?jW.fromJSON(c.value.data):null}read(r,i){i&&(i.layer=this),super.read(r,i)}write(r,i){const s=i&&i.portal,n=this.portalItem&&this.portalItem.id&&(this.portalItem.portal||Qn.getDefault());return s&&n&&!Ude(n.restUrl,s.restUrl)?(i.messages&&i.messages.push(new F("layer:cross-portal",`The layer '${this.title} (${this.id})' cannot be persisted because it refers to an item on a different portal than the one being saved to. To save, set layer.portalItem to null or save to the same portal as the item associated with the layer`,{layer:this})),null):super.write(r,{...i,layer:this})}};return u([d({type:Ab})],e.prototype,"portalItem",null),u([Ee("web-document","portalItem",["itemId"])],e.prototype,"readPortalItem",null),u([Fe("web-document","portalItem",{itemId:{type:String}})],e.prototype,"writePortalItem",null),u([d({clonable:!1})],e.prototype,"resourceReferences",void 0),u([d({type:Boolean,readOnly:!0})],e.prototype,"userHasEditingPrivileges",void 0),u([d({type:Boolean,readOnly:!0})],e.prototype,"userHasFullEditingPrivileges",void 0),u([d({type:Boolean,readOnly:!0})],e.prototype,"userHasUpdateItemPrivileges",void 0),e=u([R("esri.layers.mixins.PortalLayer")],e),e},lM={credential:null,user:null};let SA=class extends Te{constructor(){super(...arguments),this.updating=!1,this.status="unknown"}};u([d()],SA.prototype,"updating",void 0),u([d()],SA.prototype,"status",void 0),SA=u([R("esri.layers.support.PublishingInfo")],SA);const JBe=SA,K_e="esri.layers.mixins.PublishableLayer",QBe=Symbol(K_e),KBe=t=>{var e;let r=class extends t{constructor(){super(...arguments),this[e]=!0}get publishingInfo(){if(this.destroyed)return null;const i=this._get("publishingInfo");if(i)return i;const s=new JBe;return this._checkPublishingStatus(s),s}_checkPublishingStatus(i){let o=0;const a=async c=>{let h;i.updating=!0;try{h=await this.fetchPublishingStatus()}catch{h="unavailable"}h!=="published"&&h!=="unavailable"||(i.status==="publishing"&&this.refresh(),l.remove()),i.status=h,i.updating=!1,l.removed||(o=setTimeout(a,c,c+125))},l={removed:!1,remove(){this.removed=!0,clearTimeout(o)}};this.when().catch(()=>l.remove()),a(250),this.own(l)}};return e=QBe,u([d({readOnly:!0,clonable:!1})],r.prototype,"publishingInfo",null),r=u([R(K_e)],r),r},FO=new Pt,L3=new WeakMap;function e7e(t){eve(t)&&FO.push(t)}function t7e(t){eve(t)&&FO.includes(t)&&FO.remove(t)}function eve(t){return t!=null&&typeof t=="object"&&"refreshInterval"in t&&"refresh"in t}function tve(t,e){return Number.isFinite(t)&&Number.isFinite(e)?e<=0?t:tve(e,t%e):0}let IU=0,cM=0;function r7e(){const t=Date.now();for(const e of FO)e.refreshInterval&&t-(L3.get(e)??0)+5>=6e4*e.refreshInterval&&(L3.set(e,t),e.refresh(t))}_pe(()=>{const t=Date.now();let e=0;for(const r of FO)e=tve(Math.round(6e4*r.refreshInterval),e),r.refreshInterval?L3.get(r)||L3.set(r,t):L3.delete(r);if(e!==cM){if(cM=e,clearInterval(IU),cM===0)return void(IU=0);IU=setInterval(r7e,cM)}});function i7e(t){return t!=null&&typeof t=="object"&&"refreshTimestamp"in t&&"refresh"in t}const s7e=t=>{let e=class extends t{constructor(...r){super(...r),this.refreshInterval=0,this.refreshTimestamp=0,this._debounceHasDataChanged=xq(()=>this.hasDataChanged()),this.when().then(()=>{this.destroyed||e7e(this)},()=>{})}destroy(){t7e(this)}get refreshParameters(){return{_ts:this.refreshTimestamp||null}}refresh(r=Date.now()){qk(this._debounceHasDataChanged()).then(i=>{i&&this._set("refreshTimestamp",r),this.emit("refresh",{dataChanged:i})},i=>{Q.getLogger(this).error(i),this.emit("refresh",{dataChanged:!1,error:i})})}async hasDataChanged(){return!0}};return u([d({type:Number,cast:r=>r>=.1?r:r<=0?0:.1,json:{write:!0}})],e.prototype,"refreshInterval",void 0),u([d({readOnly:!0})],e.prototype,"refreshTimestamp",void 0),u([d()],e.prototype,"refreshParameters",null),e=u([R("esri.layers.mixins.RefreshableLayer")],e),e},rve=t=>{let e=class extends t{constructor(){super(...arguments),this.minScale=0,this.maxScale=0}get effectiveScaleRange(){const r={minScale:this.minScale,maxScale:this.maxScale},i=this.parent;i&&"effectiveScaleRange"in i&&n7e(r,i.effectiveScaleRange);const s=this._get("effectiveScaleRange");return s&&s.minScale===r.minScale&&s.maxScale===r.maxScale?s:r}};return u([d({type:Number,nonNullable:!0,json:{write:!0}})],e.prototype,"minScale",void 0),u([d({type:Number,nonNullable:!0,json:{write:!0}})],e.prototype,"maxScale",void 0),u([d({readOnly:!0})],e.prototype,"effectiveScaleRange",null),e=u([R("esri.layers.mixins.ScaleRangeLayer")],e),e};function n7e(t,e){return t.minScale=t.minScale>0?e.minScale>0?Math.min(t.minScale,e.minScale):t.minScale:e.minScale,t.maxScale=t.maxScale>0?e.maxScale>0?Math.max(t.maxScale,e.maxScale):t.maxScale:e.maxScale,t}const ive=Wa()({esriTimeUnitsMilliseconds:"milliseconds",esriTimeUnitsSeconds:"seconds",esriTimeUnitsMinutes:"minutes",esriTimeUnitsHours:"hours",esriTimeUnitsDays:"days",esriTimeUnitsWeeks:"weeks",esriTimeUnitsMonths:"months",esriTimeUnitsYears:"years",esriTimeUnitsDecades:"decades",esriTimeUnitsCenturies:"centuries",esriTimeUnitsUnknown:void 0});let EA=class extends Vi(de){constructor(e){super(e),this.unit="milliseconds",this.value=0}toMilliseconds(){return vVe(this.value,this.unit,"milliseconds")}};u([tt(ive,{nonNullable:!0})],EA.prototype,"unit",void 0),u([d({type:Number,json:{write:!0},nonNullable:!0})],EA.prototype,"value",void 0),EA=u([R("esri.TimeInterval")],EA);const DN=EA;function Ote(t,e){return DN.fromJSON({value:t,unit:e})}let Aa=class extends Vi(de){constructor(e){super(e),this.cumulative=!1,this.endField=null,this.fullTimeExtent=null,this.hasLiveData=!1,this.interval=null,this.startField=null,this.timeReference=null,this.trackIdField=null,this.useTime=!0}readFullTimeExtent(e,r){if(!r.timeExtent||!Array.isArray(r.timeExtent)||r.timeExtent.length!==2)return null;const i=new Date(r.timeExtent[0]),s=new Date(r.timeExtent[1]);return new rm({start:i,end:s})}writeFullTimeExtent(e,r){e&&e.start!=null&&e.end!=null?r.timeExtent=[e.start.getTime(),e.end.getTime()]:r.timeExtent=null}readInterval(e,r){return r.timeInterval&&r.timeIntervalUnits?Ote(r.timeInterval,r.timeIntervalUnits):r.defaultTimeInterval&&r.defaultTimeIntervalUnits?Ote(r.defaultTimeInterval,r.defaultTimeIntervalUnits):null}writeInterval(e,r){r.timeInterval=e?.toJSON().value??null,r.timeIntervalUnits=e?.toJSON().unit??null}};u([d({type:Boolean,json:{name:"exportOptions.timeDataCumulative",write:!0}})],Aa.prototype,"cumulative",void 0),u([d({type:String,json:{name:"endTimeField",write:{enabled:!0,allowNull:!0}}})],Aa.prototype,"endField",void 0),u([d({type:rm,json:{write:{enabled:!0,allowNull:!0}}})],Aa.prototype,"fullTimeExtent",void 0),u([Ee("fullTimeExtent",["timeExtent"])],Aa.prototype,"readFullTimeExtent",null),u([Fe("fullTimeExtent")],Aa.prototype,"writeFullTimeExtent",null),u([d({type:Boolean,json:{write:!0}})],Aa.prototype,"hasLiveData",void 0),u([d({type:DN,json:{write:{enabled:!0,allowNull:!0}}})],Aa.prototype,"interval",void 0),u([Ee("interval",["timeInterval","timeIntervalUnits","defaultTimeInterval","defaultTimeIntervalUnits"])],Aa.prototype,"readInterval",null),u([Fe("interval")],Aa.prototype,"writeInterval",null),u([d({type:String,json:{name:"startTimeField",write:{enabled:!0,allowNull:!0}}})],Aa.prototype,"startField",void 0),u([d({type:d2,json:{write:{enabled:!0,allowNull:!0}}})],Aa.prototype,"timeReference",void 0),u([d({type:String,json:{write:{enabled:!0,allowNull:!0}}})],Aa.prototype,"trackIdField",void 0),u([d({type:Boolean,json:{name:"exportOptions.useTime",write:!0}})],Aa.prototype,"useTime",void 0),Aa=u([R("esri.layers.support.TimeInfo")],Aa);const sve=Aa,o7e=t=>{let e=class extends t{constructor(){super(...arguments),this.timeExtent=null,this.timeOffset=null,this.useViewTime=!0}readOffset(r,i){const s=i.timeInfo.exportOptions;if(!s)return null;const n=s.timeOffset,o=ive.fromJSON(s.timeOffsetUnits);return n&&o?new DN({value:n,unit:o}):null}set timeInfo(r){Kfe(r,this.fieldsIndex),this._set("timeInfo",r)}};return u([d({type:rm,json:{write:!1}})],e.prototype,"timeExtent",void 0),u([d({type:DN})],e.prototype,"timeOffset",void 0),u([Ee("service","timeOffset",["timeInfo.exportOptions"])],e.prototype,"readOffset",null),u([d({value:null,type:sve,json:{write:!0,origins:{"web-document":{read:!1,write:!1},"portal-item":{read:!1,write:!1}}}})],e.prototype,"timeInfo",null),u([d({type:Boolean,json:{read:{source:"timeAnimation"},write:{target:"timeAnimation"},origins:{"web-scene":{read:!1,write:!1}}}})],e.prototype,"useViewTime",void 0),e=u([R("esri.layers.mixins.TemporalLayer")],e),e},Rte=new Rr({esriFeatureEditToolAutoCompletePolygon:"auto-complete-polygon",esriFeatureEditToolCircle:"circle",esriFeatureEditToolEllipse:"ellipse",esriFeatureEditToolFreehand:"freehand",esriFeatureEditToolLine:"line",esriFeatureEditToolNone:"none",esriFeatureEditToolPoint:"point",esriFeatureEditToolPolygon:"polygon",esriFeatureEditToolRectangle:"rectangle",esriFeatureEditToolArrow:"arrow",esriFeatureEditToolTriangle:"triangle",esriFeatureEditToolLeftArrow:"left-arrow",esriFeatureEditToolRightArrow:"right-arrow",esriFeatureEditToolUpArrow:"up-arrow",esriFeatureEditToolDownArrow:"down-arrow"});let c0=class extends Vi(de){constructor(e){super(e),this.name=null,this.description=null,this.drawingTool=null,this.prototype=null,this.thumbnail=null}};u([d({json:{write:!0}})],c0.prototype,"name",void 0),u([d({json:{write:!0}})],c0.prototype,"description",void 0),u([d({json:{read:Rte.read,write:Rte.write}})],c0.prototype,"drawingTool",void 0),u([d({json:{write:!0}})],c0.prototype,"prototype",void 0),u([d({json:{write:!0}})],c0.prototype,"thumbnail",void 0),c0=u([R("esri.layers.support.FeatureTemplate")],c0);const VZ=c0;let zm=class extends Vi(de){constructor(e){super(e),this.id=null,this.name=null,this.domains=null,this.templates=null}readDomains(e){const r={};for(const i of Object.keys(e))r[i]=JW(e[i]);return r}writeDomains(e,r){const i={};for(const s of Object.keys(e))e[s]&&(i[s]=e[s]?.toJSON());r.domains=i}};u([d({json:{write:!0}})],zm.prototype,"id",void 0),u([d({json:{write:!0}})],zm.prototype,"name",void 0),u([d({json:{write:!0}})],zm.prototype,"domains",void 0),u([Ee("domains")],zm.prototype,"readDomains",null),u([Fe("domains")],zm.prototype,"writeDomains",null),u([d({type:[VZ],json:{write:!0}})],zm.prototype,"templates",void 0),zm=u([R("esri.layers.support.FeatureType")],zm);const nve=zm;function ove(){return{fields:{type:[n5],value:null},fieldsIndex:{readOnly:!0,get(){return new aZ(this.fields||[])}},outFields:{type:[String],json:{read:!1},set:function(t){this._userOutFields=t,this.notifyChange("outFields")},get:function(){const t=this._userOutFields;if(!t||!t.length)return null;if(t.includes("*"))return["*"];if(!this.fields)return t;for(const e of t)this.fieldsIndex?.has(e)||Q.getLogger("esri.layers.support.fieldProperties").error("field-attributes-layer:invalid-field",`Invalid field ${e} found in outFields`,{layer:this,outFields:t});return IF(this.fieldsIndex,t)}}}}const $U=Q.getLogger("esri.layers.support.labelingInfo"),a7e=/\[([^\[\]]+)\]/gi;function NN(t,e,r){return t?t.map(i=>{const s=new HR;if(s.read(i,r),s.labelExpression){const n=e.fields||e.layerDefinition&&e.layerDefinition.fields||this.fields;s.labelExpression=s.labelExpression.replaceAll(a7e,(o,a)=>`[${l7e(a,n)}]`)}return s}):null}function l7e(t,e){if(!e)return t;const r=t.toLowerCase();for(let i=0;i<e.length;i++){const s=e[i].name;if(s.toLowerCase()===r)return s}return t}const c7e={esriGeometryPoint:["above-right","above-center","above-left","center-center","center-left","center-right","below-center","below-left","below-right"],esriGeometryPolygon:["always-horizontal"],esriGeometryPolyline:["center-along"],esriGeometryMultipoint:null};function tAt(t,e){const r=K(t);return r.some(i=>u7e(i,e))?[]:r}function u7e(t,e){const r=t.labelPlacement,i=c7e[e];if(!t.symbol)return $U.warn("No ILabelClass symbol specified."),!0;if(!i)return $U.error(new F("labeling:unsupported-geometry-type",`Unable to create labels for layer, geometry type '${e}' is not supported`)),!0;if(!i.includes(r)){const s=i[0];r&&$U.warn(`Found invalid label placement type ${r} for ${e}. Defaulting to ${s}`),t.labelPlacement=s}return!1}const gd=[];function h7e(t,e){if(tZ(t.url??""))return!0;const{wkid:r}=e;for(const i of gd){if((t.version??0)>=i[0])return!0;if(typeof i[1]=="function"&&(i[1]=i[1]()),i[1].has(r))return!1}return!0}gd.push([10.91,()=>{const t=new Set([9709,9716,9741,9761,9766]);for(let e=9712;e<=9713;e++)t.add(e);for(let e=9748;e<=9749;e++)t.add(e);for(let e=20904;e<=20932;e++)t.add(e);for(let e=21004;e<=21032;e++)t.add(e);for(let e=21207;e<=21264;e++)t.add(e);for(let e=21307;e<=21364;e++)t.add(e);for(let e=102759;e<=102760;e++)t.add(e);for(let e=102901;e<=102955;e++)t.add(e);return t}]),gd.push([10.9,()=>{const t=new Set([9300,9354,9364,9367,9373,9377,9387,9456,9473,9498,9678,9680,29874,103599,103872,104028]);for(let e=9356;e<=9360;e++)t.add(e);for(let e=9404;e<=9407;e++)t.add(e);for(let e=9476;e<=9482;e++)t.add(e);for(let e=9487;e<=9494;e++)t.add(e);for(let e=9697;e<=9699;e++)t.add(e);return t}]),gd.push([10.81,()=>{const t=new Set([9265,9333,103598,103699]);for(let e=9248;e<=9254;e++)t.add(e);for(let e=9271;e<=9273;e++)t.add(e);for(let e=9284;e<=9285;e++)t.add(e);for(let e=21453;e<=21463;e++)t.add(e);return t}]),gd.push([10.8,()=>{const t=new Set([8088,8395,8428,8433,8531,8687,8692,8694,8699,8900,9003,9006,9009,9012,9017,9191]);for(let e=8035;e<=8036;e++)t.add(e);for(let e=8455;e<=8456;e++)t.add(e);for(let e=8518;e<=8529;e++)t.add(e);for(let e=8533;e<=8536;e++)t.add(e);for(let e=8538;e<=8540;e++)t.add(e);for(let e=8677;e<=8679;e++)t.add(e);for(let e=8902;e<=8903;e++)t.add(e);for(let e=8907;e<=8910;e++)t.add(e);for(let e=8949;e<=8951;e++)t.add(e);for(let e=8972;e<=8987;e++)t.add(e);for(let e=9039;e<=9040;e++)t.add(e);for(let e=9068;e<=9069;e++)t.add(e);for(let e=9140;e<=9141;e++)t.add(e);for(let e=9148;e<=9150;e++)t.add(e);for(let e=9153;e<=9159;e++)t.add(e);for(let e=9205;e<=9218;e++)t.add(e);for(let e=9221;e<=9222;e++)t.add(e);for(let e=54098;e<=54101;e++)t.add(e);return t}]),gd.push([10.71,()=>{const t=new Set([6316]);for(let e=8351;e<=8353;e++)t.add(e);for(let e=9294;e<=9297;e++)t.add(e);for(let e=22619;e<=22621;e++)t.add(e);for(let e=103586;e<=103594;e++)t.add(e);return t}]),gd.push([10.7,()=>{const t=new Set([8387,8391,8427,8545,8682,8685,8818,31370,104022,104024,104975]);for(let e=8065;e<=8068;e++)t.add(e);for(let e=8082;e<=8083;e++)t.add(e);for(let e=8379;e<=8385;e++)t.add(e);for(let e=8836;e<=8840;e++)t.add(e);for(let e=8857;e<=8860;e++)t.add(e);for(let e=53035;e<=53037;e++)t.add(e);for(let e=54090;e<=54091;e++)t.add(e);for(let e=102498;e<=102499;e++)t.add(e);return t}]),gd.push([10.61,()=>new Set([102497])]),gd.push([10.6,()=>{const t=new Set([7803,7805,7887,8086,8232,8237,8240,8246,8249,8252,8255,9019,9391]);for(let e=7755;e<=7787;e++)t.add(e);for(let e=7791;e<=7795;e++)t.add(e);for(let e=7799;e<=7801;e++)t.add(e);for(let e=7825;e<=7831;e++)t.add(e);for(let e=7877;e<=7878;e++)t.add(e);for(let e=7882;e<=7883;e++)t.add(e);for(let e=7991;e<=7992;e++)t.add(e);for(let e=8042;e<=8043;e++)t.add(e);for(let e=8058;e<=8059;e++)t.add(e);for(let e=8311;e<=8348;e++)t.add(e);for(let e=9060;e<=9067;e++)t.add(e);for(let e=102562;e<=102568;e++)t.add(e);for(let e=102799;e<=102900;e++)t.add(e);return t}]),gd.push([10.51,()=>{const t=new Set([7683,7881,7886,7899,8888,9e3]);for(let e=8013;e<=8032;e++)t.add(e);for(let e=9053;e<=9057;e++)t.add(e);for(let e=104017;e<=104018;e++)t.add(e);for(let e=104971;e<=104974;e++)t.add(e);return t}]),gd.push([10.5,()=>{const t=new Set([6962,7035,7037,7039,7041,7084,7086,7133,7798,102399]);for(let e=4087;e<=4088;e++)t.add(e);for(let e=5896;e<=5899;e++)t.add(e);for(let e=7005;e<=7007;e++)t.add(e);for(let e=7057;e<=7070;e++)t.add(e);for(let e=7073;e<=7082;e++)t.add(e);for(let e=7109;e<=7128;e++)t.add(e);for(let e=7844;e<=7859;e++)t.add(e);return t}]);async function ave(t,e,r){const i=t&&t.getAtOrigin&&t.getAtOrigin("renderer",e.origin);if(i&&i.type==="unique-value"&&i.styleOrigin){const s=await gu(i.populateFromStyle());if(Xt(r),s.ok===!1){const n=s.error;e&&e.messages&&e.messages.push(new Sh("renderer:style-reference",`Failed to create unique value renderer from style reference: ${n.message}`,{error:n,context:e})),t.clear("renderer",e?.origin)}}}var D7;let OT=D7=class extends de{constructor(t){super(t),this.groupByFields=void 0,this.topCount=void 0,this.orderByFields=void 0}clone(){return new D7({groupByFields:this.groupByFields,topCount:this.topCount,orderByFields:this.orderByFields})}};u([d({type:[String],json:{write:!0}})],OT.prototype,"groupByFields",void 0),u([d({type:Number,json:{write:!0}})],OT.prototype,"topCount",void 0),u([d({type:[String],json:{write:!0}})],OT.prototype,"orderByFields",void 0),OT=D7=u([R("esri.rest.support.TopFilter")],OT);const d7e=OT;var N7;const Pte=new Rr({esriSpatialRelIntersects:"intersects",esriSpatialRelContains:"contains",esriSpatialRelCrosses:"crosses",esriSpatialRelDisjoint:"disjoint",esriSpatialRelEnvelopeIntersects:"envelope-intersects",esriSpatialRelIndexIntersects:"index-intersects",esriSpatialRelOverlaps:"overlaps",esriSpatialRelTouches:"touches",esriSpatialRelWithin:"within",esriSpatialRelRelation:"relation"}),Mte=new Rr({esriSRUnit_Meter:"meters",esriSRUnit_Kilometer:"kilometers",esriSRUnit_Foot:"feet",esriSRUnit_StatuteMile:"miles",esriSRUnit_NauticalMile:"nautical-miles",esriSRUnit_USNauticalMile:"us-nautical-miles"});let cs=N7=class extends de{constructor(t){super(t),this.cacheHint=void 0,this.distance=void 0,this.geometry=null,this.geometryPrecision=void 0,this.maxAllowableOffset=void 0,this.num=void 0,this.objectIds=null,this.orderByFields=null,this.outFields=null,this.outSpatialReference=null,this.resultType=null,this.returnGeometry=!1,this.returnM=void 0,this.returnZ=void 0,this.start=void 0,this.spatialRelationship="intersects",this.timeExtent=null,this.topFilter=void 0,this.units=null,this.where="1=1"}writeStart(t,e){e.resultOffset=this.start,e.resultRecordCount=this.num||10}clone(){return new N7(K({cacheHint:this.cacheHint,distance:this.distance,geometry:this.geometry,geometryPrecision:this.geometryPrecision,maxAllowableOffset:this.maxAllowableOffset,num:this.num,objectIds:this.objectIds,orderByFields:this.orderByFields,outFields:this.outFields,outSpatialReference:this.outSpatialReference,resultType:this.resultType,returnGeometry:this.returnGeometry,returnZ:this.returnZ,returnM:this.returnM,start:this.start,spatialRelationship:this.spatialRelationship,timeExtent:this.timeExtent,topFilter:this.topFilter,units:this.units,where:this.where}))}};u([d({type:Boolean,json:{write:!0}})],cs.prototype,"cacheHint",void 0),u([d({type:Number,json:{write:{overridePolicy:t=>({enabled:t>0})}}})],cs.prototype,"distance",void 0),u([d({types:Ew,json:{read:S_,write:!0}})],cs.prototype,"geometry",void 0),u([d({type:Number,json:{write:!0}})],cs.prototype,"geometryPrecision",void 0),u([d({type:Number,json:{write:!0}})],cs.prototype,"maxAllowableOffset",void 0),u([d({type:Number,json:{read:{source:"resultRecordCount"}}})],cs.prototype,"num",void 0),u([d({json:{write:!0}})],cs.prototype,"objectIds",void 0),u([d({type:[String],json:{write:!0}})],cs.prototype,"orderByFields",void 0),u([d({type:[String],json:{write:!0}})],cs.prototype,"outFields",void 0),u([d({type:je,json:{read:{source:"outSR"},write:{target:"outSR"}}})],cs.prototype,"outSpatialReference",void 0),u([d({type:String,json:{write:!0}})],cs.prototype,"resultType",void 0),u([d({json:{write:!0}})],cs.prototype,"returnGeometry",void 0),u([d({type:Boolean,json:{write:{overridePolicy:t=>({enabled:t})}}})],cs.prototype,"returnM",void 0),u([d({type:Boolean,json:{write:{overridePolicy:t=>({enabled:t})}}})],cs.prototype,"returnZ",void 0),u([d({type:Number,json:{read:{source:"resultOffset"}}})],cs.prototype,"start",void 0),u([Fe("start"),Fe("num")],cs.prototype,"writeStart",null),u([d({type:String,json:{read:{source:"spatialRel",reader:Pte.read},write:{target:"spatialRel",writer:Pte.write}}})],cs.prototype,"spatialRelationship",void 0),u([d({type:rm,json:{write:!0}})],cs.prototype,"timeExtent",void 0),u([d({type:d7e,json:{write:!0}})],cs.prototype,"topFilter",void 0),u([d({type:String,json:{read:Mte.read,write:{writer:Mte.write,overridePolicy(t){return{enabled:t!=null&&this.distance!=null&&this.distance>0}}}}})],cs.prototype,"units",void 0),u([d({type:String,json:{write:!0}})],cs.prototype,"where",void 0),cs=N7=u([R("esri.rest.support.TopFeaturesQuery")],cs),cs.from=Zs(cs);const uM=cs;function lve({displayField:t,editFieldsInfo:e,fields:r,objectIdField:i,title:s},n){if(!r)return null;const o=g7e({editFieldsInfo:e,fields:r,objectIdField:i},n);if(!o.length)return null;const a=v7e({titleBase:s,fields:r,displayField:t}),l=_7e();return new eE({title:a,content:l,fieldInfos:o})}const p7e=(t,e)=>e.visibleFieldNames?e.visibleFieldNames.has(t.name):HNe(t,e);function f7e(t,e){const r=t;return e&&(t=t.filter(i=>!e.includes(i.type))),t===r&&(t=t.slice()),t.sort(m7e),t}function m7e(t,e){return t.type==="oid"?-1:e.type==="oid"?1:Ite(t)?-1:Ite(e)?1:(t.alias||t.name).toLocaleLowerCase().localeCompare((e.alias||e.name).toLocaleLowerCase())}function g7e(t,e){const r=e?.visibleFieldNames;return f7e(t.fields??[],e?.ignoreFieldTypes||b7e).map(i=>new IW({fieldName:i.name,isEditable:jNe(i,t),label:i.alias,format:y7e(i),visible:p7e(i,{...t,visibleFieldNames:r})}))}function y7e(t){switch(t.type){case"small-integer":case"integer":case"single":return new GC({digitSeparator:!0,places:0});case"double":return new GC({digitSeparator:!0,places:2});case"date":return new GC({dateFormat:"long-month-day-year"});default:return t.type==="string"&&c4e(t.name)?new GC({digitSeparator:!0,places:0}):null}}function _7e(){return[new RO,new OO]}function v7e(t){const e=$Ne(t),{titleBase:r}=t;return e?`${r}: {${e.trim()}}`:r??""}function Ite(t){return(t.name&&t.name.toLowerCase())==="name"?!0:(t.alias&&t.alias.toLowerCase())==="name"}const b7e=["geometry","blob","raster","guid","xml"],Qa="FeatureLayer",cve="esri.layers.FeatureLayer",w7e=Q.getLogger(cve);function hM(t,e){return new F("layer:unsupported",`Layer (${t.title}, ${t.id}) of type '${t.declaredClass}' ${e}`,{layer:t})}function $te(t){return t&&t instanceof Pt}const LU=ove();function DU(t,e,r){const i=!!r?.writeLayerSchema;return{enabled:i,ignoreOrigin:i}}let ht=class extends Sze(fBe(PVe(KBe(Y0e(mVe(_Be(o7e(rve(s7e(S0e(__e(Q_e(fZ(gVe(T0e(Vi(mZ))))))))))))))))){constructor(...e){super(...e),this._handles=new Oi,this.charts=null,this.copyright=null,this.displayField=null,this.dynamicDataSource=null,this.fields=null,this.fieldsIndex=null,this.formTemplate=null,this.fullExtent=null,this.geometryType=null,this.hasM=void 0,this.hasZ=void 0,this.infoFor3D=null,this.isTable=!1,this.labelsVisible=!0,this.labelingInfo=null,this.legendEnabled=!0,this.objectIdField=null,this.outFields=null,this.path=null,this.popupEnabled=!0,this.popupTemplate=null,this.screenSizePerspectiveEnabled=!0,this.spatialReference=je.WGS84,this.subtypeCode=null,this.templates=null,this.timeInfo=null,this.title=null,this.sublayerTitleMode="item-title",this.type="feature",this.typeIdField=null,this.types=null,this.visible=!0}destroy(){this.source?.destroy(),this._handles=Me(this._handles)}normalizeCtorArgs(e,r){return typeof e=="string"?{url:e,...r}:e}load(e){const r=e!=null?e.signal:null;if(this.portalItem?.loaded&&this.source)return this.addResolvingPromise(this.createGraphicsSource(r).then(s=>this.initLayerProperties(s))),Promise.resolve(this);const i=this.loadFromPortal({supportedTypes:["Feature Service","Feature Collection"]},e).catch(Lo).then(async()=>{if(this.url&&this.layerId==null&&/FeatureServer|MapServer\/*$/i.test(this.url)){const s=await this._fetchFirstLayerId(r);s!=null&&(this.layerId=s)}if(!this.url&&!this._hasMemorySource())throw new F("feature-layer:missing-url-or-source","Feature layer must be created with either a url or a source");return this.initLayerProperties(await this.createGraphicsSource(r))}).then(()=>this._setUserPrivileges(this.serviceItemId,e)).then(()=>lze(this,e));return this.addResolvingPromise(i),Promise.resolve(this)}readCapabilities(e,r){return r=r.layerDefinition||r,c_e(r,this.url)}get createQueryVersion(){return this.commitProperty("definitionExpression"),this.commitProperty("dynamicDataSource"),this.commitProperty("timeExtent"),this.commitProperty("timeOffset"),this.commitProperty("geometryType"),this.commitProperty("gdbVersion"),this.commitProperty("historicMoment"),this.commitProperty("returnZ"),this.commitProperty("capabilities"),this.commitProperty("returnM"),(this._get("createQueryVersion")??0)+1}get editingEnabled(){return!(this.loaded&&!this.capabilities?.operations.supportsEditing)&&(this._isOverridden("editingEnabled")?this._get("editingEnabled"):this._hasMemorySource()||this.userHasEditingPrivileges)}set editingEnabled(e){this._overrideIfSome("editingEnabled",e)}readEditingEnabled(e,r){return this._readEditingEnabled(r,!1)}readEditingEnabledFromWebMap(e,r,i){return this._readEditingEnabled(r,!0,i)}writeEditingEnabled(e,r){this._writeEditingEnabled(e,r,!1)}writeEditingEnabledToWebMap(e,r,i,s){this._writeEditingEnabled(e,r,!0,s)}get effectiveEditingEnabled(){return uze(this)}readIsTable(e,r){return(r=r?.layerDefinition??r).type==="Table"||!r.geometryType}writeIsTable(e,r,i,s){s?.writeLayerSchema&&Ha(i,e?"Table":"Feature Layer",r)}readGlobalIdField(e,r){return n_e(r.layerDefinition||r)}readObjectIdField(e,r){return o_e(r.layerDefinition||r)}get parsedUrl(){const e=cn(this.url);return e!=null&&(this.dynamicDataSource!=null?e.path=bc(e.path,"dynamicLayer"):this.layerId!=null&&(e.path=bc(e.path,this.layerId.toString()))),e}get defaultPopupTemplate(){return this.createPopupTemplate()}set renderer(e){oN(e,this.fieldsIndex),this._set("renderer",e)}readRenderer(e,r,i){r=r.layerDefinition||r;const s=r.drawingInfo?.renderer;if(s){const n=$O(s,r,i)??void 0;return n||w7e.error("Failed to create renderer",{rendererDefinition:r.drawingInfo.renderer,layer:this,context:i}),n}return CZ(r,i)}set source(e){const r=this._get("source");r!==e&&($te(r)&&this._resetMemorySource(r),$te(e)&&this._initMemorySource(e),this._set("source",e))}castSource(e){return e?Array.isArray(e)||e instanceof Pt?new Km({layer:this,items:e}):e:null}readSource(e,r){const i=w0e.fromJSON(r.featureSet);return new Km({layer:this,items:i?.features??[]})}readTemplates(e,r){const i=r.editFieldsInfo,s=i&&i.creatorField,n=i&&i.editorField;return e=e&&e.map(o=>VZ.fromJSON(o)),this._fixTemplates(e,s),this._fixTemplates(e,n),e}readTitle(e,r){const i=r.layerDefinition?.name??r.name,s=r.title||r.layerDefinition&&r.layerDefinition.title;if(i){const n=this.portalItem&&this.portalItem.title;if(this.sublayerTitleMode==="item-title")return this.url?Rye(this.url,i):i;let o=i;if(!o&&this.url){const a=Iw(this.url);a!=null&&(o=a.title)}return o?(this.sublayerTitleMode==="item-title-and-service-name"&&n&&n!==o&&(o=n+" - "+o),e5(o)):void 0}if(this.sublayerTitleMode==="item-title"&&s)return s}readTitleFromWebMap(e,r){return r.title||r.layerDefinition&&r.layerDefinition.name}readTypeIdField(e,r){let i=(r=r.layerDefinition||r).typeIdField;if(i&&r.fields){i=i.toLowerCase();const s=r.fields.find(n=>n.name.toLowerCase()===i);s&&(i=s.name)}return i}readTypes(e,r){e=(r=r.layerDefinition||r).types;const i=r.editFieldsInfo,s=i&&i.creatorField,n=i&&i.editorField;return e&&e.map(o=>(o=nve.fromJSON(o),this._fixTemplates(o.templates,s),this._fixTemplates(o.templates,n),o))}readVisible(e,r){return r.layerDefinition&&r.layerDefinition.defaultVisibility!=null?!!r.layerDefinition.defaultVisibility:r.visibility!=null?!!r.visibility:void 0}async addAttachment(e,r){return qVe(this,e,r,Qa)}async updateAttachment(e,r,i){return WVe(this,e,r,i,Qa)}async applyEdits(e,r){return ZVe(this,e,r)}async uploadAssets(e,r){return XVe(this,e,r)}on(e,r){return super.on(e,r)}createPopupTemplate(e){return lve(this,e)}async createGraphicsSource(e){if(this._hasMemorySource()&&this.source)return this.source.load({signal:e});const{default:r}=await Mde(ae(()=>import("./FeatureLayerSource-89f5abdb.js"),["./FeatureLayerSource-89f5abdb.js","./MeshGeoreferencedRelativeVertexSpace-4cbafb45.js","./External-2117cdfc.js","./editingSupport-9c55cbd4.js","./normalizeUtils-996b11fe.js","./normalizeUtilsCommon-4aa2ad72.js","./clientSideDefaults-8aeb911a.js","./QueryEngineCapabilities-42e44ded.js","./QueryTask-16c5d630.js","./executeForIds-78f0bfd3.js","./query-2b60d096.js","./pbfQueryUtils-93c2b136.js","./pbf-725ddaf6.js","./executeQueryJSON-3a003e36.js","./executeQueryPBF-a010945f.js"],import.meta.url),e);return new r({layer:this}).load({signal:e})}createQuery(){const e=nze(this);e.dynamicDataSource=this.dynamicDataSource;const r=this.subtypeCode!=null?`${this.subtypeField} = ${this.subtypeCode}`:null,i=I9e(this.definitionExpression,r);return e.where=i||"1=1",e}async deleteAttachments(e,r){return YVe(this,e,r,Qa)}async fetchRecomputedExtents(e){return JVe(this,e,Qa)}getFeatureType(e){const{typeIdField:r,types:i}=this;if(!r||!e)return null;const s=e.attributes?e.attributes[r]:void 0;if(s==null)return null;let n=null;return i?.some(o=>{const{id:a}=o;return a!=null&&(a.toString()===s.toString()&&(n=o),!!n)}),n}getFieldDomain(e,r){const i=r?.feature,s=this.getFeatureType(i);if(s){const n=s.domains&&s.domains[e];if(n&&n.type!=="inherited")return n}return this._getLayerDomain(e)}getField(e){return this.fieldsIndex.get(e)}async queryAttachments(e,r){return QVe(this,e,r,Qa)}async queryFeatures(e,r){const i=await this.load(),s=await i.source.queryFeatures(Y_.from(e)??i.createQuery(),r);if(s?.features)for(const n of s.features)n.layer=n.sourceLayer=i;return s}async queryObjectIds(e,r){return KVe(this,e,r,Qa)}async queryFeatureCount(e,r){return eze(this,e,r,Qa)}async queryExtent(e,r){return tze(this,e,r,Qa)}async queryRelatedFeatures(e,r){return rze(this,e,r,Qa)}async queryRelatedFeaturesCount(e,r){return ize(this,e,r,Qa)}async queryTopFeatures(e,r){const{source:i,capabilities:s}=await this.load();if(!i.queryTopFeatures||!s?.query?.supportsTopFeaturesQuery)throw new F(Qa,"Layer source does not support queryTopFeatures capability");const n=await i.queryTopFeatures(uM.from(e),r);if(n?.features)for(const o of n.features)o.layer=o.sourceLayer=this;return n}async queryTopObjectIds(e,r){const{source:i,capabilities:s}=await this.load();if(!i.queryTopObjectIds||!s?.query.supportsTopFeaturesQuery)throw new F(Qa,"Layer source does not support queryTopObjectIds capability");return i.queryTopObjectIds(uM.from(e),r)}async queryTopFeaturesExtent(e,r){const{source:i,capabilities:s}=await this.load();if(!i.queryTopExtents||!s?.query?.supportsTopFeaturesQuery)throw new F(Qa,"Layer source does not support queryTopExtents capability");return i.queryTopExtents(uM.from(e),r)}async queryTopFeatureCount(e,r){const{source:i,capabilities:s}=await this.load();if(!i.queryTopCount||!s?.query?.supportsTopFeaturesQuery)throw new F(Qa,"Layer source does not support queryFeatureCount capability");return i.queryTopCount(uM.from(e),r)}read(e,r){const i=e.featureCollection;if(i){const s=i.layers;s&&s.length===1&&(super.read(s[0],r),i.showLegend!=null&&super.read({showLegend:i.showLegend},r))}super.read(e,r),r&&r.origin==="service"&&(this.revert(["objectIdField","fields","timeInfo"],"service"),this.spatialReference||this.revert(["spatialReference"],"service"))}write(e,r){r={...r,origin:r?.origin??void 0,writeLayerSchema:r?.writeLayerSchema??this._hasMemorySource()};const{origin:i,layerContainerType:s,messages:n}=r;if(this.dynamicDataSource)return n?.push(hM(this,"using a dynamic data source cannot be written to web scenes, web maps and feature service items")),null;if(this.isTable){if(i==="web-scene"||i==="web-map"&&s!=="tables")return n?.push(hM(this,"using a table source cannot be written to web scenes and web maps")),null;if(this._hasMemorySource())return n?.push(hM(this,"using an in-memory table source cannot be written to web scenes and web maps")),null}else if(this.loaded&&i==="web-map"&&s==="tables")return n?.push(hM(this,"using a non-table source cannot be written to tables in web maps")),null;return super.write(e,r)}clone(){if(this._hasMemorySource())throw new F(Qa,`FeatureLayer (title: ${this.title}, id: ${this.id}) created using in-memory source cannot be cloned`);return super.clone()}serviceSupportsSpatialReference(e){return!!this.loaded&&(this.source?.type==="memory"||h7e(this,e))}async save(e){const{save:r}=await ae(()=>import("./featureLayerUtils-e0897210.js"),["./featureLayerUtils-e0897210.js","./fetchService-c1f8267d.js","./jsonContext-b0a6edd6.js"],import.meta.url);return r(this,e)}async saveAs(e,r){const{saveAs:i}=await ae(()=>import("./featureLayerUtils-e0897210.js"),["./featureLayerUtils-e0897210.js","./fetchService-c1f8267d.js","./jsonContext-b0a6edd6.js"],import.meta.url);return i(this,e,r)}_readEditingEnabled(e,r,i){let s=e.layerDefinition?.capabilities;return s?this._hasEditingCapability(s):(s=e.capabilities,r&&i?.origin==="web-map"&&!this._hasMemorySource()&&s?this._hasEditingCapability(s):void 0)}_hasEditingCapability(e){return e.toLowerCase().split(",").map(r=>r.trim()).includes("editing")}_writeEditingEnabled(e,r,i,s){if(!e){const n=this.capabilities?.operations?.supportsSync?"Query,Sync":"Query";Ha("layerDefinition.capabilities",n,r),i&&!s?.writeLayerSchema&&(r.capabilities=n)}}_getLayerDomain(e){const r=this.fieldsIndex.get(e);return r?r.domain:null}_fetchFirstLayerId(e){return qt(this.url,{query:{f:"json",...this.customParameters,token:this.apiKey},responseType:"json",signal:e}).then(r=>{const i=r.data;if(i)return Array.isArray(i.layers)&&i.layers.length>0?i.layers[0].id:Array.isArray(i.tables)&&i.tables.length>0?i.tables[0].id:void 0})}async initLayerProperties(e){return this._set("source",e),e.sourceJSON&&(this.sourceJSON=e.sourceJSON,this.read(e.sourceJSON,{origin:"service",portalItem:this.portalItem,portal:this.portalItem?.portal,url:this.parsedUrl})),this._verifySource(),this._verifyFields(),oN(this.renderer,this.fieldsIndex),Kfe(this.timeInfo,this.fieldsIndex),ave(this,{origin:"service"})}async hasDataChanged(){return sze(this)}async fetchPublishingStatus(){const e=this.source;return e?.fetchPublishingStatus?e.fetchPublishingStatus():"unavailable"}_verifyFields(){const e=this.parsedUrl?.path??"undefined";this.objectIdField||console.log("FeatureLayer: 'objectIdField' property is not defined (url: "+e+")"),this.isTable||this._hasMemorySource()||e.search(/\/FeatureServer\//i)!==-1||this.fields?.some(r=>r.type==="geometry")||console.log("FeatureLayer: unable to find field of type 'geometry' in the layer 'fields' list. If you are using a map service layer, features will not have geometry (url: "+e+")")}_fixTemplates(e,r){e&&e.forEach(i=>{const s=i.prototype&&i.prototype.attributes;s&&r&&delete s[r]})}_verifySource(){if(this._hasMemorySource()){if(this.url)throw new F("feature-layer:mixed-source-and-url","FeatureLayer cannot be created with both an in-memory source and a url")}else if(!this.url)throw new F("feature-layer:source-or-url-required","FeatureLayer requires either a url, a valid portal item or a source")}_initMemorySource(e){e.forEach(r=>{r.layer=this,r.sourceLayer=this}),this._handles.add([e.on("after-add",r=>{r.item.layer=this,r.item.sourceLayer=this}),e.on("after-remove",r=>{r.item.layer=null,r.item.sourceLayer=null})],"fl-source")}_resetMemorySource(e){e.forEach(r=>{r.layer=null,r.sourceLayer=null}),this._handles.remove("fl-source")}_hasMemorySource(){return!(this.url||!this.source)}};u([Ee("service","capabilities")],ht.prototype,"readCapabilities",null),u([d({json:{origins:{"portal-item":{write:!0},"web-map":{write:!0}}}})],ht.prototype,"charts",void 0),u([d({readOnly:!0})],ht.prototype,"createQueryVersion",null),u([d({json:{read:{source:"layerDefinition.copyrightText"}}})],ht.prototype,"copyright",void 0),u([d({json:{read:{source:"layerDefinition.displayField"}}})],ht.prototype,"displayField",void 0),u([d({types:Eb,readOnly:!0})],ht.prototype,"defaultSymbol",void 0),u([d({type:$d})],ht.prototype,"dynamicDataSource",void 0),u([d({type:Boolean})],ht.prototype,"editingEnabled",null),u([Ee(["portal-item","web-scene"],"editingEnabled",["layerDefinition.capabilities"])],ht.prototype,"readEditingEnabled",null),u([Ee("web-map","editingEnabled",["capabilities","layerDefinition.capabilities"])],ht.prototype,"readEditingEnabledFromWebMap",null),u([Fe(["portal-item","web-scene"],"editingEnabled",{"layerDefinition.capabilities":{type:String}})],ht.prototype,"writeEditingEnabled",null),u([Fe("web-map","editingEnabled",{capabilities:{type:String},"layerDefinition.capabilities":{type:String}})],ht.prototype,"writeEditingEnabledToWebMap",null),u([d({readOnly:!0})],ht.prototype,"effectiveEditingEnabled",null),u([d({...LU.fields,json:{read:{source:"layerDefinition.fields"},origins:{service:{name:"fields"},"web-map":{write:{target:"layerDefinition.fields",overridePolicy:DU}}}}})],ht.prototype,"fields",void 0),u([d(LU.fieldsIndex)],ht.prototype,"fieldsIndex",void 0),u([d({type:i8e,json:{name:"formInfo",write:!0,origins:{"web-scene":{read:!1,write:!1}}}})],ht.prototype,"formTemplate",void 0),u([d({json:{read:{source:"layerDefinition.extent"}}})],ht.prototype,"fullExtent",void 0),u([d({json:{origins:{"web-map":{write:{target:"layerDefinition.geometryType",overridePolicy:DU,writer(t,e,r){const i=t?c7.toJSON(t):null;i&&Ha(r,i,e)}}}},read:{source:"layerDefinition.geometryType",reader:c7.read}}})],ht.prototype,"geometryType",void 0),u([d({json:{read:{source:"layerDefinition.hasM"}}})],ht.prototype,"hasM",void 0),u([d({json:{read:{source:"layerDefinition.hasZ"}}})],ht.prototype,"hasZ",void 0),u([d(i_e)],ht.prototype,"id",void 0),u([d({readOnly:!0,json:{origins:{service:{read:!0}},read:!1}})],ht.prototype,"infoFor3D",void 0),u([d({json:{origins:{"web-map":{write:{target:"layerDefinition.type"}}}}})],ht.prototype,"isTable",void 0),u([Ee("service","isTable",["type","geometryType"]),Ee("isTable",["layerDefinition.type","layerDefinition.geometryType"])],ht.prototype,"readIsTable",null),u([Fe("web-map","isTable")],ht.prototype,"writeIsTable",null),u([d(p5)],ht.prototype,"labelsVisible",void 0),u([d({type:[HR],json:{origins:{service:{read:{source:"drawingInfo.labelingInfo",reader:NN},write:{target:"drawingInfo.labelingInfo",enabled:!1}}},read:{source:"layerDefinition.drawingInfo.labelingInfo",reader:NN},write:{target:"layerDefinition.drawingInfo.labelingInfo"}}})],ht.prototype,"labelingInfo",void 0),u([d((()=>{const t=K(kVe);return t.json.origins["portal-item"]={write:{target:"layerDefinition.drawingInfo.transparency",writer(e,r,i){Ha(i,jF(e),r)}}},t})())],ht.prototype,"opacity",void 0),u([d(e_e)],ht.prototype,"legendEnabled",void 0),u([d({type:["show","hide"],json:(()=>{const t=K(s_e.json);return t.origins["portal-item"]={read:!1,write:!1},t})()})],ht.prototype,"listMode",void 0),u([Ee("globalIdField",["layerDefinition.globalIdField","layerDefinition.fields"])],ht.prototype,"readGlobalIdField",null),u([d({json:{origins:{"web-map":{write:{target:"layerDefinition.objectIdField",overridePolicy:DU}}}}})],ht.prototype,"objectIdField",void 0),u([Ee("objectIdField",["layerDefinition.objectIdField","layerDefinition.fields"])],ht.prototype,"readObjectIdField",null),u([d({value:"ArcGISFeatureLayer",type:["ArcGISFeatureLayer"]})],ht.prototype,"operationalLayerType",void 0),u([d(LU.outFields)],ht.prototype,"outFields",void 0),u([d({readOnly:!0})],ht.prototype,"parsedUrl",null),u([d({type:String,json:{origins:{"web-scene":{read:!0,write:!0}},read:!1}})],ht.prototype,"path",void 0),u([d(d5)],ht.prototype,"popupEnabled",void 0),u([d({type:eE,json:{name:"popupInfo",write:!0}})],ht.prototype,"popupTemplate",void 0),u([d({readOnly:!0})],ht.prototype,"defaultPopupTemplate",null),u([d({types:s5,json:{origins:{service:{write:{target:"drawingInfo.renderer",enabled:!1}},"web-scene":{types:p0e,name:"layerDefinition.drawingInfo.renderer",write:{overridePolicy:(t,e,r)=>({ignoreOrigin:r?.writeLayerSchema})}}},write:{target:"layerDefinition.drawingInfo.renderer",overridePolicy:(t,e,r)=>({ignoreOrigin:r?.writeLayerSchema})}}})],ht.prototype,"renderer",null),u([Ee("service","renderer",["drawingInfo.renderer","defaultSymbol"]),Ee("renderer",["layerDefinition.drawingInfo.renderer","layerDefinition.defaultSymbol"])],ht.prototype,"readRenderer",null),u([d((()=>{const t=K(Q0e);return t.json.origins["portal-item"]={read:!1,write:!1},t})())],ht.prototype,"screenSizePerspectiveEnabled",void 0),u([d({clonable:!1})],ht.prototype,"source",null),u([yr("source")],ht.prototype,"castSource",null),u([Ee("portal-item","source",["featureSet"]),Ee("web-map","source",["featureSet"])],ht.prototype,"readSource",null),u([d({json:{read:{source:"layerDefinition.extent.spatialReference"}}})],ht.prototype,"spatialReference",void 0),u([d({type:Number})],ht.prototype,"subtypeCode",void 0),u([d({type:[VZ]})],ht.prototype,"templates",void 0),u([Ee("templates",["editFieldsInfo","creatorField","editorField","templates"])],ht.prototype,"readTemplates",null),u([d({type:sve})],ht.prototype,"timeInfo",void 0),u([d()],ht.prototype,"title",void 0),u([Ee("service","title",["name"]),Ee("portal-item","title",["layerDefinition.title","layerDefinition.name","title"])],ht.prototype,"readTitle",null),u([Ee("web-map","title",["layerDefinition.name","title"])],ht.prototype,"readTitleFromWebMap",null),u([d({type:String})],ht.prototype,"sublayerTitleMode",void 0),u([d({json:{read:!1}})],ht.prototype,"type",void 0),u([d({type:String})],ht.prototype,"typeIdField",void 0),u([Ee("service","typeIdField"),Ee("typeIdField",["layerDefinition.typeIdField"])],ht.prototype,"readTypeIdField",null),u([d({type:[nve]})],ht.prototype,"types",void 0),u([Ee("service","types",["types"]),Ee("types",["layerDefinition.types"])],ht.prototype,"readTypes",null),u([d({type:Boolean,json:{origins:{"portal-item":{write:{target:"layerDefinition.defaultVisibility"}}}}})],ht.prototype,"visible",void 0),u([Ee("portal-item","visible",["visibility","layerDefinition.defaultVisibility"])],ht.prototype,"readVisible",null),ht=u([R(cve)],ht);const F7=ht,iAt=Object.freeze(Object.defineProperty({__proto__:null,default:F7},Symbol.toStringTag,{value:"Module"}));function x7e(t){return typeof t=="function"}function sAt(t,e,r,i){return x7e(t)?t(e,r,i):t}function nAt(t){return[t.r,t.g,t.b,t.a]}const T7e=` /-,
`;function Lte(t){let e=t.length;for(;e--;)if(!T7e.includes(t.charAt(e)))return!1;return!0}function S7e(t,e){const r=[];let i=0,s=-1;do if(s=t.indexOf("[",i),s>=i){if(s>i){const n=t.substr(i,s-i);r.push([n,null,Lte(n)])}if(i=s+1,s=t.indexOf("]",i),s>=i){if(s>i){const n=e[t.substr(i,s-i)];n&&r.push([null,n,!1])}i=s+1}}while(s!==-1);if(i<t.length-1){const n=t.substr(i);r.push([n,null,Lte(n)])}return r}function E7e(t,e,r){let i="",s=null;for(const n of e){const[o,a,l]=n;if(o)l?s=o:(s&&(i+=s,s=null),i+=o);else{const c=t.attributes[a];c&&(s&&(i+=s,s=null),i+=c)}}return C7e(i,r)}function oAt(t,e,r){const i=S7e(e,t);return s=>E7e(s,i,r)}function C7e(t,e){switch(typeof t!="string"&&(t=String(t)),e){case"LowerCase":return t.toLowerCase();case"Allcaps":return t.toUpperCase();default:return t}}function aAt(t,e,r,i,s,n,o=!0){const a=e/s,l=r/n,c=Math.ceil(a/2),h=Math.ceil(l/2);for(let p=0;p<n;p++)for(let f=0;f<s;f++){const m=4*(f+(o?n-p-1:p)*s);let y=0,_=0,v=0,w=0,x=0,T=0,S=0;const O=(p+.5)*l;for(let A=Math.floor(p*l);A<(p+1)*l;A++){const I=Math.abs(O-(A+.5))/h,M=(f+.5)*a,k=I*I;for(let L=Math.floor(f*a);L<(f+1)*a;L++){let D=Math.abs(M-(L+.5))/c;const U=Math.sqrt(k+D*D);U>=-1&&U<=1&&(y=2*U*U*U-3*U*U+1,y>0&&(D=4*(L+A*e),S+=y*t[D+3],v+=y,t[D+3]<255&&(y=y*t[D+3]/250),w+=y*t[D],x+=y*t[D+1],T+=y*t[D+2],_+=y))}}i[m]=w/_,i[m+1]=x/_,i[m+2]=T/_,i[m+3]=S/v}}function uve(t){return t?{r:t[0],g:t[1],b:t[2],a:t[3]/255}:{r:0,g:0,b:0,a:0}}function hve(t){return t.data?.symbol??null}function U7(t){return t.type==="CIMVectorMarker"||t.type==="CIMPictureMarker"||t.type==="CIMBarChartMarker"||t.type==="CIMCharacterMarker"||t.type==="CIMPieChartMarker"||t.type==="CIMStackedBarChartMarker"}function k7(t){return t.type==="CIMGradientStroke"||t.type==="CIMPictureStroke"||t.type==="CIMSolidStroke"}function A7e(t){return t!=null&&(t.type==="CIMGradientFill"||t.type==="CIMHatchFill"||t.type==="CIMPictureFill"||t.type==="CIMSolidFill"||t.type==="CIMWaterFill")}function FN(t){return t!=null&&(t.type==="CIMMarkerPlacementAlongLineRandomSize"||t.type==="CIMMarkerPlacementAlongLineSameSize"||t.type==="CIMMarkerPlacementAlongLineVariableSize"||t.type==="CIMMarkerPlacementAtExtremities"||t.type==="CIMMarkerPlacementAtMeasuredUnits"||t.type==="CIMMarkerPlacementAtRatioPositions"||t.type==="CIMMarkerPlacementOnLine"||t.type==="CIMMarkerPlacementOnVertices")}const lAt=(t,e=0)=>t==null||isNaN(t)?e:t,cAt=t=>t.tintColor?uve(t.tintColor):{r:255,g:255,b:255,a:1},uAt=t=>{if(!t)return!1;for(const e of t)switch(e.type){case"CIMGeometricEffectBuffer":case"CIMGeometricEffectOffset":case"CIMGeometricEffectDonut":return!0}return!1};function hAt(){return ae(()=>import("./geometryEngineJSON-bd34207d.js"),["./geometryEngineJSON-bd34207d.js","./geometryEngineBase-d69ff1ad.js","./geometryEngineJSON-2c998778.js","./json-48e3ea08.js"],import.meta.url)}function dAt(t){if(!t)return"normal";switch(t.toLowerCase()){case"italic":return"italic";case"oblique":return"oblique";default:return"normal"}}function pAt(t){if(!t)return"normal";switch(t.toLowerCase()){case"bold":return"bold";case"bolder":return"bolder";case"lighter":return"lighter";default:return"normal"}}function fAt(t){let e="normal",r="normal";if(t){const i=t.toLowerCase();i.includes("italic")?e="italic":i.includes("oblique")&&(e="oblique"),i.includes("bold")?r="bold":i.includes("light")&&(r="lighter")}return{style:e,weight:r}}function mAt(t){return t.underline?"underline":t.strikethrough?"line-through":"none"}function Dte(t){if(!t)return null;switch(t.type){case"CIMPolygonSymbol":if(t.symbolLayers)for(const e of t.symbolLayers){const r=Dte(e);if(r!=null)return r}break;case"CIMTextSymbol":return Dte(t.symbol);case"CIMSolidFill":return t.color}}function Nte(t){if(t)switch(t.type){case"CIMPolygonSymbol":case"CIMLineSymbol":{const e=t.symbolLayers;if(e)for(const r of e){const i=Nte(r);if(i!=null)return i}break}case"CIMTextSymbol":return Nte(t.symbol);case"CIMSolidStroke":return t.color}}function Fte(t){if(t)switch(t.type){case"CIMPolygonSymbol":case"CIMLineSymbol":if(t.symbolLayers)for(const e of t.symbolLayers){const r=Fte(e);if(r!==void 0)return r}break;case"CIMTextSymbol":return Fte(t.symbol);case"CIMSolidStroke":case"CIMGradientStroke":case"CIMPictureStroke":return t.width}}function gAt(t){switch(t){case"Left":default:return"left";case"Right":return"right";case"Center":case"Justify":return"center"}}function yAt(t){switch(t){case"Top":default:return"top";case"Center":return"middle";case"Baseline":return"baseline";case"Bottom":return"bottom"}}function _At(t){return(t?Object.keys(t):[]).map(e=>({name:e,alias:e,type:typeof t[e]=="string"?"esriFieldTypeString":"esriFieldTypeDouble"}))}const vAt=t=>t.includes("data:image/svg+xml");function bAt(t){if(!t)return null;switch(t.type){case"CIMPointSymbol":case"CIMTextSymbol":return"esriGeometryPoint";case"CIMLineSymbol":return"esriGeometryPolyline";case"CIMPolygonSymbol":return"esriGeometryPolygon";default:return null}}function dve(t,e,r,i){if(t)if(t.type!=="CIMTextSymbol"){if(r&&t.effects)for(const s of t.effects)P7e(s,e);if(t.symbolLayers)for(const s of t.symbolLayers)switch(s.type){case"CIMPictureMarker":case"CIMVectorMarker":O7e(s,e,i);break;case"CIMPictureStroke":case"CIMSolidStroke":!i?.preserveOutlineWidth&&s.width&&(s.width*=e);break;case"CIMPictureFill":s.height&&(s.height*=e),s.offsetX&&(s.offsetX*=e),s.offsetY&&(s.offsetY*=e);break;case"CIMHatchFill":dve(s.lineSymbol,e,!0,{...i,preserveOutlineWidth:!1}),s.offsetX&&(s.offsetX*=e),s.offsetY&&(s.offsetY*=e),s.separation&&(s.separation*=e)}}else t.height!=null&&(t.height*=e)}function O7e(t,e,r){if(t&&(t.markerPlacement&&R7e(t.markerPlacement,e),t.offsetX&&(t.offsetX*=e),t.offsetY&&(t.offsetY*=e),t.anchorPoint&&t.anchorPointUnits==="Absolute"&&(t.anchorPoint={x:t.anchorPoint.x*e,y:t.anchorPoint.y*e}),t.size=t.size!=null?t.size*e:0,t.type==="CIMVectorMarker"&&t.markerGraphics))for(const i of t.markerGraphics)t.scaleSymbolsProportionally||dve(i.symbol,e,!0,r)}function R7e(t,e){switch(FN(t)&&t.offset&&(t.offset*=e),t.type){case"CIMMarkerPlacementAlongLineRandomSize":case"CIMMarkerPlacementAlongLineSameSize":if(t.customEndingOffset&&(t.customEndingOffset*=e),t.offsetAlongLine&&(t.offsetAlongLine*=e),t.placementTemplate&&t.placementTemplate.length){const r=t.placementTemplate.map(i=>i*e);t.placementTemplate=r}break;case"CIMMarkerPlacementAlongLineVariableSize":if(t.maxRandomOffset&&(t.maxRandomOffset*=e),t.placementTemplate&&t.placementTemplate.length){const r=t.placementTemplate.map(i=>i*e);t.placementTemplate=r}break;case"CIMMarkerPlacementOnLine":t.startPointOffset&&(t.startPointOffset*=e);break;case"CIMMarkerPlacementAtExtremities":t.offsetAlongLine&&(t.offsetAlongLine*=e);break;case"CIMMarkerPlacementAtMeasuredUnits":case"CIMMarkerPlacementOnVertices":break;case"CIMMarkerPlacementAtRatioPositions":t.beginPosition&&(t.beginPosition*=e),t.endPosition&&(t.endPosition*=e);break;case"CIMMarkerPlacementPolygonCenter":t.offsetX&&(t.offsetX*=e),t.offsetY&&(t.offsetY*=e);break;case"CIMMarkerPlacementInsidePolygon":t.offsetX&&(t.offsetX*=e),t.offsetY&&(t.offsetY*=e),t.stepX&&(t.stepX*=e),t.stepY&&(t.stepY*=e)}}function P7e(t,e){switch(t.type){case"CIMGeometricEffectArrow":case"CIMGeometricEffectDonut":t.width&&(t.width*=e);break;case"CIMGeometricEffectBuffer":t.size&&(t.size*=e);break;case"CIMGeometricEffectCut":t.beginCut&&(t.beginCut*=e),t.endCut&&(t.endCut*=e),t.middleCut&&(t.middleCut*=e);break;case"CIMGeometricEffectDashes":if(t.customEndingOffset&&(t.customEndingOffset*=e),t.offsetAlongLine&&(t.offsetAlongLine*=e),t.dashTemplate&&t.dashTemplate.length){const r=t.dashTemplate.map(i=>i*e);t.dashTemplate=r}break;case"CIMGeometricEffectExtension":case"CIMGeometricEffectJog":case"CIMGeometricEffectRadial":t.length&&(t.length*=e);break;case"CIMGeometricEffectMove":t.offsetX&&(t.offsetX*=e),t.offsetY&&(t.offsetY*=e);break;case"CIMGeometricEffectOffset":case"CIMGeometricEffectOffsetTangent":t.offset&&(t.offset*=e);break;case"CIMGeometricEffectRegularPolygon":t.radius&&(t.radius*=e);break;case"CIMGeometricEffectTaperedPolygon":t.fromWidth&&(t.fromWidth*=e),t.length&&(t.length*=e),t.toWidth&&(t.toWidth*=e);break;case"CIMGeometricEffectWave":t.amplitude&&(t.amplitude*=e),t.period&&(t.period*=e)}}function pve(t){const e=[];return V7(hve(t),e),e.length?new ze(uve(e[0])):null}function V7(t,e){if(!t)return;let r;r=t.type==="CIMTextSymbol"?t.symbol:t;const i=t.type==="CIMPolygonSymbol";if(r?.symbolLayers){for(const s of r.symbolLayers)if(!(s.colorLocked||i&&(k7(s)||U7(s)&&s.markerPlacement&&FN(s.markerPlacement))))switch(s.type){case"CIMPictureMarker":case"CIMPictureStroke":case"CIMPictureFill":s.tintColor&&Ute(e,s.tintColor);break;case"CIMVectorMarker":s.markerGraphics?.forEach(n=>{V7(n.symbol,e)});break;case"CIMSolidStroke":case"CIMSolidFill":Ute(e,s.color);break;case"CIMHatchFill":V7(s.lineSymbol,e)}}}function Ute(t,e){for(const r of t)if(r.join(".")===e.join("."))return;t.push(e)}function wAt(t,e,r){e instanceof ze||(e=new ze(e));const i=hve(t);i&&z7(i,e,r)}function z7(t,e,r){if(!t)return;let i;i=t.type==="CIMTextSymbol"?t.symbol:t;const s=i?.type==="CIMPolygonSymbol";if(i?.symbolLayers)for(const n of i.symbolLayers){if(n.colorLocked)continue;if(s){if(r){const{layersToColor:a}=r;if((k7(n)||U7(n)&&n.markerPlacement&&FN(n.markerPlacement))&&a==="fill"||A7e(n)&&a==="outline")continue}else if(k7(n)||U7(n)&&n.markerPlacement&&FN(n.markerPlacement))continue}const o=e.toArray();switch(n.type){case"CIMPictureMarker":case"CIMPictureStroke":case"CIMPictureFill":n.tintColor=o;break;case"CIMVectorMarker":n.markerGraphics?.forEach(a=>{z7(a.symbol,e,r)});break;case"CIMSolidStroke":case"CIMSolidFill":n.color=o;break;case"CIMHatchFill":z7(n.lineSymbol,e,r)}}}const fve="picture-fill",mve="simple-fill",M7e="simple-line",gve="simple-marker",I7e="text",$7e="cim",NU=new Yye(1e3);function xAt(t){const e=t.style;let r=null;if(t)switch(t.type){case gve:e!=="cross"&&e!=="x"&&(r=t.color);break;case mve:e==="solid"?r=t.color:e!=="none"&&(r={type:"pattern",x:0,y:0,src:kr(`esri/symbols/patterns/${e}.png`),width:5,height:5});break;case fve:r={type:"pattern",src:t.url,width:Ms(t.width)*t.xscale,height:Ms(t.height)*t.yscale,x:Ms(t.xoffset),y:Ms(t.yoffset)};break;case I7e:r=t.color;break;case $7e:r=pve(t)}return r}function TAt(t,e){const r=t+"-"+e;return NU.get(r)!==void 0?Promise.resolve(NU.get(r)):qt(t,{responseType:"image"}).then(i=>{const s=i.data,n=s.naturalWidth,o=s.naturalHeight,a=document.createElement("canvas");a.width=n,a.height=o;const l=a.getContext("2d");l.fillStyle=e,l.fillRect(0,0,n,o),l.globalCompositeOperation="destination-in",l.drawImage(s,0,0);const c=a.toDataURL();return NU.put(r,c),c})}function yve(t){if(!t)return null;let e=null;switch(t.type){case mve:case fve:case gve:e=yve(t.outline);break;case M7e:{const r=Ms(t.width);t.style!=null&&t.style!=="none"&&r!==0&&(e={color:t.color,style:L7e(t.style),width:r,cap:t.cap,join:t.join==="miter"?Ms(t.miterLimit):t.join});break}default:e=null}return e}const L7e=(()=>{const t={};return e=>{if(t[e])return t[e];const r=e.replaceAll("-","");return t[e]=r,r}})(),SAt=new ze([128,128,128]);function _ve(){const t=new Float32Array(6);return t[0]=1,t[3]=1,t}function D7e(t){const e=new Float32Array(6);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e}function N7e(t,e,r,i,s,n){const o=new Float32Array(6);return o[0]=t,o[1]=e,o[2]=r,o[3]=i,o[4]=s,o[5]=n,o}function F7e(t,e){return new Float32Array(t,e,6)}function vve(t,e,r,i){const s=e[i],n=e[i+1];t[i]=r[0]*s+r[2]*n+r[4],t[i+1]=r[1]*s+r[3]*n+r[5]}function U7e(t,e,r,i=0,s=0,n=2){const o=s||e.length/n;for(let a=i;a<o;a++)vve(t,e,r,a*n)}Object.freeze(Object.defineProperty({__proto__:null,clone:D7e,create:_ve,createView:F7e,fromValues:N7e,transform:vve,transformMany:U7e},Symbol.toStringTag,{value:"Module"}));function k7e(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t}function V7e(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=1,t[4]=0,t[5]=0,t}function z7e(t,e,r,i,s,n,o){return t[0]=e,t[1]=r,t[2]=i,t[3]=s,t[4]=n,t[5]=o,t}function bve(t,e){const r=e[0],i=e[1],s=e[2],n=e[3],o=e[4],a=e[5];let l=r*n-i*s;return l?(l=1/l,t[0]=n*l,t[1]=-i*l,t[2]=-s*l,t[3]=r*l,t[4]=(s*a-n*o)*l,t[5]=(i*o-r*a)*l,t):null}function B7e(t){return t[0]*t[3]-t[1]*t[2]}function wve(t,e,r){const i=e[0],s=e[1],n=e[2],o=e[3],a=e[4],l=e[5],c=r[0],h=r[1],p=r[2],f=r[3],m=r[4],y=r[5];return t[0]=i*c+n*h,t[1]=s*c+o*h,t[2]=i*p+n*f,t[3]=s*p+o*f,t[4]=i*m+n*y+a,t[5]=s*m+o*y+l,t}function zZ(t,e,r){const i=e[0],s=e[1],n=e[2],o=e[3],a=e[4],l=e[5],c=Math.sin(r),h=Math.cos(r);return t[0]=i*h+n*c,t[1]=s*h+o*c,t[2]=i*-c+n*h,t[3]=s*-c+o*h,t[4]=a,t[5]=l,t}function xve(t,e,r){const i=e[0],s=e[1],n=e[2],o=e[3],a=e[4],l=e[5],c=r[0],h=r[1];return t[0]=i*c,t[1]=s*c,t[2]=n*h,t[3]=o*h,t[4]=a,t[5]=l,t}function BZ(t,e,r){const i=e[0],s=e[1],n=e[2],o=e[3],a=e[4],l=e[5],c=r[0],h=r[1];return t[0]=i,t[1]=s,t[2]=n,t[3]=o,t[4]=i*c+n*h+a,t[5]=s*c+o*h+l,t}function G7e(t,e){const r=Math.sin(e),i=Math.cos(e);return t[0]=i,t[1]=r,t[2]=-r,t[3]=i,t[4]=0,t[5]=0,t}function j7e(t,e){return t[0]=e[0],t[1]=0,t[2]=0,t[3]=e[1],t[4]=0,t[5]=0,t}function GZ(t,e){return t[0]=1,t[1]=0,t[2]=0,t[3]=1,t[4]=e[0],t[5]=e[1],t}function H7e(t){return"mat2d("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+", "+t[4]+", "+t[5]+")"}function q7e(t){return Math.sqrt(t[0]**2+t[1]**2+t[2]**2+t[3]**2+t[4]**2+t[5]**2+1)}function W7e(t,e,r){return t[0]=e[0]+r[0],t[1]=e[1]+r[1],t[2]=e[2]+r[2],t[3]=e[3]+r[3],t[4]=e[4]+r[4],t[5]=e[5]+r[5],t}function Tve(t,e,r){return t[0]=e[0]-r[0],t[1]=e[1]-r[1],t[2]=e[2]-r[2],t[3]=e[3]-r[3],t[4]=e[4]-r[4],t[5]=e[5]-r[5],t}function Z7e(t,e,r){return t[0]=e[0]*r,t[1]=e[1]*r,t[2]=e[2]*r,t[3]=e[3]*r,t[4]=e[4]*r,t[5]=e[5]*r,t}function X7e(t,e,r,i){return t[0]=e[0]+r[0]*i,t[1]=e[1]+r[1]*i,t[2]=e[2]+r[2]*i,t[3]=e[3]+r[3]*i,t[4]=e[4]+r[4]*i,t[5]=e[5]+r[5]*i,t}function Y7e(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]&&t[4]===e[4]&&t[5]===e[5]}function J7e(t,e){const r=t[0],i=t[1],s=t[2],n=t[3],o=t[4],a=t[5],l=e[0],c=e[1],h=e[2],p=e[3],f=e[4],m=e[5],y=Xa();return Math.abs(r-l)<=y*Math.max(1,Math.abs(r),Math.abs(l))&&Math.abs(i-c)<=y*Math.max(1,Math.abs(i),Math.abs(c))&&Math.abs(s-h)<=y*Math.max(1,Math.abs(s),Math.abs(h))&&Math.abs(n-p)<=y*Math.max(1,Math.abs(n),Math.abs(p))&&Math.abs(o-f)<=y*Math.max(1,Math.abs(o),Math.abs(f))&&Math.abs(a-m)<=y*Math.max(1,Math.abs(a),Math.abs(m))}const Q7e=wve,K7e=Tve;Object.freeze(Object.defineProperty({__proto__:null,add:W7e,copy:k7e,determinant:B7e,equals:J7e,exactEquals:Y7e,frob:q7e,fromRotation:G7e,fromScaling:j7e,fromTranslation:GZ,identity:V7e,invert:bve,mul:Q7e,multiply:wve,multiplyScalar:Z7e,multiplyScalarAndAdd:X7e,rotate:zZ,scale:xve,set:z7e,str:H7e,sub:K7e,subtract:Tve,translate:BZ},Symbol.toStringTag,{value:"Module"}));const eGe=new ze("white");function tGe(t){const e=t.symbolLayers?.at(-1);if(e&&"outline"in e)return e?.outline?.size}function EAt(t){if(!t)return 0;if(R_(t)){const e=tGe(t);return e??0}return fu(yve(t)?.width)}function CAt(t){if(t==null||!("symbolLayers"in t)||t.symbolLayers==null)return!1;switch(t.type){case"point-3d":return t.symbolLayers.some(e=>e.type==="object");case"line-3d":return t.symbolLayers.some(e=>e.type==="path");case"polygon-3d":return t.symbolLayers.some(e=>e.type==="object"||e.type==="extrude");default:return!1}}function rGe(t){return rc(t.resource).href}function AAt(t,e){if(!t)return null;let r=null;return R_(t)?r=iGe(t):QF(t)&&(r=t.type==="cim"?pve(t):t.color?new ze(t.color):null),r?UO(r,e):null}function iGe(t){const e=t.symbolLayers;if(!e)return null;let r=null;return e.forEach(i=>{i.type==="object"&&i.resource?.href||(r=i.type==="water"?i.color:i.material?i.material.color:null)}),r?new ze(r):null}function UO(t,e){if(e==null||t==null)return t;const r=t.toRgba();return r[3]=r[3]*e,new ze(r)}function sGe(t,e,r){const i=t.symbolLayers;if(!i)return;const s=n=>UO(e=e??n??(r!=null?eGe:null),r);i.forEach(n=>{if(n.type!=="object"||!n.resource?.href||e)if(n.type==="water")n.color=s(n.color);else{const o=n.material!=null?n.material.color:null,a=s(o);n.material==null?n.material=new lu({color:a}):n.material.color=a,r!=null&&"outline"in n&&n.outline!=null&&n.outline.color!=null&&(n.outline.color=UO(n.outline.color,r))}})}function nGe(t,e,r){(e=e??t.color)&&(t.color=UO(e,r)),r!=null&&"outline"in t&&t.outline&&t.outline.color&&(t.outline.color=UO(t.outline.color,r))}function OAt(t,e,r){t&&(e||r!=null)&&(e&&(e=new ze(e)),R_(t)?sGe(t,e,r):QF(t)&&nGe(t,e,r))}async function oGe(t,e){const r=t.symbolLayers;r&&await g5(r,async i=>aGe(i,e))}async function aGe(t,e){switch(t.type){case"extrude":cGe(t,e);break;case"icon":case"line":case"text":lGe(t,e);break;case"path":hGe(t,e);break;case"object":await uGe(t,e)}}function lGe(t,e){const r=Sve(e);r!=null&&(t.size=r)}function Sve(t){for(const e of t)if(typeof e=="number")return e;return null}function cGe(t,e){t.size=typeof e[2]=="number"?e[2]:0}async function uGe(t,e){const{resourceSize:r,symbolSize:i}=await dGe(t),s=Eve(e,r,i);t.width=D3(e[0],i[0],r[0],s),t.depth=D3(e[1],i[1],r[1],s),t.height=D3(e[2],i[2],r[2],s)}function hGe(t,e){const r=Eve(e,fg,[t.width,void 0,t.height]);t.width=D3(e[0],t.width,1,r),t.height=D3(e[2],t.height,1,r)}function Eve(t,e,r){for(let i=0;i<3;i++){const s=t[i];switch(s){case"symbol-value":{const n=r[i];return n!=null?n/e[i]:1}case"proportional":break;default:if(s&&e[i])return s/e[i]}}return 1}async function dGe(t){const{computeObjectLayerResourceSize:e}=await ae(()=>import("./symbolLayerUtils-dcdca8a5.js"),[],import.meta.url),r=await e(t,10),{width:i,height:s,depth:n}=t,o=[i,n,s];let a=1;for(let l=0;l<3;l++){const c=o[l];if(c!=null){a=c/r[l];break}}for(let l=0;l<3;l++)o[l]==null&&(o[l]=r[l]*a);return{resourceSize:r,symbolSize:o}}function D3(t,e,r,i){switch(t){case"proportional":return r*i;case"symbol-value":return e??r;default:return t}}function pGe(t,e){const r=Sve(e);if(r!=null)switch(t.type){case"simple-marker":t.size=r;break;case"picture-marker":{const i=t.width/t.height;i>1?(t.width=r,t.height=r*i):(t.width=r*i,t.height=r);break}case"simple-line":t.width=r;break;case"text":t.font.size=r}}async function RAt(t,e){if(t&&e)return R_(t)?oGe(t,e):void(QF(t)&&pGe(t,e))}function PAt(t,e,r){if(t&&e!=null)if(R_(t)){const i=t.symbolLayers;i&&i.forEach(s=>{if(s&&s.type==="object")switch(r){case"tilt":s.tilt=e;break;case"roll":s.roll=e;break;default:s.heading=e}})}else QF(t)&&(t.type!=="simple-marker"&&t.type!=="picture-marker"&&t.type!=="text"||(t.angle=e))}function MAt(t){if(!t)return null;const e=t.effects.filter(r=>r.type!=="bloom").map(r=>r.toJSON());return WB(e)}function IAt(t){return t!=null&&t.type==="polygon-3d"&&t.symbolLayers.some(e=>e.type==="extrude")}async function $At(t,e){return await t.fetchSymbol(e)||t.fetchCIMSymbol(e)}function fGe(t){return t=t||globalThis.location.hostname,mGe.some(e=>t?.match(e)!=null)}function B7(t,e){return t&&(e=e||globalThis.location.hostname)?e.match(Cve)!=null||e.match(Ove)!=null?t.replace("static.arcgis.com","staticdev.arcgis.com"):e.match(Ave)!=null||e.match(Rve)!=null?t.replace("static.arcgis.com","staticqa.arcgis.com"):t:t}const Cve=/^devext.arcgis.com$/,Ave=/^qaext.arcgis.com$/,Ove=/^[\w-]*\.mapsdevext.arcgis.com$/,Rve=/^[\w-]*\.mapsqa.arcgis.com$/,mGe=[/^([\w-]*\.)?[\w-]*\.zrh-dev-local.esri.com$/,Cve,Ave,/^jsapps.esri.com$/,Ove,Rve];function gGe(t,e,r,i){const s=t.name;return s==null?Promise.reject(new F("symbolstyleutils:style-symbol-reference-name-missing","Missing name in style symbol reference")):t.styleName&&t.styleName==="Esri2DPointSymbolsStyle"?yGe(s,e,i):hZ(t,e,i).then(n=>HZ(rc(n),s,e,r,h0e,i))}function jZ(t,e){return e.items.find(r=>r.name===t)}function HZ(t,e,r,i,s,n){const o=r&&r.portal!=null?r.portal:Qn.getDefault(),a={portal:o,url:cn(t.baseUrl),origin:"portal-item"},l=jZ(e,t.data);if(!l){const m=`The symbol name '${e}' could not be found`;return Promise.reject(new F("symbolstyleutils:symbol-name-not-found",m,{symbolName:e}))}let c=Dg(s(l,i),a),h=l.thumbnail?.href??null;const p=l.thumbnail&&l.thumbnail.imageData;fGe()&&(c=B7(c)??"",h=B7(h));const f={portal:o,url:cn(Mq(c)),origin:"portal-item"};return dZ(c,n).then(m=>{const y=i==="cimRef"?u0e(m.data):m.data,_=Hye(y,f);if(_&&R_(_)){if(h){const v=Dg(h,a);_.thumbnail=new Sb({url:v})}else p&&(_.thumbnail=new Sb({url:`data:image/png;base64,${p}`}));t.styleUrl?_.styleOrigin=new PO({portal:r.portal,styleUrl:t.styleUrl,name:e}):t.styleName&&(_.styleOrigin=new PO({portal:r.portal,styleName:t.styleName,name:e}))}return _})}function yGe(t,e,r){const i=S9e.replaceAll(/\{SymbolName\}/gi,t),s=e.portal!=null?e.portal:Qn.getDefault();return dZ(i,r).then(n=>{const o=u0e(n.data);return Hye(o,{portal:s,url:cn(Mq(i)),origin:"portal-item"})})}const _Ge=Object.freeze(Object.defineProperty({__proto__:null,fetchSymbolFromStyle:HZ,getStyleItemFromStyle:jZ,resolveWebStyleSymbol:gGe},Symbol.toStringTag,{value:"Module"}));let N3=class extends TF(Pt){constructor(e){super(e),this.handles.add([this.on("before-add",r=>{r.item==null&&r.preventDefault()}),this.on("after-add",r=>this._own(r.item)),this.on("after-remove",r=>this._release(r.item))])}get owner(){return this._get("owner")}set owner(e){e!==this._get("owner")&&(this._releaseAll(),this._set("owner",e),this._ownAll())}_ownAll(){for(const e of this.items)this._own(e)}_releaseAll(){for(const e of this.items)this._release(e)}_createNewInstance(e){return this.itemType?new(Pt.ofType(this.itemType.Type))(e):new Pt(e)}};function G7(t,e){return{type:t,cast:jge,set(r){const i=ew(r,this._get(e),t);i.owner=this,this._set(e,i)}}}u([d()],N3.prototype,"owner",null),N3=u([R("esri.core.support.OwningCollection")],N3);let F3=class extends N3{_own(e){e.layer&&"remove"in e.layer&&e.layer!==this.owner&&e.layer.remove(e),e.layer=this.owner}_release(e){e.layer===this.owner&&(e.layer=null)}};u([PW({Type:Oh,ensureType:Zs(Oh)})],F3.prototype,"itemType",void 0),F3=u([R("esri.support.GraphicsCollection")],F3);async function vGe(t,e){if(t.type==="2d")return t.hitTest(e);const r=await t.hitTest(e);if(r.results.length===0)return r;const i=(r.results[0].distance??0)*(1+bGe),s=r.results.findIndex(n=>(n.distance??0)>i);return s!==-1&&(r.results=r.results.slice(0,s)),r}const bGe=.05;function Pve(t){return t?.type==="graphic"}function NAt(t){return t.find(Pve)??null}function FAt(t){return t.filter(Pve)}function UAt(t){return t&&typeof t.highlight=="function"}function wGe(t){return t&&typeof t.maskOccludee=="function"}function kAt(t,e,r){return t==null||t>r&&(e===0||t<e)}function VAt(t,e){return t!=null&&t>0||e!=null&&e>0}function zAt(t){const e=t.effectiveScaleRange;return{minScale:e?.minScale??0,maxScale:e?.maxScale??0}}let kg=class{constructor(e,r){this._owner=r,this._properties={},this._afterDispatchHandle=null;for(const i in e){const s=e[i],n=new hpe(s,void 0,void 0,2,2);this._properties[i]={pool:n,acquired:[]}}this._afterDispatchHandle=wpe(()=>this._release())}destroy(){this._afterDispatchHandle&&(this._afterDispatchHandle.remove(),this._afterDispatchHandle=null);for(const e in this._properties){const r=this._properties[e];for(const i of r.acquired)qQ(i)||r.pool.release(i);r.pool.destroy(),r.pool=null,r.acquired=null}this._properties=null,this._owner=null}get(e){const r=this._owner._get(e),i=this._properties[e];let s=i.pool.acquire();for(i.acquired.push(s);s===r;)i.acquired.push(s),s=i.pool.acquire();return s}_release(){for(const e in this._properties){const r=this._properties[e];let i=0;for(const s of r.acquired)qQ(s)?r.acquired[i++]=s:r.pool.release(s);r.acquired.length=i}}};const xGe=oe("mac")?"Meta":"Ctrl",w5={8:"Backspace",9:"Tab",13:"Enter",27:"Escape",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete"};for(let t=48;t<58;t++)w5[t]=String.fromCharCode(t);for(let t=1;t<25;t++)w5[111+t]=`F${t}`;for(let t=65;t<91;t++)w5[t]=[String.fromCharCode(t+32),String.fromCharCode(t)];function TGe(t){if(t.key!==void 0)return TMe(t);const e=w5[t.keyCode];return Array.isArray(e)?t.shiftKey?e[1]:e[0]:e}function SGe(t){switch(t){case"Ctrl":case"Alt":case"Shift":case"Meta":case"Primary":return!0}return!1}let EGe=class{constructor(e,r=[]){this.eventType=e,this.keyModifiers=r}matches(e){if(e.type!==this.eventType)return!1;if(this.keyModifiers.length===0)return!0;const r=e.modifiers;for(const i of this.keyModifiers)if(!r.has(i))return!1;return!0}};const kte=Q.getLogger("esri.views.input.InputHandler");let To=class{constructor(e){this._manager=null,this._incoming={},this._outgoing={},this._incomingEventMatches=null,this._incomingEventTypes=null,this._outgoingEventTypes=null,this._hasSideEffects=e}get incomingEventMatches(){if(!this._incomingEventMatches){this._incomingEventMatches=[];for(const e in this._incoming){const r=this._incoming[e];for(const i of r)this._incomingEventMatches.push(i.match)}}return this._incomingEventMatches}get incomingEventTypes(){return this._incomingEventTypes||(this._incomingEventTypes=this.incomingEventMatches.map(e=>e.eventType)),this._incomingEventTypes}get outgoingEventTypes(){return this._outgoingEventTypes||(this._outgoingEventTypes=Object.keys(this._outgoing)),this._outgoingEventTypes}get hasSideEffects(){return this._hasSideEffects}get hasPendingInputs(){return!1}onInstall(e){this._manager?kte.error("This InputHandler has already been registered with an InputManager"):(e.setEventCallback(r=>this._handleEvent(r)),e.setUninstallCallback(()=>this._onUninstall()),this._manager=e)}onUninstall(){}registerIncoming(e,r,i){let s;typeof r=="function"?(i=r,s=[]):s=r||[];const n=typeof e=="string"?new EGe(e,s):e,o=()=>{this._incomingEventTypes=null,this._incomingEventMatches=null},a=h=>{const p=this._incoming[h.match.eventType];if(p){const f=p.indexOf(h);p.splice(f,1),o(),this._manager&&this._manager.updateDependencies()}},l=new CGe(n,i,{onPause:a,onRemove:a,onResume:h=>{const p=this._incoming[h.match.eventType];p&&!p.includes(h)&&(p.push(h),o(),this._manager&&this._manager.updateDependencies())}});let c=this._incoming[n.eventType];return c||(c=[],this._incoming[n.eventType]=c),c.push(l),o(),this._manager&&this._manager.updateDependencies(),l}registerOutgoing(e){if(this._outgoing[e])throw new Error("There is already a callback registered for this outgoing InputEvent: "+e);const r=new AGe(e,{onEmit:(i,s,n,o)=>{this._manager?.emit(i.eventType,s,n,o)},onRemove:i=>{delete this._outgoing[i.eventType],this._manager?.updateDependencies()}});return this._outgoing[e]=r,this._outgoingEventTypes=null,this._manager&&this._manager.updateDependencies(),r}startCapturingPointer(e){this._manager?.setPointerCapture(e,!0)}stopCapturingPointer(e){this._manager?.setPointerCapture(e,!1)}refreshHasPendingInputs(){this._manager?.refreshHasPendingInputs()}_onUninstall(){this._manager?(this.onUninstall(),this._manager=null):kte.error("This InputHandler is not registered with an InputManager")}_handleEvent(e){const r=this._incoming[e.type];if(r){for(const i of r)if(i.match.matches(e)&&(i.callback?.(e),e.shouldStopPropagation()))break}}},CGe=class{constructor(e,r,i){this.match=e,this._callback=r,this._handler=i}pause(){this._handler.onPause(this)}resume(){this._handler.onResume(this)}remove(){this._handler.onRemove(this)}get callback(){return this._callback}},AGe=class{constructor(e,r){this.eventType=e,this._removed=!1,this._handler=r}emit(e,r,i){this._removed||this._handler.onEmit(this,e,r,i)}remove(){this._removed=!0,this._handler.onRemove(this)}},OGe=class extends To{constructor(e){super(!0),this._onChange=e,this._value="mouse",this._x=null,this._y=null,this.registerIncoming("pointer-move",r=>{this._update(r.data)})}_update(e){const r=e.native.pointerType==="touch"?"touch":"mouse",{x:i,y:s}=e;r===this._value&&this._x===i&&this._y===s||(this._value=r,this._x=i,this._y=s,this._onChange(r,i,s))}},RGe=class{constructor(e,r){this._observable=new zF,this._value=e,this._equalityFunction=r}get value(){return Ht(this._observable),this._value}set value(e){this._equalityFunction(e,this._value)||(this._value=e,this._observable.notify())}mutate(e){e(this._value),this._observable.notify()}};function kO(t,e=vhe){return new RGe(t,e)}let PGe=class extends To{get multiTouchActive(){return this._multiTouchActive.value}constructor(){super(!0),this._activeTouchPointerIds=new Set,this._multiTouchActive=kO(!1),this._onPointerAdd=({data:e})=>{e.pointerType==="touch"&&(this._activeTouchPointerIds.add(e.native.pointerId),this._update())},this._onPointerRemove=({data:e})=>{e.pointerType==="touch"&&(this._activeTouchPointerIds.delete(e.native.pointerId),this._update())},this.registerIncoming("pointer-down",this._onPointerAdd),this.registerIncoming("pointer-up",this._onPointerRemove),this.registerIncoming("pointer-capture-lost",this._onPointerRemove),this.registerIncoming("pointer-cancel",this._onPointerRemove)}_update(){this._multiTouchActive.value=this._activeTouchPointerIds.size>1}},zu=class extends Te{constructor(e){super(e),this._pointerCaptures=new Map,this._nameToGroup={},this._handlers=[],this._handlersPriority=[],this._currentPropagation=null,this._updateDependenciesAfterPropagation=!1,this._sourceEvents=new Set,this._keyModifiers=new Set,this._activeKeyModifiers=new Set,this._stoppedPropagationEventIds=new Set,this.primaryKey=xGe,this._latestPointerType="mouse",this._propertiesPool=new kg({latestPointerLocation:$Ge},this),this.latestPointerLocation=null,this._paused=!1,this.test={timestamp:void 0,hasCurrentPropagation:()=>!!this._currentPropagation}}initialize(){this.eventSource.onEventReceived=this._onEventReceived.bind(this),this._installRecognizers()}destroy(){const e=Object.keys(this._nameToGroup);for(const r of e)this.uninstallHandlers(r);this.eventSource.destroy(),this._currentPropagation=null,this._propertiesPool.destroy()}get hasPendingInputs(){return this._handlers.some(e=>e.handler.hasPendingInputs)}get latestPointerType(){return this._latestPointerType}get multiTouchActive(){return this._multiTouchHandler.multiTouchActive}get updating(){return this.hasPendingInputs||this._paused}installHandlers(e,r,i=m_.INTERNAL){if(this._nameToGroup[e])return void Q.getLogger(this).error("There is already an InputHandler group registered under the name `"+e+"`");if(r.length===0)return void Q.getLogger(this).error("Can't register a group of zero handlers");const s={name:e,handlers:r.map(n=>({handler:n,active:!0,removed:!1,priorityIndex:0,groupPriority:i,eventCallback:null,uninstallCallback:null}))};this._nameToGroup[e]=s;for(let n=s.handlers.length-1;n>=0;n--){const o=s.handlers[n];this._handlers.push(o),o.handler.onInstall({updateDependencies:()=>{this.updateDependencies()},emit:(a,l,c,h,p)=>{this._emitInputEvent(o.priorityIndex+1,a,l,c,p,h)},setPointerCapture:(a,l)=>{this._setPointerCapture(s,o,a,l)},setEventCallback:a=>{o.eventCallback=a},setUninstallCallback:a=>{o.uninstallCallback=a},refreshHasPendingInputs:()=>{this.notifyChange("hasPendingInputs")}})}this.updateDependencies()}uninstallHandlers(e){const r=this._nameToGroup[e];r?(r.handlers.forEach(i=>{i.removed=!0,i.uninstallCallback?.()}),delete this._nameToGroup[e],this._currentPropagation?this._currentPropagation.needsHandlerGarbageCollect=!0:this._garbageCollectRemovedHandlers()):Q.getLogger(this).error("There is no InputHandler group registered under the name `"+e+"`")}hasHandlers(e){return this._nameToGroup[e]!==void 0}updateDependencies(){if(this._currentPropagation)return void(this._updateDependenciesAfterPropagation=!0);this._updateDependenciesAfterPropagation=!1;const e=new Set,r=new Set;this._handlersPriority=[];for(let i=this._handlers.length-1;i>=0;i--){const s=this._handlers[i];s.priorityIndex=i,this._handlersPriority.push(s)}this._handlersPriority=this._sortHandlersPriority(this._handlersPriority);for(let i=this._handlersPriority.length-1;i>=0;i--){const s=this._handlersPriority[i];s.priorityIndex=i;let n=s.handler.hasSideEffects;if(!n){for(const o of s.handler.outgoingEventTypes)if(e.has(o)){n=!0;break}}if(n)for(const o of s.handler.incomingEventMatches){e.add(o.eventType);for(const a of o.keyModifiers)SGe(a)||r.add(a)}s.active=n}this._sourceEvents=e,this._keyModifiers=r,this._pointerCaptures.size>0&&this._sourceEvents.add("pointer-capture-lost"),this._keyModifiers.size>0&&(this._sourceEvents.add("key-down"),this._sourceEvents.add("key-up")),this.eventSource&&(this.eventSource.activeEvents=this._sourceEvents)}_setLatestPointer(e,r,i){this._latestPointerType=e;const s=this._get("latestPointerLocation");if(s==null||s.x!==r||s.y!==i){const n=this._propertiesPool.get("latestPointerLocation");n.x=r,n.y=i,this._set("latestPointerLocation",n)}}_onEventReceived(e,r){if(e==="pointer-capture-lost"){const n=r;this._pointerCaptures.delete(n.native.pointerId)}this._updateKeyModifiers(e,r);const i=this.test.timestamp!=null?this.test.timestamp:r.native?r.native.timestamp:void 0,s=r.native?r.native.cancelable:void 0;this._emitInputEventFromSource(e,r,i,s)}_updateKeyModifiers(e,r){if(!r)return;let i=!1;const s=()=>{if(!i){const a=new Set;this._activeKeyModifiers.forEach(l=>{a.add(l)}),this._activeKeyModifiers=a,i=!0}},n=(a,l)=>{l&&!this._activeKeyModifiers.has(a)?(s(),this._activeKeyModifiers.add(a)):!l&&this._activeKeyModifiers.has(a)&&(s(),this._activeKeyModifiers.delete(a))};if(e==="key-down"||e==="key-up"){const a=r.key;this._keyModifiers.has(a)&&n(a,e==="key-down")}const o=r.native;n("Alt",!(!o||!o.altKey)),n("Ctrl",!(!o||!o.ctrlKey)),n("Shift",!(!o||!o.shiftKey)),n("Meta",!(!o||!o.metaKey)),n("Primary",this._activeKeyModifiers.has(this.primaryKey))}_installRecognizers(){this._latestPointerHandler=new OGe((e,r,i)=>this._setLatestPointer(e,r,i)),this._multiTouchHandler=new PGe,this.installHandlers("input-manager-logic",[this._latestPointerHandler,this._multiTouchHandler],m_.ALWAYS),this.recognizers.length>0&&this.installHandlers("default",this.recognizers,m_.INTERNAL)}_setPointerCapture(e,r,i,s){const n=e.name+"-"+r.priorityIndex,o=this._pointerCaptures.get(i.pointerId)||new Set;this._pointerCaptures.set(i.pointerId,o),s?(o.add(n),o.size===1&&this.eventSource&&this.eventSource.setPointerCapture(i,!0)):o.has(n)&&(o.delete(n),o.size===0&&(this._pointerCaptures.delete(i.pointerId),this.eventSource&&this.eventSource.setPointerCapture(i,!1)))}_garbageCollectRemovedHandlers(){this._handlers=this._handlers.filter(e=>!e.removed),this.updateDependencies()}_emitInputEventFromSource(e,r,i,s){this._emitInputEvent(0,e,r,i,s)}_emitInputEvent(e,r,i,s,n,o){const a=s!==void 0?s:this._currentPropagation?this._currentPropagation.timestamp:performance.now(),l=n!==void 0&&n,c={event:new MGe(r,i,a,o||this._activeKeyModifiers,l),priorityIndex:e};this._currentPropagation?this._currentPropagation.events.push(c):this._doNewPropagation(c)}_doNewPropagation(e){this._currentPropagation={events:new kB,currentHandler:null,needsHandlerGarbageCollect:!1,timestamp:e.event.timestamp},this._currentPropagation.events.push(e),this._continuePropagation()}_continuePropagation(){this._paused=!1;const e=this._currentPropagation;if(e){for(;e.events.length>0;){const{event:r,priorityIndex:i}=e.events.pop(),s=r.data&&r.data.eventId;if(!(s!=null&&this._stoppedPropagationEventIds.has(s)))for(e.currentHandler=this._handlersPriority[i];e.currentHandler;){if(e.currentHandler.removed)e.needsHandlerGarbageCollect=!0;else{if(e.currentHandler.active&&!r.shouldStopPropagation()&&e.currentHandler.eventCallback?.(r),r.shouldStopPropagation()){s!=null&&this._stoppedPropagationEventIds.add(s);break}if(r.shouldPausePropagation(()=>this._continuePropagation()))return void this._pausePropagation({event:r,priorityIndex:e.currentHandler.priorityIndex+1})}e.currentHandler=this._handlersPriority[e.currentHandler.priorityIndex+1]}}e.needsHandlerGarbageCollect&&this._garbageCollectRemovedHandlers(),this.hasPendingInputs||this._stoppedPropagationEventIds.clear(),this._currentPropagation=null,this._updateDependenciesAfterPropagation&&this.updateDependencies()}}_pausePropagation(e){const r=new kB;r.push(e);const i=this._currentPropagation;if(i){for(;i.events.length;)r.push(i.events.pop());i.events=r,i.currentHandler=null,this._paused=!0}}_compareHandlerPriority(e,r){if(e.handler.hasSideEffects!==r.handler.hasSideEffects)return e.handler.hasSideEffects?1:-1;if(e.groupPriority!==r.groupPriority)return e.groupPriority>r.groupPriority?-1:1;for(const i of e.handler.incomingEventMatches)for(const s of r.handler.incomingEventMatches){if(i.eventType!==s.eventType)continue;const n=i.keyModifiers.filter(o=>s.keyModifiers.includes(o));if(n.length===i.keyModifiers.length!=(n.length===s.keyModifiers.length))return i.keyModifiers.length>s.keyModifiers.length?-1:1}return e.priorityIndex>r.priorityIndex?-1:1}_sortHandlersPriority(e){const r=[];for(const i of e){let s=0;for(;s<r.length&&this._compareHandlerPriority(i,r[s])>=0;)s++;r.splice(s,0,i)}return r}get debug(){const e=r=>{const i=this._setPointerCapture;this._setPointerCapture=()=>{},r(),this._setPointerCapture=i};return{injectEvent:(r,i)=>{e(()=>{this._onEventReceived(r,i)})},disablePointerCapture:e}}};u([d({readOnly:!0})],zu.prototype,"hasPendingInputs",null),u([d({constructOnly:!0})],zu.prototype,"eventSource",void 0),u([d({constructOnly:!0})],zu.prototype,"recognizers",void 0),u([d()],zu.prototype,"_latestPointerType",void 0),u([d()],zu.prototype,"latestPointerType",null),u([d()],zu.prototype,"multiTouchActive",null),u([d({readOnly:!0})],zu.prototype,"latestPointerLocation",void 0),u([d()],zu.prototype,"_paused",void 0),u([d({readOnly:!0})],zu.prototype,"updating",null),zu=u([R("esri.views.input.InputManager")],zu);let MGe=class{constructor(e,r,i,s,n){this.type=e,this.data=r,this.timestamp=i,this.modifiers=s,this.cancelable=n,this._propagationState=M0.NONE,this._resumeCallback=null}stopPropagation(){this._propagationState|=M0.STOPPED}shouldStopPropagation(){return(this._propagationState&M0.STOPPED)!=0}async(e){this._propagationState|=M0.PAUSED;const r=(i,s)=>{this._propagationState&=~M0.PAUSED;const n=this._resumeCallback;if(this._resumeCallback=null,n&&n(),s)throw i;return i};return(typeof e=="function"?e():e).then(i=>r(i,!1),i=>r(i,!0))}shouldPausePropagation(e){return!!(this._propagationState&M0.PAUSED)&&(this._resumeCallback=e,!0)}preventDefault(){this.data.native.preventDefault()}};var M0;(function(t){t[t.NONE=0]="NONE",t[t.STOPPED=1]="STOPPED",t[t.PAUSED=2]="PAUSED"})(M0||(M0={}));const m_={ALWAYS:1,DEFAULT:0,TOOL:-1,WIDGET:-2,INTERNAL:-3};let IGe=class{};const $Ge=IGe;function fn(t,e){return t[0]=e[0],t[1]=e[1],t}function or(t,e,r){return t[0]=e,t[1]=r,t}function Ld(t,e,r){return t[0]=e[0]+r[0],t[1]=e[1]+r[1],t}function gf(t,e,r){return t[0]=e[0]-r[0],t[1]=e[1]-r[1],t}function qZ(t,e,r){return t[0]=e[0]*r[0],t[1]=e[1]*r[1],t}function Mve(t,e,r){return t[0]=e[0]/r[0],t[1]=e[1]/r[1],t}function LGe(t,e){return t[0]=Math.ceil(e[0]),t[1]=Math.ceil(e[1]),t}function DGe(t,e){return t[0]=Math.floor(e[0]),t[1]=Math.floor(e[1]),t}function NGe(t,e,r){return t[0]=Math.min(e[0],r[0]),t[1]=Math.min(e[1],r[1]),t}function FGe(t,e,r){return t[0]=Math.max(e[0],r[0]),t[1]=Math.max(e[1],r[1]),t}function UGe(t,e){return t[0]=Math.round(e[0]),t[1]=Math.round(e[1]),t}function lc(t,e,r){return t[0]=e[0]*r,t[1]=e[1]*r,t}function kGe(t,e,r,i){return t[0]=e[0]+r[0]*i,t[1]=e[1]+r[1]*i,t}function sw(t,e){const r=e[0]-t[0],i=e[1]-t[1];return Math.sqrt(r*r+i*i)}function UN(t,e){const r=e[0]-t[0],i=e[1]-t[1];return r*r+i*i}function WZ(t){const e=t[0],r=t[1];return Math.sqrt(e*e+r*r)}function Ive(t){const e=t[0],r=t[1];return e*e+r*r}function ZZ(t,e){return t[0]=-e[0],t[1]=-e[1],t}function $ve(t,e){return t[0]=1/e[0],t[1]=1/e[1],t}function VO(t,e){const r=e[0],i=e[1];let s=r*r+i*i;return s>0&&(s=1/Math.sqrt(s),t[0]=e[0]*s,t[1]=e[1]*s),t}function Ks(t,e){return t[0]*e[0]+t[1]*e[1]}function VGe(t,e,r){const i=e[0]*r[1]-e[1]*r[0];return t[0]=t[1]=0,t[2]=i,t}function nh(t,e,r,i){const s=e[0],n=e[1];return t[0]=s+i*(r[0]-s),t[1]=n+i*(r[1]-n),t}function zGe(t,e){e=e||1;const r=2*RR()*Math.PI;return t[0]=Math.cos(r)*e,t[1]=Math.sin(r)*e,t}function Lve(t,e,r){const i=e[0],s=e[1];return t[0]=r[0]*i+r[2]*s,t[1]=r[1]*i+r[3]*s,t}function T1(t,e,r){const i=e[0],s=e[1];return t[0]=r[0]*i+r[2]*s+r[4],t[1]=r[1]*i+r[3]*s+r[5],t}function BGe(t,e,r){const i=e[0],s=e[1];return t[0]=r[0]*i+r[3]*s+r[6],t[1]=r[1]*i+r[4]*s+r[7],t}function GGe(t,e,r){const i=e[0],s=e[1];return t[0]=r[0]*i+r[4]*s+r[12],t[1]=r[1]*i+r[5]*s+r[13],t}function jGe(t,e,r,i){const s=e[0]-r[0],n=e[1]-r[1],o=Math.sin(i),a=Math.cos(i);return t[0]=s*a-n*o+r[0],t[1]=s*o+n*a+r[1],t}function HGe(t,e){const r=t[0],i=t[1],s=e[0],n=e[1];let o=r*r+i*i;o>0&&(o=1/Math.sqrt(o));let a=s*s+n*n;a>0&&(a=1/Math.sqrt(a));const l=(r*s+i*n)*o*a;return l>1?0:l<-1?Math.PI:Math.acos(l)}function qGe(t){return"vec2("+t[0]+", "+t[1]+")"}function Dve(t,e){return t[0]===e[0]&&t[1]===e[1]}function Nve(t,e){const r=t[0],i=t[1],s=e[0],n=e[1],o=Xa();return Math.abs(r-s)<=o*Math.max(1,Math.abs(r),Math.abs(s))&&Math.abs(i-n)<=o*Math.max(1,Math.abs(i),Math.abs(n))}function WGe(t,e,r,i,s){let n=e[0]-r[0],o=e[1]-r[1];const a=(i[0]*n+i[1]*o)*(s-1);return n=i[0]*a,o=i[1]*a,t[0]=e[0]+n,t[1]=e[1]+o,t}const ZGe=WZ,Fve=gf,XGe=qZ,YGe=Mve,Uve=sw,JGe=UN,QGe=Ive;Object.freeze(Object.defineProperty({__proto__:null,add:Ld,angle:HGe,ceil:LGe,copy:fn,cross:VGe,dist:Uve,distance:sw,div:YGe,divide:Mve,dot:Ks,equals:Nve,exactEquals:Dve,floor:DGe,inverse:$ve,len:ZGe,length:WZ,lerp:nh,max:FGe,min:NGe,mul:XGe,multiply:qZ,negate:ZZ,normalize:VO,projectAndScale:WGe,random:zGe,rotate:jGe,round:UGe,scale:lc,scaleAndAdd:kGe,set:or,sqrDist:JGe,sqrLen:QGe,squaredDistance:UN,squaredLength:Ive,str:qGe,sub:Fve,subtract:gf,transformMat2:Lve,transformMat2d:T1,transformMat3:BGe,transformMat4:GGe},Symbol.toStringTag,{value:"Module"}));function Ve(){return[0,0]}function CA(t){return[t[0],t[1]]}function dr(t,e){return[t,e]}function kve(t){const e=Ve(),r=Math.min(2,t.length);for(let i=0;i<r;++i)e[i]=t[i];return e}function Vve(t,e){return new Float64Array(t,e,2)}function zve(){return Ve()}function Bve(){return dr(1,1)}function Gve(){return dr(1,0)}function jve(){return dr(0,1)}const ap=zve(),KGe=Bve(),Hve=Gve(),eje=jve();Object.freeze(Object.defineProperty({__proto__:null,ONES:KGe,UNIT_X:Hve,UNIT_Y:eje,ZEROS:ap,clone:CA,create:Ve,createView:Vve,fromArray:kve,fromValues:dr,ones:Bve,unitX:Gve,unitY:jve,zeros:zve},Symbol.toStringTag,{value:"Module"}));function qve(t){return 32+t.length}function Wve(t){return 16}function Zve(t){if(!t)return 0;let e=Jve;for(const r in t)if(t.hasOwnProperty(r)){const i=t[r];switch(typeof i){case"string":e+=qve(i);break;case"number":e+=Wve();break;case"boolean":e+=4}}return e}function Xve(t){if(!t)return 0;if(Array.isArray(t))return tje(t);let e=Jve;for(const r in t)t.hasOwnProperty(r)&&(e+=Yve(t[r]));return e}function tje(t){const e=t.length;if(e===0||typeof t[0]=="number")return 32+8*e;let r=Qve;for(let i=0;i<e;i++)r+=Yve(t[i]);return r}function Yve(t){switch(typeof t){case"object":return Xve(t);case"string":return qve(t);case"number":return Wve();case"boolean":return 4;default:return 8}}function KAt(t,e){return Qve+t.length*e}const Jve=32,Qve=32,XZ=(t,e,r)=>[e,r],f2=(t,e,r)=>[e,r,t[2]],YZ=(t,e,r)=>[e,r,t[2],t[3]];function e3t(t){return t?{originPosition:t.originPosition==="upper-left"?"upperLeft":t.originPosition==="lower-left"?"lowerLeft":t.originPosition,scale:t.tolerance?[t.tolerance,t.tolerance]:[1,1],translate:t.extent!=null?[t.extent.xmin,t.extent.ymax]:[0,0]}:null}function rje({scale:t,translate:e},r){return Math.round((r-e[0])/t[0])}function ije({scale:t,translate:e},r){return Math.round((e[1]-r)/t[1])}function Kve({scale:t,translate:e},r){return r*t[0]+e[0]}function e1e({scale:t,translate:e},r){return e[1]-r*t[1]}function t1e(t,e,r){const i=new Array(r.length);if(!r.length)return i;const[s,n]=t.scale;let o=Kve(t,r[0][0]),a=e1e(t,r[0][1]);i[0]=e(r[0],o,a);for(let l=1;l<r.length;l++){const c=r[l];o+=c[0]*s,a-=c[1]*n,i[l]=e(c,o,a)}return i}function r1e(t,e,r){const i=new Array(r.length);for(let s=0;s<r.length;s++)i[s]=t1e(t,e,r[s]);return i}function sje(t,e,r,i){return t1e(t,r?i?YZ:f2:i?f2:XZ,e)}function nje(t,e,r,i){return r1e(t,r?i?YZ:f2:i?f2:XZ,e)}function oje(t,e,r,i){return r1e(t,r?i?YZ:f2:i?f2:XZ,e)}function t3t(t,e,r,i,s){return e.x=rje(t,r.x),e.y=ije(t,r.y),e!==r&&(i&&(e.z=r.z),s&&(e.m=r.m)),e}function i1e(t,e,r,i,s){return r!=null&&(e.points=sje(t,r.points,i,s)),e}function s1e(t,e,r,i,s){return r==null||(e.x=Kve(t,r.x),e.y=e1e(t,r.y),e!==r&&(i&&(e.z=r.z),s&&(e.m=r.m))),e}function n1e(t,e,r,i,s){return r!=null&&(e.rings=oje(t,r.rings,i,s)),e}function o1e(t,e,r,i,s){return r!=null&&(e.paths=nje(t,r.paths,i,s)),e}let r3t=class{constructor(e,r,i){this.uid=e,this.geometry=r,this.attributes=i,this.visible=!0,this.objectId=null,this.centroid=null}};function s3t(t){return t.geometry!=null}let n3t=class{constructor(){this.exceededTransferLimit=!1,this.features=[],this.fields=[],this.hasM=!1,this.hasZ=!1,this.geometryType=null,this.objectIdFieldName=null,this.globalIdFieldName=null,this.geometryProperties=null,this.geohashFieldName=null,this.spatialReference=null,this.transform=null}};function a3t(t){const e=Yfe.fromJSON(t.geometryType),r=je.fromJSON(t.spatialReference),i=t.transform,s=t.features.map(n=>{const o=aje(n,e,r,t.objectIdFieldName),a=o.geometry;if(a!=null&&i)switch(a.type){case"point":o.geometry=s1e(i,a,a,a.hasZ,a.hasM);break;case"multipoint":o.geometry=i1e(i,a,a,!!a.hasZ,!!a.hasM);break;case"polygon":o.geometry=n1e(i,a,a,!!a.hasZ,!!a.hasM);break;case"polyline":o.geometry=o1e(i,a,a,!!a.hasZ,!!a.hasM);break;case"extent":case"mesh":o.geometry=a}return o});return{geometryType:e,features:s,spatialReference:r,fields:t.fields?.map(n=>n5.fromJSON(n))??[],objectIdFieldName:t.objectIdFieldName,globalIdFieldName:t.globalIdFieldName,geohashFieldName:t.geohashFieldName,geometryProperties:t.geometryProperties,hasZ:t.hasZ,hasM:t.hasM,exceededTransferLimit:t.exceededTransferLimit,transform:null}}function aje(t,e,r,i){return{uid:gc(),objectId:i&&t.attributes?t.attributes[i]:null,attributes:t.attributes,geometry:lje(t.geometry,e,r),visible:!0}}function lje(t,e,r){if(t==null)return null;switch(e){case"point":{const i=t;return{x:i.x,y:i.y,z:i.z,m:i.m,hasZ:i.z!=null,hasM:i.m!=null,type:"point",spatialReference:r}}case"polyline":{const i=t;return{paths:i.paths,hasZ:!!i.hasZ,hasM:!!i.hasM,type:"polyline",spatialReference:r}}case"polygon":{const i=t;return{rings:i.rings,hasZ:!!i.hasZ,hasM:!!i.hasM,type:"polygon",spatialReference:r}}case"multipoint":{const i=t;return{points:i.points,hasZ:!!i.hasZ,hasM:!!i.hasM,type:"multipoint",spatialReference:r}}}}function Dw(t,e,r,i){return{x:t,y:e,z:r,hasZ:r!=null,hasM:!1,spatialReference:i,type:"point"}}function cje(t){if(t==null)return 0;let e=32;switch(t.type){case"point":e+=42;break;case"polyline":case"polygon":{let r=0;const i=2+(t.hasZ?1:0)+(t.hasM?1:0),s=t.type==="polyline"?t.paths:t.rings;for(const n of s)r+=n.length;e+=8*r*i+64,e+=128*r,e+=34,e+=32*(s.length+1);break}case"multipoint":{const r=2+(t.hasZ?1:0)+(t.hasM?1:0),i=t.points.length;e+=8*i*r+64,e+=128*i,e+=34,e+=32;break}case"extent":e+=98,t.hasM&&(e+=32),t.hasZ&&(e+=32);break;case"mesh":e+=Z0(t.vertexAttributes.position),e+=Z0(t.vertexAttributes.normal),e+=Z0(t.vertexAttributes.uv),e+=Z0(t.vertexAttributes.tangent)}return e}function l3t(t){let e=32;return e+=Zve(t.attributes),e+=3,e+=8+cje(t.geometry),e}function uje(t){if(t==null)return 0;switch(t.type){case"point":return 1;case"polyline":{let e=0;for(const r of t.paths)e+=r.length;return e}case"polygon":{let e=0;for(const r of t.rings)e+=r.length;return e}case"multipoint":return t.points.length;case"extent":return 2;case"mesh":{const e=t.vertexAttributes&&t.vertexAttributes.position;return e?e.length/3:0}default:return}}function c3t(t){if(t==null)return!1;switch(t.type){case"extent":case"point":return!0;case"polyline":for(const e of t.paths)if(e.length>0)return!0;return!1;case"polygon":for(const e of t.rings)if(e.length>0)return!0;return!1;case"multipoint":return t.points.length>0;case"mesh":return!t.loaded||t.vertexAttributes.position.length>0}}function u3t(t,e){switch(xi(e),t.type==="mesh"&&(t=t.extent),t.type){case"point":e[0]=e[3]=t.x,e[1]=e[4]=t.y,t.hasZ&&(e[2]=e[5]=t.z);break;case"polyline":for(let r=0;r<t.paths.length;r++)hU(e,t.paths[r],!!t.hasZ);break;case"polygon":for(let r=0;r<t.rings.length;r++)hU(e,t.rings[r],!!t.hasZ);break;case"multipoint":hU(e,t.points,!!t.hasZ);break;case"extent":e[0]=t.xmin,e[1]=t.ymin,e[3]=t.xmax,e[4]=t.ymax,t.zmin!=null&&(e[2]=t.zmin),t.zmax!=null&&(e[5]=t.zmax)}}function hje(t,e){switch(wc(e),t.type==="mesh"&&(t=t.extent),t.type){case"point":e[0]=e[2]=t.x,e[1]=e[3]=t.y;break;case"polyline":for(let r=0;r<t.paths.length;r++)K6(e,t.paths[r]);break;case"polygon":for(let r=0;r<t.rings.length;r++)K6(e,t.rings[r]);break;case"multipoint":K6(e,t.points);break;case"extent":e[0]=t.xmin,e[1]=t.ymin,e[2]=t.xmax,e[3]=t.ymax}}function h3t(t,e){return t.objectId!=null?t.objectId:t.attributes&&e?t.attributes[e]:null}function Xp(t){return Ah(t.x,t.y)}function d3t(t){return Zi(t.x,t.y)}function a1e(t,e){const r=(t instanceof HTMLElement?t:t.surface)?.getBoundingClientRect();return r?Ah(e.clientX-r.left,e.clientY-r.top):Ah(0,0)}function Vte(t,e){return e instanceof Event?a1e(t,e):Xp(e)}function zte(t){if(t instanceof Event)return!0;if(typeof t=="object"&&"type"in t)switch(t.type){case"click":case"double-click":case"pointer-down":case"pointer-drag":case"pointer-enter":case"pointer-leave":case"pointer-up":case"pointer-move":case"immediate-click":case"immediate-double-click":case"hold":case"drag":case"mouse-wheel":return!0;default:return!1}return!1}function x5(){return function(t,e){if(!t[e])throw new TypeError(`Cannot auto bind undefined function '${String(e)}'`);return{value:pje(t[e])}}}function dje(t){const e=t?.type;return t instanceof KeyboardEvent||e==="keyup"||e==="keydown"||e==="keypress"}function pje(t){return function(e,...r){dje(e)?mFe(e.key)&&(e.preventDefault(),e.stopPropagation(),e.target.click()):t.call(this,e,...r)}}const l1e="calcite-mode-";function fje(){return getComputedStyle(document.body).getPropertyValue("--esri-calcite-mode-name").replaceAll(/\s|'|"/g,"")}function mje(){return fje().startsWith("dark")}function gje(){return`${l1e}${mje()?"dark":"light"}`}function yje(t){_je(t),t.classList.add(gje())}function _je(t){Array.from(t.classList).forEach(e=>{e.startsWith(l1e)&&t.classList.remove(e)})}function vje(t){return t&&typeof t.render=="function"}function p3t(t){return t&&typeof t.postMixInProperties=="function"&&typeof t.buildRendering=="function"&&typeof t.postCreate=="function"&&typeof t.startup=="function"}async function c1e(t,e){return await t.load(),bje(t,e)}async function bje(t,e){const r=[],i=(...n)=>{for(const o of n)o!=null&&(Array.isArray(o)?i(...o):Pt.isCollection(o)?o.forEach(a=>i(a)):Fg.isLoadable(o)&&r.push(o))};e(i);let s=null;if(await vBe(r,async n=>{const o=await gu(wje(n)?n.loadAll():n.load());o.ok!==!1||s||(s=o)}),s)throw s.error;return t}function wje(t){return"loadAll"in t&&typeof t.loadAll=="function"}async function xje(t){if(!t)return;const e=t.includes("-vector")?t.slice(0,t.indexOf("-vector")):t,r=await Ide("esri/t9n/basemaps");return r[t]||r[e]}const j7={streets:{id:"streets",classic:!0,deprecated:!0,get thumbnailUrl(){return kr("esri/images/basemap/streets.jpg")},baseMapLayers:[{id:"streets-base-layer",url:"//services.arcgisonline.com/ArcGIS/rest/services/World_Street_Map/MapServer",layerType:"ArcGISTiledMapServiceLayer",title:"World Street Map",showLegend:!1,visibility:!0,opacity:1}]},satellite:{id:"satellite",classic:!0,get thumbnailUrl(){return kr("esri/images/basemap/satellite.jpg")},baseMapLayers:[{id:"satellite-base-layer",url:"//services.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer",layerType:"ArcGISTiledMapServiceLayer",title:"World Imagery",showLegend:!1,visibility:!0,opacity:1}]},hybrid:{id:"hybrid",classic:!0,get thumbnailUrl(){return kr("esri/images/basemap/hybrid.jpg")},baseMapLayers:[{id:"hybrid-base-layer",url:"//services.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer",layerType:"ArcGISTiledMapServiceLayer",title:"World Imagery",showLegend:!1,visibility:!0,opacity:1},{id:"hybrid-reference-layer",styleUrl:"https://cdn.arcgis.com/sharing/rest/content/items/30d6b8271e1849cd9c3042060001f425/resources/styles/root.json",layerType:"VectorTileLayer",title:"Hybrid Reference Layer",isReference:!0,showLegend:!1,visibility:!0,opacity:1}]},terrain:{id:"terrain",classic:!0,get thumbnailUrl(){return kr("esri/images/basemap/terrain.jpg")},baseMapLayers:[{id:"terrain-base-layer",url:"//services.arcgisonline.com/ArcGIS/rest/services/World_Terrain_Base/MapServer",layerType:"ArcGISTiledMapServiceLayer",title:"World Terrain Base",showLegend:!1,visibility:!0,opacity:1},{id:"terrain-reference-layer",url:"//services.arcgisonline.com/ArcGIS/rest/services/Reference/World_Reference_Overlay/MapServer",layerType:"ArcGISTiledMapServiceLayer",title:"World Reference Overlay",isReference:!0,showLegend:!1,visibility:!0,opacity:1}]},topo:{id:"topo",classic:!0,deprecated:!0,get thumbnailUrl(){return kr("esri/images/basemap/topo.jpg")},baseMapLayers:[{id:"topo-base-layer",url:"//services.arcgisonline.com/ArcGIS/rest/services/World_Topo_Map/MapServer",layerType:"ArcGISTiledMapServiceLayer",title:"World Topo Map",showLegend:!1,visibility:!0,opacity:1}]},gray:{id:"gray",classic:!0,deprecated:!0,get thumbnailUrl(){return kr("esri/images/basemap/gray.jpg")},baseMapLayers:[{id:"gray-base-layer",url:"//services.arcgisonline.com/ArcGIS/rest/services/Canvas/World_Light_Gray_Base/MapServer",layerType:"ArcGISTiledMapServiceLayer",title:"World Light Gray Base",showLegend:!1,visibility:!0,opacity:1},{id:"gray-reference-layer",url:"//services.arcgisonline.com/ArcGIS/rest/services/Canvas/World_Light_Gray_Reference/MapServer",layerType:"ArcGISTiledMapServiceLayer",title:"World Light Gray Reference",isReference:!0,showLegend:!1,visibility:!0,opacity:1}]},"dark-gray":{id:"dark-gray",classic:!0,deprecated:!0,get thumbnailUrl(){return kr("esri/images/basemap/dark-gray.jpg")},baseMapLayers:[{id:"dark-gray-base-layer",url:"//services.arcgisonline.com/ArcGIS/rest/services/Canvas/World_Dark_Gray_Base/MapServer",layerType:"ArcGISTiledMapServiceLayer",title:"World Dark Gray Base",showLegend:!1,visibility:!0,opacity:1},{id:"dark-gray-reference-layer",url:"//services.arcgisonline.com/ArcGIS/rest/services/Canvas/World_Dark_Gray_Reference/MapServer",layerType:"ArcGISTiledMapServiceLayer",title:"World Dark Gray Reference",isReference:!0,showLegend:!1,visibility:!0,opacity:1}]},oceans:{id:"oceans",classic:!0,get thumbnailUrl(){return kr("esri/images/basemap/oceans.jpg")},baseMapLayers:[{id:"oceans-base-layer",url:"//services.arcgisonline.com/arcgis/rest/services/Ocean/World_Ocean_Base/MapServer",layerType:"ArcGISTiledMapServiceLayer",title:"World Ocean Base",showLegend:!1,visibility:!0,opacity:1},{id:"oceans-reference-layer",url:"//services.arcgisonline.com/arcgis/rest/services/Ocean/World_Ocean_Reference/MapServer",layerType:"ArcGISTiledMapServiceLayer",title:"World Ocean Reference",isReference:!0,showLegend:!1,visibility:!0,opacity:1}]},"national-geographic":{id:"national-geographic",classic:!0,deprecated:!0,get thumbnailUrl(){return kr("esri/images/basemap/national-geographic.jpg")},baseMapLayers:[{id:"national-geographic-base-layer",url:"//services.arcgisonline.com/ArcGIS/rest/services/NatGeo_World_Map/MapServer",title:"NatGeo World Map",showLegend:!1,layerType:"ArcGISTiledMapServiceLayer",visibility:!0,opacity:1}]},osm:{id:"osm",classic:!0,get thumbnailUrl(){return kr("esri/images/basemap/osm.jpg")},baseMapLayers:[{id:"osm-base-layer",layerType:"OpenStreetMap",title:"Open Street Map",showLegend:!1,visibility:!0,opacity:1}]},"dark-gray-vector":{id:"dark-gray-vector",classic:!0,get thumbnailUrl(){return kr("esri/images/basemap/dark-gray-vector.jpg")},baseMapLayers:[{id:"dark-gray-base-layer",styleUrl:"https://cdn.arcgis.com/sharing/rest/content/items/5e9b3685f4c24d8781073dd928ebda50/resources/styles/root.json",layerType:"VectorTileLayer",title:"Dark Gray Base",visibility:!0,opacity:1},{id:"dark-gray-reference-layer",styleUrl:"https://cdn.arcgis.com/sharing/rest/content/items/747cb7a5329c478cbe6981076cc879c5/resources/styles/root.json",layerType:"VectorTileLayer",title:"Dark Gray Reference",isReference:!0,visibility:!0,opacity:1}]},"gray-vector":{id:"gray-vector",classic:!0,get thumbnailUrl(){return kr("esri/images/basemap/gray-vector.jpg")},baseMapLayers:[{id:"gray-base-layer",styleUrl:"https://cdn.arcgis.com/sharing/rest/content/items/291da5eab3a0412593b66d384379f89f/resources/styles/root.json",layerType:"VectorTileLayer",title:"Light Gray Base",visibility:!0,opacity:1},{id:"gray-reference-layer",styleUrl:"https://cdn.arcgis.com/sharing/rest/content/items/1768e8369a214dfab4e2167d5c5f2454/resources/styles/root.json",layerType:"VectorTileLayer",title:"Light Gray Reference",isReference:!0,visibility:!0,opacity:1}]},"streets-vector":{id:"streets-vector",classic:!0,get thumbnailUrl(){return kr("esri/images/basemap/streets-vector.jpg")},baseMapLayers:[{id:"streets-vector-base-layer",styleUrl:"//cdn.arcgis.com/sharing/rest/content/items/de26a3cf4cc9451298ea173c4b324736/resources/styles/root.json",layerType:"VectorTileLayer",title:"World Streets",visibility:!0,opacity:1}]},"topo-vector":{id:"topo-vector",classic:!0,get thumbnailUrl(){return kr("esri/images/basemap/topo-vector.jpg")},baseMapLayers:[{id:"world-hillshade-layer",url:"//services.arcgisonline.com/arcgis/rest/services/Elevation/World_Hillshade/MapServer",layerType:"ArcGISTiledMapServiceLayer",title:"World Hillshade",showLegend:!1,visibility:!0,opacity:1},{id:"topo-vector-base-layer",styleUrl:"//cdn.arcgis.com/sharing/rest/content/items/7dc6cea0b1764a1f9af2e679f642f0f5/resources/styles/root.json",layerType:"VectorTileLayer",title:"World Topo",visibility:!0,opacity:1}]},"streets-night-vector":{id:"streets-night-vector",classic:!0,get thumbnailUrl(){return kr("esri/images/basemap/streets-night.jpg")},baseMapLayers:[{id:"streets-night-vector-base-layer",styleUrl:"//cdn.arcgis.com/sharing/rest/content/items/86f556a2d1fd468181855a35e344567f/resources/styles/root.json",layerType:"VectorTileLayer",title:"World Streets Night",visibility:!0,opacity:1}]},"streets-relief-vector":{id:"streets-relief-vector",classic:!0,get thumbnailUrl(){return kr("esri/images/basemap/streets-relief.jpg")},baseMapLayers:[{id:"world-hillshade-layer",url:"//services.arcgisonline.com/arcgis/rest/services/Elevation/World_Hillshade/MapServer",layerType:"ArcGISTiledMapServiceLayer",title:"World Hillshade",showLegend:!1,visibility:!0,opacity:1},{id:"streets-relief-vector-base-layer",styleUrl:"//www.arcgis.com/sharing/rest/content/items/b266e6d17fc345b498345613930fbd76/resources/styles/root.json",title:"World Streets Relief",layerType:"VectorTileLayer",visibility:!0,opacity:1}]},"streets-navigation-vector":{id:"streets-navigation-vector",classic:!0,get thumbnailUrl(){return kr("esri/images/basemap/streets-navigation.jpg")},baseMapLayers:[{id:"streets-navigation-vector-base-layer",styleUrl:"//cdn.arcgis.com/sharing/rest/content/items/63c47b7177f946b49902c24129b87252/resources/styles/root.json",layerType:"VectorTileLayer",title:"World Streets Navigation",visibility:!0,opacity:1}]},"arcgis-imagery":{get thumbnailUrl(){return kr("esri/images/basemap/hybrid.jpg")},title:"Imagery Hybrid",baseMapLayers:[{layerType:"ArcGISTiledMapServiceLayer",showLegend:!1,title:"World Imagery",url:"https://ibasemaps-api.arcgis.com/arcgis/rest/services/World_Imagery/MapServer"},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:Imagery:Labels",title:"Hybrid Reference Layer",isReference:!0}]},"arcgis-imagery-standard":{get thumbnailUrl(){return kr("esri/images/basemap/satellite.jpg")},title:"Imagery",baseMapLayers:[{layerType:"ArcGISTiledMapServiceLayer",showLegend:!1,title:"World Imagery",url:"https://ibasemaps-api.arcgis.com/arcgis/rest/services/World_Imagery/MapServer"}]},"arcgis-imagery-labels":{title:"Hybrid [Reference]",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:Imagery:Labels",title:"Hybrid Reference Layer",isReference:!0}]},"arcgis-light-gray":{get thumbnailUrl(){return kr("esri/images/basemap/gray-vector.jpg")},title:"Light Gray Canvas",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:LightGray:Base",title:"Light Gray Canvas Base"},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:LightGray:Labels",title:"Light Gray Canvas Labels",isReference:!0}]},"arcgis-dark-gray":{get thumbnailUrl(){return kr("esri/images/basemap/dark-gray.jpg")},title:"Dark Gray Canvas",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:DarkGray:Base",title:"Dark Gray Canvas Base"},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:DarkGray:Labels",title:"Dark Gray Canvas Labels",isReference:!0}]},"arcgis-navigation":{get thumbnailUrl(){return kr("esri/images/basemap/streets-navigation.jpg")},title:"Navigation",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:Navigation",title:"World Navigation Map"}]},"arcgis-navigation-night":{title:"Navigation (Dark Mode)",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:NavigationNight",title:"World Navigation Map (Dark Mode)"}]},"arcgis-streets":{get thumbnailUrl(){return kr("esri/images/basemap/streets-vector.jpg")},title:"Streets",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:Streets",title:"World Street Map"}]},"arcgis-streets-night":{get thumbnailUrl(){return kr("esri/images/basemap/streets-night.jpg")},title:"Streets (Night)",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:StreetsNight",title:"World Street Map (Night)"}]},"arcgis-streets-relief":{get thumbnailUrl(){return kr("esri/images/basemap/streets-relief.jpg")},title:"Streets (with Relief)",baseMapLayers:[{layerType:"ArcGISTiledMapServiceLayer",showLegend:!1,title:"World Hillshade",url:"https://ibasemaps-api.arcgis.com/arcgis/rest/services/Elevation/World_Hillshade/MapServer"},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:StreetsRelief:Base",title:"World Street Map (with Relief)"}]},"arcgis-topographic":{get thumbnailUrl(){return kr("esri/images/basemap/topo.jpg")},title:"Topographic",baseMapLayers:[{layerType:"ArcGISTiledMapServiceLayer",showLegend:!1,title:"World Hillshade",url:"https://ibasemaps-api.arcgis.com/arcgis/rest/services/Elevation/World_Hillshade/MapServer"},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:Topographic:Base",title:"World Topographic Map"}]},"arcgis-oceans":{get thumbnailUrl(){return kr("esri/images/basemap/oceans.jpg")},title:"Oceans",baseMapLayers:[{layerType:"ArcGISTiledMapServiceLayer",showLegend:!1,title:"World Ocean Base",url:"https://ibasemaps-api.arcgis.com/arcgis/rest/services/Ocean/World_Ocean_Base/MapServer"},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:Oceans:Labels",title:"World Ocean Reference",isReference:!0}]},"osm-standard":{title:"OpenStreetMap",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/OSM:Standard",title:"OpenStreetMap"}]},"osm-standard-relief":{title:"OpenStreetMap (with relief)",baseMapLayers:[{layerType:"ArcGISTiledMapServiceLayer",showLegend:!1,title:"World Hillshade",url:"https://ibasemaps-api.arcgis.com/arcgis/rest/services/Elevation/World_Hillshade/MapServer"},{styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/OSM:StandardRelief:Base",layerType:"VectorTileLayer",title:"OpenStreetMap Relief Base"}]},"osm-streets":{title:"OpenStreetMap (Streets)",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/OSM:Streets",title:"OpenStreetMap (Streets)"}]},"osm-streets-relief":{title:"OpenStreetMap (Streets with relief)",baseMapLayers:[{layerType:"ArcGISTiledMapServiceLayer",showLegend:!1,title:"World Hillshade",url:"https://ibasemaps-api.arcgis.com/arcgis/rest/services/Elevation/World_Hillshade/MapServer"},{styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/OSM:StreetsRelief:Base",layerType:"VectorTileLayer",title:"OpenStreetMap Relief Base"}]},"osm-light-gray":{title:"OpenStreetMap (Light Gray Canvas)",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/OSM:LightGray:Base",title:"OSM (Light Gray Base)"},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/OSM:LightGray:Labels",title:"OSM (Light Gray Reference)",isReference:!0}]},"osm-dark-gray":{title:"OpenStreetMap (Dark Gray Canvas)",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/OSM:DarkGray:Base",title:"OSM (Dark Gray Base)"},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/OSM:DarkGray:Labels",title:"OSM (Dark Gray Reference)",isReference:!0}]},"arcgis-terrain":{title:"Terrain with Labels",baseMapLayers:[{layerType:"ArcGISTiledMapServiceLayer",showLegend:!1,title:"World Hillshade",url:"https://ibasemaps-api.arcgis.com/arcgis/rest/services/Elevation/World_Hillshade/MapServer"},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:Terrain:Base",title:"World Terrain Base"},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:Terrain:Detail",title:"World Terrain Reference",isReference:!0}]},"arcgis-community":{title:"Community",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:Community",title:"Community"}]},"arcgis-charted-territory":{title:"Charted Territory",baseMapLayers:[{layerType:"ArcGISTiledMapServiceLayer",showLegend:!1,title:"World Hillshade",url:"https://ibasemaps-api.arcgis.com/arcgis/rest/services/Elevation/World_Hillshade/MapServer"},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:ChartedTerritory:Base",title:"Charted Territory"}]},"arcgis-colored-pencil":{title:"Colored Pencil",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:ColoredPencil",title:"Colored Pencil"}]},"arcgis-nova":{title:"Nova",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:Nova",title:"Nova"}]},"arcgis-modern-antique":{title:"Modern Antique",baseMapLayers:[{layerType:"ArcGISTiledMapServiceLayer",showLegend:!1,title:"World Hillshade",url:"https://ibasemaps-api.arcgis.com/arcgis/rest/services/Elevation/World_Hillshade/MapServer"},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:ModernAntique:Base",title:"Modern Antique"}]},"arcgis-midcentury":{title:"Mid-Century",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:Midcentury",title:"Mid-Century"}]},"arcgis-newspaper":{title:"Newspaper",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:Newspaper",title:"Newspaper"}]},"arcgis-hillshade-light":{title:"Hillshade",baseMapLayers:[{layerType:"ArcGISTiledMapServiceLayer",showLegend:!1,title:"World Hillshade",url:"https://ibasemaps-api.arcgis.com/arcgis/rest/services/Elevation/World_Hillshade/MapServer"}]},"arcgis-hillshade-dark":{title:"Hillshade (Dark)",baseMapLayers:[{layerType:"ArcGISTiledMapServiceLayer",showLegend:!1,title:"World Hillshade (Dark)",url:"https://ibasemaps-api.arcgis.com/arcgis/rest/services/Elevation/World_Hillshade_Dark/MapServer"}]},"arcgis-human-geography":{title:"Human Geography",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:HumanGeography:Base",title:"Human Geography Base"},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:HumanGeography:Detail",title:"Human Geography Detail",isReference:!0},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:HumanGeography:Label",title:"Human Geography Label",isReference:!0}]},"arcgis-human-geography-dark":{title:"Human Geography (Dark)",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:HumanGeographyDark:Base",title:"Human Geography Dark Base"},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:HumanGeographyDark:Detail",title:"Human Geography Dark Detail",isReference:!0},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:HumanGeographyDark:Label",title:"Human Geography Dark Label",isReference:!0}]}},Tje=new Set(["bing-maps","imagery","imagery-tile","map-image","open-street-map","tile","unknown","unsupported","vector-tile","web-tile","wms","wmts"]),Sje=new Set(["csv","feature","geo-rss","geojson","group","imagery","imagery-tile","kml","map-image","map-notes","media","ogc-feature","route","stream","subtype-group","tile","unknown","unsupported","vector-tile","web-tile","wfs","wms","wmts"]);function Eje(t){return t.layerContainerType==="basemap"?Tje:t.layerContainerType==="operational-layers"?Sje:null}function Cje(t,e){if(e.restrictedWebMapWriting){const r=Eje(e);return r==null||r.has(t.type)&&!XW(t)}return!0}function Aje(t,e){if(e)if(XW(t)){const r=ug("featureCollection.layers",e),i=r&&r[0]&&r[0].layerDefinition;i&&Bte(t,i)}else t.type!=="group"&&Bte(t,e)}function Bte(t,e){"maxScale"in t&&(e.maxScale=JD(t.maxScale)??void 0),"minScale"in t&&(e.minScale=JD(t.minScale)??void 0)}function Oje(t,e){if(Aje(t,e),e&&("blendMode"in t&&(e.blendMode=t.blendMode,e.blendMode==="normal"&&delete e.blendMode),e.opacity=JD(t.opacity)??void 0,e.title=t.title||"Layer",e.visibility=t.visible,"legendEnabled"in t&&t.type!=="wmts"))if(XW(t)){const r=e.featureCollection;r&&(r.showLegend=t.legendEnabled)}else e.showLegend=t.legendEnabled}function Gte(t,e,r){if(!("write"in t)||!t.write)return r&&r.messages&&r.messages.push(new F("layer:unsupported",`Layers (${t.title}, ${t.id}) of type '${t.declaredClass}' cannot be persisted`,{layer:t})),null;if(Cje(t,r)){const i={};return t.write(i,r)?i:null}return e!=null&&Oje(t,e=K(e)),e}var RL;let Rje=0;const u1e="esri.Basemap";let Bu=RL=class extends K2(Fg){constructor(t){super(t),this.id=null,this.portalItem=null,this.spatialReference=null,this.thumbnailUrl=null,this.title="Basemap",this.id=Date.now().toString(16)+"-basemap-"+Rje++,this.baseLayers=new Pt,this.referenceLayers=new Pt;const e=i=>{i.parent&&i.parent!==this&&"remove"in i.parent&&i.parent.remove(i),i.parent=this,i.type==="elevation"&&Q.getLogger(this).error(`Layer '${i.title}, id:${i.id}' of type '${i.type}' is not supported as a basemap layer and will therefore be ignored.`)},r=i=>{i.parent=null};this.addHandles([this.baseLayers.on("after-add",i=>e(i.item)),this.referenceLayers.on("after-add",i=>e(i.item)),this.baseLayers.on("after-remove",i=>r(i.item)),this.referenceLayers.on("after-remove",i=>r(i.item))])}initialize(){this.when().catch(t=>{Q.getLogger(this).error("#load()",`Failed to load basemap (title: '${this.title}', id: '${this.id}')`,t)}),this.resourceInfo&&this.read(this.resourceInfo.data,this.resourceInfo.context)}destroy(){const t=this.baseLayers.removeAll();for(const r of t)r.destroy();const e=this.referenceLayers.removeAll();for(const r of e)r.destroy();this.baseLayers.destroy(),this.referenceLayers.destroy(),this.portalItem?.destroy(),this.portalItem=null}normalizeCtorArgs(t){return t&&"resourceInfo"in t&&(this._set("resourceInfo",t.resourceInfo),delete(t={...t}).resourceInfo),t}set baseLayers(t){this._set("baseLayers",ew(t,this._get("baseLayers")))}_writeBaseLayers(t,e,r){const i=[];t&&(r={...r,layerContainerType:"basemap"},this.baseLayers.forEach(s=>{const n=Gte(s,r.webmap?r.webmap.getLayerJSONFromResourceInfo(s):null,r);n!=null&&i.push(n)}),this.referenceLayers.forEach(s=>{const n=Gte(s,r.webmap?r.webmap.getLayerJSONFromResourceInfo(s):null,r);n!=null&&(s.type!=="scene"&&(n.isReference=!0),i.push(n))})),e.baseMapLayers=i}set referenceLayers(t){this._set("referenceLayers",ew(t,this._get("referenceLayers")))}writeTitle(t,e){e.title=t||"Basemap"}load(t){return this.addResolvingPromise(this._loadFromSource(t)),Promise.resolve(this)}loadAll(){return c1e(this,t=>{t(this.baseLayers,this.referenceLayers)})}clone(){const t={id:this.id,title:this.title,portalItem:this.portalItem,baseLayers:this.baseLayers.map(e=>RD(e)?e.clone():e),referenceLayers:this.referenceLayers.map(e=>RD(e)?e.clone():e)};return this.loaded&&(t.loadStatus="loaded"),new RL({resourceInfo:this.resourceInfo}).set(t)}read(t,e){this.resourceInfo||this._set("resourceInfo",{data:t,context:e}),super.read(t,e)}write(t,e){return t=t||{},e&&e.origin||(e={origin:"web-map",...e}),super.write(t,e),!this.loaded&&this.resourceInfo&&this.resourceInfo.data.baseMapLayers&&(t.baseMapLayers=this.resourceInfo.data.baseMapLayers.map(r=>{const i=K(r);return i.url&&Ff(i.url)&&(i.url=`https:${i.url}`),i.templateUrl&&Ff(i.templateUrl)&&(i.templateUrl=`https:${i.templateUrl}`),i})),t}async _loadFromSource(t){const{resourceInfo:e,portalItem:r}=this;Xt(t);const i=[];if(e){const s=e.context?e.context.url:null;if(i.push(this._loadLayersFromJSON(e.data,s,t)),e.data.id&&!e.data.title){const n=e.data.id;i.push(xje(n).then(o=>{o&&this.read({title:o},e.context)}))}}else r&&i.push(this._loadFromItem(r,t));await Promise.all(i)}async _loadLayersFromJSON(t,e,r){const i=this.resourceInfo&&this.resourceInfo.context,s=this.portalItem&&this.portalItem.portal||i&&i.portal||null,n=Mje[i?.origin||""]??"web-map",{populateOperationalLayers:o}=await ae(()=>import("./layersCreator-6878a58a.js"),["./layersCreator-6878a58a.js","./lazyLayerLoader-e6afee2b.js","./portalLayers-f0dc6cde.js","./layersLoader-85ab12d6.js","./fetchService-c1f8267d.js","./jsonContext-b0a6edd6.js"],import.meta.url),a=[];if(Xt(r),t.baseMapLayers&&Array.isArray(t.baseMapLayers)){const l={context:{origin:n,url:e,portal:s,layerContainerType:"basemap"},defaultLayerType:"DefaultTileLayer"},c=f=>n==="web-scene"&&f.layerType==="ArcGISSceneServiceLayer"||f.isReference,h=o(this.baseLayers,t.baseMapLayers.filter(f=>!c(f)),l);a.push(h);const p=o(this.referenceLayers,t.baseMapLayers.filter(c),l);a.push(p)}await Yf(a)}async _loadFromItem(t,e){const r=await t.load(e),i=await r.fetchData("json",e),s=cn(t.itemUrl??"");return this._set("resourceInfo",{data:i.baseMap??{},context:{origin:Pje[t.type||""]??"web-map",portal:t.portal||Qn.getDefault(),url:s}}),this.read(this.resourceInfo.data,this.resourceInfo.context),this.read({spatialReference:i.spatialReference},this.resourceInfo.context),this.read({title:t.title,thumbnailUrl:t.thumbnailUrl},{origin:"portal-item",portal:t.portal||Qn.getDefault(),url:s}),this._loadLayersFromJSON(this.resourceInfo.data,s,e)}static fromId(t){const e=j7[t];if(!e)return null;if(e.deprecated){let r=null;t==="dark-gray"?r="dark-gray-vector":t==="gray"?r="gray-vector":t==="streets"?r="streets-vector":t==="topo"&&(r="topo-vector"),MO(Q.getLogger(u1e),`The ${t} basemap has entered mature support and is no longer being updated.`,{replacement:r,see:"https://arcg.is/1iq8aD",warnOnce:!0})}return RL.fromJSON(e)}};u([d({json:{write:{ignoreOrigin:!0,target:"baseMapLayers",writer(t,e,r,i){this._writeBaseLayers(t,e,i)}},origins:{"web-scene":{write:{ignoreOrigin:!0,target:{baseMapLayers:{type:Pt}},writer(t,e,r,i){this._writeBaseLayers(t,e,i)}}}}}})],Bu.prototype,"baseLayers",null),u([d({type:String,json:{origins:{"web-scene":{write:!0}}}})],Bu.prototype,"id",void 0),u([d({type:Ab})],Bu.prototype,"portalItem",void 0),u([d()],Bu.prototype,"referenceLayers",null),u([d({readOnly:!0})],Bu.prototype,"resourceInfo",void 0),u([d({type:je})],Bu.prototype,"spatialReference",void 0),u([d()],Bu.prototype,"thumbnailUrl",void 0),u([d({type:String,json:{origins:{"web-scene":{write:{isRequired:!0}}}}})],Bu.prototype,"title",void 0),u([Fe("title")],Bu.prototype,"writeTitle",null),Bu=RL=u([R(u1e)],Bu);const Pje={"Web Scene":"web-scene","Web Map":"web-map","Link Chart":"link-chart"},Mje={"web-scene":"web-scene","web-map":"web-map","link-chart":"link-chart"},kN=Bu,Ije=Object.freeze(Object.defineProperty({__proto__:null,default:kN},Symbol.toStringTag,{value:"Module"}));var H7;let PL=H7=class extends de{constructor(t){super(t),this.type="none"}clone(){return new H7({type:this.type})}};u([tt({none:"none",stayAbove:"stay-above"})],PL.prototype,"type",void 0),PL=H7=u([R("esri.ground.NavigationConstraint")],PL);var q7;let Bm=q7=class extends K2(Fg){constructor(t){super(t),this.opacity=1,this.surfaceColor=null,this.navigationConstraint=null,this.layers=new Pt;const e=i=>{i.parent&&i.parent!==this&&"remove"in i.parent&&i.parent.remove(i),i.parent=this,i.type!=="elevation"&&i.type!=="base-elevation"&&Q.getLogger(this).error(`Layer '${i.title}, id:${i.id}' of type '${i.type}' is not supported as a ground layer and will therefore be ignored. Only layers of type 'elevation' are supported.`)},r=i=>{i.parent=null};this.addHandles([this.layers.on("after-add",i=>e(i.item)),this.layers.on("after-remove",i=>r(i.item))])}initialize(){this.when().catch(t=>{ms(t)||Q.getLogger(this).error("#load()","Failed to load ground",t)}),this.resourceInfo&&this.read(this.resourceInfo.data,this.resourceInfo.context)}destroy(){const t=this.layers.removeAll();for(const e of t)e.destroy();this.layers.destroy()}normalizeCtorArgs(t){return t&&"resourceInfo"in t&&(this._set("resourceInfo",t.resourceInfo),delete(t={...t}).resourceInfo),t}set layers(t){this._set("layers",ew(t,this._get("layers")))}writeLayers(t,e,r,i){const s=[];t&&(i={...i,layerContainerType:"ground"},t.forEach(n=>{if("write"in n){const o={};GUe(n)().write(o,i)&&s.push(o)}else i&&i.messages&&i.messages.push(new F("layer:unsupported",`Layers (${n.title}, ${n.id}) of type '${n.declaredClass}' cannot be persisted in the ground`,{layer:n}))})),e.layers=s}load(t){return this.addResolvingPromise(this._loadFromSource(t)),Promise.resolve(this)}loadAll(){return c1e(this,t=>{t(this.layers)})}async queryElevation(t,e){await this.load({signal:e?.signal});const{ElevationQuery:r}=await ae(()=>import("./ElevationQuery-09f7f5d1.js"),[],import.meta.url);Xt(e);const i=new r,s=this.layers.filter(jte).toArray();return i.queryAll(s,t,e)}async createElevationSampler(t,e){await this.load({signal:e?.signal});const{ElevationQuery:r}=await ae(()=>import("./ElevationQuery-09f7f5d1.js"),[],import.meta.url);Xt(e);const i=new r,s=this.layers.filter(jte).toArray();return i.createSamplerAll(s,t,e)}clone(){const t={opacity:this.opacity,surfaceColor:K(this.surfaceColor),navigationConstraint:K(this.navigationConstraint),layers:this.layers.slice()};return this.loaded&&(t.loadStatus="loaded"),new q7({resourceInfo:this.resourceInfo}).set(t)}read(t,e){this.resourceInfo||this._set("resourceInfo",{data:t,context:e}),super.read(t,e)}_loadFromSource(t){const e=this.resourceInfo;return e?this._loadLayersFromJSON(e.data,e.context,t):Promise.resolve()}_loadLayersFromJSON(t,e,r){const i=e&&e.origin||"web-scene",s=e&&e.portal||null,n=e&&e.url||null;return ae(()=>import("./layersCreator-6878a58a.js"),["./layersCreator-6878a58a.js","./lazyLayerLoader-e6afee2b.js","./portalLayers-f0dc6cde.js","./layersLoader-85ab12d6.js","./fetchService-c1f8267d.js","./jsonContext-b0a6edd6.js"],import.meta.url).then(({populateOperationalLayers:o})=>{Xt(r);const a=[];if(t.layers&&Array.isArray(t.layers)){const l={context:{origin:i,url:n,portal:s,layerContainerType:"ground"},defaultLayerType:"ArcGISTiledElevationServiceLayer"};a.push(o(this.layers,t.layers,l))}return Yf(a)}).then(()=>{})}};function $je(t){return t&&"createElevationSampler"in t}function jte(t){return t.type==="elevation"||$je(t)}u([d({json:{read:!1}})],Bm.prototype,"layers",null),u([Fe("layers")],Bm.prototype,"writeLayers",null),u([d({readOnly:!0})],Bm.prototype,"resourceInfo",void 0),u([d({type:Number,nonNullable:!0,range:{min:0,max:1},json:{type:Xi,read:{reader:s2,source:"transparency"},write:{writer:(t,e)=>{e.transparency=jF(t)},target:"transparency"}}})],Bm.prototype,"opacity",void 0),u([d({type:ze,json:{type:[Xi],write:(t,e)=>{e.surfaceColor=t.toJSON().slice(0,3)}}})],Bm.prototype,"surfaceColor",void 0),u([d({type:PL,json:{write:!0}})],Bm.prototype,"navigationConstraint",void 0),Bm=q7=u([R("esri.Ground")],Bm);const VN=Bm;let RT=class extends Pt{constructor(e){super(e),this.getCollections=null}initialize(){this.own(_pe(()=>this._refresh()))}destroy(){this.getCollections=null}_refresh(){const e=this.getCollections!=null?this.getCollections():null;if(e==null)return void this.removeAll();let r=0;for(const i of e)i!=null&&(r=this._processCollection(r,i));this.splice(r,this.length)}_createNewInstance(e){return new Pt(e)}_processCollection(e,r){if(!r)return e;const i=this.itemFilterFunction??(s=>!!s);for(const s of r)if(s){if(i(s)){const n=this.indexOf(s,e);n>=0?n!==e&&this.reorder(s,e):this.add(s,e),++e}if(this.getChildrenFunction){const n=this.getChildrenFunction(s);if(Array.isArray(n))for(const o of n)e=this._processCollection(e,o);else e=this._processCollection(e,n)}}return e}};u([d()],RT.prototype,"getCollections",void 0),u([d()],RT.prototype,"getChildrenFunction",void 0),u([d()],RT.prototype,"itemFilterFunction",void 0),RT=u([R("esri.core.CollectionFlattener")],RT);const zO=RT,Hte=Q.getLogger("esri.support.basemapUtils");function Lje(){return{}}function Dje(t){for(const e in t){const r=t[e];r?.destroyed===!1&&r.destroy(),delete t[e]}}function Nje(t,e){let r;if(typeof t=="string"){if(!(t in j7)){const i=Object.entries(j7).filter(([s,n])=>Ur.apiKey&&!n.classic||!Ur.apiKey&&n.classic&&!n.deprecated).map(([s])=>`"${s}"`).join(", ");return Hte.warn(`Unable to find basemap definition for: ${t}. Try one of these: ${i}`),null}e&&(r=e[t]),r||(r=kN.fromId(t),e&&(e[t]=r))}else r=Zs(kN,t);return r?.destroyed&&(Hte.warn("The provided basemap is already destroyed",{basemap:r}),r=null),r}function Fje(t){return new zO({getCollections:()=>[t.tables,t.layers],getChildrenFunction:e=>{const r=[];return"tables"in e&&r.push(e.tables),"layers"in e&&r.push(e.layers),r},itemFilterFunction:e=>{const r=e.parent;return!!r&&"tables"in r&&r.tables.includes(e)}})}function FU(t){for(const e of t.values())e?.destroy();t.clear()}const qte={"world-elevation":{id:"worldElevation",url:"//elevation3d.arcgis.com/arcgis/rest/services/WorldElevation3D/Terrain3D/ImageServer",layerType:"ArcGISTiledElevationServiceLayer"},"world-topobathymetry":{id:"worldTopoBathymetry",url:"//elevation3d.arcgis.com/arcgis/rest/services/WorldElevation3D/TopoBathy3D/ImageServer",layerType:"ArcGISTiledElevationServiceLayer"}};function Uje(t){let e=null;if(typeof t=="string")if(t in qte){const r=qte[t];e=new VN({resourceInfo:{data:{layers:[r]}}})}else Q.getLogger("esri.support.groundUtils").warn(`Unable to find ground definition for: ${t}. Try "world-elevation"`);else e=Zs(VN,t);return e}function W7(t,e,r){let i,s;if(t)for(let n=0,o=t.length;n<o;n++){if(i=t.at(n),i?.[e]===r)return i;if(i?.type==="group"&&(s=W7(i.layers,e,r),s))return s}}const kje=t=>{let e=class extends t{constructor(...r){super(...r),this.layers=new Pt;const i=o=>{o.parent&&"remove"in o.parent&&o.parent.remove(o)},s=o=>{o.parent=this,this.layerAdded(o),o.type!=="elevation"&&o.type!=="base-elevation"||Q.getLogger(this).error(`Layer 'title:${o.title}, id:${o.id}' of type '${o.type}' is not supported as an operational layer and will therefore be ignored.`)},n=o=>{o.parent=null,this.layerRemoved(o)};this.addHandles([this.layers.on("before-add",o=>i(o.item)),this.layers.on("after-add",o=>s(o.item)),this.layers.on("after-remove",o=>n(o.item))])}destroy(){const r=this.layers.toArray();for(const i of r)i.destroy();this.layers.destroy()}set layers(r){this._set("layers",ew(r,this._get("layers")))}add(r,i){const s=this.layers;if(i=s.getNextIndex(i),r instanceof mZ){const n=r;n.parent===this?this.reorder(n,i):s.add(n,i)}else bu(r)?r.then(n=>{this.destroyed||this.add(n,i)}):Q.getLogger(this).error("#add()","The item being added is not a Layer or a Promise that resolves to a Layer.")}addMany(r,i){const s=this.layers;let n=s.getNextIndex(i);r.slice().forEach(o=>{o.parent!==this?(s.add(o,n),n+=1):this.reorder(o,n)})}findLayerById(r){return W7(this.layers,"id",r)}findLayerByUid(r){return W7(this.layers,"uid",r)}remove(r){return this.layers.remove(r)}removeMany(r){return this.layers.removeMany(r)}removeAll(){return this.layers.removeAll()}reorder(r,i){return this.layers.reorder(r,i)}layerAdded(r){}layerRemoved(r){}};return u([d()],e.prototype,"layers",null),e=u([R("esri.support.LayersMixin")],e),e};function Z7(t,e,r){if(t)for(let i=0,s=t.length;i<s;i++){const n=t.at(i);if(n[e]===r)return n;if(n?.type==="group"){const o=Z7(n.tables,e,r);if(o)return o}}}const Vje=t=>{let e=class extends t{constructor(...r){super(...r),this.tables=new Pt,this.addHandles([this.tables.on("after-add",i=>{const s=i.item;s.parent&&s.parent!==this&&"tables"in s.parent&&s.parent.tables.remove(s),s.parent=this,s.type!=="feature"&&Q.getLogger(this).error(`Layer 'title:${s.title}, id:${s.id}' of type '${s.type}' is not supported as a table and will therefore be ignored.`)}),this.tables.on("after-remove",i=>{i.item.parent=null})])}destroy(){const r=this.tables.removeAll();for(const i of r)i.destroy();this.tables.destroy()}set tables(r){this._set("tables",ew(r,this._get("tables")))}findTableById(r){return Z7(this.tables,"id",r)}findTableByUid(r){return Z7(this.tables,"uid",r)}};return u([d()],e.prototype,"tables",null),e=u([R("esri.support.TablesMixin")],e),e};let Yp=class extends Vje(kje(os.EventedMixin(Te))){constructor(e){super(e),this.allLayers=new zO({getCollections:()=>[this.basemap?.baseLayers,this.ground?.layers,this.layers,this.basemap?.referenceLayers],getChildrenFunction:r=>"layers"in r?r.layers:null}),this.allTables=Fje(this),this.basemap=null,this.editableLayers=new zO({getCollections:()=>[this.allLayers],itemFilterFunction:u8e}),this.ground=new VN,this._basemapCache=Lje()}destroy(){this.allLayers.destroy(),this.allTables.destroy(),this.editableLayers.destroy(),this.ground?.destroy(),this.basemap?.destroy(),Dje(this._basemapCache),this._basemapCache=null}castBasemap(e){return Nje(e,this._basemapCache)}castGround(e){return Uje(e)??this._get("ground")}findLayerById(e){return this.allLayers.find(r=>r.id===e)}findTableById(e){return this.allTables.find(r=>r.id===e)}};u([d({readOnly:!0,dependsOn:[]})],Yp.prototype,"allLayers",void 0),u([d({readOnly:!0})],Yp.prototype,"allTables",void 0),u([d({type:kN})],Yp.prototype,"basemap",void 0),u([yr("basemap")],Yp.prototype,"castBasemap",null),u([d({readOnly:!0})],Yp.prototype,"editableLayers",void 0),u([d({type:VN,nonNullable:!0})],Yp.prototype,"ground",void 0),u([yr("ground")],Yp.prototype,"castGround",null),Yp=u([R("esri.Map")],Yp);const h1e=Yp,dM="esri-identity-form",Ac={base:dM,group:`${dM}__group`,label:`${dM}__label`,footer:`${dM}__footer`,esriInput:"esri-input",esriButton:"esri-button",esriButtonSecondary:"esri-button--secondary"},zje="ArcGIS Online";let Gm=class extends Aw{constructor(e,r){super(e,r),this._usernameInputNode=null,this._passwordInputNode=null,this.signingIn=!1,this.server=null,this.resource=null,this.error=null,this.oAuthPrompt=!1}render(){const{error:e,server:r,resource:i,signingIn:s,oAuthPrompt:n,messages:o}=this,a=Gr("div",{class:Ac.group},gMe(n?o.oAuthInfo:o.info,{server:r&&/\.arcgis\.com/i.test(r)?zje:r,resource:`(${i||o.lblItem})`})),l=n?null:Gr("div",{class:Ac.group,key:"username"},Gr("label",{class:Ac.label},o.lblUser,Gr("input",{value:"",required:!0,autocomplete:"off",spellcheck:!1,type:"text",bind:this,afterCreate:EK,"data-node-ref":"_usernameInputNode",class:Ac.esriInput}))),c=n?null:Gr("div",{class:Ac.group,key:"password"},Gr("label",{class:Ac.label},o.lblPwd,Gr("input",{value:"",required:!0,type:"password",bind:this,afterCreate:EK,"data-node-ref":"_passwordInputNode",class:Ac.esriInput}))),h=Gr("div",{class:this.classes(Ac.group,Ac.footer)},Gr("input",{type:"submit",disabled:!!s,value:s?o.lblSigning:o.lblOk,class:Ac.esriButton}),Gr("input",{type:"button",value:o.lblCancel,bind:this,onclick:this._cancel,class:this.classes(Ac.esriButton,Ac.esriButtonSecondary)})),p=e?Gr("div",null,e.details&&e.details.httpStatus?o.invalidUser:o.noAuthService):null;return Gr("form",{class:Ac.base,bind:this,onsubmit:this._submit},a,p,l,c,h)}_cancel(){this._set("signingIn",!1),this._usernameInputNode&&(this._usernameInputNode.value=""),this._passwordInputNode&&(this._passwordInputNode.value=""),this.emit("cancel")}_submit(e){e.preventDefault(),this._set("signingIn",!0);const r=this.oAuthPrompt?{}:{username:this._usernameInputNode&&this._usernameInputNode.value,password:this._passwordInputNode&&this._passwordInputNode.value};this.emit("submit",r)}};u([d(),sE("esri/identity/t9n/identity")],Gm.prototype,"messages",void 0),u([d()],Gm.prototype,"signingIn",void 0),u([d()],Gm.prototype,"server",void 0),u([d()],Gm.prototype,"resource",void 0),u([d()],Gm.prototype,"error",void 0),u([d()],Gm.prototype,"oAuthPrompt",void 0),Gm=u([R("esri.identity.IdentityForm")],Gm);const Bje=Gm;/*!
* tabbable 6.1.2
* @license MIT, https://github.com/focus-trap/tabbable/blob/master/LICENSE
*/var d1e=["input:not([inert])","select:not([inert])","textarea:not([inert])","a[href]:not([inert])","button:not([inert])","[tabindex]:not(slot):not([inert])","audio[controls]:not([inert])","video[controls]:not([inert])",'[contenteditable]:not([contenteditable="false"]):not([inert])',"details>summary:first-of-type:not([inert])","details:not([inert])"],zN=d1e.join(","),p1e=typeof Element>"u",nw=p1e?function(){}:Element.prototype.matches||Element.prototype.msMatchesSelector||Element.prototype.webkitMatchesSelector,BN=!p1e&&Element.prototype.getRootNode?function(t){var e;return t==null||(e=t.getRootNode)===null||e===void 0?void 0:e.call(t)}:function(t){return t?.ownerDocument},GN=function t(e,r){var i;r===void 0&&(r=!0);var s=e==null||(i=e.getAttribute)===null||i===void 0?void 0:i.call(e,"inert"),n=s===""||s==="true",o=n||r&&e&&t(e.parentNode);return o},Gje=function(e){var r,i=e==null||(r=e.getAttribute)===null||r===void 0?void 0:r.call(e,"contenteditable");return i===""||i==="true"},f1e=function(e,r,i){if(GN(e))return[];var s=Array.prototype.slice.apply(e.querySelectorAll(zN));return r&&nw.call(e,zN)&&s.unshift(e),s=s.filter(i),s},m1e=function t(e,r,i){for(var s=[],n=Array.from(e);n.length;){var o=n.shift();if(!GN(o,!1))if(o.tagName==="SLOT"){var a=o.assignedElements(),l=a.length?a:o.children,c=t(l,!0,i);i.flatten?s.push.apply(s,c):s.push({scopeParent:o,candidates:c})}else{var h=nw.call(o,zN);h&&i.filter(o)&&(r||!e.includes(o))&&s.push(o);var p=o.shadowRoot||typeof i.getShadowRoot=="function"&&i.getShadowRoot(o),f=!GN(p,!1)&&(!i.shadowRootFilter||i.shadowRootFilter(o));if(p&&f){var m=t(p===!0?o.children:p.children,!0,i);i.flatten?s.push.apply(s,m):s.push({scopeParent:o,candidates:m})}else n.unshift.apply(n,o.children)}}return s},g1e=function(e,r){return e.tabIndex<0&&(r||/^(AUDIO|VIDEO|DETAILS)$/.test(e.tagName)||Gje(e))&&isNaN(parseInt(e.getAttribute("tabindex"),10))?0:e.tabIndex},jje=function(e,r){return e.tabIndex===r.tabIndex?e.documentOrder-r.documentOrder:e.tabIndex-r.tabIndex},y1e=function(e){return e.tagName==="INPUT"},Hje=function(e){return y1e(e)&&e.type==="hidden"},qje=function(e){var r=e.tagName==="DETAILS"&&Array.prototype.slice.apply(e.children).some(function(i){return i.tagName==="SUMMARY"});return r},Wje=function(e,r){for(var i=0;i<e.length;i++)if(e[i].checked&&e[i].form===r)return e[i]},Zje=function(e){if(!e.name)return!0;var r=e.form||BN(e),i=function(a){return r.querySelectorAll('input[type="radio"][name="'+a+'"]')},s;if(typeof window<"u"&&typeof window.CSS<"u"&&typeof window.CSS.escape=="function")s=i(window.CSS.escape(e.name));else try{s=i(e.name)}catch(o){return console.error("Looks like you have a radio button with a name attribute containing invalid CSS selector characters and need the CSS.escape polyfill: %s",o.message),!1}var n=Wje(s,e.form);return!n||n===e},Xje=function(e){return y1e(e)&&e.type==="radio"},Yje=function(e){return Xje(e)&&!Zje(e)},Jje=function(e){var r,i=e&&BN(e),s=(r=i)===null||r===void 0?void 0:r.host,n=!1;if(i&&i!==e){var o,a,l;for(n=!!((o=s)!==null&&o!==void 0&&(a=o.ownerDocument)!==null&&a!==void 0&&a.contains(s)||e!=null&&(l=e.ownerDocument)!==null&&l!==void 0&&l.contains(e));!n&&s;){var c,h,p;i=BN(s),s=(c=i)===null||c===void 0?void 0:c.host,n=!!((h=s)!==null&&h!==void 0&&(p=h.ownerDocument)!==null&&p!==void 0&&p.contains(s))}}return n},Wte=function(e){var r=e.getBoundingClientRect(),i=r.width,s=r.height;return i===0&&s===0},Qje=function(e,r){var i=r.displayCheck,s=r.getShadowRoot;if(getComputedStyle(e).visibility==="hidden")return!0;var n=nw.call(e,"details>summary:first-of-type"),o=n?e.parentElement:e;if(nw.call(o,"details:not([open]) *"))return!0;if(!i||i==="full"||i==="legacy-full"){if(typeof s=="function"){for(var a=e;e;){var l=e.parentElement,c=BN(e);if(l&&!l.shadowRoot&&s(l)===!0)return Wte(e);e.assignedSlot?e=e.assignedSlot:!l&&c!==e.ownerDocument?e=c.host:e=l}e=a}if(Jje(e))return!e.getClientRects().length;if(i!=="legacy-full")return!0}else if(i==="non-zero-area")return Wte(e);return!1},Kje=function(e){if(/^(INPUT|BUTTON|SELECT|TEXTAREA)$/.test(e.tagName))for(var r=e.parentElement;r;){if(r.tagName==="FIELDSET"&&r.disabled){for(var i=0;i<r.children.length;i++){var s=r.children.item(i);if(s.tagName==="LEGEND")return nw.call(r,"fieldset[disabled] *")?!0:!s.contains(e)}return!0}r=r.parentElement}return!1},jN=function(e,r){return!(r.disabled||GN(r)||Hje(r)||Qje(r,e)||qje(r)||Kje(r))},X7=function(e,r){return!(Yje(r)||g1e(r)<0||!jN(e,r))},eHe=function(e){var r=parseInt(e.getAttribute("tabindex"),10);return!!(isNaN(r)||r>=0)},tHe=function t(e){var r=[],i=[];return e.forEach(function(s,n){var o=!!s.scopeParent,a=o?s.scopeParent:s,l=g1e(a,o),c=o?t(s.candidates):a;l===0?o?r.push.apply(r,c):r.push(a):i.push({documentOrder:n,tabIndex:l,item:s,isScope:o,content:c})}),i.sort(jje).reduce(function(s,n){return n.isScope?s.push.apply(s,n.content):s.push(n.content),s},[]).concat(r)},rHe=function(e,r){r=r||{};var i;return r.getShadowRoot?i=m1e([e],r.includeContainer,{filter:X7.bind(null,r),flatten:!1,getShadowRoot:r.getShadowRoot,shadowRootFilter:eHe}):i=f1e(e,r.includeContainer,X7.bind(null,r)),tHe(i)},iHe=function(e,r){r=r||{};var i;return r.getShadowRoot?i=m1e([e],r.includeContainer,{filter:jN.bind(null,r),flatten:!0,getShadowRoot:r.getShadowRoot}):i=f1e(e,r.includeContainer,jN.bind(null,r)),i},pM=function(e,r){if(r=r||{},!e)throw new Error("No node provided");return nw.call(e,zN)===!1?!1:X7(r,e)},sHe=d1e.concat("iframe").join(","),UU=function(e,r){if(r=r||{},!e)throw new Error("No node provided");return nw.call(e,sHe)===!1?!1:jN(r,e)};/*!
* focus-trap 7.4.3
* @license MIT, https://github.com/focus-trap/focus-trap/blob/master/LICENSE
*/function Zte(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);e&&(i=i.filter(function(s){return Object.getOwnPropertyDescriptor(t,s).enumerable})),r.push.apply(r,i)}return r}function Xte(t){for(var e=1;e<arguments.length;e++){var r=arguments[e]!=null?arguments[e]:{};e%2?Zte(Object(r),!0).forEach(function(i){nHe(t,i,r[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):Zte(Object(r)).forEach(function(i){Object.defineProperty(t,i,Object.getOwnPropertyDescriptor(r,i))})}return t}function nHe(t,e,r){return e=aHe(e),e in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}function oHe(t,e){if(typeof t!="object"||t===null)return t;var r=t[Symbol.toPrimitive];if(r!==void 0){var i=r.call(t,e||"default");if(typeof i!="object")return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(t)}function aHe(t){var e=oHe(t,"string");return typeof e=="symbol"?e:String(e)}var Yte={activateTrap:function(e,r){if(e.length>0){var i=e[e.length-1];i!==r&&i.pause()}var s=e.indexOf(r);s===-1||e.splice(s,1),e.push(r)},deactivateTrap:function(e,r){var i=e.indexOf(r);i!==-1&&e.splice(i,1),e.length>0&&e[e.length-1].unpause()}},lHe=function(e){return e.tagName&&e.tagName.toLowerCase()==="input"&&typeof e.select=="function"},cHe=function(e){return e.key==="Escape"||e.key==="Esc"||e.keyCode===27},U3=function(e){return e.key==="Tab"||e.keyCode===9},uHe=function(e){return U3(e)&&!e.shiftKey},hHe=function(e){return U3(e)&&e.shiftKey},Jte=function(e){return setTimeout(e,0)},Qte=function(e,r){var i=-1;return e.every(function(s,n){return r(s)?(i=n,!1):!0}),i},GE=function(e){for(var r=arguments.length,i=new Array(r>1?r-1:0),s=1;s<r;s++)i[s-1]=arguments[s];return typeof e=="function"?e.apply(void 0,i):e},fM=function(e){return e.target.shadowRoot&&typeof e.composedPath=="function"?e.composedPath()[0]:e.target},dHe=[],pHe=function(e,r){var i=r?.document||document,s=r?.trapStack||dHe,n=Xte({returnFocusOnDeactivate:!0,escapeDeactivates:!0,delayInitialFocus:!0,isKeyForward:uHe,isKeyBackward:hHe},r),o={containers:[],containerGroups:[],tabbableGroups:[],nodeFocusedBeforeActivation:null,mostRecentlyFocusedNode:null,active:!1,paused:!1,delayInitialFocusTimer:void 0},a,l=function(L,D,U){return L&&L[D]!==void 0?L[D]:n[U||D]},c=function(L,D){var U=typeof D?.composedPath=="function"?D.composedPath():void 0;return o.containerGroups.findIndex(function(X){var W=X.container,G=X.tabbableNodes;return W.contains(L)||U?.includes(W)||G.find(function(Y){return Y===L})})},h=function(L){var D=n[L];if(typeof D=="function"){for(var U=arguments.length,X=new Array(U>1?U-1:0),W=1;W<U;W++)X[W-1]=arguments[W];D=D.apply(void 0,X)}if(D===!0&&(D=void 0),!D){if(D===void 0||D===!1)return D;throw new Error("`".concat(L,"` was specified but was not a node, or did not return a node"))}var G=D;if(typeof D=="string"&&(G=i.querySelector(D),!G))throw new Error("`".concat(L,"` as selector refers to no known node"));return G},p=function(){var L=h("initialFocus");if(L===!1)return!1;if(L===void 0||!UU(L,n.tabbableOptions))if(c(i.activeElement)>=0)L=i.activeElement;else{var D=o.tabbableGroups[0],U=D&&D.firstTabbableNode;L=U||h("fallbackFocus")}if(!L)throw new Error("Your focus-trap needs to have at least one focusable element");return L},f=function(){if(o.containerGroups=o.containers.map(function(L){var D=rHe(L,n.tabbableOptions),U=iHe(L,n.tabbableOptions);return{container:L,tabbableNodes:D,focusableNodes:U,firstTabbableNode:D.length>0?D[0]:null,lastTabbableNode:D.length>0?D[D.length-1]:null,nextTabbableNode:function(W){var G=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0,Y=U.findIndex(function(P){return P===W});if(!(Y<0))return G?U.slice(Y+1).find(function(P){return pM(P,n.tabbableOptions)}):U.slice(0,Y).reverse().find(function(P){return pM(P,n.tabbableOptions)})}}}),o.tabbableGroups=o.containerGroups.filter(function(L){return L.tabbableNodes.length>0}),o.tabbableGroups.length<=0&&!h("fallbackFocus"))throw new Error("Your focus-trap must have at least one container with at least one tabbable node in it at all times")},m=function k(L){if(L!==!1&&L!==i.activeElement){if(!L||!L.focus){k(p());return}L.focus({preventScroll:!!n.preventScroll}),o.mostRecentlyFocusedNode=L,lHe(L)&&L.select()}},y=function(L){var D=h("setReturnFocus",L);return D||(D===!1?!1:L)},_=function(L){var D=fM(L);if(!(c(D,L)>=0)){if(GE(n.clickOutsideDeactivates,L)){a.deactivate({returnFocus:n.returnFocusOnDeactivate});return}GE(n.allowOutsideClick,L)||L.preventDefault()}},v=function(L){var D=fM(L),U=c(D,L)>=0;U||D instanceof Document?U&&(o.mostRecentlyFocusedNode=D):(L.stopImmediatePropagation(),m(o.mostRecentlyFocusedNode||p()))},w=function(L){var D=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1,U=fM(L);f();var X=null;if(o.tabbableGroups.length>0){var W=c(U,L),G=W>=0?o.containerGroups[W]:void 0;if(W<0)D?X=o.tabbableGroups[o.tabbableGroups.length-1].lastTabbableNode:X=o.tabbableGroups[0].firstTabbableNode;else if(D){var Y=Qte(o.tabbableGroups,function(J){var re=J.firstTabbableNode;return U===re});if(Y<0&&(G.container===U||UU(U,n.tabbableOptions)&&!pM(U,n.tabbableOptions)&&!G.nextTabbableNode(U,!1))&&(Y=W),Y>=0){var P=Y===0?o.tabbableGroups.length-1:Y-1,V=o.tabbableGroups[P];X=V.lastTabbableNode}else U3(L)||(X=G.nextTabbableNode(U,!1))}else{var z=Qte(o.tabbableGroups,function(J){var re=J.lastTabbableNode;return U===re});if(z<0&&(G.container===U||UU(U,n.tabbableOptions)&&!pM(U,n.tabbableOptions)&&!G.nextTabbableNode(U))&&(z=W),z>=0){var H=z===o.tabbableGroups.length-1?0:z+1,Z=o.tabbableGroups[H];X=Z.firstTabbableNode}else U3(L)||(X=G.nextTabbableNode(U))}}else X=h("fallbackFocus");X&&(U3(L)&&L.preventDefault(),m(X))},x=function(L){if(cHe(L)&&GE(n.escapeDeactivates,L)!==!1){L.preventDefault(),a.deactivate();return}(n.isKeyForward(L)||n.isKeyBackward(L))&&w(L,n.isKeyBackward(L))},T=function(L){var D=fM(L);c(D,L)>=0||GE(n.clickOutsideDeactivates,L)||GE(n.allowOutsideClick,L)||(L.preventDefault(),L.stopImmediatePropagation())},S=function(){if(o.active)return Yte.activateTrap(s,a),o.delayInitialFocusTimer=n.delayInitialFocus?Jte(function(){m(p())}):m(p()),i.addEventListener("focusin",v,!0),i.addEventListener("mousedown",_,{capture:!0,passive:!1}),i.addEventListener("touchstart",_,{capture:!0,passive:!1}),i.addEventListener("click",T,{capture:!0,passive:!1}),i.addEventListener("keydown",x,{capture:!0,passive:!1}),a},O=function(){if(o.active)return i.removeEventListener("focusin",v,!0),i.removeEventListener("mousedown",_,!0),i.removeEventListener("touchstart",_,!0),i.removeEventListener("click",T,!0),i.removeEventListener("keydown",x,!0),a},A=function(L){var D=L.some(function(U){var X=Array.from(U.removedNodes);return X.some(function(W){return W===o.mostRecentlyFocusedNode})});D&&m(p())},I=typeof window<"u"&&"MutationObserver"in window?new MutationObserver(A):void 0,M=function(){I&&(I.disconnect(),o.active&&!o.paused&&o.containers.map(function(L){I.observe(L,{subtree:!0,childList:!0})}))};return a={get active(){return o.active},get paused(){return o.paused},activate:function(L){if(o.active)return this;var D=l(L,"onActivate"),U=l(L,"onPostActivate"),X=l(L,"checkCanFocusTrap");X||f(),o.active=!0,o.paused=!1,o.nodeFocusedBeforeActivation=i.activeElement,D?.();var W=function(){X&&f(),S(),M(),U?.()};return X?(X(o.containers.concat()).then(W,W),this):(W(),this)},deactivate:function(L){if(!o.active)return this;var D=Xte({onDeactivate:n.onDeactivate,onPostDeactivate:n.onPostDeactivate,checkCanReturnFocus:n.checkCanReturnFocus},L);clearTimeout(o.delayInitialFocusTimer),o.delayInitialFocusTimer=void 0,O(),o.active=!1,o.paused=!1,M(),Yte.deactivateTrap(s,a);var U=l(D,"onDeactivate"),X=l(D,"onPostDeactivate"),W=l(D,"checkCanReturnFocus"),G=l(D,"returnFocus","returnFocusOnDeactivate");U?.();var Y=function(){Jte(function(){G&&m(y(o.nodeFocusedBeforeActivation)),X?.()})};return G&&W?(W(y(o.nodeFocusedBeforeActivation)).then(Y,Y),this):(Y(),this)},pause:function(L){if(o.paused||!o.active)return this;var D=l(L,"onPause"),U=l(L,"onPostPause");return o.paused=!0,D?.(),O(),M(),U?.(),this},unpause:function(L){if(!o.paused||!o.active)return this;var D=l(L,"onUnpause"),U=l(L,"onPostUnpause");return o.paused=!1,D?.(),f(),S(),M(),U?.(),this},updateContainerElements:function(L){var D=[].concat(L).filter(Boolean);return o.containers=D.map(function(U){return typeof U=="string"?i.querySelector(U):U}),o.active&&f(),M(),this}},a.updateContainerElements(e),a};const fv="esri-identity-modal",bp={base:fv,open:`${fv}--open`,closed:`${fv}--closed`,title:`${fv}__title`,dialog:`${fv}__dialog`,content:`${fv}__content`,closeButton:`${fv}__close-button`,iconClose:"esri-icon-close"};let u0=class extends Aw{constructor(e,r){super(e,r),this.container=document.createElement("div"),this.content=null,this.open=!1,this._focusTrap=null,this._close=()=>{this.open=!1},document.body.appendChild(this.container),this.addHandles(le(()=>this.open,()=>this._toggleFocusTrap()))}destroy(){this._destroyFocusTrap()}get title(){return this.messages?.auth.signIn}render(){const e=this.id,{open:r,content:i,title:s,messages:n}=this,o=r&&!!i,a={[bp.open]:o,[bp.closed]:!o},l=Gr("button",{class:bp.closeButton,"aria-label":n.close,title:n.close,bind:this,onclick:this._close,type:"button"},Gr("span",{"aria-hidden":"true",class:bp.iconClose})),c=`${e}_title`,h=`${e}_content`,p=s?Gr("h1",{id:c,class:bp.title},s):null,f=o?Gr("div",{bind:this,class:bp.dialog,role:"dialog","aria-labelledby":c,"aria-describedby":h,afterCreate:this._createFocusTrap},l,p,this._renderContent(h)):null;return Gr("div",{tabIndex:-1,class:this.classes(bp.base,a)},f)}_destroyFocusTrap(){this._focusTrap?.deactivate({onDeactivate:()=>{}}),this._focusTrap=null}_toggleFocusTrap(){const{_focusTrap:e,open:r}=this;e&&(r?e.activate():e.deactivate())}_createFocusTrap(e){this._destroyFocusTrap();const r=requestAnimationFrame(()=>{this._focusTrap=pHe(e,{initialFocus:"input",onDeactivate:this._close}),this._toggleFocusTrap()});this.addHandles(bo(()=>cancelAnimationFrame(r)))}_renderContent(e){const r=this.content;return typeof r=="string"?Gr("div",{class:bp.content,id:e,innerHTML:r}):vje(r)?Gr("div",{class:bp.content,id:e},r.render()):r instanceof HTMLElement?Gr("div",{class:bp.content,id:e,bind:r,afterCreate:this._attachToNode}):null}_attachToNode(e){const r=this;e.appendChild(r)}};u([d({readOnly:!0})],u0.prototype,"container",void 0),u([d()],u0.prototype,"content",void 0),u([d()],u0.prototype,"open",void 0),u([d(),sE("esri/t9n/common")],u0.prototype,"messages",void 0),u([d()],u0.prototype,"title",null),u0=u([R("esri.identity.IdentityModal")],u0);const Kte=u0,kU="esriJSAPIOAuth";let Y7=class{constructor(e,r){this.oAuthInfo=null,this.storage=null,this.appId=null,this.codeVerifier=null,this.expires=null,this.refreshToken=null,this.ssl=null,this.stateUID=null,this.token=null,this.userId=null,this.oAuthInfo=e,this.storage=r,this._init()}isValid(){let e=!1;if(this.oAuthInfo&&this.userId&&(this.refreshToken||this.token)){if(this.expires==null&&this.refreshToken)e=!0;else if(this.expires){const r=Date.now();this.expires>r&&(this.expires-r)/1e3>60*this.oAuthInfo.minTimeUntilExpiration&&(e=!0)}}return e}save(){if(!this.storage)return!1;const e=this._load(),r=this.oAuthInfo;if(r&&r.authNamespace&&r.portalUrl){let i=e[r.authNamespace];i||(i=e[r.authNamespace]={}),this.appId||(this.appId=r.appId),i[r.portalUrl]={appId:this.appId,codeVerifier:this.codeVerifier,expires:this.expires,refreshToken:this.refreshToken,ssl:this.ssl,stateUID:this.stateUID,token:this.token,userId:this.userId};try{this.storage.setItem(kU,JSON.stringify(e))}catch(s){return console.warn(s),!1}return!0}return!1}destroy(){const e=this._load(),r=this.oAuthInfo;if(r&&r.appId&&r.portalUrl&&(this.expires==null||this.expires>Date.now())&&(this.refreshToken||this.token)){const i=r.portalUrl.replace(/^http:/i,"https:")+"/sharing/rest/oauth2/revokeToken",s=new FormData;if(s.append("f","json"),s.append("auth_token",this.refreshToken||this.token),s.append("client_id",r.appId),s.append("token_type_hint",this.refreshToken?"refresh_token":"access_token"),typeof navigator.sendBeacon=="function")navigator.sendBeacon(i,s);else{const n=new XMLHttpRequest;n.open("POST",i),n.send(s)}}if(r&&r.authNamespace&&r.portalUrl&&this.storage){const i=e[r.authNamespace];if(i){delete i[r.portalUrl];try{this.storage.setItem(kU,JSON.stringify(e))}catch(s){console.log(s)}}}r&&(r._oAuthCred=null,this.oAuthInfo=null)}_init(){const e=this._load(),r=this.oAuthInfo;if(r&&r.authNamespace&&r.portalUrl){let i=e[r.authNamespace];i&&(i=i[r.portalUrl],i&&(this.appId=i.appId,this.codeVerifier=i.codeVerifier,this.expires=i.expires,this.refreshToken=i.refreshToken,this.ssl=i.ssl,this.stateUID=i.stateUID,this.token=i.token,this.userId=i.userId))}}_load(){let e={};if(this.storage){const r=this.storage.getItem(kU);if(r)try{e=JSON.parse(r)}catch(i){console.warn(i)}}return e}};Y7.prototype.declaredClass="esri.identity.OAuthCredential";var J7;let Jo=J7=class extends de{constructor(t){super(t),this._oAuthCred=null,this.appId=null,this.authNamespace="/",this.expiration=20160,this.flowType="auto",this.forceLogin=!1,this.forceUserId=!1,this.locale=null,this.minTimeUntilExpiration=30,this.popup=!1,this.popupCallbackUrl="oauth-callback.html",this.popupWindowFeatures="height=490,width=800,resizable,scrollbars,status",this.portalUrl="https://www.arcgis.com",this.preserveUrlHash=!1,this.userId=null}clone(){return J7.fromJSON(this.toJSON())}};u([d({json:{write:!0}})],Jo.prototype,"appId",void 0),u([d({json:{write:!0}})],Jo.prototype,"authNamespace",void 0),u([d({json:{write:!0}})],Jo.prototype,"expiration",void 0),u([d({json:{write:!0}})],Jo.prototype,"flowType",void 0),u([d({json:{write:!0}})],Jo.prototype,"forceLogin",void 0),u([d({json:{write:!0}})],Jo.prototype,"forceUserId",void 0),u([d({json:{write:!0}})],Jo.prototype,"locale",void 0),u([d({json:{write:!0}})],Jo.prototype,"minTimeUntilExpiration",void 0),u([d({json:{write:!0}})],Jo.prototype,"popup",void 0),u([d({json:{write:!0}})],Jo.prototype,"popupCallbackUrl",void 0),u([d({json:{write:!0}})],Jo.prototype,"popupWindowFeatures",void 0),u([d({json:{write:!0}})],Jo.prototype,"portalUrl",void 0),u([d({json:{write:!0}})],Jo.prototype,"preserveUrlHash",void 0),u([d({json:{write:!0}})],Jo.prototype,"userId",void 0),Jo=J7=u([R("esri.identity.OAuthInfo")],Jo);const Q7=Jo;let kc=class extends de{constructor(e){super(e),this.adminTokenServiceUrl=null,this.currentVersion=null,this.hasPortal=null,this.hasServer=null,this.owningSystemUrl=null,this.owningTenant=null,this.server=null,this.shortLivedTokenValidity=null,this.tokenServiceUrl=null,this.webTierAuth=null}};u([d({json:{write:!0}})],kc.prototype,"adminTokenServiceUrl",void 0),u([d({json:{write:!0}})],kc.prototype,"currentVersion",void 0),u([d({json:{write:!0}})],kc.prototype,"hasPortal",void 0),u([d({json:{write:!0}})],kc.prototype,"hasServer",void 0),u([d({json:{write:!0}})],kc.prototype,"owningSystemUrl",void 0),u([d({json:{write:!0}})],kc.prototype,"owningTenant",void 0),u([d({json:{write:!0}})],kc.prototype,"server",void 0),u([d({json:{write:!0}})],kc.prototype,"shortLivedTokenValidity",void 0),u([d({json:{write:!0}})],kc.prototype,"tokenServiceUrl",void 0),u([d({json:{write:!0}})],kc.prototype,"webTierAuth",void 0),kc=u([R("esri.identity.ServerInfo")],kc);const VU=kc,ML={},_1e=t=>{const e=new tu(t.owningSystemUrl).host,r=new tu(t.server).host,i=/.+\.arcgis\.com$/i;return i.test(e)&&i.test(r)},K7=(t,e)=>!!(_1e(t)&&e&&e.some(r=>r.test(t.server)));let IL=null,$L=null;try{IL=window.localStorage,$L=window.sessionStorage}catch{}let v1e=class extends os{constructor(){super(),this._portalConfig=globalThis.esriGeowConfig,this.serverInfos=[],this.oAuthInfos=[],this.credentials=[],this._soReqs=[],this._xoReqs=[],this._portals=[],this._defaultOAuthInfo=null,this._defaultTokenValidity=60,this.dialog=null,this.formConstructor=Bje,this.tokenValidity=null,this.normalizeWebTierAuth=!1,this._appOrigin=window.origin!=="null"?window.origin:window.location.origin,this._appUrlObj=cn(window.location.href),this._busy=null,this._rejectOnPersistedPageShow=!1,this._oAuthLocationParams=null,this._gwTokenUrl="/sharing/rest/generateToken",this._agsRest="/rest/services",this._agsPortal=/\/sharing(\/|$)/i,this._agsAdmin=/(https?:\/\/[^\/]+\/[^\/]+)\/admin\/?(\/.*)?$/i,this._adminSvcs=/\/rest\/admin\/services(\/|$)/i,this._gwDomains=[{regex:/^https?:\/\/www\.arcgis\.com/i,customBaseUrl:"maps.arcgis.com",tokenServiceUrl:"https://www.arcgis.com/sharing/rest/generateToken"},{regex:/^https?:\/\/(?:dev|[a-z\d-]+\.mapsdev)\.arcgis\.com/i,customBaseUrl:"mapsdev.arcgis.com",tokenServiceUrl:"https://dev.arcgis.com/sharing/rest/generateToken"},{regex:/^https?:\/\/(?:devext|[a-z\d-]+\.mapsdevext)\.arcgis\.com/i,customBaseUrl:"mapsdevext.arcgis.com",tokenServiceUrl:"https://devext.arcgis.com/sharing/rest/generateToken"},{regex:/^https?:\/\/(?:qaext|[a-z\d-]+\.mapsqa)\.arcgis\.com/i,customBaseUrl:"mapsqa.arcgis.com",tokenServiceUrl:"https://qaext.arcgis.com/sharing/rest/generateToken"},{regex:/^https?:\/\/[a-z\d-]+\.maps\.arcgis\.com/i,customBaseUrl:"maps.arcgis.com",tokenServiceUrl:"https://www.arcgis.com/sharing/rest/generateToken"}],this._legacyFed=[],this._regexSDirUrl=/http.+\/rest\/services\/?/gi,this._regexServerType=/(\/(FeatureServer|GPServer|GeoDataServer|GeocodeServer|GeoenrichmentServer|GeometryServer|GlobeServer|ImageServer|KnowledgeGraphServer|MapServer|MissionServer|MobileServer|NAServer|NetworkDiagramServer|OGCFeatureServer|ParcelFabricServer|RelationalCatalogServer|SceneServer|StreamServer|UtilityNetworkServer|ValidationServer|VectorTileServer|VersionManagementServer|VideoServer)).*/gi,this._gwUser=/http.+\/users\/([^\/]+)\/?.*/i,this._gwItem=/http.+\/items\/([^\/]+)\/?.*/i,this._gwGroup=/http.+\/groups\/([^\/]+)\/?.*/i,this._rePortalTokenSvc=/\/sharing(\/rest)?\/generatetoken/i,this._createDefaultOAuthInfo=!0,this._hasTestedIfAppIsOnPortal=!1,this._getOAuthLocationParams(),window.addEventListener("pageshow",e=>{this._pageShowHandler(e)})}registerServers(e){const r=this.serverInfos;r?(e=e.filter(i=>!this.findServerInfo(i.server)),this.serverInfos=r.concat(e)):this.serverInfos=e,e.forEach(i=>{i.owningSystemUrl&&this._portals.push(i.owningSystemUrl),i.hasPortal&&this._portals.push(i.server)})}registerOAuthInfos(e){const r=this.oAuthInfos;if(r){for(const i of e){const s=this.findOAuthInfo(i.portalUrl);s&&r.splice(r.indexOf(s),1)}this.oAuthInfos=r.concat(e)}else this.oAuthInfos=e}registerToken(e){e={...e};const r=this._sanitizeUrl(e.server),i=this._isServerRsrc(r);let s,n=this.findServerInfo(r),o=!0;n||(n=new VU,n.server=this._getServerInstanceRoot(r),i?n.hasServer=!0:(n.tokenServiceUrl=this._getTokenSvcUrl(r),n.hasPortal=!0),this.registerServers([n])),s=this._findCredential(r),s?(delete e.server,Object.assign(s,e),o=!1):(s=new xs({userId:e.userId,server:n.server,token:e.token,expires:e.expires,ssl:e.ssl,scope:i?"server":"portal"}),s.resources=[r],this.credentials.push(s)),s.emitTokenChange(!1),o||s.refreshServerTokens()}toJSON(){return dF({serverInfos:this.serverInfos.map(e=>e.toJSON()),oAuthInfos:this.oAuthInfos.map(e=>e.toJSON()),credentials:this.credentials.map(e=>e.toJSON())})}initialize(e){if(!e)return;typeof e=="string"&&(e=JSON.parse(e));const r=e.serverInfos,i=e.oAuthInfos,s=e.credentials;if(r){const n=[];r.forEach(o=>{o.server&&o.tokenServiceUrl&&n.push(o.declaredClass?o:new VU(o))}),n.length&&this.registerServers(n)}if(i){const n=[];i.forEach(o=>{o.appId&&n.push(o.declaredClass?o:new Q7(o))}),n.length&&this.registerOAuthInfos(n)}s&&s.forEach(n=>{n.server&&n.token&&n.expires&&n.expires>Date.now()&&((n=n.declaredClass?n:new xs(n)).emitTokenChange(),this.credentials.push(n))})}findServerInfo(e){let r;e=this._sanitizeUrl(e);for(const i of this.serverInfos)if(this._hasSameServerInstance(i.server,e)){r=i;break}return r}findOAuthInfo(e){let r;e=this._sanitizeUrl(e);for(const i of this.oAuthInfos)if(this._hasSameServerInstance(i.portalUrl,e)){r=i;break}return r}findCredential(e,r){if(!e)return;let i;e=this._sanitizeUrl(e);const s=this._isServerRsrc(e)?"server":"portal";if(r){for(const n of this.credentials)if(this._hasSameServerInstance(n.server,e)&&r===n.userId&&n.scope===s){i=n;break}}else for(const n of this.credentials)if(this._hasSameServerInstance(n.server,e)&&this._getIdenticalSvcIdx(e,n)!==-1&&n.scope===s){i=n;break}return i}getCredential(e,r){let i,s,n=!0;r&&(i=!!r.token,s=r.error,n=r.prompt!==!1),r={...r},e=this._sanitizeUrl(e);const o=new AbortController,a=qs();if(r.signal&&nn(r.signal,()=>{o.abort()}),nn(o,()=>{a.reject(new F("identity-manager:user-aborted","ABORTED"))}),sn(o))return a.promise;r.signal=o.signal;const l=this._isAdminResource(e),c=i?this.findCredential(e):null;let h;if(c&&s&&s.details&&s.details.httpStatus===498)c.destroy();else if(c)return h=new F("identity-manager:not-authorized","You are currently signed in as: '"+c.userId+"'. You do not have access to this resource: "+e,{error:s}),a.reject(h),a.promise;const p=this._findCredential(e,r);if(p)return a.resolve(p),a.promise;let f=this.findServerInfo(e);if(f)!f.hasServer&&this._isServerRsrc(e)&&(f._restInfoPms=this._getTokenSvcUrl(e),f.hasServer=!0);else{const m=this._getTokenSvcUrl(e);if(!m)return h=new F("identity-manager:unknown-resource","Unknown resource - could not find token service endpoint."),a.reject(h),a.promise;f=new VU,f.server=this._getServerInstanceRoot(e),typeof m=="string"?(f.tokenServiceUrl=m,f.hasPortal=!0):(f._restInfoPms=m,f.hasServer=!0),this.registerServers([f])}return f.hasPortal&&f._selfReq===void 0&&(n||Ql(f.tokenServiceUrl,this._appOrigin)||this._gwDomains.some(m=>m.tokenServiceUrl===f.tokenServiceUrl))&&(f._selfReq={owningTenant:r&&r.owningTenant,selfDfd:this._getPortalSelf(f.tokenServiceUrl.replace(this._rePortalTokenSvc,"/sharing/rest/portals/self"),e)}),this._enqueue(e,f,r,a,l)}getResourceName(e){return this._isRESTService(e)?e.replace(this._regexSDirUrl,"").replace(this._regexServerType,"")||"":this._gwUser.test(e)&&e.replace(this._gwUser,"$1")||this._gwItem.test(e)&&e.replace(this._gwItem,"$1")||this._gwGroup.test(e)&&e.replace(this._gwGroup,"$1")||""}generateToken(e,r,i){const s=this._rePortalTokenSvc.test(e.tokenServiceUrl),n=new tu(this._appOrigin),o=e.shortLivedTokenValidity;let a,l,c,h,p,f,m,y;r&&(y=this.tokenValidity||o||this._defaultTokenValidity,y>o&&o>0&&(y=o)),i&&(a=i.isAdmin,l=i.serverUrl,c=i.token,f=i.signal,m=i.ssl,e.customParameters=i.customParameters),a?h=e.adminTokenServiceUrl:(h=e.tokenServiceUrl,p=new tu(h.toLowerCase()),e.webTierAuth&&i?.serverUrl&&!m&&n.scheme==="http"&&(Ql(n.uri,h,!0)||p.scheme==="https"&&n.host===p.host&&n.port==="7080"&&p.port==="7443")&&(h=h.replace(/^https:/i,"http:").replace(/:7443/i,":7080")));const _={query:{request:"getToken",username:r?.username,password:r?.password,serverUrl:l,token:c,expiration:y,referer:a||s?this._appOrigin:null,client:a?"referer":null,f:"json",...e.customParameters},method:"post",authMode:"anonymous",useProxy:this._useProxy(e,i),signal:f,...i?.ioArgs};return s||(_.withCredentials=!1),qt(h,_).then(v=>{const w=v.data;if(!w||!w.token)return new F("identity-manager:authentication-failed","Unable to generate token");const x=e.server;return ML[x]||(ML[x]={}),r&&(ML[x][r.username]=r.password),w.validity=y,w})}isBusy(){return!!this._busy}checkSignInStatus(e){return this.checkAppAccess(e,"").then(r=>r.credential)}checkAppAccess(e,r,i){let s=!1;return this.getCredential(e,{prompt:!1}).then(n=>{let o;const a={f:"json"};if(n.scope==="portal")if(r&&(this._doPortalSignIn(e)||i&&i.force))o=n.server+"/sharing/rest/oauth2/validateAppAccess",a.client_id=r;else{if(!n.token)return{credential:n};o=n.server+"/sharing/rest"}else{if(!n.token)return{credential:n};o=n.server+"/rest/services"}return n.token&&(a.token=n.token),qt(o,{query:a,authMode:"anonymous"}).then(l=>{if(l.data.valid===!1)throw new F("identity-manager:not-authorized",`You are currently signed in as: '${n.userId}'.`,l.data);return s=!!l.data.viewOnlyUserTypeApp,{credential:n}}).catch(l=>{if(l.name==="identity-manager:not-authorized")throw l;const c=l.details&&l.details.httpStatus;if(c===498)throw n.destroy(),new F("identity-manager:not-authenticated","User is not signed in.");if(c===400)throw new F("identity-manager:invalid-request");return{credential:n}})}).then(n=>({credential:n.credential,viewOnly:s}))}setOAuthResponseHash(e){e&&(e.charAt(0)==="#"&&(e=e.substring(1)),this._processOAuthPopupParams(ub(e)))}setOAuthRedirectionHandler(e){this._oAuthRedirectFunc=e}setProtocolErrorHandler(e){this._protocolFunc=e}signIn(e,r,i={}){const s=qs(),n=()=>{l?.remove(),c?.remove(),h?.remove(),a?.destroy(),this.dialog?.destroy(),this.dialog=a=l=c=h=null},o=()=>{n(),this._oAuthDfd=null,s.reject(new F("identity-manager:user-aborted","ABORTED"))};i.signal&&nn(i.signal,()=>{o()});let a=new this.formConstructor;a.resource=this.getResourceName(e),a.server=r.server,this.dialog=new Kte,this.dialog.content=a,this.dialog.open=!0,this.emit("dialog-create");let l=a.on("cancel",o),c=le(()=>this.dialog.open,o),h=a.on("submit",p=>{this.generateToken(r,p,{isAdmin:i.isAdmin,signal:i.signal}).then(f=>{n();const m=new xs({userId:p.username,server:r.server,token:f.token,expires:f.expires!=null?Number(f.expires):null,ssl:!!f.ssl,isAdmin:i.isAdmin,validity:f.validity});s.resolve(m)}).catch(f=>{a.error=f,a.signingIn=!1})});return s.promise}oAuthSignIn(e,r,i,s){this._oAuthDfd=qs();const n=this._oAuthDfd;let o;s?.signal&&nn(s.signal,()=>{const y=this._oAuthDfd&&this._oAuthDfd.oAuthWin_;y&&!y.closed?y.close():this.dialog&&f()}),n.resUrl_=e,n.sinfo_=r,n.oinfo_=i;const a=i._oAuthCred;if(a.storage&&(i.flowType==="authorization-code"||i.flowType==="auto"&&!i.popup&&r.currentVersion>=8.4)){let y=crypto.getRandomValues(new Uint8Array(32));o=q6(y),a.codeVerifier=o,y=crypto.getRandomValues(new Uint8Array(32)),a.stateUID=q6(y),a.save()||(a.codeVerifier=o=null)}else a.codeVerifier=null;let l,c,h,p;this._getCodeChallenge(o).then(y=>{const _=!s||s.oAuthPopupConfirmation!==!1;i.popup&&_?(l=new this.formConstructor,l.oAuthPrompt=!0,l.server=r.server,this.dialog=new Kte,this.dialog.content=l,this.dialog.open=!0,this.emit("dialog-create"),c=l.on("cancel",f),h=le(()=>this.dialog.open,f),p=l.on("submit",()=>{m(),this._doOAuthSignIn(e,r,i,y)})):this._doOAuthSignIn(e,r,i,y)});const f=()=>{m(),this._oAuthDfd=null,n.reject(new F("identity-manager:user-aborted","ABORTED"))},m=()=>{c?.remove(),h?.remove(),p?.remove(),l?.destroy(),this.dialog?.destroy(),this.dialog=null};return n.promise}destroyCredentials(){this.credentials&&this.credentials.slice().forEach(e=>{e.destroy()}),this.emit("credentials-destroy")}enablePostMessageAuth(e="https://www.arcgis.com/sharing/rest"){this._postMessageAuthHandle&&this._postMessageAuthHandle.remove(),this._postMessageAuthHandle=h_(window,"message",r=>{if((r.origin===this._appOrigin||r.origin.endsWith(".arcgis.com"))&&r.data?.type==="arcgis:auth:requestCredential"){const i=r.source;this.getCredential(e).then(s=>{i.postMessage({type:"arcgis:auth:credential",credential:{expires:s.expires,server:s.server,ssl:s.ssl,token:s.token,userId:s.userId}},r.origin)}).catch(s=>{i.postMessage({type:"arcgis:auth:error",error:{name:s.name,message:s.message}},r.origin)})}})}disablePostMessageAuth(){this._postMessageAuthHandle&&(this._postMessageAuthHandle.remove(),this._postMessageAuthHandle=null)}_getOAuthLocationParams(){let e=window.location.hash;if(e){e.charAt(0)==="#"&&(e=e.substring(1));const i=ub(e);let s=!1;if(i.access_token&&i.expires_in&&i.state&&i.hasOwnProperty("username"))try{i.state=JSON.parse(i.state),i.state.portalUrl&&(this._oAuthLocationParams=i,s=!0)}catch{}else if(i.error&&i.error_description&&(console.log("IdentityManager OAuth Error: ",i.error," - ",i.error_description),i.error==="access_denied"&&(s=!0,i.state)))try{i.state=JSON.parse(i.state)}catch{}s&&(window.location.hash=i.state?.hash||"")}let r=window.location.search;if(r){r.charAt(0)==="?"&&(r=r.substring(1));const i=ub(r);let s=!1;if(i.code&&i.state)try{i.state=JSON.parse(i.state),i.state.portalUrl&&i.state.uid&&(this._oAuthLocationParams=i,s=!0)}catch{}else if(i.error&&i.error_description&&(console.log("IdentityManager OAuth Error: ",i.error," - ",i.error_description),i.error==="access_denied"&&(s=!0,i.state)))try{i.state=JSON.parse(i.state)}catch{}if(s){const n={...i};["code","error","error_description","message_code","persist","state"].forEach(l=>{delete n[l]});const o=kb(n),a=window.location.pathname+(o?`?${o}`:"")+(i.state?.hash||"");window.history.replaceState(window.history.state,"",a)}}}_getOAuthToken(e,r,i,s,n){return e=e.replace(/^http:/i,"https:"),qt(`${e}/sharing/rest/oauth2/token`,{authMode:"anonymous",method:"post",query:s&&n?{grant_type:"authorization_code",code:r,redirect_uri:s,client_id:i,code_verifier:n}:{grant_type:"refresh_token",refresh_token:r,client_id:i}}).then(o=>o.data)}_getCodeChallenge(e){if(e&&globalThis.isSecureContext){const r=new TextEncoder().encode(e);return crypto.subtle.digest("SHA-256",r).then(i=>q6(new Uint8Array(i)))}return Promise.resolve(null)}_pageShowHandler(e){if(e.persisted&&this.isBusy()&&this._rejectOnPersistedPageShow){const r=new F("identity-manager:user-aborted","ABORTED");this._errbackFunc(r)}}_findCredential(e,r){let i,s,n,o,a=-1;const l=r&&r.token,c=r&&r.resource,h=this._isServerRsrc(e)?"server":"portal",p=this.credentials.filter(f=>this._hasSameServerInstance(f.server,e)&&f.scope===h);if(e=c||e,p.length)if(p.length===1){if(i=p[0],n=this.findServerInfo(i.server),s=n&&n.owningSystemUrl,o=s?this.findCredential(s,i.userId):void 0,a=this._getIdenticalSvcIdx(e,i),!l)return a===-1&&i.resources.push(e),this._addResource(e,o),i;a!==-1&&(i.resources.splice(a,1),this._removeResource(e,o))}else{let f,m;if(p.some(y=>(m=this._getIdenticalSvcIdx(e,y),m!==-1&&(f=y,n=this.findServerInfo(f.server),s=n&&n.owningSystemUrl,o=s?this.findCredential(s,f.userId):void 0,a=m,!0))),l)f&&(f.resources.splice(a,1),this._removeResource(e,o));else if(f)return this._addResource(e,o),f}}_findOAuthInfo(e){let r=this.findOAuthInfo(e);if(!r){for(const i of this.oAuthInfos)if(this._isIdProvider(i.portalUrl,e)){r=i;break}}return r}_addResource(e,r){r&&this._getIdenticalSvcIdx(e,r)===-1&&r.resources.push(e)}_removeResource(e,r){let i=-1;r&&(i=this._getIdenticalSvcIdx(e,r),i>-1&&r.resources.splice(i,1))}_useProxy(e,r){return r&&r.isAdmin&&!Ql(e.adminTokenServiceUrl,this._appOrigin)||!this._isPortalDomain(e.tokenServiceUrl)&&String(e.currentVersion)==="10.1"&&!Ql(e.tokenServiceUrl,this._appOrigin)}_getOrigin(e){const r=new tu(e);return r.scheme+"://"+r.host+(r.port!=null?":"+r.port:"")}_getServerInstanceRoot(e){const r=e.toLowerCase();let i=r.indexOf(this._agsRest);return i===-1&&this._isAdminResource(e)&&(i=this._agsAdmin.test(e)?e.replace(this._agsAdmin,"$1").length:e.search(this._adminSvcs)),i!==-1||Lde(r)||(i=r.indexOf("/sharing")),i===-1&&r.substr(-1)==="/"&&(i=r.length-1),i>-1?e.substring(0,i):e}_hasSameServerInstance(e,r){return e.substr(-1)==="/"&&(e=e.slice(0,-1)),e=e.toLowerCase(),r=this._getServerInstanceRoot(r).toLowerCase(),e=this._normalizeAGOLorgDomain(e),r=this._normalizeAGOLorgDomain(r),(e=e.substr(e.indexOf(":")))===(r=r.substr(r.indexOf(":")))}_normalizeAGOLorgDomain(e){const r=/^https?:\/\/(?:cdn|[a-z\d-]+\.maps)\.arcgis\.com/i,i=/^https?:\/\/(?:cdndev|[a-z\d-]+\.mapsdevext)\.arcgis\.com/i,s=/^https?:\/\/(?:cdnqa|[a-z\d-]+\.mapsqa)\.arcgis\.com/i;return r.test(e)?e=e.replace(r,"https://www.arcgis.com"):i.test(e)?e=e.replace(i,"https://devext.arcgis.com"):s.test(e)&&(e=e.replace(s,"https://qaext.arcgis.com")),e}_sanitizeUrl(e){const r=(Ur.request.proxyUrl||"").toLowerCase(),i=r?e.toLowerCase().indexOf(r+"?"):-1;return i!==-1&&(e=e.substring(i+r.length+1)),e=vh(e),cn(e).path}_isRESTService(e){return e.includes(this._agsRest)}_isAdminResource(e){return this._agsAdmin.test(e)||this._adminSvcs.test(e)}_isServerRsrc(e){return this._isRESTService(e)||this._isAdminResource(e)}_isIdenticalService(e,r){let i=!1;if(this._isRESTService(e)&&this._isRESTService(r)){const s=this._getSuffix(e).toLowerCase(),n=this._getSuffix(r).toLowerCase();if(i=s===n,!i){const o=/(.*)\/(MapServer|FeatureServer|UtilityNetworkServer).*/gi;i=s.replaceAll(o,"$1")===n.replaceAll(o,"$1")}}else this._isAdminResource(e)&&this._isAdminResource(r)?i=!0:this._isServerRsrc(e)||this._isServerRsrc(r)||!this._isPortalDomain(e)||(i=!0);return i}_isPortalDomain(e){const r=new tu(e.toLowerCase()),i=this._portalConfig;let s=this._gwDomains.some(n=>n.regex.test(r.uri));return!s&&i&&(s=this._hasSameServerInstance(this._getServerInstanceRoot(i.restBaseUrl),r.uri)),s||Ur.portalUrl&&(s=Ql(r,Ur.portalUrl,!0)),s||(s=this._portals.some(n=>this._hasSameServerInstance(n,r.uri))),s=s||this._agsPortal.test(r.path),s}_isIdProvider(e,r){let i=-1,s=-1;this._gwDomains.forEach((o,a)=>{i===-1&&o.regex.test(e)&&(i=a),s===-1&&o.regex.test(r)&&(s=a)});let n=!1;if(i>-1&&s>-1&&(i===0||i===4?s!==0&&s!==4||(n=!0):i===1?s!==1&&s!==2||(n=!0):i===2?s===2&&(n=!0):i===3&&s===3&&(n=!0)),!n){const o=this.findServerInfo(r),a=o&&o.owningSystemUrl;a&&_1e(o)&&this._isPortalDomain(a)&&this._isIdProvider(e,a)&&(n=!0)}return n}_getIdenticalSvcIdx(e,r){let i=-1;for(let s=0;s<r.resources.length;s++){const n=r.resources[s];if(this._isIdenticalService(e,n)){i=s;break}}return i}_getSuffix(e){return e.replace(this._regexSDirUrl,"").replace(this._regexServerType,"$1")}_getTokenSvcUrl(e){let r,i,s;if(this._isRESTService(e)||this._isAdminResource(e)){const n=this._getServerInstanceRoot(e);return r=n+"/admin/generateToken",i=qt(e=n+"/rest/info",{query:{f:"json"}}).then(o=>o.data),{adminUrl:r,promise:i}}if(this._isPortalDomain(e)){let n="";if(this._gwDomains.some(o=>(o.regex.test(e)&&(n=o.tokenServiceUrl),!!n)),n||this._portals.some(o=>(this._hasSameServerInstance(o,e)&&(n=o+this._gwTokenUrl),!!n)),n||(s=e.toLowerCase().indexOf("/sharing"),s!==-1&&(n=e.substring(0,s)+this._gwTokenUrl)),n||(n=this._getOrigin(e)+this._gwTokenUrl),n){const o=new tu(e).port;/^http:\/\//i.test(e)&&o==="7080"&&(n=n.replace(/:7080/i,":7443")),n=n.replace(/http:/i,"https:")}return n}if(e.toLowerCase().includes("premium.arcgisonline.com"))return"https://premium.arcgisonline.com/server/tokens"}_processOAuthResponseParams(e,r,i){const s=r._oAuthCred;if(e.code){const o=s.codeVerifier;return s.codeVerifier=null,s.stateUID=null,s.save(),this._getOAuthToken(i.server,e.code,r.appId,this._getRedirectURI(r,!0),o).then(a=>{const l=new xs({userId:a.username,server:i.server,token:a.access_token,expires:Date.now()+1e3*a.expires_in,ssl:a.ssl,oAuthState:e.state,_oAuthCred:s});return r.userId=l.userId,s.storage=a.persist?IL:$L,s.refreshToken=a.refresh_token,s.token=null,s.expires=a.refresh_token_expires_in?Date.now()+1e3*a.refresh_token_expires_in:null,s.userId=l.userId,s.ssl=l.ssl,s.save(),l})}const n=new xs({userId:e.username,server:i.server,token:e.access_token,expires:Date.now()+1e3*Number(e.expires_in),ssl:e.ssl==="true",oAuthState:e.state,_oAuthCred:s});return r.userId=n.userId,s.storage=e.persist?IL:$L,s.refreshToken=null,s.token=n.token,s.expires=n.expires,s.userId=n.userId,s.ssl=n.ssl,s.save(),Promise.resolve(n)}_processOAuthPopupParams(e){const r=this._oAuthDfd;if(this._oAuthDfd=null,r)if(clearInterval(this._oAuthIntervalId),this._oAuthOnPopupHandle?.remove(),e.error){const i=e.error==="access_denied",s=new F(i?"identity-manager:user-aborted":"identity-manager:authentication-failed",i?"ABORTED":"OAuth: "+e.error+" - "+e.error_description);r.reject(s)}else this._processOAuthResponseParams(e,r.oinfo_,r.sinfo_).then(i=>{r.resolve(i)}).catch(i=>{r.reject(i)})}_setOAuthResponseQueryString(e){e&&(e.charAt(0)==="?"&&(e=e.substring(1)),this._processOAuthPopupParams(ub(e)))}_exchangeToken(e,r,i){return qt(`${e}/sharing/rest/oauth2/exchangeToken`,{authMode:"anonymous",method:"post",query:{f:"json",client_id:r,token:i}}).then(s=>s.data.token)}_getPlatformSelf(e,r){return e=e.replace(/^http:/i,"https:"),qt(`${e}/sharing/rest/oauth2/platformSelf`,{authMode:"anonymous",headers:{"X-Esri-Auth-Client-Id":r,"X-Esri-Auth-Redirect-Uri":window.location.href.replace(/#.*$/,"")},method:"post",query:{f:"json",expiration:30},withCredentials:!0}).then(i=>i.data)}_getPortalSelf(e,r){let i;return this._gwDomains.some(s=>(s.regex.test(e)&&(i=s.customBaseUrl),!!i)),i?Promise.resolve({allSSL:!0,currentVersion:"8.4",customBaseUrl:i,portalMode:"multitenant",supportsOAuth:!0}):(this._appOrigin.startsWith("https:")?e=e.replace(/^http:/i,"https:").replace(/:7080/i,":7443"):/^http:/i.test(r)&&(e=e.replace(/^https:/i,"http:").replace(/:7443/i,":7080")),qt(e,{query:{f:"json"},authMode:"anonymous",withCredentials:!0}).then(s=>s.data))}_doPortalSignIn(e){const r=this._portalConfig,i=window.location.href,s=this.findServerInfo(e);return!(!r&&!this._isPortalDomain(i)||!(s?s.hasPortal||s.owningSystemUrl&&this._isPortalDomain(s.owningSystemUrl):this._isPortalDomain(e))||!(this._isIdProvider(i,e)||r&&(this._hasSameServerInstance(this._getServerInstanceRoot(r.restBaseUrl),e)||this._isIdProvider(r.restBaseUrl,e))||Ql(i,e,!0)))}_checkProtocol(e,r,i,s){let n=!0;const o=s?r.adminTokenServiceUrl:r.tokenServiceUrl;return o.trim().toLowerCase().startsWith("https:")&&!this._appOrigin.startsWith("https:")&&xR(o)&&(n=!!this._protocolFunc&&!!this._protocolFunc({resourceUrl:e,serverInfo:r}),!n)&&i(new F("identity-manager:aborted","Aborted the Sign-In process to avoid sending password over insecure connection.")),n}_enqueue(e,r,i,s,n,o){return s||(s=qs()),s.resUrl_=e,s.sinfo_=r,s.options_=i,s.admin_=n,s.refresh_=o,this._busy?this._hasSameServerInstance(this._getServerInstanceRoot(e),this._busy.resUrl_)?(this._oAuthDfd&&this._oAuthDfd.oAuthWin_&&this._oAuthDfd.oAuthWin_.focus(),this._soReqs.push(s)):this._xoReqs.push(s):this._doSignIn(s),s.promise}_doSignIn(e){this._busy=e,this._rejectOnPersistedPageShow=!1;const r=c=>{const h=e.options_&&e.options_.resource,p=e.resUrl_,f=e.refresh_;let m=!1;this.credentials.includes(c)||(f&&this.credentials.includes(f)?(f.userId=c.userId,f.token=c.token,f.expires=c.expires,f.validity=c.validity,f.ssl=c.ssl,f.creationTime=c.creationTime,m=!0,c=f):this.credentials.push(c)),c.resources||(c.resources=[]),c.resources.includes(h||p)||c.resources.push(h||p),c.scope=this._isServerRsrc(p)?"server":"portal",c.emitTokenChange();const y=this._soReqs,_={};this._soReqs=[],y.forEach(v=>{if(!this._isIdenticalService(p,v.resUrl_)){const w=this._getSuffix(v.resUrl_);_[w]||(_[w]=!0,c.resources.push(v.resUrl_))}}),e.resolve(c),y.forEach(v=>{this._hasSameServerInstance(this._getServerInstanceRoot(p),v.resUrl_)?v.resolve(c):this._soReqs.push(v)}),this._busy=e.resUrl_=e.sinfo_=e.refresh_=null,m||this.emit("credential-create",{credential:c}),this._soReqs.length?this._doSignIn(this._soReqs.shift()):this._xoReqs.length&&this._doSignIn(this._xoReqs.shift())},i=c=>{e.reject(c),this._busy=e.resUrl_=e.sinfo_=e.refresh_=null,this._soReqs.length?this._doSignIn(this._soReqs.shift()):this._xoReqs.length&&this._doSignIn(this._xoReqs.shift())},s=(c,h,p,f)=>{const m=e.sinfo_,y=!e.options_||e.options_.prompt!==!1,_=m.hasPortal&&this._findOAuthInfo(e.resUrl_);let v,w;if(c)r(new xs({userId:c,server:m.server,token:p||null,expires:f!=null?Number(f):null,ssl:!!h}));else if(window!==window.parent&&this._appUrlObj.query?.["arcgis-auth-origin"]&&this._appUrlObj.query?.["arcgis-auth-portal"]&&this._hasSameServerInstance(this._getServerInstanceRoot(this._appUrlObj.query["arcgis-auth-portal"]),e.resUrl_)){window.parent.postMessage({type:"arcgis:auth:requestCredential"},this._appUrlObj.query["arcgis-auth-origin"]);const x=h_(window,"message",T=>{T.source===window.parent&&T.data&&(T.data.type==="arcgis:auth:credential"?(x.remove(),T.data.credential.expires<Date.now()?i(new F("identity-manager:credential-request-failed","Parent application's token has expired.")):r(new xs(T.data.credential))):T.data.type==="arcgis:auth:error"&&(x.remove(),T.data.error.name==="tokenExpiredError"?i(new F("identity-manager:credential-request-failed","Parent application's token has expired.")):i(F.fromJSON(T.data.error))))});nn(e.options_?.signal,()=>{x.remove()})}else if(_){let x=_._oAuthCred;if(!x){const T=new Y7(_,IL),S=new Y7(_,$L);T.isValid()&&S.isValid()?T.expires>S.expires?(x=T,S.destroy()):(x=S,T.destroy()):x=T.isValid()?T:S,_._oAuthCred=x}if(x.isValid()){v=new xs({userId:x.userId,server:m.server,token:x.token,expires:x.expires,ssl:x.ssl,_oAuthCred:x});const T=_.appId!==x.appId&&this._doPortalSignIn(e.resUrl_);T||x.refreshToken?(e._pendingDfd=x.refreshToken?this._getOAuthToken(m.server,x.refreshToken,x.appId).then(S=>(v.expires=Date.now()+1e3*S.expires_in,v.token=S.access_token,v)):Promise.resolve(v),e._pendingDfd.then(S=>T?this._exchangeToken(S.server,_.appId,S.token).then(O=>(S.token=O,S)).catch(()=>S):S).then(S=>{r(S)}).catch(()=>{x?.destroy(),s()})):r(v)}else if(this._oAuthLocationParams&&this._hasSameServerInstance(_.portalUrl,this._oAuthLocationParams.state.portalUrl)&&(this._oAuthLocationParams.access_token||this._oAuthLocationParams.code&&this._oAuthLocationParams.state.uid===x.stateUID&&x.codeVerifier)){const T=this._oAuthLocationParams;this._oAuthLocationParams=null,e._pendingDfd=this._processOAuthResponseParams(T,_,m).then(S=>{r(S)}).catch(i)}else{const T=()=>{y?e._pendingDfd=this.oAuthSignIn(e.resUrl_,m,_,e.options_).then(r,i):(w=new F("identity-manager:not-authenticated","User is not signed in."),i(w))};this._doPortalSignIn(e.resUrl_)?e._pendingDfd=this._getPlatformSelf(m.server,_.appId).then(S=>{Ql(S.portalUrl,this._appOrigin,!0)?(v=new xs({userId:S.username,server:m.server,expires:Date.now()+1e3*S.expires_in,token:S.token}),r(v)):T()}).catch(T):T()}}else if(y){if(this._checkProtocol(e.resUrl_,m,i,e.admin_)){let x=e.options_;e.admin_&&(x=x||{},x.isAdmin=!0),e._pendingDfd=this.signIn(e.resUrl_,m,x).then(r,i)}}else w=new F("identity-manager:not-authenticated","User is not signed in."),i(w)},n=()=>{const c=e.sinfo_,h=c.owningSystemUrl,p=e.options_;let f,m,y,_;if(p&&(f=p.token,m=p.error,y=p.prompt),_=this._findCredential(h,{token:f,resource:e.resUrl_}),!_){for(const v of this.credentials)if(this._isIdProvider(h,v.server)){_=v;break}}if(_){const v=this.findCredential(e.resUrl_,_.userId);if(v)r(v);else if(K7(c,this._legacyFed)){const w=_.toJSON();w.server=c.server,w.resources=null,r(new xs(w))}else(e._pendingDfd=this.generateToken(this.findServerInfo(_.server),null,{serverUrl:e.resUrl_,token:_.token,signal:e.options_.signal,ssl:_.ssl})).then(w=>{r(new xs({userId:_?.userId,server:c.server,token:w.token,expires:w.expires!=null?Number(w.expires):null,ssl:!!w.ssl,isAdmin:e.admin_,validity:w.validity}))},i)}else this._busy=null,f&&(e.options_.token=null),(e._pendingDfd=this.getCredential(h.replace(/\/?$/,"/sharing"),{resource:e.resUrl_,owningTenant:c.owningTenant,signal:e.options_.signal,token:f,error:m,prompt:y})).then(()=>{this._enqueue(e.resUrl_,e.sinfo_,e.options_,e,e.admin_)},v=>{e.resUrl_=e.sinfo_=e.refresh_=null,e.reject(v)})};this._errbackFunc=i;const o=e.sinfo_.owningSystemUrl,a=this._isServerRsrc(e.resUrl_),l=e.sinfo_._restInfoPms;l?l.promise.then(c=>{const h=e.sinfo_;if(h._restInfoPms){h.adminTokenServiceUrl=h._restInfoPms.adminUrl,h._restInfoPms=null,h.tokenServiceUrl=(ug("authInfo.tokenServicesUrl",c)||ug("authInfo.tokenServiceUrl",c)||ug("tokenServiceUrl",c))??null,h.shortLivedTokenValidity=ug("authInfo.shortLivedTokenValidity",c)??null,h.currentVersion=c.currentVersion,h.owningTenant=c.owningTenant;const p=h.owningSystemUrl=c.owningSystemUrl;p&&this._portals.push(p)}a&&h.owningSystemUrl?n():s()},()=>{e.sinfo_._restInfoPms=null;const c=new F("identity-manager:server-identification-failed","Unknown resource - could not find token service endpoint.");i(c)}):a&&o?n():e.sinfo_._selfReq?e.sinfo_._selfReq.selfDfd.then(c=>{const h={};let p,f,m,y;return c&&(p=c.user&&c.user.username,h.username=p,h.allSSL=c.allSSL,f=c.supportsOAuth,y=parseFloat(c.currentVersion),c.portalMode==="multitenant"&&(m=c.customBaseUrl),e.sinfo_.currentVersion=y),e.sinfo_.webTierAuth=!!p,p&&this.normalizeWebTierAuth?this.generateToken(e.sinfo_,null,{ssl:h.allSSL}).catch(()=>null).then(_=>(h.portalToken=_&&_.token,h.tokenExpiration=_&&_.expires,h)):!p&&f&&y>=4.4&&!this._findOAuthInfo(e.resUrl_)?this._generateOAuthInfo({portalUrl:e.sinfo_.server,customBaseUrl:m,owningTenant:e.sinfo_._selfReq.owningTenant}).catch(()=>null).then(()=>h):h}).catch(()=>null).then(c=>{e.sinfo_._selfReq=null,c?s(c.username,c.allSSL,c.portalToken,c.tokenExpiration):s()}):s()}_generateOAuthInfo(e){let r,i=null,s=e.portalUrl;const n=e.customBaseUrl,o=e.owningTenant,a=!this._defaultOAuthInfo&&this._createDefaultOAuthInfo&&!this._hasTestedIfAppIsOnPortal;if(a){i=window.location.href;let l=i.indexOf("?");l>-1&&(i=i.slice(0,l)),l=i.search(/\/(apps|home)\//),i=l>-1?i.slice(0,l):null}return a&&i?(this._hasTestedIfAppIsOnPortal=!0,r=qt(i+"/sharing/rest",{query:{f:"json"}}).then(()=>{this._defaultOAuthInfo=new Q7({appId:"arcgisonline",popupCallbackUrl:i+"/home/oauth-callback.html"})})):r=Promise.resolve(),r.then(()=>{if(this._defaultOAuthInfo)return s=s.replace(/^http:/i,"https:"),qt(s+"/sharing/rest/oauth2/validateRedirectUri",{query:{accountId:o,client_id:this._defaultOAuthInfo.appId,redirect_uri:_l(this._defaultOAuthInfo.popupCallbackUrl),f:"json"}}).then(l=>{if(l.data.valid){const c=this._defaultOAuthInfo.clone();l.data.urlKey&&n?c.portalUrl="https://"+l.data.urlKey.toLowerCase()+"."+n:c.portalUrl=s,c.popup=window!==window.top||!(Ql(s,this._appOrigin)||this._gwDomains.some(h=>h.regex.test(s)&&h.regex.test(this._appOrigin))),this.oAuthInfos.push(c)}})})}_doOAuthSignIn(e,r,i,s){const n=i._oAuthCred,o={portalUrl:i.portalUrl};!i.popup&&i.preserveUrlHash&&window.location.hash&&(o.hash=window.location.hash),n.stateUID&&(o.uid=n.stateUID);const a={client_id:i.appId,response_type:n.codeVerifier?"code":"token",state:JSON.stringify(o),expiration:i.expiration,locale:i.locale,redirect_uri:this._getRedirectURI(i,!!n.codeVerifier)};i.forceLogin&&(a.force_login=!0),i.forceUserId&&i.userId&&(a.prepopulatedusername=i.userId),!i.popup&&this._doPortalSignIn(e)&&(a.redirectToUserOrgUrl=!0),n.codeVerifier&&(a.code_challenge=s||n.codeVerifier,a.code_challenge_method=s?"S256":"plain");const l=i.portalUrl.replace(/^http:/i,"https:")+"/sharing/oauth2/authorize",c=l+"?"+kb(a);if(i.popup){const h=window.open(c,"esriJSAPIOAuth",i.popupWindowFeatures);if(h)h.focus(),this._oAuthDfd.oAuthWin_=h,this._oAuthIntervalId=setInterval(()=>{if(h.closed){clearInterval(this._oAuthIntervalId),this._oAuthOnPopupHandle.remove();const p=this._oAuthDfd;if(p){const f=new F("identity-manager:user-aborted","ABORTED");p.reject(f)}}},500),this._oAuthOnPopupHandle=h_(window,["arcgis:auth:hash","arcgis:auth:location:search"],p=>{p.type==="arcgis:auth:hash"?this.setOAuthResponseHash(p.detail):this._setOAuthResponseQueryString(p.detail)});else{const p=new F("identity-manager:popup-blocked","ABORTED");this._oAuthDfd.reject(p)}}else this._rejectOnPersistedPageShow=!0,this._oAuthRedirectFunc?this._oAuthRedirectFunc({authorizeParams:a,authorizeUrl:l,resourceUrl:e,serverInfo:r,oAuthInfo:i}):window.location.href=c}_getRedirectURI(e,r){const i=window.location.href.replace(/#.*$/,"");if(e.popup)return _l(e.popupCallbackUrl);if(r){const s=cn(i);return s.query&&["code","error","error_description","message_code","persist","state"].forEach(n=>{delete s.query[n]}),I$(s.path,s.query)}return i}};v1e.prototype.declaredClass="esri.identity.IdentityManagerBase";let xs=class extends os.EventedAccessor{constructor(e){super(e),this._oAuthCred=null,this.tokenRefreshBuffer=2,e&&e._oAuthCred&&(this._oAuthCred=e._oAuthCred)}initialize(){this.resources=this.resources||[],this.creationTime==null&&(this.creationTime=Date.now())}refreshToken(){const e=Gt.findServerInfo(this.server),r=e&&e.owningSystemUrl,i=!!r&&this.scope==="server",s=i&&K7(e,Gt._legacyFed),n=e.webTierAuth,o=n&&Gt.normalizeWebTierAuth,a=ML[this.server],l=a&&a[this.userId];let c,h=this.resources&&this.resources[0],p=i?Gt.findServerInfo(r):null,f={username:this.userId,password:l};if(n&&!o)return;i&&!p&&Gt.serverInfos.some(y=>(Gt._isIdProvider(r,y.server)&&(p=y),!!p));const m=p?Gt.findCredential(p.server,this.userId):null;if(!i||m){if(!s){if(i)c={serverUrl:h,token:m&&m.token,ssl:m&&m.ssl};else if(o)f=null,c={ssl:this.ssl};else{if(!l){let y;return h&&(h=Gt._sanitizeUrl(h),this._enqueued=1,y=Gt._enqueue(h,e,null,null,this.isAdmin,this),y.then(()=>{this._enqueued=0,this.refreshServerTokens()}).catch(()=>{this._enqueued=0})),y}this.isAdmin&&(c={isAdmin:!0})}return Gt.generateToken(i?p:e,i?null:f,c).then(y=>{this.token=y.token,this.expires=y.expires!=null?Number(y.expires):null,this.creationTime=Date.now(),this.validity=y.validity,this.emitTokenChange(),this.refreshServerTokens()}).catch(()=>{})}m?.refreshToken()}}refreshServerTokens(){this.scope==="portal"&&Gt.credentials.forEach(e=>{const r=Gt.findServerInfo(e.server),i=r&&r.owningSystemUrl;e!==this&&e.userId===this.userId&&i&&e.scope==="server"&&(Gt._hasSameServerInstance(this.server,i)||Gt._isIdProvider(i,this.server))&&(K7(r,Gt._legacyFed)?(e.token=this.token,e.expires=this.expires,e.creationTime=this.creationTime,e.validity=this.validity,e.emitTokenChange()):e.refreshToken())})}emitTokenChange(e){clearTimeout(this._refreshTimer);const r=this.server&&Gt.findServerInfo(this.server),i=r&&r.owningSystemUrl,s=i&&Gt.findServerInfo(i);e===!1||i&&this.scope!=="portal"&&(!s||!s.webTierAuth||Gt.normalizeWebTierAuth)||this.expires==null&&this.validity==null||this._startRefreshTimer(),this.emit("token-change")}destroy(){this.userId=this.server=this.token=this.expires=this.validity=this.resources=this.creationTime=null,this._oAuthCred&&(this._oAuthCred.destroy(),this._oAuthCred=null);const e=Gt.credentials.indexOf(this);e>-1&&Gt.credentials.splice(e,1),this.emitTokenChange(),this.emit("destroy")}toJSON(){const e=dF({userId:this.userId,server:this.server,token:this.token,expires:this.expires,validity:this.validity,ssl:this.ssl,isAdmin:this.isAdmin,creationTime:this.creationTime,scope:this.scope}),r=this.resources;return r&&r.length>0&&(e.resources=r.slice()),e}_startRefreshTimer(){clearTimeout(this._refreshTimer);const e=6e4*this.tokenRefreshBuffer,r=2**31-1;let i=(this.validity?this.creationTime+6e4*this.validity:this.expires)-Date.now();i<0?i=0:i>r&&(i=r),this._refreshTimer=setTimeout(this.refreshToken.bind(this),i>e?i-e:i)}};u([d()],xs.prototype,"creationTime",void 0),u([d()],xs.prototype,"expires",void 0),u([d()],xs.prototype,"isAdmin",void 0),u([d()],xs.prototype,"oAuthState",void 0),u([d()],xs.prototype,"resources",void 0),u([d()],xs.prototype,"scope",void 0),u([d()],xs.prototype,"server",void 0),u([d()],xs.prototype,"ssl",void 0),u([d()],xs.prototype,"token",void 0),u([d()],xs.prototype,"tokenRefreshBuffer",void 0),u([d()],xs.prototype,"userId",void 0),u([d()],xs.prototype,"validity",void 0),xs=u([R("esri.identity.Credential")],xs);let b1e=class extends v1e{};b1e.prototype.declaredClass="esri.identity.IdentityManager";const T5=new b1e;oIe(T5);const fHe=Object.freeze(Object.defineProperty({__proto__:null,default:T5},Symbol.toStringTag,{value:"Module"}));function w1e(t){return t&&"getAtOrigin"in t&&"originOf"in t}function ere(t){t&&t.writtenProperties&&t.writtenProperties.forEach(({target:e,propName:r,newOrigin:i})=>{w1e(e)&&i&&e.originOf(r)!==i&&e.updateOrigin(r,i)})}async function mHe(t,e,r,i,s,n){let o=null;if(r!=null){const c=`${t}/nodepages/`,h=c+Math.floor(r.rootIndex/r.nodesPerPage);try{return{type:"page",rootPage:(await qt(h,{query:{f:"json",token:i},responseType:"json",signal:n})).data,rootIndex:r.rootIndex,pageSize:r.nodesPerPage,lodMetric:r.lodSelectionMetricType,urlPrefix:c}}catch(p){s?.warn("#fetchIndexInfo()","Failed to load root node page. Falling back to node documents.",h,p),o=p}}if(!e)return null;const a=`${t}/nodes/`,l=a+(e&&e.split("/").pop());try{return{type:"node",rootNode:(await qt(l,{query:{f:"json",token:i},responseType:"json",signal:n})).data,urlPrefix:a}}catch(c){throw new F("sceneservice:root-node-missing","Root node missing.",{pageError:o,nodeError:c,url:l})}}let gHe=null;function yHe(){return gHe}async function _He(t,e={},r){await t.load(r);const i=bc(t.itemUrl,"resources"),{start:s=1,num:n=10,sortOrder:o="asc",sortField:a="created"}=e,l={query:{start:s,num:n,sortOrder:o,sortField:a,token:t.apiKey},signal:r?.signal},c=await t.portal.request(i,l);return{total:c.total,nextStart:c.nextStart,resources:c.resources.map(({created:h,size:p,resource:f})=>({created:new Date(h),size:p,resource:t.resourceFromPath(f)}))}}async function vHe(t,e,r,i){if(!t.hasPath())throw new F(`portal-item-resource-${e}:invalid-path`,"Resource does not have a valid path");const s=t.portalItem;await s.load(i);const n=bc(s.userItemUrl,e==="add"?"addResources":"updateResources"),[o,a]=x1e(t.path),l=await T1e(r),c=new FormData;return o&&o!=="."&&c.append("resourcesPrefix",o),i!=null&&i.compress&&c.append("compress","true"),c.append("fileName",a),c.append("file",l,a),c.append("f","json"),i!=null&&i.access&&c.append("access",i.access),await s.portal.request(n,{method:"post",body:c,signal:i?.signal}),t}async function bHe(t,e,r){if(!e.hasPath())throw new F("portal-item-resources-remove:invalid-path","Resource does not have a valid path");await t.load(r);const i=bc(t.userItemUrl,"removeResources");await t.portal.request(i,{method:"post",query:{resource:e.path},signal:r?.signal}),e.portalItem=null}async function wHe(t,e){await t.load(e);const r=bc(t.userItemUrl,"removeResources");return t.portal.request(r,{method:"post",query:{deleteAll:!0},signal:e?.signal})}function x1e(t){const e=t.lastIndexOf("/");return e===-1?[".",t]:[t.slice(0,e),t.slice(e+1)]}function JZ(t){const[e,r]=xHe(t),[i,s]=x1e(e);return[i,s,r]}function xHe(t){const e=Iq(t);return e==null?[t,""]:[t.slice(0,t.length-e.length-1),`.${e}`]}async function T1e(t){return t instanceof Blob?t:(await qt(t.url,{responseType:"blob"})).data}function THe(t,e){if(!t.hasPath())return null;const[r,,i]=JZ(t.path);return t.portalItem.resourceFromPath(bc(r,e+i))}function S1e(t,e){if(!t.hasPath())return null;const[r,,i]=JZ(t.path);return t.portalItem.resourceFromPath(bc(r,e+i))}const AA=Object.freeze(Object.defineProperty({__proto__:null,addOrUpdateResource:vHe,contentToBlob:T1e,fetchResources:_He,getSiblingOfSameType:THe,getSiblingOfSameTypeI:S1e,removeAllResources:wHe,removeResource:bHe,splitPrefixFileNameAndExtension:JZ},Symbol.toStringTag,{value:"Module"}));async function tre(t,e,r){if(!e||!e.resources)return;const i=e.portalItem===t.portalItem?new Set(t.paths):new Set;t.paths.length=0,t.portalItem=e.portalItem;const s=new Set(e.resources.toKeep.map(c=>c.resource.path)),n=new Set,o=[];s.forEach(c=>{i.delete(c),t.paths.push(c)});for(const c of e.resources.toUpdate)if(i.delete(c.resource.path),s.has(c.resource.path)||n.has(c.resource.path)){const{resource:h,content:p,finish:f,error:m}=c,y=S1e(h,NF());t.paths.push(y.path),o.push(rre({resource:y,content:p,compress:c.compress,finish:f,error:m},r))}else t.paths.push(c.resource.path),o.push(SHe(c,r)),n.add(c.resource.path);for(const c of e.resources.toAdd)o.push(rre(c,r)),t.paths.push(c.resource.path);if(i.forEach(c=>{if(e.portalItem){const h=e.portalItem.resourceFromPath(c);o.push(h.portalItem.removeResource(h).catch(()=>{}))}}),o.length===0)return;const a=await Yf(o);Xt(r);const l=a.filter(c=>"error"in c).map(c=>c.error);if(l.length>0)throw new F("save:resources","Failed to save one or more resources",{errors:l})}async function rre(t,e){const r={...e??{},compress:t.compress},i=await gu(t.resource.portalItem.addResource(t.resource,t.content,r));if(i.ok!==!0)throw t.error?.(i.error),i.error;t.finish?.(t.resource)}async function SHe(t,e){const r=await gu(t.resource.update(t.content,e));if(r.ok!==!0)throw t.error?.(r.error),r.error;t.finish?.(t.resource)}const E1e="esri.layers.mixins.SceneService",Ww=Q.getLogger(E1e),EHe=t=>{let e=class extends t{constructor(){super(...arguments),this.spatialReference=null,this.fullExtent=null,this.heightModelInfo=null,this.minScale=0,this.maxScale=0,this.version={major:Number.NaN,minor:Number.NaN,versionString:""},this.copyright=null,this.sublayerTitleMode="item-title",this.title=null,this.layerId=null,this.indexInfo=null,this._debouncedSaveOperations=xq(async(r,i,s)=>{switch(r){case m2.SAVE:return this._save(i);case m2.SAVE_AS:return this._saveAs(s,i)}})}readSpatialReference(r,i){return this._readSpatialReference(i)}_readSpatialReference(r){if(r.spatialReference!=null)return je.fromJSON(r.spatialReference);{const i=r.store,s=i.indexCRS||i.geographicCRS,n=s&&parseInt(s.substring(s.lastIndexOf("/")+1,s.length),10);return n!=null?new je(n):null}}readFullExtent(r,i,s){if(r!=null&&typeof r=="object"){const a=r.spatialReference==null?{...r,spatialReference:this._readSpatialReference(i)}:r;return _r.fromJSON(a,s)}const n=i.store,o=this._readSpatialReference(i);return o==null||n==null||n.extent==null||!Array.isArray(n.extent)||n.extent.some(a=>a<zU)?null:new _r({xmin:n.extent[0],ymin:n.extent[1],xmax:n.extent[2],ymax:n.extent[3],spatialReference:o})}parseVersionString(r){const i={major:Number.NaN,minor:Number.NaN,versionString:r},s=r.split(".");return s.length>=2&&(i.major=parseInt(s[0],10),i.minor=parseInt(s[1],10)),i}readVersion(r,i){const s=i.store,n=s.version!=null?s.version.toString():"";return this.parseVersionString(n)}readTitlePortalItem(r){return this.sublayerTitleMode!=="item-title"?void 0:r}readTitleService(r,i){const s=this.portalItem&&this.portalItem.title;if(this.sublayerTitleMode==="item-title")return Rye(this.url,i.name);let n=i.name;if(!n&&this.url){const o=Iw(this.url);o!=null&&(n=o.title)}return this.sublayerTitleMode==="item-title-and-service-name"&&s&&(n=s+" - "+n),e5(n)}set url(r){const i=Pye({layer:this,url:r,nonStandardUrlAllowed:!1,logger:Ww});this._set("url",i.url),i.layerId!=null&&this._set("layerId",i.layerId)}writeUrl(r,i,s,n){Mye(this,r,"layers",i,n)}get parsedUrl(){const r=this._get("url"),i=cn(r);return this.layerId!=null&&(i.path=`${i.path}/layers/${this.layerId}`),i}async _fetchIndexAndUpdateExtent(r,i){this.indexInfo=mHe(this.parsedUrl.path,this.rootNode,r,this.apiKey,Ww,i),this.fullExtent==null||this.fullExtent.hasZ||this._updateExtent(await this.indexInfo)}_updateExtent(r){if(r?.type==="page"){const i=r.rootIndex%r.pageSize,s=r.rootPage?.nodes?.[i];if(s==null||s.obb==null||s.obb.center==null||s.obb.halfSize==null)throw new F("sceneservice:invalid-node-page","Invalid node page.");if(s.obb.center[0]<zU||this.fullExtent==null||this.fullExtent.hasZ)return;const n=s.obb.halfSize,o=s.obb.center[2],a=Math.sqrt(n[0]*n[0]+n[1]*n[1]+n[2]*n[2]);this.fullExtent.zmin=o-a,this.fullExtent.zmax=o+a}else if(r?.type==="node"){const i=r.rootNode?.mbs;if(!Array.isArray(i)||i.length!==4||i[0]<zU)return;const s=i[2],n=i[3],{fullExtent:o}=this;o&&(o.zmin=s-n,o.zmax=s+n)}}async _fetchService(r){if(this.url==null)throw new F("sceneservice:url-not-set","Scene service can not be loaded without valid portal item or url");if(this.layerId==null&&/SceneServer\/*$/i.test(this.url)){const i=await this._fetchFirstLayerId(r);i!=null&&(this.layerId=i)}return this._fetchServiceLayer(r)}async _fetchFirstLayerId(r){const i=await qt(this.url,{query:{f:"json",token:this.apiKey},responseType:"json",signal:r});if(i.data&&Array.isArray(i.data.layers)&&i.data.layers.length>0)return i.data.layers[0].id}async _fetchServiceLayer(r){const i=await qt(this.parsedUrl?.path??"",{query:{f:"json",token:this.apiKey},responseType:"json",signal:r});i.ssl&&(this.url=this.url.replace(/^http:/i,"https:"));let s=!1;if(i.data.layerType&&i.data.layerType==="Voxel"&&(s=!0),s)return this._fetchVoxelServiceLayer();const n=i.data;this.read(n,this._getServiceContext()),this.validateLayer(n)}async _fetchVoxelServiceLayer(r){const i=(await qt(this.parsedUrl?.path+"/layer",{query:{f:"json",token:this.apiKey},responseType:"json",signal:r})).data;this.read(i,this._getServiceContext()),this.validateLayer(i)}_getServiceContext(){return{origin:"service",portalItem:this.portalItem,portal:this.portalItem?.portal,url:this.parsedUrl}}async _ensureLoadBeforeSave(){await this.load(),"beforeSave"in this&&typeof this.beforeSave=="function"&&await this.beforeSave()}validateLayer(r){}_updateTypeKeywords(r,i,s){r.typeKeywords||(r.typeKeywords=[]);const n=i.getTypeKeywords();for(const o of n)r.typeKeywords.push(o);r.typeKeywords&&(r.typeKeywords=r.typeKeywords.filter((o,a,l)=>l.indexOf(o)===a),s===k3.newItem&&(r.typeKeywords=r.typeKeywords.filter(o=>o!=="Hosted Service")))}async _saveAs(r,i){const s={...ire,...i};let n=Ab.from(r);n||(Ww.error("_saveAs(): requires a portal item parameter"),await Promise.reject(new F("sceneservice:portal-item-required","_saveAs() requires a portal item to save to"))),n.id&&(n=n.clone(),n.id=null);const o=n.portal||Qn.getDefault();await this._ensureLoadBeforeSave(),n.type=mM,n.portal=o;const a={origin:"portal-item",url:null,messages:[],portal:o,portalItem:n,writtenProperties:[],blockedRelativeUrls:[],resources:{toAdd:[],toUpdate:[],toKeep:[],pendingOperations:[]}},l={layers:[this.write({},a)]};return await Promise.all(a.resources.pendingOperations??[]),await this._validateAgainstJSONSchema(l,a,s),n.url=this.url,n.title||(n.title=this.title),this._updateTypeKeywords(n,s,k3.newItem),await o.signIn(),await o.user?.addItem({item:n,folder:s&&s.folder,data:l}),await tre(this.resourceReferences,a,null),this.portalItem=n,ere(a),a.portalItem=n,n}async _save(r){const i={...ire,...r};if(!this.portalItem)throw Ww.error("_save(): requires the .portalItem property to be set"),new F("sceneservice:portal-item-not-set","Portal item to save to has not been set on this SceneService");if(this.portalItem.type!==mM)throw Ww.error("_save(): Non-matching portal item type. Got "+this.portalItem.type+", expected "+mM),new F("sceneservice:portal-item-wrong-type",`Portal item needs to have type "${mM}"`);await this._ensureLoadBeforeSave();const s={origin:"portal-item",url:this.portalItem.itemUrl&&cn(this.portalItem.itemUrl),messages:[],portal:this.portalItem.portal||Qn.getDefault(),portalItem:this.portalItem,writtenProperties:[],blockedRelativeUrls:[],resources:{toAdd:[],toUpdate:[],toKeep:[],pendingOperations:[]}},n={layers:[this.write({},s)]};return await Promise.all(s.resources.pendingOperations??[]),await this._validateAgainstJSONSchema(n,s,i),this.portalItem.url=this.url,this.portalItem.title||(this.portalItem.title=this.title),this._updateTypeKeywords(this.portalItem,i,k3.existingItem),await this.portalItem.update({data:n}),await tre(this.resourceReferences,s,null),ere(s),this.portalItem}async _validateAgainstJSONSchema(r,i,s){let n=i.messages?.filter(c=>c.type==="error").map(c=>new F(c.name,c.message,c.details))??[];s?.validationOptions?.ignoreUnsupported&&(n=n.filter(c=>c.name!=="layer:unsupported"&&c.name!=="symbol:unsupported"&&c.name!=="symbol-layer:unsupported"&&c.name!=="property:unsupported"&&c.name!=="url:unsupported"&&c.name!=="scenemodification:unsupported"));const o=s?.validationOptions,a=o?.enabled,l=yHe();if(a&&l){const c=(await l()).validate(r,s.portalItemLayerType);if(c.length>0){const h=`Layer item did not validate:
${c.join(`
`)}`;if(Ww.error(`_validateAgainstJSONSchema(): ${h}`),o.failPolicy==="throw"){const p=c.map(f=>new F("sceneservice:schema-validation",f)).concat(n);throw new F("sceneservice-validate:error","Failed to save layer item due to schema validation, see `details.errors`.",{combined:p})}}}if(n.length>0)throw new F("sceneservice:save","Failed to save SceneService due to unsupported or invalid content. See 'details.errors' for more detailed information",{errors:n})}};return u([d(i_e)],e.prototype,"id",void 0),u([d({type:je})],e.prototype,"spatialReference",void 0),u([Ee("spatialReference",["spatialReference","store.indexCRS","store.geographicCRS"])],e.prototype,"readSpatialReference",null),u([d({type:_r})],e.prototype,"fullExtent",void 0),u([Ee("fullExtent",["fullExtent","store.extent","spatialReference","store.indexCRS","store.geographicCRS"])],e.prototype,"readFullExtent",null),u([d({readOnly:!0,type:$w})],e.prototype,"heightModelInfo",void 0),u([d({type:Number,json:{name:"layerDefinition.minScale",write:!0,origins:{service:{read:{source:"minScale"},write:!1}}}})],e.prototype,"minScale",void 0),u([d({type:Number,json:{name:"layerDefinition.maxScale",write:!0,origins:{service:{read:{source:"maxScale"},write:!1}}}})],e.prototype,"maxScale",void 0),u([d({readOnly:!0})],e.prototype,"version",void 0),u([Ee("version",["store.version"])],e.prototype,"readVersion",null),u([d({type:String,json:{read:{source:"copyrightText"}}})],e.prototype,"copyright",void 0),u([d({type:String,json:{read:!1}})],e.prototype,"sublayerTitleMode",void 0),u([d({type:String})],e.prototype,"title",void 0),u([Ee("portal-item","title")],e.prototype,"readTitlePortalItem",null),u([Ee("service","title",["name"])],e.prototype,"readTitleService",null),u([d({type:Number,json:{origins:{service:{read:{source:"id"}},"portal-item":{write:{target:"id",isRequired:!0,ignoreOrigin:!0},read:!1}}}})],e.prototype,"layerId",void 0),u([d(K0e)],e.prototype,"url",null),u([Fe("url")],e.prototype,"writeUrl",null),u([d()],e.prototype,"parsedUrl",null),u([d({readOnly:!0})],e.prototype,"store",void 0),u([d({type:String,readOnly:!0,json:{read:{source:"store.rootNode"}}})],e.prototype,"rootNode",void 0),e=u([R(E1e)],e),e},zU=-1e38;var k3;(function(t){t[t.existingItem=0]="existingItem",t[t.newItem=1]="newItem"})(k3||(k3={}));const mM="Scene Service",ire={getTypeKeywords:()=>[],portalItemLayerType:"unknown",validationOptions:{enabled:!0,ignoreUnsupported:!1,failPolicy:"throw"}};var m2;(function(t){t[t.SAVE=0]="SAVE",t[t.SAVE_AS=1]="SAVE_AS"})(m2||(m2={}));const CHe={analytics:{supportsCacheHint:!1},attachment:{supportsContentType:!1,supportsExifInfo:!1,supportsKeywords:!1,supportsName:!1,supportsSize:!1,supportsCacheHint:!1,supportsResize:!1},data:{isVersioned:!1,supportsAttachment:!1,supportsM:!1,supportsZ:!1},editing:{supportsDeleteByAnonymous:!1,supportsDeleteByOthers:!1,supportsGeometryUpdate:!1,supportsGlobalId:!1,supportsReturnServiceEditsInSourceSpatialReference:!1,supportsRollbackOnFailure:!1,supportsUpdateByAnonymous:!1,supportsUpdateByOthers:!1,supportsUpdateWithoutM:!1,supportsUploadWithItemId:!1,supportsAsyncApplyEdits:!1},metadata:{supportsAdvancedFieldProperties:!1},operations:{supportsCalculate:!1,supportsTruncate:!1,supportsValidateSql:!1,supportsAdd:!1,supportsDelete:!1,supportsEditing:!1,supportsChangeTracking:!1,supportsQuery:!1,supportsQueryAnalytics:!1,supportsQueryAttachments:!1,supportsQueryTopFeatures:!1,supportsResizeAttachments:!1,supportsSync:!1,supportsUpdate:!1,supportsExceedsLimitStatistics:!1,supportsAsyncConvert3D:!1},queryRelated:{supportsCount:!1,supportsOrderBy:!1,supportsPagination:!1,supportsCacheHint:!1},queryTopFeatures:{supportsCacheHint:!1},query:{maxRecordCount:0,maxRecordCountFactor:0,standardMaxRecordCount:0,supportsCacheHint:!1,supportsCentroid:!1,supportsCompactGeometry:!1,supportsDefaultSpatialReference:!1,supportsFullTextSearch:!1,supportsDisjointSpatialRelationship:!1,supportsDistance:!1,supportsDistinct:!1,supportsExtent:!1,supportsFormatPBF:!1,supportsGeometryProperties:!1,supportsHavingClause:!1,supportsHistoricMoment:!1,supportsMaxRecordCountFactor:!1,supportsOrderBy:!1,supportsPagination:!1,supportsPercentileStatistics:!1,supportsQuantization:!1,supportsQuantizationEditMode:!1,supportsQueryByOthers:!1,supportsQueryGeometry:!1,supportsResultType:!1,supportsSqlExpression:!1,supportsStandardizedQueriesOnly:!1,supportsTopFeaturesQuery:!1,supportsSpatialAggregationStatistics:!1,supportedSpatialAggregationStatistics:{envelope:!1,centroid:!1,convexHull:!1},supportsStatistics:!1,tileMaxRecordCount:0}};let AHe=class{constructor(e,r,i,s){this._parsedUrl=e,this._portalItem=r,this._apiKey=i,this.signal=s,this._rootDocument=null;const n=this._parsedUrl?.path.match(/^(.*)\/SceneServer\/layers\/([\d]*)\/?$/i);n&&(this._urlParts={root:n[1],layerId:parseInt(n[2],10)})}async fetch(){if(!this._urlParts)return null;const e=this._portalItem??await this._portalItemFromServiceItemId();if(e==null)return this._loadFromUrl();const r=await this._findAndLoadRelatedPortalItem(e);return r==null?null:this._loadFeatureLayerFromPortalItem(r)}async fetchPortalItem(){if(!this._urlParts)return null;const e=this._portalItem??await this._portalItemFromServiceItemId();return e==null?null:this._findAndLoadRelatedPortalItem(e)}async _fetchRootDocument(){if(this._rootDocument!=null)return this._rootDocument;if(this._urlParts==null)return this._rootDocument={},{};const e={query:{f:"json",token:this._apiKey},responseType:"json",signal:this.signal},r=`${this._urlParts.root}/SceneServer`;try{const i=await qt(r,e);this._rootDocument=i.data}catch{this._rootDocument={}}return this._rootDocument}async _fetchServiceOwningPortalUrl(){const e=this._parsedUrl?.path,r=e?Gt?.findServerInfo(e):null;if(r?.owningSystemUrl)return r.owningSystemUrl;const i=e?e.replace(/(.*\/rest)\/.*/i,"$1")+"/info":null;try{const s=(await qt(i,{query:{f:"json"},responseType:"json",signal:this.signal})).data.owningSystemUrl;if(s)return s}catch(s){Lo(s)}return null}async _findAndLoadRelatedPortalItem(e){try{return(await e.fetchRelatedItems({relationshipType:"Service2Service",direction:"reverse"},{signal:this.signal})).find(r=>r.type==="Feature Service")||null}catch(r){return Lo(r),null}}async _loadFeatureLayerFromPortalItem(e){await e.load({signal:this.signal});const r=await this._findMatchingAssociatedSublayerUrl(e.url??"");return new F7({url:r,portalItem:e}).load({signal:this.signal})}async _loadFromUrl(){const e=await this._findMatchingAssociatedSublayerUrl(`${this._urlParts?.root}/FeatureServer`);return new F7({url:e}).load({signal:this.signal})}async _findMatchingAssociatedSublayerUrl(e){const r=e.replace(/^(.*FeatureServer)(\/[\d]*\/?)?$/i,"$1"),i=this._urlParts?.layerId,s=this._fetchRootDocument(),n=p=>{const f={query:{f:"json"},responseType:"json",authMode:p,signal:this.signal};return qt(r,f)},o=n("anonymous").catch(()=>n("no-prompt")),[a,l]=await Promise.all([o,s]),c=l&&l.layers,h=a.data&&a.data.layers;if(!Array.isArray(h))throw new Error("expected layers array");if(Array.isArray(c)){for(let p=0;p<Math.min(c.length,h.length);p++)if(c[p].id===i)return`${r}/${h[p].id}`}else if(i!=null&&i<h.length)return`${r}/${h[i].id}`;throw new Error("could not find matching associated sublayer")}async _portalItemFromServiceItemId(){const e=(await this._fetchRootDocument()).serviceItemId;if(!e)return null;const r=new Ab({id:e,apiKey:this._apiKey}),i=await this._fetchServiceOwningPortalUrl();i!=null&&(r.portal=new Qn({url:i}));try{return r.load({signal:this.signal})}catch(s){return Lo(s),null}}},Q1=class extends de{constructor(){super(...arguments),this.nodesPerPage=null,this.rootIndex=0,this.lodSelectionMetricType=null}};u([d({type:Number})],Q1.prototype,"nodesPerPage",void 0),u([d({type:Number})],Q1.prototype,"rootIndex",void 0),u([d({type:String})],Q1.prototype,"lodSelectionMetricType",void 0),Q1=u([R("esri.layer.support.I3SNodePageDefinition")],Q1);let mg=class extends de{constructor(){super(...arguments),this.factor=1}};u([d({type:Number,json:{read:{source:"textureSetDefinitionId"}}})],mg.prototype,"id",void 0),u([d({type:Number})],mg.prototype,"factor",void 0),mg=u([R("esri.layer.support.I3SMaterialTexture")],mg);let h0=class extends de{constructor(){super(...arguments),this.baseColorFactor=[1,1,1,1],this.baseColorTexture=null,this.metallicRoughnessTexture=null,this.metallicFactor=1,this.roughnessFactor=1}};u([d({type:[Number]})],h0.prototype,"baseColorFactor",void 0),u([d({type:mg})],h0.prototype,"baseColorTexture",void 0),u([d({type:mg})],h0.prototype,"metallicRoughnessTexture",void 0),u([d({type:Number})],h0.prototype,"metallicFactor",void 0),u([d({type:Number})],h0.prototype,"roughnessFactor",void 0),h0=u([R("esri.layer.support.I3SMaterialPBRMetallicRoughness")],h0);let Gu=class extends de{constructor(){super(...arguments),this.alphaMode="opaque",this.alphaCutoff=.25,this.doubleSided=!1,this.cullFace="none",this.normalTexture=null,this.occlusionTexture=null,this.emissiveTexture=null,this.emissiveFactor=null,this.pbrMetallicRoughness=null}};u([tt({opaque:"opaque",mask:"mask",blend:"blend"})],Gu.prototype,"alphaMode",void 0),u([d({type:Number})],Gu.prototype,"alphaCutoff",void 0),u([d({type:Boolean})],Gu.prototype,"doubleSided",void 0),u([tt({none:"none",back:"back",front:"front"})],Gu.prototype,"cullFace",void 0),u([d({type:mg})],Gu.prototype,"normalTexture",void 0),u([d({type:mg})],Gu.prototype,"occlusionTexture",void 0),u([d({type:mg})],Gu.prototype,"emissiveTexture",void 0),u([d({type:[Number]})],Gu.prototype,"emissiveFactor",void 0),u([d({type:h0})],Gu.prototype,"pbrMetallicRoughness",void 0),Gu=u([R("esri.layer.support.I3SMaterialDefinition")],Gu);let OA=class extends de{};u([d({type:String,json:{read:{source:["name","index"],reader:(t,e)=>t??`${e.index}`}}})],OA.prototype,"name",void 0),u([tt({jpg:"jpg",png:"png",dds:"dds","ktx-etc2":"ktx-etc2",ktx2:"ktx2",basis:"basis"})],OA.prototype,"format",void 0),OA=u([R("esri.layer.support.I3STextureFormat")],OA);let RA=class extends de{constructor(){super(...arguments),this.atlas=!1}};u([d({type:[OA]})],RA.prototype,"formats",void 0),u([d({type:Boolean})],RA.prototype,"atlas",void 0),RA=u([R("esri.layer.support.I3STextureSetDefinition")],RA);let Dd=class extends de{};u([tt({Float32:"Float32",UInt64:"UInt64",UInt32:"UInt32",UInt16:"UInt16",UInt8:"UInt8"})],Dd.prototype,"type",void 0),u([d({type:Number})],Dd.prototype,"component",void 0),Dd=u([R("esri.layer.support.I3SGeometryAttribute")],Dd);let PA=class extends de{};u([tt({draco:"draco"})],PA.prototype,"encoding",void 0),u([d({type:[String]})],PA.prototype,"attributes",void 0),PA=u([R("esri.layer.support.I3SGeometryCompressedAttributes")],PA);let Xh=class extends de{constructor(){super(...arguments),this.offset=0}};u([d({type:Number})],Xh.prototype,"offset",void 0),u([d({type:Dd})],Xh.prototype,"position",void 0),u([d({type:Dd})],Xh.prototype,"normal",void 0),u([d({type:Dd})],Xh.prototype,"uv0",void 0),u([d({type:Dd})],Xh.prototype,"color",void 0),u([d({type:Dd})],Xh.prototype,"uvRegion",void 0),u([d({type:Dd})],Xh.prototype,"featureId",void 0),u([d({type:Dd})],Xh.prototype,"faceRange",void 0),u([d({type:PA})],Xh.prototype,"compressedAttributes",void 0),Xh=u([R("esri.layer.support.I3SGeometryBuffer")],Xh);let MA=class extends de{};u([tt({triangle:"triangle"})],MA.prototype,"topology",void 0),u([d()],MA.prototype,"geometryBuffers",void 0),MA=u([R("esri.layer.support.I3SGeometryDefinition")],MA);let d0=class extends de{constructor(){super(...arguments),this.name=null,this.field=null,this.currentRangeExtent=null,this.fullRangeExtent=null,this.type="rangeInfo"}};u([d({type:String,json:{read:!0,write:!0}})],d0.prototype,"name",void 0),u([d({type:String,json:{read:!0,write:!0}})],d0.prototype,"field",void 0),u([d({type:[Number],json:{read:!0,write:!0}})],d0.prototype,"currentRangeExtent",void 0),u([d({type:[Number],json:{read:!0,write:!0}})],d0.prototype,"fullRangeExtent",void 0),u([d({type:["rangeInfo"],readOnly:!0,json:{read:!1,write:!0}})],d0.prototype,"type",void 0),d0=u([R("esri.layers.support.RangeInfo")],d0);function eG(t){return QZ[OHe(t)]||PHe}function OHe(t){return t instanceof Blob?t.type:RHe(t.url)}function RHe(t){const e=Iq(t);return tG[e]||C1e}const QZ={},C1e="text/plain",PHe=QZ[C1e],tG={png:"image/png",jpeg:"image/jpeg",jpg:"image/jpg",bmp:"image/bmp",gif:"image/gif",json:"application/json",txt:"text/plain",xml:"application/xml",svg:"image/svg+xml",zip:"application/zip",pbf:"application/vnd.mapbox-vector-tile",gz:"application/gzip","bin.gz":"application/octet-stream"};for(const t in tG)QZ[tG[t]]=t;function MHe(t){const e=t?.origins??[void 0];return(r,i)=>{const s=IHe(t,r,i);for(const n of e){const o=kq(r,n,i);for(const a in s)o[a]=s[a]}}}function IHe(t,e,r){if(t?.type==="resource")return $He(t,e,r);switch(t?.type??"other"){case"other":return{read:!0,write:!0};case"url":{const{read:i,write:s}=nUe;return{read:i,write:s}}}}function $He(t,e,r){const i=ER(e,r);return{type:String,read:(s,n,o)=>{const a=WF(s,n,o);return i.type===String?a:typeof i.type=="function"?new i.type({url:a}):void 0},write:{writer(s,n,o,a){if(!a||!a.resources)return typeof s=="string"?void(n[o]=Ng(s,a)):void(n[o]=s.write({},a));const l=FHe(s),c=Ng(l,{...a,verifyItemRelativeUrls:a&&a.verifyItemRelativeUrls?{writtenUrls:a.verifyItemRelativeUrls.writtenUrls,rootPath:void 0}:void 0},o2.NO),h=i.type!==String&&(!w1e(this)||a&&a.origin&&this.originIdOf(r)>dg(a.origin)),p={object:this,propertyName:r,value:s,targetUrl:c,dest:n,targetPropertyName:o,context:a,params:t};a&&a.portalItem&&c&&!mc(c)?h?LHe(p):DHe(p):a&&a.portalItem&&(c==null||Vge(c)!=null||x_(c)||h)?A1e(p):n[o]=c}}}}function A1e(t){const{targetUrl:e,params:r,value:i,context:s,dest:n,targetPropertyName:o}=t;if(!s.portalItem)return;const a=zge(e),l=a?.filename??NF(),c=r?.prefix??a?.prefix,h=R1e(i,e,s),p=bc(c,l),f=`${p}.${eG(h)}`,m=s.portalItem.resourceFromPath(f);x_(e)&&s.resources&&s.resources.pendingOperations.push(NHe(e).then(_=>{m.path=`${p}.${eG(_)}`,n[o]=m.itemRelativeUrl}).catch(()=>{}));const y=r?.compress??!1;s.resources&&O1e({...t,resource:m,content:h,compress:y,updates:s.resources.toAdd}),n[o]=m.itemRelativeUrl}function LHe(t){const{context:e,targetUrl:r,params:i,value:s,dest:n,targetPropertyName:o}=t;if(!e.portalItem)return;const a=e.portalItem.resourceFromPath(r),l=R1e(s,r,e),c=eG(l),h=Iq(a.path),p=i?.compress??!1;c===h?(e.resources&&O1e({...t,resource:a,content:l,compress:p,updates:e.resources.toUpdate}),n[o]=r):A1e(t)}function DHe({context:t,targetUrl:e,dest:r,targetPropertyName:i}){t.portalItem&&t.resources&&(t.resources.toKeep.push({resource:t.portalItem.resourceFromPath(e),compress:!1}),r[i]=e)}function O1e({object:t,propertyName:e,updates:r,resource:i,content:s,compress:n}){r.push({resource:i,content:s,compress:n,finish:o=>{UHe(t,e,o)}})}function R1e(t,e,r){return typeof t=="string"?{url:e}:new Blob([JSON.stringify(t.toJSON(r))],{type:"application/json"})}async function NHe(t){const e=(await ae(()=>Promise.resolve().then(()=>Kde),void 0,import.meta.url)).default,{data:r}=await e(t,{responseType:"blob"});return r}function FHe(t){return t==null?null:typeof t=="string"?t:t.url}function UHe(t,e,r){typeof t[e]=="string"?t[e]=r.url:t[e].url=r.url}var LL;let rG=LL=class extends K2(Pt.ofType(Jd)){constructor(t){super(t)}clone(){return new LL(this.items.map(t=>t.clone()))}write(t,e){return this.toJSON(e)}toJSON(t){const e=t?.layer?.spatialReference;return e?this.toArray().map(r=>{if(!e.equals(r.spatialReference)){if(!Vf(r.spatialReference,e))return t&&t.messages&&t.messages.push(new Sh("scenefilter:unsupported","Scene filters with incompatible spatial references are not supported",{modification:this,spatialReference:t.layer.spatialReference,context:t})),null;const s=new Jd;L_e(r,s,e),r=s}const i=r.toJSON(t);return delete i.spatialReference,i}).filter(r=>r!=null):(t?.messages&&t.messages.push(new Sh("scenefilter:unsupported","Writing Scene filters without context layer is not supported",{modification:this,spatialReference:t.layer.spatialReference,context:t})),this.toArray().map(r=>r.toJSON(t)))}static fromJSON(t,e){const r=new LL;return t.forEach(i=>r.add(Jd.fromJSON(i,e))),r}};rG=LL=u([R("esri.layers.support.PolygonCollection")],rG);const DL=rG;var iG;let PT=iG=class extends de{constructor(t){super(t),this.spatialRelationship="disjoint",this.geometries=new DL,this._geometriesSource=null,this._handles=new Oi}initialize(){this._handles.add(Ga(()=>this.geometries,"after-changes",()=>this.geometries=this.geometries,jr))}destroy(){this._handles.destroy()}readGeometries(t,e,r){Array.isArray(t)?this.geometries=DL.fromJSON(t,r):this._geometriesSource={url:Dg(t,r),context:r}}async loadGeometries(t,e){if(this._geometriesSource==null)return;const{url:r,context:i}=this._geometriesSource,s=await qt(r,{responseType:"json",signal:e?.signal}),n=t.toJSON(),o=s.data.map(a=>({...a,spatialReference:n}));this.geometries=DL.fromJSON(o,i),this._geometriesSource=null}clone(){const t=new iG({geometries:K(this.geometries),spatialRelationship:this.spatialRelationship});return t._geometriesSource=this._geometriesSource,t}};u([d({type:["disjoint","contains"],nonNullable:!0,json:{write:!0}})],PT.prototype,"spatialRelationship",void 0),u([d({type:DL,nonNullable:!0,json:{write:!0}}),MHe({origins:["web-scene","portal-item"],type:"resource",prefix:"geometries"})],PT.prototype,"geometries",void 0),u([Ee(["web-scene","portal-item"],"geometries")],PT.prototype,"readGeometries",null),PT=iG=u([R("esri.layers.support.SceneFilter")],PT);const kHe=PT;function Ph(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[4],t[4]=e[5],t[5]=e[6],t[6]=e[8],t[7]=e[9],t[8]=e[10],t}function VHe(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t}function KZ(t,e,r,i,s,n,o,a,l,c){return t[0]=e,t[1]=r,t[2]=i,t[3]=s,t[4]=n,t[5]=o,t[6]=a,t[7]=l,t[8]=c,t}function eX(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=1,t[5]=0,t[6]=0,t[7]=0,t[8]=1,t}function Mh(t,e){if(t===e){const r=e[1],i=e[2],s=e[5];t[1]=e[3],t[2]=e[6],t[3]=r,t[5]=e[7],t[6]=i,t[7]=s}else t[0]=e[0],t[1]=e[3],t[2]=e[6],t[3]=e[1],t[4]=e[4],t[5]=e[7],t[6]=e[2],t[7]=e[5],t[8]=e[8];return t}function Nw(t,e){const r=e[0],i=e[1],s=e[2],n=e[3],o=e[4],a=e[5],l=e[6],c=e[7],h=e[8],p=h*o-a*c,f=-h*n+a*l,m=c*n-o*l;let y=r*p+i*f+s*m;return y?(y=1/y,t[0]=p*y,t[1]=(-h*i+s*c)*y,t[2]=(a*i-s*o)*y,t[3]=f*y,t[4]=(h*r-s*l)*y,t[5]=(-a*r+s*n)*y,t[6]=m*y,t[7]=(-c*r+i*l)*y,t[8]=(o*r-i*n)*y,t):null}function zHe(t,e){const r=e[0],i=e[1],s=e[2],n=e[3],o=e[4],a=e[5],l=e[6],c=e[7],h=e[8];return t[0]=o*h-a*c,t[1]=s*c-i*h,t[2]=i*a-s*o,t[3]=a*l-n*h,t[4]=r*h-s*l,t[5]=s*n-r*a,t[6]=n*c-o*l,t[7]=i*l-r*c,t[8]=r*o-i*n,t}function BHe(t){const e=t[0],r=t[1],i=t[2],s=t[3],n=t[4],o=t[5],a=t[6],l=t[7],c=t[8];return e*(c*n-o*l)+r*(-c*s+o*a)+i*(l*s-n*a)}function g2(t,e,r){const i=e[0],s=e[1],n=e[2],o=e[3],a=e[4],l=e[5],c=e[6],h=e[7],p=e[8],f=r[0],m=r[1],y=r[2],_=r[3],v=r[4],w=r[5],x=r[6],T=r[7],S=r[8];return t[0]=f*i+m*o+y*c,t[1]=f*s+m*a+y*h,t[2]=f*n+m*l+y*p,t[3]=_*i+v*o+w*c,t[4]=_*s+v*a+w*h,t[5]=_*n+v*l+w*p,t[6]=x*i+T*o+S*c,t[7]=x*s+T*a+S*h,t[8]=x*n+T*l+S*p,t}function HN(t,e,r){const i=e[0],s=e[1],n=e[2],o=e[3],a=e[4],l=e[5],c=e[6],h=e[7],p=e[8],f=r[0],m=r[1];return t[0]=i,t[1]=s,t[2]=n,t[3]=o,t[4]=a,t[5]=l,t[6]=f*i+m*o+c,t[7]=f*s+m*a+h,t[8]=f*n+m*l+p,t}function tX(t,e,r){const i=e[0],s=e[1],n=e[2],o=e[3],a=e[4],l=e[5],c=e[6],h=e[7],p=e[8],f=Math.sin(r),m=Math.cos(r);return t[0]=m*i+f*o,t[1]=m*s+f*a,t[2]=m*n+f*l,t[3]=m*o-f*i,t[4]=m*a-f*s,t[5]=m*l-f*n,t[6]=c,t[7]=h,t[8]=p,t}function rX(t,e,r){const i=r[0],s=r[1],n=r[2];return t[0]=i*e[0],t[1]=i*e[1],t[2]=i*e[2],t[3]=s*e[3],t[4]=s*e[4],t[5]=s*e[5],t[6]=n*e[6],t[7]=n*e[7],t[8]=n*e[8],t}function GHe(t,e,r){const i=r[0],s=r[1];return t[0]=i*e[0],t[1]=i*e[1],t[2]=i*e[2],t[3]=s*e[3],t[4]=s*e[4],t[5]=s*e[5],t}function jHe(t,e){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=1,t[5]=0,t[6]=e[0],t[7]=e[1],t[8]=1,t}function HHe(t,e){const r=Math.sin(e),i=Math.cos(e);return t[0]=i,t[1]=r,t[2]=0,t[3]=-r,t[4]=i,t[5]=0,t[6]=0,t[7]=0,t[8]=1,t}function qHe(t,e){return t[0]=e[0],t[1]=0,t[2]=0,t[3]=0,t[4]=e[1],t[5]=0,t[6]=0,t[7]=0,t[8]=1,t}function WHe(t,e){return t[0]=e[0],t[1]=e[1],t[2]=0,t[3]=e[2],t[4]=e[3],t[5]=0,t[6]=e[4],t[7]=e[5],t[8]=1,t}function S5(t,e){const r=e[0],i=e[1],s=e[2],n=e[3],o=r+r,a=i+i,l=s+s,c=r*o,h=i*o,p=i*a,f=s*o,m=s*a,y=s*l,_=n*o,v=n*a,w=n*l;return t[0]=1-p-y,t[3]=h-w,t[6]=f+v,t[1]=h+w,t[4]=1-c-y,t[7]=m-_,t[2]=f-v,t[5]=m+_,t[8]=1-c-p,t}function P1e(t,e){const r=e[0],i=e[1],s=e[2],n=e[4],o=e[5],a=e[6],l=e[8],c=e[9],h=e[10],p=h*o-a*c,f=-h*n+a*l,m=c*n-o*l,y=r*p+i*f+s*m;if(!y)return null;const _=1/y;return t[0]=p*_,t[1]=(-h*i+s*c)*_,t[2]=(a*i-s*o)*_,t[3]=f*_,t[4]=(h*r-s*l)*_,t[5]=(-a*r+s*n)*_,t[6]=m*_,t[7]=(-c*r+i*l)*_,t[8]=(o*r-i*n)*_,t}function L_(t,e){const r=e[0],i=e[1],s=e[2],n=e[3],o=e[4],a=e[5],l=e[6],c=e[7],h=e[8],p=e[9],f=e[10],m=e[11],y=e[12],_=e[13],v=e[14],w=e[15],x=r*a-i*o,T=r*l-s*o,S=r*c-n*o,O=i*l-s*a,A=i*c-n*a,I=s*c-n*l,M=h*_-p*y,k=h*v-f*y,L=h*w-m*y,D=p*v-f*_,U=p*w-m*_,X=f*w-m*v;let W=x*X-T*U+S*D+O*L-A*k+I*M;return W?(W=1/W,t[0]=(a*X-l*U+c*D)*W,t[1]=(l*L-o*X-c*k)*W,t[2]=(o*U-a*L+c*M)*W,t[3]=(s*U-i*X-n*D)*W,t[4]=(r*X-s*L+n*k)*W,t[5]=(i*L-r*U-n*M)*W,t[6]=(_*I-v*A+w*O)*W,t[7]=(v*S-y*I-w*T)*W,t[8]=(y*A-_*S+w*x)*W,t):null}function ZHe(t,e,r){return t[0]=2/e,t[1]=0,t[2]=0,t[3]=0,t[4]=-2/r,t[5]=0,t[6]=-1,t[7]=1,t[8]=1,t}function XHe(t){return"mat3("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+", "+t[4]+", "+t[5]+", "+t[6]+", "+t[7]+", "+t[8]+")"}function YHe(t){return Math.sqrt(t[0]**2+t[1]**2+t[2]**2+t[3]**2+t[4]**2+t[5]**2+t[6]**2+t[7]**2+t[8]**2)}function JHe(t,e,r){return t[0]=e[0]+r[0],t[1]=e[1]+r[1],t[2]=e[2]+r[2],t[3]=e[3]+r[3],t[4]=e[4]+r[4],t[5]=e[5]+r[5],t[6]=e[6]+r[6],t[7]=e[7]+r[7],t[8]=e[8]+r[8],t}function M1e(t,e,r){return t[0]=e[0]-r[0],t[1]=e[1]-r[1],t[2]=e[2]-r[2],t[3]=e[3]-r[3],t[4]=e[4]-r[4],t[5]=e[5]-r[5],t[6]=e[6]-r[6],t[7]=e[7]-r[7],t[8]=e[8]-r[8],t}function QHe(t,e,r){return t[0]=e[0]*r,t[1]=e[1]*r,t[2]=e[2]*r,t[3]=e[3]*r,t[4]=e[4]*r,t[5]=e[5]*r,t[6]=e[6]*r,t[7]=e[7]*r,t[8]=e[8]*r,t}function KHe(t,e,r,i){return t[0]=e[0]+r[0]*i,t[1]=e[1]+r[1]*i,t[2]=e[2]+r[2]*i,t[3]=e[3]+r[3]*i,t[4]=e[4]+r[4]*i,t[5]=e[5]+r[5]*i,t[6]=e[6]+r[6]*i,t[7]=e[7]+r[7]*i,t[8]=e[8]+r[8]*i,t}function eqe(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]&&t[4]===e[4]&&t[5]===e[5]&&t[6]===e[6]&&t[7]===e[7]&&t[8]===e[8]}function tqe(t,e){const r=t[0],i=t[1],s=t[2],n=t[3],o=t[4],a=t[5],l=t[6],c=t[7],h=t[8],p=e[0],f=e[1],m=e[2],y=e[3],_=e[4],v=e[5],w=e[6],x=e[7],T=e[8],S=Xa();return Math.abs(r-p)<=S*Math.max(1,Math.abs(r),Math.abs(p))&&Math.abs(i-f)<=S*Math.max(1,Math.abs(i),Math.abs(f))&&Math.abs(s-m)<=S*Math.max(1,Math.abs(s),Math.abs(m))&&Math.abs(n-y)<=S*Math.max(1,Math.abs(n),Math.abs(y))&&Math.abs(o-_)<=S*Math.max(1,Math.abs(o),Math.abs(_))&&Math.abs(a-v)<=S*Math.max(1,Math.abs(a),Math.abs(v))&&Math.abs(l-w)<=S*Math.max(1,Math.abs(l),Math.abs(w))&&Math.abs(c-x)<=S*Math.max(1,Math.abs(c),Math.abs(x))&&Math.abs(h-T)<=S*Math.max(1,Math.abs(h),Math.abs(T))}function iX(t){const e=Xa(),r=t[0],i=t[1],s=t[2],n=t[3],o=t[4],a=t[5],l=t[6],c=t[7],h=t[8];return Math.abs(1-(r*r+n*n+l*l))<=e&&Math.abs(1-(i*i+o*o+c*c))<=e&&Math.abs(1-(s*s+a*a+h*h))<=e}const rqe=g2,iqe=M1e;Object.freeze(Object.defineProperty({__proto__:null,add:JHe,adjoint:zHe,copy:VHe,determinant:BHe,equals:tqe,exactEquals:eqe,frob:YHe,fromMat2d:WHe,fromMat4:Ph,fromQuat:S5,fromRotation:HHe,fromScaling:qHe,fromTranslation:jHe,identity:eX,invert:Nw,isOrthoNormal:iX,mul:rqe,multiply:g2,multiplyScalar:QHe,multiplyScalarAndAdd:KHe,normalFromMat4:L_,normalFromMat4Legacy:P1e,projection:ZHe,rotate:tX,scale:rX,scaleByVec2:GHe,set:KZ,str:XHe,sub:iqe,subtract:M1e,translate:HN,transpose:Mh},Symbol.toStringTag,{value:"Module"}));function Li(){return[1,0,0,0,1,0,0,0,1]}function I1e(t){return[t[0],t[1],t[2],t[3],t[4],t[5],t[6],t[7],t[8]]}function sqe(t,e,r,i,s,n,o,a,l){return[t,e,r,i,s,n,o,a,l]}function $1e(t,e){return new Float64Array(t,e,9)}Object.freeze(Object.defineProperty({__proto__:null,clone:I1e,create:Li,createView:$1e,fromValues:sqe},Symbol.toStringTag,{value:"Module"}));function be(){return[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}function y2(t){return[t[0],t[1],t[2],t[3],t[4],t[5],t[6],t[7],t[8],t[9],t[10],t[11],t[12],t[13],t[14],t[15]]}function sX(t,e,r,i,s,n,o,a,l,c,h,p,f,m,y,_){return[t,e,r,i,s,n,o,a,l,c,h,p,f,m,y,_]}function L1e(t,e){return new Float64Array(t,e,16)}const un=be();Object.freeze(Object.defineProperty({__proto__:null,IDENTITY:un,clone:y2,create:be,createView:L1e,fromValues:sX},Symbol.toStringTag,{value:"Module"}));function Fh(){return[0,0,0,1]}function nqe(t){return[t[0],t[1],t[2],t[3]]}function oqe(t,e,r,i){return[t,e,r,i]}function D1e(t,e){return new Float64Array(t,e,4)}const aqe=Fh();Object.freeze(Object.defineProperty({__proto__:null,IDENTITY:aqe,clone:nqe,create:Fh,createView:D1e,fromValues:oqe},Symbol.toStringTag,{value:"Module"}));function lqe(t){return t[0]=0,t[1]=0,t[2]=0,t[3]=1,t}function qN(t,e,r){r*=.5;const i=Math.sin(r);return t[0]=i*e[0],t[1]=i*e[1],t[2]=i*e[2],t[3]=Math.cos(r),t}function nX(t,e){const r=2*Math.acos(e[3]),i=Math.sin(r/2);return i>Xa()?(t[0]=e[0]/i,t[1]=e[1]/i,t[2]=e[2]/i):(t[0]=1,t[1]=0,t[2]=0),r}function E5(t,e,r){const i=e[0],s=e[1],n=e[2],o=e[3],a=r[0],l=r[1],c=r[2],h=r[3];return t[0]=i*h+o*a+s*c-n*l,t[1]=s*h+o*l+n*a-i*c,t[2]=n*h+o*c+i*l-s*a,t[3]=o*h-i*a-s*l-n*c,t}function cqe(t,e,r){r*=.5;const i=e[0],s=e[1],n=e[2],o=e[3],a=Math.sin(r),l=Math.cos(r);return t[0]=i*l+o*a,t[1]=s*l+n*a,t[2]=n*l-s*a,t[3]=o*l-i*a,t}function uqe(t,e,r){r*=.5;const i=e[0],s=e[1],n=e[2],o=e[3],a=Math.sin(r),l=Math.cos(r);return t[0]=i*l-n*a,t[1]=s*l+o*a,t[2]=n*l+i*a,t[3]=o*l-s*a,t}function hqe(t,e,r){r*=.5;const i=e[0],s=e[1],n=e[2],o=e[3],a=Math.sin(r),l=Math.cos(r);return t[0]=i*l+s*a,t[1]=s*l-i*a,t[2]=n*l+o*a,t[3]=o*l-n*a,t}function dqe(t,e){const r=e[0],i=e[1],s=e[2];return t[0]=r,t[1]=i,t[2]=s,t[3]=Math.sqrt(Math.abs(1-r*r-i*i-s*s)),t}function NL(t,e,r,i){const s=e[0],n=e[1],o=e[2],a=e[3];let l,c,h,p,f,m=r[0],y=r[1],_=r[2],v=r[3];return c=s*m+n*y+o*_+a*v,c<0&&(c=-c,m=-m,y=-y,_=-_,v=-v),1-c>Xa()?(l=Math.acos(c),h=Math.sin(l),p=Math.sin((1-i)*l)/h,f=Math.sin(i*l)/h):(p=1-i,f=i),t[0]=p*s+f*m,t[1]=p*n+f*y,t[2]=p*o+f*_,t[3]=p*a+f*v,t}function pqe(t){const e=RR,r=e(),i=e(),s=e(),n=Math.sqrt(1-r),o=Math.sqrt(r);return t[0]=n*Math.sin(2*Math.PI*i),t[1]=n*Math.cos(2*Math.PI*i),t[2]=o*Math.sin(2*Math.PI*s),t[3]=o*Math.cos(2*Math.PI*s),t}function fqe(t,e){const r=e[0],i=e[1],s=e[2],n=e[3],o=r*r+i*i+s*s+n*n,a=o?1/o:0;return t[0]=-r*a,t[1]=-i*a,t[2]=-s*a,t[3]=n*a,t}function Bf(t,e){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t[3]=e[3],t}function N1e(t,e){const r=e[0]+e[4]+e[8];let i;if(r>0)i=Math.sqrt(r+1),t[3]=.5*i,i=.5/i,t[0]=(e[5]-e[7])*i,t[1]=(e[6]-e[2])*i,t[2]=(e[1]-e[3])*i;else{let s=0;e[4]>e[0]&&(s=1),e[8]>e[3*s+s]&&(s=2);const n=(s+1)%3,o=(s+2)%3;i=Math.sqrt(e[3*s+s]-e[3*n+n]-e[3*o+o]+1),t[s]=.5*i,i=.5/i,t[3]=(e[3*n+o]-e[3*o+n])*i,t[n]=(e[3*n+s]+e[3*s+n])*i,t[o]=(e[3*o+s]+e[3*s+o])*i}return t}function mqe(t,e,r,i){const s=.5*Math.PI/180;e*=s,r*=s,i*=s;const n=Math.sin(e),o=Math.cos(e),a=Math.sin(r),l=Math.cos(r),c=Math.sin(i),h=Math.cos(i);return t[0]=n*l*h-o*a*c,t[1]=o*a*h+n*l*c,t[2]=o*l*c-n*a*h,t[3]=o*l*h+n*a*c,t}function gqe(t){return"quat("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+")"}const WR=mh,yqe=bi,_qe=sW,vqe=E5,bqe=Zb,wqe=Pfe,xqe=OF,F1e=nW,Tqe=F1e,U1e=oW,Sqe=U1e,oX=Rfe,Eqe=wS,Cqe=iN;function Aqe(t,e,r){const i=fe(e,r);return i<-.999999?(at(wp,Oqe,e),Kl(wp)<1e-6&&at(wp,Rqe,e),me(wp,wp),qN(t,wp,Math.PI),t):i>.999999?(t[0]=0,t[1]=0,t[2]=0,t[3]=1,t):(at(wp,e,r),t[0]=wp[0],t[1]=wp[1],t[2]=wp[2],t[3]=1+i,oX(t,t))}const wp=C(),Oqe=Oe(1,0,0),Rqe=Oe(0,1,0);function Pqe(t,e,r,i,s,n){return NL(sre,e,s,n),NL(nre,r,i,n),NL(t,sre,nre,2*n*(1-n)),t}const sre=Fh(),nre=Fh();function Mqe(t,e,r,i){const s=Iqe;return s[0]=r[0],s[3]=r[1],s[6]=r[2],s[1]=i[0],s[4]=i[1],s[7]=i[2],s[2]=-e[0],s[5]=-e[1],s[8]=-e[2],oX(t,N1e(t,s))}const Iqe=Li();Object.freeze(Object.defineProperty({__proto__:null,add:_qe,calculateW:dqe,conjugate:Bf,copy:WR,dot:wqe,equals:Cqe,exactEquals:Eqe,fromEuler:mqe,fromMat3:N1e,getAxisAngle:nX,identity:lqe,invert:fqe,len:Tqe,length:F1e,lerp:xqe,mul:vqe,multiply:E5,normalize:oX,random:pqe,rotateX:cqe,rotateY:uqe,rotateZ:hqe,rotationTo:Aqe,scale:bqe,set:yqe,setAxes:Mqe,setAxisAngle:qN,slerp:NL,sqlerp:Pqe,sqrLen:Sqe,squaredLength:U1e,str:gqe},Symbol.toStringTag,{value:"Module"}));function k1e(){const t=new Float32Array(4);return t[3]=1,t}function V1e(t){const e=new Float32Array(4);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e}function $qe(t,e,r,i){const s=new Float32Array(4);return s[0]=t,s[1]=e,s[2]=r,s[3]=i,s}function z1e(t,e){return new Float32Array(t,e,4)}Object.freeze(Object.defineProperty({__proto__:null,clone:V1e,create:k1e,createView:z1e,fromValues:$qe},Symbol.toStringTag,{value:"Module"}));const Lqe=new je(Ype),ore=new je(Zq),are=new je(Xq),D3t=new je(Jpe);function Gf(t){return t&&(Qf(t)||Rn(t,ore))?ore:t&&(Kf(t)||Rn(t,are))?are:Lqe}const Ss=!0,fb={identifierOffset:0,identifierLength:10,versionOffset:10,checksumOffset:12,byteCount:16};function aX(t,e,r){return{identifier:String.fromCharCode.apply(null,new Uint8Array(t,r+fb.identifierOffset,fb.identifierLength)),version:e.getUint16(r+fb.versionOffset,Ss),checksum:e.getUint32(r+fb.checksumOffset,Ss)}}const jl={sizeLo:0,sizeHi:4,minX:8,minY:16,minZ:24,maxX:32,maxY:40,maxZ:48,errorX:56,errorY:64,errorZ:72,count:80,reserved:84,byteCount:88};function Dqe(t,e){return{sizeLo:t.getUint32(e+jl.sizeLo,Ss),sizeHi:t.getUint32(e+jl.sizeHi,Ss),minX:t.getFloat64(e+jl.minX,Ss),minY:t.getFloat64(e+jl.minY,Ss),minZ:t.getFloat64(e+jl.minZ,Ss),maxX:t.getFloat64(e+jl.maxX,Ss),maxY:t.getFloat64(e+jl.maxY,Ss),maxZ:t.getFloat64(e+jl.maxZ,Ss),errorX:t.getFloat64(e+jl.errorX,Ss),errorY:t.getFloat64(e+jl.errorY,Ss),errorZ:t.getFloat64(e+jl.errorZ,Ss),count:t.getUint32(e+jl.count,Ss),reserved:t.getUint32(e+jl.reserved,Ss)}}function N3t(t){const e=new DataView(t,0);let r=0;const{identifier:i,version:s}=aX(t,e,r);if(r+=fb.byteCount,i!=="LEPCC     ")throw new F("lepcc-decode-error","Bad identifier");if(s>1)throw new F("lepcc-decode-error","Unknown version");const n=Dqe(e,r);if(r+=jl.byteCount,n.sizeHi*2**32+n.sizeLo!==t.byteLength)throw new F("lepcc-decode-error","Bad size");const o=new Float64Array(3*n.count),a=[],l=[],c=[],h=[];if(r=gM(t,r,a),r=gM(t,r,l),r=gM(t,r,c),r=gM(t,r,h),r!==t.byteLength)throw new F("lepcc-decode-error","Bad length");let p=0,f=0;for(let m=0;m<a.length;m++){f+=a[m];let y=0;for(let _=0;_<l[m];_++){y+=c[p];const v=h[p];o[3*p]=Math.min(n.maxX,n.minX+2*n.errorX*y),o[3*p+1]=Math.min(n.maxY,n.minY+2*n.errorY*f),o[3*p+2]=Math.min(n.maxZ,n.minZ+2*n.errorZ*v),p++}}return{errorX:n.errorX,errorY:n.errorY,errorZ:n.errorZ,result:o}}function gM(t,e,r){const i=[];e=sG(t,e,i);const s=[];for(let n=0;n<i.length;n++){s.length=0,e=sG(t,e,s);for(let o=0;o<s.length;o++)r.push(s[o]+i[n])}return e}function sG(t,e,r){const i=new DataView(t,e),s=i.getUint8(0),n=31&s,o=!!(32&s),a=(192&s)>>6;let l=0;if(a===0)l=i.getUint32(1,Ss),e+=5;else if(a===1)l=i.getUint16(1,Ss),e+=3;else{if(a!==2)throw new F("lepcc-decode-error","Bad count type");l=i.getUint8(1),e+=2}if(o)throw new F("lepcc-decode-error","LUT not implemented");const c=Math.ceil(l*n/8),h=new Uint8Array(t,e,c);let p=0,f=0,m=0;const y=-1>>>32-n;for(let _=0;_<l;_++){for(;f<n;)p|=h[m]<<f,f+=8,m+=1;r[_]=p&y,p>>>=n,f-=n,f+n>32&&(p|=h[m-1]>>8-f)}return e+m}const S1={sizeLo:0,sizeHi:4,count:8,colorMapCount:12,lookupMethod:14,compressionMethod:15,byteCount:16};function Nqe(t,e){return{sizeLo:t.getUint32(e+S1.sizeLo,Ss),sizeHi:t.getUint32(e+S1.sizeHi,Ss),count:t.getUint32(e+S1.count,Ss),colorMapCount:t.getUint16(e+S1.colorMapCount,Ss),lookupMethod:t.getUint8(e+S1.lookupMethod),compressionMethod:t.getUint8(e+S1.compressionMethod)}}function Fqe(t){const e=new DataView(t,0);let r=0;const{identifier:i,version:s}=aX(t,e,r);if(r+=fb.byteCount,i!=="ClusterRGB")throw new F("lepcc-decode-error","Bad identifier");if(s>1)throw new F("lepcc-decode-error","Unknown version");const n=Nqe(e,r);if(r+=S1.byteCount,n.sizeHi*2**32+n.sizeLo!==t.byteLength)throw new F("lepcc-decode-error","Bad size");if((n.lookupMethod===2||n.lookupMethod===1)&&n.compressionMethod===0){if(3*n.colorMapCount+n.count+r!==t.byteLength||n.colorMapCount>256)throw new F("lepcc-decode-error","Bad count");const o=new Uint8Array(t,r,3*n.colorMapCount),a=new Uint8Array(t,r+3*n.colorMapCount,n.count),l=new Uint8Array(3*n.count);for(let c=0;c<n.count;c++){const h=a[c];l[3*c]=o[3*h],l[3*c+1]=o[3*h+1],l[3*c+2]=o[3*h+2]}return l}if(n.lookupMethod===0&&n.compressionMethod===0){if(3*n.count+r!==t.byteLength||n.colorMapCount!==0)throw new F("lepcc-decode-error","Bad count");return new Uint8Array(t,r).slice()}if(n.lookupMethod<=2&&n.compressionMethod===1){if(r+3!==t.byteLength||n.colorMapCount!==1)throw new F("lepcc-decode-error","Bad count");const o=e.getUint8(r),a=e.getUint8(r+1),l=e.getUint8(r+2),c=new Uint8Array(3*n.count);for(let h=0;h<n.count;h++)c[3*h]=o,c[3*h+1]=a,c[3*h+2]=l;return c}throw new F("lepcc-decode-error","Bad method "+n.lookupMethod+","+n.compressionMethod)}const E1={sizeLo:0,sizeHi:4,count:8,scaleFactor:12,bitsPerPoint:14,reserved:15,byteCount:16};function Uqe(t,e){return{sizeLo:t.getUint32(e+E1.sizeLo,Ss),sizeHi:t.getUint32(e+E1.sizeHi,Ss),count:t.getUint32(e+E1.count,Ss),scaleFactor:t.getUint16(e+E1.scaleFactor,Ss),bitsPerPoint:t.getUint8(e+E1.bitsPerPoint),reserved:t.getUint8(e+E1.reserved)}}function kqe(t){const e=new DataView(t,0);let r=0;const{identifier:i,version:s}=aX(t,e,r);if(r+=fb.byteCount,i!=="Intensity ")throw new F("lepcc-decode-error","Bad identifier");if(s>1)throw new F("lepcc-decode-error","Unknown version");const n=Uqe(e,r);if(r+=E1.byteCount,n.sizeHi*2**32+n.sizeLo!==t.byteLength)throw new F("lepcc-decode-error","Bad size");const o=new Uint16Array(n.count);if(n.bitsPerPoint===8){if(n.count+r!==t.byteLength)throw new F("lepcc-decode-error","Bad size");const a=new Uint8Array(t,r,n.count);for(let l=0;l<n.count;l++)o[l]=a[l]*n.scaleFactor}else if(n.bitsPerPoint===16){if(2*n.count+r!==t.byteLength)throw new F("lepcc-decode-error","Bad size");const a=new Uint16Array(t,r,n.count);for(let l=0;l<n.count;l++)o[l]=a[l]*n.scaleFactor}else{const a=[];if(sG(t,r,a)!==t.byteLength)throw new F("lepcc-decode-error","Bad size");for(let l=0;l<n.count;l++)o[l]=a[l]*n.scaleFactor}return o}var E;(function(t){t.POSITION="position",t.NORMAL="normal",t.NORMALCOMPRESSED="normalCompressed",t.UV0="uv0",t.AUXPOS1="auxpos1",t.AUXPOS2="auxpos2",t.COLOR="color",t.SYMBOLCOLOR="symbolColor",t.SIZE="size",t.TANGENT="tangent",t.OFFSET="offset",t.SUBDIVISIONFACTOR="subdivisionFactor",t.COLORFEATUREATTRIBUTE="colorFeatureAttribute",t.SIZEFEATUREATTRIBUTE="sizeFeatureAttribute",t.OPACITYFEATUREATTRIBUTE="opacityFeatureAttribute",t.DISTANCETOSTART="distanceToStart",t.UVMAPSPACE="uvMapSpace",t.BOUNDINGRECT="boundingRect",t.UVREGION="uvRegion",t.PROFILERIGHT="profileRight",t.PROFILEUP="profileUp",t.PROFILEVERTEXANDNORMAL="profileVertexAndNormal",t.FEATUREVALUE="featureValue",t.MODELORIGINHI="modelOriginHi",t.MODELORIGINLO="modelOriginLo",t.MODEL="model",t.MODELNORMAL="modelNormal",t.INSTANCECOLOR="instanceColor",t.INSTANCEFEATUREATTRIBUTE="instanceFeatureAttribute",t.LOCALTRANSFORM="localTransform",t.GLOBALTRANSFORM="globalTransform",t.BOUNDINGSPHERE="boundingSphere",t.MODELORIGIN="modelOrigin",t.MODELSCALEFACTORS="modelScaleFactors",t.FEATUREATTRIBUTE="featureAttribute",t.STATE="state",t.LODLEVEL="lodLevel",t.POSITION0="position0",t.POSITION1="position1",t.NORMALA="normalA",t.NORMALB="normalB",t.COMPONENTINDEX="componentIndex",t.VARIANTOFFSET="variantOffset",t.VARIANTSTROKE="variantStroke",t.VARIANTEXTENSION="variantExtension",t.U8PADDING="u8padding",t.U16PADDING="u16padding",t.SIDENESS="sideness",t.START="start",t.END="end",t.UP="up",t.EXTRUDE="extrude",t.OBJECTANDLAYERIDCOLOR="objectAndLayerIdColor",t.INSTANCEOBJECTANDLAYERIDCOLOR="instanceObjectAndLayerIdColor"})(E||(E={}));const nG=Q.getLogger("esri.views.3d.layers.i3s.I3SBinaryReader");function Vqe(t,e,r){let i="",s=0;for(;s<r;){const n=t[e+s];if(n<128)i+=String.fromCharCode(n),s++;else if(n>=192&&n<224){if(s+1>=r)throw new F("utf8-decode-error","UTF-8 Decode failed. Two byte character was truncated.");const o=(31&n)<<6|63&t[e+s+1];i+=String.fromCharCode(o),s+=2}else if(n>=224&&n<240){if(s+2>=r)throw new F("utf8-decode-error","UTF-8 Decode failed. Multi byte character was truncated.");const o=(15&n)<<12|(63&t[e+s+1])<<6|63&t[e+s+2];i+=String.fromCharCode(o),s+=3}else{if(!(n>=240&&n<248))throw new F("utf8-decode-error","UTF-8 Decode failed. Invalid multi byte sequence.");{if(s+3>=r)throw new F("utf8-decode-error","UTF-8 Decode failed. Multi byte character was truncated.");const o=(7&n)<<18|(63&t[e+s+1])<<12|(63&t[e+s+2])<<6|63&t[e+s+3];if(o>=65536){const a=55296+(o-65536>>10),l=56320+(1023&o);i+=String.fromCharCode(a,l)}else i+=String.fromCharCode(o);s+=4}}}return i}function B1e(t,e){const r={byteOffset:0,byteCount:0,fields:Object.create(null)};let i=0;for(let s=0;s<e.length;s++){const n=e[s],o=n.valueType||n.type,a=Xqe[o];r.fields[n.property]=a(t,i),i+=C5[o].BYTES_PER_ELEMENT}return r.byteCount=i,r}function zqe(t,e,r){return G1e(t,e,r).map(i=>{const s=i?Date.parse(i):null;return s&&!Number.isNaN(s)?s:null})}function G1e(t,e,r){const i=[];let s,n,o=0;for(n=0;n<t;n+=1){if(s=e[n],s>0){if(i.push(Vqe(r,o,s-1)),r[o+s-1]!==0)throw new F("string-array-error","Invalid string array: missing null termination.")}else i.push(null);o+=s}return i}function lre(t,e){return new C5[e.valueType](t,e.byteOffset,e.count*e.valuesPerElement)}function Bqe(t,e){return new Uint8Array(t,e.byteOffset,e.byteCount)}function Gqe(t,e,r){const i=e.header!=null?B1e(t,e.header):{byteOffset:0,byteCount:0,fields:{count:r}},s={header:i,byteOffset:i.byteCount,byteCount:0,entries:Object.create(null)};let n=i.byteCount;for(let o=0;o<e.ordering.length;o++){const a=e.ordering[o],l=K(e[a]);if(l.count=i.fields.count??0,l.valueType==="String"){if(l.byteOffset=n,l.byteCount=i.fields[a+"ByteCount"],l.encoding!=="UTF-8")throw new F("unsupported-encoding","Unsupported String encoding.",{encoding:l.encoding});if(l.timeEncoding&&l.timeEncoding!=="ECMA_ISO8601")throw new F("unsupported-time-encoding","Unsupported time encoding.",{timeEncoding:l.timeEncoding})}else{if(!H1e(l.valueType))throw new F("unsupported-value-type","Unsupported binary valueType",{valueType:l.valueType});{const c=FL(l.valueType);n+=n%c!=0?c-n%c:0,l.byteOffset=n,l.byteCount=c*l.valuesPerElement*l.count}}n+=l.byteCount??0,s.entries[a]=l}return s.byteCount=n-s.byteOffset,s}function j1e(t,e,r){if(e!==t&&nG.error(`Invalid ${r} buffer size
 expected: ${t}, actual: ${e})`),e<t)throw new F("buffer-too-small","Binary buffer is too small",{expectedSize:t,actualSize:e})}function jqe(t){return{isDraco:!1,isLegacy:!1,color:t.color!=null,normal:t.normal!=null,uv0:t.uv0!=null,uvRegion:t.uvRegion!=null,featureIndex:t.faceRange!=null&&t.featureId!=null}}function F3t(t,e){const r=B1e(t,e&&e.header);let i=r.byteCount;const s={isDraco:!1,header:r,byteOffset:r.byteCount,byteCount:0,vertexAttributes:{}},n=r.fields,o=n.vertexCount!=null?n.vertexCount:n.count;for(const c of e.ordering){if(!e.vertexAttributes[c])continue;const h={...e.vertexAttributes[c],byteOffset:i,count:o},p=Wqe[c]||"_"+c;s.vertexAttributes[p]=h,i+=FL(h.valueType)*h.valuesPerElement*o}const a=n.faceCount;if(e.faces&&a){s.faces={};for(const c of e.ordering){if(!e.faces[c])continue;const h={...e.faces[c],byteOffset:i,count:a};s.faces[c]=h,i+=FL(h.valueType)*h.valuesPerElement*a}}const l=n.featureCount;if(e.featureAttributes&&e.featureAttributeOrder&&l){s.featureAttributes={};for(const c of e.featureAttributeOrder){if(!e.featureAttributes[c])continue;const h={...e.featureAttributes[c],byteOffset:i,count:l};s.featureAttributes[c]=h,i+=(h.valueType==="UInt64"?8:FL(h.valueType))*h.valuesPerElement*l}}return j1e(i,t.byteLength,"geometry"),s.byteCount=i-s.byteOffset,s}function U3t(t,e){return!t||!t.compressedAttributes||t.compressedAttributes.encoding!=="draco"?t?jqe(t):Hqe(e):qqe(t.compressedAttributes.attributes)}function Hqe(t){const e={isDraco:!1,isLegacy:!0,color:!1,normal:!1,uv0:!1,uvRegion:!1,featureIndex:!1};for(const r of t.ordering)if(t.vertexAttributes[r])switch(r){case"position":break;case"normal":e.normal=!0;break;case"color":e.color=!0;break;case"uv0":e.uv0=!0;break;case"region":e.uvRegion=!0}return t.featureAttributes&&t.featureAttributeOrder&&(e.featureIndex=!0),e}function qqe(t){const e={isDraco:!0,isLegacy:!1,color:!1,normal:!1,uv0:!1,uvRegion:!1,featureIndex:!1};for(const r of t)switch(r){case"position":break;case"normal":e.normal=!0;break;case"uv0":e.uv0=!0;break;case"color":e.color=!0;break;case"uv-region":e.uvRegion=!0;break;case"feature-index":e.featureIndex=!0}return e}const Wqe={position:E.POSITION,normal:E.NORMAL,color:E.COLOR,uv0:E.UV0,region:E.UVREGION};function Zqe(t,e,r){if(t.encoding==="lepcc-rgb")return Fqe(e);if(t.encoding==="lepcc-intensity")return kqe(e);if(t.encoding!=null&&t.encoding!=="")throw new F("unknown-attribute-storage-info-encoding","Unknown Attribute Storage Info Encoding");t["attributeByteCounts "]&&!t.attributeByteCounts&&(nG.warn("Warning: Trailing space in 'attributeByteCounts '."),t.attributeByteCounts=t["attributeByteCounts "]),t.ordering[0]==="ObjectIds"&&t.hasOwnProperty("objectIds")&&(nG.warn("Warning: Case error in objectIds"),t.ordering[0]="objectIds");const i=Gqe(e,t,r);j1e(i.byteOffset+i.byteCount,e.byteLength,"attribute");const s=i.entries.attributeValues||i.entries.objectIds;if(s){if(s.valueType==="String"){const n=i.entries.attributeByteCounts,o=lre(e,n),a=Bqe(e,s);return s.timeEncoding?zqe(n.count,o,a):G1e(n.count,o,a)}return lre(e,s)}throw new F("bad-attribute-storage-info","Bad attributeStorageInfo specification.")}const C5={Float32:Float32Array,Float64:Float64Array,UInt8:Uint8Array,Int8:Int8Array,UInt16:Uint16Array,Int16:Int16Array,UInt32:Uint32Array,Int32:Int32Array},Xqe={Float32:(t,e)=>new DataView(t,0).getFloat32(e,!0),Float64:(t,e)=>new DataView(t,0).getFloat64(e,!0),UInt8:(t,e)=>new DataView(t,0).getUint8(e),Int8:(t,e)=>new DataView(t,0).getInt8(e),UInt16:(t,e)=>new DataView(t,0).getUint16(e,!0),Int16:(t,e)=>new DataView(t,0).getInt16(e,!0),UInt32:(t,e)=>new DataView(t,0).getUint32(e,!0),Int32:(t,e)=>new DataView(t,0).getInt32(e,!0)};function H1e(t){return C5.hasOwnProperty(t)}function FL(t){return H1e(t)?C5[t].BYTES_PER_ELEMENT:0}function Yqe(t,e,r,i){const s=Jqe(t,e,r),n=be();return Tl(r,s,n,i),n}const q1e=1,cre=5-q1e;function Jqe(t,e,r){const i=C(),s=t[3],n=2**(Math.ceil(Math.log(s)*Math.LOG2E/cre)*cre+q1e);if(r.isGeographic){const l=n/Nr(r).radius*180/Math.PI,c=Math.round(t[1]/l),h=Math.max(-90,Math.min(90,c*l)),p=l/Math.cos((Math.abs(h)-l/2)/180*Math.PI),f=Math.round(t[0]/p)*p;i[0]=f,i[1]=h}else{const l=Math.round(t[0]/n),c=Math.round(t[1]/n);i[0]=l*n,i[1]=c*n}const o=t[2]+e,a=Math.round(o/n);return i[2]=a*n,i}function Qqe(t){return t.type==="fill"}function Kqe(t){return t.type==="extrude"}var Bt;(function(t){t[t.INVISIBLE=0]="INVISIBLE",t[t.TRANSPARENT=1]="TRANSPARENT",t[t.OPAQUE=2]="OPAQUE"})(Bt||(Bt={}));function eWe(t){return t&&t.enabled&&(Kqe(t)||Qqe(t))&&t.edges!=null}function tWe(t){return t&&t.enabled&&t.edges||null}function W1e(t,e){return Z1e(tWe(t),e)}function Z1e(t,e){if(t==null)return null;const r=t.color!=null?cZ(ze.toUnitRGBA(t.color)):Lt(0,0,0,0),i=Ms(t.size),s=Ms(t.extensionLength);switch(t.type){case"solid":return X1e({color:r,size:i,extensionLength:s,...e});case"sketch":return rWe({color:r,size:i,extensionLength:s,...e});default:return}}function X1e(t){return{...iWe,...t,type:"solid"}}function rWe(t){return{...sWe,...t,type:"sketch"}}const iWe={color:Lt(0,0,0,.2),size:1,extensionLength:0,opacity:1,objectTransparency:Bt.OPAQUE,hasSlicePlane:!1},sWe={color:Lt(0,0,0,.2),size:1,extensionLength:0,opacity:1,objectTransparency:Bt.OPAQUE,hasSlicePlane:!1};var Us;function Y1e(t){switch(t){case"multiply":default:return Us.Multiply;case"ignore":return Us.Ignore;case"replace":return Us.Replace;case"tint":return Us.Tint}}function J1e(t,e,r){if(t==null||e===Us.Ignore)return r[0]=255,r[1]=255,r[2]=255,void(r[3]=255);const i=ge(Math.round(t[3]*WN),0,WN),s=i===0||e===Us.Tint?0:e===Us.Replace?nWe:oWe;r[0]=ge(Math.round(t[0]*Zw),0,Zw),r[1]=ge(Math.round(t[1]*Zw),0,Zw),r[2]=ge(Math.round(t[2]*Zw),0,Zw),r[3]=i+s}(function(t){t[t.Multiply=1]="Multiply",t[t.Ignore=2]="Ignore",t[t.Replace=3]="Replace",t[t.Tint=4]="Tint"})(Us||(Us={}));const Zw=255,WN=85,nWe=WN,oWe=2*WN;function Hi(){return new Float32Array(3)}function ZN(t){const e=new Float32Array(3);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e}function Xr(t,e,r){const i=new Float32Array(3);return i[0]=t,i[1]=e,i[2]=r,i}function Q1e(t,e){return new Float32Array(t,e,3)}function lX(){return Hi()}function K1e(){return Xr(1,1,1)}function ebe(){return Xr(1,0,0)}function tbe(){return Xr(0,1,0)}function rbe(){return Xr(0,0,1)}const aWe=lX(),lWe=K1e(),cWe=ebe(),uWe=tbe(),hWe=rbe();Object.freeze(Object.defineProperty({__proto__:null,ONES:lWe,UNIT_X:cWe,UNIT_Y:uWe,UNIT_Z:hWe,ZEROS:aWe,clone:ZN,create:Hi,createView:Q1e,fromValues:Xr,ones:K1e,unitX:ebe,unitY:tbe,unitZ:rbe,zeros:lX},Symbol.toStringTag,{value:"Module"}));var pc;(function(t){t[t.X=0]="X",t[t.Y=1]="Y",t[t.Z=2]="Z"})(pc||(pc={}));let Xg=class{constructor(e){this._allocator=e,this._items=[],this._itemsPtr=0,this._grow()}get(){return this._itemsPtr===0&&YS(()=>this._reset()),this._itemsPtr===this._items.length&&this._grow(),this._items[this._itemsPtr++]}_reset(){const e=Math.min(3*Math.max(8,this._itemsPtr),this._itemsPtr+3*ure);this._items.length=Math.min(e,this._items.length),this._itemsPtr=0}_grow(){for(let e=0;e<Math.max(8,Math.min(this._items.length,ure));e++)this._items.push(this._allocator())}};const ure=1024;let dE=class C1{constructor(e,r,i){this._itemByteSize=e,this._itemCreate=r,this._buffers=new Array,this._items=new Array,this._itemsPtr=0,this._itemsPerBuffer=Math.ceil(i/this._itemByteSize)}get(){this._itemsPtr===0&&YS(()=>this._reset());const e=Math.floor(this._itemsPtr/this._itemsPerBuffer);for(;this._buffers.length<=e;){const r=new ArrayBuffer(this._itemsPerBuffer*this._itemByteSize);for(let i=0;i<this._itemsPerBuffer;++i)this._items.push(this._itemCreate(r,i*this._itemByteSize));this._buffers.push(r)}return this._items[this._itemsPtr++]}_reset(){const e=2*(Math.floor(this._itemsPtr/this._itemsPerBuffer)+1);for(;this._buffers.length>e;)this._buffers.pop(),this._items.length=this._buffers.length*this._itemsPerBuffer;this._itemsPtr=0}static createVec2f64(e=Xw){return new C1(16,Vve,e)}static createVec3f64(e=Xw){return new C1(24,Kq,e)}static createVec4f64(e=Xw){return new C1(32,Kye,e)}static createMat3f64(e=Xw){return new C1(72,$1e,e)}static createMat4f64(e=Xw){return new C1(128,L1e,e)}static createQuatf64(e=Xw){return new C1(32,D1e,e)}get test(){return{size:this._buffers.length*this._itemsPerBuffer*this._itemByteSize}}};const Xw=4*cN.KILOBYTES,V3t=dE.createVec2f64(),Le=dE.createVec3f64(),cX=dE.createVec4f64();dE.createMat3f64();const uX=dE.createMat4f64(),z3t=dE.createQuatf64();function Xn(t){return t?hre($s(t.origin),$s(t.direction)):hre(C(),C())}function hre(t,e){return{origin:t,direction:e}}function B3t(t,e){return Pg(t.origin,e.origin)&&Pg(t.direction,e.direction)}function yu(t,e){const r=mWe.get();return r.origin=t,r.direction=e,r}function XN(t,e=Xn()){return ibe(t.origin,t.direction,e)}function dWe(t,e,r=Xn()){return ie(r.origin,t),he(r.direction,e,t),r}function ibe(t,e,r=Xn()){return ie(r.origin,t),ie(r.direction,e),r}function pWe(t,e){const r=at(Le.get(),me(Le.get(),t.direction),he(Le.get(),e,t.origin));return fe(r,r)}function fWe(t,e,r){const i=fe(t.direction,he(r,e,t.origin));return ce(r,t.origin,te(r,t.direction,i)),r}const mWe=new Xg(()=>Xn());function G3t(t,e,r){const i=fe(t,e)/fe(t,t);return te(r,t,i)}function g_(t,e){return fe(t,e)/Ce(t)}function A5(t,e){const r=fe(t,e)/(Ce(t)*Ce(e));return-Pn(r)}function sbe(t,e,r){me(yM,t),me(BU,e);const i=fe(yM,BU),s=Pn(i),n=at(yM,yM,BU);return fe(n,r)<0?2*Math.PI-s:s}const yM=C(),BU=C(),nbe=gs();function gs(){return Wt()}function _2(t,e=gs()){return mh(e,t)}function obe(t,e){return Lt(t[0],t[1],t[2],e)}function gWe(t){return t}function yWe(t){t[0]=t[1]=t[2]=t[3]=0}function O5(t,e){return t[0]=t[1]=t[2]=0,t[3]=e,t}function bg(t){return t[3]}function _We(t){return t}function abe(t,e,r,i){return Lt(t,e,r,i)}function vWe(t,e,r){return t!==r&&ie(r,t),r[3]=t[3]+e,r}function bWe(t,e,r){return Q.getLogger("esri.geometry.support.sphere").error("sphere.setExtent is not yet supported"),t===r?r:_2(t,r)}function Q_(t,e,r){if(e==null)return!1;const{origin:i,direction:s}=e,n=wWe;n[0]=i[0]-t[0],n[1]=i[1]-t[1],n[2]=i[2]-t[2];const o=s[0]*s[0]+s[1]*s[1]+s[2]*s[2];if(o===0)return!1;const a=2*(s[0]*n[0]+s[1]*n[1]+s[2]*n[2]),l=a*a-4*o*(n[0]*n[0]+n[1]*n[1]+n[2]*n[2]-t[3]*t[3]);if(l<0)return!1;const c=Math.sqrt(l);let h=(-a-c)/(2*o);const p=(-a+c)/(2*o);return(h<0||p<h&&p>0)&&(h=p),!(h<0)&&(r&&(r[0]=i[0]+s[0]*h,r[1]=i[1]+s[1]*h,r[2]=i[2]+s[2]*h),!0)}const wWe=C();function oG(t,e){return Q_(t,e,null)}function xWe(t,e,r){if(Q_(t,e,r))return r;const i=pE(t,e,Le.get());return ce(r,e.origin,te(Le.get(),e.direction,di(e.origin,i)/Ce(e.direction))),r}function pE(t,e,r){const i=Le.get(),s=uX.get();at(i,e.origin,e.direction);const n=bg(t);at(r,i,e.origin),te(r,r,1/Ce(r)*n);const o=ube(t,e.origin),a=A5(e.origin,r);return mu(s,a+o,i),$e(r,r,s),r}function TWe(t,e,r){return Q_(t,e,r)?r:(fWe(e,t,r),lbe(t,r,r))}function lbe(t,e,r){const i=he(Le.get(),e,t),s=te(Le.get(),i,t[3]/Ce(i));return ce(r,s,t)}function cbe(t,e){const r=he(Le.get(),e,t),i=na(r),s=t[3]*t[3];return Math.sqrt(Math.abs(i-s))}function ube(t,e){const r=he(Le.get(),e,t),i=Ce(r),s=bg(t),n=s+Math.abs(s-i);return Pn(s/n)}const GU=C();function hbe(t,e,r,i){const s=he(GU,e,t);switch(r){case pc.X:{const n=pK(s,GU)[2];return se(i,-Math.sin(n),Math.cos(n),0)}case pc.Y:{const n=pK(s,GU),o=n[1],a=n[2],l=Math.sin(o);return se(i,-l*Math.cos(a),-l*Math.sin(a),Math.cos(o))}case pc.Z:return me(i,s);default:return}}function dbe(t,e){const r=he(aG,e,t);return Ce(r)-t[3]}function SWe(t,e,r,i){const s=dbe(t,e),n=hbe(t,e,pc.Z,aG),o=te(aG,n,r-s);return ce(i,e,o)}function EWe(t,e){const r=yo(t,e),i=bg(t);return r<=i*i}function CWe(t,e,r=gs()){const i=di(t,e),s=t[3],n=e[3];return i+n<s?(mh(r,t),r):i+s<n?(mh(r,e),r):(Br(r,t,e,(i+n-s)/(2*i)),r[3]=(i+s+n)/2,r)}const aG=C(),R5=gs(),AWe=Object.freeze(Object.defineProperty({__proto__:null,NullSphere:nbe,altitudeAt:dbe,angleToSilhouette:ube,axisAt:hbe,clear:yWe,closestPoint:TWe,closestPointOnSilhouette:pE,containsPoint:EWe,copy:_2,create:gs,distanceToSilhouette:cbe,elevate:vWe,fromCenterAndRadius:obe,fromRadius:O5,fromValues:abe,getCenter:_We,getRadius:bg,intersectRay:Q_,intersectRayClosestSilhouette:xWe,intersectsRay:oG,projectPoint:lbe,setAltitudeAt:SWe,setExtent:bWe,tmpSphere:R5,union:CWe,wrap:gWe},Symbol.toStringTag,{value:"Module"}));function v2(t){const e=t[0]*t[0]+t[4]*t[4]+t[8]*t[8],r=t[1]*t[1]+t[5]*t[5]+t[9]*t[9],i=t[2]*t[2]+t[6]*t[6]+t[10]*t[10];return Math.sqrt(Math.max(e,r,i))}function OWe(t,e){const r=Math.sqrt(e[0]*e[0]+e[4]*e[4]+e[8]*e[8]),i=Math.sqrt(e[1]*e[1]+e[5]*e[5]+e[9]*e[9]),s=Math.sqrt(e[2]*e[2]+e[6]*e[6]+e[10]*e[10]);return se(t,r,i,s),t}function j3t(t,e,r){r=r||t;const i=fe(t,e);se(r,t[0]-i*e[0],t[1]-i*e[1],t[2]-i*e[2]),me(r,r)}function RWe(t,e,r){Math.abs(t[0])>Math.abs(t[1])?se(e,0,1,0):se(e,1,0,0),at(r,t,e),me(e,e),at(e,r,t),me(r,r)}function _M(t,e,r,i,s,n){const o=t+(e-t)*s;return o+(r+(i-r)*s-o)*n}function PWe(t,e,r,i=C()){const s=Ce(t),n=Ce(e),o=fe(t,e)/(s*n);if(o<.9999999999999999){const a=Math.acos(o),l=((1-r)*s+r*n)/Math.sin(a),c=l/s*Math.sin((1-r)*a),h=l/n*Math.sin(r*a);return te(mb,t,c),te(gb,e,h),ce(i,mb,gb)}return Br(i,t,e,r)}function H3t(t,e,r,i=C(),s=C()){const n=Ce(t),o=Ce(e),a=fe(t,e)/(n*o);if(a<.9999999999999999){const l=Math.acos(a),c=Math.sin(l),h=Math.sin(r*l),p=Math.sin((1-r)*l),f=(1-r)*n+r*o;{const m=f/c,y=m/o*h;te(mb,t,m/n*p),te(gb,e,y),ce(i,mb,gb)}{const m=1/n*(-Math.cos((1-r)*l)*l*f+p*(-n+o));te(mb,t,m);const y=1/o*(Math.cos(r*l)*l*f+h*(-n+o));te(gb,e,y),ce(s,mb,gb),te(s,s,1/c)}return s}return Br(i,t,e,r),he(s,e,t),me(s,s),s}function UL(t,e,r){t=me(mb,t),e=me(gb,e);const i=Pn(fe(t,e));if(r){const s=at(MWe,t,e);if(fe(s,r)<0)return-i}return i}function kL(t){const e=t.length;return r=>{if(r<=t[0][0])return t[0][1];if(r>=t[e-1][0])return t[e-1][1];let i=1;for(;r>t[i][0];)i++;const s=t[i-1][0],n=t[i][0],o=(n-r)/(n-s);return o*t[i-1][1]+(1-o)*t[i][1]}}function q3t(t,e,r,i){he(dre,e,t),he(pre,r,t),at(i,dre,pre),me(i,i),i[3]=-fe(t,i)}const dre=C(),pre=C(),MWe=C(),mb=C(),gb=C();function Ir(t=IA){return[t[0],t[1],t[2],t[3]]}function IWe(t=IA[0],e=IA[1],r=IA[2],i=IA[3]){return hX(t,e,r,i,cX.get())}function P5(t,e){return hX(e[0],e[1],e[2],e[3],t)}function hX(t,e,r,i,s=Ir()){return s[0]=t,s[1]=e,s[2]=r,s[3]=i,s}function pbe(t,e,r){return ie(r,t),r[3]=e,r}function ZR(t,e,r){const i=e[0]*e[0]+e[1]*e[1]+e[2]*e[2],s=Math.abs(i-1)>1e-5&&i>1e-12?1/Math.sqrt(i):1;return r[0]=e[0]*s,r[1]=e[1]*s,r[2]=e[2]*s,r[3]=-(r[0]*t[0]+r[1]*t[1]+r[2]*t[2]),r}function ia(t,e,r,i=Ir()){const s=r[0]-e[0],n=r[1]-e[1],o=r[2]-e[2],a=t[0]-e[0],l=t[1]-e[1],c=t[2]-e[2],h=n*c-o*l,p=o*a-s*c,f=s*l-n*a,m=h*h+p*p+f*f,y=Math.abs(m-1)>1e-5&&m>1e-12?1/Math.sqrt(m):1;return i[0]=h*y,i[1]=p*y,i[2]=f*y,i[3]=-(i[0]*t[0]+i[1]*t[1]+i[2]*t[2]),i}function fbe(t,e,r,i,s){const n=t.length/3;if(n<3)return!1;se(jE,t[3*r],t[3*r+1],t[3*r+2]);let o=i,a=!1;for(;o<n-1&&!a;){const l=3*o;se(Yw,t[l],t[l+1],t[l+2]),o++,a=!la(jE,Yw)}if(!a)return!1;for(o=Math.max(o,s),a=!1;o<n&&!a;){const l=3*o;se(K1,t[l],t[l+1],t[l+2]),o++,he(vM,jE,Yw),me(vM,vM),he(bM,Yw,K1),me(bM,bM),a=!la(jE,K1)&&!la(Yw,K1)&&Math.abs(fe(vM,bM))<$We}return a?(ia(jE,Yw,K1,e),!0):(r!==0||i!==1||s!==2)&&fbe(t,e,0,1,2)}const $We=.99619469809,jE=C(),Yw=C(),K1=C(),vM=C(),bM=C();function lG(t,e,r){return e!==t&&P5(t,e),t[3]=-fe(t,r),t}function cG(t,e){return e[0]=-t[0],e[1]=-t[1],e[2]=-t[2],e[3]=-t[3],e}function BO(t,e,r,i){return at(K1,e,t),ZR(r,K1,i)}function W3t(t,e,r,i){return M5(t,e,he(Le.get(),r,e),kWe,i)}function Fw(t,e,r){return e!=null&&M5(t,e.origin,e.direction,VWe,r)}function LWe(t,e,r){return M5(t,e.origin,e.vector,Rf.NONE,r)}function DWe(t,e,r){return M5(t,e.origin,e.vector,Rf.CLAMP,r)}function mbe(t,e){return hi(t,e)>=0}function NWe(t,e){const r=fe(t,e.ray.direction),i=-hi(t,e.ray.origin);if(i<0&&r>=0)return!1;if(r>-1e-6&&r<1e-6)return i>0;if((i<0||r<0)&&!(i<0&&r<0))return!0;const s=i/r;return r>0?s<e.c1&&(e.c1=s):s>e.c0&&(e.c0=s),e.c0<=e.c1}function FWe(t,e){const r=fe(t,e.ray.direction),i=-hi(t,e.ray.origin);if(r>-1e-6&&r<1e-6)return i>0;const s=i/r;return r>0?s<e.c1&&(e.c1=s):s>e.c0&&(e.c0=s),e.c0<=e.c1}function UWe(t,e,r){const i=te(Le.get(),t,-t[3]),s=uG(t,he(Le.get(),e,i),Le.get());return ce(r,s,i),r}function Z3t(t,e,r,i){const s=t,n=Le.get(),o=Le.get();RWe(s,n,o);const a=he(Le.get(),r,e),l=g_(n,a),c=g_(o,a),h=g_(s,a);return se(i,l,c,h)}function uG(t,e,r){const i=te(Le.get(),t,fe(t,e));return he(r,e,i),r}function hi(t,e){return fe(t,e)+t[3]}function M5(t,e,r,i,s){const n=fe(t,r);if(n===0)return!1;let o=-(fe(t,e)+t[3])/n;return i&Rf.CLAMP&&(o=ge(o,0,1)),!(!(i&Rf.INFINITE_MIN)&&o<0||!(i&Rf.INFINITE_MAX)&&o>1)&&(ce(s,e,te(s,r,o)),!0)}function X3t(t){return t}const IA=[0,0,1,0];var Rf;(function(t){t[t.NONE=0]="NONE",t[t.CLAMP=1]="CLAMP",t[t.INFINITE_MIN=4]="INFINITE_MIN",t[t.INFINITE_MAX=8]="INFINITE_MAX"})(Rf||(Rf={}));const kWe=Rf.INFINITE_MIN|Rf.INFINITE_MAX,VWe=Rf.INFINITE_MAX;var De;function fre(t){return t==="global"?De.Global:De.Local}function jU(t){return t===De.Global?"global":"local"}(function(t){t[t.Global=1]="Global",t[t.Local=2]="Local"})(De||(De={}));let ke=class{constructor(e,r,i=!1,s=r){this.data=e,this.size=r,this.exclusive=i,this.stride=s}};const b2=1e-6,HE=[0,0,0],wM=[0,0,0];function zWe(t,e){const{data:r,size:i}=t,s=r.length/i;if(s<=0)return;const n=new YWe(t);VL(HE,n.minProj,n.maxProj),eb(HE,HE,.5),oh(wM,n.maxProj,n.minProj);const o=hG(wM),a=new JWe;a.quality=o,s<14&&(t=new ke(new Float64Array(n.buffer,112,42),3));const l=[0,0,0],c=[0,0,0],h=[0,0,0],p=[0,0,0],f=[0,0,0],m=[0,0,0],y=[0,0,0];switch(BWe(n,t,y,l,c,h,p,f,m,a)){case 1:return void _re(HE,wM,e);case 2:return void XWe(t,p,e)}GWe(t,y,l,c,h,p,f,m,a),gbe(t,a.b0,a.b1,a.b2,MS,IS);const _=[0,0,0];oh(_,IS,MS),a.quality=hG(_),a.quality<o?ybe(a.b0,a.b1,a.b2,MS,IS,_,e):_re(HE,wM,e)}function BWe(t,e,r,i,s,n,o,a,l,c){return jWe(t,i,s),dG(i,s)<b2?1:(oh(o,i,s),Mo(o,o),HWe(e,i,o,n)<b2?2:(oh(a,s,n),Mo(a,a),oh(l,n,i),Mo(l,l),ah(r,a,o),Mo(r,r),A1(e,r,o,a,l,c),0))}const qE=[0,0,0],WE=[0,0,0],Su=[0,0,0],Eu=[0,0,0],Cu=[0,0,0],xy=[0,0,0],Ty=[0,0,0],Sy=[0,0,0];function GWe(t,e,r,i,s,n,o,a,l){qWe(t,e,r,qE,WE),qE[0]!==void 0&&(oh(Su,qE,r),Mo(Su,Su),oh(Eu,qE,i),Mo(Eu,Eu),oh(Cu,qE,s),Mo(Cu,Cu),ah(xy,Eu,n),Mo(xy,xy),ah(Ty,Cu,o),Mo(Ty,Ty),ah(Sy,Su,a),Mo(Sy,Sy),A1(t,xy,n,Eu,Su,l),A1(t,Ty,o,Cu,Eu,l),A1(t,Sy,a,Su,Cu,l)),WE[0]!==void 0&&(oh(Su,WE,r),Mo(Su,Su),oh(Eu,WE,i),Mo(Eu,Eu),oh(Cu,WE,s),Mo(Cu,Cu),ah(xy,Eu,n),Mo(xy,xy),ah(Ty,Cu,o),Mo(Ty,Ty),ah(Sy,Su,a),Mo(Sy,Sy),A1(t,xy,n,Eu,Su,l),A1(t,Ty,o,Cu,Eu,l),A1(t,Sy,a,Su,Cu,l))}function jWe(t,e,r){let i=dG(t.maxVert[0],t.minVert[0]),s=0;for(let n=1;n<7;++n){const o=dG(t.maxVert[n],t.minVert[n]);o>i&&(i=o,s=n)}fc(e,t.minVert[s]),fc(r,t.maxVert[s])}const Au=[0,0,0];function HWe(t,e,r,i){const{data:s,size:n}=t;let o=Number.NEGATIVE_INFINITY,a=0;for(let l=0;l<s.length;l+=n){Au[0]=s[l]-e[0],Au[1]=s[l+1]-e[1],Au[2]=s[l+2]-e[2];const c=r[0]*Au[0]+r[1]*Au[1]+r[2]*Au[2],h=r[0]*r[0]+r[1]*r[1]+r[2]*r[2],p=Au[0]*Au[0]+Au[1]*Au[1]+Au[2]*Au[2]-c*c/h;p>o&&(o=p,a=l)}return fc(i,s,a),o}const xn=[0,0];function qWe(t,e,r,i,s){ZWe(t,e,xn,s,i);const n=vbe(r,e);xn[1]-b2<=n&&(i[0]=void 0),xn[0]+b2>=n&&(s[0]=void 0)}const mre=[0,0,0],gre=[0,0,0],yre=[0,0,0],Jw=[0,0,0],Qw=[0,0,0],xM=[0,0,0];function A1(t,e,r,i,s,n){if(_be(e)<b2)return;ah(mre,r,e),ah(gre,i,e),ah(yre,s,e),PS(t,e,xn),Qw[1]=xn[0],Jw[1]=xn[1],xM[1]=Jw[1]-Qw[1];const o=[r,i,s],a=[mre,gre,yre];for(let l=0;l<3;++l){PS(t,o[l],xn),Qw[0]=xn[0],Jw[0]=xn[1],PS(t,a[l],xn),Qw[2]=xn[0],Jw[2]=xn[1],xM[0]=Jw[0]-Qw[0],xM[2]=Jw[2]-Qw[2];const c=hG(xM);c<n.quality&&(fc(n.b0,o[l]),fc(n.b1,e),fc(n.b2,a[l]),n.quality=c)}}const WWe=[0,0,0];function PS(t,e,r){const{data:i,size:s}=t;r[0]=Number.POSITIVE_INFINITY,r[1]=Number.NEGATIVE_INFINITY;for(let n=0;n<i.length;n+=s){const o=i[n]*e[0]+i[n+1]*e[1]+i[n+2]*e[2];r[0]=Math.min(r[0],o),r[1]=Math.max(r[1],o)}}function ZWe(t,e,r,i,s){const{data:n,size:o}=t;fc(i,n),fc(s,i),r[0]=vbe(WWe,e),r[1]=r[0];for(let a=o;a<n.length;a+=o){const l=n[a]*e[0]+n[a+1]*e[1]+n[a+2]*e[2];l<r[0]&&(r[0]=l,fc(i,n,a)),l>r[1]&&(r[1]=l,fc(s,n,a))}}function _re(t,e,r){fc(r.center,t),eb(r.halfSize,e,.5),r.quaternion[0]=0,r.quaternion[1]=0,r.quaternion[2]=0,r.quaternion[3]=1}const hm=[0,0,0],Kw=[0,0,0],ZE=[0,0,0],MS=[0,0,0],IS=[0,0,0],vre=[0,0,0];function XWe(t,e,r){fc(hm,e),Math.abs(e[0])>Math.abs(e[1])&&Math.abs(e[0])>Math.abs(e[2])?hm[0]=0:Math.abs(e[1])>Math.abs(e[2])?hm[1]=0:hm[2]=0,_be(hm)<b2&&(hm[0]=hm[1]=hm[2]=1),ah(Kw,e,hm),Mo(Kw,Kw),ah(ZE,e,Kw),Mo(ZE,ZE),gbe(t,e,Kw,ZE,MS,IS),oh(vre,IS,MS),ybe(e,Kw,ZE,MS,IS,vre,r)}function gbe(t,e,r,i,s,n){PS(t,e,xn),s[0]=xn[0],n[0]=xn[1],PS(t,r,xn),s[1]=xn[0],n[1]=xn[1],PS(t,i,xn),s[2]=xn[0],n[2]=xn[1]}const TM=[0,0,0],xp=[1,0,0,0,1,0,0,0,1],ex=[0,0,0];function ybe(t,e,r,i,s,n,o){xp[0]=t[0],xp[1]=t[1],xp[2]=t[2],xp[3]=e[0],xp[4]=e[1],xp[5]=e[2],xp[6]=r[0],xp[7]=r[1],xp[8]=r[2],QWe(o.quaternion,xp),VL(ex,i,s),eb(ex,ex,.5),eb(o.center,t,ex[0]),eb(TM,e,ex[1]),VL(o.center,o.center,TM),eb(TM,r,ex[2]),VL(o.center,o.center,TM),eb(o.halfSize,n,.5)}const Oc=7;let YWe=class{constructor(e){this.minVert=new Array(Oc),this.maxVert=new Array(Oc);const r=64*Oc;this.buffer=new ArrayBuffer(r);let i=0;this.minProj=new Float64Array(this.buffer,i,Oc),i+=8*Oc,this.maxProj=new Float64Array(this.buffer,i,Oc),i+=8*Oc;for(let l=0;l<Oc;++l)this.minVert[l]=new Float64Array(this.buffer,i,3),i+=24;for(let l=0;l<Oc;++l)this.maxVert[l]=new Float64Array(this.buffer,i,3),i+=24;for(let l=0;l<Oc;++l)this.minProj[l]=Number.POSITIVE_INFINITY,this.maxProj[l]=Number.NEGATIVE_INFINITY;const s=new Array(Oc),n=new Array(Oc),{data:o,size:a}=e;for(let l=0;l<o.length;l+=a){let c=o[l];c<this.minProj[0]&&(this.minProj[0]=c,s[0]=l),c>this.maxProj[0]&&(this.maxProj[0]=c,n[0]=l),c=o[l+1],c<this.minProj[1]&&(this.minProj[1]=c,s[1]=l),c>this.maxProj[1]&&(this.maxProj[1]=c,n[1]=l),c=o[l+2],c<this.minProj[2]&&(this.minProj[2]=c,s[2]=l),c>this.maxProj[2]&&(this.maxProj[2]=c,n[2]=l),c=o[l]+o[l+1]+o[l+2],c<this.minProj[3]&&(this.minProj[3]=c,s[3]=l),c>this.maxProj[3]&&(this.maxProj[3]=c,n[3]=l),c=o[l]+o[l+1]-o[l+2],c<this.minProj[4]&&(this.minProj[4]=c,s[4]=l),c>this.maxProj[4]&&(this.maxProj[4]=c,n[4]=l),c=o[l]-o[l+1]+o[l+2],c<this.minProj[5]&&(this.minProj[5]=c,s[5]=l),c>this.maxProj[5]&&(this.maxProj[5]=c,n[5]=l),c=o[l]-o[l+1]-o[l+2],c<this.minProj[6]&&(this.minProj[6]=c,s[6]=l),c>this.maxProj[6]&&(this.maxProj[6]=c,n[6]=l)}for(let l=0;l<Oc;++l){let c=s[l];fc(this.minVert[l],o,c),c=n[l],fc(this.maxVert[l],o,c)}}},JWe=class{constructor(){this.b0=[1,0,0],this.b1=[0,1,0],this.b2=[0,0,1],this.quality=0}};function hG(t){return t[0]*t[1]+t[0]*t[2]+t[1]*t[2]}function VL(t,e,r){t[0]=e[0]+r[0],t[1]=e[1]+r[1],t[2]=e[2]+r[2]}function oh(t,e,r){t[0]=e[0]-r[0],t[1]=e[1]-r[1],t[2]=e[2]-r[2]}function eb(t,e,r){t[0]=e[0]*r,t[1]=e[1]*r,t[2]=e[2]*r}function fc(t,e,r=0){t[0]=e[r],t[1]=e[r+1],t[2]=e[r+2]}function ah(t,e,r){const i=e[0],s=e[1],n=e[2],o=r[0],a=r[1],l=r[2];t[0]=s*l-n*a,t[1]=n*o-i*l,t[2]=i*a-s*o}function Mo(t,e){const r=e[0]*e[0]+e[1]*e[1]+e[2]*e[2];if(r>0){const i=1/Math.sqrt(r);t[0]=e[0]*i,t[1]=e[1]*i,t[2]=e[2]*i}}function _be(t){return t[0]*t[0]+t[1]*t[1]+t[2]*t[2]}function dG(t,e){const r=e[0]-t[0],i=e[1]-t[1],s=e[2]-t[2];return r*r+i*i+s*s}function vbe(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]}function QWe(t,e){const r=e[0]+e[4]+e[8];if(r>0){let i=Math.sqrt(r+1);t[3]=.5*i,i=.5/i,t[0]=(e[5]-e[7])*i,t[1]=(e[6]-e[2])*i,t[2]=(e[1]-e[3])*i}else{let i=0;e[4]>e[0]&&(i=1),e[8]>e[3*i+i]&&(i=2);const s=(i+1)%3,n=(i+2)%3;let o=Math.sqrt(e[3*i+i]-e[3*s+s]-e[3*n+n]+1);t[i]=.5*o,o=.5/o,t[3]=(e[3*s+n]-e[3*n+s])*o,t[s]=(e[3*s+i]+e[3*i+s])*o,t[n]=(e[3*n+i]+e[3*i+n])*o}}const Rb=Fh(),La=C(),pG=C(),KWe=Li();let K3t=class{constructor(e){const o=e*56;this.buffer=new ArrayBuffer(o),this.obbs=new Array(e);for(let a=0;a<e;a++)this.obbs[a]={center:Kq(this.buffer,56*a+0),halfSize:Q1e(this.buffer,56*a+24),quaternion:z1e(this.buffer,56*a+36)}}};function dX(t=[0,0,0],e=[-1,-1,-1],r=Fh()){return{center:$s(t),halfSize:ZN(e),quaternion:V1e(r)}}function bre(t){return dX(t.center,t.halfSize,t.quaternion)}function tOt(t,e){ie(e.center,t.center),ie(e.halfSize,t.halfSize),WR(e.quaternion,t.quaternion)}function bbe(t,e){return e=e||dX(),zWe(t,e),e}function O1(t,e){const r=hi(e,t.center),i=I5(t,e);return r>i?1:r<-i?-1:0}function rOt(t,e){return La[0]=t.center[0]-e[0],La[1]=t.center[1]-e[1],La[2]=t.center[2]-e[2],Bf(Rb,t.quaternion),yc(La,La,Rb),tN(La,La),iW(pG,La,t.halfSize),AF(pG,La)<e[3]*e[3]}function iOt(t,e){e||(e=pn());const r=S5(KWe,t.quaternion),i=t.halfSize[0]*Math.abs(r[0])+t.halfSize[1]*Math.abs(r[3])+t.halfSize[2]*Math.abs(r[6]),s=t.halfSize[0]*Math.abs(r[1])+t.halfSize[1]*Math.abs(r[4])+t.halfSize[2]*Math.abs(r[7]),n=t.halfSize[0]*Math.abs(r[2])+t.halfSize[1]*Math.abs(r[5])+t.halfSize[2]*Math.abs(r[8]);return e[0]=t.center[0]-i,e[1]=t.center[1]-s,e[2]=t.center[2]-n,e[3]=t.center[0]+i,e[4]=t.center[1]+s,e[5]=t.center[2]+n,e}function sOt(t,e){return hi(e,t.center)-I5(t,e)}function nOt(t,e){return hi(e,t.center)+I5(t,e)}function oOt(t,e){return O1(t,e[0])<=0&&O1(t,e[1])<=0&&O1(t,e[2])<=0&&O1(t,e[3])<=0&&O1(t,e[4])<=0&&O1(t,e[5])<=0}function aOt(t,e,r,i=0){Bf(Rb,t.quaternion),he(La,e,t.center);const s=yc(La,La,Rb),n=yc(pG,r,Rb);let o=-1/0,a=1/0;for(let l=0;l<3;l++)if(Math.abs(n[l])>1e-6){const c=(i+t.halfSize[l]-s[l])/n[l],h=(-i-t.halfSize[l]-s[l])/n[l];o=Math.max(o,Math.min(c,h)),a=Math.min(a,Math.max(c,h))}else if(s[l]>t.halfSize[l]+i||s[l]<-t.halfSize[l]-i)return!1;return o<=a}(()=>{const t=new Int8Array(162);let e=0;const r=i=>{for(let s=0;s<i.length;s++)t[e+s]=i[s];e+=6};return r([6,2,3,1,5,4]),r([0,2,3,1,5,4]),r([0,2,3,7,5,4]),r([0,1,3,2,6,4]),r([0,1,3,2,0,0]),r([0,1,5,7,3,2]),r([0,1,3,7,6,4]),r([0,1,3,7,6,2]),r([0,1,5,7,6,2]),r([0,1,5,4,6,2]),r([0,1,5,4,0,0]),r([0,1,3,7,5,4]),r([0,2,6,4,0,0]),r([0,0,0,0,0,0]),r([1,3,7,5,0,0]),r([2,3,7,6,4,0]),r([2,3,7,6,0,0]),r([2,3,1,5,7,6]),r([0,1,5,7,6,2]),r([0,1,5,7,6,4]),r([0,1,3,7,6,4]),r([4,5,7,6,2,0]),r([4,5,7,6,0,0]),r([4,5,1,3,7,6]),r([0,2,3,7,5,4]),r([6,2,3,7,5,4]),r([6,2,3,1,5,4]),t})();function I5(t,e){Bf(Rb,t.quaternion),yc(La,e,Rb);const r=t.halfSize;return Math.abs(La[0]*r[0])+Math.abs(La[1]*r[1])+Math.abs(La[2]*r[2])}function wbe(t,e){for(let r=0;r<8;++r){const i=e[r];i[0]=1&r?-t.halfSize[0]:t.halfSize[0],i[1]=2&r?-t.halfSize[1]:t.halfSize[1],i[2]=4&r?-t.halfSize[2]:t.halfSize[2],yc(i,i,t.quaternion),ce(i,i,t.center)}}function eZe(t){return Kl(t.halfSize)}function tZe(t,e,r,i,s){if(WR(s.quaternion,t.quaternion),i===De.Global){Bf(SM,t.quaternion),yc(Ey,t.center,SM),tN(tx,Ey),iW(rx,tx,t.halfSize),Cn(rx,tx,rx);const n=Ce(rx);ce(rx,tx,t.halfSize);const o=Ce(rx);if(n<r)ie(s.center,t.center),se(Ey,r,r,r),ce(s.halfSize,t.halfSize,Ey);else{const a=o>0?1+e/o:1,l=n>0?1+r/n:1,c=(l+a)/2,h=(l-a)/2;te(s.halfSize,tx,h),hb(s.halfSize,s.halfSize,t.halfSize,c),te(s.center,tx,c),hb(s.center,s.center,t.halfSize,h),Tfe(Ey,Ey),CF(s.center,s.center,Ey),yc(s.center,s.center,s.quaternion)}}else{const n=se(Ey,0,0,1);hb(s.center,t.center,n,(r+e)/2),Bf(SM,t.quaternion),yc(n,n,SM),tN(n,n),hb(s.halfSize,t.halfSize,n,(r-e)/2)}return s}const Ey=C(),tx=C(),rx=C(),SM=Fh();function xbe(t){return t?parseInt(t.substring(t.lastIndexOf("/")+1,t.length),10):void 0}function lOt(t){if(oe("disable-feature:i3s-draco")||!t)return!1;for(const e of t)for(const r of e.geometryBuffers)if(r.compressedAttributes?.encoding==="draco")return!0;return!1}function cOt(t,e,r,i){r.traverse(e,s=>{const n=s.mbs;return(n!=null&&rZe(t,n))!==yb.OUTSIDE&&(i(s),!0)})}function uOt(t,e,r){let i=0,s=0;for(let n=0;n<e.length&&i<t.length;n++)t[i]===e[n]&&(r(n)&&(t[s]=t[i],s++),i++);t.length=s}function hOt(t,e,r){let i=0,s=0;for(;i<r.length;)hhe(t,r[i])>=0===e&&(r[s]=r[i],s++),i++;r.length=s}const XE=Ut();function dOt(t,e){if(e.rotationScale[1]===0&&e.rotationScale[2]===0&&e.rotationScale[3]===0&&e.rotationScale[5]===0&&e.rotationScale[6]===0&&e.rotationScale[7]===0)return XE[0]=(t[0]-e.position[0])/e.rotationScale[0],XE[1]=(t[1]-e.position[1])/e.rotationScale[4],XE[2]=(t[2]-e.position[0])/e.rotationScale[0],XE[3]=(t[3]-e.position[1])/e.rotationScale[4],XE}var yb;function rZe(t,e){const r=e[0],i=e[1],s=e[3],n=t[0]-r,o=r-t[2],a=t[1]-i,l=i-t[3],c=Math.max(n,o,0),h=Math.max(a,l,0),p=c*c+h*h;return p>s*s?yb.OUTSIDE:p>0?yb.INTERSECTS_CENTER_OUTSIDE:-Math.max(n,o,a,l)>s?yb.INSIDE:yb.INTERSECTS_CENTER_INSIDE}function iZe(t,e,r){const i=[],s=r&&r.missingFields,n=r&&r.originalFields;for(const o of t){const a=o.toLowerCase();let l=!1;for(const c of e)if(a===c.name.toLowerCase()){i.push(c.name),l=!0,n&&n.push(o);break}!l&&s&&s.push(o)}return i}async function pOt(t,e,r,i,s){if(e.length===0)return[];const n=t.attributeStorageInfo;if(t.associatedLayer!=null)try{return await nZe(t.associatedLayer,e,r,i)}catch(o){if(t.associatedLayer.loaded)throw o}if(n){const o=sZe(e,r,s);if(o==null)throw new F("scenelayer:features-not-loaded","Tried to query attributes for unloaded features");const a=t.parsedUrl.path;return(await Promise.all(o.map(l=>oZe(a,n,l.node,l.indices,i).then(c=>{for(let h=0;h<l.graphics.length;h++){const p=l.graphics[h],f=c[h];if(p.attributes)for(const m in p.attributes)m in f||(f[m]=p.attributes[m]);p.attributes=f}return l.graphics})))).flat()}throw new F("scenelayer:no-attribute-source","This scene layer does not have a source for attributes available")}function sZe(t,e,r){const i=new Map,s=[],n=r();for(const o of t){const a=o.attributes[e];for(let l=0;l<n.length;l++){const c=n[l],h=c.featureIds.indexOf(a);if(h>=0){let p=i.get(c.node);p||(p={node:c.node,indices:[],graphics:[]},s.push(p),i.set(c.node,p)),p.indices.push(h),p.graphics.push(o);for(let f=l;f>0;f--)n[f]=n[f-1];n[0]=c;break}}}return s}async function nZe(t,e,r,i){e.sort((l,c)=>l.attributes[r]-c.attributes[r]);const s=e.map(l=>l.attributes[r]),n=[],o=iZe(i,t.fields,{originalFields:n}),a=await Tbe(t,s,o);for(let l=0;l<e.length;l++){const c=e[l],h=a[l],p={};if(c.attributes)for(const f in c.attributes)p[f]=c.attributes[f];for(let f=0;f<n.length;f++)p[n[f]]=h[o[f]];c.attributes=p}return e}function Tbe(t,e,r){const i=t.capabilities.query.maxRecordCount;if(i!=null&&e.length>i){const n=GOe(e,i);return Promise.all(n.map(o=>Tbe(t,o,r))).then(o=>o.flat())}const s=new Y_({objectIds:e,outFields:r,orderByFields:[t.objectIdField]});return t.queryFeatures(s).then(n=>{if(n&&n.features&&n.features.length===e.length)return n.features.map(o=>o.attributes);throw new F("scenelayer:feature-not-in-associated-layer","Feature not found in associated feature layer")})}function oZe(t,e,r,i,s){return Sbe(t,e,r.resources.attributes,i,s)}function Sbe(t,e,r,i,s){const n=[];for(const o of e)if(o&&s.includes(o.name)){const a=`${t}/nodes/${r}/attributes/${o.key}/0`;n.push({url:a,storageInfo:o})}return Yf(n.map(o=>qt(o.url,{responseType:"array-buffer"}).then(a=>Zqe(o.storageInfo,a.data)))).then(o=>{const a=[];for(const l of i){const c={};for(let h=0;h<o.length;h++){const p=o[h].value;p!=null&&(c[n[h].storageInfo.name]=cZe(p,l))}a.push(c)}return a})}(function(t){t[t.OUTSIDE=0]="OUTSIDE",t[t.INTERSECTS_CENTER_OUTSIDE=1]="INTERSECTS_CENTER_OUTSIDE",t[t.INTERSECTS_CENTER_INSIDE=2]="INTERSECTS_CENTER_INSIDE",t[t.INSIDE=3]="INSIDE"})(yb||(yb={}));const aZe=-32768,lZe=-(2**31);function cZe(t,e){if(!t)return null;const r=t[e];return lF(t)?r===aZe?null:r:uF(t)?r===lZe?null:r:r!=r?null:r}function uZe(t){const e=t.store,r=e.indexCRS||e.geographicCRS,i=r===void 0?e.indexWKT:void 0;if(i){if(!t.spatialReference)throw new F("layerview:no-store-spatial-reference-wkt-index-and-no-layer-spatial-reference","Found indeWKT in the scene layer store but no layer spatial reference",{});if(i!==t.spatialReference.wkt)throw new F("layerview:store-spatial-reference-wkt-index-incompatible","The indeWKT of the scene layer store does not match the WKT of the layer spatial reference",{})}const s=r?new je(xbe(r)):t.spatialReference;return s.equals(t.spatialReference)?t.spatialReference:s}function hZe(t){const e=t.store,r=e.vertexCRS||e.projectedCRS,i=r===void 0?e.vertexWKT:void 0;if(i){if(!t.spatialReference)throw new F("layerview:no-store-spatial-reference-wkt-vertex-and-no-layer-spatial-reference","Found vertexWKT in the scene layer store but no layer spatial reference",{});if(i!==t.spatialReference.wkt)throw new F("layerview:store-spatial-reference-wkt-vertex-incompatible","The vertexWKT of the scene layer store does not match the WKT of the layer spatial reference",{})}const s=r?new je(xbe(r)):t.spatialReference;return s.equals(t.spatialReference)?t.spatialReference:s}function fOt(t,e){return e==null?"@null":e===Gf(e)?"@ECEF":t.equals(e)?"":e.wkid!=null?"@"+e.wkid:null}function fG(t,e,r){if(!Vf(t,e))throw new F("layerview:spatial-reference-incompatible","The spatial reference of this scene layer is incompatible with the spatial reference of the view",{});if(r==="local"&&!dZe(t,e))throw new F("layerview:spatial-reference-incompatible","The spatial reference of this scene layer is incompatible with the spatial reference of the view",{})}function mOt(t,e,r){if(t.serviceUpdateTimeStamp?.lastUpdate!==e.serviceUpdateTimeStamp?.lastUpdate||!r.isEmpty||uc(t.associatedLayer,i=>i.url)!==uc(e.associatedLayer,i=>i.url))throw new F("layerview:recycle-failed")}function dZe(t,e){return t.equals(e)||t.isWGS84&&e.isWebMercator||t.isWebMercator&&e.isWGS84}function pZe(t,e,r){const i=uZe(t),s=hZe(t);fG(i,e,r),fG(s,e,r)}function fZe(t){return(t.geometryType==null||t.geometryType==="triangles")&&(t.topology==null||t.topology==="PerAttributeArray")&&t.vertexAttributes!=null&&t.vertexAttributes.position!=null}function gOt(t){if(t.store==null||t.store.defaultGeometrySchema==null||!fZe(t.store.defaultGeometrySchema))throw new F("scenelayer:unsupported-geometry-schema","The geometry schema of this scene layer is not supported.",{url:t.parsedUrl.path})}function yOt(t,e){pZe(t,e.spatialReference,e.viewingMode)}function mZe(t){return t.geometryType!=null&&t.geometryType==="points"&&(t.topology==null||t.topology==="PerAttributeArray")&&(t.encoding==null||t.encoding===""||t.encoding==="lepcc-xyz")&&t.vertexAttributes!=null&&t.vertexAttributes.position!=null}function _Ot(t){if(t.store==null||t.store.defaultGeometrySchema==null||!mZe(t.store.defaultGeometrySchema))throw new F("pointcloud:unsupported-geometry-schema","The geometry schema of this point cloud scene layer is not supported.",{})}function vOt(t,e){fG(t.spatialReference,e.spatialReference,e.viewingMode)}function gZe(t){return t.type==="simple"||t.type==="class-breaks"||t.type==="unique-value"}function yZe(t){return t.type==="mesh-3d"}function bOt(t){if(t==null||!gZe(t)||(t.type==="unique-value"||t.type==="class-breaks")&&t.defaultSymbol==null)return!0;const e=t.getSymbols();if(e.length===0)return!0;for(const r of e){if(!yZe(r)||r.symbolLayers.length===0)return!0;for(const i of r.symbolLayers.items)if(i.type!=="fill"||i.material==null||i.material.color==null||i.material.colorMixMode!=="replace")return!0}return!1}const wOt=X1e({color:[0,0,0,0],opacity:0});class _Ze{constructor(){this.edgeMaterial=null,this.material=null,this.castShadows=!0}}function xOt(t){const e=new _Ze;let r=!1,i=!1;for(const s of t.symbolLayers.items)if(s.type==="fill"&&s.enabled){const n=s.material,o=s.edges;if(n!=null&&!r){const a=n.color,l=Y1e(n.colorMixMode);e.material=a!=null?{color:[a.r/255,a.g/255,a.b/255],alpha:a.a,colorMixMode:l}:{color:[1,1,1],alpha:1,colorMixMode:Us.Multiply},e.castShadows=s.castShadows,r=!0}o==null||i||(e.edgeMaterial=Z1e(o,{}),i=!0)}return e.material||(e.material={color:[1,1,1],alpha:1,colorMixMode:Us.Multiply}),e}function TOt(t,e){return(0|t)+(0|e)|0}function vZe(t,e,r,i,s=0){i===Gf(i)?e.isGeographic?EZe(t,r,e,s):SZe(t,r,e,s):e.isWGS84&&(i.isWebMercator||bO(i))?bZe(e,t,i,r,s):e.isWebMercator&&bO(i)?TZe(e,t,i,r,s):t===r?(r.center[2]+=s,oi(r.center,e,0,r.center,i,0,1)):(se(r.center,t.center[0],t.center[1],t.center[2]+s),oi(r.center,e,0,r.center,i,0,1),WR(r.quaternion,t.quaternion),ie(r.halfSize,t.halfSize))}function bZe(t,e,r,i,s){ie(k0,e.center),k0[2]+=s;const n=Gf(r);oi(k0,t,0,k0,n,0,1),Ebe(n,e,k0,r,i)}const zL=new Array(24),wZe=new ke(zL,3,!0),wre=C(),k0=C(),xZe=Li();function TZe(t,e,r,i,s){ie(k0,e.center),k0[2]+=s,Ebe(t,e,k0,r,i)}function Ebe(t,e,r,i,s){const n=S5(xZe,e.quaternion);for(let o=0;o<8;++o){for(let a=0;a<3;++a)wre[a]=e.halfSize[a]*(o&1<<a?-1:1);for(let a=0;a<3;++a){let l=r[a];for(let c=0;c<3;++c)l+=wre[c]*n[3*c+a];zL[3*o+a]=l}}oi(zL,t,0,zL,i,0,8),bbe(wZe,s)}function SZe(t,e,r,i){wbe(t,mG),se(e.center,t.center[0],t.center[1],t.center[2]+i),Tl(r,e.center,Rc,Gf(r)),se(e.center,Rc[12],Rc[13],Rc[14]);const s=2*Math.sqrt(1+Rc[0]+Rc[5]+Rc[10]);eg[0]=(Rc[6]-Rc[9])/s,eg[1]=(Rc[8]-Rc[2])/s,eg[2]=(Rc[1]-Rc[4])/s,eg[3]=.25*s,E5(e.quaternion,eg,t.quaternion),Bf(eg,e.quaternion);let n=0,o=0,a=0;for(const l of mG)l[2]+=i,oi(l,r,0,l,Gf(r),0,1),Cn(Ar,l,e.center),yc(Ar,Ar,eg),n=Math.max(n,Math.abs(Ar[0])),o=Math.max(o,Math.abs(Ar[1])),a=Math.max(a,Math.abs(Ar[2]));se(e.halfSize,n,o,a)}function EZe(t,e,r,i){const s=Nr(r),n=1+Math.max(0,i)/(s.radius+t.center[2]);se(e.center,t.center[0],t.center[1],t.center[2]+i),oi(e.center,r,0,e.center,Gf(r),0,1),WR(e.quaternion,t.quaternion),Bf(eg,t.quaternion),se(Ar,0,0,1),yc(Ar,Ar,eg),se(Ar,t.halfSize[0]*Math.abs(Ar[0]),t.halfSize[1]*Math.abs(Ar[1]),t.halfSize[2]*Math.abs(Ar[2])),te(Ar,Ar,s.inverseFlattening),ce(e.halfSize,t.halfSize,Ar),te(e.halfSize,e.halfSize,n)}function SOt(t,e,r,i,s,n){if(!n||n.length===0||e==null||!t.mbs)return null;const o=Yqe(t.mbs,s,r,e);On(CM,o);let a=null;const l=()=>{if(!a)if(a=mG,wc(EM),t.serviceObb!=null){vZe(t.serviceObb,r,xre,e,s),wbe(xre,a);for(const m of a)$e(m,m,CM),TS(EM,m)}else{const m=t.mbs;if(!m)return;const y=m[3];Ws(m,r,Ar,e),$e(Ar,Ar,CM),Ar[2]+=s;for(let _=0;_<8;++_){const v=1&_?y:-y,w=2&_?y:-y,x=4&_?y:-y,T=a[_];ie(T,[Ar[0]+v,Ar[1]+w,Ar[2]+x]),TS(EM,T)}}};let c=1/0,h=-1/0;const p=m=>{if(m.type!=="replace")return;const y=m.geometry;if(!y?.hasZ)return;wc(HU);const _=y.spatialReference||i,v=y.rings.reduce((w,x)=>x.reduce((T,S)=>(Ws(S,_,Ar,e),$e(Ar,Ar,CM),TS(HU,Ar),Math.min(Ar[2],T)),w),1/0);l(),MR(EM,HU)&&(c=Math.min(c,v),h=Math.max(h,v))};if(n.forEach(m=>p(m)),c===1/0)return null;const f=(m,y,_)=>{$e(Ar,_,o),m[y]=Ar[0],m[y+1]=Ar[1],m[y+2]=Ar[2],y+=24,_[2]=c,$e(Ar,_,o),m[y]=Ar[0],m[y+1]=Ar[1],m[y+2]=Ar[2],y+=24,_[2]=h,$e(Ar,_,o),m[y]=Ar[0],m[y+1]=Ar[1],m[y+2]=Ar[2]};for(let m=0;m<8;++m)f(Tre.data,3*m,a[m]);return bbe(Tre)}function EOt(t){return t!=null&&t.halfSize[0]>=0}function COt(t){return t[3]>=0}function AOt(t){t!=null&&(t.halfSize[0]=-1)}function OOt(t){t!=null&&(t[3]=-1)}const Rc=be(),eg=k1e(),mG=[[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0]],HU=Ut(),EM=Ut(),xre=dX(),Ar=C(),Tre={data:new Array(72),size:3,exclusive:!0,stride:3},CM=be();async function CZe(t,e=t.popupTemplate){if(e==null)return[];const r=await e.getRequiredFields(t.fieldsIndex),{lastEditInfoEnabled:i}=e,{objectIdField:s,typeIdField:n,globalIdField:o,relationships:a}=t;if(r.includes("*"))return["*"];const l=i?await UNe(t):[],c=IF(t.fieldsIndex,[...r,...l]);return n&&c.push(n),c&&s&&t.fieldsIndex?.has(s)&&!c.includes(s)&&c.push(s),c&&o&&t.fieldsIndex?.has(o)&&!c.includes(o)&&c.push(o),a&&a.forEach(h=>{const{keyField:p}=h;c&&p&&t.fieldsIndex?.has(p)&&!c.includes(p)&&c.push(p)}),c}function Cbe(t,e){return t.popupTemplate?t.popupTemplate:e!=null&&e.defaultPopupTemplateEnabled&&t.defaultPopupTemplate!=null?t.defaultPopupTemplate:null}function ROt(t,e){return Cbe(t,{defaultPopupTemplateEnabled:e})!=null}const AZe=["3DObject","Point"],Sre=ove();let It=class extends Y0e(EHe(S0e(__e(Q_e(rve(fZ(T0e(Vi(mZ))))))))){constructor(...e){super(...e),this.featureReduction=null,this.rangeInfos=null,this.operationalLayerType="ArcGISSceneServiceLayer",this.type="scene",this.fields=null,this.floorInfo=null,this.outFields=null,this.nodePages=null,this.materialDefinitions=null,this.textureSetDefinitions=null,this.geometryDefinitions=null,this.serviceUpdateTimeStamp=null,this.excludeObjectIds=new Pt,this.definitionExpression=null,this.filter=null,this.path=null,this.labelsVisible=!0,this.labelingInfo=null,this.legendEnabled=!0,this.priority=null,this.semantic=null,this.cachedDrawingInfo={color:!1},this.popupEnabled=!0,this.popupTemplate=null,this.objectIdField=null,this.globalIdField=null,this._fieldUsageInfo={},this.screenSizePerspectiveEnabled=!0}normalizeCtorArgs(e,r){return typeof e=="string"?{url:e,...r}:e}destroy(){this._set("renderer",null)}getField(e){return this.fieldsIndex.get(e)}getFieldDomain(e,r){const i=this.getFeatureType(r?.feature)?.domains?.[e];return i&&i.type!=="inherited"?i:this.getField(e)?.domain??null}getFeatureType(e){return e&&this.associatedLayer?this.associatedLayer.getFeatureType(e):null}get types(){return this.associatedLayer?.types??[]}get typeIdField(){return this.associatedLayer?.typeIdField??null}get templates(){return this.associatedLayer?.templates??null}get formTemplate(){return this.associatedLayer?.formTemplate??null}get fieldsIndex(){return new aZ(this.fields)}readNodePages(e,r,i){return r.layerType==="Point"&&(e=r.pointNodePages),e==null||typeof e!="object"?null:Q1.fromJSON(e,i)}set elevationInfo(e){this._set("elevationInfo",e),this.loaded&&this._validateElevationInfo()}get geometryType(){return OZe[this.profile]||"mesh"}set renderer(e){oN(e,this.fieldsIndex),this._set("renderer",e)}readCachedDrawingInfo(e){return e!=null&&typeof e=="object"||(e={}),e.color==null&&(e.color=!1),e}get capabilities(){const e=this.associatedLayer?.capabilities??CHe,{query:r,editing:{supportsGlobalId:i,supportsRollbackOnFailure:s,supportsUploadWithItemId:n,supportsGeometryUpdate:o,supportsReturnServiceEditsInSourceSpatialReference:a},data:{supportsZ:l,supportsM:c,isVersioned:h,supportsAttachment:p},operations:{supportsEditing:f,supportsAdd:m,supportsUpdate:y,supportsDelete:_,supportsQuery:v,supportsQueryAttachments:w,supportsAsyncConvert3D:x}}=e,T=e.operations.supportsChangeTracking,S=!!this.associatedLayer?.infoFor3D&&Mee();return{query:r,editing:{supportsGlobalId:i,supportsReturnServiceEditsInSourceSpatialReference:a,supportsRollbackOnFailure:s,supportsGeometryUpdate:S&&o,supportsUploadWithItemId:n},data:{supportsAttachment:p,supportsZ:l,supportsM:c,isVersioned:h},operations:{supportsQuery:v,supportsQueryAttachments:w,supportsEditing:f&&T,supportsAdd:S&&m&&T,supportsDelete:S&&_&&T,supportsUpdate:y&&T,supportsAsyncConvert3D:x}}}get editingEnabled(){return this._isOverridden("editingEnabled")?this._get("editingEnabled"):this.userHasEditingPrivileges}set editingEnabled(e){this._overrideIfSome("editingEnabled",e)}get infoFor3D(){return this.associatedLayer?.infoFor3D??null}get defaultPopupTemplate(){return this.associatedLayer||this.attributeStorageInfo?this.createPopupTemplate():null}readObjectIdField(e,r){return!e&&r.fields&&r.fields.some(i=>(i.type==="esriFieldTypeOID"&&(e=i.name),!!e)),e||void 0}readGlobalIdField(e,r){return!e&&r.fields&&r.fields.some(i=>(i.type==="esriFieldTypeGlobalID"&&(e=i.name),!!e)),e||void 0}get displayField(){return this.associatedLayer?.displayField??null}readProfile(e,r){const i=r.store.profile;return i!=null&&Ere[i]?Ere[i]:(Q.getLogger(this).error("Unknown or missing profile",{profile:i,layer:this}),"mesh-pyramids")}load(e){const r=e!=null?e.signal:null,i=this.loadFromPortal({supportedTypes:["Scene Service"]},e).catch(Lo).then(()=>this._fetchService(r)).then(()=>Promise.all([this._fetchIndexAndUpdateExtent(this.nodePages,r),this._setAssociatedFeatureLayer(r),this._loadFilterGeometries()])).then(()=>this._validateElevationInfo()).then(()=>this._applyAssociatedLayerOverrides()).then(()=>this._populateFieldUsageInfo()).then(()=>ave(this,{origin:"service"},r)).then(()=>oN(this.renderer,this.fieldsIndex)).then(()=>this.finishLoadEditablePortalLayer(e));return this.addResolvingPromise(i),Promise.resolve(this)}async beforeSave(){this.filter!=null&&(this.filter=this.filter.clone(),await this.load())}async _loadFilterGeometries(){if(this.filter)try{await this.filter.loadGeometries(this.spatialReference)}catch(e){Q.getLogger(this).error("#_loadFilterGeometries()",this,"Failed to load filter geometries. Geometry filter will not be applied for this layer.",{error:e}),this.filter=null}}createQuery(){const e=new Y_;return this.geometryType!=="mesh"&&(e.returnGeometry=!0,e.returnZ=!0),e.where=this.definitionExpression||"1=1",e.sqlFormat="standard",e.outFields=["*"],e}queryExtent(e,r){return this._getAssociatedLayerForQuery().then(i=>i.queryExtent(e||this.createQuery(),r))}queryFeatureCount(e,r){return this._getAssociatedLayerForQuery().then(i=>i.queryFeatureCount(e||this.createQuery(),r))}queryFeatures(e,r){return this._getAssociatedLayerForQuery().then(i=>i.queryFeatures(e||this.createQuery(),r)).then(i=>{if(i?.features)for(const s of i.features)s.layer=this,s.sourceLayer=this;return i})}async queryCachedAttributes(e,r){const i=INe(this.fieldsIndex,await CZe(this,Cbe(this)));return Sbe(this.parsedUrl.path,this.attributeStorageInfo??[],e,r,i)}async queryCachedFeature(e,r){const i=await this.queryCachedAttributes(e,[r]);if(!i||i.length===0)throw new F("scenelayer:feature-not-in-cached-data","Feature not found in cached data");const s=new Oh;return s.attributes=i[0],s.layer=this,s.sourceLayer=this,s}queryObjectIds(e,r){return this._getAssociatedLayerForQuery().then(i=>i.queryObjectIds(e||this.createQuery(),r))}queryAttachments(e,r){return this._getAssociatedLayerForQuery().then(i=>i.queryAttachments(e,r))}getFieldUsageInfo(e){const r={supportsLabelingInfo:!1,supportsRenderer:!1,supportsPopupTemplate:!1,supportsLayerQuery:!1};return this.loaded?this._fieldUsageInfo[e]||r:(Q.getLogger(this).error("#getFieldUsageInfo()","Unavailable until layer is loaded"),r)}createPopupTemplate(e){return lve(this,e)}_getAssociatedLayerForQuery(){const e=this.associatedLayer;return e?.loaded?Promise.resolve(e):this._loadAssociatedLayerForQuery()}async _loadAssociatedLayerForQuery(){if(await this.load(),!this.associatedLayer)throw new F("scenelayer:query-not-available","SceneLayer queries are not available without an associated feature layer",{layer:this});try{await this.associatedLayer.load()}catch(e){throw new F("scenelayer:query-not-available","SceneLayer associated feature layer could not be loaded",{layer:this,error:e})}return this.associatedLayer}hasCachedStatistics(e){return this.statisticsInfo!=null&&this.statisticsInfo.some(r=>r.name===e)}async queryCachedStatistics(e,r){if(await this.load(r),!this.statisticsInfo)throw new F("scenelayer:no-cached-statistics","Cached statistics are not available for this layer");const i=this.fieldsIndex.get(e);if(!i)throw new F("scenelayer:field-unexisting",`Field '${e}' does not exist on the layer`);for(const s of this.statisticsInfo)if(s.name===i.name){const n=bc(this.parsedUrl.path,s.href);return qt(n,{query:{f:"json",token:this.apiKey},responseType:"json",signal:r?r.signal:null}).then(o=>o.data)}throw new F("scenelayer:no-cached-statistics","Cached statistics for this attribute are not available")}async saveAs(e,r){return this._debouncedSaveOperations(m2.SAVE_AS,{...r,getTypeKeywords:()=>this._getTypeKeywords(),portalItemLayerType:"scene"},e)}async save(){const e={getTypeKeywords:()=>this._getTypeKeywords(),portalItemLayerType:"scene"};return this._debouncedSaveOperations(m2.SAVE,e)}async applyEdits(e,r){const{applyEdits:i}=await ae(()=>import("./editingSupport-9c55cbd4.js"),["./editingSupport-9c55cbd4.js","./normalizeUtils-996b11fe.js","./normalizeUtilsCommon-4aa2ad72.js"],import.meta.url);if(await this.load(),!this.associatedLayer)throw new F(`${this.type}-layer:not-editable`,"Service is not editable");return await this.associatedLayer.load(),i(this,this.associatedLayer.source,e,r)}async uploadAssets(e,r){if(await this.load(),this.associatedLayer==null)throw new F(`${this.type}-layer:not-editable`,"Service is not editable");return await this.associatedLayer.load(),this.associatedLayer.uploadAssets(e,r)}on(e,r){return super.on(e,r)}validateLayer(e){if(e.layerType&&!AZe.includes(e.layerType))throw new F("scenelayer:layer-type-not-supported","SceneLayer does not support this layer type",{layerType:e.layerType});if(isNaN(this.version.major)||isNaN(this.version.minor))throw new F("layer:service-version-not-supported","Service version is not supported.",{serviceVersion:this.version.versionString,supportedVersions:"1.x, 2.x"});if(this.version.major>2)throw new F("layer:service-version-too-new","Service version is too new.",{serviceVersion:this.version.versionString,supportedVersions:"1.x, 2.x"});function r(i,s){let n=!1,o=!1;if(i==null)n=!0,o=!0;else{const a=s&&s.isGeographic;switch(i){case"east-north-up":case"earth-centered":n=!0,o=a;break;case"vertex-reference-frame":n=!0,o=!a;break;default:n=!1}}if(!n)throw new F("scenelayer:unsupported-normal-reference-frame","Normal reference frame is invalid.");if(!o)throw new F("scenelayer:incompatible-normal-reference-frame","Normal reference frame is incompatible with layer spatial reference.")}r(this.normalReferenceFrame,this.spatialReference)}_getTypeKeywords(){const e=[];if(this.profile==="points")e.push("Point");else{if(this.profile!=="mesh-pyramids")throw new F("scenelayer:unknown-profile","SceneLayer:save() encountered an unknown SceneLayer profile: "+this.profile);e.push("3DObject")}return e}_populateFieldUsageInfo(){if(this._fieldUsageInfo={},this.fields)for(const e of this.fields){const r=!(!this.attributeStorageInfo||!this.attributeStorageInfo.some(n=>n.name===e.name)),i=!!this.associatedLayer?.fields?.some(n=>n&&e.name===n.name),s={supportsLabelingInfo:r,supportsRenderer:r,supportsPopupTemplate:r||i,supportsLayerQuery:i};this._fieldUsageInfo[e.name]=s}}_applyAssociatedLayerOverrides(){this._applyAssociatedLayerFieldsOverrides(),this._applyAssociatedLayerPopupOverrides(),this._applyAssociatedLayerExtentOverride()}_applyAssociatedLayerFieldsOverrides(){if(!this.associatedLayer?.fields)return;let e=null;for(const r of this.associatedLayer.fields){const i=this.getField(r.name);i?(!i.domain&&r.domain&&(i.domain=r.domain.clone()),i.editable=r.editable,i.nullable=r.nullable,i.length=r.length):(e||(e=this.fields?this.fields.slice():[]),e.push(r.clone()))}e&&this._set("fields",e)}_applyAssociatedLayerPopupOverrides(){if(!this.associatedLayer)return;const e=["popupTemplate","popupEnabled"],r=ua(this);for(let i=0;i<e.length;i++){const s=e[i],n=this.originIdOf(s),o=this.associatedLayer.originIdOf(s);n<o&&(o===pr.SERVICE||o===pr.PORTAL_ITEM)&&r.setAtOrigin(s,this.associatedLayer[s],o)}}_applyAssociatedLayerExtentOverride(){const e=this.associatedLayer?.editingInfo?.lastEditDate,r=this.associatedLayer?.serverGens,i=this.associatedLayer?.getAtOrigin("fullExtent","service");!Mee()||this.associatedLayer?.infoFor3D==null||!i||!tZ(this.associatedLayer?.url)||!e||this.serviceUpdateTimeStamp?.lastUpdate===e.getTime()||!this.serviceUpdateTimeStamp&&r?.minServerGen===r?.serverGen||ua(this).setAtOrigin("fullExtent",i.clone(),pr.SERVICE)}async _setAssociatedFeatureLayer(e){if(!["mesh-pyramids","points"].includes(this.profile))return;const r=new AHe(this.parsedUrl,this.portalItem,this.apiKey,e);try{this.associatedLayer=await r.fetch()}catch(i){ms(i)||this._logWarningOnPopupEnabled()}}async _logWarningOnPopupEnabled(){await QS(()=>this.popupEnabled&&this.popupTemplate!=null);const e=`this SceneLayer: ${this.title}`;this.attributeStorageInfo==null?Q.getLogger(this).warn(`Associated FeatureLayer could not be loaded and no binary attributes found. Popups will not work on ${e}`):Q.getLogger(this).info(`Associated FeatureLayer could not be loaded. Falling back to binary attributes for Popups on ${e}`)}_validateElevationInfo(){const e=this.elevationInfo;e&&(this.profile==="mesh-pyramids"&&e.mode==="relative-to-scene"&&Q.getLogger(this).warn(".elevationInfo=","Mesh scene layers don't support relative-to-scene elevation mode"),e.featureExpressionInfo&&e.featureExpressionInfo.expression!=="0"&&Q.getLogger(this).warn(".elevationInfo=","Scene layers do not support featureExpressionInfo"))}};u([d({types:{key:"type",base:vg,typeMap:{selection:_7}},json:{origins:{"web-scene":{name:"layerDefinition.featureReduction",write:!0},"portal-item":{name:"layerDefinition.featureReduction",write:!0}}}})],It.prototype,"featureReduction",void 0),u([d({type:[d0],json:{read:!1,origins:{"web-scene":{name:"layerDefinition.rangeInfos",write:!0},"portal-item":{name:"layerDefinition.rangeInfos",write:!0}}}})],It.prototype,"rangeInfos",void 0),u([d({json:{read:!1}})],It.prototype,"associatedLayer",void 0),u([d({type:["show","hide"]})],It.prototype,"listMode",void 0),u([d({type:["ArcGISSceneServiceLayer"]})],It.prototype,"operationalLayerType",void 0),u([d({json:{read:!1},readOnly:!0})],It.prototype,"type",void 0),u([d({...Sre.fields,readOnly:!0,json:{read:!1,origins:{service:{read:!0}}}})],It.prototype,"fields",void 0),u([d()],It.prototype,"types",null),u([d()],It.prototype,"typeIdField",null),u([d()],It.prototype,"templates",null),u([d()],It.prototype,"formTemplate",null),u([d({readOnly:!0})],It.prototype,"fieldsIndex",null),u([d({type:a_e,json:{read:{source:"layerDefinition.floorInfo"},write:{target:"layerDefinition.floorInfo"}}})],It.prototype,"floorInfo",void 0),u([d(Sre.outFields)],It.prototype,"outFields",void 0),u([d({type:Q1,readOnly:!0,json:{read:!1}})],It.prototype,"nodePages",void 0),u([Ee("service","nodePages",["nodePages","pointNodePages"])],It.prototype,"readNodePages",null),u([d({type:[Gu],readOnly:!0})],It.prototype,"materialDefinitions",void 0),u([d({type:[RA],readOnly:!0})],It.prototype,"textureSetDefinitions",void 0),u([d({type:[MA],readOnly:!0})],It.prototype,"geometryDefinitions",void 0),u([d({readOnly:!0})],It.prototype,"serviceUpdateTimeStamp",void 0),u([d({readOnly:!0})],It.prototype,"attributeStorageInfo",void 0),u([d({readOnly:!0})],It.prototype,"statisticsInfo",void 0),u([d({type:Pt.ofType(Number),nonNullable:!0,json:{origins:{service:{read:!1,write:!1}},name:"layerDefinition.excludeObjectIds",write:{enabled:!0}}})],It.prototype,"excludeObjectIds",void 0),u([d({type:String,json:{origins:{service:{read:!1,write:!1}},name:"layerDefinition.definitionExpression",write:{enabled:!0,allowNull:!0}}})],It.prototype,"definitionExpression",void 0),u([d({type:kHe,json:{name:"layerDefinition.polygonFilter",write:{enabled:!0,allowNull:!0},origins:{service:{read:!1,write:!1}}}})],It.prototype,"filter",void 0),u([d({type:String,json:{origins:{"web-scene":{read:!0,write:!0}},read:!1}})],It.prototype,"path",void 0),u([d(t_e)],It.prototype,"elevationInfo",null),u([d({type:String})],It.prototype,"geometryType",null),u([d(p5)],It.prototype,"labelsVisible",void 0),u([d({type:[HR],json:{origins:{service:{name:"drawingInfo.labelingInfo",read:{reader:NN},write:!1}},name:"layerDefinition.drawingInfo.labelingInfo",read:{reader:NN},write:!0}})],It.prototype,"labelingInfo",void 0),u([d(e_e)],It.prototype,"legendEnabled",void 0),u([d({type:Number,json:{origins:{"web-document":{default:1,write:{enabled:!0,target:{opacity:{type:Number},"layerDefinition.drawingInfo.transparency":{type:Number}}},read:{source:["opacity","layerDefinition.drawingInfo.transparency"],reader(t,e){if(typeof t=="number"&&t>=0&&t<=1)return t;const r=e.layerDefinition?.drawingInfo?.transparency;return r!==void 0?s2(r):void 0}}},"portal-item":{write:!0},service:{read:!1}}}})],It.prototype,"opacity",void 0),u([d({type:["Low","High"],readOnly:!0,json:{read:!1,origins:{service:{read:!0}}}})],It.prototype,"priority",void 0),u([d({type:["Labels"],readOnly:!0,json:{read:!1,origins:{service:{read:!0}}}})],It.prototype,"semantic",void 0),u([d({types:p0e,json:{origins:{service:{read:{source:"drawingInfo.renderer"}}},name:"layerDefinition.drawingInfo.renderer",write:!0},value:null})],It.prototype,"renderer",null),u([d({json:{read:!1}})],It.prototype,"cachedDrawingInfo",void 0),u([Ee("service","cachedDrawingInfo")],It.prototype,"readCachedDrawingInfo",null),u([d({readOnly:!0,json:{read:!1}})],It.prototype,"capabilities",null),u([d({type:Boolean,json:{read:!1}})],It.prototype,"editingEnabled",null),u([d({readOnly:!0,json:{write:!1,read:!1}})],It.prototype,"infoFor3D",null),u([d(d5)],It.prototype,"popupEnabled",void 0),u([d({type:eE,json:{name:"popupInfo",write:!0}})],It.prototype,"popupTemplate",void 0),u([d({readOnly:!0,json:{read:!1}})],It.prototype,"defaultPopupTemplate",null),u([d({type:String,json:{read:!1}})],It.prototype,"objectIdField",void 0),u([Ee("service","objectIdField",["objectIdField","fields"])],It.prototype,"readObjectIdField",null),u([d({type:String,json:{read:!1}})],It.prototype,"globalIdField",void 0),u([Ee("service","globalIdField",["globalIdField","fields"])],It.prototype,"readGlobalIdField",null),u([d({readOnly:!0,type:String,json:{read:!1}})],It.prototype,"displayField",null),u([d({type:String,json:{read:!1}})],It.prototype,"profile",void 0),u([Ee("service","profile",["store.profile"])],It.prototype,"readProfile",null),u([d({readOnly:!0,type:String,json:{origins:{service:{read:{source:"store.normalReferenceFrame"}}},read:!1}})],It.prototype,"normalReferenceFrame",void 0),u([d(Q0e)],It.prototype,"screenSizePerspectiveEnabled",void 0),It=u([R("esri.layers.SceneLayer")],It);const Ere={"mesh-pyramids":"mesh-pyramids",meshpyramids:"mesh-pyramids","features-meshes":"mesh-pyramids",points:"points","features-points":"points",lines:"lines","features-lines":"lines",polygons:"polygons","features-polygons":"polygons"},OZe={"mesh-pyramids":"mesh",points:"point",lines:"polyline",polygons:"polygon"},Abe=It,MOt=Object.freeze(Object.defineProperty({__proto__:null,default:Abe},Symbol.toStringTag,{value:"Module"}));let jm=class extends Vi(de){constructor(...e){super(...e),this.position=new pt([0,0,0]),this.heading=0,this.tilt=0,this.fov=55}normalizeCtorArgs(e,r,i,s){if(e&&typeof e=="object"&&("x"in e||Array.isArray(e))){const n={position:e};return r!=null&&(n.heading=r),i!=null&&(n.tilt=i),s!=null&&(n.fov=s),n}return e}writePosition(e,r,i,s){const n=e.clone();n.x=sh(e.x||0),n.y=sh(e.y||0),n.z=e.hasZ?sh(e.z||0):e.z,r[i]=n.write({},s)}readPosition(e,r){const i=new pt;return i.read(e,r),i.x=sh(i.x||0),i.y=sh(i.y||0),i.z=i.hasZ?sh(i.z||0):i.z,i}equals(e){return e!=null&&this.tilt===e.tilt&&this.heading===e.heading&&this.fov===e.fov&&this.position.equals(e.position)}};u([d({type:pt,json:{write:{isRequired:!0}}})],jm.prototype,"position",void 0),u([Fe("position")],jm.prototype,"writePosition",null),u([Ee("position")],jm.prototype,"readPosition",null),u([d({type:Number,nonNullable:!0,json:{write:{isRequired:!0}}}),yr(t=>bW.normalize(sh(t)))],jm.prototype,"heading",void 0),u([d({type:Number,nonNullable:!0,json:{write:{isRequired:!0}}}),yr(t=>ge(sh(t),-180,180))],jm.prototype,"tilt",void 0),u([d({type:Number,nonNullable:!0,json:{read:!1,write:!1}})],jm.prototype,"fov",void 0),jm=u([R("esri.Camera")],jm);const Ih=jm;var gG;let p0=gG=class extends de{constructor(t){super(t),this.rotation=0,this.scale=0,this.targetGeometry=null,this.camera=null}castRotation(t){return(t%=360)<0&&(t+=360),t}clone(){return new gG({rotation:this.rotation,scale:this.scale,targetGeometry:this.targetGeometry!=null?this.targetGeometry.clone():null,camera:this.camera!=null?this.camera.clone():null})}};function qU(){return{enabled:!this.camera}}u([d({type:Number,json:{write:!0,origins:{"web-map":{default:0,write:!0},"web-scene":{write:{overridePolicy:qU}}}}})],p0.prototype,"rotation",void 0),u([yr("rotation")],p0.prototype,"castRotation",null),u([d({type:Number,json:{write:!0,origins:{"web-map":{default:0,write:!0},"web-scene":{write:{overridePolicy:qU}}}}})],p0.prototype,"scale",void 0),u([d({types:Ew,json:{read:S_,write:!0,origins:{"web-scene":{read:S_,write:{overridePolicy:qU}}}}})],p0.prototype,"targetGeometry",void 0),u([d({type:Ih,json:{write:!0}})],p0.prototype,"camera",void 0),p0=gG=u([R("esri.Viewpoint")],p0);const lp=p0;function dp(t){return t?{origin:$s(t.origin),vector:$s(t.vector)}:{origin:C(),vector:C()}}function RZe(t,e){const r=MZe.get();return r.origin=t,r.vector=e,r}function $Ot(t,e=dp()){return PZe(t.origin,t.vector,e)}function PZe(t,e,r=dp()){return ie(r.origin,t),ie(r.vector,e),r}function Pb(t,e,r=dp()){return ie(r.origin,t),he(r.vector,e,t),r}function pX(t,e){const r=he(Le.get(),e,t.origin),i=fe(t.vector,r),s=fe(t.vector,t.vector),n=ge(i/s,0,1),o=he(Le.get(),te(Le.get(),t.vector,n),r);return fe(o,o)}function LOt(t,e,r){return yG(t,e,0,1,r)}function DOt(t,e,r){return ce(r,t.origin,te(r,t.vector,e))}function yG(t,e,r,i,s){const{vector:n,origin:o}=t,a=he(Le.get(),e,o),l=fe(n,a)/na(n);return te(s,n,ge(l,r,i)),ce(s,s,t.origin)}function NOt(t,e){if(Rbe(t,RZe(e.origin,e.direction),!1,YN)){const{tA:r,pB:i,distance2:s}=YN;if(r>=0&&r<=1)return s;if(r<0)return yo(t.origin,i);if(r>1)return yo(ce(Le.get(),t.origin,t.vector),i)}return null}function Obe(t,e,r){return!!Rbe(t,e,!0,YN)&&(ie(r,YN.pA),!0)}function Rbe(t,e,r,i){const n=t.origin,o=ce(Le.get(),n,t.vector),a=e.origin,l=ce(Le.get(),a,e.vector),c=Le.get(),h=Le.get();if(c[0]=n[0]-a[0],c[1]=n[1]-a[1],c[2]=n[2]-a[2],h[0]=l[0]-a[0],h[1]=l[1]-a[1],h[2]=l[2]-a[2],Math.abs(h[0])<1e-6&&Math.abs(h[1])<1e-6&&Math.abs(h[2])<1e-6)return!1;const p=Le.get();if(p[0]=o[0]-n[0],p[1]=o[1]-n[1],p[2]=o[2]-n[2],Math.abs(p[0])<1e-6&&Math.abs(p[1])<1e-6&&Math.abs(p[2])<1e-6)return!1;const f=c[0]*h[0]+c[1]*h[1]+c[2]*h[2],m=h[0]*p[0]+h[1]*p[1]+h[2]*p[2],y=c[0]*p[0]+c[1]*p[1]+c[2]*p[2],_=h[0]*h[0]+h[1]*h[1]+h[2]*h[2],v=(p[0]*p[0]+p[1]*p[1]+p[2]*p[2])*_-m*m;if(Math.abs(v)<1e-6)return!1;let w=(f*m-y*_)/v,x=(f+m*w)/_;r&&(w=ge(w,0,1),x=ge(x,0,1));const T=Le.get(),S=Le.get();return T[0]=n[0]+w*p[0],T[1]=n[1]+w*p[1],T[2]=n[2]+w*p[2],S[0]=a[0]+x*h[0],S[1]=a[1]+x*h[1],S[2]=a[2]+x*h[2],i.tA=w,i.tB=x,i.pA=T,i.pB=S,i.distance2=yo(T,S),!0}const YN={tA:0,tB:0,pA:C(),pB:C(),distance2:0},MZe=new Xg(()=>dp()),WU=Q.getLogger("esri.views.3d.support.geometryUtils.boundedPlane");let IZe=class{constructor(){this.plane=Ir(),this.origin=C(),this.basis1=C(),this.basis2=C()}};const Pbe=IZe;function Yg(t=zbe){return{plane:Ir(t.plane),origin:$s(t.origin),basis1:$s(t.basis1),basis2:$s(t.basis2)}}function $Ze(t,e,r){const i=HZe.get();return i.origin=t,i.basis1=e,i.basis2=r,i.plane=IWe(0,0,0,0),$5(i),i}function Uw(t,e=Yg()){return fX(t.origin,t.basis1,t.basis2,e)}function LZe(t,e){ie(e.origin,t.origin),ie(e.basis1,t.basis1),ie(e.basis2,t.basis2),P5(e.plane,t.plane)}function fX(t,e,r,i=Yg()){return ie(i.origin,t),ie(i.basis1,e),ie(i.basis2,r),$5(i),GZe(i,"fromValues()"),i}function $5(t){BO(t.basis2,t.basis1,t.origin,t.plane)}function Mbe(t,e,r){t!==r&&Uw(t,r);const i=te(Le.get(),Vg(t),e);return ce(r.origin,r.origin,i),r.plane[3]-=e,r}function DZe(t,e,r){return Ibe(e,r),Mbe(r,_X(t,t.origin),r),r}function Ibe(t,e=Yg()){const r=(t[2]-t[0])/2,i=(t[3]-t[1])/2;return se(e.origin,t[0]+r,t[1]+i,0),se(e.basis1,r,0,0),se(e.basis2,0,i,0),hX(0,0,1,0,e.plane),e}function mX(t,e,r){return!!Fw(t.plane,e,r)&&kbe(t,r)}function NZe(t,e,r){if(mX(t,e,r))return r;const i=$be(t,e,Le.get());return ce(r,e.origin,te(Le.get(),e.direction,di(e.origin,i)/Ce(e.direction))),r}function $be(t,e,r){const i=JN.get();Vbe(t,e,i,JN.get());let s=Number.POSITIVE_INFINITY;for(const n of bX){const o=vX(t,n,L5.get()),a=Le.get();if(LWe(i,o,a)){const l=Hg(Le.get(),e.origin,a),c=Math.abs(Pn(fe(e.direction,l)));c<s&&(s=c,ie(r,a))}}return s===Number.POSITIVE_INFINITY?Lbe(t,e,r):r}function Lbe(t,e,r){if(mX(t,e,r))return r;const i=JN.get(),s=JN.get();Vbe(t,e,i,s);let n=Number.POSITIVE_INFINITY;for(const o of bX){const a=vX(t,o,L5.get()),l=Le.get();if(DWe(i,a,l)){const c=pWe(e,l);if(!mbe(s,l))continue;c<n&&(n=c,ie(r,l))}}return gX(t,e.origin)<n&&Dbe(t,e.origin,r),r}function Dbe(t,e,r){const i=UWe(t.plane,e,Le.get()),s=yG(Cre(t,t.basis1),i,-1,1,Le.get()),n=yG(Cre(t,t.basis2),i,-1,1,Le.get());return he(r,ce(Le.get(),s,n),t.origin),r}function Nbe(t,e,r){const{origin:i,basis1:s,basis2:n}=t,o=he(Le.get(),e,i),a=g_(s,o),l=g_(n,o),c=g_(Vg(t),o);return se(r,a,l,c)}function gX(t,e){const r=Nbe(t,e,Le.get()),{basis1:i,basis2:s}=t,n=Ce(i),o=Ce(s),a=Math.max(Math.abs(r[0])-n,0),l=Math.max(Math.abs(r[1])-o,0),c=r[2];return a*a+l*l+c*c}function FZe(t,e){return Math.sqrt(gX(t,e))}function UZe(t,e){let r=Number.NEGATIVE_INFINITY;for(const i of bX){const s=vX(t,i,L5.get()),n=pX(s,e);n>r&&(r=n)}return Math.sqrt(r)}function yX(t,e){return mbe(t.plane,e)&&kbe(t,e)}function kZe(t,e,r,i){return BZe(t,r,i)}function _X(t,e){const r=-t.plane[3];return g_(Vg(t),e)-r}function VZe(t,e,r,i){const s=_X(t,e),n=te(jZe,Vg(t),r-s);return ce(i,e,n),i}function Fbe(t,e){return la(t.basis1,e.basis1)&&la(t.basis2,e.basis2)&&la(t.origin,e.origin)}function Ube(t,e,r){return t!==r&&Uw(t,r),On(ix,e),xc(ix,ix),$e(r.basis1,t.basis1,ix),$e(r.basis2,t.basis2,ix),$e(r.plane,t.plane,ix),$e(r.origin,t.origin,e),lG(r.plane,r.plane,r.origin),r}function zZe(t,e,r,i){return t!==i&&Uw(t,i),mu(ZU,e,r),$e(i.basis1,t.basis1,ZU),$e(i.basis2,t.basis2,ZU),$5(i),i}function Vg(t){return t.plane}function BZe(t,e,r){switch(e){case pc.X:ie(r,t.basis1),me(r,r);break;case pc.Y:ie(r,t.basis2),me(r,r);break;case pc.Z:ie(r,Vg(t))}return r}function kbe(t,e){const r=he(Le.get(),e,t.origin),i=na(t.basis1),s=na(t.basis2),n=fe(t.basis1,r),o=fe(t.basis2,r);return-n-i<0&&n-i<0&&-o-s<0&&o-s<0}function Cre(t,e){const r=L5.get();return ie(r.origin,t.origin),ie(r.vector,e),r}function vX(t,e,r){const{basis1:i,basis2:s,origin:n}=t,o=te(Le.get(),i,e.origin[0]),a=te(Le.get(),s,e.origin[1]);ce(r.origin,o,a),ce(r.origin,r.origin,n);const l=te(Le.get(),i,e.direction[0]),c=te(Le.get(),s,e.direction[1]);return te(r.vector,ce(l,l,c),2),r}function GZe(t,e){Math.abs(fe(t.basis1,t.basis2)/(Ce(t.basis1)*Ce(t.basis2)))>1e-6&&WU.warn(e,"Provided basis vectors are not perpendicular"),Math.abs(fe(t.basis1,Vg(t)))>1e-6&&WU.warn(e,"Basis vectors and plane normal are not perpendicular"),Math.abs(-fe(Vg(t),t.origin)-t.plane[3])>1e-6&&WU.warn(e,"Plane offset is not consistent with plane origin")}function Vbe(t,e,r,i){const s=Vg(t);BO(s,e.direction,e.origin,r),BO(r,s,e.origin,i)}const zbe={plane:Ir(),origin:Oe(0,0,0),basis1:Oe(1,0,0),basis2:Oe(0,1,0)},JN=new Xg(Ir),L5=new Xg(dp),jZe=C(),HZe=new Xg(()=>Yg()),bX=[{origin:[-1,-1],direction:[1,0]},{origin:[1,-1],direction:[0,1]},{origin:[1,1],direction:[-1,0]},{origin:[-1,1],direction:[0,-1]}],ix=be(),ZU=be(),qZe=Object.freeze(Object.defineProperty({__proto__:null,BoundedPlaneClass:Pbe,UP:zbe,altitudeAt:_X,axisAt:kZe,closestPoint:Lbe,closestPointOnSilhouette:$be,copy:Uw,copyWithoutVerify:LZe,create:Yg,distance:FZe,distance2:gX,distanceToSilhouette:UZe,elevate:Mbe,equals:Fbe,extrusionContainsPoint:yX,fromAABoundingRect:Ibe,fromValues:fX,intersectRay:mX,intersectRayClosestSilhouette:NZe,normal:Vg,projectPoint:Dbe,projectPointLocal:Nbe,rotate:zZe,setAltitudeAt:VZe,setExtent:DZe,transform:Ube,updateUnboundedPlane:$5,wrap:$Ze},Symbol.toStringTag,{value:"Module"}));function WZe(t){const{value:e,operations:r}=t;return{operations:r,value:r.create(e)}}function ZZe(t,e,r){return t.operations.setExtent(t.value,e,r.value),r}function XZe(t){return{operations:t,value:t.create()}}function Bbe(t,e,r=XZe(t)){return r.operations=t,t.copy(e,r.value),r}function YZe(t){return Bbe(AWe,abe(0,0,0,Nr(t).radius))}const Are=2**50;function JZe(){return Bbe(qZe,fX([0,0,0],[Are,0,0],[0,Are,0]))}function QZe(t,e,r){return t.operations.axisAt(t.value,e,pc.Z,r)}function KZe(t,e,r,i){return t.operations.axisAt(t.value,e,r,i)}function eXe(t,e,r){return t.operations.intersectRay(t.value,e,r)}function tXe(t,e,r){return t.operations.intersectRayClosestSilhouette(t.value,e,r)}function rXe(t,e){return t.operations.altitudeAt(t.value,e)}function Gbe(t,e,r,i){return t.operations.setAltitudeAt(t.value,e,r,i)}function iXe(t,e,r,i){return e!==i&&Ls(i,e),se(sx,i[12],i[13],i[14]),Gbe(t,sx,r,sx),i[12]=sx[0],i[13]=sx[1],i[14]=sx[2],i}function XU(t,e,r){return t.operations.elevate(t.value,e,r.value)}const sx=C();function Ore(t,e,r,i,s){return s[0]=fe(t,e),s[1]=fe(t,r),s[2]=fe(t,i),s}function _G(t,e,r,i,s){ie(r,t),ie(AM,e),me(AM,AM),at(i,AM,r),at(s,i,r)}function sXe(t,e){return t?Gf(e):e.isGeographic?je.PlateCarree:e}const AM=C(),wX=96;function UOt(t,e){const r=e||t.extent,i=t.width,s=Za(r&&r.spatialReference);return r&&i?r.width/i*s*Yq*wX:0}function nXe(t,e){return t/(Za(e)*Yq*wX)}function oXe(t){return t/(Yq*wX)}const aXe="OBJECTID";let w2=class extends N3{constructor(e){super(e),this.handles.add(this.on("before-add",r=>{r.item!=null&&r.item.parent===this.owner&&(Q.getLogger(this).warn("Analysis inside the collection must be unique. Not adding this element again."),r.preventDefault())}))}_own(e){e.parent=this.owner}_release(e){e.parent=null}};w2=u([R("esri.support.AnalysesCollection")],w2);const BL={widthBreakpoint:{getValue(t){const e=t.viewSize[0],r=t.breakpoints,i=this.values;return e<=r.xsmall?i.xsmall:e<=r.small?i.small:e<=r.medium?i.medium:e<=r.large?i.large:i.xlarge},values:{xsmall:"xsmall",small:"small",medium:"medium",large:"large",xlarge:"xlarge"},valueToClassName:{xsmall:"esri-view-width-xsmall esri-view-width-less-than-small esri-view-width-less-than-medium esri-view-width-less-than-large esri-view-width-less-than-xlarge",small:"esri-view-width-small esri-view-width-greater-than-xsmall esri-view-width-less-than-medium esri-view-width-less-than-large esri-view-width-less-than-xlarge",medium:"esri-view-width-medium esri-view-width-greater-than-xsmall esri-view-width-greater-than-small esri-view-width-less-than-large esri-view-width-less-than-xlarge",large:"esri-view-width-large esri-view-width-greater-than-xsmall esri-view-width-greater-than-small esri-view-width-greater-than-medium esri-view-width-less-than-xlarge",xlarge:"esri-view-width-xlarge esri-view-width-greater-than-xsmall esri-view-width-greater-than-small esri-view-width-greater-than-medium esri-view-width-greater-than-large"}},heightBreakpoint:{getValue(t){const e=t.viewSize[1],r=t.breakpoints,i=this.values;return e<=r.xsmall?i.xsmall:e<=r.small?i.small:e<=r.medium?i.medium:e<=r.large?i.large:i.xlarge},values:{xsmall:"xsmall",small:"small",medium:"medium",large:"large",xlarge:"xlarge"},valueToClassName:{xsmall:"esri-view-height-xsmall esri-view-height-less-than-small esri-view-height-less-than-medium esri-view-height-less-than-large esri-view-height-less-than-xlarge",small:"esri-view-height-small esri-view-height-greater-than-xsmall esri-view-height-less-than-medium esri-view-height-less-than-large esri-view-height-less-than-xlarge",medium:"esri-view-height-medium esri-view-height-greater-than-xsmall esri-view-height-greater-than-small esri-view-height-less-than-large esri-view-height-less-than-xlarge",large:"esri-view-height-large esri-view-height-greater-than-xsmall esri-view-height-greater-than-small esri-view-height-greater-than-medium esri-view-height-less-than-xlarge",xlarge:"esri-view-height-xlarge esri-view-height-greater-than-xsmall esri-view-height-greater-than-small esri-view-height-greater-than-medium esri-view-height-greater-than-large"}},orientation:{getValue(t){const e=t.viewSize,r=e[0],i=e[1],s=this.values;return i>=r?s.portrait:s.landscape},values:{portrait:"portrait",landscape:"landscape"},valueToClassName:{portrait:"esri-view-orientation-portrait",landscape:"esri-view-orientation-landscape"}}},YU={xsmall:544,small:768,medium:992,large:1200};function lXe(t){const e=t;return e&&e.xsmall<e.small&&e.small<e.medium&&e.medium<e.large}function JU(t,e){return e?BL[t].valueToClassName[e].split(" "):[]}const cXe=t=>{let e=class extends t{constructor(...r){super(...r),this._breakpointsHandles=new Oi,this.orientation=null,this.widthBreakpoint=null,this.heightBreakpoint=null,this.breakpoints=YU}initialize(){this._breakpointsHandles.add(le(()=>[this.breakpoints,this.size],()=>this._updateClassNames(),Vr))}destroy(){this.destroyed||(this._removeActiveClassNames(),this._breakpointsHandles=Me(this._breakpointsHandles))}set breakpoints(r){if(r===this._get("breakpoints"))return;const i=lXe(r);if(!i){const s=JSON.stringify(YU,null,2);console.warn("provided breakpoints are not valid, using defaults:"+s)}r=i?r:YU,this._set("breakpoints",{...r})}_updateClassNames(){if(!this.container)return;const r=oc.acquire(),i=oc.acquire();let s,n=!1;for(s in BL){const o=this[s],a=BL[s].getValue({viewSize:this.size,breakpoints:this.breakpoints});o!==a&&(n=!0,this[s]=a,JU(s,o).forEach(l=>i.push(l)),JU(s,a).forEach(l=>r.push(l)))}n&&(this._applyClassNameChanges(r,i),oc.release(r),oc.release(i))}_applyClassNameChanges(r,i){const s=this.container;s&&(i.forEach(n=>s.classList.remove(n)),r.forEach(n=>s.classList.add(n)))}_removeActiveClassNames(){const r=this.container;if(!r)return;let i;for(i in BL)JU(i,this[i]).forEach(s=>r.classList.remove(s))}};return u([d()],e.prototype,"breakpoints",null),u([d()],e.prototype,"orientation",void 0),u([d()],e.prototype,"widthBreakpoint",void 0),u([d()],e.prototype,"heightBreakpoint",void 0),e=u([R("esri.views.BreakpointsOwner")],e),e};let f0=class extends Te{constructor(){super(...arguments),this.items=new Pt,this._watchUpdatingTracking=new Cf,this._callbacks=new Map,this._projector=PK(),this._hiddenProjector=PK()}get needsRender(){return this.items.length>0}get updating(){return this._watchUpdatingTracking?.updating??!1}initialize(){const e=document.createElement("div");e.className="esri-overlay-surface",this._set("surface",e),this._hiddenSurface=document.createElement("div"),this._hiddenSurface.setAttribute("style","visibility: hidden;"),e.appendChild(this._hiddenSurface),this._watchUpdatingTracking.addOnCollectionChange(()=>this.items,r=>{for(const i of r.added){const s=()=>i.render();this._callbacks.set(i,s),this._projector.append(this.surface,s)}for(const i of r.removed){const s=this._projector.detach(this._callbacks.get(i));this.surface.removeChild(s.domNode),this._callbacks.delete(i)}})}addItem(e){this.items.add(e)}removeItem(e){this.items.remove(e)}destroy(){this.items.removeAll(),this._callbacks.forEach(e=>this._projector.detach(e)),this._callbacks=null,this._projector=null,this._watchUpdatingTracking.destroy()}render(){this._projector.renderNow()}computeBoundingRect(e){const r=this._hiddenSurface,i=this._hiddenProjector;let s;const n=()=>(s=e.render(),s);i.append(r,n),i.renderNow();const o={left:0,top:0,right:0,bottom:0};if(s&&s.domNode){const a=s.domNode.getBoundingClientRect();o.left=a.left,o.top=a.top,o.right=a.right,o.bottom=a.bottom}for(i.detach(n);r.firstChild;)r.removeChild(r.firstChild);return o}overlaps(e,r){const i=this.computeBoundingRect(e),s=this.computeBoundingRect(r);return Math.max(i.left,s.left)<=Math.min(i.right,s.right)&&Math.max(i.top,s.top)<=Math.min(i.bottom,s.bottom)}get hasVisibleItems(){return this.items.some(e=>e.visible)}async prepare(){await document.fonts.load(this._fontString()).catch(()=>{})}renderCanvas(e){if(!this.items.some(i=>i.visible))return;const r=e.getContext("2d");r.save(),r.font=this._fontString(),this.items.forEach(i=>{r.save(),i.renderCanvas(r),r.restore()}),r.restore()}_fontString(){return`10px ${getComputedStyle(this.surface).fontFamily}`}};u([d({readOnly:!0})],f0.prototype,"surface",void 0),u([d({readOnly:!0})],f0.prototype,"items",void 0),u([d({readOnly:!0})],f0.prototype,"needsRender",null),u([d({readOnly:!0})],f0.prototype,"_watchUpdatingTracking",void 0),u([d({readOnly:!0})],f0.prototype,"updating",null),f0=u([R("esri.views.overlay.ViewOverlay")],f0);const Rre=f0,QU=[0,0];function uXe(t){const e=(t.ownerDocument||window.document).defaultView,r=t.getBoundingClientRect();return QU[0]=r.left+(e?.pageXOffset??0),QU[1]=r.top+(e?.pageYOffset??0),QU}function Pre(t){t&&(ome(t),t.parentNode&&t.parentNode.removeChild(t))}function hXe(t){const e=document.createElement("div");return t.appendChild(e),e}const YE=16,OM=750,dXe=512,pXe=2,fXe=t=>{let e=class extends t{constructor(...r){super(...r),this._freqInfo={freq:YE,time:OM},this._overlayRenderTaskHandle=null,this.height=0,this.overlay=null,this.position=null,this.resizing=!1,this.root=null,this.surface=null,this.suspended=!0,this.ui=null,this.userContent=null,this.width=0,this.widthBreakpoint=null,this.addHandles([le(()=>this.cursor,i=>{const{surface:s}=this;s&&s.setAttribute("data-cursor",i)}),le(()=>this.navigating,i=>{const{surface:s}=this;s&&s.setAttribute("data-navigating",i.toString())})])}initialize(){this.addHandles([le(()=>this.ui,(r,i)=>this._handleUIChange(r,i),Vr),this.on("focus",()=>this.notifyChange("focused")),this.on("blur",()=>this.notifyChange("focused"))])}destroy(){this.destroyed||(this.ui=Me(this.ui),this.container=null)}get container(){return this._get("container")??null}set container(r){const i=this._get("container"),s=LF(r);if(s||typeof r!="string"||Q.getLogger(this).error("#container",`element with id '${r}' not found`),i===s)return;if(this._stopMeasuring(),i&&(i.classList.remove("esri-view"),this._overlayRenderTaskHandle&&(this._overlayRenderTaskHandle.remove(),this._overlayRenderTaskHandle=null),this.overlay&&(this.overlay.destroy(),this._set("overlay",null)),this.root&&(Pre(this.root),this._set("root",null)),this.userContent&&(bK(this.userContent,i),Pre(this.userContent),this._set("userContent",null))),!s)return this._set("width",0),this._set("height",0),this._set("position",null),this._set("suspended",!0),this._set("surface",null),void this._set("container",null);s.classList.add("esri-view");const n=document.createElement("div");n.className="esri-view-user-storage",bK(s,n),s.appendChild(n),this._set("userContent",n);const o=document.createElement("div");o.className="esri-view-root",s.insertBefore(o,s.firstChild),this._set("root",o);const a=document.createElement("div");a.className="esri-view-surface",a.setAttribute("role","application"),a.tabIndex=0,o.appendChild(a),this._set("surface",a);const l=new Rre;o.appendChild(l.surface),this._set("overlay",l),this.addHandles(le(()=>l.needsRender,c=>{c&&!this._overlayRenderTaskHandle?this._overlayRenderTaskHandle=JS({render:()=>this.overlay?.render()}):this._overlayRenderTaskHandle=Ii(this._overlayRenderTaskHandle)})),this.forceDOMReadyCycle(),this._set("container",s),this._startMeasuring()}get focused(){const r=document.activeElement===this.surface;return document.hasFocus()&&r}get size(){return[this.width,this.height]}blur(){this.surface?.blur()}focus(){this.surface?.focus()}pageToContainer(r,i,s){const n=this.position;return r-=n?n[0]:0,i-=n?n[1]:0,s?(s[0]=r,s[1]=i):s=[r,i],s}containerToPage(r,i,s){const n=this.position;return r+=n?n[0]:0,i+=n?n[1]:0,s?(s[0]=r,s[1]=i):s=[r,i],s}_handleUIChange(r,i){this.removeHandles("ui"),i&&i!==r&&i.destroy(),r&&(r.view=this,this.addHandles(le(()=>this.root,s=>{r.container=s?hXe(s):null},Vr),"ui")),this._set("ui",r)}_stopMeasuring(){this.removeHandles("measuring"),this._get("resizing")&&this._set("resizing",!1)}_startMeasuring(){const r=this._freqInfo;r.freq=YE,r.time=OM,this.addHandles([(()=>{const i=()=>{r.freq=YE,r.time=OM};return window.addEventListener("resize",i),{remove(){window.removeEventListener("resize",i)}}})(),JS({prepare:i=>{const s=this._measure(),n=this._freqInfo;if(n.time+=i.deltaTime,s&&(n.freq=YE,this._get("resizing")||this._set("resizing",!0)),n.time<n.freq)return;n.time=0;const o=this._position();n.freq=o||s?YE:Math.min(OM,n.freq*pXe),!s&&n.freq>=dXe&&this._get("resizing")&&this._set("resizing",!1)}})],"measuring"),this._measure(),this._position()}_measure(){const r=this.container,i=r?r.clientWidth:0,s=r?r.clientHeight:0;if(i===0||s===0)return this.suspended||this._set("suspended",!0),!1;const n=this.width,o=this.height;return i===n&&s===o?(this.suspended&&this._set("suspended",!1),!1):(this._set("width",i),this._set("height",s),this.suspended&&this._set("suspended",!1),this.emit("resize",{oldWidth:n,oldHeight:o,width:i,height:s}),!0)}_position(){const r=this.container,i=this.position,s=r&&uXe(r);return!!s&&(!i||s[0]!==i[0]||s[1]!==i[1])&&(this._set("position",[s[0],s[1]]),!0)}forceDOMReadyCycle(){}};return u([d()],e.prototype,"container",null),u([d({readOnly:!0})],e.prototype,"focused",null),u([d({readOnly:!0})],e.prototype,"height",void 0),u([d({type:Rre})],e.prototype,"overlay",void 0),u([d({readOnly:!0})],e.prototype,"position",void 0),u([d({readOnly:!0})],e.prototype,"resizing",void 0),u([d({readOnly:!0})],e.prototype,"root",void 0),u([d({value:null,readOnly:!0})],e.prototype,"size",null),u([d({readOnly:!0})],e.prototype,"surface",void 0),u([d({readOnly:!0})],e.prototype,"suspended",void 0),u([d()],e.prototype,"ui",void 0),u([d({readOnly:!0})],e.prototype,"userContent",void 0),u([d({readOnly:!0})],e.prototype,"width",void 0),u([d()],e.prototype,"widthBreakpoint",void 0),e=u([R("esri.views.DOMContainer")],e),e},xX=Q.getLogger("esri.layers.support.ElevationSampler");let jbe=class{queryElevation(e){return Hbe(e.clone(),this)}on(){return vXe}projectIfRequired(e,r){return qbe(e,r)}},mXe=class extends jbe{get spatialReference(){return this.extent.spatialReference}constructor(e,r,i){super(),this.tile=e,this.noDataValue=i;const s=e.tile.extent;this.extent=RF(s,r.spatialReference),this.extent.zmin=e.zmin,this.extent.zmax=e.zmax,this._aaExtent=s;const n=Za(r.spatialReference),o=r.lodAt(e.tile.level).resolution*n;this.demResolution={min:o,max:o}}contains(e){const r=this.projectIfRequired(e,this.spatialReference);return r!=null&&this.containsAt(r.x,r.y)}containsAt(e,r){return PF(this._aaExtent,e,r)}elevationAt(e,r){if(!this.containsAt(e,r)){const i=this.extent,s=`${i.xmin}, ${i.ymin}, ${i.xmax}, ${i.ymax}`;return xX.warn("#elevationAt()",`Point used to sample elevation (${e}, ${r}) is outside of the sampler extent (${s})`),this.noDataValue}return this.tile.sample(e,r)??this.noDataValue}},GOt=class extends jbe{get spatialReference(){return this.extent.spatialReference}constructor(e,r,i){let s;super(),typeof r=="number"?(this.noDataValue=r,s=null):(s=r,this.noDataValue=i),this.samplers=s?e.map(o=>new mXe(o,s,this.noDataValue)):e;const n=this.samplers[0];if(n){this.extent=n.extent.clone();const{min:o,max:a}=n.demResolution;this.demResolution={min:o,max:a};for(let l=1;l<this.samplers.length;l++){const c=this.samplers[l];this.extent.union(c.extent),this.demResolution.min=Math.min(this.demResolution.min,c.demResolution.min),this.demResolution.max=Math.max(this.demResolution.max,c.demResolution.max)}}else this.extent=RF(Ut(),s.spatialReference),this.demResolution={min:0,max:0}}elevationAt(e,r){for(const i of this.samplers)if(i.containsAt(e,r))return i.elevationAt(e,r);return xX.warn("#elevationAt()",`Point used to sample elevation (${e}, ${r}) is outside of the sampler`),this.noDataValue}};function Hbe(t,e){const r=qbe(t,e.spatialReference);if(!r)return null;switch(t.type){case"point":gXe(t,r,e);break;case"polyline":yXe(t,r,e);break;case"multipoint":_Xe(t,r,e)}return t}function qbe(t,e){if(t==null)return null;const r=t.spatialReference;if(r.equals(e))return t;const i=Sw(t,e);return i||xX.error(`Cannot project geometry spatial reference (wkid:${r.wkid}) to elevation sampler spatial reference (wkid:${e.wkid})`),i}function gXe(t,e,r){t.z=r.elevationAt(e.x,e.y)}function yXe(t,e,r){yf.spatialReference=e.spatialReference;const i=t.hasM&&!t.hasZ;for(let s=0;s<t.paths.length;s++){const n=t.paths[s],o=e.paths[s];for(let a=0;a<n.length;a++){const l=n[a],c=o[a];yf.x=c[0],yf.y=c[1],i&&(l[3]=l[2]),l[2]=r.elevationAt(yf.x,yf.y)}}t.hasZ=!0}function _Xe(t,e,r){yf.spatialReference=e.spatialReference;const i=t.hasM&&!t.hasZ;for(let s=0;s<t.points.length;s++){const n=t.points[s],o=e.points[s];yf.x=o[0],yf.y=o[1],i&&(n[3]=n[2]),n[2]=r.elevationAt(yf.x,yf.y)}t.hasZ=!0}const yf=new pt,vXe={remove(){}};var vG;let Jp=vG=class extends de{constructor(t){super(t),this.cols=null,this.level=0,this.levelValue=null,this.origin=null,this.resolution=0,this.rows=null,this.scale=0}clone(){return new vG({cols:this.cols,level:this.level,levelValue:this.levelValue,resolution:this.resolution,rows:this.rows,scale:this.scale})}};u([d({json:{write:!0,origins:{"web-document":{read:!1,write:!1},"portal-item":{read:!1,write:!1}}}})],Jp.prototype,"cols",void 0),u([d({type:Xi,json:{write:!0}})],Jp.prototype,"level",void 0),u([d({type:String,json:{write:!0}})],Jp.prototype,"levelValue",void 0),u([d({json:{write:!0,origins:{"web-document":{read:!1,write:!1},"portal-item":{read:!1,write:!1}}}})],Jp.prototype,"origin",void 0),u([d({type:Number,json:{write:!0}})],Jp.prototype,"resolution",void 0),u([d({json:{write:!0,origins:{"web-document":{read:!1,write:!1},"portal-item":{read:!1,write:!1}}}})],Jp.prototype,"rows",void 0),u([d({type:Number,json:{write:!0}})],Jp.prototype,"scale",void 0),Jp=vG=u([R("esri.layers.support.LOD")],Jp);const Ud=Jp;let bXe=class{constructor(e,r,i,s,n=void 0){this.id=e,this.level=r,this.row=i,this.col=s,this.extent=n}};var m0;const Mre=new Rr({PNG:"png",PNG8:"png8",PNG24:"png24",PNG32:"png32",JPEG:"jpg",JPG:"jpg",DIB:"dib",TIFF:"tiff",EMF:"emf",PS:"ps",PDF:"pdf",GIF:"gif",SVG:"svg",SVGZ:"svgz",Mixed:"mixed",MIXED:"mixed",LERC:"lerc",LERC2D:"lerc2d",RAW:"raw",pbf:"pbf"});let Qo=m0=class extends de{static create(t={}){const{resolutionFactor:e=1,scales:r,size:i=256,spatialReference:s=je.WebMercator,numLODs:n=24}=t;if(!aa(s)){const p=[];if(r)for(let f=0;f<r.length;f++){const m=r[f];p.push(new Ud({level:f,scale:m,resolution:m}))}else{let f=5e-4;for(let m=n-1;m>=0;m--)p.unshift(new Ud({level:m,scale:f,resolution:f})),f*=2}return new m0({dpi:96,lods:p,origin:new pt(0,0,s),size:[i,i],spatialReference:s})}const o=d_(s),a=t.origin?new pt({x:t.origin.x,y:t.origin.y,spatialReference:s}):new pt(o?{x:o.origin[0],y:o.origin[1],spatialReference:s}:{x:0,y:0,spatialReference:s}),l=96,c=1/(Za(s)*39.37*l),h=[];if(r)for(let p=0;p<r.length;p++){const f=r[p],m=f*c;h.push(new Ud({level:p,scale:f,resolution:m}))}else{let p=Zpe(s)?512/i*5916575275917094e-7:256/i*591657527591555e-6;const f=Math.ceil(n/e);h.push(new Ud({level:0,scale:p,resolution:p*c}));for(let m=1;m<f;m++){const y=p/2**e,_=y*c;h.push(new Ud({level:m,scale:y,resolution:_})),p=y}}return new m0({dpi:l,lods:h,origin:a,size:[i,i],spatialReference:s})}constructor(t){super(t),this.dpi=96,this.format=null,this.origin=null,this.size=null,this.spatialReference=null}get isWrappable(){const{spatialReference:t,origin:e}=this;if(t&&e){const r=d_(t);return t.isWrappable&&!!r&&Math.abs(r.origin[0]-e.x)<=r.dx}return!1}readOrigin(t,e){return pt.fromJSON({spatialReference:e.spatialReference,...t})}set lods(t){let e=0,r=0;const i=[],s=this._levelToLOD={};t&&(e=-1/0,r=1/0,t.forEach(n=>{i.push(n.scale),e=n.scale>e?n.scale:e,r=n.scale<r?n.scale:r,s[n.level]=n})),this._set("scales",i),this._set("lods",t),this._initializeUpsampleLevels()}readSize(t,e){return[e.cols,e.rows]}writeSize(t,e){e.cols=t[0],e.rows=t[1]}zoomToScale(t){const e=this.scales;if(t<=0)return e[0];if(t>=e.length-1)return e[e.length-1];const r=Math.floor(t),i=r+1;return e[r]/(e[r]/e[i])**(t-r)}scaleToZoom(t){const e=this.scales,r=e.length-1;let i=0;for(;i<r;i++){const s=e[i],n=e[i+1];if(s<=t)return i;if(n===t)return i+1;if(s>t&&n<t)return i+Math.log(s/t)/Math.log(s/n)}return i}snapScale(t,e=.95){const r=this.scaleToZoom(t);return r%Math.floor(r)>=e?this.zoomToScale(Math.ceil(r)):this.zoomToScale(Math.floor(r))}tileAt(t,e,r,i){const s=this.lodAt(t);if(!s)return null;let n,o;if(typeof e=="number")n=e,o=r;else if(Rn(e.spatialReference,this.spatialReference))n=e.x,o=e.y,i=r;else{const c=Sw(e,this.spatialReference);if(c==null)return null;n=c.x,o=c.y,i=r}const a=s.resolution*this.size[0],l=s.resolution*this.size[1];return i||(i=new bXe(null,0,0,0,Ut())),i.level=t,i.row=Math.floor((this.origin.y-o)/l+.001),i.col=Math.floor((n-this.origin.x)/a+.001),this.updateTileInfo(i),i}updateTileInfo(t,e=m0.ExtrapolateOptions.NONE){let r=this.lodAt(t.level);if(!r&&e===m0.ExtrapolateOptions.POWER_OF_TWO){const o=this.lods[this.lods.length-1];o.level<t.level&&(r=o)}if(!r)return;const i=t.level-r.level,s=r.resolution*this.size[0]/2**i,n=r.resolution*this.size[1]/2**i;t.id=`${t.level}/${t.row}/${t.col}`,t.extent||(t.extent=Ut()),t.extent[0]=this.origin.x+t.col*s,t.extent[1]=this.origin.y-(t.row+1)*n,t.extent[2]=t.extent[0]+s,t.extent[3]=t.extent[1]+n}upsampleTile(t){const e=this._upsampleLevels[t.level];return!(!e||e.parentLevel===-1)&&(t.level=e.parentLevel,t.row=Math.floor(t.row/e.factor+.001),t.col=Math.floor(t.col/e.factor+.001),this.updateTileInfo(t),!0)}getTileBounds(t,e){const r=this.lodAt(e.level);if(r==null)return null;const{resolution:i}=r,s=i*this.size[0],n=i*this.size[1];return t[0]=this.origin.x+e.col*s,t[1]=this.origin.y-(e.row+1)*n,t[2]=t[0]+s,t[3]=t[1]+n,t}lodAt(t){return this._levelToLOD?.[t]??null}clone(){return m0.fromJSON(this.write({}))}getOrCreateCompatible(t,e){if(this.size[0]===256&&this.size[1]===256)return t===256?this:null;const r=[],i=this.lods.length;for(let s=0;s<i;s++){const n=this.lods[s],o=n.resolution*e;r.push(new Ud({level:n.level,scale:n.scale,resolution:o}))}return new m0({size:[t,t],dpi:this.dpi,format:this.format,compressionQuality:this.compressionQuality,origin:this.origin,spatialReference:this.spatialReference,lods:r})}_initializeUpsampleLevels(){const t=this.lods;this._upsampleLevels=[];let e=null;for(let r=0;r<t.length;r++){const i=t[r];this._upsampleLevels[i.level]={parentLevel:e?e.level:-1,factor:e?e.resolution/i.resolution:0},e=i}}};u([d({type:Number,json:{write:!0}})],Qo.prototype,"compressionQuality",void 0),u([d({type:Number,json:{write:!0}})],Qo.prototype,"dpi",void 0),u([d({type:String,json:{read:Mre.read,write:Mre.write,origins:{"web-scene":{read:!1,write:!1}}}})],Qo.prototype,"format",void 0),u([d({readOnly:!0})],Qo.prototype,"isWrappable",null),u([d({type:pt,json:{write:!0}})],Qo.prototype,"origin",void 0),u([Ee("origin")],Qo.prototype,"readOrigin",null),u([d({type:[Ud],value:null,json:{write:!0}})],Qo.prototype,"lods",null),u([d({readOnly:!0})],Qo.prototype,"scales",void 0),u([d({cast:t=>Array.isArray(t)?t:typeof t=="number"?[t,t]:[256,256]})],Qo.prototype,"size",void 0),u([Ee("size",["rows","cols"])],Qo.prototype,"readSize",null),u([Fe("size",{cols:{type:Xi},rows:{type:Xi}})],Qo.prototype,"writeSize",null),u([d({type:je,json:{write:!0}})],Qo.prototype,"spatialReference",void 0),Qo=m0=u([R("esri.layers.support.TileInfo")],Qo),function(t){var e;(e=t.ExtrapolateOptions||(t.ExtrapolateOptions={}))[e.NONE=0]="NONE",e[e.POWER_OF_TWO=1]="POWER_OF_TWO"}(Qo||(Qo={}));const GL=Qo,wXe=12;let ac=class cl{constructor(e){const r=cl.checkUnsupported(e);if(r!=null)throw r;const i=e;this.spatialReference=i.spatialReference,this._isWebMercator=this.spatialReference.isWebMercator,this._isGCS=$_(this.spatialReference)||Qf(this.spatialReference)||Kf(this.spatialReference),this.origin=[i.origin.x,i.origin.y],this.pixelSize=i.size[0],this.dpi=i.dpi;const s=i.lods.reduce((c,h,p)=>(h.level<c.min&&(c.min=h.level,c.minIndex=p),c.max=Math.max(c.max,h.level),c),{min:1/0,minIndex:0,max:-1/0}),n=i.lods[s.minIndex],o=2**n.level;let a=n.resolution*o,l=n.scale*o;this.levels=new Array(s.max+1);for(let c=0;c<this.levels.length;c++)this.levels[c]={resolution:a,scale:l,tileSize:[a*i.size[0],a*i.size[1]]},a/=2,l/=2}clone(){return new cl(this.toTileInfo())}toTileInfo(){return new GL({dpi:this.dpi,origin:new pt({x:this.origin[0],y:this.origin[1],spatialReference:this.spatialReference}),size:[this.pixelSize,this.pixelSize],spatialReference:this.spatialReference,lods:this.levels.map((e,r)=>new Ud({level:r,scale:e.scale,resolution:e.resolution}))})}getExtent(e,r,i,s){const n=this.levels[e],o=n.tileSize[0],a=n.tileSize[1];s[0]=this.origin[0]+i*o,s[2]=this.origin[0]+(i+1)*o,s[3]=this.origin[1]-r*a,s[1]=this.origin[1]-(r+1)*a}convertExtentToRadians(e,r){this._isWebMercator?(r[0]=aK(e[0]),r[1]=QD(e[1]),r[2]=aK(e[2]),r[3]=QD(e[3])):this._isGCS&&(r[0]=Dt(e[0]),r[1]=Dt(e[1]),r[2]=Dt(e[2]),r[3]=Dt(e[3]))}getExtentGeometry(e,r,i,s=new _r){return this.getExtent(e,r,i,Tp),s.spatialReference=this.spatialReference,s.xmin=Tp[0],s.ymin=Tp[1],s.xmax=Tp[2],s.ymax=Tp[3],s.zmin=void 0,s.zmax=void 0,s}ensureMaxLod(e){if(e==null)return!1;let r=!1;for(;this.levels.length<=e;){const i=this.levels[this.levels.length-1],s=i.resolution/2;this.levels.push({resolution:s,scale:i.scale/2,tileSize:[s*this.pixelSize,s*this.pixelSize]}),r=!0}return r}capMaxLod(e){this.levels.length>e+1&&(this.levels.length=e+1)}getMaxLod(){return this.levels.length-1}scaleAtLevel(e){return this.levels[0].scale/2**e}levelAtScale(e){const r=this.levels[0].scale;return e>=r?0:Math.log(r/e)*Math.LOG2E}resolutionAtLevel(e){return this.levels[0].resolution/2**e}compatibleWith(e){if(!(e instanceof cl)){if(cl.checkUnsupported(e))return!1;e=new cl(e)}if(!e.spatialReference.equals(this.spatialReference)||e.pixelSize!==this.pixelSize)return!1;const r=Math.min(this.levels.length,e.levels.length)-1,i=this.levels[r].resolution;let s=.5*i;return!xS(e.origin[0],this.origin[0],s)||!xS(e.origin[1],this.origin[1],s)?!1:(s=.5*i/2**r/this.pixelSize*wXe,xS(i,e.levels[r].resolution,s))}rootTilesInExtent(e,r=null,i=1/0){const s=new Array,n=this.levels[0].tileSize;if(e==null||n[0]===0||n[1]===0)return s;cl.computeRowColExtent(e,n,this.origin,Tp);let o=Tp[1],a=Tp[3],l=Tp[0],c=Tp[2];const h=c-l,p=a-o;if(h*p>i){const f=Math.floor(Math.sqrt(i));p>f&&(o=o+Math.floor(.5*p)-Math.floor(.5*f),a=o+f),h>f&&(l=l+Math.floor(.5*h)-Math.floor(.5*f),c=l+f)}for(let f=o;f<a;f++)for(let m=l;m<c;m++)s.push([0,f,m]);return r!=null&&(r[0]=this.origin[0]+l*n[0],r[1]=this.origin[1]-a*n[1],r[2]=this.origin[0]+c*n[0],r[3]=this.origin[1]-o*n[1]),s}static computeRowColExtent(e,r,i,s){const n=.001*(e[2]-e[0]+(e[3]-e[1]));s[0]=Math.max(0,Math.floor((e[0]+n-i[0])/r[0])),s[2]=Math.max(0,Math.ceil((e[2]-n-i[0])/r[0])),s[1]=Math.max(0,Math.floor((i[1]-e[3]+n)/r[1])),s[3]=Math.max(0,Math.ceil((i[1]-e[1]-n)/r[1]))}static isPowerOfTwo(e){const r=e.lods,i=r[0].resolution*2**r[0].level;return!r.some(s=>!oNe(s.resolution,i/2**s.level))}static hasGapInLevels(e){const r=e.lods.map(i=>i.level);r.sort((i,s)=>i-s);for(let i=1;i<r.length;i++)if(r[i]!==r[0]+i)return!0;return!1}static tileSizeSupported(e){const r=e.size[1];return r===e.size[0]&&(r&r-1)==0&&r>=128&&r<=512}static hasOriginPerLODs(e){const r=e.origin;return e.lods.some(i=>i.origin!=null&&(i.origin[0]!==r.x||i.origin[1]!==r.y))}static getMissingTileInfoError(){return new F("tilingscheme:tile-info-missing","Tiling scheme must have tiling information")}static checkUnsupported(e){return e==null?TX():e.lods.length<1?new F("tilingscheme:generic","Tiling scheme must have at least one level"):cl.isPowerOfTwo(e)?cl.hasGapInLevels(e)?new F("tilingscheme:gaps","Tiling scheme levels must not have gaps between min and max level"):cl.tileSizeSupported(e)?cl.hasOriginPerLODs(e)?new F("tilingscheme:multiple-origin","Tiling scheme levels must not have their own origin"):null:new F("tilingscheme:tile-size","Tiles must be square and size must be one of [128, 256, 512]"):new F("tilingscheme:power-of-two","Tiling scheme must be power of two")}static fromExtent(e,r){const i=e[2]-e[0],s=e[3]-e[1],n=Za(r),o=1.2*Math.max(i,s),a=256,l=96,c=.0254,h=new cl(new GL({size:[a,a],origin:new pt({x:e[0]-.5*(o-i),y:e[3]+.5*(o-s)}),lods:[new Ud({level:0,resolution:o/a,scale:1/(a/l*c/(o*n))})],spatialReference:r}));return h.ensureMaxLod(20),h}static makeWebMercatorAuxiliarySphere(e){const r=new cl(cl.WebMercatorAuxiliarySphereTileInfo);return r.ensureMaxLod(e),r}static makeGCSWithTileSize(e,r=256,i=16){const s=256/r,n=new cl(new GL({size:[r,r],origin:new pt({x:-180,y:90,spatialReference:e}),spatialReference:e,lods:[new Ud({level:0,resolution:.703125*s,scale:295497598570834e-6*s})]}));return n.ensureMaxLod(i),n}get test(){return{isWebMercator:this._isWebMercator,isGCS:this._isGCS}}};function TX(){return new F("tilingscheme:tile-info-missing","Tiling scheme must have tiling information")}ac.WebMercatorAuxiliarySphereTileInfo=new GL({size:[256,256],origin:new pt({x:-20037508342787e-6,y:20037508342787e-6,spatialReference:je.WebMercator}),spatialReference:je.WebMercator,lods:[new Ud({level:0,resolution:156543.03392800014,scale:591657527591555e-6})]}),ac.WebMercatorAuxiliarySphere=ac.makeWebMercatorAuxiliarySphere(19);const Tp=Ut(),iS=64,$A=512,xXe=2.5,GO=aNe(SV/10),Wbe=2,Zbe=Ut();ac.WebMercatorAuxiliarySphere.getExtent(0,0,0,Zbe);const TXe=Ut([-180,-90,180,90]),SXe="Cannot extend surface to encompass all layers because it would result in too many root tiles.",EXe="Surface extent is too large for tile resolution at level 0.",CXe=3;let AXe=CXe;function bG(t){return t<4?3:AXe}let g0=class extends os.EventedAccessor{constructor(e){super(e),this.demResolution={min:-1,max:-1},this.noDataValue=GO}initialize(){this.view.basemapTerrain.on("elevation-change",()=>this.emit("changed",{}))}get extent(){const e=this.view.basemapTerrain;if(e==null||e.extent==null||e.spatialReference==null)return null;const r=RF(e.extent,e.spatialReference);return r.zmin=e.visibleElevationBounds.min,r.zmax=e.visibleElevationBounds.max,r}get spatialReference(){return this.view.basemapTerrain?.spatialReference??je.WGS84}elevationAt(e,r){if(this.extent==null||!$a(this.extent,e,r)){const i=this.extent!=null?`${this.extent.xmin}, ${this.extent.ymin}, ${this.extent.xmax}, ${this.extent.ymax}`:null;return Q.getLogger(this).warn("#elevationAt()",`Point used to sample elevation (${e}, ${r}) is outside of the sampler extent (${i})`),this.noDataValue}return this.view.elevationProvider?.getElevation(e,r,0,this.spatialReference,"ground")??this.noDataValue}queryElevation(e){return Hbe(e.clone(),this)}};u([d({readOnly:!0})],g0.prototype,"demResolution",void 0),u([d({readOnly:!0})],g0.prototype,"extent",null),u([d({readOnly:!0})],g0.prototype,"noDataValue",void 0),u([d()],g0.prototype,"spatialReference",null),u([d({constructOnly:!0})],g0.prototype,"view",void 0),g0=u([R("esri.views.support.GroundViewElevationSampler")],g0);const OXe=g0;let y0=class extends Te{constructor(e){super(e),this.view=null,this.layerViews=new Pt}initialize(){this.addHandles(Eh(()=>this.view?.map?.ground,e=>e.load())),this.addHandles(this.layerViews.on("after-changes",()=>this._layerViewsAfterChangesHandler()))}destroy(){this.removeAllHandles(),this._set("view",null);for(const e of this.layerViews)e.destroy();this.layerViews.length=0}get elevationSampler(){return this.view?this.view.type==="2d"?null:this.view.ready&&this.view.basemapTerrain&&this.view.basemapTerrain.ready?new OXe({view:this.view}):null:null}get updating(){return!this.suspended&&this.layerViews.some(e=>e.updating)}get suspended(){return!this.view||this.view.suspended}_layerViewsAfterChangesHandler(){this.removeHandles("updating"),this.addHandles(this.layerViews.map(e=>le(()=>e.updating,()=>this._updateUpdating(),jr)).toArray(),"updating"),this._updateUpdating()}_updateUpdating(){this.notifyChange("updating")}};u([d({readOnly:!0})],y0.prototype,"elevationSampler",null),u([d({type:Boolean,readOnly:!0})],y0.prototype,"updating",null),u([d({constructOnly:!0})],y0.prototype,"view",void 0),u([d({type:Pt,readOnly:!0})],y0.prototype,"layerViews",void 0),u([d({readOnly:!0})],y0.prototype,"suspended",null),y0=u([R("esri.views.GroundView")],y0);const RXe=y0;function Sp(t){return t!=null&&"open"in t&&"declaredClass"in t}function Ire(t){return t!=null&&"declaredClass"in t&&"dockOptions"in t}const PXe=t=>{let e=class extends t{constructor(){super(...arguments),this._popupSetupTask=null,this.popup={},this.popupEnabled=!0}initialize(){this.addHandles([le(()=>[this.ui,this.popup],([r,i],s)=>{const n="popup",o="manual";if(s){const[a,l]=s;a&&Sp(l)&&(l.view=null,Ire(l)&&a.remove(l,n))}r&&Sp(i)&&(i.view=this,Ire(i)&&r.add(i,{key:n,position:o,internal:!0}))},Vr),this.on("click",r=>{this.popup&&this.popupEnabled&&(r.pointerType!=="mouse"||r.button===0)&&(!Sp(this.popup)&&"autoOpenEnabled"in this.popup&&this.popup.autoOpenEnabled===!1||(Sp(this.popup)?this.popup.viewModel.handleViewClick(r):r.async(async()=>{await this.setupPopup(),Sp(this.popup)&&!this.destroyed&&this.ready&&this.popupEnabled&&this.popup.viewModel.handleViewClick(r)})))},m_.WIDGET)]),QS(()=>this.ready&&this.popupEnabled&&!this.updating).then(()=>{ae(()=>import("./Popup-c5162ef6.js").then(r=>r.a0),["./Popup-c5162ef6.js","./Spinner-717ea9e5.js","./unitFormatUtils-b50d8ff8.js","./AttachmentInfo-03d5deea.js","./vmEvent-27fa49b3.js","./uriUtils-6b0395c3.js","./utils-3be18bec.js","./executeQueryJSON-3a003e36.js","./query-2b60d096.js","./normalizeUtils-996b11fe.js","./normalizeUtilsCommon-4aa2ad72.js","./pbfQueryUtils-93c2b136.js","./pbf-725ddaf6.js","./symbolUtils-2e5baa60.js","./colorUtils-c0f43caf.js"],import.meta.url)})}destroy(){this.destroyed||this.closePopup()}async openPopup(r){Sp(this.popup)&&this.popup.open(r);try{if(await this.setupPopup(),!this.popup)return void Q.getLogger(this).error(new F("view:null-popup","Popup is null and can't be opened"));this.popup.open(r)}catch{}}closePopup(){this._popupSetupTask?.abort(),Sp(this.popup)&&this.popup.close()}async fetchPopupFeatures(r,i){await this.when();const{location:s,queryArea:n,layerViewsAndGraphics:o,clientOnlyGraphics:a}=await this._prepareFetchPopupFeatures(r,i),l=Promise.resolve(a),c=this._queryLayerPopupFeatures(n,o,i),h=c.map(p=>p.promise);return{location:s,clientOnlyGraphics:a,allGraphicsPromise:Wk([l,...h]).then(p=>Array.from(new Set(p.flat()))),promisesPerLayerView:c}}async setupPopup(){if(this._popupSetupTask?.abort(),this.popup&&!Sp(this.popup))return this._popupSetupTask=uE(async r=>{const{default:i}=await ae(()=>import("./Popup-c5162ef6.js").then(n=>n.a0),["./Popup-c5162ef6.js","./Spinner-717ea9e5.js","./unitFormatUtils-b50d8ff8.js","./AttachmentInfo-03d5deea.js","./vmEvent-27fa49b3.js","./uriUtils-6b0395c3.js","./utils-3be18bec.js","./executeQueryJSON-3a003e36.js","./query-2b60d096.js","./normalizeUtils-996b11fe.js","./normalizeUtilsCommon-4aa2ad72.js","./pbfQueryUtils-93c2b136.js","./pbf-725ddaf6.js","./symbolUtils-2e5baa60.js","./colorUtils-c0f43caf.js"],import.meta.url);if(Xt(r),!this.popup||Sp(this.popup))return;const s=this.popup;delete s.open,delete s.close,this.popup=new i(s)}),this._popupSetupTask.promise}_queryLayerPopupFeatures(r,i,s){return i.map(({layerView:n,graphics:o})=>{const a={clientGraphics:o,event:s?.event,signal:s?.signal,defaultPopupTemplateEnabled:s!=null&&!!s.defaultPopupTemplateEnabled},l=n.fetchPopupFeatures(r,a);return{layerView:n,promise:l}})}_isValidPopupGraphic(r,i){return r&&!!r.getEffectivePopupTemplate(i!=null&&i.defaultPopupTemplateEnabled)}async _prepareFetchPopupFeatures(r,i){const{clientGraphics:s,queryArea:n,location:o}=await this._popupHitTestGraphics(r,i),a=this._getFetchPopupLayerViews(),{layerViewsAndGraphics:l,clientOnlyGraphics:c}=this._graphicsPerFetchPopupLayerView(s,a);return{clientOnlyGraphics:c,layerViewsAndGraphics:l,queryArea:n,location:o}}async _popupHitTestGraphics(r,i){const s=await this.popupHitTest(r),n=s.results,o=s.mapPoint,a=n.filter(c=>c.type==="graphic"&&this._isValidPopupGraphic(c.graphic,i)),l=a.length?a[0].mapPoint:null;return{clientGraphics:a.map(c=>c.graphic),queryArea:o,location:o||l}}_getFetchPopupLayerViews(){const r=[];return this.allLayerViews.forEach(i=>{this._isValidPopupLayerView(i)&&r.push(i)}),this.graphicsView!=null&&this._isValidPopupLayerView(this.graphicsView)&&r.push(this.graphicsView),r.reverse()}_isValidPopupLayerView(r){return r!=null&&(!("layer"in r)||!r.suspended)&&"fetchPopupFeatures"in r}_graphicsPerFetchPopupLayerView(r,i){const s=[],n=new Map,o=i.map(a=>{const l=[];return"layer"in a?n.set(a.layer,l):n.set(a.graphics,l),{layerView:a,graphics:l}});for(const a of r){const l=n.get(a.layer)||n.get(a.sourceLayer)||null;l?l.push(a):s.push(a)}return{layerViewsAndGraphics:o,clientOnlyGraphics:s}}};return u([d({cast(r){return!r||Sp(r)||typeof r=="object"&&(r.open=i=>(MO(Q.getLogger(this),"view.popup is no longer created by default. view.popup.open() will stop working when the popup isn't created",{replacement:"Use view.openPopup() instead.",version:"4.27"}),this.openPopup(i)),r.close=()=>(MO(Q.getLogger(this),"view.popup is no longer created by default. view.popup.close() will stop working when the popup isn't created",{replacement:"Use view.closePopup() instead.",version:"4.27"}),this.closePopup())),r}})],e.prototype,"popup",void 0),u([d()],e.prototype,"popupEnabled",void 0),e=u([R("esri.views.PopupView")],e),e};let _0=class extends Te{constructor(e){super(e),this.view=null,this.baseLayerViews=new Pt,this.referenceLayerViews=new Pt,this._loadingHandle=le(()=>this.view?.map?.basemap,r=>{r&&r.load().catch(()=>{})},Vr)}destroy(){this._set("view",null),this._loadingHandle&&(this._loadingHandle.remove(),this._loadingHandle=null);for(const e of this.baseLayerViews)e.destroy();this.baseLayerViews.length=0;for(const e of this.referenceLayerViews)e.destroy();this.referenceLayerViews.length=0}get suspended(){return!this.view||this.view.suspended}get updating(){if(this.view&&this.view.suspended)return!1;const e=this.view?.map?.basemap;return!!e&&!!e.loaded&&(this.baseLayerViews.some(r=>r.updating)||this.referenceLayerViews.some(r=>r.updating))}};u([d({constructOnly:!0})],_0.prototype,"view",void 0),u([d({readOnly:!0})],_0.prototype,"baseLayerViews",void 0),u([d({readOnly:!0})],_0.prototype,"referenceLayerViews",void 0),u([d({readOnly:!0})],_0.prototype,"suspended",null),u([d({type:Boolean,readOnly:!0})],_0.prototype,"updating",null),_0=u([R("esri.views.BasemapView")],_0);function MXe(t){return"tryRecycleWith"in t}let IXe=class{constructor(e,r,i){this.layer=e,this.view=r,this.layerViewImporter=i,this._controller=new AbortController,this._deferred=qs(),this._started=!1,this.done=!1,this.promise=this._deferred.promise,nn(this._controller.signal,()=>{const s=new F("cancelled:layerview-create","layerview creation cancelled",{layer:e});this._deferred.reject(s)})}tryRecycle(e){if(!this.done||!this.layerView||!MXe(this.layerView))return null;const r=this.layer.type,i=this._controller.signal;for(let s=0;s<e.length;s++){const n=e[s];if(n.type!==r)continue;const o=this.layerView.tryRecycleWith(n,{signal:i});if(o){e.splice(s,1),this.layer=n;const a=this.layerView,l=a.view;return this.promise=Promise.race([o.then(()=>(Xt(this._controller.signal),n.emit("layerview-destroy",{view:l,layerView:a}),l.emit("layerview-destroy",{view:l,layerView:a}),n.emit("layerview-create",{view:l,layerView:a}),l.emit("layerview-create",{view:l,layerView:a}),a)),new Promise((c,h)=>nn(this._controller.signal,()=>h(Dr())))]),this.promise}}return null}destroy(){this._controller.abort();const{layerView:e}=this;if(e){const{layer:r,view:i}=this;r.emit("layerview-destroy",{view:i,layerView:e}),i.emit("layerview-destroy",{layer:r,layerView:e})}this.done=!0,this.layer=null,this.layerView=null,this.view=null,this.layerViewImporter=null,this._map=null}async start(){if(this._started)return;this._started=!0;const{_controller:{signal:e},layer:r,view:i}=this;this._map=i.map;try{let s,n;if(await r.load({signal:e}),"prefetchResources"in r&&await r.prefetchResources?.({signal:e}),LXe(r))s=await r.createLayerView(i,{signal:e});else{if(!this.layerViewImporter.hasLayerViewModule(r))throw new F("layer:view-not-supported","No layerview implementation was found");const l=await this.layerViewImporter.importLayerView(r);Xt(e),s="default"in l?new l.default({layer:r,view:i}):new l({layer:r,view:i})}const o=()=>{n=Ii(n),s.destroyed||s.destroy(),s.layer=null,s.parent=null,s.view=null,this.done=!0};n=nn(e,o),Xt(e);try{await s.when()}catch(l){throw o(),l}if(!this._map?.allLayers?.includes(r))return o(),void this._deferred.reject(new F("view:no-layerview-for-layer","The layer has been removed from the map",{layer:r}));this.layerView=s,r.emit("layerview-create",{view:i,layerView:s}),i.emit("layerview-create",{layer:r,layerView:s}),this.done=!0,this._deferred.resolve(s)}catch(s){r.emit("layerview-create-error",{view:i,error:s}),i.emit("layerview-create-error",{layer:r,error:s}),this.done=!0,this._deferred.reject(new F("layerview:create-error","layerview creation failed",{layer:r,error:s}))}}},ju=class extends Te{constructor(e){super(e),this._layerLayerViewInfoMap=new Map,this._recyclingInfoMap=new Map,this._watchUpdatingTracking=new Cf,this.supportsGround=!0,this._preloadLayerViewModules=()=>{const r=this.view.map?.allLayers;if(r)for(const i of r)this.layerViewImporter.hasLayerViewModule(i)&&this.layerViewImporter.importLayerView(i)},this._reschedule=()=>this.destroyed?Promise.reject():(this._workPromise==null&&(this._workPromise=qs(),this._workPromise.promise.catch(()=>{})),this.removeHandles("reschedule"),this.addHandles(J2(this._doWork),"reschedule"),this._workPromise.promise),this._doWork=()=>{if(this.destroyed)return;const r=this.view.map;if(this._map!==r&&(this.clear(),this._map=r),this._workPromise==null)return void this.notifyChange("updating");this.removeHandles("reschedule"),this.removeHandles("collection-change");const i=new Set,s=[],n=this.view.ready,o=l=>{if(l!=null){for(const c of l)if(c){i.add(c);const h=this._layerLayerViewInfoMap.get(c);h&&n?h.start():h||this._recyclingInfoMap.has(c)||s.push(c),"layers"in c&&c.layers&&o(c.layers)}}};for(const l of this._rootCollectionNames)o(this.get(l));for(const[l,c]of this._layerLayerViewInfoMap)if(!i.has(l)){this._layerLayerViewInfoMap.delete(c.layer);const h=c.tryRecycle(s);h?(this.notifyChange("updating"),this._recyclingInfoMap.set(c.layer,c),h.then(()=>{this.notifyChange("updating"),this._recyclingInfoMap.delete(c.layer),this._layerLayerViewInfoMap.set(c.layer,c),this._reschedule()}).catch(()=>{this.notifyChange("updating"),this._recyclingInfoMap.delete(c.layer),c.destroy(),this._reschedule()})):c.destroy()}for(const[l,c]of this._recyclingInfoMap)i.has(l)||(this.notifyChange("updating"),this._recyclingInfoMap.delete(c.layer),c.destroy());for(const l of s)this._createLayerView(l);this._refreshCollections();const a=[r?.ground?.layers,r?.basemap?.baseLayers,r?.basemap?.referenceLayers,r?.layers].filter(l=>!!l);i.forEach(l=>"layers"in l&&a.push(l.layers)),this.addHandles(a.map(l=>this._watchUpdatingTracking.addOnCollectionChange(()=>l,this._reschedule)),"collection-change"),this._workPromise.resolve(),this._workPromise=null}}initialize(){this.own([Ga(()=>this.view?.map?.allLayers,"change",this._preloadLayerViewModules,{onListenerAdd:this._preloadLayerViewModules}),le(()=>{const e=this.view,r=e?.map;return[r?.basemap,r?.ground,r?.layers,e?.ready]},()=>this._reschedule(),As)]),this._preloadLayerViewModules(),this._reschedule()}destroy(){this.clear(),FU(this._recyclingInfoMap),FU(this._layerLayerViewInfoMap),this._watchUpdatingTracking.destroy(),this._map=null,this._workPromise!=null&&(this._workPromise.reject(Dr()),this._workPromise=null)}get _layersToLayerViews(){const e=[["view.map.basemap.baseLayers","view.basemapView.baseLayerViews"],["view.map.layers","view.layerViews"],["view.map.basemap.referenceLayers","view.basemapView.referenceLayerViews"]];return this.supportsGround&&e.push(["view.map.ground.layers","view.groundView.layerViews"]),new Map(e)}get _rootCollectionNames(){return Array.from(this._layersToLayerViews.keys())}get updating(){return this._workPromise!=null||this._watchUpdatingTracking.updating||No(this._layerLayerViewInfoMap,e=>!e.done)||this._recyclingInfoMap.size>0}get updatingRemaining(){let e=0;for(const r of this._layerLayerViewInfoMap.values())r.done||++e;return e}clear(){this.destroyed||(FU(this._layerLayerViewInfoMap),this._refreshCollections())}async whenLayerView(e){if(await this._reschedule(),!this._layerLayerViewInfoMap.has(e)){if(this._recyclingInfoMap.has(e))return this._recyclingInfoMap.get(e).promise;throw new F("view:no-layerview-for-layer","No layerview has been found for the layer",{layer:e})}return this._layerLayerViewInfoMap.get(e).promise}_refreshCollections(){for(const[e,r]of this._layersToLayerViews)this._populateLayerViewsOwners(this.get(e),this.get(r),this.view);this.notifyChange("updating"),this.notifyChange("updatingRemaining")}_populateLayerViewsOwners(e,r,i){if(!e||!r)return void(r&&r.removeAll());let s=0;for(const n of e){const o=this._layerLayerViewInfoMap.get(n);if(!o||!o.layerView)continue;const a=o.layerView;a.layer=n,a.parent=i,r.at(s)!==a&&r.splice(s,0,a),n.layers&&this._populateLayerViewsOwners(n.layers,a.layerViews,a),s+=1}s<r.length&&r.splice(s,r.length)}_createLayerView(e){e.load().catch(()=>{}),this.layerViewImporter.hasLayerViewModule(e)&&this.layerViewImporter.importLayerView(e);const r=new IXe(e,this.view,this.layerViewImporter);r.promise.then(()=>this._refreshCollections(),i=>{i&&(ms(i)||i.name==="cancelled:layerview-create")||Q.getLogger(this).error(`Failed to create layerview for layer title:'${e.title??"no title"}', id:'${e.id??"no id"}' of type '${e.type}'.`,{layer:e,error:i}),this._refreshCollections()}),this._layerLayerViewInfoMap.set(e,r),this.view.ready&&r.start(),this.notifyChange("updating"),this.notifyChange("updatingRemaining")}};u([d()],ju.prototype,"_workPromise",void 0),u([d({readOnly:!0})],ju.prototype,"_watchUpdatingTracking",void 0),u([d({readOnly:!0})],ju.prototype,"_layersToLayerViews",null),u([d({readOnly:!0})],ju.prototype,"_rootCollectionNames",null),u([d()],ju.prototype,"layerViewImporter",void 0),u([d()],ju.prototype,"supportsGround",void 0),u([d({readOnly:!0})],ju.prototype,"updating",null),u([d({readOnly:!0})],ju.prototype,"updatingRemaining",null),u([d({constructOnly:!0})],ju.prototype,"view",void 0),ju=u([R("esri.views.LayerViewManager")],ju);const $Xe=ju;function LXe(t){return"createLayerView"in t&&t.createLayerView!=null}let Vc=class extends Te{constructor(e){super(e),this.factor=1.5,this.offset=Ah(0,0),this.position=null,this.size=120,this.maskUrl=null,this.maskEnabled=!0,this.overlayUrl=null,this.overlayEnabled=!0,this.visible=!0}get version(){return this.commitProperty("factor"),this.commitProperty("offset"),this.commitProperty("position"),this.commitProperty("visible"),this.commitProperty("size"),this.commitProperty("maskUrl"),this.commitProperty("maskEnabled"),this.commitProperty("overlayUrl"),this.commitProperty("overlayEnabled"),(this._get("version")||0)+1}};u([d({type:Number})],Vc.prototype,"factor",void 0),u([d({nonNullable:!0})],Vc.prototype,"offset",void 0),u([d()],Vc.prototype,"position",void 0),u([d({type:Number,range:{min:0}})],Vc.prototype,"size",void 0),u([d()],Vc.prototype,"maskUrl",void 0),u([d()],Vc.prototype,"maskEnabled",void 0),u([d()],Vc.prototype,"overlayUrl",void 0),u([d()],Vc.prototype,"overlayEnabled",void 0),u([d({readOnly:!0})],Vc.prototype,"version",null),u([d({type:Boolean})],Vc.prototype,"visible",void 0),Vc=u([R("esri.views.Magnifier")],Vc);const Xbe=Vc;let DXe=class{constructor(){this._tasks=new Array,this._running=kO(!1)}get length(){return this._tasks.length}get running(){return this._running.value}destroy(){this.cancelAll()}runTask(e){for(;!e.done&&this._process(e);)e.madeProgress()}push(e,r,i){return this._running.value=!0,new Promise((s,n)=>this._tasks.push(new $re(s,n,e,r,i)))}unshift(e,r,i){return this._running.value=!0,new Promise((s,n)=>this._tasks.unshift(new $re(s,n,e,r,i)))}_process(e){if(this._tasks.length===0)return!1;const r=this._tasks.shift();try{const i=sn(r.signal);if(i&&!r.abortCallback)r.reject(Dr());else{const s=i?r.abortCallback?.(Dr()):r.callback(e);bu(s)?s.then(r.resolve,r.reject):r.resolve(s)}}catch(i){r.reject(i)}return this._running.value=this._tasks.length>0,!0}cancelAll(){const e=Dr();for(const r of this._tasks)if(r.abortCallback){const i=r.abortCallback(e);r.resolve(i)}else r.reject(e);this._tasks.length=0,this._running.value=!1}},$re=class{constructor(e,r,i,s=void 0,n=void 0){this.resolve=e,this.reject=r,this.callback=i,this.signal=s,this.abortCallback=n}},LA=class extends Te{constructor(){super(...arguments),this.SCHEDULER_LOG_SLOW_TASKS=!1,this.FEATURE_SERVICE_SNAPPING_SOURCE_TILE_TREE_SHOW_TILES=!1}};u([d()],LA.prototype,"SCHEDULER_LOG_SLOW_TASKS",void 0),u([d()],LA.prototype,"FEATURE_SERVICE_SNAPPING_SOURCE_TILE_TREE_SHOW_TILES",void 0),LA=u([R("esri.views.support.DebugFlags")],LA);const NXe=new LA;var $r;(function(t){t[t.ANIMATING=0]="ANIMATING",t[t.INTERACTING=1]="INTERACTING",t[t.IDLE=2]="IDLE"})($r||($r={}));function FXe(){return new QN.Scheduler}var jo,dt;(function(t){t[t.YIELD=1]="YIELD"})(jo||(jo={})),function(t){t.RESOURCE_CONTROLLER_IMMEDIATE="immediate",t.RESOURCE_CONTROLLER="schedule",t.SLIDE="slide",t.STREAM_DATA_LOADER="stream loader",t.ELEVATION_QUERY="elevation query",t.TERRAIN_SURFACE="terrain",t.SURFACE_GEOMETRY_UPDATES="surface geometry updates",t.LOD_RENDERER="LoD renderer",t.GRAPHICS_CORE="Graphics3D",t.I3S_CONTROLLER="I3S",t.POINT_CLOUD_LAYER="point cloud",t.FEATURE_TILE_FETCHER="feature fetcher",t.OVERLAY="overlay",t.STAGE="stage",t.GRAPHICS_DECONFLICTOR="graphics deconflictor",t.FILTER_VISIBILITY="Graphics3D filter visibility",t.SCALE_VISIBILITY="Graphics3D scale visibility",t.FRUSTUM_VISIBILITY="Graphics3D frustum visibility",t.POINT_OF_INTEREST_FREQUENT="POI frequent",t.POINT_OF_INTEREST_INFREQUENT="POI infrequent",t.LABELER="labeler",t.FEATURE_QUERY_ENGINE="feature query",t.FEATURE_TILE_TREE="feature tile tree",t.FEATURE_TILE_TREE_ACTIVE="fast feature tile tree",t.ELEVATION_ALIGNMENT="elevation alignment",t.TEXT_TEXTURE_ATLAS="text texture atlas",t.TEXTURE_UNLOAD="texture unload",t.LINE_OF_SIGHT_TOOL="line of sight tool",t.LINE_OF_SIGHT_TOOL_INTERACTIVE="interactive line of sight tool",t.ELEVATION_PROFILE="elevation profile",t.SNAPPING="snapping",t.SHADOW_ACCUMULATOR="shadow accumulator",t.CLOUDS_GENERATOR="clouds generator",t[t.NONE=0]="NONE",t[t.TEST_PRIO=1]="TEST_PRIO"}(dt||(dt={}));const hf=0,Lre=new Map([[dt.RESOURCE_CONTROLLER_IMMEDIATE,hf],[dt.RESOURCE_CONTROLLER,4],[dt.SLIDE,hf],[dt.STREAM_DATA_LOADER,hf],[dt.ELEVATION_QUERY,hf],[dt.TERRAIN_SURFACE,1],[dt.SURFACE_GEOMETRY_UPDATES,1],[dt.LOD_RENDERER,2],[dt.GRAPHICS_CORE,2],[dt.I3S_CONTROLLER,2],[dt.POINT_CLOUD_LAYER,2],[dt.FEATURE_TILE_FETCHER,2],[dt.OVERLAY,4],[dt.STAGE,4],[dt.GRAPHICS_DECONFLICTOR,4],[dt.FILTER_VISIBILITY,4],[dt.SCALE_VISIBILITY,4],[dt.FRUSTUM_VISIBILITY,4],[dt.CLOUDS_GENERATOR,4],[dt.POINT_OF_INTEREST_FREQUENT,6],[dt.POINT_OF_INTEREST_INFREQUENT,30],[dt.LABELER,8],[dt.FEATURE_QUERY_ENGINE,8],[dt.FEATURE_TILE_TREE,16],[dt.FEATURE_TILE_TREE_ACTIVE,hf],[dt.ELEVATION_ALIGNMENT,12],[dt.TEXT_TEXTURE_ATLAS,12],[dt.TEXTURE_UNLOAD,12],[dt.LINE_OF_SIGHT_TOOL,16],[dt.LINE_OF_SIGHT_TOOL_INTERACTIVE,hf],[dt.SNAPPING,hf],[dt.SHADOW_ACCUMULATOR,30]]);function Dre(t){return Lre.has(t)?Lre.get(t):typeof t=="number"?t:1}const Nre=6.5,Fre=1,UXe=30,Ure=1e3/30,kre=100,Vre=.9;var QN,mv;(function(t){class e{get updating(){return this._updating.value}_updatingChanged(){this._updating.value=this._tasks.some(n=>n.needsUpdate)}constructor(){this._updating=kO(!0),this._microTaskQueued=!1,this._frameNumber=0,this.performanceInfo={total:new pg("total"),tasks:new Map},this._frameTaskTimes=new Map,this._budget=new i,this._state=$r.INTERACTING,this._tasks=new kt,this._runQueue=new kt,this._load=0,this._idleStateCallbacks=new kt,this._idleUpdatesStartFired=!1,this._forceTask=!1,this._debug=!1,this._debugHandle=le(()=>NXe.SCHEDULER_LOG_SLOW_TASKS,o=>this._debug=o,Vr);for(const o of Object.keys(dt))this.performanceInfo.tasks.set(dt[o],new pg(dt[o]));const n=this;this._test={FRAME_SAFETY_BUDGET:Nre,INTERACTING_BUDGET:Ure,IDLE_BUDGET:kre,get availableBudget(){return n._budget.budget},usedBudget:0,getBudget:()=>n._budget,setBudget:o=>n._budget=o,updateTask:o=>this._updateTask(o),getState:o=>this._getState(o),getRuntime:o=>this._getRuntime(o),frameTaskTimes:this._frameTaskTimes,resetRuntimes:()=>this._resetRuntimes(),getRunning:()=>this._getRunning()}}destroy(){this._tasks.toArray().forEach(n=>n.remove()),this._tasks.clear(),Ii(this._debugHandle),this._microTaskQueued=!1,this._updatingChanged()}taskRunningChanged(n){this._updatingChanged(),n&&this._budget.remaining>0&&!this._microTaskQueued&&(this._microTaskQueued=!0,queueMicrotask(()=>{this._microTaskQueued&&(this._microTaskQueued=!1,this._budget.remaining>0&&this._schedule()&&this.frame())}))}registerTask(n,o){const a=Dre(n),l=new r(this,n,o,a);return this._tasks.push(l),this._updatingChanged(),this.performanceInfo.tasks.has(n)||this.performanceInfo.tasks.set(n,new pg(n)),l}registerIdleStateCallbacks(n,o){const a={idleBegin:n,idleEnd:o};this._idleStateCallbacks.push(a),this.state===$r.IDLE&&this._idleUpdatesStartFired&&a.idleBegin();const l=this;return{remove:()=>this._removeIdleStateCallbacks(a),set idleBegin(c){l._idleUpdatesStartFired&&(a.idleEnd(),l._state===$r.IDLE&&c()),a.idleBegin=c},set idleEnd(c){a.idleEnd=c}}}get load(){return this._load}set state(n){this._state!==n&&(this._state=n,this.state!==$r.IDLE&&this._idleUpdatesStartFired&&(this._idleUpdatesStartFired=!1,this._idleStateCallbacks.forAll(o=>o.idleEnd())))}get state(){return this._state}updateBudget(n){this._test.usedBudget=0,++this._frameNumber;let o=Nre,a=n.frameDuration,l=Fre;switch(this.state){case $r.IDLE:o=0,a=Math.max(kre,n.frameDuration),l=UXe;break;case $r.INTERACTING:a=Math.max(Ure,n.frameDuration);case $r.ANIMATING:}return a=a-n.elapsedFrameTime-o,this.state!==$r.IDLE&&a<Fre&&!this._forceTask?(this._forceTask=!0,!1):(a=Math.max(a,l),this._budget.reset(a,this.state),this._updateLoad(),this._schedule())}frame(){switch(this._forceTask=!1,this._microTaskQueued=!1,this.state){case $r.IDLE:this._idleUpdatesStartFired||(this._idleUpdatesStartFired=!0,this._idleStateCallbacks.forAll(n=>n.idleBegin())),this._runIdle();break;case $r.INTERACTING:this._runInteracting();break;default:this._runAnimating()}this._test.usedBudget=this._budget.elapsed}stopFrame(){this._budget.reset(0,this._state),this._budget.madeProgress()}_removeIdleStateCallbacks(n){this._idleUpdatesStartFired&&n.idleEnd(),this._idleStateCallbacks.removeUnordered(n)}removeTask(n){this._tasks.removeUnordered(n),this._runQueue.removeUnordered(n),this._updatingChanged()}_updateTask(n){this._tasks.forAll(o=>{o.name===n&&o.setPriority(n)})}_getState(n){if(this._runQueue.some(a=>a.name===n))return mv.SCHEDULED;let o=mv.IDLE;return this._tasks.forAll(a=>{a.name===n&&a.needsUpdate&&(a.schedulePriority<=1?o=mv.READY:o!==mv.READY&&(o=mv.WAITING))}),o}_getRuntime(n){let o=0;return this._tasks.forAll(a=>{a.name===n&&(o+=a.runtime)}),o}_resetRuntimes(){this._tasks.forAll(n=>n.runtime=0)}_getRunning(){const n=new Map;if(this._tasks.forAll(a=>{a.needsUpdate&&n.set(a.name,(n.get(a.name)||0)+1)}),n.size===0)return null;let o="";return n.forEach((a,l)=>{o+=a>1?` ${a}x ${l}`:` ${l}`}),o}_runIdle(){this._run()}_runInteracting(){this._run()}_runAnimating(){this._run()}_updateLoad(){const n=this._tasks.reduce((o,a)=>a.needsUpdate?++o:o,0);this._load=this._load*Vre+n*(1-Vre)}_schedule(){for(this._runQueue.filterInPlace(n=>!!n.needsUpdate||(n.schedulePriority=n.basePriority,!1)),this._tasks.forAll(n=>{n.basePriority===hf&&n.needsUpdate&&!this._runQueue.includes(n)&&n.blockFrame!==this._frameNumber&&this._runQueue.unshift(n)});this._runQueue.length===0;){let n=!1,o=0;if(this._tasks.forAll(a=>{a.needsUpdate&&a.schedulePriority!==0&&a.basePriority!==hf&&a.blockFrame!==this._frameNumber&&(n=!0,o=Math.max(o,a.basePriority),a.schedulePriority===1?(a.schedulePriority=0,this._runQueue.push(a)):--a.schedulePriority)}),!n)return this._updatingChanged(),!1}return this._updatingChanged(),!0}_run(){const n=this._budget.now();this._startFrameTaskTimes();do for(;this._runQueue.length>0;){const o=this._budget.now(),a=this._runQueue.pop();this._budget.resetProgress();try{a.task.runTask(this._budget)===jo.YIELD&&(a.blockFrame=this._frameNumber)}catch(c){Q.getLogger("esri.views.support.Scheduler").error(`Exception in task "${a.name}"`,c)}!this._budget.hasProgressed&&a.blockFrame!==this._frameNumber&&a.needsUpdate&&(a.name,dt.I3S_CONTROLLER,a.blockFrame=this._frameNumber),a.schedulePriority=a.basePriority;const l=this._budget.now()-o;if(a.runtime+=l,this._frameTaskTimes.set(a.priority,this._frameTaskTimes.get(a.priority)+l),this._debug&&l>2*this._budget.budget&&console.log("Task",a.name,"used",l,"of max",this._budget.budget,"ms"),this._budget.remaining<=0)return this._updatingChanged(),void this._recordFrameTaskTimes(this._budget.now()-n)}while(this._schedule());this._updatingChanged(),this._recordFrameTaskTimes(this._budget.now()-n)}_startFrameTaskTimes(){for(const n of Object.keys(dt))this._frameTaskTimes.set(dt[n],0)}_recordFrameTaskTimes(n){this._frameTaskTimes.forEach((o,a)=>this.performanceInfo.tasks.get(a).record(o)),this.performanceInfo.total.record(n)}get test(){return this._test}}t.Scheduler=e;class r{get task(){return this._task.value}get updating(){return this._queue.running}constructor(n,o,a,l){this._scheduler=n,this.name=o,this._basePriority=l,this.blockFrame=0,this.runtime=0,this._queue=new DXe,this._handles=new Oi,this.schedulePriority=this._basePriority,this._task=kO(a??this._queue),this._handles.add(Eh(()=>this.task.running,c=>n.taskRunningChanged(c)))}remove(){this.processQueue(za),this._scheduler.removeTask(this),this.schedule=x2.schedule,this.reschedule=x2.reschedule,this._handles.destroy()}get basePriority(){return this._basePriority}setPriority(n){this.name=n;const o=Dre(n);this._basePriority!==hf&&this.schedulePriority===0||(this.schedulePriority=o),this._basePriority=o}get priority(){return this.name}set priority(n){this.setPriority(n)}get needsUpdate(){return this.updating||this.task.running}schedule(n,o,a){return this._queue.push(n,o,a)}reschedule(n,o,a){return this._queue.unshift(n,o,a)}processQueue(n){this._queue.runTask(n)}}class i{constructor(){this._begin=typeof performance<"u"?performance.now():0,this._budget=0,this._state=$r.IDLE,this._done=!1,this._progressed=!1,this._enabled=!0}run(n){return!this.done&&(n()===!0&&this.madeProgress(),!0)}get done(){return this._done}get budget(){return this._budget}madeProgress(){return this._progressed=!0,this._done=this.elapsed>=this._budget&&this._enabled,this._done}get state(){return this._state}get enabled(){return this._enabled}set enabled(n){this._enabled=n}reset(n,o){this._begin=this.now(),this._budget=n,this._state=o,this.resetProgress()}get remaining(){return Math.max(this._budget-this.elapsed,0)}now(){return performance.now()}get elapsed(){return performance.now()-this._begin}resetProgress(){this._progressed=!1,this._done=!1}get hasProgressed(){return this._progressed}}t.Budget=i})(QN||(QN={})),function(t){t.SCHEDULED="s",t.READY="r",t.WAITING="w",t.IDLE="i"}(mv||(mv={}));const za=(()=>{const t=new QN.Budget;return t.enabled=!1,t})();let kXe=class{remove(){}processQueue(){}schedule(e,r,i){try{if(sn(r)){const s=Dr();return i?Promise.resolve(i(s)):Promise.reject(s)}return Zk(e(za))}catch(s){return Promise.reject(s)}}reschedule(e,r,i){return this.schedule(e,r,i)}};const x2=new kXe;let sS=class extends Te{constructor(e,r){super({}),this._stage=e,this._textureRequests=new Map,this._frameTask=r?.registerTask(dt.TEXTURE_UNLOAD)??x2}normalizeCtorArgs(){return{}}destroy(){super.destroy(),this._frameTask?.remove(),this._textureRequests?.forEach(e=>this._releaseTextureRequest(e)),this._textureRequests?.clear()}get updating(){return this._frameTask.updating}fromData(e,r,i){const s=this.makeUid(e);let n=this._textureRequests.get(s);if(!n){const o=new Ybe(i);o.texture=r(),this._stage?.add(o.texture),this._stage?.loadImmediate(o.texture),this._textureRequests.set(s,o),n=o}return n.referenceCount++,{uid:s,texture:n.texture,release:()=>this._release(s)}}_release(e){const r=this._textureRequests.get(e);r?(r.referenceCount<1&&console.warn("TextureCollection: reference count is < 1 for "+e),r.referenceCount--,r.referenceCount<1&&this._frameTask.schedule(()=>this._releaseNow(e))):console.warn(`TextureCollection: texture doesn't exist: '${e}'`)}get test(){return{textureRequests:this._textureRequests}}_releaseNow(e){if(!this._textureRequests)return;const r=this._textureRequests.get(e);!r||r.referenceCount>0||(this._releaseTextureRequest(r),this._textureRequests.delete(e))}_releaseTextureRequest(e){e.onRemove&&e.onRemove(),e.texture?this._stage?.remove(e.texture):e.abortController&&(e.abortController.abort(),e.abortController=null)}makeUid(e,r=null){return r!=null?`${e}.${r}px`:e}};u([d()],sS.prototype,"_frameTask",void 0),u([d()],sS.prototype,"updating",null),sS=u([R("esri.views.3d.support.TextureCollection")],sS);let Ybe=class{constructor(e){this.onRemove=e,this.referenceCount=0}};var zre;(function(t){t[t.Left=0]="Left",t[t.Middle=1]="Middle",t[t.Right=2]="Right"})(zre||(zre={}));const Jbe=["click","double-click","immediate-click","immediate-double-click","hold","drag","key-down","key-up","pointer-down","pointer-move","pointer-up","pointer-drag","mouse-wheel","pointer-enter","pointer-leave","gamepad","focus","blur"],Qbe={};function Kbe(t){return!!Qbe[t]}function VXe(t){for(const e of t)if(!Kbe(e))return!1;return!0}Jbe.forEach(t=>{Qbe[t]=!0});let zXe=class{constructor(e){this._handlers=new Map,this._counter=0,this._handlerCounts=new Map,this.view=e,this.inputManager=null}connect(e){e&&this.disconnect(),this.inputManager=e,this._handlers.forEach(({handler:r,priority:i},s)=>this.inputManager?.installHandlers(s,[r],i))}disconnect(){this.inputManager&&this._handlers.forEach((e,r)=>this.inputManager?.uninstallHandlers(r)),this.inputManager=null}destroy(){this.disconnect(),this._handlers.clear(),this.view=null}on(e,r,i,s){const n=Array.isArray(e)?e:e.split(",");if(!VXe(n))return n.some(Kbe)&&console.error("Error: registering input events and other events on the view at the same time is not supported."),null;let o,a;Array.isArray(r)?a=r:(o=r,a=[]),typeof i=="function"?o=i:s=i,s=s??m_.DEFAULT;const l=this._createUniqueGroupName(),c=new BXe(this.view,n,a,o);this._handlers.set(l,{handler:c,priority:s});for(const h of n){const p=this._handlerCounts.get(h)||0;this._handlerCounts.set(h,p+1)}return this.inputManager&&this.inputManager.installHandlers(l,[c],s),{remove:()=>this._removeHandler(l,n)}}hasHandler(e){return!!this._handlerCounts.get(e)}_removeHandler(e,r){if(this._handlers.has(e)){this._handlers.delete(e);for(const i of r){const s=this._handlerCounts.get(i);s===void 0?console.error("Trying to remove handler for event that has no handlers registered: ",i):s===1?this._handlerCounts.delete(i):this._handlerCounts.set(i,s-1)}}this.inputManager&&this.inputManager.uninstallHandlers(e)}_createUniqueGroupName(){return this._counter+=1,`viewEvents_${this._counter}`}},BXe=class extends To{constructor(e,r,i,s){super(!0),this._latestDragStart=void 0,this.view=e;for(const n of r)switch(n){case"click":this.registerIncoming("click",i,o=>s(this._wrapClick(o)));break;case"double-click":this.registerIncoming("double-click",i,o=>s(this._wrapDoubleClick(o)));break;case"immediate-click":this.registerIncoming("immediate-click",i,o=>s(this._wrapImmediateClick(o)));break;case"immediate-double-click":this.registerIncoming("immediate-double-click",i,o=>s(this._wrapImmediateDoubleClick(o)));break;case"hold":this.registerIncoming("hold",i,o=>s(this._wrapHold(o)));break;case"drag":this.registerIncoming("drag",i,o=>{const a=this._wrapDrag(o);a&&s(a)});break;case"key-down":this.registerIncoming("key-down",i,o=>s(this._wrapKeyDown(o)));break;case"key-up":this.registerIncoming("key-up",i,o=>s(this._wrapKeyUp(o)));break;case"pointer-down":this.registerIncoming("pointer-down",i,o=>s(this._wrapPointer(o,"pointer-down")));break;case"pointer-move":this.registerIncoming("pointer-move",i,o=>s(this._wrapPointer(o,"pointer-move")));break;case"pointer-up":this.registerIncoming("pointer-up",i,o=>s(this._wrapPointer(o,"pointer-up")));break;case"pointer-drag":this.registerIncoming("pointer-drag",i,o=>s(this._wrapPointerDrag(o)));break;case"mouse-wheel":this.registerIncoming("mouse-wheel",i,o=>s(this._wrapMouseWheel(o)));break;case"pointer-enter":this.registerIncoming("pointer-enter",i,o=>s(this._wrapPointer(o,"pointer-enter")));break;case"pointer-leave":this.registerIncoming("pointer-leave",i,o=>s(this._wrapPointer(o,"pointer-leave")));break;case"gamepad":this.registerIncoming("gamepad",i,o=>{s(this._wrapGamepad(o))});break;case"focus":this.registerIncoming("focus",i,o=>{s(this._wrapFocus(o))});break;case"blur":this.registerIncoming("blur",i,o=>{s(this._wrapBlur(o))})}}_wrapFocus(e){return{type:"focus",timestamp:e.timestamp,native:e.data.native,cancelable:e.cancelable,stopPropagation:()=>e.stopPropagation(),async:r=>e.async(r),preventDefault:()=>e.preventDefault()}}_wrapBlur(e){return{type:"blur",timestamp:e.timestamp,native:e.data.native,cancelable:e.cancelable,stopPropagation:()=>e.stopPropagation(),async:r=>e.async(r),preventDefault:()=>e.preventDefault()}}_wrapClick(e){const{pointerType:r,button:i,buttons:s,x:n,y:o,native:a,eventId:l}=e.data,{cancelable:c,timestamp:h}=e;return{type:"click",pointerType:r,button:i,buttons:s,x:n,y:o,native:a,timestamp:h,screenPoint:Ah(n,o),mapPoint:this._getMapPoint(n,o),eventId:l,cancelable:c,stopPropagation:()=>e.stopPropagation(),async:p=>e.async(p),preventDefault:()=>e.preventDefault()}}_wrapDoubleClick(e){const{pointerType:r,button:i,buttons:s,x:n,y:o,native:a,eventId:l}=e.data,{cancelable:c,timestamp:h}=e;return{type:"double-click",pointerType:r,button:i,buttons:s,x:n,y:o,native:a,timestamp:h,mapPoint:this._getMapPoint(n,o),eventId:l,cancelable:c,stopPropagation:()=>e.stopPropagation(),async:p=>e.async(p),preventDefault:()=>e.preventDefault()}}_wrapImmediateClick(e){const{pointerType:r,button:i,buttons:s,x:n,y:o,native:a,eventId:l}=e.data,c=a.pointerId,{cancelable:h,timestamp:p}=e;return{type:"immediate-click",pointerId:c,pointerType:r,button:i,buttons:s,x:n,y:o,native:a,timestamp:p,mapPoint:this._getMapPoint(n,o),eventId:l,cancelable:h,stopPropagation:()=>e.stopPropagation(),async:f=>e.async(f),preventDefault:()=>e.preventDefault()}}_wrapImmediateDoubleClick(e){const{pointerType:r,button:i,buttons:s,x:n,y:o,native:a,eventId:l}=e.data,c=a.pointerId,{cancelable:h,timestamp:p}=e;return{type:"immediate-double-click",pointerId:c,pointerType:r,button:i,buttons:s,x:n,y:o,native:a,timestamp:p,mapPoint:this._getMapPoint(n,o),eventId:l,cancelable:h,stopPropagation:()=>e.stopPropagation(),async:f=>e.async(f),preventDefault:()=>e.preventDefault()}}_wrapHold(e){const{pointerType:r,button:i,buttons:s,x:n,y:o,native:a}=e.data,{cancelable:l,timestamp:c}=e;return{type:"hold",pointerType:r,button:i,buttons:s,x:n,y:o,native:a,timestamp:c,mapPoint:this._getMapPoint(n,o),cancelable:l,stopPropagation:()=>e.stopPropagation(),async:h=>e.async(h),preventDefault:()=>e.preventDefault()}}_getMapPoint(e,r){return this.view.toMap(Ah(e,r),{exclude:[]})}_wrapDrag(e){const r=e.data,{x:i,y:s}=r.center,{action:n,pointerType:o,button:a}=r;if(n==="start"&&(this._latestDragStart=r),!this._latestDragStart)return;const l=r.pointer.native,c=r.buttons,{cancelable:h,timestamp:p}=e,f={x:this._latestDragStart.center.x,y:this._latestDragStart.center.y};return n==="end"&&(this._latestDragStart=void 0),{type:"drag",action:n,x:i,y:s,origin:f,pointerType:o,button:a,buttons:c,radius:r.radius,angle:qa(r.angle),native:l,timestamp:p,cancelable:h,stopPropagation:()=>e.stopPropagation(),async:m=>e.async(m),preventDefault:()=>e.preventDefault()}}_wrapKeyDown(e){const{key:r,repeat:i,native:s}=e.data,{cancelable:n,timestamp:o}=e;return{type:"key-down",key:r,repeat:i,native:s,timestamp:o,cancelable:n,stopPropagation:()=>e.stopPropagation(),async:a=>e.async(a),preventDefault:()=>e.preventDefault()}}_wrapKeyUp(e){const{key:r,native:i}=e.data,{cancelable:s,timestamp:n}=e;return{type:"key-up",key:r,native:i,timestamp:n,cancelable:s,stopPropagation:()=>e.stopPropagation(),async:o=>e.async(o),preventDefault:()=>e.preventDefault()}}_wrapPointer(e,r){const{x:i,y:s,button:n,buttons:o,native:a,eventId:l}=e.data,c=a.pointerId,h=a.pointerType,{cancelable:p,timestamp:f}=e;return{type:r,x:i,y:s,pointerId:c,pointerType:h,button:n,buttons:o,native:a,timestamp:f,eventId:l,cancelable:p,stopPropagation:()=>e.stopPropagation(),async:m=>e.async(m),preventDefault:()=>e.preventDefault()}}_wrapPointerDrag(e){const{x:r,y:i,buttons:s,native:n,eventId:o}=e.data.currentEvent,{button:a}=e.data.startEvent,l=e.data.startEvent.native.pointerId,c=e.data.startEvent.native.pointerType,h=e.data.action,p={x:e.data.startEvent.x,y:e.data.startEvent.y},{cancelable:f,timestamp:m}=e;return{type:"pointer-drag",x:r,y:i,pointerId:l,pointerType:c,button:a,buttons:s,action:h,origin:p,native:n,timestamp:m,eventId:o,cancelable:f,stopPropagation:()=>e.stopPropagation(),async:y=>e.async(y),preventDefault:()=>e.preventDefault()}}_wrapMouseWheel(e){const{cancelable:r,data:i,timestamp:s}=e,{x:n,y:o,deltaY:a,native:l}=i;return{type:"mouse-wheel",x:n,y:o,deltaY:a,native:l,timestamp:s,cancelable:r,stopPropagation:()=>e.stopPropagation(),async:c=>e.async(c),preventDefault:()=>e.preventDefault()}}_wrapGamepad(e){const{action:r,state:i,device:s}=e.data,{cancelable:n,timestamp:o}=e,{buttons:a,axes:l}=i;return{type:"gamepad",device:s,timestamp:o,action:r,buttons:a,axes:l,cancelable:n,stopPropagation:()=>e.stopPropagation(),async:c=>e.async(c),preventDefault:()=>e.preventDefault()}}};var jO,Bre,Gre;(function(t){t[t.USER=0]="USER",t[t.MANAGER=1]="MANAGER"})(jO||(jO={})),function(t){t[t.None=0]="None",t[t.Unfocused=1]="Unfocused",t[t.Focused=2]="Focused",t[t.Unselected=4]="Unselected",t[t.Selected=8]="Selected",t[t.All=15]="All"}(Bre||(Bre={})),function(t){t[t.None=0]="None",t[t.Custom1=16]="Custom1",t[t.Custom2=32]="Custom2",t[t.Custom3=64]="Custom3",t[t.Custom4=128]="Custom4",t[t.Custom5=256]="Custom5",t[t.Custom6=512]="Custom6",t[t.Custom7=1024]="Custom7",t[t.Custom8=2048]="Custom8",t[t.Custom9=4096]="Custom9",t[t.Custom10=8192]="Custom10",t[t.Custom11=16384]="Custom11",t[t.Custom12=32768]="Custom12",t[t.All=65520]="All"}(Gre||(Gre={}));function GXe(t){return[t.on("before-add",e=>{const r=e.item;if(r==null||t.includes(r))return Q.getLogger("esri.views.interactive.interactiveToolUtils").warn("Tool is either already in the list of tools or tool is `null`. Not adding tool."),void e.preventDefault();r.onAdd()}),t.on("after-remove",e=>{const r=e.item;r.active&&(r.view.activeTool=null),r.destroy()})]}function wG(t){return t.visible&&t.getEditableFlag!=null&&t.getEditableFlag(jO.USER)&&t.getEditableFlag(jO.MANAGER)}let jXe=class{constructor(){this._pointerLocations=new Map,this._hoveredManipulators=new Map,this._grabbedManipulators=new Map,this._draggedManipulators=new Map,this._stopDrag=!1,this._revertToNullActiveTool=!1,this._cursor=null}get cursor(){return this._cursor}hasFocusedManipulators(){return this._grabbedManipulators.size>0||this._draggedManipulators.size>0}handleInputEvent(e,r){const i=()=>e.stopPropagation();switch(e.type){case"pointer-move":jre(e.pointerType)&&this._pointerLocations.set(e.pointerId,{x:e.x,y:e.y,pointerType:e.pointerType});break;case"drag":this._grabbedManipulators.size>0&&(this._stopDrag=!0),this._stopDrag&&(i(),e.action==="end"&&(this._stopDrag=!1));break;case"pointer-down":{if(!Hre(e))break;const s=Xp(e),n=this._intersect(s,e.pointerType,r.forEachTool);if(n==null)break;const o=n.manipulator,a=n.tool;o==null||a==null||!o.interactive||o.grabbable&&o.grabbableForEvent(e)||!o.grabbing||o.dragging||this._ungrabManipulatorBeforeDragging(o,e,r),o!=null&&a!=null&&o.interactive&&o.grabbable&&o.grabbableForEvent(e)&&!o.grabbing&&(this._grabbedManipulators.set(e.pointerId,{manipulator:o,tool:a,start:s,pointerType:e.pointerType}),this._grabbedManipulators.size===1&&r.activeTool==null&&(this._revertToNullActiveTool=!0,r.setActiveTool(n.tool)),o.grabbing=!0,o.events.emit("grab-changed",{action:"start",pointerType:e.pointerType,screenPoint:s}),i());break}case"pointer-up":this._draggedManipulators.has(e.pointerId)||this._handlePointerEnd(e,r);break;case"pointer-drag":{if(!Hre(e))break;const s=this._grabbedManipulators.get(e.pointerId),n=uc(s,({manipulator:h})=>h),o=uc(s,({tool:h})=>h);if(n==null||o==null)break;const a=Xp(e);a.x=ge(a.x,0,r.view.width),a.y=ge(a.y,0,r.view.height);const l=s.start,c=this._draggedManipulators.get(e.pointerId);switch(e.action){case"start":case"update":e.action!=="update"&&this._grabbedManipulators.size!==1||(n.dragging=!0,c?n.events.emit("drag",{action:"update",start:l,screenPoint:a}):n.events.emit("drag",{action:"start",start:l,screenPoint:a,pointerType:e.pointerType}),this._draggedManipulators.set(e.pointerId,{tool:o,manipulator:n,start:l}));break;case"end":n.dragging=!1,c&&n.events.emit("drag",{action:"end",start:l,screenPoint:a}),this._draggedManipulators.delete(e.pointerId),this._handlePointerEnd(e,r)}i();break}case"immediate-click":{const s=Xp(e),n=this._intersect(s,e.pointerType,r.forEachTool);if(HXe(e)||r.forEachTool(c=>{if((n==null||n.tool!==c||c.automaticManipulatorSelection)&&c.manipulators){let h=!1;c.manipulators.forEach(({manipulator:p})=>{p.selected&&(p.selected=!1,h=!0)}),h&&c.onManipulatorSelectionChanged&&c.onManipulatorSelectionChanged()}}),n==null)break;const{manipulator:o,tool:a}=n;if(!o.interactive)break;o.selectable&&a.automaticManipulatorSelection&&(o.selected=!o.selected,a.onManipulatorSelectionChanged&&a.onManipulatorSelectionChanged());const l=e.native.shiftKey;o.events.emit("immediate-click",{screenPoint:s,button:e.button,pointerType:e.pointerType,shiftKey:l,stopPropagation:i});break}case"click":{const s=Xp(e),n=this._intersect(s,e.pointerType,r.forEachTool),o=n!=null?n.manipulator:null;if(o==null||!o.interactive)break;const a=e.native.shiftKey;o.events.emit(e.type,{screenPoint:s,button:e.button,pointerType:e.pointerType,shiftKey:a}),i();break}case"double-click":{const s=Xp(e),n=this._intersect(s,e.pointerType,r.forEachTool),o=n!=null?n.manipulator:null;if(o==null||!o.interactive)break;const a=e.native.shiftKey;o.events.emit("double-click",{screenPoint:s,button:e.button,pointerType:e.pointerType,shiftKey:a,stopPropagation:i});break}case"immediate-double-click":{const s=Xp(e),n=this._intersect(s,e.pointerType,r.forEachTool),o=n!=null?n.manipulator:null;if(o==null||!o.interactive)break;const a=e.native.shiftKey;o.events.emit("immediate-double-click",{screenPoint:s,button:e.button,pointerType:e.pointerType,shiftKey:a,stopPropagation:i});break}}this._onFocusChange(r.forEachTool)}_ungrabManipulatorBeforeDragging(e,r,i){e.grabbing=!1,e.events.emit("grab-changed",{action:"end",pointerType:r.pointerType,screenPoint:Xp(r)}),this._grabbedManipulators.forEach(({manipulator:s},n)=>{s===e&&this._grabbedManipulators.delete(n)}),this._afterManipulatorUngrab(i.setActiveTool)}_handlePointerEnd(e,r){const i=uc(this._grabbedManipulators.get(e.pointerId),({manipulator:s})=>s);i!=null&&i.grabbing&&(i.grabbing=!1,i.events.emit("grab-changed",{action:"end",pointerType:e.pointerType,screenPoint:Xp(e)}),this._grabbedManipulators.delete(e.pointerId),this._afterManipulatorUngrab(r.setActiveTool))}_cursorFromMap(e){let r=null;return No(e,({manipulator:i})=>!(i==null||!i.interactive)&&(i.grabbing&&i.grabCursor?(r=i.grabCursor,!0):!!i.cursor&&(r=i.cursor,!0))),r}_onFocusChange(e){this._updateCursor(),this._updateFocusedManipulatorTools(e)}_updateCursor(){this._grabbedManipulators.size>0?this._cursor=this._cursorFromMap(this._grabbedManipulators)||"grabbing":this._hoveredManipulators.size>0?this._cursor=this._cursorFromMap(this._hoveredManipulators)||"pointer":this._cursor=null}_updateFocusedManipulatorTools(e){const r=new Set,i=new Set;this._grabbedManipulators.forEach(({tool:s})=>{r.add(s)}),this._hoveredManipulators.forEach(({tool:s})=>{i.add(s)}),e(s=>{s.hasGrabbedManipulators=r.has(s),s.hasHoveredManipulators=i.has(s);const n=this._grabbedManipulators.values(),o=OIe(n,({tool:a})=>a===s);s.firstGrabbedManipulator=o!=null?o.manipulator:null})}clearPointers(e,{forEachTool:r,setActiveTool:i},s=!0,n){const o=(a,l)=>a===e&&(n==null||n===l);this._grabbedManipulators.forEach(({tool:a,manipulator:l,pointerType:c},h)=>{o(a,l)&&(this._grabbedManipulators.delete(h),l.grabbing=!1,l.events.emit("grab-changed",{action:"end",screenPoint:null,pointerType:c}))}),this._draggedManipulators.forEach(({tool:a,manipulator:l},c)=>{o(a,l)&&(this._draggedManipulators.delete(c),l.dragging=!1,l.events.emit("drag",{action:"cancel"}))}),s&&this._hoveredManipulators.forEach(({tool:a,manipulator:l},c)=>{o(a,l)&&(this._hoveredManipulators.delete(c),l.hovering=!1)}),this._afterManipulatorUngrab(i),this._onFocusChange(r)}_intersect(e,r,i){let s=null;return i(n=>{if(n.manipulators==null||!wG(n))return!1;const o=n.manipulators.intersect(e,r);return o!=null&&(s={tool:n,manipulator:o},!0)}),s}updateHoveredStateFromKnownPointers(e){this._pointerLocations.forEach((r,i)=>{this._updateHoveredStateForPointerAtScreenPosition(Ah(r.x,r.y),i,r.pointerType,e)})}handleHoverEvent(e,r){e.type!=="pointer-up"&&e.type!=="immediate-click"&&e.type!=="pointer-move"||!jre(e.pointerType)||this._updateHoveredStateForPointerAtScreenPosition(Xp(e),e.pointerId,e.pointerType,r)}_updateHoveredStateForPointerAtScreenPosition(e,r,i,s){let n=this._intersect(e,i,s);const o=uc(this._hoveredManipulators.get(r),({manipulator:a})=>a);n==null||n.manipulator.interactive||(n=null),n!=null&&o===n.manipulator||(o!=null&&(o.hovering=!1),n!=null?(n.manipulator.hovering=!0,this._hoveredManipulators.set(r,n)):this._hoveredManipulators.delete(r),this._onFocusChange(s))}_afterManipulatorUngrab(e){this._grabbedManipulators.size===0&&this._revertToNullActiveTool&&(e(null),this._revertToNullActiveTool=!1)}};function jre(t){return t==="mouse"}function Hre(t){return t.pointerType!=="mouse"||t.button===0}function HXe(t){return!!t.native.shiftKey}const qre="attached",KU="tools",qXe=1e3;let yd=class extends yO{constructor(e){super(e),this._clock=wR,this._manipulatorState=new jXe,this.tools=new Pt,this.cursor=null,this._interacting=!1,this._interactingTimeout=null,this._forEachTool=r=>{for(const i of this.tools.items)if(r(i))return}}initialize(){this.handles.add([this.view.on(Jbe,e=>{this._handleInputEvent(e)},m_.TOOL),...GXe(this.tools),this.tools.on("before-add",({item:e})=>{this._updateToolEditableFlag(e)}),this.tools.on("before-remove",({item:e})=>{this._manipulatorState.clearPointers(e,this._manipulatorStateEventArgs),this._updateCursor()}),this.tools.on("change",()=>{this._refreshToolWatchers()})])}destroy(){this.detach(),this.handles.removeAll()}get _manipulatorStateEventArgs(){return{forEachTool:this._forEachTool,activeTool:this.activeTool,setActiveTool:e=>{this.activeTool=e},view:this.view}}set activeTool(e){if(e!=null&&!this.view.ready)return void Q.getLogger(this).error("Cannot set active tool while view is not ready.");if(e===this.activeTool)return;const r=this.activeTool;this._set("activeTool",e),r?.deactivate(),e?.activate(),this._removeIncompleteTools(e);for(const i of this.tools){this._updateToolEditableFlag(i);const s=wG(i);this.activeTool!=null&&s||this._manipulatorState.clearPointers(i,this._manipulatorStateEventArgs,!s)}this._updateCursor()}get updating(){return this.updatingHandles.updating||this.tools.some(e=>e.updating)||(this.textures?.updating??!1)}get interacting(){return this._interacting}_clearInteractingTimeout(){this._interactingTimeout=Ii(this._interactingTimeout)}_startInteractingTimeout(){this._clearInteractingTimeout(),this._interactingTimeout=this._clock.setTimeout(()=>this._interacting=!1,qXe)}attach(){this.view.type==="3d"?(this._set("textures",new sS(this.view._stage,this.view.resourceController.scheduler)),this.handles.add([le(()=>{const{state:e}=this.view;return"camera"in e&&e.camera},()=>this._forEachManipulator(e=>e.onViewChange())),this.view.elevationProvider?.on("elevation-change",e=>this._forEachManipulator(r=>r.onElevationChange(e))),bo(()=>this._set("textures",Me(this.textures)))],qre)):this.handles.add(le(()=>this.view.extent,()=>this._forEachManipulator(e=>e.onViewChange())))}detach(){this.activeTool=null,this.tools.removeAll(),this.handles.remove(qre),this._clearInteractingTimeout(),this._interacting=!1}_forEachManipulator(e){this._forEachTool(r=>{r.manipulators&&r.manipulators.forEach(({manipulator:i})=>e(i,r))})}_handleInputEvent(e){let r=!1;const i={...e,stopPropagation:()=>{r=!0,e.stopPropagation()}};this.activeTool!=null?this.activeTool.handleInputEvent&&this.activeTool.handleInputEvent(i):this._forEachTool(s=>{!r&&s.visible&&s.handleInputEvent(i)}),!r&&e.type==="key-down"&&e.key==="Escape"&&this.activeTool&&(e.stopPropagation(),this.activeTool=null),this._manipulatorState.handleInputEvent(i,this._manipulatorStateEventArgs),r||this.activeTool==null||this.activeTool.handleInputEventAfter(i),this._manipulatorState.handleHoverEvent(i,this._forEachTool),this._updateCursor(),e.type==="pointer-move"&&(this._manipulatorState.hasFocusedManipulators()||this.activeTool)&&(this._interacting=!0,this._startInteractingTimeout())}_refreshToolWatchers(){this.handles.remove(KU),this._forEachTool(e=>{if(e instanceof Te){const r=le(()=>[e.cursor,e.visible,e.editable],()=>{wG(e)||this._manipulatorState.clearPointers(e,this._manipulatorStateEventArgs),this._updateCursor()});this.handles.add(r,KU)}e.manipulators&&this.handles.add([e.manipulators.on("after-remove",r=>{this._manipulatorState.clearPointers(e,this._manipulatorStateEventArgs,!0,r.item.manipulator)}),e.manipulators.on("change",()=>{this._manipulatorState.updateHoveredStateFromKnownPointers(this._forEachTool),this._updateCursor()})],KU)}),this._manipulatorState.updateHoveredStateFromKnownPointers(this._forEachTool),this._updateCursor()}_updateToolEditableFlag(e){e.setEditableFlag?.(jO.MANAGER,this.activeTool==null||e===this.activeTool)}_updateCursor(){let e=this._manipulatorState.cursor;e==null&&this._forEachTool(r=>!(r.cursor==null||!r.visible)&&(e=r.cursor,!0)),this._get("cursor")!==e&&this._set("cursor",e)}_removeIncompleteTools(e){this.tools.filter(r=>(e==null||r!==e)&&!r.created&&r.removeIncompleteOnCancel).forEach(r=>{this.tools.remove(r)})}get test(){return{setClock:e=>this._clock=e}}};u([d({constructOnly:!0,nonNullable:!0})],yd.prototype,"view",void 0),u([d({readOnly:!0,nonNullable:!0})],yd.prototype,"textures",void 0),u([d({value:null})],yd.prototype,"activeTool",null),u([d({readOnly:!0,type:Pt})],yd.prototype,"tools",void 0),u([d({readOnly:!0})],yd.prototype,"cursor",void 0),u([d({readOnly:!0})],yd.prototype,"updating",null),u([d()],yd.prototype,"_interacting",void 0),u([d({readOnly:!0})],yd.prototype,"interacting",null),yd=u([R("esri.views.ToolViewManager")],yd);let MT=class extends Te{constructor(e){super(),this.nativeIndex=null,this._detectedDeviceType="unknown",e.mapping==="standard"?this._detectedDeviceType="standard":WXe.test(e.id)?this._detectedDeviceType="spacemouse":this._detectedDeviceType="unknown",this.nativeIndex=e.index}get native(){const e=navigator.getGamepads?navigator.getGamepads():[];return this.nativeIndex!=null&&this.nativeIndex<e.length?e[this.nativeIndex]:null}get deviceType(){return this._detectedDeviceType}get axisThreshold(){return ZXe[this.deviceType]}};u([d({nonNullable:!0,readOnly:!0})],MT.prototype,"nativeIndex",void 0),u([d({type:String,readOnly:!0})],MT.prototype,"deviceType",null),u([d({type:Number,readOnly:!0})],MT.prototype,"axisThreshold",null),MT=u([R("esri.views.input.gamepad.GamepadInputDevice")],MT);const WXe=new RegExp("^(3dconnexion|space(mouse|navigator|pilot|explorer))","i"),ZXe={standard:.15,spacemouse:.025,unknown:0},SX=MT;let DA=class extends Te{constructor(...e){super(...e),this.devices=new Pt,this.enabledFocusMode="document"}};u([d({type:Pt.ofType(SX),readOnly:!0})],DA.prototype,"devices",void 0),u([d({type:["document","view","none"]})],DA.prototype,"enabledFocusMode",void 0),DA=u([R("esri.views.input.gamepad.GamepadSettings")],DA);const XXe=DA;let jL=class extends Te{constructor(){super(...arguments),this.gamepad=new XXe}};u([d({readOnly:!0})],jL.prototype,"gamepad",void 0),jL=u([R("esri.views.input.Input")],jL);const YXe=jL;let v0=class extends Te{constructor(e){super(e),this.enabled=!0,this.device=null,this.mode="pan",this.tiltDirection="forward-down",this.velocityFactor=1}};u([d({type:Boolean,nonNullable:!0})],v0.prototype,"enabled",void 0),u([d({type:SX})],v0.prototype,"device",void 0),u([d({type:["pan","zoom"],nonNullable:!0})],v0.prototype,"mode",void 0),u([d({type:["forward-down","forward-up"],nonNullable:!0})],v0.prototype,"tiltDirection",void 0),u([d({type:Number,nonNullable:!0})],v0.prototype,"velocityFactor",void 0),v0=u([R("esri.views.navigation.gamepad.GamepadSettings")],v0);const ewe=v0;let R1=class extends Te{constructor(e){super(e),this.browserTouchPanEnabled=!0,this.gamepad=new ewe,this.momentumEnabled=!0,this.mouseWheelZoomEnabled=!0}};u([d({type:Boolean})],R1.prototype,"browserTouchPanEnabled",void 0),u([d({type:ewe,nonNullable:!0})],R1.prototype,"gamepad",void 0),u([d({type:Boolean})],R1.prototype,"momentumEnabled",void 0),u([d({type:Boolean})],R1.prototype,"mouseWheelZoomEnabled",void 0),R1=u([R("esri.views.navigation.Navigation")],R1);const twe=R1;function pRt(t,e,r){const i=rwe(t),s=e,n=JXe(i,s,r);if(i){const o=$w.deriveUnitFromSR(i,t.spatialReference).heightUnit;if(!r&&o!==i.heightUnit){const a=new F("layerview:unmatched-height-unit",`The vertical units of the layer must match the horizontal units (${o})`,{horizontalUnit:o});return new F("layerview:unsupported-height-model-info","The vertical coordinate system of the layer is not supported",{heightModelInfo:i,error:a})}}if(!QXe(t)||n===ec.Unsupported)return new F("layerview:unsupported-height-model-info","The vertical coordinate system of the layer is not supported",{heightModelInfo:i});switch(n){case ec.Units:{const o=i?.heightUnit||"unknown",a=s?.heightUnit||"unknown",l=new F("layerview:incompatible-height-unit",`The vertical units of the layer (${o}) must match the vertical units of the scene (${a})`,{layerUnit:o,sceneUnit:a});return new F("layerview:incompatible-height-model-info","The vertical coordinate system of the layer is incompatible with the scene",{layerHeightModelInfo:i,sceneHeightModelInfo:s,error:l})}case ec.HeightModel:{const o=i?.heightModel||"unknown",a=s?.heightModel||"unknown",l=new F("layerview:incompatible-height-model",`The height model of the layer (${o}) must match the height model of the scene (${a})`,{layerHeightModel:o,sceneHeightModel:a});return new F("layerview:incompatible-height-model-info","The vertical coordinate system of the layer is incompatible with the scene",{layerHeightModelInfo:i,sceneHeightModelInfo:s,error:l})}case ec.CRS:{const o=i?.vertCRS||"unknown",a=s?.vertCRS||"unknown",l=new F("layerview:incompatible-vertical-datum",`The vertical datum of the layer (${o}) must match the vertical datum of the scene (${a})`,{layerDatum:o,sceneDatum:a});return new F("layerview:incompatible-height-model-info","The vertical coordinate system of the layer is incompatible with the scene",{layerHeightModelInfo:i,sceneHeightModelInfo:s,error:l})}}return null}function JXe(t,e,r){if(!Wre(t)||!Wre(e))return ec.Unsupported;if(t==null||e==null)return ec.Ok;if(!r&&t.heightUnit!==e.heightUnit)return ec.Units;if(t.heightModel!==e.heightModel)return ec.HeightModel;switch(t.heightModel){case"gravity-related-height":return ec.Ok;case"ellipsoidal":return t.vertCRS===e.vertCRS?ec.Ok:ec.CRS;default:return ec.Unsupported}}var ec;function Wre(t){return t==null||t.heightModel!=null&&t.heightUnit!=null}function QXe(t){return"heightModelInfo"in t&&t.heightModelInfo!=null||t.spatialReference!=null||!nwe(t)}function rwe(t){const e=t.url?Iw(t.url):void 0;return!(t.spatialReference?.vcsWkid==null&&e!=null&&e.serverType==="ImageServer")&&iwe(t)&&t.heightModelInfo?t.heightModelInfo:nwe(t)?$w.deriveUnitFromSR(eYe,t.spatialReference):null}function iwe(t){return"heightModelInfo"in t}function swe(t){if(t.type==="unknown"||!("capabilities"in t))return!1;switch(t.type){case"csv":case"feature":case"geojson":case"subtype-group":case"ogc-feature":case"oriented-imagery":case"wfs":case"knowledge-graph-sublayer":return!0;default:return!1}}function nwe(t){return swe(t)?!!(t.capabilities&&t.capabilities.data&&t.capabilities.data.supportsZ):owe(t)}function KXe(t){return t.layers!=null||owe(t)||swe(t)||iwe(t)}function owe(t){switch(t.type){case"building-scene":case"elevation":case"integrated-mesh":case"point-cloud":case"scene":case"voxel":return!0;case"base-dynamic":case"base-elevation":case"base-tile":case"bing-maps":case"csv":case"dimension":case"geojson":case"feature":case"subtype-group":case"geo-rss":case"graphics":case"group":case"imagery":case"imagery-tile":case"kml":case"knowledge-graph":case"link-chart":case"knowledge-graph-sublayer":case"line-of-sight":case"map-image":case"map-notes":case"media":case"ogc-feature":case"open-street-map":case"oriented-imagery":case"route":case"stream":case"tile":case"unknown":case"unsupported":case"vector-tile":case"video":case"wcs":case"web-tile":case"wfs":case"wms":case"wmts":case null:return!1}return!1}(function(t){t[t.Ok=0]="Ok",t[t.Units=1]="Units",t[t.HeightModel=2]="HeightModel",t[t.CRS=3]="CRS",t[t.Unsupported=4]="Unsupported"})(ec||(ec={}));const eYe=new $w({heightModel:"gravity-related-height"});let xG,e8=null;async function tYe(t){e8||(e8=ae(()=>Promise.resolve().then(()=>qmt),void 0,import.meta.url).then(e=>xG=e)),await e8,Xt(t)}async function awe(t,e,r,i){if(!t)return null;const s=t.spatialReference;return y5()||Vf(s,e)?Lw(t,e):xG?xG.projectGeometry(t,e,r,i):(await Promise.race([tYe(i),NO(i)]),awe(t,e,r,i))}let Ni=class extends Te{constructor(e){super(e),this.required={tileInfo:!1,heightModelInfo:!1,extent:!1},this.defaultSpatialReference=null,this.userSpatialReference=null,this.sourcePreloadCount=10,this.priorityCollection=null,this.requiresExtentInSpatialReference=!0,this.suspended=!1,this._projectExtentTask={task:null,input:null,output:null,spatialReference:null}}destroy(){this._projectExtentTask.task&&(this._projectExtentTask.task=pu(this._projectExtentTask.task)),this._set("map",null)}get ready(){return!this._spatialReferenceTask.updating&&!this._tileInfoTask.updating&&!this._extentTask.updating}get heightModelInfoReady(){return!this._heightModelInfoTask.updating}get spatialReference(){return this.userSpatialReference!=null?this.userSpatialReference:this._spatialReferenceTask.spatialReference}get extent(){return this._extentTask.extent}get heightModelInfo(){return this._heightModelInfoTask.heightModelInfo}get vcsWkid(){return this._heightModelInfoTask.vcsWkid}get latestVcsWkid(){return this._heightModelInfoTask.latestVcsWkid}get viewingMode(){return this.userSpatialReference==null||this.userSpatialReference.equals(this._spatialReferenceTask.spatialReference)?this._spatialReferenceTask.viewingMode:null}get tileInfo(){return this._tileInfoTask.tileInfo}get mapCollections(){const e=this.map?.(),r=[];return this.priorityCollection!=null&&r.push(this.priorityCollection),r.push({parent:e?.basemap,layers:e?.basemap?.baseLayers},{layers:e?.layers},{parent:e?.ground,layers:e?.ground?.layers},{parent:e?.basemap,layers:e?.basemap?.referenceLayers}),r}get _allLayers(){return this._collectLayers(this.mapCollections)}get _spatialReferenceTask(){if(this.suspended)return this._get("_spatialReferenceTask")??{updating:!1};const{layers:e,updating:r}=this._allLayers;let i=null;for(const n of e){const o=this._getSupportedSpatialReferences(n);if(o.length>0){const a=this._narrowDownSpatialReferenceCandidates(i,o);a!=null&&(i=a)}if(i!=null&&i.length===1)break}if(r&&(i==null||i.length!==1))return{updating:!0};const s=this._pickSpatialReferenceCandidate(i);return{spatialReference:s!=null?s.spatialReference:null,viewingMode:s!=null?s.viewingMode:null,updating:!1}}get _tileInfoTask(){if(!this.required.tileInfo)return this._get("_tileInfoTask")??{updating:!1};if(!this.spatialReference)return{updating:this._spatialReferenceTask.updating};const{layers:e,updating:r}=this._collectLayers([{parent:this.map?.()?.basemap,layers:this.map?.()?.basemap?.baseLayers},{layers:this.map?.()?.layers}]);if(e&&e.length>0&&"tileInfo"in e[0]){const i=e[0].tileInfo;return{tileInfo:i&&i.spatialReference.equals(this.spatialReference)?i:null,updating:!1}}return{updating:r}}get _heightModelInfoTask(){if(!this.required.heightModelInfo||this.suspended&&this._get("_heightModelInfoTask")?.heightModelInfo)return this._get("_heightModelInfoTask")??{updating:!1};const{layers:e,updating:r}=this._allLayers;for(const i of e)if(KXe(i)){const s=rwe(i);if(s)return{heightModelInfo:s,vcsWkid:i.spatialReference?.vcsWkid,latestVcsWkid:i.spatialReference?.latestVcsWkid,updating:!1}}return{updating:r}}get _extentCandidatesTask(){if(this.suspended||!this.required.extent)return this._get("_extentCandidatesTask")??{updating:!1};if(!this.spatialReference)return{updating:this._spatialReferenceTask.updating};const e=this._allLayers,r=e.updating,i=[];for(const s of e.layers){const n="fullExtents"in s&&s.fullExtents||(s.fullExtent!=null?[s.fullExtent]:[]),o=this.requiresExtentInSpatialReference?null:n[0],a=n.find(l=>l.spatialReference.equals(this.spatialReference))??o;if(a)return{candidates:[{extent:a,layer:s}],updating:!1};if(this._getSupportedSpatialReferences(s).length>0)for(const l of n)i.push({extent:l,layer:s})}return{candidates:i,updating:r}}get _extentTask(){const{candidates:e,updating:r}=this._extentCandidatesTask;if(r)return{updating:r};if(e==null||e.length===0)return{updating:!1};if(!this.spatialReference)return{updating:this._spatialReferenceTask.updating};const i=this._pickExtentCandidate(e),s=this.spatialReference;return i.extent.equals(this._projectExtentTask.input)&&s.equals(this._projectExtentTask.spatialReference)?{extent:this._projectExtentTask.output,updating:this._projectExtentTask.task!=null&&!this._projectExtentTask.task.finished}:(this._projectExtentTask.task!=null&&(this._projectExtentTask.task=pu(this._projectExtentTask.task)),this._projectExtentTask={input:i.extent.clone(),output:null,spatialReference:s.clone(),task:uE(async n=>{try{const o=await awe(i.extent,s,"portalItem"in i.layer?i.layer.portalItem:void 0,n);this._projectExtentTask={...this._projectExtentTask,task:null,output:o}}catch{if(sn(n))return;this._projectExtentTask={...this._projectExtentTask,task:null}}})},{updating:!0})}_narrowDownSpatialReferenceCandidates(e,r){if(e==null)return r;const i=[],s=(n,o)=>n!=null?o!=null?n===o&&n:n:o;for(const n of e)for(const o of r){if(!n.spatialReference.equals(o.spatialReference))continue;const a=s(n.viewingMode,o.viewingMode);if(a!==!1){i.push({spatialReference:n.spatialReference,viewingMode:a});break}}return i.length>0?i:null}_pickSpatialReferenceCandidate(e){const r=this.defaultSpatialReference;return e==null||e.length<1?r!=null?{spatialReference:r,viewingMode:null}:null:(r!=null&&e.length>1&&e.some(({spatialReference:i})=>i.equals(r))&&(e=e.filter(({spatialReference:i})=>i.equals(r))),e.length>1&&e.some(({viewingMode:i})=>i!==De.Local)&&(e=e.filter(({viewingMode:i})=>i!==De.Local)),e[0])}_getSupportedSpatialReferences(e){const r="supportedSpatialReferences"in e&&e.supportedSpatialReferences||(e.spatialReference?[e.spatialReference]:[]);if(r.length===0)return[];const i=[];for(const s of r){const n=this.getSpatialReferenceSupport({spatialReference:s,layer:e});if(n!=null){const o=n.constraints!=null?n.constraints:[{spatialReference:s,viewingMode:null}];for(const{spatialReference:a,viewingMode:l}of o)this.requiresExtentInSpatialReference&&this.userSpatialReference!=null&&!a.equals(this.userSpatialReference)||i.push({spatialReference:a,viewingMode:l})}}return i}_pickExtentCandidate(e){const r=this.spatialReference;return e.find(({extent:i})=>r.equals(i.spatialReference))||e[0]}_collectLayers(e){if(this._loadMaybe(this.map?.())!=="loaded")return{layers:[],updating:!0};const r=new rYe;for(const i of e)if(this._collectCollection(i,r),r.preloading===this.sourcePreloadCount)break;return{layers:r.layers,updating:r.updating}}_collectCollection(e,r){if(e.layers){switch(this._loadMaybe(e.parent)){case"loading":return r.updating=!0,void++r.preloading;case"failed":return}for(const i of e.layers){switch(this._loadMaybe(i)){case"failed":continue;case"loading":r.updating=!0,++r.preloading;break;case"loaded":r.updating||r.layers.push(i),"layers"in i&&this._collectCollection({layers:i.layers},r)}if(r.preloading===this.sourcePreloadCount)break}}}_loadMaybe(e){return e&&"loadStatus"in e&&e.loadStatus!=null?e.loadStatus==="not-loaded"?(e.load().catch(r=>{ms(r)||console.log(r)}),"loading"):e.loadStatus:"loaded"}};u([d()],Ni.prototype,"required",void 0),u([d({constructOnly:!0})],Ni.prototype,"map",void 0),u([d({constructOnly:!0})],Ni.prototype,"getSpatialReferenceSupport",void 0),u([d()],Ni.prototype,"defaultSpatialReference",void 0),u([d()],Ni.prototype,"userSpatialReference",void 0),u([d()],Ni.prototype,"sourcePreloadCount",void 0),u([d()],Ni.prototype,"priorityCollection",void 0),u([d()],Ni.prototype,"requiresExtentInSpatialReference",void 0),u([d()],Ni.prototype,"suspended",void 0),u([d({readOnly:!0})],Ni.prototype,"ready",null),u([d({readOnly:!0})],Ni.prototype,"heightModelInfoReady",null),u([d({readOnly:!0})],Ni.prototype,"spatialReference",null),u([d({readOnly:!0})],Ni.prototype,"extent",null),u([d({readOnly:!0})],Ni.prototype,"heightModelInfo",null),u([d({readOnly:!0})],Ni.prototype,"vcsWkid",null),u([d({readOnly:!0})],Ni.prototype,"latestVcsWkid",null),u([d({readOnly:!0})],Ni.prototype,"viewingMode",null),u([d({readOnly:!0})],Ni.prototype,"tileInfo",null),u([d({readOnly:!0})],Ni.prototype,"mapCollections",null),u([d({readOnly:!0})],Ni.prototype,"_allLayers",null),u([d({readOnly:!0})],Ni.prototype,"_spatialReferenceTask",null),u([d({readOnly:!0})],Ni.prototype,"_tileInfoTask",null),u([d({readOnly:!0})],Ni.prototype,"_heightModelInfoTask",null),u([d({readOnly:!0})],Ni.prototype,"_extentCandidatesTask",null),u([d()],Ni.prototype,"_extentTask",null),u([d()],Ni.prototype,"_projectExtentTask",void 0),Ni=u([R("esri.views.support.DefaultsFromMap")],Ni);let rYe=class{constructor(){this.layers=new Array,this.preloading=-1,this.updating=!1}};var NA;let Rt=NA=class extends TF(os.EventedMixin(DF(Te))){constructor(t){super(t),this._userSpatialReference=null,this._cursor=null,this.allLayerViews=new zO({getCollections:()=>[this.basemapView?.baseLayerViews,this.groundView?.layerViews,this.layerViews,this.basemapView?.referenceLayerViews],getChildrenFunction:sYe}),this.groundView=null,this.basemapView=null,this.fatalError=null,this.graphics=new F3,this.analyses=new w2,this.typeSpecificPreconditionsReady=!0,this.layerViews=new Pt,this.magnifier=new Xbe,this.padding={left:0,top:0,right:0,bottom:0},this.ready=!1,this.spatialReferenceWarningDelay=1e3,this.supportsGround=!0,this.timeExtent=null,this.timeReference=new d2,this.type=null,this.scale=null,this.updating=!1,this.initialExtentRequired=!0,this.input=new YXe,this.navigation=new twe,this.layerViewManager=null,this.analysisViewManager=null,this.isHeightModelInfoRequired=!1,this.width=null,this.height=null,this.resizing=!1,this.suspended=!1,this.viewEvents=new zXe(this),this.persistableViewModels=new Pt,this._isValid=!1,this._readyCycleForced=!1,this._currentSpatialReference=null,this.handles.add(le(()=>this.preconditionsReady,e=>{e?(this._currentSpatialReference=this.spatialReference,NA.views.add(this)):(this._currentSpatialReference=null,NA.views.remove(this)),this.notifyChange("spatialReference"),!e&&this.ready?(this.toolViewManager?.detach(),this.analysisViewManager!=null&&this.analysisViewManager.detach(),this.layerViewManager?.clear(),this._teardown()):e&&!this.ready&&(this._startup(),this.analysisViewManager!=null&&this.analysisViewManager.attach(),this.toolViewManager.attach())},jr))}initialize(){this.addResolvingPromise(this.validate().then(()=>(this._isValid=!0,QS(()=>this.ready)))),this.basemapView=new _0({view:this}),this.layerViewManager=new $Xe({view:this,layerViewImporter:{importLayerView:t=>this.importLayerView(t),hasLayerViewModule:t=>this.hasLayerViewModule(t)},supportsGround:this.supportsGround}),this.toolViewManager=new yd({view:this}),this._setupSpatialReferenceLogger(),this.handles.add([le(()=>this.initialExtentRequired,t=>this.defaultsFromMap.required={...this.defaultsFromMap.required,extent:t},{sync:!0,initial:!0}),le(()=>this.ready,t=>{this.defaultsFromMap&&(this.defaultsFromMap.suspended=t,this.defaultsFromMap.userSpatialReference=t?this.spatialReference:this._userSpatialReference)},{sync:!0}),le(()=>this._userSpatialReference,t=>{this.defaultsFromMap&&(this.defaultsFromMap.userSpatialReference=t)},{sync:!0,initial:!0})])}_setupSpatialReferenceLogger(){let t=null;this.handles.add([le(()=>this.defaultsFromMap?.ready,e=>{const r=this.map?.allLayers.length>0;if(e&&!this.spatialReference&&r){if(t!=null)return;const i=bo(()=>t=pu(t));t=uE(async s=>{try{await pO(this.spatialReferenceWarningDelay,null,s)}catch{return}finally{t=null}Q.getLogger(this).warn("#spatialReference","no spatial reference could be derived from the currently added map layers")}),this.handles.add(i,"spatial-reference-logger-task")}else this.handles.remove("spatial-reference-logger-task")},{sync:!0})])}destroy(){this.destroyed||(NA.views.remove(this),this.viewEvents.destroy(),this.allLayerViews.destroy(),this.navigation&&(this.navigation.destroy(),this._set("navigation",null)),this.graphics=Me(this.graphics),this.analyses=Me(this.analyses),this.handles.remove("defaultsFromMap"),this.defaultsFromMap.destroy(),this._set("defaultsFromMap",null),Me(this.analysisViewManager),this.toolViewManager=Me(this.toolViewManager),this.layerViewManager=Me(this.layerViewManager),this.basemapView=Me(this.basemapView),this.groundView?.destroy(),this.layerViews?.forEach(t=>t.destroy()),this.layerViews.length=0,this.invalidate(),this._emitter.clear(),this.handles.removeAll(),this.map=Me(this.map))}_startup(){this._set("ready",!0)}_teardown(){this._set("ready",!1)}whenReady(){return Promise.resolve(this)}toMap(){return Q.getLogger(this).error("#toMap()","Not implemented on this instance of View"),null}get activeTool(){return this.toolViewManager?.activeTool}set activeTool(t){this.toolViewManager&&(this.toolViewManager.activeTool=t)}get animation(){return this._get("animation")}set animation(t){this._set("animation",t)}get center(){return null}get _defaultsFromMapSettings(){return{}}get defaultsFromMap(){return new Ni({required:{tileInfo:!1,heightModelInfo:!1,extent:!1},map:()=>this.map,getSpatialReferenceSupport:t=>this.getSpatialReferenceSupport(t),...this._defaultsFromMapSettings})}get extent(){return this._get("extent")}set extent(t){this._set("extent",t)}get heightModelInfo(){return this.getDefaultHeightModelInfo()}get interacting(){return this.navigating}get navigating(){return!1}get preconditionsReady(){return!(this.fatalError||!this._isValid||this._readyCycleForced||!this.map||Fg.isLoadable(this.map)&&!this.map.loaded||this.width===0||this.height===0||!this.spatialReference||!this._validateSpatialReference(this.spatialReference)||!this._currentSpatialReference&&!this.defaultsFromMap?.ready||!this.typeSpecificPreconditionsReady)}get resolution(){return 0}set map(t){t!==this._get("map")&&(t?.destroyed&&(Q.getLogger(this).warn("#map","The provided map is already destroyed",{map:t}),t=null),Fg.isLoadable(t)&&t.load().catch(()=>{}),this.constructed&&!this.destroyed&&(this.forceReadyCycle(),this._currentSpatialReference=null),this._set("map",t))}get spatialReference(){let t=this._userSpatialReference||this._currentSpatialReference||this.getDefaultSpatialReference()||null;return t&&this.defaultsFromMap?.required?.heightModelInfo&&(t=t.clone(),t.vcsWkid=this.defaultsFromMap.vcsWkid,t.latestVcsWkid=this.defaultsFromMap.latestVcsWkid),t}set spatialReference(t){const e=!Rn(t,this._get("spatialReference"));this._set("_userSpatialReference",t),e&&(this._set("spatialReference",t),this._spatialReferenceChanged(t))}_spatialReferenceChanged(t){}get stationary(){return!this.animation&&!this.navigating&&!this.resizing}get tools(){return this.toolViewManager?.tools}get initialExtent(){return this.defaultsFromMap?.extent}get cursor(){const t=this.toolViewManager?this.toolViewManager.cursor:null;return t??(this._cursor||"default")}set cursor(t){this._cursor=t,this.notifyChange("cursor")}get size(){return[this.width,this.height]}whenLayerView(t){return this.layerViewManager?.whenLayerView(t)??Promise.reject()}getDefaultSpatialReference(){return this.defaultsFromMap?.spatialReference}getDefaultHeightModelInfo(){return(this.map&&"heightModelInfo"in this.map?this.map.heightModelInfo:void 0)??this.defaultsFromMap?.heightModelInfo??null}importLayerView(t){throw new F("importLayerView() not implemented")}hasLayerViewModule(t){return!1}async validate(){}invalidate(){this._isValid=!1}getSpatialReferenceSupport(){return{constraints:null}}_validateSpatialReference(t){return this.getSpatialReferenceSupport({spatialReference:t})!=null}when(t,e){return this.isResolved()&&!this.ready&&Q.getLogger(this).warn("#when()","Calling view.when() while the view is no longer ready but was already resolved once will resolve immediately. Use reactiveUtils.whenOnce(() => view.ready).then(...) instead."),super.when(t,e)}forceReadyCycle(){this.ready&&(Eh(()=>this.destroyed||this.preconditionsReady===!1,()=>this._readyCycleForced=!1,{once:!0}),this._readyCycleForced=!0)}addAndActivateTool(t){this.toolViewManager.tools.add(t),this.activeTool=t}tryFatalErrorRecovery(){this.fatalError=null}};Rt.views=new Pt,u([d()],Rt.prototype,"_userSpatialReference",void 0),u([d()],Rt.prototype,"activeTool",null),u([d({readOnly:!0})],Rt.prototype,"allLayerViews",void 0),u([d()],Rt.prototype,"groundView",void 0),u([d()],Rt.prototype,"animation",null),u([d()],Rt.prototype,"basemapView",void 0),u([d()],Rt.prototype,"center",null),u([d({readOnly:!0})],Rt.prototype,"_defaultsFromMapSettings",null),u([d()],Rt.prototype,"defaultsFromMap",null),u([d()],Rt.prototype,"fatalError",void 0),u([d({type:_r})],Rt.prototype,"extent",null),u([d(G7(F3,"graphics"))],Rt.prototype,"graphics",void 0),u([d(G7(w2,"analyses"))],Rt.prototype,"analyses",void 0),u([d({readOnly:!0,type:$w})],Rt.prototype,"heightModelInfo",null),u([d({readOnly:!0})],Rt.prototype,"interacting",null),u([d({readOnly:!0})],Rt.prototype,"navigating",null),u([d({readOnly:!0,dependsOn:["fatalError","_isValid","_readyCycleForced","map","map.loaded?","width","height","spatialReference","_currentSpatialReference","defaultsFromMap.ready","typeSpecificPreconditionsReady"]})],Rt.prototype,"preconditionsReady",null),u([d({readOnly:!0})],Rt.prototype,"typeSpecificPreconditionsReady",void 0),u([d({type:Pt,readOnly:!0})],Rt.prototype,"layerViews",void 0),u([d()],Rt.prototype,"resolution",null),u([d({type:Xbe})],Rt.prototype,"magnifier",void 0),u([d({value:null,type:h1e})],Rt.prototype,"map",null),u([d()],Rt.prototype,"padding",void 0),u([d({readOnly:!0})],Rt.prototype,"ready",void 0),u([d({type:je})],Rt.prototype,"spatialReference",null),u([d()],Rt.prototype,"spatialReferenceWarningDelay",void 0),u([d()],Rt.prototype,"stationary",null),u([d({readOnly:!0})],Rt.prototype,"supportsGround",void 0),u([d({type:rm})],Rt.prototype,"timeExtent",void 0),u([d({type:d2,nonNullable:!0})],Rt.prototype,"timeReference",void 0),u([d()],Rt.prototype,"tools",null),u([d()],Rt.prototype,"toolViewManager",void 0),u([d({readOnly:!0})],Rt.prototype,"type",void 0),u([d({type:Number})],Rt.prototype,"scale",void 0),u([d({readOnly:!0})],Rt.prototype,"updating",void 0),u([d({readOnly:!0})],Rt.prototype,"initialExtentRequired",void 0),u([d({readOnly:!0})],Rt.prototype,"initialExtent",null),u([d()],Rt.prototype,"cursor",null),u([d({readOnly:!0})],Rt.prototype,"input",void 0),u([d({type:twe,nonNullable:!0})],Rt.prototype,"navigation",void 0),u([d()],Rt.prototype,"layerViewManager",void 0),u([d()],Rt.prototype,"analysisViewManager",void 0),u([d()],Rt.prototype,"width",void 0),u([d()],Rt.prototype,"height",void 0),u([d({readOnly:!0})],Rt.prototype,"resizing",void 0),u([d({value:null,readOnly:!0})],Rt.prototype,"size",null),u([d({readOnly:!0})],Rt.prototype,"suspended",void 0),u([d({readOnly:!0})],Rt.prototype,"viewEvents",void 0),u([d({readOnly:!0})],Rt.prototype,"persistableViewModels",void 0),u([d()],Rt.prototype,"_isValid",void 0),u([d()],Rt.prototype,"_readyCycleForced",void 0),u([d()],Rt.prototype,"_currentSpatialReference",void 0),Rt=NA=u([R("esri.views.View")],Rt);const iYe=Rt;function sYe(t){return t.layerViews}let b0=class extends uN{constructor(e){super(e),this.state="running",this.target=null,this._resolver=null}initialize(){this._resolver=qs(),this.addResolvingPromise(this._resolver.promise)}get done(){return this.state==="finished"||this.state==="stopped"}stop(){this.state!=="stopped"&&this.state!=="finished"&&(this._set("state","stopped"),this._resolver?.reject(new F("ViewAnimation stopped")))}finish(){this.state!=="stopped"&&this.state!=="finished"&&(this._set("state","finished"),this._resolver?.resolve())}update(e,r){r||(r=bu(e)?"waiting-for-target":"running"),this._set("target",e),this._set("state",r)}};u([d({readOnly:!0})],b0.prototype,"done",null),u([d({readOnly:!0,type:String})],b0.prototype,"state",void 0),u([d()],b0.prototype,"target",void 0),b0=u([R("esri.views.ViewAnimation")],b0),function(t){t.State={RUNNING:"running",STOPPED:"stopped",FINISHED:"finished",WAITING_FOR_TARGET:"waiting-for-target"}}(b0||(b0={}));const T2=b0,JE=()=>ae(()=>import("./TileLayerView3D-8273e750.js"),["./TileLayerView3D-8273e750.js","./LayerView3D-af974166.js","./TiledLayerView3D-52dae82c.js","./LayerView-535107ac.js","./RefreshableLayerView-10c78a74.js","./MapServiceLayerViewHelper-0ceb32ca.js","./floorFilterUtils-73949d2d.js","./drapedUtils-2204a7de.js","./normalizeUtils-996b11fe.js","./normalizeUtilsCommon-4aa2ad72.js","./sublayerUtils-7f6367bc.js"],import.meta.url),Zre=()=>ae(()=>import("./ElevationLayerView3D-7a9d4106.js"),["./ElevationLayerView3D-7a9d4106.js","./LayerView3D-af974166.js","./TiledLayerView3D-52dae82c.js","./LayerView-535107ac.js"],import.meta.url),Xre={"base-dynamic":()=>ae(()=>import("./BaseDynamicLayerView3D-585256a8.js"),["./BaseDynamicLayerView3D-585256a8.js","./DynamicLayerView3D-43ed5e7b.js","./LayerView3D-af974166.js","./projectExtentUtils-d31b5a37.js","./ImageMaterial-0a3b496e.js","./LayerView-535107ac.js","./RefreshableLayerView-10c78a74.js"],import.meta.url),"base-elevation":Zre,"base-tile":JE,"bing-maps":JE,"building-scene":()=>ae(()=>import("./BuildingSceneLayerView3D-fcaf3f14.js"),["./BuildingSceneLayerView3D-fcaf3f14.js","./BuildingGroupSublayer-395286e3.js","./BuildingComponentSublayer-7b41056b.js","./WhereClause-ae8c5a06.js","./executionError-e8d36121.js","./I3SMeshView3D-1d7d8215.js","./I3SOverrides-50df23d3.js","./I3SNode-7e746cc9.js","./meshFeatureSet-93794d5a.js","./Mesh-d3af21f3.js","./MeshGeoreferencedRelativeVertexSpace-4cbafb45.js","./MeshLocalVertexSpace-0353b8cf.js","./MeshTransform-d557c89a.js","./georeference-ab089445.js","./External-2117cdfc.js","./FeatureLayerView3D-b3bb5f6d.js","./FeatureLayerViewBase3D-680cfbad.js","./FeatureLikeLayerView3D-0a06e10d.js","./dehydratedFeatureComparison-d30367d4.js","./queryForSymbologySnapping-be0451bb.js","./elevationInfoUtils-287337e4.js","./hash-6f442295.js","./Graphics3DScaleVisibility-eaf5a046.js","./rendererConversion-22515807.js","./optimizedFeatureQueryEngineAdapter-f5f88773.js","./centroid-3dcadaf5.js","./PooledRBush-506b9510.js","./quickselect-d16016af.js","./floorFilterUtils-73949d2d.js","./QueryEngine-360bd3bb.js","./normalizeUtils-996b11fe.js","./normalizeUtilsCommon-4aa2ad72.js","./json-48e3ea08.js","./QueryEngineCapabilities-42e44ded.js","./utils-a3586684.js","./generateRendererUtils-0f364d1e.js","./FeatureStore-48143fe8.js","./BoundsStore-d475102f.js","./projectExtentUtils-d31b5a37.js","./LayerView3D-af974166.js","./query-2b60d096.js","./pbfQueryUtils-93c2b136.js","./pbf-725ddaf6.js","./EventedSet-9f3fb8de.js","./LayerView-535107ac.js","./RefreshableLayerView-10c78a74.js","./SceneModification-26432643.js","./SceneLayerWorker-335e8e8a.js","./I3SQueryFeatureStore-0e97c15a.js","./DefinitionExpressionSceneLayerView-e46f6be9.js"],import.meta.url),csv:()=>ae(()=>import("./CSVLayerView3D-04d6eef5.js"),["./CSVLayerView3D-04d6eef5.js","./FeatureLayerViewBase3D-680cfbad.js","./FeatureLikeLayerView3D-0a06e10d.js","./dehydratedFeatureComparison-d30367d4.js","./queryForSymbologySnapping-be0451bb.js","./elevationInfoUtils-287337e4.js","./hash-6f442295.js","./Graphics3DScaleVisibility-eaf5a046.js","./rendererConversion-22515807.js","./optimizedFeatureQueryEngineAdapter-f5f88773.js","./centroid-3dcadaf5.js","./PooledRBush-506b9510.js","./quickselect-d16016af.js","./floorFilterUtils-73949d2d.js","./QueryEngine-360bd3bb.js","./normalizeUtils-996b11fe.js","./normalizeUtilsCommon-4aa2ad72.js","./WhereClause-ae8c5a06.js","./executionError-e8d36121.js","./json-48e3ea08.js","./QueryEngineCapabilities-42e44ded.js","./utils-a3586684.js","./generateRendererUtils-0f364d1e.js","./FeatureStore-48143fe8.js","./BoundsStore-d475102f.js","./projectExtentUtils-d31b5a37.js","./LayerView3D-af974166.js","./query-2b60d096.js","./pbfQueryUtils-93c2b136.js","./pbf-725ddaf6.js","./EventedSet-9f3fb8de.js","./LayerView-535107ac.js","./RefreshableLayerView-10c78a74.js"],import.meta.url),dimension:()=>ae(()=>import("./DimensionLayerView3D-6cbf4be6.js"),["./DimensionLayerView3D-6cbf4be6.js","./LayerView3D-af974166.js","./LayerView-535107ac.js"],import.meta.url),elevation:Zre,feature:()=>ae(()=>import("./FeatureLayerView3D-b3bb5f6d.js"),["./FeatureLayerView3D-b3bb5f6d.js","./FeatureLayerViewBase3D-680cfbad.js","./FeatureLikeLayerView3D-0a06e10d.js","./dehydratedFeatureComparison-d30367d4.js","./queryForSymbologySnapping-be0451bb.js","./elevationInfoUtils-287337e4.js","./hash-6f442295.js","./Graphics3DScaleVisibility-eaf5a046.js","./rendererConversion-22515807.js","./optimizedFeatureQueryEngineAdapter-f5f88773.js","./centroid-3dcadaf5.js","./PooledRBush-506b9510.js","./quickselect-d16016af.js","./floorFilterUtils-73949d2d.js","./QueryEngine-360bd3bb.js","./normalizeUtils-996b11fe.js","./normalizeUtilsCommon-4aa2ad72.js","./WhereClause-ae8c5a06.js","./executionError-e8d36121.js","./json-48e3ea08.js","./QueryEngineCapabilities-42e44ded.js","./utils-a3586684.js","./generateRendererUtils-0f364d1e.js","./FeatureStore-48143fe8.js","./BoundsStore-d475102f.js","./projectExtentUtils-d31b5a37.js","./LayerView3D-af974166.js","./query-2b60d096.js","./pbfQueryUtils-93c2b136.js","./pbf-725ddaf6.js","./EventedSet-9f3fb8de.js","./LayerView-535107ac.js","./RefreshableLayerView-10c78a74.js"],import.meta.url),geojson:()=>ae(()=>import("./GeoJSONLayerView3D-a8df4f1b.js"),["./GeoJSONLayerView3D-a8df4f1b.js","./FeatureLayerViewBase3D-680cfbad.js","./FeatureLikeLayerView3D-0a06e10d.js","./dehydratedFeatureComparison-d30367d4.js","./queryForSymbologySnapping-be0451bb.js","./elevationInfoUtils-287337e4.js","./hash-6f442295.js","./Graphics3DScaleVisibility-eaf5a046.js","./rendererConversion-22515807.js","./optimizedFeatureQueryEngineAdapter-f5f88773.js","./centroid-3dcadaf5.js","./PooledRBush-506b9510.js","./quickselect-d16016af.js","./floorFilterUtils-73949d2d.js","./QueryEngine-360bd3bb.js","./normalizeUtils-996b11fe.js","./normalizeUtilsCommon-4aa2ad72.js","./WhereClause-ae8c5a06.js","./executionError-e8d36121.js","./json-48e3ea08.js","./QueryEngineCapabilities-42e44ded.js","./utils-a3586684.js","./generateRendererUtils-0f364d1e.js","./FeatureStore-48143fe8.js","./BoundsStore-d475102f.js","./projectExtentUtils-d31b5a37.js","./LayerView3D-af974166.js","./query-2b60d096.js","./pbfQueryUtils-93c2b136.js","./pbf-725ddaf6.js","./EventedSet-9f3fb8de.js","./LayerView-535107ac.js","./RefreshableLayerView-10c78a74.js"],import.meta.url),graphics:()=>ae(()=>import("./GraphicsLayerView3D-810caf12.js"),["./GraphicsLayerView3D-810caf12.js","./LayerView3D-af974166.js","./queryForSymbologySnapping-be0451bb.js","./elevationInfoUtils-287337e4.js","./GraphicsProcessor-2061d640.js","./Graphics3DScaleVisibility-eaf5a046.js","./rendererConversion-22515807.js","./optimizedFeatureQueryEngineAdapter-f5f88773.js","./centroid-3dcadaf5.js","./PooledRBush-506b9510.js","./quickselect-d16016af.js","./projectExtentUtils-d31b5a37.js","./LayerView-535107ac.js"],import.meta.url),group:()=>ae(()=>import("./GroupLayerView-b7a82aa8.js"),["./GroupLayerView-b7a82aa8.js","./LayerView-535107ac.js"],import.meta.url),imagery:()=>ae(()=>import("./ImageryLayerView3D-77b0d3a3.js"),["./ImageryLayerView3D-77b0d3a3.js","./DynamicLayerView3D-43ed5e7b.js","./LayerView3D-af974166.js","./projectExtentUtils-d31b5a37.js","./ImageMaterial-0a3b496e.js","./LayerView-535107ac.js","./RefreshableLayerView-10c78a74.js"],import.meta.url),"integrated-mesh":()=>ae(()=>import("./IntegratedMeshLayerView3D-6f0d1e6b.js"),["./IntegratedMeshLayerView3D-6f0d1e6b.js","./I3SMeshView3D-1d7d8215.js","./I3SOverrides-50df23d3.js","./I3SNode-7e746cc9.js","./meshFeatureSet-93794d5a.js","./Mesh-d3af21f3.js","./MeshGeoreferencedRelativeVertexSpace-4cbafb45.js","./MeshLocalVertexSpace-0353b8cf.js","./MeshTransform-d557c89a.js","./georeference-ab089445.js","./External-2117cdfc.js","./FeatureLayerView3D-b3bb5f6d.js","./FeatureLayerViewBase3D-680cfbad.js","./FeatureLikeLayerView3D-0a06e10d.js","./dehydratedFeatureComparison-d30367d4.js","./queryForSymbologySnapping-be0451bb.js","./elevationInfoUtils-287337e4.js","./hash-6f442295.js","./Graphics3DScaleVisibility-eaf5a046.js","./rendererConversion-22515807.js","./optimizedFeatureQueryEngineAdapter-f5f88773.js","./centroid-3dcadaf5.js","./PooledRBush-506b9510.js","./quickselect-d16016af.js","./floorFilterUtils-73949d2d.js","./QueryEngine-360bd3bb.js","./normalizeUtils-996b11fe.js","./normalizeUtilsCommon-4aa2ad72.js","./WhereClause-ae8c5a06.js","./executionError-e8d36121.js","./json-48e3ea08.js","./QueryEngineCapabilities-42e44ded.js","./utils-a3586684.js","./generateRendererUtils-0f364d1e.js","./FeatureStore-48143fe8.js","./BoundsStore-d475102f.js","./projectExtentUtils-d31b5a37.js","./LayerView3D-af974166.js","./query-2b60d096.js","./pbfQueryUtils-93c2b136.js","./pbf-725ddaf6.js","./EventedSet-9f3fb8de.js","./LayerView-535107ac.js","./RefreshableLayerView-10c78a74.js","./SceneModification-26432643.js","./SceneLayerWorker-335e8e8a.js"],import.meta.url),"line-of-sight":()=>ae(()=>import("./LineOfSightLayerView3D-b169e10e.js"),["./LineOfSightLayerView3D-b169e10e.js","./LayerView3D-af974166.js","./LayerView-535107ac.js"],import.meta.url),"map-image":()=>ae(()=>import("./MapImageLayerView3D-b167fe38.js"),["./MapImageLayerView3D-b167fe38.js","./DynamicLayerView3D-43ed5e7b.js","./LayerView3D-af974166.js","./projectExtentUtils-d31b5a37.js","./ImageMaterial-0a3b496e.js","./LayerView-535107ac.js","./RefreshableLayerView-10c78a74.js","./ExportImageParameters-7717516b.js","./floorFilterUtils-73949d2d.js","./sublayerUtils-7f6367bc.js","./MapServiceLayerViewHelper-0ceb32ca.js","./drapedUtils-2204a7de.js","./normalizeUtils-996b11fe.js","./normalizeUtilsCommon-4aa2ad72.js"],import.meta.url),media:()=>ae(()=>import("./MediaLayerView3D-a914831a.js"),["./MediaLayerView3D-a914831a.js","./MediaElementView-9c31a791.js","./normalizeUtilsSync-f1a97bc7.js","./normalizeUtilsCommon-4aa2ad72.js","./LayerView3D-af974166.js","./ImageMaterial-0a3b496e.js","./LayerView-535107ac.js"],import.meta.url),"ogc-feature":()=>ae(()=>import("./OGCFeatureLayerView3D-d6b1d624.js"),["./OGCFeatureLayerView3D-d6b1d624.js","./FeatureLayerViewBase3D-680cfbad.js","./FeatureLikeLayerView3D-0a06e10d.js","./dehydratedFeatureComparison-d30367d4.js","./queryForSymbologySnapping-be0451bb.js","./elevationInfoUtils-287337e4.js","./hash-6f442295.js","./Graphics3DScaleVisibility-eaf5a046.js","./rendererConversion-22515807.js","./optimizedFeatureQueryEngineAdapter-f5f88773.js","./centroid-3dcadaf5.js","./PooledRBush-506b9510.js","./quickselect-d16016af.js","./floorFilterUtils-73949d2d.js","./QueryEngine-360bd3bb.js","./normalizeUtils-996b11fe.js","./normalizeUtilsCommon-4aa2ad72.js","./WhereClause-ae8c5a06.js","./executionError-e8d36121.js","./json-48e3ea08.js","./QueryEngineCapabilities-42e44ded.js","./utils-a3586684.js","./generateRendererUtils-0f364d1e.js","./FeatureStore-48143fe8.js","./BoundsStore-d475102f.js","./projectExtentUtils-d31b5a37.js","./LayerView3D-af974166.js","./query-2b60d096.js","./pbfQueryUtils-93c2b136.js","./pbf-725ddaf6.js","./EventedSet-9f3fb8de.js","./LayerView-535107ac.js","./RefreshableLayerView-10c78a74.js"],import.meta.url),"open-street-map":JE,"oriented-imagery":()=>ae(()=>import("./FeatureLayerView3D-b3bb5f6d.js"),["./FeatureLayerView3D-b3bb5f6d.js","./FeatureLayerViewBase3D-680cfbad.js","./FeatureLikeLayerView3D-0a06e10d.js","./dehydratedFeatureComparison-d30367d4.js","./queryForSymbologySnapping-be0451bb.js","./elevationInfoUtils-287337e4.js","./hash-6f442295.js","./Graphics3DScaleVisibility-eaf5a046.js","./rendererConversion-22515807.js","./optimizedFeatureQueryEngineAdapter-f5f88773.js","./centroid-3dcadaf5.js","./PooledRBush-506b9510.js","./quickselect-d16016af.js","./floorFilterUtils-73949d2d.js","./QueryEngine-360bd3bb.js","./normalizeUtils-996b11fe.js","./normalizeUtilsCommon-4aa2ad72.js","./WhereClause-ae8c5a06.js","./executionError-e8d36121.js","./json-48e3ea08.js","./QueryEngineCapabilities-42e44ded.js","./utils-a3586684.js","./generateRendererUtils-0f364d1e.js","./FeatureStore-48143fe8.js","./BoundsStore-d475102f.js","./projectExtentUtils-d31b5a37.js","./LayerView3D-af974166.js","./query-2b60d096.js","./pbfQueryUtils-93c2b136.js","./pbf-725ddaf6.js","./EventedSet-9f3fb8de.js","./LayerView-535107ac.js","./RefreshableLayerView-10c78a74.js"],import.meta.url),"point-cloud":()=>ae(()=>import("./PointCloudLayerView3D-150bf5d7.js").then(t=>t.P),["./PointCloudLayerView3D-150bf5d7.js","./LayerView3D-af974166.js","./PointCloudWorkerUtil-6fa19a78.js","./PointCloudUniqueValueRenderer-737725b8.js","./PopupSceneLayerView-5bd6a30f.js","./LayerView-535107ac.js"],import.meta.url),voxel:()=>ae(()=>import("./VoxelLayerView3D-97b4ffd2.js"),["./VoxelLayerView3D-97b4ffd2.js","./LayerView3D-af974166.js","./PopupSceneLayerView-5bd6a30f.js","./LayerView-535107ac.js"],import.meta.url),route:()=>ae(()=>import("./RouteLayerView3D-320f3409.js"),["./RouteLayerView3D-320f3409.js","./Stop-64aec423.js","./LayerView3D-af974166.js","./GraphicsProcessor-2061d640.js","./Graphics3DScaleVisibility-eaf5a046.js","./rendererConversion-22515807.js","./optimizedFeatureQueryEngineAdapter-f5f88773.js","./centroid-3dcadaf5.js","./PooledRBush-506b9510.js","./quickselect-d16016af.js","./projectExtentUtils-d31b5a37.js","./EventedSet-9f3fb8de.js","./LayerView-535107ac.js"],import.meta.url),scene:t=>t.profile==null||t.profile==="mesh-pyramids"?ae(()=>import("./SceneLayerView3D-e68fc4d0.js"),["./SceneLayerView3D-e68fc4d0.js","./I3SOverrides-50df23d3.js","./I3SNode-7e746cc9.js","./meshFeatureSet-93794d5a.js","./Mesh-d3af21f3.js","./MeshGeoreferencedRelativeVertexSpace-4cbafb45.js","./MeshLocalVertexSpace-0353b8cf.js","./MeshTransform-d557c89a.js","./georeference-ab089445.js","./External-2117cdfc.js","./FeatureLayerView3D-b3bb5f6d.js","./FeatureLayerViewBase3D-680cfbad.js","./FeatureLikeLayerView3D-0a06e10d.js","./dehydratedFeatureComparison-d30367d4.js","./queryForSymbologySnapping-be0451bb.js","./elevationInfoUtils-287337e4.js","./hash-6f442295.js","./Graphics3DScaleVisibility-eaf5a046.js","./rendererConversion-22515807.js","./optimizedFeatureQueryEngineAdapter-f5f88773.js","./centroid-3dcadaf5.js","./PooledRBush-506b9510.js","./quickselect-d16016af.js","./floorFilterUtils-73949d2d.js","./QueryEngine-360bd3bb.js","./normalizeUtils-996b11fe.js","./normalizeUtilsCommon-4aa2ad72.js","./WhereClause-ae8c5a06.js","./executionError-e8d36121.js","./json-48e3ea08.js","./QueryEngineCapabilities-42e44ded.js","./utils-a3586684.js","./generateRendererUtils-0f364d1e.js","./FeatureStore-48143fe8.js","./BoundsStore-d475102f.js","./projectExtentUtils-d31b5a37.js","./LayerView3D-af974166.js","./query-2b60d096.js","./pbfQueryUtils-93c2b136.js","./pbf-725ddaf6.js","./EventedSet-9f3fb8de.js","./LayerView-535107ac.js","./RefreshableLayerView-10c78a74.js","./I3SMeshView3D-1d7d8215.js","./SceneModification-26432643.js","./SceneLayerWorker-335e8e8a.js","./SceneLayerView-949413c5.js","./DefinitionExpressionSceneLayerView-e46f6be9.js","./I3SQueryFeatureStore-0e97c15a.js","./PopupSceneLayerView-5bd6a30f.js"],import.meta.url):ae(()=>import("./SceneLayerGraphicsView3D-99a6a54c.js"),["./SceneLayerGraphicsView3D-99a6a54c.js","./I3SOverrides-50df23d3.js","./I3SNode-7e746cc9.js","./meshFeatureSet-93794d5a.js","./Mesh-d3af21f3.js","./MeshGeoreferencedRelativeVertexSpace-4cbafb45.js","./MeshLocalVertexSpace-0353b8cf.js","./MeshTransform-d557c89a.js","./georeference-ab089445.js","./External-2117cdfc.js","./FeatureLayerView3D-b3bb5f6d.js","./FeatureLayerViewBase3D-680cfbad.js","./FeatureLikeLayerView3D-0a06e10d.js","./dehydratedFeatureComparison-d30367d4.js","./queryForSymbologySnapping-be0451bb.js","./elevationInfoUtils-287337e4.js","./hash-6f442295.js","./Graphics3DScaleVisibility-eaf5a046.js","./rendererConversion-22515807.js","./optimizedFeatureQueryEngineAdapter-f5f88773.js","./centroid-3dcadaf5.js","./PooledRBush-506b9510.js","./quickselect-d16016af.js","./floorFilterUtils-73949d2d.js","./QueryEngine-360bd3bb.js","./normalizeUtils-996b11fe.js","./normalizeUtilsCommon-4aa2ad72.js","./WhereClause-ae8c5a06.js","./executionError-e8d36121.js","./json-48e3ea08.js","./QueryEngineCapabilities-42e44ded.js","./utils-a3586684.js","./generateRendererUtils-0f364d1e.js","./FeatureStore-48143fe8.js","./BoundsStore-d475102f.js","./projectExtentUtils-d31b5a37.js","./LayerView3D-af974166.js","./query-2b60d096.js","./pbfQueryUtils-93c2b136.js","./pbf-725ddaf6.js","./EventedSet-9f3fb8de.js","./LayerView-535107ac.js","./RefreshableLayerView-10c78a74.js","./SceneLayerView-949413c5.js","./DefinitionExpressionSceneLayerView-e46f6be9.js","./PopupSceneLayerView-5bd6a30f.js"],import.meta.url),stream:()=>ae(()=>import("./StreamLayerView3D-660dcaec.js"),["./StreamLayerView3D-660dcaec.js","./StreamFeatureManager-696fe8d3.js","./createConnection-c5247714.js","./query-2b60d096.js","./normalizeUtils-996b11fe.js","./normalizeUtilsCommon-4aa2ad72.js","./pbfQueryUtils-93c2b136.js","./pbf-725ddaf6.js","./EventedSet-9f3fb8de.js","./FeatureLikeLayerView3D-0a06e10d.js","./dehydratedFeatureComparison-d30367d4.js","./queryForSymbologySnapping-be0451bb.js","./elevationInfoUtils-287337e4.js","./hash-6f442295.js","./Graphics3DScaleVisibility-eaf5a046.js","./rendererConversion-22515807.js","./optimizedFeatureQueryEngineAdapter-f5f88773.js","./centroid-3dcadaf5.js","./PooledRBush-506b9510.js","./quickselect-d16016af.js","./floorFilterUtils-73949d2d.js","./QueryEngine-360bd3bb.js","./WhereClause-ae8c5a06.js","./executionError-e8d36121.js","./json-48e3ea08.js","./QueryEngineCapabilities-42e44ded.js","./utils-a3586684.js","./generateRendererUtils-0f364d1e.js","./FeatureStore-48143fe8.js","./BoundsStore-d475102f.js","./projectExtentUtils-d31b5a37.js","./LayerView3D-af974166.js","./LayerView-535107ac.js"],import.meta.url),tile:JE,"imagery-tile":()=>ae(()=>import("./ImageryTileLayerView3D-51046fdc.js"),["./ImageryTileLayerView3D-51046fdc.js","./LayerView3D-af974166.js","./TiledLayerView3D-52dae82c.js","./rasterProjectionHelper-e968ac1d.js","./LayerView-535107ac.js","./RefreshableLayerView-10c78a74.js","./drapedUtils-2204a7de.js"],import.meta.url),"vector-tile":()=>ae(()=>import("./VectorTileLayerView3D-3a051b4e.js"),["./VectorTileLayerView3D-3a051b4e.js","./Rect-98da58d6.js","./pbf-725ddaf6.js","./rasterizingUtils-4b81019f.js","./TileInfoView-81874107.js","./definitions-40cbc24b.js","./number-e491b09e.js","./GeometryUtils-0258f920.js","./StyleRepository-3a6b235e.js","./colorUtils-c0f43caf.js","./TileClipper-ae6eca9e.js","./LayerView3D-af974166.js","./TiledLayerView3D-52dae82c.js","./LayerView-535107ac.js"],import.meta.url),wcs:()=>ae(()=>import("./ImageryTileLayerView3D-51046fdc.js"),["./ImageryTileLayerView3D-51046fdc.js","./LayerView3D-af974166.js","./TiledLayerView3D-52dae82c.js","./rasterProjectionHelper-e968ac1d.js","./LayerView-535107ac.js","./RefreshableLayerView-10c78a74.js","./drapedUtils-2204a7de.js"],import.meta.url),"web-tile":JE,wfs:()=>ae(()=>import("./WFSLayerView3D-7f735aa5.js"),["./WFSLayerView3D-7f735aa5.js","./FeatureLayerViewBase3D-680cfbad.js","./FeatureLikeLayerView3D-0a06e10d.js","./dehydratedFeatureComparison-d30367d4.js","./queryForSymbologySnapping-be0451bb.js","./elevationInfoUtils-287337e4.js","./hash-6f442295.js","./Graphics3DScaleVisibility-eaf5a046.js","./rendererConversion-22515807.js","./optimizedFeatureQueryEngineAdapter-f5f88773.js","./centroid-3dcadaf5.js","./PooledRBush-506b9510.js","./quickselect-d16016af.js","./floorFilterUtils-73949d2d.js","./QueryEngine-360bd3bb.js","./normalizeUtils-996b11fe.js","./normalizeUtilsCommon-4aa2ad72.js","./WhereClause-ae8c5a06.js","./executionError-e8d36121.js","./json-48e3ea08.js","./QueryEngineCapabilities-42e44ded.js","./utils-a3586684.js","./generateRendererUtils-0f364d1e.js","./FeatureStore-48143fe8.js","./BoundsStore-d475102f.js","./projectExtentUtils-d31b5a37.js","./LayerView3D-af974166.js","./query-2b60d096.js","./pbfQueryUtils-93c2b136.js","./pbf-725ddaf6.js","./EventedSet-9f3fb8de.js","./LayerView-535107ac.js","./RefreshableLayerView-10c78a74.js"],import.meta.url),wms:()=>ae(()=>import("./WMSLayerView3D-5c114ed5.js"),["./WMSLayerView3D-5c114ed5.js","./DynamicLayerView3D-43ed5e7b.js","./LayerView3D-af974166.js","./projectExtentUtils-d31b5a37.js","./ImageMaterial-0a3b496e.js","./LayerView-535107ac.js","./RefreshableLayerView-10c78a74.js","./ExportWMSImageParameters-961e794c.js"],import.meta.url),wmts:()=>ae(()=>import("./WMTSLayerView3D-5072ab79.js"),["./WMTSLayerView3D-5072ab79.js","./LayerView3D-af974166.js","./TiledLayerView3D-52dae82c.js","./LayerView-535107ac.js","./RefreshableLayerView-10c78a74.js"],import.meta.url),"geo-rss":null,kml:null,"knowledge-graph":null,"link-chart":null,"knowledge-graph-sublayer":null,"map-notes":null,"subtype-group":null,unknown:null,unsupported:null,video:null};function nYe(t){const e=t.declaredClass?t.declaredClass.slice(t.declaredClass.lastIndexOf(".")+1):"Unknown",r=e.replaceAll(/([a-z])([A-Z])/g,"$1-$2").toLowerCase();return new F(`${r}:view-not-supported`,`${e} is not supported in 3D`)}const Yre={hasLayerViewModule:t=>Xre[t.type]!=null,importLayerView:t=>{const e=Xre[t.type];if(e==null)throw nYe(t);return e(t)}},Jre="analyses-owner-handles";var nS,tb;(function(t){t[t.PENDING=0]="PENDING",t[t.CREATED=1]="CREATED"})(nS||(nS={})),function(t){t[t.ADDED=0]="ADDED",t[t.REMOVED=1]="REMOVED"}(tb||(tb={}));let P1=class extends yO{constructor(e){super(e),this._allAnalysisViews=new Pt,this._creatingViewCount=0,this._items=new Map,this._scheduledUpdateHandle=null,this._attachedToViewResolver=Qre(),this._analysisModules={"area-measurement":{module:null},dimension:{module:null},"direct-line-measurement":{module:null},"line-of-sight":{module:null},slice:{module:null}}}destroy(){this._disconnectOwners(),this._attachedToViewResolver.reject(Dr("AnalysisViewManager was destroyed"))}attach(){this._connectOwners(),this._attachedToViewResolver.resolve()}detach(){this._disconnectOwners(),this._attachedToViewResolver.reject(Dr()),this._attachedToViewResolver=Qre()}get updating(){return!this.view.ready||this._creatingViewCount!==0||this._allAnalysisViews.some(e=>e.updating)}get testInfo(){return{allAnalysisViews:this._allAnalysisViews}}async whenAnalysisView(e){await this._attachedToViewResolver.promise;const r=this._items.get(e);if(r==null||r.state.list===tb.REMOVED)throw new F("AnalysisViewManager:no-analysisview-for-analysis","The analysis has not been added to view.analyses",{analysis:e});return r.createAnalysisViewTask.promise}_connectOwners(){this.handles.add(this._connectAnalysesCollection(this.view.analyses),Jre)}_disconnectOwners(){this.handles.remove(Jre),this._update(),this._creatingViewCount=0}_connectAnalysesCollection(e){for(const s of e)this._addAnalysis(s);const r=e.on("after-add",s=>this._addAnalysis(s.item)),i=e.on("after-remove",s=>this._removeAnalysis(s.item));return{remove:()=>{r.remove(),i.remove();for(const s of e)this._removeAnalysis(s)}}}_addAnalysis(e){const r=this._items.get(e);if(r==null){const i={state:{view:nS.PENDING,list:tb.ADDED},analysis:e,view:null,createAnalysisViewTask:null};this._items.set(e,i),i.createAnalysisViewTask=uE(s=>this._createAnalysisViewPromise(i,s))}else r.state.list=tb.ADDED}_removeAnalysis(e){const r=this._items.get(e);r!=null?(r.state.list=tb.REMOVED,this._scheduleUpdate()):Q.getLogger(this).error("Trying to remove analysis which was not added")}_scheduleUpdate(){this._scheduledUpdateHandle==null&&(this._scheduledUpdateHandle=J2(()=>this._update()))}_update(){this._scheduledUpdateHandle=Ii(this._scheduledUpdateHandle),this._items.forEach(e=>{if(e.state.list===tb.REMOVED)switch(this._items.delete(e.analysis),e.state.view){case nS.PENDING:e.createAnalysisViewTask=pu(e.createAnalysisViewTask);break;case nS.CREATED:e.view!=null&&(this._allAnalysisViews.remove(e.view),e.view=Me(e.view),e.createAnalysisViewTask=null)}})}async _createAnalysisViewPromise(e,r){const i=e.analysis,s=i.type,n=this._analysisModules[s];if(this._creatingViewCount+=1,n.module==null)try{n.module=await this._loadAnalysisModule(s)}catch(a){throw this._creatingViewCount-=1,a}if(sn(r))throw this._creatingViewCount-=1,Dr("AnalysisView creation aborted");const o=new n.module.default({analysis:i,view:this.view});try{await o.when()}catch(a){throw this._creatingViewCount-=1,a}if(sn(r))throw this._creatingViewCount-=1,o.destroy(),Dr("AnalysisView creation aborted");return e.view=o,e.state.view=nS.CREATED,this._allAnalysisViews.add(o),this._creatingViewCount-=1,o}_loadAnalysisModule(e){switch(e){case"area-measurement":return ae(()=>import("./AreaMeasurementAnalysisView3D-a9e5db7d.js").then(r=>r.A),["./AreaMeasurementAnalysisView3D-a9e5db7d.js","./UnitNormalizer-edf1cd88.js","./getDefaultUnitForView-33179f7a.js","./unitFormatUtils-b50d8ff8.js","./AnalysisView3D-797ede55.js","./geometryEngine-547e4a01.js","./geometryEngineBase-d69ff1ad.js","./hydrated-e6cbef23.js","./geodesicUtils-04ddd9a4.js","./euclideanAreaMeasurementUtils-00f3f32f.js","./measurementUtils-c24c5920.js","./LineVisualElement-edcd3279.js","./EditGeometryOperations-73b5f5f7.js","./geometry2dUtils-9d16f4f8.js","./analysisThemeUtils-558736fc.js","./colorUtils-fa6b524d.js","./colorUtils-c0f43caf.js","./Segment-11bdf3c4.js","./viewUtils-ca2c33e3.js","./elevationInfoUtils-287337e4.js","./TextOverlayItem-ebd9edd4.js"],import.meta.url);case"dimension":return ae(()=>import("./DimensionAnalysisView3D-ffce36dd.js"),["./DimensionAnalysisView3D-ffce36dd.js","./AnalysisView3D-797ede55.js","./LengthDimension-e00dc09e.js","./getDefaultUnitForView-33179f7a.js","./unitFormatUtils-b50d8ff8.js","./Segment-11bdf3c4.js","./LineVisualElement-edcd3279.js","./viewUtils-ca2c33e3.js","./elevationInfoUtils-287337e4.js","./TextOverlayItem-ebd9edd4.js","./euclideanLengthMeasurementUtils-8f8f7aa9.js","./measurementUtils-c24c5920.js","./analysisThemeUtils-558736fc.js","./colorUtils-fa6b524d.js","./colorUtils-c0f43caf.js","./manipulatorUtils-1c1ed0c0.js","./ImageMaterial-0a3b496e.js","./Factory-ee11222a.js","./dragEventPipeline-491faa8f.js","./drawUtils-f091ac1a.js","./VerticesVisualElement-7ac51104.js","./RightAngleQuadVisualElement-46e9d25f.js","./VisualElementResources-345e70b2.js","./PointVisualElement-62697d84.js","./SnappingManager-e561e372.js","./geometry2dUtils-9d16f4f8.js","./SnappingContext-d538137b.js","./PointSnappingHint-b8c54ed3.js","./EditGeometryOperations-73b5f5f7.js","./SnappingOperation-e7779836.js","./dehydratedFeatureComparison-d30367d4.js","./analysisViewUtils-58c58951.js"],import.meta.url);case"direct-line-measurement":return ae(()=>import("./DirectLineMeasurementAnalysisView3D-4a8cd79f.js").then(r=>r.D),["./DirectLineMeasurementAnalysisView3D-4a8cd79f.js","./UnitNormalizer-edf1cd88.js","./getDefaultUnitForView-33179f7a.js","./unitFormatUtils-b50d8ff8.js","./AnalysisView3D-797ede55.js","./geometryEngine-547e4a01.js","./geometryEngineBase-d69ff1ad.js","./hydrated-e6cbef23.js","./geodesicUtils-04ddd9a4.js","./LineVisualElement-edcd3279.js","./analysisThemeUtils-558736fc.js","./colorUtils-fa6b524d.js","./colorUtils-c0f43caf.js","./Segment-11bdf3c4.js","./viewUtils-ca2c33e3.js","./elevationInfoUtils-287337e4.js","./TextOverlayItem-ebd9edd4.js","./RightAngleQuadVisualElement-46e9d25f.js","./VisualElementResources-345e70b2.js"],import.meta.url);case"line-of-sight":return ae(()=>import("./LineOfSightAnalysisView3D-ed57f0e3.js"),["./LineOfSightAnalysisView3D-ed57f0e3.js","./AnalysisView3D-797ede55.js","./LineOfSightAnalysisTarget-97c1d998.js","./elevationInfoUtils-287337e4.js","./LineVisualElement-edcd3279.js","./analysisThemeUtils-558736fc.js","./colorUtils-fa6b524d.js","./colorUtils-c0f43caf.js","./manipulatorUtils-1c1ed0c0.js","./ImageMaterial-0a3b496e.js","./manipulatorUtils-cf589e3d.js","./PointVisualElement-62697d84.js","./VisualElementResources-345e70b2.js","./analysisViewUtils-58c58951.js","./dragEventPipeline-491faa8f.js","./drawUtils-f091ac1a.js"],import.meta.url);case"slice":return ae(()=>import("./SliceAnalysisView3D-a84e44f8.js"),["./SliceAnalysisView3D-a84e44f8.js","./AnalysisView3D-797ede55.js","./sliceToolUtils-46cb6f04.js","./analysisThemeUtils-558736fc.js","./colorUtils-fa6b524d.js","./colorUtils-c0f43caf.js","./LineVisualElement-edcd3279.js","./manipulatorUtils-1c1ed0c0.js","./ImageMaterial-0a3b496e.js","./BuildingComponentSublayer-7b41056b.js","./Factory-ee11222a.js","./elevationInfoUtils-287337e4.js","./dragEventPipeline-491faa8f.js","./drawUtils-f091ac1a.js","./analysisViewUtils-58c58951.js"],import.meta.url)}}};function Qre(){const t=qs();return t.promise.catch(()=>{}),t}u([d()],P1.prototype,"updating",null),u([d({constructOnly:!0})],P1.prototype,"view",void 0),u([d()],P1.prototype,"_allAnalysisViews",void 0),u([d()],P1.prototype,"_creatingViewCount",void 0),P1=u([R("esri.views.3d.analysis.AnalysisViewManager3D")],P1);const oYe=P1;let Hm=class extends Te{constructor(e){super(e),this.collision=new FA,this.distance=1/0,this.minimumPoiDistance=4,this.tilt=null}get altitude(){return this.mode===De.Local?null:this._get("altitude")||null}set altitude(e){this.mode!==De.Local?this._set("altitude",e):Q.getLogger(this).warn("Altitude constraint is ignored in local scenes")}clampAltitude(e){return this.altitude?ge(e,this.altitude.min,this.altitude.max):e}clampTilt(e,r){if(!this.tilt)return r;const i=this.tilt(e);return ge(r,i.min,i.max)}clampDistance(e){return Math.min(e,this.distance)}createDefaultTilt(){return this.mode===De.Local?this._createDefaultTiltLocal():this._createDefaultTiltGlobal()}createConstantMaxTilt(e){return(r,i=t8)=>(i.min=$o.min,i.max=e,i)}_createDefaultTiltLocal(){const e=this.collision.enabled?kL([[4e3,$o.max],[1e4,Dt(88)],[6e6,Dt(88)]]):()=>$o.max;return(r,i=t8)=>(i.min=$o.min,i.max=e(r),i)}_createDefaultTiltGlobal(){const e=this.collision.enabled?kL([[4e3,$o.max],[5e4,Dt(88)],[6e6,Dt(88)],[2e7,$o.min]]):kL([[3e5,$o.max],[3e6,Dt(88)],[6e6,Dt(88)],[2e7,$o.min]]);return(r,i=t8)=>(i.min=$o.min,i.max=e(r),i)}};function aYe(t){return{min:-2e5,max:4*t.radius}}u([d()],Hm.prototype,"altitude",null),u([d({readOnly:!0})],Hm.prototype,"collision",void 0),u([d()],Hm.prototype,"distance",void 0),u([d({readOnly:!0})],Hm.prototype,"minimumPoiDistance",void 0),u([d()],Hm.prototype,"tilt",void 0),u([d({constructOnly:!0})],Hm.prototype,"mode",void 0),Hm=u([R("esri.views.3d.state.Constraints")],Hm);const Kre=aYe(nr),$o={min:Dt(.5),max:Dt(179.5)},t8={min:0,max:0};let FA=class extends Te{constructor(){super(...arguments),this.enabled=!0,this.elevationMargin=5}};u([d({type:Boolean})],FA.prototype,"enabled",void 0),u([d({type:Number})],FA.prototype,"elevationMargin",void 0),FA=u([R("esri.views.3d.state.Constraints.CollisionConstraint")],FA);let oS=class extends Te{constructor(){super(...arguments),this.min=Kre.min,this.max=Kre.max}};u([d({type:Number})],oS.prototype,"min",void 0),u([d({type:Number})],oS.prototype,"max",void 0),oS=u([R("esri.views.3d.constraints.AltitudeConstraint")],oS);let tg=class extends Te{constructor(){super(...arguments),this.mode="auto"}get near(){return this._get("near")}set near(e){this._set("near",e),e>=this._get("far")&&(this.far=e+1e-9),this.mode="manual"}castNear(e){return Math.max(1e-8,e)}get far(){return this._get("far")}set far(e){this._set("far",e),e<=this._get("near")&&(this.near=e-1e-9),this.mode="manual"}castFar(e){return Math.max(1e-8,e)}autoUpdate(e,r){this.mode==="auto"&&(this._get("near")!==e&&this._set("near",e),this._get("far")!==r&&this._set("far",r))}};u([d({type:Number,value:1e-8})],tg.prototype,"near",null),u([yr("near")],tg.prototype,"castNear",null),u([d({type:Number,value:1e-8})],tg.prototype,"far",null),u([yr("far")],tg.prototype,"castFar",null),u([d({type:["auto","manual"]})],tg.prototype,"mode",void 0),tg=u([R("esri.views.3d.constraints.ClipDistanceConstraint")],tg);const TG={min:qa($o.min),max:qa($o.max)};let rb=class extends Te{constructor(){super(...arguments),this.mode="auto"}get max(){return this._get("max")}set max(e){this._set("max",e),this.mode="manual"}castMax(e){return ge(e,TG.min,TG.max)}autoUpdate(e){this.mode==="auto"&&this._get("max")!==e&&this._set("max",e)}};u([d({type:["auto","manual"]})],rb.prototype,"mode",void 0),u([d({type:Number,value:TG.max})],rb.prototype,"max",null),u([yr("max")],rb.prototype,"castMax",null),rb=u([R("esri.views.3d.constraints.TiltConstraint")],rb);let ib=class extends Te{constructor(){super(...arguments),this.tilt=new rb,this.altitude=new oS,this.clipDistance=new tg}};u([d({type:rb})],ib.prototype,"tilt",void 0),u([d({type:oS})],ib.prototype,"altitude",void 0),u([d({type:tg})],ib.prototype,"clipDistance",void 0),ib=u([R("esri.views.3d.constraints.Constraints")],ib);var SG;let Hu=SG=class extends de{constructor(t){super(t),this.type="sun",this.date=null,this.directShadowsEnabled=!1,this.displayUTCOffset=null}readDate(t,e){return e.datetime!=null&&new Date(e.datetime)||null}writeDate(t,e,r){e[r]=t.getTime()}readDirectShadowsEnabled(t,e){return!!e.directShadows}writedirectShadowsEnabled(t,e,r){t&&(e[r]=t)}writeDisplayUTCOffset(t,e){t!=null&&(e.displayUTCOffset=t)}clone(){return new SG(this.cloneConstructProperties())}cloneConstructProperties(){const t={directShadowsEnabled:this.directShadowsEnabled,displayUTCOffset:this.displayUTCOffset!=null?this.displayUTCOffset:null};return this.date!=null&&(t.date=new Date(this.date.getTime())),t}};u([d({readOnly:!0,type:["sun"],json:{write:!0}})],Hu.prototype,"type",void 0),u([d({type:Date,json:{type:Number,write:{target:"datetime"}}})],Hu.prototype,"date",void 0),u([Ee("date",["datetime"])],Hu.prototype,"readDate",null),u([Fe("date")],Hu.prototype,"writeDate",null),u([d({type:Boolean,json:{default:!1,write:{target:"directShadows"}}})],Hu.prototype,"directShadowsEnabled",void 0),u([Ee("directShadowsEnabled",["directShadows"])],Hu.prototype,"readDirectShadowsEnabled",null),u([Fe("directShadowsEnabled")],Hu.prototype,"writedirectShadowsEnabled",null),u([d({type:Number,json:{write:!0}})],Hu.prototype,"displayUTCOffset",void 0),u([Fe("displayUTCOffset")],Hu.prototype,"writeDisplayUTCOffset",null),Hu=SG=u([R("esri.webscene.SunLighting")],Hu);const HO=Hu;var IT;const lwe="esri.views.3d.environment.SunLighting",RM=Q.getLogger(lwe);let Qp=IT=class extends os.EventedMixin(HO){constructor(t){super(t),this.cameraTrackingEnabled=!0,this.positionTimezoneInfo={hours:0,minutes:0,seconds:0,autoUpdated:!0};const e=new Date().getFullYear(),r=new Date("March 15, "+e+" 12:00:00 UTC");this._set("defaultDate",r),this._set("date",r)}get ambientOcclusionEnabled(){return jd(RM,"ambientOcclusionEnabled",{replacement:"ambient occlusion is automatically shown and this property has no effect",version:"4.27"}),this._get("ambientOcclusionEnabled")??!1}set ambientOcclusionEnabled(t){jd(RM,"ambientOcclusionEnabled",{replacement:"ambient occlusion is automatically shown and this property has no effect",version:"4.27"}),this._set("ambientOcclusionEnabled",t)}get waterReflectionEnabled(){return jd(RM,"waterReflectionEnabled",{replacement:"reflections are automatically shown and this property has no effect",version:"4.27"}),this._get("waterReflectionEnabled")??!1}set waterReflectionEnabled(t){jd(RM,"waterReflectionEnabled",{replacement:"reflections are automatically shown and this property has no effect",version:"4.27"}),this._set("waterReflectionEnabled",t)}get defaultDate(){return new Date(this._get("defaultDate").getTime())}static fromWebsceneLighting(t){return new IT(t.cloneConstructProperties())}set defaultDate(t){const e=this._get("date")===this._get("defaultDate");t=new Date(t.getTime()),this._set("defaultDate",t),e&&this._set("date",t)}set date(t){t!=null&&(this.positionTimezoneInfo.autoUpdated=!1,this._set("date",new Date(t.getTime())))}autoUpdate(t,e){const r=IT.calculateTimezoneOffset(this.positionTimezoneInfo);this.positionTimezoneInfo.hours=e.hours,this.positionTimezoneInfo.minutes=e.minutes,this.positionTimezoneInfo.seconds=e.seconds;let i=null;t!=null&&(this.positionTimezoneInfo.autoUpdated=!0,isNaN(t.getTime())?(i=this.defaultDate.getTime(),this._set("date",this.defaultDate)):(i=this.date&&this.date.getTime(),this._set("date",new Date(t.getTime()))));const s=IT.calculateTimezoneOffset(this.positionTimezoneInfo);if(r!==s&&(PM.target=this,PM.timezoneOffset=s,this.emit("timezone-will-change",PM),PM.target=null),t!=null)return isNaN(t.getTime())||i!==t.getTime()}clone(){const t=this._get("date")===this._get("defaultDate"),e=new IT({...this.cloneConstructProperties(),defaultDate:this.defaultDate,cameraTrackingEnabled:this.cameraTrackingEnabled});return t&&e._set("date",e._get("defaultDate")),e.positionTimezoneInfo.autoUpdated=this.positionTimezoneInfo.autoUpdated,e.positionTimezoneInfo.hours=this.positionTimezoneInfo.hours,e.positionTimezoneInfo.minutes=this.positionTimezoneInfo.minutes,e.positionTimezoneInfo.seconds=this.positionTimezoneInfo.seconds,e}cloneWithWebsceneLighting(t){const e=this.clone();return t.date!=null&&(e.date=t.date),e.directShadowsEnabled=t.directShadowsEnabled,e.displayUTCOffset=t.displayUTCOffset,e}cloneNonPersistentConstructProperties(){return{cameraTrackingEnabled:this.cameraTrackingEnabled}}};u([d({type:Boolean})],Qp.prototype,"cameraTrackingEnabled",void 0),u([d({type:Boolean})],Qp.prototype,"ambientOcclusionEnabled",null),u([d({type:Boolean})],Qp.prototype,"waterReflectionEnabled",null),u([d({type:Date})],Qp.prototype,"defaultDate",null),u([d({type:Date})],Qp.prototype,"date",null),Qp=IT=u([R(lwe)],Qp),function(t){function e({hours:r,minutes:i,seconds:s}){return Math.round(r+i/60+s/3600)}t.calculateTimezoneOffset=e}(Qp||(Qp={}));const PM={target:null,timezoneOffset:0},w0=Qp;var EG;let UA=EG=class extends de{constructor(t){super(t),this.type="virtual",this.directShadowsEnabled=!1}clone(){return new EG(this.cloneConstructProperties())}cloneConstructProperties(){return{directShadowsEnabled:this.directShadowsEnabled}}};u([d({readOnly:!0,type:["virtual"],json:{write:!0}})],UA.prototype,"type",void 0),u([d({type:Boolean,json:{default:!1,name:"directShadows",write:!0}})],UA.prototype,"directShadowsEnabled",void 0),UA=EG=u([R("esri.webscene.VirtualLighting")],UA);const D5=UA;var HL;const cwe="esri.views.3d.environment.VirtualLighting",MM=Q.getLogger(cwe);let $T=HL=class extends os.EventedMixin(D5){constructor(t){super(t),this.cameraTrackingEnabled=!0}get ambientOcclusionEnabled(){return jd(MM,"ambientOcclusionEnabled",{replacement:"ambient occlusion is automatically shown and this property has no effect",version:"4.27"}),this._get("ambientOcclusionEnabled")??!1}set ambientOcclusionEnabled(t){jd(MM,"ambientOcclusionEnabled",{replacement:"ambient occlusion is automatically shown and this property has no effect",version:"4.27"}),this._set("ambientOcclusionEnabled",t)}get waterReflectionEnabled(){return jd(MM,"waterReflectionEnabled",{replacement:"water reflections are automatically shown and this property has no effect",version:"4.27"}),this._get("waterReflectionEnabled")??!1}set waterReflectionEnabled(t){jd(MM,"waterReflectionEnabled",{replacement:"water reflections are automatically shown and this property has no effect",version:"4.27"}),this._set("waterReflectionEnabled",t)}clone(){return new HL({...this.cloneConstructProperties(),cameraTrackingEnabled:this.cameraTrackingEnabled})}static fromWebsceneLighting(t){return new HL(t.cloneConstructProperties())}cloneWithWebsceneLighting(t){const e=this.clone();return e.directShadowsEnabled=t.directShadowsEnabled,e}cloneNonPersistentConstructProperties(){return{cameraTrackingEnabled:this.cameraTrackingEnabled}}};u([d({type:Boolean})],$T.prototype,"ambientOcclusionEnabled",null),u([d({type:Boolean})],$T.prototype,"waterReflectionEnabled",null),u([d({type:Boolean})],$T.prototype,"cameraTrackingEnabled",void 0),$T=HL=u([R(cwe)],$T);const kA=$T,lYe={key:"type",defaultKeyValue:"sun",base:null,typeMap:{sun:w0,virtual:kA}};var CG;let V3=CG=class extends Te{set quality(t){["low","high"].includes(t)&&this._set("quality",t)}clone(){return new CG({quality:this.quality})}};u([d({type:["low","high"],value:"low"})],V3.prototype,"quality",null),V3=CG=u([R("esri.views.3d.environment.SceneViewAtmosphere")],V3);var AG;let VA=AG=class extends de{constructor(t){super(t),this.type="sunny",this.cloudCover=.5}clone(){return new AG({cloudCover:this.cloudCover})}};u([tt({sunny:"sunny"})],VA.prototype,"type",void 0),u([d({type:Number,nonNullable:!0,range:{min:0,max:1},json:{write:!0}})],VA.prototype,"cloudCover",void 0),VA=AG=u([R("esri.views.3d.environment.SunnyWeather")],VA);const OG=VA;var RG;let zA=RG=class extends de{constructor(t){super(t),this.type="cloudy",this.cloudCover=.5}clone(){return new RG({cloudCover:this.cloudCover})}};u([tt({cloudy:"cloudy"})],zA.prototype,"type",void 0),u([d({type:Number,nonNullable:!0,range:{min:0,max:1},json:{write:!0}})],zA.prototype,"cloudCover",void 0),zA=RG=u([R("esri.views.3d.environment.CloudyWeather")],zA);const cYe=zA;var PG;let BA=PG=class extends de{constructor(t){super(t),this.type="foggy",this.fogStrength=.5}clone(){return new PG({fogStrength:this.fogStrength})}};u([tt({foggy:"foggy"})],BA.prototype,"type",void 0),u([d({type:Number,nonNullable:!0,range:{min:0,max:1},json:{write:!0}})],BA.prototype,"fogStrength",void 0),BA=PG=u([R("esri.views.3d.environment.FoggyWeather")],BA);const uYe=BA;var MG;let LT=MG=class extends de{constructor(t){super(t),this.type="rainy",this.cloudCover=.5,this.precipitation=.5}clone(){return new MG({cloudCover:this.cloudCover,precipitation:this.precipitation})}};u([tt({rainy:"rainy"})],LT.prototype,"type",void 0),u([d({type:Number,nonNullable:!0,range:{min:0,max:1},json:{write:!0}})],LT.prototype,"cloudCover",void 0),u([d({type:Number,nonNullable:!0,range:{min:0,max:1},json:{write:!0}})],LT.prototype,"precipitation",void 0),LT=MG=u([R("esri.views.3d.environment.RainyWeather")],LT);const hYe=LT;var IG;let M1=IG=class extends de{constructor(t){super(t),this.type="snowy",this.cloudCover=.5,this.precipitation=.5,this.snowCover="disabled"}clone(){return new IG({cloudCover:this.cloudCover,precipitation:this.precipitation,snowCover:this.snowCover})}};u([tt({snowy:"snowy"})],M1.prototype,"type",void 0),u([d({type:Number,nonNullable:!0,range:{min:0,max:1},json:{write:!0}})],M1.prototype,"cloudCover",void 0),u([d({type:Number,nonNullable:!0,range:{min:0,max:1},json:{write:!0}})],M1.prototype,"precipitation",void 0),u([d({type:["enabled","disabled"],nonNullable:!0,json:{write:!0}})],M1.prototype,"snowCover",void 0),M1=IG=u([R("esri.views.3d.environment.SnowyWeather")],M1);const dYe=M1,uwe={key:"type",base:OG,typeMap:{sunny:OG,cloudy:cYe,rainy:hYe,snowy:dYe,foggy:uYe}},pYe=Object.keys(uwe.typeMap);function fYe(t,e){return!!pYe.includes(t)||(e.error(`"${t}" is not a valid weather type`),!1)}const df=1e4,mYe={key:"type",defaultKeyValue:"sun",base:null,typeMap:{sun:HO,virtual:D5}};let qL=class extends de{constructor(e){super(e)}clone(){}};u([d({readOnly:!0,json:{read:!1}})],qL.prototype,"type",void 0),qL=u([R("esri.webscene.background.Background")],qL);const hwe=qL;var $G;const gYe={...qg,nonNullable:!0};let GA=$G=class extends hwe{constructor(t){super(t),this.type="color",this.color=new ze([0,0,0,1])}clone(){return new $G(this.cloneProperties())}cloneProperties(){return{color:this.color.clone()}}};u([tt({color:"color"},{readOnly:!0})],GA.prototype,"type",void 0),u([d(gYe)],GA.prototype,"color",void 0),GA=$G=u([R("esri.webscene.background.ColorBackground")],GA);const dwe=GA,eie={base:hwe,key:"type",typeMap:{color:dwe}};function yYe(t){return(e,r,i)=>{if(!e)return e;for(const s in t.typeMap)if(e.type===s){const n=new t.typeMap[s];return n.read(e,i),n}}}const _Ye={types:eie,json:{read:yYe(eie),write:{overridePolicy:(t,e,r)=>({enabled:!r||!r.isPresentation})}}};var LG;const pwe="esri.webscene.Environment",vYe=Q.getLogger(pwe),tie=(t,e,r)=>({enabled:!r||!r.isPresentation});let x0=LG=class extends de{constructor(t){super(t),this.lighting=new HO,this.background=null,this.atmosphereEnabled=!0,this.starsEnabled=!0}set weather(t){fYe(t?.type,vYe)&&this._set("weather",t)}clone(){return new LG(this.cloneConstructProperties())}cloneConstructProperties(){return{lighting:this.lighting&&this.lighting.type==="virtual"?D5.prototype.clone.call(this.lighting):HO.prototype.clone.call(this.lighting),background:K(this.background),atmosphereEnabled:this.atmosphereEnabled,starsEnabled:this.starsEnabled,weather:this.weather.clone()}}};u([d({types:mYe,nonNullable:!0,json:{write:!0}})],x0.prototype,"lighting",void 0),u([d(_Ye)],x0.prototype,"background",void 0),u([d({type:Boolean,nonNullable:!0,json:{write:{overridePolicy:tie}}})],x0.prototype,"atmosphereEnabled",void 0),u([d({type:Boolean,nonNullable:!0,json:{write:{overridePolicy:tie}}})],x0.prototype,"starsEnabled",void 0),u([d({types:uwe,nonNullable:!0,json:{write:!0},value:new OG})],x0.prototype,"weather",null),x0=LG=u([R(pwe)],x0);const fwe=x0;var jA;let DT=jA=class extends fwe{constructor(t){super(t),this.atmosphere=new V3,this.lighting=new w0,this.cachedCameraTrackingEnabled=null}static fromWebsceneEnvironment(t){const e=t.cloneConstructProperties();return new jA({...e,lighting:e.lighting?e.lighting.type==="virtual"?kA.fromWebsceneLighting(e.lighting):w0.fromWebsceneLighting(e.lighting):void 0})}castLighting(t){return this._convertLighting(t)}applyLighting(t){this.lighting=this._convertLighting(t)}_convertLighting(t){return t?t instanceof w0||t instanceof kA?t:t instanceof HO?this.lighting&&this.lighting.type!=="virtual"?this.lighting.cloneWithWebsceneLighting(t):new w0({...t.cloneConstructProperties(),...this.lighting?.cloneNonPersistentConstructProperties()}):t instanceof D5?this.lighting&&this.lighting.type==="virtual"?this.lighting.cloneWithWebsceneLighting(t):new kA({...t.cloneConstructProperties(),...this.lighting?.cloneNonPersistentConstructProperties()}):np(lYe,t):new w0}clone(){return new jA({lighting:this.lighting.clone(),atmosphere:this.atmosphere.clone(),weather:this.weather.clone(),atmosphereEnabled:this.atmosphereEnabled,starsEnabled:this.starsEnabled,background:K(this.background)})}cloneWithWebsceneEnvironment(t){return new jA({atmosphere:this.atmosphere.clone(),weather:this.weather.clone(),atmosphereEnabled:this.atmosphereEnabled,starsEnabled:this.starsEnabled,background:K(this.background),...t.cloneConstructProperties(),lighting:this._getLighting(t)})}_getLighting(t){switch(t.lighting.type){case"sun":return this.lighting&&this.lighting.type==="sun"?this.lighting.cloneWithWebsceneLighting(t.lighting):w0.fromWebsceneLighting(t.lighting);case"virtual":return this.lighting&&this.lighting.type==="virtual"?this.lighting.cloneWithWebsceneLighting(t.lighting):kA.fromWebsceneLighting(t.lighting);default:return t.lighting,w0.fromWebsceneLighting(t.lighting)}}};u([d({type:V3,json:{read:!1},nonNullable:!0})],DT.prototype,"atmosphere",void 0),u([d({nonNullable:!0})],DT.prototype,"lighting",void 0),u([yr("lighting")],DT.prototype,"castLighting",null),DT=jA=u([R("esri.views.3d.environment.SceneViewEnvironment")],DT);const NT=DT;var ea;(function(t){t[t.Realistic=0]="Realistic",t[t.Local=1]="Local",t[t.Mars=2]="Mars",t[t.None=3]="None"})(ea||(ea={}));function EX(t){return ge((t-1e5)/(1e6-1e5),0,1)}const DG=1e4,bYe=.085,I0=1e5;let wYe=class{};const ei=wYe;function b(t,...e){let r="";for(let i=0;i<e.length;i++)r+=t[i]+e[i];return r+=t[t.length-1],r}(function(t){function e(i){return Math.round(i).toString()}function r(i){return i.toPrecision(8)}t.int=e,t.float=r})(b||(b={}));var Ps;function Pf(t,e){switch(e.textureCoordinateType){case Ps.Default:return t.attributes.add(E.UV0,"vec2"),t.varyings.add("vuv0","vec2"),void t.vertex.code.add(b`void forwardTextureCoordinates() {
vuv0 = uv0;
}`);case Ps.Compressed:return t.attributes.add(E.UV0,"vec2"),t.varyings.add("vuv0","vec2"),void t.vertex.code.add(b`vec2 getUV0() {
return uv0 / 16384.0;
}
void forwardTextureCoordinates() {
vuv0 = getUV0();
}`);case Ps.Atlas:return t.attributes.add(E.UV0,"vec2"),t.varyings.add("vuv0","vec2"),t.attributes.add(E.UVREGION,"vec4"),t.varyings.add("vuvRegion","vec4"),void t.vertex.code.add(b`void forwardTextureCoordinates() {
vuv0 = uv0;
vuvRegion = uvRegion;
}`);default:e.textureCoordinateType;case Ps.None:return void t.vertex.code.add(b`void forwardTextureCoordinates() {}`);case Ps.COUNT:return}}(function(t){t[t.None=0]="None",t[t.Default=1]="Default",t[t.Atlas=2]="Atlas",t[t.Compressed=3]="Compressed",t[t.COUNT=4]="COUNT"})(Ps||(Ps={}));function Ec(t){t.code.add(b`const float MAX_RGBA_FLOAT =
255.0 / 256.0 +
255.0 / 256.0 / 256.0 +
255.0 / 256.0 / 256.0 / 256.0 +
255.0 / 256.0 / 256.0 / 256.0 / 256.0;
const vec4 FIXED_POINT_FACTORS = vec4(1.0, 256.0, 256.0 * 256.0, 256.0 * 256.0 * 256.0);
vec4 float2rgba(const float value) {
float valueInValidDomain = clamp(value, 0.0, MAX_RGBA_FLOAT);
vec4 fixedPointU8 = floor(fract(valueInValidDomain * FIXED_POINT_FACTORS) * 256.0);
const float toU8AsFloat = 1.0 / 255.0;
return fixedPointU8 * toU8AsFloat;
}
const vec4 RGBA_2_FLOAT_FACTORS = vec4(
255.0 / (256.0),
255.0 / (256.0 * 256.0),
255.0 / (256.0 * 256.0 * 256.0),
255.0 / (256.0 * 256.0 * 256.0 * 256.0)
);
float rgba2float(vec4 rgba) {
return dot(rgba, RGBA_2_FLOAT_FACTORS);
}`)}function _u(t){t.include(Ec),t.code.add(b`float linearDepthFromFloat(float depth, vec2 nearFar) {
return -(depth * (nearFar[1] - nearFar[0]) + nearFar[0]);
}
float linearDepthFromTexture(sampler2D depthTex, vec2 uv, vec2 nearFar) {
return linearDepthFromFloat(rgba2float(texture(depthTex, uv)), nearFar);
}`)}function N5(t){t.fragment.code.add(b`const float GAMMA = 2.2;
const float INV_GAMMA = 0.4545454545;
vec4 delinearizeGamma(vec4 color) {
return vec4(pow(color.rgb, vec3(INV_GAMMA)), color.w);
}
vec3 linearizeGamma(vec3 color) {
return pow(color, vec3(GAMMA));
}`)}var Qr;(function(t){t[t.Pass=0]="Pass",t[t.Draw=1]="Draw"})(Qr||(Qr={}));let as=class{constructor(e,r,i,s,n=null){this.name=e,this.type=r,this.arraySize=n,this.bind={[Qr.Pass]:null,[Qr.Draw]:null},i!=null&&s!=null&&(this.bind[i]=s)}equals(e){return this.type===e.type&&this.name===e.name&&this.arraySize===e.arraySize}},Ft=class extends as{constructor(e,r){super(e,"vec3",Qr.Pass,(i,s,n)=>i.setUniform3fv(e,r(s,n)))}};function Jg(t){t.uniforms.add(new Ft("mainLightDirection",(e,r)=>r.lighting.mainLight.direction))}function im(t){t.uniforms.add(new Ft("mainLightIntensity",(e,r)=>r.lighting.mainLight.intensity))}function KN(t){Jg(t.fragment),im(t.fragment),t.fragment.code.add(b`vec3 evaluateMainLighting(vec3 normal_global, float shadowing) {
float dotVal = clamp(dot(normal_global, mainLightDirection), 0.0, 1.0);
return mainLightIntensity * ((1.0 - shadowing) * dotVal);
}`)}let Sr=class extends as{constructor(e,r){super(e,"vec2",Qr.Pass,(i,s,n)=>i.setUniform2fv(e,r(s,n)))}},sr=class extends as{constructor(e,r){super(e,"vec4",Qr.Pass,(i,s,n)=>i.setUniform4fv(e,r(s,n)))}},Re=class extends as{constructor(e,r){super(e,"float",Qr.Pass,(i,s,n)=>i.setUniform1f(e,r(s,n)))}},$i=class extends as{constructor(e,r){super(e,"mat4",Qr.Pass,(i,s,n)=>i.setUniformMatrix4fv(e,r(s,n)))}};const wa=Wt();let xYe=class{constructor(e){this.message=e}toString(){return`AssertException: ${this.message}`}};function et(t,e){if(!t){e=e||"Assertion";const r=new Error(e).stack;throw new xYe(`${e} at ${r}`)}}function nx(t,e){t||(e=e||"",console.warn("Verify failed: "+e+`
`+new Error("verify").stack))}function rie(t,e,r,i){let s,n=(r[0]-t[0])/e[0],o=(i[0]-t[0])/e[0];n>o&&(s=n,n=o,o=s);let a=(r[1]-t[1])/e[1],l=(i[1]-t[1])/e[1];if(a>l&&(s=a,a=l,l=s),n>l||a>o)return!1;a>n&&(n=a),l<o&&(o=l);let c=(r[2]-t[2])/e[2],h=(i[2]-t[2])/e[2];return c>h&&(s=c,c=h,h=s),!(n>h||c>o)&&(h<o&&(o=h),!(o<0))}function IM(t,e,r,i,s,n=Ve()){const o=(i[s]-r[s])*(e[0]-t[0])-(i[0]-r[0])*(e[s]-t[s]),a=(i[0]-r[0])*(t[s]-r[s])-(i[s]-r[s])*(t[0]-r[0]);if(o===0)return!1;const l=a/o;return n[0]=t[0]+l*(e[0]-t[0]),n[1]=t[s]+l*(e[s]-t[s]),!0}function iie(t,e,r,i,s){wa[0]=t[0],wa[1]=t[1],wa[2]=t[2],wa[3]=1,su(wa,wa,e),s.length>2&&(s[2]=-wa[2]),su(wa,wa,r),et(wa[3]!==0),s[0]=wa[0]/wa[3],s[1]=wa[1]/wa[3],s[2]=wa[2]/wa[3],s[0]=(.5*s[0]+.5)*i[2]+i[0],s[1]=(.5*s[1]+.5)*i[3]+i[1]}function TYe(t,e){return Math.log(t)/Math.log(e)}function SYe(t,e,r,i){t[12]=e,t[13]=r,t[14]=i}function mwe(t){return t[0]===1&&t[1]===0&&t[2]===0&&t[3]===0&&t[4]===0&&t[5]===1&&t[6]===0&&t[7]===0&&t[8]===0&&t[9]===0&&t[10]===1&&t[11]===0&&t[15]===1}const gwe=Q.getLogger("esri.views.3d.webgl-engine.core.shaderModules.shaderBuilder");let ywe=class{constructor(){this._includedModules=new Map}include(e,r){if(this._includedModules.has(e)){const i=this._includedModules.get(e);if(i!==r){gwe.error("Trying to include shader module multiple times with different sets of options.");const s=new Set;for(const n of Object.keys(i))i[n]!==e[n]&&s.add(n);for(const n of Object.keys(e))i[n]!==e[n]&&s.add(n);s.forEach(n=>console.error(`  ${n}: current ${i[n]} new ${e[n]}`))}}else this._includedModules.set(e,r),e(this.builder,r)}},wr=class extends ywe{constructor(){super(...arguments),this.vertex=new sie,this.fragment=new sie,this.attributes=new AYe,this.varyings=new OYe,this.extensions=new NG,this.constants=new _we}get fragmentUniforms(){return this.fragment.uniforms.entries}get builder(){return this}generate(e){const r=this.extensions.generateSource(e),i=this.attributes.generateSource(e),s=this.varyings.generateSource(e),n=e==="vertex"?this.vertex:this.fragment,o=n.uniforms.generateSource(),a=n.code.generateSource(),l=e==="vertex"?PYe:RYe,c=this.constants.generateSource().concat(n.constants.generateSource());return`#version 300 es
${r.join(`
`)}

${l}

${c.join(`
`)}

${o.join(`
`)}

${i.join(`
`)}

${s.join(`
`)}

${a.join(`
`)}`}generateBind(e,r){const i=new Map;this.vertex.uniforms.entries.forEach(o=>{const a=o.bind[e];a!=null&&i.set(o.name,a)}),this.fragment.uniforms.entries.forEach(o=>{const a=o.bind[e];a!=null&&i.set(o.name,a)});const s=Array.from(i.values()),n=s.length;return(o,a,l)=>{for(let c=0;c<n;++c)s[c](r,o,a,l)}}},EYe=class{constructor(){this._entries=new Map}add(...e){for(const r of e)this._add(r)}get(e){return this._entries.get(e)}_add(e){if(e!=null){if(this._entries.has(e.name)&&!this._entries.get(e.name).equals(e))throw new F(`Duplicate uniform name ${e.name} for different uniform type`);this._entries.set(e.name,e)}else gwe.error(`Trying to add null Uniform from ${new Error().stack}.`)}generateSource(){return Array.from(this._entries.values()).map(e=>e.arraySize!=null?`uniform ${e.type} ${e.name}[${e.arraySize}];`:`uniform ${e.type} ${e.name};`)}get entries(){return Array.from(this._entries.values())}},CYe=class{constructor(){this._entries=new Array}add(e){this._entries.push(e)}generateSource(){return this._entries}},sie=class extends ywe{constructor(){super(...arguments),this.uniforms=new EYe,this.code=new CYe,this.constants=new _we}get builder(){return this}},AYe=class{constructor(){this._entries=new Array}add(e,r){this._entries.push([e,r])}generateSource(e){return e==="fragment"?[]:this._entries.map(r=>`in ${r[1]} ${r[0]};`)}},OYe=class{constructor(){this._entries=new Map}add(e,r){this._entries.has(e)&&et(this._entries.get(e)===r),this._entries.set(e,r)}generateSource(e){const r=new Array;return this._entries.forEach((i,s)=>r.push(e==="vertex"?`out ${i} ${s};`:`in ${i} ${s};`)),r}},NG=class FG{constructor(){this._entries=new Set}add(e){this._entries.add(e)}generateSource(e){const r=e==="vertex"?FG.ALLOWLIST_VERTEX:FG.ALLOWLIST_FRAGMENT;return Array.from(this._entries).filter(i=>r.includes(i)).map(i=>`#extension ${i} : enable`)}};NG.ALLOWLIST_FRAGMENT=["GL_EXT_shader_texture_lod","GL_OES_standard_derivatives"],NG.ALLOWLIST_VERTEX=[];let _we=class Js{constructor(){this._entries=new Set}add(e,r,i){let s="ERROR_CONSTRUCTOR_STRING";switch(r){case"float":s=Js._numberToFloatStr(i);break;case"int":s=Js._numberToIntStr(i);break;case"bool":s=i.toString();break;case"vec2":s=`vec2(${Js._numberToFloatStr(i[0])},                            ${Js._numberToFloatStr(i[1])})`;break;case"vec3":s=`vec3(${Js._numberToFloatStr(i[0])},                            ${Js._numberToFloatStr(i[1])},                            ${Js._numberToFloatStr(i[2])})`;break;case"vec4":s=`vec4(${Js._numberToFloatStr(i[0])},                            ${Js._numberToFloatStr(i[1])},                            ${Js._numberToFloatStr(i[2])},                            ${Js._numberToFloatStr(i[3])})`;break;case"ivec2":s=`ivec2(${Js._numberToIntStr(i[0])},                             ${Js._numberToIntStr(i[1])})`;break;case"ivec3":s=`ivec3(${Js._numberToIntStr(i[0])},                             ${Js._numberToIntStr(i[1])},                             ${Js._numberToIntStr(i[2])})`;break;case"ivec4":s=`ivec4(${Js._numberToIntStr(i[0])},                             ${Js._numberToIntStr(i[1])},                             ${Js._numberToIntStr(i[2])},                             ${Js._numberToIntStr(i[3])})`;break;case"mat2":case"mat3":case"mat4":s=`${r}(${Array.prototype.map.call(i,n=>Js._numberToFloatStr(n)).join(", ")})`}return this._entries.add(`const ${r} ${e} = ${s};`),this}static _numberToIntStr(e){return e.toFixed(0)}static _numberToFloatStr(e){return Number.isInteger(e)?e.toFixed(1):e.toString()}generateSource(){return Array.from(this._entries)}};const RYe=`#ifdef GL_FRAGMENT_PRECISION_HIGH
  precision highp float;
  precision highp sampler2D;
#else
  precision mediump float;
  precision mediump sampler2D;
#endif

out vec4 fragColor;`,PYe=`precision highp float;
precision highp sampler2D;`;let Je=class extends as{constructor(e,r){super(e,"sampler2D",Qr.Pass,(i,s,n)=>i.bindTexture(e,r(s,n)))}};const z3=Oe(parseFloat(5802e-9.toFixed(6)),parseFloat(13558e-9.toFixed(6)),parseFloat(331e-7.toFixed(6))),r8=3,i8=Oe(r8*parseFloat(65e-8.toFixed(6)),r8*parseFloat(1881e-9.toFixed(6)),r8*parseFloat(85e-9.toFixed(6))),MYe=3996e-9,IYe=Oe(parseFloat(Number(z3[0]+i8[0]).toFixed(6)),parseFloat(Number(z3[1]+i8[1]).toFixed(6)),parseFloat(Number(z3[2]+i8[2]).toFixed(6)));function $Ye(t){const e=new wr;e.attributes.add(E.POSITION,"vec2"),e.include(Pf,{textureCoordinateType:Ps.Default}),e.varyings.add("worldRay","vec3"),e.varyings.add("eyeDir","vec3");const{vertex:r,fragment:i}=e;return r.uniforms.add(new $i("inverseProjectionMatrix",(s,n)=>n.camera.inverseProjectionMatrix),new $i("inverseViewMatrix",(s,n)=>lE(LYe,n.camera.viewMatrix))),r.code.add(b`void main(void) {
vec3 posViewNear = (inverseProjectionMatrix * vec4(position, -1, 1)).xyz;
eyeDir = posViewNear;
worldRay = (inverseViewMatrix * vec4(posViewNear, 0)).xyz;
forwardTextureCoordinates();
gl_Position = vec4(position, 1, 1);
}`),i.uniforms.add(new Ft("backgroundColor",s=>s.backgroundColor),new Sr("radii",s=>s.radii),new Ft("cameraPosition",(s,n)=>n.camera.eye),new sr("heightParameters",s=>s.heightParameters),new Re("innerFadeDistance",s=>s.innerFadeDistance),new Re("altitudeFade",s=>s.altitudeFade),new Je("depthTexture",s=>s.depthTexture),new Re("hazeStrength",s=>s.hazeStrength)),i.constants.add("betaRayleigh","vec3",z3),i.constants.add("betaCombined","vec3",IYe),i.constants.add("betaMie","float",MYe),i.constants.add("scaleHeight","float",bYe*I0),Jg(i),e.include(N5),t.haze&&(i.include(_u),i.uniforms.add(new Sr("nearFar",(s,n)=>n.camera.nearFar))),i.code.add(b`vec2 sphereIntersect(vec3 start, vec3 dir, float radius, bool planet) {
float a = dot(dir, dir);
float b = 2.0 * dot(dir, start);
float c = planet ? heightParameters[1] - radius * radius : heightParameters[2];
float d = (b * b) - 4.0 * a * c;
if (d < 0.0) {
return vec2(1e5, -1e5);
}
return vec2((-b - sqrt(d)) / (2.0 * a), (-b + sqrt(d)) / (2.0 * a));
}`),i.code.add(b`float chapmanApproximation(float X, float h, float cosZenith) {
float c = sqrt(X + h);
float cExpH = c * exp(-h);
if (cosZenith >= 0.0) {
return cExpH / (c * cosZenith + 1.0);
} else {
float x0 = sqrt(1.0 - cosZenith * cosZenith) * (X + h);
float c0 = sqrt(x0);
return 2.0 * c0 * exp(X - x0) - cExpH / (1.0 - c * cosZenith);
}
}`),i.code.add(b`float getOpticalDepth(vec3 position, vec3 dir, float h) {
return scaleHeight * chapmanApproximation(radii[0] / scaleHeight, h, dot(normalize(position), dir));
}`),i.code.add(b`
    const int STEPS = 6;

    vec3 getAtmosphereColour(vec3 cameraPos, vec3 rayDir, vec3 lightDir, float terrainDepth) {
      float reducedPlanetRadius = radii[0] - 20000.0;
      vec2 rayPlanetIntersect = sphereIntersect(cameraPos, rayDir, reducedPlanetRadius, true);
      vec2 rayAtmosphereIntersect = sphereIntersect(cameraPos, rayDir, radii[1], false);
      bool hitsAtmosphere = (rayAtmosphereIntersect.x <= rayAtmosphereIntersect.y) && rayAtmosphereIntersect.x > 0.0;
      bool insideAtmosphere = heightParameters[0] < radii[1];

      if (!(hitsAtmosphere || insideAtmosphere)) {
        return vec3(0);
      }

      bool hitsPlanet = (rayPlanetIntersect.x <= rayPlanetIntersect.y) && rayPlanetIntersect.x > 0.0;

      float start = insideAtmosphere ? 0.0 : rayAtmosphereIntersect.x;

      if (heightParameters[0] < reducedPlanetRadius) {
        // Long light rays from the night side of the planet lead to numerical instability
        // Do not render the atmosphere in such cases
        if (dot(rayDir, normalize(cameraPos)) < -0.025) {
          return vec3(0);
        }
        start = rayPlanetIntersect.y;
      }

      float end = hitsPlanet ? rayPlanetIntersect.x : rayAtmosphereIntersect.y;
      float maxEnd = end;

      ${t.haze?b`if (terrainDepth != -1.0) { end = terrainDepth; }`:""}

      vec3 samplePoint = cameraPos + rayDir * end;
      float multiplier = hitsPlanet ? -1.0 : 1.0;

      vec3 scattering = vec3(0);
      float scaleFract = (length(samplePoint) - radii[0]) / scaleHeight;
      float lastOpticalDepth = getOpticalDepth(samplePoint, rayDir, scaleFract);
      float stepSize = (end - start) / float(STEPS);
      for (int i = 0; i < STEPS; i++) {
        samplePoint -= stepSize * rayDir;
        scaleFract = (length(samplePoint) - radii[0]) / scaleHeight;
        float opticalDepth = multiplier * getOpticalDepth(samplePoint, rayDir * multiplier, scaleFract);

        if (i > 0) {
          scattering *= ${t.haze?"":b`mix(2.5, 1.0, clamp((length(cameraPos) - radii[0]) / 50e3, 0.0, 1.0)) * `} exp(-(mix(betaCombined, betaRayleigh, 0.5) + betaMie) * max(0.0, (opticalDepth - lastOpticalDepth)));
        }

        if (dot(normalize(samplePoint), lightDir) > -0.3) {

          float scale = exp(-scaleFract);
          float lightDepth = getOpticalDepth(samplePoint, lightDir, scaleFract);

          scattering += scale * exp(-(betaCombined + betaMie) * lightDepth);
          ${t.haze?"":b`scattering += scale * exp(-(0.25 * betaCombined ) * lightDepth);`}
        }

        lastOpticalDepth = opticalDepth;

      }

      float mu = dot(rayDir, lightDir);
      float mumu = 1.0 + mu * mu;

      float phaseRayleigh = 0.0596831 * mumu;

      ${t.haze?b`return 3.0 * scattering * stepSize * phaseRayleigh * betaRayleigh;`:b`
            const float g = 0.8;
            const float gg = g * g;
            float phaseMie = end == maxEnd ? 0.1193662 * ((1.0 - gg) * mumu) / (pow(1.0 + gg - 2.0 * mu * g, 1.5) * (2.0 + gg)) : 0.0;
            phaseMie = clamp(phaseMie, 0.0, 128.0);
            return 3.0 * scattering * stepSize * (phaseRayleigh * betaRayleigh + 0.025 * phaseMie * betaMie);`}
    }

    ${t.haze?"":b`
            vec4 applyUndergroundAtmosphere(vec3 rayDir, vec3 lightDirection, vec4 fragColor) {
              vec2 rayPlanetIntersect = sphereIntersect(cameraPosition, rayDir, radii[0], true);
              if (!((rayPlanetIntersect.x <= rayPlanetIntersect.y) && rayPlanetIntersect.y > 0.0)) {
                return fragColor;
              }

              float lightAngle = dot(lightDirection, normalize(cameraPosition + rayDir * max(0.0, rayPlanetIntersect.x)));
              vec4 surfaceColor = vec4(vec3(max(0.0, (smoothstep(-1.0, 0.8, 2.0 * lightAngle)))), 1.0 - altitudeFade);
              float relDist = (rayPlanetIntersect.y - max(0.0, rayPlanetIntersect.x)) / innerFadeDistance;
              if (relDist > 1.0) {
                return surfaceColor;
              }

              return mix(fragColor, surfaceColor, smoothstep(0.0, 1.0, relDist * relDist));
            }

            float getGlow(float dist, float radius, float intensity) {
              return pow(radius / max(dist, 1e-6), intensity);
            }

            vec3 getSun(vec3 cameraPos, vec3 rayDir, vec3 lightDir){

              // Get the amount of atmosphere between camera and the Sun along the view ray
              float scaleFract = (length(cameraPos) - radii[0]) / scaleHeight;
              float sunOpticalDepth = getOpticalDepth(cameraPos, rayDir, scaleFract);

              // Find the amount of light that remains after travelling through the atmosphere from the Sun along the view ray
              // This will make the colour of the Sun reddish on the horizon and white from space
              vec3 sunTransmittance = exp(-(mix(betaCombined, betaRayleigh, 0.5)) * max(0.0, sunOpticalDepth));

              // Alignment of light direction and view ray
              float mu = dot(rayDir, lightDir);
              // Draw the Sun as a bright disc
              float sunDisc = 256.0 * smoothstep(0.0, 128.0, clamp(getGlow(1.0 - mu, 3e-5, 3.0), 0.0, 128.0));

              return normalize(sunTransmittance) * sunDisc;
            }`}

    ${t.haze&&t.reduced?b`
        float getDepth(vec2 uv){
          return linearDepthFromTexture(depthTexture, uv, nearFar);
        }

        float textureBilinear(vec2 uv) {
          // Information about the high-resolution depth texture
          vec2 depthTextureSize = vec2(textureSize(depthTexture, 0));
          vec2 texelSize = 1.0 / depthTextureSize;

          // The uv inside the upper right pixel - of the tile of 4 pixels -
          // that the atmosphere uv maps to in the depth texture
          vec2 depthUV = (uv * depthTextureSize) - vec2(0.5);

          // Relative distance of the uv coordinates inside the depth texture pixel
          vec2 f = fract(depthUV);

          // Snap to the centre of the depth texture pixel
          vec2 snapUV = (floor(depthUV) + vec2(0.5)) / depthTextureSize;

          // Read the depth texture pixel and its three neighbours
          float d0 = getDepth(snapUV);
          float d1 = getDepth(snapUV + vec2(texelSize.x, 0.0));
          float d2 = getDepth(snapUV + vec2(0.0, texelSize.y));
          float d3 = getDepth(snapUV + texelSize);

          // Return the bilinearly interpolated value of the neighbouring pixels based
          // on the sample position in the depth texture pixel
          return mix(mix(d0, d1, f.x), mix(d2, d3, f.x), f.y);
        }
        `:""}

    vec3 tonemapACES(vec3 x) {
      return clamp((x * (2.51 * x + 0.03)) / (x * (2.43 * x + 0.59) + 0.14), 0.0, 1.0);
    }

    void main() {
      vec3 rayDir = normalize(worldRay);
      float terrainDepth = -1.0;
      ${t.haze?b`
          vec4 depthSample = texture(depthTexture, vuv0).rgba;
          if (depthSample != vec4(0)) {
            vec3 cameraSpaceRay = normalize(eyeDir);
            cameraSpaceRay /= cameraSpaceRay.z;

              ${t.reduced?b`cameraSpaceRay *= -textureBilinear(vuv0);`:b`cameraSpaceRay *= -linearDepthFromTexture(depthTexture, vuv0, nearFar);`}

            terrainDepth = max(0.0, length(cameraSpaceRay));
          }else{
            discard;
          }
          `:b`${t.reduced?"":b`
                float depthSample = texture(depthTexture, vuv0).r;
                if (depthSample != 1.0) {
                  fragColor = vec4(0);
                  return;
                }`}`}

      ${t.haze?b`
            vec3 col = vec3(0);
            float fadeOut = smoothstep(-10000.0, -15000.0, heightParameters[0] - radii[0]);
            if(depthSample != vec4(0)){
              col = (1.0 - fadeOut) * hazeStrength * getAtmosphereColour(cameraPosition, rayDir, mainLightDirection, terrainDepth);
            }
            // Alpha is ignored for haze blending
            float alpha = 1.0;
            `:b`
            vec3 col = linearizeGamma(backgroundColor);
            col += getAtmosphereColour(cameraPosition, rayDir, mainLightDirection, terrainDepth);
            col += getSun(cameraPosition, rayDir, mainLightDirection);
            float alpha = smoothstep(0.0, mix(0.15, 0.01, heightParameters[3]), length(col));`}

      col = tonemapACES(col);
      fragColor = delinearizeGamma(vec4(col, alpha));
      ${t.haze?"":b`fragColor = applyUndergroundAtmosphere(rayDir, mainLightDirection, fragColor);`}
    }
  `),e}const LYe=be(),DYe=Object.freeze(Object.defineProperty({__proto__:null,betaRayleigh:z3,build:$Ye},Symbol.toStringTag,{value:"Module"}));let Er=class{constructor(e,r){this._module=e,this._loadModule=r}get(){return this._module}async reload(){return this._module=await this._loadModule(),this._module}};var wi,St,we,jf,bt,qd,S2,Ke,Kr,fs,Ct,$t,is,Tt,Xe,ks,js,Tr,Kc,po;(function(t){t[t.DEPTH_BUFFER_BIT=256]="DEPTH_BUFFER_BIT",t[t.STENCIL_BUFFER_BIT=1024]="STENCIL_BUFFER_BIT",t[t.COLOR_BUFFER_BIT=16384]="COLOR_BUFFER_BIT"})(wi||(wi={})),function(t){t[t.POINTS=0]="POINTS",t[t.LINES=1]="LINES",t[t.LINE_LOOP=2]="LINE_LOOP",t[t.LINE_STRIP=3]="LINE_STRIP",t[t.TRIANGLES=4]="TRIANGLES",t[t.TRIANGLE_STRIP=5]="TRIANGLE_STRIP",t[t.TRIANGLE_FAN=6]="TRIANGLE_FAN"}(St||(St={})),function(t){t[t.ZERO=0]="ZERO",t[t.ONE=1]="ONE",t[t.SRC_COLOR=768]="SRC_COLOR",t[t.ONE_MINUS_SRC_COLOR=769]="ONE_MINUS_SRC_COLOR",t[t.SRC_ALPHA=770]="SRC_ALPHA",t[t.ONE_MINUS_SRC_ALPHA=771]="ONE_MINUS_SRC_ALPHA",t[t.DST_ALPHA=772]="DST_ALPHA",t[t.ONE_MINUS_DST_ALPHA=773]="ONE_MINUS_DST_ALPHA",t[t.DST_COLOR=774]="DST_COLOR",t[t.ONE_MINUS_DST_COLOR=775]="ONE_MINUS_DST_COLOR",t[t.SRC_ALPHA_SATURATE=776]="SRC_ALPHA_SATURATE",t[t.CONSTANT_COLOR=32769]="CONSTANT_COLOR",t[t.ONE_MINUS_CONSTANT_COLOR=32770]="ONE_MINUS_CONSTANT_COLOR",t[t.CONSTANT_ALPHA=32771]="CONSTANT_ALPHA",t[t.ONE_MINUS_CONSTANT_ALPHA=32772]="ONE_MINUS_CONSTANT_ALPHA"}(we||(we={})),function(t){t[t.ADD=32774]="ADD",t[t.MIN=32775]="MIN",t[t.MAX=32776]="MAX",t[t.SUBTRACT=32778]="SUBTRACT",t[t.REVERSE_SUBTRACT=32779]="REVERSE_SUBTRACT"}(jf||(jf={})),function(t){t[t.ARRAY_BUFFER=34962]="ARRAY_BUFFER",t[t.ELEMENT_ARRAY_BUFFER=34963]="ELEMENT_ARRAY_BUFFER",t[t.UNIFORM_BUFFER=35345]="UNIFORM_BUFFER",t[t.PIXEL_PACK_BUFFER=35051]="PIXEL_PACK_BUFFER",t[t.PIXEL_UNPACK_BUFFER=35052]="PIXEL_UNPACK_BUFFER",t[t.COPY_READ_BUFFER=36662]="COPY_READ_BUFFER",t[t.COPY_WRITE_BUFFER=36663]="COPY_WRITE_BUFFER"}(bt||(bt={})),function(t){t[t.FRONT=1028]="FRONT",t[t.BACK=1029]="BACK",t[t.FRONT_AND_BACK=1032]="FRONT_AND_BACK"}(qd||(qd={})),function(t){t[t.CW=2304]="CW",t[t.CCW=2305]="CCW"}(S2||(S2={})),function(t){t[t.BYTE=5120]="BYTE",t[t.UNSIGNED_BYTE=5121]="UNSIGNED_BYTE",t[t.SHORT=5122]="SHORT",t[t.UNSIGNED_SHORT=5123]="UNSIGNED_SHORT",t[t.INT=5124]="INT",t[t.UNSIGNED_INT=5125]="UNSIGNED_INT",t[t.FLOAT=5126]="FLOAT"}(Ke||(Ke={})),function(t){t[t.NEVER=512]="NEVER",t[t.LESS=513]="LESS",t[t.EQUAL=514]="EQUAL",t[t.LEQUAL=515]="LEQUAL",t[t.GREATER=516]="GREATER",t[t.NOTEQUAL=517]="NOTEQUAL",t[t.GEQUAL=518]="GEQUAL",t[t.ALWAYS=519]="ALWAYS"}(Kr||(Kr={})),function(t){t[t.ZERO=0]="ZERO",t[t.KEEP=7680]="KEEP",t[t.REPLACE=7681]="REPLACE",t[t.INCR=7682]="INCR",t[t.DECR=7683]="DECR",t[t.INVERT=5386]="INVERT",t[t.INCR_WRAP=34055]="INCR_WRAP",t[t.DECR_WRAP=34056]="DECR_WRAP"}(fs||(fs={})),function(t){t[t.NEAREST=9728]="NEAREST",t[t.LINEAR=9729]="LINEAR",t[t.NEAREST_MIPMAP_NEAREST=9984]="NEAREST_MIPMAP_NEAREST",t[t.LINEAR_MIPMAP_NEAREST=9985]="LINEAR_MIPMAP_NEAREST",t[t.NEAREST_MIPMAP_LINEAR=9986]="NEAREST_MIPMAP_LINEAR",t[t.LINEAR_MIPMAP_LINEAR=9987]="LINEAR_MIPMAP_LINEAR"}(Ct||(Ct={})),function(t){t[t.CLAMP_TO_EDGE=33071]="CLAMP_TO_EDGE",t[t.REPEAT=10497]="REPEAT",t[t.MIRRORED_REPEAT=33648]="MIRRORED_REPEAT"}($t||($t={})),function(t){t[t.TEXTURE_2D=3553]="TEXTURE_2D",t[t.TEXTURE_CUBE_MAP=34067]="TEXTURE_CUBE_MAP",t[t.TEXTURE_3D=32879]="TEXTURE_3D",t[t.TEXTURE_CUBE_MAP_POSITIVE_X=34069]="TEXTURE_CUBE_MAP_POSITIVE_X",t[t.TEXTURE_CUBE_MAP_NEGATIVE_X=34070]="TEXTURE_CUBE_MAP_NEGATIVE_X",t[t.TEXTURE_CUBE_MAP_POSITIVE_Y=34071]="TEXTURE_CUBE_MAP_POSITIVE_Y",t[t.TEXTURE_CUBE_MAP_NEGATIVE_Y=34072]="TEXTURE_CUBE_MAP_NEGATIVE_Y",t[t.TEXTURE_CUBE_MAP_POSITIVE_Z=34073]="TEXTURE_CUBE_MAP_POSITIVE_Z",t[t.TEXTURE_CUBE_MAP_NEGATIVE_Z=34074]="TEXTURE_CUBE_MAP_NEGATIVE_Z",t[t.TEXTURE_2D_ARRAY=35866]="TEXTURE_2D_ARRAY"}(is||(is={})),function(t){t[t.DEPTH_COMPONENT=6402]="DEPTH_COMPONENT",t[t.DEPTH_STENCIL=34041]="DEPTH_STENCIL",t[t.DEPTH24_STENCIL8=35056]="DEPTH24_STENCIL8",t[t.ALPHA=6406]="ALPHA",t[t.RGB=6407]="RGB",t[t.RGBA=6408]="RGBA",t[t.LUMINANCE=6409]="LUMINANCE",t[t.LUMINANCE_ALPHA=6410]="LUMINANCE_ALPHA",t[t.RED=6403]="RED",t[t.RG=33319]="RG",t[t.RED_INTEGER=36244]="RED_INTEGER",t[t.RG_INTEGER=33320]="RG_INTEGER",t[t.RGB_INTEGER=36248]="RGB_INTEGER",t[t.RGBA_INTEGER=36249]="RGBA_INTEGER"}(Tt||(Tt={})),function(t){t[t.RGBA4=32854]="RGBA4",t[t.R16F=33325]="R16F",t[t.RG16F=33327]="RG16F",t[t.RGB32F=34837]="RGB32F",t[t.RGBA16F=34842]="RGBA16F",t[t.R32F=33326]="R32F",t[t.RG32F=33328]="RG32F",t[t.RGBA32F=34836]="RGBA32F",t[t.R11F_G11F_B10F=35898]="R11F_G11F_B10F",t[t.RGB8=32849]="RGB8",t[t.RGBA8=32856]="RGBA8",t[t.RGB5_A1=32855]="RGB5_A1",t[t.R8=33321]="R8",t[t.RG8=33323]="RG8",t[t.R8I=33329]="R8I",t[t.R8UI=33330]="R8UI",t[t.R16I=33331]="R16I",t[t.R16UI=33332]="R16UI",t[t.R32I=33333]="R32I",t[t.R32UI=33334]="R32UI",t[t.RG8I=33335]="RG8I",t[t.RG8UI=33336]="RG8UI",t[t.RG16I=33337]="RG16I",t[t.RG16UI=33338]="RG16UI",t[t.RG32I=33339]="RG32I",t[t.RG32UI=33340]="RG32UI",t[t.RGB16F=34843]="RGB16F",t[t.RGB9_E5=35901]="RGB9_E5",t[t.SRGB8=35905]="SRGB8",t[t.SRGB8_ALPHA8=35907]="SRGB8_ALPHA8",t[t.RGB565=36194]="RGB565",t[t.RGBA32UI=36208]="RGBA32UI",t[t.RGB32UI=36209]="RGB32UI",t[t.RGBA16UI=36214]="RGBA16UI",t[t.RGB16UI=36215]="RGB16UI",t[t.RGBA8UI=36220]="RGBA8UI",t[t.RGB8UI=36221]="RGB8UI",t[t.RGBA32I=36226]="RGBA32I",t[t.RGB32I=36227]="RGB32I",t[t.RGBA16I=36232]="RGBA16I",t[t.RGB16I=36233]="RGB16I",t[t.RGBA8I=36238]="RGBA8I",t[t.RGB8I=36239]="RGB8I",t[t.R8_SNORM=36756]="R8_SNORM",t[t.RG8_SNORM=36757]="RG8_SNORM",t[t.RGB8_SNORM=36758]="RGB8_SNORM",t[t.RGBA8_SNORM=36759]="RGBA8_SNORM",t[t.RGB10_A2=32857]="RGB10_A2",t[t.RGB10_A2UI=36975]="RGB10_A2UI"}(Xe||(Xe={})),function(t){t[t.FLOAT=5126]="FLOAT",t[t.UNSIGNED_BYTE=5121]="UNSIGNED_BYTE",t[t.UNSIGNED_INT_24_8=34042]="UNSIGNED_INT_24_8",t[t.UNSIGNED_SHORT_4_4_4_4=32819]="UNSIGNED_SHORT_4_4_4_4",t[t.UNSIGNED_SHORT_5_5_5_1=32820]="UNSIGNED_SHORT_5_5_5_1",t[t.UNSIGNED_SHORT_5_6_5=33635]="UNSIGNED_SHORT_5_6_5",t[t.BYTE=5120]="BYTE",t[t.UNSIGNED_SHORT=5123]="UNSIGNED_SHORT",t[t.SHORT=5122]="SHORT",t[t.UNSIGNED_INT=5125]="UNSIGNED_INT",t[t.INT=5124]="INT",t[t.HALF_FLOAT=5131]="HALF_FLOAT",t[t.UNSIGNED_INT_2_10_10_10_REV=33640]="UNSIGNED_INT_2_10_10_10_REV",t[t.UNSIGNED_INT_10F_11F_11F_REV=35899]="UNSIGNED_INT_10F_11F_11F_REV",t[t.UNSIGNED_INT_5_9_9_9_REV=35902]="UNSIGNED_INT_5_9_9_9_REV",t[t.FLOAT_32_UNSIGNED_INT_24_8_REV=36269]="FLOAT_32_UNSIGNED_INT_24_8_REV"}(ks||(ks={})),function(t){t[t.DEPTH_COMPONENT16=33189]="DEPTH_COMPONENT16",t[t.STENCIL_INDEX8=36168]="STENCIL_INDEX8",t[t.DEPTH_STENCIL=34041]="DEPTH_STENCIL",t[t.DEPTH_COMPONENT24=33190]="DEPTH_COMPONENT24",t[t.DEPTH_COMPONENT32F=36012]="DEPTH_COMPONENT32F",t[t.DEPTH24_STENCIL8=35056]="DEPTH24_STENCIL8",t[t.DEPTH32F_STENCIL8=36013]="DEPTH32F_STENCIL8"}(js||(js={})),function(t){t[t.STATIC_DRAW=35044]="STATIC_DRAW",t[t.DYNAMIC_DRAW=35048]="DYNAMIC_DRAW",t[t.STREAM_DRAW=35040]="STREAM_DRAW",t[t.STATIC_READ=35045]="STATIC_READ",t[t.DYNAMIC_READ=35049]="DYNAMIC_READ",t[t.STREAM_READ=35041]="STREAM_READ",t[t.STATIC_COPY=35046]="STATIC_COPY",t[t.DYNAMIC_COPY=35050]="DYNAMIC_COPY",t[t.STREAM_COPY=35042]="STREAM_COPY"}(Tr||(Tr={})),function(t){t[t.FRAGMENT_SHADER=35632]="FRAGMENT_SHADER",t[t.VERTEX_SHADER=35633]="VERTEX_SHADER"}(Kc||(Kc={})),function(t){t[t.FRAMEBUFFER=36160]="FRAMEBUFFER",t[t.READ_FRAMEBUFFER=36008]="READ_FRAMEBUFFER",t[t.DRAW_FRAMEBUFFER=36009]="DRAW_FRAMEBUFFER"}(po||(po={}));const s8=33984;var An,qc;(function(t){t[t.Texture=0]="Texture",t[t.BufferObject=1]="BufferObject",t[t.VertexArrayObject=2]="VertexArrayObject",t[t.Shader=3]="Shader",t[t.Program=4]="Program",t[t.FramebufferObject=5]="FramebufferObject",t[t.Renderbuffer=6]="Renderbuffer",t[t.Sync=7]="Sync",t[t.COUNT=8]="COUNT"})(An||(An={})),function(t){t[t.COLOR_ATTACHMENT0=36064]="COLOR_ATTACHMENT0",t[t.COLOR_ATTACHMENT1=36065]="COLOR_ATTACHMENT1",t[t.COLOR_ATTACHMENT2=36066]="COLOR_ATTACHMENT2",t[t.COLOR_ATTACHMENT3=36067]="COLOR_ATTACHMENT3",t[t.COLOR_ATTACHMENT4=36068]="COLOR_ATTACHMENT4",t[t.COLOR_ATTACHMENT5=36069]="COLOR_ATTACHMENT5",t[t.COLOR_ATTACHMENT6=36070]="COLOR_ATTACHMENT6",t[t.COLOR_ATTACHMENT7=36071]="COLOR_ATTACHMENT7",t[t.COLOR_ATTACHMENT8=36072]="COLOR_ATTACHMENT8",t[t.COLOR_ATTACHMENT9=36073]="COLOR_ATTACHMENT9",t[t.COLOR_ATTACHMENT10=36074]="COLOR_ATTACHMENT10",t[t.COLOR_ATTACHMENT11=36075]="COLOR_ATTACHMENT11",t[t.COLOR_ATTACHMENT12=36076]="COLOR_ATTACHMENT12",t[t.COLOR_ATTACHMENT13=36077]="COLOR_ATTACHMENT13",t[t.COLOR_ATTACHMENT14=36078]="COLOR_ATTACHMENT14",t[t.COLOR_ATTACHMENT15=36079]="COLOR_ATTACHMENT15"}(qc||(qc={}));const nie=33306;var us,oie,aie,lie,e4,UG,cie;(function(t){t[t.COMPRESSED_RGB_S3TC_DXT1_EXT=33776]="COMPRESSED_RGB_S3TC_DXT1_EXT",t[t.COMPRESSED_RGBA_S3TC_DXT1_EXT=33777]="COMPRESSED_RGBA_S3TC_DXT1_EXT",t[t.COMPRESSED_RGBA_S3TC_DXT3_EXT=33778]="COMPRESSED_RGBA_S3TC_DXT3_EXT",t[t.COMPRESSED_RGBA_S3TC_DXT5_EXT=33779]="COMPRESSED_RGBA_S3TC_DXT5_EXT",t[t.COMPRESSED_R11_EAC=37488]="COMPRESSED_R11_EAC",t[t.COMPRESSED_SIGNED_R11_EAC=37489]="COMPRESSED_SIGNED_R11_EAC",t[t.COMPRESSED_RG11_EAC=37490]="COMPRESSED_RG11_EAC",t[t.COMPRESSED_SIGNED_RG11_EAC=37491]="COMPRESSED_SIGNED_RG11_EAC",t[t.COMPRESSED_RGB8_ETC2=37492]="COMPRESSED_RGB8_ETC2",t[t.COMPRESSED_SRGB8_ETC2=37493]="COMPRESSED_SRGB8_ETC2",t[t.COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2=37494]="COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2",t[t.COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2=37495]="COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2",t[t.COMPRESSED_RGBA8_ETC2_EAC=37496]="COMPRESSED_RGBA8_ETC2_EAC",t[t.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC=37497]="COMPRESSED_SRGB8_ALPHA8_ETC2_EAC"})(us||(us={})),function(t){t[t.FLOAT=5126]="FLOAT",t[t.FLOAT_VEC2=35664]="FLOAT_VEC2",t[t.FLOAT_VEC3=35665]="FLOAT_VEC3",t[t.FLOAT_VEC4=35666]="FLOAT_VEC4",t[t.INT=5124]="INT",t[t.INT_VEC2=35667]="INT_VEC2",t[t.INT_VEC3=35668]="INT_VEC3",t[t.INT_VEC4=35669]="INT_VEC4",t[t.BOOL=35670]="BOOL",t[t.BOOL_VEC2=35671]="BOOL_VEC2",t[t.BOOL_VEC3=35672]="BOOL_VEC3",t[t.BOOL_VEC4=35673]="BOOL_VEC4",t[t.FLOAT_MAT2=35674]="FLOAT_MAT2",t[t.FLOAT_MAT3=35675]="FLOAT_MAT3",t[t.FLOAT_MAT4=35676]="FLOAT_MAT4",t[t.SAMPLER_2D=35678]="SAMPLER_2D",t[t.SAMPLER_CUBE=35680]="SAMPLER_CUBE",t[t.UNSIGNED_INT=5125]="UNSIGNED_INT",t[t.UNSIGNED_INT_VEC2=36294]="UNSIGNED_INT_VEC2",t[t.UNSIGNED_INT_VEC3=36295]="UNSIGNED_INT_VEC3",t[t.UNSIGNED_INT_VEC4=36296]="UNSIGNED_INT_VEC4",t[t.FLOAT_MAT2x3=35685]="FLOAT_MAT2x3",t[t.FLOAT_MAT2x4=35686]="FLOAT_MAT2x4",t[t.FLOAT_MAT3x2=35687]="FLOAT_MAT3x2",t[t.FLOAT_MAT3x4=35688]="FLOAT_MAT3x4",t[t.FLOAT_MAT4x2=35689]="FLOAT_MAT4x2",t[t.FLOAT_MAT4x3=35690]="FLOAT_MAT4x3",t[t.SAMPLER_3D=35679]="SAMPLER_3D",t[t.SAMPLER_2D_SHADOW=35682]="SAMPLER_2D_SHADOW",t[t.SAMPLER_2D_ARRAY=36289]="SAMPLER_2D_ARRAY",t[t.SAMPLER_2D_ARRAY_SHADOW=36292]="SAMPLER_2D_ARRAY_SHADOW",t[t.SAMPLER_CUBE_SHADOW=36293]="SAMPLER_CUBE_SHADOW",t[t.INT_SAMPLER_2D=36298]="INT_SAMPLER_2D",t[t.INT_SAMPLER_3D=36299]="INT_SAMPLER_3D",t[t.INT_SAMPLER_CUBE=36300]="INT_SAMPLER_CUBE",t[t.INT_SAMPLER_2D_ARRAY=36303]="INT_SAMPLER_2D_ARRAY",t[t.UNSIGNED_INT_SAMPLER_2D=36306]="UNSIGNED_INT_SAMPLER_2D",t[t.UNSIGNED_INT_SAMPLER_3D=36307]="UNSIGNED_INT_SAMPLER_3D",t[t.UNSIGNED_INT_SAMPLER_CUBE=36308]="UNSIGNED_INT_SAMPLER_CUBE",t[t.UNSIGNED_INT_SAMPLER_2D_ARRAY=36311]="UNSIGNED_INT_SAMPLER_2D_ARRAY"}(oie||(oie={})),function(t){t[t.OBJECT_TYPE=37138]="OBJECT_TYPE",t[t.SYNC_CONDITION=37139]="SYNC_CONDITION",t[t.SYNC_STATUS=37140]="SYNC_STATUS",t[t.SYNC_FLAGS=37141]="SYNC_FLAGS"}(aie||(aie={})),function(t){t[t.UNSIGNALED=37144]="UNSIGNALED",t[t.SIGNALED=37145]="SIGNALED"}(lie||(lie={})),function(t){t[t.ALREADY_SIGNALED=37146]="ALREADY_SIGNALED",t[t.TIMEOUT_EXPIRED=37147]="TIMEOUT_EXPIRED",t[t.CONDITION_SATISFIED=37148]="CONDITION_SATISFIED",t[t.WAIT_FAILED=37149]="WAIT_FAILED"}(e4||(e4={})),function(t){t[t.SYNC_GPU_COMMANDS_COMPLETE=37143]="SYNC_GPU_COMMANDS_COMPLETE"}(UG||(UG={})),function(t){t[t.SYNC_FLUSH_COMMANDS_BIT=1]="SYNC_FLUSH_COMMANDS_BIT"}(cie||(cie={}));let Pr=class{constructor(e,r,i){this.release=i,this.initializeConfiguration(e,r),this._configuration=r.snapshot(),this._program=this.initializeProgram(e),this._pipeline=this.initializePipeline(e.rctx.capabilities)}destroy(){this._program=Ue(this._program),this._pipeline=this._configuration=null}reload(e){Ue(this._program),this._program=this.initializeProgram(e),this._pipeline=this.initializePipeline(e.rctx.capabilities)}get program(){return this._program}get compiled(){return this.program.compiled}get key(){return this._configuration.key}get configuration(){return this._configuration}bindPipelineState(e,r=null,i){e.setPipelineState(this.getPipelineState(r,i))}ensureAttributeLocations(e){this.program.assertCompatibleVertexAttributeLocations(e)}get primitiveType(){return St.TRIANGLES}getPipelineState(e,r){return this._pipeline}initializeConfiguration(e,r){}};const br=new Map([[E.POSITION,0],[E.NORMAL,1],[E.NORMALCOMPRESSED,1],[E.UV0,2],[E.COLOR,3],[E.COLORFEATUREATTRIBUTE,3],[E.SIZE,4],[E.TANGENT,4],[E.AUXPOS1,5],[E.SYMBOLCOLOR,5],[E.AUXPOS2,6],[E.FEATUREATTRIBUTE,6],[E.INSTANCEFEATUREATTRIBUTE,6],[E.INSTANCECOLOR,7],[E.OBJECTANDLAYERIDCOLOR,7],[E.INSTANCEOBJECTANDLAYERIDCOLOR,7],[E.MODEL,8],[E.MODELNORMAL,12],[E.MODELORIGINHI,11],[E.MODELORIGINLO,15]]),NYe=Q.getLogger("esri.views.webgl.checkWebGLError");function FYe(t,e){switch(e){case t.INVALID_ENUM:return"Invalid Enum. An unacceptable value has been specified for an enumerated argument.";case t.INVALID_VALUE:return"Invalid Value. A numeric argument is out of range.";case t.INVALID_OPERATION:return"Invalid Operation. The specified command is not allowed for the current state.";case t.INVALID_FRAMEBUFFER_OPERATION:return"Invalid Framebuffer operation. The currently bound framebuffer is not framebuffer complete when trying to render to or to read from it.";case t.OUT_OF_MEMORY:return"Out of memory. Not enough memory is left to execute the command.";case t.CONTEXT_LOST_WEBGL:return"WebGL context has been lost";default:return"Unknown error"}}const vwe=!!oe("enable-feature:webgl-debug");function Qu(){return vwe}function kG(){return vwe}function V0(t){if(Qu()){const e=t.getError();if(e){const r=FYe(t,e),i=new Error().stack;NYe.error(new F("webgl-error","WebGL error occured",{message:r,stack:i}))}}}let Cr=class{constructor(e,r,i){this._context=e,this._locations=i,this._textures=new Map,this._freeTextureUnits=new kt({deallocator:null}),this._glProgram=e.programCache.acquire(r.generate("vertex"),r.generate("fragment"),i),this._glProgram.stop=()=>{throw new Error("Wrapped _glProgram used directly")},this.bindPass=r.generateBind(Qr.Pass,this),this.bindDraw=r.generateBind(Qr.Draw,this),this._fragmentUniforms=Qu()?r.fragmentUniforms:null}dispose(){this._glProgram.dispose()}get glName(){return this._glProgram.glName}get compiled(){return this._glProgram.compiled}setUniform1b(e,r){this._glProgram.setUniform1i(e,r?1:0)}setUniform1i(e,r){this._glProgram.setUniform1i(e,r)}setUniform1f(e,r){this._glProgram.setUniform1f(e,r)}setUniform2fv(e,r){this._glProgram.setUniform2fv(e,r)}setUniform3fv(e,r){this._glProgram.setUniform3fv(e,r)}setUniform4fv(e,r){this._glProgram.setUniform4fv(e,r)}setUniformMatrix3fv(e,r){this._glProgram.setUniformMatrix3fv(e,r)}setUniformMatrix4fv(e,r){this._glProgram.setUniformMatrix4fv(e,r)}setUniform1fv(e,r){this._glProgram.setUniform1fv(e,r)}setUniform1iv(e,r){this._glProgram.setUniform1iv(e,r)}setUniform2iv(e,r){this._glProgram.setUniform3iv(e,r)}setUniform3iv(e,r){this._glProgram.setUniform3iv(e,r)}setUniform4iv(e,r){this._glProgram.setUniform4iv(e,r)}assertCompatibleVertexAttributeLocations(e){e.locations!==this._locations&&console.error("VertexAttributeLocations are incompatible")}stop(){this._textures.clear(),this._freeTextureUnits.clear()}bindTexture(e,r){if(r==null||r.glName==null){const s=this._textures.get(e);return s&&(this._context.bindTexture(null,s.unit),this._freeTextureUnit(s),this._textures.delete(e)),null}let i=this._textures.get(e);return i==null?(i=this._allocTextureUnit(r),this._textures.set(e,i)):i.texture=r,this._context.useProgram(this),this.setUniform1i(e,i.unit),this._context.bindTexture(r,i.unit),i.unit}rebindTextures(){this._context.useProgram(this),this._textures.forEach((e,r)=>{this._context.bindTexture(e.texture,e.unit),this.setUniform1i(r,e.unit)}),this._fragmentUniforms!=null&&this._fragmentUniforms.forEach(e=>{e.type!=="sampler2D"&&e.type!=="samplerCube"||this._textures.has(e.name)||console.error(`Texture sampler ${e.name} has no bound texture`)})}_allocTextureUnit(e){return{texture:e,unit:this._freeTextureUnits.length===0?this._textures.size:this._freeTextureUnits.pop()}}_freeTextureUnit(e){this._freeTextureUnits.push(e.unit)}};var pi,ow,ds,wg,Sl,zg,E2,Yr,aw,xg;(function(t){t[t.None=0]="None",t[t.Front=1]="Front",t[t.Back=2]="Back",t[t.COUNT=3]="COUNT"})(pi||(pi={})),function(t){t[t.Less=0]="Less",t[t.Lequal=1]="Lequal",t[t.COUNT=2]="COUNT"}(ow||(ow={})),function(t){t[t.BACKGROUND=0]="BACKGROUND",t[t.UPDATE=1]="UPDATE"}(ds||(ds={})),function(t){t[t.NOT_LOADED=0]="NOT_LOADED",t[t.LOADING=1]="LOADING",t[t.LOADED=2]="LOADED"}(wg||(wg={})),function(t){t[t.IntegratedMeshMaskExcluded=1]="IntegratedMeshMaskExcluded",t[t.OutlineVisualElementMask=2]="OutlineVisualElementMask"}(Sl||(Sl={})),function(t){t[t.Highlight=0]="Highlight",t[t.MaskOccludee=1]="MaskOccludee",t[t.COUNT=2]="COUNT"}(zg||(zg={})),function(t){t[t.CHANGED=0]="CHANGED",t[t.UNCHANGED=1]="UNCHANGED"}(E2||(E2={})),function(t){t[t.Blend=0]="Blend",t[t.Opaque=1]="Opaque",t[t.Mask=2]="Mask",t[t.MaskBlend=3]="MaskBlend",t[t.COUNT=4]="COUNT"}(Yr||(Yr={})),function(t){t[t.OFF=0]="OFF",t[t.ON=1]="ON"}(aw||(aw={})),function(t){t.DDS_ENCODING="image/vnd-ms.dds",t.KTX2_ENCODING="image/ktx2",t.BASIS_ENCODING="image/x.basis"}(xg||(xg={}));function Tc(t,e,r=jf.ADD,i=[0,0,0,0]){return{srcRgb:t,srcAlpha:t,dstRgb:e,dstAlpha:e,opRgb:r,opAlpha:r,color:{r:i[0],g:i[1],b:i[2],a:i[3]}}}function xo(t,e,r,i,s=jf.ADD,n=jf.ADD,o=[0,0,0,0]){return{srcRgb:t,srcAlpha:e,dstRgb:r,dstAlpha:i,opRgb:s,opAlpha:n,color:{r:o[0],g:o[1],b:o[2],a:o[3]}}}const CX={face:qd.BACK,mode:S2.CCW},bwe={face:qd.FRONT,mode:S2.CCW},F5=t=>t===pi.Back?CX:t===pi.Front?bwe:null,Ol={zNear:0,zFar:1},Vt={r:!0,g:!0,b:!0,a:!0};function UYe(t){return qYe.intern(t)}function kYe(t){return WYe.intern(t)}function VYe(t){return ZYe.intern(t)}function zYe(t){return XYe.intern(t)}function BYe(t){return YYe.intern(t)}function GYe(t){return JYe.intern(t)}function jYe(t){return QYe.intern(t)}function HYe(t){return KYe.intern(t)}function At(t){return eJe.intern(t)}let Qg=class{constructor(e,r){this._makeKey=e,this._makeRef=r,this._interns=new Map}intern(e){if(!e)return null;const r=this._makeKey(e),i=this._interns;return i.has(r)||i.set(r,this._makeRef(e)),i.get(r)??null}};function Kg(t){return"["+t.join(",")+"]"}const qYe=new Qg(wwe,t=>({__tag:"Blending",...t}));function wwe(t){return t?Kg([t.srcRgb,t.srcAlpha,t.dstRgb,t.dstAlpha,t.opRgb,t.opAlpha,t.color.r,t.color.g,t.color.b,t.color.a]):null}const WYe=new Qg(xwe,t=>({__tag:"Culling",...t}));function xwe(t){return t?Kg([t.face,t.mode]):null}const ZYe=new Qg(Twe,t=>({__tag:"PolygonOffset",...t}));function Twe(t){return t?Kg([t.factor,t.units]):null}const XYe=new Qg(Swe,t=>({__tag:"DepthTest",...t}));function Swe(t){return t?Kg([t.func]):null}const YYe=new Qg(Ewe,t=>({__tag:"StencilTest",...t}));function Ewe(t){return t?Kg([t.function.func,t.function.ref,t.function.mask,t.operation.fail,t.operation.zFail,t.operation.zPass]):null}const JYe=new Qg(Cwe,t=>({__tag:"DepthWrite",...t}));function Cwe(t){return t?Kg([t.zNear,t.zFar]):null}const QYe=new Qg(Awe,t=>({__tag:"ColorWrite",...t}));function Awe(t){return t?Kg([t.r,t.g,t.b,t.a]):null}const KYe=new Qg(Owe,t=>({__tag:"StencilWrite",...t}));function Owe(t){return t?Kg([t.mask]):null}const eJe=new Qg(tJe,t=>({blending:UYe(t.blending),culling:kYe(t.culling),polygonOffset:VYe(t.polygonOffset),depthTest:zYe(t.depthTest),stencilTest:BYe(t.stencilTest),depthWrite:GYe(t.depthWrite),colorWrite:jYe(t.colorWrite),stencilWrite:HYe(t.stencilWrite)}));function tJe(t){return t?Kg([wwe(t.blending),xwe(t.culling),Twe(t.polygonOffset),Swe(t.depthTest),Ewe(t.stencilTest),Cwe(t.depthWrite),Awe(t.colorWrite),Owe(t.stencilWrite)]):null}let rJe=class{constructor(e){this._pipelineInvalid=!0,this._blendingInvalid=!0,this._cullingInvalid=!0,this._polygonOffsetInvalid=!0,this._depthTestInvalid=!0,this._stencilTestInvalid=!0,this._depthWriteInvalid=!0,this._colorWriteInvalid=!0,this._stencilWriteInvalid=!0,this._stateSetters=e}setPipeline(e){(this._pipelineInvalid||e!==this._pipeline)&&(this._setBlending(e.blending),this._setCulling(e.culling),this._setPolygonOffset(e.polygonOffset),this._setDepthTest(e.depthTest),this._setStencilTest(e.stencilTest),this._setDepthWrite(e.depthWrite),this._setColorWrite(e.colorWrite),this._setStencilWrite(e.stencilWrite),this._pipeline=e),this._pipelineInvalid=!1}invalidateBlending(){this._blendingInvalid=!0,this._pipelineInvalid=!0}invalidateCulling(){this._cullingInvalid=!0,this._pipelineInvalid=!0}invalidatePolygonOffset(){this._polygonOffsetInvalid=!0,this._pipelineInvalid=!0}invalidateDepthTest(){this._depthTestInvalid=!0,this._pipelineInvalid=!0}invalidateStencilTest(){this._stencilTestInvalid=!0,this._pipelineInvalid=!0}invalidateDepthWrite(){this._depthWriteInvalid=!0,this._pipelineInvalid=!0}invalidateColorWrite(){this._colorWriteInvalid=!0,this._pipelineInvalid=!0}invalidateStencilWrite(){this._stencilTestInvalid=!0,this._pipelineInvalid=!0}_setBlending(e){this._blending=this._setSubState(e,this._blending,this._blendingInvalid,this._stateSetters.setBlending),this._blendingInvalid=!1}_setCulling(e){this._culling=this._setSubState(e,this._culling,this._cullingInvalid,this._stateSetters.setCulling),this._cullingInvalid=!1}_setPolygonOffset(e){this._polygonOffset=this._setSubState(e,this._polygonOffset,this._polygonOffsetInvalid,this._stateSetters.setPolygonOffset),this._polygonOffsetInvalid=!1}_setDepthTest(e){this._depthTest=this._setSubState(e,this._depthTest,this._depthTestInvalid,this._stateSetters.setDepthTest),this._depthTestInvalid=!1}_setStencilTest(e){this._stencilTest=this._setSubState(e,this._stencilTest,this._stencilTestInvalid,this._stateSetters.setStencilTest),this._stencilTestInvalid=!1}_setDepthWrite(e){this._depthWrite=this._setSubState(e,this._depthWrite,this._depthWriteInvalid,this._stateSetters.setDepthWrite),this._depthWriteInvalid=!1}_setColorWrite(e){this._colorWrite=this._setSubState(e,this._colorWrite,this._colorWriteInvalid,this._stateSetters.setColorWrite),this._colorWriteInvalid=!1}_setStencilWrite(e){this._stencilWrite=this._setSubState(e,this._stencilWrite,this._stencilWriteInvalid,this._stateSetters.setStencilWrite),this._stencilTestInvalid=!1}_setSubState(e,r,i,s){return(i||e!==r)&&(s(e),this._pipelineInvalid=!0),e}},iJe=class extends ei{constructor(){super(...arguments),this.heightParameters=Wt(),this.radii=Ve(),this.innerFadeDistance=0,this.altitudeFade=0,this.hazeStrength=1,this.renderScale=Ve(),this.backgroundColor=C()}},HA=class Rwe extends Pr{initializeProgram(e){return new Cr(e.rctx,Rwe.shader.get().build(this.configuration),br)}initializePipeline(){return this.configuration.reduced?At({blending:Tc(we.ONE,we.ZERO),depthTest:{func:Kr.ALWAYS},colorWrite:Vt}):this.configuration.haze?At({blending:xo(we.ONE,we.ZERO,we.ONE_MINUS_SRC_COLOR,we.ONE),colorWrite:Vt}):At({blending:Tc(we.SRC_ALPHA,we.ONE_MINUS_SRC_ALPHA),depthTest:{func:Kr.LEQUAL},colorWrite:Vt})}};HA.shader=new Er(DYe,()=>ae(()=>import("./ChapmanAtmosphere.glsl-afefa4ef.js"),[],import.meta.url));let pa=class extends ei{constructor(){super(),this._key="",this._keyDirty=!1,this._parameterBits=this._parameterBits?this._parameterBits.map(()=>0):[],this._parameterNames||(this._parameterNames=[])}get key(){return this._keyDirty&&(this._keyDirty=!1,this._key=String.fromCharCode.apply(String,this._parameterBits)),this._key}snapshot(){const e=this._parameterNames,r={key:this.key};for(const i of e)r[i]=this[i];return r}};function B(t={}){return(e,r)=>{if(e._parameterNames=e._parameterNames??[],e._parameterNames.push(r),t.constValue!=null)Object.defineProperty(e,r,{get:()=>t.constValue});else{const i=e._parameterNames.length-1,s=t.count||2,n=Math.ceil(Math.log2(s)),o=e._parameterBits??[0];let a=0;for(;o[a]+n>16;)a++,a>=o.length&&o.push(0);e._parameterBits=o;const l=o[a],c=(1<<n)-1<<l;o[a]+=n,Object.defineProperty(e,r,{get(){return this[i]},set(h){if(this[i]!==h&&(this[i]=h,this._keyDirty=!0,this._parameterBits[a]=this._parameterBits[a]&~c|+h<<l&c,typeof h!="number"&&typeof h!="boolean"))throw new Error("Configuration value for "+r+" must be boolean or number, got "+typeof h)}})}}}let t4=class extends pa{constructor(){super(...arguments),this.haze=!1,this.reduced=!1}};u([B()],t4.prototype,"haze",void 0),u([B()],t4.prototype,"reduced",void 0);let _o=class{constructor(e,r,i,s,n,o=!1,a=0){this.name=e,this.count=r,this.type=i,this.offset=s,this.stride=n,this.normalized=o,this.divisor=a}};new _o(E.POSITION,3,Ke.FLOAT,0,12);new _o(E.POSITION,3,Ke.FLOAT,0,20),new _o(E.UV0,2,Ke.FLOAT,12,20);new _o(E.POSITION,3,Ke.FLOAT,0,32),new _o(E.NORMAL,3,Ke.FLOAT,12,32),new _o(E.UV0,2,Ke.FLOAT,24,32);new _o(E.POSITION,3,Ke.FLOAT,0,16),new _o(E.COLOR,4,Ke.UNSIGNED_BYTE,12,16);const AX=[new _o(E.POSITION,2,Ke.FLOAT,0,8)],XR=[new _o(E.POSITION,2,Ke.FLOAT,0,16),new _o(E.UV0,2,Ke.FLOAT,8,16)];function uie(t){const e=t.gl;switch(e.getError()){case e.NO_ERROR:return null;case e.INVALID_ENUM:return"An unacceptable value has been specified for an enumerated argument";case e.INVALID_VALUE:return"An unacceptable value has been specified for an argument";case e.INVALID_OPERATION:return"The specified command is not allowed for the current state";case e.INVALID_FRAMEBUFFER_OPERATION:return"The currently bound framebuffer is not framebuffer complete";case e.OUT_OF_MEMORY:return"Not enough memory is left to execute the command";case e.CONTEXT_LOST_WEBGL:return"WebGL context is lost"}return"Unknown error"}function Fo(t,e){return t.vertexBuffers[e].byteLength/sJe(t.layout[e])}function sJe(t){return t[0].stride}function OX(t,e,r,i,s=0){const n=t.gl,o=t.capabilities.instancing;t.bindBuffer(r);for(const a of i){const l=e.get(a.name);l===void 0&&console.error(`There is no location for vertex attribute '${a.name}' defined.`);const c=s*a.stride;if(a.count<=4)n.vertexAttribPointer(l,a.count,a.type,a.normalized,a.stride,a.offset+c),n.enableVertexAttribArray(l),a.divisor>0&&o&&o.vertexAttribDivisor(l,a.divisor);else if(a.count===9)for(let h=0;h<3;h++)n.vertexAttribPointer(l+h,3,a.type,a.normalized,a.stride,a.offset+12*h+c),n.enableVertexAttribArray(l+h),a.divisor>0&&o&&o.vertexAttribDivisor(l+h,a.divisor);else if(a.count===16)for(let h=0;h<4;h++)n.vertexAttribPointer(l+h,4,a.type,a.normalized,a.stride,a.offset+16*h+c),n.enableVertexAttribArray(l+h),a.divisor>0&&o&&o.vertexAttribDivisor(l+h,a.divisor);else console.error("Unsupported vertex attribute element count: "+a.count)}}function RX(t,e,r,i){const s=t.gl,n=t.capabilities.instancing;t.bindBuffer(r);for(const o of i){const a=e.get(o.name);if(o.count<=4)s.disableVertexAttribArray(a),o.divisor&&o.divisor>0&&n&&n.vertexAttribDivisor(a,0);else if(o.count===9)for(let l=0;l<3;l++)s.disableVertexAttribArray(a+l),o.divisor&&o.divisor>0&&n&&n.vertexAttribDivisor(a+l,0);else if(o.count===16)for(let l=0;l<4;l++)s.disableVertexAttribArray(a+l),o.divisor&&o.divisor>0&&n&&n.vertexAttribDivisor(a+l,0);else console.error("Unsupported vertex attribute element count: "+o.count)}t.unbindBuffer(bt.ARRAY_BUFFER)}function PX(t){switch(t){case Tt.ALPHA:case Tt.LUMINANCE:case Tt.RED:case Tt.RED_INTEGER:case Xe.R8:case Xe.R8I:case Xe.R8UI:case Xe.R8_SNORM:case js.STENCIL_INDEX8:return 1;case Tt.LUMINANCE_ALPHA:case Tt.RG:case Tt.RG_INTEGER:case Xe.RGBA4:case Xe.R16F:case Xe.R16I:case Xe.R16UI:case Xe.RG8:case Xe.RG8I:case Xe.RG8UI:case Xe.RG8_SNORM:case Xe.RGB565:case Xe.RGB5_A1:case js.DEPTH_COMPONENT16:return 2;case Tt.DEPTH_COMPONENT:case Tt.RGB:case Tt.RGB_INTEGER:case Xe.RGB8:case Xe.RGB8I:case Xe.RGB8UI:case Xe.RGB8_SNORM:case Xe.SRGB8:case js.DEPTH_COMPONENT24:return 3;case Tt.DEPTH_STENCIL:case Tt.DEPTH24_STENCIL8:case Tt.RGBA:case Tt.RGBA_INTEGER:case Xe.RGBA8:case Xe.R32F:case Xe.R11F_G11F_B10F:case Xe.RG16F:case Xe.R32I:case Xe.R32UI:case Xe.RG16I:case Xe.RG16UI:case Xe.RGBA8I:case Xe.RGBA8UI:case Xe.RGBA8_SNORM:case Xe.SRGB8_ALPHA8:case Xe.RGB9_E5:case Xe.RGB10_A2UI:case Xe.RGB10_A2:case js.DEPTH_STENCIL:case js.DEPTH_COMPONENT32F:case js.DEPTH24_STENCIL8:return 4;case js.DEPTH32F_STENCIL8:return 5;case Xe.RGB16F:case Xe.RGB16I:case Xe.RGB16UI:return 6;case Xe.RG32F:case Xe.RG32I:case Xe.RG32UI:case Xe.RGBA16F:case Xe.RGBA16I:case Xe.RGBA16UI:return 8;case Xe.RGB32F:case Xe.RGB32I:case Xe.RGB32UI:return 12;case Xe.RGBA32F:case Xe.RGBA32I:case Xe.RGBA32UI:return 16;case us.COMPRESSED_RGB_S3TC_DXT1_EXT:case us.COMPRESSED_RGBA_S3TC_DXT1_EXT:return .5;case us.COMPRESSED_RGBA_S3TC_DXT3_EXT:case us.COMPRESSED_RGBA_S3TC_DXT5_EXT:return 1;case us.COMPRESSED_R11_EAC:case us.COMPRESSED_SIGNED_R11_EAC:case us.COMPRESSED_RGB8_ETC2:case us.COMPRESSED_SRGB8_ETC2:case us.COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2:case us.COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2:return .5;case us.COMPRESSED_RG11_EAC:case us.COMPRESSED_SIGNED_RG11_EAC:case us.COMPRESSED_RGBA8_ETC2_EAC:case us.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC:return 1}return 0}const ox=Q.getLogger("esri.views.webgl.VertexArrayObject");let $h=class{constructor(e,r,i,s,n=null){this._context=e,this._locations=r,this._layout=i,this._buffers=s,this._indexBuffer=n,this._glName=null,this._initialized=!1,e.instanceCounter.increment(An.VertexArrayObject,this)}get glName(){return this._glName}get context(){return this._context}get vertexBuffers(){return this._buffers}get indexBuffer(){return this._indexBuffer}get byteSize(){return Object.keys(this._buffers).reduce((e,r)=>e+this._buffers[r].byteLength,this._indexBuffer!=null?this._indexBuffer.byteLength:0)}get layout(){return this._layout}get locations(){return this._locations}get memoryEstimate(){return this.byteSize+(Object.keys(this._buffers).length+(this._indexBuffer?1:0))*mhe}dispose(){if(this._context){this._context.getBoundVAO()===this&&this._context.bindVAO(null);for(const e in this._buffers)this._buffers[e]?.dispose(),delete this._buffers[e];this._indexBuffer=Ue(this._indexBuffer),this.disposeVAOOnly()}else(this._glName||Object.getOwnPropertyNames(this._buffers).length>0)&&ox.warn("Leaked WebGL VAO")}disposeVAOOnly(){this._glName&&((this._context?.capabilities?.vao).deleteVertexArray(this._glName),this._glName=null),this._context.instanceCounter.decrement(An.VertexArrayObject,this),this._context=X2(this._context)}initialize(){if(this._initialized)return;const e=this._context.capabilities.vao;if(e){const r=e.createVertexArray();e.bindVertexArray(r),this._bindLayout(),e.bindVertexArray(null),this._glName=r}this._initialized=!0}bind(){this.initialize();const e=this._context.capabilities.vao;e?e.bindVertexArray(this.glName):(this._context.bindVAO(null),this._bindLayout())}_bindLayout(){const{_buffers:e,_layout:r,_indexBuffer:i}=this;e||ox.error("Vertex buffer dictionary is empty!");const s=this._context.gl;for(const n in e){const o=e[n];o||ox.error("Vertex buffer is uninitialized!");const a=r[n];a||ox.error("Vertex element descriptor is empty!"),OX(this._context,this._locations,o,a)}i!=null&&(this._context.capabilities.vao?s.bindBuffer(s.ELEMENT_ARRAY_BUFFER,i.glName):this._context.bindBuffer(i))}unbind(){this.initialize();const e=this._context.capabilities.vao;e?e.bindVertexArray(null):this._unbindLayout()}_unbindLayout(){const{_buffers:e,_layout:r}=this;e||ox.error("Vertex buffer dictionary is empty!");for(const i in e){const s=e[i];s||ox.error("Vertex buffer is uninitialized!");const n=r[i];RX(this._context,this._locations,s,n)}this._indexBuffer!=null&&this._context.unbindBuffer(this._indexBuffer.bufferType)}},pp=class extends $h{};var lr;function VG(t,e,r={}){const i=e===lr.WEBGL1?["webgl","experimental-webgl","webkit-3d","moz-webgl"]:["webgl2"];for(const s of i){const n=t.getContext(s,r);if(n)return n}return null}function nJe(t,e,r={}){const i=Pwe(t);for(const s of i){const n=VG(e,s,r);if(n)return n}return null}function Pwe(t){if(t==="3d")return[lr.WEBGL2];const e=oe("esri-force-webgl");return e===lr.WEBGL1||e===lr.WEBGL2?[e]:oe("mac")&&oe("chrome")?[lr.WEBGL1,lr.WEBGL2]:[lr.WEBGL2,lr.WEBGL1]}(function(t){t[t.WEBGL1=1]="WEBGL1",t[t.WEBGL2=2]="WEBGL2"})(lr||(lr={}));const Ep=Q.getLogger("esri.views.webgl.BufferObject");let Lr=class FT{static createIndex(e,r,i){return new FT(e,bt.ELEMENT_ARRAY_BUFFER,r,i)}static createVertex(e,r,i){return new FT(e,bt.ARRAY_BUFFER,r,i)}static createUniform(e,r,i){if(e.type!==lr.WEBGL2)throw new Error("Uniform buffers are supported in WebGL2 only!");return new FT(e,bt.UNIFORM_BUFFER,r,i)}static createPixelPack(e,r=Tr.STREAM_READ,i){if(e.type!==lr.WEBGL2)throw new Error("Pixel pack buffers are supported in WebGL2 only!");const s=new FT(e,bt.PIXEL_PACK_BUFFER,r);return i&&s.setSize(i),s}static createPixelUnpack(e,r=Tr.STREAM_DRAW,i){if(e.type!==lr.WEBGL2)throw new Error("Pixel unpack buffers are supported in WebGL2 only!");return new FT(e,bt.PIXEL_UNPACK_BUFFER,r,i)}constructor(e,r,i,s){this._context=e,this.bufferType=r,this.usage=i,this._glName=null,this._size=-1,this._indexType=void 0,e.instanceCounter.increment(An.BufferObject,this),this._glName=this._context.gl.createBuffer(),V0(this._context.gl),s&&this.setData(s)}get glName(){return this._glName}get size(){return this._size}get indexType(){return this._indexType}get byteLength(){return this.bufferType===bt.ELEMENT_ARRAY_BUFFER?this._indexType===Ke.UNSIGNED_INT?4*this._size:2*this._size:this._size}get _isVAOAware(){return this.bufferType===bt.ELEMENT_ARRAY_BUFFER||this.bufferType===bt.ARRAY_BUFFER}dispose(){this._context?.gl?(this._glName&&(this._context.gl.deleteBuffer(this._glName),this._glName=null),this._context.instanceCounter.decrement(An.BufferObject,this),this._context=X2(this._context)):this._glName&&Ep.warn("Leaked WebGL buffer object")}setSize(e,r=null){if(e<=0&&Ep.error("Buffer size needs to be positive!"),this.bufferType===bt.ELEMENT_ARRAY_BUFFER&&r!=null)switch(this._indexType=r,r){case Ke.UNSIGNED_SHORT:e*=2;break;case Ke.UNSIGNED_INT:e*=4}this._setBufferData(e)}setData(e){if(!e)return;let r=e.byteLength;this.bufferType===bt.ELEMENT_ARRAY_BUFFER&&(cF(e)&&(r/=2,this._indexType=Ke.UNSIGNED_SHORT),hF(e)&&(r/=4,this._indexType=Ke.UNSIGNED_INT)),this._setBufferData(r,e)}_setBufferData(e,r=null){this._size=e;const i=this._context.getBoundVAO();this._isVAOAware&&this._context.bindVAO(null),this._context.bindBuffer(this);const s=this._context.gl;r!=null?s.bufferData(this.bufferType,r,this.usage):s.bufferData(this.bufferType,e,this.usage),V0(s),this._isVAOAware&&this._context.bindVAO(i)}setSubData(e,r,i,s){if(!e)return;(r<0||r*e.BYTES_PER_ELEMENT>=this.byteLength)&&Ep.error("offset is out of range!"),i>=s&&Ep.error("end must be bigger than start!"),(r+(s-i))*e.BYTES_PER_ELEMENT>this.byteLength&&Ep.error("An attempt to write beyond the end of the buffer!");const n=this._context.getBoundVAO();this._isVAOAware&&this._context.bindVAO(null),this._context.bindBuffer(this);const o=this._context.gl;if(this._context.type===lr.WEBGL2)o.bufferSubData(this.bufferType,r*e.BYTES_PER_ELEMENT,e,i,s-i);else{const a=i===0&&s===e.length?e:e.subarray(i,s);o.bufferSubData(this.bufferType,r*e.BYTES_PER_ELEMENT,a)}V0(o),this._isVAOAware&&this._context.bindVAO(n)}getSubData(e,r=0,i,s){if(this._context.type!==lr.WEBGL2)return void Ep.error("Get buffer subdata is supported in WebGL2 only!");if(i<0||s<0)return void Ep.error("Problem getting subdata: offset and length were less than zero!");const n=oJe(e)?e.BYTES_PER_ELEMENT:1;if(n*((i??0)+(s??0))>e.byteLength)return void Ep.error("Problem getting subdata: offset and length exceeded destination size!");r+n*(s??0)>this.byteLength&&Ep.warn("Potential problem getting subdata: requested data exceeds buffer size!");const o=this._context.gl;this._context.bindBuffer(this,bt.COPY_READ_BUFFER),o.getBufferSubData(bt.COPY_READ_BUFFER,r,e,i,s),this._context.unbindBuffer(bt.COPY_READ_BUFFER)}async getSubDataAsync(e,r=0,i,s){this._context.type===lr.WEBGL2?(await this._context.clientWaitAsync(),this.getSubData(e,r,i,s)):Ep.error("Get buffer subdata is supported in WebGL2 only!")}};function oJe(t){return BOe(t)}var D_;(function(t){t[t.Texture=0]="Texture",t[t.RenderBuffer=1]="RenderBuffer"})(D_||(D_={}));let vr=class{constructor(e=0,r=e){this.width=e,this.height=r,this.target=is.TEXTURE_2D,this.pixelFormat=Tt.RGBA,this.dataType=ks.UNSIGNED_BYTE,this.samplingMode=Ct.LINEAR,this.wrapMode=$t.REPEAT,this.maxAnisotropy=1,this.flipped=!1,this.hasMipmap=!1,this.isOpaque=!1,this.unpackAlignment=4,this.preMultiplyAlpha=!1,this.depth=1,this.isImmutable=!1}};function aJe(t){return t.width<=0||t.height<=0||t.internalFormat==null?0:t.width*t.height*(t.hasMipmap?4/3:1)*PX(t.internalFormat)}let lJe=class Mwe extends vr{constructor(e,r){switch(super(),this.context=e,Object.assign(this,r),this.internalFormat){case Xe.R16F:case Xe.R16I:case Xe.R16UI:case Xe.R32F:case Xe.R32I:case Xe.R32UI:case Xe.R8_SNORM:case Xe.R8:case Xe.R8I:case Xe.R8UI:this.pixelFormat=Tt.RED}}static validate(e,r){return new Mwe(e,r)}};const hie=4;let Et=class{constructor(e,r=null,i=null){if(this.type=D_.Texture,this._glName=null,this._samplingModeDirty=!1,this._wrapModeDirty=!1,this._wasImmutablyAllocated=!1,"context"in e)this._descriptor=e,i=r;else{const s=lJe.validate(e,r);if(!s)throw new F("Texture descriptor invalid");this._descriptor=s}if(this._descriptor.context.instanceCounter.increment(An.Texture,this),this._descriptor.context.type!==lr.WEBGL2&&(this._descriptor.isImmutable&&(this._descriptor.isImmutable=!1),I1(this._descriptor.target)))throw new F("3D and array textures are not supported in WebGL1");this._descriptor.target===is.TEXTURE_CUBE_MAP?this._setDataCubeMap(i):this.setData(i)}get glName(){return this._glName}get descriptor(){return this._descriptor}get gpuMemoryUsage(){return pJe.delete(this),aJe(this._descriptor)}get isDirty(){return this._samplingModeDirty||this._wrapModeDirty}dispose(){this._descriptor.context.gl&&this._glName&&(this._descriptor.context.unbindTexture(this),this._descriptor.context.gl.deleteTexture(this._glName),this._glName=null,this._descriptor.context.instanceCounter.decrement(An.Texture,this))}release(){this.dispose()}resize(e,r){const i=this._descriptor;if(i.width!==e||i.height!==r){if(this._wasImmutablyAllocated)throw new F("Immutable textures can't be resized!");i.width=e,i.height=r,this._descriptor.target===is.TEXTURE_CUBE_MAP?this._setDataCubeMap(null):this.setData(null)}}_setDataCubeMap(e=null){for(let r=is.TEXTURE_CUBE_MAP_POSITIVE_X;r<=is.TEXTURE_CUBE_MAP_NEGATIVE_Z;r++)this._setData(e,r)}setData(e){this._setData(e)}_setData(e,r){if(!this._descriptor.context||!this._descriptor.context.gl)return;const i=this._descriptor.context.gl;V0(i),this._glName||(this._glName=i.createTexture()),e===void 0&&(e=null);const s=this._descriptor,n=r??s.target,o=I1(n);e===null&&(s.width=s.width||hie,s.height=s.height||hie,o&&(s.depth=s.depth??1));const a=this._descriptor.context.bindTexture(this,Et.TEXTURE_UNIT_FOR_UPDATES);this._descriptor.context.setActiveTexture(Et.TEXTURE_UNIT_FOR_UPDATES),n8(this._descriptor.context,s),this._configurePixelStorage(),V0(i);const l=this._deriveInternalFormat();if(o8(e)){let c=e.width,h=e.height;const p=1;e instanceof HTMLVideoElement&&(c=e.videoWidth,h=e.videoHeight),s.width&&s.height,o&&s.depth,s.isImmutable&&!this._wasImmutablyAllocated&&this._texStorage(n,l,s.hasMipmap,c,h,p),this._texImage(n,0,l,c,h,p,e),V0(i),s.hasMipmap&&this.generateMipmap(),s.width||(s.width=c),s.height||(s.height=h),o&&!s.depth&&(s.depth=p)}else{const{width:c,height:h,depth:p}=s;if(c==null||h==null)throw new F("Width and height must be specified!");if(o&&p==null)throw new F("Depth must be specified!");if(s.isImmutable&&!this._wasImmutablyAllocated&&this._texStorage(n,l,s.hasMipmap,c,h,p),WL(e)){const f=e.levels,m=fie(n,c,h,p),y=Math.min(m-1,f.length-1);this._descriptor.context.gl2!=null?i.texParameteri(s.target,this._descriptor.context.gl2.TEXTURE_MAX_LEVEL,y):s.hasMipmap=s.hasMipmap&&m===f.length;const _=l;if(!hJe(_))throw new F("Attempting to use compressed data with an uncompressed format!");this._forEachMipmapLevel((v,w,x,T)=>{const S=f[Math.min(v,f.length-1)];this._compressedTexImage(n,v,_,w,x,T,S)},y)}else this._texImage(n,0,l,c,h,p,e),V0(i),s.hasMipmap&&this.generateMipmap()}die(i,this._descriptor),pie(i,this._descriptor),cJe(this._descriptor.context,this._descriptor),V0(i),this._descriptor.context.bindTexture(a,Et.TEXTURE_UNIT_FOR_UPDATES)}updateData(e,r,i,s,n,o,a=0){o||console.error("An attempt to use uninitialized data!"),this._glName||console.error("An attempt to update uninitialized texture!");const l=this._descriptor.context.gl,c=this._descriptor.context.gl2,h=this._descriptor,p=this._deriveInternalFormat(),{pixelFormat:f,dataType:m,target:y,isImmutable:_}=h;if(_&&!this._wasImmutablyAllocated)throw new F("Cannot update immutable texture before allocation!");const v=this._descriptor.context.bindTexture(this,Et.TEXTURE_UNIT_FOR_UPDATES,!0);if((r<0||i<0||s>h.width||n>h.height||r+s>h.width||i+n>h.height)&&console.error("An attempt to update out of bounds of the texture!"),this._configurePixelStorage(),a){if(!c)return void console.error("Webgl2 must be enabled to use dataRowOffset!");l.pixelStorei(c.UNPACK_SKIP_ROWS,a)}if(o8(o)?c?c.texSubImage2D(y,e,r,i,s,n,f,m,o):l.texSubImage2D(y,e,r,i,f,m,o):WL(o)?l.compressedTexSubImage2D(y,e,r,i,s,n,p,o.levels[e]):l.texSubImage2D(y,e,r,i,s,n,f,m,o),a){if(!c)return void console.error("Webgl2 must be enabled to use dataRowOffset!");l.pixelStorei(c.UNPACK_SKIP_ROWS,0)}this._descriptor.context.bindTexture(v,Et.TEXTURE_UNIT_FOR_UPDATES)}updateData3D(e,r,i,s,n,o,a,l){l||console.error("An attempt to use uninitialized data!"),this._glName||console.error("An attempt to update uninitialized texture!");const c=this._descriptor.context.gl2;if(c==null)throw new F("3D textures are not supported in WebGL1");const h=this._descriptor,p=this._deriveInternalFormat(),{pixelFormat:f,dataType:m,isImmutable:y,target:_}=h;if(y&&!this._wasImmutablyAllocated)throw new F("Cannot update immutable texture before allocation!");I1(_)||console.warn("Attempting to set 3D texture data on a non-3D texture");const v=this._descriptor.context.bindTexture(this,Et.TEXTURE_UNIT_FOR_UPDATES);if(this._descriptor.context.setActiveTexture(Et.TEXTURE_UNIT_FOR_UPDATES),(r<0||i<0||s<0||n>h.width||o>h.height||a>h.depth||r+n>h.width||i+o>h.height||s+a>h.depth)&&console.error("An attempt to update out of bounds of the texture!"),this._configurePixelStorage(),WL(l))l=l.levels[e],c.compressedTexSubImage3D(_,e,r,i,s,n,o,a,p,l);else{const w=l;c.texSubImage3D(_,e,r,i,s,n,o,a,f,m,w)}this._descriptor.context.bindTexture(v,Et.TEXTURE_UNIT_FOR_UPDATES)}generateMipmap(){const e=this._descriptor;if(!e.hasMipmap){if(this._wasImmutablyAllocated)throw new F("Cannot add mipmaps to immutable texture after allocation");e.hasMipmap=!0,this._samplingModeDirty=!0,n8(this._descriptor.context,e)}e.samplingMode===Ct.LINEAR?(this._samplingModeDirty=!0,e.samplingMode=Ct.LINEAR_MIPMAP_NEAREST):e.samplingMode===Ct.NEAREST&&(this._samplingModeDirty=!0,e.samplingMode=Ct.NEAREST_MIPMAP_NEAREST);const r=this._descriptor.context.bindTexture(this,Et.TEXTURE_UNIT_FOR_UPDATES);this._descriptor.context.setActiveTexture(Et.TEXTURE_UNIT_FOR_UPDATES),this._descriptor.context.gl.generateMipmap(e.target),this._descriptor.context.bindTexture(r,Et.TEXTURE_UNIT_FOR_UPDATES)}setSamplingMode(e){e!==this._descriptor.samplingMode&&(this._descriptor.samplingMode=e,this._samplingModeDirty=!0)}setWrapMode(e){e!==this._descriptor.wrapMode&&(this._descriptor.wrapMode=e,n8(this._descriptor.context,this._descriptor),this._wrapModeDirty=!0)}applyChanges(){const e=this._descriptor.context.gl,r=this._descriptor;this._samplingModeDirty&&(die(e,r),this._samplingModeDirty=!1),this._wrapModeDirty&&(pie(e,r),this._wrapModeDirty=!1)}_deriveInternalFormat(){if(this._descriptor.context.type===lr.WEBGL1)return this._descriptor.internalFormat=this._descriptor.pixelFormat;if(this._descriptor.internalFormat!=null)return this._descriptor.internalFormat===Tt.DEPTH_STENCIL&&(this._descriptor.internalFormat=Tt.DEPTH24_STENCIL8),this._descriptor.internalFormat;switch(this._descriptor.dataType){case ks.FLOAT:switch(this._descriptor.pixelFormat){case Tt.RGBA:return this._descriptor.internalFormat=Xe.RGBA32F;case Tt.RGB:return this._descriptor.internalFormat=Xe.RGB32F;default:throw new F("Unable to derive format")}case ks.UNSIGNED_BYTE:switch(this._descriptor.pixelFormat){case Tt.RGBA:return this._descriptor.internalFormat=Xe.RGBA8;case Tt.RGB:return this._descriptor.internalFormat=Xe.RGB8}}return this._descriptor.internalFormat=this._descriptor.pixelFormat===Tt.DEPTH_STENCIL?Tt.DEPTH24_STENCIL8:this._descriptor.pixelFormat}_configurePixelStorage(){const e=this._descriptor.context.gl,{unpackAlignment:r,flipped:i,preMultiplyAlpha:s}=this._descriptor;e.pixelStorei(e.UNPACK_ALIGNMENT,r),e.pixelStorei(e.UNPACK_FLIP_Y_WEBGL,i?1:0),e.pixelStorei(e.UNPACK_PREMULTIPLY_ALPHA_WEBGL,s?1:0)}_texStorage(e,r,i,s,n,o){const a=this._descriptor.context.gl2;if(a==null)throw new F("Immutable textures are not supported in WebGL1");if(!uJe(r))throw new F("Immutable textures must have a sized internal format");if(!this._descriptor.isImmutable)return;const l=i?fie(e,s,n,o):1;if(I1(e)){if(o==null)throw new F("Missing depth dimension for 3D texture upload");a.texStorage3D(e,l,r,s,n,o)}else a.texStorage2D(e,l,r,s,n);this._wasImmutablyAllocated=!0}_texImage(e,r,i,s,n,o,a){const l=this._descriptor.context.gl,c=I1(e),{isImmutable:h,pixelFormat:p,dataType:f}=this._descriptor,m=this._descriptor.context.type===lr.WEBGL2,y=m?l:null;if(m||!o8(a))if(h){if(a!=null){const _=a;if(c){if(o==null)throw new F("Missing depth dimension for 3D texture upload");y.texSubImage3D(e,r,0,0,0,s,n,o,p,f,_)}else l.texSubImage2D(e,r,0,0,s,n,p,f,_)}}else{const _=a;if(c){if(o==null)throw new F("Missing depth dimension for 3D texture upload");y.texImage3D(e,r,i,s,n,o,0,p,f,_)}else l.texImage2D(e,r,i,s,n,0,p,f,_)}else l.texImage2D(e,0,i,p,f,a)}_compressedTexImage(e,r,i,s,n,o,a){const l=this._descriptor.context.gl;let c=null;const h=I1(e),p=this._descriptor.isImmutable;if(h){if(this._descriptor.context.type!==lr.WEBGL2)throw new F("3D textures are not supported in WebGL1");c=l}if(p){if(a!=null)if(h){if(o==null)throw new F("Missing depth dimension for 3D texture upload");c.compressedTexSubImage3D(e,r,0,0,0,s,n,o,i,a)}else l.compressedTexSubImage2D(e,r,0,0,s,n,i,a)}else if(h){if(o==null)throw new F("Missing depth dimension for 3D texture upload");c.compressedTexImage3D(e,r,i,s,n,o,0,a)}else l.compressedTexImage2D(e,r,i,s,n,0,a)}_forEachMipmapLevel(e,r=1/0){let{width:i,height:s,depth:n,hasMipmap:o,target:a}=this._descriptor;const l=a===is.TEXTURE_3D;if(i==null||s==null||l&&n==null)throw new F("Missing texture dimensions for mipmap calculation");for(let c=0;e(c,i,s,n),o&&(i!==1||s!==1||l&&n!==1)&&!(c>=r);++c)i=Math.max(1,i>>1),s=Math.max(1,s>>1),l&&(n=Math.max(1,n>>1))}};function n8(t,e){(e.width!=null&&e.width<0||e.height!=null&&e.height<0||e.depth!=null&&e.depth<0)&&console.error("Negative dimension parameters are not allowed!");const r=t.type===lr.WEBGL2;r||!e.isImmutable&&!I1(e.target)||console.error("Immutable and 3D-like textures are not supported in WebGL1!"),!r&&(e.width!=null&&Xb(e.width)&&e.height!=null&&Xb(e.height)||(typeof e.wrapMode=="number"?e.wrapMode!==$t.CLAMP_TO_EDGE&&console.error("Non-power-of-two textures must have a wrap mode of CLAMP_TO_EDGE!"):e.wrapMode.s===$t.CLAMP_TO_EDGE&&e.wrapMode.t===$t.CLAMP_TO_EDGE||console.error("Non-power-of-two textures must have a wrap mode of CLAMP_TO_EDGE!"),e.hasMipmap&&console.error("Mipmapping requires power-of-two textures!")))}function die(t,e){let r=e.samplingMode,i=e.samplingMode;r===Ct.LINEAR_MIPMAP_NEAREST||r===Ct.LINEAR_MIPMAP_LINEAR?(r=Ct.LINEAR,e.hasMipmap||(i=Ct.LINEAR)):r!==Ct.NEAREST_MIPMAP_NEAREST&&r!==Ct.NEAREST_MIPMAP_LINEAR||(r=Ct.NEAREST,e.hasMipmap||(i=Ct.NEAREST)),t.texParameteri(e.target,t.TEXTURE_MAG_FILTER,r),t.texParameteri(e.target,t.TEXTURE_MIN_FILTER,i)}function pie(t,e){typeof e.wrapMode=="number"?(t.texParameteri(e.target,t.TEXTURE_WRAP_S,e.wrapMode),t.texParameteri(e.target,t.TEXTURE_WRAP_T,e.wrapMode)):(t.texParameteri(e.target,t.TEXTURE_WRAP_S,e.wrapMode.s),t.texParameteri(e.target,t.TEXTURE_WRAP_T,e.wrapMode.t))}function cJe(t,e){const r=t.capabilities.textureFilterAnisotropic;r&&t.gl.texParameterf(e.target,r.TEXTURE_MAX_ANISOTROPY,e.maxAnisotropy??1)}function uJe(t){return t in Xe}function hJe(t){return t in us}function WL(t){return t!=null&&"type"in t&&t.type==="compressed"}function dJe(t){return t!=null&&"byteLength"in t}function o8(t){return t!=null&&!WL(t)&&!dJe(t)}function I1(t){return t===is.TEXTURE_3D||t===is.TEXTURE_2D_ARRAY}function fie(t,e,r,i=1){let s=Math.max(e,r);return t===is.TEXTURE_3D&&(s=Math.max(s,i)),Math.round(Math.log(s)/Math.LN2)+1}Et.TEXTURE_UNIT_FOR_UPDATES=0;const pJe=new Map;function Rl(t,e=AX,r=br,i=-1,s=1){let n=null;return e===XR?n=new Float32Array([i,i,0,0,s,i,1,0,i,s,0,1,s,s,1,1]):n=new Float32Array([i,i,s,i,i,s,s,s]),new pp(t,r,{geometry:e},{geometry:Lr.createVertex(t,Tr.STATIC_DRAW,n)})}function fJe(t,e=AX,r=br){const i=new Float32Array([-1,-1,3,-1,-1,3]);return new pp(t,r,{geometry:e},{geometry:Lr.createVertex(t,Tr.STATIC_DRAW,i)})}const Iwe=4;function $we(t,e=Iwe){const r=new vr;return r.samplingMode=Ct.NEAREST,r.width=r.height=e,new Et(t,r)}function mJe(t,e,r=Iwe){const i=new Uint8Array(r*r*4);for(let n=0;n<i.length;n+=4)i[n]=255*e[0],i[n+1]=255*e[1],i[n+2]=255*e[2],i[n+3]=255*e[3];const s=new vr;return s.samplingMode=Ct.NEAREST,s.width=s.height=r,new Et(t,s,i)}function Lwe(t){const e=new vr;return e.samplingMode=Ct.NEAREST,e.width=e.height=1,new Et(t,e,new Uint8Array([255,255,255,255]))}let mie=class{constructor(e,r){this._view=e,this.type=ea.Realistic,this._handles=new Oi,this._passParameters=new iJe,this._rootTileElevationMin=NaN,this._lowerBoundEarthRadius=nr.radius,this._fadeHaze=0,this._tmpScale=Ve(),this._updateRadius(nr.radius);const i=r.renderContext.rctx;this._updateRootTileElevationBounds(),this._handles.add([le(()=>this._view?.basemapTerrain?.rootTileElevationBounds,()=>this._view?.basemapTerrain?this._updateRootTileElevationBounds():null),le(()=>this._view?.basemapTerrain?.visibleElevationBounds,()=>this._view?.basemapTerrain?this._updateVisibleElevationBounds():null)]);const s=new t4;s.haze=!1,this._atmosphereTechnique=r.techniqueRepository.acquire(HA,s),s.haze=!0,this._atmosphereHazeTechnique=r.techniqueRepository.acquire(HA,s),s.reduced=!0,s.haze=!1,this._atmosphereReducedTechnique=r.techniqueRepository.acquire(HA,s),s.haze=!0,this._atmosphereHazeReducedTechnique=r.techniqueRepository.acquire(HA,s),this._vao=Rl(i,XR)}destroy(){this._handles.destroy(),this._atmosphereTechnique.release(),this._atmosphereHazeTechnique.release(),this._atmosphereReducedTechnique.release(),this._atmosphereHazeReducedTechnique.release(),this._vao.dispose()}render(e,r){this._render(e,r?this._atmosphereTechnique:this._atmosphereReducedTechnique,e.offscreenRenderingHelper.depthTexture,r,!1)}renderHaze(e,r,i){this._fadeHaze=r,this._render(e,i?this._atmosphereHazeTechnique:this._atmosphereHazeReducedTechnique,e.offscreenRenderingHelper.linearDepthTexture,i,!0)}_render(e,r,i,s,n){if(i==null)return;const o=e.offscreenRenderingHelper;this._update(e.bindParameters.camera),this._passParameters.depthTexture=i;const a=o.background.color;se(this._passParameters.backgroundColor,a[0]*a[3],a[1]*a[3],a[2]*a[3]);const l=e.rctx.bindTechnique(r,this._passParameters,e.bindParameters);if(s)o.renderDepthDetached(()=>this._renderCommon(l,e));else{const c=e.rctx.getViewport(),h=Ce(e.bindParameters.camera.eye)-nr.radius;let p;if(h<I0){const y=Math.min(1,Math.max(0,h/I0));p=n?wt(.4,.5,y):wt(.2,.3,y)}else{const y=Math.min(1,Math.max(0,(h-I0)/(15*I0)));p=n?wt(.5,1,y):wt(.3,.6,y)}const f=Math.floor(p*e.bindParameters.camera.fullViewport[2]),m=Math.floor(p*e.bindParameters.camera.fullViewport[3]);e.rctx.setViewport(0,0,f,m),o.renderToTargets(()=>this._renderCommon(l,e),o.tmpColor,o.tmpDepth,[0,0,0,1],!1,!1),e.rctx.setViewport(c.x,c.y,c.width,c.height),or(this._tmpScale,f/e.bindParameters.camera.fullViewport[2],m/e.bindParameters.camera.fullViewport[3]),o.compositeAtmosphereToMain(e.bindParameters,n,i,this._tmpScale)}}_renderCommon(e,r){this._vao!=null&&(r.rctx.bindVAO(this._vao),e.assertCompatibleVertexAttributeLocations(this._vao),r.rctx.drawArrays(St.TRIANGLE_STRIP,0,4))}_adjustRadiusForTesselation(e){return e*Math.cos(Math.PI/16/16)}_updateRootTileElevationBounds(){const e=this._view.basemapTerrain.rootTileElevationBounds.min;e!==this._rootTileElevationMin&&(this._rootTileElevationMin=e,this._lowerBoundEarthRadius=nr.radius,this._updateVisibleElevationBounds())}_updateVisibleElevationBounds(){const e=this._adjustRadiusForTesselation(nr.radius+this._view.basemapTerrain.visibleElevationBounds.min);e<this._lowerBoundEarthRadius&&this._updateRadius(e)}_updateRadius(e){this._lowerBoundEarthRadius=e,or(this._passParameters.radii,e,e+I0),this._passParameters.innerFadeDistance=2*Math.sqrt((2*e-DG)*DG)}_update(e){if(!e)return;const r=na(e.eye),i=Math.sqrt(r),s=r-this._passParameters.radii[1]*this._passParameters.radii[1],n=ge((i-this._passParameters.radii[0])/I0,0,1);bi(this._passParameters.heightParameters,i,r,s,n),this._passParameters.altitudeFade=EX(i-this._lowerBoundEarthRadius),this._passParameters.hazeStrength=wt(wt(.6,1,TO(9500,10500,i-nr.radius)),1,this._fadeHaze)}static isSupported(e){return e.renderContext.rctx.capabilities.depthTexture}};function Dwe(t){t.fragment.code.add(b`vec4 textureAtlasLookup(sampler2D tex, vec2 textureCoordinates, vec4 atlasRegion) {
vec2 atlasScale = atlasRegion.zw - atlasRegion.xy;
vec2 uvAtlas = fract(textureCoordinates) * atlasScale + atlasRegion.xy;
float maxdUV = 0.125;
vec2 dUVdx = clamp(dFdx(textureCoordinates), -maxdUV, maxdUV) * atlasScale;
vec2 dUVdy = clamp(dFdy(textureCoordinates), -maxdUV, maxdUV) * atlasScale;
return textureGrad(tex, uvAtlas, dUVdx, dUVdy);
}`)}function MX(t,e){switch(t.include(Pf,e),e.textureCoordinateType){case Ps.Default:case Ps.Compressed:return void t.fragment.code.add(b`vec4 textureLookup(sampler2D tex, vec2 uv) {
return texture(tex, uv);
}`);case Ps.Atlas:return t.include(Dwe),void t.fragment.code.add(b`vec4 textureLookup(sampler2D tex, vec2 uv) {
return textureAtlasLookup(tex, uv, vuvRegion);
}`);default:e.textureCoordinateType;case Ps.None:case Ps.COUNT:return}}let cu=class extends as{constructor(e,r){super(e,"vec3",Qr.Draw,(i,s,n,o)=>i.setUniform3fv(e,r(s,n,o)))}},bh=class extends as{constructor(e,r){super(e,"sampler2D",Qr.Draw,(i,s,n)=>i.bindTexture(e,r(s,n)))}},K_=class{constructor(e){this._material=e.material,this._techniqueRepository=e.techniqueRep,this._output=e.output}dispose(){this._techniqueRepository.release(this._technique)}get technique(){return this._technique}get _stippleTextureRepository(){return this._techniqueRepository.constructionContext.stippleTextureRepository}get _markerTextureRepository(){return this._techniqueRepository.constructionContext.markerTextureRepository}ensureTechnique(e,r){return this._technique=this._techniqueRepository.releaseAndAcquire(e,this._material.getConfiguration(this._output,r),this._technique),this._technique}ensureResources(e){return wg.LOADED}},IX=class extends K_{constructor(e){super(e),this._numLoading=0,this._disposed=!1,this._textureRepository=e.textureRep,this._textureId=e.textureId,this._acquire(e.textureId,r=>this._texture=r),this._acquire(e.normalTextureId,r=>this._textureNormal=r),this._acquire(e.emissiveTextureId,r=>this._textureEmissive=r),this._acquire(e.occlusionTextureId,r=>this._textureOcclusion=r),this._acquire(e.metallicRoughnessTextureId,r=>this._textureMetallicRoughness=r)}dispose(){this._texture=Ui(this._texture),this._textureNormal=Ui(this._textureNormal),this._textureEmissive=Ui(this._textureEmissive),this._textureOcclusion=Ui(this._textureOcclusion),this._textureMetallicRoughness=Ui(this._textureMetallicRoughness),this._disposed=!0}ensureResources(e){return this._numLoading===0?wg.LOADED:wg.LOADING}get textureBindParameters(){return new Nwe(this._texture!=null?this._texture.glTexture:null,this._textureNormal!=null?this._textureNormal.glTexture:null,this._textureEmissive!=null?this._textureEmissive.glTexture:null,this._textureOcclusion!=null?this._textureOcclusion.glTexture:null,this._textureMetallicRoughness!=null?this._textureMetallicRoughness.glTexture:null)}updateTexture(e){this._texture!=null&&e===this._texture.id||(this._texture=Ui(this._texture),this._textureId=e,this._acquire(this._textureId,r=>this._texture=r))}_acquire(e,r){if(e==null)return void r(null);const i=this._textureRepository.acquire(e);if(bu(i))return++this._numLoading,void i.then(s=>{if(this._disposed)return Ui(s),void r(null);r(s)}).finally(()=>--this._numLoading);r(i)}},Nwe=class extends ei{constructor(e=null,r=null,i=null,s=null,n=null){super(),this.texture=e,this.textureNormal=r,this.textureEmissive=i,this.textureOcclusion=s,this.textureMetallicRoughness=n}};var st;(function(t){t[t.Disabled=0]="Disabled",t[t.Normal=1]="Normal",t[t.Schematic=2]="Schematic",t[t.Water=3]="Water",t[t.WaterOnIntegratedMesh=4]="WaterOnIntegratedMesh",t[t.Terrain=5]="Terrain",t[t.TerrainWithWater=6]="TerrainWithWater",t[t.COUNT=7]="COUNT"})(st||(st={}));function $X(t,e){const r=t.fragment,i=e.hasMetallicRoughnessTexture||e.hasEmissionTexture||e.hasOcclusionTexture;if(e.pbrMode===st.Normal&&i&&t.include(MX,e),e.pbrMode!==st.Schematic)if(e.pbrMode!==st.Disabled){if(e.pbrMode===st.Normal){r.code.add(b`vec3 mrr;
vec3 emission;
float occlusion;`);const s=e.pbrTextureBindType;e.hasMetallicRoughnessTexture&&(r.uniforms.add(s===Qr.Pass?new Je("texMetallicRoughness",n=>n.textureMetallicRoughness):new bh("texMetallicRoughness",n=>n.textureMetallicRoughness)),r.code.add(b`void applyMetallnessAndRoughness(vec2 uv) {
vec3 metallicRoughness = textureLookup(texMetallicRoughness, uv).rgb;
mrr[0] *= metallicRoughness.b;
mrr[1] *= metallicRoughness.g;
}`)),e.hasEmissionTexture&&(r.uniforms.add(s===Qr.Pass?new Je("texEmission",n=>n.textureEmissive):new bh("texEmission",n=>n.textureEmissive)),r.code.add(b`void applyEmission(vec2 uv) {
emission *= textureLookup(texEmission, uv).rgb;
}`)),e.hasOcclusionTexture?(r.uniforms.add(s===Qr.Pass?new Je("texOcclusion",n=>n.textureOcclusion):new bh("texOcclusion",n=>n.textureOcclusion)),r.code.add(b`void applyOcclusion(vec2 uv) {
occlusion *= textureLookup(texOcclusion, uv).r;
}
float getBakedOcclusion() {
return occlusion;
}`)):r.code.add(b`float getBakedOcclusion() { return 1.0; }`),s===Qr.Pass?r.uniforms.add(new Ft("emissionFactor",n=>n.emissiveFactor),new Ft("mrrFactors",n=>n.mrrFactors)):r.uniforms.add(new cu("emissionFactor",n=>n.emissiveFactor),new cu("mrrFactors",n=>n.mrrFactors)),r.code.add(b`
    void applyPBRFactors() {
      mrr = mrrFactors;
      emission = emissionFactor;
      occlusion = 1.0;

      ${e.hasMetallicRoughnessTexture?b`applyMetallnessAndRoughness(${e.hasMetallicRoughnessTextureTransform?b`metallicRoughnessUV`:"vuv0"});`:""}

      ${e.hasEmissionTexture?b`applyEmission(${e.hasEmissiveTextureTransform?b`emissiveUV`:"vuv0"});`:""}

      ${e.hasOcclusionTexture?b`applyOcclusion(${e.hasOcclusionTextureTransform?b`occlusionUV`:"vuv0"});`:""}
    }
  `)}}else r.code.add(b`float getBakedOcclusion() { return 1.0; }`);else r.code.add(b`vec3 mrr = vec3(0.0, 0.6, 0.2);
vec3 emission = vec3(0.0);
float occlusion = 1.0;
void applyPBRFactors() {}
float getBakedOcclusion() { return 1.0; }`)}function LX(t,e){const r=t.fragment,i=e.lightingSphericalHarmonicsOrder!==void 0?e.lightingSphericalHarmonicsOrder:2;i===0?(r.uniforms.add(new Ft("lightingAmbientSH0",(s,n)=>se(gie,n.lighting.sh.r[0],n.lighting.sh.g[0],n.lighting.sh.b[0]))),r.code.add(b`vec3 calculateAmbientIrradiance(vec3 normal, float ambientOcclusion) {
vec3 ambientLight = 0.282095 * lightingAmbientSH0;
return ambientLight * (1.0 - ambientOcclusion);
}`)):i===1?(r.uniforms.add(new sr("lightingAmbientSH_R",(s,n)=>bi(dm,n.lighting.sh.r[0],n.lighting.sh.r[1],n.lighting.sh.r[2],n.lighting.sh.r[3])),new sr("lightingAmbientSH_G",(s,n)=>bi(dm,n.lighting.sh.g[0],n.lighting.sh.g[1],n.lighting.sh.g[2],n.lighting.sh.g[3])),new sr("lightingAmbientSH_B",(s,n)=>bi(dm,n.lighting.sh.b[0],n.lighting.sh.b[1],n.lighting.sh.b[2],n.lighting.sh.b[3]))),r.code.add(b`vec3 calculateAmbientIrradiance(vec3 normal, float ambientOcclusion) {
vec4 sh0 = vec4(
0.282095,
0.488603 * normal.x,
0.488603 * normal.z,
0.488603 * normal.y
);
vec3 ambientLight = vec3(
dot(lightingAmbientSH_R, sh0),
dot(lightingAmbientSH_G, sh0),
dot(lightingAmbientSH_B, sh0)
);
return ambientLight * (1.0 - ambientOcclusion);
}`)):i===2&&(r.uniforms.add(new Ft("lightingAmbientSH0",(s,n)=>se(gie,n.lighting.sh.r[0],n.lighting.sh.g[0],n.lighting.sh.b[0])),new sr("lightingAmbientSH_R1",(s,n)=>bi(dm,n.lighting.sh.r[1],n.lighting.sh.r[2],n.lighting.sh.r[3],n.lighting.sh.r[4])),new sr("lightingAmbientSH_G1",(s,n)=>bi(dm,n.lighting.sh.g[1],n.lighting.sh.g[2],n.lighting.sh.g[3],n.lighting.sh.g[4])),new sr("lightingAmbientSH_B1",(s,n)=>bi(dm,n.lighting.sh.b[1],n.lighting.sh.b[2],n.lighting.sh.b[3],n.lighting.sh.b[4])),new sr("lightingAmbientSH_R2",(s,n)=>bi(dm,n.lighting.sh.r[5],n.lighting.sh.r[6],n.lighting.sh.r[7],n.lighting.sh.r[8])),new sr("lightingAmbientSH_G2",(s,n)=>bi(dm,n.lighting.sh.g[5],n.lighting.sh.g[6],n.lighting.sh.g[7],n.lighting.sh.g[8])),new sr("lightingAmbientSH_B2",(s,n)=>bi(dm,n.lighting.sh.b[5],n.lighting.sh.b[6],n.lighting.sh.b[7],n.lighting.sh.b[8]))),r.code.add(b`vec3 calculateAmbientIrradiance(vec3 normal, float ambientOcclusion) {
vec3 ambientLight = 0.282095 * lightingAmbientSH0;
vec4 sh1 = vec4(
0.488603 * normal.x,
0.488603 * normal.z,
0.488603 * normal.y,
1.092548 * normal.x * normal.y
);
vec4 sh2 = vec4(
1.092548 * normal.y * normal.z,
0.315392 * (3.0 * normal.z * normal.z - 1.0),
1.092548 * normal.x * normal.z,
0.546274 * (normal.x * normal.x - normal.y * normal.y)
);
ambientLight += vec3(
dot(lightingAmbientSH_R1, sh1),
dot(lightingAmbientSH_G1, sh1),
dot(lightingAmbientSH_B1, sh1)
);
ambientLight += vec3(
dot(lightingAmbientSH_R2, sh2),
dot(lightingAmbientSH_G2, sh2),
dot(lightingAmbientSH_B2, sh2)
);
return ambientLight * (1.0 - ambientOcclusion);
}`),e.pbrMode!==st.Normal&&e.pbrMode!==st.Schematic||r.code.add(b`const vec3 skyTransmittance = vec3(0.9, 0.9, 1.0);
vec3 calculateAmbientRadiance(float ambientOcclusion)
{
vec3 ambientLight = 1.2 * (0.282095 * lightingAmbientSH0) - 0.2;
return ambientLight *= (1.0 - ambientOcclusion) * skyTransmittance;
}`))}const gie=C(),dm=Wt();function YR(t){t.vertex.code.add(b`const float PI = 3.141592653589793;`),t.fragment.code.add(b`const float PI = 3.141592653589793;
const float LIGHT_NORMALIZATION = 1.0 / PI;
const float INV_PI = 0.3183098861837907;
const float HALF_PI = 1.570796326794897;`)}var Os,lw;function gJe(t){return t?.cubeMap!=null}function DX(t){return t!=null&&!t.running}(function(t){t[t.RENDERING=0]="RENDERING",t[t.FINISHED_RENDERING=1]="FINISHED_RENDERING",t[t.FADING_TEXTURE_CHANNELS=2]="FADING_TEXTURE_CHANNELS",t[t.SWITCH_CHANNELS=3]="SWITCH_CHANNELS",t[t.FINISHED=4]="FINISHED"})(Os||(Os={})),function(t){t[t.RG=0]="RG",t[t.BA=1]="BA"}(lw||(lw={}));let yJe=class{constructor(){this.readChannels=lw.RG,this.renderingStage=Os.FINISHED,this.startTime=0,this.startTimeHeightFade=0,this.cameraPositionLastFrame=C(),this.isCameraPositionFinal=!0,this.parallax=new yie,this.parallaxNew=new yie,this.crossFade={enabled:!1,factor:1,distanceThresholdFactor:.3},this.fadeInOut={stage:bn.FINISHED,factor:1,distanceThresholdFactor:.6},this.fadeIn={stage:sc.FINISHED,factor:1,distanceThresholdFactor:2},this.fadeInOutHeight={stage:N_.FINISHED,factor:-1}}get isFading(){return this.fadeInOut.stage===bn.FADE_OUT||this.fadeInOut.stage===bn.FADE_IN||this.fadeIn.stage===sc.FADE_IN||this.fadeInOutHeight.stage!==N_.FINISHED||this.renderingStage===Os.FADING_TEXTURE_CHANNELS}};var sc,bn,N_;(function(t){t[t.FINISHED=0]="FINISHED",t[t.CHANGE_ANCHOR=1]="CHANGE_ANCHOR",t[t.FADE_IN=2]="FADE_IN"})(sc||(sc={})),function(t){t[t.FINISHED=0]="FINISHED",t[t.FADE_OUT=1]="FADE_OUT",t[t.SWITCH=2]="SWITCH",t[t.FADE_IN=3]="FADE_IN"}(bn||(bn={})),function(t){t[t.FINISHED=0]="FINISHED",t[t.HEIGHT_FADE=1]="HEIGHT_FADE"}(N_||(N_={}));let yie=class{constructor(){this.anchorPointClouds=C(),this.cloudsHeight=1e5,this.radiusCurvatureCorrectionFactor=0,this.transform=be()}},Mf=class extends as{constructor(e,r){super(e,"bool",Qr.Pass,(i,s,n)=>i.setUniform1b(e,r(s,n)))}},_Je=class extends as{constructor(e,r){super(e,"samplerCube",Qr.Pass,(i,s,n)=>i.bindTexture(e,r(s,n)))}};function Fwe(t){const e=t.fragment;e.uniforms.add(new $i("rotationMatrixClouds",(r,i)=>i.cloudsFade.parallax.transform),new $i("rotationMatrixCloudsCrossFade",(r,i)=>i.cloudsFade.parallaxNew.transform),new Ft("anchorPosition",(r,i)=>i.cloudsFade.parallax.anchorPointClouds),new Ft("anchorPositionCrossFade",(r,i)=>i.cloudsFade.parallaxNew.anchorPointClouds),new Re("cloudsHeight",(r,i)=>i.cloudsFade.parallax.cloudsHeight),new Re("radiusCurvatureCorrectionFactor",(r,i)=>i.cloudsFade.parallax.radiusCurvatureCorrectionFactor),new Re("totalFadeInOut",(r,i)=>i.cloudsFade.fadeInOut.stage===bn.FINISHED?i.cloudsFade.fadeInOutHeight.factor+1-i.cloudsFade.fadeIn.factor:i.cloudsFade.fadeInOutHeight.factor+1-i.cloudsFade.fadeInOut.factor),new Re("crossFadeAnchorFactor",(r,i)=>ge(i.cloudsFade.crossFade.factor,0,1)),new _Je("cubeMap",(r,i)=>i.cloudsFade.data?.cubeMap?i.cloudsFade.data.cubeMap.colorTexture:null),new Mf("crossFade",(r,i)=>i.cloudsFade.crossFade.enabled),new Mf("readChannelsRG",(r,i)=>i.cloudsFade.readChannels===lw.RG),new Mf("fadeTextureChannels",(r,i)=>i.cloudsFade.renderingStage===Os.FADING_TEXTURE_CHANNELS)),e.constants.add("planetRadius","float",nr.radius),e.code.add(b`vec3 intersectWithCloudLayer(vec3 dir, vec3 cameraPosition, vec3 spherePos)
{
float radiusClouds = planetRadius + cloudsHeight;
float B = 2.0 * dot(cameraPosition, dir);
float C = dot(cameraPosition, cameraPosition) - radiusClouds * radiusClouds;
float det = B * B - 4.0 * C;
float pointIntDist = max(0.0, 0.5 *(-B + sqrt(det)));
vec3 intersectionPont = cameraPosition + dir * pointIntDist;
intersectionPont =  intersectionPont - spherePos;
return intersectionPont;
}`),e.code.add(b`vec3 correctForPlanetCurvature(vec3 dir)
{
dir.z = dir.z*(1.-radiusCurvatureCorrectionFactor) + radiusCurvatureCorrectionFactor;
return dir;
}`),e.code.add(b`vec3 rotateDirectionToAnchorPoint(mat4 rotMat, vec3 inVec)
{
return (rotMat * vec4(inVec, 0.0)).xyz;
}`),Jg(e),im(e),e.code.add(b`const float SUNSET_TRANSITION_FACTOR = 0.3;
const vec3 RIM_COLOR = vec3(0.28, 0.175, 0.035);
const float RIM_SCATTERING_FACTOR = 140.0;
const float BACKLIGHT_FACTOR = 0.2;
const float BACKLIGHT_SCATTERING_FACTOR = 10.0;
const float BACKLIGHT_TRANSITION_FACTOR = 0.3;
vec3 calculateCloudColor(vec3 cameraPosition, vec3 worldSpaceRay, vec4 clouds)
{
float upDotLight = dot(normalize(cameraPosition), normalize(mainLightDirection));
float dirDotLight = max(dot(normalize(-worldSpaceRay), normalize(mainLightDirection)), 0.0);
float sunsetTransition = clamp(pow(max(upDotLight, 0.0), SUNSET_TRANSITION_FACTOR), 0.0, 1.0);
vec3 ambientLight = calculateAmbientIrradiance(normalize(cameraPosition),  0.0);
vec3 mainLight = evaluateMainLighting(normalize(cameraPosition),  0.0);
vec3 combinedLight = clamp((mainLightIntensity + ambientLight )/PI, vec3(0.0), vec3(1.0));
vec3 baseCloudColor = pow(combinedLight * pow(clouds.xyz, vec3(GAMMA)), vec3(INV_GAMMA));
float scatteringMod = max(clouds.a < 0.5 ? clouds.a / 0.5 : - clouds.a / 0.5 + 2.0, 0.0);
float rimLightIntensity = 0.5 + 0.5 *pow(max(upDotLight, 0.0), 0.35);
vec3 directSunScattering = RIM_COLOR * rimLightIntensity * (pow(dirDotLight, RIM_SCATTERING_FACTOR)) * scatteringMod;
float additionalLight = BACKLIGHT_FACTOR * pow(dirDotLight, BACKLIGHT_SCATTERING_FACTOR) * (1. - pow(sunsetTransition, BACKLIGHT_TRANSITION_FACTOR)) ;
return vec3(baseCloudColor * (1. + additionalLight) + directSunScattering);
}`),e.code.add(b`vec4 getCloudData(vec3 rayDir, bool readOtherChannel)
{
vec4 cloudData = texture(cubeMap, rayDir);
float mu = dot(rayDir, vec3(0, 0, 1));
bool readChannels = readChannelsRG ^^ readOtherChannel;
if (readChannels) {
cloudData = vec4(vec3(cloudData.r), cloudData.g);
} else {
cloudData = vec4(vec3(cloudData.b), cloudData.a);
}
if (length(cloudData) == 0.0) {
return vec4(cloudData.rgb, 1.0);
}
return cloudData;
}`),e.code.add(b`vec4 renderCloudsNoFade(vec3 worldRay, vec3 cameraPosition)
{
vec3 intersectionPoint = intersectWithCloudLayer(normalize(worldRay), cameraPosition, anchorPosition);
vec3 worldRayRotated = rotateDirectionToAnchorPoint(rotationMatrixClouds, normalize(intersectionPoint));
vec3 worldRayRotatedCorrected = correctForPlanetCurvature(worldRayRotated);
vec4 cloudData = getCloudData(worldRayRotatedCorrected, false);
float totalTransmittance = clamp(cloudData.a * (1.0 - totalFadeInOut) + totalFadeInOut, 0.0 , 1.0);
if (length(cloudData.rgb) == 0.0) {
totalTransmittance = 1.0;
}
return vec4(calculateCloudColor(cameraPosition, normalize(-worldRay), cloudData), totalTransmittance);
}`),e.code.add(b`vec4 renderCloudsCrossFade(vec3 worldRay, vec3 cameraPosition)
{
vec3 intersectionPoint = intersectWithCloudLayer(normalize(worldRay), cameraPosition, anchorPosition);
vec3 worldRayRotated = rotateDirectionToAnchorPoint(rotationMatrixClouds, normalize(intersectionPoint));
vec3 worldRayRotatedCorrected = correctForPlanetCurvature(worldRayRotated);
vec4 cloudData = getCloudData(worldRayRotatedCorrected, false);
vec4 cloudColor = vec4(calculateCloudColor(cameraPosition, normalize(-worldRay), cloudData), cloudData.a);
intersectionPoint = intersectWithCloudLayer(normalize(worldRay), cameraPosition, anchorPositionCrossFade);
worldRayRotated = rotateDirectionToAnchorPoint(rotationMatrixCloudsCrossFade, normalize(intersectionPoint));
worldRayRotatedCorrected = correctForPlanetCurvature(worldRayRotated);
cloudData = getCloudData(worldRayRotatedCorrected, fadeTextureChannels);
vec4 cloudColorCrossFade = vec4(calculateCloudColor(cameraPosition, normalize(-worldRay), cloudData), cloudData.a);
cloudColor = mix(cloudColor, cloudColorCrossFade, crossFadeAnchorFactor);
float totalTransmittance = clamp(cloudColor.a * (1.0 - totalFadeInOut) + totalFadeInOut, 0.0 , 1.0);
if (length(cloudColor.rgb) == 0.0) {
totalTransmittance = 1.0;
}
return vec4(cloudColor.rgb, totalTransmittance);
}`),e.code.add(b`vec4 renderClouds(vec3 worldRay, vec3 cameraPosition)
{
return crossFade ? renderCloudsCrossFade(worldRay, cameraPosition) : renderCloudsNoFade(worldRay, cameraPosition);
}`)}function sm(t){t.code.add(b`vec4 premultiplyAlpha(vec4 v) {
return vec4(v.rgb * v.a, v.a);
}
vec3 rgb2hsv(vec3 c) {
vec4 K = vec4(0.0, -1.0 / 3.0, 2.0 / 3.0, -1.0);
vec4 p = c.g < c.b ? vec4(c.bg, K.wz) : vec4(c.gb, K.xy);
vec4 q = c.r < p.x ? vec4(p.xyw, c.r) : vec4(c.r, p.yzx);
float d = q.x - min(q.w, q.y);
float e = 1.0e-10;
return vec3(abs(q.z + (q.w - q.y) / (6.0 * d + e)), min(d / (q.x + e), 1.0), q.x);
}
vec3 hsv2rgb(vec3 c) {
vec4 K = vec4(1.0, 2.0 / 3.0, 1.0 / 3.0, 3.0);
vec3 p = abs(fract(c.xxx + K.xyz) * 6.0 - K.www);
return c.z * mix(K.xxx, clamp(p - K.xxx, 0.0, 1.0), c.y);
}
float rgb2v(vec3 c) {
return max(c.x, max(c.y, c.z));
}`)}function vJe(){const t=new wr;t.attributes.add(E.POSITION,"vec2"),t.varyings.add("worldRay","vec3");const{vertex:e,fragment:r}=t;return e.uniforms.add(new $i("inverseProjectionMatrix",(i,s)=>s.camera.inverseProjectionMatrix),new $i("inverseViewMatrix",(i,s)=>lE(bJe,s.camera.viewMatrix))),e.code.add(b`void main(void) {
vec3 posViewNear = (inverseProjectionMatrix * vec4(position, -1.0, 1.0)).xyz;
worldRay = (inverseViewMatrix * vec4(posViewNear, 0.0)).xyz;
gl_Position = vec4(position, 1.0, 1.0);
}`),r.include(sm),r.include(Ec),t.include(LX,{pbrMode:st.Disabled,lightingSphericalHarmonicsOrder:2}),t.include(YR),t.include(N5),t.include(KN),t.include(Fwe,{instancedDoublePrecision:!1}),r.uniforms.add(new Ft("cameraPosition",(i,s)=>s.camera.eye)),r.code.add(b`void main() {
vec4 cloudsColor = renderClouds(normalize(worldRay), cameraPosition);
fragColor = vec4((1.0 - totalFadeInOut) * cloudsColor.rgb, cloudsColor.a);
}`),t}const bJe=be(),wJe=Object.freeze(Object.defineProperty({__proto__:null,build:vJe},Symbol.toStringTag,{value:"Module"}));let Uwe=class kwe extends Pr{constructor(e){super(e,new pa,()=>this.destroy())}initializeProgram(e){return new Cr(e.rctx,kwe.shader.get().build(),br)}initializePipeline(){return At({blending:xo(we.ONE,we.ZERO,we.SRC_ALPHA,we.ONE),depthTest:{func:Kr.LEQUAL},colorWrite:Vt})}};Uwe.shader=new Er(wJe,()=>ae(()=>import("./CloudsComposition.glsl-c598c274.js"),[],import.meta.url));let $1=class extends Te{constructor(e){super(e),this._technique=new Uwe(e),this._vao=Rl(e.rctx)}destroy(){this._technique=Ui(this._technique),this._vao=Ue(this._vao)}render(e){const r=e.bindParameters.cloudsFade;if(this._vao==null||r.data==null)return;if(!this._technique.compiled)return void this.requestRender();const i=e.rctx.bindTechnique(this._technique,xJe,e.bindParameters);e.rctx.bindVAO(this._vao),i.assertCompatibleVertexAttributeLocations(this._vao),e.rctx.drawArrays(St.TRIANGLE_STRIP,0,4)}};u([d({constructOnly:!0})],$1.prototype,"rctx",void 0),u([d({constructOnly:!0})],$1.prototype,"viewingMode",void 0),u([d({constructOnly:!0})],$1.prototype,"planetRadius",void 0),u([d({constructOnly:!0})],$1.prototype,"requestRender",void 0),$1=u([R("esri.views.3d.environment.CloudsComposition")],$1);const xJe=new ei;var wl;(function(t){t[t.SIXTEEN=0]="SIXTEEN",t[t.HUNDRED=1]="HUNDRED",t[t.TWOHUNDRED=2]="TWOHUNDRED",t[t.COUNT=3]="COUNT"})(wl||(wl={}));let ZL=class extends pa{constructor(){super(...arguments),this.steps=wl.SIXTEEN,this.writeTextureChannels=lw.RG}};u([B({count:wl.COUNT})],ZL.prototype,"steps",void 0),u([B({constValue:oe("esri-mobile")?1024:2048})],ZL.prototype,"cubeMapSize",void 0),u([B()],ZL.prototype,"writeTextureChannels",void 0);let qA=class{constructor(e,r,i,s,n,o,a,l,c=.5){this.coverage=e,this.density=r,this.absorption=i,this.cloudSize=s,this.detailSize=n,this.smoothness=o,this.cloudHeight=a,this.raymarchingSteps=l,this.median=c}};const _ie=new qA([0,.6],[.03,.03],[0,0],[.9,.9],[.8,.8],[.7,.7],[.05,.05],wl.SIXTEEN),Ko={sunny:_ie,cloudy:new qA([.3,.65],[.2,.4],[0,0],[.85,.85],[.75,.75],[.3,.4],[1,1],wl.TWOHUNDRED,.6),rainy:new qA([.6,.8],[.5,.8],[.1,.5],[.9,.9],[.75,.75],[.5,.5],[1,1],wl.TWOHUNDRED,.4),snowy:new qA([.25,.75],[.3,.3],[0,0],[.95,.95],[.7,.7],[.69,.75],[.3,1],wl.HUNDRED,.65),foggy:new qA([.8,.8],[.5,.5],[0,0],[.95,.95],[.9,.9],[.55,.55],[.3,.3],wl.SIXTEEN),default:_ie},rh=oe("esri-mobile")?64:128,TJe=rh/128,Ad=Math.ceil(Math.sqrt(rh)),y_=(rh+2)*Ad,SJe=1e5,a8=128,EJe=y_/1560;function Uh(t,e=!0){t.attributes.add(E.POSITION,"vec2"),e&&t.varyings.add("uv","vec2"),t.vertex.code.add(b`
    void main(void) {
      gl_Position = vec4(position, 0.0, 1.0);
      ${e?b`uv = position * 0.5 + vec2(0.5);`:""}
    }
  `)}let qO=class extends as{constructor(e,r){super(e,"mat3",Qr.Draw,(i,s,n)=>i.setUniformMatrix3fv(e,r(s,n)))}},Vwe=class extends ei{constructor(){super(...arguments),this.cloudRadius=0,this.cloudSize=0,this.detailSize=0,this.absorption=0,this.density=0,this.smoothness=0,this.cloudHeight=0,this.coverage=0,this.raymarchingSteps=Ko.default.raymarchingSteps,this.weatherTile=Ve()}},zwe=class extends ei{constructor(){super(...arguments),this.viewMatrix=Li()}};function CJe(t){const e=new wr;e.include(Uh,!1);const r=e.fragment;return r.uniforms.add(new Re("cloudRadius",i=>i.cloudRadius),new Re("power",i=>wt(35,120,i.absorption)),new Re("sigmaE",i=>1+i.absorption),new Re("density",i=>wt(0,.3,i.density)),new Re("cloudSize",i=>wt(0,.02,Math.max(.01,1-i.cloudSize))),new Re("detailSize",i=>wt(0,.2,Math.max(.01,1-i.detailSize))),new Re("smoothness",i=>wt(0,.5,1-i.smoothness)),new Re("cloudHeight",i=>wt(0,1500,i.cloudHeight)),new Re("coverage",i=>i.coverage),new qO("view",i=>i.viewMatrix),new Je("cloudShapeTexture",i=>i.noiseTexture!=null?i.noiseTexture.textureAtlas:null),new Sr("cloudVariables",i=>or(AJe,i.coverage,i.absorption))),r.constants.add("halfCubeMapSize","float",.5*t.cubeMapSize),r.code.add(b`
    const int STEPS = ${t.steps===wl.SIXTEEN?b`16`:t.steps===wl.HUNDRED?b`100`:b`200`};
    const int STEPS_LIGHT = 6;
    const float stepL = 300.0 / float(STEPS_LIGHT);
    const float cloudStart = 1500.0;

    vec3 rayDirection(vec2 fragCoord) {
      vec2 xy = fragCoord - halfCubeMapSize;
      return normalize(vec3(-xy, -halfCubeMapSize));
    }

    float remap(float x, float low1, float high1, float low2, float high2) {
      return low2 + (x - low1) * (high2 - low2) / (high1 - low1);
    }

    float saturate(float x) {
      return clamp(x, 0.0, 1.0);
    }`),r.code.add(b`
    float getCloudShape(vec3 pos, float pOffset) {
      const float textureWidth = ${b.float(y_)};
      const float dataWidth = ${b.float(y_)};
      const float tileRows = ${b.float(Ad)};
      const vec3 atlasDimensions = vec3(${b.float(rh)}, ${b.float(rh)}, tileRows * tileRows);

      //Change from Y being height to Z being height
      vec3 p = float(${b.float(TJe)}) * pos.xzy;

      //Pixel coordinates of point in the 3D data
      vec3 coord = vec3(mod(p - pOffset * atlasDimensions, atlasDimensions));
      float f = fract(coord.z);
      float level = floor(coord.z);
      float tileY = floor(level / tileRows);
      float tileX = level - tileY * tileRows;

      //The data coordinates are offset by the x and y tile, the two boundary cells between each tile pair and the initial boundary cell on the first row/column
      vec2 offset = atlasDimensions.x * vec2(tileX, tileY) + 2.0 * vec2(tileX, tileY) + 1.0;
      vec2 pixel = coord.xy + offset;
      vec2 data = texture(cloudShapeTexture, mod(pixel, dataWidth) / textureWidth).xy;

      return 1.0 - mix(data.x, data.y, f);
    }

    float getCloudMap(vec2 p){
      // Shift the texture center to origin to avoid seam artifacts
      vec2 uv = (${b.float(EJe)} * p) / ${b.float(y_)} + 0.5;

      return texture(cloudShapeTexture, uv).a;
    }
    `),r.code.add(b`float clouds(vec3 p) {
float cloud = saturate(0.5 * mix(0.0, 1.0, min(2.0 * coverage, 1.0)));
if (cloud <= 0.0) {
return 0.0;
}
float cloudMap = getCloudMap(cloudSize * p.xy);
cloud = mix(cloud, min(2.0 * (coverage), 1.0) * cloudMap, min(2.0 * (1.0 - coverage), 1.0));
if (cloud <= 0.0) {
return 0.0;
}
float shape = getCloudShape(8.0 * cloudSize * p, 0.0);
cloud = saturate(remap(cloud, smoothness * shape, 1.0, 0.0, 1.0));
if (cloud <= 0.0) {
return 0.0;
}
float heightFraction = saturate((length(p) - cloudRadius - cloudStart) / cloudHeight);
cloud *= saturate(remap(heightFraction, 0.0, 0.25, 0.0, 1.0)) * smoothstep(1.0, 0.25, heightFraction);
if (cloud <= 0.0) {
return 0.0;
}
return density * saturate(remap(cloud, 0.35 * smoothness * getCloudShape(detailSize * p, 0.0), 1.0, 0.0, 1.0));
}`),r.code.add(b`vec2 sphereIntersections(vec3 start, vec3 dir, float radius) {
float a = dot(dir, dir);
float b = 2.0 * dot(dir, start);
float c = dot(start, start) - (radius * radius);
float d = (b * b) - 4.0 * a * c;
if (d < 0.0) {
return vec2(1e5, -1e5);
}
return vec2((-b - sqrt(d)) / (2.0 * a), (-b + sqrt(d)) / (2.0 * a));
}
float HenyeyGreenstein(float g, float costh) {
return (1.0 / (4.0 * 3.1415))  * ((1.0 - g * g) / pow(1.0 + g * g - 2.0 * g * costh, 1.5));
}`),r.code.add(`
    float multipleOctaves(float extinction, float mu, float stepL) {
      float attenuation = 1.0;
      float contribution = 1.0;
      float phaseAttenuation = 1.0;
      float luminance = 0.0;

      for (int i = 0; i < 4; i++) {
        float phase = mix(HenyeyGreenstein(0.0, mu), HenyeyGreenstein(0.3 * phaseAttenuation, mu), 0.7);
        luminance += contribution * phase * exp(-stepL * extinction * sigmaE * attenuation);
        attenuation *= 0.2;
        contribution *= 0.6;
        phaseAttenuation *= 0.5;
      }

      return luminance;
    }`),r.code.add(b`float lightRay(vec3 org, vec3 p, float phaseFunction, float mu, vec3 sunDirection) {
float lightRayDensity = clouds(p);
lightRayDensity += clouds(p + sunDirection * 1.0 * stepL);
lightRayDensity += clouds(p + sunDirection * 2.0 * stepL);
lightRayDensity += clouds(p + sunDirection * 3.0 * stepL);
lightRayDensity += clouds(p + sunDirection * 4.0 * stepL);
lightRayDensity += clouds(p + sunDirection * 5.0 * stepL);
float beersLaw = multipleOctaves(lightRayDensity, mu, stepL);
return mix(beersLaw * 2.0 * (1.0 - (exp(-stepL * lightRayDensity * 2.0 * sigmaE ))), beersLaw, 0.5 + 0.5 * mu);
}`),r.code.add(b`float mainRay(vec3 org, vec3 dir, vec3 sunDirection, float distToStart, float totalDistance, out float totalTransmittance) {
if (dir.z < 0.0) {
return 0.0;
}
totalTransmittance = 1.0;
float stepS = totalDistance / float(STEPS);
float cameraHeight = length(org);
float mu = 0.5 + 0.5 * dot(sunDirection, dir);
float phaseFunction = mix(HenyeyGreenstein(-0.3, mu), HenyeyGreenstein(0.3, mu), 0.7);
vec3 p = org + distToStart  * dir;
float dist = distToStart;
float shading = 0.0;
for (int i = 0; i < STEPS; i++) {
float sampleDensity = clouds(p);
float sampleSigmaE = sampleDensity * sigmaE;
if (sampleDensity > 0.0 ) {
float ambient = mix((1.2), (1.6), saturate((length(p) - cloudRadius - cloudStart) / cloudHeight));
float luminance = sampleDensity * (ambient + power * phaseFunction * lightRay(org, p, phaseFunction, mu, sunDirection));
float transmittance = exp(-sampleSigmaE * stepS);
shading += totalTransmittance * (luminance - luminance * transmittance) / sampleSigmaE;
totalTransmittance *= transmittance;
if (totalTransmittance <= 0.001) {
totalTransmittance = 0.0;
break;
}
}
dist += stepS;
p = org + dir * dist;
}
return shading;
}`),r.code.add(b`void main() {
if (coverage ==  0.0) {
fragColor = vec4(0.0, 1.0, 0.0, 1.0);
return;
}
vec3 rayDir = rayDirection(gl_FragCoord.xy);
rayDir = normalize(view * rayDir);
vec3 viewPos = vec3(0, 0, cloudRadius + 1.0);
bool hitsPlanet = rayDir.z < 0.0;
float hazeFactor = smoothstep(-0.01, mix(0.0, 0.075, cloudVariables.x), abs(dot(rayDir, vec3(0, 0, 1))));
float totalTransmittance = 1.0;
float shading = 0.0;
if (hitsPlanet) {
shading = clamp(1.0 - cloudVariables.y, 0.6, 1.0) * (1.0 - hazeFactor);
totalTransmittance = hazeFactor;
fragColor = vec4(shading, totalTransmittance, shading, totalTransmittance);
return;
}
vec2 rayStartIntersect = sphereIntersections(viewPos, rayDir, cloudRadius + cloudStart);
vec2 rayEndIntersect = sphereIntersections(viewPos, rayDir, cloudRadius + cloudStart + cloudHeight);
float distToStart = rayStartIntersect.y;
float totalDistance = rayEndIntersect.y - distToStart;
vec3 sunDirection = normalize(vec3(0, 0, 1));
shading = 0.5 * mainRay(viewPos, rayDir, sunDirection, distToStart, totalDistance, totalTransmittance);
shading = mix(clamp(1.0 - cloudVariables.y, 0.6, 1.0), shading, hazeFactor);
totalTransmittance = mix(0.0, totalTransmittance, hazeFactor);
fragColor = vec4(shading, totalTransmittance, shading, totalTransmittance);
}`),e}const AJe=Ve(),OJe=Object.freeze(Object.defineProperty({__proto__:null,CloudsDrawParameters:zwe,CloudsPassParameters:Vwe,build:CJe},Symbol.toStringTag,{value:"Module"}));let Bwe=class Gwe extends Pr{constructor(e,r){super(e,r,()=>this.destroy())}initializeProgram(e){return new Cr(e.rctx,Gwe.shader.get().build(this.configuration),br)}initializePipeline(){return At({blending:Tc(we.CONSTANT_COLOR,we.ONE_MINUS_CONSTANT_COLOR,jf.ADD,this.configuration.writeTextureChannels===lw.RG?[1,1,0,0]:[0,0,1,1]),depthTest:{func:Kr.LEQUAL},colorWrite:Vt})}};Bwe.shader=new Er(OJe,()=>ae(()=>import("./Clouds.glsl-b15b0be4.js"),[],import.meta.url));var iu;(function(t){t[t.Full=0]="Full",t[t.WeatherMap=1]="WeatherMap",t[t.COUNT=2]="COUNT"})(iu||(iu={}));let zG=class extends pa{constructor(){super(...arguments),this.mode=iu.Full}};u([B({count:iu.COUNT})],zG.prototype,"mode",void 0);let jwe=class extends ei{constructor(){super(...arguments),this.weatherTile=dr(0,0)}};function RJe(t){const e=new wr;return e.include(Uh,!1),e.fragment.code.add(b`float remap(float x, float low1, float high1, float low2, float high2) {
return low2 + (x - low1) * (high2 - low2) / (high1 - low1);
}`),t.mode===iu.Full&&e.fragment.code.add(b`
    float saturate(float x) {
      return clamp(x, 0.0, 1.0);
    }

    // Safer modulo for positive and negative values
    vec3 modulo(vec3 m, float n){
      return mod(mod(m, n) + n, n);
    }

    vec3 hash(vec3 p3, float frequency){
      p3 = modulo(p3, frequency);
      p3 = fract(p3 * vec3(0.1031, 0.1030, 0.0973));
      p3 += dot(p3, p3.yxz + 33.33);
      return -1.0 + 2.0 * fract((p3.xxy + p3.yxx) * p3.zyx);
    }

    // 5th order polynomial interpolation
    vec3 fade(vec3 t){
      return (t * t * t) * (t * (t * 6.0 - 15.0) + 10.0);
    }

    float gradientNoise(vec3 p, float frequency){
      // Cell point is in
      vec3 i = floor(p);

      // Position in the cell in [0, 1]
      vec3 f = fract(p);

      // Interpolation value for gradient mixing
      vec3 u = fade(f);

      // Trilinear interpolation of gradients at cube vertices around point
      return mix( mix( mix( dot( hash( i + vec3(0.0,0.0,0.0), frequency), f - vec3(0.0,0.0,0.0) ),
                            dot( hash( i + vec3(1.0,0.0,0.0), frequency), f - vec3(1.0,0.0,0.0) ), u.x),
                       mix( dot( hash( i + vec3(0.0,1.0,0.0), frequency), f - vec3(0.0,1.0,0.0) ),
                            dot( hash( i + vec3(1.0,1.0,0.0), frequency), f - vec3(1.0,1.0,0.0) ), u.x), u.y),
                  mix( mix( dot( hash( i + vec3(0.0,0.0,1.0), frequency), f - vec3(0.0,0.0,1.0) ),
                            dot( hash( i + vec3(1.0,0.0,1.0), frequency), f - vec3(1.0,0.0,1.0) ), u.x),
                       mix( dot( hash( i + vec3(0.0,1.0,1.0), frequency), f - vec3(0.0,1.0,1.0) ),
                            dot( hash( i + vec3(1.0,1.0,1.0), frequency), f - vec3(1.0,1.0,1.0) ), u.x), u.y), u.z );
    }

    float getPerlinNoise(vec3 pos, float frequency) {
      float octaveFrequencyFactor = 2.0;
      float sum = 0.0;
      float weightSum = 0.0;
      float weight = 1.0;

      for (int oct = 0; oct < 3; oct++) {
        vec3 p = pos * frequency;
        float val = 0.5 + 0.5 * gradientNoise(p, frequency);
        sum += val * weight;
        weightSum += weight;
        weight *= 0.5;
        frequency *= octaveFrequencyFactor;
      }

      float noise = (sum / weightSum);
      noise = saturate(noise);
      return noise;
    }

    float worley(vec3 pos, float numCells) {
      vec3 p = pos * numCells;
      float d = 1.0e10;

      for (int x = -1; x <= 1; x++) {
        for (int y = -1; y <= 1; y++) {
          for (int z = -1; z <= 1; z++) {
            vec3 tp = floor(p) + vec3(x, y, z);
            tp = p - tp - (hash(tp, numCells) * 0.5 + 0.5);
            d = min(d, dot(tp, tp));
          }
        }
      }

      return 1.0 - clamp(d, 0.0, 1.0);
    }

    vec3 get3Dfrom2D(vec2 uv) {
      vec2 tile = floor(uv);
      float z = floor(${b.float(Ad)} * tile.y + tile.x);
      return vec3(fract(uv), z);
    }

    float getTextureForPointPerlinWorley(vec3 p) {
      float perlinNoise = getPerlinNoise(p, ${b.float(8)});

      float worley0 = worley(p, ${b.float(2)} * 2.0);
      float worley1 = worley(p, ${b.float(2)} * 8.0);
      float worley2 = worley(p, ${b.float(2)} * 14.0);

      float worleyFBM = worley0 * 0.625 + worley1 * 0.25 + worley2 * 0.125;
      return remap(perlinNoise, 0.0, 1.0, worleyFBM, 1.0);
    }

    float getTextureForPointWorley(vec3 p) {
      float worley0 = worley(p, ${b.float(2)});
      float worley1 = worley(p, ${b.float(2)} * 2.0);
      float worley2 = worley(p, ${b.float(2)} * 4.0);
      float worley3 = worley(p, ${b.float(2)} * 8.0);

      float FBM0 = worley0 * 0.625 + worley1 * 0.25 + worley2 * 0.125;
      float FBM1 = worley1 * 0.625 + worley2 * 0.25 + worley3 * 0.125;
      float FBM2 = worley2 * 0.75 + worley3 * 0.25;

      return FBM0 * 0.625 + FBM1 * 0.25 + FBM2 * 0.125;
    }
  `),e.fragment.uniforms.add(new Sr("weatherTile",r=>r.weatherTile)),e.fragment.code.add(b`
    vec2 modulo(vec2 m, float n){
      return mod(mod(m, n) + n, n);
    }

    vec2 hash(vec2 p){
      // Get position of p in weather tile
      p = modulo(p, ${b.float(a8)});

      // Get global coordinates of p
      p += weatherTile * ${b.float(a8)};

      // Limit position to avoid numerical instability
      p = modulo(p, ${b.float(SJe)});

      vec3 p3 = fract(vec3(p.xyx) * vec3(0.1031, 0.1030, 0.0973));
      p3 += dot(p3, p3.yzx + 33.33);
      return 2.0 * fract((p3.xx + p3.yz) * p3.zy) - 1.0;
    }

    vec2 fade(vec2 t){
      return (t * t * t) * (t * (t * 6.0 - 15.0) + 10.0);
    }

    float gradientNoise(vec2 p){
      vec2 i = floor( p );
      vec2 f = fract( p );

      vec2 u = fade(f);

      // Bilinear interpolation of gradients at cell vertices around point
      return  mix(
                mix(dot( hash( i + vec2(0.0,0.0) ), f - vec2(0.0,0.0) ),
                    dot( hash( i + vec2(1.0,0.0) ), f - vec2(1.0,0.0) ), u.x),
                mix(dot( hash( i + vec2(0.0,1.0) ), f - vec2(0.0,1.0) ),
                    dot( hash( i + vec2(1.0,1.0) ), f - vec2(1.0,1.0) ), u.x),
                u.y);
    }

    float worley(vec2 p){
      float d = 1.0e10;
      for (int x = -1; x <= 1; x++){
        for (int y = -1; y <= 1; y++){
                vec2 tp = floor(p) + vec2(x, y);
                tp = p - tp - (0.5 + 0.5 * hash(tp));
                d = min(d, dot(tp, tp));
            }
        }
      return 1.0 - clamp(d, 0.0, 1.0);
    }
  `),e.fragment.code.add(b`void main() {`),t.mode===iu.Full&&e.fragment.code.add(b`
        float padWidth = 1.0;
        float paddedSize = ${b.float(rh)} + 2.0 * padWidth;
        float tileCount = ${b.float(Ad)} * ${b.float(Ad)};
        vec2 tile = floor((gl_FragCoord.xy - 0.5) / paddedSize);

        bool padCell = false;
        if (mod(gl_FragCoord.x, paddedSize) == 0.5 || mod(gl_FragCoord.x, paddedSize) == paddedSize - 0.5) {
          padCell = true;
        }

        if (mod(gl_FragCoord.y, paddedSize) == 0.5 || mod(gl_FragCoord.y, paddedSize) == paddedSize - 0.5) {
          padCell = true;
        }

        bool startPadX = false;
        bool startPadY = false;
        bool endPadX = false;
        bool endPadY = false;

        if (gl_FragCoord.x == tile.x * paddedSize + 0.5) {
          startPadX = true;
        }

        if (gl_FragCoord.y == tile.y * paddedSize + 0.5) {
          startPadY = true;
        }

        if (gl_FragCoord.x == (tile.x + 1.0) * paddedSize - 0.5) {
          endPadX = true;
        }

        if (gl_FragCoord.y == (tile.y + 1.0) * paddedSize - 0.5) {
          endPadY = true;
        }

        vec2 padding = vec2(2.0 * padWidth) * tile;
        vec2 uv;

        if (padCell) {
          vec2 pixel = gl_FragCoord.xy - padWidth - padding;

          if (startPadX) {
            pixel.x += ${b.float(rh)};
          }

          if (startPadY) {
            pixel.y += ${b.float(rh)};
          }

          if (endPadX) {
            pixel.x -= ${b.float(rh)};
          }

          if (endPadY) {
            pixel.y -= ${b.float(rh)};
          }

          uv = vec2(pixel.xy / ${b.float(rh)});
        } else {
          vec2 pixel = gl_FragCoord.xy - padWidth - padding;
          uv = vec2(pixel.xy / ${b.float(rh)});
        }

        vec3 p_ = get3Dfrom2D(uv);
        vec3 p = p_;
        p.z /= (${b.float(Ad)} * ${b.float(Ad)});

        float worleyPerlinNoise = getTextureForPointPerlinWorley(p);
        float worleyNoise = getTextureForPointWorley(p);

        fragColor.r = saturate(remap(worleyPerlinNoise, worleyNoise, 1.0, 0.0, 1.0));

        p_ = mod(p_ + 1.0, ${b.float(Ad)} * ${b.float(Ad)});
        p = p_;
        p.z /= (${b.float(Ad)} * ${b.float(Ad)});

        worleyPerlinNoise = getTextureForPointPerlinWorley(p);
        worleyNoise = getTextureForPointWorley(p);

        fragColor.g = saturate(remap(worleyPerlinNoise, worleyNoise, 1.0, 0.0, 1.0));
      `),e.fragment.code.add(b`
      vec2 mapUV = ${b.float(a8)} * (gl_FragCoord.xy / ${b.float(y_)});
      float map = abs(gradientNoise(mapUV));
      map = remap(map, 0.25 * (1.0 - worley(8.0 * mapUV)), 1.0, 0.0, 1.0);

      ${t.mode===iu.Full?b`fragColor.ba = vec2(0.0, map);`:b`fragColor = vec4(map);`};
    }
  `),e}const PJe=Object.freeze(Object.defineProperty({__proto__:null,NoiseTextureAtlasPassParameters:jwe,build:RJe},Symbol.toStringTag,{value:"Module"}));let BG=class Hwe extends Pr{initializeProgram(e){return new Cr(e.rctx,Hwe.shader.get().build(this.configuration),br)}initializePipeline(){return At({blending:this.configuration.mode===iu.Full?Tc(we.ONE,we.ZERO):xo(we.ZERO,we.ONE,we.ONE,we.ZERO),depthTest:{func:Kr.ALWAYS},colorWrite:Vt})}};BG.shader=new Er(PJe,()=>ae(()=>import("./NoiseTextureAtlas.glsl-21a7a3e2.js"),[],import.meta.url));let r4=class{constructor(e,r,i=r){this.internalFormat=e,this.width=r,this.height=i,this.multisampled=!1,this.samples=1}};function MJe(t){return t.width<=0||t.height<=0||t.internalFormat==null?0:t.width*t.height*PX(t.internalFormat)}let IJe=class{constructor(e,r){this._context=e,this._descriptor=r,this.type=D_.RenderBuffer,this._context.instanceCounter.increment(An.Renderbuffer,this);const i=this._context.gl;this.glName=i.createRenderbuffer(),this._context.bindRenderbuffer(this);const{width:s,height:n,internalFormat:o,multisampled:a}=r;if(a){if(this._context.type!==lr.WEBGL2)throw new Error("Multisampled renderbuffers are not supported in WebGL1!");i.renderbufferStorageMultisample(i.RENDERBUFFER,this.samples,o,s,n)}else i.renderbufferStorage(i.RENDERBUFFER,o,s,n)}get descriptor(){return this._descriptor}get samples(){const e=this._descriptor.samples,r=this._context.parameters.maxSamples;return e?Math.min(e,r):r}get gpuMemoryUsage(){return MJe(this._descriptor)}resize(e,r){const i=this._descriptor;if(i.width===e&&i.height===r)return;i.width=e,i.height=r;const s=this._context.gl;this._context.bindRenderbuffer(this),i.multisampled?s.renderbufferStorageMultisample(s.RENDERBUFFER,this.samples,i.internalFormat,i.width,i.height):s.renderbufferStorage(s.RENDERBUFFER,i.internalFormat,i.width,i.height)}dispose(){this._context&&(this._context.gl.deleteRenderbuffer(this.glName),this._context.instanceCounter.decrement(An.Renderbuffer,this),this._context=X2(this._context))}};const $Je=Q.getLogger("esri.views.webgl.FramebufferObject");let hn=class UT{constructor(e,r,i=null){this._context=e,this._glName=null,this._colorAttachments=new Map,this._depthBuffer=null,this._stencilBuffer=null,this._depthStencilTexture=null,this._initialized=!1,e.instanceCounter.increment(An.FramebufferObject,this);const s=XL(r)?r:new Et(this._context,r);if(this._colorAttachments.set(qc.COLOR_ATTACHMENT0,s),this._validateTextureDescriptor(s.descriptor),this._validateColorAttachmentPoint(qc.COLOR_ATTACHMENT0),i!=null)if(DJe(i))this._context.capabilities.depthTexture||console.error("Setting the depth/stencil texture as an attachment requires WEBGL_depth_texture or WebGL2"),this._depthStencilTexture=XL(i)?i:new Et(this._context,i),this._validateTextureDescriptor(this._depthStencilTexture.descriptor);else{const n=LJe(i)?i:new IJe(this._context,i),o=n.descriptor;o.internalFormat===js.STENCIL_INDEX8?this._stencilBuffer=n:this._depthBuffer=n,this._validateRenderBufferDescriptor(o)}}dispose(){if(this._colorAttachments.size===0&&!this._glName)return;const e=this._context.getBoundFramebufferObject();this._colorAttachments.forEach((r,i)=>this.detachColorTexture(i)?.dispose()),this.detachDepthStencilBuffer()?.dispose(),this.detachDepthStencilTexture()?.dispose(),this._glName&&(this._context.gl.deleteFramebuffer(this._glName),this._glName=null),this._context.bindFramebuffer(e),this._context.instanceCounter.decrement(An.FramebufferObject,this)}get glName(){return this._glName}get colorTexture(){return this._colorAttachments.get(qc.COLOR_ATTACHMENT0)}get depthStencilAttachment(){return this._depthStencilTexture||this._depthBuffer||this._stencilBuffer}get depthStencilTexture(){return this._depthStencilTexture}get width(){return this._colorAttachments.get(qc.COLOR_ATTACHMENT0)?.descriptor?.width??0}get height(){return this._colorAttachments.get(qc.COLOR_ATTACHMENT0)?.descriptor?.height??0}get gpuMemoryUsage(){return[...this._colorAttachments].reduce((e,[r,i])=>e+i.gpuMemoryUsage,this.depthStencilAttachment?.gpuMemoryUsage??0)}getColorTexture(e){const r=this._colorAttachments.get(e);return r&&XL(r)?r:null}attachColorTexture(e,r=qc.COLOR_ATTACHMENT0){if(!e)return;this._validateColorAttachmentPoint(r);const i=e.descriptor;this._validateTextureDescriptor(i),this.detachColorTexture(r)?.dispose(),this._initialized&&(this._context.bindFramebuffer(this),this._framebufferTexture2D(e.glName,r)),this._colorAttachments.set(r,e)}detachColorTexture(e=qc.COLOR_ATTACHMENT0){const r=this._colorAttachments.get(e);if(r)return this._initialized&&(this._context.bindFramebuffer(this),this._framebufferTexture2D(null,e)),this._colorAttachments.delete(e),r}setColorTextureTarget(e,r=qc.COLOR_ATTACHMENT0){const i=this._colorAttachments.get(r);i&&this._framebufferTexture2D(i.glName,r,e)}attachDepthStencil(e){if(e)switch(e.type){case D_.Texture:return this._attachDepthStencilTexture(e);case D_.RenderBuffer:return this._attachDepthStencilBuffer(e)}}_attachDepthStencilTexture(e){if(e==null)return;const r=e.descriptor;r.pixelFormat!==Tt.DEPTH_STENCIL&&r.pixelFormat!==Tt.DEPTH24_STENCIL8&&console.error("Depth/Stencil texture must have a pixel type of DEPTH_STENCIL!"),r.dataType!==ks.UNSIGNED_INT_24_8&&console.error("Depth/Stencil texture must have data type of UNSIGNED_INT_24_8!"),this._context.capabilities.depthTexture||console.error("Extension WEBGL_depth_texture isn't supported therefore it is no possible to set the depth/stencil texture!"),this._validateTextureDescriptor(r),this._disposeDepthStencilAttachments(),this._initialized&&(this._context.bindFramebuffer(this),this._framebufferTexture2D(e.glName,nie)),this._depthStencilTexture?.dispose(),this._depthStencilTexture=e}detachDepthStencilTexture(){const e=this._depthStencilTexture;return e&&this._initialized&&(this._context.bindFramebuffer(this),this._framebufferTexture2D(null,nie)),this._depthStencilTexture=null,e}_attachDepthStencilBuffer(e){if(e==null)return;const r=e.descriptor;if(r.internalFormat!==js.DEPTH_STENCIL&&r.internalFormat!==js.DEPTH_COMPONENT16&&console.error("Depth/Stencil buffer must have correct internalFormat"),this._validateRenderBufferDescriptor(r),this._disposeDepthStencilAttachments(),this._initialized){this._context.bindFramebuffer(this);const i=this._context.gl,s=this._getGLAttachmentPoint(r);i.framebufferRenderbuffer(po.FRAMEBUFFER,s,i.RENDERBUFFER,e.glName)}this._depthBuffer?.dispose(),this._depthBuffer=e}detachDepthStencilBuffer(){const e=this._depthBuffer;if(e&&this._initialized){this._context.bindFramebuffer(this);const r=this._context.gl,i=this._getGLAttachmentPoint(e.descriptor);r.framebufferRenderbuffer(po.FRAMEBUFFER,i,r.RENDERBUFFER,null),e.dispose()}return this._depthBuffer=null,e}copyToTexture(e,r,i,s,n,o,a){(e<0||r<0||n<0||o<0)&&console.error("Offsets cannot be negative!"),(i<=0||s<=0)&&console.error("Copy width and height must be greater than zero!");const l=a.descriptor;a.descriptor.target!==is.TEXTURE_2D&&console.error("Texture target must be TEXTURE_2D!"),(l?.width==null||l?.height==null||e+i>this.width||r+s>this.height||n+i>l.width||o+s>l.height)&&console.error("Bad dimensions, the current input values will attempt to read or copy out of bounds!");const c=this._context,h=c.bindTexture(a,Et.TEXTURE_UNIT_FOR_UPDATES);c.setActiveTexture(Et.TEXTURE_UNIT_FOR_UPDATES),c.bindFramebuffer(this),c.gl.copyTexSubImage2D(is.TEXTURE_2D,0,n,o,e,r,i,s),c.bindTexture(h,Et.TEXTURE_UNIT_FOR_UPDATES)}readPixels(e,r,i,s,n,o,a){(i<=0||s<=0)&&console.error("Copy width and height must be greater than zero!"),a||console.error("Target memory is not initialized!"),this._context.bindFramebuffer(this),this._context.gl.readPixels(e,r,i,s,n,o,a)}async readPixelsAsync(e,r,i,s,n,o,a){if(this._context.type!==lr.WEBGL2)return Qu()&&console.warn("Attempting to read pixels using pixel buffer object without WebGL2"),void this.readPixels(e,r,i,s,n,o,a);const l=this._context.gl,c=Lr.createPixelPack(this._context,Tr.STREAM_READ,a.byteLength);this._context.bindBuffer(c),this._context.bindFramebuffer(this),l.readPixels(e,r,i,s,n,o,0),this._context.unbindBuffer(bt.PIXEL_PACK_BUFFER),await c.getSubDataAsync(a),c.dispose()}resize(e,r){if(this.width===e&&this.height===r)return;const i={width:e,height:r};_b(i,this._context.parameters.maxTextureSize),this._colorAttachments.forEach(s=>s.resize(i.width,i.height)),this._depthStencilTexture?.resize(i.width,i.height),this._initialized&&(_b(i,this._context.parameters.maxRenderbufferSize),this._depthBuffer?.resize(i.width,i.height),this._stencilBuffer?.resize(i.width,i.height),this._context.getBoundFramebufferObject()===this&&this._context.bindFramebuffer(null),this._initialized=!1)}initializeAndBind(e=po.FRAMEBUFFER){const r=this._context.gl;if(this._initialized)return void r.bindFramebuffer(e,this.glName);this._glName&&r.deleteFramebuffer(this._glName);const i=r.createFramebuffer();r.bindFramebuffer(e,i),this._colorAttachments.forEach((n,o)=>this._framebufferTexture2D(n.glName,o,vie(n),e));const s=this._depthBuffer||this._stencilBuffer;if(s){const n=this._getGLAttachmentPoint(s.descriptor);r.framebufferRenderbuffer(e,n,r.RENDERBUFFER,s.glName)}else this._depthStencilTexture&&this._framebufferTexture2D(this._depthStencilTexture.glName,r.DEPTH_STENCIL_ATTACHMENT,vie(this._depthStencilTexture),e);Qu()&&r.checkFramebufferStatus(e)!==r.FRAMEBUFFER_COMPLETE&&console.error("Framebuffer is incomplete!"),this._glName=i,this._initialized=!0}_framebufferTexture2D(e,r=qc.COLOR_ATTACHMENT0,i=is.TEXTURE_2D,s=po.FRAMEBUFFER,n=0){this._context.gl.framebufferTexture2D(s,r,i,e,n)}_disposeDepthStencilAttachments(){const e=this._context.gl;if(this._depthBuffer){if(this._initialized){this._context.bindFramebuffer(this);const r=this._getGLAttachmentPoint(this._depthBuffer.descriptor);e.framebufferRenderbuffer(po.FRAMEBUFFER,r,e.RENDERBUFFER,null)}this._depthBuffer=Ue(this._depthBuffer)}this._stencilBuffer&&(this._initialized&&(this._context.bindFramebuffer(this),e.framebufferRenderbuffer(po.FRAMEBUFFER,e.STENCIL_ATTACHMENT,e.RENDERBUFFER,null)),this._stencilBuffer=Ue(this._stencilBuffer)),this._depthStencilTexture&&(this._initialized&&(this._context.bindFramebuffer(this),this._framebufferTexture2D(null,e.DEPTH_STENCIL_ATTACHMENT)),this._depthStencilTexture=Ue(this._depthStencilTexture))}_validateTextureDescriptor(e){e.target!==is.TEXTURE_2D&&e.target!==is.TEXTURE_CUBE_MAP&&console.error("Texture type must be TEXTURE_2D or TEXTURE_CUBE_MAP!"),_b(e,this._context.parameters.maxTextureSize),this._validateBufferDimensions(e)}_validateRenderBufferDescriptor(e){_b(e,this._context.parameters.maxRenderbufferSize),this._validateBufferDimensions(e)}_validateBufferDimensions(e){e.width<=0&&(e.width=this.width),e.height<=0&&(e.height=this.height),this.width>0&&this.height>0&&(this.width===e.width&&this.height===e.height||console.error("Attachment size must match framebuffer size!"))}_getGLAttachmentPoint(e){switch(e.internalFormat){case js.DEPTH_COMPONENT16:case js.DEPTH_COMPONENT24:case js.DEPTH_COMPONENT32F:return this._context.gl.DEPTH_ATTACHMENT;case js.DEPTH24_STENCIL8:case js.DEPTH32F_STENCIL8:case js.DEPTH_STENCIL:return this._context.gl.DEPTH_STENCIL_ATTACHMENT;case js.STENCIL_INDEX8:return this._context.gl.STENCIL_ATTACHMENT}}_validateColorAttachmentPoint(e){if(UT._MAX_COLOR_ATTACHMENTS===-1){const i=this._context.capabilities.drawBuffers;if(i){const s=this._context.gl;UT._MAX_COLOR_ATTACHMENTS=s.getParameter(i.MAX_COLOR_ATTACHMENTS)}else UT._MAX_COLOR_ATTACHMENTS=1}const r=e-qc.COLOR_ATTACHMENT0;r+1>UT._MAX_COLOR_ATTACHMENTS&&Q.getLogger("esri.views.webgl.FrameBufferObject").error("esri.FrameBufferObject",`illegal attachment point for color attachment: ${r+1}. Implementation supports up to ${UT._MAX_COLOR_ATTACHMENTS} color attachments`)}};function XL(t){return t!=null&&"type"in t&&t.type===D_.Texture}function LJe(t){return t!=null&&"type"in t&&t.type===D_.RenderBuffer}function DJe(t){return XL(t)||t!=null&&"pixelFormat"in t}function _b(t,e){const r=Math.max(t.width,t.height);if(r>e){$Je.warn(`Resizing FBO attachment size ${t.width}x${t.height} to device limit ${e}`);const i=e/r;return t.width=Math.round(t.width*i),t.height=Math.round(t.height*i),!1}return!0}function vie(t){return t.descriptor.target===is.TEXTURE_CUBE_MAP?is.TEXTURE_CUBE_MAP_POSITIVE_X:is.TEXTURE_2D}hn._MAX_COLOR_ATTACHMENTS=-1;let WA=class extends Te{constructor(e){super(e),this._needsRender=!0,this._passParameters=new jwe,this._frameBuffer=new hn(e.context.renderContext.rctx,new vr(y_)),this._vao=Rl(e.context.renderContext.rctx)}get _techniqueRepository(){return this.context.techniqueRepository}get textureAtlas(){return this._texture!=null?this._weatherMapTechnique!=null&&this._weatherMapTechnique.compiled&&this._needsRender&&(this._texture=this._render(iu.WeatherMap)):this._fullTechnique!=null&&this._fullTechnique.compiled&&(this._texture=this._render(iu.Full)),this._texture}_setDirty(){this._needsRender=!0}updateWeatherMap(e){this._passParameters.weatherTile[0]===e[0]&&this._passParameters.weatherTile[1]===e[1]||(fn(this._passParameters.weatherTile,e),this._setDirty())}destroy(){this._fullTechniqueCached=Ui(this._fullTechniqueCached),this._weatherMapTechniqueCached=Ui(this._weatherMapTechniqueCached),this._frameBuffer=Ue(this._frameBuffer),this._vao=Ue(this._vao)}get _fullTechnique(){if(this._fullTechniqueCached==null){const e=new zG;e.mode=iu.Full,this._fullTechniqueCached=this._techniqueRepository.acquire(BG,e)}return this._fullTechniqueCached}get _weatherMapTechnique(){if(this._weatherMapTechniqueCached==null){const e=new zG;e.mode=iu.WeatherMap,this._weatherMapTechniqueCached=this._techniqueRepository.acquire(BG,e)}return this._weatherMapTechniqueCached}_render(e){if(this._vao==null||this._frameBuffer==null)return null;const r=e===iu.Full?this._fullTechnique:this._weatherMapTechnique,i=this.context.renderContext.rctx,s=i.getViewport();i.setViewport(0,0,y_,y_),i.bindFramebuffer(this._frameBuffer);const n=i.bindTechnique(r,this._passParameters,null);return i.bindVAO(this._vao),n.assertCompatibleVertexAttributeLocations(this._vao),i.gl.drawArrays(i.gl.TRIANGLE_STRIP,0,4),i.setViewport(s.x,s.y,s.width,s.height),this._needsRender=!1,this._frameBuffer.colorTexture}};u([d({constructOnly:!0})],WA.prototype,"context",void 0),u([d({readOnly:!0})],WA.prototype,"_techniqueRepository",null),WA=u([R("esri.views.3d.environment.NoiseTextureAtlas")],WA);function qwe(t){t.include(_u),t.uniforms.add(new Je("geometryDepthTexture",(e,r)=>r.multipassGeometry.linearDepthTexture),new Sr("nearFar",(e,r)=>r.camera.nearFar)),t.code.add(b`bool geometryDepthTest(vec2 pos, float elementDepth) {
float geometryDepth = linearDepthFromTexture(geometryDepthTexture, pos, nearFar);
return (elementDepth < (geometryDepth - 1.0));
}`)}let NJe=class{constructor(){this.enabled=!1}};function vu(t,e){e.hasMultipassTerrain&&(t.fragment.include(_u),t.fragment.uniforms.add(new Je("terrainDepthTexture",(r,i)=>i.multipassTerrain.linearDepthTexture)),t.fragment.uniforms.add(new Sr("nearFar",(r,i)=>i.camera.nearFar)),t.fragment.uniforms.add(new Sr("inverseViewport",(r,i)=>i.inverseViewport)),t.fragment.code.add(b`
    void terrainDepthTest(vec4 fragCoord, float fragmentDepth){
      float terrainDepth = linearDepthFromTexture(terrainDepthTexture, fragCoord.xy * inverseViewport, nearFar);
      if(fragmentDepth ${e.cullAboveGround?">":"<="} terrainDepth){
        discard;
      }
    }
  `))}let FJe=class{constructor(){this.enabled=!1,this.cullAboveGround=!1}};function UJe(t,e){const r=t.fragment;r.include(_u),r.uniforms.add(new Sr("nearFar",(i,s)=>s.camera.nearFar)),r.uniforms.add(new Je("depthMap",(i,s)=>s.linearDepthTexture)),r.uniforms.add(new $i("proj",(i,s)=>s.ssr.camera.projectionMatrix)),r.uniforms.add(new Re("invResolutionHeight",(i,s)=>1/s.ssr.camera.height)),r.uniforms.add(new $i("reprojectionMatrix",(i,s)=>s.ssr.reprojectionMatrix)),r.code.add(b`
  vec2 reprojectionCoordinate(vec3 projectionCoordinate)
  {
    vec4 zw = proj * vec4(0.0, 0.0, -projectionCoordinate.z, 1.0);
    vec4 reprojectedCoord = reprojectionMatrix * vec4(zw.w * (projectionCoordinate.xy * 2.0 - 1.0), zw.z, zw.w);
    reprojectedCoord.xy /= reprojectedCoord.w;
    return reprojectedCoord.xy * 0.5 + 0.5;
  }

  const int maxSteps = ${e.highStepCount?"150":"75"};

  vec4 applyProjectionMat(mat4 projectionMat, vec3 x)
  {
    vec4 projectedCoord =  projectionMat * vec4(x, 1.0);
    projectedCoord.xy /= projectedCoord.w;
    projectedCoord.xy = projectedCoord.xy*0.5 + 0.5;
    return projectedCoord;
  }

  vec3 screenSpaceIntersection(vec3 dir, vec3 startPosition, vec3 viewDir, vec3 normal)
  {
    vec3 viewPos = startPosition;
    vec3 viewPosEnd = startPosition;

    // Project the start position to the screen
    vec4 projectedCoordStart = applyProjectionMat(proj, viewPos);
    vec3  Q0 = viewPos / projectedCoordStart.w; // homogeneous camera space
    float k0 = 1.0/ projectedCoordStart.w;

    // advance the position in the direction of the reflection
    viewPos += dir;

    vec4 projectedCoordVanishingPoint = applyProjectionMat(proj, dir);

    // Project the advanced position to the screen
    vec4 projectedCoordEnd = applyProjectionMat(proj, viewPos);
    vec3  Q1 = viewPos / projectedCoordEnd.w; // homogeneous camera space
    float k1 = 1.0/ projectedCoordEnd.w;

    // calculate the reflection direction in the screen space
    vec2 projectedCoordDir = (projectedCoordEnd.xy - projectedCoordStart.xy);
    vec2 projectedCoordDistVanishingPoint = (projectedCoordVanishingPoint.xy - projectedCoordStart.xy);

    float yMod = min(abs(projectedCoordDistVanishingPoint.y), 1.0);

    float projectedCoordDirLength = length(projectedCoordDir);
    float maxSt = float(maxSteps);

    // normalize the projection direction depending on maximum steps
    // this determines how blocky the reflection looks
    vec2 dP = yMod * (projectedCoordDir)/(maxSt * projectedCoordDirLength);

    // Normalize the homogeneous camera space coordinates
    vec3  dQ = yMod * (Q1 - Q0)/(maxSt * projectedCoordDirLength);
    float dk = yMod * (k1 - k0)/(maxSt * projectedCoordDirLength);

    // initialize the variables for ray marching
    vec2 P = projectedCoordStart.xy;
    vec3 Q = Q0;
    float k = k0;
    float rayStartZ = -startPosition.z; // estimated ray start depth value
    float rayEndZ = -startPosition.z;   // estimated ray end depth value
    float prevEstimateZ = -startPosition.z;
    float rayDiffZ = 0.0;
    float dDepth;
    float depth;
    float rayDiffZOld = 0.0;

    // early outs
    if (dot(normal, dir) < 0.0 || dot(-viewDir, normal) < 0.0)
      return vec3(P, 0.0);

    for(int i = 0; i < maxSteps-1; i++)
    {
      depth = -linearDepthFromTexture(depthMap, P, nearFar); // get linear depth from the depth buffer

      // estimate depth of the marching ray
      rayStartZ = prevEstimateZ;
      dDepth = -rayStartZ - depth;
      rayEndZ = (dQ.z * 0.5 + Q.z)/ ((dk * 0.5 + k));
      rayDiffZ = rayEndZ- rayStartZ;
      prevEstimateZ = rayEndZ;

      if(-rayEndZ > nearFar[1] || -rayEndZ < nearFar[0] || P.y < 0.0  || P.y > 1.0 )
      {
        return vec3(P, 0.);
      }

      // If we detect a hit - return the intersection point, two conditions:
      //  - dDepth > 0.0 - sampled point depth is in front of estimated depth
      //  - if difference between dDepth and rayDiffZOld is not too large
      //  - if difference between dDepth and 0.025/abs(k) is not too large
      //  - if the sampled depth is not behind far plane or in front of near plane

      if((dDepth) < 0.025/abs(k) + abs(rayDiffZ) && dDepth > 0.0 && depth > nearFar[0] && depth < nearFar[1] && abs(P.y - projectedCoordStart.y) > invResolutionHeight)
      {
        return vec3(P, depth);
      }

      // continue with ray marching
      P += dP;
      Q.z += dQ.z;
      k += dk;
      rayDiffZOld = rayDiffZ;
    }
    return vec3(P, 0.0);
  }
  `)}let kJe=class{constructor(){this.enabled=!1,this.fadeFactor=1,this.reprojectionMatrix=be()}};function U5(t){return t?{ray:Xn(t.ray),c0:t.c0,c1:t.c1}:{ray:Xn(),c0:0,c1:Number.MAX_VALUE}}function VJe(t,e=U5()){return XN(t,e.ray),e.c0=0,e.c1=Number.MAX_VALUE,e}function zJe(t,e,r=U5()){const i=Ce(t.vector);return ibe(t.origin,e,r.ray),r.c0=0,r.c1=i,r}function SPt(t,e){return Wwe(t,t.c0,e)}function EPt(t,e){return Wwe(t,t.c1,e)}function Wwe(t,e,r){return ce(r,t.ray.origin,te(r,t.ray.direction,e))}new Xg(()=>U5());function WO(t){return t?[Ir(t[0]),Ir(t[1]),Ir(t[2]),Ir(t[3]),Ir(t[4]),Ir(t[5])]:[Ir(),Ir(),Ir(),Ir(),Ir(),Ir()]}function Zwe(){return[C(),C(),C(),C(),C(),C(),C(),C()]}function i4(t,e){for(let r=0;r<fE;r++)P5(t[r],e[r])}function Xwe(t,e,r,i=WJe){const s=si(uX.get(),e,t);On(s,s);for(let n=0;n<HJe;++n){const o=su(cX.get(),qJe[n],s);se(i[n],o[0]/o[3],o[1]/o[3],o[2]/o[3])}Ywe(r,i)}function Ywe(t,e){ia(e[Ye.FAR_BOTTOM_LEFT],e[Ye.NEAR_BOTTOM_LEFT],e[Ye.NEAR_TOP_LEFT],t[ui.LEFT]),ia(e[Ye.NEAR_BOTTOM_RIGHT],e[Ye.FAR_BOTTOM_RIGHT],e[Ye.FAR_TOP_RIGHT],t[ui.RIGHT]),ia(e[Ye.FAR_BOTTOM_LEFT],e[Ye.FAR_BOTTOM_RIGHT],e[Ye.NEAR_BOTTOM_RIGHT],t[ui.BOTTOM]),ia(e[Ye.NEAR_TOP_LEFT],e[Ye.NEAR_TOP_RIGHT],e[Ye.FAR_TOP_RIGHT],t[ui.TOP]),ia(e[Ye.NEAR_BOTTOM_LEFT],e[Ye.NEAR_BOTTOM_RIGHT],e[Ye.NEAR_TOP_RIGHT],t[ui.NEAR]),ia(e[Ye.FAR_BOTTOM_RIGHT],e[Ye.FAR_BOTTOM_LEFT],e[Ye.FAR_TOP_LEFT],t[ui.FAR])}function a_(t,e){for(let r=0;r<fE;r++){const i=t[r];if(i[0]*e[0]+i[1]*e[1]+i[2]*e[2]+i[3]>=e[3])return!1}return!0}function BJe(t,e){return Qwe(t,VJe(e,Kwe.get()))}function CPt(t,e){for(let r=0;r<fE;r++){const i=t[r];if(!FWe(i,e))return!1}return!0}function GJe(t,e,r){return Qwe(t,zJe(e,r,Kwe.get()))}function Jwe(t,e){for(let r=0;r<fE;r++)if(hi(t[r],e)>0)return!1;return!0}function Qwe(t,e){for(let r=0;r<fE;r++)if(!NWe(t[r],e))return!1;return!0}var ui,Ye;(function(t){t[t.LEFT=0]="LEFT",t[t.RIGHT=1]="RIGHT",t[t.BOTTOM=2]="BOTTOM",t[t.TOP=3]="TOP",t[t.NEAR=4]="NEAR",t[t.FAR=5]="FAR"})(ui||(ui={})),function(t){t[t.NEAR_BOTTOM_LEFT=0]="NEAR_BOTTOM_LEFT",t[t.NEAR_BOTTOM_RIGHT=1]="NEAR_BOTTOM_RIGHT",t[t.NEAR_TOP_RIGHT=2]="NEAR_TOP_RIGHT",t[t.NEAR_TOP_LEFT=3]="NEAR_TOP_LEFT",t[t.FAR_BOTTOM_LEFT=4]="FAR_BOTTOM_LEFT",t[t.FAR_BOTTOM_RIGHT=5]="FAR_BOTTOM_RIGHT",t[t.FAR_TOP_RIGHT=6]="FAR_TOP_RIGHT",t[t.FAR_TOP_LEFT=7]="FAR_TOP_LEFT"}(Ye||(Ye={}));const jJe={bottom:[Ye.FAR_BOTTOM_RIGHT,Ye.NEAR_BOTTOM_RIGHT,Ye.NEAR_BOTTOM_LEFT,Ye.FAR_BOTTOM_LEFT],near:[Ye.NEAR_BOTTOM_LEFT,Ye.NEAR_BOTTOM_RIGHT,Ye.NEAR_TOP_RIGHT,Ye.NEAR_TOP_LEFT],far:[Ye.FAR_BOTTOM_RIGHT,Ye.FAR_BOTTOM_LEFT,Ye.FAR_TOP_LEFT,Ye.FAR_TOP_RIGHT],right:[Ye.NEAR_BOTTOM_RIGHT,Ye.FAR_BOTTOM_RIGHT,Ye.FAR_TOP_RIGHT,Ye.NEAR_TOP_RIGHT],left:[Ye.FAR_BOTTOM_LEFT,Ye.NEAR_BOTTOM_LEFT,Ye.NEAR_TOP_LEFT,Ye.FAR_TOP_LEFT],top:[Ye.FAR_TOP_LEFT,Ye.NEAR_TOP_LEFT,Ye.NEAR_TOP_RIGHT,Ye.FAR_TOP_RIGHT]},fE=6,HJe=8,qJe=[Lt(-1,-1,-1,1),Lt(1,-1,-1,1),Lt(1,1,-1,1),Lt(-1,1,-1,1),Lt(-1,-1,1,1),Lt(1,-1,1,1),Lt(1,1,1,1),Lt(-1,1,1,1)],Kwe=new Xg(U5),WJe=Zwe();function ZJe(t,e,r){return 2*Math.atan(Math.sqrt(e*e+r*r)*Math.tan(.5*t)/e)}function XJe(t,e,r){return 2*Math.atan(Math.sqrt(e*e+r*r)*Math.tan(.5*t)/r)}function YJe(t,e,r){return 2*Math.atan(e*Math.tan(.5*t)/Math.sqrt(e*e+r*r))}function JJe(t,e,r){return 2*Math.atan(r*Math.tan(.5*t)/Math.sqrt(e*e+r*r))}var GG;let ut=GG=class extends Te{constructor(t={}){super(t),this._center=C(),this._up=C(),this._viewUp=C(),this._viewForward=C(),this._viewRight=C(),this._ray=Xn(),this._viewport=Lt(0,0,1,1),this._padding=Lt(0,0,0,0),this._fov=55/180*Math.PI,this._nearFar=dr(1,1e3),this._viewDirty=!0,this._viewMatrix=be(),this._viewProjectionDirty=!0,this._viewProjectionMatrix=be(),this._viewInverseTransposeMatrixDirty=!0,this._viewInverseTransposeMatrix=be(),this._frustumDirty=!0,this._frustum=WO(),this._fullViewport=Wt(),this._pixelRatio=1,this.relativeElevation=0}get pixelRatio(){return this._pixelRatio}set pixelRatio(t){this._pixelRatio=t>0?t:1}get eye(){return this._ray.origin}set eye(t){this._compareAndSetView(t,this._ray.origin)}get center(){return this._center}set center(t){this._compareAndSetView(t,this._center,"_center")}get ray(){return he(this._ray.direction,this.center,this.eye),this._ray}get up(){return this._up}set up(t){this._compareAndSetView(t,this._up,"_up")}get viewMatrix(){return this._ensureViewClean(),this._viewMatrix}set viewMatrix(t){Ls(this._viewMatrix,t),this._viewDirty=!1,this._viewInverseTransposeMatrixDirty=!0,this._viewProjectionDirty=!0,this._frustumDirty=!0}get viewForward(){return this._ensureViewClean(),this._viewForward}get viewUp(){return this._ensureViewClean(),this._viewUp}get viewRight(){return this._ensureViewClean(),this._viewRight}get nearFar(){return this._nearFar}get near(){return this._nearFar[0]}set near(t){this._nearFar[0]!==t&&(this._nearFar[0]=t,this._viewProjectionDirty=!0,this._frustumDirty=!0,this.notifyChange("_nearFar"))}get far(){return this._nearFar[1]}set far(t){this._nearFar[1]!==t&&(this._nearFar[1]=t,this._viewProjectionDirty=!0,this._frustumDirty=!0,this.notifyChange("_nearFar"))}get viewport(){return this._viewport}set viewport(t){this.x=t[0],this.y=t[1],this.width=t[2],this.height=t[3]}get screenViewport(){if(this.pixelRatio===1)return this._viewport;const t=Zb(Wt(),this._viewport,1/this.pixelRatio),e=this._get("screenViewport");return e&&iN(t,e)?e:t}get screenPadding(){if(this.pixelRatio===1)return this._padding;const t=Zb(Wt(),this._padding,1/this.pixelRatio),e=this._get("screenPadding");return e&&iN(t,e)?e:t}get x(){return this._viewport[0]}set x(t){t+=this._padding[er.LEFT],this._viewport[0]!==t&&(this._viewport[0]=t,this._viewProjectionDirty=!0,this._frustumDirty=!0,this.notifyChange("_viewport"))}get y(){return this._viewport[1]}set y(t){t+=this._padding[er.BOTTOM],this._viewport[1]!==t&&(this._viewport[1]=t,this._viewProjectionDirty=!0,this._frustumDirty=!0,this.notifyChange("_viewport"))}get width(){return this._viewport[2]}set width(t){this._viewport[2]!==t&&(this._viewport[2]=t,this._viewProjectionDirty=!0,this._frustumDirty=!0,this.notifyChange("_viewport"))}get height(){return this._viewport[3]}set height(t){this._viewport[3]!==t&&(this._viewport[3]=t,this._viewProjectionDirty=!0,this._frustumDirty=!0,this.notifyChange("_viewport"))}get fullWidth(){return this._viewport[2]+this._padding[er.RIGHT]+this._padding[er.LEFT]}set fullWidth(t){this.width=t-(this._padding[er.RIGHT]+this._padding[er.LEFT])}get fullHeight(){return this._viewport[3]+this._padding[er.TOP]+this._padding[er.BOTTOM]}set fullHeight(t){this.height=t-(this._padding[er.TOP]+this._padding[er.BOTTOM])}get fullViewport(){return this._fullViewport[0]=this._viewport[0]-this._padding[er.LEFT],this._fullViewport[1]=this._viewport[1]-this._padding[er.BOTTOM],this._fullViewport[2]=this.fullWidth,this._fullViewport[3]=this.fullHeight,this._fullViewport}get _aspect(){return this.width/this.height}get padding(){return this._padding}set padding(t){wS(this._padding,t)||(this._viewport[0]+=t[er.LEFT]-this._padding[er.LEFT],this._viewport[1]+=t[er.BOTTOM]-this._padding[er.BOTTOM],this._viewport[2]-=t[er.RIGHT]+t[er.LEFT]-(this._padding[er.RIGHT]+this._padding[er.LEFT]),this._viewport[3]-=t[er.TOP]+t[er.BOTTOM]-(this._padding[er.TOP]+this._padding[er.BOTTOM]),mh(this._padding,t),this._viewProjectionDirty=!0,this._frustumDirty=!0,this.notifyChange("_padding"),this.notifyChange("_viewport"))}get viewProjectionMatrix(){return this._viewProjectionDirty&&(si(this._viewProjectionMatrix,this.projectionMatrix,this.viewMatrix),this._viewProjectionDirty=!1),this._viewProjectionMatrix}get projectionMatrix(){const t=this.width,e=this.height,r=this.near*Math.tan(this.fovY/2),i=r*this._aspect,s=R0e(be(),-i*(1+2*this._padding[er.LEFT]/t),i*(1+2*this._padding[er.RIGHT]/t),-r*(1+2*this._padding[er.BOTTOM]/e),r*(1+2*this._padding[er.TOP]/e),this.near,this.far),n=this._get("projectionMatrix");return n&&yZ(n,s)?n:s}get inverseProjectionMatrix(){return On(be(),this.projectionMatrix)||this._get("inverseProjectionMatrix")||be()}get fov(){return this._fov}set fov(t){this._fov=t,this._viewProjectionDirty=!0,this._frustumDirty=!0}get fovX(){return YJe(this._fov,this.width,this.height)}set fovX(t){this._fov=ZJe(t,this.width,this.height),this._viewProjectionDirty=!0,this._frustumDirty=!0}get fovY(){return JJe(this._fov,this.width,this.height)}set fovY(t){this._fov=XJe(t,this.width,this.height),this._viewProjectionDirty=!0,this._frustumDirty=!0}get distance(){return di(this.center,this.eye)}get frustum(){return this._recomputeFrustum(),this._frustum}get viewInverseTransposeMatrix(){return(this._viewInverseTransposeMatrixDirty||this._viewDirty)&&(On(this._viewInverseTransposeMatrix,this.viewMatrix),xc(this._viewInverseTransposeMatrix,this._viewInverseTransposeMatrix),this._viewInverseTransposeMatrixDirty=!1),this._viewInverseTransposeMatrix}depthNDCToWorld(t){const e=2*t-1;return 2*this.near*this.far/(this.far+this.near-e*(this.far-this.near))}get perRenderPixelRatio(){return Math.tan(this.fovX/2)/(this.width/2)}get perScreenPixelRatio(){return this.perRenderPixelRatio*this.pixelRatio}get aboveGround(){return this.relativeElevation!=null&&this.relativeElevation>=0}copyFrom(t){ie(this._ray.origin,t.eye),this.center=t.center,this.up=t.up,mh(this._viewport,t.viewport),this.notifyChange("_viewport"),mh(this._padding,t.padding),this.notifyChange("_padding"),fn(this._nearFar,t.nearFar),this.notifyChange("_nearFar"),this._fov=t.fov,this.relativeElevation=t.relativeElevation;const e=t;return this._viewDirty=e._viewDirty,this._viewDirty||(Ls(this._viewMatrix,t.viewMatrix),ie(this._viewRight,t.viewRight),ie(this._viewUp,t.viewUp),ie(this._viewForward,t.viewForward)),this._viewProjectionDirty=!0,this._frustumDirty=e._frustumDirty,this._frustumDirty||(i4(this._frustum,t.frustum),this._frustumDirty=!1),e._viewInverseTransposeMatrixDirty?this._viewInverseTransposeMatrixDirty=!0:(Ls(this._viewInverseTransposeMatrix,t.viewInverseTransposeMatrix),this._viewInverseTransposeMatrixDirty=!1),mh(this._fullViewport,t.fullViewport),this.pixelRatio=t.pixelRatio,this}copyViewFrom(t){this.eye=t.eye,this.center=t.center,this.up=t.up}clone(){return new GG().copyFrom(this)}equals(t){return la(this.eye,t.eye)&&la(this.center,t.center)&&la(this.up,t.up)&&wS(this._viewport,t.viewport)&&wS(this._padding,t.padding)&&Dve(this.nearFar,t.nearFar)&&this._fov===t.fov&&this.pixelRatio===t.pixelRatio&&this.relativeElevation===t.relativeElevation}almostEquals(t){if(Math.abs(t.fov-this._fov)>=.001||rN(t.screenPadding,this.screenPadding)>=1||rN(this.screenViewport,t.screenViewport)>=1)return!1;Cn(qo,t.eye,t.center),Cn(l8,this.eye,this.center);const e=fe(qo,l8),r=wV(qo),i=wV(l8),s=5e-4;return e*e>=(1-1e-10)*r*i&&AF(t.eye,this.eye)<Math.max(r,i)*s*s}computeRenderPixelSizeAt(t){return this.computeRenderPixelSizeAtDist(this._viewDirectionDistance(t))}computeRenderPixelSizeAtDist(t){return t*this.perScreenPixelRatio}computeScreenPixelSizeAt(t){return this.computeScreenPixelSizeAtDist(this._viewDirectionDistance(t))}_viewDirectionDistance(t){return Math.abs(g_(this.viewForward,he(qo,t,this.eye)))}computeScreenPixelSizeAtDist(t){return t*this.perScreenPixelRatio}computeDistanceFromRadius(t,e){return t/Math.tan(Math.min(this.fovX,this.fovY)/(2*(e||1)))}getScreenCenter(t=Zi()){return t[0]=(this.padding[er.LEFT]+this.width/2)/this.pixelRatio,t[1]=(this.padding[er.TOP]+this.height/2)/this.pixelRatio,t}getRenderCenter(t,e=.5,r=.5){return t[0]=this.padding[er.LEFT]+this.width*e,t[1]=this.padding[er.BOTTOM]+this.height*r,t[2]=.5,t}setGLViewport(t){const e=this.viewport,r=this.padding;t.setViewport(e[0]-r[3],e[1]-r[2],e[2]+r[1]+r[3],e[3]+r[0]+r[2])}applyProjection(t,e){t!==Kt&&ie(Kt,t),Kt[3]=1,su(Kt,Kt,this.projectionMatrix);const r=Math.abs(Kt[3]);te(Kt,Kt,1/r);const i=this.fullViewport;e[0]=wt(0,i[0]+i[2],.5+.5*Kt[0]),e[1]=wt(0,i[1]+i[3],.5+.5*Kt[1]),e[2]=.5*(Kt[2]+1),e[3]=r}unapplyProjection(t,e){const r=this.fullViewport;Kt[0]=(t[0]/(r[0]+r[2])*2-1)*t[3],Kt[1]=(t[1]/(r[1]+r[3])*2-1)*t[3],Kt[2]=(2*t[2]-1)*t[3],Kt[3]=t[3],this.inverseProjectionMatrix!=null&&(su(Kt,Kt,this.inverseProjectionMatrix),e[0]=Kt[0],e[1]=Kt[1],e[2]=Kt[2])}projectToScreen(t,e){return this.projectToRenderScreen(t,c8),this.renderToScreen(c8,e),e}projectToRenderScreen(t,e){if(Kt[0]=t[0],Kt[1]=t[1],Kt[2]=t[2],Kt[3]=1,su(Kt,Kt,this.viewProjectionMatrix),Kt[3]===0)return null;te(Kt,Kt,1/Math.abs(Kt[3]));const r=this.fullViewport;return"x"in e?(e.x=wt(0,r[0]+r[2],.5+.5*Kt[0]),e.y=wt(0,r[1]+r[3],.5+.5*Kt[1])):(e[0]=wt(0,r[0]+r[2],.5+.5*Kt[0]),e[1]=wt(0,r[1]+r[3],.5+.5*Kt[1]),e.length>2&&(e[2]=.5*(Kt[2]+1))),e}unprojectFromScreen(t,e){return this.unprojectFromRenderScreen(this.screenToRender(t,c8),e)}unprojectFromRenderScreen(t,e){if(si($M,this.projectionMatrix,this.viewMatrix),!On($M,$M))return null;const r=this.fullViewport;return Kt[0]=2*(t[0]-r[0])/r[2]-1,Kt[1]=2*(t[1]-r[1])/r[3]-1,Kt[2]=2*t[2]-1,Kt[3]=1,su(Kt,Kt,$M),Kt[3]===0?null:(e[0]=Kt[0]/Kt[3],e[1]=Kt[1]/Kt[3],e[2]=Kt[2]/Kt[3],e)}constrainWindowSize(t,e,r,i){const s=t*this.pixelRatio,n=e*this.pixelRatio,o=Math.max(s-r/2,0),a=Math.max(this.fullHeight-n-i/2,0),l=-Math.min(s-r/2,0),c=-Math.min(this.fullHeight-n-i/2,0);return[o,a,r-l- -Math.min(this.fullWidth-s-r/2,0),i-c- -Math.min(n-i/2,0)]}computeUp(t){t===De.Global?this._computeUpGlobal():this._computeUpLocal()}screenToRender(t,e){const r=t[0]*this.pixelRatio,i=this.fullHeight-t[1]*this.pixelRatio;return e[0]=r,e[1]=i,e}renderToScreen(t,e){const r=t[0]/this.pixelRatio,i=(this.fullHeight-t[1])/this.pixelRatio;e[0]=r,e[1]=i}_computeUpGlobal(){he(qo,this.center,this.eye);const t=Ce(this.center);t<1?(se(this._up,0,0,1),this._markViewDirty(),this.notifyChange("_up")):Math.abs(fe(qo,this.center))>.9999*Ce(qo)*t||(at(this._up,qo,this.center),at(this._up,this._up,qo),me(this._up,this._up),this.notifyChange("_up"),this._markViewDirty())}_computeUpLocal(){Hg(qo,this.eye,this.center),Math.abs(qo[2])<=.9999&&(te(qo,qo,qo[2]),se(this._up,-qo[0],-qo[1],1-qo[2]),me(this._up,this._up),this.notifyChange("_up"),this._markViewDirty())}_compareAndSetView(t,e,r=""){typeof t[0]=="number"&&isFinite(t[0])&&typeof t[1]=="number"&&isFinite(t[1])&&typeof t[2]=="number"&&isFinite(t[2])?la(t,e)||(ie(e,t),this._markViewDirty(),r.length&&this.notifyChange(r)):Q.getLogger("esri.views.3d.webgl-engine.lib.Camera").warn("Camera vector contains invalid number, ignoring value")}_markViewDirty(){this._viewDirty=!0,this._frustumDirty=!0,this._viewProjectionDirty=!0}_recomputeFrustum(){this._frustumDirty&&(Xwe(this.viewMatrix,this.projectionMatrix,this._frustum),this._frustumDirty=!1)}_ensureViewClean(){this._viewDirty&&(c5(this._viewMatrix,this.eye,this.center,this.up),se(this._viewForward,-this._viewMatrix[2],-this._viewMatrix[6],-this._viewMatrix[10]),se(this._viewUp,this._viewMatrix[1],this._viewMatrix[5],this._viewMatrix[9]),se(this._viewRight,this._viewMatrix[0],this._viewMatrix[4],this._viewMatrix[8]),this._viewDirty=!1,this._viewInverseTransposeMatrixDirty=!0)}};u([d()],ut.prototype,"_center",void 0),u([d()],ut.prototype,"_up",void 0),u([d()],ut.prototype,"_viewport",void 0),u([d()],ut.prototype,"_padding",void 0),u([d()],ut.prototype,"_fov",void 0),u([d()],ut.prototype,"_nearFar",void 0),u([d()],ut.prototype,"_pixelRatio",void 0),u([d()],ut.prototype,"pixelRatio",null),u([d()],ut.prototype,"eye",null),u([d()],ut.prototype,"center",null),u([d()],ut.prototype,"up",null),u([d({readOnly:!0})],ut.prototype,"nearFar",null),u([d()],ut.prototype,"near",null),u([d()],ut.prototype,"far",null),u([d()],ut.prototype,"viewport",null),u([d({readOnly:!0})],ut.prototype,"screenViewport",null),u([d({readOnly:!0})],ut.prototype,"screenPadding",null),u([d()],ut.prototype,"x",null),u([d()],ut.prototype,"y",null),u([d()],ut.prototype,"width",null),u([d()],ut.prototype,"height",null),u([d()],ut.prototype,"fullWidth",null),u([d()],ut.prototype,"fullHeight",null),u([d({readOnly:!0})],ut.prototype,"_aspect",null),u([d()],ut.prototype,"padding",null),u([d({readOnly:!0})],ut.prototype,"projectionMatrix",null),u([d({readOnly:!0})],ut.prototype,"inverseProjectionMatrix",null),u([d()],ut.prototype,"fov",null),u([d()],ut.prototype,"fovX",null),u([d()],ut.prototype,"fovY",null),ut=GG=u([R("esri.views.3d.webgl-engine.lib.Camera")],ut);const Kt=Wt(),$M=be(),qo=C(),l8=C(),c8=zo();var er;(function(t){t[t.TOP=0]="TOP",t[t.RIGHT=1]="RIGHT",t[t.BOTTOM=2]="BOTTOM",t[t.LEFT=3]="LEFT"})(er||(er={}));var ue;(function(t){t[t.INTEGRATED_MESH=0]="INTEGRATED_MESH",t[t.OPAQUE_TERRAIN=1]="OPAQUE_TERRAIN",t[t.OPAQUE_MATERIAL=2]="OPAQUE_MATERIAL",t[t.TRANSPARENT_MATERIAL=3]="TRANSPARENT_MATERIAL",t[t.TRANSPARENT_TERRAIN=4]="TRANSPARENT_TERRAIN",t[t.TRANSPARENT_DEPTH_WRITE_DISABLED_MATERIAL=5]="TRANSPARENT_DEPTH_WRITE_DISABLED_MATERIAL",t[t.OCCLUDED_TERRAIN=6]="OCCLUDED_TERRAIN",t[t.OCCLUDER_MATERIAL=7]="OCCLUDER_MATERIAL",t[t.TRANSPARENT_OCCLUDER_MATERIAL=8]="TRANSPARENT_OCCLUDER_MATERIAL",t[t.OCCLUSION_PIXELS=9]="OCCLUSION_PIXELS",t[t.POSTPROCESSING_ENVIRONMENT_OPAQUE=10]="POSTPROCESSING_ENVIRONMENT_OPAQUE",t[t.POSTPROCESSING_ENVIRONMENT_TRANSPARENT=11]="POSTPROCESSING_ENVIRONMENT_TRANSPARENT",t[t.LASERLINES=12]="LASERLINES",t[t.LASERLINES_CONTRAST_CONTROL=13]="LASERLINES_CONTRAST_CONTROL",t[t.HUD_MATERIAL=14]="HUD_MATERIAL",t[t.LABEL_MATERIAL=15]="LABEL_MATERIAL",t[t.LINE_CALLOUTS=16]="LINE_CALLOUTS",t[t.LINE_CALLOUTS_HUD_DEPTH=17]="LINE_CALLOUTS_HUD_DEPTH",t[t.DRAPED_MATERIAL=18]="DRAPED_MATERIAL",t[t.DRAPED_WATER=19]="DRAPED_WATER",t[t.VOXEL=20]="VOXEL",t[t.MAX_SLOTS=21]="MAX_SLOTS"})(ue||(ue={}));var ot;(function(t){t[t.Color=0]="Color",t[t.Alpha=1]="Alpha",t[t.FrontFace=2]="FrontFace",t[t.NONE=3]="NONE",t[t.COUNT=4]="COUNT"})(ot||(ot={}));let NX=class{constructor(e=C()){this.intensity=e}},exe=class{constructor(e=C(),r=Oe(.57735,.57735,.57735)){this.intensity=e,this.direction=r}},s4=class{constructor(e=C(),r=Oe(.57735,.57735,.57735),i=!0,s=1,n=1){this.intensity=e,this.direction=r,this.castShadows=i,this.specularStrength=s,this.environmentStrength=n}},txe=class{constructor(){this.r=[0],this.g=[0],this.b=[0]}};function QJe(t,e,r){(r=r||t).length=t.length;for(let i=0;i<t.length;i++)r[i]=t[i]*e[i];return r}function u8(t,e,r){(r=r||t).length=t.length;for(let i=0;i<t.length;i++)r[i]=t[i]*e;return r}function $S(t,e,r){(r=r||t).length=t.length;for(let i=0;i<t.length;i++)r[i]=t[i]+e[i];return r}function rxe(t){return(t+1)*(t+1)}function KJe(t){return ge(Math.floor(Math.sqrt(t)-1),0,2)}function ixe(t,e,r){const i=t[0],s=t[1],n=t[2],o=r||[];return o.length=rxe(e),e>=0&&(o[0]=.28209479177),e>=1&&(o[1]=.4886025119*i,o[2]=.4886025119*n,o[3]=.4886025119*s),e>=2&&(o[4]=1.09254843059*i*s,o[5]=1.09254843059*s*n,o[6]=.31539156525*(3*n*n-1),o[7]=1.09254843059*i*n,o[8]=.54627421529*(i*i-s*s)),o}function eQe(t,e){const r=rxe(t),i=e||{r:[],g:[],b:[]};i.r.length=i.g.length=i.b.length=r;for(let s=0;s<r;s++)i.r[s]=i.g[s]=i.b[s]=0;return i}function tQe(t,e){const r=KJe(e.r.length);for(const i of t)ca(jG,i.direction),ixe(jG,r,lg),QJe(lg,YL),u8(lg,i.intensity[0],ax),$S(e.r,ax),u8(lg,i.intensity[1],ax),$S(e.g,ax),u8(lg,i.intensity[2],ax),$S(e.b,ax);return e}function rQe(t,e){ixe(jG,0,lg);for(const r of t)e.r[0]+=lg[0]*YL[0]*r.intensity[0]*4*Math.PI,e.g[0]+=lg[0]*YL[0]*r.intensity[1]*4*Math.PI,e.b[0]+=lg[0]*YL[0]*r.intensity[2]*4*Math.PI;return e}function iQe(t,e,r,i){eQe(e,i),se(r.intensity,0,0,0);let s=!1;const n=sQe,o=nQe,a=oQe;n.length=0,o.length=0,a.length=0;for(const l of t)l instanceof s4&&!s?(ie(r.direction,l.direction),ie(r.intensity,l.intensity),r.specularStrength=l.specularStrength,r.environmentStrength=l.environmentStrength,r.castShadows=l.castShadows,s=!0):l instanceof s4||l instanceof exe?n.push(l):l instanceof NX?o.push(l):l instanceof txe&&a.push(l);tQe(n,i),rQe(o,i);for(const l of a)$S(i.r,l.r),$S(i.g,l.g),$S(i.b,l.b)}const sQe=[],nQe=[],oQe=[],lg=[0],ax=[0],jG=C(),YL=[3.141593,2.094395,2.094395,2.094395,.785398,.785398,.785398,.785398,.785398];let bie=class{constructor(){this.color=C(),this.intensity=1}},aQe=class{constructor(){this.direction=C(),this.ambient=new bie,this.diffuse=new bie}};const sxe=.4;let h8=class{constructor(){this._shOrder=2,this._legacy=new aQe,this.globalFactor=.5,this.noonFactor=.5,this._sphericalHarmonics=new txe,this._mainLight=new s4(C(),Oe(1,0,0),!1)}get legacy(){return this._legacy}get sh(){return this._sphericalHarmonics}get mainLight(){return this._mainLight}set(e){iQe(e,this._shOrder,this._mainLight,this._sphericalHarmonics),ie(this._legacy.direction,this._mainLight.direction);const r=1/Math.PI;this._legacy.ambient.color[0]=.282095*this._sphericalHarmonics.r[0]*r,this._legacy.ambient.color[1]=.282095*this._sphericalHarmonics.g[0]*r,this._legacy.ambient.color[2]=.282095*this._sphericalHarmonics.b[0]*r,te(this._legacy.diffuse.color,this._mainLight.intensity,r),ie(LM,this._legacy.diffuse.color),te(LM,LM,sxe*this.globalFactor),ce(this._legacy.ambient.color,this._legacy.ambient.color,LM)}copyFrom(e){this._sphericalHarmonics.r=Array.from(e.sh.r),this._sphericalHarmonics.g=Array.from(e.sh.g),this._sphericalHarmonics.b=Array.from(e.sh.b),ie(this._mainLight.direction,e.mainLight.direction),ie(this._mainLight.intensity,e.mainLight.intensity),this._mainLight.castShadows=e.mainLight.castShadows,this._mainLight.specularStrength=e.mainLight.specularStrength,this._mainLight.environmentStrength=e.mainLight.environmentStrength,this.globalFactor=e.globalFactor,this.noonFactor=e.noonFactor}lerpLighting(e,r,i){if(Br(this._mainLight.intensity,e.mainLight.intensity,r.mainLight.intensity,i),this._mainLight.environmentStrength=wt(e.mainLight.environmentStrength,r.mainLight.environmentStrength,i),this._mainLight.specularStrength=wt(e.mainLight.specularStrength,r.mainLight.specularStrength,i),ie(this._mainLight.direction,r.mainLight.direction),this._mainLight.castShadows=r.mainLight.castShadows,this.globalFactor=wt(e.globalFactor,r.globalFactor,i),this.noonFactor=wt(e.noonFactor,r.noonFactor,i),e.sh.r.length===r.sh.r.length)for(let s=0;s<r.sh.r.length;s++)this._sphericalHarmonics.r[s]=wt(e.sh.r[s],r.sh.r[s],i),this._sphericalHarmonics.g[s]=wt(e.sh.g[s],r.sh.g[s],i),this._sphericalHarmonics.b[s]=wt(e.sh.b[s],r.sh.b[s],i);else for(let s=0;s<r.sh.r.length;s++)this._sphericalHarmonics.r[s]=r.sh.r[s],this._sphericalHarmonics.g[s]=r.sh.g[s],this._sphericalHarmonics.b[s]=r.sh.b[s]}};const LM=C();let k5=class{constructor(e,r,i){this.shadowMap=e,this.ssaoHelper=r,this.slicePlane=i,this.slot=ue.OPAQUE_MATERIAL,this.hasOccludees=!1,this.enableFillLights=!0,this.transparencyPassType=ot.NONE,this.alignPixelEnabled=!1,this._camera=new ut,this._inverseViewport=Ve(),this.oldLighting=new h8,this.newLighting=new h8,this._fadedLighting=new h8,this._lighting=this.newLighting,this.ssr=new kJe,this.multipassTerrain=new FJe,this.multipassGeometry=new NJe,this.overlays=[],this.cloudsFade=new yJe}get camera(){return this._camera}set camera(e){this._camera=this.ssr.camera=e,this._inverseViewport[0]=1/e.fullViewport[2],this._inverseViewport[1]=1/e.fullViewport[3]}get inverseViewport(){return this._inverseViewport}get lighting(){return this._lighting}get weatherFading(){return this._lighting===this._fadedLighting}fadeLighting(e){const{oldLighting:r,newLighting:i}=this;e>=1?this._lighting=i:(this._fadedLighting.lerpLighting(r,i,e),this._lighting=this._fadedLighting)}},ul=class extends Te{constructor(e){super(e),this._handles=new Oi,this._techniques=new Array,this._techniqueConfiguration=new ZL,this._bindParameters=new k5(null,null,null),this._passParameters=new Vwe,this._drawParameters=new zwe,this._weatherTile=Ve(),this._weatherTileCount=128,this._faceIndex=0,this._tileIndex=0,this.coverage=wt(Ko.default.coverage[0],Ko.default.coverage[1],.5),this.density=wt(Ko.default.density[0],Ko.default.density[1],.5),this.absorption=wt(Ko.default.absorption[0],Ko.default.absorption[1],.5),this.cloudSize=wt(Ko.default.cloudSize[0],Ko.default.cloudSize[1],.5),this.detailSize=wt(Ko.default.detailSize[0],Ko.default.detailSize[1],.5),this.smoothness=wt(Ko.default.smoothness[0],Ko.default.smoothness[1],.5),this.cloudHeight=wt(Ko.default.cloudHeight[0],Ko.default.cloudHeight[1],.5),this.raymarchingSteps=Ko.default.raymarchingSteps,this._viewMatrix=be(),this._dirty=!1,this.running=!1,this._vao=Rl(e.context.renderContext.rctx)}_getTechnique(e){const r=1-this.context.renderContext.bindParameters.cloudsFade.readChannels,i=r===lw.RG?2*e:2*e+1;return this._techniques[i]||(this._techniqueConfiguration.writeTextureChannels=r,this._techniqueConfiguration.steps=e,this._techniques[i]=new Bwe({rctx:this.context.renderContext.rctx,viewingMode:this.view.state.viewingMode},this._techniqueConfiguration),this._techniques[i])}updateWeatherTile(){const e=this.view.camera.position.latitude,r=this.view.camera.position.longitude;if(e==null||r==null)return;or(this._weatherTile,(e+90)/180,(r+180)/360);const i=Math.floor(this._weatherTileCount*Math.abs(2*this._weatherTile[0]-1));this._weatherTile[0]=Math.floor(2*this._weatherTileCount*this._weatherTile[0]),this._weatherTile[1]=Math.floor(4*(this._weatherTileCount-i)*this._weatherTile[1]);let s=0,n=0;if(this.view.environment!=null&&this.view.environment.lighting.type!=="virtual"&&this.view.environment.lighting.date!=null){const o=new Date(this.view.environment.lighting.date);o.setUTCHours(this.view.environment.lighting.date.getUTCHours()+(this.view.environment.lighting.displayUTCOffset??0)),s=31*o.getUTCMonth()+o.getUTCDate(),n=o.getUTCFullYear()}this._weatherTile[0]=(this._weatherTile[0]+s)%(2*this._weatherTileCount),this._weatherTile[1]=(this._weatherTile[1]+n%100)%(4*this._weatherTileCount),Nve(this._passParameters.weatherTile,this._weatherTile)||this.setDirty()}initialize(){const e=Nr(this.view.spatialReference);this._passParameters.cloudRadius=.5*e.radius,this.setDirty(),this.updateWeatherTile(),this._handles.add([this.view.resourceController.scheduler.registerTask(dt.CLOUDS_GENERATOR,this),le(()=>[this.coverage,this.density,this.absorption,this.cloudSize,this.detailSize,this.smoothness,this.cloudHeight,this.raymarchingSteps],()=>this.setDirty(),Vr)])}destroy(){this._handles.destroy(),this._techniques.forEach(e=>Ui(e)),this._frameBufferCube=Ue(this._frameBufferCube),this._techniques.length=0,this._vao.dispose(),this._passParameters.noiseTexture=Me(this._passParameters.noiseTexture)}get _tilesPerFace(){switch(this._techniqueConfiguration.steps){case wl.SIXTEEN:return 1;case wl.HUNDRED:return 4;case wl.COUNT:case wl.TWOHUNDRED:return 8}}_ensureNoiseTexture(){if(this._passParameters.noiseTexture!=null)this._passParameters.noiseTexture.updateWeatherMap(this._passParameters.weatherTile);else{const e=this.context;this._passParameters.noiseTexture=new WA({context:e}),this._passParameters.noiseTexture.updateWeatherMap(this._passParameters.weatherTile)}return this._passParameters.noiseTexture.textureAtlas!=null}_ensureFrameBufferCube(e){if(this._frameBufferCube==null){const r=new vr(e);r.target=is.TEXTURE_CUBE_MAP,r.wrapMode=$t.CLAMP_TO_EDGE,this._frameBufferCube=new hn(this.context.renderContext.rctx,r)}return this._frameBufferCube}get cubeMap(){return this._frameBufferCube}destroyFrameBufferCube(){this._frameBufferCube=Ue(this._frameBufferCube)}applyPreset(e,r){const i=e.median,s=n=>{const o=wt(n[0],n[1],i);return r<.5?wt(n[0],o,2*r):wt(o,n[1],2*(r-.5))};this.coverage=s(e.coverage),this.density=s(e.density),this.absorption=s(e.absorption),this.cloudSize=s(e.cloudSize),this.detailSize=s(e.detailSize),this.smoothness=s(e.smoothness),this.cloudHeight=s(e.cloudHeight),this.raymarchingSteps=e.raymarchingSteps}setDirty(){this._dirty=this.running=!0}runTask(e){this._faceIndex===0&&this._tileIndex===0&&(this._passParameters.raymarchingSteps=this.raymarchingSteps,this.updateWeatherTile(),fn(this._passParameters.weatherTile,this._weatherTile));const r=this._getTechnique(this._passParameters.raymarchingSteps);if(!r.compiled||!this.context.renderContext.bindParameters.cloudsFade.isCameraPositionFinal||this.context.renderContext.bindParameters.cloudsFade.isFading||!this._ensureNoiseTexture())return jo.YIELD;this._faceIndex===0&&this._tileIndex===0&&(this.context.renderContext.bindParameters.cloudsFade.renderingStage=Os.RENDERING,this._passParameters.absorption=this.absorption,this._passParameters.density=this.density,this._passParameters.cloudSize=this.cloudSize,this._passParameters.detailSize=this.detailSize,this._passParameters.smoothness=this.smoothness,this._passParameters.cloudHeight=this.cloudHeight,this._passParameters.coverage=this.coverage,this._dirty=!1);const i=this.context.renderContext.rctx,s=i.bindTechnique(r,this._passParameters,this._bindParameters);i.bindVAO(this._vao),s.assertCompatibleVertexAttributeLocations(this._vao);const n=i.getViewport(),o=r.configuration.cubeMapSize,a=o/this._tilesPerFace,l=this._tileIndex*a;i.setViewport(0,l,o,a);const c=this._ensureFrameBufferCube(o);i.bindFramebuffer(c);const h=lQe[this._faceIndex],p=cQe[this._faceIndex];M0e(this._viewMatrix,uQe,h,p),Ph(this._drawParameters.viewMatrix,this._viewMatrix);const f=is.TEXTURE_CUBE_MAP_POSITIVE_X+this._faceIndex;return c.setColorTextureTarget(f),s.bindDraw(this._drawParameters,this._bindParameters,this._passParameters),i.gl.drawArrays(i.gl.TRIANGLE_STRIP,0,4),i.gl.flush(),i.setViewport(n.x,n.y,n.width,n.height),this.requestRender(),++this._tileIndex,this._faceIndex===4&&this._tileIndex===this._tilesPerFace?(this.running=this._dirty,this._faceIndex=0,this._tileIndex=0,this.context.renderContext.bindParameters.cloudsFade.renderingStage=Os.FINISHED_RENDERING):this._tileIndex===this._tilesPerFace&&(++this._faceIndex,this._tileIndex=0),e.madeProgress(),jo.YIELD}};u([d({constructOnly:!0})],ul.prototype,"context",void 0),u([d({constructOnly:!0})],ul.prototype,"view",void 0),u([d({constructOnly:!0})],ul.prototype,"requestRender",void 0),u([d()],ul.prototype,"coverage",void 0),u([d()],ul.prototype,"density",void 0),u([d()],ul.prototype,"absorption",void 0),u([d()],ul.prototype,"cloudSize",void 0),u([d()],ul.prototype,"detailSize",void 0),u([d()],ul.prototype,"smoothness",void 0),u([d()],ul.prototype,"cloudHeight",void 0),u([d()],ul.prototype,"raymarchingSteps",void 0),u([d()],ul.prototype,"running",void 0),ul=u([R("esri.views.3d.environment.CloudsGenerator")],ul);const lQe=[Xr(1,0,0),Xr(-1,0,0),Xr(0,1,0),Xr(0,-1,0),Xr(0,0,1)],cQe=[Xr(0,1,0),Xr(0,1,0),Xr(0,0,-1),Xr(0,0,1),Xr(0,1,0)],uQe=lX();let nxe=class extends ei{constructor(){super(...arguments),this.fogColor=C(),this.fogStrength=4e-6,this.atmosphereC=1,this.fogAmount=0}};function hQe(){const t=new wr;t.attributes.add(E.POSITION,"vec2"),t.include(Pf,{textureCoordinateType:Ps.Default}),t.varyings.add("worldRay","vec3"),t.varyings.add("eyeDir","vec3");const{vertex:e,fragment:r}=t;return e.uniforms.add(new $i("inverseProjectionMatrix",(i,s)=>s.camera.inverseProjectionMatrix),new $i("inverseViewMatrix",(i,s)=>lE(dQe,s.camera.viewMatrix))),e.code.add(b`void main(void) {
vec3 posViewNear = (inverseProjectionMatrix * vec4(position, -1, 1)).xyz;
eyeDir = posViewNear;
worldRay = (inverseViewMatrix * vec4(posViewNear, 0)).xyz;
forwardTextureCoordinates();
gl_Position = vec4(position, 1, 1);
}`),r.uniforms.add(new Re("atmosphereC",i=>i.atmosphereC),new Ft("cameraPosition",(i,s)=>s.camera.eye),new Sr("nearFar",(i,s)=>s.camera.nearFar),new Je("depthTexture",i=>i.depthTexture),new Re("fogStrength",i=>i.fogStrength),new Re("fogAmount",i=>i.fogAmount),new Ft("fogColor",i=>i.fogColor)),t.include(N5),r.include(_u),r.code.add(b`vec2 sphereIntersect(vec3 start, vec3 dir) {
float a = dot(dir, dir);
float b = 2.0 * dot(dir, start);
float d = (b * b) - 4.0 * a * atmosphereC;
if (d < 0.0) {
return vec2(1e5, -1e5);
}
return vec2((-b - sqrt(d)) / (2.0 * a), (-b + sqrt(d)) / (2.0 * a));
}`),r.code.add(b`vec4 applyFog(float dist, vec3 rayDir){
if(dist == -1.0){
vec2 rayAtmosphereIntersect = sphereIntersect(cameraPosition, rayDir);
dist = 0.055 * rayAtmosphereIntersect.y;
}
float fogAmount = fogAmount * (1.0 - exp(-dist * fogStrength));
return vec4(fogAmount * fogColor, fogAmount);
}`),r.code.add(b`vec3 tonemapACES(vec3 x) {
return clamp((x * (2.51 * x + 0.03)) / (x * (2.43 * x + 0.59) + 0.14), 0.0, 1.0);
}
void main() {
vec3 rayDir = normalize(worldRay);
float terrainDepth = -1.0;
float depthSample = texture(depthTexture, vuv0).r;
float zNorm = 2.0 * depthSample - 1.0;
float linDepth = 2.0 * nearFar[0] * nearFar[1] / (nearFar[1] + nearFar[0] - zNorm * (nearFar[1] - nearFar[0]));
if(depthSample < 1.0 && depthSample > 0.0){
vec3 cameraSpaceRay = normalize(eyeDir);
cameraSpaceRay /= cameraSpaceRay.z;
cameraSpaceRay *= linDepth;
terrainDepth = max(0.0, length(cameraSpaceRay));
}
vec4 fog = applyFog(terrainDepth, rayDir);
fragColor = delinearizeGamma(vec4(tonemapACES(fog.rgb), fog.a));
}`),t}const dQe=be(),pQe=Object.freeze(Object.defineProperty({__proto__:null,FogPassParameters:nxe,build:hQe},Symbol.toStringTag,{value:"Module"}));let oxe=class axe extends Pr{constructor(e){super(e,new pa,()=>this.destroy())}initializeProgram(e){return new Cr(e.rctx,axe.shader.get().build(),br)}initializePipeline(){return At({blending:xo(we.SRC_ALPHA,we.ZERO,we.ONE_MINUS_SRC_ALPHA,we.ONE),colorWrite:Vt})}};oxe.shader=new Er(pQe,()=>ae(()=>import("./Fog.glsl-c4e96d1f.js"),[],import.meta.url));const fQe=.95,mQe=1;let L1=class extends Te{constructor(e){super(e),this._passParameters=new nxe;const r=e.context.renderContext.rctx;this._vao=Rl(r,XR),this._technique=new oxe(e);const i=Nr(e.view.spatialReference);this._planetRadius=i.radius,this._atmosphereRadius=i.radius+I0}destroy(){this._technique.release(),this._vao.dispose()}set strength(e){this._passParameters.fogStrength=e}get strength(){return this._passParameters.fogStrength}render(e,r){if(this._update(e,r),this._passParameters.fogAmount<=0)return;const i=this._technique;if(!i.compiled)return void this.context.requestRender();const s=e.offscreenRenderingHelper;s.renderDepthDetached(()=>{this._passParameters.depthTexture=s.depthTexture;const n=e.rctx.bindTechnique(i,this._passParameters,e.bindParameters);this._renderFog(n,e)})}_renderFog(e,r){const i=r.rctx;i.bindVAO(this._vao),e.assertCompatibleVertexAttributeLocations(this._vao),i.drawArrays(St.TRIANGLE_STRIP,0,4)}_update(e,r){const i=e.bindParameters.camera;me(wie,i.eye);const s=Math.max(0,fe(wie,e.bindParameters.lighting.mainLight.direction)),n=r.color;te(xie,n,.1),Br(this._passParameters.fogColor,xie,n,s);const o=Ce(i.eye),a=o*o;this._passParameters.atmosphereC=a-this._atmosphereRadius*this._atmosphereRadius,this._passParameters.fogAmount=(1-TO(fQe*df,mQe*df,Math.abs(o-this._planetRadius)))*r.amount,this._passParameters.fogStrength=r.strength}static isSupported(e){return e.capabilities.depthTexture}};u([d({constructOnly:!0})],L1.prototype,"context",void 0),u([d({constructOnly:!0})],L1.prototype,"view",void 0),u([d({constructOnly:!0})],L1.prototype,"rctx",void 0),u([d({constructOnly:!0})],L1.prototype,"viewingMode",void 0),L1=u([R("esri.views.3d.environment.Fog")],L1);let gQe=class{constructor(){this.color=C(),this.strength=0,this.amount=0}};const wie=C(),xie=C();let Uo=class extends pa{};u([B({constValue:!0})],Uo.prototype,"hasSliceHighlight",void 0),u([B({constValue:!1})],Uo.prototype,"hasSliceInVertexProgram",void 0),u([B({constValue:!1})],Uo.prototype,"instancedDoublePrecision",void 0),u([B({constValue:!1})],Uo.prototype,"hasModelTransformation",void 0),u([B({constValue:Qr.Pass})],Uo.prototype,"pbrTextureBindType",void 0);var Hf;(function(t){t[t.Cone=0]="Cone",t[t.Cylinder=1]="Cylinder",t[t.Underground=2]="Underground",t[t.COUNT=3]="COUNT"})(Hf||(Hf={}));let FX=class extends Uo{constructor(){super(...arguments),this.geometry=Hf.Cone}};u([B({count:Hf.COUNT})],FX.prototype,"geometry",void 0);var N;(function(t){t[t.Color=0]="Color",t[t.Depth=1]="Depth",t[t.Normal=2]="Normal",t[t.Shadow=3]="Shadow",t[t.ShadowHighlight=4]="ShadowHighlight",t[t.ShadowExcludeHighlight=5]="ShadowExcludeHighlight",t[t.Highlight=6]="Highlight",t[t.Alpha=7]="Alpha",t[t.ObjectAndLayerIdColor=8]="ObjectAndLayerIdColor",t[t.COUNT=9]="COUNT"})(N||(N={}));function JR(t){t.attributes.add(E.POSITION,"vec3"),t.vertex.code.add(b`vec3 positionModel() { return position; }`)}function n4({code:t},e){e.doublePrecisionRequiresObfuscation?t.add(b`vec3 dpPlusFrc(vec3 a, vec3 b) {
return mix(a, a + b, vec3(notEqual(b, vec3(0))));
}
vec3 dpMinusFrc(vec3 a, vec3 b) {
return mix(vec3(0), a - b, vec3(notEqual(a, b)));
}
vec3 dpAdd(vec3 hiA, vec3 loA, vec3 hiB, vec3 loB) {
vec3 t1 = dpPlusFrc(hiA, hiB);
vec3 e = dpMinusFrc(t1, hiA);
vec3 t2 = dpMinusFrc(hiB, e) + dpMinusFrc(hiA, dpMinusFrc(t1, e)) + loA + loB;
return t1 + t2;
}`):t.add(b`vec3 dpAdd(vec3 hiA, vec3 loA, vec3 hiB, vec3 loB) {
vec3 t1 = hiA + hiB;
vec3 e = t1 - hiA;
vec3 t2 = ((hiB - e) + (hiA - (t1 - e))) + loA + loB;
return t1 + t2;
}`)}let kh=class extends as{constructor(e,r){super(e,"mat3",Qr.Pass,(i,s,n)=>i.setUniformMatrix3fv(e,r(s,n)))}};function LS(t,e){t.include(JR);const r=t.vertex;r.include(n4,e),t.varyings.add("vPositionWorldCameraRelative","vec3"),t.varyings.add("vPosition_view","vec3"),r.uniforms.add(new Ft("transformWorldFromViewTH",i=>i.transformWorldFromViewTH),new Ft("transformWorldFromViewTL",i=>i.transformWorldFromViewTL),new kh("transformViewFromCameraRelativeRS",i=>i.transformViewFromCameraRelativeRS),new $i("transformProjFromView",i=>i.transformProjFromView),new qO("transformWorldFromModelRS",i=>i.transformWorldFromModelRS),new cu("transformWorldFromModelTH",i=>i.transformWorldFromModelTH),new cu("transformWorldFromModelTL",i=>i.transformWorldFromModelTL)),r.code.add(b`vec3 positionWorldCameraRelative() {
vec3 rotatedModelPosition = transformWorldFromModelRS * positionModel();
vec3 transform_CameraRelativeFromModel = dpAdd(
transformWorldFromModelTL,
transformWorldFromModelTH,
-transformWorldFromViewTL,
-transformWorldFromViewTH
);
return transform_CameraRelativeFromModel + rotatedModelPosition;
}`),r.code.add(b`
    void forwardPosition(float fOffset) {
      vPositionWorldCameraRelative = positionWorldCameraRelative();
      if (fOffset != 0.0) {
        vPositionWorldCameraRelative += fOffset * ${e.spherical?b`normalize(transformWorldFromViewTL + vPositionWorldCameraRelative)`:b`vec3(0.0, 0.0, 1.0)`};
      }

      vPosition_view = transformViewFromCameraRelativeRS * vPositionWorldCameraRelative;
      gl_Position = transformProjFromView * vec4(vPosition_view, 1.0);
    }
  `),t.fragment.uniforms.add(new Ft("transformWorldFromViewTL",i=>i.transformWorldFromViewTL)),r.code.add(b`vec3 positionWorld() {
return transformWorldFromViewTL + vPositionWorldCameraRelative;
}`),t.fragment.code.add(b`vec3 positionWorld() {
return transformWorldFromViewTL + vPositionWorldCameraRelative;
}`)}let lxe=class extends ei{constructor(){super(...arguments),this.transformWorldFromViewTH=C(),this.transformWorldFromViewTL=C(),this.transformViewFromCameraRelativeRS=Li(),this.transformProjFromView=be()}},cxe=class extends ei{constructor(){super(...arguments),this.transformWorldFromModelRS=Li(),this.transformWorldFromModelTH=C(),this.transformWorldFromModelTL=C()}};function F_(t){t.varyings.add("linearDepth","float")}function cw(t){t.vertex.uniforms.add(new Sr("nearFar",(e,r)=>r.camera.nearFar))}function V5(t){t.vertex.code.add(b`float calculateLinearDepth(vec2 nearFar,float z) {
return (-z - nearFar[0]) / (nearFar[1] - nearFar[0]);
}`)}function mE(t,e){const{vertex:r}=t;switch(e.output){case N.Color:if(e.receiveShadows)return F_(t),void r.code.add(b`void forwardLinearDepth() { linearDepth = gl_Position.w; }`);break;case N.Depth:case N.Shadow:case N.ShadowHighlight:case N.ShadowExcludeHighlight:return t.include(LS,e),F_(t),cw(t),V5(t),void r.code.add(b`void forwardLinearDepth() {
linearDepth = calculateLinearDepth(nearFar, vPosition_view.z);
}`)}r.code.add(b`void forwardLinearDepth() {}`)}function xl(t){V5(t),t.vertex.code.add(b`vec4 transformPositionWithDepth(mat4 proj, mat4 view, vec3 pos, vec2 nearFar, out float depth) {
vec4 eye = view * vec4(pos, 1.0);
depth = calculateLinearDepth(nearFar,eye.z);
return proj * eye;
}`),t.vertex.code.add(b`vec4 transformPosition(mat4 proj, mat4 view, vec3 pos) {
return proj * (view * vec4(pos, 1.0));
}`)}let UX=class extends ei{constructor(){super(...arguments),this.texV=Ve(),this.altitudeFade=0,this.innerScale=0,this.undergroundFadeAlpha=0,this.silhouette=new uxe}},uxe=class{constructor(){this.center=C(),this.v1=C(),this.v2=C()}};function yQe(t){const e=new wr,{vertex:r,fragment:i}=e;if(Jg(r),t.geometry===Hf.Underground)e.attributes.add(E.POSITION,"vec2"),e.varyings.add("color","vec4"),r.uniforms.add(new Ft("cameraPosition",(s,n)=>n.camera.eye),new Re("undergroundFadeAlpha",s=>s.undergroundFadeAlpha)),r.code.add(b`void main(void) {
float ndotl = dot(normalize(cameraPosition), mainLightDirection);
float lighting = max(0.0, smoothstep(-1.0, 0.8, 2.0 * ndotl));
color = vec4(vec3(lighting), undergroundFadeAlpha);
gl_Position = vec4(position.xy, 1.0, 1.0);
}`),i.code.add(b`void main() {
fragColor = color;
}`);else{e.include(xl,t),e.attributes.add(E.POSITION,"vec3"),e.varyings.add("vtc","vec2"),e.varyings.add("falloff","float");const s=t.geometry===Hf.Cylinder;r.uniforms.add(new $i("proj",(a,l)=>l.camera.projectionMatrix),new $i("view",(a,l)=>l.camera.viewMatrix)),s||(e.varyings.add("innerFactor","float"),r.uniforms.add(new Ft("silCircleCenter",a=>a.silhouette.center)),r.uniforms.add(new Ft("silCircleV1",a=>a.silhouette.v1)),r.uniforms.add(new Ft("silCircleV2",a=>a.silhouette.v2)),r.uniforms.add(new Sr("texV",a=>a.texV)),r.uniforms.add(new Re("innerScale",a=>a.innerScale)));const n=6.2831853,o=1/128;r.code.add(b`
		void main(void) {
      ${s?b`
      vec3 pos = position;
      float ndotl = mainLightDirection.z;
      vtc = vec2(0.0, position.z + 0.05);`:b`
      innerFactor = clamp(-position.z, 0.0, 1.0);
      float scale = position.y * (1.0 + innerFactor * innerScale);
      float phi = position.x * ${b.float(n*o)} + 1.0;
      vec3 pos =  (silCircleCenter + sin(phi) * silCircleV1 + cos(phi) * silCircleV2) * scale;
      float ndotl = dot(normalize(position.y > 0.0 ? pos: silCircleCenter), mainLightDirection);
      vtc.x = position.x  * ${b.float(o)};
      vtc.y = texV.x * (1.0 - position.z) + texV.y * position.z;
      `}
      falloff = max(0.0, smoothstep(-1.0, 0.8, 2.0 * ndotl));

		  gl_Position = transformPosition(proj, view, pos);
		  gl_Position.z = gl_Position.w; // project atmosphere onto the far plane
    }
	  `),i.uniforms.add(new Je("tex",a=>a.texture)),s||i.uniforms.add(new Re("altitudeFade",a=>a.altitudeFade)),i.code.add(b`
		void main() {
			vec4 atmosphereColor = texture(tex, vtc) * falloff;
      ${s?b`fragColor = atmosphereColor;`:b`
			vec4 innerColor = vec4(atmosphereColor.rgb, 1.0 - altitudeFade);
			fragColor = mix(atmosphereColor, innerColor, smoothstep(0.0, 1.0, innerFactor));
      `}
    }`)}return e}const _Qe=Object.freeze(Object.defineProperty({__proto__:null,SilhouetteCircle:uxe,SimpleAtmospherePassParameters:UX,build:yQe},Symbol.toStringTag,{value:"Module"}));let o4=class hxe extends Pr{initializeProgram(e){return new Cr(e.rctx,hxe.shader.get().build(this.configuration),br)}initializePipeline(){return this.configuration.geometry===Hf.Cylinder?At({blending:xo(we.SRC_ALPHA,we.ONE,we.ONE_MINUS_SRC_ALPHA,we.ONE_MINUS_SRC_ALPHA),culling:CX,depthTest:{func:Kr.LEQUAL},colorWrite:Vt}):At({blending:xo(we.SRC_ALPHA,we.ONE,we.ONE_MINUS_SRC_ALPHA,we.ONE_MINUS_SRC_ALPHA),depthTest:{func:Kr.LEQUAL},colorWrite:Vt})}};o4.shader=new Er(_Qe,()=>ae(()=>import("./SimpleAtmosphere.glsl-8aa8fd88.js"),[],import.meta.url));const vQe=new Uint8ClampedArray([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,2,0,0,0,2,0,0,0,2,0,0,0,2,0,0,0,2,0,0,0,2,0,0,0,3,0,0,0,3,0,0,0,3,0,0,0,3,0,0,0,3,0,0,0,4,0,0,0,4,0,0,0,4,0,0,0,4,0,0,0,4,0,0,0,4,0,0,0,5,0,0,0,5,0,0,0,5,0,0,0,5,0,0,0,5,0,0,0,6,0,0,0,6,0,0,0,6,0,0,0,6,0,0,0,6,0,0,0,7,0,0,0,7,0,0,0,7,0,0,0,7,0,0,0,7,0,0,0,8,0,0,0,8,0,0,0,8,0,0,0,8,0,0,0,8,0,0,0,9,0,0,0,9,0,0,0,9,0,0,0,9,0,0,0,9,0,0,0,10,0,0,0,10,0,0,0,10,0,0,0,10,0,0,0,11,0,0,0,11,0,0,0,11,0,0,0,11,0,0,0,11,0,0,0,12,0,0,0,12,0,0,0,12,0,0,0,12,0,0,0,13,0,0,0,13,0,0,0,13,0,0,0,13,0,0,0,14,0,0,0,14,0,0,0,14,0,0,0,14,0,0,0,15,0,0,0,15,0,0,0,15,0,0,0,15,0,0,0,15,16,0,0,16,16,0,0,16,16,0,0,16,16,0,0,16,15,0,0,17,15,0,0,17,15,0,0,17,15,0,0,17,14,0,0,18,14,0,0,18,14,0,0,18,13,0,0,19,13,0,0,19,13,0,0,19,13,0,0,19,13,0,0,20,13,0,0,20,13,0,0,20,13,0,0,20,12,0,0,21,12,0,0,21,12,0,0,21,12,0,0,21,12,0,0,22,12,0,0,22,12,0,0,22,12,0,0,22,11,0,0,23,11,0,0,23,11,0,0,23,11,0,0,24,11,0,0,24,11,0,0,24,11,0,0,24,10,0,0,25,10,0,0,25,10,0,0,25,10,0,0,26,10,0,0,26,10,0,0,26,10,0,0,26,9,0,0,27,9,0,0,27,9,0,0,27,18,0,0,28,18,0,0,28,18,0,0,28,18,0,0,28,18,0,0,29,18,0,0,29,18,0,0,29,17,0,0,30,17,0,0,30,17,0,0,30,17,0,0,30,16,0,0,31,16,0,0,31,16,0,0,31,16,0,0,32,16,0,0,32,16,0,0,32,15,0,0,33,15,0,0,33,15,0,0,33,15,0,0,34,15,8,0,34,15,8,0,34,15,8,0,34,15,7,0,35,15,7,0,35,15,7,0,35,21,7,0,36,21,7,0,36,21,7,0,36,21,7,0,37,21,7,0,37,21,7,0,37,20,7,0,38,20,7,0,38,20,7,0,38,20,7,0,39,20,7,0,39,20,7,0,39,20,7,0,39,19,6,0,40,19,6,0,40,19,6,0,40,19,6,0,41,19,6,0,41,19,6,0,41,18,6,0,42,18,6,0,42,18,6,0,42,24,6,0,43,24,6,0,43,24,6,0,43,23,6,0,44,23,6,0,44,23,6,0,44,23,6,0,45,23,6,0,45,23,6,0,45,22,6,0,46,22,6,0,46,22,6,0,46,22,5,0,47,22,5,0,47,22,5,0,47,21,5,0,48,21,5,0,48,21,5,0,48,21,5,0,49,21,5,0,49,26,5,0,49,25,5,0,50,25,5,0,50,25,5,0,50,25,5,0,51,25,5,0,51,25,5,0,51,25,5,0,52,25,5,0,52,25,5,0,52,24,5,0,53,24,5,0,53,24,5,0,53,24,9,0,54,28,9,0,54,28,9,0,54,28,9,0,55,28,9,0,55,27,9,0,56,27,9,0,56,27,9,0,56,27,9,4,57,27,9,4,57,27,9,4,57,26,9,4,58,26,9,4,58,26,9,4,58,26,9,4,59,26,9,4,59,26,9,4,59,26,8,4,60,30,8,4,60,30,8,4,60,29,8,4,61,29,8,4,61,29,8,4,62,29,8,4,62,29,8,4,62,28,8,4,63,28,8,4,63,28,8,4,63,28,12,4,64,28,12,4,64,28,12,4,64,27,12,4,65,27,12,8,65,27,12,8,65,31,12,8,66,31,12,8,66,30,11,8,67,30,11,8,67,30,11,8,67,30,11,8,68,30,11,8,68,30,11,8,68,30,15,7,69,30,15,7,69,30,15,7,69,33,15,11,70,33,15,11,70,32,14,11,71,32,14,11,71,32,14,11,71,32,18,14,72,32,18,14,72,32,18,14,72,31,17,14,73,35,17,14,73,34,17,17,74,34,21,17,74,34,21,17,74,34,20,17,75,34,20,20,75,34,20,20,75,34,23,20,76,34,23,20,76,36,23,23,77,36,23,23,77,36,23,23,77,36,23,23,78,36,26,26,78,36,26,26,78,36,26,26,79,36,26,29,79,38,26,29,80,38,29,29,80,38,29,29,80,38,28,31,81,38,28,31,81,38,31,31,81,37,31,34,82,37,31,34,82,37,31,37,83,40,34,37,83,40,34,37,83,39,33,39,84,39,33,39,84,39,36,42,84,39,36,42,85,39,36,42,85,39,36,42,85,39,39,44,86,39,39,44,86,41,38,47,87,41,41,47,87,41,41,50,87,41,41,49,88,41,41,52,88,40,43,52,89,43,43,52,89,43,43,54,89,42,45,54,90,42,45,57,90,42,45,57,90,42,45,59,91,42,48,59,91,44,47,61,92,44,47,61,92,44,50,61,92,44,49,63,93,44,49,63,93,44,52,66,93,43,52,65,94,46,54,68,94,46,54,70,95,46,54,70,95,46,54,70,95,45,56,72,96,45,56,72,96,45,58,74,97,47,58,76,97,47,58,76,97,47,60,78,98,47,60,78,98,47,60,81,98,49,62,80,99,49,62,82,99,48,61,84,100,48,64,84,100,48,64,84,100,50,63,86,101,50,66,86,101,50,66,88,101,50,65,90,102,52,67,89,103,51,69,91,104,51,68,92,105,52,69,93,107,52,71,94,108,54,70,96,109,53,71,96,111,52,73,98,112,54,72,98,114,53,73,100,115,54,72,100,117,54,73,102,118,55,74,104,120,55,76,105,121,56,77,106,123,56,76,107,124,57,79,107,126,58,78,110,128,57,79,111,129,56,80,113,131,58,79,112,132,57,82,114,134,58,81,116,136,60,82,117,137,59,83,117,139,60,83,119,141,59,84,120,142,60,85,122,144,59,86,122,146,60,86,126,148,62,87,127,149,61,88,127,151,62,88,128,153,63,89,130,155,62,90,131,156,63,90,132,158,64,91,134,160,65,91,135,162,64,92,136,163,63,93,138,165,66,95,139,167,65,95,140,169,66,95,142,171,67,96,142,172,66,97,144,174,67,99,145,176,67,97,148,178,67,99,147,180,68,100,149,181,68,100,150,183,69,101,152,185,70,102,153,187,71,103,155,188,70,103,156,190,70,104,157,192,71,105,158,194,71,106,160,195,72,106,161,197,72,108,161,199,73,108,163,200,73,109,164,202,74,109,165,204,74,110,167,206,75,111,168,207,74,112,170,209,75,112,170,210,76,113,171,212,76,114,173,214,77,115,174,215,78,115,175,217,78,116,175,218,78,117,177,220,78,118,178,221,79,118,180,223,80,120,180,224,81,120,181,226,81,120,182,227,82,121,184,229,82,122,185,230,84,123,186,232,83,123,187,233,84,124,189,234,84,125,188,235,85,126,189,237,86,126,190,238,86,127,191,239,87,127,192,240,87,129,193,242,88,129,194,243,89,130,195,244,90,131,196,245,90,132,197,246,91,132,197,247,92,133,198,248,92,134,199,249,93,135,200,250,94,136,201,251,95,137,202,252,96,138,203,253,97,140,204,254,98,141,205,254,99,142,206,255,101,143,207,255,102,144,208,255,103,146,209,255,104,147,209,255,106,148,210,255,107,149,211,255,108,151,212,255,110,152,213,255,111,153,213,255,112,154,214,255,114,156,215,255,115,157,215,255,117,158,216,255,118,160,217,255,120,161,217,255,121,162,218,255,123,164,218,255,124,165,219,255,125,166,219,255,127,167,220,255,129,169,220,255,130,170,221,255,132,171,221,255,133,173,222,255,134,174,222,255,136,175,223,255,139,178,224,255,142,180,224,255,144,182,225,255,147,185,226,255,150,187,226,255,153,189,227,255,155,191,228,255,158,194,228,255,160,196,229,255,163,198,229,255,165,200,230,255,168,202,231,255,170,203,231,255,172,205,232,255,174,207,232,255,176,209,233,255,178,210,234,255,180,212,234,255,182,214,235,255,184,215,236,255,186,217,237,255,188,219,238,255,190,220,238,255,192,221,239,255,193,222,240,255,194,224,240,255,196,225,241,255,197,226,241,255,198,226,242,255,199,227,242,255,200,228,242,255,201,228,243,255,202,229,243,255,203,230,243,255,204,230,244,255,205,231,244,255,207,232,244,255,208,233,245,255,209,233,245,255,211,234,246,255,213,235,246,255,217,238,247,255,222,240,248,255,226,242,249,255,231,245,250,255,236,247,251,255,241,249,252,255,245,251,253,255,249,252,254,255,255,255,255,255]);function Cc(t,e=0){const r=t.stride;return Array.from(t.fields.keys()).filter(i=>{const s=t.fields.get(i)?.optional;return!(s&&s.glPadding)}).map(i=>{const s=t.fields.get(i),n=s.constructor.ElementCount,o=bQe(s.constructor.ElementType),a=s.offset,l=!(!s.optional||!s.optional.glNormalized);return new _o(i,n,o,a,r,l,e)})}function bQe(t){const e=wQe[t];if(e)return e;throw new Error("BufferType not supported in WebGL")}const wQe={u8:Ke.UNSIGNED_BYTE,u16:Ke.UNSIGNED_SHORT,u32:Ke.UNSIGNED_INT,i8:Ke.BYTE,i16:Ke.SHORT,i32:Ke.INT,f32:Ke.FLOAT};let kX=class{constructor(e,r,i=0,s,n){this.TypedArrayConstructor=e,this.elementCount=9;const o=this.TypedArrayConstructor;s===void 0&&(s=9*o.BYTES_PER_ELEMENT);const a=r.byteLength===0?0:i;this.typedBuffer=n==null?new o(r,a):new o(r,a,(n-i)/o.BYTES_PER_ELEMENT),this.typedBufferStride=s/o.BYTES_PER_ELEMENT,this.count=Math.ceil(this.typedBuffer.length/this.typedBufferStride),this.stride=this.typedBufferStride*this.TypedArrayConstructor.BYTES_PER_ELEMENT}sliceBuffer(e,r,i=this.count-r){const s=this.typedBuffer.byteOffset+r*this.stride;return new e(this.buffer,s,this.stride,s+i*this.stride)}getMat(e,r){let i=e*this.typedBufferStride;for(let s=0;s<9;s++)r[s]=this.typedBuffer[i++];return r}setMat(e,r){let i=e*this.typedBufferStride;for(let s=0;s<9;s++)this.typedBuffer[i++]=r[s]}get(e,r){return this.typedBuffer[e*this.typedBufferStride+r]}set(e,r,i){this.typedBuffer[e*this.typedBufferStride+r]=i}copyFrom(e,r,i){const s=this.typedBuffer,n=r.typedBuffer;let o=e*this.typedBufferStride,a=i*r.typedBufferStride;for(let l=0;l<9;++l)s[o++]=n[a++]}get buffer(){return this.typedBuffer.buffer}};kX.ElementCount=9;let VX=class{constructor(e,r,i=0,s,n){this.TypedArrayConstructor=e,this.elementCount=16;const o=this.TypedArrayConstructor;s===void 0&&(s=16*o.BYTES_PER_ELEMENT);const a=r.byteLength===0?0:i;this.typedBuffer=n==null?new o(r,a):new o(r,a,(n-i)/o.BYTES_PER_ELEMENT),this.typedBufferStride=s/o.BYTES_PER_ELEMENT,this.count=Math.ceil(this.typedBuffer.length/this.typedBufferStride),this.stride=this.typedBufferStride*this.TypedArrayConstructor.BYTES_PER_ELEMENT}sliceBuffer(e,r,i=this.count-r){const s=this.typedBuffer.byteOffset+r*this.stride;return new e(this.buffer,s,this.stride,s+i*this.stride)}getMat(e,r){let i=e*this.typedBufferStride;for(let s=0;s<16;s++)r[s]=this.typedBuffer[i++];return r}setMat(e,r){let i=e*this.typedBufferStride;for(let s=0;s<16;s++)this.typedBuffer[i++]=r[s]}get(e,r){return this.typedBuffer[e*this.typedBufferStride+r]}set(e,r,i){this.typedBuffer[e*this.typedBufferStride+r]=i}copyFrom(e,r,i){const s=this.typedBuffer,n=r.typedBuffer;let o=e*this.typedBufferStride,a=i*r.typedBufferStride;for(let l=0;l<16;++l)s[o++]=n[a++]}get buffer(){return this.typedBuffer.buffer}};VX.ElementCount=16;let ey=class{constructor(e,r,i=0,s,n){this.TypedArrayConstructor=e,this.elementCount=1;const o=this.TypedArrayConstructor;s===void 0&&(s=o.BYTES_PER_ELEMENT);const a=r.byteLength===0?0:i;this.typedBuffer=n==null?new o(r,a):new o(r,a,(n-i)/o.BYTES_PER_ELEMENT),this.stride=s,this.typedBufferStride=s/o.BYTES_PER_ELEMENT,this.count=Math.ceil(this.typedBuffer.length/this.typedBufferStride)}sliceBuffer(e,r,i=this.count-r){const s=this.typedBuffer.byteOffset+r*this.stride;return new e(this.buffer,s,this.stride,s+i*this.stride)}get(e){return this.typedBuffer[e*this.typedBufferStride]}set(e,r){this.typedBuffer[e*this.typedBufferStride]=r}get buffer(){return this.typedBuffer.buffer}};ey.ElementCount=1;let ty=class{constructor(e,r,i=0,s,n){this.TypedArrayConstructor=e,this.elementCount=2;const o=this.TypedArrayConstructor;s===void 0&&(s=2*o.BYTES_PER_ELEMENT);const a=r.byteLength===0?0:i;this.typedBuffer=n==null?new o(r,a):new o(r,a,(n-i)/o.BYTES_PER_ELEMENT),this.typedBufferStride=s/o.BYTES_PER_ELEMENT,this.count=Math.ceil(this.typedBuffer.length/this.typedBufferStride),this.stride=this.typedBufferStride*this.TypedArrayConstructor.BYTES_PER_ELEMENT}sliceBuffer(e,r,i=this.count-r){const s=this.typedBuffer.byteOffset+r*this.stride;return new e(this.buffer,s,this.stride,s+i*this.stride)}getVec(e,r){return e*=this.typedBufferStride,or(r,this.typedBuffer[e],this.typedBuffer[e+1])}setVec(e,r){e*=this.typedBufferStride,this.typedBuffer[e++]=r[0],this.typedBuffer[e]=r[1]}get(e,r){return this.typedBuffer[e*this.typedBufferStride+r]}set(e,r,i){this.typedBuffer[e*this.typedBufferStride+r]=i}setValues(e,r,i){e*=this.typedBufferStride,this.typedBuffer[e++]=r,this.typedBuffer[e]=i}copyFrom(e,r,i){const s=this.typedBuffer,n=r.typedBuffer;let o=e*this.typedBufferStride,a=i*r.typedBufferStride;s[o++]=n[a++],s[o]=n[a]}get buffer(){return this.typedBuffer.buffer}};ty.ElementCount=2;let ry=class{constructor(e,r,i=0,s,n){this.TypedArrayConstructor=e,this.elementCount=3;const o=this.TypedArrayConstructor;s===void 0&&(s=3*o.BYTES_PER_ELEMENT);const a=r.byteLength===0?0:i;this.typedBuffer=n==null?new o(r,a):new o(r,a,(n-i)/o.BYTES_PER_ELEMENT),this.typedBufferStride=s/o.BYTES_PER_ELEMENT,this.count=Math.ceil(this.typedBuffer.length/this.typedBufferStride),this.stride=this.typedBufferStride*this.TypedArrayConstructor.BYTES_PER_ELEMENT}sliceBuffer(e,r,i=this.count-r){const s=this.typedBuffer.byteOffset+r*this.stride;return new e(this.buffer,s,this.stride,s+i*this.stride)}getVec(e,r){return e*=this.typedBufferStride,se(r,this.typedBuffer[e],this.typedBuffer[e+1],this.typedBuffer[e+2])}setVec(e,r){e*=this.typedBufferStride,this.typedBuffer[e++]=r[0],this.typedBuffer[e++]=r[1],this.typedBuffer[e]=r[2]}get(e,r){return this.typedBuffer[e*this.typedBufferStride+r]}set(e,r,i){this.typedBuffer[e*this.typedBufferStride+r]=i}setValues(e,r,i,s){e*=this.typedBufferStride,this.typedBuffer[e++]=r,this.typedBuffer[e++]=i,this.typedBuffer[e]=s}copyFrom(e,r,i){const s=this.typedBuffer,n=r.typedBuffer;let o=e*this.typedBufferStride,a=i*r.typedBufferStride;s[o++]=n[a++],s[o++]=n[a++],s[o]=n[a]}get buffer(){return this.typedBuffer.buffer}};ry.ElementCount=3;let iy=class{constructor(e,r,i=0,s,n){this.TypedArrayConstructor=e,this.start=i,this.elementCount=4;const o=this.TypedArrayConstructor;s===void 0&&(s=4*o.BYTES_PER_ELEMENT);const a=r.byteLength===0?0:i;this.typedBuffer=n==null?new o(r,a):new o(r,a,(n-i)/o.BYTES_PER_ELEMENT),this.typedBufferStride=s/o.BYTES_PER_ELEMENT,this.count=Math.ceil(this.typedBuffer.length/this.typedBufferStride),this.stride=this.typedBufferStride*this.TypedArrayConstructor.BYTES_PER_ELEMENT}sliceBuffer(e,r,i=this.count-r){const s=this.typedBuffer.byteOffset+r*this.stride;return new e(this.buffer,s,this.stride,s+i*this.stride)}getVec(e,r){return e*=this.typedBufferStride,bi(r,this.typedBuffer[e++],this.typedBuffer[e++],this.typedBuffer[e++],this.typedBuffer[e])}setVec(e,r){e*=this.typedBufferStride,this.typedBuffer[e++]=r[0],this.typedBuffer[e++]=r[1],this.typedBuffer[e++]=r[2],this.typedBuffer[e]=r[3]}get(e,r){return this.typedBuffer[e*this.typedBufferStride+r]}set(e,r,i){this.typedBuffer[e*this.typedBufferStride+r]=i}setValues(e,r,i,s,n){e*=this.typedBufferStride,this.typedBuffer[e++]=r,this.typedBuffer[e++]=i,this.typedBuffer[e++]=s,this.typedBuffer[e]=n}copyFrom(e,r,i){const s=this.typedBuffer,n=r.typedBuffer;let o=e*this.typedBufferStride,a=i*r.typedBufferStride;s[o++]=n[a++],s[o++]=n[a++],s[o++]=n[a++],s[o]=n[a]}get buffer(){return this.typedBuffer.buffer}};iy.ElementCount=4;let z5=class dxe extends ey{constructor(e,r=0,i,s){super(Float32Array,e,r,i,s),this.elementType="f32"}static fromTypedArray(e,r){return new dxe(e.buffer,e.byteOffset,r,e.byteOffset+e.byteLength)}};z5.ElementType="f32";let ev=class HG extends ty{constructor(e,r=0,i,s){super(Float32Array,e,r,i,s),this.elementType="f32"}slice(e,r){return this.sliceBuffer(HG,e,r)}static fromTypedArray(e,r){return new HG(e.buffer,e.byteOffset,r,e.byteOffset+e.byteLength)}};ev.ElementType="f32";let dn=class qG extends ry{constructor(e,r=0,i,s){super(Float32Array,e,r,i,s),this.elementType="f32"}slice(e,r){return this.sliceBuffer(qG,e,r)}static fromTypedArray(e,r){return new qG(e.buffer,e.byteOffset,r,e.byteOffset+e.byteLength)}};dn.ElementType="f32";let cp=class WG extends iy{constructor(e,r=0,i,s){super(Float32Array,e,r,i,s),this.elementType="f32"}slice(e,r){return this.sliceBuffer(WG,e,r)}static fromTypedArray(e,r){return new WG(e.buffer,e.byteOffset,r,e.byteOffset+e.byteLength)}};cp.ElementType="f32";let U_=class ZG extends kX{constructor(e,r=0,i,s){super(Float32Array,e,r,i,s),this.elementType="f32"}slice(e,r){return this.sliceBuffer(ZG,e,r)}static fromTypedArray(e,r){return new ZG(e.buffer,e.byteOffset,r,e.byteOffset+e.byteLength)}};U_.ElementType="f32";let zX=class XG extends kX{constructor(e,r=0,i,s){super(Float64Array,e,r,i,s),this.elementType="f64"}slice(e,r){return this.sliceBuffer(XG,e,r)}static fromTypedArray(e,r){return new XG(e.buffer,e.byteOffset,r,e.byteOffset+e.byteLength)}};zX.ElementType="f64";let BX=class YG extends VX{constructor(e,r=0,i,s){super(Float32Array,e,r,i,s),this.elementType="f32"}slice(e,r){return this.sliceBuffer(YG,e,r)}static fromTypedArray(e,r){return new YG(e.buffer,e.byteOffset,r,e.byteOffset+e.byteLength)}};BX.ElementType="f32";let ZO=class JG extends VX{constructor(e,r=0,i,s){super(Float64Array,e,r,i,s),this.elementType="f64"}slice(e,r){return this.sliceBuffer(JG,e,r)}static fromTypedArray(e,r){return new JG(e.buffer,e.byteOffset,r,e.byteOffset+e.byteLength)}};ZO.ElementType="f64";let GX=class QG extends ey{constructor(e,r=0,i,s){super(Float64Array,e,r,i,s),this.elementType="f64"}slice(e,r){return this.sliceBuffer(QG,e,r)}static fromTypedArray(e,r){return new QG(e.buffer,e.byteOffset,r,e.byteOffset+e.byteLength)}};GX.ElementType="f64";let jX=class KG extends ty{constructor(e,r=0,i,s){super(Float64Array,e,r,i,s),this.elementType="f64"}slice(e,r){return this.sliceBuffer(KG,e,r)}static fromTypedArray(e,r){return new KG(e.buffer,e.byteOffset,r,e.byteOffset+e.byteLength)}};jX.ElementType="f64";let Lh=class ej extends ry{constructor(e,r=0,i,s){super(Float64Array,e,r,i,s),this.elementType="f64"}slice(e,r){return this.sliceBuffer(ej,e,r)}static fromTypedArray(e,r){return new ej(e.buffer,e.byteOffset,r,e.byteOffset+e.byteLength)}};Lh.ElementType="f64";let B5=class tj extends iy{constructor(e,r=0,i,s){super(Float64Array,e,r,i,s),this.elementType="f64"}slice(e,r){return this.sliceBuffer(tj,e,r)}static fromTypedArray(e,r){return new tj(e.buffer,e.byteOffset,r,e.byteOffset+e.byteLength)}};B5.ElementType="f64";let C2=class rj extends ey{constructor(e,r=0,i,s){super(Uint8Array,e,r,i,s),this.elementType="u8"}slice(e,r){return this.sliceBuffer(rj,e,r)}static fromTypedArray(e,r){return new rj(e.buffer,e.byteOffset,r,e.byteOffset+e.byteLength)}};C2.ElementType="u8";let G5=class ij extends ty{constructor(e,r=0,i,s){super(Uint8Array,e,r,i,s),this.elementType="u8"}slice(e,r){return this.sliceBuffer(ij,e,r)}static fromTypedArray(e,r){return new ij(e.buffer,e.byteOffset,r,e.byteOffset+e.byteLength)}};G5.ElementType="u8";let j5=class sj extends ry{constructor(e,r=0,i,s){super(Uint8Array,e,r,i,s),this.elementType="u8"}slice(e,r){return this.sliceBuffer(sj,e,r)}static fromTypedArray(e,r){return new sj(e.buffer,e.byteOffset,r,e.byteOffset+e.byteLength)}};j5.ElementType="u8";let ha=class nj extends iy{constructor(e,r=0,i,s){super(Uint8Array,e,r,i,s),this.elementType="u8"}slice(e,r){return this.sliceBuffer(nj,e,r)}static fromTypedArray(e,r){return new nj(e.buffer,e.byteOffset,r,e.byteOffset+e.byteLength)}};ha.ElementType="u8";let H5=class oj extends ey{constructor(e,r=0,i,s){super(Uint16Array,e,r,i,s),this.elementType="u16"}slice(e,r){return this.sliceBuffer(oj,e,r)}static fromTypedArray(e,r){return new oj(e.buffer,e.byteOffset,r,e.byteOffset+e.byteLength)}};H5.ElementType="u16";let HX=class aj extends ty{constructor(e,r=0,i,s){super(Uint16Array,e,r,i,s),this.elementType="u16"}slice(e,r){return this.sliceBuffer(aj,e,r)}static fromTypedArray(e,r){return new aj(e.buffer,e.byteOffset,r,e.byteOffset+e.byteLength)}};HX.ElementType="u16";let q5=class lj extends ry{constructor(e,r=0,i,s){super(Uint16Array,e,r,i,s),this.elementType="u16"}slice(e,r){return this.sliceBuffer(lj,e,r)}static fromTypedArray(e,r){return new lj(e.buffer,e.byteOffset,r,e.byteOffset+e.byteLength)}};q5.ElementType="u16";let QR=class cj extends iy{constructor(e,r=0,i,s){super(Uint16Array,e,r,i,s),this.elementType="u16"}slice(e,r){return this.sliceBuffer(cj,e,r)}static fromTypedArray(e,r){return new cj(e.buffer,e.byteOffset,r,e.byteOffset+e.byteLength)}};QR.ElementType="u16";let W5=class uj extends ey{constructor(e,r=0,i,s){super(Uint32Array,e,r,i,s),this.elementType="u32"}slice(e,r){return this.sliceBuffer(uj,e,r)}static fromTypedArray(e,r){return new uj(e.buffer,e.byteOffset,r,e.byteOffset+e.byteLength)}};W5.ElementType="u32";let qX=class hj extends ty{constructor(e,r=0,i,s){super(Uint32Array,e,r,i,s),this.elementType="u32"}slice(e,r){return this.sliceBuffer(hj,e,r)}static fromTypedArray(e,r){return new hj(e.buffer,e.byteOffset,r,e.byteOffset+e.byteLength)}};qX.ElementType="u32";let pxe=class dj extends ry{constructor(e,r=0,i,s){super(Uint32Array,e,r,i,s),this.elementType="u32"}slice(e,r){return this.sliceBuffer(dj,e,r)}static fromTypedArray(e,r){return new dj(e.buffer,e.byteOffset,r,e.byteOffset+e.byteLength)}};pxe.ElementType="u32";let fxe=class pj extends iy{constructor(e,r=0,i,s){super(Uint32Array,e,r,i,s),this.elementType="u32"}slice(e,r){return this.sliceBuffer(pj,e,r)}static fromTypedArray(e,r){return new pj(e.buffer,e.byteOffset,r,e.byteOffset+e.byteLength)}};fxe.ElementType="u32";let WX=class fj extends ey{constructor(e,r=0,i,s){super(Int8Array,e,r,i,s),this.elementType="i8"}slice(e,r){return this.sliceBuffer(fj,e,r)}static fromTypedArray(e,r){return new fj(e.buffer,e.byteOffset,r,e.byteOffset+e.byteLength)}};WX.ElementType="i8";let Z5=class mj extends ty{constructor(e,r=0,i,s){super(Int8Array,e,r,i,s),this.elementType="i8"}slice(e,r){return this.sliceBuffer(mj,e,r)}static fromTypedArray(e,r){return new mj(e.buffer,e.byteOffset,r,e.byteOffset+e.byteLength)}};Z5.ElementType="i8";let mxe=class gj extends ry{constructor(e,r=0,i,s){super(Int8Array,e,r,i,s),this.elementType="i8"}slice(e,r){return this.sliceBuffer(gj,e,r)}static fromTypedArray(e,r){return new gj(e.buffer,e.byteOffset,r,e.byteOffset+e.byteLength)}};mxe.ElementType="i8";let gxe=class yj extends iy{constructor(e,r=0,i,s){super(Int8Array,e,r,i,s),this.elementType="i8"}slice(e,r){return this.sliceBuffer(yj,e,r)}static fromTypedArray(e,r){return new yj(e.buffer,e.byteOffset,r,e.byteOffset+e.byteLength)}};gxe.ElementType="i8";let yxe=class _j extends ey{constructor(e,r=0,i,s){super(Int16Array,e,r,i,s),this.elementType="i16"}slice(e,r){return this.sliceBuffer(_j,e,r)}static fromTypedArray(e,r){return new _j(e.buffer,e.byteOffset,r,e.byteOffset+e.byteLength)}};yxe.ElementType="i16";let KR=class vj extends ty{constructor(e,r=0,i,s){super(Int16Array,e,r,i,s),this.elementType="i16"}slice(e,r){return this.sliceBuffer(vj,e,r)}static fromTypedArray(e,r){return new vj(e.buffer,e.byteOffset,r,e.byteOffset+e.byteLength)}};KR.ElementType="i16";let _xe=class bj extends ry{constructor(e,r=0,i,s){super(Int16Array,e,r,i,s),this.elementType="i16"}slice(e,r){return this.sliceBuffer(bj,e,r)}static fromTypedArray(e,r){return new bj(e.buffer,e.byteOffset,r,e.byteOffset+e.byteLength)}};_xe.ElementType="i16";let vxe=class wj extends iy{constructor(e,r=0,i,s){super(Int16Array,e,r,i,s),this.elementType="i16"}slice(e,r){return this.sliceBuffer(wj,e,r)}static fromTypedArray(e,r){return new wj(e.buffer,e.byteOffset,r,e.byteOffset+e.byteLength)}};vxe.ElementType="i16";let bxe=class xj extends ey{constructor(e,r=0,i,s){super(Int32Array,e,r,i,s),this.elementType="i32"}slice(e,r){return this.sliceBuffer(xj,e,r)}static fromTypedArray(e,r){return new xj(e.buffer,e.byteOffset,r,e.byteOffset+e.byteLength)}};bxe.ElementType="i32";let wxe=class Tj extends ty{constructor(e,r=0,i,s){super(Int32Array,e,r,i,s),this.elementType="i32"}slice(e,r){return this.sliceBuffer(Tj,e,r)}static fromTypedArray(e,r){return new Tj(e.buffer,e.byteOffset,r,e.byteOffset+e.byteLength)}};wxe.ElementType="i32";let xxe=class Sj extends ry{constructor(e,r=0,i,s){super(Int32Array,e,r,i,s),this.elementType="i32"}slice(e,r){return this.sliceBuffer(Sj,e,r)}static fromTypedArray(e,r){return new Sj(e.buffer,e.byteOffset,r,e.byteOffset+e.byteLength)}};xxe.ElementType="i32";let Txe=class Ej extends iy{constructor(e,r=0,i,s){super(Int32Array,e,r,i,s),this.elementType="i32"}slice(e,r){return this.sliceBuffer(Ej,e,r)}static fromTypedArray(e,r){return new Ej(e.buffer,e.byteOffset,r,e.byteOffset+e.byteLength)}};Txe.ElementType="i32";function Tie(t){switch(t){case"u8":case"i8":return 1;case"u16":case"i16":return 2;case"u32":case"i32":case"f32":return 4;case"f64":return 8}}let Sie=class Sxe{constructor(e,r){this.layout=e,this.buffer=typeof r=="number"?new ArrayBuffer(r*e.stride):r;for(const i of e.fields.keys()){const s=e.fields.get(i);this[i]=new s.constructor(this.buffer,s.offset,this.stride)}}get stride(){return this.layout.stride}get count(){return this.buffer.byteLength/this.stride}get byteLength(){return this.buffer.byteLength}getField(e,r){const i=this[e];return i&&i.elementCount===r.ElementCount&&i.elementType===r.ElementType?i:null}slice(e,r){return new Sxe(this.layout,this.buffer.slice(e*this.stride,r*this.stride))}copyFrom(e,r=0,i=0,s=e.count){const n=this.stride;if(n%4==0){const o=new Uint32Array(e.buffer,r*n,s*n/4);new Uint32Array(this.buffer,i*n,s*n/4).set(o)}else{const o=new Uint8Array(e.buffer,r*n,s*n);new Uint8Array(this.buffer,i*n,s*n).set(o)}return this}},Exe=class Cxe{constructor(e=null){this._stride=0,this._lastAligned=0,this._fields=new Map,e&&(this._stride=e.stride,e.fields.forEach(r=>this._fields.set(r[0],{...r[1],constructor:SQe(r[1].constructor)})))}vec2f(e,r){return this._appendField(e,ev,r),this}vec2f64(e,r){return this._appendField(e,jX,r),this}vec3f(e,r){return this._appendField(e,dn,r),this}vec3f64(e,r){return this._appendField(e,Lh,r),this}vec4f(e,r){return this._appendField(e,cp,r),this}vec4f64(e,r){return this._appendField(e,B5,r),this}mat3f(e,r){return this._appendField(e,U_,r),this}mat3f64(e,r){return this._appendField(e,zX,r),this}mat4f(e,r){return this._appendField(e,BX,r),this}mat4f64(e,r){return this._appendField(e,ZO,r),this}vec4u8(e,r){return this._appendField(e,ha,r),this}f32(e,r){return this._appendField(e,z5,r),this}f64(e,r){return this._appendField(e,GX,r),this}u8(e,r){return this._appendField(e,C2,r),this}u16(e,r){return this._appendField(e,H5,r),this}i8(e,r){return this._appendField(e,WX,r),this}vec2i8(e,r){return this._appendField(e,Z5,r),this}vec2i16(e,r){return this._appendField(e,KR,r),this}vec2u8(e,r){return this._appendField(e,G5,r),this}vec4u16(e,r){return this._appendField(e,QR,r),this}u32(e,r){return this._appendField(e,W5,r),this}_appendField(e,r,i){if(this._fields.has(e))return void et(!1,`${e} already added to vertex buffer layout`);const s=r.ElementCount*Tie(r.ElementType),n=this._stride;this._stride+=s,this._fields.set(e,{size:s,constructor:r,offset:n,optional:i})}createBuffer(e){return new Sie(this,e)}createView(e){return new Sie(this,e)}clone(){const e=new Cxe;return e._stride=this._stride,e._fields=new Map,this._fields.forEach((r,i)=>e._fields.set(i,r)),e.BufferType=this.BufferType,e}get stride(){if(this._lastAligned!==this._fields.size){let e=1;this._fields.forEach(r=>e=Math.max(e,Tie(r.constructor.ElementType))),this._stride=Math.floor((this._stride+e-1)/e)*e,this._lastAligned=this._fields.size}return this._stride}get fields(){return this._fields}};function zi(){return new Exe}let xQe=class{constructor(e){this.fields=new Array,e.fields.forEach((r,i)=>{const s={...r,constructor:Axe(r.constructor)};this.fields.push([i,s])}),this.stride=e.stride}};const TQe=[z5,ev,dn,cp,U_,BX,GX,jX,Lh,B5,zX,ZO,C2,G5,j5,ha,H5,HX,q5,QR,W5,qX,pxe,fxe,WX,Z5,mxe,gxe,yxe,KR,_xe,vxe,bxe,wxe,xxe,Txe];function Axe(t){return`${t.ElementType}_${t.ElementCount}`}function SQe(t){return Oxe.get(t)}const Oxe=new Map;TQe.forEach(t=>Oxe.set(Axe(t),t));function Bo(t,e=!1){return t<=du?e?new Array(t).fill(0):new Array(t):new Float64Array(t)}function Rxe(t){return(ip(t)?t.length:t.byteLength/8)<=du?Array.from(t):new Float64Array(t)}function wh(t,e,r){return Array.isArray(t)?t.slice(e,e+r):t.subarray(e,e+r)}function KPt(t,e){for(let r=0;r<e.length;++r)t[r]=e[r];return t}function eMt(t){return Array.isArray(t)?new Float64Array(t):t}function Yi(t,e=!1){return t<=du?e?new Array(t).fill(0):new Array(t):new Float32Array(t)}function tMt(t){return ip(t)?t.length<du?t:new Float32Array(t):t.length<du?Array.from(t):t}function Eie(t){return(ip(t)?t.length:t.byteLength/8)<=du?Array.from(t):new Float32Array(t)}function a4(t,e,r){return Array.isArray(t)?t.slice(e,e+r):t.subarray(e,e+r)}function If(t){return ip(t)?t.length<du?t:Cie(t):t.length<du?Array.from(t):t.BYTES_PER_ELEMENT===Uint16Array.BYTES_PER_ELEMENT?t:Cie(t)}function Cie(t){let e=!0;for(const r of t){if(r>=65536)return ip(t)?new Uint32Array(t):t;r>=256&&(e=!1)}return e?new Uint8Array(t):new Uint16Array(t)}function l4(t){return t<=du?new Array(t):t<=65536?new Uint16Array(t):new Uint32Array(t)}function EQe(t){return t<=du?new Array(t):new Uint32Array(t)}let lx=(()=>{const t=new Uint32Array(131072);for(let e=0;e<t.length;++e)t[e]=e;return t})();const Pxe=[0],d8=(()=>{const t=new Uint16Array(65536);for(let e=0;e<t.length;++e)t[e]=e;return t})();function A2(t){if(t===1)return Pxe;if(t<du)return Array.from(new Uint16Array(d8.buffer,0,t));if(t<d8.length)return new Uint16Array(d8.buffer,0,t);if(t>lx.length){const e=Math.max(2*lx.length,t);lx=new Uint32Array(e);for(let r=0;r<lx.length;r++)lx[r]=r}return new Uint32Array(lx.buffer,0,t)}let DM=new Uint8Array(65536);function gE(t){if(t===1)return Pxe;if(t<du)return new Array(t).fill(0);if(t>DM.length){const e=Math.max(2*DM.length,t);DM=new Uint8Array(e)}return new Uint8Array(DM.buffer,0,t)}var Cj;(function(t){function e(o,a){const l=o[a],c=o[a+1],h=o[a+2];return Math.sqrt(l*l+c*c+h*h)}function r(o,a){const l=o[a],c=o[a+1],h=o[a+2],p=1/Math.sqrt(l*l+c*c+h*h);o[a]*=p,o[a+1]*=p,o[a+2]*=p}function i(o,a,l){o[a]*=l,o[a+1]*=l,o[a+2]*=l}function s(o,a,l,c,h,p=a){(h=h||o)[p]=o[a]+l[c],h[p+1]=o[a+1]+l[c+1],h[p+2]=o[a+2]+l[c+2]}function n(o,a,l,c,h,p=a){(h=h||o)[p]=o[a]-l[c],h[p+1]=o[a+1]-l[c+1],h[p+2]=o[a+2]-l[c+2]}t.length=e,t.normalize=r,t.scale=i,t.add=s,t.subtract=n})(Cj||(Cj={}));var ss;(function(t){t[t.Layer=0]="Layer",t[t.Object=1]="Object",t[t.Mesh=2]="Mesh",t[t.Line=3]="Line",t[t.Point=4]="Point",t[t.Material=5]="Material",t[t.Texture=6]="Texture",t[t.COUNT=7]="COUNT"})(ss||(ss={}));function CQe(t){if(t.length<du)return Array.from(t);if(ip(t))return Float64Array.from(t);if(!("BYTES_PER_ELEMENT"in t))return Array.from(t);switch(t.BYTES_PER_ELEMENT){case 1:return Uint8Array.from(t);case 2:return cF(t)?Uint16Array.from(t):Int16Array.from(t);case 4:return Float32Array.from(t);default:return Float64Array.from(t)}}let Mxe=class Ixe{constructor(e,r,i,s){this.primitiveIndices=e,this._numIndexPerPrimitive=r,this.indices=i,this.position=s,this._children=void 0,et(e.length>=1),et(i.length%this._numIndexPerPrimitive==0),et(i.length>=e.length*this._numIndexPerPrimitive),et(s.size===3||s.size===4);const{data:n,size:o}=s,a=e.length;let l=o*i[this._numIndexPerPrimitive*e[0]];gv.clear(),gv.push(l);const c=Oe(n[l],n[l+1],n[l+2]),h=$s(c);for(let m=0;m<a;++m){const y=this._numIndexPerPrimitive*e[m];for(let _=0;_<this._numIndexPerPrimitive;++_){l=o*i[y+_],gv.push(l);let v=n[l];c[0]=Math.min(v,c[0]),h[0]=Math.max(v,h[0]),v=n[l+1],c[1]=Math.min(v,c[1]),h[1]=Math.max(v,h[1]),v=n[l+2],c[2]=Math.min(v,c[2]),h[2]=Math.max(v,h[2])}}this.bbMin=c,this.bbMax=h;const p=Br(C(),this.bbMin,this.bbMax,.5);this.radius=.5*Math.max(Math.max(h[0]-c[0],h[1]-c[1]),h[2]-c[2]);let f=this.radius*this.radius;for(let m=0;m<gv.length;++m){l=gv.at(m);const y=n[l]-p[0],_=n[l+1]-p[1],v=n[l+2]-p[2],w=y*y+_*_+v*v;if(w<=f)continue;const x=Math.sqrt(w),T=.5*(x-this.radius);this.radius=this.radius+T,f=this.radius*this.radius;const S=T/x;p[0]+=y*S,p[1]+=_*S,p[2]+=v*S}this.center=p,gv.clear()}getChildren(){if(this._children||yo(this.bbMin,this.bbMax)<=1)return this._children;const e=Br(C(),this.bbMin,this.bbMax,.5),r=this.primitiveIndices.length,i=new Uint8Array(r),s=new Array(8);for(let c=0;c<8;++c)s[c]=0;const{data:n,size:o}=this.position;for(let c=0;c<r;++c){let h=0;const p=this._numIndexPerPrimitive*this.primitiveIndices[c];let f=o*this.indices[p],m=n[f],y=n[f+1],_=n[f+2];for(let v=1;v<this._numIndexPerPrimitive;++v){f=o*this.indices[p+v];const w=n[f],x=n[f+1],T=n[f+2];w<m&&(m=w),x<y&&(y=x),T<_&&(_=T)}m<e[0]&&(h|=1),y<e[1]&&(h|=2),_<e[2]&&(h|=4),i[c]=h,++s[h]}let a=0;for(let c=0;c<8;++c)s[c]>0&&++a;if(a<2)return;const l=new Array(8);for(let c=0;c<8;++c)l[c]=s[c]>0?new Uint32Array(s[c]):void 0;for(let c=0;c<8;++c)s[c]=0;for(let c=0;c<r;++c){const h=i[c];l[h][s[h]++]=this.primitiveIndices[c]}this._children=new Array;for(let c=0;c<8;++c)l[c]!==void 0&&this._children.push(new Ixe(l[c],this._numIndexPerPrimitive,this.indices,this.position));return this._children}static prune(){gv.prune()}};const gv=new kt({deallocator:null});let eP=class{constructor(){this.id=gc()}unload(){}};function AQe(t){return t?{p0:$s(t.p0),p1:$s(t.p1),p2:$s(t.p2)}:{p0:C(),p1:C(),p2:C()}}function Aie(t,e,r){const i=e[0]-t[0],s=e[1]-t[1],n=r[0]-t[0],o=r[1]-t[1];return .5*Math.abs(i*o-s*n)}function OQe(t,e,r){return he(p8,e,t),he(Oie,r,t),Ce(at(p8,p8,Oie))/2}new Xg(dp);new Xg(()=>AQe());const p8=C(),Oie=C();function RQe(t,e,r){if(!t||!e)return!1;const{size:i,data:s}=t;se(r,0,0,0),se(Ku,0,0,0);let n=0,o=0;for(let a=0;a<e.length-2;a+=3){const l=e[a]*i,c=e[a+1]*i,h=e[a+2]*i;se(qn,s[l],s[l+1],s[l+2]),se(cg,s[c],s[c+1],s[c+2]),se(NM,s[h],s[h+1],s[h+2]);const p=OQe(qn,cg,NM);p?(ce(qn,qn,cg),ce(qn,qn,NM),te(qn,qn,1/3*p),ce(r,r,qn),n+=p):(ce(Ku,Ku,qn),ce(Ku,Ku,cg),ce(Ku,Ku,NM),o+=3)}return(o!==0||n!==0)&&(n!==0?(te(r,r,1/n),!0):o!==0&&(te(r,Ku,1/o),!0))}function PQe(t,e,r){if(!t||!e)return!1;const{size:i,data:s}=t;se(r,0,0,0);let n=-1,o=0;for(let a=0;a<e.length;a++){const l=e[a]*i;n!==l&&(r[0]+=s[l],r[1]+=s[l+1],r[2]+=s[l+2],o++),n=l}return o>1&&te(r,r,1/o),o>0}function MQe(t,e,r,i){if(!t)return!1;se(i,0,0,0),se(Ku,0,0,0);let s=0,n=0;const{size:o,data:a}=t,l=e?e.length-1:a.length/o-1,c=l+(r?2:0);for(let h=0;h<c;h+=2){const p=h<l?h:l,f=h<l?h+1:0,m=(e?e[p]:p)*o,y=(e?e[f]:f)*o;qn[0]=a[m],qn[1]=a[m+1],qn[2]=a[m+2],cg[0]=a[y],cg[1]=a[y+1],cg[2]=a[y+2],te(qn,ce(qn,qn,cg),.5);const _=PR(qn,cg);_>0?(ce(i,i,te(qn,qn,_)),s+=_):s===0&&(ce(Ku,Ku,qn),n++)}return s!==0?(te(i,i,1/s),!0):n!==0&&(te(i,Ku,1/n),!0)}const qn=C(),cg=C(),NM=C(),Ku=C();let c4=class{constructor(e){this.channel=e,this.id=gc()}};function Aj(t,e,r){for(let i=0;i<r;++i)e[2*i]=t[i],e[2*i+1]=t[i]-e[2*i]}function IQe(t,e){const r=t.length;for(let i=0;i<r;++i)aS[0]=t[i],e[i]=aS[0];return e}function $Qe(t,e){const r=t.length;for(let i=0;i<r;++i)aS[0]=t[i],aS[1]=t[i]-aS[0],e[i]=aS[1];return e}const aS=new Float32Array(2);function Oj(t,e){return t==null&&(t=[]),t.push(e),t}function Rj(t,e){if(t==null)return null;const r=t.filter(i=>i!==e);return r.length===0?null:r}function LQe(t,e,r,i,s){FM[0]=t.get(e,0),FM[1]=t.get(e,1),FM[2]=t.get(e,2),Aj(FM,yv,3),r.set(s,0,yv[0]),i.set(s,0,yv[1]),r.set(s,1,yv[2]),i.set(s,1,yv[3]),r.set(s,2,yv[4]),i.set(s,2,yv[5])}const FM=C(),yv=new Float32Array(6);let Vs=class $xe extends eP{constructor(e,r,i=[],s=null,n=ss.Mesh,o=null,a=-1){super(),this.material=e,this.mapPositions=s,this.type=n,this.objectAndLayerIdColor=o,this.edgeIndicesLength=a,this.visible=!0,this._vertexAttributes=new Map,this._indices=new Map,this._boundingInfo=null;for(const[l,c]of r)c&&this._vertexAttributes.set(l,{...c});if(i==null||i.length===0){const l=DQe(this._vertexAttributes),c=A2(l);this.edgeIndicesLength=this.edgeIndicesLength<0?l:this.edgeIndicesLength;for(const h of this._vertexAttributes.keys())this._indices.set(h,c)}else for(const[l,c]of i)c&&(this._indices.set(l,If(c)),l===E.POSITION&&(this.edgeIndicesLength=this.edgeIndicesLength<0?this._indices.get(l).length:this.edgeIndicesLength))}instantiate(e={}){const r=new $xe(e.material||this.material,[],void 0,this.mapPositions,this.type,this.objectAndLayerIdColor,this.edgeIndicesLength);return this._vertexAttributes.forEach((i,s)=>{i.exclusive=!1,r._vertexAttributes.set(s,i)}),this._indices.forEach((i,s)=>r._indices.set(s,i)),r._boundingInfo=this._boundingInfo,r.transformation=e.transformation||this.transformation,r}get vertexAttributes(){return this._vertexAttributes}getMutableAttribute(e){let r=this._vertexAttributes.get(e);return r&&!r.exclusive&&(r={...r,exclusive:!0,data:CQe(r.data)},this._vertexAttributes.set(e,r)),r}setAttributeData(e,r){const i=this._vertexAttributes.get(e);i&&this._vertexAttributes.set(e,{...i,exclusive:!0,data:r})}get indices(){return this._indices}get indexCount(){const e=this._indices.values().next().value;return e?e.length:0}get faceCount(){return this.indexCount/3}get boundingInfo(){return this._boundingInfo==null&&(this._boundingInfo=this._calculateBoundingInfo()),this._boundingInfo}computeAttachmentOrigin(e){return!!(this.type===ss.Mesh?this._computeAttachmentOriginTriangles(e):this.type===ss.Line?this._computeAttachmentOriginLines(e):this._computeAttachmentOriginPoints(e))&&(this._transformation!=null&&$e(e,e,this._transformation),!0)}_computeAttachmentOriginTriangles(e){const r=this.indices.get(E.POSITION),i=this.vertexAttributes.get(E.POSITION);return RQe(i,r,e)}_computeAttachmentOriginLines(e){const r=this.vertexAttributes.get(E.POSITION),i=this.indices.get(E.POSITION);return MQe(r,i,i&&NQe(this.material.parameters,r,i),e)}_computeAttachmentOriginPoints(e){const r=this.indices.get(E.POSITION),i=this.vertexAttributes.get(E.POSITION);return PQe(i,r,e)}invalidateBoundingInfo(){this._boundingInfo=null}_calculateBoundingInfo(){const e=this.indices.get(E.POSITION),r=this.vertexAttributes.get(E.POSITION);if(!e||e.length===0||!r)return null;const i=this.type===ss.Mesh?3:1;et(e.length%i==0,"Indexing error: "+e.length+" not divisible by "+i);const s=A2(e.length/i);return new Mxe(s,i,e,r)}get transformation(){return this._transformation??un}set transformation(e){this._transformation=e&&e!==un?y2(e):null}get shaderTransformation(){return this._shaderTransformer!=null?this._shaderTransformer(this.transformation):this.transformation}get shaderTransformer(){return this._shaderTransformer}set shaderTransformer(e){this._shaderTransformer=e}get hasVolatileTransformation(){return this._shaderTransformer!=null}addHighlight(){const e=new c4(zg.Highlight);return this.highlights=Oj(this.highlights,e),e}removeHighlight(e){this.highlights=Rj(this.highlights,e)}};function DQe(t){const e=t.values().next().value;return e==null?0:e.data.length/e.size}function NQe(t,e,r){return!(!("isClosed"in t)||!t.isClosed)&&(r?r.length>2:e.data.length>6)}const cx=Cj,f8=[[-.5,-.5,.5],[.5,-.5,.5],[.5,.5,.5],[-.5,.5,.5],[-.5,-.5,-.5],[.5,-.5,-.5],[.5,.5,-.5],[-.5,.5,-.5]],FQe=[0,0,1,-1,0,0,1,0,0,0,-1,0,0,1,0,0,0,-1],UQe=[0,0,1,0,1,1,0,1],kQe=[0,1,2,2,3,0,4,0,3,3,7,4,1,5,6,6,2,1,1,0,4,4,5,1,3,2,6,6,7,3,5,4,7,7,6,5],Lxe=new Array(36);for(let t=0;t<6;t++)for(let e=0;e<6;e++)Lxe[6*t+e]=t;const D1=new Array(36);for(let t=0;t<6;t++)D1[6*t]=0,D1[6*t+1]=1,D1[6*t+2]=2,D1[6*t+3]=2,D1[6*t+4]=3,D1[6*t+5]=0;function VQe(t,e){Array.isArray(e)||(e=[e,e,e]);const r=new Array(24);for(let i=0;i<8;i++)r[3*i]=f8[i][0]*e[0],r[3*i+1]=f8[i][1]*e[1],r[3*i+2]=f8[i][2]*e[2];return new Vs(t,[[E.POSITION,new ke(r,3,!0)],[E.NORMAL,new ke(FQe,3)],[E.UV0,new ke(UQe,2)]],[[E.POSITION,kQe],[E.NORMAL,Lxe],[E.UV0,D1]])}const m8=[[-.5,0,-.5],[.5,0,-.5],[.5,0,.5],[-.5,0,.5],[0,-.5,0],[0,.5,0]],zQe=[0,1,-1,1,1,0,0,1,1,-1,1,0,0,-1,-1,1,-1,0,0,-1,1,-1,-1,0],BQe=[5,1,0,5,2,1,5,3,2,5,0,3,4,0,1,4,1,2,4,2,3,4,3,0],GQe=[0,0,0,1,1,1,2,2,2,3,3,3,4,4,4,5,5,5,6,6,6,7,7,7];function jQe(t,e){Array.isArray(e)||(e=[e,e,e]);const r=new Array(18);for(let i=0;i<6;i++)r[3*i]=m8[i][0]*e[0],r[3*i+1]=m8[i][1]*e[1],r[3*i+2]=m8[i][2]*e[2];return new Vs(t,[[E.POSITION,new ke(r,3,!0)],[E.NORMAL,new ke(zQe,3)]],[[E.POSITION,BQe],[E.NORMAL,GQe]])}const JL=Xr(-.5,0,-.5),QL=Xr(.5,0,-.5),KL=Xr(0,0,.5),eD=Xr(0,.5,0),ux=Hi(),hx=Hi(),DS=Hi(),NS=Hi(),FS=Hi();he(ux,JL,eD),he(hx,JL,QL),at(DS,ux,hx),me(DS,DS),he(ux,QL,eD),he(hx,QL,KL),at(NS,ux,hx),me(NS,NS),he(ux,KL,eD),he(hx,KL,JL),at(FS,ux,hx),me(FS,FS);const g8=[JL,QL,KL,eD],HQe=[0,-1,0,DS[0],DS[1],DS[2],NS[0],NS[1],NS[2],FS[0],FS[1],FS[2]],qQe=[0,1,2,3,1,0,3,2,1,3,0,2],WQe=[0,0,0,1,1,1,2,2,2,3,3,3];function ZQe(t,e){Array.isArray(e)||(e=[e,e,e]);const r=new Array(12);for(let i=0;i<4;i++)r[3*i]=g8[i][0]*e[0],r[3*i+1]=g8[i][1]*e[1],r[3*i+2]=g8[i][2]*e[2];return new Vs(t,[[E.POSITION,new ke(r,3,!0)],[E.NORMAL,new ke(HQe,3)]],[[E.POSITION,qQe],[E.NORMAL,WQe]])}function sMt(t,e,r,i,s={uv:!0}){const n=-Math.PI,o=2*Math.PI,a=-Math.PI/2,l=Math.PI,c=Math.max(3,Math.floor(r)),h=Math.max(2,Math.floor(i)),p=(c+1)*(h+1),f=Yi(3*p),m=Yi(3*p),y=Yi(2*p),_=[];let v=0;for(let S=0;S<=h;S++){const O=[],A=S/h,I=a+A*l,M=Math.cos(I);for(let k=0;k<=c;k++){const L=k/c,D=n+L*o,U=Math.cos(D)*M,X=Math.sin(I),W=-Math.sin(D)*M;f[3*v]=U*e,f[3*v+1]=X*e,f[3*v+2]=W*e,m[3*v]=U,m[3*v+1]=X,m[3*v+2]=W,y[2*v]=L,y[2*v+1]=A,O.push(v),++v}_.push(O)}const w=new Array;for(let S=0;S<h;S++)for(let O=0;O<c;O++){const A=_[S][O],I=_[S][O+1],M=_[S+1][O+1],k=_[S+1][O];S===0?(w.push(A),w.push(M),w.push(k)):S===h-1?(w.push(A),w.push(I),w.push(M)):(w.push(A),w.push(I),w.push(M),w.push(M),w.push(k),w.push(A))}const x=[[E.POSITION,w],[E.NORMAL,w]],T=[[E.POSITION,new ke(f,3,!0)],[E.NORMAL,new ke(m,3,!0)]];return s.uv&&(T.push([E.UV0,new ke(y,2,!0)]),x.push([E.UV0,w])),s.offset&&(x[0][0]=E.OFFSET,T[0][0]=E.OFFSET,x.push([E.POSITION,gE(w.length)]),T.push([E.POSITION,new ke(Float64Array.from(s.offset),3,!0)])),new Vs(t,T,x)}function XQe(t,e,r,i){const{vertexAttributes:s,indices:n}=Dxe(e,r,i);return new Vs(t,s,n)}function Dxe(t,e,r){const i=t;let s,n;if(r)s=[0,-1,0,1,0,0,0,0,1,-1,0,0,0,0,-1,0,1,0],n=[0,1,2,0,2,3,0,3,4,0,4,1,1,5,2,2,5,3,3,5,4,4,5,1];else{const h=i*(1+Math.sqrt(5))/2;s=[-i,h,0,i,h,0,-i,-h,0,i,-h,0,0,-i,h,0,i,h,0,-i,-h,0,i,-h,h,0,-i,h,0,i,-h,0,-i,-h,0,i],n=[0,11,5,0,5,1,0,1,7,0,7,10,0,10,11,1,5,9,5,11,4,11,10,2,10,7,6,7,1,8,3,9,4,3,4,2,3,2,6,3,6,8,3,8,9,4,9,5,2,4,11,6,2,10,8,6,7,9,8,1]}for(let h=0;h<s.length;h+=3)cx.scale(s,h,t/cx.length(s,h));let o={};function a(h,p){h>p&&([h,p]=[p,h]);const f=h.toString()+"."+p.toString();if(o[f])return o[f];let m=s.length;return s.length+=3,cx.add(s,3*h,s,3*p,s,m),cx.scale(s,m,t/cx.length(s,m)),m/=3,o[f]=m,m}for(let h=0;h<e;h++){const p=n.length,f=new Array(4*p);for(let m=0;m<p;m+=3){const y=n[m],_=n[m+1],v=n[m+2],w=a(y,_),x=a(_,v),T=a(v,y),S=4*m;f[S]=y,f[S+1]=w,f[S+2]=T,f[S+3]=_,f[S+4]=x,f[S+5]=w,f[S+6]=v,f[S+7]=T,f[S+8]=x,f[S+9]=w,f[S+10]=x,f[S+11]=T}n=f,o={}}const l=Eie(s);for(let h=0;h<l.length;h+=3)cx.normalize(l,h);const c=[[E.POSITION,n],[E.NORMAL,n]];return{vertexAttributes:[[E.POSITION,new ke(Eie(s),3,!0)],[E.NORMAL,new ke(l,3,!0)]],indices:c}}function Pj(t,e,r,i,s,n,o,a,l=null){const c=r?[r[0],r[1],r[2]]:[0,0,0],h=e?[e[0],e[1],e[2]]:[0,0,1];o=o||[0,0];const p=i?[255*i[0],255*i[1],255*i[2],i.length>3?255*i[3]:255]:[255,255,255,255],f=s!=null&&s.length===2?s:[1,1],m=[[E.POSITION,new ke(c,3,!0)],[E.NORMAL,new ke(h,3,!0)],[E.UV0,new ke(o,o.length)],[E.COLOR,new ke(p,4,!0)],[E.SIZE,new ke(f,2)]];if(n!=null){const y=[n[0],n[1],n[2],n[3]];m.push([E.AUXPOS1,new ke(y,4)])}if(a!=null){const y=[a[0],a[1],a[2],a[3]];m.push([E.AUXPOS2,new ke(y,4)])}return new Vs(t,m,null,null,ss.Point,l)}const YQe=[[-1,-1,0],[1,-1,0],[1,1,0],[-1,1,0]];function nMt(t,e=YQe){const r=new Array(12);for(let h=0;h<4;h++)for(let p=0;p<3;p++)r[3*h+p]=e[h][p];const i=[0,1,2,2,3,0],s=[0,0,1],n=[0,0,0,0,0,0],o=[0,0,1,0,1,1,0,1],a=[255,255,255,255],l=[[E.POSITION,i],[E.NORMAL,n],[E.UV0,i],[E.COLOR,n]],c=[[E.POSITION,new ke(r,3,!0)],[E.NORMAL,new ke(s,3,!0)],[E.UV0,new ke(o,2,!0)],[E.COLOR,new ke(a,4,!0)]];return new Vs(t,c,l)}function Rie(t,e,r,i,s,n=!0,o=!0){let a=0;const l=r,c=e;let h=Xr(0,a,0),p=Xr(0,a+c,0),f=Xr(0,-1,0),m=Xr(0,1,0);s&&(a=c,p=Xr(0,0,0),h=Xr(0,a,0),f=Xr(0,1,0),m=Xr(0,-1,0));const y=[p,h],_=[f,m],v=i+2,w=Math.sqrt(c*c+l*l);if(s)for(let M=i-1;M>=0;M--){const k=M*(2*Math.PI/i),L=Xr(Math.cos(k)*l,a,Math.sin(k)*l);y.push(L);const D=Xr(c*Math.cos(k)/w,-l/w,c*Math.sin(k)/w);_.push(D)}else for(let M=0;M<i;M++){const k=M*(2*Math.PI/i),L=Xr(Math.cos(k)*l,a,Math.sin(k)*l);y.push(L);const D=Xr(c*Math.cos(k)/w,l/w,c*Math.sin(k)/w);_.push(D)}const x=new Array,T=new Array;if(n){for(let M=3;M<y.length;M++)x.push(1),x.push(M-1),x.push(M),T.push(0),T.push(0),T.push(0);x.push(y.length-1),x.push(2),x.push(1),T.push(0),T.push(0),T.push(0)}if(o){for(let M=3;M<y.length;M++)x.push(M),x.push(M-1),x.push(0),T.push(M),T.push(M-1),T.push(1);x.push(0),x.push(2),x.push(y.length-1),T.push(1),T.push(2),T.push(_.length-1)}const S=Yi(3*v);for(let M=0;M<v;M++)S[3*M]=y[M][0],S[3*M+1]=y[M][1],S[3*M+2]=y[M][2];const O=Yi(3*v);for(let M=0;M<v;M++)O[3*M]=_[M][0],O[3*M+1]=_[M][1],O[3*M+2]=_[M][2];const A=[[E.POSITION,x],[E.NORMAL,T]],I=[[E.POSITION,new ke(S,3,!0)],[E.NORMAL,new ke(O,3,!0)]];return new Vs(t,I,A)}function JQe(t,e,r,i,s,n,o){const a=s?ZN(s):Xr(1,0,0),l=n?ZN(n):Xr(0,0,0);o??(o=!0);const c=Hi();me(c,a);const h=Hi();te(h,c,Math.abs(e));const p=Hi();te(p,h,-.5),ce(p,p,l);const f=Xr(0,1,0);Math.abs(1-fe(c,f))<.2&&se(f,0,0,1);const m=Hi();at(m,c,f),me(m,m),at(f,m,c);const y=2*i+(o?2:0),_=i+(o?2:0),v=Yi(3*y),w=Yi(3*_),x=Yi(2*y),T=new Array(3*i*(o?4:2)),S=new Array(3*i*(o?4:2));o&&(v[3*(y-2)]=p[0],v[3*(y-2)+1]=p[1],v[3*(y-2)+2]=p[2],x[2*(y-2)]=0,x[2*(y-2)+1]=0,v[3*(y-1)]=v[3*(y-2)]+h[0],v[3*(y-1)+1]=v[3*(y-2)+1]+h[1],v[3*(y-1)+2]=v[3*(y-2)+2]+h[2],x[2*(y-1)]=1,x[2*(y-1)+1]=1,w[3*(_-2)]=-c[0],w[3*(_-2)+1]=-c[1],w[3*(_-2)+2]=-c[2],w[3*(_-1)]=c[0],w[3*(_-1)+1]=c[1],w[3*(_-1)+2]=c[2]);const O=(D,U,X)=>{T[D]=U,S[D]=X};let A=0;const I=Hi(),M=Hi();for(let D=0;D<i;D++){const U=D*(2*Math.PI/i);te(I,f,Math.sin(U)),te(M,m,Math.cos(U)),ce(I,I,M),w[3*D]=I[0],w[3*D+1]=I[1],w[3*D+2]=I[2],te(I,I,r),ce(I,I,p),v[3*D]=I[0],v[3*D+1]=I[1],v[3*D+2]=I[2],x[2*D]=D/i,x[2*D+1]=0,v[3*(D+i)]=v[3*D]+h[0],v[3*(D+i)+1]=v[3*D+1]+h[1],v[3*(D+i)+2]=v[3*D+2]+h[2],x[2*(D+i)]=D/i,x[2*D+1]=1;const X=(D+1)%i;O(A++,D,D),O(A++,D+i,D),O(A++,X,X),O(A++,X,X),O(A++,D+i,D),O(A++,X+i,X)}if(o){for(let D=0;D<i;D++){const U=(D+1)%i;O(A++,y-2,_-2),O(A++,D,_-2),O(A++,U,_-2)}for(let D=0;D<i;D++){const U=(D+1)%i;O(A++,D+i,_-1),O(A++,y-1,_-1),O(A++,U+i,_-1)}}const k=[[E.POSITION,T],[E.NORMAL,S],[E.UV0,T]],L=[[E.POSITION,new ke(v,3,!0)],[E.NORMAL,new ke(w,3,!0)],[E.UV0,new ke(x,2,!0)]];return new Vs(t,L,k)}function oMt(t,e,r,i,s,n){i=i||10,s=s==null||s,et(e.length>1);const o=[[0,0,0]],a=[],l=[];for(let c=0;c<i;c++){a.push([0,-c-1,-(c+1)%i-1]);const h=c/i*2*Math.PI;l.push([Math.cos(h)*r,Math.sin(h)*r])}return QQe(t,l,e,o,a,s,n)}function QQe(t,e,r,i,s,n,o=Xr(0,0,0)){const a=e.length,l=Yi(r.length*a*3+(6*i.length||0)),c=Yi(r.length*a*3+(i?6:0)),h=new Array,p=new Array;let f=0,m=0;const y=Hi(),_=Hi(),v=Hi(),w=Hi(),x=Hi(),T=Hi(),S=Hi(),O=C(),A=Hi(),I=Hi(),M=Hi(),k=Hi(),L=Hi(),D=Ir();se(A,0,1,0),he(_,r[1],r[0]),me(_,_),n?(ce(O,r[0],o),me(v,O)):se(v,0,0,1),u4(_,v,A,A,x,v,Pie),ie(w,v),ie(k,x);for(let z=0;z<i.length;z++)te(T,x,i[z][0]),te(O,v,i[z][2]),ce(T,T,O),ce(T,T,r[0]),l[f++]=T[0],l[f++]=T[1],l[f++]=T[2];c[m++]=-_[0],c[m++]=-_[1],c[m++]=-_[2];for(let z=0;z<s.length;z++)h.push(s[z][0]>0?s[z][0]:-s[z][0]-1+i.length),h.push(s[z][1]>0?s[z][1]:-s[z][1]-1+i.length),h.push(s[z][2]>0?s[z][2]:-s[z][2]-1+i.length),p.push(0),p.push(0),p.push(0);let U=i.length;const X=i.length-1;for(let z=0;z<r.length;z++){let H=!1;z>0&&(ie(y,_),z<r.length-1?(he(_,r[z+1],r[z]),me(_,_)):H=!0,ce(I,y,_),me(I,I),ce(M,r[z-1],w),ZR(r[z],I,D),Fw(D,yu(M,y),O)?(he(O,O,r[z]),me(v,O),at(x,I,v),me(x,x)):u4(I,w,k,A,x,v,Pie),ie(w,v),ie(k,x)),n&&(ce(O,r[z],o),me(L,O));for(let Z=0;Z<a;Z++)if(te(T,x,e[Z][0]),te(O,v,e[Z][1]),ce(T,T,O),me(S,T),c[m++]=S[0],c[m++]=S[1],c[m++]=S[2],ce(T,T,r[z]),l[f++]=T[0],l[f++]=T[1],l[f++]=T[2],!H){const J=(Z+1)%a;h.push(U+Z),h.push(U+a+Z),h.push(U+J),h.push(U+J),h.push(U+a+Z),h.push(U+a+J);for(let re=0;re<6;re++){const ye=h.length-6;p.push(h[ye+re]-X)}}U+=a}const W=r[r.length-1];for(let z=0;z<i.length;z++)te(T,x,i[z][0]),te(O,v,i[z][1]),ce(T,T,O),ce(T,T,W),l[f++]=T[0],l[f++]=T[1],l[f++]=T[2];const G=m/3;c[m++]=_[0],c[m++]=_[1],c[m++]=_[2];const Y=U-a;for(let z=0;z<s.length;z++)h.push(s[z][0]>=0?U+s[z][0]:-s[z][0]-1+Y),h.push(s[z][2]>=0?U+s[z][2]:-s[z][2]-1+Y),h.push(s[z][1]>=0?U+s[z][1]:-s[z][1]-1+Y),p.push(G),p.push(G),p.push(G);const P=[[E.POSITION,h],[E.NORMAL,p]],V=[[E.POSITION,new ke(l,3,!0)],[E.NORMAL,new ke(c,3,!0)]];return new Vs(t,V,P)}function aMt(t,e,r,i){et(e.length>1,"createPolylineGeometry(): polyline needs at least 2 points"),et(e[0].length===3,"createPolylineGeometry(): malformed vertex"),et(r==null||r.length===e.length,"createPolylineGeometry: need same number of points and normals"),et(r==null||r[0].length===3,"createPolylineGeometry(): malformed normal");const s=Bo(3*e.length),n=new Array(2*(e.length-1));let o=0,a=0;for(let h=0;h<e.length;h++){for(let p=0;p<3;p++)s[o++]=e[h][p];h>0&&(n[a++]=h-1,n[a++]=h)}const l=[],c=[];if(l.push([E.POSITION,n]),c.push([E.POSITION,new ke(s,3,!0)]),r){const h=Yi(3*r.length);let p=0;for(let f=0;f<e.length;f++)for(let m=0;m<3;m++)h[p++]=r[f][m];l.push([E.NORMAL,n]),c.push([E.NORMAL,new ke(h,3,!0)])}return i&&(c.push([E.COLOR,new ke(i,4)]),l.push([E.COLOR,A2(i.length/4)])),new Vs(t,c,l,null,ss.Line)}function lMt(t,e,r,i,s,n=0){const o=new Array(18),a=[[-r,n,s/2],[i,n,s/2],[0,e+n,s/2],[-r,n,-s/2],[i,n,-s/2],[0,e+n,-s/2]],l=[0,1,2,3,0,2,2,5,3,1,4,5,5,2,1,1,0,3,3,4,1,4,3,5];for(let c=0;c<6;c++)o[3*c]=a[c][0],o[3*c+1]=a[c][1],o[3*c+2]=a[c][2];return new Vs(t,[[E.POSITION,new ke(o,3,!0)]],[[E.POSITION,l]])}function cMt(t,e){const r=t.getMutableAttribute(E.POSITION).data;for(let i=0;i<r.length;i+=3){const s=r[i],n=r[i+1],o=r[i+2];se(dx,s,n,o),$e(dx,dx,e),r[i]=dx[0],r[i+1]=dx[1],r[i+2]=dx[2]}}function KQe(t,e=t){const r=t.vertexAttributes,i=r.get(E.POSITION).data,s=r.get(E.NORMAL).data;if(s){const n=e.getMutableAttribute(E.NORMAL).data;for(let o=0;o<s.length;o+=3){const a=s[o+1];n[o+1]=-s[o+2],n[o+2]=a}}if(i){const n=e.getMutableAttribute(E.POSITION).data;for(let o=0;o<i.length;o+=3){const a=i[o+1];n[o+1]=-i[o+2],n[o+2]=a}}}function y8(t,e,r,i,s){return!(Math.abs(fe(e,t))>s)&&(at(r,t,e),me(r,r),at(i,r,t),me(i,i),!0)}function u4(t,e,r,i,s,n,o){return y8(t,e,s,n,o)||y8(t,r,s,n,o)||y8(t,i,s,n,o)}const Pie=.99619469809,dx=Hi();let eKe=class{constructor(e,r){this.type=ea.Local,this._configuration=new FX,this._passParameters=new UX,this._configuration.geometry=Hf.Cylinder,this._technique=r.techniqueRepository.acquire(o4,this._configuration);const i=r.renderContext.rctx;this._vao=this._createVertexArrayObject(i),this._vaoCount=Fo(this._vao,"geometry");const s=new vr;s.wrapMode=$t.CLAMP_TO_EDGE,s.flipped=!0,s.width=1,s.height=512,this._passParameters.texture=new Et(i,s,vQe)}destroy(){this._passParameters.texture=Ue(this._passParameters.texture),this._vao.dispose(),this._technique.release()}render(e){const r=e.rctx,i=r.bindTechnique(this._technique,this._passParameters,e.bindParameters);tKe(Mie,e.bindParameters.camera.viewMatrix),i.setUniformMatrix4fv("view",Mie),r.bindVAO(this._vao),i.assertCompatibleVertexAttributeLocations(this._vao),r.drawArrays(St.TRIANGLES,0,this._vaoCount)}renderHaze(){return!1}_createVertexArrayObject(e){const r=Dxe(1,2,!1),i=r.indices[0][1],s=r.vertexAttributes[0][1];for(let l=0;l<i.length;l+=3){const c=i[l];i[l]=i[l+2],i[l+2]=c}const n=s.data,o=Iie.createBuffer(i.length),a=o.position;for(let l=0;l<i.length;++l){const c=3*i[l];a.set(l,0,n[c]),a.set(l,1,n[c+1]),a.set(l,2,n[c+2])}return new pp(e,br,{geometry:Cc(Iie)},{geometry:Lr.createVertex(e,Tr.STATIC_DRAW,o.buffer)})}};function tKe(t,e){Ls(t,e),t[12]=0,t[13]=0,t[14]=0,t[15]=1}const Mie=be(),Iie=zi().vec3f(E.POSITION),rKe=new Uint8ClampedArray([0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,2,0,0,0,2,0,0,0,2,0,0,0,2,0,0,0,3,0,0,0,3,0,0,0,3,0,0,0,4,0,0,0,4,0,0,0,4,0,0,0,5,0,0,0,5,0,0,0,5,0,0,0,5,0,0,0,5,0,0,0,5,0,0,0,5,0,0,0,6,0,0,0,6,0,0,0,7,0,0,0,7,0,0,0,7,0,0,0,8,0,0,0,8,0,0,0,8,0,0,0,9,0,0,0,9,0,0,0,9,0,0,0,10,0,0,0,10,0,0,0,11,0,0,0,11,0,0,0,11,0,0,0,12,0,0,0,12,0,0,0,12,0,0,0,13,0,0,0,13,0,0,0,14,0,0,0,14,0,0,0,14,0,0,0,14,0,0,0,14,0,0,0,15,0,0,0,15,0,0,0,16,0,0,0,16,0,0,0,16,0,0,0,17,0,0,0,17,0,0,0,18,0,0,0,18,0,0,0,19,0,0,0,19,0,0,0,19,0,0,0,20,0,0,0,20,0,0,0,21,0,0,0,21,0,0,0,22,0,0,0,22,11,0,0,23,11,0,0,23,11,0,0,23,11,0,0,23,11,0,0,24,11,0,0,24,11,0,0,24,10,0,0,25,10,0,0,25,10,0,0,26,10,0,0,26,9,0,0,27,9,0,0,27,9,0,0,28,9,0,0,28,9,0,0,29,9,0,0,29,8,0,0,30,8,0,0,30,8,0,0,31,8,0,0,31,8,0,0,32,8,0,0,32,8,0,0,32,8,0,0,32,8,0,0,33,8,0,0,33,8,0,0,34,7,0,0,35,7,0,0,35,7,0,0,36,7,0,0,36,7,7,0,37,7,7,0,37,7,7,0,38,7,7,0,38,13,7,0,39,13,7,0,39,13,6,0,40,13,6,0,40,12,6,0,41,12,6,0,41,12,6,0,41,12,6,0,42,12,6,0,42,12,6,0,43,12,6,0,43,12,6,0,44,12,6,0,44,11,6,0,45,11,6,6,45,11,6,6,46,11,5,5,47,11,5,5,47,11,5,5,48,11,5,5,48,10,5,5,49,10,5,5,49,10,5,5,50,15,5,5,51,15,5,5,51,15,5,5,51,15,5,5,51,15,5,5,52,15,5,5,52,14,5,5,53,14,5,5,54,14,5,5,54,14,5,5,55,14,5,5,55,14,5,5,56,13,4,4,57,13,4,4,57,13,4,4,58,13,4,4,58,13,4,4,59,13,4,4,59,17,4,4,60,17,4,4,60,17,4,4,60,17,4,4,61,17,4,4,61,16,4,4,62,16,4,4,63,16,4,4,63,16,8,4,64,16,8,4,64,16,8,4,65,15,8,4,66,15,8,4,66,15,8,4,67,19,8,4,68,19,8,4,68,18,7,4,69,18,7,4,69,18,7,4,69,18,7,4,70,18,7,4,70,18,7,4,71,18,7,4,71,18,7,4,72,17,7,3,73,17,7,3,73,21,7,3,74,21,7,3,74,20,7,3,75,20,7,3,76,20,7,3,76,20,7,3,77,20,7,3,77,20,7,3,78,20,7,3,78,20,7,7,78,19,6,6,79,19,10,6,80,19,10,6,80,22,9,6,81,22,9,6,81,22,9,6,82,22,9,6,83,22,9,6,83,21,9,6,84,21,9,6,84,21,9,6,85,21,9,6,86,21,9,6,86,23,9,6,87,23,9,6,87,23,9,6,87,23,9,6,88,23,9,6,88,23,9,6,89,23,8,6,90,23,8,6,90,22,8,6,91,22,8,6,91,25,8,6,92,25,8,5,93,25,8,5,93,24,8,5,94,24,8,5,94,24,11,5,95,24,11,5,96,24,11,5,96,26,11,5,97,26,11,5,97,26,11,5,97,26,10,5,98,26,10,5,98,26,10,5,99,25,10,5,100,25,10,5,100,25,10,5,101,25,10,5,101,25,10,5,102,27,10,5,103,27,10,5,103,27,10,5,104,27,10,5,104,27,12,5,105,26,12,5,106,26,12,5,106,29,12,5,106,29,12,5,106,29,12,7,107,28,12,7,108,28,12,7,108,28,12,7,109,28,12,7,109,30,12,7,110,30,11,7,111,30,11,7,111,30,11,7,112,30,11,7,112,29,11,7,113,29,11,7,114,29,11,7,114,31,11,7,115,31,11,7,115,31,11,7,115,31,11,7,116,31,11,7,116,33,13,7,117,33,13,9,117,32,13,9,118,32,13,9,118,32,13,9,119,34,15,8,120,34,15,8,120,34,15,8,121,36,15,8,121,36,15,8,122,36,15,8,122,35,15,8,123,37,14,8,124,37,14,8,124,37,14,8,124,37,14,8,124,39,14,8,125,39,16,8,125,38,16,8,126,38,16,8,127,38,16,8,127,40,16,10,128,40,16,10,128,40,16,10,129,42,18,10,129,41,18,10,130,41,18,10,130,43,18,10,131,43,18,10,131,42,17,10,132,42,17,12,132,42,17,12,133,44,17,12,133,44,17,12,133,46,17,11,134,46,17,11,134,45,19,11,135,45,19,11,135,47,19,11,136,47,19,11,136,47,19,11,137,47,19,11,137,48,20,11,138,48,20,11,138,50,20,13,139,50,20,13,139,49,20,13,140,49,22,13,140,51,22,13,141,51,22,13,141,50,22,13,142,52,22,13,142,52,21,12,143,53,21,12,143,53,21,12,143,53,21,12,143,53,21,14,144,53,23,14,144,55,23,14,145,55,23,14,145,56,23,14,146,56,23,14,146,57,24,14,147,57,24,14,147,59,24,16,148,59,24,16,148,58,24,15,149,58,26,15,149,58,26,15,149,60,26,15,150,60,26,15,150,61,25,15,151,61,25,15,151,62,25,17,152,62,25,17,152,64,25,17,152,64,27,17,152,63,27,17,153,63,27,17,153,65,27,17,153,66,28,17,154,66,28,17,154,67,28,16,155,67,28,16,155,67,30,16,155,69,29,18,156,69,29,18,156,68,29,18,157,70,29,18,157,70,29,18,157,71,31,18,158,71,31,18,158,72,30,19,159,72,30,19,159,74,30,19,159,73,30,19,160,73,32,19,160,74,32,19,161,74,32,21,161,76,32,21,161,78,33,21,161,78,33,21,161,79,35,20,162,78,34,20,163,79,34,22,164,81,36,22,164,82,36,22,165,81,35,22,166,82,37,21,167,84,37,21,167,85,36,21,168,86,38,23,169,88,38,23,169,88,38,23,170,88,39,23,170,89,39,24,171,91,40,24,171,92,40,24,172,93,40,24,173,94,41,25,173,95,41,25,174,96,42,25,175,98,42,25,175,99,43,26,176,99,43,26,177,101,45,26,177,102,44,26,178,103,46,27,179,104,46,27,179,105,46,27,179,106,45,28,180,108,47,28,180,108,46,28,181,109,48,28,182,111,48,29,182,111,49,29,183,114,49,29,184,114,50,30,184,114,50,30,185,116,51,30,185,117,51,30,186,119,52,31,187,119,53,31,187,121,53,31,188,122,54,33,188,123,54,32,189,124,55,32,189,125,55,32,189,126,56,34,190,128,56,34,190,128,57,33,191,130,57,33,191,131,58,35,192,131,58,35,192,133,59,34,193,134,60,35,194,135,60,35,194,136,61,37,195,139,61,37,195,139,62,36,196,141,62,36,196,141,63,38,197,142,63,38,197,143,64,39,198,144,64,39,198,146,66,39,198,146,67,39,198,147,67,38,199,147,68,40,199,149,68,40,200,150,69,40,200,152,70,41,201,154,71,41,201,154,71,42,202,155,72,42,202,156,73,41,203,157,73,43,203,158,74,42,204,160,75,44,204,161,76,44,204,162,77,44,205,164,77,45,205,165,78,45,206,166,79,45,206,168,80,46,207,169,81,46,207,170,83,47,207,171,83,47,207,172,83,47,207,174,85,48,208,175,85,48,208,177,85,48,209,178,87,49,209,180,87,49,210,181,87,49,210,182,89,50,210,182,89,50,211,185,91,50,211,186,91,51,212,186,93,51,212,189,94,52,212,190,95,51,213,192,96,51,213,193,96,53,213,194,97,52,214,195,98,54,214,197,98,55,215,198,100,55,215,199,101,55,215,200,102,55,216,202,103,55,216,203,104,55,216,204,105,57,216,205,106,57,216,207,107,58,216,208,108,58,217,209,109,59,217,210,110,60,217,211,111,60,218,212,112,61,218,213,113,61,218,214,114,62,219,217,115,63,219,217,116,64,219,218,118,64,220,219,119,65,220,220,121,66,220,222,121,67,221,222,122,67,221,222,123,68,221,223,124,69,222,224,125,70,222,225,127,71,222,226,128,72,223,228,129,73,223,228,130,74,223,229,132,75,223,230,135,79,224,231,138,81,224,233,141,84,224,233,144,87,225,235,147,91,225,236,150,94,225,237,154,97,225,238,158,102,225,239,161,107,225,239,165,110,225,240,168,114,226,241,172,118,226,241,176,122,226,241,181,126,226,242,183,130,227,243,186,135,227,243,190,139,227,244,194,143,227,244,197,147,228,244,200,150,228,245,204,154,228,245,207,157,228,245,210,161,229,246,212,164,229,246,215,167,229,246,217,169,229,246,220,172,230,247,221,174,230]),UM=128,$ie=-DG,Lie=0,_8=50,iKe=()=>1-511/512,sKe=kL([[50,.1015625],[500,.21875],[5e3,1-250/512],[5e4,.4140625]]);let nKe=class{constructor(e,r){this.view=e,this.type=ea.Mars,this._passParameters=new UX,this._vaoCount=0,this._texV1=1;const i=Nr(e.spatialReference);this._planetRadius=i.radius,this._outerRimWidth=i.outerAtmosphereRimWidth,this._innerRimFactor=(this._planetRadius+$ie)/this._planetRadius,this._middleRimFactor=(this._planetRadius+Lie)/this._planetRadius,this._outerRimFactor=(this._planetRadius+this._outerRimWidth)/this._planetRadius,this._texV0=Lie/this._outerRimWidth,this._texVScale=this._texV1-this._texV0,this._techniqueRepository=r.techniqueRepository;const s=r.renderContext.rctx;this._cameraChangeHandle=le(()=>this.view.state?.camera,()=>r.requestRender(),As),this._vao=this._createRibbon(s),this._vaoCount=Fo(this._vao,"geometry"),this._fadeVao=Rl(s),this._fadeVaoCount=Fo(this._fadeVao,"geometry");const n=new vr;n.wrapMode=$t.CLAMP_TO_EDGE,n.flipped=!0,n.width=1,n.height=512,this._passParameters.texture=new Et(s,n,rKe);const o=new FX;o.geometry=Hf.Cone,this._coneTechnique=this._techniqueRepository.acquire(o4,o),o.geometry=Hf.Underground,this._undergroundTechnique=this._techniqueRepository.acquire(o4,o)}destroy(){this._coneTechnique.release(),this._undergroundTechnique.release(),this._cameraChangeHandle.remove(),this._passParameters.texture=Ue(this._passParameters.texture),this._fadeVao.dispose(),this._vao.dispose()}render(e){const r=e.bindParameters.camera;this._update(r);const i=e.rctx;this._passParameters.undergroundFadeAlpha<1&&(i.bindTechnique(this._coneTechnique,this._passParameters,e.bindParameters),i.bindVAO(this._vao),i.drawArrays(St.TRIANGLES,0,this._vaoCount)),this._passParameters.undergroundFadeAlpha>0&&(i.bindTechnique(this._undergroundTechnique,this._passParameters,e.bindParameters),i.bindVAO(this._fadeVao),i.drawArrays(St.TRIANGLE_STRIP,0,this._fadeVaoCount))}renderHaze(){}_update(e){const r=C(),i=this._planetRadius,s=Ce(e.eye),n=s-i;if(n<0){const m=Math.min(-n/5e3,1);this._passParameters.undergroundFadeAlpha=m}else this._passParameters.undergroundFadeAlpha=0;const o=Math.max(_8,n),a=i+$ie;this._passParameters.innerScale=oKe(i+o,i,a)-1,this._passParameters.altitudeFade=EX(n),te(r,e.eye,(i+_8)/s),Die(r,e.center,e.up,i,this._passParameters.silhouette);const l=this._computeScreenRimWidth(e,r,e.up,this._passParameters.silhouette),c=iKe(),h=sKe(n);let p=this._texV0+c*this._texVScale,f=this._texV0+l*h*this._texVScale;if(n>_8){Die(e.eye,e.center,e.up,i,this._passParameters.silhouette);const m=this._computeScreenRimWidth(e,e.eye,e.up,this._passParameters.silhouette),y=ge((m-1.5)/(l-1.5),0,1);p=this._texV0+y*c*this._texVScale,f=this._texV0+wt(this._texV1,l*h,y)*this._texVScale}or(this._passParameters.texV,p,f)}_createRibbon(e){const r=Yi(3+3*UM*3),i=new Uint32Array(3*UM*5);r[0]=0,r[1]=0,r[2]=-1;for(let o=0;o<UM;o++){const a=9*o+3;r[a]=o,r[a+1]=this._innerRimFactor,r[a+2]=-1,r[a+3]=o,r[a+4]=this._middleRimFactor,r[a+5]=0,r[a+6]=o,r[a+7]=this._outerRimFactor,r[a+8]=1;const l=3*o+1,c=o===UM-1?1:l+3,h=15*o;i[h]=l,i[h+1]=l+1,i[h+2]=c+1,i[h+3]=c+1,i[h+4]=c,i[h+5]=l,i[h+6]=l+1,i[h+7]=l+2,i[h+8]=c+2,i[h+9]=c+2,i[h+10]=c+1,i[h+11]=l+1,i[h+12]=l,i[h+13]=c,i[h+14]=0}const s=Nie.createBuffer(i.length),n=s.position;for(let o=0;o<i.length;++o){const a=3*i[o];n.set(o,0,r[a]),n.set(o,1,r[a+1]),n.set(o,2,r[a+2])}return new pp(e,br,{geometry:Cc(Nie)},{geometry:Lr.createVertex(e,Tr.STATIC_DRAW,s.buffer)})}_computeScreenRimWidth(e,r,i,s){return ce(px,s.center,s.v2),te(kM,px,this._outerRimFactor),c5(v8,r,px,i),iie(px,v8,e.projectionMatrix,e.viewport,px),iie(kM,v8,e.projectionMatrix,e.viewport,kM),di(px,kM)/e.height}};function Die(t,e,r,i,s){const n=Ce(t),o=i*Math.sqrt(n*n-i*i)/n,a=Math.sqrt(i*i-o*o),l=s.v1,c=s.v2;return te(s.center,t,a/n),at(l,t,e),na(l)<1&&at(l,t,r),te(l,l,o/Ce(l)),at(c,l,t),te(c,c,o/Ce(c)),o}const v8=be(),px=C(),kM=C();function oKe(t,e,r){return t*t/(Math.sqrt(t*t-e*e)*Math.sqrt(t*t-r*r)+e*r)}const Nie=zi().vec3f(E.POSITION);var Bg;(function(t){t[t.Rain=0]="Rain",t[t.Snow=1]="Snow",t[t.COUNT=2]="COUNT"})(Bg||(Bg={}));let Mj=class extends pa{constructor(){super(...arguments),this.type=Bg.Rain}};u([B({count:Bg.COUNT})],Mj.prototype,"type",void 0);function aKe(t){const e=new wr;return e.attributes.add(E.POSITION,"vec3"),e.attributes.add(E.INSTANCEFEATUREATTRIBUTE,"float"),e.vertex.uniforms.add(new Ft("cameraPosition",(r,i)=>i.camera.eye)),e.vertex.uniforms.add(new Ft("offset",(r,i)=>lKe(r,i))),e.vertex.uniforms.add(new Re("width",r=>r.width)),e.vertex.uniforms.add(new $i("proj",(r,i)=>i.camera.projectionMatrix)),e.vertex.uniforms.add(new $i("view",(r,i)=>i.camera.viewMatrix)),e.vertex.uniforms.add(new Re("time",r=>r.time)),e.varyings.add("vUv","vec2"),e.vertex.code.add(b`
    vec3 hash31(float p){
      vec3 p3 = fract(vec3(p) * vec3(0.1031, 0.1030, 0.0973));
      p3 += dot(p3, p3.yzx + 33.33);
      return fract((p3.xxy + p3.yzz) * p3.zyx);
    }

    float hash11(float p){
      p = fract(p * 0.1031);
      p *= p + 33.33;
      p *= p + p;
      return fract(p);
    }

    //https://www.geeks3d.com/20141201/how-to-rotate-a-vertex-by-a-quaternion-in-glsl/
    vec3 rotateVectorByQuaternion(vec3 v, vec4 q){
      return 2.0 * cross(q.xyz, v * q.w + cross(q.xyz, v)) + v;
    }

    void main(void) {

      vUv = position.xz;

      vec3 rand = hash31(instanceFeatureAttribute);

      // Set random position for all particles
      // The hash function space is not high resolution so offset particles by an additional random value
      // This creates grids of 1000 particles which are shifted by random hundreths of the tile width
      // overlaying multiple identical but offset grids
      vec3 randomPosition = 2.0 * (rand + (0.01 + 0.01 * rand) * floor(0.001 * instanceFeatureAttribute)) - 1.0;

      // Random orientation of rain drops
      float angle = 3.1415 * hash11(instanceFeatureAttribute);

      vec3 up = vec3(0, 0, 1);

      // Gravity and wind direction
      vec3 direction = normalize(cameraPosition);

      vec3 tangent = normalize(cross(direction, up));

      // Gravity
      vec3 animatedPos = randomPosition + direction * -time;

      // Rain particles fall straight down and are randomly oriented
      // Snow particles have random sinusoid trajectories and are rotated to face the camera
      ${t.type===Bg.Rain?b`
            // Random rotation for particle
            vec3 rotationAxis = up;
            vec4 quat = vec4(rotationAxis * sin(angle), cos(angle));
            vec3 transformedPos = rotateVectorByQuaternion(vec3(0.2, 0.2, 4.0) * (position - vec3(0.5, 0.0, 0.5)), quat);

            // Rotate particle to planetary position
            rotationAxis = tangent;
            angle = 0.5 * -acos(dot(direction, up));
            quat = vec4(rotationAxis * sin(angle), cos(angle));
            transformedPos = rotateVectorByQuaternion(transformedPos, quat);

            vec4 pos = mat4(mat3(view)) * vec4(transformedPos + (mod(width * animatedPos - offset, width) - 0.5 * width), 1.0);
            gl_Position = proj * pos;
      `:b`
            vec3 rotationAxis = direction;
            vec4 quat = vec4(rotationAxis * sin(angle), cos(angle));

            tangent = rotateVectorByQuaternion(tangent, quat);
            // Random sinusoid from friction
            animatedPos += tangent * 0.25 * sin(dot(animatedPos, direction));
            vec4 pos = mat4(mat3(view)) * vec4((mod(width * animatedPos - offset, width) - 0.5 * width), 1.0);
            gl_Position = proj * (0.5 * vec4(position.xzy, 0.0) + pos);
      `}
    }
  `),e.fragment.uniforms.add(new Re("opacity",r=>r.opacity),new Ft("particleColor",(r,i)=>cKe(i,t))),e.fragment.code.add(b`
    void main() {

      // Cut off corners of the triangle
      if(vUv.x < 0.0 || vUv.y < 0.0){
        discard;
      }

      float d = length(vUv - vec2(0.5));

      ${t.type===Bg.Rain?b`d = 0.35 * smoothstep(0.5, 0.0, d);`:b`d = smoothstep(0.5, 0.1, d);`}
      fragColor = opacity * vec4(particleColor * d, d);
    }
  `),e}function lKe(t,e){const r=e.camera.eye,i=.5*t.width,s=1/t.width,n=xfe(Ij,se(Ij,(r[0]+i)*s,(r[1]+i)*s,(r[2]+i)*s));return Cn(n,r,te(n,n,t.width))}function cKe(t,e){const r=e.type===Bg.Rain?hKe:uKe,i=te(Ij,r,dKe),s=t.camera.eye;me(Fie,s);const n=Math.max(0,fe(Fie,t.lighting.mainLight.direction));return Br(i,i,r,n)}const Ij=C(),Fie=C(),uKe=Oe(1,1,1),hKe=Oe(.85,.85,.85),dKe=.7,pKe=Object.freeze(Object.defineProperty({__proto__:null,build:aKe},Symbol.toStringTag,{value:"Module"}));let fKe=class extends ei{constructor(){super(...arguments),this.time=0,this.radius=1,this.width=500,this.opacity=1}},$j=class Nxe extends Pr{initializeProgram(e){return new Cr(e.rctx,Nxe.shader.get().build(this.configuration),tD)}initializePipeline(){return At({blending:xo(we.ONE,we.ONE,we.ONE_MINUS_SRC_ALPHA,we.ONE_MINUS_SRC_ALPHA),depthTest:{func:Kr.LEQUAL},colorWrite:Vt})}};$j.shader=new Er(pKe,()=>ae(()=>import("./Precipitation.glsl-dd837094.js"),[],import.meta.url));const tD=new Map([[E.POSITION,0],[E.INSTANCEFEATUREATTRIBUTE,1]]);let Fxe=class{constructor(){this.enabled=!0,this._time=0}get time(){return this._time}advance({deltaTime:e,fixedTime:r}){return r!=null?this._time!==r&&(this._time=r,!0):(this._time=this._time+e,e!==0)}},mKe=class{constructor(e,r){this.deltaTime=e,this.fixedTime=r}},N1=class extends Te{constructor(e){super(e),this._numParticles=25e4,this._rainSpeed=.1,this._snowSpeed=.01,this._passParameters=new fKe,this._animation=new Fxe,this._updatingTracking=new Cf,this._passParameters.time=0,this._passParameters.radius=Nr(e.view.spatialReference).radius,this._techniqueRepository=e.context.techniqueRepository}destroy(){this._updatingTracking.destroy(),this._numParticles=0,this._snowTechniqueCached=Ui(this._snowTechniqueCached),this._rainTechniqueCached=Ui(this._rainTechniqueCached),this._vao=Ue(this._vao),this._instanceIdBuffer=Ue(this._instanceIdBuffer)}get updating(){return this._updatingTracking.updating}get _rainTechnique(){if(this._rainTechniqueCached==null){const e=new Mj;e.type=Bg.Rain,this._rainTechniqueCached=this._techniqueRepository.acquire($j,e)}return this._rainTechniqueCached}get _snowTechnique(){if(this._snowTechniqueCached==null){const e=new Mj;e.type=Bg.Snow,this._snowTechniqueCached=this._techniqueRepository.acquire($j,e)}return this._snowTechniqueCached}update(e){return this._animation.advance(e)}render(e,r,i){const s=i==="rainy"?this._rainTechnique:this._snowTechnique;if(!s.compiled)return void this.context.requestRender();const n=e.rctx;if(this._ensureResources(n),s==null||this._vao==null||this._instanceIdBuffer==null||(e.bindParameters.cloudsFade.data!=null&&(this._passParameters.opacity=1-e.bindParameters.cloudsFade.fadeInOutHeight.factor),this._passParameters.opacity<=0))return;const o=.35;r=r<.5?wt(0,o,2*r):wt(o,1,2*(r-.5)),this._passParameters.time=(i==="rainy"?this._rainSpeed:this._snowSpeed)*Fq(this._animation.time)%1e5;const a=n.bindTechnique(s,this._passParameters,e.bindParameters);n.bindVAO(this._vao),a.assertCompatibleVertexAttributeLocations(this._vao),OX(n,tD,this._instanceIdBuffer,Uie,0),n.capabilities.instancing?.drawArraysInstanced(St.TRIANGLES,0,3,this._numParticles*r),RX(n,tD,this._instanceIdBuffer,Uie)}_ensureResources(e){this._vao==null&&(this._vao=this._createVertexArrayObject(e)),this._instanceIdBuffer==null&&(this._instanceIdBuffer=this._createInstanceIndices(e))}_createInstanceIndices(e){const r=[];for(let i=0;i<this._numParticles;i++)r.push(i);return Lr.createVertex(e,Tr.STATIC_DRAW,new Float32Array(r))}_createVertexArrayObject(e){const r=new Float32Array([-1,0,1,1,0,-1,1,0,1]);return new pp(e,tD,{geometry:Cc(gKe)},{geometry:Lr.createVertex(e,Tr.STATIC_DRAW,r)})}};u([d({constructOnly:!0})],N1.prototype,"context",void 0),u([d({constructOnly:!0})],N1.prototype,"view",void 0),u([d({readOnly:!0})],N1.prototype,"updating",null),u([d()],N1.prototype,"_updatingTracking",void 0),N1=u([R("esri.views.3d.environment.Precipitation")],N1);const gKe=zi().vec3f(E.POSITION),Uie=Cc(zi().f32(E.INSTANCEFEATUREATTRIBUTE),1);function yKe(){const t=new wr;return t.attributes.add(E.POSITION,"vec3"),t.attributes.add(E.COLOR,"vec4"),t.attributes.add(E.SIZE,"float"),t.varyings.add("vcolor","vec4"),t.varyings.add("vsize","float"),t.vertex.uniforms.add(new $i("transform",(e,r)=>_Ke(e,r)),new sr("viewport",(e,r)=>r.camera.fullViewport),new Re("pixelRatio",(e,r)=>r.camera.pixelRatio)),t.vertex.code.add(b`void main(void) {
gl_Position = transform * vec4(position, 0);
vcolor = color / 1.2;
vsize = size * 5.0 * pixelRatio;
gl_PointSize = vsize;
}`),t.fragment.code.add(b`void main() {
float cap = 0.7;
float scale = 1.0 / cap;
float helper = clamp(length(abs(gl_PointCoord - vec2(0.5))), 0.0, cap);
float alpha = clamp((cap - helper) * scale, 0.0, 1.0);
float intensity = alpha * alpha * alpha;
if (vsize < 3.0) {
intensity *= 0.5;
}
fragColor = vec4(vcolor.xyz, intensity);
}`),t}function _Ke(t,e){return Ls(Cy,e.camera.projectionMatrix),Cy[10]=24e-8-1,Cy[11]=-1,Cy[14]=(24e-8-2)*e.camera.near,si(Cy,Cy,e.camera.viewMatrix),si(Cy,Cy,t.modelMatrix)}const Cy=be(),vKe=Object.freeze(Object.defineProperty({__proto__:null,build:yKe},Symbol.toStringTag,{value:"Module"}));let bKe=class extends ei{constructor(){super(...arguments),this.modelMatrix=be()}},Uxe=class kxe extends Pr{constructor(e){super(e,new pa,()=>this.destroy())}initializeProgram(e){return new Cr(e.rctx,kxe.shader.get().build(),br)}initializePipeline(){return At({blending:xo(we.SRC_ALPHA,we.ONE,we.ONE_MINUS_SRC_ALPHA,we.ONE_MINUS_SRC_ALPHA),depthTest:{func:Kr.LEQUAL},colorWrite:Vt})}};Uxe.shader=new Er(vKe,()=>ae(()=>import("./Stars.glsl-38d8e8c6.js"),[],import.meta.url));let T0=class extends Te{get updating(){return this._updatingTracking.updating||this.loading}get loading(){return this._loadDataTask!=null&&!this._loadDataTask.finished}constructor(e){super(e),this._loadDataTask=null,this._numPoints=0,this._renderParameter=new bKe,this._updatingTracking=new Cf}initialize(){this._loadDataTask=this._createLoadDataTask()}destroy(){this._loadDataTask=pu(this._loadDataTask),this._updatingTracking.destroy(),this._numPoints=0,this._technique=Ui(this._technique),this._vao=Ue(this._vao),_v=null}render(e){const{rctx:r}=e;if(this._ensureResources(r),this._technique==null||this._vao==null)return;if(!this._technique.compiled)return void this.requestRender();const i=r.bindTechnique(this._technique,this._renderParameter,e.bindParameters);r.bindVAO(this._vao),i.assertCompatibleVertexAttributeLocations(this._vao),r.drawArrays(St.POINTS,0,this._numPoints)}_ensureResources(e){if(this._technique!=null||_v==null)return;this._technique=new Uxe({rctx:e,viewingMode:this.view.state.viewingMode}),this._numPoints=_v.byteLength/kie;const r=new Float32Array(_v,0,2*this._numPoints),i=new Uint8Array(_v,2*this._numPoints*4,this._numPoints);this._vao=this._createVertexArrayObject(e,r,i,this._numPoints),this._updatingTracking.add(()=>this.view.environment.lighting.type!=="virtual"?this.view.environment.lighting.date:null,s=>this._update(s),Vr)}_computeDayDuration(e){const r=e,i=new Date(e.getFullYear(),0,1,11,58,56);return(+r-+i)/(+new Date(e.getFullYear()+1,0,1,11,58,55)-+i)}_update(e){if(!e)return;const r=(e.getHours()/12+e.getMinutes()/60*(2/24)+e.getSeconds()/60*(2/1440)-.9972222)%2,i=2*this._computeDayDuration(e),s=Ls(this._renderParameter.modelMatrix,TKe);h2(s,s,-i*Math.PI),si(s,xKe,s),h2(s,s,-r*Math.PI),this.requestRender()}_hexToRGB(e){return[parseInt(e.substring(0,2),16),parseInt(e.substring(2,4),16),parseInt(e.substring(4,6),16)]}_unpackUint8Attributes(e){return e>=192?[2.9,e-192]:e>=160?[2.5,e-160]:e>=128?[2,e-128]:e>=96?[1.5,e-96]:e>=64?[1,e-64]:e>=32?[.7,e-32]:[.4,e]}_createVertexArrayObject(e,r,i,s){const n=Vie.createBuffer(s),o=n.position,a=n.color,l=n.size;for(let c=0;c<s;c++){const h=r[2*c],p=r[2*c+1];o.set(c,0,-Math.cos(h)*Math.sin(p)),o.set(c,1,-Math.sin(h)*Math.sin(p)),o.set(c,2,-Math.cos(p));const f=this._unpackUint8Attributes(i[c]),m=this._hexToRGB(wKe[f[1]]);a.set(c,0,255*m[0]),a.set(c,1,255*m[1]),a.set(c,2,255*m[2]),a.set(c,3,255),l.set(c,f[0])}return new pp(e,br,{geometry:Cc(Vie)},{geometry:Lr.createVertex(e,Tr.STATIC_DRAW,n.buffer)})}_createLoadDataTask(){if(_v!=null)return null;const e=uE(async r=>{const{data:i}=await AIe("esri/views/3d/environment/resources/stars.wsv",{responseType:"array-buffer",signal:r});this._verifyStarData(i),_v=i});return e.promise.catch(r=>{ms(r)||Q.getLogger(this).error(r)}).then(()=>{this.destroyed||(this.requestRender(),this.notifyChange("updating"))}),e}_verifyStarData(e){if(!e)throw new F("stars:no-data-received","Failed to create stars because star catalogue is missing");const r=e.byteLength/kie;if(r%1!=0||r>5e4||r<5e3)throw new F("stars:invalid-data","Failed to create stars because star catalogue data is invalid")}};u([d({constructOnly:!0})],T0.prototype,"view",void 0),u([d({constructOnly:!0})],T0.prototype,"requestRender",void 0),u([d({readOnly:!0})],T0.prototype,"updating",null),u([d()],T0.prototype,"_loadDataTask",void 0),u([d()],T0.prototype,"_updatingTracking",void 0),T0=u([R("esri.views.3d.environment.Stars")],T0);const wKe=["9bb2ff","9eb5ff","aabfff","bbccff","ccd8ff ","dae2ff","e4e9ff","eeefff","f8f6ff","fff9fb","fff5ef","fff1e5","ffeddb","ffe9d2","ffe6ca","ffe3c3","ffe0bb","ffddb4","ffdaad","ffd6a5","ffd29c","ffcc8f","ffc178","ffa94b","ff7b00"],xKe=sX(1,0,0,0,0,.9174771405229186,.39778850739794974,0,0,-.39778850739794974,.9174771405229186,0,0,0,0,1),TKe=sX(1,0,0,0,0,.9174771405229186,-.39778850739794974,0,0,.39778850739794974,.9174771405229186,0,0,0,0,1),kie=9,Vie=zi().vec3f(E.POSITION).vec4u8(E.COLOR).f32(E.SIZE);let _v=null;function sy(t=EKe){return[t[0],t[1],t[2],t[3]]}function b8(t,e,r=sy()){return ie(r,t),r[3]=e,r}function zie(t,e,r=sy()){return at(r,t,e),me(r,r),r[3]=-Sfe(t,e),r}function Bie(t,e,r=sy()){return qN(VM,t,Gie(t)),qN(jie,e,Gie(e)),E5(VM,jie,VM),SKe(r,qa(nX(r,VM)))}function vMt(t,e,r,i=sy()){return b8(bfe,t,zM),b8(wfe,e,Hie),b8(tW,r,qie),Bie(zM,Hie,zM),Bie(zM,qie,i),i}function bMt(t){return t}function wMt(t){return t[3]}function Gie(t){return Dt(t[3])}function SKe(t,e){return t[3]=e,t}const EKe=[0,0,1,0],VM=Fh(),jie=Fh();sy();const zM=sy(),Hie=sy(),qie=sy();function CKe(t,e,r){const i=t.parallax.anchorPointClouds;t.fadeIn.stage===sc.FINISHED&&(t.fadeIn.factor=0,ie(i,_f),t.fadeIn.stage=sc.CHANGE_ANCHOR,t.crossFade.enabled=!1,t.fadeInOut.stage=bn.FINISHED),t.fadeIn.stage===sc.CHANGE_ANCHOR&&t.isCameraPositionFinal&&(DX(t.data)&&t.renderingStage!==Os.RENDERING||t.renderingStage===Os.FADING_TEXTURE_CHANNELS)&&(ie(i,_f),t.fadeIn.stage=sc.FADE_IN,t.startTime=e,t.renderingStage===Os.FADING_TEXTURE_CHANNELS&&(t.renderingStage=Os.SWITCH_CHANNELS)),t.fadeIn.factor<1&&t.fadeIn.stage===sc.FADE_IN?t.fadeIn.factor=r?ge((e-t.startTime)/(Vxe*r),0,1):1:t.fadeIn.factor>=1&&t.fadeIn.stage===sc.FADE_IN&&(t.fadeIn.stage=sc.FINISHED,t.fadeIn.factor=1)}function AKe(t,e,r){const{fadeInOut:i,crossFade:s}=t;i.stage===bn.FINISHED&&(t.startTime=e,i.factor=1,i.stage=bn.FADE_OUT),i.factor>0&&i.stage===bn.FADE_OUT?i.factor=r?1-ge((e-t.startTime)/(IKe*r),0,1):0:(i.factor<=0&&i.stage===bn.FADE_OUT&&(i.factor=0,ie(t.parallax.anchorPointClouds,_f)),i.factor<=0&&i.stage===bn.FADE_OUT&&t.isCameraPositionFinal&&(i.factor=0,i.stage=bn.SWITCH,t.crossFade.enabled=!1,s.factor=1),i.stage===bn.SWITCH&&(DX(t.data)&&t.renderingStage!==Os.RENDERING||t.renderingStage===Os.FADING_TEXTURE_CHANNELS)&&(t.startTime=e,i.factor=0,i.stage=bn.FADE_IN,ie(t.parallax.anchorPointClouds,_f),t.crossFade.enabled=!1,s.factor=1,t.renderingStage===Os.FADING_TEXTURE_CHANNELS&&(t.renderingStage=Os.SWITCH_CHANNELS)),i.factor<1&&i.stage===bn.FADE_IN?i.factor=r?ge((e-t.startTime)/(Vxe*r),0,1):1:i.factor>=1&&i.stage===bn.FADE_IN&&(i.stage=bn.FINISHED,i.factor=1))}function OKe(t,e,r,i){const{crossFade:s}=t,n=t.parallax.anchorPointClouds;t.crossFade.enabled&&!i||(ie(t.parallaxNew.anchorPointClouds,_f),t.startTime=e,s.factor=0,t.crossFade.enabled=!0),s.factor<1&&t.crossFade.enabled?s.factor=r?ge((e-t.startTime)/($Ke*r),0,1):1:s.factor>=1&&t.crossFade.enabled&&(t.crossFade.enabled=!1,s.factor=1,ie(n,t.parallaxNew.anchorPointClouds),t.renderingStage===Os.FADING_TEXTURE_CHANNELS&&(t.renderingStage=Os.SWITCH_CHANNELS))}function Wie(t,e,r,i){const s=t.fadeInOutHeight,n=s.stage===N_.FINISHED?r:t.startTimeHeightFade;if(i!==0){const o=(r-n)/(LKe*i);s.factor+=e?-o:o}else s.factor=e?0:1;t.startTimeHeightFade=r,s.factor=ge(s.factor,0,1),s.stage=N_.HEIGHT_FADE}function RKe(t,e,r,i,s){t.renderingStage===Os.FINISHED_RENDERING&&(t.renderingStage=Os.FADING_TEXTURE_CHANNELS);const n=Ce(e.eye);t.fadeInOutHeight.factor<0&&(t.fadeInOutHeight.factor=n-nr.radius>df?1:0),t.isCameraPositionFinal=T_(t.cameraPositionLastFrame,e.eye),me(_f,e.eye),te(_f,_f,nr.radius);const o=t.parallax;o.anchorPointClouds[0]===0&&o.anchorPointClouds[1]===0&&o.anchorPointClouds[2]===0&&ie(o.anchorPointClouds,_f);const a=Ce(he(MKe,o.anchorPointClouds,_f));let l=!0;a>t.fadeIn.distanceThresholdFactor*o.cloudsHeight||t.fadeIn.stage!==sc.FINISHED?CKe(t,i,s):a>t.fadeInOut.distanceThresholdFactor*o.cloudsHeight||t.fadeInOut.stage!==bn.FINISHED?AKe(t,i,s):a>t.crossFade.distanceThresholdFactor*o.cloudsHeight||t.crossFade.enabled||t.renderingStage===Os.FADING_TEXTURE_CHANNELS?OKe(t,i,s,(r!==$r.IDLE||!DX(t.data))&&t.renderingStage!==Os.FADING_TEXTURE_CHANNELS):l=!1;const c=n-nr.radius;if((c>1.7*df||c<-df)&&t.fadeInOutHeight.factor<1?t.fadeInOutHeight.factor=1:(c>df||c<-.35*df)&&t.fadeInOutHeight.factor<1?Wie(t,!1,i,s):c<df&&c>-.35*df&&t.fadeInOutHeight.factor>0?Wie(t,!0,i,s):t.fadeInOutHeight.stage=N_.FINISHED,t.renderingStage===Os.SWITCH_CHANNELS&&(t.readChannels=1-t.readChannels,t.renderingStage=Os.FINISHED),o.radiusCurvatureCorrectionFactor=.84*Math.sqrt(Math.max(n*n-nr.radius*nr.radius,0))/n,zie(Zie,o.anchorPointClouds,fx),dc(o.transform,un,fx[3],fx),l){const{parallaxNew:h}=t;zie(Zie,h.anchorPointClouds,fx),dc(h.transform,un,fx[3],fx)}ie(t.cameraPositionLastFrame,e.eye)}function PKe(t){return t.crossFade.enabled||t.fadeInOut.stage!==bn.FINISHED||t.fadeIn.stage!==sc.FINISHED||t.fadeInOutHeight.stage!==N_.FINISHED||t.renderingStage!==Os.FINISHED}const Zie=Oe(0,0,1),fx=sy(),_f=C(),MKe=C(),Vxe=1,IKe=.5,$Ke=1.3,LKe=1;let yE=class{constructor(){this._outer=new Map}clear(){this._outer.clear()}get empty(){return this._outer.size===0}get(e,r){return this._outer.get(e)?.get(r)}set(e,r,i){const s=this._outer.get(e);s?s.set(r,i):this._outer.set(e,new Map([[r,i]]))}delete(e,r){const i=this._outer.get(e);i&&(i.delete(r),i.size===0&&this._outer.delete(e))}forEach(e){this._outer.forEach((r,i)=>e(r,i))}};var Hs;function Xie(t=!oe("disable-feature:high-quality-idle"),e=null){const r=new yE;return t?(r.set($r.IDLE,Hs.Antialiasing,e!=="low"),r.set($r.IDLE,Hs.HighResolutionAtmosphere,e!=="low"),r.set($r.IDLE,Hs.HighQualityTransparency,!0),r.set($r.IDLE,Hs.SSAO,!0),r.set($r.IDLE,Hs.WaterReflection,!0),r.set($r.IDLE,Hs.PhysicalPixelRendering,!oe("esri-mobile"))):(r.set($r.ANIMATING,Hs.HighResolutionShadows,!0),r.set($r.INTERACTING,Hs.HighResolutionShadows,!0)),r.set($r.IDLE,Hs.HighResolutionShadows,!0),r.set($r.IDLE,Hs.HighResolutionVoxel,!0),r}(function(t){t[t.Antialiasing=0]="Antialiasing",t[t.HighQualityTransparency=1]="HighQualityTransparency",t[t.HighResolutionVoxel=2]="HighResolutionVoxel",t[t.HighResolutionAtmosphere=3]="HighResolutionAtmosphere",t[t.SSAO=4]="SSAO",t[t.WaterReflection=5]="WaterReflection",t[t.HighResolutionShadows=6]="HighResolutionShadows",t[t.PhysicalPixelRendering=7]="PhysicalPixelRendering"})(Hs||(Hs={}));var US;(function(t){t[t.Immediate=0]="Immediate",t[t.Faded=1]="Faded"})(US||(US={}));var ZA;const DKe=[ue.POSTPROCESSING_ENVIRONMENT_OPAQUE,ue.POSTPROCESSING_ENVIRONMENT_TRANSPARENT];let Oo=ZA=class extends Te{constructor(t){super(t),this._context=null,this._atmosphere=null,this._oldWeatherParameters=new w8,this._newWeatherParameters=new w8,this._fadedWeatherParameters=new w8,this._weatherParameters=this._newWeatherParameters}initialize(){this.view._stage.addRenderPlugin(DKe,this)}destroy(){this.removeHandles(),this.uninitializeRenderContext(),this.view?._stage!=null&&this.view._stage.removeRenderPlugin(this),this._set("view",null)}get atmosphere(){return this._atmosphere}get _atmosphereType(){return this.atmosphere!=null?this.atmosphere.type:ea.None}get canRender(){return!(this._atmosphere===null&&this._stars===null)}get needsLinearDepth(){return this._atmosphereType===ea.Realistic}updateAnimation(t){return this._precipitation!=null&&this._precipitation.update(t)}get updating(){return this._stars!=null&&this._stars.updating||this._clouds!=null&&this._clouds.running}get weatherVisible(){return Ce(this.view.state.camera.eye)-Nr(this.view.spatialReference).radius<=df}get _stars(){const t=this.view,e=t.environment?.starsEnabled??!1,r=this._get("_stars");return e&&this._context!=null?r??new T0({view:t,requestRender:()=>this._setNeedsRender()}):(Me(r),null)}get _precipitation(){const t=this._get("_precipitation");if(!this._precipitationEnabled||this._context==null)return Me(t),null;const e=this.view,r=this._context;return t!=null&&t.context===r?t:(Me(t),new N1({context:r,view:e}))}get _clouds(){const t=this._get("_clouds");if(!this.weatherEnabled||this._context==null)return Me(t),null;if(t!=null)return t;const e=this.view,r=this._context;return Me(t),new ul({context:r,view:e,requestRender:()=>this._setNeedsRender()})}get _cloudsComposition(){const t=this._get("_cloudsComposition");if(!this.weatherEnabled||this._context==null)return Me(t),null;const e=this.view.state.viewingMode,r=this._context.renderContext.rctx,i=Nr(this.view.spatialReference).radius;return t!=null&&t.viewingMode===e&&t.planetRadius===i?t:(Me(t),new $1({rctx:r,viewingMode:e,planetRadius:i,requestRender:()=>this._setNeedsRender()}))}get _fog(){const t=this._get("_fog");if(!this.weatherEnabled||this._context==null)return Me(t),null;if(t!=null)return t;const e=this.view,r=this._context,i=this._context.renderContext.rctx,s=this.view.state.viewingMode;return new L1({context:r,view:e,rctx:i,viewingMode:s})}get weatherEnabled(){return!!this.view?.environmentManager?.weatherEnabled}get _precipitationEnabled(){return this.weatherEnabled&&(this.view.environment.weather.type==="rainy"||this.view.environment.weather.type==="snowy")}initializeRenderContext(t=null){this._context=t;const e=()=>this._setNeedsRender();this.addHandles([le(()=>({viewingMode:this.view.state.viewingMode,enabled:this.view.environment.atmosphereEnabled}),r=>this._updateAtmosphere(r),As),le(()=>this._stars,e),le(()=>this._precipitation,e),le(()=>this._clouds,()=>this._updateWeather(),Vr),le(()=>this._fog,()=>this._updateFogHaze(),Vr),le(()=>this.view.state.mode,()=>{this._setNeedsRender()},jr),le(()=>this._weatherUpdateParameters,()=>{this._updateWeather(),this._updateFogHaze()},As)])}uninitializeRenderContext(){this._context=null,this._atmosphere=Me(this._atmosphere),this._set("_stars",Me(this._stars)),this._set("_precipitation",Me(this._precipitation)),this._set("_clouds",Me(this._clouds)),this._set("_cloudsComposition",Me(this._cloudsComposition)),this._set("_fog",Me(this._fog))}prepareRender(t){t.bindParameters.cloudsFade.data=gJe(this._clouds)?this._clouds:null,this.view.viewingMode!=="local"&&t.bindParameters.cloudsFade.data?.cubeMap!=null&&(RKe(t.bindParameters.cloudsFade,t.bindParameters.camera,this.view.state.mode,t.time,this.view.qualitySettings.fadeDuration),this._updateWeatherFading(t.bindParameters),t.bindParameters.cloudsFade.renderingStage===Os.FINISHED&&this._clouds!=null&&this._clouds.coverage===0&&this._clouds.running===!1&&(this._clouds.destroyFrameBufferCube(),t.bindParameters.cloudsFade.data=null))}render(t){if(t.output===N.Color)switch(t.bindParameters.slot){case ue.POSTPROCESSING_ENVIRONMENT_OPAQUE:this._stars!=null&&this._stars.render(t),this.atmosphere!=null&&(this.atmosphere.render(t,this.view?.qualitySettings.highResolutionAtmosphere||this.view?._stage?.renderer?.isFeatureEnabled(Hs.HighResolutionAtmosphere)),this._cloudsComposition!=null&&t.bindParameters.cloudsFade.data!=null&&(this.weatherVisible&&this._clouds!=null&&this._clouds.updateWeatherTile(),this._cloudsComposition.render(t)),PKe(t.bindParameters.cloudsFade)&&this._context!=null&&t.bindParameters.cloudsFade.data?.cubeMap!=null&&this._context.requestRender());break;case ue.POSTPROCESSING_ENVIRONMENT_TRANSPARENT:if(this.atmosphere!=null&&(this.atmosphere.renderHaze(t,this._weatherParameters.hazeAmount,this.view?.qualitySettings.highResolutionAtmosphere||this.view?._stage?.renderer?.isFeatureEnabled(Hs.HighResolutionAtmosphere)),this._weatherParameters.fog.amount>0&&this._fog!=null&&this._fog.render(t,this._weatherParameters.fog),this._precipitation!=null)){const e=this.view.environment.weather;e.type!=="rainy"&&e.type!=="snowy"||this._precipitation.render(t,e.precipitation,e.type)}}}updateLightSources(t,e,r,i){if(this._context!=null){const s=this._context.renderContext;s.bindParameters.oldLighting.copyFrom(s.bindParameters.lighting),s.bindParameters.newLighting.noonFactor=e,s.bindParameters.newLighting.globalFactor=r,s.bindParameters.newLighting.set(t),i===US.Faded||s.bindParameters.weatherFading?s.bindParameters.fadeLighting(0):s.bindParameters.fadeLighting(1),this._context.requestRender()}}get _weatherUpdateParameters(){const t=this.weatherEnabled?this.view.environment.weather:null;return t==null?null:t.type==="rainy"||t.type==="snowy"?{type:t.type,weatherAdjustment:t.cloudCover,effect:t.precipitation}:{type:t.type,weatherAdjustment:t.type==="foggy"?t.fogStrength:t.cloudCover}}_updateWeatherFading(t){if(!t.weatherFading)return;const e=t.cloudsFade;return e.fadeIn.stage===sc.FADE_IN?(t.fadeLighting(e.fadeIn.factor),void this._fadeWeather(e.fadeIn.factor)):e.fadeInOut.stage===bn.FADE_IN?(t.fadeLighting(e.fadeInOut.factor),void this._fadeWeather(e.fadeInOut.factor)):e.crossFade.enabled?(t.fadeLighting(e.crossFade.factor),void this._fadeWeather(e.crossFade.factor)):(t.fadeLighting(0),void this._fadeWeather(0))}_fadeWeather(t){const{_newWeatherParameters:e,_oldWeatherParameters:r}=this;t>=1?this._weatherParameters=e:(this._fadedWeatherParameters.lerp(r,e,t),this._weatherParameters=this._fadedWeatherParameters)}_updateWeather(){const t=this._weatherUpdateParameters;t!=null&&this._clouds!=null&&(this._clouds.applyPreset(Ko[t.type],t.weatherAdjustment),this._setNeedsRender())}_setNeedsRender(){this._context!=null&&this._context.requestRender()}_updateFogHaze(){const t=this._weatherUpdateParameters;if(this._fog==null||t==null||this._context==null)return;const e=this._context.renderContext.bindParameters;switch(this._oldWeatherParameters.copyFrom(this._weatherParameters),t.type){case"foggy":this._newWeatherParameters.fog.strength=wt(3e-5,.005,t.weatherAdjustment**3),ie(this._newWeatherParameters.fog.color,Yie),this._newWeatherParameters.fog.amount=1,this._newWeatherParameters.hazeAmount=1,this._setNeedsRender();break;case"rainy":this._newWeatherParameters.fog.strength=wt(4e-6,2e-4,(t.effect??0)**3),ie(this._newWeatherParameters.fog.color,NKe),this._newWeatherParameters.fog.amount=1,this._newWeatherParameters.hazeAmount=0,this._setNeedsRender();break;case"snowy":this._newWeatherParameters.fog.strength=wt(4e-6,2e-4,(t.effect??0)**3),ie(this._newWeatherParameters.fog.color,Yie),this._newWeatherParameters.fog.amount=1,this._newWeatherParameters.hazeAmount=1,this._setNeedsRender();break;default:this._newWeatherParameters.fog.strength=0,this._newWeatherParameters.fog.amount=0,this._newWeatherParameters.hazeAmount=1,this._setNeedsRender()}e.weatherFading?this._fadeWeather(0):this._fadeWeather(1)}_updateAtmosphere(t){const e=this._selectAtmosphereType(t);if(e!==ea.None&&this._context){if(!this._atmosphere||this._atmosphere.type!==e){this._atmosphere=Me(this._atmosphere);const r=this._getAtmosphereClass(e);r&&(this._atmosphere=new r(this.view,this._context))}}else this._atmosphere=Me(this._atmosphere);this._setNeedsRender()}_getAtmosphereClass(t){switch(t){case ea.Realistic:return mie;case ea.Local:return eKe;case ea.Mars:return nKe;default:case ea.None:return null}}_selectAtmosphereType(t){const{enabled:e,viewingMode:r}=t;return!e||Kf(this.view.spatialReference)?ea.None:r===De.Local?ea.Local:this._context!=null&&mie.isSupported(this._context)&&_O(this.view.spatialReference)?ea.Realistic:Qf(this.view.spatialReference)?ea.Mars:ea.None}get test(){return{atmosphere:this._atmosphere,clouds:this._clouds,selectAtmosphereType:()=>this._selectAtmosphereType({viewingMode:this.view.state.viewingMode,enabled:this.view.environment.atmosphereEnabled}),stubGetAtmosphereClass:t=>{Jie=ZA.prototype._getAtmosphereClass,ZA.prototype._getAtmosphereClass=t},restoreGetAtmosphereClass:()=>{ZA.prototype._getAtmosphereClass=Jie}}}};u([d({constructOnly:!0})],Oo.prototype,"view",void 0),u([d({readOnly:!0})],Oo.prototype,"atmosphere",null),u([d({readOnly:!0})],Oo.prototype,"_atmosphereType",null),u([d({type:Boolean,readOnly:!0})],Oo.prototype,"updating",null),u([d({readOnly:!0})],Oo.prototype,"weatherVisible",null),u([d()],Oo.prototype,"_context",void 0),u([d()],Oo.prototype,"_atmosphere",void 0),u([d({readOnly:!0})],Oo.prototype,"_stars",null),u([d({readOnly:!0})],Oo.prototype,"_precipitation",null),u([d({readOnly:!0})],Oo.prototype,"_clouds",null),u([d({readOnly:!0})],Oo.prototype,"_cloudsComposition",null),u([d({readOnly:!0})],Oo.prototype,"_fog",null),u([d({readOnly:!0})],Oo.prototype,"weatherEnabled",null),u([d({readOnly:!0})],Oo.prototype,"_precipitationEnabled",null),u([d({readOnly:!0})],Oo.prototype,"_weatherUpdateParameters",null),Oo=ZA=u([R("esri.views.3d.environment.EnvironmentRenderer")],Oo);let w8=class{constructor(){this.fog=new gQe,this.hazeAmount=1}copyFrom(e){this.fog.amount=e.fog.amount,this.hazeAmount=e.hazeAmount,this.fog.strength=e.fog.strength,ie(this.fog.color,e.fog.color)}lerp(e,r,i){this.fog.amount=wt(e.fog.amount,r.fog.amount,i),this.hazeAmount=wt(e.hazeAmount,r.hazeAmount,i),this.fog.strength=wt(e.fog.strength,r.fog.strength,i),Br(this.fog.color,e.fog.color,r.fog.color,i)}};const NKe=Oe(.5,.5,.5),Yie=Oe(1.5,1.5,1.5);let Jie;function Qie(t,e,r){if(e.longitude==null||e.latitude==null||r.longitude==null||r.latitude==null)throw new Error("Invalid points: no lon/lat");return FKe(t,e.longitude,e.latitude,r.longitude,r.latitude)}function FKe(t,e,r,i,s){const n=Dt(r),o=Dt(s),a=n-o,l=Dt(e)-Dt(i),c=Math.sin(a/2),h=Math.sin(l/2),p=2*Ch(Math.sqrt(c*c+Math.cos(n)*Math.cos(o)*h*h))*t;return Math.round(1e4*p)/1e4}function UKe(t,e,r){const i=e.spatialReference,s=Nr(i),n=new pt(e.x,t.y,i),o=new pt(r.x,t.y,i),a=new pt(t.x,e.y,i),l=new pt(t.x,r.y,i);return{lon:Qie(s.radius,n,o),lat:Qie(s.radius,a,l)}}function kKe(t,e,r){const i=e/r,s=Dt(t),n=Math.sin(i/2),o=Math.cos(s),a=2*Ch(Math.sqrt(n*n/(o*o)));return qa(a)}function VKe(t,e){let r=t/15;return e||(r=Math.round(r)),r}function Kie(t,e){const r=t?.[0];if(r==null)return null;e||(e={hours:0,minutes:0,seconds:0}),e.hours=VKe(r,!0);const i=e.hours%1;e.hours-=i,e.minutes=60*i;const s=e.minutes%1;return e.minutes-=s,e.seconds=Math.round(60*s),e}var ese,tse,rse,Lj={exports:{}};Lj.exports,ese=Lj,tse=function(){var t=Math.PI,e=Math.sin,r=Math.cos,i=Math.tan,s=Math.asin,n=Math.atan2,o=Math.acos,a=t/180,l=864e5,c=2440588,h=2451545,p={dec:0,ra:0};function f(P){return P.valueOf()/l-.5+c}function m(P){return new Date((P+.5-c)*l)}function y(P){return f(P)-h}var _=23.4397*a;function v(P,V){return n(e(P)*r(_)-i(V)*e(_),r(P))}function w(P,V){return s(e(V)*r(_)+r(V)*e(_)*e(P))}function x(P,V,z){return n(e(P),r(P)*e(V)-i(z)*r(V))}function T(P,V,z){return s(e(V)*e(z)+r(V)*r(z)*r(P))}function S(P,V){return a*(280.16+360.9856235*P)-V}function O(P){return a*(357.5291+.98560028*P)}function A(P){return a*(1.9148*e(P)+.02*e(2*P)+3e-4*e(3*P))}function I(P,V){return P+V+102.9372*a+t}function M(P,V){var z=O(P),H=I(z,A(z));return V||(V={dec:0,ra:0}),V.dec=w(H,0),V.ra=v(H,0),V}var k={PolarException:{NORMAL:0,MIDNIGHT_SUN:1,POLAR_NIGHT:2},getPosition:function(P,V,z,H){var Z=a*-z,J=a*V,re=y(P),ye=M(re,p),Ne=S(re,Z)-ye.ra;return H||(H={azimuth:0,altitude:0}),H.azimuth=x(Ne,J,ye.dec),H.altitude=T(Ne,J,ye.dec),H}},L=[[-.83,"sunrise","sunset"]];k.addTime=function(P,V,z){L.push([P,V,z])};var D=9e-4;function U(P,V){return Math.round(P-D-V/(2*t))}function X(P,V,z){return D+(P+V)/(2*t)+z}function W(P,V,z){return h+P+.0053*e(V)-.0069*e(2*z)}function G(P,V,z){return o((e(P)-e(V)*e(z))/(r(V)*r(z)))}function Y(P){var V=a*(134.963+13.064993*P),z=a*(93.272+13.22935*P),H=a*(218.316+13.176396*P)+6.289*a*e(V),Z=5.128*a*e(z),J=385001-20905*r(V);return{ra:v(H,Z),dec:w(H,Z),dist:J}}return k.getTimes=function(P,V,z){var H=a*-z,Z=a*V,J=U(y(P),H),re=X(0,H,J),ye=O(re),Ne=A(ye),yt=I(ye,Ne),Ot=w(yt,0),lt=W(re,ye,yt);function _t(ct){return W(X(G(ct,Z,Ot),H,J),ye,yt)}function _e(ct){var Ge=(e(ct)-e(Z)*e(Ot))/(r(Z)*r(Ot));return Ge<-1?k.PolarException.MIDNIGHT_SUN:Ge>1?k.PolarException.POLAR_NIGHT:k.PolarException.NORMAL}var Ae,xt,ve,Be,qe,ft={solarNoon:m(lt),nadir:m(lt-.5),polarException:k.PolarException.NORMAL};for(Ae=0,xt=L.length;Ae<xt;Ae+=1)qe=lt-((Be=_t((ve=L[Ae])[0]*a))-lt),ft[ve[1]]=m(qe),ft[ve[2]]=m(Be);return ft.polarException=_e(L[0][0]*a),ft},k.getMoonPosition=function(P,V,z){var H=a*-z,Z=a*V,J=y(P),re=Y(J),ye=S(J,H)-re.ra,Ne=T(ye,Z,re.dec);return Ne+=.017*a/i(Ne+10.26*a/(Ne+5.1*a)),{azimuth:x(ye,Z,re.dec),altitude:Ne,distance:re.dist}},k.getMoonFraction=function(P){var V=y(P),z=M(V),H=Y(V),Z=149598e3,J=o(e(z.dec)*e(H.dec)+r(z.dec)*r(H.dec)*r(z.ra-H.ra)),re=n(Z*e(J),H.dist-Z*r(J));return(1+r(re))/2},k},(rse=tse())!==void 0&&(ese.exports=rse);const uw=BR(Lj.exports),Ua={local:{altitude:1500,ambientAtNight:.1,ambientAtNoon:.45,ambientAtTwilight:.2,directAtNoon:.65,directAtTwilight:.7},global:{altitude:8e5,ambient:.015,direct:.75},planarDirection:{localAltitude:1e4,globalAltitude:1e6,globalAngles:{azimuth:1.3*Math.PI,altitude:.6*Math.PI}}};let BM=class{constructor(e,r){this.direct=e,this.ambient=r}};function zKe(t,e,r,i,s,n){se(n.ambient.color,1,1,1),n.ambient.intensity=Ua.global.ambient,se(n.direct.color,1,1,1),n.direct.intensity=Ua.global.direct;const o=e[2],a=ge((Math.abs(o)-Ua.local.altitude)/(Ua.global.altitude-Ua.local.altitude),0,1);let l;if(n.globalFactor=a,t!=null&&(l=uw.getTimes(t,e[1],e[0])),a<1){let c;if(t!=null)c=ZKe(t,l,i);else{const h=Gxe(i);c={direct:{intensity:Ua.local.directAtNoon*h.direct,color:Oe(1,1,1)},ambient:{intensity:Ua.local.ambientAtNoon*h.ambient,color:Oe(1,1,1)},timeOfDay:"early afternoon"}}Br(n.ambient.color,c.ambient.color,n.ambient.color,a),n.ambient.intensity=wt(c.ambient.intensity,n.ambient.intensity,a),Br(n.direct.color,c.direct.color,n.direct.color,a),n.direct.intensity=wt(c.direct.intensity,n.direct.intensity,a),n.specularStrength=i==="rainy"||i==="snowy"||i==="foggy"?0:1,n.environmentStrength=i==="rainy"?.7:i==="snowy"||i==="foggy"?.75:1}n.noonFactor=t!=null?WKe(t,l):1,t!=null?BKe(t,e,r,n.direct.directionToLightSource):zxe(s,r,n.direct.directionToLightSource)}function zxe(t,e,r){e===De.Global?me(E8,t.eye):se(E8,0,0,1),te(C8,t.viewForward,-1);const i=UL(C8,E8),s=Math.max(i-2*A8,0),n=.85*s/(s+1),o=Math.max(A8,i-A8-n);mu(pse,-o,t.viewRight),$e(r,C8,pse),ce(r,r,te(XKe,t.viewRight,YKe)),me(r,r)}function BKe(t,e,r,i){const s=qKe,n=Rh(HKe);if(r===De.Global)uw.getPosition(t,0,0,s),se(i,0,0,-1),u2(n,n,-s.azimuth),l5(n,n,-s.altitude),$e(i,i,n);else{const o=Ua.planarDirection,a=o.globalAngles,l=e[2];let c=(Math.abs(l)-o.localAltitude)/(o.globalAltitude-o.localAltitude);c=ge(c,0,1),c<1?(uw.getPosition(t,e[1],e[0],s),s.azimuth=(1-c)*s.azimuth+c*a.azimuth,s.altitude=(1-c)*s.altitude+c*a.altitude):(s.azimuth=a.azimuth,s.altitude=a.altitude),se(i,0,-1,0),h2(n,n,-s.azimuth),u2(n,n,-s.altitude),$e(i,i,n)}}function GKe(t,e){if(e===De.Global)return!0;const r=Ua.planarDirection;return Math.abs(t)<r.localAltitude}const jKe=Oe(.5773502691896258,-.5773502691896258,.5773502691896258);let Bxe=class{constructor(){this.ambient={color:Oe(1,1,1),intensity:.55},this.direct={color:Oe(1,1,1),intensity:.55,directionToLightSource:$s(jKe)},this.noonFactor=.5,this.globalFactor=0,this.specularStrength=1,this.environmentStrength=1}};const HKe=be(),qKe={azimuth:0,altitude:0};function WKe(t,e){const r=t.valueOf();let i,s;e.polarException===uw.PolarException.MIDNIGHT_SUN?(i=r-60*(t.getHours()+48)*60*1e3-60*t.getMinutes()*1e3,s=i+432e6):e.polarException===uw.PolarException.POLAR_NIGHT?(i=r-2,s=r-1):(i=e.sunrise.valueOf(),s=e.sunset.valueOf());const n=i+(s-i)/2;return 1-ge(Math.abs(r-n)/432e5,0,1)}function Gxe(t){switch(t){case"disabled":case"sunny":case"cloudy":return new BM(1,1);case"rainy":return new BM(.4,1.2);case"snowy":return new BM(.5,1.3);case"foggy":return new BM(.2,1.6)}}function ise(t,e){const r=(t[0]+t[1]+t[2])/3;t[0]+=(r-t[0])*e,t[1]+=(r-t[1])*e,t[2]+=(r-t[2])*e}const x8=Oe(.01,.01,.01),Dj=Oe(1,.6,.5),Nj=Oe(1,.98,.98),sse=Oe(1,1,1),T8=Oe(.8,.8,1),Fj=Oe(.8,.8,1),Uj=Oe(.98,.98,1),nse=Oe(1,1,1),S8=dr(.01,Ua.local.ambientAtNight),kj=dr(Ua.local.directAtTwilight,Ua.local.ambientAtTwilight),Vj=dr(.9*Ua.local.directAtNoon,Ua.local.ambientAtNoon),ose=dr(Ua.local.directAtNoon,Ua.local.ambientAtNoon),ase=Vj,lse=Nj,cse=Uj,use=kj,hse=Dj,dse=Fj;function ZKe(t,e,r){const i=t.valueOf();let s,n;e.polarException===uw.PolarException.MIDNIGHT_SUN?(s=i-60*(t.getHours()+48)*60*1e3-60*t.getMinutes()*1e3,n=s+432e6):e.polarException===uw.PolarException.POLAR_NIGHT?(s=i-2,n=i-1):(s=e.sunrise.valueOf(),n=e.sunset.valueOf());const o=n-s,a=s+o/2,l=o/4,c=a-l,h=a+l,p=.06*o,f=s-p/2,m=s+p/2,y=n-p/2,_=n+p/2,v=Ve(),w=C(),x=C();let T="";if(i<f||i>_)fn(v,S8),ie(w,x8),ie(x,T8),T="night";else if(i<m){const A=(i-f)/(m-f);nh(v,S8,kj,A),Br(w,x8,Dj,A),Br(x,T8,Fj,A),T="sun rising"}else if(i<c){const A=(i-m)/(c-m);nh(v,kj,Vj,A),Br(w,Dj,Nj,A),Br(x,Fj,Uj,A),T="early morning"}else if(i<a){const A=(i-c)/(a-c);nh(v,Vj,ose,A),Br(w,Nj,sse,A),Br(x,Uj,nse,A),T="late morning"}else if(i<h){const A=(i-a)/(h-a);nh(v,ose,ase,A),Br(w,sse,lse,A),Br(x,nse,cse,A),T="early afternoon"}else if(i<y){const A=(i-h)/(y-h);nh(v,ase,use,A),Br(w,lse,hse,A),Br(x,cse,dse,A),T="late afternoon"}else if(i<_){const A=(i-y)/(_-y);nh(v,use,S8,A),Br(w,hse,x8,A),Br(x,dse,T8,A),T="sun setting"}let S=0;switch(r){case"rainy":case"foggy":S=.8;break;case"snowy":S=.5}S>0&&(ise(w,S),ise(x,S));const O=Gxe(r);return{direct:{intensity:v[0]*O.direct,color:w},ambient:{intensity:v[1]*O.ambient,color:x},timeOfDay:T}}const pse=be(),E8=C(),C8=C(),XKe=C(),A8=.25,YKe=.2;let _d=class extends os.EventedAccessor{constructor(){super(),this._referencePointUpdateDelay=200,this._referencePointUpdateInterval=3e3,this._referencePointUpdateDistThreshold=1e6,this._referencePosUpdateQuery=null,this._referencePosMapCoordsRequested=null,this._viewHandles=new Oi,this._preserveAbsoluteDateTime=!1,this._trackingEnabled=!1,this._referencePosResetPreserveAbsoluteTime=!1,this._referencePosUpdateTimer=null,this._referencePosMapCoords=null,this._mainLight=new s4,this._ambientLight=new NX,this._moonLight=new exe,this.disableQueries=!1,this._disableWeather=!1,this._renderer=null,this._referencePosWGS84Comparable=null,this._resetReferencePosition()}destroy(){this.disconnectView(),this._viewHandles.destroy()}get _view(){return this._renderer?.view}get updating(){return!((this.disableQueries||!this._referencePosUpdateQuery&&!this._referencePosMapCoordsRequested)&&!this._renderer?.updating)}get weatherEnabled(){return this._view?.environment.atmosphereEnabled&&!this._disableWeather&&this._view?.state?.viewingMode===De.Global&&_O(this._view.spatialReference)}get weatherVisible(){return this.weatherEnabled&&this._renderer?.weatherVisible}get referencePositionWGS84Comparable(){return this._referencePosWGS84Comparable}connectView(e){if(this._renderer)return;this._renderer=new Oo({view:e});const r=()=>this._updateRenderParameters(),i=()=>this._cameraHandler();this._viewHandles.add([le(()=>e.environment.lighting,s=>this._updateLightingHandler(s),jr),le(()=>e.environment.lighting.type!=="virtual"?e.environment.lighting.date:null,s=>this._lightingDateHandler(s),jr),le(()=>e.stationary,()=>this._interactingStationaryHandler()),le(()=>e.environment.lighting.directShadowsEnabled,r,jr),le(()=>e.qualitySettings.ambientOcclusion,r,jr),le(()=>e.qualitySettings.reflections,r,jr),le(()=>e.environment.background?.color,r,jr),le(()=>e.spatialReference,()=>this._resetReferencePosition(!0),jr),le(()=>e.environment.weather.type,()=>this._updateLighting(null,US.Faded),jr),le(()=>this.weatherEnabled,()=>this._updateLighting(null,US.Faded),jr),le(()=>e.viewingMode,()=>this._resetReferencePosition(!0),As),le(()=>e.environment.lighting.type!=="virtual"&&e.environment.lighting.cameraTrackingEnabled,s=>this._updateCameraTracking(s),As),le(()=>e.state.camera,i,As),le(()=>this.disableQueries,i)]),this._updateRenderParameters(),this._updateLighting(),this._cameraHandler(),this.notifyChange("updating")}disconnectView(){this._viewHandles.removeAll(),this._resetReferencePosition(),this._renderer=Me(this._renderer)}_updateLightingHandler(e){this._updateCameraTracking(e.type!=="virtual"&&e.cameraTrackingEnabled),this._lightingDateHandler(e.type!=="virtual"?e.date:null),this._updateRenderParameters()}_updateCameraTracking(e){if(this._trackingEnabled=e,e)this._cameraHandler();else{const r=this._view.environment.lighting;r?.type!=="virtual"&&(r.positionTimezoneInfo.autoUpdated=!1)}}_lightingDateHandler(e){const r=this._view.environment.lighting;if(r?.type!=="virtual"){if(e){if(!r.positionTimezoneInfo.autoUpdated){this._preserveAbsoluteDateTime=!0;const i=this._view.spatialReference;if(!$_(i)){const s=this._view.camera.position;if(!this._referencePosMapCoords||!this._referencePosMapCoords.equals(s))return void this._requestReferencePositionUpdate(s)}if(this._preupdateTracking(e),this._referencePosWGS84Comparable!=null){const s=Kie(this._referencePosWGS84Comparable,fse);s!=null&&(r.autoUpdate(null,s),this._trackingEnabled&&(r.positionTimezoneInfo.autoUpdated=!0))}}this._updateLighting(e)}}else this._updateLighting()}_preupdateTracking(e){!this._trackingEnabled&&this._view.environment.lighting.type!=="virtual"&&this._view.environment.lighting.cameraTrackingEnabled&&this._cameraHandler(e)}_cameraHandler(e=null){const r=this._view;if(!r.ready)return;const i=r.stateManager.camera;i&&(this._cameraHandlerClientSide(i,e)||this._cameraHandlerServerSide(i))}_cameraHandlerClientSide(e,r){const i=_O(this._view.spatialReference);if(i&&!$_(this._view.spatialReference))return this._view.environment.lighting.type==="virtual"&&this._updateLighting(),!1;const s=e.position;return this._referencePosWGS84Comparable==null&&(this._referencePosWGS84Comparable=C()),i?F_e(s,this._referencePosWGS84Comparable):se(this._referencePosWGS84Comparable,s.longitude??0,s.latitude??0,s.z??0),this.notifyChange("referencePositionWGS84Comparable"),this._autoUpdateTimezone(this._referencePosWGS84Comparable,r)||this._updateLighting(r),!0}_cameraHandlerServerSide(e){const r=e.position;(!this._referencePosMapCoords||this._referencePosMapCoordsRequested||this._exceedsReferencePosDistThreshold(r))&&this._requestReferencePositionUpdate(r,!0),this._view.mapCoordsHelper&&this._referencePosWGS84Comparable&&(this._referencePosWGS84Comparable[2]=(r.z??0)*this._view.mapCoordsHelper.unitInMeters,this._referencePosChanged())}_interactingStationaryHandler(){this._view.stationary&&this._executePendingReferencePositionUpdate()}_updateLighting(e,r=US.Immediate){const i=this._view;e=e||(i.environment.lighting.type==="virtual"?null:i.environment.lighting.date);const s=this._referencePosWGS84Comparable,n=s!=null?JKe:QKe,o=this.weatherVisible?i.environment.weather.type:"disabled";s!=null?zKe(e,s,i.state.viewingMode,o,i.state.camera,n):i.environment.lighting.type==="virtual"&&zxe(i.state.camera,i.state.viewingMode,n.direct.directionToLightSource);const a=this._mainLight,l=n.direct;te(a.intensity,l.color,l.intensity*Math.PI),ie(a.direction,l.directionToLightSource),a.specularStrength=n.specularStrength,a.environmentStrength=n.environmentStrength;const c=this._ambientLight;te(c.intensity,n.ambient.color,n.ambient.intensity);const h=this._moonLight;Br(h.intensity,eet,tet,n.globalFactor);const p=(1-.5*n.globalFactor)*(1-.4*n.noonFactor*(1-n.globalFactor));te(h.intensity,h.intensity,p),ie(h.direction,l.directionToLightSource),this._renderer.updateLightSources([a,c,h],n.noonFactor,n.globalFactor,r),this._updateRenderParameters()}_autoUpdateTimezone(e,r=null){if(this._view.environment.lighting.type==="virtual"||!this._view.environment.lighting.cameraTrackingEnabled||e==null)return!1;const i=KKe;i.setTime((r||this._view.environment.lighting.date).getTime());const s=Kie(e,fse);if(s==null)return!1;let n=this._view.environment.lighting.positionTimezoneInfo;if(n.autoUpdated){if(n.hours===s.hours&&n.minutes===s.minutes&&n.seconds===s.seconds)return!1}else n=s;const o=i.getUTCHours()-(s.hours-n.hours),a=i.getUTCMinutes()-(s.minutes-n.minutes),l=i.getUTCSeconds()-(s.seconds-n.seconds);return i.setUTCHours(o),i.setUTCMinutes(a),i.setUTCSeconds(l),!r&&this._view.environment.lighting.autoUpdate(i,s)}_updateRenderParameters(){const e=this._view._stage;if(!e)return;const r=this._referencePosWGS84Comparable==null||GKe(this._referencePosWGS84Comparable[2],this._view.state.viewingMode),i=this._view.environment.background,s=i instanceof dwe?{type:"color",color:cZ(ze.toUnitRGBA(i.color))}:{type:"color",color:Lt(0,0,0,1)};e.renderer.setParameters({shadowMap:this._view.environment.lighting.directShadowsEnabled&&r,background:s,environment:this._view.environment,weatherVisible:this._view.environmentManager.weatherVisible,qualitySettings:this._view.qualitySettings})}_resetReferencePosition(e=!1){this._cancelReferencePosUpdates(),this._referencePosMapCoords=null,this._referencePosMapCoordsRequested=null,this._referencePosResetPreserveAbsoluteTime=null,this._referencePosWGS84Comparable=null,this.notifyChange("updating"),e&&this._cameraHandler()}_requestReferencePositionUpdate(e,r=!1){if(!this.disableQueries&&(this._referencePosMapCoordsRequested?this._referencePosMapCoordsRequested.copy(e):this._referencePosMapCoordsRequested=e.clone(),this._referencePosResetPreserveAbsoluteTime=!!r,!this._referencePosUpdateQuery&&!this._referencePosUpdateTimer&&this._view.stationary)){const i=this._referencePosUpdateQuery=pO(this._referencePointUpdateDelay).then(()=>{if(this._referencePosUpdateQuery===i){const n=()=>this._referencePosUpdateQuery!==i;return this._doReferencePositionUpdateQuery(n)}}).catch(n=>{n.name==="mapcoordshelper:missing-geometry-service"&&(this.disableQueries=!0)}).then(()=>{this._referencePosUpdateQuery===i&&(this._referencePosUpdateQuery=null,this._referencePosUpdateTimer||this._executePendingReferencePositionUpdate(),this.notifyChange("updating"))}),s=this._referencePosUpdateTimer=pO(this._referencePointUpdateInterval).then(()=>{this._referencePosUpdateTimer===s&&(this._referencePosUpdateTimer=null,this._referencePosUpdateQuery||this._executePendingReferencePositionUpdate())});this.notifyChange("updating")}}async _doReferencePositionUpdateQuery(e){this._referencePosResetPreserveAbsoluteTime&&(this._preserveAbsoluteDateTime=!1),this._referencePosMapCoords?this._referencePosMapCoords.copy(this._referencePosMapCoordsRequested):this._referencePosMapCoords=this._referencePosMapCoordsRequested.clone(),this._referencePosResetPreserveAbsoluteTime=null,this._referencePosMapCoordsRequested=null;const r=await this._view.mapCoordsHelper.toGeographic(this._referencePosMapCoords);if(!e()&&!isNaN(r[0])&&!isNaN(r[1])){const i=(this._referencePosMapCoords.z??0)*this._view.mapCoordsHelper.unitInMeters;this._referencePosWGS84Comparable?(this._referencePosWGS84Comparable[0]=r[0],this._referencePosWGS84Comparable[1]=r[1],this._referencePosWGS84Comparable[2]=i):this._referencePosWGS84Comparable=[r[0],r[1],i],this._referencePosChanged()}}_executePendingReferencePositionUpdate(){const e=this._referencePosMapCoordsRequested;e&&this._requestReferencePositionUpdate(e,this._referencePosResetPreserveAbsoluteTime)}_referencePosChanged(){this._preserveAbsoluteDateTime?this._updateLighting():this._autoUpdateTimezone(this._referencePosWGS84Comparable)||this._updateLighting(),this.notifyChange("referencePositionWGS84Comparable")}_exceedsReferencePosDistThreshold(e){if(this._referencePosMapCoords){let r=this._referencePosMapCoords.distance(e);return this._view.mapCoordsHelper&&(r*=this._view.mapCoordsHelper.unitInMeters),r>this._referencePointUpdateDistThreshold}return!0}_cancelReferencePosUpdates(){const e=!!this._referencePosUpdateQuery;return this._referencePosUpdateQuery=null,this._referencePosUpdateTimer=null,e}get test(){const e=this;return{get renderer(){return e._renderer},set referencePointUpdateInterval(r){e._referencePointUpdateInterval=r},set referencePointUpdateDistThreshold(r){e._referencePointUpdateDistThreshold=r},set referencePosUpdateTimer(r){e._referencePosUpdateTimer=r},set referencePointUpdateDelay(r){e._referencePointUpdateDelay=r},set disableWeather(r){e._disableWeather=r}}}};u([d({type:Boolean,readOnly:!0})],_d.prototype,"updating",null),u([d()],_d.prototype,"disableQueries",void 0),u([d()],_d.prototype,"_disableWeather",void 0),u([d()],_d.prototype,"weatherEnabled",null),u([d()],_d.prototype,"weatherVisible",null),u([d()],_d.prototype,"referencePositionWGS84Comparable",null),u([d()],_d.prototype,"_renderer",void 0),u([d()],_d.prototype,"_referencePosWGS84Comparable",void 0),_d=u([R("esri.views.3d.environment.SceneViewEnvironmentManager")],_d);const JKe=new Bxe,QKe=new Bxe,KKe=new Date,fse={hours:0,minutes:0,seconds:0},eet=Oe(.22,.22,.33),tet=Oe(.22,.22,.22);var Ai;(function(t){t[t.NONE=0]="NONE",t[t.TILT=1]="TILT",t[t.ALTITUDE=2]="ALTITUDE",t[t.DISTANCE=4]="DISTANCE",t[t.COLLISION=8]="COLLISION",t[t.ALL=15]="ALL",t[t.ALL_EXCEPT_COLLISION=7]="ALL_EXCEPT_COLLISION"})(Ai||(Ai={}));var Zt;(function(t){t[t.NONE=0]="NONE",t[t.ZOOM=1]="ZOOM",t[t.TUMBLE=2]="TUMBLE",t[t.LOOK_AROUND=3]="LOOK_AROUND",t[t.PAN=4]="PAN",t[t.ASCEND=5]="ASCEND"})(Zt||(Zt={}));var Jn;(function(t){t[t.TUMBLE=0]="TUMBLE",t[t.LOOK_AROUND=1]="LOOK_AROUND"})(Jn||(Jn={}));function XO(t,e){return(t&e)!=0}function h4(t,e,r,i,s,n){t!==0&&(r?(n.min=Math.min(n.min,e),n.max=Math.max(n.max,e)):i!=null?(n.min-=Math.max(0,(e-n.min)*(1-i)),n.max+=Math.max(0,(e-n.max)*(1-i))):s&&(n.min-=Math.max(0,e-n.min-s),n.max+=Math.max(0,e-n.max-s)))}const k_={selection:Ai.NONE,interactionType:Zt.NONE,interactionFactor:0,interactionStartCamera:null,interactionDirection:null,tiltMode:Jn.TUMBLE};function jxe(t,e,r,i){return e=e||t.viewForward,ie(i,e),te(i,i,Math.sign(fe(e,r))),i}function ret(t,e,r,i){return aet(t,e,r,net(i,e,r,!0))}function iet(t,e,r,i){const s=fe(r,he(t,i,e));return ce(t,e,te(t,r,s))}const set={dir:C(),len:0,clip:Ve()};function net(t,e,r,i){const s=set;return t?(r&&i&&(s.len=di(e,r)),ie(s.dir,t)):i?(s.len=di(e,r),he(s.dir,r,e),te(s.dir,s.dir,1/s.len)):(he(s.dir,r,e),me(s.dir,s.dir)),s}function oet(t,e,r){const i=fe(t,r.dir),s=-hi(t,e);if(s<0&&i>=0)return!1;if(i>-1e-6&&i<1e-6)return s>0;if((s<0||i<0)&&!(s<0&&i<0))return!0;const n=s/i;return i>0?n<r.clip[1]&&(r.clip[1]=n):n>r.clip[0]&&(r.clip[0]=n),r.clip[0]<=r.clip[1]}function aet(t,e,r,i){i.clip[0]=0,i.clip[1]=r?i.len:Number.MAX_VALUE;for(let s=0;s<t.length;s++)if(!oet(t[s],e,i))return!1;return!0}function cet(t,e,r=k_){const i=ZX(t,e,r);if(i===0)return!1;const s=t.renderCoordsHelper,n=s.getAltitude(e.eye)+i,o=jxe(e,r.interactionDirection,det(t,e,Math.sign(i),get),met),a=ie(yet,e.viewForward),l=s.intersectInfiniteManifold(yu(e.eye,o),n,O8);return e.eye=l??s.setAltitude(O8,n,e.eye),e.center=iet(O8,e.eye,a,e.center),!0}function ZX(t,e,r=k_){if(!uet(t,r)||!t.state.constraints.altitude)return 0;const i=pet(t.state.constraints.altitude,fet);het(t,r,i);const s=t.renderCoordsHelper.getAltitude(e.eye),n=ge(s,i.min,i.max)-s;return Math.abs(n)<=1e-6?0:n}function uet(t,e){const r=t.state.constraints.altitude;return!(!t.state.isGlobal||!r)&&(e.interactionType!==Zt.TUMBLE||!XO(e.selection,Ai.TILT))}function het(t,e,r){const i=e.interactionType;if(i===Zt.NONE)return;const{min:s,max:n}=r,{interactionStartCamera:o,interactionFactor:a}=e;if(!o)return;const l=i===Zt.TUMBLE||i===Zt.ZOOM,c=ZX(t,o),h=c===0?0:t.renderCoordsHelper.getAltitude(o.eye);r.min=s,r.max=n,h4(c,h,l,a,.05*h,r)}function det(t,e,r,i){return t.renderCoordsHelper.worldUpAtPosition(e.eye,i),te(i,i,r),i}function pet(t,e){return e.min=t.min,e.max=t.max,e}const fet={min:0,max:0},met=C(),get=C(),yet=C(),O8=C();function XX(t,e,r=k_){if(!t.state.isLocal)return 0;const i=t.state.constraints.distance;if(!t.pointsOfInterest.surfaceOrigin.renderLocation||i===1/0)return 0;GM.min=0,GM.max=i,vet(t,r,GM);const s=YX(t,e),n=GM.max-s;return n>=-1e-6?0:n}function _et(t,e,r=k_){const i=XX(t,e,r);if(i===0)return!1;const s=t.pointsOfInterest.surfaceOrigin;if(!s.renderLocation)return!1;const n=YX(t,e)+i,o=ie(wet,e.eye),a=jxe(e,r.interactionDirection,bet(e,s.renderLocation,Eet),Tet);if(!Q_(obe(s.renderLocation,n),yu(e.eye,a),jM))return!1;e.eye=jM;const l=he(xet,e.eye,o);e.center=ce(jM,e.center,l);const c=t.renderCoordsHelper.getAltitude(e.center),h=t.renderCoordsHelper.intersectInfiniteManifold(e.ray,c,jM);return h!=null&&(e.center=h),!0}function vet(t,e,r){const i=e.interactionType;if(i===Zt.NONE)return;const{min:s,max:n}=r,{interactionStartCamera:o,interactionFactor:a}=e;if(!o)return;const l=i===Zt.ZOOM||i===Zt.PAN,c=XX(t,o),h=c===0?0:YX(t,o);r.min=s,r.max=n,h4(c,h,l,a,.05*h,r)}function YX(t,e){const r=t.pointsOfInterest.surfaceOrigin;return r.renderLocation?di(e.eye,r.renderLocation):0}function bet(t,e,r){return Hg(r,t.eye,e)}const GM={min:0,max:0},wet=C(),xet=C(),Tet=C(),Eet=C(),jM=C();var ki,vo;(function(t){t[t.OBJECT=0]="OBJECT",t[t.HUD=1]="HUD",t[t.TERRAIN=2]="TERRAIN",t[t.OVERLAY=3]="OVERLAY",t[t.I3S=4]="I3S",t[t.PCL=5]="PCL",t[t.LOD=6]="LOD",t[t.VOXEL=7]="VOXEL"})(ki||(ki={}));let Cet=class{constructor(){this.verticalOffset=0,this.selectionMode=!1,this.hud=!0,this.selectOpaqueTerrainOnly=!0,this.invisibleTerrain=!1,this.backfacesTerrain=!0,this.isFiltered=!1,this.filteredLayerUids=[],this.store=vo.ALL}};(function(t){t[t.MIN=0]="MIN",t[t.MINMAX=1]="MINMAX",t[t.ALL=2]="ALL"})(vo||(vo={}));let Aet=class{constructor(e,r,i){this.object=e,this.geometryId=r,this.triangleNr=i}},Oet=class extends Aet{constructor(e,r,i,s){super(e,r,i),this.center=s!=null?$s(s):null}},Hxe=class{constructor(e){this.layerUid=e}},X5=class extends Hxe{constructor(e,r){super(e),this.graphicUid=r}};function fp(t){return t!=null&&t.dist!=null}function mse(t){return(e,r,i)=>(Br(gse,e,r,i),!yX(t,gse))}function Y5(t){return fp(t)&&t.intersector===ki.OBJECT&&!!t.target}function J5(t){return fp(t)&&t.intersector===ki.HUD&&!!t.target&&"center"in t.target&&t.target.center!=null}const gse=C();let Ret=class{constructor(){this._transform=be(),this._transformInverse=new HM({value:this._transform},On,be),this._transformInverseTranspose=new HM(this._transformInverse,xc,be),this._transformTranspose=new HM({value:this._transform},xc,be),this._transformInverseRotation=new HM({value:this._transform},P1e,Li)}_invalidateLazyTransforms(){this._transformInverse.invalidate(),this._transformInverseTranspose.invalidate(),this._transformTranspose.invalidate(),this._transformInverseRotation.invalidate()}get transform(){return this._transform}get inverse(){return this._transformInverse.value}get inverseTranspose(){return this._transformInverseTranspose.value}get inverseRotation(){return this._transformInverseRotation.value}get transpose(){return this._transformTranspose.value}setTransformMatrix(e){Ls(this._transform,e)}multiplyTransform(e){si(this._transform,this._transform,e)}set(e){Ls(this._transform,e),this._invalidateLazyTransforms()}setAndInvalidateLazyTransforms(e,r){this.setTransformMatrix(e),this.multiplyTransform(r),this._invalidateLazyTransforms()}},HM=class{constructor(e,r,i){this._original=e,this._update=r,this._dirty=!0,this._transform=i()}invalidate(){this._dirty=!0}get value(){return this._dirty&&(this._update(this._transform,this._original.value),this._dirty=!1),this._transform}},Pet=class{constructor(e=0){this.offset=e,this.tmpVertex=C()}applyToVertex(e,r,i){const s=e+this.localOrigin[0],n=r+this.localOrigin[1],o=i+this.localOrigin[2],a=this.offset/Math.sqrt(s*s+n*n+o*o);return this.tmpVertex[0]=e+s*a,this.tmpVertex[1]=r+n*a,this.tmpVertex[2]=i+o*a,this.tmpVertex}applyToAabb(e){for(let n=0;n<3;++n)Ay[n]=e[0+n]+this.localOrigin[n],qM[n]=e[3+n]+this.localOrigin[n],QE[n]=Ay[n];const r=this.applyToVertex(Ay[0],Ay[1],Ay[2]);for(let n=0;n<3;++n)e[n]=r[n],e[n+3]=r[n];const i=n=>{const o=this.applyToVertex(n[0],n[1],n[2]);for(let a=0;a<3;++a)e[a]=Math.min(e[a],o[a]),e[a+3]=Math.max(e[a+3],o[a])};for(let n=1;n<8;++n){for(let o=0;o<3;++o)QE[o]=n&1<<o?qM[o]:Ay[o];i(QE)}let s=0;for(let n=0;n<3;++n)Ay[n]*qM[n]<0&&(s|=1<<n);if(s!==0&&s!==7){for(let n=0;n<8;++n)if(!(s&n)){for(let o=0;o<3;++o)QE[o]=s&1<<o?0:n&1<<o?Ay[o]:qM[o];i(QE)}}for(let n=0;n<3;++n)e[n]-=this.localOrigin[n],e[n+3]-=this.localOrigin[n];return e}};const Ay=C(),qM=C(),QE=C();let Met=class{constructor(e=0){this.componentLocalOriginLength=0,this._tmpVertex=C(),this._mbs=gs(),this._obb={center:C(),halfSize:Hi(),quaternion:null},this._totalOffset=0,this._offset=0,this._resetOffset(e)}_resetOffset(e){this._offset=e,this._totalOffset=e}set offset(e){this._resetOffset(e)}get offset(){return this._offset}set componentOffset(e){this._totalOffset=this._offset+e}set localOrigin(e){this.componentLocalOriginLength=Math.sqrt(e[0]*e[0]+e[1]*e[1]+e[2]*e[2])}applyToVertex(e,r,i){const s=e,n=r,o=i+this.componentLocalOriginLength,a=this._totalOffset/Math.sqrt(s*s+n*n+o*o);return this._tmpVertex[0]=e+s*a,this._tmpVertex[1]=r+n*a,this._tmpVertex[2]=i+o*a,this._tmpVertex}applyToAabb(e){const r=e[0],i=e[1],s=e[2]+this.componentLocalOriginLength,n=e[3],o=e[4],a=e[5]+this.componentLocalOriginLength,l=r*n<0?0:Math.min(Math.abs(r),Math.abs(n)),c=i*o<0?0:Math.min(Math.abs(i),Math.abs(o)),h=s*a<0?0:Math.min(Math.abs(s),Math.abs(a)),p=Math.sqrt(l*l+c*c+h*h);if(p<this._totalOffset)return e[0]-=r<0?this._totalOffset:0,e[1]-=i<0?this._totalOffset:0,e[2]-=s<0?this._totalOffset:0,e[3]+=n>0?this._totalOffset:0,e[4]+=o>0?this._totalOffset:0,e[5]+=a>0?this._totalOffset:0,e;const f=Math.max(Math.abs(r),Math.abs(n)),m=Math.max(Math.abs(i),Math.abs(o)),y=Math.max(Math.abs(s),Math.abs(a)),_=Math.sqrt(f*f+m*m+y*y),v=this._totalOffset/_,w=this._totalOffset/p;return e[0]+=r*(r>0?v:w),e[1]+=i*(i>0?v:w),e[2]+=s*(s>0?v:w),e[3]+=n*(n<0?v:w),e[4]+=o*(o<0?v:w),e[5]+=a*(a<0?v:w),e}applyToMbs(e){const r=Math.sqrt(e[0]*e[0]+e[1]*e[1]+e[2]*e[2]),i=this._totalOffset/r;return this._mbs[0]=e[0]+e[0]*i,this._mbs[1]=e[1]+e[1]*i,this._mbs[2]=e[2]+e[2]*i,this._mbs[3]=e[3]+e[3]*this._totalOffset/r,this._mbs}applyToObb(e){const r=e.center,i=this._totalOffset/Math.sqrt(r[0]*r[0]+r[1]*r[1]+r[2]*r[2]);this._obb.center[0]=r[0]+r[0]*i,this._obb.center[1]=r[1]+r[1]*i,this._obb.center[2]=r[2]+r[2]*i,yc(this._obb.halfSize,e.halfSize,e.quaternion),ce(this._obb.halfSize,this._obb.halfSize,e.center);const s=this._totalOffset/Math.sqrt(this._obb.halfSize[0]*this._obb.halfSize[0]+this._obb.halfSize[1]*this._obb.halfSize[1]+this._obb.halfSize[2]*this._obb.halfSize[2]);return this._obb.halfSize[0]+=this._obb.halfSize[0]*s,this._obb.halfSize[1]+=this._obb.halfSize[1]*s,this._obb.halfSize[2]+=this._obb.halfSize[2]*s,he(this._obb.halfSize,this._obb.halfSize,e.center),Bf(bse,e.quaternion),yc(this._obb.halfSize,this._obb.halfSize,bse),this._obb.halfSize[0]*=this._obb.halfSize[0]<0?-1:1,this._obb.halfSize[1]*=this._obb.halfSize[1]<0?-1:1,this._obb.halfSize[2]*=this._obb.halfSize[2]<0?-1:1,this._obb.quaternion=e.quaternion,this._obb}},Iet=class{constructor(e=0){this.offset=e,this.sphere=gs(),this.tmpVertex=C()}applyToVertex(e,r,i){const s=this.objectTransform.transform;let n=s[0]*e+s[4]*r+s[8]*i+s[12],o=s[1]*e+s[5]*r+s[9]*i+s[13],a=s[2]*e+s[6]*r+s[10]*i+s[14];const l=this.offset/Math.sqrt(n*n+o*o+a*a);n+=n*l,o+=o*l,a+=a*l;const c=this.objectTransform.inverse;return this.tmpVertex[0]=c[0]*n+c[4]*o+c[8]*a+c[12],this.tmpVertex[1]=c[1]*n+c[5]*o+c[9]*a+c[13],this.tmpVertex[2]=c[2]*n+c[6]*o+c[10]*a+c[14],this.tmpVertex}applyToMinMax(e,r){const i=this.offset/Math.sqrt(e[0]*e[0]+e[1]*e[1]+e[2]*e[2]);e[0]+=e[0]*i,e[1]+=e[1]*i,e[2]+=e[2]*i;const s=this.offset/Math.sqrt(r[0]*r[0]+r[1]*r[1]+r[2]*r[2]);r[0]+=r[0]*s,r[1]+=r[1]*s,r[2]+=r[2]*s}applyToAabb(e){const r=this.offset/Math.sqrt(e[0]*e[0]+e[1]*e[1]+e[2]*e[2]);e[0]+=e[0]*r,e[1]+=e[1]*r,e[2]+=e[2]*r;const i=this.offset/Math.sqrt(e[3]*e[3]+e[4]*e[4]+e[5]*e[5]);return e[3]+=e[3]*i,e[4]+=e[4]*i,e[5]+=e[5]*i,e}applyToBoundingSphere(e){const r=Math.sqrt(e[0]*e[0]+e[1]*e[1]+e[2]*e[2]),i=this.offset/r;return this.sphere[0]=e[0]+e[0]*i,this.sphere[1]=e[1]+e[1]*i,this.sphere[2]=e[2]+e[2]*i,this.sphere[3]=e[3]+e[3]*this.offset/r,this.sphere}};const yse=new Iet;function zj(t){return t!=null?(yse.offset=t,yse):null}const _se=new Met;function $et(t){return t!=null?(_se.offset=t,_se):null}const vse=new Pet;function Let(t){return t!=null?(vse.offset=t,vse):null}const z0="terrain",bse=Fh(),O2=1e-5;let Det=class{constructor(e){this.options=new Cet,this._results=new Net,this.transform=new Ret,this.tolerance=O2,this.verticalOffset=null,this._ray=Xn(),this._rayEnd=C(),this._rayBeginTransformed=C(),this._rayEndTransformed=C(),this.viewingMode=e??De.Global}get results(){return this._results}get ray(){return this._ray}get rayBegin(){return this._ray.origin}get rayEnd(){return this._rayEnd}reset(e,r,i){this.resetWithRay(dWe(e,r,this._ray),i)}resetWithRay(e,r){this.camera=r,e!==this._ray&&XN(e,this._ray),this.options.verticalOffset!==0?this.viewingMode===De.Local?this._ray.origin[2]-=this.options.verticalOffset:this.verticalOffset=this.options.verticalOffset:this.verticalOffset=null,ce(this._rayEnd,this._ray.origin,this._ray.direction),this._results.init(this._ray)}intersect(e=null,r,i,s,n){this.point=r,this.filterPredicate=s,this.tolerance=i??O2;const o=zj(this.verticalOffset);if(e&&e.length>0){const a=n?l=>{n(l)&&this.intersectObject(l)}:l=>{this.intersectObject(l)};for(const l of e){const c=l.getSpatialQueryAccelerator&&l.getSpatialQueryAccelerator();c!=null?(o!=null?c.forEachAlongRayWithVerticalOffset(this._ray.origin,this._ray.direction,a,o):c.forEachAlongRay(this._ray.origin,this._ray.direction,a),this.options.selectionMode&&this.options.hud&&c.forEachDegenerateObject(a)):l.objects.forAll(h=>a(h))}}this.sortResults()}intersectObject(e){const r=e.geometries;if(!r)return;const i=e.shaderTransformation,s=zj(this.verticalOffset);for(const n of r){if(!n.visible)continue;const{material:o,id:a}=n;this.transform.setAndInvalidateLazyTransforms(i,n.shaderTransformation),$e(this._rayBeginTransformed,this.rayBegin,this.transform.inverse),$e(this._rayEndTransformed,this.rayEnd,this.transform.inverse);const l=this.transform.transform;s!=null&&(s.objectTransform=this.transform),o.intersect(n,this.transform.transform,this,this._rayBeginTransformed,this._rayEndTransformed,(c,h,p,f,m,y)=>{if(c>=0){if(this.filterPredicate!=null&&!this.filterPredicate(this._ray.origin,this._rayEnd,c))return;const _=f?this._results.hud:this._results,v=f?w=>{const x=new Oet(e,a,p,y);w.set(ki.HUD,x,c,h,un,m)}:w=>w.set(ki.OBJECT,{object:e,geometryId:a,triangleNr:p},c,h,l,m);if((_.min.drapedLayerOrder==null||m>=_.min.drapedLayerOrder)&&(_.min.dist==null||c<_.min.dist)&&v(_.min),this.options.store!==vo.MIN&&(_.max.drapedLayerOrder==null||m<_.max.drapedLayerOrder)&&(_.max.dist==null||c>_.max.dist)&&v(_.max),this.options.store===vo.ALL)if(f){const w=new Bj(this._ray);v(w),this._results.hud.all.push(w)}else{const w=new kS(this._ray);v(w),this._results.all.push(w)}}})}}sortResults(e=this._results.all){e.sort((r,i)=>r.dist!==i.dist?(r.dist??0)-(i.dist??0):r.drapedLayerOrder!==i.drapedLayerOrder?(r.drapedLayerOrder??Number.MAX_VALUE)-(i.drapedLayerOrder??Number.MAX_VALUE):(i.drapedLayerGraphicOrder??Number.MIN_VALUE)-(r.drapedLayerGraphicOrder??Number.MIN_VALUE))}};function Dh(t){return new Det(t)}let Net=class{constructor(){this.min=new kS(Xn()),this.max=new kS(Xn()),this.hud={min:new Bj(Xn()),max:new Bj(Xn()),all:new Array},this.ground=new kS(Xn()),this.all=[]}init(e){this.min.init(e),this.max.init(e),this.ground.init(e),this.all.length=0,this.hud.min.init(e),this.hud.max.init(e),this.hud.all.length=0}},kS=class{get ray(){return this._ray}get distanceInRenderSpace(){return this.dist!=null?(te(WM,this.ray.direction,this.dist),Ce(WM)):null}getIntersectionPoint(e){return!!fp(this)&&(te(WM,this.ray.direction,this.dist),ce(e,this.ray.origin,WM),!0)}getTransformedNormal(e){return ie(KE,this.normal),KE[3]=0,su(KE,KE,this.transformation),ie(e,KE),me(e,e)}constructor(e){this.intersector=ki.OBJECT,this.normal=C(),this.transformation=be(),this._ray=Xn(),this.init(e)}init(e){this.dist=null,this.target=null,this.drapedLayerOrder=null,this.drapedLayerGraphicOrder=null,this.intersector=ki.OBJECT,XN(e,this._ray)}set(e,r,i,s,n,o,a){this.intersector=e,this.dist=i,ie(this.normal,s??tW),Ls(this.transformation,n??un),this.target=r,this.drapedLayerOrder=o,this.drapedLayerGraphicOrder=a}copy(e){XN(e.ray,this._ray),this.intersector=e.intersector,this.dist=e.dist,this.target=e.target,this.drapedLayerOrder=e.drapedLayerOrder,this.drapedLayerGraphicOrder=e.drapedLayerGraphicOrder,ie(this.normal,e.normal),Ls(this.transformation,e.transformation)}},Bj=class extends kS{constructor(){super(...arguments),this.intersector=ki.HUD}};function JX(t){return new kS(t)}const WM=C(),KE=Wt();function qxe(t,e,r,i){return t.renderCoordsHelper.fromRenderCoords(e.eye,d4,i)!=null&&Nfe(r,d4)}function Q5(t,e){return t.elevationProvider?t.elevationProvider.getElevation(e[0],e[1],e[2],t.renderCoordsHelper.spatialReference,"ground")??0:0}function kw(t,e,r,i){const s=t.state.camera.clone();e&&r&&i&&(s.eye=e,s.center=r,s.up=i),Fet(t,s.ray,Oy)||ie(Oy,s.center);const n=t.state.constraints,o=n.minimumPoiDistance;if(yo(s.eye,Oy)<o){const a=n.collision.enabled;ie(vv,s.viewForward),te(vv,vv,o),a?s.eye=he(d4,Oy,vv):ce(Oy,s.eye,vv);const l=t.renderCoordsHelper,c=l.getAltitude(s.eye),h=n.collision.elevationMargin;a&&c<h&&(he(vv,Oy,s.eye),s.eye=l.setAltitude(d4,h,s.eye),ce(Oy,s.eye,vv))}return s.center=Oy,s}function wse(t,e,r){if(!t.state.isGlobal||!t.stateManager.constraintsManager)return!1;const i=Q5(t,e),s=t.stateManager.constraintsManager.nearFarHeuristic,{far:n}=s.compute(e,r,t.renderDataExtent,i,ket),o=n*n;return yo(e,r)>o}function Fet(t,e,r){let i=xse[t.viewingMode];i||(i=Dh(t.state.viewingMode),i.options.backfacesTerrain=!t.state.isGlobal,i.options.invisibleTerrain=!0,xse[t.viewingMode]=i);const{isGlobal:s}=t.state;return!(!t.sceneIntersectionHelper.intersectRay(e,i,r)||wse(t,e.origin,r))||!(!t.renderCoordsHelper.intersectManifold(e,0,r)||wse(t,e.origin,r))||!!s&&Uet(e,r,Nr(t.spatialReference).radius)}function Uet(t,e,r){const i=fe(t.origin,t.origin)-r*r,s=i>0?Math.sqrt(i)/3:1;return te(e,t.direction,s/Ce(t.direction)),ce(e,e,t.origin),!0}const xse={},d4=C(),Oy=C(),vv=C(),ket={near:0,far:0};function _E(t,e,r=yh.EYE){const i=t.state.constraints;if(!i.collision.enabled)return!1;const s=Q5(t,e.eye),n=t.renderCoordsHelper.getAltitude(e.eye),o=s+i.collision.elevationMargin;if(n>=o)return!1;const a=Ce(e.eye);if(he(ZM,e.center,e.eye),e.eye=t.renderCoordsHelper.setAltitude(Vet,o,e.eye),r===yh.EYE_AND_CENTER)e.center=ce(ZM,e.eye,ZM);else if(r===yh.EYE_AND_CENTER_SCALE){const l=(a-n+o)/a;e.center=te(ZM,e.center,l)}return!0}var yh;(function(t){t[t.EYE=0]="EYE",t[t.EYE_AND_CENTER=1]="EYE_AND_CENTER",t[t.EYE_AND_CENTER_SCALE=2]="EYE_AND_CENTER_SCALE"})(yh||(yh={}));const ZM=C(),Vet=C();function V_(t,e,r){t.worldUpAtPosition(e,Tse),he(R8,r,e);const i=Ce(R8);return i===0?0:Pn(fe(R8,Tse)/i)}const Tse=C(),R8=C();function Wxe(t,e,r=k_,i=!0){eC.eyeCenterDistance=0,eC.requiresTwoSteps=!1;const s=QX(t,e,r,void 0,eC);if(s===0)return!1;switch(mu(XM,-s,e.viewRight),r.tiltMode){case Jn.LOOK_AROUND:$e(Ry,e.viewForward,XM),te(Ry,Ry,eC.eyeCenterDistance),e.center=ce(B0,e.eye,Ry);break;case Jn.TUMBLE:he(Ry,e.center,e.eye),$e(Ry,Ry,XM),e.eye=he(B0,e.center,Ry);break;default:r.tiltMode}return e.up=$e(B0,e.up,XM),!eC.requiresTwoSteps||!i||Wxe(t,e,r,!1)}function QX(t,e,r=k_,i=k_,s){if(!t.state.constraints.tilt)return 0;const n=e.distance,o=t.state.constraints.tilt(n,Yet);return Xet(t,r,o),i.interactionType===Zt.TUMBLE&&XO(i.selection,Ai.ALTITUDE)&&Zxe(t,i.interactionStartCamera,o),r.tiltMode===Jn.LOOK_AROUND||i.tiltMode===Jn.LOOK_AROUND?Bet(t,e,o,s):zet(t,e,o)}function zet(t,e,r){const i=V_(t.renderCoordsHelper,e.center,e.eye),s=i-ge(i,r.min,r.max);return YO(s)?s:0}function Bet(t,e,r,i){switch(i&&(i.requiresTwoSteps=!1),t.viewingMode){case"global":return jet(t,e,r,i);case"local":return Get(t,e,r,i)}}function Get(t,e,r,i){const s=V_(t.renderCoordsHelper,e.center,e.eye),n=ge(s,r.min,r.max),o=s-n;if(!YO(o))return 0;if(i){const a=t.pointsOfInterest.centerOnSurfaceFrequent.estimatedSurfaceAltitude,l=t.renderCoordsHelper.getAltitude(e.eye)-a,c=Math.cos(n);Math.abs(c)>1e-4?i.eyeCenterDistance=l/c:i.eyeCenterDistance=e.distance}return o}function jet(t,e,r,i){const s=Het(t,e,Jet),n=ge(s.tiltAtCenter,r.min,r.max);if(!YO(s.tiltAtCenter-n))return 0;let o,a;return s.centerIsOnSurface?(o=qet(s),a=Wet(s,o)):(o=s.constraints.clampTilt(s.eyeCenterDistance,s.tiltAtCenter),i&&o<Math.PI/2&&(i.requiresTwoSteps=!0,o=Math.PI/2-1e-5),a=Zet(s,o)),i&&(i.eyeCenterDistance=Gj(s,o)),a}function Het(t,e,r){const i=t.pointsOfInterest.centerOnSurfaceFrequent.estimatedSurfaceAltitude,s=i+Nr(t.spatialReference).radius,n=t.renderCoordsHelper.intersectManifold(e.ray,i,B0);return r.eyeCenterDistance=e.distance,r.centerIsOnSurface=!1,n!=null?(r.eyeCenterDistance=di(e.eye,n),r.tiltAtCenter=V_(t.renderCoordsHelper,n,e.eye),r.centerIsOnSurface=!0):t.state.isLocal?r.tiltAtCenter=V_(t.renderCoordsHelper,e.center,e.eye):(pE(O5(R5,s),e.ray,B0),r.eyeCenterDistance=di(e.eye,B0),r.tiltAtCenter=Pn(-fe(e.viewForward,me(B0,B0)))),r.radius=s,r.eyeRadius=Ce(e.eye),r.constraints=t.state.constraints,r}function YO(t){return Math.abs(t)>1e-9}function qet(t){const{constraints:e,eyeCenterDistance:r,tiltAtCenter:i}=t;let s=i,n=e.clampTilt(r,i);const o=Gj(t,n);if(e.clampTilt(o,i)===n)return n;let a=0;for(;a<10&&YO(n-s);){const l=(s+n)/2,c=Gj(t,l);YO(e.clampTilt(c,l)-l)?s=l:n=l,a++}return n}function Gj(t,e){if(!t.centerIsOnSurface)return t.eyeCenterDistance;const r=Math.PI-ge(e,0,Math.PI),i=Ch(t.radius/t.eyeRadius*Math.sin(r)),s=Math.PI-r-i,n=Math.sin(s)/Math.sin(r);if(t.eyeRadius<t.radius&&n>1){const o=Math.PI-i,a=Math.PI-r-o;return Math.sin(a)/Math.sin(r)*t.eyeRadius}return n*t.eyeRadius}function Wet(t,e){const r=Ch(t.radius/t.eyeRadius*Math.sin(t.tiltAtCenter)),i=Ch(t.radius/t.eyeRadius*Math.sin(e));return t.eyeRadius>t.radius?r-i:i-r}function Zet(t,e){return t.tiltAtCenter-Math.PI/2-(e-Math.PI/2)}function Xet(t,e,r){if(e.interactionType===Zt.NONE)return;const{interactionStartCamera:i,interactionFactor:s}=e;if(!i)return;const{min:n,max:o}=r,a=QX(t,i,k_,e),l=a===0?0:V_(t.renderCoordsHelper,i.center,i.eye);r.min=n,r.max=o,e.interactionType===Zt.TUMBLE?(XO(e.selection,Ai.ALTITUDE)&&Zxe(t,i,r),h4(a,l,!0,s,Sse,r)):h4(a,l,!1,s,Sse,r)}function Zxe(t,e,r){const i=t.state.constraints;if(t.state.isLocal||!i.altitude||!e)return;const s=na(e.center),n=Math.sqrt(s),o=e.distance,a=Nr(t.spatialReference).radius,l=i.altitude.min+a,c=i.altitude.max+a,h=(l*l-o*o-s)/(-2*n*o),p=(c*c-o*o-s)/(-2*n*o);r.min=Math.max(r.min,Math.min(Math.PI-Pn(p),r.max)),r.max=Math.min(r.max,Math.PI-Pn(h))}const Ry=C(),XM=be(),B0=C(),Sse=Dt(5),Yet={min:0,max:0},Jet={constraints:null,radius:0,eyeRadius:0,centerIsOnSurface:!0,eyeCenterDistance:0,tiltAtCenter:0},eC={eyeCenterDistance:0,requiresTwoSteps:!1};function Qet(t){return t}const K5=t=>t*t,KX=t=>1-K5(1-t),Ket=t=>t<.5?K5(2*t)/2:(KX(2*(t-.5))+1)/2,eY=t=>t*t*t,Xxe=t=>1-eY(1-t),Yxe=t=>t<.5?eY(2*t)/2:(Xxe(2*(t-.5))+1)/2,tY=t=>t*t*t*t,Jxe=t=>1-tY(1-t),ett=t=>t<.5?tY(2*t)/2:(Jxe(2*(t-.5))+1)/2,rY=t=>t*t*t*t*t,Qxe=t=>1-rY(1-t),ttt=t=>t<.5?rY(2*t)/2:(Qxe(2*(t-.5))+1)/2,iY=t=>1-Math.cos(t*Math.PI/2),Kxe=t=>1-iY(1-t),rtt=t=>t<.5?iY(2*t)/2:(Kxe(2*(t-.5))+1)/2,sY=t=>2**(10*(t-1)),tP=t=>1-sY(1-t),itt=t=>t<.5?sY(2*t)/2:(tP(2*(t-.5))+1)/2,nY=t=>-(Math.sqrt(1-t*t)-1),eTe=t=>1-nY(1-t),stt=t=>t<.5?nY(2*t)/2:(eTe(2*(t-.5))+1)/2;function Vh(t){const e=2*(t-Math.sqrt((t-1)*t)),r=e/2/t;return i=>i<r?t*i*i:e*i-e+1}function zh(t,e){return(r,i)=>r<e?e*t(r/e,i):1-t((1-r)/(1-e),i)*(1-e)}const ntt=zh(Vh(1),1),ott=zh(Vh(1),0),tTe=zh(Vh(1),.5),att=zh(Vh(2),1),ltt=zh(Vh(2),0),ctt=zh(Vh(2),.5),utt=zh(Vh(3),1),htt=zh(Vh(3),0),dtt=zh(Vh(3),.5),ptt=zh(Vh(4),1),ftt=zh(Vh(4),0),mtt=zh(Vh(4),.5),gtt={linear:Qet,"in-quad":K5,"out-quad":KX,"in-out-quad":Ket,"in-coast-quad":ntt,"out-coast-quad":ott,"in-out-coast-quad":tTe,"in-cubic":eY,"out-cubic":Xxe,"in-out-cubic":Yxe,"in-coast-cubic":att,"out-coast-cubic":ltt,"in-out-coast-cubic":ctt,"in-quart":tY,"out-quart":Jxe,"in-out-quart":ett,"in-coast-quart":utt,"out-coast-quart":htt,"in-out-coast-quart":dtt,"in-quint":rY,"out-quint":Qxe,"in-out-quint":ttt,"in-coast-quint":ptt,"out-coast-quint":ftt,"in-out-coast-quint":mtt,"in-sine":iY,"out-sine":Kxe,"in-out-sine":rtt,"in-expo":sY,"out-expo":tP,"in-out-expo":itt,"in-circ":nY,"out-circ":eTe,"in-out-circ":stt};function Rs(t,e,r=btt,i=e){i!==e&&i.copyFrom(e),i.computeUp(t.state.viewingMode);let s=!1;for(let a=0;a<wtt;a++){let l=0;for(const c of vtt)if(XO(r.selection,c.type)){const h=Math.abs(c.error(t,i,r));c.apply(t,i,r)&&(s=!0,l+=h)}if(l===0)break}const n=XO(r.selection,Ai.COLLISION),o=ytt(r.interactionType,t);return n&&_E(t,i,o)&&(s=!0),s&&i.computeUp(t.state.viewingMode),s}function ytt(t,e){switch(t){case Zt.PAN:return yh.EYE_AND_CENTER;case Zt.ASCEND:return e.state.isGlobal?yh.EYE_AND_CENTER_SCALE:yh.EYE_AND_CENTER;default:return yh.EYE}}function kd(t){const e=Math.min(1,t/150);return Yxe(e)}function _tt(t,e,r){return QX(t,e,r)*e.distance}const vtt=[{type:Ai.TILT,error:_tt,apply:Wxe},{type:Ai.ALTITUDE,error:ZX,apply:cet},{type:Ai.DISTANCE,error:XX,apply:_et}],btt={selection:Ai.ALL,interactionType:Zt.NONE,interactionFactor:0,interactionStartCamera:null,interactionDirection:null,tiltMode:Jn.TUMBLE},wtt=5,Pc=C(),Il=C(),Py=C(),Wo=C(),bv=C(),xtt=C(),Mc={upward:Oe(0,0,1),forward:Oe(0,1,0),sideway:Oe(1,0,0)},Ese=Li();let Cse=class{constructor(e=De.Global){this.viewingMode=e,this.center=C(),this.pitch=0,this.yaw=0,this.distance=0,this.lookAtDirection=$s(Mc.forward)}pixelsPerPanAtZoom(e){return this.size/2/(this._zoomToPanScale*e)}zoomAtPixelsPerPan(e){return this.size/2/(this._zoomToPanScale*e)}pixelsPerRotateAtZoom(){const e=Math.max(Math.cos(Math.abs(this.pitch)),.5);return this.size/2/e}compareTo(e,r){if(r||(r={pan:0,rotate:0,sourceZoom:0,targetZoom:0}),this.viewingMode===De.Global){const n=(Ce(this.center)+Ce(e.center))/2;r.pan=UL(this.center,e.center)*n}else r.pan=di(this.center,e.center);let i=Math.abs(e.yaw-this.yaw);i>=Math.PI&&(i=2*Math.PI-i);const s=Math.abs(e.pitch-this.pitch);return r.rotate=Math.max(i,s),r.sourceZoom=this.distance,r.targetZoom=e.distance,r}interpolate(e,r,i){this.viewingMode===De.Global?PWe(e.center,r.center,i.pan,this.center):Br(this.center,e.center,r.center,i.pan),this.distance=isFinite(r.distance)?wt(e.distance,r.distance,i.zoom):e.distance,this.pitch=wt(e.pitch,r.pitch,i.rotate);let s=e.yaw;const n=r.yaw;Math.abs(n-s)>=Math.PI&&(s+=2*(s<n?1:-1)*Math.PI),this.yaw=wt(s,n,i.rotate)}copyFrom(e){ie(this.center,e.center),this.pitch=e.pitch,this.yaw=e.yaw,this.distance=e.distance,ie(this.lookAtDirection,e.lookAtDirection),this.size=e.size,this.copyFromCommon(e),this.viewingMode=e.viewingMode}copyFromRenderCamera(e){const r=this._lookAtOrientation(e.center,Ese);ie(this.center,e.center),he(Wo,e.center,e.eye),hc(Wo,Wo,r),hc(bv,e.up,r),this.distance=Ce(Wo),this.distance!==0&&(Wo[0]/=this.distance,Wo[1]/=this.distance,Wo[2]/=this.distance),this.pitch=this._eyeUpToPitch(Wo),this.yaw=this._eyeUpToYaw(Wo,bv),this.size=Math.sqrt(e.width*e.width+e.height*e.height),this.copyFromCommon(e)}copyFromCommon(e){this.fov=e.fov,this._zoomToPanScale=Math.atan(.5*this.fov)}copyToRenderCamera(e){const r=this._lookAtOrientation(this.center,Ese);Mh(r,r),this._axisAngleVec3(Mc.sideway,this.pitch-Math.PI/2,Mc.forward,Wo),this._axisAngleVec3(Mc.upward,this.yaw,Wo),this._axisAngleVec3(Mc.sideway,this.pitch-Math.PI/2,Mc.upward,bv),this._axisAngleVec3(Mc.upward,this.yaw,bv),te(Wo,Wo,this.distance),hc(Wo,Wo,r),hc(bv,bv,r),e.center=this.center,e.eye=he(Wo,this.center,Wo),e.up=bv}_axisAngleVec3(e,r,i,s=i){const n=Math.cos(r),o=Math.sin(r);return te(Pc,i,n),at(Il,e,i),te(Il,Il,o),te(Py,e,(1-n)*fe(e,i)),ce(s,ce(s,Pc,Il),Py)}_lookAtOrientation(e,r=Li()){return this._upAtLookAt(e,Py),at(Pc,this.lookAtDirection,Py),me(Pc,Pc),Pc[0]===0&&Pc[1]===0&&Pc[2]===0&&ie(Pc,Mc.sideway),at(Il,Py,Pc),me(Il,Il),r[0]=Pc[0],r[1]=Il[0],r[2]=Py[0],r[3]=Pc[1],r[4]=Il[1],r[5]=Py[1],r[6]=Pc[2],r[7]=Il[2],r[8]=Py[2],r}_upAtLookAt(e,r){return this.viewingMode===De.Local?ie(r,Mc.upward):me(r,e)}_eyeUpToPitch(e){return Math.PI-UL(Mc.upward,e)}_eyeUpToYaw(e,r){const i=xtt;return Math.abs(r[2])<.5?(ie(i,r),e[2]>0&&te(i,i,-1)):ie(i,e),at(Il,i,Mc.upward),me(Il,Il),UL(Mc.sideway,Il,Mc.upward)}};const p4={desiredScreenFlow:2,minDuration:500,maxDuration:8e3};let Ttt=class rTe{constructor(e){this._createCamera=e,this.compared={sourceZoom:0,targetZoom:0,pan:0,rotate:0},this.settings={desiredScreenFlow:p4.desiredScreenFlow},this.source=e(),this.target=e()}clone(){const e=new rTe(this._createCamera);return e.copyFrom(this),e}copyFrom(e){this.update(e.source,e.target,e.settings)}update(e,r,i){this.source!==e&&this.source.copyFrom(e),this.target!==r&&this.target.copyFrom(r),this.compared=this.source.compareTo(this.target,this.compared),this.settings.desiredScreenFlow=i.desiredScreenFlow!=null?i.desiredScreenFlow:p4.desiredScreenFlow,this.desiredPixelFlow=this.settings.desiredScreenFlow*this.target.size,this.halfWindowSize=this.target.size/2}halfWindowPanAtZoom(e){const r=this.target.pixelsPerPanAtZoom(e);return this.halfWindowSize/r}get hasZoom(){return Math.abs(this.compared.sourceZoom-this.compared.targetZoom)>1e-5}get hasPan(){return this.compared.pan>1e-9}get hasRotate(){return this.compared.rotate>1e-9}},Stt=class{constructor(){this.segments=[]}get time(){return this.segments.reduce((e,r)=>e+r.time,0)}interpolateComponentsAt(e,r){e=Math.min(Math.max(e,0),1),e*=this.time;let i=0,s=0;const n=this.definition;for(let o=0;o<this.segments.length;o++){const a=this.segments[o],l=a.definition;if(e<=a.time||o===this.segments.length-1){if(r=this.segmentInterpolateComponentsAt(a,a.time===0?0:e/a.time,r),n.hasPan&&!isNaN(r.pan)&&isFinite(n.compared.pan)?r.pan=(i+l.compared.pan*r.pan)/n.compared.pan:r.pan=1,n.hasRotate&&!isNaN(r.rotate)&&isFinite(n.compared.rotate)?r.rotate=(s+l.compared.rotate*r.rotate)/n.compared.rotate:r.rotate=1,n.hasZoom&&!isNaN(r.zoom)&&isFinite(l.compared.targetZoom)){const c=r.zoom*(l.compared.targetZoom-l.compared.sourceZoom)+l.compared.sourceZoom,h=this.segments[0].definition.compared.sourceZoom,p=this.segments[this.segments.length-1].definition.compared.targetZoom;r.zoom=(c-h)/(p-h)}else r.zoom=1;return r}e-=a.time,i+=l.compared.pan,s+=l.compared.rotate}}segmentInterpolateComponentsAt(e,r,i){return e.interpolateComponentsAt(r,i)}},P8=class{get time(){return this._time}constructor(e){e&&this.update(e)}update(e){e&&(this.definition?this.definition.copyFrom(e):this.definition=e.clone()),this._updatePrecomputedVariables(),this._updatePixelFlow()}_updatePrecomputedVariables(){const e=this.definition,r=e.compared,i=r.sourceZoom,s=r.targetZoom;this._zoomSign=i>s?1:-1,this._panPixelsAtSource=r.pan*e.source.pixelsPerPanAtZoom(i);const n=(e.source.pixelsPerRotateAtZoom(i)+e.target.pixelsPerRotateAtZoom(s))/2;this._rotatePixels=r.rotate*n}_updatePixelFlow(){const e=this.definition.compared.sourceZoom,r=this.definition.compared.targetZoom,{hasZoom:i,hasPan:s,hasRotate:n}=this.definition;let o=0,a=0;i&&(s&&(o=(r/e-1)/(-1/(this._zoomSign*this.definition.halfWindowSize)*Math.LN2*this._panPixelsAtSource)),n&&(a=this._zoomSign*(Math.log(e/r)/Math.LN2)*this.definition.halfWindowSize/this._rotatePixels)),this._zoomPixelFlow=0,this._panPixelFlow=0,this._rotatePixelFlow=0;const l=this.definition.desiredPixelFlow;if(i&&s&&n){const c=o+a+o*a;this._zoomPixelFlow=o*a/c*l,this._panPixelFlow=a/c*l,this._rotatePixelFlow=o/c*l}else if(i&&s){const c=1+o;this._zoomPixelFlow=o/c*l,this._panPixelFlow=1/c*l}else if(i&&n){const c=1+a;this._zoomPixelFlow=a/c*l,this._rotatePixelFlow=1/c*l}else if(s&&n){const c=this._panPixelsAtSource/this._rotatePixels,h=1+c;this._panPixelFlow=c/h*l,this._rotatePixelFlow=1/h*l}else s?this._panPixelFlow=l:i?this._zoomPixelFlow=l:n&&(this._rotatePixelFlow=l);this._time=n?this.rotateTime:i?this.zoomTime:s?this.panTime:0}get rotateTime(){return this.definition.hasRotate?this._rotatePixels/this._rotatePixelFlow:0}get zoomTime(){return this.definition.hasZoom?this._zoomSign*(Math.log(this.definition.compared.sourceZoom/this.definition.compared.targetZoom)/Math.LN2)*this.definition.halfWindowSize/this._zoomPixelFlow:0}get panTime(){if(this.definition.hasPan){if(this.definition.hasZoom){const e=-1/(this._zoomSign*this.definition.halfWindowSize)*Math.LN2,r=e*this._panPixelsAtSource;return Math.log(r*(this._zoomPixelFlow/this._panPixelFlow)+1)/(e*this._zoomPixelFlow)}return this._panPixelsAtSource/this._panPixelFlow}return 0}_interpolateComponentsZoom(e){if(e===0||e===1)return e;if(this.definition.hasZoom){const r=this.definition.compared.sourceZoom,i=this.definition.compared.targetZoom;return(r*(r/i)**-e-r)/(i-r)}return e}_interpolateComponentsPan(e){if(e===0||e===1)return e;if(this.definition.hasPan&&this.definition.hasZoom){const r=-1/(this._zoomSign*this.definition.halfWindowSize)*this._zoomPixelFlow;return 1/this._panPixelsAtSource*(this._panPixelFlow*(2**(r*e*this._time)-1))/(r*Math.LN2)}return e}_interpolateComponentsRotate(e){return e}interpolateComponentsAt(e,r){e=Math.min(Math.max(e,0),1);const i=this._interpolateComponentsZoom(e),s=this._interpolateComponentsPan(e),n=this._interpolateComponentsRotate(e);return r?(r.zoom=i,r.pan=s,r.rotate=n):r={zoom:i,pan:s,rotate:n},r}};function Ett(t,e,r){const i=e-t.compared.sourceZoom,s=t.halfWindowPanAtZoom(i);return-t.halfWindowSize*(r.ascensionFactor*Math.LN2*t.compared.pan+s)*Math.log(t.compared.sourceZoom/e)/(t.desiredPixelFlow*Math.LN2*s)}function Ctt(t,e,r){const i=1/e,s=Math.log(t.compared.sourceZoom*i),n=1/t.desiredPixelFlow,o=1/Math.LN2,a=e-t.compared.sourceZoom,l=1/a,c=(r.ascensionFactor*Math.LN2*t.compared.pan+t.halfWindowPanAtZoom(a))/t.halfWindowPanAtZoom(1);return t.halfWindowSize*i*n*o*l*c-t.halfWindowSize*s*n*o*l+t.halfWindowSize*s*n*o*c/(a*a)}function Att(t,e,r){const i=e-t.compared.sourceZoom,s=1/i,n=1/e,o=Math.log(t.compared.sourceZoom*n),a=(r.ascensionFactor*Math.LN2*t.compared.pan+t.halfWindowPanAtZoom(i))/t.halfWindowPanAtZoom(1);return t.halfWindowSize*s*(-2*s*n*a+2*s*o+2*n-2*o*a/(i*i)-a/(e*e))/(t.desiredPixelFlow*Math.LN2)}function Ott(t,e){return-t.halfWindowSize*Math.log(t.compared.sourceZoom/e)/(t.desiredPixelFlow*Math.LN2)}function Rtt(t,e){return t.halfWindowSize/(e*t.desiredPixelFlow*Math.LN2)}function Ptt(t,e){return-t.halfWindowSize/(e*e*t.desiredPixelFlow*Math.LN2)}function Mtt(t,e,r){return-t.compared.pan*t.halfWindowSize*(r.ascensionFactor+r.descensionFactor-1)/(t.desiredPixelFlow*t.halfWindowPanAtZoom(e))}function Itt(t,e,r){return t.compared.pan*t.halfWindowSize*(r.ascensionFactor+r.descensionFactor-1)/(t.desiredPixelFlow*t.halfWindowPanAtZoom(e*e))}function $tt(t,e,r){return-2*t.compared.pan*t.halfWindowSize*(r.ascensionFactor+r.descensionFactor-1)/(t.desiredPixelFlow*t.halfWindowPanAtZoom(e*e*e))}function Ltt(t,e,r){return t.halfWindowSize*(-t.halfWindowPanAtZoom(e)-r.descensionFactor*Math.LN2*t.compared.pan+t.halfWindowPanAtZoom(t.compared.targetZoom))*Math.log(e/t.compared.targetZoom)/(t.desiredPixelFlow*Math.LN2*t.halfWindowPanAtZoom(-e+t.compared.targetZoom))}function Dtt(t,e,r){const i=Math.log(e/t.compared.targetZoom),s=1/t.desiredPixelFlow,n=1/Math.LN2,o=-e+t.compared.targetZoom,a=1/o,l=(-t.halfWindowPanAtZoom(e)-r.descensionFactor*Math.LN2*t.compared.pan+t.halfWindowPanAtZoom(t.compared.targetZoom))/t.halfWindowPanAtZoom(1);return-t.halfWindowSize*i*s*n*a+t.halfWindowSize*i*s*n*l/(o*o)+t.halfWindowSize*s*n*a*l/e}function Ntt(t,e,r){const i=e-t.compared.targetZoom,s=1/i,n=1/e,o=Math.log(e/t.compared.targetZoom),a=(t.halfWindowPanAtZoom(e)+r.descensionFactor*Math.LN2*t.compared.pan-t.halfWindowPanAtZoom(t.compared.targetZoom))/t.halfWindowPanAtZoom(1);return t.halfWindowSize*s*(-2*s*n*a-2*s*o+2*n+2*o*a/(i*i)-a/(e*e))/(t.desiredPixelFlow*Math.LN2)}function Ftt(t,e){return t.halfWindowSize*Math.log(e/t.compared.targetZoom)/(t.desiredPixelFlow*Math.LN2)}function Utt(t,e){return t.halfWindowSize/(e*t.desiredPixelFlow*Math.LN2)}function ktt(t,e){return-t.halfWindowSize/(e*e*t.desiredPixelFlow*Math.LN2)}function Vtt(t){const e=Math.LN2*t.compared.pan,r=t.compared.sourceZoom-t.compared.targetZoom,i=t.halfWindowPanAtZoom(r),s=t.halfWindowSize*Math.log(t.compared.sourceZoom/t.compared.targetZoom)/(t.desiredPixelFlow*Math.LN2*i);return t.compared.sourceZoom<=t.compared.targetZoom?s*(e-i):s*(e+i)}function ztt(t,e){let r=Btt(t,e);const i={ascensionFactor:e.ascensionFactor!=null?e.ascensionFactor:.5,descensionFactor:e.descensionFactor!=null?e.descensionFactor:.5},s=i.ascensionFactor===0,n=i.descensionFactor===0,o=s?Ott:Ett,a=s?Rtt:Ctt,l=s?Ptt:Att,c=n?Ftt:Ltt,h=n?Utt:Dtt,p=n?ktt:Ntt,f=S=>o(t,S,i)+Mtt(t,S,i)+c(t,S,i),m=S=>a(t,S,i)+Itt(t,S,i)+h(t,S,i),y=S=>l(t,S,i)+$tt(t,S,i)+p(t,S,i);let _=f(r);const v=Vtt(t);let w;const x=e.maximumIterations||20,T=e.maximumDistance!=null?e.maximumDistance:1/0;for(w=0;w<x;w++){const O=(m(r)+1e-6)/y(r);if(isNaN(O)||r>=T&&O<0){if(!isFinite(T))return null;r=T,_=f(r);break}if(r-=O,r<t.compared.sourceZoom||r<t.compared.targetZoom)return null;const A=f(r);if(Math.abs(A-_)/_<=.005)break;_=A}return _>v*(1-.3)||r<t.compared.sourceZoom||r<t.compared.targetZoom?null:r}function Btt(t,e){const r=Math.max(t.compared.sourceZoom,t.compared.targetZoom),i=t.source.zoomAtPixelsPerPan(t.desiredPixelFlow/t.compared.pan)/2;return i<r?e.maximumDistance!=null?r+(e.maximumDistance-r)/2:1.5*r:e.maximumDistance?Math.min(e.maximumDistance,i):i}let Gtt=class extends Stt{constructor(e,r){super(),this._preallocSegments=[new P8,new P8,new P8],this._ascensionSegment=null,this._descensionSegment=null,this.update(e,r)}update(e,r){if(!e)return;this.definition?this.definition.copyFrom(e):this.definition=e.clone();let i=null;r&&r.apex&&(i=ztt(e,r.apex)),this.segments.length=0,this._ascensionSegment=null,this._descensionSegment=null,i==null?this._updateWithoutApex():this._updateWithApex(i,r?.apex)}segmentInterpolateComponentsAt(e,r,i){return i=e.interpolateComponentsAt(r,i),e===this._ascensionSegment?i.zoom=KX(i.zoom):e===this._descensionSegment&&(i.zoom=K5(i.zoom)),i}_updateWithApex(e,r){const[i,s,n]=this._preallocSegments,o=r?.ascensionFactor??.5,a=Math.min(1-o,r?.ascensionFactor!=null&&r.descensionFactor!=null?r.descensionFactor:.5),l=1-o-a;i.definition?i.definition.copyFrom(this.definition):i.definition=this.definition.clone(),i.definition.compared.targetZoom=e,i.definition.compared.pan=this.definition.compared.pan*o,i.definition.compared.rotate=this.definition.compared.rotate*o,i.update(),this._ascensionSegment=i,this.segments.push(i),l>0&&(s.definition?s.definition.copyFrom(this.definition):s.definition=this.definition.clone(),s.definition.copyFrom(this.definition),s.definition.compared.sourceZoom=e,s.definition.compared.targetZoom=e,s.definition.compared.pan=this.definition.compared.pan*l,s.definition.compared.rotate=this.definition.compared.rotate*l,s.update(),this.segments.push(s)),n.definition?n.definition.copyFrom(this.definition):n.definition=this.definition.clone(),n.definition.compared.sourceZoom=e,n.definition.compared.pan=this.definition.compared.pan*a,n.definition.compared.rotate=this.definition.compared.rotate*a,n.update(),this._descensionSegment=n,this.segments.push(n)}_updateWithoutApex(){const[e]=this._preallocSegments;e.update(this.definition),this.segments.push(e)}};const jtt={zoom:0,pan:0,rotate:0};let Htt=class{get time(){return this._time}constructor(e){this._createCamera=e,this._time=0,this.definition=new Ttt(e),this.path=new Gtt}update(e,r,i){this.definition.update(e,r,i),this.path.update(this.definition,i),this._time=this._applyTimeSettings(dpe(isFinite(this.path.time)?this.path.time:0),i),this._easing=i.easing??(this._time>=1e3?tTe:tP)}cameraAt(e,r){r=r||this._createCamera(),e=Math.min(Math.max(0,e),1),e=this._normalizedEasing(e);const i=this.path.interpolateComponentsAt(e,jtt);return r.interpolate(this.definition.source,this.definition.target,i),r}_normalizedEasing(e){const r=this._easing(0,this._time),i=this._easing(1,this._time);return(this._easing(e,this._time)-r)/(i-r)}_applyTimeSettings(e,r){const i=r.speedFactor!=null?r.speedFactor:1;r.duration!=null?e=r.duration:r.speedFactor!=null&&(e=e/i);const s=r.minDuration!=null?r.minDuration:p4.minDuration/i,n=r.maxDuration!=null?r.maxDuration:p4.maxDuration/i;return Math.min(Math.max(s,e),n)}};const qtt=C();let Wtt=class{get finished(){return this.currentTime>=this._animation.time}get time(){return this._animation.time}constructor(e){this.currentTime=0,this._animation=new Htt(()=>new Cse(e)),this._current=new Cse(e)}update(e,r,i){const s=this._animation.definition.source,n=this._animation.definition.target,o=he(qtt,r.center,e.center),a=Ce(o);a>=1e-5?(o[0]/=a,o[1]/=a,o[2]/=a):(o[0]=0,o[1]=1,o[0]=0),ie(s.lookAtDirection,o),ie(n.lookAtDirection,o),s.copyFromRenderCamera(e),n.copyFromRenderCamera(r),this._current.copyFrom(s),this._animation.update(s,n,i),this.currentTime=0,e.almostEquals(r)&&(this.currentTime=this._animation.time)}cameraAt(e,r){return this._animation.cameraAt(e,this._current),r=r||new ut,this._current.copyToRenderCamera(r),r}step(e,r){return this.finished||(this.currentTime=this.currentTime+dpe(e),this.currentTime>=this.time&&(this.currentTime=this.time)),this.cameraAt(this.currentTime/this.time,r)}};var qi;(function(t){t.Ready="ready",t.Rejected="rejected",t.Running="running",t.Stopped="stopped",t.Finished="finished"})(qi||(qi={}));let og=class extends Te{constructor(e){super(e),this.state=qi.Ready}get active(){return this.state===qi.Running}get isInteractive(){return!1}get canStop(){return!1}stopController(){return!!this.canStop&&(this.state=qi.Stopped,!0)}finishController(){this.state=qi.Finished}get steppingFinished(){return!1}};u([d({constructOnly:!0})],og.prototype,"view",void 0),u([d({readOnly:!0})],og.prototype,"active",null),u([d()],og.prototype,"state",void 0),u([d({readOnly:!0})],og.prototype,"isInteractive",null),og=u([R("esri.views.3d.state.controllers.CameraController")],og);let JO=class extends og{constructor(){super(...arguments),this._asyncResult=null}get canStop(){return!0}set asyncResult(e){this._asyncResult&&(this._asyncResult.reject(Dr()),this._asyncResult=null),this.state===qi.Finished||this.state===qi.Stopped?(yF(e),this.state===qi.Finished?e.resolve():e.reject(Dr())):this._asyncResult=e}get asyncResult(){return this._asyncResult}onControllerStart(){this.state=qi.Running,this.viewAnimation!=null&&this.viewAnimation.when(()=>this.updateStateFromViewAnimation(),()=>this.updateStateFromViewAnimation())}updateStateFromViewAnimation(){this.viewAnimation==null||this.state!==qi.Ready&&this.state!==qi.Running||(this.viewAnimation.state===T2.State.FINISHED?this.finish():this.viewAnimation.state===T2.State.STOPPED&&(this.state=qi.Stopped))}onControllerEnd(){this.viewAnimation==null||this.viewAnimation.done||(this.state===qi.Finished?this.viewAnimation.finish():this.state===qi.Stopped&&this.viewAnimation.stop()),this._asyncResult&&(this.state===qi.Finished?this._asyncResult.resolve():this._asyncResult.reject(Dr()))}finish(){this.finishController()}};JO=u([R("esri.views.3d.state.controllers.AnimationController")],JO);let gg=class extends JO{get intersectionHelper(){return this.view.sceneIntersectionHelper}constructor(e){super(e),this.mode="interaction",this._hasTarget=!1}initialize(){this.animation=new Wtt(this.view.state.viewingMode),this.viewAnimation=this.mode==="interaction"?null:new T2}get isInteractive(){return this.mode==="interaction"}begin(e,r){this._hasTarget=!0;const i=this.animationSettings(r);YM.copyFrom(this.view.state.camera);const s=Dh(this.view.state.viewingMode);this.intersectionHelper.intersectRay(YM.ray,s,Ase)&&(YM.center=Ase),this.animation.update(YM,e,i),this.animation.finished&&this.finish()}finish(){this.animation.currentTime=this.animation.time,super.finish()}get steppingFinished(){return this._hasTarget&&this.animation.finished}stepController(e,r){this._hasTarget&&this.animation.step(e,r)}onControllerEnd(e){this._hasTarget&&(this.animation.cameraAt(this.animation.currentTime/this.animation.time,e),this.animation.currentTime=this.animation.time),super.onControllerEnd(e)}animationSettings(e={}){return{apex:{maximumDistance:this.view.state.constraints.clampAltitude(1/0)/6,ascensionFactor:void 0,descensionFactor:void 0},...e,easing:typeof e.easing=="string"?gtt[e.easing]:e.easing}}};u([d({constructOnly:!0})],gg.prototype,"mode",void 0),u([d({readOnly:!0})],gg.prototype,"isInteractive",null),gg=u([R("esri.views.3d.state.controllers.PointToPointAnimationController")],gg);const YM=new ut,Ase=C();function e6(t=Xtt){return[t[0],t[1],t[2],t[3]]}function QO(t,e){return Ztt(t[0],t[1],t[2],e,cX.get())}function Ztt(t,e,r,i,s=e6()){return s[0]=t,s[1]=e,s[2]=r,s[3]=i,s}function oY(t,e,r){return at(r,t,e),me(r,r),r[3]=A5(t,e),r}const Xtt=[0,0,1,0];function iTe(t,e,r){return Ytt(t,t.screenToRender(e,Le.get()),r)}function Ytt(t,e,r){const i=fn(Le.get(),e);if(i[2]=0,!t.unprojectFromRenderScreen(i,r.origin))return null;const s=fn(Le.get(),e);s[2]=1;const n=t.unprojectFromRenderScreen(s,Le.get());return n==null?null:(he(r.direction,n,r.origin),r)}function vE(t,e,r){return aY(t,t.screenToRender(e,Le.get()),r)}function aY(t,e,r){ie(r.origin,t.eye);const i=se(Le.get(),e[0],e[1],1),s=t.unprojectFromRenderScreen(i,Le.get());return s==null?null:(he(r.direction,s,r.origin),r)}function lY(t,e,r,i){const s=vE(e,r,Jtt);return Q_(t,s,i)}const Jtt=Xn();var R2;(function(t){t[t.Ellipsoid=0]="Ellipsoid",t[t.Silhouette=1]="Silhouette"})(R2||(R2={}));const sTe=30,f4=[1,3e8],t6=80,nTe=8,oTe=200,aTe=1508e5,lTe=5,cTe=50,Qtt=5,Ktt=10,M8=90,Vw={exclude:new Set([z0])};function Mb(t,e,r){return r[0]=e[0]/(t.fullWidth/t.pixelRatio),r[1]=e[1]/(t.fullHeight/t.pixelRatio),r}function jj(t){for(;t>Math.PI;)t-=2*Math.PI;for(;t<-Math.PI;)t+=2*Math.PI;return t}function z_(t,e,r){const i=mu(uX.get(),r[3],r);i==null||$0e(i,un)||(he(Zr,t.eye,e),$e(Zr,Zr,i),t.eye=ce(Zr,Zr,e),he(Zr,t.center,e),$e(Zr,Zr,i),t.center=ce(Zr,Zr,e),t.up=$e(Zr,t.up,i))}function ert(t,e,r,i){return Fw(t,iTe(e,r,hY),i)}function Hj(t,e,r,i){return Fw(t,vE(e,r,hY),i)}function cY(t,e,r,i){const s=Le.get();let n=1-r;he(s,e,t.eye);const o=Ce(s);let a=o*(1-n);n>=0&&a<i&&(a=i,n=-(a-o)/o),Math.abs(o-a)<1e-6||(te(s,s,n),t.eye=ce(Zr,t.eye,s),t.center=Br(Zr,t.center,e,n))}function uTe(t,e,r){e.getScreenCenter(Ose),lY(t,e,Ose,Zr)&&(e.center=Zr);const i=e.distance,s=i*r;if(Math.abs(i-s)<1e-6)return;const n=te(Le.get(),e.viewForward,s);e.eye=he(Zr,e.center,n)}const Ose=Zi();function I8(t,e){se(e,0,0,0);for(const r of t)ce(e,e,r);te(e,e,1/t.length)}function rD(t,e,r,i){return Math.sin(t/Ce(e))*(r+i.radius)}function Rse(t,e,r,i){return rD(Math.PI/2,e,r,i)+(t-Math.PI/2)}var Yn;(function(t){t[t.Vertical=0]="Vertical",t[t.Horizontal=1]="Horizontal"})(Yn||(Yn={}));const Pse={Elevation:3e4,Angle:Dt(16)},JM={Pole:.95,Angle:Dt(18),Tilt:45},hTe=Dt(80);function dTe(t,e,r,i,s,n){const o=C(),a=gs();let l=!0,c=!0;return t.intersectScreen(r,o,n)?a[3]=Ce(o):(c=!1,e.aboveGround&&s!==R2.Ellipsoid?a[3]=Math.max(Ce(e.center),.9*i.radius):a[3]=Ce(e.eye)-e.relativeElevation,s===R2.Silhouette?KO(a,e,r,o):l=lY(a,e,r,o)),{sphere:a,scenePickPoint:l?o:null,hasGeometryIntersection:c}}function r6(t,e,r){return Ce(t.eye)-r.radius>Pse.Elevation?Yn.Horizontal:(vE(t,e,Use),-Math.sign(t.relativeElevation)*(.5*Math.PI+A5(t.eye,Use.direction))<Pse.Angle?Yn.Vertical:Yn.Horizontal)}function pTe(t,e,r){he($8,r,e),t.eye=he(Zr,t.eye,$8),t.center=he(Zr,t.center,$8)}const $8=C();function KO(t,e,r,i){const s=vE(e,r,hY);return s!=null&&(pE(t,s,QM),Q_(t,s,i)?!(yo(QM,s.origin)<yo(i,s.origin))||(ie(i,QM),!1):(he(mx,e.eye,e.center),me(mx,mx),pbe(mx,-fe(me(mx,mx),QM),Mse),Fw(Mse,s,i),!1))}const QM=C(),mx=C(),Mse=Ir();function fTe(t,e,r,i,s,n){let o=0;if(at(y4,t,e),he(rI,t,e),Ce(t)<=s||!i.aboveGround){at(r,rI,i.eye);const a=fe(t,e)/(Ce(t)*Ce(e));if(a<.9999)o=Pn(a);else{const c=Ce(at(C(),t,e))/(Ce(t)*Ce(e));o=Ch(c)}const l=Math.cos(ge(A_.normalize(Dt(n)),0,hTe));o=-o-Math.max(0,Ce(e)-s)/(l*s)}else he(Ise,i.eye,i.center),at(r,rI,Ise),o=-Ce(rI)/s;return me(r,r),te(r,r,Ce(y4)),o}const Ise=C();function $se(t,e,r,i){let s,n;const o=Math.cos(ge(A_.normalize(Dt(i)),0,hTe));return s=e>r?-(e-r)/(o*r):e<-r?Math.PI-(e+r)/(o*r):Pn(e/r),n=t>r?-(t-r)/(o*r):t<-r?Math.PI-(t+r)/(o*r):Pn(t/r),(n-s)*r}function trt(t,e,r,i,s,n,o,a,l,c){const h=$se(t[2],e[2],n[3],a),p=l?$se(t[0],e[0],n[3],180):e[0]-t[0],f=Math.sin(o)*p-Math.cos(o)*h,m=Math.cos(o)*p+Math.sin(o)*h;me(Zr,s);const y=l?f/Math.sqrt(Math.abs(n[3]**2-fe(r,Zr)**2)):f/n[3],_=m/Math.sqrt(Math.abs(n[3]**2-fe(r,i)**2));or(c,y,_)}function mTe(t,e,r,i,s,n,o,a,l,c){at(y4,t,e),_G(n.up,n.eye,KM,eI,tI),_G([0,0,1],n.eye,Tg,__,vTe),ie(r,__),ie(i,Tg),me(r,r),te(r,r,Ce(y4)),Ore(t,me(eI,eI),me(tI,tI),me(KM,KM),Lse),Ore(e,eI,tI,KM,Dse),trt(Lse,Dse,t,Tg,__,o,a,l,c,s)}function rrt(t,e,r,i,s,n,o){mu(m4,s,i),mu(g4,o,n),si(lS,m4,g4),he(e,t,r),$e(e,e,lS),ce(e,e,r)}function gTe(t,e,r,i,s,n){mu(m4,i,r),mu(g4,n,s),si(lS,m4,g4),he(Zr,t.eye,e),$e(Zr,Zr,lS),t.eye=ce(Zr,Zr,e),he(Zr,t.center,e),$e(Zr,Zr,lS),t.center=ce(Zr,Zr,e),he(Zr,t.up,e),$e(Zr,Zr,lS),t.up=ce(Zr,Zr,e)}function uY(t,e,r,i,s,n){return(Math.abs(i)>Math.PI-JM.Angle||Math.abs(i)<JM.Angle)&&(Math.abs(t[2])<r*JM.Pole||Math.abs(e)>r)&&n.aboveGround&&s<JM.Tilt}function yTe(t,e,r,i,s,n){if(n)oY(r,i,Nse),z_(e,t,Nse);else{const o=fTe(r,i,Fse,e,t[3],s);z_(e,t,QO(Fse,o))}}function _Te(t,e,r,i,s,n,o){const a=o?20:1,l=1e-12;let c,h;ie(wv,i),iI.copyFrom(e);for(let p=0;p<a&&yo(r,wv)>l&&(c=yo(r,wv),mTe(r,wv,__,Tg,tC,iI,t,s,n,o),gTe(iI,t,Tg,tC[1],__,tC[0]),rrt(wv,wv,t,Tg,tC[1],__,tC[0]),h=yo(r,wv),h<c||p===0);p++)e.copyFrom(iI)}function irt(t,e,r,i,s,n,o){uY(r,fe(e.up,r),t[3],-A_.normalize(Dt(s)),n,e)?_Te(t,e,r,i,-A_.normalize(Dt(s)),n,o):yTe(t,e,r,i,n,o)}function srt(t,e,r,i,s,n){const{eye:o}=t;_G([0,0,1],o,Tg,__,vTe);const a=e.translation[0]*r.pan,l=s.mode==="zoom"?0:e.translation[1]*r.pan,c=Math.max(Math.sqrt(Math.abs(1-fe(t.center,Tg)**2/Ce(t.center)**2)),.5),h=(Math.sin(n)*l+Math.cos(n)*a)/c,p=-Math.cos(n)*l+Math.sin(n)*a;switch(dc(i.pan.matrix,i.pan.matrix,h,Tg),i.pan.enabled=!0,s.mode){case"pan":dc(i.pan.matrix,i.pan.matrix,p,__),i.pan.enabled=!0;break;case"zoom":i.zoom=-e.translation[1]*r.zoom}}function nrt(t,e,r,i,s){const{eye:n,viewRight:o}=t,a=at(Le.get(),o,n),l=e.translation[0]*r.pan;switch(l!==0&&(dc(i.pan.matrix,i.pan.matrix,-l,a),i.pan.enabled=!0),s.mode){case"pan":{const c=e.translation[1]*r.pan;c!==0&&(dc(i.pan.matrix,i.pan.matrix,c,o),i.pan.enabled=!0);break}case"zoom":i.zoom=-e.translation[1]*r.zoom}}function ort(t,e,r,i,s,n,o,a,l){uY(t.center,fe(t.up,t.center),Ce(t.center),-A_.normalize(Dt(n)),o,e)?srt(e,r,i,a,l,-A_.normalize(Dt(s))):nrt(e,r,i,a,l)}const Tg=C(),__=C(),vTe=C(),KM=C(),eI=C(),tI=C(),Lse=C(),Dse=C(),tC=Ve(),Nse=e6(),m4=be(),g4=be(),lS=be(),wv=C(),Zr=C(),rI=C(),iI=new ut,y4=C(),Fse=C(),hY={origin:C(),direction:C()},Use={origin:C(),direction:C()},kse=.6,L8=4,art=60;let _4=class extends gg{constructor(){super(...arguments),this._zoomLocation=C(),this._tmpCamera=new ut,this._tmpViewDir=C(),this._tmpRayDir={origin:C(),direction:C()},this._targetOnSphere=C(),this._tmpCenter=C(),this._constraintOptions={selection:Ai.ALL_EXCEPT_COLLISION,interactionType:Zt.ZOOM,interactionFactor:null,interactionStartCamera:new ut,interactionDirection:null,tiltMode:Jn.TUMBLE},this._sphere=gs()}initialize(){this._intersector=Dh(this.view.state.viewingMode)}zoomStep(e,r){if(!this.active)return;const i=this.view.state,{interactionStartCamera:s}=this._constraintOptions;s&&(this.animation.finished?s.copyFrom(i.camera):this.animation.cameraAt(1,s));let n=!1,o=!1;this.intersectionHelper.intersectScreen(r,this._zoomLocation,this.view.map.ground.opacity===0?Vw:{})&&(n=e>0,o=!0),this._tmpCamera.copyFrom(i.camera),n?this.intersectionHelper.intersectRay(this._tmpCamera.ray,this._intersector,this._tmpCenter)&&(this._tmpCamera.center=this._tmpCenter):this.intersectionHelper.intersectRay(this._tmpCamera.ray,this._intersector,this._zoomLocation)?this._tmpCamera.center=this._zoomLocation:ie(this._zoomLocation,this._tmpCamera.center),this._updateCamera(this._tmpCamera,e,this._zoomLocation,r,o),this.begin(this._tmpCamera)}animationSettings(){return{duration:600,easing:tP}}_updateCamera(e,r,i,s,n){const o=Nr(this.view.spatialReference),a=r6(e,s,o),l=Math.abs(this.view.camera.position.z);me(nI,e.eye),te(nI,nI,-1),vE(e,s,this._tmpRayDir),me(this._tmpRayDir.direction,this._tmpRayDir.direction);const c=ge(Math.min(nTe,1/Math.abs(fe(nI,this._tmpRayDir.direction)))*l,oTe,aTe);if(a===Yn.Horizontal){let h=kse**r;this._sphere[3]=Ce(i),he(this._tmpViewDir,e.center,e.eye);const p=Math.min(Ce(this._tmpViewDir),c);let f=p*h;if(h<=1&&f<L8&&(f=L8,h=f/p),Math.abs(p-f)<1e-6)return;const m=Ce(e.center);if(this._sphere[3]!==m){const y=this._sphere[3]+h*(m-this._sphere[3]);e.center=te(sI,e.center,y/m)}te(this._tmpViewDir,this._tmpViewDir,-h),e.eye=ce(sI,e.center,this._tmpViewDir),Rs(this.view,e,this._constraintOptions),yo(i,e.center)>1e-12&&lY(this._sphere,e,s,this._targetOnSphere)&&irt(this._sphere,e,i,this._targetOnSphere,this.view.camera.heading,this.view.camera.tilt,!0)}else{let h=kse**Math.abs(r);const p=r>0?1:-1;he(this._tmpViewDir,i,e.eye);const f=Ce(this._tmpViewDir),m=this.view._stage.renderView.getMinimalDepthForArea(null,s[0],s[1],this.view.state.camera,art);let y=m??c;y=n&&r>0?Math.min(y,f):y,te(this._tmpRayDir.direction,this._tmpRayDir.direction,y),ce(i,this._tmpRayDir.origin,this._tmpRayDir.direction);let _=y*h;const v=Math.max(L8,1.01*e.nearFar[0]);if(r>0&&_<v&&(_=v,h=_/y),Math.abs(y-_)<1e-6)return;te(this._tmpRayDir.direction,this._tmpRayDir.direction,p*(1-h)),e.eye=ce(sI,e.eye,this._tmpRayDir.direction),e.center=ce(sI,e.center,this._tmpRayDir.direction)}_E(this.view,e)}};_4=u([R("esri.views.3d.state.controllers.global.ZoomStepController")],_4);const sI=C(),nI=C(),lrt=.6,crt=4,urt=60;let v4=class extends gg{constructor(){super(...arguments),this._zoomLocation=C(),this._tmpCamera=new ut,this._tmpRayDir=C(),this._tmpCenter=C(),this._constraintOptions={selection:Ai.ALL,interactionType:Zt.ZOOM,interactionFactor:null,interactionStartCamera:new ut,interactionDirection:null,tiltMode:Jn.TUMBLE}}zoomStep(e,r){if(!this.active)return;const i=this.view.state,{interactionStartCamera:s}=this._constraintOptions;s&&(this.animation.finished?s.copyFrom(i.camera):this.animation.cameraAt(1,s)),this._tmpCamera.copyFrom(i.camera);const n=Dh(this.view.state.viewingMode);let o=!1;e>0?(o=this.intersectionHelper.intersectScreenFreePointFallback(r,this._zoomLocation,this.view.map.ground.opacity===0?Vw:{}),this.intersectionHelper.intersectRay(this._tmpCamera.ray,n,this._tmpCenter)&&(this._tmpCamera.center=this._tmpCenter)):this.intersectionHelper.intersectRay(this._tmpCamera.ray,n,this._zoomLocation)?this._tmpCamera.center=this._zoomLocation:ie(this._zoomLocation,this._tmpCamera.center);const a=lrt**e;let l=this.view._stage.renderView.getMinimalDepthForArea(this.view.voxelWasm,r[0],r[1],this.view.state.camera,urt);he(oI,this._tmpCamera.eye,this._zoomLocation),me(oI,oI);const c=ge(Math.min(nTe,1/Math.abs(fe(hrt,oI)))*Math.abs(this.view.camera.position.z),oTe,aTe);if(l=l??c,l){const h=C();he(h,this._zoomLocation,this._tmpCamera.eye),(l<Ce(h)||!o)&&(me(h,h),ce(this._zoomLocation,this._tmpCamera.eye,te(h,h,l)))}this._updateCamera(this._tmpCamera,a,this._zoomLocation),this.begin(this._tmpCamera)}animationSettings(){return{duration:600,easing:tP}}_updateCamera(e,r,i){he(this._tmpRayDir,i,e.eye);const s=Ce(this._tmpRayDir);let n=s*r;const o=r<=1,a=Math.max(crt,1.01*e.nearFar[0]);n!==0&&(o&&n<a&&(n=a,r=n/s),Math.abs(s-n)<1e-6||(te(this._tmpRayDir,this._tmpRayDir,r),e.eye=he(Vse,i,this._tmpRayDir),e.center=Br(Vse,e.center,i,1-r),Rs(this.view,e,this._constraintOptions)))}};v4=u([R("esri.views.3d.state.controllers.local.ZoomStepController")],v4);const Vse=C(),hrt=Oe(0,0,1),oI=C();function drt(t,e){switch(e){case"primary":return t.pointerType==="touch"||t.button===0;case"secondary":return t.pointerType!=="touch"&&t.button===2;case"tertiary":return t.pointerType!=="touch"&&t.button===1}}function dY(t,e){if(t.pointerType==="touch")return!1;switch(e){case"primary":return t.button===0;case"secondary":return t.button===2;case"tertiary":return t.button===1}}let prt=class extends To{constructor(e,r){super(!0),this._view=e,this.registerIncoming("double-click",r,i=>this._handleDoubleClick(i))}_handleDoubleClick(e){const r=e.data;if(drt(r,"primary")){const i=this._view.state.isGlobal?new _4({view:this._view,mode:"animation"}):new v4({view:this._view,mode:"animation"});this._view.state.switchCameraController(i),i.zoomStep(Math.log(.5)/Math.log(.6),Zi(r.x,r.y)),e.stopPropagation()}}};function frt(t,e,r){return t===De.Global?new grt(r):new mrt(e,r)}let mrt=class{constructor(e,r){this._elevationProvider=e,this._referenceEllipsoid=Nr(r),this._unitInMeters=Za(r,this._referenceEllipsoid.metersPerDegree)}compute(e,r,i,s,n){n||(n={near:0,far:0});let o=e[2]*this._unitInMeters;const a=o,l=o-s,c=this._elevationProvider?.visibleElevationBounds;c&&(o=l>=0?a-this._unitInMeters*c.min:this._unitInMeters*c.max-a);const h={x:(i=i??new _r({xmin:0,ymin:0,zmin:0,xmax:0,ymax:0,zmax:0})).xmax-i.xmin,y:i.ymax-i.ymin,z:4*Math.max(i.xmax-i.xmin,i.ymax-i.ymin)},p=Math.max(h.x,h.y,h.z);he(xv,r,e),gx[0]=xv[0]>0?i.xmax:i.xmin,gx[1]=xv[1]>0?i.ymax:i.ymin,gx[2]=xv[2]>0?p/2:-p/2,he(gx,gx,e),me(xv,xv);const f=1.1*fe(gx,xv)*this._unitInMeters,m=Math.sqrt(o*(o+2*this._referenceEllipsoid.radius)),y=Math.max(i.xmax-i.xmin,i.ymax-i.ymin),_=y*vrt*this._unitInMeters,v=y*brt*this._unitInMeters,w=ge((o-v)/(_-v),0,1)**3,x=Math.min(wt(m,f,w),m)*Math.max(Math.log(Math.abs(l)),1);return bTe(Math.min(x,Math.max(34064e4,p))/this._unitInMeters,yrt,this._unitInMeters,n)}},grt=class{constructor(e){this._referenceEllipsoid=Nr(e)}compute(e,r,i,s,n){n||(n={near:0,far:0});const o=Ce(e),a=o-this._referenceEllipsoid.radius,l=this._referenceEllipsoid.radius+Math.min(0,s),c=Math.abs(a-s),h=Math.max(c,Math.abs(a)),p=Math.sqrt(h*(h+2*l)),f=o+this._referenceEllipsoid.radius;return bTe(1.2*wt(p,f,EX(h)),ge(2e4-(Math.log(h)-7.983)/9.011*19e3,1e3,2e4),1,n)}};function bTe(t,e,r,i){const s=_rt/r;return t/e>s?(i.far=t,i.near=i.far/e):(i.near=s,i.far=i.near*e),i}const yrt=2e4,_rt=2,vrt=.001,brt=1e-4,gx=C(),xv=C();let iD=class extends Te{constructor(e){super(e)}initialize(){this.addHandles(this.view.basemapTerrain.on("elevation-change",e=>this._handleElevationChangeEvent(e)))}_handleElevationChangeEvent(e){if(this.view.state.cameraController)return;const r=this.view.state.camera;e.spatialReference!=null&&qxe(this.view,r,e.extent,e.spatialReference)&&this._applyToCurrentCamera()}_applyToCurrentCamera(){this.view.state.updateCamera(e=>_E(this.view,e,yh.EYE_AND_CENTER))}};u([d({constructOnly:!0})],iD.prototype,"view",void 0),iD=u([R("esri.views.3d.state.ElevationCollisionConstraint")],iD);let XA=class extends Te{constructor(e){super(e),this.nearFarHeuristic=frt(e.view.state.viewingMode,e.view.basemapTerrain,e.view.renderCoordsHelper.spatialReference)}initialize(){this.addHandles([le(()=>[this.view.constraints?.clipDistance?.near,this.view.constraints?.clipDistance?.far],()=>this._clipDistanceNearFarChanged()),le(()=>this.view.constraints?.clipDistance?.mode,()=>this._updateNearFar()),this.view.state.events.on("before-camera-change",e=>this._updateCameraNearFar(e)),le(()=>this.view.renderDataExtent,()=>this._updateNearFar(),jr),le(()=>[this.view.constraints?.altitude?.min,this.view.constraints?.altitude?.max],()=>this._updateAltitude(),jr),le(()=>this.view.constraints?.tilt?.max,()=>this._updateTiltMax(),jr),le(()=>this.view.constraints?.tilt?.mode,()=>this._updateTilt(),jr),le(()=>this.view.state?.camera,()=>this._updateTiltAutoMax(),jr),le(()=>[this.view.map?.ground?.navigationConstraint?.type,this.view.state?.constraints?.collision?.enabled],()=>this._updateCollision(),jr)]),this.view.state.isLocal&&this.addHandles(le(()=>this.view.renderDataExtent,e=>this._updateLocalSurfaceDistance(e),Vr)),this._updateNearFar(),this.view.state.viewingMode!==De.Local&&this._updateAltitude(),this._updateTilt(),this._updateCollision(),this._set("surfaceCollisionConstraint",new iD({view:this.view}))}destroy(){this.surfaceCollisionConstraint&&(this.surfaceCollisionConstraint.destroy(),this._set("surfaceCollisionConstraint",null))}_clipDistanceNearFarChanged(){const e=this.view.constraints?.clipDistance;e&&e.mode!=="auto"&&this.view.state.updateCamera(r=>this._updateCameraNearFarManual(r,e))}_updateNearFar(){this.view.state.updateCamera(e=>this._updateCameraNearFar(e))}_updateCameraNearFar(e){const r=this.view.constraints&&this.view.constraints.clipDistance;(r?r.mode:"auto")==="manual"?this._updateCameraNearFarManual(e,r):this._updateCameraNearFarAuto(e,r)}_updateCameraNearFarAuto(e,r){this.nearFarHeuristic.compute(e.eye,e.center,this.view.renderDataExtent,Q5(this.view,e.eye),e),r&&r.autoUpdate(e.near,e.far)}_updateCameraNearFarManual(e,r){r&&(e.near=r.near,e.far=r.far)}_updateCollision(){const e=this.view.map?.ground?.navigationConstraint?.type,r=!e||e==="stay-above",i=this.view.state.constraints.collision;if(r!==i.enabled){i.enabled=r,r&&this._reapplyConstraints(Ai.COLLISION);const s=this.view.constraints&&this.view.constraints.tilt;s&&s.mode!=="auto"||this._updateTiltAuto()}}_updateAltitude(){const e=this.view.constraints&&this.view.constraints.altitude;e&&this.view.state.viewingMode!==De.Local?this.view.state.constraints.altitude={min:e.min,max:e.max}:this.view.state.constraints.altitude=null,this._reapplyConstraints()}_updateTiltMax(){const e=this.view.constraints&&this.view.constraints.tilt;e&&e.mode!=="auto"&&(this._updateTiltManual(e),this._reapplyConstraints())}_updateTilt(){const e=this.view.constraints&&this.view.constraints.tilt;(e?e.mode:"auto")==="manual"?this._updateTiltManual(e):this._updateTiltAuto(),this._reapplyConstraints()}_updateTiltManual(e){const r=this.view.state.constraints;r.tilt=r.createConstantMaxTilt(Dt(e.max))}_updateTiltAuto(){const e=this.view.state.constraints;e.tilt=e.createDefaultTilt(),this._updateTiltAutoMax()}_updateTiltAutoMax(){const e=this.view.constraints&&this.view.constraints.tilt;if(!e||e.mode!=="auto")return;const r=this.view.state.constraints;if(r.tilt){const i=r.tilt(this.view.state.camera.distance).max;e.autoUpdate(qa(i))}}_updateLocalSurfaceDistance(e){if(e==null)return;let r=Math.max(e.width,e.height);if(r<=0)return;e.zmax!=null&&e.zmin!=null&&(r=Math.max(r,e.zmax-e.zmin));const i=this.view.state,s=3*r/Math.atan(i.camera.fov/2);s!==i.constraints.distance&&(i.constraints.distance=s)}_reapplyConstraints(e=Ai.ALL){this.view.state.updateCamera(r=>Rs(this.view,r,{selection:e,interactionType:Zt.NONE,interactionFactor:null,interactionStartCamera:null,interactionDirection:null,tiltMode:Jn.TUMBLE}))}};u([d({constructOnly:!0})],XA.prototype,"view",void 0),u([d({readOnly:!0})],XA.prototype,"surfaceCollisionConstraint",void 0),XA=u([R("esri.views.3d.state.ConstraintsManager")],XA);let G0=class{get planes(){return this.frustum}get points(){return this._points}get mutablePoints(){return this._points}get direction(){return this._direction}constructor(e){this.renderCoordsHelper=e,this.frustum=WO(),this._points=Zwe(),this.lines=new Array(12),this._origin=C(),this._direction=C(),this._altitude=null;for(let r=0;r<12;r++)this.lines[r]={origin:null,direction:C(),endpoint:null}}update(e){Xwe(e.viewMatrix,e.projectionMatrix,this.frustum,this._points),ie(this._origin,e.eye),ie(this._direction,e.viewForward),this._altitude=this.renderCoordsHelper.getAltitude(this._origin),this._updateLines()}updatePoints(e){for(let r=0;r<this._points.length;r++)ie(this._points[r],e[r]);Ywe(this.frustum,this._points),this._updateLines()}get altitude(){return this._altitude}intersectsSphere(e){return a_(this.frustum,e)}intersectsRay(e){return BJe(this.frustum,e)}intersectsLineSegment(e,r){return GJe(this.frustum,e,r)}intersectsPoint(e){return Jwe(this.frustum,e)}_updateLines(){const e=this._points;for(let r=0;r<4;r++){const i=r+4;D8(this.lines[r],e[r],e[i]),D8(this.lines[r+4],e[r],r===3?e[0]:e[r+1]),D8(this.lines[r+8],e[i],r===3?e[4]:e[i+1])}}};function D8(t,e,r){t.origin=e,t.endpoint=r,Hg(t.direction,e,r)}G0.planePointIndices=jJe,G0.nearFarLineIndices=[[Ye.NEAR_BOTTOM_LEFT,Ye.FAR_BOTTOM_LEFT],[Ye.NEAR_BOTTOM_RIGHT,Ye.FAR_BOTTOM_RIGHT],[Ye.NEAR_TOP_RIGHT,Ye.FAR_TOP_RIGHT],[Ye.NEAR_TOP_LEFT,Ye.FAR_TOP_LEFT]];let B3=class extends og{set desiredCamera(e){this._set("desiredCamera",e.clone())}constructor(e){super(e)}get canStop(){return!0}get constraintEnabled(){return this.view.state.constraints.collision.enabled}onControllerStart(){this.state=qi.Running,this.addHandles(this.view.basemapTerrain.on("elevation-change",e=>this._handleElevationChangeEvent(e))),this._applyCorrection()}onControllerEnd(){this.removeAllHandles()}stepController(){}_handleElevationChangeEvent(e){(e.spatialReference==null||qxe(this.view,this.desiredCamera,e.extent,e.spatialReference))&&this._applyCorrection()}_applyCorrection(){this.view.state.updateCamera(e=>{e.copyViewFrom(this.desiredCamera),_E(this.view,e,yh.EYE_AND_CENTER)||this.constraintEnabled||(this.state=qi.Stopped)})}};u([d({constructOnly:!0})],B3.prototype,"desiredCamera",null),B3=u([R("esri.views.3d.state.controllers.SurfaceCollisionCorrectionController")],B3);const wrt=C(),aI=C();function pY(){return{direction:C(),up:C()}}function wTe(t,e,r,i,s){let n=me(wrt,t),o=fe(n,i);const a=o>0;o=Math.abs(o),o>.99&&(o=Math.abs(fe(e,i)),o<.99?(ie(n,e),a&&te(n,n,-1)):n=null);let l=0;if(n){te(aI,i,fe(i,n)),he(n,n,aI);const h=fe(n,s)/(Ce(n)*Ce(s));at(aI,n,s),l=(fe(aI,i)>0?1:-1)*qa(Pn(h))}const c=qa(Pn(-fe(i,t)/Ce(t)));return r?(r.heading=l,r.tilt=c,r):{heading:l,tilt:c}}const xTe=Oe(0,1,0),TTe=Oe(0,0,1),rC=be(),pm=C(),fm=C();function STe(t,e,r,i=pY()){const{direction:s,up:n}=i;return C0e(rC,-Dt(e)),u2(rC,rC,Dt(r)),$e(s,TTe,rC),te(s,s,-1),$e(n,xTe,rC),i}function xrt(t,e,r,i){return wTe(e,r,i,TTe,xTe)}function Trt(t,e,r,i){const s=STe(t,r,i),n=C();return te(n,s.direction,-e),ce(n,n,t),{up:s.up,eye:n,heading:r,tilt:i}}function Srt(t){return qa(t)}function Ert(t){return Dt(t)}function ETe(t,e,r,i,s){const n=t.renderSpatialReference,o=t.map&&t.spatialReference||e.spatialReference;return wo(e,pm,n),wo(e,fm,n),pm[0]-=r/2,fm[0]+=r/2,pm[1]-=i/2,fm[1]+=i/2,Ws(pm,n,pm,o),Ws(fm,n,fm,o),s?(s.xmin=pm[0],s.ymin=pm[1],s.xmax=fm[0],s.ymax=fm[1],s.spatialReference=o):s=new _r(pm[0],pm[1],fm[0],fm[1],o),s}const Crt=Object.freeze(Object.defineProperty({__proto__:null,directionToHeadingTilt:xrt,eyeForCenterWithHeadingTilt:Trt,eyeTiltToLookAtTilt:Ert,headingTiltToDirectionUp:STe,lookAtTiltToEyeTilt:Srt,toExtent:ETe},Symbol.toStringTag,{value:"Module"})),CTe=Oe(0,0,1),ATe=me(C(),Oe(1,1,1)),Art=new C_(-180,180),iC=be(),$0=C(),yx=C();function OTe(t,e,r,i=pY()){at($0,t,CTe),fe($0,$0)===0&&at($0,t,ATe),mu(iC,-Dt(e),t),dc(iC,iC,-Dt(r),$0);const{up:s,direction:n}=i;return at(s,$0,t),me(s,s),$e(s,s,iC),me(n,t),ca(n,n),$e(n,n,iC),i}function Ort(t,e,r,i){const s=$0,n=yx;return me(s,t),at(yx,s,CTe),fe(yx,yx)===0&&at(yx,s,ATe),at(n,yx,s),wTe(e,r,i,s,n)}function Rrt(t,e,r,i){const s={eye:C(),up:null,tilt:i,heading:r},n=$0;n[0]=t[0],n[1]=t[2],n[2]=-t[1];const o=e,a=Dt(r),l=Dt(i),c=Math.sin(a),h=Math.cos(a),p=Math.sin(l),f=Math.cos(l),m=Ce(n);let y;if(Math.abs(l)<1e-8)y=o+m;else{const Y=m/p,P=Ch(o/Y),V=Math.PI-l-P;y=Y*Math.sin(V)}const _=f*o,v=o*o*(p*p),w=h*h*v,x=y-_,T=x*x,S=w*(w+T-n[1]*n[1]);if(S<0)return te(s.eye,n,y/m),s.tilt=0,lI(s,t);const O=Math.sqrt(S),A=n[1]*x,I=w+T;let M;if(M=h>0?-O+A:O+A,Math.abs(I)<1e-8)return m<1e-8?(s.eye[0]=0,s.eye[1]=0,s.eye[2]=o):te(s.eye,n,y/m),s.tilt=0,N8(s.eye),lI(s,t);s.eye[1]=M/I;const k=c*c*v,L=p*o,D=h*L*s.eye[1],U=s.eye[1]*s.eye[1],X=1-U,W=Math.sqrt(X),G=w*U+k-2*D*W*x+X*T;return Math.abs(G)<1e-8?(te(s.eye,n,y/m),s.tilt=0,N8(s.eye),lI(s,t)):(s.eye[0]=(X*(y*n[0]-_*n[0])-L*W*(n[0]*s.eye[1]*h+n[2]*c))/G,s.eye[2]=(X*(y*n[2]-_*n[2])-L*W*(n[2]*s.eye[1]*h-n[0]*c))/G,te(s.eye,s.eye,y),N8(s.eye),lI(s,t))}function N8(t){const e=t[1];t[1]=-t[2],t[2]=e}function lI(t,e){const r=OTe(e,t.heading,t.tilt);return t.up=r.up,t}function Prt(t,e,r){const i=Ce(e),s=Math.sqrt(r*r+i*i-2*r*i*Math.cos(Math.PI-t)),n=Ch(r/(s/Math.sin(t)));return qa(t-n)}function Mrt(t,e,r){const i=Dt(t),s=Ce(e);return Ch(r/(s/Math.sin(i)))+i}function RTe(t,e,r,i,s){let n,o,a,l;const c=e.latitude,h=Nr(t.spatialReference).radius,p=e.longitude,f=kKe(c,r,h)/2;n=p-f,o=p+f;const m=Dt(c),y=(1+Math.sin(m))/(1-Math.sin(m)),_=(y+1)*Math.tan(i/h/2),v=_*_;function w(T){const S=Math.PI/2;return(T=u4e.normalize(T,-S))>S&&(T=Math.PI-T),T}if(a=1.5*Math.PI-2*Math.atan(.5*(_+Math.sqrt(4*y+v))),l=a+i/h,a=w(a),l=w(l),l<a){const T=l;l=a,a=T}if(a=Math.max(qa(a),-90),l=Math.min(qa(l),90),o=Art.monotonic(n,o),o-n>180){const T=(o-n-180)/2;n+=T,o-=T}const x=t.spatialReference&&t.spatialReference.isGeographic?t.spatialReference:je.WGS84;return s?(s.xmin=n,s.ymin=a,s.xmax=o,s.ymax=l,s.spatialReference=x):s=new _r(n,a,o,l,x),t.spatialReference&&t.spatialReference.isWebMercator&&T3(s,!1,s),s}const Irt=Object.freeze(Object.defineProperty({__proto__:null,directionToHeadingTilt:Ort,eyeForCenterWithHeadingTilt:Rrt,eyeTiltToLookAtTilt:Mrt,headingTiltToDirectionUp:OTe,lookAtTiltToEyeTilt:Prt,toExtent:RTe},Symbol.toStringTag,{value:"Module"}));function b4(t){return t.type==="point"}let fY=class{constructor(e,r=null,i=0){this.array=e,this.spatialReference=r,this.offset=i}};function PTe(t){return"array"in t}function wf(t,e,r="ground"){if(b4(e))return t.getElevation(e.x,e.y,e.z||0,e.spatialReference,r);if(PTe(e)){let i=e.offset;return t.getElevation(e.array[i++],e.array[i++],e.array[i]||0,e.spatialReference??t.spatialReference,r)}return t.getElevation(e[0],e[1],e[2]||0,t.spatialReference,r)}function qj(t,e){return t!=null&&(e==null||(e===De.Local?!t.isGeographic||t.isWGS84||t.wkid===hh.CGCS2000:t.isWebMercator||t.isWGS84||t.wkid===hh.CGCS2000||t.wkid===hh.GCSMARS2000||t.wkid===hh.GCSMARS2000_SPHERE||t.wkid===hh.GCSMOON2000))}const MTe=Q.getLogger("esri.views.3d.support.cameraUtils"),ITe=39.37,$Te=96,Wj=1,$rt=8,Lrt=5,LTe=1,zse=C(),Drt={heading:0,tilt:0},j0=new pt,Nrt=new C_(-20037508342788905e-9,20037508342788905e-9),Frt=new C_(-180,180);var Go;function rP(t){return t.spatialReference||je.WGS84}function bE(t){return t.viewingMode==="global"?Irt:Crt}function Urt(t,e,r,i,s){return bE(t).headingTiltToDirectionUp(e,r,i,s)}function rg(t,e){if(e==null)return null;const r=t.renderSpatialReference,i=bE(t).headingTiltToDirectionUp,s=C();if(!wo(e.position,s,r))return null;const n=i(s,e.heading,e.tilt);te(n.direction,n.direction,t.state.camera.distance),ce(n.direction,n.direction,s);const o=kw(t,s,n.direction,n.up);return o.fov=Dt(e.fov),o}(function(t){t[t.LOCKED=0]="LOCKED",t[t.ADJUST=1]="ADJUST"})(Go||(Go={}));const _x=C();function P2(t,e,r){const i=t.renderSpatialReference,s=i6(t,e.eye,e.viewForward,e.up,Drt);let n=rP(t);return Ws(e.eye,i,_x,n)||(n=je.WGS84,Ws(e.eye,i,_x,n)),r==null?new Ih(new pt(_x,n),s.heading,s.tilt,qa(e.fov)):(r.position.x=_x[0],r.position.y=_x[1],r.position.z=_x[2],r.position.spatialReference=n,r.heading=s.heading,r.tilt=s.tilt,r.fov=qa(e.fov),r)}function mY(t,e,r){const i=t.state.camera,s=i.width/2/i.pixelRatio;return t.renderCoordsHelper.viewingMode===De.Global&&r!=null&&(e*=Math.cos(Dt(r))),e/=t.renderCoordsHelper.unitInMeters,s/($Te*ITe/e)/Math.tan(i.fovX/2)}function hw(t,e,r){const i=t.state.camera,s=e*Math.tan(i.fovX/2),n=i.width/2/i.pixelRatio;let o=$Te*ITe/(n/s);return t.renderCoordsHelper.viewingMode===De.Global&&r!=null&&(o/=Math.cos(Dt(r))),o*t.renderCoordsHelper.unitInMeters}function DTe(t,e,r,i,s,n){return NTe(t,e,mY(t,r,e.latitude),i,s,n)}function NTe(t,e,r,i,s,n){if(Ib(n)){const a=new wE(n.signal);return eR(t,i.heading,i.tilt,e,r,s,a),void a.resolver.promise.then(l=>{const c=x4(t,l,i.fov);if(c!=null)return n.resolver.resolve(c);n.resolver.reject()},l=>n.resolver.reject(l))}const o=eR(t,i.heading,i.tilt,e,r,s);return x4(t,o,i.fov,n)}function i6(t,e,r,i,s){return bE(t).directionToHeadingTilt(e,r,i,s)}function krt(t,e){return!!(t.basemapTerrain&&t.renderCoordsHelper.fromRenderCoords(e,j0,t.spatialReference)&&t.elevationProvider&&(wf(t.elevationProvider,j0)??0)>(j0.z??0)-LTe)}async function Vrt(t,e,r){if(!t.renderCoordsHelper.fromRenderCoords(e,j0,t.spatialReference)||!t.elevationProvider)return!1;const i=j0.z??0;return(await t.elevationProvider.queryElevation(j0.x,j0.y,i,j0.spatialReference,"ground",r)??0)>i-LTe}async function zrt(t,e,r){const i=C();if(e)if(e instanceof pt){if(wo(e,i,t.renderSpatialReference),e.z==null&&t.basemapTerrain!=null&&t.elevationProvider!=null){const s=await t.elevationProvider.queryElevation(e.x,e.y,e.z??0,e.spatialReference,"ground",r);return s!=null&&t.renderCoordsHelper.setAltitude(i,s),i}}else ie(i,e);else ie(i,t.state.camera.center);return i}function Brt(t,e){const r=C();if(e&&e instanceof pt){if(wo(e,r,t.renderSpatialReference),e.z==null&&t.basemapTerrain!=null&&t.elevationProvider!=null){const i=wf(t.elevationProvider,e);i!=null&&t.renderCoordsHelper.setAltitude(r,i)}}else ie(r,e||t.state.camera.center);return r}function eR(t,e,r,i,s,n,o){const a=i&&i instanceof pt?i:null;if(Ib(o))return zrt(t,i,o.signal).then(c=>{Zj(t,e,r,a,c,s,n,o)},c=>o.resolver.reject(c)),null;const l=Brt(t,i);return Zj(t,e,r,a,l,s,n,o)}function Zj(t,e,r,i,s,n,o,a){if(i==null){const p=t.renderSpatialReference;if((i=Ug(s,p,rP(t)))==null)return null}n=Math.max(n,t.state.constraints.minimumPoiDistance);const l=Hrt(t,e,r,s,n,o),c=(0,bE(t).eyeForCenterWithHeadingTilt)(s,n,l.heading,l.tilt);if(o===Go.ADJUST&&t.viewingMode==="global"&&r>0){const p=()=>{const m=FTe(t,s,n,Wrt(t,n,r,s));return o=r-m<1?Go.LOCKED:Go.ADJUST,Zj(t,e,m,i,s,n,o,a)},f=t.map.ground.navigationConstraint;if(!f||f.type==="stay-above"){if(krt(t,c.eye))return p();if(Ib(a))return Vrt(t,c.eye,a.signal).then(m=>m?p():(a.resolver.resolve({eye:c.eye,up:c.up,center:$s(s),heading:c.heading,tilt:c.tilt}),null)),null}}const h=!a||Ib(a)?{center:C(),eye:C(),up:C(),tilt:0,heading:0}:a;return h.eye=c.eye,h.up=c.up,h.center=$s(s),h.heading=c.heading,h.tilt=c.tilt,Ib(a)&&a.resolver.resolve(h),h}function G3(t,e,r,i,s,n=null){let o,a,l;if(t.state.isGlobal){if(!qj(e.spatialReference,De.Global))return Ib(n)&&n.resolver.reject(),null;const v=new pt(e.xmin,e.ymin,e.spatialReference),w=new pt(e.xmax,e.ymax,e.spatialReference),x=e.spatialReference.isGeographic?Frt:Nrt;o=new pt({x:x.center(v.x,w.x),y:(w.y+v.y)/2,z:e.zmax!=null&&e.zmin!=null?(e.zmax+e.zmin)/2:void 0,spatialReference:e.spatialReference});const T=Nr(e.spatialReference),S=UKe(o,v,w);a=S.lon,l=S.lat,x.diff(v.x,w.x)>x.range/2&&(a+=T.halfCircumference),a=Math.min(a,T.halfCircumference),l=Math.min(l,T.halfCircumference)}else{const v=t.renderSpatialReference??e.spatialReference;v.equals(e.spatialReference)||(e=Lw(e,v)),a=e.xmax-e.xmin,l=e.ymax-e.ymin;const w=e.zmax!=null&&e.zmin!=null?(e.zmax+e.zmin)/2:void 0;o=new pt({x:e.xmin+.5*a,y:e.ymin+.5*l,z:w,spatialReference:v})}const c=e.zmax!=null&&e.zmin!=null?e.zmax-e.zmin:0,h=t.state.camera,p=1/Math.tan(h.fovX/2),f=1/Math.tan(h.fovY/2),m=1/Math.tan(h.fov/2),y=Math.max(.5*a*p,.5*l*f,.5*c*m)/Wj;if(Ib(n)){const v=new wE(n.signal);return eR(t,r,i,o,y,s,v),void v.resolver.promise.then(w=>{const x=x4(t,w,t.camera.fov);if(x!=null)return n.resolver.resolve(x);n.resolver.reject()},w=>n.resolver.reject(w))}const _=eR(t,r,i,o,y,s);return x4(t,_,t.camera.fov,n)}function Grt(t,e,r){const i=t.renderSpatialReference,s=Ug(r,i,rP(t));if(s==null)return null;const n=Math.tan(e.fovX/2),o=Math.tan(e.fovY/2),a=PR(e.eye,r),l=2*a*n*Wj,c=2*a*o*Wj;return t.viewingMode==="global"?RTe(t,s,l,c):ETe(t,s,l,c)}function jrt(t,e,r){const i=t.pointsOfInterest.centerOnSurfaceFrequent.distance;if(Math.log(r/i)/Math.LN2>$rt)return!0;const s=t.renderSpatialReference,n=rP(t),o=Ug(e,s,n),a=Ug(t.pointsOfInterest.centerOnSurfaceFrequent.renderLocation,s,n);if(o==null||a==null)return!1;const l=Math.tan(.5*t.state.camera.fov)*i;return a.distance(o)/l>Lrt}function Hrt(t,e,r,i,s,n){let o=0;return n===Go.ADJUST&&jrt(t,i,s)?(e=0,o=qrt(t,s,r,i)):o=gY(t,i,s,r),o=t.state.constraints.clampTilt(s,o),{heading:e,tilt:r=FTe(t,i,s,o)}}const w4=.7;function qrt(t,e,r,i){const s=gY(t,i,e,r);if(!t.state.constraints.tilt)return s;const n=t.state.constraints.tilt(e);n.max=Math.min(n.max,.5*Math.PI);const o=n.min*(1-w4)+n.max*w4;return Math.min(s,o)}function Wrt(t,e,r,i){let s=gY(t,i,e,r);if(!t.state.constraints.tilt)return s;const n=t.state.constraints.tilt(e);return s=Math.min(s,.5*Math.PI),n.min*(1-w4)+s*w4}function FTe(t,e,r,i){return bE(t).lookAtTiltToEyeTilt(i,e,r)}function gY(t,e,r,i){return bE(t).eyeTiltToLookAtTilt(i,e,r)}function x4(t,e,r,i){if(e==null)return null;const s=t.renderSpatialReference,n=Ug(e.eye,s,rP(t));return n==null?null:i!=null?(i.position=n,i.heading=e.heading,i.tilt=e.tilt,i.fov=r,i):new Ih(n,e.heading,e.tilt,r)}function Zrt(t,e){const r=t.basemapTerrain?.tilingScheme;if(r)return r.levelAtScale(e);MTe.error("#scaleToZoom()","Cannot compute zoom from scale without a tiling scheme")}function UTe(t,e){const r=t.basemapTerrain?.tilingScheme;if(r)return r.scaleAtLevel(e);MTe.error("#zoomToScale()","Cannot compute scale from zoom without a tiling scheme")}function kTe(t,e){return Ws(e.center,t.renderSpatialReference,zse,je.WGS84),hw(t,e.distance,zse[1])}let wE=class{constructor(e){this.signal=e,this.resolver=qs()}};function Ib(t){return t&&"resolver"in t}const Xrt=.66;function VTe(t){return 360-bW.normalize(t)}function s6(t){return bW.normalize(360-t)}function sC(t){return t!=null&&t.resolver&&t.resolver.reject(),null}function Yrt(t,e){return t!=null&&t.resolver&&t.resolver.resolve(e),e}function zTe(t,e,r,i=null){if(!e)return sC(i);const s=t.spatialReference||je.WGS84;if(e.camera!=null){const c=Sw(e.camera.position,s);if(c==null)return sC(i);const h=e.camera.clone();return h.position=c.clone(),Yrt(i,h)}if(e.targetGeometry==null)return sC(i);const n=e.get("targetGeometry.spatialReference");if(n&&!p_(n,s))return sC(i);const o=P2(t,t.state.camera);let a=Go.ADJUST;if(e.rotation!=null&&(o.heading=VTe(e.rotation),a=Go.LOCKED),r!=null&&(o.tilt=r),e.targetGeometry.type==="point"){const c=e.targetGeometry;let h;const p=e.targetGeometry.clone();return h=e.scale!=null?mY(t,e.scale,c.latitude):t.state.camera.distance,NTe(t,p,h,o,a,i)}const l=e.targetGeometry.extent;return l?G3(t,l,o.heading,o.tilt,a,i):sC(i)}function Jrt(t,e,r=null){return r==null&&(r=new lp),vY(t,null,e.clone(),r)}async function Qrt(t,e,r){const i=lit(t,e);if(!i)throw new F("viewpointutils-create:no-target","Missing target for creating viewpoint");const s=new Ih({fov:t.camera.fov}),n=new lp({camera:s});if(i.target instanceof lp)return Tv(await tit(t,i.target,i,r,n));if(i.target instanceof Ih)return Tv(GTe(t,i.target,n));const o=i.scale!=null||i.zoom!=null;if(i.target instanceof _r){const c=i.target.xmin===i.target.xmax||i.target.ymin===i.target.ymax;return Tv(o||c?await Xj(t,i,i.target.center,s,r,n):await nit(t,i,i.target,s,r,n))}const a={boundingBox:xi(),hasZ:!1,screenSpaceObjects:[]},l=o?Krt(t,i):void 0;if(await BTe(t,i.target,l,a),isFinite(a.boundingBox[0])){let c;if(Bd(a.boundingBox,Cs),Zc.x=Cs[0],Zc.y=Cs[1],Zc.z=Cs[2],Zc.spatialReference=t.spatialReference,isFinite(Zc.z)&&a.hasZ?c=BW(a.boundingBox):(Zc.z=void 0,c=uNe(zW(a.boundingBox,uit))),o||c)return Tv(await Xj(t,i,Zc,s,r,n));const h=cit(t,a.screenSpaceObjects);return Tv(await ait(t,i,Zc,a.boundingBox,h,s,r,n))}return i.position?Tv(iit(t,i,s,n)):Tv(await sit(t,i,s,r,n))}function yY(t,e){return e.scale==null&&e.zoom!=null?UTe(t,e.zoom):e.scale}function Krt(t,e){const r=yY(t,e);return r?oXe(r):void 0}function _Y(t,e){let r=!1;return e.heading!=null?(t.heading=e.heading,r=!0):e.rotation!=null&&(t.heading=VTe(e.rotation),r=!0),e.tilt!=null&&(t.tilt=e.tilt,r=!0),e.fov!=null&&(t.fov=e.fov),r}function vY(t,e,r,i){const s=t.spatialReference||je.WGS84;return(e=e??rg(t,r))==null||(i.targetGeometry=Ug(e.center,t.renderSpatialReference,s),i.scale=kTe(t,e),i.rotation=s6(r.heading),i.camera=r),i}function T4(t,e,r){const i=()=>new F("viewpointutils:invalid-geometry","The target is missing a valid geometry");if(!e)throw i();if(!p_(e.spatialReference,t.spatialReference))throw new F("viewpointutils:incompatible-spatialreference",`Spatial reference (${e.spatialReference?e.spatialReference.wkid:"unknown"}) is incompatible with the view (${t.spatialReference?.wkid})`,{geometry:e});const s=[];if(!e.hasZ&&t.basemapTerrain){let a;switch(e.type){case"point":a=e;break;case"multipoint":case"polyline":a=e.extent?.center;break;case"mesh":a=e.origin;break;case"extent":a=e.center;break;case"polygon":a=e.centroid}a&&t.basemapTerrain.spatialReference!=null&&p_(a,t.basemapTerrain.spatialReference)&&t.elevationProvider?Cs[2]=wf(t.elevationProvider,a)??0:Cs[2]=0}(0,hit[e.type])(e,a=>{s.push(a[0],a[1],a[2])},Cs);const n=s.length/3;if(n===0)throw i();const o=new Array(s.length);if(oi(s,e.spatialReference,0,o,t.spatialReference,0,n)){e.hasZ&&(r.hasZ=!0);for(let a=0;a<o.length;a+=3)e.hasZ?(Cs[0]=o[a],Cs[1]=o[a+1],Cs[2]=o[a+2]):(Cs[0]=o[a],Cs[1]=o[a+1]),kf(r.boundingBox,Cs)}}async function eit(t,e,r,i){const s=await gu(t.whenViewForGraphic(e));if(s.ok===!1||s.value==null||!("whenGraphicBounds"in s.value))return void T4(t,e.geometry,i);const n=s.value,o=await gu(n.whenGraphicBounds(e,{minDemResolution:r}));if(o.ok===!1)return void T4(t,e.geometry,i);const{screenSpaceObjects:a,boundingBox:l}=o.value;n2(i.boundingBox,l),a&&a.forEach(c=>{i.screenSpaceObjects.push(c)}),isFinite(l[2])&&(i.hasZ=!0)}async function BTe(t,e,r,i){if(Array.isArray(e)&&e.length===2){const s=e[0],n=e[1];if(typeof s=="number"&&typeof n=="number")return Zc.x=s,Zc.y=n,Zc.z=void 0,Zc.spatialReference=t.spatialReference?.isGeographic?t.spatialReference:je.WGS84,void T4(t,Zc,i)}e&&"map"in e&&typeof e.map=="function"?await Yf(e.map(s=>BTe(t,s,r,i))):e instanceof q_?T4(t,e,i):e instanceof Oh&&await eit(t,e,r,i)}async function tit(t,e,r,i,s){if(e.camera!=null)return GTe(t,e.camera,s);s.scale=e.scale,s.rotation=e.rotation,s.targetGeometry=e.targetGeometry!=null?e.targetGeometry.clone():null,s.camera=null,r.heading!=null?s.rotation=s6(r.heading):r.rotation!=null&&(s.rotation=r.rotation);const n=yY(t,r);n!=null&&(s.scale=n);const o=new wE(i);return zTe(t,s,r.tilt,o),s.camera=await o.resolver.promise,s}function GTe(t,e,r){const i=t.spatialReference,s=Sw(e.position,i);return s==null?null:((e=e.clone()).fov=t.camera.fov,e.position=s,vY(t,null,e,r))}function rit(t,e,r,i,s,n){const o=t.renderSpatialReference;return wo(r,uI,o),wo(e,F8,o),n.targetGeometry=new pt(e),s.position=new pt(r),he(S4,F8,uI),i6(t,uI,S4,i.up,s),n.scale=hw(t,di(uI,F8),n.targetGeometry.latitude),n.rotation=s6(s.heading),n.camera=s,n}async function Xj(t,e,r,i,s,n){if(r==null)throw new F("createfromcenter","invalid point");n.targetGeometry=r.clone();const o=kw(t);if(e.position)return rit(t,n.targetGeometry,e.position,o,i,n);if(e.zoomFactor){const l=o.distance/e.zoomFactor,c=te(Cs,o.viewForward,-l);o.eye=ce(Cs,o.center,c),n.scale=hw(t,l,r.latitude)}P2(t,o,i);const a=_Y(i,e)?Go.LOCKED:Go.ADJUST;if(!e.zoomFactor){const l=yY(t,e);l==null?(wo(r,Cs,t.renderSpatialReference),Jwe(o.frustum,Cs)?n.scale=hw(t,di(o.eye,Cs),r.latitude):n.scale=kTe(t,o)):n.scale=l;const c=new wE(s);DTe(t,n.targetGeometry,n.scale,i,a,c),n.camera=await c.resolver.promise}return n}function iit(t,e,r,i){const s=kw(t);return ie(S4,s.viewForward),i6(t,s.eye,S4,s.up,U8),r.position=new pt(e.position),r.heading=e.heading!=null?e.heading:U8.heading,r.tilt=e.tilt!=null?e.tilt:U8.tilt,vY(t,null,r,i)}async function sit(t,e,r,i,s){const n=kw(t);return Xj(t,e,Ug(n.center,t.renderSpatialReference,t.spatialReference),r,i,s)}async function nit(t,e,r,i,s,n){n.targetGeometry=r.clone();const o=kw(t);P2(t,o,i);const a=_Y(i,e)?Go.LOCKED:Go.ADJUST,l=new wE(s);return G3(t,r,i.heading,i.tilt,a,l),n.camera=await l.resolver.promise,n}function oit(t,e,r,i,s){let n=0;r.z!=null?n=r.z:t.basemapTerrain&&t.elevationProvider&&(n=wf(t.elevationProvider,r)),se(Cs,r.x,r.y,n),Tl(t.spatialReference,Cs,Bse,t.renderSpatialReference),Ph(cI,Bse),Mh(cI,cI),xi(nC);const o=[[0,1,2],[3,1,2],[0,4,2],[3,4,2],[0,1,5],[3,1,5],[0,4,5],[3,4,5]];for(let y=0;y<o.length;y++){const _=o[y];let v=i[_[2]];isFinite(v)||(v=n),se(Cs,i[_[0]],i[_[1]],v),Ws(Cs,t.spatialReference,Cs,t.renderSpatialReference),kf(nC,hc(Cs,Cs,cI))}const a=Ow(nC),l=Z_(nC),c=Rw(nC),h=1/Math.tan(e.fovX/2),p=1/Math.tan(e.fovY/2),f=.5*Math.sqrt(a*a+c*c)*Math.max(p,h)+.5*l,m=.5*l*p+.5*Math.max(a,c);return Math.max(f,m)/s}async function ait(t,e,r,i,s,n,o,a){a.targetGeometry=r.clone();const l=kw(t),c=oit(t,l,r,i,s);P2(t,l,n);const h=_Y(n,e)?Go.LOCKED:Go.ADJUST;a.scale=hw(t,c,a.targetGeometry.latitude);const p=new wE(o);return DTe(t,a.targetGeometry,a.scale,n,h,p),a.camera=await p.resolver.promise,a}function lit(t,e){if(!e||!t.spatialReference)return null;const r={target:void 0};return"declaredClass"in e||Array.isArray(e)?r.target=e:(Object.assign(r,e),e.center&&!r.target&&(r.target=e.center)),r}function Tv(t){return t&&t.camera!=null&&(t.rotation=s6(t.camera.heading)),t}function cit(t,e){const r=Xrt;if(!e.length)return r;let i=Number.NEGATIVE_INFINITY;for(let s=0;s<e.length;s++){const n=e[s].screenSpaceBoundingRect;i=Math.max(i,Math.abs(n[0]),Math.abs(n[1]),Math.abs(n[2]),Math.abs(n[3]))}return r-i/Math.min(t.width,t.height)*2}const Cs=C(),Bse=be(),cI=Li(),nC=pn(),uit=Ut(),S4=C(),uI=C(),F8=C(),U8={heading:0,tilt:0},Zc=new pt,hit={point(t,e,r){r[0]=t.x,r[1]=t.y,t.z!=null&&(r[2]=t.z),e(r)},polygon(t,e,r){const i=t.hasZ;for(let s=0;s<t.rings.length;s++){const n=t.rings[s];for(let o=0;o<n.length;o++)r[0]=n[o][0],r[1]=n[o][1],i&&(r[2]=n[o][2]),e(r)}},polyline(t,e,r){const i=t.hasZ;for(let s=0;s<t.paths.length;s++){const n=t.paths[s];for(let o=0;o<n.length;o++)r[0]=n[o][0],r[1]=n[o][1],i&&(r[2]=n[o][2]),e(r)}},multipoint(t,e,r){const i=t.points,s=t.hasZ;for(let n=0;n<i.length;n++)r[0]=i[n][0],r[1]=i[n][1],s&&(r[2]=i[n][2]),e(r)},extent(t,e,r){t.zmin!=null&&t.zmax!=null?(e(se(r,t.xmin,t.ymin,t.zmin)),e(se(r,t.xmax,t.ymin,t.zmin)),e(se(r,t.xmin,t.ymax,t.zmin)),e(se(r,t.xmax,t.ymax,t.zmin)),e(se(r,t.xmin,t.ymin,t.zmax)),e(se(r,t.xmax,t.ymin,t.zmax)),e(se(r,t.xmin,t.ymax,t.zmax)),e(se(r,t.xmax,t.ymax,t.zmax))):(e(se(r,t.xmin,t.ymin,r[2])),e(se(r,t.xmax,t.ymin,r[2])),e(se(r,t.xmin,t.ymax,r[2])),e(se(r,t.xmax,t.ymax,r[2])))},mesh(t,e,r){const i=t.vertexAttributes&&t.vertexAttributes.position;if(i)for(let s=0;s<i.length;s+=3)e(se(r,i[s],i[s+1],i[s+2]))}};let dit=class{constructor(e,r,i){this.target=e,this.options=r,this.view=i,this.state="pending",this._animationController=null,this._promise=new Promise((s,n)=>{this._resolveCallback=s,this._rejectCallback=n;const o=new AbortController;this.options.signal!=null&&nn(this.options.signal,()=>{this.abort()}),this._abortController=o,this.waitForReady()})}then(e,r){return this._promise.then(e,r)}catch(e){return this._promise.catch(e)}resolve(e){if(this.state!=="finished")return this.state="finished",this._resolveCallback(e)}reject(e){if(this.state!=="finished")return this.state="finished",this._rejectCallback(e)}abort(e=!1){this._abortController.abort(),this.state==="wait-for-animation-finish"&&!e&&this._animationController!=null&&this.view.state.cameraController===this._animationController&&this._animationController.active&&this._animationController.stopController(),this.reject(Dr())}async waitForReady(){if(this.state="wait-for-ready",!this.view.ready)try{await QS(()=>this.view.ready,this._abortController.signal)}catch(e){return this.reject(e)}this.createViewPoint()}createViewPoint(){this.state!=="finished"&&(this.state="wait-for-viewpoint",this._animationController=this.options.animate?this._getAnimationController():null,Qrt(this.view,this.target,this._abortController.signal).then(e=>{if(this.state==="finished")return;const r=e?this._getCameraFromViewpoint(e):null;if(r!=null)if(this.options.animate){if(this._animationController==null)return;this.startAnimation(r,this._animationController)}else this.view.stateManager.setStateCamera(r.camera,{applyConstraints:!r.isFullySpecified,positionAndOrientationOnly:!0,doNotCancelGoToOperation:!0}),this.resolve()},e=>{this.reject(e)}))}_getCameraFromViewpoint(e){const r=!!(this.target instanceof lp&&this.target.camera||this.target instanceof Ih),i=e.camera;if(i==null)return null;if(!this.view.stateManager.isCompatible(i)){const n=i.position,o=n&&n.spatialReference,a=o?o.wkid:"none",l=this.view.spatialReference?.wkid;return this.reject(new F("GotoAnimation:incompatible-spatialreference",`Resulting camera has an incompatible spatial reference (camera: ${a}, view: ${l})`,{camera:i})),null}const s=rg(this.view,i);return s==null?(this.reject(new F("GotoAnimation:invalid-camera","Resulting camera is invalid")),null):{viewpoint:e,camera:s,isFullySpecified:r}}startAnimation(e,r){this.state="wait-for-animation-finish";const i=r.viewAnimation;if(i==null)return void this.reject(new F("GotoAnimation:missing-animation","Unreachable code in view.stateManager"));if(i.update(e.viewpoint,"running"),!r.active||r.viewAnimation==null||r.viewAnimation.target!==e.viewpoint||this.view.state.cameraController!==r)return this.abort();let s;e.isFullySpecified?(s=new B3({view:this.view,desiredCamera:e.camera}),_E(this.view,e.camera,yh.EYE_AND_CENTER)):Rs(this.view,e.camera),r.begin(e.camera,this.options);const n=()=>{const a=this.view.state.cameraController;s&&(a&&a.active?a instanceof gg&&a.viewAnimation!=null&&a.viewAnimation.target===e.viewpoint&&(this.view.state.cameraController=s):r.viewAnimation!=null&&r.viewAnimation.target===e.viewpoint&&r.state==="finished"&&(this.view.state.cameraController=s))},o=a=>{if(this.view.state!=null)switch(r.state){case qi.Finished:switch(this.state){case"pending":case"wait-for-ready":case"wait-for-viewpoint":case"wait-for-animation-finish":this.resolve()}break;case qi.Ready:case qi.Rejected:case qi.Running:case qi.Stopped:switch(this.state){case"pending":case"wait-for-ready":case"wait-for-viewpoint":case"wait-for-animation-finish":this.reject(a)}}};i.when(n,a=>o(a)),r.asyncResult={resolve:()=>o(),reject:a=>o(a)}}_getAnimationController(){let e=null,r=null;const i=this.view.state.cameraController;return i instanceof gg&&(i.updateStateFromViewAnimation(),i.active&&(e=i,r=e.viewAnimation)),e!=null||(e=new gg({view:this.view,mode:"animation"}),r=e.viewAnimation,this.view.state.switchCameraController(e))?e:(r?.stop(),this.reject(new F("GotoAnimation:goto-cannot-interrupt","Cannot start an animation while interacting")),null)}},vn=class extends Te{get camera(){const e=this._get("camera");if(!this.ready)return e;const r=P2(this.view,this.view.state.camera,k8);return r&&e&&r.equals(e)?e:r.clone()}set camera(e){this._updatePropertyBeforeReady("camera",e)||(this.view.elevationProvider?.enableElevationCache(!0),this.setStateCamera(rg(this.view,e),{applyConstraints:!1})||Q.getLogger(this).error("#camera=","Invalid camera",e),this.view.elevationProvider?.enableElevationCache(!1))}get contentCamera(){const e=this._get("contentCamera");if(!this.ready)return e;const r=P2(this.view,this.view.state.contentCamera,k8);return r&&e&&r.equals(e)?e:r.clone()}set contentCamera(e){if(this._updatePropertyBeforeReady("contentCamera",e))return;const r=rg(this.view,e);r!=null?(this._updateElevation(r),this.view.state.contentCamera=r):this.view.state.contentCamera=null}installContentCameraReset(e){if(this.removeHandles(V8),this.test.contentCameraResetState.clear(),!this.view.state.fixedContentCamera)return!1;const r=this.zoom,i=this.view.state.camera.distance**2,s=Fa(this.view.state.camera.center),n=e.sticky?this.contentCamera.clone():null;return this.addHandles([le(()=>this.contentCamera,()=>{e.sticky||(this.removeHandles(V8),this.test.contentCameraResetState.clear())}),le(()=>this.zoom,o=>{o!==void 0&&r!==void 0&&(this.test.contentCameraResetState.set("view.zoom",Math.abs(o-r)/2),Math.abs(o-r)>2?this.contentCamera=null:this.view.state.fixedContentCamera||(this.contentCamera=n))}),le(()=>this.view.state.camera,o=>{const a=yo(s,o.center);this.test.contentCameraResetState.set("camera.center",a/i),a>i?this.contentCamera=null:this.view.state.fixedContentCamera||(this.contentCamera=n)})],V8),!0}get center(){return this.ready?this.view.pointsOfInterest.centerOnContent.location:this._get("center")}set center(e){this._updatePropertyBeforeReady("center",e)||(e?this.isCompatible(e)?this.setStateCamera(this._centerToCamera(e),{applyConstraints:!0})?this.view.pointsOfInterest.centerOnContent.runTask():Q.getLogger(this).error("#center=","Invalid center",e):Q.getLogger(this).error("#center=","Center has an incompatible spatial reference (center: "+(e.spatialReference?e.spatialReference.wkid:"none")+", view: "+this.view.spatialReference?.wkid+")",e):Q.getLogger(this).error("#center=","Center may not be null or undefined"))}get extent(){if(!this.ready)return this._get("extent");const e=this.view,r=Grt(e,e.state.camera,e.pointsOfInterest.centerOnContent.renderLocation);return r??this._get("extent")}set extent(e){this._updatePropertyBeforeReady("extent",e)||(e?this.isCompatible(e)?this.setStateCamera(this._extentToCamera(e),{applyConstraints:!0})||Q.getLogger(this).error("#extent=","Invalid extent",e):Q.getLogger(this).error("#extent=","Extent has an incompatible spatial reference (extent: "+(e.spatialReference?e.spatialReference.wkid:"none")+", view: "+this.view.spatialReference?.wkid+")",e):Q.getLogger(this).error("#extent=","Extent may not be null or undefined"))}get frustum(){const e=this._propertiesPool.get("frustum");return e.renderCoordsHelper=this.view.renderCoordsHelper,e.update(this.view.state.camera),e}get hasInitialView(){return!!this.view.get("map.initialViewProperties.viewpoint")}get scale(){if(this.ready){const e=this.view.pointsOfInterest.centerOnContent;return hw(this.view,e.distance,e.location.latitude)}return this._get("scale")}set scale(e){this._updatePropertyBeforeReady("scale",e)||this.setStateCamera(this._scaleToCamera(e),{applyConstraints:!0})||Q.getLogger(this).error("#scale=","Invalid scale",e)}get padding(){if(!this.ready)return this._get("padding");const e=this.view.state.camera,r=e.padding,i=e.pixelRatio,s=this._get("padding"),n=Math.round(r[er.TOP]/i),o=Math.round(r[er.RIGHT]/i),a=Math.round(r[er.BOTTOM]/i),l=Math.round(r[er.LEFT]/i);return s!=null&&s.top===n&&s.right===o&&s.bottom===a&&s.left===l?s:{top:n,right:o,bottom:a,left:l}}set padding(e){this._updatePropertyBeforeReady("padding",e)||(this._paddingToArray(e,this.view.state.camera.pixelRatio,hI),this.view.state.updateCamera(r=>r.padding=hI))}_paddingToArray(e,r,i){e?bi(i,e.top||0,e.right||0,e.bottom||0,e.left||0):bi(i,0,0,0,0);for(let s=0;s<4;s++)i[s]=Math.round(i[s]*r)}get screenCenter(){const e=this.padding;return Ah((this.view.width-(e.left+e.right))/2+e.left,(this.view.height-(e.top+e.bottom))/2+e.top)}get viewpoint(){return this.ready?Jrt(this.view,this.camera):this._get("viewpoint")}set viewpoint(e){if(!this._updatePropertyBeforeReady("viewpoint",e))if(e)if(this.isCompatible(e))this.setStateCamera(this._viewpointToCamera(e),{applyConstraints:!e.camera})||Q.getLogger(this).error("#viewpoint=","Invalid viewpoint",e);else{const r=e.camera!=null?e.camera.position:e.targetGeometry,i=r!=null&&r.spatialReference;Q.getLogger(this).error("#viewpoint=","Viewpoint has an incompatible spatial reference (viewpoint: "+(i?i.wkid:"none")+", view: "+this.view.spatialReference?.wkid+")",e)}else Q.getLogger(this).error("#viewpoint=","Viewpoint may not be null or undefined")}get zoom(){return this.ready?Zrt(this.view,this.scale):this._get("zoom")}set zoom(e){this._updatePropertyBeforeReady("zoom",e)||e===void 0||this.setStateCamera(this._zoomToCamera(e),{applyConstraints:!0})||Q.getLogger(this).error("#zoom=","Invalid zoom",e)}_computeCanvasSize(){if(this._devicePixelRatioOverride)return this.view.state.contentPixelRatio=this._devicePixelRatioOverride,this._tmpCanvasSize.width=Math.round(this.view.surface.clientWidth*this._devicePixelRatioOverride),this._tmpCanvasSize.height=Math.round(this.view.surface.clientHeight*this._devicePixelRatioOverride),this._tmpCanvasSize.pixelRatio=this._devicePixelRatioOverride,this._tmpCanvasSize;const e=Math.min(this._windowDevicePixelRatio,this.view.qualitySettings.maximumPixelRatio),r=this._usePhysicalPixelRendering?this._windowDevicePixelRatio:e;this._tmpCanvasSize.width=Math.round(this.view.surface.clientWidth*r),this._tmpCanvasSize.height=Math.round(this.view.surface.clientHeight*r);const i=this.view._stage.renderView.renderingContext.parameters.maxTextureSize;return _b(this._tmpCanvasSize,i)?this._tmpCanvasSize.pixelRatio=r:this._tmpCanvasSize.pixelRatio=this._tmpCanvasSize.width>0?this._tmpCanvasSize.width/this.view.surface.clientWidth:r,this.view.state&&(this.view.state.contentPixelRatio=Math.min(this._windowDevicePixelRatio,this.view.qualitySettings.maximumPixelRatio)),this._tmpCanvasSize}get _rasterPixelRatio(){return this._devicePixelRatioOverride!=null?this._devicePixelRatioOverride:this._usePhysicalPixelRenderingAny?this._windowDevicePixelRatio:Math.min(this._windowDevicePixelRatio,this.view.qualitySettings.maximumPixelRatio)}get _usePhysicalPixelRendering(){return this.view?._stage?.renderer.isFeatureEnabled(Hs.PhysicalPixelRendering)??!1}get _usePhysicalPixelRenderingAny(){const e=this.view?._stage?.renderer;return e&&(e.isFeatureEnabled(Hs.PhysicalPixelRendering,$r.IDLE)||e.isFeatureEnabled(Hs.PhysicalPixelRendering,$r.INTERACTING)||e.isFeatureEnabled(Hs.PhysicalPixelRendering,$r.ANIMATING))}constructor(e){super(e),this.constraintsManager=null,this.ready=!1,this._windowDevicePixelRatio=1,this._devicePixelRatioOverride=null,this._updatingIgnoreRenderState=!1,this.test={viewStateManager:this,contentCameraResetState:new Map,setDevicePixelRatio:r=>this._devicePixelRatioOverride=r,renderState:null,get maximumPixelRatio(){return this.viewStateManager.view.qualitySettings.maximumPixelRatio},set updatingIgnoreRenderState(r){this.viewStateManager._updatingIgnoreRenderState=r},get updatingIgnoreRenderState(){return this.viewStateManager._updatingIgnoreRenderState||this.renderState!=null}},this._propertiesPool=new kg({frustum:G0},this),this._cameraSetByUser=!1,this._gotoOperation=null,this._cameraChangeTime=0,this._tmpCanvasSize=new pit}initialize(){this._cameraChangeTime=performance.now(),this.addHandles([Ga(()=>this.view.state.events,"before-camera-change",e=>e&&this._updateElevation(e)),le(()=>this.view.state?.camera,(e,r)=>this._cameraChangedHandler(e,r),jr)]),Eh(()=>this.view.state?.camera,e=>this._updateElevation(e),{once:!0,sync:!0}),this.addHandles([JS({prepare:()=>this._prepareFrame()}),le(()=>this.view.state.cameraController,()=>{this._cameraSetByUser=!0,this.removeHandles(dI)}),Ga(()=>this.view.state.events,"camera-projection-changed",()=>this.notifyChange("scale"))])}destroy(){this.exit(),this._propertiesPool=Me(this._propertiesPool)}init(){this.constraintsManager=new XA({view:this.view}),this._prepareFrame();const e=this._getInitialProperties();this._cameraSetByUser=!1,this._set("ready",!0);for(const r of e)this.set(r.name,r.value);if(!this._cameraSetByUser){const r=this.view.get("map.initialViewProperties.viewpoint")||this.view.initialExtent;r&&this.isCompatible(r)?this._setInitialView(r):this.view.state.viewingMode===De.Local&&this.addHandles(Eh(()=>this.view.basemapTerrain.ready,()=>{this.removeHandles(dI),this._setInitialView(this.view.dataExtent)},{once:!0,initial:!0}),dI)}}exit(){this._cancelGoToOperation(),this.ready&&(this._override("padding",this.padding),this._set("ready",!1),this._clearOverride("hasInitialView"),this._cameraSetByUser=!1,this.removeHandles(dI),this.constraintsManager=Me(this.constraintsManager))}async goTo(e,r){const i={animate:!0,...r};return this._gotoOperation!=null&&this._gotoOperation.abort(i.animate),this._gotoOperation=new dit(e,i,this.view),this.view.resourceController.scheduler.stopFrame(),this._gotoOperation}debugSetCameraOnContent(){this.setStateCamera(kw(this.view),{applyConstraints:!1})}step(e){const r=this.view.state,i=r?.cameraController;i&&(r.updateCamera(s=>i.stepController(e,s)),i.steppingFinished&&i.finishController())}_cancelGoToOperation(){this._gotoOperation!=null&&(this._gotoOperation.abort(),this._gotoOperation=null)}_getInitialProperties(){const e=new Set,r=[];for(const{propertyName:i,overrides:s}of mit){const n=e.has(i),o=this._isOverridden(i);!n&&o&&r.push({name:i,value:this._get(i)}),this._clearOverride(i),(n||o)&&s.forEach(a=>e.add(a))}return r}_setInitialView(e){if(e==null||this._cameraSetByUser)return;if(e instanceof Ih)return void this.setStateCamera(rg(this.view,e),{applyConstraints:!1});if(e instanceof lp){if(e.targetGeometry instanceof _r){const n=G3(this.view,e.targetGeometry,0,.5,Go.LOCKED);return void(n!=null&&this.setStateCamera(rg(this.view,n),{applyConstraints:!0}))}const i={applyConstraints:!e.camera},s=this._viewpointToCamera(e);return void this.setStateCamera(s,i)}const r=G3(this.view,e,0,.5,Go.LOCKED);r!=null&&this.setStateCamera(rg(this.view,r),{applyConstraints:!0})}_updatePropertyBeforeReady(e,r){return!this.ready&&(this._override(e,r),r&&fit.includes(e)&&this._override("hasInitialView",!0),!0)}isCompatible(e){return e!=null&&(e instanceof lp?e.camera?this.isCompatible(e.camera):this.isCompatible(e.targetGeometry):e instanceof Ih?this.isCompatible(e.position):e.spatialReference&&p_(e.spatialReference,this.view.spatialReference))}_getPreservingHeadingTilt(e=git){return this._cameraSetByUser?(e.heading=this.camera.heading,e.tilt=this.camera.tilt):(e.heading=0,e.tilt=.5),e}_centerPointAtDistanceToCamera(e,r,i=My){const{heading:s,tilt:n}=this._getPreservingHeadingTilt(),o=eR(this.view,s,n,e,r,Go.ADJUST);return o==null?null:(i.copyFrom(this.view.state.camera),i.eye=o.eye,i.center=o.center,i.up=o.up,i)}_centerToCamera(e){const r=this.view.pointsOfInterest.centerOnContent;r.runTask();const i=r.distance;return this._centerPointAtDistanceToCamera(e,i)}_extentToCamera(e){const{heading:r,tilt:i}=this._getPreservingHeadingTilt(),s=G3(this.view,e,r,i,Go.ADJUST,k8);return s?rg(this.view,s):null}_scaleToCamera(e){if(e==null)return null;const r=this.view.pointsOfInterest.centerOnContent;r.runTask();const i=r.renderLocation,s=r.location.latitude;if(s==null)return null;const n=mY(this.view,e,s);return this._centerPointAtDistanceToCamera(i,n)}_zoomToCamera(e){return this._scaleToCamera(UTe(this.view,e))}_viewpointToCamera(e){return rg(this.view,zTe(this.view,e))}setStateCamera(e,r){return!(e==null||!this.view.state.stopActiveCameraController())&&(this._cameraSetByUser=!0,r.doNotCancelGoToOperation||this._cancelGoToOperation(),this.view.state.updateCamera(i=>{r.positionAndOrientationOnly?(i.eye=e.eye,i.center=e.center,i.up=e.up):i.copyFrom(e),r.applyConstraints&&Rs(this.view,i)}),r.applyConstraints||(this.view.state.cameraController=new B3({view:this.view,desiredCamera:e})),!0)}_prepareFrame(){const{surface:e,canvas:r}=this.view;if(!e||!r)return;this._windowDevicePixelRatio=window.devicePixelRatio;const i=this._computeCanvasSize();if(i.width!==0&&i.height!==0&&(r.width===i.width&&r.height===i.height||(r.width=i.width,r.height=i.height),this.view.state)){const s=this.view.state.camera;s.fullWidth===i.width&&s.fullHeight===i.height&&s.pixelRatio===i.pixelRatio||(My.copyFrom(s),My.pixelRatio!==i.pixelRatio&&(this._paddingToArray(this.padding,i.pixelRatio,hI),My.padding=hI),My.fullWidth=i.width,My.fullHeight=i.height,My.pixelRatio=i.pixelRatio,this.view.state.camera=My),this._updateViewState()}}_updateElevation(e){const r=this.view.basemapTerrain&&this.view.basemapTerrain.spatialReference,i=this.view.renderCoordsHelper?.getAltitude(e.eye)??0,s=r?Q5(this.view,e.eye):0;e.relativeElevation=i-s}_updateViewState(){this.test.renderState!=null?this.view.state.mode=this.test.renderState:this.view.animation?this.view.state.mode=$r.ANIMATING:this.view.interacting?this.view.state.mode=$r.INTERACTING:(this.view.state.mode===$r.ANIMATING&&(this._cameraChangeTime=0),performance.now()-this._cameraChangeTime<=yit?this.view.state.mode=$r.INTERACTING:this.view.state.mode=$r.IDLE),this.view.state.rasterPixelRatio=this._rasterPixelRatio}_cameraChangedHandler(e,r){e&&r&&e.almostEquals(r)||(this._cameraChangeTime=performance.now(),this._updateViewState())}};u([d({type:Ih,dependsOn:["view.state.camera","ready"]})],vn.prototype,"camera",null),u([d({type:Ih,dependsOn:["view.state.contentCamera","ready"]})],vn.prototype,"contentCamera",null),u([d({type:pt})],vn.prototype,"center",null),u([d({type:_r})],vn.prototype,"extent",null),u([d({readOnly:!0})],vn.prototype,"frustum",null),u([d({readOnly:!0})],vn.prototype,"hasInitialView",null),u([d({readOnly:!0,type:Boolean})],vn.prototype,"ready",void 0),u([d({type:Number})],vn.prototype,"scale",null),u([d()],vn.prototype,"padding",null),u([d({readOnly:!0})],vn.prototype,"screenCenter",null),u([d({constructOnly:!0})],vn.prototype,"view",void 0),u([d({type:lp})],vn.prototype,"viewpoint",null),u([d({type:Number})],vn.prototype,"zoom",null),u([d({readOnly:!0})],vn.prototype,"_rasterPixelRatio",null),u([d({readOnly:!0})],vn.prototype,"_usePhysicalPixelRendering",null),u([d({readOnly:!0})],vn.prototype,"_usePhysicalPixelRenderingAny",null),u([d()],vn.prototype,"_windowDevicePixelRatio",void 0),u([d()],vn.prototype,"_devicePixelRatioOverride",void 0),vn=u([R("esri.views.3d.state.ViewStateManager")],vn);let pit=class{constructor(){this.width=0,this.height=0,this.pixelRatio=1}};const fit=["camera","viewpoint","extent","scale","center","zoom"],mit=[{propertyName:"camera",overrides:["viewpoint"]},{propertyName:"viewpoint",overrides:["extent"]},{propertyName:"extent",overrides:["center","scale"]},{propertyName:"center",overrides:[]},{propertyName:"scale",overrides:["zoom"]},{propertyName:"zoom",overrides:[]},{propertyName:"padding",overrides:[]}],git={heading:0,tilt:0},k8=new Ih,My=new ut,hI=Wt(),dI="pending-initial-view",V8="content-camera-reset",yit=300,Gse=100;let xf=class extends og{constructor(){super(...arguments),this.startCamera=new ut,this.currentCamera=new ut,this._lastInteraction=0}get isInteractive(){return performance.now()-this._lastInteraction<Gse}stepController(e,r){r.copyViewFrom(this.currentCamera),this.currentCamera.copyFrom(r)}onControllerStart(e){this.state=qi.Running,this.startCamera.copyFrom(e),this.currentCamera.copyFrom(e)}onControllerEnd(e){e.copyViewFrom(this.currentCamera)}commitCamera(){this._lastInteraction=performance.now(),setTimeout(()=>this.notifyChange("isInteractive"),Gse),this.view.state.updateCamera(e=>this.stepController(0,e)),this.steppingFinished&&this.finishController()}};u([d({readOnly:!0})],xf.prototype,"isInteractive",null),u([d()],xf.prototype,"_lastInteraction",void 0),xf=u([R("esri.views.3d.state.controllers.InteractiveController")],xf);var tc;(function(t){t[t.CENTER=0]="CENTER",t[t.EYE=1]="EYE"})(tc||(tc={}));let j3=class extends xf{get _intersectionHelper(){return this.view.sceneIntersectionHelper}constructor(e){super(e),this.pivot=tc.CENTER,this._rotScale=0,this._lastPoint=Ve(),this._tmpWorldUp=C(),this._tmpViewDir=C(),this._tmpRotCurPoint=Ve(),this._tmpTransf=be(),this._tmpAxis=C(),this._tmpPivotPoint=C(),this._pivotPos=C(),this._constraintOptions={selection:Ai.ALL,interactionType:Zt.TUMBLE,interactionFactor:0,interactionStartCamera:null,interactionDirection:null,tiltMode:Jn.TUMBLE}}initialize(){this._rotScale=this.pivot===tc.CENTER?3:1.5}begin(e){if(this.active){switch(this.pivot){case tc.EYE:ie(this._pivotPos,this.startCamera.eye),this._constraintOptions.interactionType=Zt.LOOK_AROUND,this._constraintOptions.tiltMode=Jn.LOOK_AROUND,this._constraintOptions.selection=Ai.NONE;break;case tc.CENTER:{const r=this._intersectionHelper.intersectRayFreePointFallback(this.startCamera.ray,this._pivotPos,this.view.map.ground.opacity===0?Vw:{});r||ie(this._pivotPos,this.startCamera.center),this._constrainPivotPoint(e,r),this.startCamera.center=this._pivotPos,this._constraintOptions.interactionType=Zt.TUMBLE,this._constraintOptions.tiltMode=Jn.TUMBLE,this._constraintOptions.selection=Ai.ALL&~Ai.DISTANCE;break}}this._constraintOptions.interactionStartCamera=this.startCamera,Mb(this.startCamera,e,this._lastPoint)}}_constrainPivotPoint(e,r){const i=this.startCamera,s=C();he(s,this._pivotPos,i.eye);const n=Ce(s),o=Math.abs(this.view.camera.position.z);this.view.renderCoordsHelper.worldUpAtPosition(i.eye,jse);let a=Math.max(Math.min(Qtt,1/Math.abs(fe(jse,i.viewForward)))*o,Ktt);r&&(a=Math.min(n,a));const l=Nr(this.view.spatialReference),c=Zi(i.width/i.pixelRatio*.5,i.height/i.pixelRatio*.5),h=r6(this.startCamera,c,l);let p=this.view._stage.renderView.getMinimalDepthForArea(this.view.voxelWasm,i.fullWidth/i.pixelRatio*.5,i.fullHeight/i.pixelRatio*.5,i,2.5*M8,M8),f=this.view._stage.renderView.getMinimalDepthForArea(this.view.voxelWasm,e[0],e[1],i,M8);p==null&&f==null||(p=p??f??0,f=f==null||h===Yn.Horizontal?p:f,a=p>f?f:p,a=r?Math.min(a,n):a),me(s,s),ie(this._pivotPos,ce(this._tmpPivotPoint,i.eye,te(this._tmpPivotPoint,s,a)))}update(e){if(this.active){switch(this.pivot){case tc.EYE:this.currentCamera.center=this._applyRotation(this.currentCamera,e,this.currentCamera.center,this._pivotPos);break;case tc.CENTER:this.currentCamera.center=this._pivotPos,this.currentCamera.eye=this._applyRotation(this.currentCamera,e,this.currentCamera.eye,this._pivotPos)}Rs(this.view,this.currentCamera,this._constraintOptions),this.commitCamera()}}end(){this.active&&this.finishController()}_applyRotation(e,r,i,s){this.view.renderCoordsHelper.worldUpAtPosition(s,this._tmpWorldUp),Mb(e,r,this._tmpRotCurPoint);let n=(this._lastPoint[1]-this._tmpRotCurPoint[1])*this._rotScale,o=(this._tmpRotCurPoint[0]-this._lastPoint[0])*this._rotScale;he(this._tmpViewDir,i,s);const a=Ce(this._tmpViewDir),l=Pn(fe(this._tmpViewDir,this._tmpWorldUp)/a);if(this.pivot===tc.EYE){n*=-.5;const c=.5*Math.PI-l,h=.5*Math.PI*.99;n=c-Math.max(-h,Math.min(h,c+n))}return n=ge(n+l,$o.min,$o.max)-l,at(this._tmpAxis,e.up,this._tmpViewDir),this.pivot===tc.CENTER&&(o=-o),mu(this._tmpTransf,o,this._tmpWorldUp),dc(this._tmpTransf,this._tmpTransf,n,this._tmpAxis),$e(this._tmpViewDir,this._tmpViewDir,this._tmpTransf),e.up=$e(z8,e.up,this._tmpTransf),ce(z8,s,this._tmpViewDir),fn(this._lastPoint,this._tmpRotCurPoint),z8}};u([d()],j3.prototype,"pivot",void 0),j3=u([R("esri.views.3d.state.controllers.RotateController")],j3);const z8=C(),jse=C();let B8=class extends To{constructor(e,r,i,s){super(!0),this._view=e,this.pointerAction=r,this._pivot=i,this.registerIncoming("drag",s,n=>this._handleDrag(n))}_handleDrag(e){const r=e.data;if(r.pointers.size>1||!dY(e.data,this.pointerAction))return;const i=Zi(r.center.x,r.center.y);switch(r.action){case"start":this._cameraController&&(this._cameraController.end(),this._cameraController=null),this._cameraController=new j3({view:this._view,pivot:this._pivot}),this._view.state.switchCameraController(this._cameraController),this._cameraController.begin(i);break;case"update":this._cameraController&&this._cameraController.update(i);break;case"end":this._cameraController&&(this._cameraController.end(),this._cameraController=null)}e.stopPropagation()}},Yj=class extends xf{constructor(){super(...arguments),this._pickPoint=C(),this._tmpP0=Ve(),this._panAxisAngle=e6(),this._tmpRayDir=C(),this._tmpRayDirPick=C(),this._targetOnSphere=C(),this._navMode=Yn.Horizontal,this._tmpRay={origin:C(),direction:C()},this.dragBeginPoint=Zi(),this._normalizedAnchorPoint=Ve(),this._constraintOptions={selection:Ai.ALL_EXCEPT_COLLISION,interactionType:Zt.ZOOM,interactionFactor:0,interactionStartCamera:null,interactionDirection:null,tiltMode:Jn.TUMBLE},this._sphere=gs(),this._hasPickPoint=!1}get _intersectionHelper(){return this.view.sceneIntersectionHelper}begin(e){if(!this.active)return;fn(this.dragBeginPoint,e),Mb(this.startCamera,e,this._normalizedAnchorPoint);const r=Nr(this.view.spatialReference),i=dTe(this._intersectionHelper,this.startCamera,e,r,R2.Ellipsoid,this.view.map.ground.opacity===0?Vw:{});if(this._navMode=r6(this.startCamera,e,r),this._navMode===Yn.Horizontal)this._hasPickPoint=!!i.scenePickPoint,this._pickPoint=i.scenePickPoint??this._pickPoint,this._sphere=i.sphere;else{let s;vE(this.startCamera,e,this._tmpRay),me(this._tmpRay.direction,this._tmpRay.direction),i.scenePickPoint!=null&&(he(this._tmpRayDirPick,this.startCamera.eye,i.scenePickPoint),s=Ce(this._tmpRayDirPick));const n=Math.abs(this.view.camera.position.z);this.view.renderCoordsHelper.worldUpAtPosition(this.startCamera.eye,Hse);let o=ge(Math.min(sTe,1/Math.abs(fe(Hse,this._tmpRay.direction)))*n,f4[0],f4[1]);const a=this.view._stage.renderView.getMinimalDepthForArea(null,e[0],e[1],this.view.state.camera,t6);o=a??o,o=s!=null?Math.min(o,s):o,this._hasPickPoint=!0,te(this._tmpRay.direction,this._tmpRay.direction,o),ce(this._pickPoint,this._tmpRay.origin,this._tmpRay.direction)}this._constraintOptions.interactionStartCamera=this.startCamera}update(e){if(this.active){if(this.currentCamera.eye=this.startCamera.eye,this.currentCamera.center=this.startCamera.center,this.currentCamera.up=this.startCamera.up,this._navMode===Yn.Horizontal){he(this._tmpRayDir,this.currentCamera.center,this.currentCamera.eye);const r=Ce(this._tmpRayDir);Mb(this.currentCamera,e,this._tmpP0);const i=12*(this._normalizedAnchorPoint[1]-this._tmpP0[1]);let s=r*2**i;const n=this.view.state.constraints.minimumPoiDistance;if(i<0&&s<n&&(s=n),Math.abs(r-s)<1e-6)return;if(this._hasPickPoint&&s<r){const o=1-(1-s/r)*(1-this._sphere[3]/Ce(this.currentCamera.center));this.currentCamera.center=te(pI,this.currentCamera.center,o)}te(this._tmpRayDir,this._tmpRayDir,-s/r),this.currentCamera.eye=ce(pI,this.currentCamera.center,this._tmpRayDir),this._constraintOptions.interactionFactor=kd(sw(this.dragBeginPoint,e)),Rs(this.view,this.currentCamera,this._constraintOptions),this._hasPickPoint&&(KO(this._sphere,this.currentCamera,this.dragBeginPoint,this._targetOnSphere),oY(this._pickPoint,this._targetOnSphere,this._panAxisAngle),z_(this.currentCamera,this._sphere,this._panAxisAngle))}else{const r=Ce(this._tmpRay.direction);Mb(this.currentCamera,e,this._tmpP0);const i=12*(this._normalizedAnchorPoint[1]-this._tmpP0[1]);let s=r*2**i;const n=this.view.state.constraints.minimumPoiDistance;if(i<0&&s<n&&(s=n),Math.abs(r-s)<1e-6)return;te(this._tmpRayDir,this._tmpRay.direction,1-s/r),this.currentCamera.eye=ce(pI,this.currentCamera.eye,this._tmpRayDir),this.currentCamera.center=ce(pI,this.currentCamera.center,this._tmpRayDir)}_E(this.view,this.currentCamera),this.commitCamera()}}end(){this.active&&this.finishController()}};Yj=u([R("esri.views.3d.state.controllers.global.ZoomController")],Yj);const pI=C(),Hse=C();let Jj=class extends xf{constructor(){super(...arguments),this._tmpP=C(),this._tmpDir=C(),this._tmpN=C(),this._tmpP0=Ve(),this._tmpPoi=C(),this._tmpRayDir=C(),this.dragBeginPoint=Zi(),this._normalizedAnchorPoint=Ve(),this._constraintOptions={selection:Ai.ALL,interactionType:Zt.ZOOM,interactionFactor:0,interactionStartCamera:null,interactionDirection:C(),tiltMode:Jn.TUMBLE},this._plane=Ir()}get _intersectionHelper(){return this.view.sceneIntersectionHelper}begin(e){if(!this.active)return;fn(this.dragBeginPoint,e),Mb(this.startCamera,e,this._normalizedAnchorPoint);const r=this._intersectionHelper.intersectScreenFreePointFallback(e,this._tmpP,this.view.map.ground.opacity===0?Vw:{});he(this._tmpDir,this._tmpP,this.startCamera.eye);const i=Ce(this._tmpDir);me(this._tmpDir,this._tmpDir);const s=Math.abs(this.view.camera.position.z);let n=ge(Math.min(sTe,1/Math.abs(fe(_it,this._tmpDir)))*s,f4[0],f4[1]);const o=this.view._stage.renderView.getMinimalDepthForArea(this.view.voxelWasm,e[0],e[1],this.view.state.camera,t6);n=o??n,n=r?Math.min(n,i):n,te(this._tmpDir,this._tmpDir,n),ce(this._tmpP,this.startCamera.eye,this._tmpDir),he(this._tmpN,this.startCamera.eye,this.startCamera.center),me(this._tmpN,this._tmpN),this._tmpN[1]<0&&ca(this._tmpN,this._tmpN),ZR(this._tmpP,this._tmpN,this._plane),this._constraintOptions.interactionStartCamera=this.startCamera}update(e){if(!this.active)return;ert(this._plane,this.currentCamera,this.dragBeginPoint,this._tmpPoi)||ie(this._tmpPoi,this.currentCamera.center),Mb(this.currentCamera,e,this._tmpP0);let r=4*(this._tmpP0[1]-this._normalizedAnchorPoint[1]);fn(this._normalizedAnchorPoint,this._tmpP0),he(this._tmpRayDir,this._tmpPoi,this.currentCamera.eye);const i=Ce(this._tmpRayDir);let s=i*(1-r);this._constraintOptions.interactionDirection&&(ie(this._constraintOptions.interactionDirection,this._tmpRayDir),te(this._constraintOptions.interactionDirection,this._constraintOptions.interactionDirection,Math.sign(r)/i));const n=this.view.state.constraints.minimumPoiDistance;r>=0&&s<n&&(s=n,r=-(s-i)/i),Math.abs(i-s)<1e-6||(te(this._tmpRayDir,this._tmpRayDir,r),this.currentCamera.eye=ce(Sv,this.currentCamera.eye,this._tmpRayDir),Br(Sv,this.currentCamera.center,this._tmpPoi,r),this._tmpPoi[2]>this.startCamera.center[2]?Sv[2]=Math.max(this.startCamera.center[2],Sv[2]):Sv[2]=Math.min(this.startCamera.center[2],Sv[2]),this.currentCamera.center=Sv,this._constraintOptions.interactionFactor=kd(sw(this.dragBeginPoint,e)),Rs(this.view,this.currentCamera,this._constraintOptions),this.commitCamera())}end(){this.active&&this.finishController()}};Jj=u([R("esri.views.3d.state.controllers.local.ZoomController")],Jj);const Sv=C(),_it=Oe(0,0,1);let vit=class extends To{constructor(e,r,i){super(!0),this._view=e,this.pointerAction=r,this.registerIncoming("drag",i,s=>this._handleDrag(s))}_handleDrag(e){const r=e.data;if(r.pointers.size>1||!dY(e.data,this.pointerAction))return;const i=Zi(r.center.x,r.center.y);switch(r.action){case"start":this._cameraController&&(this._cameraController.end(),this._cameraController=null),this._view.state.isGlobal?this._cameraController=new Yj({view:this._view}):this._cameraController=new Jj({view:this._view}),this._view.state.switchCameraController(this._cameraController),this._cameraController.begin(i);break;case"update":this._cameraController&&this._cameraController.update(i);break;case"end":this._cameraController&&(this._cameraController.end(),this._cameraController=null)}e.stopPropagation()}};function Yh(t){let e=t*t;return t<0&&(e*=-1),e}function qse(t,e,r){const i=r,s=t.state,n=t.device,o=e.tiltDirection==="forward-down"?1:-1,a=1;return n.deviceType==="standard"?(i.translation[0]=Yh(s.axes[0]),i.translation[1]=Yh(s.axes[1]),i.translation[2]=Yh(s.buttons[7])-Yh(s.buttons[6]),i.heading=Yh(s.axes[2]),i.tilt=Yh(s.axes[3])):n.deviceType==="spacemouse"&&(i.translation[0]=1.2*Yh(s.axes[0]),i.translation[1]=1.2*Yh(s.axes[1]),i.translation[2]=2*-Yh(s.axes[2]),i.heading=1.2*Yh(s.axes[5]),i.tilt=1.2*Yh(s.axes[3])),i.tilt*=o,te(i.translation,i.translation,a),i}function Wse(t,e){const r=e;return r.translation[0]=t[1]-t[0],r.translation[1]=t[3]-t[2],r.translation[2]=t[4]-t[5],r.heading=t[7]-t[6],r.tilt=t[8]-t[9],r.zoom=t[10]-t[11],r}function G8(t){return t.translation[0]===0&&t.translation[1]===0&&t.translation[2]===0&&t.heading===0&&t.tilt===0&&t.zoom===0}let vb=class extends xf{constructor(e){super(e),this._filteredSurfaceElevation=0,this._transformation={translation:[0,0,0],heading:0,tilt:0,zoom:0},this._keysButtonState=[0,0,0,0,0,0,0,0,0,0,0,0],this._tmpCamera=new ut,this._headingStart=0,this._constraintOptions={selection:Ai.ALL,interactionType:Zt.NONE,interactionStartCamera:new ut,interactionFactor:0,interactionDirection:null,tiltMode:Jn.LOOK_AROUND}}handleEventGamepad(e){const r=qse(e,this.view.navigation.gamepad,this._transformation);(e.action==="end"||G8(r))&&this.finishController()}activateDirection(e){this._keysButtonState[e]=1,Wse(this._keysButtonState,this._transformation)}deactivateDirection(e){this._keysButtonState[e]=0;const r=Wse(this._keysButtonState,this._transformation);G8(r)&&this.finishController()}onControllerStart(e){this._filteredSurfaceElevation=this.view.pointsOfInterest.cameraOnSurface.location.z,this._headingStart=this.view.camera.heading,super.onControllerStart(e)}_updateFilteredSurfaceElevation(e){const r=this.view.pointsOfInterest.cameraOnSurface.location.z,i=1;this._filteredSurfaceElevation+=i*(r-this._filteredSurfaceElevation)*e}stepController(e,r){this._updateStartHeading(),this._updateFilteredSurfaceElevation(e),this.currentCamera.copyViewFrom(r),this._updateCameraCenter(),this._constraintOptions.interactionStartCamera?.copyFrom(this.currentCamera),this._calculateControlTransformation(e,this.currentCamera,Ev),this._applyDisabledMovementTypes(Ev),this._applyPan(Ev.pan),this._applyRotate(Ev.rotate),this._applyZoom(Ev.zoom),this._applyAscend(Ev.ascend),this._constraintOptions.interactionType=Zt.NONE,this._constraintOptions.selection=Ai.COLLISION,Rs(this.view,this.currentCamera,this._constraintOptions),super.stepController(e,r)}_updateStartHeading(){this._transformation.heading!==0&&(this._headingStart=this.view.camera.heading)}_applyRotate(e){if(!e.enabled)return;const r=this.currentCamera;he(Ka,r.center,r.eye),$e(Ka,Ka,e.matrix),r.center=ce(Ka,Ka,r.eye),r.up=$e(Ka,r.up,e.matrix),this._constraintOptions.interactionType=Zt.LOOK_AROUND,this._constraintOptions.selection=Ai.ALL_EXCEPT_COLLISION,Rs(this.view,r,this._constraintOptions)}_applyPan(e,r=this.currentCamera){e.enabled&&(r.eye=$e(Ka,r.eye,e.matrix),r.center=$e(Ka,r.center,e.matrix),this.view.state.isGlobal&&(r.up=$e(Ka,r.up,e.matrix)),this._constraintOptions.interactionType=Zt.PAN,this._constraintOptions.selection=Ai.ALL,Rs(this.view,r,this._constraintOptions))}_applyZoom(e){if(!e)return;const r=this.currentCamera.viewForward;this.currentCamera.eye=ce(Ka,this.currentCamera.eye,te(Le.get(),r,e)),ie(oC,r),ca(oC,oC),this._constraintOptions.interactionDirection=oC,this._constraintOptions.interactionType=Zt.ZOOM,this._constraintOptions.selection=Ai.ALL_EXCEPT_COLLISION,Rs(this.view,this.currentCamera,this._constraintOptions),this._constraintOptions.interactionDirection=null}_applyAscend(e){if(!e)return;const r=this.view.renderCoordsHelper.worldUpAtPosition(this.currentCamera.eye,Le.get());if(this._constraintOptions.interactionDirection=ie(oC,r),this.view.state.isGlobal){const i=Ce(this.currentCamera.eye),s=(i+e)/i;this.currentCamera.eye=te(Ka,this.currentCamera.eye,s),this.currentCamera.center=te(Ka,this.currentCamera.center,s)}else{const i=te(Le.get(),r,e);this.currentCamera.eye=ce(Ka,this.currentCamera.eye,i),this.currentCamera.center=ce(Ka,this.currentCamera.center,i)}this._updateCameraCenter(),this._constraintOptions.interactionType=Zt.ASCEND,this._constraintOptions.selection=Ai.COLLISION,Rs(this.view,this.currentCamera,this._constraintOptions)&&this._updateCameraCenter(),this._constraintOptions.selection=Ai.ALL_EXCEPT_COLLISION,Rs(this.view,this.currentCamera,this._constraintOptions),this._constraintOptions.interactionDirection=null}_calculateControlTransformation(e,r,i){Cit(i);const s=this._computeVelocities(e);this.view.state.isLocal?this._calculateControlTransformationLocal(s,r,i):this._calculateControlTransformationGlobal(s,r,i)}_updateCameraCenter(){const e=this.view.pointsOfInterest.centerOnSurfaceFrequent.estimatedSurfaceAltitude,r=this.view.renderCoordsHelper,i=this.currentCamera.ray;this.currentCamera.center=r.intersectManifoldClosestSilhouette(i,e,Ka)}_calculateControlTransformationLocal(e,r,i){const{viewRight:s,viewForward:n}=r,o=this._transformation,a=this.view.navigation.gamepad,l=se(Le.get(),n[0],n[1],0);me(l,l);const c=o.translation[0]*e.pan;if(c!==0){const _=te(Le.get(),s,c);Al(i.pan.matrix,i.pan.matrix,_),i.pan.enabled=!0}switch(a.mode){case"pan":{const _=-o.translation[1]*e.pan;if(_!==0){const v=te(Le.get(),l,_);Al(i.pan.matrix,i.pan.matrix,v),i.pan.enabled=!0}i.zoom=o.zoom*e.zoom;break}case"zoom":i.zoom=(-o.translation[1]+o.zoom)*e.zoom;break;default:a.mode}const h=o.translation[2]*e.ascend;i.ascend=h;const p=-o.heading*e.rotate;p!==0&&(dc(i.rotate.matrix,i.rotate.matrix,p,this.view.renderCoordsHelper.worldUpAtPosition(r.eye,Le.get())),i.rotate.enabled=!0);const f=o.tilt*e.rotate,m=V_(this.view.renderCoordsHelper,r.center,r.eye),y=ge(m+f,$o.min,$o.max)-m;y&&(dc(i.rotate.matrix,i.rotate.matrix,y,s),i.rotate.enabled=!0)}_calculateControlTransformationGlobal(e,r,i){const{eye:s,viewRight:n}=r,o=this._transformation,a=this.view.navigation.gamepad,l=at(Le.get(),n,s);me(l,l),ca(l,l),ort(this.startCamera,r,o,e,this.view.camera.heading,this._headingStart,this.view.camera.tilt,i,a),this._tmpCamera.copyFrom(this.currentCamera),this._applyPan(Ev.pan,this._tmpCamera);const c=this.view.pointsOfInterest.centerOnSurfaceFrequent.estimatedSurfaceAltitude,h=o.translation[2]*e.ascend;i.ascend=h;const p=-o.heading*e.rotate;p!==0&&(dc(i.rotate.matrix,i.rotate.matrix,p,this._tmpCamera.eye),i.rotate.enabled=!0);const f=o.tilt*e.rotate,m=this._clampTiltDeltaGlobalToValidRange(f,r.ray,c);m!==0&&(dc(i.rotate.matrix,i.rotate.matrix,m,this._tmpCamera.viewRight),i.rotate.enabled=!0),i.zoom+=o.zoom*e.zoom}_clampTiltDeltaGlobalToValidRange(e,r,i){const s=Nr(this.view.spatialReference),n=rD($o.min,r.origin,i,s);let o=0,a=0;const l=Le.get();if(this.view.renderCoordsHelper.intersectManifold(r,i,l)){const c=V_(this.view.renderCoordsHelper,l,r.origin);o=rD(c,r.origin,i,s),a=rD($o.max,r.origin,i,s)}else{pE(O5(R5,i+s.radius),r,l);const c=Math.PI+A5(r.direction,l);o=Rse(c,r.origin,i,s),a=Rse($o.max,r.origin,i,s)}return ge(o+e,n,a)-o}_getPointAbsoluteSurfaceElevation(e,r,i){const{renderCoordsHelper:s}=this.view,n=s.getAltitude(e),o=r+Math.abs(n-r);return s.setAltitude(i,o,e),o}_clampedDistanceToSurface(e,r){const{renderCoordsHelper:i}=this.view,{camera:s}=this.view.state,{direction:n}=Urt(this.view,r,0,jTe,Eit),o=i.intersectManifoldClosestSilhouette(yu(r,n),e,Le.get()),a=di(r,o),l=i.intersectManifoldClosestSilhouette(yu(r,Hg(Le.get(),r,s.center)),e,Le.get()),c=di(r,l);return Math.min(a,c)}_computeHeadingRotateRadius(e){const{renderCoordsHelper:r,state:i}=this.view,{camera:s,isGlobal:n}=i,o=r.intersectManifoldClosestSilhouette(s.ray,this._filteredSurfaceElevation,Le.get());if(n){const a=he(Le.get(),e,o),l=Ce(a);te(a,a,1/l);const c=me(Le.get(),e),h=Pn(fe(c,a));return l*Math.sin(Math.min(wit,h))}{const a=ie(Le.get(),e);return r.setAltitude(a,this._filteredSurfaceElevation),di(o,a)}}_minimumAscendVelocity(){return this.view.state.constraints.collision.enabled?0:xit}_computeVelocities(e){const r=this._filteredSurfaceElevation,i=r+Nr(this.view.spatialReference).radius,{camera:s,isGlobal:n}=this.view.state,o=Le.get(),a=this._getPointAbsoluteSurfaceElevation(s.eye,r,o),l=this._clampedDistanceToSurface(r,o),c=s.width/2,h=Zse*s.width,p=Zse*s.width,f=l*Math.tan(.5*s.fovX)/c,m=f/i,y=f/this._computeHeadingRotateRadius(o),_=a-r;return{pan:(n?m:f)*h*e,ascend:Math.max(this._minimumAscendVelocity()*e,2**(h*e/c)*_-_),zoom:2**(h*e/c)*l-l,rotate:ge(y*p,Tit,Sit)*e}}_applyDisabledMovementTypes(e){this.disableMovements==null||this.disableMovements.mode!==void 0&&this.view.state.viewingMode!==this.disableMovements.mode||(e.zoom=this.disableMovements.zoom?0:e.zoom,e.ascend=this.disableMovements.ascend?0:e.ascend,e.pan.enabled=!this.disableMovements.pan,this.disableMovements.pan&&Rh(e.pan.matrix),e.rotate.enabled=!this.disableMovements.rotate,this.disableMovements.rotate&&Rh(e.rotate.matrix))}static activatesFor(e,r){const i=qse(r,e.navigation.gamepad,bit);return!(r.action==="end"||G8(i))}};u([d({constructOnly:!0})],vb.prototype,"gamepadDevice",void 0),u([d({constructOnly:!0})],vb.prototype,"disableMovements",void 0),vb=u([R("esri.views.3d.state.controllers.GamepadKeyboardController")],vb);const bit={translation:[0,0,0],heading:0,tilt:0,zoom:0},jTe=80,wit=Dt(jTe),Zse=.75,xit=5,Tit=Dt(30),Sit=Dt(80),Ev={zoom:0,ascend:0,pan:{enabled:!1,matrix:be()},rotate:{enabled:!1,matrix:be()}},Ka=C(),oC=C(),Eit=pY();function Cit(t){t.zoom=0,t.ascend=0,t.pan.enabled=!1,Rh(t.pan.matrix),t.rotate.enabled=!1,Rh(t.rotate.matrix)}let Ait=class extends To{constructor(e){super(!0),this._view=e,this._watchHandles=new Oi,this._handle=this.registerIncoming("gamepad",r=>this._handleEventGamepad(r)),this._handle.pause()}onInstall(e){super.onInstall(e),this._watchHandles.add([le(()=>this._view.navigation.gamepad.enabled,r=>{r?this._handle.resume():(this._handle.pause(),this._cameraControllerGamepad&&(this._cameraControllerGamepad.finishController(),this._cameraControllerGamepad=null))},Vr),le(()=>this._view.navigation.gamepad.device,r=>{this._cameraControllerGamepad&&r&&this._cameraControllerGamepad.gamepadDevice!==r&&(this._cameraControllerGamepad.finishController(),this._cameraControllerGamepad=null)})])}onUninstall(){this._watchHandles.removeAll(),super.onUninstall()}_handleEventGamepad(e){const r=this._view.navigation.gamepad.device;if(r&&e.data.device!==r)return;const i=this._cameraControllerGamepad&&this._cameraControllerGamepad.active;if(i||vb.activatesFor(this._view,e.data)){if(!i){const s=new vb({view:this._view,gamepadDevice:e.data.device});this._view.state.switchCameraController(s)&&(this._cameraControllerGamepad=s)}this._cameraControllerGamepad&&this._cameraControllerGamepad.active&&this._cameraControllerGamepad.gamepadDevice===e.data.device&&this._cameraControllerGamepad.handleEventGamepad(e.data)}}};var Wl;(function(t){t[t.LEFT=0]="LEFT",t[t.RIGHT=1]="RIGHT",t[t.FORWARD=2]="FORWARD",t[t.BACKWARD=3]="BACKWARD",t[t.UP=4]="UP",t[t.DOWN=5]="DOWN",t[t.HEADINGLEFT=6]="HEADINGLEFT",t[t.HEADINGRIGHT=7]="HEADINGRIGHT",t[t.TILTUP=8]="TILTUP",t[t.TILTDOWN=9]="TILTDOWN",t[t.ZOOMIN=10]="ZOOMIN",t[t.ZOOMOUT=11]="ZOOMOUT"})(Wl||(Wl={}));let Oit=class extends To{constructor(e,r){super(!0),this._view=e,this._disableMovements={pan:!0,zoom:!1,ascend:!0,rotate:!1,mode:De.Local},this._keyToNumber={[r.left]:Wl.LEFT,[r.right]:Wl.RIGHT,[r.forward]:Wl.FORWARD,[r.backward]:Wl.BACKWARD,[r.up]:Wl.UP,[r.down]:Wl.DOWN,[r.headingLeft]:Wl.HEADINGLEFT,[r.headingRight]:Wl.HEADINGRIGHT,[r.tiltUp]:Wl.TILTUP,[r.tiltDown]:Wl.TILTDOWN,[r.zoomIn]:Wl.ZOOMIN,[r.zoomOut]:Wl.ZOOMOUT},this.registerIncoming("key-down",null,i=>this._handleKeyDown(i)),this.registerIncoming("key-up",null,i=>this._handleKeyUp(i)),this.registerIncoming("blur",null,()=>this._handleBlur())}_handleKeyDown(e){if(e.data.native.ctrlKey||e.data.native.metaKey)return;const r=this._keyToNumber[e.data.key];r!=null&&(this._cameraControllerKeyboard&&this._cameraControllerKeyboard.active||(this._cameraControllerKeyboard=new vb({view:this._view,disableMovements:this._disableMovements}),this._view.state.switchCameraController(this._cameraControllerKeyboard)),this._cameraControllerKeyboard.active&&(this._cameraControllerKeyboard.activateDirection(r),e.stopPropagation()))}_handleBlur(){this._cameraControllerKeyboard&&this._cameraControllerKeyboard.active&&(this._cameraControllerKeyboard.finishController(),this._cameraControllerKeyboard=null)}_handleKeyUp(e){if(e.data.native.ctrlKey||e.data.native.metaKey)return;const r=this._keyToNumber[e.data.key];r!=null&&this._cameraControllerKeyboard&&this._cameraControllerKeyboard.active&&(this._cameraControllerKeyboard.deactivateDirection(r),e.stopPropagation())}},Rit=class extends To{constructor(e,r){super(!0),this._view=e,this.registerIncoming("mouse-wheel",r,i=>this._handleMouseWheel(i))}_handleMouseWheel(e){if(!this._view.navigation.mouseWheelZoomEnabled)return;const r=e.data;this._cameraController&&this._cameraController.active||(this._cameraController=this._view.state.isGlobal?new _4({view:this._view,mode:"interaction"}):new v4({view:this._view,mode:"interaction"}),this._view.state.switchCameraController(this._cameraController)),this._cameraController.zoomStep(-1/60*r.deltaY,Zi(r.x,r.y)),e.preventDefault(),e.stopPropagation()}},E4=class{constructor(e){this._gain=e}reset(e){this._value=e}set gain(e){this._gain=e}get value(){return this._value===void 0?0:this._value}update(e){this._value===void 0?this._value=e:this._value=this._gain*e+(1-this._gain)*this._value}},dw=class extends JO{constructor(){super(...arguments),this._beginCamera=new ut,this._elapsedTimeSec=0,this.constraintOptions={selection:Ai.ALL,interactionType:Zt.PAN,interactionFactor:0,interactionStartCamera:new ut,interactionDirection:null,tiltMode:Jn.TUMBLE}}initialize(){this.constraintOptions.interactionType=this.interactionType,this.viewAnimation=new T2}get steppingFinished(){return this.momentum.isFinished(this._elapsedTimeSec)}onControllerStart(e){this._beginCamera.copyFrom(e),this.constraintOptions.interactionStartCamera=this._beginCamera,super.onControllerStart(e)}stepController(e,r){r.copyViewFrom(this._beginCamera),this._elapsedTimeSec+=e,this.momentumStep(this._elapsedTimeSec,r),Rs(this.view,r,this.constraintOptions)}};dw=u([R("esri.views.3d.state.controllers.momentum.MomentumController")],dw);let H3=class extends dw{constructor(e){super(e),this.interactionType=Zt.PAN,this._tmpPan=C()}momentumStep(e,r){const i=this.momentum.value(e);te(this._tmpPan,this.momentum.direction,i),r.eye=he(Xse,r.eye,this._tmpPan),r.center=he(Xse,r.center,this._tmpPan),this.constraintOptions.interactionDirection=this._tmpPan}};u([d({constructOnly:!0})],H3.prototype,"momentum",void 0),H3=u([R("esri.views.3d.state.controllers.momentum.PanPlanarMomentumController")],H3);const Xse=C(),Pit=C(),fI=C();let sD=class extends dw{constructor(e){super(e),this.interactionType=Zt.PAN}momentumStep(e,r){const i=this.momentum.value1(e),s=this.momentum.value2(e);ie(fI,r.eye),me(fI,fI),at(this.momentum.axis2,fI,this.momentum.axis1),gTe(r,Pit,this.momentum.axis1,i,this.momentum.axis2,s)}};u([d({constructOnly:!0})],sD.prototype,"momentum",void 0),sD=u([R("esri.views.3d.state.controllers.momentum.PanSphericalMomentumController")],sD);let sb=class extends dw{set center(e){this._set("center",$s(e))}set axis(e){this._set("axis",$s(e))}constructor(e){super(e),this.interactionType=Zt.TUMBLE}momentumStep(e,r){const i=this.momentum.value(e);z_(r,this.center,QO(this.axis,i))}};u([d({constructOnly:!0})],sb.prototype,"momentum",void 0),u([d({constructOnly:!0})],sb.prototype,"center",null),u([d({constructOnly:!0})],sb.prototype,"axis",null),sb=u([R("esri.views.3d.state.controllers.momentum.MomentumController")],sb);let cS=class extends dw{set zoomCenter(e){this._set("zoomCenter",$s(e))}constructor(e){super(e),this.interactionType=Zt.ZOOM,this.constraintOptions.interactionDirection=C()}momentumStep(e,r){const{interactionDirection:i}=this.constraintOptions;if(!i)return;ie(i,r.eye);const s=this.momentum.valueDelta(0,e);cY(r,this.zoomCenter,s,this.view.state.constraints.minimumPoiDistance),Hg(i,r.eye,i)}};u([d({constructOnly:!0})],cS.prototype,"momentum",void 0),u([d({constructOnly:!0})],cS.prototype,"zoomCenter",null),cS=u([R("esri.views.3d.state.controllers.momentum.ZoomPlanarMomentumController")],cS);let F1=class extends dw{set screenCenter(e){this._set("screenCenter",Zi(e[0],e[1]))}set sceneCenter(e){this._set("sceneCenter",$s(e))}constructor(e){super(e),this.interactionType=Zt.ZOOM,this.radius=0,this._tmpSceneCenter=C(),this._tmpZoomAxisAngle=e6(),this._sphere=gs()}initialize(){this._sphere[3]=this.radius}momentumStep(e,r){const i=this.momentum.valueDelta(0,e);uTe(this._sphere,r,i),this.constraintOptions.interactionType=Zt.ZOOM,Rs(this.view,r,this.constraintOptions),KO(this._sphere,r,this.screenCenter,this._tmpSceneCenter),oY(this.sceneCenter,this._tmpSceneCenter,this._tmpZoomAxisAngle),z_(r,this._sphere,this._tmpZoomAxisAngle),this.constraintOptions.interactionType=Zt.PAN}};u([d({constructOnly:!0})],F1.prototype,"momentum",void 0),u([d({constructOnly:!0})],F1.prototype,"screenCenter",null),u([d({constructOnly:!0})],F1.prototype,"sceneCenter",null),u([d({constructOnly:!0})],F1.prototype,"radius",void 0),F1=u([R("esri.views.3d.state.controllers.momentum.ZoomSphericalMomentumController")],F1);let Vd=class{constructor(e){this._gain=e,this.lastValue=void 0,this.filteredDelta=void 0}update(e){if(this.hasLastValue()){const r=this.computeDelta(e);this._updateDelta(r)}this.lastValue=e}reset(){this.lastValue=void 0,this.filteredDelta=void 0}hasLastValue(){return this.lastValue!==void 0}hasFilteredDelta(){return this.filteredDelta!==void 0}computeDelta(e){return this.lastValue===void 0?NaN:e-this.lastValue}_updateDelta(e){this.filteredDelta!==void 0?this.filteredDelta=(1-this._gain)*this.filteredDelta+this._gain*e:this.filteredDelta=e}},n6=class{constructor(e,r,i){this._initialVelocity=e,this._stopVelocity=r,this._friction=i,this._duration=Math.abs(Math.log(Math.abs(this._initialVelocity)/this._stopVelocity)/Math.log(1-this._friction))}get duration(){return this._duration}isFinished(e){return e>this.duration}get friction(){return this._friction}value(e){return this.valueFromInitialVelocity(this._initialVelocity,e)}valueDelta(e,r){const i=this.value(e);return this.value(e+r)-i}valueFromInitialVelocity(e,r){r=Math.min(r,this.duration);const i=1-this.friction;return e*(i**r-1)/Math.log(i)}},Mit=class extends n6{constructor(e,r,i,s,n){super(e,r,i),this._sceneVelocity=s,this.direction=n}value(e){return super.valueFromInitialVelocity(this._sceneVelocity,e)}},HTe=class{constructor(e=300,r=12,i=.84){this._minimumInitialVelocity=e,this._stopVelocity=r,this._friction=i,this.enabled=!0,this._time=new Vd(.6),this._screen=[new Vd(.4),new Vd(.4)],this._scene=[new Vd(.6),new Vd(.6),new Vd(.6)],this._tmpDirection=C()}add(e,r,i){if(this.enabled){if(this._time.hasLastValue()&&this._time.computeDelta(i)<.015)return;this._screen[0].update(e[0]),this._screen[1].update(e[1]),this._scene[0].update(r[0]),this._scene[1].update(r[1]),this._scene[2].update(r[2]),this._time.update(i)}}reset(){this._screen[0].reset(),this._screen[1].reset(),this._scene[0].reset(),this._scene[1].reset(),this._scene[2].reset(),this._time.reset()}evaluateMomentum(){if(!this.enabled||!this._screen[0].hasFilteredDelta()||!this._time.hasFilteredDelta())return null;const e=this._screen[0].filteredDelta,r=this._screen[1].filteredDelta,i=e==null||r==null?0:Math.sqrt(e*e+r*r),s=this._time.filteredDelta,n=s==null||i==null?0:i/s;return Math.abs(n)<this._minimumInitialVelocity?null:this.createMomentum(n,this._stopVelocity,this._friction)}createMomentum(e,r,i){se(this._tmpDirection,this._scene[0].filteredDelta??0,this._scene[1].filteredDelta??0,this._scene[2].filteredDelta??0);const s=Ce(this._tmpDirection);s>0&&te(this._tmpDirection,this._tmpDirection,1/s);const n=this._time.filteredDelta;return new Mit(e,r,i,n==null?0:s/n,this._tmpDirection)}},Yse=class{constructor(e){this._gain=e}update(e){this.filteredValue!==void 0?this.filteredValue=(1-this._gain)*this.filteredValue+this._gain*e:this.filteredValue=e}reset(){this.filteredValue=void 0}get hasFilteredValue(){return this.filteredValue!==void 0}};const Jse=1e-5;let Iit=class extends n6{constructor(e,r,i,s,n,o=0,a){super(e,r,i),this._angularVelocity1=s,this.axis1=n,this.angularVelocity2=o,this.axis2=a}value1(e){return super.valueFromInitialVelocity(this._angularVelocity1,e)}value2(e){return super.valueFromInitialVelocity(this.angularVelocity2,e)}},$it=class{constructor(e=300,r=12,i=.84){this._minimumInitialVelocity=e,this._stopVelocity=r,this._friction=i,this.enabled=!0,this._tmpAxis1=C(),this._tmpAxis2=C(),this._tmpAngles=Ve(),this._time=new Vd(.3),this._screen=[new Vd(.4),new Vd(.4)],this._angle1=new Yse(.6),this._angle2=new Yse(.6),this._axis1=C(),this._axis2=C(),this._lastScene=C()}addMomentumDirectRotation(e,r,i,s,n,o){if(this.enabled){if(this._time.hasLastValue()){if(this._time.computeDelta(i)<.01)return;let a=fTe(this._lastScene,r,this._tmpAxis2,s,n,o);this._angle2.update(0),na(this._tmpAxis2)<Jse?a=0:me(this._axis1,this._tmpAxis2),this._angle1.update(a),ie(this._lastScene,r)}this._screen[0].update(e[0]),this._screen[1].update(e[1]),this._time.update(i)}}addMomentumPreserveHeading(e,r,i,s,n,o,a){if(this.enabled){if(this._time.hasLastValue()){if(this._time.computeDelta(i)<.01)return;mTe(this._lastScene,r,this._tmpAxis2,this._tmpAxis1,this._tmpAngles,s,n,o,a,!1),na(this._tmpAxis2)<Jse?(this._angle1.update(0),this._angle2.update(0)):(this._angle1.update(this._tmpAngles[1]),this._angle2.update(this._tmpAngles[0]),me(this._axis1,this._tmpAxis1),me(this._axis2,this._tmpAxis2)),ie(this._lastScene,r)}this._screen[0].update(e[0]),this._screen[1].update(e[1]),this._time.update(i)}}reset(){this._screen[0].reset(),this._screen[1].reset(),this._angle1.reset(),this._angle2.reset(),this._time.reset()}evaluateMomentum(){if(!this.enabled||!this._screen[0].hasFilteredDelta())return null;const e=this._screen[0].filteredDelta,r=this._screen[1].filteredDelta,i=e==null||r==null?null:Math.sqrt(e*e+r*r),s=this._time.filteredDelta,n=i==null||s==null?0:i/s;return Math.abs(n)<this._minimumInitialVelocity?null:this.createMomentum(n,this._stopVelocity,this._friction)}createMomentum(e,r,i){const s=this._time.filteredDelta,n=this._angle1.filteredValue,o=this._angle2.filteredValue,a=s==null||o==null?0:o/s;return new Iit(e,r,i,s==null||n==null?0:n/s,this._axis1,a,this._axis2)}},qTe=class{constructor(e=2.5,r=.01,i=.95,s=12){this._minimumInitialVelocity=e,this._stopVelocity=r,this._friction=i,this._maxVelocity=s,this.enabled=!0,this.value=new Vd(.8),this.time=new Vd(.3)}add(e,r){if(this.enabled&&r!=null){if(this.time.hasLastValue()){if(this.time.computeDelta(r)<.01)return;if(this.value.hasFilteredDelta()){const i=this.value.computeDelta(e);this.value.filteredDelta*i<0&&this.value.reset()}}this.time.update(r),this.value.update(e)}}reset(){this.value.reset(),this.time.reset()}evaluateMomentum(){if(!this.enabled||!this.value.hasFilteredDelta()||!this.time.hasFilteredDelta())return null;let e=this.value.filteredDelta/this.time.filteredDelta;return e=ge(e,-this._maxVelocity,this._maxVelocity),Math.abs(e)<this._minimumInitialVelocity?null:this.createMomentum(e,this._stopVelocity,this._friction)}createMomentum(e,r,i){return new n6(e,r,i)}},WTe=class extends qTe{constructor(e=3,r=.01,i=.95,s=12){super(e,r,i,s)}add(e,r){const i=this.value.lastValue;if(i!=null){let s=e-i;for(;s>Math.PI;)s-=2*Math.PI;for(;s<-Math.PI;)s+=2*Math.PI;e=i+s}super.add(e,r)}},Lit=class extends n6{constructor(e,r,i){super(e,r,i)}value(e){const r=super.value(e);return Math.exp(r)}valueDelta(e,r){const i=super.value(e),s=super.value(e+r)-i;return Math.exp(s)}},ZTe=class extends qTe{constructor(e=2.5,r=.01,i=.95,s=12){super(e,r,i,s)}add(e,r){super.add(Math.log(e),r)}createMomentum(e,r,i){return new Lit(e,r,i)}},Qj=class extends xf{constructor(){super(...arguments),this._smoothRotation=new E4(.05),this._rotationAxis=C(),this._beginAngle=0,this._beginHeading=0,this._panningPlane=Ir(),this._beginRadius=0,this._smoothScaling=new E4(.05),this._zoomCenterScreen=Zi(),this._zoomMomentumEstimator=new ZTe,this._rotationMomentumEstimator=new WTe,this._panSphericalMomentumEstimator=new $it,this._panPlanarMomentumEstimator=new HTe,this._adjustedSphere=gs(),this._tmp3d=C(),this._tmpScreenPointArray=Zi(),this._beginScreenPoint=Zi(),this._beginScenePoint=C(),this._screenPickPoint=Zi(),this._scenePickPoint=C(),this._mode=Yn.Horizontal,this._sphere=gs(),this._pointerCount=0,this._tmpInteractionDirection=C(),this._constraintOptions={selection:Ai.ALL,interactionType:Zt.NONE,interactionFactor:0,interactionStartCamera:new ut,interactionDirection:null,tiltMode:Jn.TUMBLE}}get _intersectionHelper(){return this.view.sceneIntersectionHelper}begin(e){if(!this.active)return;const r=this.view.navigation.momentumEnabled;this._zoomMomentumEstimator.enabled=r,this._rotationMomentumEstimator.enabled=r,this._panPlanarMomentumEstimator.enabled=r,this._panSphericalMomentumEstimator.enabled=r,this._beginHeading=-A_.normalize(Dt(this.view.camera.heading)),this._beginRadius=e.radius,this._pointerCount=e.pointers.size,this._beginAngle=e.angle,this._smoothRotation.reset(),ff(e.center,this._screenPickPoint),fn(this._beginScreenPoint,this._screenPickPoint);const i=Nr(this.view.spatialReference),s=dTe(this._intersectionHelper,this.startCamera,this._screenPickPoint,i,R2.Silhouette,this.view.map.ground.opacity===0?Vw:{});s.scenePickPoint!=null&&(this._scenePickPoint=s.scenePickPoint,this._sphere=s.sphere,ie(this._beginScenePoint,this._scenePickPoint),this._mode=r6(this.startCamera,this._screenPickPoint,i),this._mode===Yn.Vertical&&this._preparePlanarPanMode(e,s.hasGeometryIntersection),this._constraintOptions.interactionStartCamera?.copyFrom(this.startCamera))}update(e){if(!this.active)return;this.currentCamera.copyFrom(this.startCamera);const r=e.pointers.size>1;this._mode===Yn.Horizontal?(r&&this._zoomSpherical(e),this._panningSpherical(e),r&&this._rotateSpherical(e)):(r&&this._zoomPlanar(e),this._panningPlanar(e),r&&this._rotatePlanar(e)),this.commitCamera()}end(e){e.pointers.size===this._pointerCount&&this.update(e),this.finishController();const r=this._zoomMomentumEstimator.evaluateMomentum();if(r)return this._mode===Yn.Horizontal?new F1({view:this.view,momentum:r,screenCenter:this._zoomCenterScreen,sceneCenter:this._beginScenePoint,radius:this._sphere[3]}):new cS({view:this.view,momentum:r,zoomCenter:this._beginScenePoint});const i=this._rotationMomentumEstimator.evaluateMomentum();if(i)return new sb({view:this.view,momentum:i,center:this._sphere,axis:this._rotationAxis});if(this._mode===Yn.Horizontal){const s=this._panSphericalMomentumEstimator.evaluateMomentum();if(s)return new sD({view:this.view,momentum:s})}else{const s=this._panPlanarMomentumEstimator.evaluateMomentum();if(s)return new H3({view:this.view,momentum:s})}return null}_preparePlanarPanMode(e,r){const i=ca(this._tmp3d,this.startCamera.viewForward);ZR(this._scenePickPoint,i,this._panningPlane);const s=Zi(this._screenPickPoint[0],0),n=C(),o=Ce(this.startCamera.eye);this._adjustedSphere[3]=o<this._sphere[3]?o-100:this._sphere[3],KO(this._adjustedSphere,this.startCamera,s,n);const a=zo();this.startCamera.projectToRenderScreen(n,a);const l=C(),c=C(),h=C();he(l,this._scenePickPoint,this.currentCamera.eye);const p=Ce(l);me(l,l);const f=lTe*Math.max(Math.abs(this.view.camera.position.z),cTe),m=this.view._stage.renderView.getMinimalDepthForArea(null,this._screenPickPoint[0],this._screenPickPoint[1],this.view.state.camera,t6);let y=m??f;y=r?Math.min(y,p):y,ie(h,ce(c,this.currentCamera.eye,te(c,l,y))),this._panningPlane[3]=-fe(this._panningPlane,h),this.startCamera.center=ce(c,this.startCamera.eye,te(c,this.startCamera.viewForward,y));const _=ff(e.center,this._tmpScreenPointArray);Hj(this._panningPlane,this.startCamera,_,this._beginScenePoint)}_zoomSpherical(e){const r=this._beginRadius/e.radius,i=.001875*Math.min(Math.max(e.radius,40),120);this._smoothScaling.gain=i,this._smoothScaling.update(r),uTe(this._sphere,this.currentCamera,this._smoothScaling.value),ff(e.center,this._zoomCenterScreen),this._zoomMomentumEstimator.add(this._smoothScaling.value,.001*e.timestamp),this._constraintOptions.interactionType=Zt.ZOOM,this._constraintOptions.interactionFactor=kd(e.radius-this._beginRadius),Rs(this.view,this.currentCamera,this._constraintOptions)}_panningSpherical(e){const r=ff(e.center,this._tmpScreenPointArray);KO(this._sphere,this.currentCamera,r,this._tmp3d),uY(this._beginScenePoint,fe(this.currentCamera.up,this._beginScenePoint),this._sphere[3],this._beginHeading,this.view.camera.tilt,this.startCamera)?(_Te(this._sphere,this.currentCamera,this._beginScenePoint,this._tmp3d,this._beginHeading,this.view.camera.tilt,!1),this._panSphericalMomentumEstimator.addMomentumPreserveHeading(r,this._tmp3d,.001*e.timestamp,this.startCamera,this._sphere,this._beginHeading,this.view.camera.tilt)):(yTe(this._sphere,this.currentCamera,this._beginScenePoint,this._tmp3d,this.view.camera.tilt,!1),this._panSphericalMomentumEstimator.addMomentumDirectRotation(r,this._tmp3d,.001*e.timestamp,this.startCamera,this._sphere[3],this.view.camera.tilt)),this._constraintOptions.interactionType=Zt.PAN,this._constraintOptions.interactionFactor=kd(sw(this._screenPickPoint,r)),Rs(this.view,this.currentCamera,this._constraintOptions)}_rotateSpherical(e){me(this._rotationAxis,this._scenePickPoint),this.currentCamera.aboveGround||ca(this._rotationAxis,this._rotationAxis);const r=this._smoothRotation.value,i=r+jj(e.angle-r),s=.00125*Math.min(Math.max(e.radius,40),120);this._smoothRotation.gain=s,this._smoothRotation.update(i);const n=this._smoothRotation.value-this._beginAngle;this._rotationMomentumEstimator.add(n,.001*e.timestamp),z_(this.currentCamera,this._sphere,QO(this._rotationAxis,n)),this._constraintOptions.interactionType=Zt.TUMBLE,this._constraintOptions.interactionFactor=kd(e.radius*i),Rs(this.view,this.currentCamera,this._constraintOptions)}_panningPlanar(e){const r=ff(e.center,this._tmpScreenPointArray);Hj(this._panningPlane,this.currentCamera,r,this._tmp3d)&&(pTe(this.currentCamera,this._beginScenePoint,this._tmp3d),this._panPlanarMomentumEstimator.add(r,this._tmp3d,.001*e.timestamp),this._constraintOptions.interactionType=Zt.PAN,this._constraintOptions.interactionFactor=kd(sw(this._beginScreenPoint,r)),this._constraintOptions.interactionDirection=this.view.renderCoordsHelper.worldUpAtPosition(this.currentCamera.eye,this._tmpInteractionDirection),Rs(this.view,this.currentCamera,this._constraintOptions),this._constraintOptions.interactionDirection=null)}_zoomPlanar(e){const r=this._beginRadius/e.radius,i=.001875*Math.min(Math.max(e.radius,40),120);this._smoothScaling.gain=i,this._smoothScaling.update(r),this._zoomMomentumEstimator.add(this._smoothScaling.value,.001*e.timestamp),cY(this.currentCamera,this._beginScenePoint,this._smoothScaling.value,this.view.state.constraints.minimumPoiDistance),this._constraintOptions.interactionType=Zt.ZOOM,this._constraintOptions.interactionFactor=kd(e.radius-this._beginRadius),Rs(this.view,this.currentCamera,this._constraintOptions)}_rotatePlanar(e){ie(this._rotationAxis,this._beginScenePoint),this.currentCamera.aboveGround||ca(this._rotationAxis,this._rotationAxis);const r=this._smoothRotation.value;let i=e.angle-r;i=jj(i);const s=r+i,n=.00125*Math.min(Math.max(e.radius,40),120);this._smoothRotation.gain=n,this._smoothRotation.update(s);const o=this._smoothRotation.value-this._beginAngle;this._rotationMomentumEstimator.add(o,.001*e.timestamp),z_(this.currentCamera,this._sphere,QO(this._rotationAxis,o)),this._constraintOptions.interactionType=Zt.TUMBLE,this._constraintOptions.interactionFactor=kd(e.radius*o),Rs(this.view,this.currentCamera,this._constraintOptions)}};Qj=u([R("esri.views.3d.state.controllers.global.PinchAndPanController")],Qj);const Qse=Oe(0,0,1),Dit={ELEVATION_THRESHOLD:3e4,ANGLE_THRESHOLD:16/180*Math.PI};let Kj=class extends xf{constructor(){super(...arguments),this._rotationValueSmooth=new E4(.05),this._scalingValueSmooth=new E4(.05),this._planeHorizontal=Ir(),this._planeVertical=Ir(),this._rotationMomentumEstimator=new WTe,this._panMomentumEstimator=new HTe(300,12,.9),this._zoomMomentumEstimator=new ZTe,this._beginRadius=0,this._beginCenter=C(),this._beginAngle=0,this._tmpPoints=[],this._panMode=Yn.Horizontal,this._beginCenterScreen=Zi(),this._tmpCentroid3d=C(),this._tmpCentroid2d=Zi(),this._tmp2d=Zi(),this._pointerCount=0,this._constraintOptions={selection:Ai.ALL,interactionType:Zt.NONE,interactionFactor:0,interactionStartCamera:new ut,interactionDirection:null,tiltMode:Jn.TUMBLE}}begin(e){if(!this.active)return;const r=this.view.navigation.momentumEnabled;this._zoomMomentumEstimator.enabled=r,this._rotationMomentumEstimator.enabled=r,this._panMomentumEstimator.enabled=r,this._beginRadius=e.radius,this._pointerCount=e.pointers.size,this._beginAngle=e.angle,this._rotationValueSmooth.reset(),this._scalingValueSmooth.reset(),ff(e.center,this._beginCenterScreen),pbe(Qse,0,this._planeHorizontal);const i=C(),s=this._intersectionHelper.intersectScreenFreePointFallback(this._beginCenterScreen,i,this.view.map.ground.opacity===0?Vw:{}),n=C();ca(n,this.startCamera.viewForward);const o=C();ie(o,Qse);const a=fe(n,o),l=Ch(a<0?-a:a);this._panMode=l>=Dit.ANGLE_THRESHOLD?Yn.Horizontal:Yn.Vertical;const c=Math.min(lTe,1/Math.abs(fe(o,this.startCamera.viewForward)))*Math.max(Math.abs(this.view.camera.position.z),cTe);lG(this._planeHorizontal,this._planeHorizontal,i),this.startCamera.aboveGround||cG(this._planeHorizontal,this._planeHorizontal);const h=C(),p=C(),f=C();he(h,i,this.currentCamera.eye);const m=Ce(h);if(me(h,h),this._panMode===Yn.Vertical){te(o,o,a),he(this._planeVertical,n,o),me(this._planeVertical,this._planeVertical),lG(this._planeVertical,this._planeVertical,i);const y=this.view._stage.renderView.getMinimalDepthForArea(this.view.voxelWasm,this._beginCenterScreen[0],this._beginCenterScreen[1],this.view.state.camera,t6);let _=y??c;_=s?Math.min(_,m):_,ie(f,ce(p,this.currentCamera.eye,te(p,h,_))),this._planeVertical[3]=-fe(this._planeVertical,f),this._computePlanePoints(e.pointers,this._planeVertical,this.startCamera,this._tmpPoints),I8(this._tmpPoints,this._beginCenter)}else{const y=s?m:c;ie(f,ce(p,this.currentCamera.eye,te(p,h,y))),this._planeHorizontal[3]=-fe(this._planeHorizontal,f),this._computePlanePoints(e.pointers,this._planeHorizontal,this.startCamera,this._tmpPoints),I8(this._tmpPoints,this._beginCenter)}this._constraintOptions.interactionStartCamera?.copyFrom(this.startCamera)}update(e){if(!this.active)return;this.currentCamera.copyFrom(this.startCamera);const r=e.pointers.size>1,i=this._panMode===Yn.Horizontal?this._planeHorizontal:this._planeVertical,s=this._beginCenter;if(r){const n=this._beginRadius/e.radius,o=.001875*Math.min(Math.max(e.radius,40),120);this._scalingValueSmooth.gain=o,this._scalingValueSmooth.update(n),cY(this.currentCamera,s,this._scalingValueSmooth.value,this.view.state.constraints.minimumPoiDistance),this._zoomMomentumEstimator.add(this._scalingValueSmooth.value,.001*e.timestamp),this._constraintOptions.interactionType=Zt.ZOOM,this._constraintOptions.interactionFactor=kd(Math.abs(e.radius-this._beginRadius)),Rs(this.view,this.currentCamera,this._constraintOptions)}if(this._computePlanePoints(e.pointers,i,this.currentCamera,this._tmpPoints),I8(this._tmpPoints,this._tmpCentroid3d),ff(e.center,this._tmpCentroid2d),pTe(this.currentCamera,s,this._tmpCentroid3d),this._panMomentumEstimator.add(this._tmpCentroid2d,this._tmpCentroid3d,.001*e.timestamp),this._constraintOptions.interactionType=Zt.PAN,this._constraintOptions.interactionFactor=kd(sw(this._beginCenterScreen,this._tmpCentroid2d)),Rs(this.view,this.currentCamera,this._constraintOptions),r){const n=this._planeHorizontal,o=s,a=this._rotationValueSmooth.value,l=a+jj(e.angle-a),c=.00125*Math.min(Math.max(e.radius,40),120);this._rotationValueSmooth.gain=c,this._rotationValueSmooth.update(l);const h=this._rotationValueSmooth.value-this._beginAngle;this._rotationMomentumEstimator.add(h,.001*e.timestamp),z_(this.currentCamera,o,QO(n,h)),this._constraintOptions.interactionType=Zt.TUMBLE,this._constraintOptions.interactionFactor=kd(Math.abs(e.radius*h)),Rs(this.view,this.currentCamera,this._constraintOptions)}this.commitCamera()}end(e){e.pointers.size===this._pointerCount&&this.update(e),this.finishController();const r=this._zoomMomentumEstimator.evaluateMomentum();if(r)return new cS({view:this.view,momentum:r,zoomCenter:this._beginCenter});const i=this._rotationMomentumEstimator.evaluateMomentum();if(i)return new sb({view:this.view,momentum:i,center:this._beginCenter,axis:this._planeHorizontal});const s=this._panMomentumEstimator.evaluateMomentum();return s?new H3({view:this.view,momentum:s}):null}_computePlanePoints(e,r,i,s){s.length=e.size;const n=this._tmp2d;let o=0;return e.forEach(a=>{n[0]=a.x,n[1]=a.y,s[o]===void 0&&(s[o]=C()),Hj(r,i,n,s[o]),o+=1}),s}get _intersectionHelper(){return this.view.sceneIntersectionHelper}};Kj=u([R("esri.views.3d.state.controllers.local.PinchAndPanController")],Kj);let Kse=class extends To{constructor(e,r,i){super(!0),this._view=e,this.pointerAction=r,this._lastEndTimestamp=0,this._lastTimestamp=0,this.registerIncoming("drag",i,s=>this._handleDrag(s))}_handleDrag(e){if(e.data.pointerType==="mouse"&&!dY(e.data,this.pointerAction))return;const r=e.timestamp-this._lastEndTimestamp,i=40,s=this._momentum&&this._momentum.active&&r<i;switch(e.data.action){case"start":case"update":if(s)break;this._controller&&this._controller.active?e.data.timestamp-this._lastTimestamp>2&&(this._controller.update(e.data),this._lastTimestamp=e.timestamp):this._startController(e);break;case"end":case"removed":this._endController(e,!0);break;case"added":this._endController(e,!1),this._startController(e)}e.stopPropagation()}_endController(e,r){if(this._controller&&this._controller.active){this._lastEndTimestamp=e.timestamp;const i=this._controller.end(e.data);r&&i&&(this._momentum=i,this._view.state.switchCameraController(this._momentum))}this._controller=null}_startController(e){this._controller=this._createController(),this._view.state.switchCameraController(this._controller),this._controller.begin(e.data),this._lastTimestamp=e.timestamp}_createController(){return this._view.state.isGlobal?new Qj({view:this._view}):new Kj({view:this._view})}},Nit=class extends To{constructor(e,r){super(!0),this.view=e,this.registerIncoming("pointer-down",r,()=>this.view.state.stopActiveCameraController())}},XTe=class extends To{constructor(e,r){super(!0),this.key=e,this.registerIncoming("key-down",r,i=>this._handleKeyDown(i))}_handleKeyDown(e){e.data.key===this.key&&(this.activate(),e.stopPropagation())}},Fit=class extends XTe{constructor(e,r,i){super(r,i),this.view=e}activate(){this.view.goTo({heading:0}).catch(()=>{})}},Uit=class extends XTe{constructor(e,r,i){super(r,i),this.view=e}activate(){this.view.goTo({tilt:0}).catch(()=>{})}},kit=class extends To{constructor(e,r=!1){super(!0),this._view=e,this._invert=r,this.registerIncoming("vertical-two-finger-drag",i=>this._handleTwoFinger(i))}_handleTwoFinger(e){const r=this._invert?-1:1,i=Zi(0,e.data.delta*r);switch(e.data.action){case"begin":this._cameraController?.end(),this._cameraController=new j3({view:this._view,pivot:tc.CENTER}),this._view.state.switchCameraController(this._cameraController),this._cameraController.begin(i);break;case"update":this._cameraController?.update(i);break;case"end":this._cameraController?.end(),this._cameraController=null}}};function ene(t){const e=t.native;return e?{buttons:e.buttons.map(r=>r.pressed?r.value||1:0),axes:e.axes.map(r=>Bit(r,t.axisThreshold))}:{buttons:[],axes:[]}}function Vit(t,e){if(t.axes.length!==e.axes.length||t.buttons.length!==e.buttons.length)return!1;for(let r=0;r<t.axes.length;r++)if(t.axes[r]!==e.axes[r])return!1;for(let r=0;r<t.buttons.length;r++)if(t.buttons[r]!==e.buttons[r])return!1;return!0}function zit(t){for(let e=0;e<t.axes.length;e++)if(t.axes[e]!==0)return!1;for(let e=0;e<t.buttons.length;e++)if(t.buttons[e]!==0)return!1;return!0}function Bit(t,e){const r=Math.abs(t);return r<e?0:Math.sign(t)*(r-e)/(1-e)}let Git=class{constructor(e,r){this._element=e,this._input=r,this._hasEventListeners=!1,this._onConnectGamepad=n=>{this._connectGamepad(n.gamepad)},this._onDisconnectGamepad=n=>{const o=n.gamepad,a=o.index,l=this._inputDevices[a];l&&(this._emitGamepadEvent(o,ene(l),!1),this._inputDevices.splice(a,1),this._latestUpdate.splice(a,1),this._input.gamepad.devices.remove(l),this.ensurePollingState())},this._frameTask=null,this._latestUpdate=new Array,this._inputDevices=new Array,this._callback=null;const i="getGamepads"in window.navigator,s=window.isSecureContext;this.supported=i&&s,this.supported&&(this._forEachGamepad(n=>this._connectGamepad(n)),window.addEventListener("gamepadconnected",this._onConnectGamepad),window.addEventListener("gamepaddisconnected",this._onDisconnectGamepad),this.ensurePollingState())}destroy(){this.hasEventListeners=!1,this.supported&&(window.removeEventListener("gamepadconnected",this._onConnectGamepad),window.removeEventListener("gamepaddisconnected",this._onDisconnectGamepad))}set hasEventListeners(e){this._hasEventListeners!==e&&(this._hasEventListeners=e,this.ensurePollingState())}get _eventsEnabled(){return this.supported&&this._inputDevices.length>0&&this._hasEventListeners}set onEvent(e){this._callback=e}_connectGamepad(e){const r=new SX(e);r.deviceType!=="unknown"&&(this._inputDevices[e.index]=r,this._input.gamepad.devices.add(r)),this.ensurePollingState()}ensurePollingState(){this._eventsEnabled?this._startPolling():this._stopPolling()}_startPolling(){this._frameTask==null&&(this._frameTask=JS({update:()=>this._readGamepadState()}))}_stopPolling(){this._frameTask!=null&&(this._frameTask.remove(),this._frameTask=null,this._latestUpdate=new Array)}_readGamepadState(){const e=document.hasFocus(),r=this._element.contains(document.activeElement),i=this._input.gamepad.enabledFocusMode==="document"&&!e||this._input.gamepad.enabledFocusMode==="view"&&!r;this._forEachGamepad(s=>{const n=this._inputDevices[s.index];if(!n)return;const o=this._latestUpdate[s.index],a=ene(n),l=i||zit(a);o&&(o.timestamp===s.timestamp||!o.active&&l||Vit(o.state,a))||this._emitGamepadEvent(s,a,!l)})}_forEachGamepad(e){const r=window.navigator.getGamepads();for(let i=0;i<r.length;i++){const s=r[i];this._validate(s)&&e(s)}}_emitGamepadEvent(e,r,i){const s=this._latestUpdate[e.index],n=s&&s.active;if(!n&&!i)return;const o=!n&&i?"start":n&&i?"update":"end";this._latestUpdate[e.index]={timestamp:e.timestamp,state:r,active:i},this._callback&&this._callback({device:this._inputDevices[e.index],state:r,action:o})}_validate(e){if(!e||!e.connected)return!1;for(let r=0;r<e.axes.length;r++)if(isNaN(e.axes[r]))return!1;return!0}};const tne=oe("edge"),jit=oe("chrome"),Hit=oe("ff"),qit=oe("safari"),rne="esri-view-surface",vx={touchNone:`${rne}--touch-none`,touchPan:`${rne}--touch-pan`};let YTe=class JTe{constructor(e,r){this._input=r,this._active={},this._callback=()=>{},this._activePointerCaptures=new Set,this._keyDownState=new Set,this._eventId=1,this._browserTouchPanningEnabled=!1,this._element=e,e.getAttribute("tabindex")||e.setAttribute("tabindex","0"),this._eventHandlers={"key-down":this._handleKey,"key-up":this._handleKey,"pointer-down":this._handlePointer,"pointer-move":this._handlePointerPreventDefault,"pointer-up":this._handlePointerPreventDefault,"pointer-enter":this._handlePointer,"pointer-leave":this._handlePointer,"pointer-cancel":this._handlePointer,"mouse-wheel":this._handleMouseWheel,"pointer-capture-lost":this._handlePointerCaptureLost},this._updateTouchAction(),this._element.addEventListener("keydown",this._preventAltKeyDefault),this._gamepadSource=new Git(e,this._input),this._gamepadSource.onEvent=i=>this._callback("gamepad",i)}destroy(){this._callback=()=>{},this.activeEvents=null,this._activePointerCaptures.forEach(e=>{this._releasePointerCaptureSafe(e)}),this._gamepadSource=Me(this._gamepadSource),this._activePointerCaptures=null,this._removeTouchAction(),this._element.removeEventListener("keydown",this._preventAltKeyDefault)}get browserTouchPanningEnabled(){return this._browserTouchPanningEnabled}set browserTouchPanningEnabled(e){this._browserTouchPanningEnabled=e,this._updateTouchAction(),this._updateTouchEventHandling()}set onEventReceived(e){this._callback=e}set activeEvents(e){for(const r in this._active)if(!e||!e.has(r)){const i=this._active[r];this._element.removeEventListener(j8[r],i),delete this._active[r]}e&&e.forEach(r=>{if(!this._active[r]&&j8[r]){const i=(this._eventHandlers[r]||this._handleDefault).bind(this,r);this._element.addEventListener(j8[r],i),this._active[r]=i}}),this._gamepadSource.hasEventListeners=e?.has("gamepad")??!1}setPointerCapture(e,r){r?this._setPointerCatpureSafe(e.pointerId):(this._releasePointerCaptureSafe(e.pointerId),this._activePointerCaptures.delete(e.pointerId))}_updateTouchAction(){this._element.classList.remove(this._browserTouchPanningEnabled?vx.touchNone:vx.touchPan),this._element.classList.add(this._browserTouchPanningEnabled?vx.touchPan:vx.touchNone)}_updateTouchEventHandling(){this._browserTouchPanningEnabled?this._element.addEventListener("touchmove",this._preventMultiTouchPanning):this._element.removeEventListener("touchmove",this._preventMultiTouchPanning)}_removeTouchAction(){this._element.classList.remove(vx.touchNone),this._element.classList.remove(vx.touchPan),this._element.removeEventListener("touchmove",this._preventMultiTouchPanning)}_setPointerCatpureSafe(e){try{this._element.setPointerCapture(e),this._activePointerCaptures.add(e)}catch{}}_releasePointerCaptureSafe(e){try{if(this._element.hasPointerCapture&&!this._element.hasPointerCapture(e))return;this._element.releasePointerCapture(e)}catch{}}_updateNormalizedPointerLikeEvent(e,r){const i=a1e(this._element,e);return JTe.test.disableSubpixelCoordinates&&(i.x=Math.round(i.x),i.y=Math.round(i.y)),r.x=i.x,r.y=i.y,r}_handleKey(e,r){const i=TGe(r);i&&e==="key-up"&&this._keyDownState.delete(i);const s={native:r,key:i,repeat:!!i&&this._keyDownState.has(i)};i&&e==="key-down"&&this._keyDownState.add(s.key),this._callback(e,s)}_handlePointer(e,r){const i=this._updateNormalizedPointerLikeEvent(r,{native:r,x:0,y:0,pointerType:r.pointerType,button:r.button,buttons:r.buttons,eventId:this._eventId++});this._callback(e,i)}_handlePointerPreventDefault(e,r){const i=this._updateNormalizedPointerLikeEvent(r,{native:r,x:0,y:0,pointerType:r.pointerType,button:r.button,buttons:r.buttons,eventId:this._eventId++});r.preventDefault(),this._callback(e,i)}_handleMouseWheel(e,r){let i=r.deltaY;switch(r.deltaMode){case 0:tne&&(i=i/document.documentElement.clientHeight*600);break;case 1:i*=30;break;case 2:i*=900}tne?i*=.7:jit||qit?i*=.6:Hit&&(i*=1.375);const s=100,n=Math.abs(i);n>s&&(i=i/n*200/(1+Math.exp(-.02*(n-s))));const o=this._updateNormalizedPointerLikeEvent(r,{native:r,x:0,y:0,deltaY:i});this._callback(e,o)}_handlePointerCaptureLost(e,r){this._activePointerCaptures.delete(r.pointerId),this._handleDefault(e,r)}_handleDefault(e,r){const i={native:r};r.preventDefault(),this._callback(e,i)}_preventAltKeyDefault(e){e.key==="Alt"&&e.preventDefault()}_preventMultiTouchPanning(e){e.touches.length>1&&e.preventDefault()}};YTe.test={disableSubpixelCoordinates:!1};const j8={"key-down":"keydown","key-up":"keyup","pointer-down":"pointerdown","pointer-up":"pointerup","pointer-move":"pointermove","mouse-wheel":"wheel","pointer-capture-got":"gotpointercapture","pointer-capture-lost":"lostpointercapture","context-menu":"contextmenu","pointer-enter":"pointerenter","pointer-leave":"pointerleave","pointer-cancel":"pointercancel",focus:"focus",blur:"blur"};let Wit=class extends To{constructor(){super(!0),this.registerIncoming("context-menu",e=>{e.data.native.preventDefault()})}};function QTe(t,e){return Math.abs(e.x-t.x)+Math.abs(e.y-t.y)}function Zit(t,e){const r=e.x-t.x,i=e.y-t.y;return Math.sqrt(r*r+i*i)}function Xit(t,e){if(e?(e.radius=0,e.center.x=0,e.center.y=0):e={radius:0,center:Ah()},t.length===0)return e;if(t.length===1)return e.center.x=t[0].x,e.center.y=t[0].y,e;if(t.length===2){const[T,S]=t,[O,A]=[S.x-T.x,S.y-T.y];return e.radius=Math.sqrt(O*O+A*A)/2,e.center.x=(T.x+S.x)/2,e.center.y=(T.y+S.y)/2,e}let r=0,i=0;for(let T=0;T<t.length;T++)r+=t[T].x,i+=t[T].y;r/=t.length,i/=t.length;const s=t.map(T=>T.x-r),n=t.map(T=>T.y-i);let o=0,a=0,l=0,c=0,h=0,p=0,f=0;for(let T=0;T<s.length;T++){const S=s[T],O=n[T],A=S*S,I=O*O;o+=A,a+=I,l+=S*O,c+=A*S,h+=I*O,p+=S*I,f+=O*A}const m=.5*(c+p),y=.5*(h+f),_=o*a-l*l,v=(m*a-y*l)/_,w=(o*y-l*m)/_,x=Ah(v+r,w+i);return{radius:Math.sqrt(v*v+w*w+(o+a)/t.length),center:x}}function q3(t){const{native:e}=t,{pointerId:r,button:i,pointerType:s}=e;return s==="mouse"?`${r}:${i}`:`${s}`}let Yit=class extends To{constructor(e){super(!1),this._navigationTouch=e,this._startStateModifiers=new Set,this._activePointerMap=new Map,this._isDragging=!1,this._isCurrentDragSuppressed=!1,this._drag=this.registerOutgoing("drag"),this.registerIncoming("pointer-drag",this._handlePointerDrag.bind(this)),this.registerIncoming("pointer-up",this._handlePointerUpAndPointerLost.bind(this)),this.registerIncoming("pointer-capture-lost",this._handlePointerUpAndPointerLost.bind(this)),this.registerIncoming("pointer-cancel",this._handlePointerUpAndPointerLost.bind(this))}_createPayload(e,r,i,s){return{action:e,pointerType:this._pointerType,button:this._mouseButton,buttons:r.buttons,timestamp:s,pointers:Jit(this._activePointerMap),pointer:r,angle:i.angle,radius:i.radius,center:i.center}}_addPointer(e){const r=e.native.pointerId,i=mI(this._activePointerMap).angle,s={event:e,initialAngle:0,lastAngle:0};this._activePointerMap.set(r,s);const n=nD(s,KTe(this._activePointerMap));s.initialAngle=n,s.lastAngle=n,this._updatePointerAngles(i)}_updatePointer(e){if(e&&e.x==null&&e.y==null)return;const r=e.native.pointerId,i=this._activePointerMap.get(r);i?i.event=e:this._addPointer(e)}_removePointer(e){const r=mI(this._activePointerMap).angle;this._activePointerMap.delete(e),this._updatePointerAngles(r)}_updatePointerAngles(e){const r=mI(this._activePointerMap);this._activePointerMap.forEach(i=>{i.initialAngle=nD(i,r)-e,i.lastAngle=nD(i,r)-e})}_emitEvent(e,r,i){const s=mI(this._activePointerMap);this._drag.emit(this._createPayload(e,r,s,i),void 0,this._startStateModifiers)}_handlePointerUpAndPointerLost(e){const r=e.data.native.pointerId,i=e.timestamp;this._activePointerMap.get(r)&&(this._activePointerMap.size===1?(this._updatePointer(e.data),!this._isCurrentDragSuppressed&&this._emitEvent("end",e.data,i),this._isDragging=!1,this._isCurrentDragSuppressed=!1,this._removePointer(r)):(this._removePointer(r),this._emitEvent("removed",e.data,e.timestamp)))}_handlePointerDrag(e){const r=e.data,i=r.currentEvent,s=e.timestamp;switch(r.action){case"start":case"update":this._isDragging?this._activePointerMap.has(i.native.pointerId)?(this._updatePointer(i),!this._isCurrentDragSuppressed&&this._emitEvent("update",i,s)):(this._addPointer(i),this._emitEvent("added",i,s),this._isCurrentDragSuppressed=this._isSuppressed):(this._updatePointer(i),this._pointerType=e.data.startEvent.pointerType,this._mouseButton=e.data.startEvent.button,this._startStateModifiers=e.modifiers,this._isDragging=!0,this._isCurrentDragSuppressed=this._isSuppressed,!this._isCurrentDragSuppressed&&this._emitEvent("start",i,s))}}get _isSuppressed(){return!!this._navigationTouch&&!this._navigationTouch.browserTouchPanEnabled&&this._pointerType==="touch"&&this._activePointerMap.size===1}};function KTe(t){const e=[];return t.forEach(r=>{e.push(Ah(r.event.x,r.event.y))}),Xit(e)}function mI(t){const e=KTe(t);let r=0;return t.forEach(i=>{let s=nD(i,e),n=s-i.lastAngle;for(;n>Math.PI;)n-=2*Math.PI;for(;n<-Math.PI;)n+=2*Math.PI;s=i.lastAngle+n,i.lastAngle=s;const o=s-i.initialAngle;r+=o}),r/=t.size||1,{angle:r,radius:e.radius,center:e.center}}function Jit(t){const e=new Map;return t.forEach((r,i)=>e.set(i,r.event)),e}function nD(t,e){const r=t.event,i=r.x-e.center.x,s=r.y-e.center.y;return Math.atan2(s,i)}var ine;(function(t){t[t.Left=0]="Left",t[t.Middle=1]="Middle",t[t.Right=2]="Right",t[t.Back=3]="Back",t[t.Forward=4]="Forward",t[t.Undefined=-1]="Undefined"})(ine||(ine={}));const l_={maximumDoubleClickDelay:250,maximumDoubleClickDistance:10,maximumDoubleTouchDelay:350,maximumDoubleTouchDistance:35};let Qit=class extends To{constructor(e=l_.maximumDoubleClickDelay,r=l_.maximumDoubleClickDistance,i=l_.maximumDoubleTouchDelay,s=l_.maximumDoubleTouchDistance,n=wR){super(!1),this._maximumDoubleClickDelay=e,this._maximumDoubleClickDistance=r,this._maximumDoubleTouchDelay=i,this._maximumDoubleTouchDistance=s,this._clock=n,this._pointerState=new Map,this._click=this.registerOutgoing("click"),this._doubleClick=this.registerOutgoing("double-click"),this.registerIncoming("immediate-click",this._handleImmediateClick.bind(this)),this.registerIncoming("pointer-down",this._handlePointerDown.bind(this))}onUninstall(){this._pointerState.forEach(e=>e.doubleClickTimer=Ii(e.doubleClickTimer))}get hasPendingInputs(){return No(this._pointerState,e=>e.doubleClickTimer!=null)}_clearDoubleClickTimer(e,r){const i=this._pointerState.get(e);i&&(i.doubleClickTimer=Ii(i.doubleClickTimer),r&&this._click.emit(i.event.data,void 0,i.event.modifiers),this._pointerState.delete(e),this.refreshHasPendingInputs())}_doubleClickTimeoutExceeded(e){const r=this._pointerState.get(e);r.pointerDownCount===1&&this._click.emit(r.event.data,void 0,r.event.modifiers),r.doubleClickTimer=null,this._pointerState.delete(e),this.refreshHasPendingInputs()}_getPointerId(e){const{pointerId:r,pointerType:i,button:s}=e.native;return i==="mouse"?`${r}:${s}`:`${i}`}_handleImmediateClick(e){const r=e.data,{pointerType:i}=r.native,s=this._getPointerId(r);if(!this._pointerState.has(s))return void this._startClick(e);const n=this._pointerState.get(s),{data:o,modifiers:a}=n.event,l=i==="touch"?this._maximumDoubleTouchDistance:this._maximumDoubleClickDistance;QTe(o,r)>l?(this._clearDoubleClickTimer(s,!0),this._startClick(e)):(this._clearDoubleClickTimer(s,!1),n.pointerDownCount===2&&this._doubleClick.emit(o,void 0,a))}_handlePointerDown(e){const r=q3(e.data),i=this._pointerState.get(r);i&&(i.pointerDownCount+=1)}_startClick(e){const{data:r}=e,{native:{pointerType:i}}=r,s=q3(r),n=i==="touch"?this._maximumDoubleTouchDelay:this._maximumDoubleClickDelay,o=this._clock.setTimeout(()=>this._doubleClickTimeoutExceeded(s),n),a=1;this._pointerState.set(s,{event:e,doubleClickTimer:o,pointerDownCount:a}),this.refreshHasPendingInputs()}},Kit=class extends To{constructor(e=l_.maximumDoubleClickDelay,r=l_.maximumDoubleClickDistance,i=l_.maximumDoubleTouchDelay,s=l_.maximumDoubleTouchDistance,n=wR){super(!1),this._maximumDoubleClickDelay=e,this._maximumDoubleClickDistance=r,this._maximumDoubleTouchDelay=i,this._maximumDoubleTouchDistance=s,this._clock=n,this._pointerState=new Map,this._immediateDoubleClick=this.registerOutgoing("immediate-double-click"),this.registerIncoming("pointer-down",this._handlePointerDown.bind(this)),this.registerIncoming("pointer-up",this._handlePointerUp.bind(this))}onUninstall(){this._pointerState.forEach(e=>{e.immediateDoubleClick&&e.immediateDoubleClick.timeoutHandle.remove()}),super.onUninstall()}_handlePointerDown(e){const r=e.data,i=q3(r);if(!this._pointerState.has(i)){const s={downButton:r.native.button,immediateDoubleClick:null};this._pointerState.set(i,s),this.startCapturingPointer(r.native)}}_handlePointerUp(e){const r=e.data,i=q3(r),s=this._pointerState.get(i);if(s&&s.downButton===r.native.button){const n=s.immediateDoubleClick;if(n){n.timeoutHandle.remove();const o=e.data.native.pointerType==="touch"?this._maximumDoubleTouchDistance:this._maximumDoubleClickDistance;QTe(n,e.data)>o?this._startImmediateDoubleClick(e,s):(this._immediateDoubleClick.emit(e.data,void 0,n.modifiers),this._removeState(r))}else this._startImmediateDoubleClick(e,s)}}_startImmediateDoubleClick(e,r){const i=e.data.native.pointerType==="touch"?this._maximumDoubleTouchDelay:this._maximumDoubleClickDelay;r.immediateDoubleClick={x:e.data.x,y:e.data.y,modifiers:e.modifiers,timeoutHandle:this._clock.setTimeout(()=>this._removeState(e.data),i)}}_removeState(e){const r=q3(e);this._pointerState.delete(r),this.stopCapturingPointer(e.native),this.refreshHasPendingInputs()}};const aC={maximumClickDelay:300,movementUntilMouseDrag:1.5,movementUntilPenDrag:6,movementUntilTouchDrag:6,holdDelay:500};let est=class extends To{constructor(e=aC.maximumClickDelay,r=aC.movementUntilMouseDrag,i=aC.movementUntilPenDrag,s=aC.movementUntilTouchDrag,n=aC.holdDelay,o=wR){super(!1),this._maximumClickDelay=e,this._movementUntilMouseDrag=r,this._movementUntilPenDrag=i,this._movementUntilTouchDrag=s,this._holdDelay=n,this._clock=o,this._pointerState=new Map,this._pointerDrag=this.registerOutgoing("pointer-drag"),this._immediateClick=this.registerOutgoing("immediate-click"),this._pointerHold=this.registerOutgoing("hold"),this.registerIncoming("pointer-down",this._handlePointerDown.bind(this)),this.registerIncoming("pointer-up",a=>{this._handlePointerLoss(a,"pointer-up")}),this.registerIncoming("pointer-capture-lost",a=>{this._handlePointerLoss(a,"pointer-capture-lost")}),this.registerIncoming("pointer-cancel",a=>{this._handlePointerLoss(a,"pointer-cancel")}),this._moveHandle=this.registerIncoming("pointer-move",this._handlePointerMove.bind(this)),this._moveHandle.pause()}onUninstall(){this._pointerState.forEach(e=>{e.holdTimeout=Ii(e.holdTimeout)}),super.onUninstall()}_handlePointerDown(e){const r=e.data,i=r.native.pointerId;let s=null;this._pointerState.size===0&&(s=this._clock.setTimeout(()=>{const o=this._pointerState.get(i);if(o){if(!o.isDragging){const a=o.previousEvent;this._pointerHold.emit(a,void 0,e.modifiers),o.holdEmitted=!0}o.holdTimeout=null}},this._holdDelay));const n={startEvent:r,previousEvent:r,startTimestamp:e.timestamp,isDragging:!1,downButton:r.native.button,holdTimeout:s,modifiers:new Set};this._pointerState.set(i,n),this.startCapturingPointer(r.native),this._moveHandle.resume(),this._pointerState.size>1&&this._startDragging(e)}_createPointerDragData(e,r,i){return{action:e,startEvent:r.startEvent,previousEvent:r.previousEvent,currentEvent:i}}_handlePointerMove(e){const r=e.data,i=r.native.pointerId,s=this._pointerState.get(i);s&&(s.isDragging?this._pointerDrag.emit(this._createPointerDragData("update",s,r),void 0,s.modifiers):Zit(r,s.startEvent)>this._getDragThreshold(r.native.pointerType)&&this._startDragging(e),s.previousEvent=r)}_getDragThreshold(e){switch(e){case"touch":return this._movementUntilTouchDrag;case"pen":return this._movementUntilPenDrag;default:return this._movementUntilMouseDrag}}_startDragging(e){const r=e.data,i=r.native.pointerId;this._pointerState.forEach(s=>{s.holdTimeout!=null&&(s.holdTimeout.remove(),s.holdTimeout=null),s.isDragging||(s.modifiers=e.modifiers,s.isDragging=!0,i===s.startEvent.native.pointerId?this._pointerDrag.emit(this._createPointerDragData("start",s,r)):this._pointerDrag.emit(this._createPointerDragData("start",s,s.previousEvent),e.timestamp))})}_handlePointerLoss(e,r){const i=e.data,s=i.native.pointerId,n=this._pointerState.get(s);n&&(n.holdTimeout!=null&&(n.holdTimeout.remove(),n.holdTimeout=null),n.isDragging?this._pointerDrag.emit(this._createPointerDragData("end",n,r==="pointer-up"?i:n.previousEvent),void 0,n.modifiers):r==="pointer-up"&&n.downButton===i.native.button&&e.timestamp-n.startTimestamp<=this._maximumClickDelay&&!n.holdEmitted&&this._immediateClick.emit(i),this._pointerState.delete(s),this.stopCapturingPointer(i.native),this._pointerState.size===0&&this._moveHandle.pause())}},tst=class{constructor(e){this._callbacks=e,this._currentCount=0,this._callbacks.condition||(this._callbacks.condition=()=>!0)}handle(e){const r=e.data,i=r.pointers.size;switch(r.action){case"start":this._currentCount=i,this._emitStart(e);break;case"added":this._emitEnd(this._previousEvent),this._currentCount=i,this._emitStart(e);break;case"update":this._emitUpdate(e);break;case"removed":this._startEvent&&this._emitEnd(this._previousEvent),this._currentCount=i,this._emitStart(e);break;case"end":this._emitEnd(e),this._currentCount=0}this._previousEvent=e}_emitStart(e){this._startEvent=e,this._callbacks.condition?.(this._currentCount,e)&&this._callbacks.start(this._currentCount,e,this._startEvent)}_emitUpdate(e){this._callbacks.condition?.(this._currentCount,e)&&this._callbacks.update(this._currentCount,e,this._startEvent)}_emitEnd(e){this._callbacks.condition?.(this._currentCount,e)&&this._callbacks.end(this._currentCount,e,this._startEvent),this._startEvent=null}},rst=class extends To{constructor(e=20,r=40){super(!1),this._threshold=e,this._maxDelta=r,this._state="ready",this._emittedArtificalEnd2=!1,this._vertical=this.registerOutgoing("vertical-two-finger-drag"),this._artificalDrag=this.registerOutgoing("drag"),this._dragEventSeparator=new tst({start:(i,s)=>this._observeStart(i,s),update:(i,s,n)=>this._observeUpdate(i,s,n),end:(i,s)=>this._observeEnd(s)}),this.registerIncoming("drag",i=>this._dragEventSeparator.handle(i))}get failed(){return this._state==="failed"}_observeStart(e,r){e===1&&this._emittedArtificalEnd2&&(this._emittedArtificalEnd2=!1,this._artificalDrag.emit({action:"start",button:r.data.button,buttons:r.data.buttons,pointerType:r.data.pointerType,timestamp:r.data.timestamp,pointers:r.data.pointers,pointer:r.data.pointer,angle:r.data.angle,radius:r.data.radius,center:r.data.center}),r.stopPropagation()),this._state=e===2?"ready":"failed"}_observeUpdate(e,r,i){if(this._state!=="failed"&&e===2)return this._state==="active"?(this._vertical.emit({delta:r.data.center.y-this._thresholdReachedCenter.y,action:"update"}),void r.stopPropagation()):void(this._checkMovementWithinLimits(r.data,i.data)?this._checkVerticalThresholdReached(r.data,i.data)&&(this._state="active",this._emittedArtificalEnd2=!0,this._thresholdReachedCenter=r.data.center,this._artificalDrag.emit({action:"end",button:r.data.button,buttons:r.data.buttons,pointerType:r.data.pointerType,timestamp:r.data.timestamp,pointers:r.data.pointers,pointer:r.data.pointer,angle:r.data.angle,radius:r.data.radius,center:r.data.center}),this._vertical.emit({delta:r.data.center.y-this._thresholdReachedCenter.y,action:"begin"}),r.stopPropagation()):this._state="failed")}_observeEnd(e){this._state==="active"&&(this._vertical.emit({delta:e.data.center.y-this._thresholdReachedCenter.y,action:"end"}),this._state="ready",e.stopPropagation())}_checkMovementWithinLimits(e,r){let i=-1/0,s=1/0,n=-1/0,o=1/0;for(const{x:_,y:v}of r.pointers.values())i=Math.max(i,_),s=Math.min(s,_),n=Math.max(n,v),o=Math.min(o,v);let a=-1/0,l=1/0,c=-1/0,h=1/0;for(const{x:_,y:v}of e.pointers.values())a=Math.max(a,_),l=Math.min(l,_),c=Math.max(c,v),h=Math.min(h,v);const p=i-s,f=n-o,m=a-l,y=c-h;return Math.abs(e.center.x-r.center.x)<this._threshold&&Math.abs(m-p)<=this._maxDelta&&Math.abs(y-f)<=this._maxDelta}_checkVerticalThresholdReached(e,r){let i=Math.abs(e.center.y-r.center.y);return e.pointers.forEach((s,n)=>{const o=r.pointers.get(n);i=Math.min(i,Math.abs(s.y-o.y))}),i>=this._threshold}},vd=class extends Te{constructor(){super(...arguments),this._handles=new Oi}destroy(){this._handles=Me(this._handles),this.disconnect()}get primaryDragAction(){return this._get("primaryDragAction")}set primaryDragAction(e){e!=="pan"&&e!=="rotate"||e===this._get("primaryDragAction")||(this._set("primaryDragAction",e),this._updateMode())}get mode(){return this._get("mode")}set mode(e){e!=="default"&&e!=="pro"||e===this._get("mode")||(this._set("mode",e),this._updateMode())}get updating(){return!!this._inputManager?.updating}get latestPointerType(){return this._inputManager?.latestPointerType}get latestPointerLocation(){return this._inputManager?.latestPointerLocation}get multiTouchActive(){return this._inputManager?.multiTouchActive??!1}disconnect(){this.view.viewEvents.disconnect(),this._inputManager=Me(this._inputManager)}connect(){const e=this.view;this._source=new YTe(this.view.surface,e.input);const r=[new Kit,new est,new Qit,new Yit(this.view.navigation),new rst],i=new zu({eventSource:this._source,recognizers:r});this._inputManager=i,i.installHandlers("prevent-context-menu",[new Wit],m_.INTERNAL),this._modeDragPan=new Kse(e,"primary"),this._modeDragRotate=new B8(e,"secondary",tc.CENTER),this._modeDragZoom=new vit(e,"tertiary");const s={lookAround:"b",pan:{left:"ArrowLeft",right:"ArrowRight",forward:"ArrowUp",backward:"ArrowDown",up:"u",down:"j",headingLeft:"a",headingRight:"d",tiltUp:"w",tiltDown:"s",zoomIn:"+",zoomOut:"-"},resetHeading:"n",resetTilt:"p"};i.installHandlers("navigation",[new Nit(e),new prt(e),new Ait(e),new Oit(e,s.pan),new Rit(e),new Uit(e,s.resetTilt),new Fit(e,s.resetHeading),new B8(e,"primary",tc.EYE,[s.lookAround]),new B8(e,"secondary",tc.CENTER,[s.lookAround]),new Kse(e,"tertiary",[s.lookAround]),this._modeDragRotate,this._modeDragZoom,this._modeDragPan,new kit(e)],m_.INTERNAL),this.view.viewEvents.connect(i),this._updateMode(),this._handles.add(le(()=>this.view.navigation?.browserTouchPanEnabled,n=>{this._source.browserTouchPanningEnabled=!n},Vr))}_updateMode(){const e=this.mode,r=this.primaryDragAction,i=eH.get(e)?.get(r);i&&(this._modeDragPan&&(this._modeDragPan.pointerAction=i.pan),this._modeDragRotate&&(this._modeDragRotate.pointerAction=i.rotate),this._modeDragZoom&&(this._modeDragZoom.pointerAction=i.zoom))}get test(){return{inputManager:this._inputManager,modeDragPan:this._modeDragPan,modeDragRotate:this._modeDragRotate,modeDragZoom:this._modeDragZoom}}};u([d()],vd.prototype,"view",void 0),u([d({value:"pan"})],vd.prototype,"primaryDragAction",null),u([d({value:"default"})],vd.prototype,"mode",null),u([d({readOnly:!0})],vd.prototype,"updating",null),u([d()],vd.prototype,"latestPointerType",null),u([d()],vd.prototype,"latestPointerLocation",null),u([d()],vd.prototype,"multiTouchActive",null),u([d()],vd.prototype,"_inputManager",void 0),vd=u([R("esri.views.3d.input.SceneInputManager")],vd);const eH=new Map,H8=new Map,q8=new Map;H8.set("pan",{pan:"primary",rotate:"secondary",zoom:"tertiary"}),H8.set("rotate",{pan:"secondary",rotate:"primary",zoom:"tertiary"}),q8.set("pan",{pan:"primary",rotate:"tertiary",zoom:"secondary"}),q8.set("rotate",{pan:"tertiary",rotate:"primary",zoom:"secondary"}),eH.set("default",H8),eH.set("pro",q8);const ist=vd;let bs=class extends Te{constructor(){super(...arguments),this.SCENEVIEW_HITTEST_RETURN_INTERSECTOR=!1,this.DECONFLICTOR_SHOW_VISIBLE=!1,this.DECONFLICTOR_SHOW_INVISIBLE=!1,this.DECONFLICTOR_SHOW_GRID=!1,this.LABELS_SHOW_BORDER=!1,this.TEXT_SHOW_BASELINE=!1,this.TEXT_SHOW_BORDER=!1,this.OVERLAY_DRAW_DEBUG_TEXTURE=!1,this.OVERLAY_SHOW_CENTER=!1,this.SHOW_POI=!1,this.TESTS_DISABLE_OPTIMIZATIONS=!1,this.TESTS_DISABLE_FAST_UPDATES=!1,this.DRAW_MESH_GEOMETRY_NORMALS=!1,this.FEATURE_TILE_FETCH_SHOW_TILES=!1,this.FEATURE_TILE_TREE_SHOW_TILES=!1,this.TERRAIN_TILE_TREE_SHOW_TILES=!1,this.I3S_TREE_SHOW_TILES=!1,this.I3S_SHOW_MODIFICATIONS=!1,this.LOD_INSTANCE_RENDERER_DISABLE_UPDATES=!1,this.LOD_INSTANCE_RENDERER_COLORIZE_BY_LEVEL=!1,this.EDGES_SHOW_HIDDEN_TRANSPARENT_EDGES=!1,this.LINE_WIREFRAMES=!1}};u([d()],bs.prototype,"SCENEVIEW_HITTEST_RETURN_INTERSECTOR",void 0),u([d()],bs.prototype,"DECONFLICTOR_SHOW_VISIBLE",void 0),u([d()],bs.prototype,"DECONFLICTOR_SHOW_INVISIBLE",void 0),u([d()],bs.prototype,"DECONFLICTOR_SHOW_GRID",void 0),u([d()],bs.prototype,"LABELS_SHOW_BORDER",void 0),u([d()],bs.prototype,"TEXT_SHOW_BASELINE",void 0),u([d()],bs.prototype,"TEXT_SHOW_BORDER",void 0),u([d()],bs.prototype,"OVERLAY_DRAW_DEBUG_TEXTURE",void 0),u([d()],bs.prototype,"OVERLAY_SHOW_CENTER",void 0),u([d()],bs.prototype,"SHOW_POI",void 0),u([d()],bs.prototype,"TESTS_DISABLE_OPTIMIZATIONS",void 0),u([d()],bs.prototype,"TESTS_DISABLE_FAST_UPDATES",void 0),u([d()],bs.prototype,"DRAW_MESH_GEOMETRY_NORMALS",void 0),u([d()],bs.prototype,"FEATURE_TILE_FETCH_SHOW_TILES",void 0),u([d()],bs.prototype,"FEATURE_TILE_TREE_SHOW_TILES",void 0),u([d()],bs.prototype,"TERRAIN_TILE_TREE_SHOW_TILES",void 0),u([d()],bs.prototype,"I3S_TREE_SHOW_TILES",void 0),u([d()],bs.prototype,"I3S_SHOW_MODIFICATIONS",void 0),u([d()],bs.prototype,"LOD_INSTANCE_RENDERER_DISABLE_UPDATES",void 0),u([d()],bs.prototype,"LOD_INSTANCE_RENDERER_COLORIZE_BY_LEVEL",void 0),u([d()],bs.prototype,"EDGES_SHOW_HIDDEN_TRANSPARENT_EDGES",void 0),u([d()],bs.prototype,"LINE_WIREFRAMES",void 0),bs=u([R("esri.views.3d.support.DebugFlags")],bs);const ni=new bs;let Xc,VS,tH=!1,rH=!1,iH=!1,sH=!1,W3=null;function sst(t,e){if(!rH||!VS)return;eSe();const r=VS;let i=0;for(let s=0;s<t.accBinsNumX;s++)for(let n=0;n<t.accBinsNumY;n++){const o=t.accBins[s][t.accBinsNumY-1-n];i+=o.length;const a=s*t.accBinsSizeX,l=(s+1)*t.accBinsSizeX,c=n*t.accBinsSizeY,h=(n+1)*t.accBinsSizeY;r.fillText(o.length.toFixed(),a+5,c+15),tSe(a,l,c,h,"blue")}r.fillText("total totalShownLabels: "+i,70,40),r.fillText("total visible labels: "+e.size,70,50),r.fillText("total numTests: "+t.accNumTests,70,30)}function nst(t){iH=ni.DECONFLICTOR_SHOW_VISIBLE,sH=ni.DECONFLICTOR_SHOW_INVISIBLE,tH=iH||sH,rH=ni.DECONFLICTOR_SHOW_GRID,W3=null,tH||rH?W3=()=>ost(t):Xc&&(Xc.parentElement.removeChild(Xc),Xc=null)}function eSe(){W3&&(W3(),W3=null)}function ost(t){Xc==null&&(Xc=document.createElement("canvas"),Xc.setAttribute("id","debugCanvas2d"),t.surface.parentElement.style.position="relative",t.surface.parentElement.appendChild(Xc));const{state:e}=t,{camera:r,pixelRatio:i}=e,{width:s,height:n}=r,o=s*i,a=n*i;Xc.setAttribute("width",`${o}px`),Xc.setAttribute("height",`${a}px`),Xc.setAttribute("style",`position:absolute;left:0px;top:0px;display:block;pointer-events:none;width:${s}px;height:${n}px`),VS=Xc.getContext("2d"),VS.clearRect(0,0,s,n),VS.font="12px Arial"}function tSe(t,e,r,i,s){eSe();const n=Xc.height,o=VS;o.beginPath(),o.lineWidth=1,o.strokeStyle=s,o.moveTo(t,n-r),o.lineTo(e,n-r),o.stroke(),o.lineTo(e,n-i),o.stroke(),o.lineTo(e,n-r),o.stroke(),o.lineTo(t,n-r),o.stroke(),o.lineTo(t,n-r),o.stroke(),o.closePath()}function ast(t,e){tH&&(e&&iH||!e&&sH)&&tSe(t.aabr[0],t.aabr[2],t.aabr[1],t.aabr[3],e?"green":"red")}var ko,Zn;(function(t){t[t.USER=1]="USER",t[t.SCALE_RANGE=2]="SCALE_RANGE",t[t.FILTER=4]="FILTER",t[t.DECONFLICTION=8]="DECONFLICTION",t[t.ALL_GRAPHIC=15]="ALL_GRAPHIC",t[t.ALL_LABEL=255]="ALL_LABEL"})(ko||(ko={})),function(t){t[t.GRAPHIC=1]="GRAPHIC",t[t.LABEL=16]="LABEL"}(Zn||(Zn={}));function rSe(t,e){return new oSe(t,lSe,e)}function lst(t,e){const{curvatureDependent:r,scaleStart:i,scaleFallOffRange:s}=lSe;return new oSe(t,{curvatureDependent:{min:{curvature:r.min.curvature,tiltAngle:r.min.tiltAngle,scaleFallOffFactor:W8.curvatureDependent.min.scaleFallOffFactor},max:{curvature:r.max.curvature,tiltAngle:r.max.tiltAngle,scaleFallOffFactor:W8.curvatureDependent.max.scaleFallOffFactor}},scaleStart:i,scaleFallOffRange:s,minPixelSize:W8.minPixelSize},e)}function cst(t){return Math.abs(t*t*t)}function iSe(t,e,r){const i=r.parameters,s=r.paddingPixelsOverride;return lC.scale=Math.min(i.divisor/(e-i.offset),1),lC.factor=cst(t),lC.minPixelSize=i.minPixelSize,lC.paddingPixels=s,lC}function sSe(t,e){return t===0?e.minPixelSize:e.minPixelSize*(1+2*e.paddingPixels/t)}function bY(t,e){return Math.max(wt(t*e.scale,t,e.factor),sSe(t,e))}function ust(t,e,r){const i=iSe(t,e,r);return i.minPixelSize=0,i.paddingPixels=0,bY(1,i)}function sne(t,e,r,i){i.scale=ust(t,e,r),i.factor=0,i.minPixelSize=r.parameters.minPixelSize,i.paddingPixels=r.paddingPixelsOverride}function nSe(t,e,r=[0,0]){const i=Math.min(Math.max(e.scale,sSe(t[1],e)/Math.max(1e-5,t[1])),1);return r[0]=t[0]*i,r[1]=t[1]*i,r}function hst(t,e,r,i){return bY(t,iSe(e,r,i))}let oSe=class aSe{get paddingPixelsOverride(){return this._paddingPixelsOverride||this.parameters.paddingPixels}constructor(e,r,i,s=dst(),n){this._viewingMode=e,this._description=r,this._ellipsoidRadius=i,this.parameters=s,this._paddingPixelsOverride=n,this._viewingMode===De.Local?(this._coverageCompensation=this._surfaceCoverageCompensationLocal,this._calculateCurvatureDependentParameters=this._calculateCurvatureDependentParametersLocal):(this._coverageCompensation=this._surfaceCoverageCompensationGlobal,this._calculateCurvatureDependentParameters=this._calculateCurvatureDependentParametersGlobal)}update(e){return(!this.parameters||this.parameters.camera.fovY!==e.fovY||this.parameters.camera.distance!==e.distance)&&(this._calculateParameters(e,this._ellipsoidRadius,this.parameters),!0)}overridePadding(e){return e!==this.paddingPixelsOverride?new aSe(this._viewingMode,this._description,this._ellipsoidRadius,this.parameters,e):this}_calculateParameters(e,r,i){const{scaleStart:s,scaleFallOffRange:n,minPixelSize:o}=this._description,{fovY:a,distance:l}=e,c=this._calculateCurvatureDependentParameters(e,r),h=this._coverageCompensation(e,r,c),{tiltAngle:p,scaleFallOffFactor:f}=c,m=Math.sin(p)*l,y=.5*Math.PI-p-a*(.5-s*h),_=m/Math.cos(y),v=y+a*n*h,w=(_-f*(m/Math.cos(v)))/(1-f);return i.camera.fovY=e.fovY,i.camera.distance=e.distance,i.offset=w,i.divisor=_-w,i.minPixelSize=o,i}_calculateCurvatureDependentParametersLocal(e,r,i=nne){return i.tiltAngle=this._description.curvatureDependent.min.tiltAngle,i.scaleFallOffFactor=this._description.curvatureDependent.min.scaleFallOffFactor,i}_calculateCurvatureDependentParametersGlobal(e,r,i=nne){const s=this._description.curvatureDependent,n=1+e.distance/r,o=Math.sqrt(n*n-1),[a,l]=[s.min.curvature,s.max.curvature],c=ge((o-a)/(l-a),0,1),[h,p]=[s.min,s.max];return i.tiltAngle=wt(h.tiltAngle,p.tiltAngle,c),i.scaleFallOffFactor=wt(h.scaleFallOffFactor,p.scaleFallOffFactor,c),i}_surfaceCoverageCompensationLocal(e,r,i){return(e.fovY-i.tiltAngle)/e.fovY}_surfaceCoverageCompensationGlobal(e,r,i){const s=r*r,n=i.tiltAngle+.5*Math.PI,{fovY:o,distance:a}=e,l=a*a+s-2*Math.cos(n)*a*r,c=Math.sqrt(l),h=Math.sqrt(l-s);return(Math.acos(h/c)-Math.asin(r/(c/Math.sin(n)))+.5*o)/o}};const lSe={curvatureDependent:{min:{curvature:Dt(10),tiltAngle:Dt(12),scaleFallOffFactor:.5},max:{curvature:Dt(70),tiltAngle:Dt(40),scaleFallOffFactor:.8}},scaleStart:.3,scaleFallOffRange:.65,minPixelSize:0},W8={curvatureDependent:{min:{scaleFallOffFactor:.7},max:{scaleFallOffFactor:.95}},minPixelSize:14};function dst(){return{camera:{distance:0,fovY:0},divisor:0,offset:0,minPixelSize:0,paddingPixels:0}}const lC={scale:0,factor:0,minPixelSize:0,paddingPixels:0},nne={tiltAngle:0,scaleFallOffFactor:0};function pst(t){return t instanceof Float32Array&&t.length>=16}function fst(t){return Array.isArray(t)&&t.length>=16}function mst(t){return pst(t)||fst(t)}function wY(t){t.vertex.code.add(b`float screenSizePerspectiveMinSize(float size, vec4 factor) {
float nonZeroSize = 1.0 - step(size, 0.0);
return (
factor.z * (
1.0 +
nonZeroSize *
2.0 * factor.w / (
size + (1.0 - nonZeroSize)
)
)
);
}`),t.vertex.code.add(b`float screenSizePerspectiveViewAngleDependentFactor(float absCosAngle) {
return absCosAngle * absCosAngle * absCosAngle;
}`),t.vertex.code.add(b`vec4 screenSizePerspectiveScaleFactor(float absCosAngle, float distanceToCamera, vec4 params) {
return vec4(
min(params.x / (distanceToCamera - params.y), 1.0),
screenSizePerspectiveViewAngleDependentFactor(absCosAngle),
params.z,
params.w
);
}`),t.vertex.code.add(b`float applyScreenSizePerspectiveScaleFactorFloat(float size, vec4 factor) {
return max(mix(size * factor.x, size, factor.y), screenSizePerspectiveMinSize(size, factor));
}`),t.vertex.code.add(b`float screenSizePerspectiveScaleFloat(float size, float absCosAngle, float distanceToCamera, vec4 params) {
return applyScreenSizePerspectiveScaleFactorFloat(
size,
screenSizePerspectiveScaleFactor(absCosAngle, distanceToCamera, params)
);
}`),t.vertex.code.add(b`vec2 applyScreenSizePerspectiveScaleFactorVec2(vec2 size, vec4 factor) {
return mix(size * clamp(factor.x, screenSizePerspectiveMinSize(size.y, factor) / max(1e-5, size.y), 1.0), size, factor.y);
}`),t.vertex.code.add(b`vec2 screenSizePerspectiveScaleVec2(vec2 size, float absCosAngle, float distanceToCamera, vec4 params) {
return applyScreenSizePerspectiveScaleFactorVec2(size, screenSizePerspectiveScaleFactor(absCosAngle, distanceToCamera, params));
}`)}function gst(t){t.uniforms.add(new sr("screenSizePerspective",e=>cSe(e.screenSizePerspective)))}function o6(t){t.uniforms.add(new sr("screenSizePerspectiveAlignment",e=>cSe(e.screenSizePerspectiveAlignment||e.screenSizePerspective)))}function cSe(t){return bi(yst,t.parameters.divisor,t.parameters.offset,t.parameters.minPixelSize,t.paddingPixelsOverride)}const yst=Wt();var Pi,lh,Z3,rs,rn;(function(t){t[t.INNER=0]="INNER",t[t.OUTER=1]="OUTER"})(Pi||(Pi={})),function(t){t[t.REGULAR=0]="REGULAR",t[t.HAS_NORTH_POLE=1]="HAS_NORTH_POLE",t[t.HAS_SOUTH_POLE=2]="HAS_SOUTH_POLE",t[t.HAS_BOTH_POLES=3]="HAS_BOTH_POLES"}(lh||(lh={})),function(t){t[t.OFF=0]="OFF",t[t.ON=1]="ON"}(Z3||(Z3={})),function(t){t[t.Color=0]="Color",t[t.ColorNoRasterImage=1]="ColorNoRasterImage",t[t.Highlight=2]="Highlight",t[t.Water=3]="Water",t[t.Occluded=4]="Occluded",t[t.ObjectAndLayerIdColor=5]="ObjectAndLayerIdColor"}(rs||(rs={})),function(t){t[t.FADING=0]="FADING",t[t.IMMEDIATE=1]="IMMEDIATE",t[t.UNFADED=2]="UNFADED"}(rn||(rn={}));let _st=class{constructor(e,r){this.vec3=e,this.id=r}};function C4(t,e,r,i){return new _st(Oe(t,e,r),i)}var Da;(function(t){t[t.None=0]="None",t[t.ColorAndWater=1]="ColorAndWater",t[t.Highlight=2]="Highlight",t[t.Occluded=3]="Occluded",t[t.ObjectAndLayerIdColor=4]="ObjectAndLayerIdColor"})(Da||(Da={}));const xY=1.3;let one=class{get extent(){return this._extent}constructor(e,r){this.index=e,this.renderTargets=r,this._extent=Ut(),this.resolution=0,this.renderLocalOrigin=C4(0,0,0,"O"),this.pixelRatio=1,this.mapUnitsPerPixel=1,this.canvasGeometries=new vst,this.hasDrapedFeatureSource=!1,this.hasDrapedRasterSource=!1,this.hasTargetWithoutRasterImage=!1,this.index=e,this.validTargets=new Array(r.renderTargets.length).fill(!1)}getValidTexture(e){return this.validTargets[e]?this.renderTargets.getTarget(e).getTexture():null}get _needsColorWithoutRasterImage(){return this.hasDrapedRasterSource&&this.hasDrapedFeatureSource&&this.hasTargetWithoutRasterImage}getColorTexture(e){const r=e===Da.ColorAndWater?this.renderTargets.getTarget(rs.Color):e===Da.Highlight?this.renderTargets.getTarget(rs.Highlight):e===Da.ObjectAndLayerIdColor?this.renderTargets.getTarget(rs.ObjectAndLayerIdColor):this.renderTargets.getTarget(rs.Occluded);return r?r.getTexture():null}getColorTextureNoRasterImage(){return this._needsColorWithoutRasterImage?this.getValidTexture(rs.ColorNoRasterImage):this.hasDrapedFeatureSource?this.getValidTexture(rs.Color):null}getNormalTexture(e){const r=e===Da.ColorAndWater?this.renderTargets.getTarget(rs.Water):null;return r?r.getTexture():null}draw(e,r){const i=this.computeRenderTargetValidityBitfield();for(const s of this.renderTargets.renderTargets)s.type!==rs.ColorNoRasterImage||this._needsColorWithoutRasterImage?this.validTargets[s.type]=e.drawTarget(this,s,r):this.validTargets[s.type]=!1;return i^this.computeRenderTargetValidityBitfield()?E2.CHANGED:E2.UNCHANGED}computeRenderTargetValidityBitfield(){const e=this.validTargets;return+e[rs.Color]|+e[rs.ColorNoRasterImage]<<1|+e[rs.Highlight]<<2|+e[rs.Water]<<3|+e[rs.Occluded]<<4}setupGeometryViewsCyclical(e){this.setupGeometryViewsDirect();const r=.001*e.range;if(this._extent[0]-r<=e.min){const i=this.canvasGeometries.extents[this.canvasGeometries.numViews++];nN(this._extent,e.range,0,i)}if(this._extent[2]+r>=e.max){const i=this.canvasGeometries.extents[this.canvasGeometries.numViews++];nN(this._extent,-e.range,0,i)}}setupGeometryViewsDirect(){this.canvasGeometries.numViews=1,Lg(this.canvasGeometries.extents[0],this._extent)}hasSomeSizedView(){for(let e=0;e<this.canvasGeometries.numViews;e++){const r=this.canvasGeometries.extents[e];if(r[0]!==r[2]&&r[1]!==r[3])return!0}return!1}applyViewport(e){e.setViewport(this.index===Pi.INNER?0:this.resolution,0,this.resolution,this.resolution)}},vst=class{constructor(){this.extents=[Ut(),Ut(),Ut()],this.numViews=0}},uSe=class extends as{constructor(e,r){super(e,"mat4",Qr.Draw,(i,s,n)=>i.setUniformMatrix4fv(e,r(s,n)))}};function up(t,e){e.instancedDoublePrecision?t.constants.add("cameraPosition","vec3",ja):t.uniforms.add(new cu("cameraPosition",(r,i)=>se(hSe,i.camera.viewInverseTransposeMatrix[3]-r.origin[0],i.camera.viewInverseTransposeMatrix[7]-r.origin[1],i.camera.viewInverseTransposeMatrix[11]-r.origin[2])))}function vc(t,e){if(!e.instancedDoublePrecision)return void t.uniforms.add(new $i("proj",(i,s)=>s.camera.projectionMatrix),new uSe("view",(i,s)=>Al(ane,s.camera.viewMatrix,i.origin)),new cu("localOrigin",i=>i.origin));const r=i=>se(hSe,i.camera.viewInverseTransposeMatrix[3],i.camera.viewInverseTransposeMatrix[7],i.camera.viewInverseTransposeMatrix[11]);t.uniforms.add(new $i("proj",(i,s)=>s.camera.projectionMatrix),new $i("view",(i,s)=>Al(ane,s.camera.viewMatrix,r(s))),new Ft("localOrigin",(i,s)=>r(s)))}const ane=be(),hSe=C();function M2(t){t.uniforms.add(new $i("viewNormal",(e,r)=>r.camera.viewInverseTransposeMatrix))}function xE(t,e){t.uniforms.add(new Re("pixelRatio",(r,i)=>i.camera.pixelRatio/(e.draped?xY:1)))}function dSe(t,e){const r=t.vertex;e.hasVerticalOffset?(pSe(r),e.hasScreenSizePerspective&&(t.include(wY),o6(r),up(t.vertex,e)),r.code.add(b`
      vec3 calculateVerticalOffset(vec3 worldPos, vec3 localOrigin) {
        float viewDistance = length((view * vec4(worldPos, 1.0)).xyz);
        ${e.spherical?b`vec3 worldNormal = normalize(worldPos + localOrigin);`:b`vec3 worldNormal = vec3(0.0, 0.0, 1.0);`}
        ${e.hasScreenSizePerspective?b`
            float cosAngle = dot(worldNormal, normalize(worldPos - cameraPosition));
            float verticalOffsetScreenHeight = screenSizePerspectiveScaleFloat(verticalOffset.x, abs(cosAngle), viewDistance, screenSizePerspectiveAlignment);`:b`
            float verticalOffsetScreenHeight = verticalOffset.x;`}
        // Screen sized offset in world space, used for example for line callouts
        float worldOffset = clamp(verticalOffsetScreenHeight * verticalOffset.y * viewDistance, verticalOffset.z, verticalOffset.w);
        return worldNormal * worldOffset;
      }

      vec3 addVerticalOffset(vec3 worldPos, vec3 localOrigin) {
        return worldPos + calculateVerticalOffset(worldPos, localOrigin);
      }
    `)):r.code.add(b`vec3 addVerticalOffset(vec3 worldPos, vec3 localOrigin) { return worldPos; }`)}const bst=Wt();function pSe(t){t.uniforms.add(new sr("verticalOffset",(e,r)=>{const{minWorldLength:i,maxWorldLength:s,screenLength:n}=e.verticalOffset,o=Math.tan(.5*r.camera.fovY)/(.5*r.camera.fullViewport[3]),a=r.camera.pixelRatio||1;return bi(bst,n*a,o,i,s)}))}function a6(t){t.uniforms.add(new Mf("alignPixelEnabled",(e,r)=>r.alignPixelEnabled)),t.code.add(b`vec4 alignToPixelCenter(vec4 clipCoord, vec2 widthHeight) {
if (!alignPixelEnabled)
return clipCoord;
vec2 xy = vec2(0.500123) + 0.5 * clipCoord.xy / clipCoord.w;
vec2 pixelSz = vec2(1.0) / widthHeight;
vec2 ij = (floor(xy * widthHeight) + vec2(0.5)) * pixelSz;
vec2 result = (ij * 2.0 - vec2(1.0)) * clipCoord.w;
return vec4(result, clipCoord.zw);
}`),t.code.add(b`vec4 alignToPixelOrigin(vec4 clipCoord, vec2 widthHeight) {
if (!alignPixelEnabled)
return clipCoord;
vec2 xy = vec2(0.5) + 0.5 * clipCoord.xy / clipCoord.w;
vec2 pixelSz = vec2(1.0) / widthHeight;
vec2 ij = floor((xy + 0.5 * pixelSz) * widthHeight) * pixelSz;
vec2 result = (ij * 2.0 - vec2(1.0)) * clipCoord.w;
return vec4(result, clipCoord.zw);
}`)}var Jl;(function(t){t[t.Occluded=0]="Occluded",t[t.NotOccluded=1]="NotOccluded",t[t.Both=2]="Both",t[t.COUNT=3]="COUNT"})(Jl||(Jl={}));var vl;function fSe(t,e){t.include(wY),t.attributes.add(E.POSITION,"vec3"),t.attributes.add(E.NORMAL,"vec3"),t.attributes.add(E.AUXPOS1,"vec4");const r=t.vertex;vc(r,e),up(r,e),r.uniforms.add(new sr("viewport",(i,s)=>s.camera.fullViewport),new Re("polygonOffset",i=>i.shaderPolygonOffset),new Re("cameraGroundRelative",(i,s)=>s.camera.aboveGround?1:-1),new Re("renderTransparentlyOccludedHUD",(i,s)=>s.renderTransparentlyOccludedHUD===Jl.Occluded?1:s.renderTransparentlyOccludedHUD===Jl.NotOccluded?0:.75),new Je("hudVisibilityTexture",(i,s)=>s.hudVisibilityTexture)),e.hasVerticalOffset&&pSe(r),r.constants.add("smallOffsetAngle","float",.984807753012208),r.code.add(b`struct ProjectHUDAux {
vec3 posModel;
vec3 posView;
vec3 vnormal;
float distanceToCamera;
float absCosAngle;
};`),r.code.add(b`float applyHUDViewDependentPolygonOffset(float pointGroundDistance, float absCosAngle, inout vec3 posView) {
float pointGroundSign = sign(pointGroundDistance);
if (pointGroundSign == 0.0) {
pointGroundSign = cameraGroundRelative;
}
float groundRelative = cameraGroundRelative * pointGroundSign;
if (polygonOffset > .0) {
float cosAlpha = clamp(absCosAngle, 0.01, 1.0);
float tanAlpha = sqrt(1.0 - cosAlpha * cosAlpha) / cosAlpha;
float factor = (1.0 - tanAlpha / viewport[2]);
if (groundRelative > 0.0) {
posView *= factor;
}
else {
posView /= factor;
}
}
return groundRelative;
}`),e.draped&&!e.hasVerticalOffset||M2(r),e.draped||(r.uniforms.add(new Re("perDistancePixelRatio",(i,s)=>Math.tan(s.camera.fovY/2)/(s.camera.fullViewport[2]/2))),r.code.add(b`void applyHUDVerticalGroundOffset(vec3 normalModel, inout vec3 posModel, inout vec3 posView) {
float distanceToCamera = length(posView);
float pixelOffset = distanceToCamera * perDistancePixelRatio * 0.5;
vec3 modelOffset = normalModel * cameraGroundRelative * pixelOffset;
vec3 viewOffset = (viewNormal * vec4(modelOffset, 1.0)).xyz;
posModel += modelOffset;
posView += viewOffset;
}`)),e.screenCenterOffsetUnitsEnabled===vl.Screen&&xE(r,e),e.hasScreenSizePerspective&&o6(r),r.code.add(b`
    vec4 projectPositionHUD(out ProjectHUDAux aux) {
      // centerOffset is in view space and is used to implement world size offsetting
      // of labels with respect to objects. It also pulls the label towards the viewer
      // so that the label is visible in front of the object.
      vec3 centerOffset = auxpos1.xyz;

      // The pointGroundDistance is the distance of the geometry to the ground and is
      // negative if the point is below the ground, or positive if the point is above
      // ground.
      float pointGroundDistance = auxpos1.w;

      aux.posModel = position;
      aux.posView = (view * vec4(aux.posModel, 1.0)).xyz;
      aux.vnormal = normal;
      ${e.draped?"":"applyHUDVerticalGroundOffset(aux.vnormal, aux.posModel, aux.posView);"}

      // Screen sized offset in world space, used for example for line callouts
      // Note: keep this implementation in sync with the CPU implementation, see
      //   - MaterialUtil.verticalOffsetAtDistance
      //   - HUDMaterial.applyVerticalOffsetTransformation

      aux.distanceToCamera = length(aux.posView);

      vec3 viewDirObjSpace = normalize(cameraPosition - aux.posModel);
      float cosAngle = dot(aux.vnormal, viewDirObjSpace);

      aux.absCosAngle = abs(cosAngle);

      ${e.hasScreenSizePerspective&&(e.hasVerticalOffset||e.screenCenterOffsetUnitsEnabled===vl.Screen)?"vec4 perspectiveFactor = screenSizePerspectiveScaleFactor(aux.absCosAngle, aux.distanceToCamera, screenSizePerspectiveAlignment);":""}

      ${e.hasVerticalOffset?e.hasScreenSizePerspective?"float verticalOffsetScreenHeight = applyScreenSizePerspectiveScaleFactorFloat(verticalOffset.x, perspectiveFactor);":"float verticalOffsetScreenHeight = verticalOffset.x;":""}

      ${e.hasVerticalOffset?b`
            float worldOffset = clamp(verticalOffsetScreenHeight * verticalOffset.y * aux.distanceToCamera, verticalOffset.z, verticalOffset.w);
            vec3 modelOffset = aux.vnormal * worldOffset;
            aux.posModel += modelOffset;
            vec3 viewOffset = (viewNormal * vec4(modelOffset, 1.0)).xyz;
            aux.posView += viewOffset;
            // Since we elevate the object, we need to take that into account
            // in the distance to ground
            pointGroundDistance += worldOffset;`:""}

      float groundRelative = applyHUDViewDependentPolygonOffset(pointGroundDistance, aux.absCosAngle, aux.posView);

      ${e.screenCenterOffsetUnitsEnabled!==vl.Screen?b`
            // Apply x/y in view space, but z in screen space (i.e. along posView direction)
            aux.posView += vec3(centerOffset.x, centerOffset.y, 0.0);

            // Same material all have same z != 0.0 condition so should not lead to
            // branch fragmentation and will save a normalization if it's not needed
            if (centerOffset.z != 0.0) {
              aux.posView -= normalize(aux.posView) * centerOffset.z;
            }
          `:""}

      vec4 posProj = proj * vec4(aux.posView, 1.0);

      ${e.screenCenterOffsetUnitsEnabled===vl.Screen?e.hasScreenSizePerspective?"float centerOffsetY = applyScreenSizePerspectiveScaleFactorFloat(centerOffset.y, perspectiveFactor);":"float centerOffsetY = centerOffset.y;":""}

      ${e.screenCenterOffsetUnitsEnabled===vl.Screen?"posProj.xy += vec2(centerOffset.x, centerOffsetY) * pixelRatio * 2.0 / viewport.zw * posProj.w;":""}

      // constant part of polygon offset emulation
      posProj.z -= groundRelative * polygonOffset * posProj.w;
      return posProj;
    }
  `),r.include(a6),r.code.add(b`bool testVisibilityHUD(vec4 posProj) {
vec4 posProjCenter = alignToPixelCenter(posProj, viewport.zw);
vec4 occlusionPixel = texture(hudVisibilityTexture, .5 + .5 * posProjCenter.xy / posProjCenter.w);
if (renderTransparentlyOccludedHUD > 0.5) {
return occlusionPixel.r * occlusionPixel.g > 0.0 && occlusionPixel.g * renderTransparentlyOccludedHUD < 1.0;
}
return occlusionPixel.r * occlusionPixel.g > 0.0 && occlusionPixel.g == 1.0;
}`)}(function(t){t[t.World=0]="World",t[t.Screen=1]="Screen",t[t.COUNT=2]="COUNT"})(vl||(vl={}));const gI=pn();function mSe(t,e,r,i,s,n){if(t.visible)if(t.boundingInfo){et(t.type===ss.Mesh);const o=e.tolerance;gSe(t.boundingInfo,r,i,o,s,n)}else{const o=t.indices.get(E.POSITION),a=t.vertexAttributes.get(E.POSITION);iP(r,i,0,o.length/3,o,a,void 0,s,n)}}const wst=C();function gSe(t,e,r,i,s,n){if(t==null)return;const o=_Se(e,r,wst);if(Ige(gI,t.bbMin),$ge(gI,t.bbMax),s?.applyToAabb(gI),SY(gI,e,o,i)){const{primitiveIndices:a,indices:l,position:c}=t,h=a?a.length:l.length/3;if(h>Est){const p=t.getChildren();if(p!==void 0){for(const f of p)gSe(f,e,r,i,s,n);return}}iP(e,r,0,h,l,c,a,s,n)}}const ySe=C();function iP(t,e,r,i,s,n,o,a,l){if(o)return xst(t,e,r,i,s,n,o,a,l);const{data:c,stride:h}=n,p=t[0],f=t[1],m=t[2],y=e[0]-p,_=e[1]-f,v=e[2]-m;for(let w=r,x=3*r;w<i;++w){let T=h*s[x++],S=c[T++],O=c[T++],A=c[T];T=h*s[x++];let I=c[T++],M=c[T++],k=c[T];T=h*s[x++];let L=c[T++],D=c[T++],U=c[T];a!=null&&([S,O,A]=a.applyToVertex(S,O,A,w),[I,M,k]=a.applyToVertex(I,M,k,w),[L,D,U]=a.applyToVertex(L,D,U,w));const X=I-S,W=M-O,G=k-A,Y=L-S,P=D-O,V=U-A,z=_*V-P*v,H=v*Y-V*y,Z=y*P-Y*_,J=X*z+W*H+G*Z;if(Math.abs(J)<=Number.EPSILON)continue;const re=p-S,ye=f-O,Ne=m-A,yt=re*z+ye*H+Ne*Z;if(J>0){if(yt<0||yt>J)continue}else if(yt>0||yt<J)continue;const Ot=ye*G-W*Ne,lt=Ne*X-G*re,_t=re*W-X*ye,_e=y*Ot+_*lt+v*_t;if(J>0){if(_e<0||yt+_e>J)continue}else if(_e>0||yt+_e<J)continue;const Ae=(Y*Ot+P*lt+V*_t)/J;Ae>=0&&l(Ae,TY(X,W,G,Y,P,V,ySe),w,!1)}}function xst(t,e,r,i,s,n,o,a,l){const{data:c,stride:h}=n,p=t[0],f=t[1],m=t[2],y=e[0]-p,_=e[1]-f,v=e[2]-m;for(let w=r;w<i;++w){const x=o[w];let T=3*x,S=h*s[T++],O=c[S++],A=c[S++],I=c[S];S=h*s[T++];let M=c[S++],k=c[S++],L=c[S];S=h*s[T];let D=c[S++],U=c[S++],X=c[S];a!=null&&([O,A,I]=a.applyToVertex(O,A,I,w),[M,k,L]=a.applyToVertex(M,k,L,w),[D,U,X]=a.applyToVertex(D,U,X,w));const W=M-O,G=k-A,Y=L-I,P=D-O,V=U-A,z=X-I,H=_*z-V*v,Z=v*P-z*y,J=y*V-P*_,re=W*H+G*Z+Y*J;if(Math.abs(re)<=Number.EPSILON)continue;const ye=p-O,Ne=f-A,yt=m-I,Ot=ye*H+Ne*Z+yt*J;if(re>0){if(Ot<0||Ot>re)continue}else if(Ot>0||Ot<re)continue;const lt=Ne*Y-G*yt,_t=yt*W-Y*ye,_e=ye*G-W*Ne,Ae=y*lt+_*_t+v*_e;if(re>0){if(Ae<0||Ot+Ae>re)continue}else if(Ae>0||Ot+Ae<re)continue;const xt=(P*lt+V*_t+z*_e)/re;xt>=0&&l(xt,TY(W,G,Y,P,V,z,ySe),x,!1)}}const lne=C(),cne=C();function TY(t,e,r,i,s,n,o){return se(lne,t,e,r),se(cne,i,s,n),at(o,lne,cne),me(o,o),o}function _Se(t,e,r){return se(r,1/(e[0]-t[0]),1/(e[1]-t[1]),1/(e[2]-t[2]))}function SY(t,e,r,i){return EY(t,e,r,i,1/0)}function EY(t,e,r,i,s){const n=(t[0]-i-e[0])*r[0],o=(t[3]+i-e[0])*r[0];let a=Math.min(n,o),l=Math.max(n,o);const c=(t[1]-i-e[1])*r[1],h=(t[4]+i-e[1])*r[1];if(l=Math.min(l,Math.max(c,h)),l<0||(a=Math.max(a,Math.min(c,h)),a>l))return!1;const p=(t[2]-i-e[2])*r[2],f=(t[5]+i-e[2])*r[2];return l=Math.min(l,Math.max(p,f)),!(l<0)&&(a=Math.max(a,Math.min(p,f)),!(a>l)&&a<s)}function vSe(t,e,r,i,s){let n=(r.screenLength||0)*t.pixelRatio;s!=null&&(n=hst(n,i,e,s));const o=n*Math.tan(.5*t.fovY)/(.5*t.fullHeight);return ge(o*e,r.minWorldLength||0,r.maxWorldLength!=null?r.maxWorldLength:1/0)}function bSe(t,e){const r=e?bSe(e):{};for(const i in t){let s=t[i];s&&s.forEach&&(s=Sst(s)),s==null&&i in r||(r[i]=s)}return r}function Tst(t,e){let r=!1;for(const i in e){const s=e[i];s!==void 0&&(Array.isArray(s)?t[i]===null?(t[i]=s.slice(),r=!0):oq(t[i],s)&&(r=!0):t[i]!==s&&(r=!0,t[i]=s))}return r}function Sst(t){const e=[];return t.forEach(r=>e.push(r)),e}const wSe={multiply:1,ignore:2,replace:3,tint:4},Est=1e3;let tv=class extends eP{constructor(e,r){super(),this.type=ss.Material,this.supportsEdges=!1,this._visible=!0,this._renderPriority=0,this._insertOrder=0,this._vertexAttributeLocations=br,this._pp0=Oe(0,0,1),this._pp1=Oe(0,0,0),this._parameters=bSe(e,r),this.validateParameters(this._parameters)}dispose(){}get parameters(){return this._parameters}update(e){return!1}setParameters(e,r=!0){Tst(this._parameters,e)&&(this.validateParameters(this._parameters),r&&this.parametersChanged())}validateParameters(e){}get visible(){return this._visible}set visible(e){e!==this._visible&&(this._visible=e,this.parametersChanged())}shouldRender(e){return this.isVisible()&&this.isVisibleForOutput(e.output)&&(this.renderOccluded&e.renderOccludedMask)!=0}isVisibleForOutput(e){return!0}get renderOccluded(){return this.parameters.renderOccluded}get renderPriority(){return this._renderPriority}set renderPriority(e){e!==this._renderPriority&&(this._renderPriority=e,this.parametersChanged())}get insertOrder(){return this._insertOrder}set insertOrder(e){e!==this._insertOrder&&(this._insertOrder=e,this.parametersChanged())}get vertexAttributeLocations(){return this._vertexAttributeLocations}isVisible(){return this._visible}parametersChanged(){this.repository!=null&&this.repository.materialChanged(this)}intersectDraped(e,r,i,s,n,o){return this._pp0[0]=this._pp1[0]=s[0],this._pp0[1]=this._pp1[1]=s[1],this.intersect(e,r,i,this._pp0,this._pp1,n)}},xSe=class extends mKe{constructor(e,r,i){super(r,i),this.camera=e}};var Mi;(function(t){t[t.None=0]="None",t[t.Occlude=1]="Occlude",t[t.Transparent=2]="Transparent",t[t.OccludeAndTransparent=4]="OccludeAndTransparent",t[t.OccludeAndTransparentStencil=8]="OccludeAndTransparentStencil",t[t.Opaque=16]="Opaque"})(Mi||(Mi={}));let CY=class extends ei{constructor(){super(...arguments),this.renderOccluded=Mi.Occlude}},TSe=class{constructor(){this.factor=new une,this.factorAlignment=new une}},une=class{constructor(){this.scale=0,this.factor=0,this.minPixelSize=0,this.paddingPixels=0}};function h$t(t,e,r,i,s=1){const n=r.typedBuffer,o=r.typedBufferStride,a=t.length;if(i*=o,s===1)for(let l=0;l<a;++l)n[i]=e[t[l]],i+=o;else for(let l=0;l<a;++l){const c=e[t[l]];for(let h=0;h<s;h++)n[i]=c,i+=o}}function hne(t,e,r,i){const s=r.typedBuffer,n=r.typedBufferStride,o=t.length;i*=n;for(let a=0;a<o;++a){const l=2*t[a];s[i]=e[l],s[i+1]=e[l+1],i+=n}}function SSe(t,e,r,i,s){const n=r.typedBuffer,o=r.typedBufferStride,a=t.length;if(i*=o,s==null||s===1)for(let l=0;l<a;++l){const c=3*t[l];n[i]=e[c],n[i+1]=e[c+1],n[i+2]=e[c+2],i+=o}else for(let l=0;l<a;++l){const c=3*t[l];for(let h=0;h<s;++h)n[i]=e[c],n[i+1]=e[c+1],n[i+2]=e[c+2],i+=o}}function I2(t,e,r,i,s=1){const n=r.typedBuffer,o=r.typedBufferStride,a=t.length;if(i*=o,s===1)for(let l=0;l<a;++l){const c=4*t[l];n[i]=e[c],n[i+1]=e[c+1],n[i+2]=e[c+2],n[i+3]=e[c+3],i+=o}else for(let l=0;l<a;++l){const c=4*t[l];for(let h=0;h<s;++h)n[i]=e[c],n[i+1]=e[c+1],n[i+2]=e[c+2],n[i+3]=e[c+3],i+=o}}function dne(t,e,r){const i=t.typedBuffer,s=t.typedBufferStride;e*=s;for(let n=0;n<r;++n)i[e]=0,i[e+1]=0,i[e+2]=0,i[e+3]=0,e+=s}function AY(t,e,r,i,s,n=1){if(!r)return void SSe(t,e,i,s,n);const o=i.typedBuffer,a=i.typedBufferStride,l=t.length,c=r[0],h=r[1],p=r[2],f=r[4],m=r[5],y=r[6],_=r[8],v=r[9],w=r[10],x=r[12],T=r[13],S=r[14];s*=a;let O=0,A=0,I=0;const M=u5(r)?k=>{O=e[k]+x,A=e[k+1]+T,I=e[k+2]+S}:k=>{const L=e[k],D=e[k+1],U=e[k+2];O=c*L+f*D+_*U+x,A=h*L+m*D+v*U+T,I=p*L+y*D+w*U+S};if(n===1)for(let k=0;k<l;++k)M(3*t[k]),o[s]=O,o[s+1]=A,o[s+2]=I,s+=a;else for(let k=0;k<l;++k){M(3*t[k]);for(let L=0;L<n;++L)o[s]=O,o[s+1]=A,o[s+2]=I,s+=a}}function OY(t,e,r,i,s,n=1){if(!r)return void SSe(t,e,i,s,n);const o=r,a=i.typedBuffer,l=i.typedBufferStride,c=t.length,h=o[0],p=o[1],f=o[2],m=o[4],y=o[5],_=o[6],v=o[8],w=o[9],x=o[10],T=!_Z(o),S=1e-6,O=1-S;s*=l;let A=0,I=0,M=0;const k=u5(o)?L=>{A=e[L],I=e[L+1],M=e[L+2]}:L=>{const D=e[L],U=e[L+1],X=e[L+2];A=h*D+m*U+v*X,I=p*D+y*U+w*X,M=f*D+_*U+x*X};if(n===1)if(T)for(let L=0;L<c;++L){k(3*t[L]);const D=A*A+I*I+M*M;if(D<O&&D>S){const U=1/Math.sqrt(D);a[s]=A*U,a[s+1]=I*U,a[s+2]=M*U}else a[s]=A,a[s+1]=I,a[s+2]=M;s+=l}else for(let L=0;L<c;++L)k(3*t[L]),a[s]=A,a[s+1]=I,a[s+2]=M,s+=l;else for(let L=0;L<c;++L){if(k(3*t[L]),T){const D=A*A+I*I+M*M;if(D<O&&D>S){const U=1/Math.sqrt(D);A*=U,I*=U,M*=U}}for(let D=0;D<n;++D)a[s]=A,a[s+1]=I,a[s+2]=M,s+=l}}function Cst(t,e,r,i,s,n=1){if(!r)return void I2(t,e,i,s,n);const o=r,a=i.typedBuffer,l=i.typedBufferStride,c=t.length,h=o[0],p=o[1],f=o[2],m=o[4],y=o[5],_=o[6],v=o[8],w=o[9],x=o[10],T=!_Z(o),S=1e-6,O=1-S;if(s*=l,n===1)for(let A=0;A<c;++A){const I=4*t[A],M=e[I],k=e[I+1],L=e[I+2],D=e[I+3];let U=h*M+m*k+v*L,X=p*M+y*k+w*L,W=f*M+_*k+x*L;if(T){const G=U*U+X*X+W*W;if(G<O&&G>S){const Y=1/Math.sqrt(G);U*=Y,X*=Y,W*=Y}}a[s]=U,a[s+1]=X,a[s+2]=W,a[s+3]=D,s+=l}else for(let A=0;A<c;++A){const I=4*t[A],M=e[I],k=e[I+1],L=e[I+2],D=e[I+3];let U=h*M+m*k+v*L,X=p*M+y*k+w*L,W=f*M+_*k+x*L;if(T){const G=U*U+X*X+W*W;if(G<O&&G>S){const Y=1/Math.sqrt(G);U*=Y,X*=Y,W*=Y}}for(let G=0;G<n;++G)a[s]=U,a[s+1]=X,a[s+2]=W,a[s+3]=D,s+=l}}function ESe(t,e,r,i,s,n=1){const o=i.typedBuffer,a=i.typedBufferStride,l=t.length;if(s*=a,r!==e.length||r!==4)if(n!==1)if(r!==4)for(let c=0;c<l;++c){const h=3*t[c];for(let p=0;p<n;++p)o[s]=e[h],o[s+1]=e[h+1],o[s+2]=e[h+2],o[s+3]=255,s+=a}else for(let c=0;c<l;++c){const h=4*t[c];for(let p=0;p<n;++p)o[s]=e[h],o[s+1]=e[h+1],o[s+2]=e[h+2],o[s+3]=e[h+3],s+=a}else{if(r===4){for(let c=0;c<l;++c){const h=4*t[c];o[s]=e[h],o[s+1]=e[h+1],o[s+2]=e[h+2],o[s+3]=e[h+3],s+=a}return}for(let c=0;c<l;++c){const h=3*t[c];o[s]=e[h],o[s+1]=e[h+1],o[s+2]=e[h+2],o[s+3]=255,s+=a}}else{o[s]=e[0],o[s+1]=e[1],o[s+2]=e[2],o[s+3]=e[3];const c=new Uint32Array(i.typedBuffer.buffer,i.start),h=a/4,p=c[s/=4];s+=h;const f=l*n;for(let m=1;m<f;++m)c[s]=p,s+=h}}function Ast(t,e,r,i){const s=r.typedBuffer,n=r.typedBufferStride,o=t.length,a=e[0];i*=n;for(let l=0;l<o;++l)s[i]=a,i+=n}function CSe(t,e,r,i,s=1){const n=e.typedBuffer,o=e.typedBufferStride;if(i*=o,s===1)for(let a=0;a<r;++a)n[i]=t[0],n[i+1]=t[1],n[i+2]=t[2],n[i+3]=t[3],i+=o;else for(let a=0;a<r;++a)for(let l=0;l<s;++l)n[i]=t[0],n[i+1]=t[1],n[i+2]=t[2],n[i+3]=t[3],i+=o}function ASe(t,e,r,i,s,n){for(const o of e.fields.keys()){const a=t.vertexAttributes.get(o),l=t.indices.get(o);if(a&&l)OSe(o,a,l,r,i,s,n);else if(o===E.OBJECTANDLAYERIDCOLOR&&t.objectAndLayerIdColor!=null){const c=t.indices.get(E.POSITION);if(et(!!c,`No buffer view for ${o}`),c){const h=c.length,p=s.getField(o,ha);CSe(t.objectAndLayerIdColor,p,h,n)}}}}function OSe(t,e,r,i,s,n,o){switch(t){case E.POSITION:{et(e.size===3);const a=n.getField(t,dn);et(!!a,`No buffer view for ${t}`),a&&AY(r,e.data,i,a,o);break}case E.NORMAL:{et(e.size===3);const a=n.getField(t,dn);et(!!a,`No buffer view for ${t}`),a&&OY(r,e.data,s,a,o);break}case E.NORMALCOMPRESSED:{et(e.size===2);const a=n.getField(t,KR);et(!!a,`No buffer view for ${t}`),a&&hne(r,e.data,a,o);break}case E.UV0:{et(e.size===2);const a=n.getField(t,ev);et(!!a,`No buffer view for ${t}`),a&&hne(r,e.data,a,o);break}case E.COLOR:case E.SYMBOLCOLOR:{const a=n.getField(t,ha);et(!!a,`No buffer view for ${t}`),et(e.size===3||e.size===4),!a||e.size!==3&&e.size!==4||ESe(r,e.data,e.size,a,o);break}case E.COLORFEATUREATTRIBUTE:{const a=n.getField(t,z5);et(!!a,`No buffer view for ${t}`),et(e.size===1),a&&e.size===1&&Ast(r,e.data,a,o);break}case E.TANGENT:{et(e.size===4);const a=n.getField(t,cp);et(!!a,`No buffer view for ${t}`),a&&Cst(r,e.data,s,a,o);break}case E.PROFILERIGHT:case E.PROFILEUP:case E.PROFILEVERTEXANDNORMAL:case E.FEATUREVALUE:{et(e.size===4);const a=n.getField(t,cp);et(!!a,`No buffer view for ${t}`),a&&I2(r,e.data,a,o)}}}function tR(t,e,r=0){const i=ge(t,0,Pst);for(let s=0;s<4;s++)e[r+s]=Math.floor(256*Mst(i*Ost[s]))}function RY(t,e=0){let r=0;for(let i=0;i<4;i++)r+=t[e+i]*Rst[i];return r}const Ost=[1,256,65536,16777216],Rst=[1/256,1/65536,1/16777216,1/4294967296],Pst=RY(new Uint8ClampedArray([255,255,255,255]));function Mst(t){return t-Math.floor(t)}async function Gg(t,e){const{data:r}=await qt(t,{responseType:"image",...e});return r}function Ist(){if(Z8==null){const t=e=>kr(`esri/libs/basisu/${e}`);Z8=ae(()=>import("./basis_transcoder-94f9513a.js"),[],import.meta.url).then(e=>e.b).then(({default:e})=>e({locateFile:t}).then(r=>(r.initializeBasis(),delete r.then,r)))}return Z8}let Z8;var nb;(function(t){t[t.ETC1_RGB=0]="ETC1_RGB",t[t.ETC2_RGBA=1]="ETC2_RGBA",t[t.BC1_RGB=2]="BC1_RGB",t[t.BC3_RGBA=3]="BC3_RGBA",t[t.BC4_R=4]="BC4_R",t[t.BC5_RG=5]="BC5_RG",t[t.BC7_M6_RGB=6]="BC7_M6_RGB",t[t.BC7_M5_RGBA=7]="BC7_M5_RGBA",t[t.PVRTC1_4_RGB=8]="PVRTC1_4_RGB",t[t.PVRTC1_4_RGBA=9]="PVRTC1_4_RGBA",t[t.ASTC_4x4_RGBA=10]="ASTC_4x4_RGBA",t[t.ATC_RGB=11]="ATC_RGB",t[t.ATC_RGBA=12]="ATC_RGBA",t[t.FXT1_RGB=17]="FXT1_RGB",t[t.PVRTC2_4_RGB=18]="PVRTC2_4_RGB",t[t.PVRTC2_4_RGBA=19]="PVRTC2_4_RGBA",t[t.ETC2_EAC_R11=20]="ETC2_EAC_R11",t[t.ETC2_EAC_RG11=21]="ETC2_EAC_RG11",t[t.RGBA32=13]="RGBA32",t[t.RGB565=14]="RGB565",t[t.BGR565=15]="BGR565",t[t.RGBA4444=16]="RGBA4444"})(nb||(nb={}));let ep=null,yI=null;async function RSe(){return yI==null&&(yI=Ist(),ep=await yI),yI}function $st(t,e){if(ep==null)return t.byteLength;const r=new ep.BasisFile(new Uint8Array(t)),i=MSe(r)?PSe(r.getNumLevels(0),r.getHasAlpha(),r.getImageWidth(0,0),r.getImageHeight(0,0),e):0;return r.close(),r.delete(),i}function Lst(t,e){if(ep==null)return t.byteLength;const r=new ep.KTX2File(new Uint8Array(t)),i=ISe(r)?PSe(r.getLevels(),r.getHasAlpha(),r.getWidth(),r.getHeight(),e):0;return r.close(),r.delete(),i}function PSe(t,e,r,i,s){const n=PX(e?us.COMPRESSED_RGBA8_ETC2_EAC:us.COMPRESSED_RGB8_ETC2),o=s&&t>1?(4**t-1)/(3*4**(t-1)):1;return Math.ceil(r*i*n*o)}function MSe(t){return t.getNumImages()>=1&&!t.isUASTC()}function ISe(t){return t.getFaces()>=1&&t.isETC1S()}async function Dst(t,e,r){ep==null&&(ep=await RSe());const i=new ep.BasisFile(new Uint8Array(r));if(!MSe(i))return null;i.startTranscoding();const s=$Se(t,e,i.getNumLevels(0),i.getHasAlpha(),i.getImageWidth(0,0),i.getImageHeight(0,0),(n,o)=>i.getImageTranscodedSizeInBytes(0,n,o),(n,o,a)=>i.transcodeImage(a,0,n,o,0,0));return i.close(),i.delete(),s}async function Nst(t,e,r){ep==null&&(ep=await RSe());const i=new ep.KTX2File(new Uint8Array(r));if(!ISe(i))return null;i.startTranscoding();const s=$Se(t,e,i.getLevels(),i.getHasAlpha(),i.getWidth(),i.getHeight(),(n,o)=>i.getImageTranscodedSizeInBytes(n,0,0,o),(n,o,a)=>i.transcodeImage(a,n,0,0,o,0,-1,-1));return i.close(),i.delete(),s}function $Se(t,e,r,i,s,n,o,a){const{compressedTextureETC:l,compressedTextureS3TC:c}=t.capabilities,[h,p]=l?i?[nb.ETC2_RGBA,us.COMPRESSED_RGBA8_ETC2_EAC]:[nb.ETC1_RGB,us.COMPRESSED_RGB8_ETC2]:c?i?[nb.BC3_RGBA,us.COMPRESSED_RGBA_S3TC_DXT5_EXT]:[nb.BC1_RGB,us.COMPRESSED_RGB_S3TC_DXT1_EXT]:[nb.RGBA32,Tt.RGBA],f=e.hasMipmap?r:Math.min(1,r),m=[];for(let y=0;y<f;y++)m.push(new Uint8Array(o(y,h))),a(y,h,m[y]);return e.internalFormat=p,e.hasMipmap=m.length>1,e.samplingMode=e.hasMipmap?Ct.LINEAR_MIPMAP_LINEAR:Ct.LINEAR,e.width=s,e.height=n,new Et(t,e,{type:"compressed",levels:m})}const _I=Q.getLogger("esri.views.3d.webgl-engine.lib.DDSUtil"),Fst=542327876,Ust=131072,kst=4;function PY(t){return t.charCodeAt(0)+(t.charCodeAt(1)<<8)+(t.charCodeAt(2)<<16)+(t.charCodeAt(3)<<24)}function Vst(t){return String.fromCharCode(255&t,t>>8&255,t>>16&255,t>>24&255)}const zst=PY("DXT1"),Bst=PY("DXT3"),Gst=PY("DXT5"),jst=31,Hst=0,qst=1,Wst=2,Zst=3,Xst=4,Yst=7,Jst=20,Qst=21;function Kst(t,e,r){const i=ent(r,e.hasMipmap??!1);if(i==null)throw new Error("DDS texture data is null");const{textureData:s,internalFormat:n,width:o,height:a}=i;return e.samplingMode=s.levels.length>1?Ct.LINEAR_MIPMAP_LINEAR:Ct.LINEAR,e.hasMipmap=s.levels.length>1,e.internalFormat=n,e.width=o,e.height=a,new Et(t,e,s)}function ent(t,e){const r=new Int32Array(t,0,jst);if(r[Hst]!==Fst)return _I.error("Invalid magic number in DDS header"),null;if(!(r[Jst]&kst))return _I.error("Unsupported format, must contain a FourCC code"),null;const i=r[Qst];let s,n;switch(i){case zst:s=8,n=us.COMPRESSED_RGB_S3TC_DXT1_EXT;break;case Bst:s=16,n=us.COMPRESSED_RGBA_S3TC_DXT3_EXT;break;case Gst:s=16,n=us.COMPRESSED_RGBA_S3TC_DXT5_EXT;break;default:return _I.error("Unsupported FourCC code:",Vst(i)),null}let o=1,a=r[Xst],l=r[Zst];!(3&a)&&!(3&l)||(_I.warn("Rounding up compressed texture size to nearest multiple of 4."),a=a+3&-4,l=l+3&-4);const c=a,h=l;let p,f;r[Wst]&Ust&&e!==!1&&(o=Math.max(1,r[Yst]));let m=r[qst]+4;const y=[];for(let _=0;_<o;++_)f=(a+3>>2)*(l+3>>2)*s,p=new Uint8Array(t,m,f),y.push(p),m+=f,a=Math.max(1,a>>1),l=Math.max(1,l>>1);return{textureData:{type:"compressed",levels:y},internalFormat:n,width:c,height:h}}let zw=class extends eP{constructor(e,r){super(),this._data=e,this.type=ss.Texture,this._glTexture=null,this._loadingPromise=null,this._loadingController=null,this.events=new os,this.parameters=r||{},this.parameters.mipmap=this.parameters.mipmap!==!1,this.parameters.noUnpackFlip=this.parameters.noUnpackFlip||!1,this.parameters.preMultiplyAlpha=this.parameters.preMultiplyAlpha||!1,this.parameters.wrap=this.parameters.wrap||{s:$t.REPEAT,t:$t.REPEAT},this._startPreload(e)}_startPreload(e){e!=null&&(e instanceof HTMLVideoElement?this._startPreloadVideoElement(e):e instanceof HTMLImageElement&&this._startPreloadImageElement(e))}_startPreloadVideoElement(e){if(!(x_(e.src)||e.preload==="auto"&&e.crossOrigin)){e.preload="auto",e.crossOrigin="anonymous";const r=!e.paused;if(e.src=e.src,r&&e.autoplay){const i=()=>{e.removeEventListener("canplay",i),e.play()};e.addEventListener("canplay",i)}}}_startPreloadImageElement(e){Jf(e.src)||x_(e.src)||e.crossOrigin||(e.crossOrigin="anonymous",e.src=e.src)}dispose(){this._data=void 0}_createDescriptor(e){const r=new vr;return r.wrapMode=this.parameters.wrap??$t.REPEAT,r.flipped=!this.parameters.noUnpackFlip,r.samplingMode=this.parameters.mipmap?Ct.LINEAR_MIPMAP_LINEAR:Ct.LINEAR,r.hasMipmap=!!this.parameters.mipmap,r.preMultiplyAlpha=!!this.parameters.preMultiplyAlpha,r.maxAnisotropy=this.parameters.maxAnisotropy??(this.parameters.mipmap?e.parameters.maxMaxAnisotropy:1),r}get glTexture(){return this._glTexture}get memoryEstimate(){return this._glTexture?.gpuMemoryUsage||tnt(this._data,this.parameters)}load(e){if(this._glTexture!=null)return this._glTexture;if(this._loadingPromise)return this._loadingPromise;const r=this._data;return r==null?(this._glTexture=new Et(e,this._createDescriptor(e),null),this._glTexture):typeof r=="string"?this._loadFromURL(e,r):r instanceof Image?this._loadFromImageElement(e,r):r instanceof HTMLVideoElement?this._loadFromVideoElement(e,r):r instanceof ImageData||r instanceof HTMLCanvasElement?this._loadFromImage(e,r):(DC(r)||W0(r))&&this.parameters.encoding===xg.DDS_ENCODING?(this._data=void 0,this._loadFromDDSData(e,r)):(DC(r)||W0(r))&&this.parameters.encoding===xg.KTX2_ENCODING?(this._data=void 0,this._loadFromKTX2(e,r)):(DC(r)||W0(r))&&this.parameters.encoding===xg.BASIS_ENCODING?(this._data=void 0,this._loadFromBasis(e,r)):W0(r)?this._loadFromPixelData(e,r):DC(r)?this._loadFromPixelData(e,new Uint8Array(r)):null}get requiresFrameUpdates(){return this._data instanceof HTMLVideoElement}frameUpdate(e){return this._data instanceof HTMLVideoElement&&this._glTexture!=null?this._data.readyState<X3.HAVE_CURRENT_DATA||e===this._data.currentTime?e:(this._glTexture.setData(this._data),this._glTexture.descriptor.hasMipmap&&this._glTexture.generateMipmap(),this.parameters.updateCallback&&this.parameters.updateCallback(),this._data.currentTime):e}_loadFromDDSData(e,r){return this._glTexture=Kst(e,this._createDescriptor(e),r),this._glTexture}_loadFromKTX2(e,r){return this._loadAsync(()=>Nst(e,this._createDescriptor(e),r).then(i=>(this._glTexture=i,i)))}_loadFromBasis(e,r){return this._loadAsync(()=>Dst(e,this._createDescriptor(e),r).then(i=>(this._glTexture=i,i)))}_loadFromPixelData(e,r){et(this.parameters.width>0&&this.parameters.height>0);const i=this._createDescriptor(e);return i.pixelFormat=this.parameters.components===1?Tt.LUMINANCE:this.parameters.components===3?Tt.RGB:Tt.RGBA,i.width=this.parameters.width??0,i.height=this.parameters.height??0,this._glTexture=new Et(e,i,r),this._glTexture}_loadFromURL(e,r){return this._loadAsync(async i=>{const s=await Gg(r,{signal:i});return Xt(i),this._loadFromImage(e,s)})}_loadFromImageElement(e,r){return r.complete?this._loadFromImage(e,r):this._loadAsync(async i=>{const s=await Xde(r,r.src,!1,i);return Xt(i),this._loadFromImage(e,s)})}_loadFromVideoElement(e,r){return r.readyState>=X3.HAVE_CURRENT_DATA?this._loadFromImage(e,r):this._loadFromVideoElementAsync(e,r)}_loadFromVideoElementAsync(e,r){return this._loadAsync(i=>new Promise((s,n)=>{const o=()=>{r.removeEventListener("loadeddata",a),r.removeEventListener("error",l),Ii(c)},a=()=>{r.readyState>=X3.HAVE_CURRENT_DATA&&(o(),s(this._loadFromImage(e,r)))},l=h=>{o(),n(h||new F("Failed to load video"))};r.addEventListener("loadeddata",a),r.addEventListener("error",l);const c=nn(i,()=>l(Dr()))}))}_loadFromImage(e,r){const i=LSe(r);this.parameters.width=i.width,this.parameters.height=i.height;const s=this._createDescriptor(e);return s.pixelFormat=this.parameters.components===3?Tt.RGB:Tt.RGBA,s.width=i.width,s.height=i.height,this._glTexture=new Et(e,s,r),this._glTexture}_loadAsync(e){const r=new AbortController;this._loadingController=r;const i=e(r.signal);this._loadingPromise=i;const s=()=>{this._loadingController===r&&(this._loadingController=null),this._loadingPromise===i&&(this._loadingPromise=null)};return i.then(s,s),i}unload(){if(this._glTexture=Ue(this._glTexture),this._loadingController!=null){const e=this._loadingController;this._loadingController=null,this._loadingPromise=null,e.abort()}this.events.emit("unloaded")}};function tnt(t,e){if(t==null)return 0;if(DC(t)||W0(t))return e.encoding===xg.KTX2_ENCODING?Lst(t,!!e.mipmap):e.encoding===xg.BASIS_ENCODING?$st(t,!!e.mipmap):t.byteLength;const{width:r,height:i}=t instanceof Image||t instanceof ImageData||t instanceof HTMLCanvasElement||t instanceof HTMLVideoElement?LSe(t):e;return(e.mipmap?4/3:1)*r*i*(e.components||4)||0}function LSe(t){return t instanceof HTMLVideoElement?{width:t.videoWidth,height:t.videoHeight}:t}var X3;(function(t){t[t.HAVE_NOTHING=0]="HAVE_NOTHING",t[t.HAVE_METADATA=1]="HAVE_METADATA",t[t.HAVE_CURRENT_DATA=2]="HAVE_CURRENT_DATA",t[t.HAVE_FUTURE_DATA=3]="HAVE_FUTURE_DATA",t[t.HAVE_ENOUGH_DATA=4]="HAVE_ENOUGH_DATA"})(X3||(X3={}));const rR=128,MY=.5;function rnt(t,e=rR,r=e*MY,i=0){const s=DSe(t,e,r,i);return new zw(s,{mipmap:!1,wrap:{s:$t.CLAMP_TO_EDGE,t:$t.CLAMP_TO_EDGE},width:e,height:e,components:4,noUnpackFlip:!0})}function DSe(t,e=rR,r=e*MY,i=0){switch(t){case"circle":default:return int(e,r);case"square":return snt(e,r);case"cross":return ont(e,r,i);case"x":return ant(e,r,i);case"kite":return nnt(e,r);case"triangle":return lnt(e,r);case"arrow":return cnt(e,r)}}function int(t,e){const r=t/2-.5;return sP(t,USe(r,r,e/2))}function snt(t,e){return NSe(t,e,!1)}function nnt(t,e){return NSe(t,e,!0)}function ont(t,e,r=0){return FSe(t,e,!1,r)}function ant(t,e,r=0){return FSe(t,e,!0,r)}function lnt(t,e){return sP(t,kSe(t/2,e,e/2))}function cnt(t,e){const r=e,i=e/2,s=t/2,n=.8*r,o=USe(s,(t-e)/2-n,Math.sqrt(n*n+i*i)),a=kSe(s,r,i);return sP(t,(l,c)=>Math.max(a(l,c),-o(l,c)))}function NSe(t,e,r){return r&&(e/=Math.SQRT2),sP(t,(i,s)=>{let n=i-.5*t+.25,o=.5*t-s-.75;if(r){const a=(n+o)/Math.SQRT2;o=(o-n)/Math.SQRT2,n=a}return Math.max(Math.abs(n),Math.abs(o))-.5*e})}function FSe(t,e,r,i=0){e-=i,r&&(e*=Math.SQRT2);const s=.5*e;return sP(t,(n,o)=>{let a,l=n-.5*t,c=.5*t-o-1;if(r){const h=(l+c)/Math.SQRT2;c=(c-l)/Math.SQRT2,l=h}return l=Math.abs(l),c=Math.abs(c),a=l>c?l>s?Math.sqrt((l-s)*(l-s)+c*c):c:c>s?Math.sqrt(l*l+(c-s)*(c-s)):l,a-=i/2,a})}function USe(t,e,r){return(i,s)=>{const n=i-t,o=s-e;return Math.sqrt(n*n+o*o)-r}}function kSe(t,e,r){const i=Math.sqrt(e*e+r*r);return(s,n)=>{const o=Math.abs(s-t)-r,a=n-t+e/2+.75,l=(e*o+r*a)/i,c=-a;return Math.max(l,c)}}function sP(t,e){const r=new Uint8Array(4*t*t);for(let i=0;i<t;i++)for(let s=0;s<t;s++){const n=s+t*i;let o=e(s,i);o=o/t+.5,tR(o,r,4*n)}return r}let p$t=class extends ei{constructor(e){super(),this.slicePlaneLocalOrigin=e}};function unt(t,e){VSe(t,e,new Ft("slicePlaneOrigin",(r,i)=>jSe(e,r,i)),new Ft("slicePlaneBasis1",(r,i)=>A4(e,r,i,i.slicePlane?.basis1)),new Ft("slicePlaneBasis2",(r,i)=>A4(e,r,i,i.slicePlane?.basis2)))}function ps(t,e){VSe(t,e,new cu("slicePlaneOrigin",(r,i)=>jSe(e,r,i)),new cu("slicePlaneBasis1",(r,i)=>A4(e,r,i,i.slicePlane?.basis1)),new cu("slicePlaneBasis2",(r,i)=>A4(e,r,i,i.slicePlane?.basis2)))}function VSe(t,e,...r){if(!e.hasSlicePlane){const o=b`#define rejectBySlice(_pos_) false
#define discardBySlice(_pos_) {}
#define highlightSlice(_color_, _pos_) (_color_)`;return e.hasSliceInVertexProgram&&t.vertex.code.add(o),void t.fragment.code.add(o)}e.hasSliceInVertexProgram&&t.vertex.uniforms.add(...r),t.fragment.uniforms.add(...r);const i=b`struct SliceFactors {
float front;
float side0;
float side1;
float side2;
float side3;
};
SliceFactors calculateSliceFactors(vec3 pos) {
vec3 rel = pos - slicePlaneOrigin;
vec3 slicePlaneNormal = -cross(slicePlaneBasis1, slicePlaneBasis2);
float slicePlaneW = -dot(slicePlaneNormal, slicePlaneOrigin);
float basis1Len2 = dot(slicePlaneBasis1, slicePlaneBasis1);
float basis2Len2 = dot(slicePlaneBasis2, slicePlaneBasis2);
float basis1Dot = dot(slicePlaneBasis1, rel);
float basis2Dot = dot(slicePlaneBasis2, rel);
return SliceFactors(
dot(slicePlaneNormal, pos) + slicePlaneW,
-basis1Dot - basis1Len2,
basis1Dot - basis1Len2,
-basis2Dot - basis2Len2,
basis2Dot - basis2Len2
);
}
bool sliceByFactors(SliceFactors factors) {
return factors.front < 0.0
&& factors.side0 < 0.0
&& factors.side1 < 0.0
&& factors.side2 < 0.0
&& factors.side3 < 0.0;
}
bool sliceEnabled() {
return dot(slicePlaneBasis1, slicePlaneBasis1) != 0.0;
}
bool sliceByPlane(vec3 pos) {
return sliceEnabled() && sliceByFactors(calculateSliceFactors(pos));
}
#define rejectBySlice(_pos_) sliceByPlane(_pos_)
#define discardBySlice(_pos_) { if (sliceByPlane(_pos_)) discard; }`,s=b`vec4 applySliceHighlight(vec4 color, vec3 pos) {
SliceFactors factors = calculateSliceFactors(pos);
const float HIGHLIGHT_WIDTH = 1.0;
const vec4 HIGHLIGHT_COLOR = vec4(0.0, 0.0, 0.0, 0.3);
factors.front /= (2.0 * HIGHLIGHT_WIDTH) * fwidth(factors.front);
factors.side0 /= (2.0 * HIGHLIGHT_WIDTH) * fwidth(factors.side0);
factors.side1 /= (2.0 * HIGHLIGHT_WIDTH) * fwidth(factors.side1);
factors.side2 /= (2.0 * HIGHLIGHT_WIDTH) * fwidth(factors.side2);
factors.side3 /= (2.0 * HIGHLIGHT_WIDTH) * fwidth(factors.side3);
if (sliceByFactors(factors)) {
return color;
}
float highlightFactor = (1.0 - step(0.5, factors.front))
* (1.0 - step(0.5, factors.side0))
* (1.0 - step(0.5, factors.side1))
* (1.0 - step(0.5, factors.side2))
* (1.0 - step(0.5, factors.side3));
return mix(color, vec4(HIGHLIGHT_COLOR.rgb, color.a), highlightFactor * HIGHLIGHT_COLOR.a);
}`,n=e.hasSliceHighlight?b`
        ${s}
        #define highlightSlice(_color_, _pos_) (sliceEnabled() ? applySliceHighlight(_color_, _pos_) : (_color_))
      `:b`#define highlightSlice(_color_, _pos_) (_color_)`;e.hasSliceInVertexProgram&&t.vertex.code.add(i),t.fragment.code.add(i),t.fragment.code.add(n)}function zSe(t,e,r){return t.instancedDoublePrecision?se(hnt,r.camera.viewInverseTransposeMatrix[3],r.camera.viewInverseTransposeMatrix[7],r.camera.viewInverseTransposeMatrix[11]):e.slicePlaneLocalOrigin}function BSe(t,e){return t!=null?he(O4,e.origin,t):e.origin}function GSe(t,e,r){return t.hasSliceTranslatedView?e!=null?Al(dnt,r.camera.viewMatrix,e):r.camera.viewMatrix:null}function jSe(t,e,r){if(r.slicePlane==null)return ja;const i=zSe(t,e,r),s=BSe(i,r.slicePlane),n=GSe(t,i,r);return n!=null?$e(O4,s,n):s}function A4(t,e,r,i){if(i==null||r.slicePlane==null)return ja;const s=zSe(t,e,r),n=BSe(s,r.slicePlane),o=GSe(t,s,r);return o!=null?(ce(cC,i,n),$e(O4,n,o),$e(cC,cC,o),he(cC,cC,O4)):i}const hnt=C(),O4=C(),cC=C(),dnt=be();function nP(t,e){const r=e.output===N.ObjectAndLayerIdColor,i=e.objectAndLayerIdColorInstanced;r&&(t.varyings.add("objectAndLayerIdColorVarying","vec4"),i?t.attributes.add(E.INSTANCEOBJECTANDLAYERIDCOLOR,"vec4"):t.attributes.add(E.OBJECTANDLAYERIDCOLOR,"vec4")),t.vertex.code.add(b`
     void forwardObjectAndLayerIdColor() {
      ${r?i?b`objectAndLayerIdColorVarying = instanceObjectAndLayerIdColor * 0.003921568627451;`:b`objectAndLayerIdColorVarying = objectAndLayerIdColor * 0.003921568627451;`:b``} }`),t.fragment.code.add(b`
      void outputObjectAndLayerIdColor() {
        ${r?b`fragColor = objectAndLayerIdColorVarying;`:b``} }`)}function pnt(t,e){const{vertex:r,fragment:i}=t;r.include(a6),e.hasMultipassGeometry&&r.include(qwe),e.hasMultipassTerrain&&t.varyings.add("depth","float"),r.code.add(b`
  void main(void) {
    vec4 posProjCenter;
    if (dot(position, position) > 0.0) {
      // Render single point to center of the pixel to avoid subpixel
      // filtering to affect the marker color
      ProjectHUDAux projectAux;
      vec4 posProj = projectPositionHUD(projectAux);
      posProjCenter = alignToPixelCenter(posProj, viewport.zw);

      ${e.hasMultipassGeometry?b`
        // Don't draw vertices behind geometry
        if(geometryDepthTest(.5 + .5 * posProjCenter.xy / posProjCenter.w, projectAux.posView.z)){
          posProjCenter = vec4(1e038, 1e038, 1e038, 1.0);
        }`:""}

      ${e.hasMultipassTerrain?"depth = projectAux.posView.z;":""}
      vec3 vpos = projectAux.posModel;
      if (rejectBySlice(vpos)) {
        // Project out of clip space
        posProjCenter = vec4(1e038, 1e038, 1e038, 1.0);
      }

    } else {
      // Project out of clip space
      posProjCenter = vec4(1e038, 1e038, 1e038, 1.0);
    }

    gl_Position = posProjCenter;
    gl_PointSize = 1.0;
  }
  `),e.hasMultipassTerrain&&i.include(_u),e.hasMultipassTerrain&&i.uniforms.add(new Je("terrainDepthTexture",(s,n)=>n.multipassTerrain.linearDepthTexture),new Sr("nearFar",(s,n)=>n.camera.nearFar)),i.include(Ec),i.code.add(b`
  void main() {
    fragColor = vec4(1);
    ${e.hasMultipassTerrain?b`
          // Read the rgba data from the texture linear depth
          vec4 terrainDepthData = texelFetch(terrainDepthTexture, ivec2(gl_FragCoord.xy), 0);

          float terrainDepth = linearDepthFromFloat(rgba2float(terrainDepthData), nearFar);

          // If HUD vertex is behind terrain and the terrain depth is not the initialize value (e.g. we are not looking at the sky)
          // Mark the HUD vertex as occluded by transparent terrain
          if(depth < terrainDepth && terrainDepthData != vec4(0,0,0,1)){
            fragColor.g = 0.5;
          }`:""}
  }
  `)}const fnt=Lt(1,1,0,1),HSe=Lt(1,0,1,1);function ny(t){t.fragment.uniforms.add(new Je("depthTexture",(e,r)=>r.highlightDepthTexture)),t.fragment.constants.add("occludedHighlightFlag","vec4",fnt).add("unoccludedHighlightFlag","vec4",HSe),t.fragment.code.add(b`void outputHighlight() {
float sceneDepth = float(texelFetch(depthTexture, ivec2(gl_FragCoord.xy), 0).x);
if (gl_FragCoord.z > sceneDepth + 5e-7) {
fragColor = occludedHighlightFlag;
} else {
fragColor = unoccludedHighlightFlag;
}
}`)}let qSe=class extends as{constructor(e,r,i){super(e,"vec4",Qr.Pass,(s,n,o)=>s.setUniform4fv(e,r(n,o)),i)}},bl=class extends as{constructor(e,r,i){super(e,"float",Qr.Pass,(s,n,o)=>s.setUniform1fv(e,r(n,o)),i)}};var sa,pne;(function(t){t[t.Undefined=0]="Undefined",t[t.DefinedSize=1]="DefinedSize",t[t.DefinedScale=2]="DefinedScale"})(sa||(sa={})),function(t){t[t.Undefined=0]="Undefined",t[t.DefinedAngle=1]="DefinedAngle"}(pne||(pne={}));let IY=class{constructor(e){this.field=e}},mnt=class extends IY{constructor(e){super(e),this.minSize=[0,0,0],this.maxSize=[0,0,0],this.offset=[0,0,0],this.factor=[0,0,0],this.type=[sa.Undefined,sa.Undefined,sa.Undefined]}},gnt=class extends IY{constructor(e){super(e),this.colors=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],this.values=[0,0,0,0,0,0,0,0]}},ynt=class extends IY{constructor(e){super(e),this.values=[0,0,0,0,0,0,0,0],this.opacityValues=[0,0,0,0,0,0,0,0]}},_nt=class{};function uC(t){return t!=null}function bx(t){return typeof t=="number"}function l6(t){return typeof t=="string"}function vnt(t){return t==null||l6(t)}function on(t,e){t&&t.push(e)}function bnt(t,e,r,i=be()){const s=t||0,n=e||0,o=r||0;return s!==0&&h2(i,i,-s/180*Math.PI),n!==0&&u2(i,i,n/180*Math.PI),o!==0&&l5(i,i,o/180*Math.PI),i}function Iy(t,e,r,i,s){const n=t.minSize,o=t.maxSize;if(t.expression)return on(s,"Could not convert size info: expression not supported"),!1;if(t.useSymbolValue){const a=i.symbolSize[r];return e.minSize[r]=a,e.maxSize[r]=a,e.offset[r]=e.minSize[r],e.factor[r]=0,e.type[r]=sa.DefinedSize,!0}if(uC(t.field))return uC(t.stops)?t.stops.length===2&&bx(t.stops[0].size)&&bx(t.stops[1].size)?(fne(t.stops[0].size,t.stops[1].size,t.stops[0].value,t.stops[1].value,e,r),e.type[r]=sa.DefinedSize,!0):(on(s,"Could not convert size info: stops only supported with 2 elements"),!1):bx(n)&&bx(o)&&uC(t.minDataValue)&&uC(t.maxDataValue)?(fne(n,o,t.minDataValue,t.maxDataValue,e,r),e.type[r]=sa.DefinedSize,!0):t.valueUnit==="unknown"?(on(s,"Could not convert size info: proportional size not supported"),!1):c2[t.valueUnit]!=null?(e.minSize[r]=-1/0,e.maxSize[r]=1/0,e.offset[r]=0,e.factor[r]=1/c2[t.valueUnit],e.type[r]=sa.DefinedSize,!0):(on(s,"Could not convert size info: scale-dependent size not supported"),!1);if(!uC(t.field)){if(t.stops&&t.stops[0]&&bx(t.stops[0].size))return e.minSize[r]=t.stops[0].size,e.maxSize[r]=t.stops[0].size,e.offset[r]=e.minSize[r],e.factor[r]=0,e.type[r]=sa.DefinedSize,!0;if(bx(n))return e.minSize[r]=n,e.maxSize[r]=n,e.offset[r]=n,e.factor[r]=0,e.type[r]=sa.DefinedSize,!0}return on(s,"Could not convert size info: unsupported variant of sizeInfo"),!1}function fne(t,e,r,i,s,n){const o=Math.abs(i-r)>0?(e-t)/(i-r):0;s.minSize[n]=o>0?t:e,s.maxSize[n]=o>0?e:t,s.offset[n]=t-r*o,s.factor[n]=o}function wnt(t,e,r,i){if(t.normalizationField||t.valueRepresentation)return on(i,"Could not convert size info: unsupported property"),null;if(!vnt(t.field))return on(i,"Could not convert size info: field is not a string"),null;if(e.size){if(t.field)if(e.size.field){if(t.field!==e.size.field)return on(i,"Could not convert size info: multiple fields in use"),null}else e.size.field=t.field}else e.size=new mnt(t.field);let s;switch(t.axis){case"width":return s=Iy(t,e.size,0,r,i),s?e:null;case"height":return s=Iy(t,e.size,2,r,i),s?e:null;case"depth":return s=Iy(t,e.size,1,r,i),s?e:null;case"width-and-depth":return s=Iy(t,e.size,0,r,i),s&&Iy(t,e.size,1,r,i),s?e:null;case null:case void 0:case"all":return s=Iy(t,e.size,0,r,i),s=s&&Iy(t,e.size,1,r,i),s=s&&Iy(t,e.size,2,r,i),s?e:null;default:return on(i,`Could not convert size info: unknown axis "${t.axis}""`),null}}function xnt(t,e,r){for(let s=0;s<3;++s){let n=e.unitInMeters;t.type[s]===sa.DefinedSize&&(n*=e.modelSize[s],t.type[s]=sa.DefinedScale),t.minSize[s]=t.minSize[s]/n,t.maxSize[s]=t.maxSize[s]/n,t.offset[s]=t.offset[s]/n,t.factor[s]=t.factor[s]/n}let i;if(t.type[0]!==sa.Undefined)i=0;else if(t.type[1]!==sa.Undefined)i=1;else{if(t.type[2]===sa.Undefined)return on(r,"No size axis contains a valid size or scale"),!1;i=2}for(let s=0;s<3;++s)t.type[s]===sa.Undefined&&(t.minSize[s]=t.minSize[i],t.maxSize[s]=t.maxSize[i],t.offset[s]=t.offset[i],t.factor[s]=t.factor[i],t.type[s]=t.type[i]);return!0}function mne(t,e,r){t[4*e]=r.r/255,t[4*e+1]=r.g/255,t[4*e+2]=r.b/255,t[4*e+3]=r.a}function Tnt(t,e,r){if(t.normalizationField)return on(r,"Could not convert color info: unsupported property"),null;if(l6(t.field)){if(!t.stops)return on(r,"Could not convert color info: missing stops or colors"),null;{if(t.stops.length>8)return on(r,"Could not convert color info: too many color stops"),null;e.color=new gnt(t.field);const i=t.stops;for(let s=0;s<8;++s){const n=i[Math.min(s,i.length-1)];e.color.values[s]=n.value,mne(e.color.colors,s,n.color)}}}else{if(!(t.stops&&t.stops.length>=0))return on(r,"Could not convert color info: no field and no colors/stops"),null;{const i=t.stops&&t.stops.length>=0&&t.stops[0].color;e.color={field:null,values:[0,0,0,0,0,0,0,0],colors:[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]};for(let s=0;s<8;s++)e.color.values[s]=1/0,mne(e.color.colors,s,i)}}return e}function Snt(t,e,r){if(t.normalizationField)return on(r,"Could not convert opacity info: unsupported property"),null;if(l6(t.field)){if(!t.stops)return on(r,"Could not convert opacity info: missing stops or opacities"),null;{if(t.stops.length>8)return on(r,"Could not convert opacity info: too many opacity stops"),null;e.opacity=new ynt(t.field);const i=t.stops;for(let s=0;s<8;++s){const n=i[Math.min(s,i.length-1)];e.opacity.values[s]=n.value,e.opacity.opacityValues[s]=n.opacity}}}else{if(!(t.stops&&t.stops.length>=0))return on(r,"Could not convert opacity info: no field and no opacities/stops"),null;{const i=t.stops&&t.stops.length>=0?t.stops[0].opacity:0;e.opacity={field:null,values:[0,0,0,0,0,0,0,0],opacityValues:[0,0,0,0,0,0,0,0]};for(let s=0;s<8;s++)e.opacity.values[s]=1/0,e.opacity.opacityValues[s]=i}}return e}function X8(t,e,r){const i=r===2&&t.rotationType==="arithmetic";e.offset[r]=i?90:0,e.factor[r]=i?-1:1,e.type[r]=1}function Ent(t,e,r){if(!l6(t.field))return on(r,"Could not convert rotation info: field is not a string"),null;if(e.rotation){if(t.field)if(e.rotation.field){if(t.field!==e.rotation.field)return on(r,"Could not convert rotation info: multiple fields in use"),null}else e.rotation.field=t.field}else e.rotation={field:t.field,offset:[0,0,0],factor:[1,1,1],type:[0,0,0]};switch(t.axis){case"tilt":return X8(t,e.rotation,0),e;case"roll":return X8(t,e.rotation,1),e;case null:case void 0:case"heading":return X8(t,e.rotation,2),e;default:return on(r,`Could not convert rotation info: unknown axis "${t.axis}""`),null}}let oP=class{constructor(e,r=[1,1,1],i=[1,1,1],s=1,n=[0,0,0],o=[1,1,1],a=[0,0,0]){this.supports=e,this.modelSize=r,this.symbolSize=i,this.unitInMeters=s,this.anchor=n,this.scale=o,this.rotation=a}};function WSe(t,e,r){if(!t)return null;const i=t.reduce((s,n)=>{if(!s)return s;if(n.valueExpression)return on(r,"Could not convert visual variables: arcade expressions not supported"),null;switch(n.type){case"size":return e.supports.size?wnt(n,s,e,r):s;case"color":return e.supports.color?Tnt(n,s,r):s;case"opacity":return e.supports.opacity?Snt(n,s,r):null;case"rotation":return e.supports.rotation?Ent(n,s,r):s;default:return null}},new _nt);return!(t.length>0&&i)||i.size||i.color||i.opacity||i.rotation?i&&i.size&&!xnt(i.size,e,r)?null:i:null}let Cnt=class{constructor(e,r,i){this.visualVariables=e,this.materialParameters=r,this.requiresShaderTransformation=i}};function $2(t,e){if(!t||ni.TESTS_DISABLE_FAST_UPDATES)return null;const r=WSe(t.visualVariables,e);return r?new Cnt(r,XSe(r,e),!!r.size):null}function L2(t,e,r){if(!e||!t)return!1;const i=t.visualVariables,s=WSe(e.visualVariables,r);return!!s&&!!(vI(i.size,s.size,"size")&&vI(i.color,s.color,"color")&&vI(i.rotation,s.rotation,"rotation")&&vI(i.opacity,s.opacity,"opacity"))&&(t.visualVariables=s,t.materialParameters=XSe(s,r),t.requiresShaderTransformation=!!s.size,!0)}function vI(t,e,r){if(!!t!=!!e||t&&t.field!==e?.field)return!1;if(t&&r==="rotation"){const i=t,s=e;for(let n=0;n<3;n++)if(i.type[n]!==s.type[n]||i.offset[n]!==s.offset[n]||i.factor[n]!==s.factor[n])return!1}return!0}let ZSe=class extends ei{constructor(e){super(),this.vvSize=e?.size??null,this.vvColor=e?.color??null,this.vvOpacity=e?.opacity??null}};function XSe(t,e){const r=new ZSe(t);return r.vvSize&&(r.vvSymbolAnchor=e.anchor,Rh(Y3),bnt(e.rotation[2],e.rotation[0],e.rotation[1],Y3),r.vvSymbolRotationMatrix=r.vvSymbolRotationMatrix||Li(),Ph(r.vvSymbolRotationMatrix,Y3)),r}function nH(t,e,r){if(!t.vvSize)return r;Ls($y,r);const i=t.vvSymbolRotationMatrix;tm(Y3,i[0],i[1],i[2],0,i[3],i[4],i[5],0,i[6],i[7],i[8],0,0,0,0,1),si($y,$y,Y3);for(let s=0;s<3;++s){const n=t.vvSize.offset[s]+e[0]*t.vvSize.factor[s];gne[s]=ge(n,t.vvSize.minSize[s],t.vvSize.maxSize[s])}return a5($y,$y,gne),Al($y,$y,t.vvSymbolAnchor),$y}function Ant(t,e,r){if(e.vvSize)for(let i=0;i<3;++i){const s=e.vvSize.offset[i]+r[0]*e.vvSize.factor[i];t[i]=ge(s,e.vvSize.minSize[i],e.vvSize.maxSize[i])}else se(t,1,1,1)}function tp(t,e){const r=t==null?0:e.attributes[t];return typeof r=="number"&&isFinite(r)?r:0}const $y=be(),gne=C(),Y3=be();let aP=class extends ZSe{constructor(){super(...arguments),this.renderOccluded=Mi.Occlude}};const zS=8;function Sg(t,e){const{vertex:r,attributes:i}=t;e.hasVvInstancing&&(e.vvSize||e.vvColor)&&i.add(E.INSTANCEFEATUREATTRIBUTE,"vec4"),e.vvSize?(r.uniforms.add(new Ft("vvSizeMinSize",s=>s.vvSize.minSize)),r.uniforms.add(new Ft("vvSizeMaxSize",s=>s.vvSize.maxSize)),r.uniforms.add(new Ft("vvSizeOffset",s=>s.vvSize.offset)),r.uniforms.add(new Ft("vvSizeFactor",s=>s.vvSize.factor)),r.uniforms.add(new kh("vvSymbolRotationMatrix",s=>s.vvSymbolRotationMatrix)),r.uniforms.add(new Ft("vvSymbolAnchor",s=>s.vvSymbolAnchor)),r.code.add(b`vec3 vvScale(vec4 _featureAttribute) {
return clamp(vvSizeOffset + _featureAttribute.x * vvSizeFactor, vvSizeMinSize, vvSizeMaxSize);
}
vec4 vvTransformPosition(vec3 position, vec4 _featureAttribute) {
return vec4(vvSymbolRotationMatrix * ( vvScale(_featureAttribute) * (position + vvSymbolAnchor)), 1.0);
}`),r.code.add(b`
      const float eps = 1.192092896e-07;
      vec4 vvTransformNormal(vec3 _normal, vec4 _featureAttribute) {
        vec3 vvScale = clamp(vvSizeOffset + _featureAttribute.x * vvSizeFactor, vvSizeMinSize + eps, vvSizeMaxSize);
        return vec4(vvSymbolRotationMatrix * _normal / vvScale, 1.0);
      }

      ${e.hasVvInstancing?b`
      vec4 vvLocalNormal(vec3 _normal) {
        return vvTransformNormal(_normal, instanceFeatureAttribute);
      }

      vec4 localPosition() {
        return vvTransformPosition(position, instanceFeatureAttribute);
      }`:""}
    `)):r.code.add(b`vec4 localPosition() { return vec4(position, 1.0); }
vec4 vvLocalNormal(vec3 _normal) { return vec4(_normal, 1.0); }`),e.vvColor?(r.constants.add("vvColorNumber","int",zS),r.uniforms.add(new bl("vvColorValues",s=>s.vvColor.values,zS),new qSe("vvColorColors",s=>s.vvColor.colors,zS)),r.code.add(b`
      vec4 interpolateVVColor(float value) {
        if (value <= vvColorValues[0]) {
          return vvColorColors[0];
        }

        for (int i = 1; i < vvColorNumber; ++i) {
          if (vvColorValues[i] >= value) {
            float f = (value - vvColorValues[i-1]) / (vvColorValues[i] - vvColorValues[i-1]);
            return mix(vvColorColors[i-1], vvColorColors[i], f);
          }
        }
        return vvColorColors[vvColorNumber - 1];
      }

      vec4 vvGetColor(vec4 featureAttribute) {
        return interpolateVVColor(featureAttribute.y);
      }

      ${e.hasVvInstancing?b`
            vec4 vvColor() {
              return vvGetColor(instanceFeatureAttribute);
            }`:"vec4 vvColor() { return vec4(1.0); }"}
    `)):r.code.add(b`vec4 vvColor() { return vec4(1.0); }`)}const R4=.1,go=.001;function Ont(t){const e=new wr,r=t.signedDistanceFieldEnabled;if(e.include(fSe,t),e.include(ps,t),t.occlusionPass)return e.include(pnt,t),e;const{vertex:i,fragment:s}=e;e.include(wY),s.include(Ec),s.include(sm),e.include(Sg,t),e.include(nP,t),e.varyings.add("vcolor","vec4"),e.varyings.add("vtc","vec2"),e.varyings.add("vsize","vec2"),t.binaryHighlightOcclusionEnabled&&e.varyings.add("voccluded","float"),i.uniforms.add(new sr("viewport",(c,h)=>h.camera.fullViewport),new Sr("screenOffset",(c,h)=>or(YSe,2*c.screenOffset[0]*h.camera.pixelRatio,2*c.screenOffset[1]*h.camera.pixelRatio)),new Sr("anchorPosition",c=>P4(c)),new sr("materialColor",c=>c.color)),xE(i,t),r&&(i.uniforms.add(new sr("outlineColor",c=>c.outlineColor)),s.uniforms.add(new sr("outlineColor",c=>yne(c)?c.outlineColor:Of),new Re("outlineSize",c=>yne(c)?c.outlineSize:0))),t.hasScreenSizePerspective&&(gst(i),o6(i)),(t.debugDrawLabelBorder||t.binaryHighlightOcclusionEnabled)&&e.varyings.add("debugBorderCoords","vec4"),e.attributes.add(E.UV0,"vec2"),e.attributes.add(E.COLOR,"vec4"),e.attributes.add(E.SIZE,"vec2"),e.attributes.add(E.AUXPOS2,"vec4"),i.code.add(b`
    void main(void) {
      ProjectHUDAux projectAux;
      vec4 posProj = projectPositionHUD(projectAux);
      forwardObjectAndLayerIdColor();

      if (rejectBySlice(projectAux.posModel)) {
        // Project outside of clip plane
        gl_Position = vec4(1e038, 1e038, 1e038, 1.0);
        return;
      }
      vec2 inputSize;
      ${t.hasScreenSizePerspective?b`
      inputSize = screenSizePerspectiveScaleVec2(size, projectAux.absCosAngle, projectAux.distanceToCamera, screenSizePerspective);
      vec2 screenOffsetScaled = screenSizePerspectiveScaleVec2(screenOffset, projectAux.absCosAngle, projectAux.distanceToCamera, screenSizePerspectiveAlignment);
         `:b`
      inputSize = size;
      vec2 screenOffsetScaled = screenOffset;`}

      ${t.vvSize?"inputSize *= vvScale(auxpos2).xx;":""}

      vec2 combinedSize = inputSize * pixelRatio;
      vec4 quadOffset = vec4(0.0);

      ${t.occlusionTestEnabled||t.binaryHighlightOcclusionEnabled?"bool visible = testVisibilityHUD(posProj);":""}

      ${t.binaryHighlightOcclusionEnabled?"voccluded = visible ? 0.0 : 1.0;":""}
    `);const n=b`vec2 uv01 = floor(uv0);
vec2 uv = uv0 - uv01;
quadOffset.xy = ((uv01 - anchorPosition) * 2.0 * combinedSize + screenOffsetScaled) / viewport.zw * posProj.w;`;t.pixelSnappingEnabled&&i.include(a6);const o=t.pixelSnappingEnabled?r?b`posProj = alignToPixelOrigin(posProj, viewport.zw) + quadOffset;`:b`posProj += quadOffset;
if (inputSize.x == size.x) {
posProj = alignToPixelOrigin(posProj, viewport.zw);
}`:b`posProj += quadOffset;`;i.code.add(b`
    ${t.occlusionTestEnabled?"if (visible) {":""}
    ${n}
    ${t.vvColor?"vcolor = interpolateVVColor(auxpos2.y) * materialColor;":"vcolor = color / 255.0 * materialColor;"}

    ${t.output===N.ObjectAndLayerIdColor?b`vcolor.a = 1.0;`:""}

    bool alphaDiscard = vcolor.a < ${b.float(go)};
    ${r?`alphaDiscard = alphaDiscard && outlineColor.a < ${b.float(go)};`:""}
    if (alphaDiscard) {
      // "early discard" if both symbol color (= fill) and outline color (if applicable) are transparent
      gl_Position = vec4(1e38, 1e38, 1e38, 1.0);
      return;
    } else {
      ${o}
      gl_Position = posProj;
    }

    vtc = uv;

    ${t.debugDrawLabelBorder?"debugBorderCoords = vec4(uv01, 1.5 / combinedSize);":""}
    vsize = inputSize;
    ${t.occlusionTestEnabled?b`} else { vtc = vec2(0.0);
      ${t.debugDrawLabelBorder?"debugBorderCoords = vec4(0.5, 0.5, 1.5 / combinedSize);}":"}"}`:""}
  }
  `),s.uniforms.add(new Je("tex",c=>c.texture));const a=t.debugDrawLabelBorder?b`(isBorder > 0.0 ? 0.0 : ${b.float(R4)})`:b.float(R4),l=b`
    ${t.debugDrawLabelBorder?b`
      float isBorder = float(any(lessThan(debugBorderCoords.xy, debugBorderCoords.zw)) || any(greaterThan(debugBorderCoords.xy, 1.0 - debugBorderCoords.zw)));`:""}

    ${r?b`
      vec4 fillPixelColor = vcolor;

      // Attempt to sample texel centers to avoid that thin cross outlines
      // disappear with large symbol sizes.
      // see: https://devtopia.esri.com/WebGIS/arcgis-js-api/issues/7058#issuecomment-603041
      const float txSize = ${b.float(rR)};
      const float texelSize = 1.0 / txSize;
      // Calculate how much we have to add/subtract to/from each texel to reach the size of an onscreen pixel
      vec2 scaleFactor = (vsize - txSize) * texelSize;
      vec2 samplePos = vtc + (vec2(1.0, -1.0) * texelSize) * scaleFactor;

      // Get distance and map it into [-0.5, 0.5]
      float d = rgba2float(texture(tex, samplePos)) - 0.5;

      // Distance in output units (i.e. pixels)
      float dist = d * vsize.x;

      // Create smooth transition from the icon into its outline
      float fillAlphaFactor = clamp(0.5 - dist, 0.0, 1.0);
      fillPixelColor.a *= fillAlphaFactor;

      if (outlineSize > 0.25) {
        vec4 outlinePixelColor = outlineColor;
        float clampedOutlineSize = min(outlineSize, 0.5*vsize.x);

        // Create smooth transition around outline
        float outlineAlphaFactor = clamp(0.5 - (abs(dist) - 0.5*clampedOutlineSize), 0.0, 1.0);
        outlinePixelColor.a *= outlineAlphaFactor;

        if (
          outlineAlphaFactor + fillAlphaFactor < ${a} ||
          fillPixelColor.a + outlinePixelColor.a < ${b.float(go)}
        ) {
          discard;
        }

        // perform un-premultiplied over operator (see https://en.wikipedia.org/wiki/Alpha_compositing#Description)
        float compositeAlpha = outlinePixelColor.a + fillPixelColor.a * (1.0 - outlinePixelColor.a);
        vec3 compositeColor = vec3(outlinePixelColor) * outlinePixelColor.a +
          vec3(fillPixelColor) * fillPixelColor.a * (1.0 - outlinePixelColor.a);

        fragColor = vec4(compositeColor, compositeAlpha);
      } else {
        if (fillAlphaFactor < ${a}) {
          discard;
        }

        fragColor = premultiplyAlpha(fillPixelColor);
      }

      // visualize SDF:
      // fragColor = vec4(clamp(-dist/vsize.x*2.0, 0.0, 1.0), clamp(dist/vsize.x*2.0, 0.0, 1.0), 0.0, 1.0);
      `:b`
          vec4 texColor = texture(tex, vtc, -0.5);
          if (texColor.a < ${a}) {
            discard;
          }
          fragColor = texColor * premultiplyAlpha(vcolor);
          `}

    // Draw debug border with transparency, so that original texels along border are still partially visible
    ${t.debugDrawLabelBorder?b`fragColor = mix(fragColor, vec4(1.0, 0.0, 1.0, 1.0), isBorder * 0.5);`:""}
  `;return t.output===N.Alpha&&s.code.add(b`
      void main() {
        ${l}
        fragColor = vec4(fragColor.a);
      }
      `),t.output===N.ObjectAndLayerIdColor&&s.code.add(b`
      void main() {
        ${l}
        outputObjectAndLayerIdColor();
      }
      `),t.output===N.Color&&s.code.add(b`
    void main() {
      ${l}
      ${t.transparencyPassType===ot.FrontFace?"fragColor.rgb /= fragColor.a;":""}
    }
    `),t.output===N.Highlight&&(e.include(ny,t),s.code.add(b`
    void main() {
      ${l}
      ${t.binaryHighlightOcclusionEnabled?b`
          if (voccluded == 1.0) {
            fragColor = vec4(1.0, 1.0, 0.0, 1.0);
          } else {
            fragColor = vec4(1.0, 0.0, 1.0, 1.0);
          }`:"outputHighlight();"}
    }
    `)),e}function yne(t){return t.outlineColor[3]>0&&t.outlineSize>0}function P4(t,e=YSe){return t.textureIsSignedDistanceField?Rnt(t.anchorPosition,t.distanceFieldBoundingBox,e):fn(e,t.anchorPosition),e}function Rnt(t,e,r){e!=null?or(r,t[0]*(e[2]-e[0])+e[0],t[1]*(e[3]-e[1])+e[1]):or(r,0,0)}const YSe=Ve(),Pnt=Object.freeze(Object.defineProperty({__proto__:null,build:Ont,calculateAnchorPosForRendering:P4},Symbol.toStringTag,{value:"Module"})),uu=xo(we.SRC_ALPHA,we.ONE,we.ONE_MINUS_SRC_ALPHA,we.ONE_MINUS_SRC_ALPHA),Mnt=Tc(we.ONE,we.ONE),JSe=Tc(we.ZERO,we.ONE_MINUS_SRC_ALPHA);function oy(t){return t===ot.FrontFace?null:t===ot.Alpha?JSe:Mnt}function c6(t){return t===ot.FrontFace?Ol:null}const u6=5e5,h6={factor:-1,units:-2};function d6(t){return t?h6:null}function rv(t,e=Kr.LESS){return t===ot.NONE||t===ot.FrontFace?e:Kr.LEQUAL}let QSe=class KSe extends Pr{initializeConfiguration(e,r){r.spherical=e.viewingMode===De.Global}initializeProgram(e){return new Cr(e.rctx,KSe.shader.get().build(this.configuration),br)}_setPipelineState(e){const r=this.configuration,i=e===ot.NONE,s=e===ot.FrontFace,n=this.configuration.hasPolygonOffset?Int:null,o=(i||s)&&r.output!==N.Highlight&&(r.depthEnabled||r.occlusionPass)?Ol:null;return At({blending:r.output===N.Color||r.output===N.Alpha||r.output===N.Highlight?i?$nt:oy(e):null,depthTest:{func:Kr.LEQUAL},depthWrite:o,colorWrite:Vt,polygonOffset:n})}initializePipeline(){return this._setPipelineState(this.configuration.transparencyPassType)}get primitiveType(){return this.configuration.occlusionPass?St.POINTS:St.TRIANGLES}};QSe.shader=new Er(Pnt,()=>ae(()=>import("./HUDMaterial.glsl-9c216539.js"),[],import.meta.url));const Int={factor:0,units:-4},$nt=Tc(we.ONE,we.ONE_MINUS_SRC_ALPHA);let ws=class extends Uo{constructor(){super(...arguments),this.output=N.Color,this.screenCenterOffsetUnitsEnabled=vl.World,this.transparencyPassType=ot.NONE,this.spherical=!1,this.occlusionTestEnabled=!0,this.signedDistanceFieldEnabled=!1,this.vvSize=!1,this.vvColor=!1,this.hasVerticalOffset=!1,this.hasScreenSizePerspective=!1,this.debugDrawLabelBorder=!1,this.binaryHighlightOcclusionEnabled=!0,this.hasSlicePlane=!1,this.hasPolygonOffset=!1,this.depthEnabled=!0,this.pixelSnappingEnabled=!0,this.draped=!1,this.hasMultipassGeometry=!1,this.hasMultipassTerrain=!1,this.cullAboveGround=!1,this.occlusionPass=!1,this.objectAndLayerIdColorInstanced=!1}};u([B({count:N.COUNT})],ws.prototype,"output",void 0),u([B({count:vl.COUNT})],ws.prototype,"screenCenterOffsetUnitsEnabled",void 0),u([B({count:ot.COUNT})],ws.prototype,"transparencyPassType",void 0),u([B()],ws.prototype,"spherical",void 0),u([B()],ws.prototype,"occlusionTestEnabled",void 0),u([B()],ws.prototype,"signedDistanceFieldEnabled",void 0),u([B()],ws.prototype,"vvSize",void 0),u([B()],ws.prototype,"vvColor",void 0),u([B()],ws.prototype,"hasVerticalOffset",void 0),u([B()],ws.prototype,"hasScreenSizePerspective",void 0),u([B()],ws.prototype,"debugDrawLabelBorder",void 0),u([B()],ws.prototype,"binaryHighlightOcclusionEnabled",void 0),u([B()],ws.prototype,"hasSlicePlane",void 0),u([B()],ws.prototype,"hasPolygonOffset",void 0),u([B()],ws.prototype,"depthEnabled",void 0),u([B()],ws.prototype,"pixelSnappingEnabled",void 0),u([B()],ws.prototype,"draped",void 0),u([B()],ws.prototype,"hasMultipassGeometry",void 0),u([B()],ws.prototype,"hasMultipassTerrain",void 0),u([B()],ws.prototype,"cullAboveGround",void 0),u([B()],ws.prototype,"occlusionPass",void 0),u([B()],ws.prototype,"objectAndLayerIdColorInstanced",void 0),u([B({constValue:!0})],ws.prototype,"hasSliceInVertexProgram",void 0),u([B({constValue:!1})],ws.prototype,"hasVvInstancing",void 0);let D2=class extends tv{constructor(e){super(e,new Gnt),this._configuration=new ws}getConfiguration(e,r){return this._configuration.output=e,this._configuration.hasSlicePlane=this.parameters.hasSlicePlane,this._configuration.hasVerticalOffset=!!this.parameters.verticalOffset,this._configuration.hasScreenSizePerspective=!!this.parameters.screenSizePerspective,this._configuration.screenCenterOffsetUnitsEnabled=this.parameters.centerOffsetUnits==="screen"?vl.Screen:vl.World,this._configuration.hasPolygonOffset=this.parameters.polygonOffset,this._configuration.draped=this.parameters.isDraped,this._configuration.occlusionTestEnabled=this.parameters.occlusionTest,this._configuration.pixelSnappingEnabled=this.parameters.pixelSnappingEnabled,this._configuration.signedDistanceFieldEnabled=this.parameters.textureIsSignedDistanceField,this._configuration.vvSize=!!this.parameters.vvSize,this._configuration.vvColor=!!this.parameters.vvColor,this._configuration.occlusionPass=r.slot===ue.OCCLUSION_PIXELS&&this.parameters.occlusionTest&&(e===N.Color||e===N.Alpha),e===N.Color&&(this._configuration.debugDrawLabelBorder=!!ni.LABELS_SHOW_BORDER),e===N.Highlight&&(this._configuration.binaryHighlightOcclusionEnabled=this.parameters.binaryHighlightOcclusion),this._configuration.depthEnabled=this.parameters.depthEnabled,this._configuration.transparencyPassType=r.transparencyPassType,this._configuration.hasMultipassGeometry=r.multipassGeometry.enabled,this._configuration.hasMultipassTerrain=r.multipassTerrain.enabled,this._configuration.cullAboveGround=r.multipassTerrain.cullAboveGround,this._configuration}intersect(e,r,i,s,n,o){if(!i.options.selectionMode||!i.options.hud||!e.visible)return;const a=this.parameters;let l=1,c=1;if(Ph(J8,r),e.shaderTransformer!=null){const x=e.shaderTransformer(bne);l=x[0],c=x[5],Nnt(J8)}const h=e.vertexAttributes.get(E.POSITION),p=e.vertexAttributes.get(E.SIZE),f=e.vertexAttributes.get(E.NORMAL),m=e.vertexAttributes.get(E.AUXPOS1);et(h.size>=3);const y=i.point,_=i.camera,v=P4(a);l*=_.pixelRatio,c*=_.pixelRatio;const w=this.parameters.centerOffsetUnits==="screen";for(let x=0;x<h.data.length/h.size;x++){const T=x*h.size;se(Zo,h.data[T],h.data[T+1],h.data[T+2]),$e(Zo,Zo,r);const S=x*p.size;Ly[0]=p.data[S]*l,Ly[1]=p.data[S+1]*c,$e(Zo,Zo,_.viewMatrix);const O=x*m.size;if(se(Ic,m.data[O],m.data[O+1],m.data[O+2]),!w&&(Zo[0]+=Ic[0],Zo[1]+=Ic[1],Ic[2]!==0)){const I=Ic[2];me(Ic,Zo),he(Zo,Zo,te(Ic,Ic,I))}const A=x*f.size;if(se(hC,f.data[A],f.data[A+1],f.data[A+2]),this._normalAndViewAngle(hC,J8,_,Q8),this._applyVerticalOffsetTransformationView(Zo,Q8,_,Y8),_.applyProjection(Zo,xa),xa[0]>-1){xa[0]=Math.floor(xa[0]),xa[1]=Math.floor(xa[1]),w&&(Ic[0]||Ic[1])&&(xa[0]+=Ic[0],Ic[1]!==0&&(xa[1]+=bY(Ic[1],Y8.factorAlignment)),_.unapplyProjection(xa,Zo)),xa[0]+=this.parameters.screenOffset[0],xa[1]+=this.parameters.screenOffset[1],nSe(Ly,Y8.factor,Ly);const I=Vnt*_.pixelRatio;let M=0;if(a.textureIsSignedDistanceField&&(M=a.outlineSize*_.pixelRatio/2),y&&_ne(y,xa[0],xa[1],Ly,I,M,a,v)){const k=i.ray;if($e(vne,Zo,On(knt,_.viewMatrix)),xa[0]=y[0],xa[1]=y[1],_.unprojectFromRenderScreen(xa,Zo)){const L=C();ie(L,k.direction);const D=1/Ce(L);te(L,L,D),o(di(k.origin,Zo)*D,L,-1,!0,1,vne)}}}}}intersectDraped(e,r,i,s,n,o){const a=e.vertexAttributes.get(E.POSITION),l=e.vertexAttributes.get(E.SIZE),c=this.parameters,h=P4(c);let p=1,f=1;if(e.shaderTransformer!=null){const y=e.shaderTransformer(bne);p=y[0],f=y[5]}p*=e.screenToWorldRatio,f*=e.screenToWorldRatio;const m=znt*e.screenToWorldRatio;for(let y=0;y<a.data.length/a.size;y++){const _=y*a.size,v=a.data[_],w=a.data[_+1],x=y*l.size;Ly[0]=l.data[x]*p,Ly[1]=l.data[x+1]*f;let T=0;c.textureIsSignedDistanceField&&(T=c.outlineSize*e.screenToWorldRatio/2),_ne(s,v,w,Ly,m,T,c,h)&&n(o.dist,o.normal,-1,!1)}}createBufferWriter(){return new Hnt(this)}_normalAndViewAngle(e,r,i,s){return mst(r)&&(r=Ph(Unt,r)),hc(s.normal,e,r),$e(s.normal,s.normal,i.viewInverseTransposeMatrix),s.cosAngle=fe(e2e,Bnt),s}_updateScaleInfo(e,r,i){const s=this.parameters;s.screenSizePerspective!=null?sne(i,r,s.screenSizePerspective,e.factor):(e.factor.scale=1,e.factor.factor=0,e.factor.minPixelSize=0,e.factor.paddingPixels=0),s.screenSizePerspectiveAlignment!=null?sne(i,r,s.screenSizePerspectiveAlignment,e.factorAlignment):(e.factorAlignment.factor=e.factor.factor,e.factorAlignment.scale=e.factor.scale,e.factorAlignment.minPixelSize=e.factor.minPixelSize,e.factorAlignment.paddingPixels=e.factor.paddingPixels)}applyShaderOffsetsView(e,r,i,s,n,o,a){const l=this._normalAndViewAngle(r,i,n,Q8);return this._applyVerticalGroundOffsetView(e,l,n,a),this._applyVerticalOffsetTransformationView(a,l,n,o),this._applyPolygonOffsetView(a,l,s[3],n,a),this._applyCenterOffsetView(a,s,a),a}applyShaderOffsetsNDC(e,r,i,s,n){return this._applyCenterOffsetNDC(e,r,i,s),n!=null&&ie(n,s),this._applyPolygonOffsetNDC(s,r,i,s),s}_applyPolygonOffsetView(e,r,i,s,n){const o=s.aboveGround?1:-1;let a=Math.sign(i);a===0&&(a=o);const l=o*a;if(this.parameters.shaderPolygonOffset<=0)return ie(n,e);const c=ge(Math.abs(r.cosAngle),.01,1),h=1-Math.sqrt(1-c*c)/c/s.viewport[2];return te(n,e,l>0?h:1/h),n}_applyVerticalGroundOffsetView(e,r,i,s){const n=Ce(e),o=i.aboveGround?1:-1,a=.5*i.computeRenderPixelSizeAtDist(n),l=te(Zo,r.normal,o*a);return ce(s,e,l),s}_applyVerticalOffsetTransformationView(e,r,i,s){const n=this.parameters;if(!n.verticalOffset||!n.verticalOffset.screenLength){if(n.screenSizePerspective||n.screenSizePerspectiveAlignment){const c=Ce(e);this._updateScaleInfo(s,c,r.cosAngle)}else s.factor.scale=1,s.factorAlignment.scale=1;return e}const o=Ce(e),a=n.screenSizePerspectiveAlignment??n.screenSizePerspective,l=vSe(i,o,n.verticalOffset,r.cosAngle,a);return this._updateScaleInfo(s,o,r.cosAngle),te(r.normal,r.normal,l),ce(e,e,r.normal)}_applyCenterOffsetView(e,r,i){const s=this.parameters.centerOffsetUnits!=="screen";return i!==e&&ie(i,e),s&&(i[0]+=r[0],i[1]+=r[1],r[2]&&(me(hC,i),ce(i,i,te(hC,hC,r[2])))),i}_applyCenterOffsetNDC(e,r,i,s){const n=this.parameters.centerOffsetUnits!=="screen";return s!==e&&ie(s,e),n||(s[0]+=r[0]/i.fullWidth*2,s[1]+=r[1]/i.fullHeight*2),s}_applyPolygonOffsetNDC(e,r,i,s){const n=this.parameters.shaderPolygonOffset;if(e!==s&&ie(s,e),n){const o=i.aboveGround?1:-1,a=o*Math.sign(r[3]);s[2]-=(a||o)*n}return s}requiresSlot(e,r){if(r===N.Color||r===N.Alpha||r===N.Highlight||r===N.ObjectAndLayerIdColor){if(e===ue.DRAPED_MATERIAL)return!0;const{drawInSecondSlot:i,occlusionTest:s}=this.parameters;return e===(i?ue.LABEL_MATERIAL:ue.HUD_MATERIAL)||s&&e===ue.OCCLUSION_PIXELS}return!1}createGLMaterial(e){return new Lnt(e)}calculateRelativeScreenBounds(e,r,i=Ut()){return Dnt(this.parameters,e,r,i),i[2]=i[0]+e[0],i[3]=i[1]+e[1],i}},Lnt=class extends IX{constructor(e){super({...e,...e.material.parameters})}selectProgram(e){return this.ensureTechnique(QSe,e)}beginSlot(e){return this.updateTexture(this._material.parameters.textureId),this._material.setParameters(this.textureBindParameters),this.selectProgram(e)}};function Dnt(t,e,r,i=Fnt){return fn(i,t.anchorPosition),i[0]*=-e[0],i[1]*=-e[1],i[0]+=t.screenOffset[0]*r,i[1]+=t.screenOffset[1]*r,i}function Nnt(t){const e=t[0],r=t[1],i=t[2],s=t[3],n=t[4],o=t[5],a=t[6],l=t[7],c=t[8],h=1/Math.sqrt(e*e+r*r+i*i),p=1/Math.sqrt(s*s+n*n+o*o),f=1/Math.sqrt(a*a+l*l+c*c);return t[0]=e*h,t[1]=r*h,t[2]=i*h,t[3]=s*p,t[4]=n*p,t[5]=o*p,t[6]=a*f,t[7]=l*f,t[8]=c*f,t}function _ne(t,e,r,i,s,n,o,a){let l=e-s-(a[0]>0?i[0]*a[0]:0),c=l+i[0]+2*s,h=r-s-(a[1]>0?i[1]*a[1]:0),p=h+i[1]+2*s;const f=o.distanceFieldBoundingBox;return o.textureIsSignedDistanceField&&f!=null&&(l+=i[0]*f[0],h+=i[1]*f[1],c-=i[0]*(1-f[2]),p-=i[1]*(1-f[3]),l-=n,c+=n,h-=n,p+=n),t[0]>l&&t[0]<c&&t[1]>h&&t[1]<p}const Y8=new TSe,Fnt=Ve(),Zo=C(),hC=C(),xa=Wt(),e2e=C(),vne=C(),J8=Li(),Unt=Li(),knt=be(),Ic=C(),Q8={normal:e2e,cosAngle:0},bne=be(),Vnt=1,znt=2,Ly=[0,0],Bnt=Oe(0,0,1);let Gnt=class extends Nwe{constructor(){super(...arguments),this.renderOccluded=Mi.Occlude,this.color=Lt(1,1,1,1),this.texCoordScale=[1,1],this.polygonOffset=!1,this.anchorPosition=dr(.5,.5),this.screenOffset=[0,0],this.shaderPolygonOffset=1e-5,this.textureIsSignedDistanceField=!1,this.outlineColor=Lt(1,1,1,1),this.outlineSize=0,this.vvSizeEnabled=!1,this.vvSize=null,this.vvColor=null,this.vvOpacity=null,this.vvSymbolAnchor=null,this.vvSymbolRotationMatrix=null,this.hasSlicePlane=!1,this.pixelSnappingEnabled=!0,this.occlusionTest=!0,this.binaryHighlightOcclusion=!0,this.centerOffsetUnits="world",this.drawInSecondSlot=!1,this.depthEnabled=!0,this.isDraped=!1}};const t2e=zi().vec3f(E.POSITION).vec3f(E.NORMAL).vec2f(E.UV0).vec4u8(E.COLOR).vec2f(E.SIZE).vec4f(E.AUXPOS1).vec4f(E.AUXPOS2),jnt=t2e.clone().vec4u8(E.OBJECTANDLAYERIDCOLOR);let Hnt=class{constructor(e){this._material=e,this.vertexBufferLayout=oe("enable-feature:objectAndLayerId-rendering")?jnt:t2e}elementCount(e){return 6*e.indices.get(E.POSITION).length}write(e,r,i,s,n){AY(i.indices.get(E.POSITION),i.vertexAttributes.get(E.POSITION).data,e,s.position,n,6),OY(i.indices.get(E.NORMAL),i.vertexAttributes.get(E.NORMAL).data,r,s.normal,n,6);const o=i.vertexAttributes.get(E.UV0).data;let a,l,c,h;if(o==null||o.length<4){const w=this._material.parameters;a=0,l=0,c=w.texCoordScale[0],h=w.texCoordScale[1]}else a=o[0],l=o[1],c=o[2],h=o[3];c=Math.min(1.99999,c+1),h=Math.min(1.99999,h+1);let p=i.indices.get(E.POSITION).length,f=n;const m=s.uv0;for(let w=0;w<p;++w)m.set(f,0,a),m.set(f,1,l),f+=1,m.set(f,0,c),m.set(f,1,l),f+=1,m.set(f,0,c),m.set(f,1,h),f+=1,m.set(f,0,c),m.set(f,1,h),f+=1,m.set(f,0,a),m.set(f,1,h),f+=1,m.set(f,0,a),m.set(f,1,l),f+=1;ESe(i.indices.get(E.COLOR),i.vertexAttributes.get(E.COLOR).data,4,s.color,n,6);const y=i.indices.get(E.SIZE),_=i.vertexAttributes.get(E.SIZE).data;p=y.length;const v=s.size;f=n;for(let w=0;w<p;++w){const x=_[2*y[w]],T=_[2*y[w]+1];for(let S=0;S<6;++S)v.set(f,0,x),v.set(f,1,T),f+=1}if(i.indices.get(E.AUXPOS1)&&i.vertexAttributes.get(E.AUXPOS1)?I2(i.indices.get(E.AUXPOS1),i.vertexAttributes.get(E.AUXPOS1).data,s.auxpos1,n,6):dne(s.auxpos1,n,6*p),i.indices.get(E.AUXPOS2)&&i.vertexAttributes.get(E.AUXPOS2)?I2(i.indices.get(E.AUXPOS2),i.vertexAttributes.get(E.AUXPOS2).data,s.auxpos2,n,6):dne(s.auxpos2,n,6*p),i.objectAndLayerIdColor!=null&&i.indices.get(E.POSITION)){const w=i.indices.get(E.POSITION).length,x=s.getField(E.OBJECTANDLAYERIDCOLOR,ha);CSe(i.objectAndLayerIdColor,x,w,n,6)}}};const Cp=C(),wx=Wt(),dC=Wt(),K8=C(),qnt=be(),Wnt=gs(),e9=Xn(),Znt=C(),Xnt=Ut();class Ynt{constructor(){this.aabr=Ut(),this.distance=0,this.culled=!1,this.visible=!1}}class Jnt{constructor(e,r){this.graphics3DGraphic=e,this.slicePlaneEnabled=r,this.info={}}}var Yl;(function(t){t[t.Idle=0]="Idle",t[t.Process=1]="Process",t[t.Sort=2]="Sort",t[t.Deconflict=3]="Deconflict",t[t.NumStates=4]="NumStates"})(Yl||(Yl={}));class r2e{constructor(){this.camera=new ut,this.slicePlane=Yg(),this.slicePlaneEnabled=!1}copyFrom(e){this.camera.copyFrom(e.camera),Uw(e.slicePlane,this.slicePlane),this.slicePlaneEnabled=e.slicePlaneEnabled}}let uS=class extends Te{get dirty(){return this._dirty}get state(){return this._state}constructor(t){super(t),this._dirty=!1,this._runningViewState=new r2e,this._state=Yl.Idle,this._active=new Map,this._visible=new Map,this._iterators=new tot,this._accBinsNumX=15,this._accBinsNumY=20,this._accBinsSizeX=0,this._accBinsSizeY=0,this._accBins=null,this.accNumTests=0}destroy(){this._active.clear(),this._visible.clear(),this._iterators=null}setDirty(){!this._dirty&&this._active.size>0&&(this._dirty=!0,this.notifyChange("updating"))}get updating(){return this._state!==Yl.Idle||this._dirty}get updatingProgress(){if(!this.updating)return 1;const t=this._state/Yl.NumStates;return this._dirty?.5*t:t}get running(){return this.view.ready&&this.view.state!=null&&this.updating}runTask(t){switch(this._state){case Yl.Idle:this._startUpdate(),t.madeProgress();case Yl.Process:if(this._state=Yl.Process,!this._processActiveGraphics(t))return;case Yl.Sort:if(this._state=Yl.Sort,!this._sortVisibleGraphics(t))return;case Yl.Deconflict:if(this._state=Yl.Deconflict,!this._deconflictVisibleGraphics(t))return;default:sst(this,this._visible),this._state=Yl.Idle,this.notifyChange("updating")}}modifyGraphics(t,e){e?t.forEach(r=>this.addToActiveGraphics(r)):t.forEach(r=>this.removeFromActiveGraphics(r)),this.setDirty()}layerSupportsDeconfliction(t){if(t==null||t.type!=="object3d")return!1;const e=t.stageObject;return(e?e.geometries.length:0)!==1?!1:e?.geometries[0]?.material instanceof D2}_startUpdate(){nst(this.view),this._dirty=!1,this._runningViewState.copyFrom(this.viewState);const{fullWidth:t,fullHeight:e}=this._runningViewState.camera;this._initBins(t,e),this._resetIterators()}addToActiveGraphics(t){t.info[this.visibilityGroup]=new Ynt,this._active.set(t.graphics3DGraphic.graphic.uid,t),this.setDirty()}removeFromActiveGraphics(t){this._visible.delete(t.graphics3DGraphic.graphic.uid),Qnt(t,this.visibilityGroup),delete t.info[this.visibilityGroup],this._active.delete(t.graphics3DGraphic.graphic.uid),this.setDirty()}_processActiveGraphics(t){const e=this._ensureActiveGraphicsIterator(),r=lE(qnt,this._runningViewState.camera.projectionMatrix),i=this.view.viewingMode==="global"&&this.view.map.ground.opacity===1&&this._runningViewState.camera.relativeElevation>0?Wnt:null;let s=0;for(i!=null&&($e(i,ja,this._runningViewState.camera.viewMatrix),i[3]=Nr(this.view.spatialReference).radius,s=cbe(i,ja));!t.done;){t.madeProgress();const n=e.next();if(n.done===!0)return this._resetActiveGraphicsIterator(),!0;const o=n.value,a=o&&o.info[this.visibilityGroup];a&&(this._collectGraphics3DGraphics(o,r,i,s),a.culled?this._visible.delete(o.graphics3DGraphic.graphic.uid):this._visible.set(o.graphics3DGraphic.graphic.uid,o))}return!1}_sortVisibleGraphics(t){const e=this._ensureSortGraphicsIterator();for(;!t.done;){const r=e.next();if(t.madeProgress(),r.done===!0)return this._resetSortGraphicsIterator(),!0}return!1}_deconflictVisibleGraphics(t){const e=this._ensureVisibleGraphicsIterator(),r=this.visibilityGroup===Zn.LABEL;for(;!t.done;){t.madeProgress();const i=e.next();if(i.done===!0)return this._resetVisibleGraphicsIterator(),!0;const s=i.value,n=s.info[this.visibilityGroup];if(!n||n.culled)continue;const o=s.graphics3DGraphic,a=!r||o.isVisible();n.visible=a&&!this._isConflicted(s),n.visible&&this._addToBins(s),this._setGraphicVisibility(s,n.visible),ast(n,n.visible)}return!1}_resetIterators(){this._iterators.active=null,this._iterators.visible=null,this._iterators.sort=null}_ensureActiveGraphicsIterator(){return this._iterators.active||(this._iterators.active=wne(this._active)),this._iterators.active}_resetActiveGraphicsIterator(){this._iterators.active=null}_ensureVisibleGraphicsIterator(){return this._iterators.visible||(this._iterators.visible=wne(this._visible)),this._iterators.visible}_resetVisibleGraphicsIterator(){this._iterators.visible=null}_ensureSortGraphicsIterator(){return this._iterators.sort||(this._iterators.sort=Knt(this._visible,this._iterators.sortArray,this.visibilityGroup)),this._iterators.sort}_resetSortGraphicsIterator(){this._iterators.sort=null}_collectGraphics3DGraphics(t,e,r,i){const s=t.graphics3DGraphic;if(s.destroyed)return;const n=t.info[this.visibilityGroup];if(!s.isVisible(Zn.GRAPHIC,ko.DECONFLICTION))return void(n.culled=!0);const o=this.getGraphicsLayers(s);wc(n.aabr);let a=null;for(const l of o){if(!this.layerSupportsDeconfliction(l))continue;const c=l.stageObject.geometries[0].material;if(a==null&&(a=sot,this._getProjectionInfo(l,e,a),a.isOutsideScreen||this._isCulledBySlice(t,Cp)||r!=null&&this._isCulledByHorizon(a,r,i)))return void(n.culled=!0);this._expandBoundingRect(n,l,c,a)}a==null?n.culled=!0:(n.distance=a.distance,n.culled=!1)}_getProjectionInfo(t,e,r){const i=this._runningViewState.camera,s=t.stageObject,n=s.geometries[0],o=n.material,a=s.boundingVolumeWorldSpace.bounds;$e(Cp,a,i.viewMatrix);const l=n.vertexAttributes,c=l.get(E.NORMAL).data,h=l.get(E.AUXPOS1).data;o.applyShaderOffsetsView(Cp,c,s.transformation,h,i,r.scaleInfo,Cp),bi(wx,Cp[0],Cp[1],Cp[2],1),su(dC,wx,i.projectionMatrix),te(r.positionNDC,dC,1/dC[3]),o.applyShaderOffsetsNDC(r.positionNDC,h,i,r.positionNDC,K8),r.distanceWithoutPolygonOffset=i.depthNDCToWorld(K8[2]),r.distance=K8[2]===r.positionNDC[2]?r.distanceWithoutPolygonOffset:i.depthNDCToWorld(r.positionNDC[2]),bi(dC,r.positionNDC[0],r.positionNDC[1],r.positionNDC[2],1),su(wx,dC,e),Zb(wx,wx,1/wx[3]),se(r.positionView,Cp[0],Cp[1],Cp[2])}_isCulledByHorizon(t,e,r){return ie(e9.direction,t.positionView),se(e9.origin,0,0,0),!!Q_(e,e9,Znt)&&t.distanceWithoutPolygonOffset>r}_isCulledBySlice(t,e){return t.slicePlaneEnabled&&this._runningViewState.slicePlaneEnabled&&yX(this._runningViewState.slicePlane,e)}_expandBoundingRect(t,e,r,{positionNDC:i,scaleInfo:s}){const n=this._runningViewState.camera,o=e.getScreenSize(rot);nSe(o,s.factor,o),o[0]*=n.pixelRatio,o[1]*=n.pixelRatio;const a=nN(r.calculateRelativeScreenBounds(o,s.factorAlignment.scale,Xnt),wt(0,n.fullWidth,.5+.5*i[0]),wt(0,n.fullHeight,.5+.5*i[1])),l=this.iconMarginFactor;if(l!==0){const c=l*Math.min(ru(a),op(a));a[0]-=c,a[1]-=c,a[2]+=c,a[3]+=c}f_(t.aabr,a,t.aabr)}_isConflicted(t){const e=t.graphics3DGraphic.graphic.uid,r=t.info[this.visibilityGroup];for(let i=Math.floor(r.aabr[0]/this._accBinsSizeX);i<=Math.floor(r.aabr[2]/this._accBinsSizeX);i++)if(!(i<0||i>=this._accBinsNumX))for(let s=Math.floor(r.aabr[1]/this._accBinsSizeY);s<=Math.floor(r.aabr[3]/this._accBinsSizeY);s++){if(s<0||s>=this._accBinsNumY)continue;const n=this._accBins[i][s];for(let o=0;o<n.length;o++){const a=n.data[o],l=a.info[this.visibilityGroup];if(l&&l.visible&&a.graphics3DGraphic.graphic.uid!==e&&(this.accNumTests++,MR(l.aabr,r.aabr)))return!0}}return!1}_initBins(t,e){if(this._accBins==null){this._accBins=[];for(let r=0;r<this._accBinsNumX;r++){this._accBins.push([]);const i=this._accBins[this._accBins.length-1];for(let s=0;s<this._accBinsNumY;s++)i.push(new kt)}}else for(let r=0;r<this._accBinsNumX;r++)for(let i=0;i<this._accBinsNumY;i++)this._accBins[r][i].clear();this._accBinsSizeX=t/this._accBinsNumX,this._accBinsSizeY=e/this._accBinsNumY,this.accNumTests=0}_addToBins(t){const e=t.info[this.visibilityGroup],r=Math.floor(e.aabr[0]/this._accBinsSizeX),i=Math.floor(e.aabr[2]/this._accBinsSizeX),s=Math.floor(e.aabr[1]/this._accBinsSizeY),n=Math.floor(e.aabr[3]/this._accBinsSizeY);for(let o=r;o<=i;o++)if(!(o<0||o>=this._accBinsNumX))for(let a=s;a<=n;a++)a<0||a>=this._accBinsNumY||this._accBins[o][a].push(t)}_setGraphicVisibility(t,e){const r=t.graphics3DGraphic;r.destroyed||(r.setVisibilityFlag(this.visibilityGroup,ko.DECONFLICTION,e),this.visibilityGroup===Zn.LABEL&&this.view.labeler.setLabelGraphicVisibility(r,e))}};function Qnt(t,e){const r=t.graphics3DGraphic;r.destroyed||r.setVisibilityFlag(e,ko.DECONFLICTION,!0)}function*wne(t){if(Map.prototype.entries){const e=t.entries();for(let r=e.next();!r.done;r=e.next())yield r.value[1]}else yield*t.values()}function*Knt(t,e,r){e.clear(),t.forEach((s,n)=>{const o=e.pushNew();o.id=n,o.visible=s.graphics3DGraphic.getVisibilityFlag(r,ko.DECONFLICTION);const a=s.info&&s.info[r];o.prio=s.graphics3DGraphic.deconflictionPriority,o.distance=a?a.distance:Number.MAX_VALUE}),yield;const i=e.iterableSort((s,n)=>s.prio!==n.prio?n.prio-s.prio:s.distance!==n.distance?s.distance-n.distance:s.visible!==n.visible?s.visible?-1:1:s.id-n.id);for(let s=i.next();!s.done;s=i.next())yield;e.forAll(s=>{const n=t.get(s.id);n&&(t.delete(s.id),t.set(s.id,n))}),e.clear()}u([d({constructOnly:!0})],uS.prototype,"view",void 0),u([d({type:Boolean,readOnly:!0})],uS.prototype,"updating",null),uS=u([R("esri.views.3d.layers.graphics.Deconflictor")],uS);class eot{constructor(){this.id=0,this.visible=!1,this.prio=0,this.distance=0}}class tot{constructor(e=null,r=null,i=null){this.active=e,this.visible=r,this.sort=i,this.sortArray=new kt({allocator:s=>s||new eot})}}const rot=Ve();class iot{constructor(){this.positionView=C(),this.positionNDC=C(),this.distance=0,this.distanceWithoutPolygonOffset=0,this.scaleInfo=new TSe}get isOutsideScreen(){const e=this.positionNDC;return e[0]<-1||e[1]<-1||e[2]<-1||e[0]>=1||e[1]>=1}}const sot=new iot,not=2e3;let oD=class extends uS{constructor(e){super(e),this.visibilityGroup=Zn.LABEL,this.iconMarginFactor=0,this._lastDeconfliction=0}get viewState(){return this.parent.viewState}runTask(e){if(this.parent.running)return jo.YIELD;const r=performance.now();if(e.state!==$r.IDLE&&r-this._lastDeconfliction<not)return jo.YIELD;super.runTask(e),this.state===Yl.Idle&&(this._lastDeconfliction=r)}enabledChanged(e,r){this.modifyGraphics(r,e.labelsEnabled)}getGraphicsLayers(e){return e.labelLayers}};u([d({constructOnly:!0})],oD.prototype,"parent",void 0),oD=u([R("esri.views.3d.layers.graphics.LabelDeconflictor")],oD);let oH=class extends uS{constructor(){super(...arguments),this._handles=new Oi,this._contexts=new Map,this._viewState=new r2e,this.visibilityGroup=Zn.GRAPHIC,this._iconMarginFactor=-.1}get labels(){return this._labels}get viewState(){return this._viewState}initialize(){this._handles.add([le(()=>this.view?.state?.camera,()=>{this._updateViewState(),this.setDirty()}),le(()=>this.view?.map?.ground?.opacity,(e,r)=>{e!==1&&r!==1||this.setDirty()}),le(()=>this.view?.slicePlane,()=>{this._updateSlicePlane(),this._slicePlaneChanged()},Vr)]),this._frameTask=this.view.resourceController.scheduler.registerTask(dt.GRAPHICS_DECONFLICTOR,this),this._labels=new oD({view:this.view,parent:this})}destroy(){this._labels.destroy(),this._labels=null,this._handles.destroy(),this._handles=null,this._frameTask&&(this._frameTask.remove(),this._frameTask=null)}get iconMarginFactor(){return this._iconMarginFactor}set iconMarginFactor(e){this._iconMarginFactor=e,this.setDirty()}setDirty(){this._contexts.size>0&&(super.setDirty(),this._labels.setDirty())}runTask(e){super.runTask(e),this.running||this._labels.setDirty()}setInitialIconVisibilityFlag(e,r){const i=!(this._graphicSupportsDeconfliction(r)&&t9(e));r.setVisibilityFlag(Zn.GRAPHIC,ko.DECONFLICTION,i)}_updateViewState(){this.view&&this.view.state&&(this._viewState.camera.copyFrom(this.view.state.camera),this._updateSlicePlane())}_updateSlicePlane(){const e=this.view?this.view.slicePlane:null;e!=null&&Ube(e,this._viewState.camera.viewMatrix,this._viewState.slicePlane),this._viewState.slicePlaneEnabled=e!=null}_slicePlaneChanged(){No(this._contexts,(e,r)=>r.symbolCreationContext.slicePlaneEnabled)&&this.setDirty()}addGraphicsOwner(e){const r=this._getGraphicsContext(e);return{addGraphic:i=>this._addGraphic(e,r,i),removeGraphic:i=>this._removeGraphic(r,i),labelingInfoChange:()=>this._labels.enabledChanged(e,r),featureReductionChange:()=>this.enabledChanged(e,r),slicePlaneEnabledChange:()=>this._slicePlaneEnabledChanged(e,r),clear:()=>r.forEach(i=>this._removeGraphic(r,i.graphics3DGraphic))}}removeGraphicsOwner(e){const r=this._contexts.get(e);r&&(r.forEach(i=>this._removeGraphic(r,i.graphics3DGraphic)),this._contexts.delete(e),this.setDirty())}_addGraphic(e,r,i){const s=i.graphic.uid,n=new Jnt(i,e.symbolCreationContext.slicePlaneEnabled);r.set(s,n),t9(e)&&this.addToActiveGraphics(n),e.labelsEnabled&&this._labels.addToActiveGraphics(n)}_removeGraphic(e,r){const i=r.graphic.uid,s=e.get(i);s&&(this.removeFromActiveGraphics(s),this._labels.removeFromActiveGraphics(s),e.delete(i),this.setDirty())}enabledChanged(e,r){const i=t9(e);i||oot(e),this.modifyGraphics(r,i)}_slicePlaneEnabledChanged(e,r){const i=e.symbolCreationContext.slicePlaneEnabled;r.forEach(s=>s.slicePlaneEnabled=i),this.setDirty()}getGraphicsLayers(e){return e.layers}_graphicSupportsDeconfliction(e){if(e.isDraped)return!1;const r=e.layers;if(!r||!r.length)return!1;for(const i of r)if(this.layerSupportsDeconfliction(i))return!0;return!1}_getGraphicsContext(e){const r=this._contexts.get(e);if(r)return r;const i=new Map;return this._contexts.set(e,i),this.setDirty(),i}};function t9(t){const e=t.layer;return!(!e||!e.featureReduction||e.featureReduction.type!=="selection")}function oot(t){const e=t.graphics3DGraphics;e&&e.forEach(r=>r.setVisibilityFlag(Zn.GRAPHIC,ko.DECONFLICTION,!0))}oH=u([R("esri.views.3d.layers.graphics.GraphicsDeconflictor")],oH);function i2e(t){return"declaredClass"in t}function xne(t){return"declaredClass"in t}function aot(t){return"declaredClass"in t}function lot(t,e){return t?aot(t)?t:new Oh({layer:e,sourceLayer:e,visible:t.visible,symbol:K(t.symbol),attributes:K(t.attributes),geometry:s2e(t.geometry)}):null}function s2e(t){return t==null?null:i2e(t)?t:S_(cot(t))}function cot(t){const{wkid:e,wkt:r,latestWkid:i}=t.spatialReference,s={wkid:e,wkt:r,latestWkid:i};switch(t.type){case"point":{const{x:n,y:o,z:a,m:l}=t;return{x:n,y:o,z:a,m:l,spatialReference:s}}case"polygon":{const{rings:n,hasZ:o,hasM:a}=t;return{rings:Tne(n),hasZ:o,hasM:a,spatialReference:s}}case"polyline":{const{paths:n,hasZ:o,hasM:a}=t;return{paths:Tne(n),hasZ:o,hasM:a,spatialReference:s}}case"extent":{const{xmin:n,xmax:o,ymin:a,ymax:l,zmin:c,zmax:h,mmin:p,mmax:f,hasZ:m,hasM:y}=t;return{xmin:n,xmax:o,ymin:a,ymax:l,zmin:c,zmax:h,mmin:p,mmax:f,hasZ:m,hasM:y,spatialReference:s}}case"multipoint":{const{points:n,hasZ:o,hasM:a}=t;return{points:o2e(n)?n2e(n):n,hasZ:o,hasM:a,spatialReference:s}}default:return}}function Tne(t){return uot(t)?t.map(e=>n2e(e)):t}function n2e(t){return t.map(e=>Array.from(e))}function uot(t){for(const e of t)if(e.length!==0)return o2e(e);return!1}function o2e(t){return t.length>0&&(B2(t[0])||G2(t[0]))}function hot(t,e){if(!t)return null;let r;if(xne(t)){if(e==null)return t.clone();if(xne(e))return e.copy(t)}return e!=null?(r=e,r.x=t.x,r.y=t.y,r.spatialReference=t.spatialReference,t.hasZ?(r.z=t.z,r.hasZ=t.hasZ):(r.z=void 0,r.hasZ=!1),t.hasM?(r.m=t.m,r.hasM=!0):(r.m=void 0,r.hasM=!1)):(r=Dw(t.x,t.y,t.z,t.spatialReference),t.hasM&&(r.m=t.m,r.hasM=!0)),r}function $$t(t){const{wkid:e,wkt:r,latestWkid:i}=t,s={wkid:e,wkt:r,latestWkid:i};return je.fromJSON(s)}const r9=Q.getLogger("esri.layers.support.labelFormatUtils"),i9={type:"simple",evaluate:()=>null},dot={getAttribute:(t,e)=>t.field(e)};async function a2e(t,e,r){if(!t||!t.symbol||!e)return i9;const i=t.where,s=f5(t),n=i?await ae(()=>import("./WhereClause-ae8c5a06.js").then(a=>a.W),["./WhereClause-ae8c5a06.js","./executionError-e8d36121.js"],import.meta.url):null;let o;if(s.type==="arcade"){const a=await SNe(s.expression,r,e);if(a==null)return i9;o={type:"arcade",evaluate(l){try{const c=a.evaluate({$feature:"attributes"in l?a.repurposeFeature(l):l},a.services);if(c!=null)return c.toString()}catch(c){r9.error(new F("arcade-expression-error","Encountered an error when evaluating label expression for feature",{error:c,feature:l,expression:s}))}return null},needsHydrationToEvaluate:()=>PZ(s.expression)==null}}else o={type:"simple",evaluate:a=>s.expression.replaceAll(/{[^}]*}/g,l=>{const c=l.slice(1,-1),h=e.get(c);if(!h)return l;let p=null;return"attributes"in a?a&&a.attributes&&(p=a.attributes[h.name]):p=a.field(h.name),p==null?"":l2e(p,h)})};if(i){let a;try{a=n.WhereClause.create(i,e)}catch(c){return r9.error(new F("bad-where-clause","Encountered an error when evaluating where clause, ignoring",{where:i,error:c})),i9}const l=o.evaluate;o.evaluate=c=>{const h="attributes"in c?void 0:dot;try{if(a.testFeature(c,h))return l(c)}catch(p){r9.error(new F("bad-where-clause","Encountered an error when evaluating where clause for feature",{where:i,feature:c,error:p}))}return null}}return o}function l2e(t,e){if(t==null)return"";const r=e.domain;if(r){if(r.type==="codedValue"||r.type==="coded-value"){const s=t;for(const n of r.codedValues)if(n.code===s)return n.name}else if(r.type==="range"){const s=+t,n="range"in r?r.range[0]:r.minValue,o="range"in r?r.range[1]:r.maxValue;if(n<=s&&s<=o)return r.name}}let i=t;return e.type==="date"||e.type==="esriFieldTypeDate"?i=w_(i,UC("short-date")):$F(e)&&(i=ZS(+i)),i||""}const L$t=Object.freeze(Object.defineProperty({__proto__:null,createLabelFunction:a2e,formatField:l2e},Symbol.toStringTag,{value:"Module"}));let c2e=class{constructor(e=null,r="center",i="center",s=null,n=[0,0,0],o=0,a=[0,0,0,1],l=[0,0],c="world",h=0,p=0){this.verticalOffset=e,this.horizontalPlacement=r,this.verticalPlacement=i,this.text=s,this.translation=n,this.elevationOffset=o,this.centerOffset=a,this.screenOffset=l,this.centerOffsetUnits=c,this.displayWidth=h,this.displayHeight=p}};function $Y(t,e){if(t.type==="point")return Dy(t,e,!1);if(i2e(t))switch(t.type){case"extent":return Dy(t.center,e,!1);case"polygon":return Dy(t.centroid,e,!1);case"polyline":return Dy(Sne(t),e,!0);case"mesh":return Dy(t.origin,e,!1)}else switch(t.type){case"extent":return Dy(pot(t),e,!0);case"polygon":return Dy(fot(t),e,!0);case"polyline":return Dy(Sne(t),e,!0)}}function Sne(t){const e=t.paths[0];if(!e||e.length===0)return null;const r=dfe(e,hfe(e)/2);return Dw(r[0],r[1],r[2],t.spatialReference)}function pot(t){return Dw(.5*(t.xmax+t.xmin),.5*(t.ymax+t.ymin),t.zmin!=null&&t.zmax!=null&&isFinite(t.zmin)&&isFinite(t.zmax)?.5*(t.zmax+t.zmin):void 0,t.spatialReference)}function fot(t){const e=t.rings[0];if(!e||e.length===0)return null;const r=ffe(t.rings,!!t.hasZ);return Dw(r[0],r[1],r[2],t.spatialReference)}function Dy(t,e,r){const i=r?t:hot(t);return e&&t?P_e(t,i,e)?i:null:i}function N$t(t,e,r,i=0){if(t){e||(e=Ut());const s=t;let n=.5*s.width*(r-1),o=.5*s.height*(r-1);return s.width<1e-7*s.height?n+=o/20:s.height<1e-7*s.width&&(o+=n/20),bi(e,s.xmin-n-i,s.ymin-o-i,s.xmax+n+i,s.ymax+o+i),e}return null}function u2e(t,e){for(let r=0;r<t.geometries.length;++r){const i=t.geometries[r].getMutableAttribute(E.AUXPOS1);i&&i.data[3]!==e&&(i.data[3]=e,t.geometryVertexAttrsUpdated(t.geometries[r]))}}function J3(t,e,r=null){const i=VR(dh);return t!=null&&(i[0]=t[0],i[1]=t[1],i[2]=t[2]),e!=null?i[3]=e:t!=null&&t.length>3&&(i[3]=t[3]),r&&(i[0]*=r,i[1]*=r,i[2]*=r,i[3]*=r),i}function F$t(t,e,r,i,s,n=[0,0,0,0]){for(let o=0;o<3;++o)t!=null&&t[o]!=null?n[o]=t[o]:r!=null&&r[o]!=null?n[o]=r[o]:n[o]=s[o];return n[3]=e??i??s[3],n}function Ene(t=fg,e,r,i=1){const s=new Array(3);if(e==null||r==null)s[0]=1,s[1]=1,s[2]=1;else{let n,o=0;for(let a=2;a>=0;a--){const l=t[a];let c;const h=l!=null,p=a===0&&!n&&!h,f=r[a];l==="symbol-value"||p?c=f!==0?e[a]/f:1:h&&l!=="proportional"&&isFinite(l)&&(c=f!==0?l/f:1),c!=null&&(s[a]=c,n=c,o=Math.max(o,Math.abs(c)))}for(let a=2;a>=0;a--)s[a]==null?s[a]=n:s[a]===0&&(s[a]=.001*o)}for(let n=2;n>=0;n--)s[n]/=i;return Fa(s)}function mot(t){return t.isPrimitive!=null}function p6(t){return aH(mot(t)?[t.width,t.depth,t.height]:t)?null:"Symbol sizes may not be negative values"}function aH(t){const e=r=>r==null||r>=0;return Array.isArray(t)?t.every(e):e(t)}function got(t,e,r,i=be()){return t&&h2(i,i,-t/180*Math.PI),e&&u2(i,i,e/180*Math.PI),r&&l5(i,i,r/180*Math.PI),i}function LY(t,e,r){if(r.minDemResolution!=null)return r.minDemResolution;const i=Za(e),s=Ow(t)*i,n=Rw(t)*i,o=Z_(t)*(e.isGeographic?1:i);return s===0&&n===0&&o===0?r.minDemResolutionForPoints:.01*Math.max(s,n,o)}function h2e(t,e,r,i,s,n,o,a,l,c,h){const p=Sot[h.mode];let f,m,y=0;if(oi(t,e,r,i,l.spatialReference,s,a))return p.requiresAlignment(h)?(y=p.applyElevationAlignmentBuffer(i,s,n,o,a,l,c,h),f=n,m=o):(f=i,m=s),oi(f,l.spatialReference,m,n,c.spatialReference,o,a)?y:void 0}function B_(t,e,r,i,s){const n=(b4(t)?t.z:PTe(t)?t.array[t.offset+2]:t[2])||0;switch(r.mode){case"on-the-ground":{const o=wf(e,t,"ground")??0;return s.verticalDistanceToGround=0,s.sampledElevation=o,void(s.z=o)}case"relative-to-ground":{const o=wf(e,t,"ground")??0,a=r.geometryZWithOffset(n,i);return s.verticalDistanceToGround=a,s.sampledElevation=o,void(s.z=a+o)}case"relative-to-scene":{const o=wf(e,t,"scene")??0,a=r.geometryZWithOffset(n,i);return s.verticalDistanceToGround=a,s.sampledElevation=o,void(s.z=a+o)}case"absolute-height":{const o=r.geometryZWithOffset(n,i),a=wf(e,t,"ground")??0;return s.verticalDistanceToGround=o-a,s.sampledElevation=a,void(s.z=o)}default:return void(s.z=0)}}function yot(t,e,r,i){return B_(t,e,r,i,hS),hS.z}function lP(t,e,r){return e==null||r==null?t.definedChanged:e==="on-the-ground"&&r==="on-the-ground"?t.staysOnTheGround:e===r||e!=="on-the-ground"&&r!=="on-the-ground"?ns.UPDATE:t.onTheGroundChanged}function Nh(t){return t==="relative-to-ground"||t==="relative-to-scene"}function G_(t){return t!=="absolute-height"}function _ot(t,e,r,i,s){B_(e,r,s,i,hS),u2e(t,hS.verticalDistanceToGround);const n=hS.sampledElevation,o=Ls(Eot,t.transformation);return bI[0]=e.x,bI[1]=e.y,bI[2]=hS.z,Tl(e.spatialReference,bI,o,i.spatialReference)?t.transformation=o:console.warn("Could not locate symbol object properly, it might be misplaced"),n}function vot(t,e,r,i,s,n){let o=0;const a=n.spatialReference;e*=3,i*=3;for(let l=0;l<s;++l){const c=t[e],h=t[e+1],p=t[e+2],f=n.getElevation(c,h,p,a,"ground")??0;o+=f,r[i]=c,r[i+1]=h,r[i+2]=f,e+=3,i+=3}return o/s}function bot(t,e,r,i,s,n,o,a){let l=0;const c=a.calculateOffsetRenderUnits(o),h=a.featureExpressionInfoContext,p=n.spatialReference;e*=3,i*=3;for(let f=0;f<s;++f){const m=t[e],y=t[e+1],_=t[e+2],v=n.getElevation(m,y,_,p,"ground")??0;l+=v,r[i]=m,r[i+1]=y,r[i+2]=h==null?_+v+c:v+c,e+=3,i+=3}return l/s}function wot(t,e,r,i,s,n,o,a){let l=0;const c=a.calculateOffsetRenderUnits(o),h=a.featureExpressionInfoContext,p=n.spatialReference;e*=3,i*=3;for(let f=0;f<s;++f){const m=t[e],y=t[e+1],_=t[e+2],v=n.getElevation(m,y,_,p,"scene")??0;l+=v,r[i]=m,r[i+1]=y,r[i+2]=h==null?_+v+c:v+c,e+=3,i+=3}return l/s}function xot(t){const e=t.meterUnitOffset,r=t.featureExpressionInfoContext;return e!==0||r!=null}function Tot(t,e,r,i,s,n,o,a){const l=a.calculateOffsetRenderUnits(o),c=a.featureExpressionInfoContext;e*=3,i*=3;for(let h=0;h<s;++h){const p=t[e],f=t[e+1],m=t[e+2];r[i]=p,r[i+1]=f,r[i+2]=c==null?m+l:l,e+=3,i+=3}return 0}let cP=class{constructor(){this.verticalDistanceToGround=0,this.sampledElevation=0,this.z=0}};var ns;(function(t){t[t.NONE=0]="NONE",t[t.UPDATE=1]="UPDATE",t[t.RECREATE=2]="RECREATE"})(ns||(ns={}));const Sot={"absolute-height":{applyElevationAlignmentBuffer:Tot,requiresAlignment:xot},"on-the-ground":{applyElevationAlignmentBuffer:vot,requiresAlignment:()=>!0},"relative-to-ground":{applyElevationAlignmentBuffer:bot,requiresAlignment:()=>!0},"relative-to-scene":{applyElevationAlignmentBuffer:wot,requiresAlignment:()=>!0}},Eot=be(),hS=new cP,bI=C();function DY(t){return t.mapPositions!=null}function d2e(t,e,r,i,s){const n=t.stageObject,o=n.geometries;let a=0;for(const l of o){if(!DY(l))continue;const{update:c,averageGeometrySampledElevation:h}=f2e(l,e,r,i,s);a+=h,c&&n.geometryVertexAttrsUpdated(l)}return a/o.length}function $b(t,e,r,i,s,n){const o=t.stageObject,a=e.centerPointInElevationSR;let l=0;o.usesVerticalDistanceToGround?(i(a,yl),u2e(o,yl.verticalDistanceToGround),l=yl.sampledElevation):(i(a,yl),e.mode!=="absolute-height"&&(l=yl.sampledElevation));const c=Ls(Cot,n??o.transformation),h=se(p2e,c[12],c[13],c[14]);ni.TESTS_DISABLE_OPTIMIZATIONS?(gl[0]=a.x,gl[1]=a.y,gl[2]=yl.z,Tl(a.spatialReference,gl,c,s.spatialReference)&&(n?Ls(n,c):o.transformation=c)):s.setAltitudeOfTransformation(yl.z,c);const p=NY/s.unitInMeters;return(Math.abs(c[12]-h[0])>=p||Math.abs(c[13]-h[1])>=p||Math.abs(c[14]-h[2])>=p)&&(n?Ls(n,c):o.transformation=c),l}const Cot=be();function Aot(t,e,r,i,s){const n=t.graphics3DSymbolLayer.lodRenderer;if(n==null)return 0;const o=e.centerPointInElevationSR;i(o,yl);const a=e.mode!=="absolute-height"?yl.sampledElevation:0,l=n.instanceData,c=t.instanceIndex,h=Rot;l.getGlobalTransform(c,h);const p=se(p2e,h[12],h[13],h[14]);ni.TESTS_DISABLE_OPTIMIZATIONS?(gl[0]=o.x,gl[1]=o.y,gl[2]=yl.z,Tl(o.spatialReference,gl,h,s.spatialReference)&&l.setGlobalTransform(c,h)):s.setAltitudeOfTransformation(yl.z,h);const f=NY/s.unitInMeters;return(ni.TESTS_DISABLE_OPTIMIZATIONS||Math.abs(h[12]-p[0])>=f||Math.abs(h[13]-p[1])>=f||Math.abs(h[14]-p[2])>=f)&&l.setGlobalTransform(c,h),a}function Oot(t,e,r,i,s){const n=t.stageObject,o=n.geometries;if(o.length===0)return 0;let a=0,l=null,c=0,h=!1;for(const p of o){if(!DY(p))continue;const f=p.vertexAttributes.get(E.POSITION);if(f!==l){const{update:m,averageGeometrySampledElevation:y}=f2e(p,e,r,i,s);c=y,l=f,h=m}h&&n.geometryVertexAttrsUpdated(p),a+=c}return a/o.length}const NY=.01,gl=C(),Ou=C(),xx=C(),Rot=be(),p2e=C(),yl=new cP;function f2e(t,e,r,i,s){let n=!1;const o=t.shaderTransformation,a=e.requiresSampledElevationInfo;Ou[0]=o[12],Ou[1]=o[13],Ou[2]=o[14],t.invalidateBoundingInfo();const l=t.getMutableAttribute(E.POSITION),c=l.data,h=l.size,p=c.length/h,f=new fY(t.mapPositions,r);let m=0,y=0;for(let _=0;_<p;_++){if(xx[0]=c[m],xx[1]=c[m+1],xx[2]=c[m+2],i(f,yl),a&&(y+=yl.sampledElevation),ni.TESTS_DISABLE_OPTIMIZATIONS)c[m]=f.array[f.offset],c[m+1]=f.array[f.offset+1],c[m+2]=yl.z,oi(c,r,m,c,s.spatialReference,m,1),c[m]-=Ou[0],c[m+1]-=Ou[1],c[m+2]-=Ou[2],n=!0;else{gl[0]=c[m]+Ou[0],gl[1]=c[m+1]+Ou[1],gl[2]=c[m+2]+Ou[2],s.setAltitude(gl,yl.z),c[m]=gl[0]-Ou[0],c[m+1]=gl[1]-Ou[1],c[m+2]=gl[2]-Ou[2];const v=NY/s.unitInMeters;(Math.abs(xx[0]-c[m])>=v||Math.abs(xx[1]-c[m+1])>=v||Math.abs(xx[2]-c[m+2])>=v)&&(n=!0)}m+=h,f.offset+=3}return y/=p,{update:n,averageGeometrySampledElevation:y}}const Pot=Q.getLogger("esri.views.3d.layers.graphics.featureExpressionInfoUtils");function Mot(t){return{cachedResult:t.cachedResult,arcade:t.arcade?{func:t.arcade.func,context:t.arcade.modules.arcadeUtils.createExecContext(null,{sr:t.arcade.context.spatialReference}),modules:t.arcade.modules}:null}}function k$t(t){const e=t&&t.expression;if(typeof e=="string"){const r=y2e(e);if(r!=null)return{cachedResult:r}}return null}async function V$t(t,e,r,i){const s=t&&t.expression;if(typeof s!="string")return null;const n=y2e(s);if(n!=null)return{cachedResult:n};const o=await E_();Xt(r);const a=o.arcadeUtils,l=a.createSyntaxTree(s);return a.dependsOnView(l)?(i?.error("Expressions containing '$view' are not supported on ElevationInfo"),{cachedResult:0}):{arcade:{func:a.createFunction(l),context:a.createExecContext(null,{sr:e}),modules:o}}}function m2e(t,e,r){return t.arcadeUtils.createFeature(e.attributes,e.geometry,r)}function f6(t,e){if(t!=null&&!g2e(t)){if(!e||!t.arcade)return void Pot.errorOncePerTick("Arcade support required but not provided");const r=e;r._geometry&&(r._geometry=s2e(r._geometry)),t.arcade.modules.arcadeUtils.updateExecContext(t.arcade.context,e)}}function Iot(t){if(t!=null){if(g2e(t))return t.cachedResult;const e=t.arcade;let r=e?.modules.arcadeUtils.executeFunction(e.func,e.context);return typeof r!="number"&&(t.cachedResult=0,r=0),r}return 0}function z$t(t,e=!1){let r=t&&t.featureExpressionInfo;const i=r&&r.expression;return e||i==="0"||(r=null),r??null}const $ot={cachedResult:0};function g2e(t){return t.cachedResult!=null}function y2e(t){return t==="0"?0:null}let mp=class _2e{constructor(){this._meterUnitOffset=0,this._renderUnitOffset=0,this._unit="meters",this._metersPerElevationInfoUnit=1,this._featureExpressionInfoContext=null,this.centerPointInElevationSR=null,this.mode=null}get featureExpressionInfoContext(){return this._featureExpressionInfoContext}get meterUnitOffset(){return this._meterUnitOffset}get unit(){return this._unit}set unit(e){this._unit=e,this._metersPerElevationInfoUnit=DVe(e)}get requiresSampledElevationInfo(){return this.mode!=="absolute-height"}reset(){this.mode=null,this._meterUnitOffset=0,this._renderUnitOffset=0,this._featureExpressionInfoContext=null,this.unit="meters"}set offsetMeters(e){this._meterUnitOffset=e,this._renderUnitOffset=0}set offsetElevationInfoUnits(e){this._meterUnitOffset=e*this._metersPerElevationInfoUnit,this._renderUnitOffset=0}addOffsetRenderUnits(e){this._renderUnitOffset+=e}geometryZWithOffset(e,r){const i=this.calculateOffsetRenderUnits(r);return this.featureExpressionInfoContext!=null?i:e+i}calculateOffsetRenderUnits(e){let r=this._meterUnitOffset;const i=this.featureExpressionInfoContext;return i!=null&&(r+=Iot(i)*this._metersPerElevationInfoUnit),r/e.unitInMeters+this._renderUnitOffset}setFromElevationInfo(e){this.mode=e.mode,this.unit=LVe(e.unit)?e.unit:"meters",this.offsetElevationInfoUnits=e.offset??0}updateFeatureExpressionInfoContext(e,r,i){if(e==null)return void(this._featureExpressionInfoContext=null);const s=e&&e.arcade;s&&r!=null&&i!=null?(this._featureExpressionInfoContext=Mot(e),f6(this._featureExpressionInfoContext,m2e(s.modules,r,i))):this._featureExpressionInfoContext=e}static fromElevationInfo(e){const r=new _2e;return e!=null&&r.setFromElevationInfo(e),r}},Lot=class{constructor(e,r,i){this.graphic=e,this.renderingInfo=r,this.layer=i}},Dot=class{constructor(e,r,i){this.baseMaterial=e,this.edgeMaterials=r,this.properties=i}},nm=class{get isElevationSource(){return!!this.stageObject.lastValidElevationBB}constructor(e,r,i,s,n,o,a,l=null){this.graphics3DSymbolLayer=e,this.stageObject=r,this._uniqueGeometries=i,this._uniqueMaterials=s,this._sharedResource=n,this.elevationAligner=o,this.elevationContext=a,this._edgeState=l,this.type="object3d",this._stageLayer=null,this._visible=!1,this._addedToStage=!1,this.alignedSampledElevation=0,this.needsElevationUpdates=!1,this.useObjectOriginAsAttachmentOrigin=!1}initialize(e){this._stageLayer=e;const r=e.stage;r.addMany(this._uniqueMaterials),r.addMany(this._uniqueGeometries),r.add(this.stageObject)}destroy(){if(!this._stageLayer)return;const e=this._stageLayer.stage;e.removeMany(this._uniqueMaterials),e.removeMany(this._uniqueGeometries),e.remove(this.stageObject),this._addedToStage&&(this._stageLayer.remove(this.stageObject),this._addedToStage=!1);const r=e.renderer.ensureEdgeView();r.hasObject(this.stageObject)&&r.removeObject(this.stageObject),this.stageObject.dispose(),this._sharedResource!=null&&this._sharedResource.release(),this._visible=!1,this._stageLayer=null}layerOpacityChanged(e,r){if(this._edgeState==null)return;const i=Cne(this._edgeState.baseMaterial);let s=!1;for(const n of this._edgeState.edgeMaterials)n.objectTransparency!==i&&(n.objectTransparency=i,s=!0);s&&this.resetEdgeObject(r),this._stageLayer.stage.renderer.ensureEdgeView().updateAllComponentOpacities(this.stageObject,[e])}slicePlaneEnabledChanged(e,r){this._edgeState!=null&&(this._stageLayer.stage.renderer.ensureEdgeView().updateAllComponentMaterials(this.stageObject,this._edgeState.edgeMaterials,{hasSlicePlane:e},!r),this._edgeState.properties.hasSlicePlane=e)}setVisibility(e){if(this._stageLayer!=null&&this._visible!==e&&(this._visible=e,this.stageObject.visible=e,this._visible&&!this._addedToStage&&(this._stageLayer.add(this.stageObject),this._addedToStage=!0),this._edgeState)){const r=this._stageLayer.stage.renderer.ensureEdgeView();r.hasObject(this.stageObject)?r.updateObjectVisibility(this.stageObject,e):e&&this._addOrUpdateEdgeObject(r,!1)}}get visible(){return this._visible}alignWithElevation(e,r,i,s){if(this.elevationAligner==null)return;i!=null&&f6(this.elevationContext.featureExpressionInfoContext,i);const n=(o,a)=>B_(o,e,this.elevationContext,r,a);this.alignedSampledElevation=this.elevationAligner(this,this.elevationContext,e.spatialReference,n,r),this.resetEdgeObject(s)}alignWithAbsoluteElevation(e,r,i){const s=(n,o)=>{o.sampledElevation=e,o.verticalDistanceToGround=0,o.z=e};this.alignedSampledElevation=this.elevationAligner(this,this.elevationContext,null,s,r),this.resetEdgeObject(i)}getCenterObjectSpace(e=C()){return ie(e,this.stageObject.boundingVolumeObjectSpace.bounds)}getBoundingBoxObjectSpace(e=pn()){const r=this.stageObject.boundingVolumeObjectSpace;return Ige(e,r.min),$ge(e,r.max),e}computeAttachmentOrigin(e){if(this.useObjectOriginAsAttachmentOrigin){const r=this.stageObject.shaderTransformation;e.render.origin[0]+=r[12],e.render.origin[1]+=r[13],e.render.origin[2]+=r[14],e.render.num++}else for(const r of this.stageObject.geometries)r.computeAttachmentOrigin(mm)&&($e(mm,mm,this.stageObject.shaderTransformation),ce(e.render.origin,e.render.origin,mm),e.render.num++)}async getProjectedBoundingBox(e,r,i,s,n){const o=this.getBoundingBoxObjectSpace(n),a=Not,l=BW(o)?1:a.length;for(let h=0;h<l;h++){const p=a[h];Ny[0]=o[p[0]],Ny[1]=o[p[1]],Ny[2]=o[p[2]],$e(Ny,Ny,this.stageObject.transformation),Cv[3*h]=Ny[0],Cv[3*h+1]=Ny[1],Cv[3*h+2]=Ny[2]}if(!e(Cv,0,l))return null;xi(o);let c=null;this.calculateRelativeScreenBounds&&(c=this.calculateRelativeScreenBounds());for(let h=0;h<3*l;h+=3){for(let p=0;p<3;p++)o[p]=Math.min(o[p],Cv[h+p]),o[p+3]=Math.max(o[p+3],Cv[h+p]);c&&i.push({location:Cv.slice(h,h+3),screenSpaceBoundingRect:c})}if(r&&r.service&&this.elevationContext.mode!=="absolute-height"){Bd(o,mm);const h=this.elevationContext.mode==="relative-to-scene"?"scene":"ground";let p=0;if(r.useViewElevation)p=r.service.getElevation(mm[0],mm[1],h)??0;else try{const f=LY(o,r.service.spatialReference,r);p=await r.service.queryElevation(mm[0],mm[1],s,f,h)??0}catch{}Mge(o,0,0,-this.alignedSampledElevation+p)}return o}addObjectState(e,r){e===zg.Highlight&&r.addObject(this.stageObject,this.stageObject.highlight()),e===zg.MaskOccludee&&r.addObject(this.stageObject,this.stageObject.maskOccludee())}removeObjectState(e){e.removeObject(this.stageObject)}resetEdgeObject(e){if(this._edgeState==null)return;const r=this._stageLayer.stage.renderer.ensureEdgeView();this._visible?this._addOrUpdateEdgeObject(r,e):r.removeObject(this.stageObject)}_addOrUpdateEdgeObject(e,r){const i=this._edgeState;if(i==null)return;const s=Cne(i.baseMaterial);for(const n of i.edgeMaterials)n.objectTransparency=s;e.addOrUpdateObject3D(this.stageObject,i.edgeMaterials,i.properties,!r).then(()=>this._stageLayer?.sync())}};function Cne(t){return t.isVisible()?t.parameters.transparent?Bt.TRANSPARENT:Bt.OPAQUE:Bt.INVISIBLE}const Cv=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],Ny=C(),mm=C(),Not=[[0,1,2],[3,1,2],[0,4,2],[3,4,2],[0,1,5],[3,1,5],[0,4,5],[3,4,5]];let v2e=class{constructor(e,r=null){this.labelText=r,this.elevationOffset=e??0}};var Is;(function(t){t[t.RecreateSymbol=0]="RecreateSymbol",t[t.RecreateGraphics=1]="RecreateGraphics",t[t.FastUpdate=2]="FastUpdate"})(Is||(Is={}));let FY=class{constructor(e){this.schedule=e,this._abortController=null,this._loadStatus=Qc.LOADING,this._loadError=null,this._loader=null,this.logger=null}destroy(){this.abortLoad()}get loadStatus(){return this._loadStatus}load(e,r){return this._loadStatus===Qc.LOADED?(e&&e(),this._loader??Promise.resolve()):this._loadStatus===Qc.FAILED?(r&&r(this._loadError),this._loader??Promise.resolve()):(this._loader==null&&(this._abortController=new AbortController,this._loader=this.doLoad(this._abortController.signal).then(()=>{this._abortController=null,this._loadStatus=Qc.LOADED},i=>{throw this._loadError=i,this._abortController=null,this._loadStatus=Qc.FAILED,!ms(i)&&this.logger&&i.message&&this.logger.warn(i.message),i})),this._loader.then(e,r).catch(()=>{}),this._loader)}abortLoad(){this._abortController!=null?this._abortController=pu(this._abortController):this._loadStatus===Qc.LOADING&&(this._loadStatus=Qc.FAILED),this._loader=null}};var Qc;(function(t){t[t.LOADING=0]="LOADING",t[t.LOADED=1]="LOADED",t[t.FAILED=2]="FAILED"})(Qc||(Qc={}));const b2e=3,lH=3,w2e=10;let x2e=class{constructor(e,r=null){this.geometry=e,this.textures=r}};function wI(t){const e=[];return t.levels.forEach(r=>r.components.forEach(i=>e.push(i.geometry.material))),aF(e)}function Ane(t){const e=new Array;return t.levels.forEach(r=>{r.components.forEach(i=>{i.textures!=null&&e.push(...i.textures)})}),aF(e)}function T2e(t){const e=t.components.map(r=>r.geometry);return aF(e)}function One(t){const e=[];return t.levels.forEach(r=>{r.components.forEach(i=>{e.push(i.geometry)})}),aF(e)}function Fot(t){switch(t){case"sphere":case"cube":case"diamond":case"cylinder":case"cone":case"inverted-cone":case"tetrahedron":return!0}return!1}function S2e(t,e){const r=(i,s,n=!1)=>({levels:i.map(o=>{const a=s(o.tesselation);return n&&KQe(a),{components:[new x2e(a)],faceCount:a.indexCount/3,minScreenSpaceRadius:o.minScreenSpaceRadius}})});switch(t){case"sphere":return r([{tesselation:0,minScreenSpaceRadius:0},{tesselation:1,minScreenSpaceRadius:8},{tesselation:2,minScreenSpaceRadius:16},{tesselation:3,minScreenSpaceRadius:50},{tesselation:4,minScreenSpaceRadius:250}],i=>XQe(e,.5,i,!0));case"cube":return r([{tesselation:0,minScreenSpaceRadius:0}],()=>VQe(e,1));case"cone":return r(s9,i=>Rie(e,1,.5,i,!1),!0);case"inverted-cone":return r(s9,i=>Rie(e,1,.5,i,!0),!0);case"cylinder":return r(s9,i=>JQe(e,1,.5,i,[0,0,1],[0,0,.5]));case"tetrahedron":return r([{tesselation:0,minScreenSpaceRadius:0}],()=>ZQe(e,1),!0);case"diamond":return r([{tesselation:0,minScreenSpaceRadius:0}],()=>jQe(e,1),!0);default:return}}const s9=[{tesselation:6,minScreenSpaceRadius:0},{tesselation:18,minScreenSpaceRadius:7},{tesselation:64,minScreenSpaceRadius:65}],UY={primitivesPerFeature:0,primitivesPerCoordinate:0,drawCallsPerFeature:0,estimated:!0,memory:{bytesPerFeature:0,bytesPerCoordinate:0,bytesPerFeatureLabel:0,resourceBytes:0,draped:{bytesPerFeature:0,bytesPerFeatureLabel:0,bytesPerCoordinate:0}}};function Z$t(t){return t.type==="web-style"?UY:kY(t.symbolLayers.toArray().map(e=>E2e(t,e)))}function kY(t){let e=0,r=0,i=0,s=!1,n=0;const o={bytesPerFeature:0,bytesPerFeatureLabel:0,bytesPerCoordinate:0,resourceBytes:0,draped:{bytesPerFeature:0,bytesPerFeatureLabel:0,bytesPerCoordinate:0}};for(const a of t)a!=null&&(e+=a.primitivesPerFeature,r+=a.primitivesPerCoordinate,i+=a.drawCallsPerFeature,o.bytesPerFeature+=a.memory.bytesPerFeature,o.bytesPerFeatureLabel+=a.memory.bytesPerFeatureLabel,o.bytesPerCoordinate+=a.memory.bytesPerCoordinate,o.resourceBytes+=a.memory.resourceBytes,o.draped.bytesPerFeature+=a.memory.bytesPerFeature,o.draped.bytesPerFeatureLabel+=a.memory.bytesPerFeatureLabel,o.draped.bytesPerCoordinate+=a.memory.bytesPerCoordinate,s=s||a.estimated,++n);return{primitivesPerFeature:e,primitivesPerCoordinate:r,drawCallsPerFeature:i,estimated:s,memory:o,numComplexities:n}}function X$t(t){const e=kY(t);return e.numComplexities>0&&(e.primitivesPerFeature/=e.numComplexities,e.primitivesPerCoordinate/=e.numComplexities,e.drawCallsPerFeature/=e.numComplexities,e.memory.bytesPerFeature/=e.numComplexities,e.memory.bytesPerFeatureLabel/=e.numComplexities,e.memory.bytesPerCoordinate/=e.numComplexities,e.memory.resourceBytes/=e.numComplexities,e.memory.draped.bytesPerFeature/=e.numComplexities,e.memory.draped.bytesPerFeatureLabel/=e.numComplexities,e.memory.draped.bytesPerCoordinate/=e.numComplexities),e}const Rne={};function E2e(t,e){const r=C2e(t,e),i=eWe(e)?2:0;switch(e.type){case"extrude":return{primitivesPerFeature:-4,primitivesPerCoordinate:4,drawCallsPerFeature:i,estimated:!1,memory:r};case"fill":return t.type==="mesh-3d"?{primitivesPerFeature:0,primitivesPerCoordinate:0,drawCallsPerFeature:i,estimated:!1,memory:r}:e.outline!=null&&e.outline.size>0?{primitivesPerFeature:-4,primitivesPerCoordinate:3,drawCallsPerFeature:0,estimated:!1,memory:r}:{primitivesPerFeature:-2,primitivesPerCoordinate:1,drawCallsPerFeature:0,estimated:!1,memory:r};case"water":return{primitivesPerFeature:-2,primitivesPerCoordinate:1,drawCallsPerFeature:0,estimated:!1,memory:r};case"line":return{primitivesPerFeature:-2,primitivesPerCoordinate:2,drawCallsPerFeature:0,estimated:!1,memory:r};case"object":return e.resource?.href?{primitivesPerFeature:16,primitivesPerCoordinate:0,drawCallsPerFeature:0,estimated:!0,memory:r}:{...Uot(e.resource&&e.resource.primitive||qge),memory:r};case"path":{let s=0,n=0;switch(e.profile){case"circle":s=w2e;break;case"quad":s=4;break;default:return void(e.profile,void 0)}switch(e.join??"simple"){case"round":n=b2e;break;case"miter":case"bevel":n=1;break;default:return}const o=2*s,a=s*n*2;let l=-2*a-o;switch(e.cap){case"none":break;case"butt":case"square":l+=2*(s-1);break;case"round":l+=2*(s*(lH-1)*2+s);break;default:return}return{primitivesPerFeature:l,primitivesPerCoordinate:a+o,drawCallsPerFeature:0,estimated:!1,memory:r}}case"text":case"icon":return{primitivesPerFeature:2,primitivesPerCoordinate:0,drawCallsPerFeature:0,estimated:!1,memory:r};default:return}}function C2e(t,e){const r=t.type==="point-3d";switch(e.type){case"extrude":return e.edges&&e.edges.size>0?el.EXTRUDE_EDGES:el.EXTRUDE;case"fill":return e.outline!=null&&e.outline.size>0?el.FILL_OUTLINE:el.FILL;case"water":return el.FILL;case"line":return e.join==="round"?el.LINE_ROUND:el.LINE_MITER;case"path":switch(e.join){case"round":switch(e.profile){case"circle":return el.PATH_ROUND_CIRCLE;case"quad":return el.PATH_ROUND_QUAD;default:return void(e.profile,void 0)}case"miter":case"bevel":switch(e.profile){case"circle":return el.PATH_MITER_CIRCLE;case"quad":return el.PATH_MITER_QUAD;default:return void(e.profile,void 0)}default:return}case"object":return r?el.OBJECT_POINT:el.OBJECT_POLYGON;case"icon":case"text":return r?el.ICON_POINT:el.ICON_POLYGON;default:return}}function Uot(t){let e=Rne[t];if(e)return e;const r=S2e(t,null);return e={primitivesPerFeature:T2e(r.levels[0]).reduce((i,s)=>i+s.indices.get(E.POSITION).length/3,0),primitivesPerCoordinate:0,drawCallsPerFeature:0,estimated:!1},Rne[t]=e,e}const el={ICON_POINT:{bytesPerFeature:2321.5204640676384,bytesPerFeatureLabel:990.45722,bytesPerCoordinate:0,resourceBytes:0,draped:{bytesPerFeature:2169.5155951150787,bytesPerFeatureLabel:999.2598599999999,bytesPerCoordinate:0}},ICON_POLYGON:{bytesPerFeature:3822.4566594216512,bytesPerFeatureLabel:1004.4288266666666,bytesPerCoordinate:3.8232947206245864,resourceBytes:0,draped:{bytesPerFeature:3656.161389156324,bytesPerFeatureLabel:994.9227800000001,bytesPerCoordinate:3.836714603517761}},OBJECT_POINT:{bytesPerFeature:1286.2669145138564,bytesPerFeatureLabel:1011.4901900000001,bytesPerCoordinate:0,resourceBytes:0,draped:{bytesPerFeature:1286.2669145138564,bytesPerFeatureLabel:1011.4901900000001,bytesPerCoordinate:0}},OBJECT_POLYGON:{bytesPerFeature:2796.828455517831,bytesPerFeatureLabel:1012.9951500000002,bytesPerCoordinate:4.051546356517487,resourceBytes:0,draped:{bytesPerFeature:2796.828455517831,bytesPerFeatureLabel:1012.9951500000002,bytesPerCoordinate:4.051546356517487}},LINE_MITER:{bytesPerFeature:4906.045480276492,bytesPerFeatureLabel:1002.8815266666666,bytesPerCoordinate:24.04850207798191,resourceBytes:0,draped:{bytesPerFeature:4315.785832179941,bytesPerFeatureLabel:998.7028333333334,bytesPerCoordinate:19.457038722015074}},LINE_ROUND:{bytesPerFeature:4893.576398024015,bytesPerFeatureLabel:1015.8812866666666,bytesPerCoordinate:24.039686621147293,resourceBytes:0,draped:{bytesPerFeature:4321.076505943878,bytesPerFeatureLabel:1008.7058400000001,bytesPerCoordinate:19.522527447599565}},PATH_MITER_CIRCLE:{bytesPerFeature:27475.37385725739,bytesPerFeatureLabel:945.1915,bytesPerCoordinate:1936.190695268645,resourceBytes:0,draped:{bytesPerFeature:27475.37385725739,bytesPerFeatureLabel:945.1915,bytesPerCoordinate:1936.190695268645}},PATH_ROUND_CIRCLE:{bytesPerFeature:13432.532036888486,bytesPerFeatureLabel:949.8167000000001,bytesPerCoordinate:4250.913048917402,resourceBytes:0,draped:{bytesPerFeature:13432.532036888486,bytesPerFeatureLabel:949.8167000000001,bytesPerCoordinate:4250.913048917402}},PATH_MITER_QUAD:{bytesPerFeature:17083.041162790672,bytesPerFeatureLabel:1006.4104,bytesPerCoordinate:1543.9135284683243,resourceBytes:0,draped:{bytesPerFeature:17083.041162790672,bytesPerFeatureLabel:1006.4104,bytesPerCoordinate:1543.9135284683243}},PATH_ROUND_QUAD:{bytesPerFeature:24054.406240577355,bytesPerFeatureLabel:976.0122999999999,bytesPerCoordinate:2683.863857257418,resourceBytes:0,draped:{bytesPerFeature:24054.406240577355,bytesPerFeatureLabel:976.0122999999999,bytesPerCoordinate:2683.863857257418}},FILL:{bytesPerFeature:5336.950602511737,bytesPerFeatureLabel:993.6785799999999,bytesPerCoordinate:9.558162275921951,resourceBytes:0,draped:{bytesPerFeature:4643.732435264264,bytesPerFeatureLabel:1003.6394400000001,bytesPerCoordinate:8.123952159573538}},FILL_OUTLINE:{bytesPerFeature:8210.8457089066,bytesPerFeatureLabel:1006.2871066666667,bytesPerCoordinate:14.496686428135353,resourceBytes:0,draped:{bytesPerFeature:6982.149803527473,bytesPerFeatureLabel:1005.1158800000001,bytesPerCoordinate:11.034666572000932}},EXTRUDE:{bytesPerFeature:16336.386002724352,bytesPerFeatureLabel:1013.2957066666665,bytesPerCoordinate:40.50904192903909,resourceBytes:0,draped:{bytesPerFeature:16336.386002724352,bytesPerFeatureLabel:1013.2957066666665,bytesPerCoordinate:40.50904192903909}},EXTRUDE_EDGES:{bytesPerFeature:18251.260762353977,bytesPerFeatureLabel:1044.1864133333333,bytesPerCoordinate:40.594518397678755,resourceBytes:0,draped:{bytesPerFeature:18251.260762353977,bytesPerFeatureLabel:1044.1864133333333,bytesPerCoordinate:40.594518397678755}}},Tx=Q.getLogger("esri.views.3d.layers.graphics.Graphics3DSymbolLayer");let om=class extends FY{constructor(e,r,i,s){super(i.schedule),this.symbol=e,this.symbolLayer=r,this._context=i,this._elevationInfoOverride=null,this.ignoreDrivers=!1,this._drivenProperties={color:!1,opacity:!1,opacityAlwaysOpaque:!0,size:!1},this.complexity=null,this.logger=Tx,this._elevationOptions={supportsOffsetAdjustment:!1,supportsOnTheGround:!0},this.skipHighSymbolLodsChanged=!0,this._renderPriority=s.renderPriority,this._renderPriorityStep=s.renderPriorityStep,this._elevationContext=new mp,this.complexity=this.computeComplexity(),this.ignoreDrivers=s.ignoreDrivers,this.ignoreDrivers||(this._drivenProperties=Pne(this._context.renderer)),this._updateElevationContext()}getCachedSize(){return null}get extentPadding(){return 0}_drivenPropertiesChanged(e){if(this.ignoreDrivers)return!1;const r=this._drivenProperties,i=Pne(e);return i.color!==r.color||i.opacity!==r.opacity||i.opacityAlwaysOpaque!==r.opacityAlwaysOpaque||i.size!==r.size}get needsDrivenTransparentPass(){return this._drivenProperties.opacity&&!this._drivenProperties.opacityAlwaysOpaque}_logGeometryCreationWarnings(e,r,i,s){const n=e.projectionSuccess,o="polygons"in e?e.polygons:null,a=`${s} geometry failed to be created`;let l=null;n?!this._logGeometryValidationWarnings(r,i,s)&&o&&o.length===0&&i==="rings"&&r.length>0&&r[0].length>2&&(l=`${a} (filled rings should use clockwise winding - try reversing the order of vertices)`):l=`${a} (failed to project geometry to view spatial reference)`,l&&Tx.warnOncePerTick(l)}_logGeometryValidationWarnings(e,r,i){const s=`${i} geometry failed to be created`;return!e.length||e.length===1&&!e[0].length?(Tx.warnOncePerTick(`${s} (no ${r} were defined)`),!0):(!Array.isArray(e)||!Array.isArray(e[0]))&&(Tx.warnOncePerTick(`${s} (${r} should be defined as a 2D array)`),!0)}_validateGeometry(e,r=null,i=null){if(r!=null&&!r.includes(e.type))return this.logger.warn("unsupported geometry type for "+i+` symbol: ${e.type}`),!1;if(e.type==="point"){const s=e;if(!isFinite(s.x)||!isFinite(s.y))return Tx.warn("point coordinate is not a valid number, graphic skipped"),!1}return!0}_defaultElevationInfoNoZ(){return kot}_defaultElevationInfoZ(){return Vot}_updateElevationContext(){this._elevationInfoOverride!=null?(this._elevationContext.setFromElevationInfo(this._elevationInfoOverride),this._elevationContext.updateFeatureExpressionInfoContext(null)):this._context.layer.elevationInfo?(this._elevationContext.setFromElevationInfo(this._context.layer.elevationInfo),this._elevationContext.updateFeatureExpressionInfoContext(this._context.featureExpressionInfoContext)):this._elevationContext.reset()}getDefaultElevationInfo(e){return e.hasZ?this._defaultElevationInfoZ():this._defaultElevationInfoNoZ()}getGeometryElevationMode(e,r=this.getDefaultElevationInfo(e)){return this._elevationContext.mode||r.mode}setElevationInfoOverride(e){this._elevationInfoOverride=e,this._updateElevationContext()}setGraphicElevationContext(e,r){const i=e.geometry,s=this.getDefaultElevationInfo(i);r.unit=this._elevationContext.unit!=null?this._elevationContext.unit:s.unit,r.mode=this.getGeometryElevationMode(i,s),r.offsetMeters=this._elevationContext.meterUnitOffset??s.offset??0;const n=!this._elevationOptions.supportsOnTheGround&&r.mode==="on-the-ground";n&&(r.mode="relative-to-ground",r.offsetMeters=0);const o=n?$ot:this._elevationContext.featureExpressionInfoContext;return r.updateFeatureExpressionInfoContext(o,e,this._context.layer),r}prepareSymbolLayerPatch(e){}updateGeometry(e,r){return!1}updateTransform(e,r,i,s){return!1}onRemoveGraphic(e){}_getLayerOpacity(){return this._context.graphicsCoreOwner&&"fullOpacity"in this._context.graphicsCoreOwner?this._context.graphicsCoreOwner.fullOpacity??0:this._context.layer.opacity??1}_getCombinedOpacity(e,r=Mne){let i=1;return this.draped||(i*=this._getLayerOpacity()),this._drivenProperties.opacity||(e!=null?i*=e.a:r.hasIntrinsicColor||(i=0)),i}_getCombinedOpacityAndColor(e,r=Mne){const i=this._getCombinedOpacity(e,r);if(this._drivenProperties.color)return J3(null,i);const s=e!=null?ze.toUnitRGB(e):fg;return J3(s,i)}_getVertexOpacityAndColor(e,r=null){const i=this._drivenProperties.color?e.color:null,s=this._drivenProperties.opacity?e.opacity:null,n=J3(i,s);return r&&(n[0]*=r,n[1]*=r,n[2]*=r,n[3]*=r),n}isFastUpdatesEnabled(){return this._fastUpdates!=null}computeComplexity(){return E2e(this.symbol,this.symbolLayer)}globalPropertyChanged(e,r,i){switch(e){case"opacity":return this.layerOpacityChanged(r,i),!0;case"elevationInfo":{const s=this._elevationContext.mode;return this._updateElevationContext(),this.layerElevationInfoChanged(r,i,s)!==ns.RECREATE}case"slicePlaneEnabled":return this.slicePlaneEnabledChanged(r,i);case"physicalBasedRenderingEnabled":return this.physicalBasedRenderingChanged();case"pixelRatio":return this.pixelRatioChanged;case"skipHighSymbolLods":return this.skipHighSymbolLodsChanged;default:return!1}}get pixelRatioChanged(){return!0}updateGraphics3DGraphicElevationInfo(e,r,i){let s=ns.UPDATE;return e.forEach(n=>{const o=r(n);if(o!=null){const a=n.graphic;this.setGraphicElevationContext(a,o.elevationContext),o.needsElevationUpdates=i(o.elevationContext.mode)}else s=ns.RECREATE}),s}applyRendererDiff(e,r){return Is.RecreateSymbol}getFastUpdateAttrValues(e){if(!this._fastUpdates)return null;const r=this._fastUpdates.visualVariables,i=r.size?tp(r.size.field,e):0,s=r.color?tp(r.color.field,e):0,n=r.opacity?tp(r.opacity.field,e):0;return Lt(i,s,n,0)}get draped(){return this._draped}ensureDrapedStatus(e){return this._draped==null?(this._draped=e,!0):(e!==this.draped&&Tx.warnOnce("A symbol can only produce either draped or non-draped visualizations. Use two separate symbol instances for draped and non-draped graphics if necessary."),!1)}test(){const e=()=>({size:this._fastUpdates?.visualVariables.size?.field??null,color:this._fastUpdates?.visualVariables.color?.field??null,opacity:this._fastUpdates?.visualVariables.opacity?.field??null,rotation:this._fastUpdates?.visualVariables.rotation?.field??null});return{drivenProperties:this._drivenProperties,getVisVarFields:e}}};function Pne(t){const e={color:!1,opacity:!1,opacityAlwaysOpaque:!0,size:!1};return t&&"visualVariables"in t&&t.visualVariables&&t.visualVariables.forEach(r=>{switch(r.type){case"color":if(e.color=!0,r.stops)for(let i=0;i<r.stops.length;i++){const s=r.stops[i].color;s&&(e.opacity=!0,s.a<1&&(e.opacityAlwaysOpaque=!1))}break;case"opacity":e.opacity=!0,e.opacityAlwaysOpaque=!1;break;case"size":e.size=!0}}),e}const kot={mode:"on-the-ground",offset:0,unit:"meters"},Vot={mode:"absolute-height",offset:0,unit:"meters"},Mne={hasIntrinsicColor:!1};let ay=class extends eP{get geometries(){return this._geometries}get transformation(){return this._transformation??un}set transformation(e){this._transformation=Ls(this._transformation??be(),e),this._invalidateBoundingVolume(),this._emit("objectTransformation",this)}get shaderTransformation(){return this._shaderTransformation??this.transformation}set shaderTransformation(e){this._shaderTransformation=Ls(this._shaderTransformation??be(),e),this._invalidateBoundingVolume(),this._emit("objectShaderTransformation",this)}clearShaderTransformation(){this._shaderTransformation=void 0,this._invalidateBoundingVolume(),this._emit("objectShaderTransformation",this)}constructor(e={}){super(),this.type=ss.Object,this._hasVolatileTransformation=!1,this._parentLayer=null,this._visible=!0,this.castShadow=e.castShadow??!0,this.usesVerticalDistanceToGround=e.usesVerticalDistanceToGround??!1,this.graphicUid=e.graphicUid,this.layerUid=e.layerUid,e.isElevationSource&&(this.lastValidElevationBB=new A2e),this._geometries=e.geometries?Array.from(e.geometries):new Array}dispose(){this._geometries.length=0}get parentLayer(){return this._parentLayer}set parentLayer(e){et(this._parentLayer==null||e==null,"Object3D can only be added to a single Layer"),this._parentLayer=e}addGeometry(e){e.visible=this._visible,this._geometries.push(e),this._hasVolatileTransformation=this._hasVolatileTransformation||e.hasVolatileTransformation,this._emit("objectGeometryAdded",{object:this,geometry:e}),this._invalidateBoundingVolume()}removeGeometry(e){const r=this._geometries.splice(e,1)[0];r&&(this._emit("objectGeometryRemoved",{object:this,geometry:r}),this._invalidateBoundingVolume())}removeAllGeometries(){for(;this._geometries.length>0;)this.removeGeometry(0)}geometryVertexAttrsUpdated(e){this._emit("objectGeometryUpdated",{object:this,geometry:e}),this._invalidateBoundingVolume()}get visible(){return this._visible}set visible(e){if(this._visible!==e){this._visible=e;for(const r of this._geometries)r.visible=this._visible;this._emit("visibilityChanged",this)}}maskOccludee(){const e=new c4(zg.MaskOccludee);for(const r of this._geometries)r.occludees=Oj(r.occludees,e);return this._emit("occlusionChanged",this),e}removeOcclude(e){for(const r of this._geometries)r.occludees=Rj(r.occludees,e);this._emit("occlusionChanged",this)}highlight(){const e=new c4(zg.Highlight);for(const r of this._geometries)r.highlights=Oj(r.highlights,e);return this._emit("highlightChanged",this),e}removeHighlight(e){for(const r of this._geometries)r.highlights=Rj(r.highlights,e);this._emit("highlightChanged",this)}getCombinedStaticTransformation(e,r){return si(r,this.transformation,e.transformation)}getCombinedShaderTransformation(e,r=be()){return si(r,this.shaderTransformation,e.shaderTransformation)}hasVolativeTransformation(){return this._hasVolatileTransformation}get boundingVolumeWorldSpace(){return this._bvWorldSpace&&!this._hasVolatileTransformation||(this._bvWorldSpace=this._bvWorldSpace||new Ine,this._validateBoundingVolume(this._bvWorldSpace,Q3.WorldSpace)),this._bvWorldSpace}get boundingVolumeObjectSpace(){return this._bvObjectSpace&&!this._hasVolatileTransformation||(this._bvObjectSpace=this._bvObjectSpace||new Ine,this._validateBoundingVolume(this._bvObjectSpace,Q3.ObjectSpace)),this._bvObjectSpace}_validateBoundingVolume(e,r){const i=r===Q3.ObjectSpace;for(const s of this._geometries){const n=s.boundingInfo;n&&zot(n,e,i?s.shaderTransformation:this.getCombinedShaderTransformation(s))}Br(e.bounds,e.min,e.max,.5);for(const s of this._geometries){const n=s.boundingInfo;if(n==null)continue;const o=i?s.shaderTransformation:this.getCombinedShaderTransformation(s),a=v2(o);$e($ne,n.center,o);const l=di($ne,e.bounds),c=n.radius*a;e.bounds[3]=Math.max(e.bounds[3],l+c)}}_invalidateBoundingVolume(){const e=this._bvWorldSpace?.bounds;this._bvObjectSpace=this._bvWorldSpace=void 0,this._parentLayer&&e&&this._parentLayer.notifyObjectBBChanged(this,e)}_emit(e,r){this._parentLayer&&this._parentLayer.events.emit(e,r)}get test(){const e=this;return{hasGeometry:r=>e._geometries.includes(r),getGeometryIndex:r=>e._geometries.indexOf(r)}}},A2e=class{constructor(){this.min=Oe(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),this.max=Oe(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE)}isEmpty(){return this.max[0]<this.min[0]&&this.max[1]<this.min[1]&&this.max[2]<this.min[2]}},Ine=class extends A2e{constructor(){super(...arguments),this.bounds=gs()}};function zot(t,e,r){const i=t.bbMin,s=t.bbMax;if(u5(r)){const n=se(Bot,r[12],r[13],r[14]);ce($c,i,n),ce(Jh,s,n);for(let o=0;o<3;++o)e.min[o]=Math.min(e.min[o],$c[o]),e.max[o]=Math.max(e.max[o],Jh[o])}else if($e($c,i,r),la(i,s))for(let n=0;n<3;++n)e.min[n]=Math.min(e.min[n],$c[n]),e.max[n]=Math.max(e.max[n],$c[n]);else{$e(Jh,s,r);for(let n=0;n<3;++n)e.min[n]=Math.min(e.min[n],$c[n],Jh[n]),e.max[n]=Math.max(e.max[n],$c[n],Jh[n]);for(let n=0;n<3;++n){ie($c,i),ie(Jh,s),$c[n]=s[n],Jh[n]=i[n],$e($c,$c,r),$e(Jh,Jh,r);for(let o=0;o<3;++o)e.min[o]=Math.min(e.min[o],$c[o],Jh[o]),e.max[o]=Math.max(e.max[o],$c[o],Jh[o])}}}const Bot=C(),$c=C(),Jh=C(),$ne=C();var Q3;(function(t){t[t.WorldSpace=0]="WorldSpace",t[t.ObjectSpace=1]="ObjectSpace"})(Q3||(Q3={}));function VY(t,e,r,i,s,n){const o=t.clippingExtent;if(wo(e,c_,t.elevationProvider.spatialReference),o!=null&&!VW(o,c_))return null;wo(e,c_,t.renderCoordsHelper.spatialReference),r.shaderTransformer=n,r.localOrigin=t.localOriginFactory.getOrigin(c_);const a=new ay({geometries:[r],castShadow:!1,layerUid:t.layer.uid,graphicUid:s,usesVerticalDistanceToGround:!0});return{object:a,sampledElevation:_ot(a,e,t.elevationProvider,t.renderCoordsHelper,i)}}function iR(t,e,r){const i=t.elevationContext,s=r.spatialReference;wo(e,c_,s),i.centerPointInElevationSR=Dw(c_[0],c_[1],e.hasZ?c_[2]:0,s??null)}function sR(t){switch(t.type){case"point":return t;case"polygon":case"extent":return $Y(t);case"polyline":{const e=t.paths[0];if(!e||e.length===0)return null;const r=dfe(e,hfe(e)/2);return Dw(r[0],r[1],r[2],t.spatialReference)}case"mesh":return t.origin}return null}const c_=C();function O2e(){return new Float32Array(2)}function Got(t){const e=new Float32Array(2);return e[0]=t[0],e[1]=t[1],e}function ch(t,e){const r=new Float32Array(2);return r[0]=t,r[1]=e,r}function jot(t,e){return new Float32Array(t,e,2)}function R2e(){return O2e()}function P2e(){return ch(1,1)}function M2e(){return ch(1,0)}function I2e(){return ch(0,1)}const $2e=R2e(),L2e=P2e(),Hot=M2e(),qot=I2e();Object.freeze(Object.defineProperty({__proto__:null,ONES:L2e,UNIT_X:Hot,UNIT_Y:qot,ZEROS:$2e,clone:Got,create:O2e,createView:jot,fromValues:ch,ones:P2e,unitX:M2e,unitY:I2e,zeros:R2e},Symbol.toStringTag,{value:"Module"}));function Wot(t){const e=new wr,{vertex:r,fragment:i}=e;return r.include(a6),e.include(fSe,t),e.include(ps,t),e.attributes.add(E.UV0,"vec2"),r.uniforms.add(new sr("viewport",(s,n)=>n.camera.fullViewport),new Re("lineSize",(s,n)=>s.size>0?Math.max(1,s.size)*n.camera.pixelRatio:0),new Sr("pixelToNDC",(s,n)=>or(Dne,2/n.camera.fullViewport[2],2/n.camera.fullViewport[3])),new Re("borderSize",(s,n)=>s.borderColor!=null?n.camera.pixelRatio:0),new Sr("screenOffset",(s,n)=>or(Dne,s.screenOffset[0]*n.camera.pixelRatio,s.screenOffset[1]*n.camera.pixelRatio))),e.varyings.add("coverageSampling","vec4"),e.varyings.add("lineSizes","vec2"),t.hasMultipassGeometry&&e.varyings.add("depth","float"),t.hasScreenSizePerspective&&o6(r),r.code.add(b`
    void main(void) {
      ProjectHUDAux projectAux;
      vec4 endPoint = projectPositionHUD(projectAux);

      vec3 vpos = projectAux.posModel;
      if (rejectBySlice(vpos)) {
        gl_Position = vec4(1e38, 1e38, 1e38, 1.0);
        return;
      }
    ${t.occlusionTestEnabled?b`
      if (!testVisibilityHUD(endPoint)) {
        gl_Position = vec4(1e38, 1e38, 1e38, 1.0);
        return;
      }`:""}

    ${t.hasScreenSizePerspective?b`
      vec4 perspectiveFactor = screenSizePerspectiveScaleFactor(projectAux.absCosAngle, projectAux.distanceToCamera, screenSizePerspectiveAlignment);
      vec2 screenOffsetScaled = applyScreenSizePerspectiveScaleFactorVec2(screenOffset, perspectiveFactor);
        `:b`vec2 screenOffsetScaled = screenOffset;`}
      // Add view dependent polygon offset to get exact same original starting point. This is mostly used to get the
      // correct depth value
      vec3 posView = (view * vec4(position, 1.0)).xyz;
      ${t.hasMultipassGeometry?"depth = posView.z;":""}

      applyHUDViewDependentPolygonOffset(auxpos1.w, projectAux.absCosAngle, posView);
      vec4 startPoint = proj * vec4(posView, 1.0);
      // Apply screen offset to both start and end point
      vec2 screenOffsetNorm = screenOffsetScaled * 2.0 / viewport.zw;
      startPoint.xy += screenOffsetNorm * startPoint.w;
      endPoint.xy += screenOffsetNorm * endPoint.w;
      // Align start and end to pixel origin
      vec4 startAligned = alignToPixelOrigin(startPoint, viewport.zw);
      vec4 endAligned = alignToPixelOrigin(endPoint, viewport.zw);
    ${t.depthHudEnabled?t.depthHudAlignStartEnabled?b`endAligned = vec4(endAligned.xy / endAligned.w * startAligned.w, startAligned.zw);`:b`startAligned = vec4(startAligned.xy / startAligned.w * endAligned.w, endAligned.zw);`:""}
      vec4 projectedPosition = mix(startAligned, endAligned, uv0.y);
      // The direction of the line in screen space
      vec2 screenSpaceDirection = normalize(endAligned.xy / endAligned.w - startAligned.xy / startAligned.w);
      vec2 perpendicularScreenSpaceDirection = vec2(screenSpaceDirection.y, -screenSpaceDirection.x);
    ${t.hasScreenSizePerspective?b`
      float lineSizeScaled = applyScreenSizePerspectiveScaleFactorFloat(lineSize, perspectiveFactor);
      float borderSizeScaled = applyScreenSizePerspectiveScaleFactorFloat(borderSize, perspectiveFactor);
        `:b`
      float lineSizeScaled = lineSize;
      float borderSizeScaled = borderSize;
        `}
      float halfPixelSize = lineSizeScaled * 0.5;

      // Compute full ndc offset, adding 1px padding for doing anti-aliasing and the border size
      float padding = 1.0 + borderSizeScaled;
      vec2 ndcOffset = (-halfPixelSize - padding + uv0.x * (lineSizeScaled + padding + padding)) * pixelToNDC;

      // Offset x/y from the center of the line in screen space
      projectedPosition.xy += perpendicularScreenSpaceDirection * ndcOffset * projectedPosition.w;

      // Compute a coverage varying which we can use in the fragment shader to determine
      // how much a pixel is actually covered by the line (i.e. to anti alias the line).
      // This works by computing two coordinates that can be linearly interpolated and then
      // subtracted to find out how far away from the line edge we are.
      float edgeDirection = (uv0.x * 2.0 - 1.0);

      float halfBorderSize = 0.5 * borderSizeScaled;
      float halfPixelSizeAndBorder = halfPixelSize + halfBorderSize;
      float outerEdgeCoverageSampler = edgeDirection * (halfPixelSizeAndBorder + halfBorderSize + 1.0);

      float isOneSided = float(lineSizeScaled < 2.0 && borderSize < 2.0);

      coverageSampling = vec4(
        // Edge coordinate
        outerEdgeCoverageSampler,

        // Border edge coordinate
        outerEdgeCoverageSampler - halfPixelSizeAndBorder * isOneSided,

        // Line offset
        halfPixelSize - 0.5,

        // Border offset
        halfBorderSize - 0.5 + halfPixelSizeAndBorder * (1.0 - isOneSided)
      );

      lineSizes = vec2(lineSizeScaled, borderSizeScaled);

      gl_Position = projectedPosition;
    }
  `),i.uniforms.add(new sr("uColor",s=>Lne(s.color)),new sr("borderColor",s=>Lne(s.borderColor))),t.hasMultipassGeometry&&(i.include(qwe,t),i.uniforms.add(new Sr("inverseViewport",(s,n)=>n.inverseViewport))),i.code.add(b`
    void main() {
      ${t.hasMultipassGeometry?"if( geometryDepthTest(gl_FragCoord.xy * inverseViewport, depth) ){ discard; }":""}

      // Mix between line and border coverage offsets depending on whether we need
      // a border (based on the sidedness).
      vec2 coverage = min(1.0 - clamp(abs(coverageSampling.xy) - coverageSampling.zw, 0.0, 1.0), lineSizes);

      // Mix between border and line color based on the line coverage (conceptually the line blends on top of the
      // border background).
      //
      // Anti-alias by blending final result using the full (including optional border) coverage and the color alpha
      float borderAlpha = uColor.a * borderColor.a * coverage.y;
      float colorAlpha = uColor.a * coverage.x;

      float finalAlpha = mix(borderAlpha, 1.0, colorAlpha);

    ${t.depthHudEnabled?b`
      if (finalAlpha < 0.01) {
        discard;
      }
      `:b`
      vec3 finalRgb = mix(borderColor.rgb * borderAlpha, uColor.rgb, colorAlpha);
      fragColor = vec4(finalRgb, finalAlpha);
      `}
  }
  `),e}function Lne(t){return t??Of}const Dne=Ve(),Zot=Object.freeze(Object.defineProperty({__proto__:null,build:Wot},Symbol.toStringTag,{value:"Module"}));let D2e=class N2e extends Pr{initializeConfiguration(e,r){r.spherical=e.viewingMode===De.Global}initializeProgram(e){return new Cr(e.rctx,N2e.shader.get().build(this.configuration),br)}setPipelineState(e){const r=e?Kr.ALWAYS:Kr.LESS;return this.configuration.depthHudEnabled?At({depthTest:{func:r},depthWrite:Ol}):At({blending:xo(we.ONE,we.SRC_ALPHA,we.ONE_MINUS_SRC_ALPHA,we.ONE_MINUS_SRC_ALPHA),depthTest:{func:r},colorWrite:Vt})}initializePipeline(){return this.setPipelineState(this.configuration.hasMultipassGeometry)}};D2e.shader=new Er(Zot,()=>ae(()=>import("./LineCallout.glsl-ca929922.js"),[],import.meta.url));let qu=class extends Uo{constructor(){super(...arguments),this.screenCenterOffsetUnitsEnabled=vl.World,this.spherical=!1,this.occlusionTestEnabled=!0,this.hasVerticalOffset=!1,this.hasScreenSizePerspective=!1,this.depthHudEnabled=!1,this.depthHudAlignStartEnabled=!1,this.hasSlicePlane=!1,this.hasMultipassGeometry=!1}};u([B({count:vl.COUNT})],qu.prototype,"screenCenterOffsetUnitsEnabled",void 0),u([B()],qu.prototype,"spherical",void 0),u([B()],qu.prototype,"occlusionTestEnabled",void 0),u([B()],qu.prototype,"hasVerticalOffset",void 0),u([B()],qu.prototype,"hasScreenSizePerspective",void 0),u([B()],qu.prototype,"depthHudEnabled",void 0),u([B()],qu.prototype,"depthHudAlignStartEnabled",void 0),u([B()],qu.prototype,"hasSlicePlane",void 0),u([B()],qu.prototype,"hasMultipassGeometry",void 0),u([B({constValue:!0})],qu.prototype,"hasSliceInVertexProgram",void 0),u([B({constValue:!1})],qu.prototype,"draped",void 0);let xI=class cH extends tv{get uniqueMaterialIdentifier(){return this._uniqueMaterialIdentifier}constructor(e){super(e,new F2e),this._configuration=new qu,this._uniqueMaterialIdentifier=cH.uniqueMaterialIdentifier(this.parameters)}getPassParameters(){return this.parameters}getConfiguration(e,r){const i=r?.slot!==ue.LINE_CALLOUTS;return this._configuration.occlusionTestEnabled=this.parameters.occlusionTest,this._configuration.hasVerticalOffset=this.parameters.verticalOffset!=null,this._configuration.hasScreenSizePerspective=this.parameters.screenSizePerspective!=null,this._configuration.depthHudEnabled=i,this._configuration.depthHudAlignStartEnabled=!!this.parameters.depthHUDAlignStart,this._configuration.screenCenterOffsetUnitsEnabled=this.parameters.centerOffsetUnits==="screen"?vl.Screen:vl.World,this._configuration.hasSlicePlane=this.parameters.hasSlicePlane,this._configuration.hasMultipassGeometry=r.multipassGeometry.enabled,this._configuration}intersect(){}requiresSlot(e,r){if(r===N.Color)switch(e){case ue.LINE_CALLOUTS:case ue.LINE_CALLOUTS_HUD_DEPTH:return!0}return!1}createGLMaterial(e){return new Xot(e)}createBufferWriter(){return new Jot}validateParameters(e){const r=cH.uniqueMaterialIdentifier(e);r!==this._uniqueMaterialIdentifier&&(this._uniqueMaterialIdentifier=r)}static uniqueMaterialIdentifier(e){return JSON.stringify({screenOffset:e.screenOffset||[0,0],centerOffsetUnits:e.centerOffsetUnits||"world"})}},Xot=class extends K_{beginSlot(e){return this.ensureTechnique(D2e,e)}},F2e=class extends CY{constructor(){super(...arguments),this.screenOffset=ap,this.color=[0,0,0,1],this.size=1,this.occlusionTest=!1,this.shaderPolygonOffset=1e-5,this.depthHUDAlignStart=!1,this.centerOffsetUnits="world",this.hasSlicePlane=!1}};const Yot=zi().vec3f(E.POSITION).vec3f(E.NORMAL).vec2f(E.UV0).vec4f(E.AUXPOS1),Nne=[ch(0,0),ch(1,0),ch(0,1),ch(1,0),ch(1,1),ch(0,1)];let Jot=class{constructor(){this.vertexBufferLayout=Yot}elementCount(e){return 6*e.indices.get(E.POSITION).length}write(e,r,i,s,n){AY(i.indices.get(E.POSITION),i.vertexAttributes.get(E.POSITION).data,e,s.position,n,6),OY(i.indices.get(E.NORMAL),i.vertexAttributes.get(E.NORMAL).data,r,s.normal,n,6),I2(i.indices.get(E.AUXPOS1),i.vertexAttributes.get(E.AUXPOS1).data,s.auxpos1,n,6);for(let o=0;o<Nne.length;++o)s.uv0.setVec(n+o,Nne[o])}},U2e=class k2e extends om{constructor(e,r){super(e,null,r,eat),this._elevationOptions={supportsOffsetAdjustment:!0,supportsOnTheGround:!1},this.ensureDrapedStatus(!1)}async doLoad(){this._material=new xI(this._materialParameters),this._context.stage.add(this._material)}destroy(){super.destroy(),this._context.stage.remove(this._material),this._material=null}_perInstanceMaterialParameters(e){const r=this._materialParameters;return r.screenOffset=e.screenOffset||ap,r.centerOffsetUnits=e.centerOffsetUnits||"world",r}get _materialParameters(){const e=new F2e,r=this.symbol,i=r.callout;if(e.color=i.color!=null?ze.toUnitRGBA(i.color):[0,0,0,0],e.color[3]*=this._getLayerOpacity(),e.size=Ms(i.size||0),r.verticalOffset){const{screenLength:o,minWorldLength:a,maxWorldLength:l}=r.verticalOffset;e.verticalOffset={screenLength:Ms(o),minWorldLength:a||0,maxWorldLength:l??1/0}}e.borderColor=i.border!=null&&i.border.color!=null?ze.toUnitRGBA(i.border.color):null;const s=r.symbolLayers.at(0).type==="object",n=r.type==="label-3d";return e.occlusionTest=!s,e.shaderPolygonOffset=s?0:void 0,e.depthHUDAlignStart=n,e.hasSlicePlane=this._context.slicePlaneEnabled,e.screenSizePerspective=this._context.screenSizePerspectiveEnabled?this._context.sharedResources.screenSizePerspectiveSettings:null,e}_defaultElevationInfoNoZ(){return Kot}createGraphics3DGraphic(e){const r=e.renderingInfo,i=e.graphic,s=this.setGraphicElevationContext(i,new mp,r.elevationOffset||0),n=r.symbol,o=this._elevationContext.mode==="on-the-ground"&&(n.type==="cim"||!n.symbolLayers.some(l=>l.type==="object"||l.type==="text"));if(n.type!=="label-3d"&&o||n.type==="point-3d"&&n.symbolLayers.every(l=>l.type==="text"&&!Qge(l)))return null;const a=$Y(i.geometry);return a==null?null:this._createAs3DShape(a,s,r,i.uid)}layerOpacityChanged(){this._material?.setParameters(this._materialParameters)}layerElevationInfoChanged(e,r,i){const s=this._elevationContext.mode,n=lP(k2e.elevationModeChangeTypes,i,s);return n!==ns.UPDATE||e.forEach(o=>{const a=r(o);a!=null&&this.updateGraphicElevationContext(o.graphic,a)}),n}slicePlaneEnabledChanged(){return this._material?.setParameters({hasSlicePlane:this._context.slicePlaneEnabled}),!0}physicalBasedRenderingChanged(){return!0}setGraphicElevationContext(e,r,i=0){const s=super.setGraphicElevationContext(e,r);return s.addOffsetRenderUnits(i),s}updateGraphicElevationContext(e,r){this.setGraphicElevationContext(e,r.elevationContext,r.metadata!=null?r.metadata.elevationOffset:0),r.needsElevationUpdates=Nh(r.elevationContext.mode)}computeComplexity(){return{primitivesPerFeature:2,primitivesPerCoordinate:0,drawCallsPerFeature:0,estimated:!1,memory:UY.memory}}_createVertexData(e){const{translation:r,centerOffset:i}=e,s=new ke(r?[r[0],r[1],r[2]]:[0,0,0],3,!0),n=new ke(i?[i[0],i[1],i[2],i[3]]:[0,0,0,1],4,!0);return[[E.POSITION,s],[E.NORMAL,new ke([0,0,1],3,!0)],[E.AUXPOS1,n]]}_getOrCreateMaterial(e){const r=this._perInstanceMaterialParameters(e),i=xI.uniqueMaterialIdentifier(r);if(this._material&&i===this._material.uniqueMaterialIdentifier)return{material:this._material,isUnique:!1};if(e.materialCollection!=null){let s=e.materialCollection.get(i);return s==null&&(s=new xI(r),e.materialCollection.add(i,s)),{material:s,isUnique:!1}}return{material:new xI(r),isUnique:!0}}_createAs3DShape(e,r,i,s){const n=this._context.layer.uid,o=this._context.stage.renderView.getObjectAndLayerIdColor({graphicUid:s,layerUid:n}),a=this._getOrCreateMaterial(i),l=new Vs(a.material,this._createVertexData(i),Qot,null,ss.Point,o),c=VY(this._context,e,l,r,s);if(c==null)return null;const h=new nm(this,c.object,[l],a.isUnique?[a.material]:null,null,$b,r);return h.metadata=new v2e(i.elevationOffset),h.alignedSampledElevation=c.sampledElevation,h.needsElevationUpdates=Nh(r.mode),iR(h,e,this._context.elevationProvider),h}};U2e.elevationModeChangeTypes={definedChanged:ns.UPDATE,staysOnTheGround:ns.UPDATE,onTheGroundChanged:ns.RECREATE};const n9=[0],Qot=[[E.POSITION,n9],[E.NORMAL,n9],[E.AUXPOS1,n9]],Kot={mode:"relative-to-ground",offset:0},eat={ignoreDrivers:!0,renderPriority:0,renderPriorityStep:1};let tat=class{constructor(e,r,i=C(),s=Wt(),n=Ve(),o="world",a=0,l=null){this.renderer=e,this.symbol=r,this.translation=i,this.centerOffset=s,this.screenOffset=n,this.centerOffsetUnits=o,this.elevationOffset=a,this.materialCollection=l}},rat=class extends Lot{};const Fne=Q.getLogger("esri.views.3d.layers.graphics.Graphics3DCalloutSymbolLayerFactory");function iat(t,e){if(!ZW(t))return Fne.error("Graphics3DCalloutSymbolLayerFactory#make",`symbol of type '${t.type}' does not support callouts`),null;if(!t.callout)return null;const r=sat[t.callout.type];return r?new r(t,e):(Fne.error("Graphics3DCalloutSymbolLayerFactory#make",`unknown or unsupported callout type ${t.callout.type}`),null)}const sat={line:U2e};let pw=class V2e{constructor(e=null,r={},i,s){this.geometry=e,this.attributes=r,this.centroid=i,this.objectId=s,this.displayId=0,this.geohashX=0,this.geohashY=0}weakClone(){const e=new V2e(this.geometry,this.attributes,this.centroid,this.objectId);return e.displayId=this.displayId,e.geohashX=this.geohashX,e.geohashY=this.geohashY,e}};function oLt(t){return!(t.geometry==null||!t.geometry.coords||!t.geometry.coords.length)}let aLt=class extends pw{},nat=class z2e{constructor(){this.objectIdFieldName=null,this.globalIdFieldName=null,this.geohashFieldName=null,this.geometryProperties=null,this.geometryType=null,this.spatialReference=null,this.hasZ=!1,this.hasM=!1,this.features=[],this.fields=[],this.transform=null,this.exceededTransferLimit=!1,this.uniqueIdField=null,this.queryGeometryType=null,this.queryGeometry=null}weakClone(){const e=new z2e;return e.objectIdFieldName=this.objectIdFieldName,e.globalIdFieldName=this.globalIdFieldName,e.geohashFieldName=this.geohashFieldName,e.geometryProperties=this.geometryProperties,e.geometryType=this.geometryType,e.spatialReference=this.spatialReference,e.hasZ=this.hasZ,e.hasM=this.hasM,e.features=this.features,e.fields=this.fields,e.transform=this.transform,e.exceededTransferLimit=this.exceededTransferLimit,e.uniqueIdField=this.uniqueIdField,e.queryGeometry=this.queryGeometry,e.queryGeometryType=this.queryGeometryType,e}},j_=class aD{constructor(e=[],r=[],i=!1){this.lengths=e??[],this.coords=r??[],this.hasIndeterminateRingOrder=i}static fromRect(e){const[r,i,s,n]=e,o=s-r,a=n-i;return new aD([5],[r,i,o,0,0,a,-o,0,0,-a])}get isPoint(){return this.lengths.length===0}get maxLength(){return Math.max(...this.lengths)}get size(){return this.lengths.reduce((e,r)=>e+r)}forEachVertex(e){let r=0;this.lengths.length||e(this.coords[0],this.coords[1]);for(let i=0;i<this.lengths.length;i++){const s=this.lengths[i];for(let n=0;n<s;n++)e(this.coords[2*(n+r)],this.coords[2*(n+r)+1]);r+=s}}clone(e){return e?(e.set(this.coords),new aD(this.lengths.slice(),e,this.hasIndeterminateRingOrder)):new aD(this.lengths.slice(),this.coords.slice(),this.hasIndeterminateRingOrder)}};function da(t,e){return t?e?4:3:e?3:2}const uP=Q.getLogger("esri.layers.graphics.featureConversionUtils"),B2e={esriGeometryPoint:0,esriGeometryPolyline:2,esriGeometryPolygon:3,esriGeometryMultipoint:0,esriGeometryEnvelope:0},oat=(t,e,r,i,s,n)=>{t[r]=s,t[r+1]=n},Une=(t,e,r,i,s,n)=>{t[r]=s,t[r+1]=n,t[r+2]=e[i+2]},aat=(t,e,r,i,s,n)=>{t[r]=s,t[r+1]=n,t[r+2]=e[i+3]},lat=(t,e,r,i,s,n)=>{t[r]=s,t[r+1]=n,t[r+2]=e[i+2],t[r+3]=e[i+3]};function zY(t,e,r,i){if(t){if(r)return e&&i?lat:Une;if(e&&i)return aat}else if(e&&i)return Une;return oat}function o9({scale:t,translate:e},r){return Math.round((r-e[0])/t[0])}function a9({scale:t,translate:e},r){return Math.round((e[1]-r)/t[1])}function l9({scale:t,translate:e},r,i){return r*t[i]+e[i]}function cLt(t,e,r){return t?e?r?jY(t):BY(t):r?GY(t):m6(t):null}function m6(t){const e=t.coords;return{x:e[0],y:e[1]}}function G2e(t,e){return t.coords[0]=e.x,t.coords[1]=e.y,t}function BY(t){const e=t.coords;return{x:e[0],y:e[1],z:e[2]}}function cat(t,e){return t.coords[0]=e.x,t.coords[1]=e.y,t.coords[2]=e.z,t}function GY(t){const e=t.coords;return{x:e[0],y:e[1],m:e[2]}}function uat(t,e){return t.coords[0]=e.x,t.coords[1]=e.y,t.coords[2]=e.m,t}function jY(t){const e=t.coords;return{x:e[0],y:e[1],z:e[2],m:e[3]}}function hat(t,e){return t.coords[0]=e.x,t.coords[1]=e.y,t.coords[2]=e.z,t.coords[3]=e.m,t}function dat(t,e,r,i){let s=m6;r&&i?s=jY:r?s=BY:i&&(s=GY);for(const n of e){const{geometry:o,attributes:a}=n,l=o!=null?s(o):null;t.push({attributes:a,geometry:l})}return t}function HY(t,e){return t&&e?hat:t?cat:e?uat:G2e}function pat(t,e,r,i,s){const n=HY(r,i);for(const{geometry:o,attributes:a}of e){const l=o!=null?n(new j_,o):null;t.push(new pw(l,a,null,s?a[s]:void 0))}return t}function uLt(t,e,r=HY(e.z!=null,e.m!=null)){return r(t,e)}function fat(t,e,r,i){for(const{geometry:s,attributes:n}of e)t.push({attributes:n,geometry:s!=null?j2e(s,r,i):null});return t}function j2e(t,e,r){if(t==null)return null;const i=da(e,r),s=[];for(let n=0;n<t.coords.length;n+=i){const o=[];for(let a=0;a<i;a++)o.push(t.coords[n+a]);s.push(o)}return e?r?{points:s,hasZ:e,hasM:r}:{points:s,hasZ:e}:r?{points:s,hasM:r}:{points:s}}function mat(t,e,r,i,s){const n=da(r,i);for(const{geometry:o,attributes:a}of e){const l=o!=null?H2e(new j_,o,n):null;t.push(new pw(l,a,null,s?a[s]:void 0))}return t}function H2e(t,e,r=da(e.hasZ,e.hasM)){t.lengths[0]=e.points.length;const i=t.coords;let s=0;for(const n of e.points)for(let o=0;o<r;o++)i[s++]=n[o];return t}function gat(t,e,r,i){for(const{geometry:s,attributes:n}of e)t.push({attributes:n,geometry:s!=null?q2e(s,r,i):null});return t}function q2e(t,e,r){if(!t)return null;const i=da(e,r),{coords:s,lengths:n}=t,o=[];let a=0;for(const l of n){const c=[];for(let h=0;h<l;h++){const p=[];for(let f=0;f<i;f++)p.push(s[a++]);c.push(p)}o.push(c)}return e?r?{paths:o,hasZ:e,hasM:r}:{paths:o,hasZ:e}:r?{paths:o,hasM:r}:{paths:o}}function yat(t,e,r,i,s){const n=da(r,i);for(const{geometry:o,attributes:a}of e){const l=o!=null?W2e(new j_,o,n):null;t.push(new pw(l,a,null,s?a[s]:void 0))}return t}function W2e(t,e,r=da(e.hasZ,e.hasM)){const{lengths:i,coords:s}=t;let n=0;for(const o of e.paths){for(const a of o)for(let l=0;l<r;l++)s[n++]=a[l];i.push(o.length)}return t}function _at(t,e,r,i){for(const{geometry:s,attributes:n,centroid:o}of e){const a=s!=null?Z2e(s,r,i):null;if(o!=null){const l=m6(o);t.push({attributes:n,centroid:l,geometry:a})}else t.push({attributes:n,geometry:a})}return t}function Z2e(t,e,r){if(!t)return null;const i=da(e,r),{coords:s,lengths:n}=t,o=[];let a=0;for(const l of n){const c=[];for(let h=0;h<l;h++){const p=[];for(let f=0;f<i;f++)p.push(s[a++]);c.push(p)}o.push(c)}return e?r?{rings:o,hasZ:e,hasM:r}:{rings:o,hasZ:e}:r?{rings:o,hasM:r}:{rings:o}}function vat(t,e,r,i,s){for(const{geometry:n,centroid:o,attributes:a}of e){const l=n!=null?X2e(new j_,n,r,i):null,c=s?a[s]:void 0;o!=null?t.push(new pw(l,a,G2e(new j_,o),c)):t.push(new pw(l,a,null,c))}return t}function X2e(t,e,r=e.hasZ,i=e.hasM){return bat(t,e.rings,r,i)}function bat(t,e,r,i){const s=da(r,i),{lengths:n,coords:o}=t;let a=0;Eg(t);for(const l of e){for(const c of l)for(let h=0;h<s;h++)o[a++]=c[h];n.push(l.length)}return t}const BS=[],K3=[];function hLt(t,e,r,i,s){BS[0]=t;const[n]=Y2e(K3,BS,e,r,i,s);return hp(BS),hp(K3),n}function Y2e(t,e,r,i,s,n){if(hp(t),!r){for(const o of e){const a=n?o.attributes[n]:void 0;t.push(new pw(null,o.attributes,null,a))}return t}switch(r){case"esriGeometryPoint":return pat(t,e,i,s,n);case"esriGeometryMultipoint":return mat(t,e,i,s,n);case"esriGeometryPolyline":return yat(t,e,i,s,n);case"esriGeometryPolygon":return vat(t,e,i,s,n);default:uP.error("convertToFeatureSet:unknown-geometry",new F(`Unable to parse unknown geometry type '${r}'`)),hp(t)}return t}function dLt(t,e,r,i){K3[0]=t,J2e(BS,K3,e,r,i);const s=BS[0];return hp(BS),hp(K3),s}function wat(t,e,r){if(t==null)return null;const i=new j_;return"hasZ"in t&&e==null&&(e=t.hasZ),"hasM"in t&&r==null&&(r=t.hasM),pW(t)?HY(e??t.z!=null,r??t.m!=null)(i,t):SS(t)?X2e(i,t,e,r):fW(t)?W2e(i,t,da(e,r)):dW(t)?H2e(i,t,da(e,r)):void uP.error("convertFromGeometry:unknown-geometry",new F(`Unable to parse unknown geometry type '${t}'`))}function xat(t,e,r,i){const s=t&&("coords"in t?t:t.geometry);if(s==null)return null;switch(e){case"esriGeometryPoint":{let n=m6;return r&&i?n=jY:r?n=BY:i&&(n=GY),n(s)}case"esriGeometryMultipoint":return j2e(s,r,i);case"esriGeometryPolyline":return q2e(s,r,i);case"esriGeometryPolygon":return Z2e(s,r,i);default:return uP.error("convertToGeometry:unknown-geometry",new F(`Unable to parse unknown geometry type '${e}'`)),null}}function Tat(t,e){for(const r of e)t.push({attributes:r.attributes});return t}function J2e(t,e,r,i,s){if(hp(t),r==null)return Tat(t,e);switch(r){case"esriGeometryPoint":return dat(t,e,i,s);case"esriGeometryMultipoint":return fat(t,e,i,s);case"esriGeometryPolyline":return gat(t,e,i,s);case"esriGeometryPolygon":return _at(t,e,i,s);default:uP.error("convertToFeatureSet:unknown-geometry",new F(`Unable to parse unknown geometry type '${r}'`))}return t}function pLt(t){const{objectIdFieldName:e,spatialReference:r,transform:i,fields:s,hasM:n,hasZ:o,features:a,geometryType:l,exceededTransferLimit:c,uniqueIdField:h,queryGeometry:p,queryGeometryType:f}=t,m={features:J2e([],a,l,o,n),fields:s,geometryType:l,objectIdFieldName:e,spatialReference:r,uniqueIdField:h,queryGeometry:xat(p,f,!1,!1)};return i&&(m.transform=i),c&&(m.exceededTransferLimit=c),n&&(m.hasM=n),o&&(m.hasZ=o),m}function fLt(t,e){const r=new nat,{hasM:i,hasZ:s,features:n,objectIdFieldName:o,spatialReference:a,geometryType:l,exceededTransferLimit:c,transform:h,fields:p}=t;return p&&(r.fields=p),r.geometryType=l??null,r.objectIdFieldName=o??e??null,r.spatialReference=a??null,r.objectIdFieldName?(n&&Y2e(r.features,n,l,s,i,r.objectIdFieldName),c&&(r.exceededTransferLimit=c),i&&(r.hasM=i),s&&(r.hasZ=s),h&&(r.transform=h),r):(uP.error(new F("optimized-features:invalid-objectIdFieldName","objectIdFieldName is missing")),r)}function mLt(t){const{transform:e,features:r,hasM:i,hasZ:s}=t;if(!e)return t;for(const n of r)n.geometry!=null&&Vne(n.geometry,n.geometry,i,s,e),n.centroid!=null&&Vne(n.centroid,n.centroid,i,s,e);return t.transform=null,t}function gLt(t,e){const{geometryType:r,features:i,hasM:s,hasZ:n}=e;if(!t)return e;for(let o=0;o<i.length;o++){const a=i[o],l=a.weakClone();l.geometry=new j_,kne(l.geometry,a.geometry,s,n,r,t),a.centroid&&(l.centroid=new j_,kne(l.centroid,a.centroid,s,n,"esriGeometryPoint",t)),i[o]=l}return e.transform=t,e}function kne(t,e,r,i,s,n,o=r,a=i){if(Eg(t),e==null||!e.coords.length)return null;const l=B2e[s],{coords:c,lengths:h}=e,p=da(r,i),f=da(r&&o,i&&a),m=zY(r,i,o,a);if(!h.length)return m(t.coords,c,0,0,o9(n,c[0]),a9(n,c[1])),Eg(t,p,0),t;let y,_,v,w,x=0,T=0,S=T;for(const O of h){if(O<l)continue;let A=0;T=S,v=y=o9(n,c[x]),w=_=a9(n,c[x+1]),m(t.coords,c,T,x,v,w),A++,x+=p,T+=f;for(let I=1;I<O;I++,x+=p)v=o9(n,c[x]),w=a9(n,c[x+1]),v===y&&w===_||(m(t.coords,c,T,x,v-y,w-_),T+=f,A++,y=v,_=w);A>=l&&(t.lengths.push(A),S=T)}return hp(t.coords,S),t.coords.length?t:null}function yLt(t,e,r,i,s,n,o=r,a=i){if(Eg(t),!e||!e.coords.length)return null;const l=B2e[s],{coords:c,lengths:h}=e,p=da(r,i),f=da(r&&o,i&&a),m=zY(r,i,o,a);if(!h.length)return m(t.coords,c,0,0,c[0],c[1]),Eg(t,p,0),t;let y=0;const _=n*n;for(const v of h){if(v<l){y+=v*p;continue}const w=t.coords.length/f,x=y,T=y+(v-1)*p;m(t.coords,c,t.coords.length,x,c[x],c[x+1]),uH(t.coords,c,p,_,m,x,T),m(t.coords,c,t.coords.length,T,c[T],c[T+1]);const S=t.coords.length/f-w;S>=l?t.lengths.push(S):hp(t.coords,w*f),y+=v*p}return t.coords.length?t:null}function Sat(t,e,r,i){const s=t[e],n=t[e+1],o=t[r],a=t[r+1],l=t[i],c=t[i+1];let h=o,p=a,f=l-h,m=c-p;if(f!==0||m!==0){const y=((s-h)*f+(n-p)*m)/(f*f+m*m);y>1?(h=l,p=c):y>0&&(h+=f*y,p+=m*y)}return f=s-h,m=n-p,f*f+m*m}function uH(t,e,r,i,s,n,o){let a,l=i,c=0;for(let h=n+r;h<o;h+=r)a=Sat(e,h,n,o),a>l&&(c=h,l=a);l>i&&(c-n>r&&uH(t,e,r,i,s,n,c),s(t,e,t.length,c,e[c],e[c+1]),o-c>r&&uH(t,e,r,i,s,c,o))}function _Lt(t,e,r,i){if(e==null||!e.coords||!e.coords.length)return null;const s=da(r,i);let n=Number.POSITIVE_INFINITY,o=Number.POSITIVE_INFINITY,a=Number.NEGATIVE_INFINITY,l=Number.NEGATIVE_INFINITY;if(e&&e.coords){const c=e.coords;for(let h=0;h<c.length;h+=s){const p=c[h],f=c[h+1];n=Math.min(n,p),a=Math.max(a,p),o=Math.min(o,f),l=Math.max(l,f)}}return mz(t)?H6e(t,n,o,a,l):aW(n,o,a,l,t),t}function Vne(t,e,r,i,s){const{coords:n,lengths:o}=e,a=da(r,i);if(!n.length)return t!==e&&Eg(t),t;yF(s);const{originPosition:l,scale:c,translate:h}=s,p=Cat;p.originPosition=l;const f=p.scale;f[0]=c[0]??1,f[1]=-(c[1]??1),f[2]=c[2]??1,f[3]=c[3]??1;const m=p.translate;if(m[0]=h[0]??0,m[1]=h[1]??0,m[2]=h[2]??0,m[3]=h[3]??0,!o.length){for(let _=0;_<a;++_)t.coords[_]=l9(p,n[_],_);return t!==e&&Eg(t,a,0),t}let y=0;for(let _=0;_<o.length;_++){const v=o[_];t.lengths[_]=v;for(let T=0;T<a;++T)t.coords[y+T]=l9(p,n[y+T],T);let w=t.coords[y],x=t.coords[y+1];y+=a;for(let T=1;T<v;T++,y+=a){w+=n[y]*f[0],x+=n[y+1]*f[1],t.coords[y]=w,t.coords[y+1]=x;for(let S=2;S<a;++S)t.coords[y+S]=l9(p,n[y+S],S)}}return t!==e&&Eg(t,n.length,o.length),t}function vLt(t,e,r,i,s,n){if(Eg(t),t.lengths.push(...e.lengths),r===s&&i===n)for(let o=0;o<e.coords.length;o++)t.coords.push(e.coords[o]);else{const o=da(r,i),a=zY(r,i,s,n),l=e.coords;for(let c=0;c<l.length;c+=o)a(t.coords,l,t.coords.length,c,l[c],l[c+1])}return t}function Eat(t,e,r,i){let s=0,n=t[i*e],o=t[i*(e+1)];for(let a=1;a<r;a++){const l=n+t[i*(e+a)],c=o+t[i*(e+a)+1],h=(l-n)*(c+o);n=l,o=c,s+=h}return .5*s}function bLt(t,e){const{coords:r,lengths:i}=t;let s=0,n=0;for(let o=0;o<i.length;o++){const a=i[o];n+=Eat(r,s,a,e),s+=a}return Math.abs(n)}function Eg(t,e=0,r=0){hp(t.lengths,r),hp(t.coords,e)}function hp(t,e=0){t.length!==e&&(t.length=e)}const Cat={originPosition:"lowerLeft",scale:[1,1,1,1],translate:[0,0,0,0]},zne=new Vo(Array,t=>HF(t,Lge),null,10,5),Aat=Ut();let Oat=class{get labelLayers(){return this._labelLayers||XOe}get extent(){return this._extent}get isElevationSource(){return this.layers.some(e=>e?.isElevationSource)}constructor(e,r,i,s,n){this.graphic=e,this.graphics3DSymbol=r,this.layers=i,this._visibleFlags=ko.ALL_LABEL,this.deconflictionPriority=0,++r.referenced,this._featureExpressionFeature=n?m2e(n,e,s):null}initialize(e){this._layer=e,this._forEachSymbolLayerGraphic(r=>{r.initialize(e),r.setVisibility(this.isVisible())})}destroy(){this._forEachSymbolLayerGraphic(e=>e.destroy()),this._calloutLayer=null,--this.graphics3DSymbol.referenced,this.graphics3DSymbol=null}get destroyed(){return this.layers==null}clearLabelGraphics(){this._forEachLabelGraphic(e=>e.destroy()),this._labelLayers=null}addLabelGraphic(e,r){this._labelLayers||(this._labelLayers=new Array),this._labelLayers.push(e),e.initialize(r),e.setVisibility(this.isVisible(Zn.LABEL))}setCalloutGraphic(e){this._calloutLayer=e,this._layer&&(e.initialize(this._layer),e.setVisibility(this.isVisible()))}get calloutLayer(){return this._calloutLayer}get isDraped(){let e=!1;return this._forEachSymbolLayerGraphic(r=>{r.type==="draped"&&(e=!0)}),e}isVisible(e=Zn.GRAPHIC,r){const i=r?this._visibleFlags|r|Zn.LABEL*r:this._visibleFlags;return e===Zn.GRAPHIC?(i&ko.ALL_GRAPHIC)===ko.ALL_GRAPHIC:(i&ko.ALL_LABEL)===ko.ALL_LABEL}setVisibilityFlag(e,r,i){const s=this.isVisible(e);i?this._visibleFlags|=e*r:this._visibleFlags&=~(e*r);const n=this.isVisible(e);if(s===n)return!1;if(e===Zn.LABEL)this._forEachLabelGraphic(o=>o.setVisibility(n));else{this._forEachSymbolLayerGraphic(a=>a.setVisibility(n));const o=this.isVisible(Zn.LABEL);this._forEachLabelGraphic(a=>a.setVisibility(o))}return!0}getVisibilityFlag(e,r){return(this._visibleFlags&e*r)!=0}computeExtent(e){if(!this._extent){const r=this.graphic.geometry;if(r==null)return!1;this._extent=Ut(),hje(r,this._extent);const i=r.spatialReference;if(!Rn(i,e)&&!qR(this._extent,i,this._extent,e))return this._extent=null,!1}return!0}getAsOptimizedGeometry(e,r){return this._optimizedGeometry||(this._optimizedGeometry=this._convertGraphicToOptimizedGeometry(this.graphic,e,r)),this._optimizedGeometry}_convertGraphicToOptimizedGeometry(e,r,i){let s=e.geometry;return s.type!=="mesh"&&s.type!=="extent"||(s=Jd.fromExtent(s.type==="mesh"?s.extent:s)),wat(s,r,i)}get usedMemory(){let e=Zve(this.graphic.attributes);return this._forEachSymbolLayerGraphic(r=>{const i=r.graphics3DSymbolLayer.complexity;if(i==null)return;const s=r.type==="draped"?i.memory.draped:i.memory;e+=s.bytesPerFeature,s.bytesPerCoordinate&&(e+=uje(this.graphic.geometry)*s.bytesPerCoordinate)}),e}computeAttachmentOrigin(){const e={render:{origin:C(),num:0},draped:{origin:Ve(),num:0}};for(const r of this.layers)r?.computeAttachmentOrigin(e);return e.render.num>1&&te(e.render.origin,e.render.origin,1/e.render.num),e.draped.num>1&&lc(e.draped.origin,e.draped.origin,1/e.draped.num),e}async getProjectedBoundingBox(e,r,i,s,n){return n||(n={boundingBox:null,requiresDrapedElevation:!1,screenSpaceObjects:[]}),n.boundingBox?xi(n.boundingBox):n.boundingBox=xi(),n.requiresDrapedElevation=!1,await g5(this.layers,async o=>{if(o==null)return;const a=o.type==="draped"?r:e,l=zne.acquire(),c=await o.getProjectedBoundingBox(a,i,n.screenSpaceObjects,s,l);isFinite(c[2])&&isFinite(c[5])||(n.requiresDrapedElevation=!0),c&&n2(n.boundingBox,l),zne.release(l)}),G6e(n.boundingBox)||EV(zW(n.boundingBox,Aat))?n:null}needsElevationUpdates(){for(const e of this.layers)if(e!=null&&(e.type==="object3d"||e.type==="lod-instance")&&e.needsElevationUpdates)return!0;return this._labelLayers?.some(e=>e?.needsElevationUpdates??!1)??!1}alignWithElevation(e,r,i){this._forEachRenderedGraphic(s=>{s.type!=="object3d"&&s.type!=="lod-instance"||s.alignWithElevation(e,r,this._featureExpressionFeature,i)})}alignWithAbsoluteElevation(e,r,i){this._forEachRenderedGraphic(s=>{s.type==="object3d"&&s.alignWithAbsoluteElevation(e,r,i)})}addObjectStateSet(e,r){this._forEachSymbolLayerGraphic(i=>i.addObjectState(e,r))}removeObjectState(e){this._forEachSymbolLayerGraphic(r=>r.removeObjectState(e))}_forEachGraphicList(e,r){e?.forEach(i=>i&&r(i))}_forEachSymbolLayerGraphic(e){this._forEachGraphicList(this.layers,e),this._calloutLayer&&e(this._calloutLayer)}_forEachLabelGraphic(e){this._forEachGraphicList(this._labelLayers,e)}_forEachRenderedGraphic(e){this._forEachSymbolLayerGraphic(e),this._forEachLabelGraphic(e)}get test(){const e=this;return{addLabelLayer:r=>{e._labelLayers||(e._labelLayers=new Array),e._labelLayers.push(r)}}}},xLt=class{constructor(e,r){this.scheduler=e,this.schedule=r,this.sharedResources=null,this.streamDataRequester=null,this.elevationProvider=null,this.renderer=null,this.stage=null,this.clippingExtent=null,this.renderCoordsHelper=null,this.overlaySR=null,this.layer=null,this.drapeSourceRenderer=null,this.graphicsCoreOwner=null,this.localOriginFactory=null,this.featureExpressionInfoContext=null,this.screenSizePerspectiveEnabled=!0,this.slicePlaneEnabled=!1,this.physicalBasedRenderingEnabled=!1,this.skipHighSymbolLods=!1,this.isAsync=!1}},Rat=class{constructor(){this.renderPriority=0,this.renderPriorityStep=1,this.ignoreDrivers=!1}};var Bne,Gne,jne,hH={exports:{}};hH.exports,Bne=hH,Gne=function(){function t(P,V,z){z=z||2;var H,Z,J,re,ye,Ne,yt,Ot=V&&V.length,lt=Ot?V[0]*z:P.length,_t=e(P,0,lt,z,!0),_e=[];if(!_t||_t.next===_t.prev)return _e;if(Ot&&(_t=l(P,V,_t,z)),P.length>80*z){H=J=P[0],Z=re=P[1];for(var Ae=z;Ae<lt;Ae+=z)(ye=P[Ae])<H&&(H=ye),(Ne=P[Ae+1])<Z&&(Z=Ne),ye>J&&(J=ye),Ne>re&&(re=Ne);yt=(yt=Math.max(J-H,re-Z))!==0?1/yt:0}return i(_t,_e,z,H,Z,yt),_e}function e(P,V,z,H,Z){var J,re;if(Z===Y(P,V,z,H)>0)for(J=V;J<z;J+=H)re=X(J,P[J],P[J+1],re);else for(J=z-H;J>=V;J-=H)re=X(J,P[J],P[J+1],re);if(re&&O(re,re.next)){var ye=re.next;W(re),re=ye}return re}function r(P,V){if(!P)return P;V||(V=P);var z,H=P;do if(z=!1,H.steiner||!O(H,H.next)&&S(H.prev,H,H.next)!==0)H=H.next;else{var Z=H.prev;if(W(H),(H=V=Z)===H.next)break;z=!0}while(z||H!==V);return V}function i(P,V,z,H,Z,J,re){if(P){!re&&J&&y(P,H,Z,J);for(var ye,Ne,yt=P;P.prev!==P.next;)if(ye=P.prev,Ne=P.next,J?n(P,H,Z,J):s(P))V.push(ye.i/z),V.push(P.i/z),V.push(Ne.i/z),W(P),P=Ne.next,yt=Ne.next;else if((P=Ne)===yt){re?re===1?i(P=o(r(P),V,z),V,z,H,Z,J,2):re===2&&a(P,V,z,H,Z,J):i(r(P),V,z,H,Z,J,1);break}}}function s(P){var V=P.prev,z=P,H=P.next;if(S(V,z,H)>=0)return!1;for(var Z=P.next.next;Z!==P.prev;){if(x(V.x,V.y,z.x,z.y,H.x,H.y,Z.x,Z.y)&&S(Z.prev,Z,Z.next)>=0)return!1;Z=Z.next}return!0}function n(P,V,z,H){var Z=P.prev,J=P,re=P.next;if(S(Z,J,re)>=0)return!1;for(var ye=Z.x<J.x?Z.x<re.x?Z.x:re.x:J.x<re.x?J.x:re.x,Ne=Z.y<J.y?Z.y<re.y?Z.y:re.y:J.y<re.y?J.y:re.y,yt=Z.x>J.x?Z.x>re.x?Z.x:re.x:J.x>re.x?J.x:re.x,Ot=Z.y>J.y?Z.y>re.y?Z.y:re.y:J.y>re.y?J.y:re.y,lt=v(ye,Ne,V,z,H),_t=v(yt,Ot,V,z,H),_e=P.prevZ,Ae=P.nextZ;_e&&_e.z>=lt&&Ae&&Ae.z<=_t;){if(_e!==P.prev&&_e!==P.next&&x(Z.x,Z.y,J.x,J.y,re.x,re.y,_e.x,_e.y)&&S(_e.prev,_e,_e.next)>=0||(_e=_e.prevZ,Ae!==P.prev&&Ae!==P.next&&x(Z.x,Z.y,J.x,J.y,re.x,re.y,Ae.x,Ae.y)&&S(Ae.prev,Ae,Ae.next)>=0))return!1;Ae=Ae.nextZ}for(;_e&&_e.z>=lt;){if(_e!==P.prev&&_e!==P.next&&x(Z.x,Z.y,J.x,J.y,re.x,re.y,_e.x,_e.y)&&S(_e.prev,_e,_e.next)>=0)return!1;_e=_e.prevZ}for(;Ae&&Ae.z<=_t;){if(Ae!==P.prev&&Ae!==P.next&&x(Z.x,Z.y,J.x,J.y,re.x,re.y,Ae.x,Ae.y)&&S(Ae.prev,Ae,Ae.next)>=0)return!1;Ae=Ae.nextZ}return!0}function o(P,V,z){var H=P;do{var Z=H.prev,J=H.next.next;!O(Z,J)&&A(Z,H,H.next,J)&&L(Z,J)&&L(J,Z)&&(V.push(Z.i/z),V.push(H.i/z),V.push(J.i/z),W(H),W(H.next),H=P=J),H=H.next}while(H!==P);return r(H)}function a(P,V,z,H,Z,J){var re=P;do{for(var ye=re.next.next;ye!==re.prev;){if(re.i!==ye.i&&T(re,ye)){var Ne=U(re,ye);return re=r(re,re.next),Ne=r(Ne,Ne.next),i(re,V,z,H,Z,J),void i(Ne,V,z,H,Z,J)}ye=ye.next}re=re.next}while(re!==P)}function l(P,V,z,H){var Z,J,re,ye=[];for(Z=0,J=V.length;Z<J;Z++)(re=e(P,V[Z]*H,Z<J-1?V[Z+1]*H:P.length,H,!1))===re.next&&(re.steiner=!0),ye.push(w(re));for(ye.sort(c),Z=0;Z<ye.length;Z++)z=r(z=p(ye[Z],z),z.next);return z}function c(P,V){return P.x-V.x}function h(P){if(P.next.prev===P)return P;let V=P;for(;;){const z=V.next;if(z.prev===V||z===V||z===P)break;V=z}return V}function p(P,V){var z=f(P,V);if(!z)return V;var H=U(z,P),Z=r(z,z.next);let J=h(H);return r(J,J.next),Z=h(Z),h(V===z?Z:V)}function f(P,V){var z,H=V,Z=P.x,J=P.y,re=-1/0;do{if(J<=H.y&&J>=H.next.y&&H.next.y!==H.y){var ye=H.x+(J-H.y)*(H.next.x-H.x)/(H.next.y-H.y);if(ye<=Z&&ye>re){if(re=ye,ye===Z){if(J===H.y)return H;if(J===H.next.y)return H.next}z=H.x<H.next.x?H:H.next}}H=H.next}while(H!==V);if(!z)return null;if(Z===re)return z;var Ne,yt=z,Ot=z.x,lt=z.y,_t=1/0;H=z;do Z>=H.x&&H.x>=Ot&&Z!==H.x&&x(J<lt?Z:re,J,Ot,lt,J<lt?re:Z,J,H.x,H.y)&&(Ne=Math.abs(J-H.y)/(Z-H.x),L(H,P)&&(Ne<_t||Ne===_t&&(H.x>z.x||H.x===z.x&&m(z,H)))&&(z=H,_t=Ne)),H=H.next;while(H!==yt);return z}function m(P,V){return S(P.prev,P,V.prev)<0&&S(V.next,P,P.next)<0}function y(P,V,z,H){var Z=P;do Z.z===null&&(Z.z=v(Z.x,Z.y,V,z,H)),Z.prevZ=Z.prev,Z.nextZ=Z.next,Z=Z.next;while(Z!==P);Z.prevZ.nextZ=null,Z.prevZ=null,_(Z)}function _(P){var V,z,H,Z,J,re,ye,Ne,yt=1;do{for(z=P,P=null,J=null,re=0;z;){for(re++,H=z,ye=0,V=0;V<yt&&(ye++,H=H.nextZ);V++);for(Ne=yt;ye>0||Ne>0&&H;)ye!==0&&(Ne===0||!H||z.z<=H.z)?(Z=z,z=z.nextZ,ye--):(Z=H,H=H.nextZ,Ne--),J?J.nextZ=Z:P=Z,Z.prevZ=J,J=Z;z=H}J.nextZ=null,yt*=2}while(re>1);return P}function v(P,V,z,H,Z){return(P=1431655765&((P=858993459&((P=252645135&((P=16711935&((P=32767*(P-z)*Z)|P<<8))|P<<4))|P<<2))|P<<1))|(V=1431655765&((V=858993459&((V=252645135&((V=16711935&((V=32767*(V-H)*Z)|V<<8))|V<<4))|V<<2))|V<<1))<<1}function w(P){var V=P,z=P;do(V.x<z.x||V.x===z.x&&V.y<z.y)&&(z=V),V=V.next;while(V!==P);return z}function x(P,V,z,H,Z,J,re,ye){return(Z-re)*(V-ye)-(P-re)*(J-ye)>=0&&(P-re)*(H-ye)-(z-re)*(V-ye)>=0&&(z-re)*(J-ye)-(Z-re)*(H-ye)>=0}function T(P,V){return P.next.i!==V.i&&P.prev.i!==V.i&&!k(P,V)&&(L(P,V)&&L(V,P)&&D(P,V)&&(S(P.prev,P,V.prev)||S(P,V.prev,V))||O(P,V)&&S(P.prev,P,P.next)>0&&S(V.prev,V,V.next)>0)}function S(P,V,z){return(V.y-P.y)*(z.x-V.x)-(V.x-P.x)*(z.y-V.y)}function O(P,V){return P.x===V.x&&P.y===V.y}function A(P,V,z,H){var Z=M(S(P,V,z)),J=M(S(P,V,H)),re=M(S(z,H,P)),ye=M(S(z,H,V));return Z!==J&&re!==ye||!(Z!==0||!I(P,z,V))||!(J!==0||!I(P,H,V))||!(re!==0||!I(z,P,H))||!(ye!==0||!I(z,V,H))}function I(P,V,z){return V.x<=Math.max(P.x,z.x)&&V.x>=Math.min(P.x,z.x)&&V.y<=Math.max(P.y,z.y)&&V.y>=Math.min(P.y,z.y)}function M(P){return P>0?1:P<0?-1:0}function k(P,V){var z=P;do{if(z.i!==P.i&&z.next.i!==P.i&&z.i!==V.i&&z.next.i!==V.i&&A(z,z.next,P,V))return!0;z=z.next}while(z!==P);return!1}function L(P,V){return S(P.prev,P,P.next)<0?S(P,V,P.next)>=0&&S(P,P.prev,V)>=0:S(P,V,P.prev)<0||S(P,P.next,V)<0}function D(P,V){var z=P,H=!1,Z=(P.x+V.x)/2,J=(P.y+V.y)/2;do z.y>J!=z.next.y>J&&z.next.y!==z.y&&Z<(z.next.x-z.x)*(J-z.y)/(z.next.y-z.y)+z.x&&(H=!H),z=z.next;while(z!==P);return H}function U(P,V){var z=new G(P.i,P.x,P.y),H=new G(V.i,V.x,V.y),Z=P.next,J=V.prev;return P.next=V,V.prev=P,z.next=Z,Z.prev=z,H.next=z,z.prev=H,J.next=H,H.prev=J,H}function X(P,V,z,H){var Z=new G(P,V,z);return H?(Z.next=H.next,Z.prev=H,H.next.prev=Z,H.next=Z):(Z.prev=Z,Z.next=Z),Z}function W(P){P.next.prev=P.prev,P.prev.next=P.next,P.prevZ&&(P.prevZ.nextZ=P.nextZ),P.nextZ&&(P.nextZ.prevZ=P.prevZ)}function G(P,V,z){this.i=P,this.x=V,this.y=z,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}function Y(P,V,z,H){for(var Z=0,J=V,re=z-H;J<z;J+=H)Z+=(P[re]-P[J])*(P[J+1]+P[re+1]),re=J;return Z}return t.deviation=function(P,V,z,H){var Z=V&&V.length,J=Z?V[0]*z:P.length,re=Math.abs(Y(P,0,J,z));if(Z)for(var ye=0,Ne=V.length;ye<Ne;ye++){var yt=V[ye]*z,Ot=ye<Ne-1?V[ye+1]*z:P.length;re-=Math.abs(Y(P,yt,Ot,z))}var lt=0;for(ye=0;ye<H.length;ye+=3){var _t=H[ye]*z,_e=H[ye+1]*z,Ae=H[ye+2]*z;lt+=Math.abs((P[_t]-P[Ae])*(P[_e+1]-P[_t+1])-(P[_t]-P[_e])*(P[Ae+1]-P[_t+1]))}return re===0&&lt===0?0:Math.abs((lt-re)/re)},t.flatten=function(P){for(var V=P[0][0].length,z={vertices:[],holes:[],dimensions:V},H=0,Z=0;Z<P.length;Z++){for(var J=0;J<P[Z].length;J++)for(var re=0;re<V;re++)z.vertices.push(P[Z][J][re]);Z>0&&(H+=P[Z-1].length,z.holes.push(H))}return z},t},(jne=Gne())!==void 0&&(Bne.exports=jne);const N2=BR(hH.exports),g6=Q.getLogger("esri.views.3d.support.buffer.math");function Pat(t,e,r){F2(t.typedBuffer,e.typedBuffer,r,t.typedBufferStride,e.typedBufferStride)}function F2(t,e,r,i=3,s=i){if(t.length/i!==Math.ceil(e.length/s))return g6.error("source and destination buffers need to have the same number of elements"),t;const n=t.length/i,o=r[0],a=r[1],l=r[2],c=r[4],h=r[5],p=r[6],f=r[8],m=r[9],y=r[10],_=r[12],v=r[13],w=r[14];let x=0,T=0;for(let S=0;S<n;S++){const O=e[x],A=e[x+1],I=e[x+2];t[T]=o*O+c*A+f*I+_,t[T+1]=a*O+h*A+m*I+v,t[T+2]=l*O+p*A+y*I+w,x+=s,T+=i}return t}function Q2e(t,e,r){fw(t.typedBuffer,e.typedBuffer,r,t.typedBufferStride,e.typedBufferStride)}function fw(t,e,r,i=3,s=i){if(t.length/i!==Math.ceil(e.length/s))return void g6.error("source and destination buffers need to have the same number of elements");const n=t.length/i,o=r[0],a=r[1],l=r[2],c=r[3],h=r[4],p=r[5],f=r[6],m=r[7],y=r[8];let _=0,v=0;for(let w=0;w<n;w++){const x=e[_],T=e[_+1],S=e[_+2];t[v]=o*x+c*T+f*S,t[v+1]=a*x+h*T+m*S,t[v+2]=l*x+p*T+y*S,_+=s,v+=i}}function Mat(t,e,r){M4(t.typedBuffer,e,r,t.typedBufferStride)}function M4(t,e,r,i=3){const s=Math.min(t.length/i,e.count),n=e.typedBuffer,o=e.typedBufferStride;let a=0,l=0;for(let c=0;c<s;c++)t[l]=r*n[a],t[l+1]=r*n[a+1],t[l+2]=r*n[a+2],a+=o,l+=i}function Iat(t,e){y6(t.typedBuffer,e.typedBuffer,t.typedBufferStride,e.typedBufferStride)}function y6(t,e,r=3,i=r){const s=Math.min(t.length/r,e.length/i);let n=0,o=0;for(let a=0;a<s;a++){const l=e[n],c=e[n+1],h=e[n+2],p=l*l+c*c+h*h;if(p>0){const f=1/Math.sqrt(p);t[o]=f*l,t[o+1]=f*c,t[o+2]=f*h}n+=i,o+=r}}function $at(t,e,r){const i=Math.min(t.count,e.count),s=t.typedBuffer,n=t.typedBufferStride,o=e.typedBuffer,a=e.typedBufferStride;let l=0,c=0;for(let h=0;h<i;h++)s[c]=o[l]>>r,s[c+1]=o[l+1]>>r,s[c+2]=o[l+2]>>r,l+=a,c+=n}Object.freeze(Object.defineProperty({__proto__:null,normalize:y6,normalizeView:Iat,scale:M4,scaleView:Mat,shiftRight:$at,transformMat3:fw,transformMat3View:Q2e,transformMat4:F2,transformMat4View:Pat},Symbol.toStringTag,{value:"Module"}));function Lat(t,e,r){return{objectId:t,target:e,distance:r,type:"vertex"}}function Hne(t,e,r,i,s,n=!1){return{objectId:t,target:e,distance:r,type:"edge",start:i,end:s,draped:n}}function _6(t,e){if(!t||t.symbol)return null;const r=e&&e.renderer;return t&&r!=null&&r.getObservationRenderer?r.getObservationRenderer(t):r}function Dat(t,e){if(t.symbol!=null)return t.symbol;const r=_6(t,e);return r!=null&&r.type!=="dot-density"?r.getSymbol(t,e):null}function ELt(t,e){const r=_6(t,e),i=Dat(t,e);if(i==null)return null;const s={renderer:r,symbol:i};if(r==null||!("visualVariables"in r)||!r.visualVariables)return s;const n=nZ(r,t,e)??[],o=["proportional","proportional","proportional"];for(const{variable:a,value:l}of n)switch(a.type){case"color":s.color=l.toRgba();break;case"size":if(a.target==="outline")s.outlineSize=l;else{const c=a.axis,h=a.useSymbolValue?"symbol-value":l;switch(c){case"width":o[0]=h;break;case"depth":o[1]=h;break;case"height":o[2]=h;break;case"width-and-depth":o[0]=o[1]=h;break;default:o[0]=o[1]=o[2]=h}}break;case"opacity":s.opacity=l;break;case"rotation":switch(a.axis){case"tilt":s.tilt=l;break;case"roll":s.roll=l;break;default:s.heading=l}}return o[0]==="proportional"&&o[1]==="proportional"&&o[2]==="proportional"||(s.size=o),s}async function Nat(t,e){if(t.symbol!=null)return t.symbol;const r=_6(t,e);return r!=null?r.getSymbolAsync(t,e):null}async function CLt(t,e){const r=_6(t,e),i=await Nat(t,e);if(!i)return null;const s={renderer:r,symbol:i};if(!r||!("visualVariables"in r)||!r.visualVariables)return s;const n=nZ(r,t,e)??[],o=["proportional","proportional","proportional"];for(const{variable:a,value:l}of n)if(a.type==="color")s.color=ze.toUnitRGBA(l);else if(a.type==="size")if(a.target==="outline")s.outlineSize=l;else{const c=a.axis,h=a.useSymbolValue?"symbol-value":l;c==="width"?o[0]=h:c==="depth"?o[1]=h:c==="height"?o[2]=h:o[0]=o[1]=c==="width-and-depth"?h:o[2]=h}else a.type==="opacity"?s.opacity=l:a.type==="rotation"&&a.axis==="tilt"?s.tilt=l:a.type==="rotation"&&a.axis==="roll"?s.roll=l:a.type==="rotation"&&(s.heading=l);return(isFinite(o[0])||isFinite(o[1])||isFinite(o[2]))&&(s.size=o),s}function Fat(t,e=0){const r=t[e];return typeof r=="number"&&isFinite(r)?r:null}function Uat(t){for(let e=0;e<3;e++){const r=t[e];if(typeof r=="number")return isFinite(r)?r:0}return 0}function qne(t){const e=[[E.POSITION,t.indices]],r=[[E.POSITION,new ke(t.attributeData.position,3,!0)]];return t.attributeData.colorFeature!=null?(r.push([E.COLORFEATUREATTRIBUTE,new ke([t.attributeData.colorFeature],1,!0)]),e.push([E.COLORFEATUREATTRIBUTE,new Array(t.indices.length).fill(0)])):t.attributeData.color&&(r.push([E.COLOR,new ke(t.attributeData.color,4,!0)]),e.push([E.COLOR,gE(t.indices.length)])),t.attributeData.uvMapSpace&&(r.push([E.UVMAPSPACE,new ke(t.attributeData.uvMapSpace,4,!0)]),e.push([E.UVMAPSPACE,t.indices])),t.attributeData.boundingRect&&(r.push([E.BOUNDINGRECT,new ke(t.attributeData.boundingRect,9,!0)]),e.push([E.BOUNDINGRECT,t.indices])),new Vs(t.material,r,e,t.mapPositions,ss.Mesh,t.attributeData.objectAndLayerIdColor)}function Wne(t,e=null){const r=[[E.POSITION,t.indices],[E.UV0,t.indices]],i=[[E.POSITION,new ke(t.attributeData.position,3,!0)],[E.UV0,new ke(t.attributeData.uv0,2,!0)]];return new Vs(t.material,i,r,t.mapPositions,ss.Mesh,e)}function nR(t){switch(t.type){case"extent":if(t instanceof _r)return Jd.fromExtent(t);break;case"polygon":return t}return null}let v6=class{constructor(e,r,i){this.renderData=e,this.layerUid=r,this.graphicUid=i,this.outGeometries=new Array}};function dH(t,e,r){const i=Array.isArray(t),s=i?t.length/e:t.byteLength/(4*e),n=i?t:new Uint32Array(t,0,s*e),o=r?.minReduction??0,a=r?.originalIndices||null,l=a?a.length:0,c=r?.componentOffsets||null;let h=0;if(c)for(let A=0;A<c.length-1;A++){const I=c[A+1]-c[A];I>h&&(h=I)}else h=s;const p=Math.floor(1.1*h)+1;(Ap==null||Ap.length<2*p)&&(Ap=new Uint32Array(iNe(2*p)));for(let A=0;A<2*p;A++)Ap[A]=0;let f=0;const m=!!c&&!!a,y=m?l:s;let _=l4(s);const v=new Uint32Array(l),w=1.96;let x=o!==0?Math.ceil(4*w*w/(o*o)*o*(1-o)):y,T=1,S=c?c[1]:y;for(let A=0;A<y;A++){if(A===x){const U=1-f/A;if(U+w*Math.sqrt(U*(1-U)/A)<o)return null;x*=2}if(A===S){for(let U=0;U<2*p;U++)Ap[U]=0;if(a)for(let U=c[T-1];U<c[T];U++)v[U]=_[a[U]];S=c[++T]}const I=m?a[A]:A,M=I*e,k=zat(n,M,e);let L=k%p,D=f;for(;Ap[2*L+1]!==0;){if(Ap[2*L]===k){const U=Ap[2*L+1]-1;if(kat(n,M,U*e,e)){D=_[U];break}}L++,L>=p&&(L-=p)}D===f&&(Ap[2*L]=k,Ap[2*L+1]=I+1,f++),_[I]=D}if(o!==0&&1-f/s<o)return null;if(m){for(let A=c[T-1];A<v.length;A++)v[A]=_[a[A]];_=If(v)}const O=i?new Array(f):new Uint32Array(f*e);f=0;for(let A=0;A<y;A++)_[A]===f&&(Vat(n,(m?a[A]:A)*e,O,f*e,e),f++);if(a&&!m){const A=new Uint32Array(l);for(let I=0;I<A.length;I++)A[I]=_[a[I]];_=If(A)}return{buffer:Array.isArray(O)?O:O.buffer,indices:_,uniqueCount:f}}function kat(t,e,r,i){for(let s=0;s<i;s++)if(t[e+s]!==t[r+s])return!1;return!0}function Vat(t,e,r,i,s){for(let n=0;n<s;n++)r[i+n]=t[e+n]}function zat(t,e,r){let i=0;for(let s=0;s<r;s++)i=t[e+s]+i|0,i=i+(i<<11)+(i>>>2)|0;return i>>>0}let Ap=null;function OLt(t){const e=hP(t.rings,t.hasZ,qf.CCW_IS_HOLE),r=new Array;let i=0,s=0;for(const a of e.polygons){const l=a.count,c=a.index,h=wh(e.position,3*c,3*l),p=a.holeIndices.map(m=>m-c),f=If(N2(h,p,3));r.push({position:h,faces:f}),i+=h.length,s+=f.length}const n=Bat(r,i,s),o=Array.isArray(n.position)?dH(n.position,3,{originalIndices:n.faces}):dH(n.position.buffer,6,{originalIndices:n.faces});return n.position=Rxe(new Float64Array(o.buffer)),n.faces=o.indices,n}function Bat(t,e,r){if(t.length===1)return t[0];const i=Bo(e),s=new Array(r);let n=0,o=0,a=0;for(const l of t){for(let c=0;c<l.position.length;c++)i[n++]=l.position[c];for(const c of l.faces)s[o++]=c+a;a=n/3}return{position:i,faces:If(s)}}function hP(t,e,r){const i=t.length,s=new Array(i),n=new Array(i),o=new Array(i);let a=0,l=0,c=0,h=0;for(let m=0;m<i;++m)h+=t[m].length;const p=Bo(3*h);let f=0;for(let m=i-1;m>=0;m--){const y=t[m],_=r===qf.CCW_IS_HOLE&&Gat(y);if(_&&i!==1)s[a++]=y;else{let v=y.length;for(let x=0;x<a;++x)v+=s[x].length;const w={index:f,pathLengths:new Array(a+1),count:v,holeIndices:new Array(a)};w.pathLengths[0]=y.length,y.length>0&&(o[c++]={index:f,count:y.length}),f=_?TI(y,y.length-1,-1,p,f,y.length,e):TI(y,0,1,p,f,y.length,e);for(let x=0;x<a;++x){const T=s[x];w.holeIndices[x]=f,w.pathLengths[x+1]=T.length,T.length>0&&(o[c++]={index:f,count:T.length}),f=TI(T,0,1,p,f,T.length,e)}a=0,w.count>0&&(n[l++]=w)}}for(let m=0;m<a;++m){const y=s[m];y.length>0&&(o[c++]={index:f,count:y.length}),f=TI(y,0,1,p,f,y.length,e)}return n.length=l,o.length=c,{position:p,polygons:n,outlines:o}}function TI(t,e,r,i,s,n,o){s*=3;for(let a=0;a<n;++a){const l=t[e];i[s++]=l[0],i[s++]=l[1],i[s++]=o?l[2]:0,e+=r}return s/3}function Gat(t){return!Qq(t,!1,!1)}var qf;(function(t){t[t.NONE=0]="NONE",t[t.CCW_IS_HOLE=1]="CCW_IS_HOLE"})(qf||(qf={}));var eO,I4,pH;(function(t){t[t.RasterImage=0]="RasterImage",t[t.Features=1]="Features"})(eO||(eO={})),function(t){t[t.MapLayer=0]="MapLayer",t[t.ViewLayer=1]="ViewLayer",t[t.Outline=2]="Outline",t[t.SnappingHint=3]="SnappingHint"}(I4||(I4={})),function(t){t[t.WithRasterImage=0]="WithRasterImage",t[t.WithoutRasterImage=1]="WithoutRasterImage"}(pH||(pH={}));let K2e=class{constructor(e,r){this._fbo=null;const i=new vr;i.wrapMode=$t.CLAMP_TO_EDGE,i.samplingMode=Ct.LINEAR_MIPMAP_LINEAR,i.hasMipmap=r,i.maxAnisotropy=8,this._fbo=new hn(e,i)}dispose(){this._fbo=Ue(this._fbo)}getTexture(){return this._fbo?.colorTexture}isValid(){return this._fbo!=null}resize(e,r){this._fbo?.resize(e,r)}bind(e){e.bindFramebuffer(this._fbo)}generateMipMap(){const e=this._fbo?.colorTexture;e?.descriptor.hasMipmap&&e.generateMipmap()}disposeRenderTargetMemory(){this._fbo?.resize(0,0)}get gpuMemoryUsage(){return this._fbo?.gpuMemoryUsage??0}},Sx=class{constructor(e,r,i,s=!0){this.output=r,this.type=i,this.valid=!1,this.lastUsed=1/0,this.fbo=new K2e(e,s)}},jat=class{constructor(e){this.renderTargets=[new Sx(e,N.Color,rs.Color),new Sx(e,N.Color,rs.ColorNoRasterImage),new Sx(e,N.Highlight,rs.Highlight,!1),new Sx(e,N.Normal,rs.Water),new Sx(e,N.Color,rs.Occluded)],oe("enable-feature:objectAndLayerId-rendering")&&this.renderTargets.push(new Sx(e,N.ObjectAndLayerIdColor,rs.ObjectAndLayerIdColor))}getTarget(e){return this.renderTargets[e].fbo}dispose(){for(const e of this.renderTargets)e.fbo.dispose()}disposeRenderTargetMemory(){for(const e of this.renderTargets)e.fbo.disposeRenderTargetMemory()}validateUsageForTarget(e,r,i){return e?(r.lastUsed=i,!1):i-r.lastUsed>Hat?(r.fbo.disposeRenderTargetMemory(),r.lastUsed=1/0,!1):r.lastUsed<1/0}get gpuMemoryUsage(){return this.renderTargets.reduce((e,r)=>e+r.fbo.gpuMemoryUsage,0)}};const Hat=1e3;let eEe=class extends ei{constructor(){super(...arguments),this.color=Lt(1,1,1,1)}};function qat(){const t=new wr;return t.include(Uh),t.fragment.uniforms.add(new Je("tex",e=>e.texture),new sr("uColor",e=>e.color)),t.fragment.code.add(b`void main() {
vec4 texColor = texture(tex, uv);
fragColor = texColor * uColor;
}`),t}const Wat=Object.freeze(Object.defineProperty({__proto__:null,TextureOnlyPassParameters:eEe,build:qat},Symbol.toStringTag,{value:"Module"}));let tEe=class{constructor(e){this._context=e,this._perConstructorInstances=new yE,this._frameCounter=0,this._keepAliveFrameCount=Zne}get viewingMode(){return this._context.viewingMode}get constructionContext(){return this._context}destroy(){this._perConstructorInstances.forEach(e=>e.forEach(r=>r.technique.destroy())),this._perConstructorInstances.clear()}acquire(e,r=Xat){const i=r.key;let s=this._perConstructorInstances.get(e,i);if(s==null){const n=new e(this._context,r,()=>this.release(n));s=new Zat(n),this._perConstructorInstances.set(e,i,s)}return++s.refCount,s.technique}releaseAndAcquire(e,r,i){if(i!=null){if(r.key===i.key)return i;this.release(i)}return this.acquire(e,r)}release(e){if(e==null||this._perConstructorInstances.empty)return;const r=this._perConstructorInstances.get(e.constructor,e.key);r!=null&&(--r.refCount,r.refCount===0&&(r.refZeroFrame=this._frameCounter))}frameUpdate(){this._frameCounter++,this._keepAliveFrameCount!==Zne&&this._perConstructorInstances.forEach((e,r)=>{e.forEach((i,s)=>{i.refCount===0&&i.refZeroFrame+this._keepAliveFrameCount<this._frameCounter&&(i.technique.destroy(),this._perConstructorInstances.delete(r,s))})})}async reloadAll(){const e=new Array;this._perConstructorInstances.forEach((r,i)=>{const s=async(n,o)=>{const a=o.shader;a&&(await a.reload(),n.forEach(l=>l.technique.reload(this._context)))};e.push(s(r,i))}),await Promise.all(e)}},Zat=class{constructor(e){this.technique=e,this.refCount=0,this.refZeroFrame=0}};const Zne=-1,Xat=new pa;let rEe=class{constructor(e,r,i,s){this._textureRepository=e,this._techniqueRepository=r,this.materialChanged=i,this.requestRender=s,this._id2glMaterialRef=new yE}dispose(){this._textureRepository.destroy()}acquire(e,r,i){if(this._ownMaterial(e),!e.requiresSlot(r,i))return null;let s=this._id2glMaterialRef.get(i,e.id);if(s==null){const n=e.createGLMaterial({material:e,techniqueRep:this._techniqueRepository,textureRep:this._textureRepository,output:i});s=new Yat(n),this._id2glMaterialRef.set(i,e.id,s)}return s.ref(),s.glMaterial}release(e,r){const i=this._id2glMaterialRef.get(r,e.id);i!=null&&(i.unref(),i.referenced||(Ue(i.glMaterial),this._id2glMaterialRef.delete(r,e.id)))}_ownMaterial(e){e.repository!=null&&e.repository!==this&&Q.getLogger("esri.views.3d.webgl-engine.lib.GLMaterialRepository").error("Material is already owned by a different material repository"),e.repository=this}},Yat=class{constructor(e){this.glMaterial=e,this._refCnt=0}ref(){++this._refCnt}unref(){--this._refCnt,et(this._refCnt>=0)}get referenced(){return this._refCnt>0}};const Jat={orderedRepackingEnabled:!1},Qat=["layerObjectAdded","layerObjectRemoved","layerObjectsAdded","layerObjectsRemoved","shaderTransformationChanged","objectTransformation","visibilityChanged","occlusionChanged","highlightChanged","objectGeometryAdded","objectGeometryRemoved","objectGeometryUpdated"];let fH=class lD{get bounds(){return this._root.bounds}get halfSize(){return this._root.halfSize}get root(){return this._root.node}get maximumObjectsPerNode(){return this._maximumObjectsPerNode}get maximumDepth(){return this._maximumDepth}get objectCount(){return this._objectCount}constructor(e,r){this.objectToBoundingSphere=e,this._maximumObjectsPerNode=10,this._maximumDepth=20,this._degenerateObjects=new Set,this._root=new Gn,this._objectCount=0,r&&(r.maximumObjectsPerNode!==void 0&&(this._maximumObjectsPerNode=r.maximumObjectsPerNode),r.maximumDepth!==void 0&&(this._maximumDepth=r.maximumDepth))}destroy(){this._degenerateObjects.clear(),Gn.clearPool(),mH[0]=null,Av.prune(),U1.prune()}add(e,r=e.length){this._objectCount+=r,this._grow(e,r);const i=Gn.acquire();for(let s=0;s<r;s++){const n=e[s];this._isDegenerate(n)?this._degenerateObjects.add(n):(i.init(this._root),this._add(n,i))}Gn.release(i)}remove(e,r=null){this._objectCount-=e.length;const i=Gn.acquire();for(const s of e){const n=r??_2(this.objectToBoundingSphere(s),ilt);YA(n[3])?(i.init(this._root),this._remove(s,n,i)):this._degenerateObjects.delete(s)}Gn.release(i),this._shrink()}update(e,r){if(!YA(r[3])&&this._isDegenerate(e))return;const i=rlt(e);this.remove(i,r),this.add(i)}forEachAlongRay(e,r,i){const s=yu(e,r);this._forEachNode(this._root,n=>{if(!this._intersectsNode(s,n))return!1;const o=n.node;return o.terminals.forAll(a=>{this._intersectsObject(s,a)&&i(a)}),o.residents!==null&&o.residents.forAll(a=>{this._intersectsObject(s,a)&&i(a)}),!0})}forEachAlongRayWithVerticalOffset(e,r,i,s){const n=yu(e,r);this._forEachNode(this._root,o=>{if(!this._intersectsNodeWithOffset(n,o,s))return!1;const a=o.node;return a.terminals.forAll(l=>{this._intersectsObjectWithOffset(n,l,s)&&i(l)}),a.residents!==null&&a.residents.forAll(l=>{this._intersectsObjectWithOffset(n,l,s)&&i(l)}),!0})}forEach(e){this._forEachNode(this._root,r=>{const i=r.node;return i.terminals.forAll(e),i.residents!==null&&i.residents.forAll(e),!0}),this._degenerateObjects.forEach(e)}forEachDegenerateObject(e){this._degenerateObjects.forEach(e)}findClosest(e,r,i,s=()=>!0,n=1/0){let o=1/0,a=1/0,l=null;const c=c9(e,r),h=p=>{if(--n,!s(p))return;const f=this.objectToBoundingSphere(p);if(!a_(i,f))return;const m=L0(e,r,f),y=m-f[3],_=m+f[3];y<o&&(o=y,a=_,l=p)};return this._forEachNodeDepthOrdered(this._root,p=>{if(n<=0||!a_(i,p.bounds)||(te(Ru,c,p.halfSize),ce(Ru,Ru,p.bounds),L0(e,r,Ru)>a))return!1;const f=p.node;return f.terminals.forAll(m=>h(m)),f.residents!==null&&f.residents.forAll(m=>h(m)),!0},e,r),l}forEachInDepthRange(e,r,i,s,n,o,a){let l=-1/0,c=1/0;const h={setRange:_=>{i===lD.DepthOrder.FRONT_TO_BACK?(l=Math.max(l,_.near),c=Math.min(c,_.far)):(l=Math.max(l,-_.far),c=Math.min(c,-_.near))}};h.setRange(s);const p=L0(r,i,e),f=c9(r,i),m=c9(r,-i),y=_=>{if(!a(_))return;const v=this.objectToBoundingSphere(_),w=v,x=L0(r,i,w)-p,T=x-v[3],S=x+v[3];T>c||S<l||!a_(o,v)||n(_,h)};this._forEachNodeDepthOrdered(this._root,_=>{if(!a_(o,_.bounds)||(te(Ru,f,_.halfSize),ce(Ru,Ru,_.bounds),L0(r,i,Ru)-p>c)||(te(Ru,m,_.halfSize),ce(Ru,Ru,_.bounds),L0(r,i,Ru)-p<l))return!1;const v=_.node;return v.terminals.forAll(w=>y(w)),v.residents!==null&&v.residents.forAll(w=>y(w)),!0},r,i)}forEachNode(e){this._forEachNode(this._root,r=>e(r.node,r.bounds,r.halfSize,r.depth))}forEachNeighbor(e,r){const i=bg(r),s=r,n=l=>{const c=this.objectToBoundingSphere(l),h=bg(c),p=i+h;return!(yo(c,s)-p*p<=0)||e(l)};let o=!0;const a=l=>{o&&(o=n(l))};this._forEachNode(this._root,l=>{const c=bg(l.bounds),h=i+c;if(yo(l.bounds,s)-h*h>0)return!1;const p=l.node;return p.terminals.forAll(a),o&&p.residents!==null&&p.residents.forAll(a),o}),o&&this.forEachDegenerateObject(a)}_intersectsNode(e,r){return SI(r.bounds,2*-r.halfSize,Yc),SI(r.bounds,2*r.halfSize,Jc),rie(e.origin,e.direction,Yc,Jc)}_intersectsNodeWithOffset(e,r,i){return SI(r.bounds,2*-r.halfSize,Yc),SI(r.bounds,2*r.halfSize,Jc),i.applyToMinMax(Yc,Jc),rie(e.origin,e.direction,Yc,Jc)}_intersectsObject(e,r){const i=this.objectToBoundingSphere(r);return!(i[3]>0)||oG(i,e)}_intersectsObjectWithOffset(e,r,i){const s=this.objectToBoundingSphere(r);return!(s[3]>0)||oG(i.applyToBoundingSphere(s),e)}_forEachNode(e,r){let i=Gn.acquire().init(e);const s=[i];for(;s.length!==0;){if(i=s.pop(),r(i)&&!i.isLeaf())for(let n=0;n<i.node.children.length;n++)i.node.children[n]&&s.push(Gn.acquire().init(i).advance(n));Gn.release(i)}}_forEachNodeDepthOrdered(e,r,i,s=lD.DepthOrder.FRONT_TO_BACK){let n=Gn.acquire().init(e);const o=[n];for(tlt(i,s,Jne);o.length!==0;){if(n=o.pop(),r(n)&&!n.isLeaf())for(let a=7;a>=0;--a){const l=Jne[a];n.node.children[l]&&o.push(Gn.acquire().init(n).advance(l))}Gn.release(n)}}_remove(e,r,i){Av.clear();const s=i.advanceTo(r,(n,o)=>{Av.push(n.node),Av.push(o)})?i.node.terminals:i.node.residents;if(s.removeUnordered(e),s.length===0)for(let n=Av.length-2;n>=0;n-=2){const o=Av.data[n],a=Av.data[n+1];if(!this._purge(o,a))break}}_nodeIsEmpty(e){if(e.terminals.length!==0)return!1;if(e.residents!==null)return e.residents.length===0;for(let r=0;r<e.children.length;r++)if(e.children[r])return!1;return!0}_purge(e,r){return r>=0&&(e.children[r]=null),!!this._nodeIsEmpty(e)&&(e.residents===null&&(e.residents=new kt({shrink:!0})),!0)}_add(e,r){r.advanceTo(this.objectToBoundingSphere(e))?r.node.terminals.push(e):(r.node.residents.push(e),r.node.residents.length>this._maximumObjectsPerNode&&r.depth<this._maximumDepth&&this._split(r))}_split(e){const r=e.node.residents;e.node.residents=null;for(let i=0;i<r.length;i++){const s=Gn.acquire().init(e);this._add(r.at(i),s),Gn.release(s)}}_grow(e,r){if(r!==0&&(Xne(e,r,i=>this.objectToBoundingSphere(i),gm),YA(gm[3])&&!this._fitsInsideTree(gm)))if(this._nodeIsEmpty(this._root.node))_2(gm,this._root.bounds),this._root.halfSize=1.25*this._root.bounds[3],this._root.updateBoundsRadiusFromHalfSize();else{const i=this._rootBoundsForRootAsSubNode(gm);this._placingRootViolatesMaxDepth(i)?this._rebuildTree(gm,i):this._growRootAsSubNode(i),Gn.release(i)}}_rebuildTree(e,r){ie(h9,r.bounds),h9[3]=r.halfSize,Xne([e,h9],2,s=>s,d9);const i=Gn.acquire().init(this._root);this._root.initFrom(null,d9,d9[3]),this._root.increaseHalfSize(1.25),this._forEachNode(i,s=>(this.add(s.node.terminals.data,s.node.terminals.length),s.node.residents!==null&&this.add(s.node.residents.data,s.node.residents.length),!0)),Gn.release(i)}_placingRootViolatesMaxDepth(e){const r=Math.log(e.halfSize/this._root.halfSize)*Math.LOG2E;let i=0;return this._forEachNode(this._root,s=>(i=Math.max(i,s.depth),i+r<=this._maximumDepth)),i+r>this._maximumDepth}_rootBoundsForRootAsSubNode(e){const r=e[3],i=e;let s=-1/0;const n=this._root.bounds,o=this._root.halfSize;for(let l=0;l<3;l++){const c=n[l]-o-(i[l]-r),h=i[l]+r-(n[l]+o),p=Math.max(0,Math.ceil(c/(2*o))),f=Math.max(0,Math.ceil(h/(2*o)))+1,m=2**Math.ceil(Math.log(p+f)*Math.LOG2E);s=Math.max(s,m),EI[l].min=p,EI[l].max=f}for(let l=0;l<3;l++){let c=EI[l].min,h=EI[l].max;const p=(s-(c+h))/2;c+=Math.ceil(p),h+=Math.floor(p);const f=n[l]-o-c*o*2;u9[l]=f+(h+c)*o}const a=s*o;return u9[3]=a*sEe,Gn.acquire().initFrom(null,u9,a,0)}_growRootAsSubNode(e){const r=this._root.node;ie(gm,this._root.bounds),gm[3]=this._root.halfSize,this._root.init(e),e.advanceTo(gm,null,!0),e.node.children=r.children,e.node.residents=r.residents,e.node.terminals=r.terminals}_shrink(){for(;;){const e=this._findShrinkIndex();if(e===-1)break;this._root.advance(e),this._root.depth=0}}_findShrinkIndex(){if(this._root.node.terminals.length!==0||this._root.isLeaf())return-1;let e=null;const r=this._root.node.children;let i=0,s=0;for(;s<r.length&&e==null;)i=s++,e=r[i];for(;s<r.length;)if(r[s++])return-1;return i}_isDegenerate(e){return!YA(this.objectToBoundingSphere(e)[3])}_fitsInsideTree(e){const r=this._root.bounds,i=this._root.halfSize;return e[3]<=i&&e[0]>=r[0]-i&&e[0]<=r[0]+i&&e[1]>=r[1]-i&&e[1]<=r[1]+i&&e[2]>=r[2]-i&&e[2]<=r[2]+i}toJSON(){const{maximumDepth:e,maximumObjectsPerNode:r,_objectCount:i}=this,s=this._nodeToJSON(this._root.node);return{maximumDepth:e,maximumObjectsPerNode:r,objectCount:i,root:{bounds:this._root.bounds,halfSize:this._root.halfSize,depth:this._root.depth,node:s}}}_nodeToJSON(e){const r=e.children.map(n=>n?this._nodeToJSON(n):null),i=e.residents?.map(n=>this.objectToBoundingSphere(n)),s=e.terminals?.map(n=>this.objectToBoundingSphere(n));return{children:r,residents:i,terminals:s}}static fromJSON(e){const r=new lD(i=>i,{maximumDepth:e.maximumDepth,maximumObjectsPerNode:e.maximumObjectsPerNode});return r._objectCount=e.objectCount,r._root.initFrom(e.root.node,e.root.bounds,e.root.halfSize,e.root.depth),r}},Gn=class kT{constructor(){this.bounds=gs(),this.halfSize=0,this.initFrom(null,null,0,0)}init(e){return this.initFrom(e.node,e.bounds,e.halfSize,e.depth)}initFrom(e,r,i,s=this.depth){return this.node=e??kT.createEmptyNode(),r!=null&&_2(r,this.bounds),this.halfSize=i,this.depth=s,this}increaseHalfSize(e){this.halfSize*=e,this.updateBoundsRadiusFromHalfSize()}updateBoundsRadiusFromHalfSize(){this.bounds[3]=this.halfSize*sEe}advance(e){let r=this.node.children[e];r||(r=kT.createEmptyNode(),this.node.children[e]=r),this.node=r,this.halfSize/=2,this.depth++;const i=iEe[e];return this.bounds[0]+=i[0]*this.halfSize,this.bounds[1]+=i[1]*this.halfSize,this.bounds[2]+=i[2]*this.halfSize,this.updateBoundsRadiusFromHalfSize(),this}advanceTo(e,r,i=!1){for(;;){if(this.isTerminalFor(e))return r&&r(this,-1),!0;if(this.isLeaf()){if(!i)return r&&r(this,-1),!1;this.node.residents=null}const s=this._childIndex(e);r&&r(this,s),this.advance(s)}}isLeaf(){return this.node.residents!=null}isTerminalFor(e){return e[3]>this.halfSize/2}_childIndex(e){const r=this.bounds;return(r[0]<e[0]?1:0)+(r[1]<e[1]?2:0)+(r[2]<e[2]?4:0)}static createEmptyNode(){return{children:[null,null,null,null,null,null,null,null],terminals:new kt({shrink:!0}),residents:new kt({shrink:!0})}}static acquire(){return kT._pool.acquire()}static release(e){kT._pool.release(e)}static clearPool(){kT._pool.prune()}};function Kat(t,e){t[0]=Math.min(t[0],e[0]-e[3]),t[1]=Math.min(t[1],e[1]-e[3]),t[2]=Math.min(t[2],e[2]-e[3])}function elt(t,e){t[0]=Math.max(t[0],e[0]+e[3]),t[1]=Math.max(t[1],e[1]+e[3]),t[2]=Math.max(t[2],e[2]+e[3])}function SI(t,e,r){r[0]=t[0]+e,r[1]=t[1]+e,r[2]=t[2]+e}function Xne(t,e,r,i){if(e===1){const s=r(t[0]);_2(s,i)}else{Yc[0]=1/0,Yc[1]=1/0,Yc[2]=1/0,Jc[0]=-1/0,Jc[1]=-1/0,Jc[2]=-1/0;for(let s=0;s<e;s++){const n=r(t[s]);YA(n[3])&&(Kat(Yc,n),elt(Jc,n))}Br(i,Yc,Jc,.5),i[3]=Math.max(Jc[0]-Yc[0],Jc[1]-Yc[1],Jc[2]-Yc[2])/2}}function tlt(t,e,r){if(!U1.length)for(let i=0;i<8;++i)U1.push({index:0,distance:0});for(let i=0;i<8;++i){const s=iEe[i];U1.data[i].index=i,U1.data[i].distance=L0(t,e,s)}U1.sort((i,s)=>i.distance-s.distance);for(let i=0;i<8;++i)r[i]=U1.data[i].index}function c9(t,e){let r,i=1/0;for(let s=0;s<8;++s){const n=L0(t,e,Yne[s]);n<i&&(i=n,r=Yne[s])}return r}function L0(t,e,r){return e*(t[0]*r[0]+t[1]*r[1]+t[2]*r[2])}function YA(t){return!isNaN(t)&&t!==-1/0&&t!==1/0&&t>0}Gn._pool=new Vo(Gn),function(t){var e;(e=t.DepthOrder||(t.DepthOrder={}))[e.FRONT_TO_BACK=1]="FRONT_TO_BACK",e[e.BACK_TO_FRONT=-1]="BACK_TO_FRONT"}(fH||(fH={}));const iEe=[Oe(-1,-1,-1),Oe(1,-1,-1),Oe(-1,1,-1),Oe(1,1,-1),Oe(-1,-1,1),Oe(1,-1,1),Oe(-1,1,1),Oe(1,1,1)],Yne=[Oe(-1,-1,-1),Oe(-1,-1,1),Oe(-1,1,-1),Oe(-1,1,1),Oe(1,-1,-1),Oe(1,-1,1),Oe(1,1,-1),Oe(1,1,1)],sEe=Math.sqrt(3),mH=[null];function rlt(t){return mH[0]=t,mH}const u9=gs(),Ru=C(),Yc=C(),Jc=C(),Av=new kt,ilt=gs(),gm=gs(),h9=gs(),d9=gs(),EI=[{min:0,max:0},{min:0,max:0},{min:0,max:0}],U1=new kt,Jne=[0,0,0,0,0,0,0,0],Wd=fH;var v_;(function(t){t[t.ASYNC=0]="ASYNC",t[t.SYNC=1]="SYNC"})(v_||(v_={}));let nEe=class extends eP{get objects(){return this._objects}constructor(e,r,i=""){super(),this.stage=e,this.apiLayerUid=i,this.type=ss.Layer,this.events=new os,this.sliceable=!1,this._objects=new kt,this._objectsAdded=new kt,this._handles=new Oi,this.apiLayerUid=i,this.visible=r?.visible??!0,this.pickable=r?.pickable??!0,this.updatePolicy=r?.updatePolicy??v_.ASYNC,this._disableOctree=r?.disableOctree??!1,e.add(this);for(const s of Qat)this._handles.add(this.events.on(s,n=>e.handleEvent(s,n)))}destroy(){this._handles.size&&(this._handles.destroy(),this.stage.remove(this),this.invalidateSpatialQueryAccelerator())}add(e){this._objects.push(e),e.parentLayer=this,this.events.emit("layerObjectAdded",{layer:this,object:e}),this._octree!=null&&this._objectsAdded.push(e)}remove(e){this._objects.removeUnordered(e)&&(e.parentLayer=null,this.events.emit("layerObjectRemoved",{layer:this,object:e}),this._octree!=null&&(this._objectsAdded.removeUnordered(e)||this._octree.remove([e])))}addMany(e){this._objects.pushArray(e);for(const r of e)r.parentLayer=this;this.events.emit("layerObjectsAdded",{layer:this,objects:e}),this._octree!=null&&this._objectsAdded.pushArray(e)}removeMany(e){const r=new Array;if(this._objects.removeUnorderedMany(e,e.length,r),r.length!==0){for(const i of r)i.parentLayer=null;if(this.events.emit("layerObjectsRemoved",{layer:this,objects:r}),this._octree!=null){for(let i=0;i<r.length;)this._objectsAdded.removeUnordered(r[i])?(r[i]=r[r.length-1],r.length-=1):++i;this._octree.remove(r)}}}sync(){this.updatePolicy!==v_.SYNC&&this.stage.syncLayer(this.id)}notifyObjectBBChanged(e,r){this._octree==null||this._objectsAdded.includes(e)||this._octree.update(e,r)}getSpatialQueryAccelerator(){return this._octree==null&&this._objects.length>50&&!this._disableOctree?(this._octree=new Wd(e=>e.boundingVolumeWorldSpace.bounds),this._octree.add(this._objects.data,this._objects.length)):this._octree!=null&&this._objectsAdded.length>0&&(this._octree.add(this._objectsAdded.data,this._objectsAdded.length),this._objectsAdded.clear()),this._octree}shaderTransformationChanged(){this.invalidateSpatialQueryAccelerator(),this.events.emit("shaderTransformationChanged",this)}invalidateSpatialQueryAccelerator(){this._octree=Me(this._octree),this._objectsAdded.clear()}};function $4(t){return t!=null&&t.type===ss.Layer}var hu,mw;(function(t){t[t.Draped=0]="Draped",t[t.Screen=1]="Screen",t[t.World=2]="World",t[t.COUNT=3]="COUNT"})(hu||(hu={})),function(t){t[t.Center=0]="Center",t[t.Tip=1]="Tip",t[t.COUNT=2]="COUNT"}(mw||(mw={}));let co=class extends Uo{constructor(){super(...arguments),this.output=N.Color,this.transparencyPassType=ot.NONE,this.occluder=!1,this.hasSlicePlane=!1,this.writeDepth=!1,this.space=hu.Screen,this.hideOnShortSegments=!1,this.hasCap=!1,this.anchor=mw.Center,this.hasTip=!1,this.vvSize=!1,this.vvColor=!1,this.vvOpacity=!1,this.hasOccludees=!1,this.hasMultipassTerrain=!1,this.cullAboveGround=!1}get draped(){return this.space===hu.Draped}};u([B({count:N.COUNT})],co.prototype,"output",void 0),u([B({count:ot.COUNT})],co.prototype,"transparencyPassType",void 0),u([B()],co.prototype,"occluder",void 0),u([B()],co.prototype,"hasSlicePlane",void 0),u([B()],co.prototype,"writeDepth",void 0),u([B({count:hu.COUNT})],co.prototype,"space",void 0),u([B()],co.prototype,"hideOnShortSegments",void 0),u([B()],co.prototype,"hasCap",void 0),u([B({count:mw.COUNT})],co.prototype,"anchor",void 0),u([B()],co.prototype,"hasTip",void 0),u([B()],co.prototype,"vvSize",void 0),u([B()],co.prototype,"vvColor",void 0),u([B()],co.prototype,"vvOpacity",void 0),u([B()],co.prototype,"hasOccludees",void 0),u([B()],co.prototype,"hasMultipassTerrain",void 0),u([B()],co.prototype,"cullAboveGround",void 0),u([B({constValue:!0})],co.prototype,"hasVvInstancing",void 0),u([B({constValue:!0})],co.prototype,"hasSliceTranslatedView",void 0);const Qne=8;function oEe(t,e){const r=t.vertex;r.uniforms.add(new Re("intrinsicWidth",i=>i.width)),e.vvSize?(t.attributes.add(E.SIZEFEATUREATTRIBUTE,"float"),r.uniforms.add(new Ft("vvSizeMinSize",i=>i.vvSize.minSize),new Ft("vvSizeMaxSize",i=>i.vvSize.maxSize),new Ft("vvSizeOffset",i=>i.vvSize.offset),new Ft("vvSizeFactor",i=>i.vvSize.factor)),r.code.add(b`float getSize() {
return intrinsicWidth * clamp(vvSizeOffset + sizeFeatureAttribute * vvSizeFactor, vvSizeMinSize, vvSizeMaxSize).x;
}`)):(t.attributes.add(E.SIZE,"float"),r.code.add(b`float getSize(){
return intrinsicWidth * size;
}`)),e.vvOpacity?(t.attributes.add(E.OPACITYFEATUREATTRIBUTE,"float"),r.constants.add("vvOpacityNumber","int",8),r.uniforms.add(new bl("vvOpacityValues",i=>i.vvOpacity.values,Qne),new bl("vvOpacityOpacities",i=>i.vvOpacity.opacityValues,Qne)),r.code.add(b`float interpolateOpacity( float value ){
if (value <= vvOpacityValues[0]) {
return vvOpacityOpacities[0];
}
for (int i = 1; i < vvOpacityNumber; ++i) {
if (vvOpacityValues[i] >= value) {
float f = (value - vvOpacityValues[i-1]) / (vvOpacityValues[i] - vvOpacityValues[i-1]);
return mix(vvOpacityOpacities[i-1], vvOpacityOpacities[i], f);
}
}
return vvOpacityOpacities[vvOpacityNumber - 1];
}
vec4 applyOpacity( vec4 color ){
return vec4(color.xyz, interpolateOpacity(opacityFeatureAttribute));
}`)):r.code.add(b`vec4 applyOpacity( vec4 color ){
return color;
}`),e.vvColor?(t.include(Sg,e),t.attributes.add(E.COLORFEATUREATTRIBUTE,"float"),r.code.add(b`vec4 getColor(){
return applyOpacity(interpolateVVColor(colorFeatureAttribute));
}`)):(t.attributes.add(E.COLOR,"vec4"),r.code.add(b`vec4 getColor(){
return applyOpacity(color);
}`))}function jg(t,e){switch(t.fragment.include(Ec),e.output){case N.Shadow:case N.ShadowHighlight:case N.ShadowExcludeHighlight:t.fragment.code.add(b`float _calculateFragDepth(const in float depth) {
const float SLOPE_SCALE = 2.0;
const float BIAS = 20.0 * .000015259;
float m = max(abs(dFdx(depth)), abs(dFdy(depth)));
float result = depth + SLOPE_SCALE * m + BIAS;
return clamp(result, .0, .999999);
}
void outputDepth(float _linearDepth) {
fragColor = float2rgba(_calculateFragDepth(_linearDepth));
}`);break;case N.Depth:t.fragment.code.add(b`void outputDepth(float _linearDepth) {
fragColor = float2rgba(_linearDepth);
}`)}}let aEe=class{constructor(e,r,i){this._createTexture=e,this._parametersKey=r,this._repository=new Map,this._orphanCache=i.newCache(`procedural-texture-repository:${gc()}`,s=>s.dispose())}destroy(){for(const[e,{texture:r}]of this._repository)r.dispose();this._repository.clear(),this._orphanCache.destroy()}swap(e,r=null){const i=this._acquire(e);return this.release(r),i}release(e){if(e==null)return;const r=this._parametersKey(e),i=this._repository.get(r);if(i&&(i.refCount--,i.refCount===0)){this._repository.delete(r);const{texture:s}=i,n=s.gpuMemoryUsage;this._orphanCache.put(r,s,n)}}_acquire(e){if(e==null)return null;const r=this._parametersKey(e),i=this._repository.get(r);if(i)return i.refCount++,i.texture;const s=this._orphanCache.pop(r)??this._createTexture(e),n=new slt(s);return this._repository.set(r,n),s}},slt=class{constructor(e){this.texture=e,this.refCount=1}};function nlt(t,e){return new aEe(r=>{const{encodedData:i,paddedPixels:s}=olt(r),n=new vr;return n.internalFormat=Tt.RGBA,n.width=s,n.height=1,n.wrapMode=$t.CLAMP_TO_EDGE,new Et(t,n,i)},r=>`${r.pattern.join(",")}-r${r.pixelRatio}`,e)}function olt(t){const e=qY(t),r=1/t.pixelRatio,i=lEe(t),s=cEe(t),n=(Math.floor(.5*(s-1))+.5)*r,o=[];let a=1;for(const m of e){for(let y=0;y<m;y++){const _=a*(Math.min(y,m-1-y)+.5)*r/n*.5+.5;o.push(_)}a=-a}const l=Math.round(e[0]/2),c=[...o.slice(l),...o.slice(0,l)],h=i+uEe,p=new Uint8Array(4*h);let f=4;for(const m of c)tR(m,p,f),f+=4;return p.copyWithin(0,f-4,f),p.copyWithin(f,4,8),{encodedData:p,paddedPixels:h}}function qY(t){return t.pattern.map(e=>Math.round(e*t.pixelRatio))}function lEe(t){if(t==null)return 1;const e=qY(t);return Math.floor(e.reduce((r,i)=>r+i))}function cEe(t){return qY(t).reduce((e,r)=>Math.max(e,r))}const uEe=2;function alt(t){return t==null?Of:t.length===4?t:bi(llt,t[0],t[1],t[2],1)}const llt=Wt();function hEe(t,e){t.constants.add("stippleAlphaColorDiscard","float",.001),t.constants.add("stippleAlphaHighlightDiscard","float",.5),e.stippleEnabled?clt(t,e):ult(t)}function clt(t,e){const r=!(e.draped&&e.stipplePreferContinuous),{vertex:i,fragment:s}=t;s.include(Ec),e.draped||(up(i,e),i.uniforms.add(new Re("worldToScreenPerDistanceRatio",(n,o)=>1/o.camera.perScreenPixelRatio)),i.code.add(b`float computeWorldToScreenRatio(vec3 segmentCenter) {
float segmentDistanceToCamera = length(segmentCenter - cameraPosition);
return worldToScreenPerDistanceRatio / segmentDistanceToCamera;
}`)),t.varyings.add("vStippleDistance","float"),e.stippleRequiresClamp&&t.varyings.add("vStippleDistanceLimits","vec2"),e.stippleRequiresStretchMeasure&&t.varyings.add("vStipplePatternStretch","float"),i.code.add(b`
    float discretizeWorldToScreenRatio(float worldToScreenRatio) {
      float step = ${dlt};

      float discreteWorldToScreenRatio = log(worldToScreenRatio);
      discreteWorldToScreenRatio = ceil(discreteWorldToScreenRatio / step) * step;
      discreteWorldToScreenRatio = exp(discreteWorldToScreenRatio);
      return discreteWorldToScreenRatio;
    }
  `),i.code.add(b`vec2 computeStippleDistanceLimits(float startPseudoScreen, float segmentLengthPseudoScreen, float segmentLengthScreen, float patternLength) {`),i.code.add(b`
    if (segmentLengthPseudoScreen >= ${r?"patternLength":"1e4"}) {
  `),xE(i,e),i.code.add(b`
        // Round the screen length to get an integer number of pattern repetitions (minimum 1).
        float repetitions = segmentLengthScreen / (patternLength * pixelRatio);
        float flooredRepetitions = max(1.0, floor(repetitions + 0.5));
        float segmentLengthScreenRounded = flooredRepetitions * patternLength;

        ${e.stippleRequiresStretchMeasure?b`
              float stretch = repetitions / flooredRepetitions;

              // We need to impose a lower bound on the stretch factor to prevent the dots from merging together when there is only 1 repetition.
              // 0.75 is the lowest possible stretch value for flooredRepetitions > 1, so it makes sense as lower bound.
              vStipplePatternStretch = max(0.75, stretch);`:""}

        return vec2(0.0, segmentLengthScreenRounded);
      }
      return vec2(startPseudoScreen, startPseudoScreen + segmentLengthPseudoScreen);
    }
  `),s.constants.add("stippleTexturePadding","float",uEe),s.uniforms.add(new Je("stipplePatternTexture",n=>n.stippleTexture),new Re("stipplePatternSDFNormalizer",n=>hlt(n.stipplePattern)),new Re("stipplePatternPixelSizeInv",n=>1/WY(n))),s.code.add(b`float padStippleTexture(float u) {
float paddedTextureSize = float(textureSize(stipplePatternTexture, 0).x);
float unpaddedTextureSize = paddedTextureSize - stippleTexturePadding;
return (u * unpaddedTextureSize + stippleTexturePadding * 0.5) / paddedTextureSize;
}`),s.code.add(b`
    float getStippleSDF(out bool isClamped) {
      ${e.stippleRequiresClamp?b`
          float stippleDistanceClamped = clamp(vStippleDistance, vStippleDistanceLimits.x, vStippleDistanceLimits.y);
          vec2 aaCorrectedLimits = vStippleDistanceLimits + vec2(1.0, -1.0) / gl_FragCoord.w;
          isClamped = vStippleDistance < aaCorrectedLimits.x || vStippleDistance > aaCorrectedLimits.y;`:b`
          float stippleDistanceClamped = vStippleDistance;
          isClamped = false;`}

      float u = stippleDistanceClamped * gl_FragCoord.w * stipplePatternPixelSizeInv;
      ${e.stippleScaleWithLineWidth?b`u *= vLineSizeInv;`:""}
      u = padStippleTexture(fract(u));

      float encodedSDF = rgba2float(texture(stipplePatternTexture, vec2(u, 0.5)));
      float sdf = (encodedSDF * 2.0 - 1.0) * stipplePatternSDFNormalizer;

      ${e.stippleRequiresStretchMeasure?b`return (sdf - 0.5) * vStipplePatternStretch + 0.5;`:b`return sdf;`}
    }

    float getStippleSDF() {
      bool ignored;
      return getStippleSDF(ignored);
    }

    float getStippleAlpha() {
      bool isClamped;
      float stippleSDF = getStippleSDF(isClamped);

      float antiAliasedResult = ${e.stippleScaleWithLineWidth?b`clamp(stippleSDF * vLineWidth + 0.5, 0.0, 1.0);`:b`clamp(stippleSDF + 0.5, 0.0, 1.0);`}

      return isClamped ? floor(antiAliasedResult + 0.5) : antiAliasedResult;
    }
  `),e.stippleOffColorEnabled?(s.uniforms.add(new sr("stippleOffColor",n=>alt(n.stippleOffColor))),s.code.add(b`#define discardByStippleAlpha(stippleAlpha, threshold) {}
#define blendStipple(color, stippleAlpha) mix(color, stippleOffColor, stippleAlpha)`)):s.code.add(b`#define discardByStippleAlpha(stippleAlpha, threshold) if (stippleAlpha < threshold) { discard; }
#define blendStipple(color, stippleAlpha) vec4(color.rgb, color.a * stippleAlpha)`)}function ult(t){t.fragment.code.add(b`float getStippleAlpha() { return 1.0; }
#define discardByStippleAlpha(_stippleAlpha_, _threshold_) {}
#define blendStipple(color, _stippleAlpha_) color`)}function hlt(t){return t?(Math.floor(.5*(cEe(t)-1))+.5)/t.pixelRatio:1}function WY(t){const e=t.stipplePattern;return e?lEe(t.stipplePattern)/e.pixelRatio:1}const dlt=b.float(.4),Lb=64,ZY=Lb/2,dEe=ZY/5,plt=Lb/dEe,flt=.25;function mlt(t,e){const r=DSe(t,Lb,ZY,dEe),i=new vr;return i.internalFormat=Tt.RGBA,i.width=Lb,i.height=Lb,i.wrapMode=$t.CLAMP_TO_EDGE,new Et(e,i,r)}function pEe(t,e){const{vertex:r,constants:i}=t;i.add("markerSizePerLineWidth","float",plt),xE(r,e),r.uniforms.get("markerScale")==null&&r.constants.add("markerScale","float",1),r.code.add(b`float getLineWidth() {
return max(getSize(), 1.0) * pixelRatio;
}
float getScreenMarkerSize() {
return markerSizePerLineWidth * markerScale * getLineWidth();
}`),e.space===hu.World&&(r.constants.add("maxSegmentLengthFraction","float",.45),r.uniforms.add(new Re("perRenderPixelRatio",(s,n)=>n.camera.perRenderPixelRatio)),r.code.add(b`bool areWorldMarkersHidden(vec4 pos, vec4 other) {
vec3 midPoint = mix(pos.xyz, other.xyz, 0.5);
float distanceToCamera = length(midPoint);
float screenToWorldRatio = perRenderPixelRatio * distanceToCamera * 0.5;
float worldMarkerSize = getScreenMarkerSize() * screenToWorldRatio;
float segmentLen = length(pos.xyz - other.xyz);
return worldMarkerSize > maxSegmentLengthFraction * segmentLen;
}
float getWorldMarkerSize(vec4 pos) {
float distanceToCamera = length(pos.xyz);
float screenToWorldRatio = perRenderPixelRatio * distanceToCamera * 0.5;
return getScreenMarkerSize() * screenToWorldRatio;
}`))}var xh;(function(t){t[t.BUTT=0]="BUTT",t[t.SQUARE=1]="SQUARE",t[t.ROUND=2]="ROUND",t[t.COUNT=3]="COUNT"})(xh||(xh={}));let Fi=class extends Uo{constructor(){super(...arguments),this.output=N.Color,this.capType=xh.BUTT,this.transparencyPassType=ot.NONE,this.occluder=!1,this.hasSlicePlane=!1,this.hasPolygonOffset=!1,this.writeDepth=!1,this.draped=!1,this.stippleEnabled=!1,this.stippleOffColorEnabled=!1,this.stippleScaleWithLineWidth=!1,this.stipplePreferContinuous=!0,this.roundJoins=!1,this.applyMarkerOffset=!1,this.vvSize=!1,this.vvColor=!1,this.vvOpacity=!1,this.falloffEnabled=!1,this.innerColorEnabled=!1,this.hasOccludees=!1,this.hasMultipassTerrain=!1,this.cullAboveGround=!1,this.wireframe=!1,this.objectAndLayerIdColorInstanced=!1}};u([B({count:N.COUNT})],Fi.prototype,"output",void 0),u([B({count:xh.COUNT})],Fi.prototype,"capType",void 0),u([B({count:ot.COUNT})],Fi.prototype,"transparencyPassType",void 0),u([B()],Fi.prototype,"occluder",void 0),u([B()],Fi.prototype,"hasSlicePlane",void 0),u([B()],Fi.prototype,"hasPolygonOffset",void 0),u([B()],Fi.prototype,"writeDepth",void 0),u([B()],Fi.prototype,"draped",void 0),u([B()],Fi.prototype,"stippleEnabled",void 0),u([B()],Fi.prototype,"stippleOffColorEnabled",void 0),u([B()],Fi.prototype,"stippleScaleWithLineWidth",void 0),u([B()],Fi.prototype,"stipplePreferContinuous",void 0),u([B()],Fi.prototype,"roundJoins",void 0),u([B()],Fi.prototype,"applyMarkerOffset",void 0),u([B()],Fi.prototype,"vvSize",void 0),u([B()],Fi.prototype,"vvColor",void 0),u([B()],Fi.prototype,"vvOpacity",void 0),u([B()],Fi.prototype,"falloffEnabled",void 0),u([B()],Fi.prototype,"innerColorEnabled",void 0),u([B()],Fi.prototype,"hasOccludees",void 0),u([B()],Fi.prototype,"hasMultipassTerrain",void 0),u([B()],Fi.prototype,"cullAboveGround",void 0),u([B()],Fi.prototype,"wireframe",void 0),u([B({constValue:!0})],Fi.prototype,"stippleRequiresClamp",void 0),u([B({constValue:!0})],Fi.prototype,"stippleRequiresStretchMeasure",void 0),u([B({constValue:!0})],Fi.prototype,"hasVvInstancing",void 0),u([B({constValue:!0})],Fi.prototype,"hasSliceTranslatedView",void 0),u([B()],Fi.prototype,"objectAndLayerIdColorInstanced",void 0);const L4=1;function glt(t){const e=new wr,{vertex:r,fragment:i}=e,s=t.hasMultipassTerrain&&(t.output===N.Color||t.output===N.Alpha);e.include(YR),e.include(oEe,t),e.include(hEe,t);const n=t.applyMarkerOffset&&!t.draped;n&&(r.uniforms.add(new Re("markerScale",m=>m.markerScale)),e.include(pEe,{space:hu.World,draped:!1})),t.output===N.Depth&&e.include(jg,t),e.include(nP,t),vc(r,t),r.uniforms.add(new $i("inverseProjectionMatrix",(m,y)=>y.camera.inverseProjectionMatrix),new Sr("nearFar",(m,y)=>y.camera.nearFar),new Re("miterLimit",m=>m.join!=="miter"?0:m.miterLimit),new sr("viewport",(m,y)=>y.camera.fullViewport)),r.constants.add("LARGE_HALF_FLOAT","float",65500),e.attributes.add(E.POSITION,"vec3"),e.attributes.add(E.SUBDIVISIONFACTOR,"float"),e.attributes.add(E.UV0,"vec2"),e.attributes.add(E.AUXPOS1,"vec3"),e.attributes.add(E.AUXPOS2,"vec3"),e.varyings.add("vColor","vec4"),e.varyings.add("vpos","vec3"),F_(e),s&&e.varyings.add("depth","float");const o=t.stippleEnabled&&t.stippleScaleWithLineWidth;o&&e.varyings.add("vLineSizeInv","float");const a=t.capType===xh.ROUND,l=o||a;l&&e.varyings.add("vLineWidth","float");const c=t.innerColorEnabled||a;c&&e.varyings.add("vLineDistance","float");const h=t.stippleEnabled&&a,p=t.falloffEnabled||h;p&&e.varyings.add("vLineDistanceNorm","float"),a&&(e.varyings.add("vSegmentSDF","float"),e.varyings.add("vReverseSegmentSDF","float")),r.code.add(b`#define PERPENDICULAR(v) vec2(v.y, -v.x);
float interp(float ncp, vec4 a, vec4 b) {
return (-ncp - a.z) / (b.z - a.z);
}
vec2 rotate(vec2 v, float a) {
float s = sin(a);
float c = cos(a);
mat2 m = mat2(c, -s, s, c);
return m * v;
}`),r.code.add(b`vec4 projectAndScale(vec4 pos) {
vec4 posNdc = proj * pos;
posNdc.xy *= viewport.zw / posNdc.w;
return posNdc;
}`),V5(e),r.code.add(b`
    void clipAndTransform(inout vec4 pos, inout vec4 prev, inout vec4 next, in bool isStartVertex) {
      float vnp = nearFar[0] * 0.99;

      if(pos.z > -nearFar[0]) {
        //current pos behind ncp --> we need to clip
        if (!isStartVertex) {
          if(prev.z < -nearFar[0]) {
            //previous in front of ncp
            pos = mix(prev, pos, interp(vnp, prev, pos));
            next = pos;
          } else {
            pos = vec4(0.0, 0.0, 0.0, 1.0);
          }
        } else {
          if(next.z < -nearFar[0]) {
            //next in front of ncp
            pos = mix(pos, next, interp(vnp, pos, next));
            prev = pos;
          } else {
            pos = vec4(0.0, 0.0, 0.0, 1.0);
          }
        }
      } else {
        //current position visible
        if (prev.z > -nearFar[0]) {
          //previous behind ncp
          prev = mix(pos, prev, interp(vnp, pos, prev));
        }
        if (next.z > -nearFar[0]) {
          //next behind ncp
          next = mix(next, pos, interp(vnp, next, pos));
        }
      }

      ${s?"depth = pos.z;":""}
      linearDepth = calculateLinearDepth(nearFar,pos.z);

      pos = projectAndScale(pos);
      next = projectAndScale(next);
      prev = projectAndScale(prev);
    }
  `),xE(r,t),r.code.add(b`
  void main(void) {
    // unpack values from uv0.y
    bool isStartVertex = abs(abs(uv0.y)-3.0) == 1.0;

    float coverage = 1.0;

    // Check for special value of uv0.y which is used by the Renderer when graphics
    // are removed before the VBO is recompacted. If this is the case, then we just
    // project outside of clip space.
    if (uv0.y == 0.0) {
      // Project out of clip space
      gl_Position = vec4(1e038, 1e038, 1e038, 1.0);
    }
    else {
      bool isJoin = abs(uv0.y) < 3.0;

      float lineSize = getSize();
      float lineWidth = lineSize * pixelRatio;

      ${l?b`vLineWidth = lineWidth;`:""}
      ${o?b`vLineSizeInv = 1.0 / lineSize;`:""}

      // convert sub-pixel coverage to alpha
      if (lineWidth < 1.0) {
        coverage = lineWidth;
        lineWidth = 1.0;
      }else{
        // Ribbon lines cannot properly render non-integer sizes. Round width to integer size if
        // larger than one for better quality. Note that we do render < 1 pixels more or less correctly
        // so we only really care to round anything larger than 1.
        lineWidth = floor(lineWidth + 0.5);
      }

      vec4 pos  = view * vec4(position.xyz, 1.0);
      vec4 prev = view * vec4(auxpos1.xyz, 1.0);
      vec4 next = view * vec4(auxpos2.xyz, 1.0);
  `),n&&r.code.add(b`vec4 other = isStartVertex ? next : prev;
bool markersHidden = areWorldMarkersHidden(pos, other);
if(!isJoin && !markersHidden) {
pos.xyz += normalize(other.xyz - pos.xyz) * getWorldMarkerSize(pos) * 0.5;
}`),r.code.add(b`clipAndTransform(pos, prev, next, isStartVertex);
vec2 left = (pos.xy - prev.xy);
vec2 right = (next.xy - pos.xy);
float leftLen = length(left);
float rightLen = length(right);`),(t.stippleEnabled||a)&&r.code.add(b`
      float isEndVertex = float(!isStartVertex);
      vec2 segmentOrigin = mix(pos.xy, prev.xy, isEndVertex);
      vec2 segment = mix(right, left, isEndVertex);
      ${a?b`vec2 segmentEnd = mix(next.xy, pos.xy, isEndVertex);`:""}
    `),r.code.add(b`left = (leftLen > 0.001) ? left/leftLen : vec2(0.0, 0.0);
right = (rightLen > 0.001) ? right/rightLen : vec2(0.0, 0.0);
vec2 capDisplacementDir = vec2(0, 0);
vec2 joinDisplacementDir = vec2(0, 0);
float displacementLen = lineWidth;
if (isJoin) {
bool isOutside = (left.x * right.y - left.y * right.x) * uv0.y > 0.0;
joinDisplacementDir = normalize(left + right);
joinDisplacementDir = PERPENDICULAR(joinDisplacementDir);
if (leftLen > 0.001 && rightLen > 0.001) {
float nDotSeg = dot(joinDisplacementDir, left);
displacementLen /= length(nDotSeg * left - joinDisplacementDir);
if (!isOutside) {
displacementLen = min(displacementLen, min(leftLen, rightLen)/abs(nDotSeg));
}
}
if (isOutside && (displacementLen > miterLimit * lineWidth)) {`),t.roundJoins?r.code.add(b`
        vec2 startDir = leftLen < 0.001 ? right : left;
        startDir = PERPENDICULAR(startDir);

        vec2 endDir = rightLen < 0.001 ? left : right;
        endDir = PERPENDICULAR(endDir);

        float factor = ${t.stippleEnabled?b`min(1.0, subdivisionFactor * ${b.float((L4+2)/(L4+1))})`:b`subdivisionFactor`};

        float rotationAngle = acos(clamp(dot(startDir, endDir), -1.0, 1.0));
        joinDisplacementDir = rotate(startDir, -sign(uv0.y) * factor * rotationAngle);
      `):r.code.add(b`if (leftLen < 0.001) {
joinDisplacementDir = right;
}
else if (rightLen < 0.001) {
joinDisplacementDir = left;
}
else {
joinDisplacementDir = (isStartVertex || subdivisionFactor > 0.0) ? right : left;
}
joinDisplacementDir = PERPENDICULAR(joinDisplacementDir);`);const f=t.capType!==xh.BUTT;return r.code.add(b`
        displacementLen = lineWidth;
      }
    } else {
      // CAP handling ---------------------------------------------------
      joinDisplacementDir = isStartVertex ? right : left;
      joinDisplacementDir = PERPENDICULAR(joinDisplacementDir);

      ${f?b`capDisplacementDir = isStartVertex ? -right : left;`:""}
    }
  `),r.code.add(b`
    // Displacement (in pixels) caused by join/or cap
    vec2 dpos = joinDisplacementDir * sign(uv0.y) * displacementLen + capDisplacementDir * displacementLen;

    ${p||c?b`float lineDistNorm = sign(uv0.y) * pos.w;`:""}

    ${c?b`vLineDistance = lineWidth * lineDistNorm;`:""}
    ${p?b`vLineDistanceNorm = lineDistNorm;`:""}

    pos.xy += dpos;
  `),a&&r.code.add(b`vec2 segmentDir = normalize(segment);
vSegmentSDF = (isJoin && isStartVertex) ? LARGE_HALF_FLOAT : (dot(pos.xy - segmentOrigin, segmentDir) * pos.w) ;
vReverseSegmentSDF = (isJoin && !isStartVertex) ? LARGE_HALF_FLOAT : (dot(pos.xy - segmentEnd, -segmentDir) * pos.w);`),t.stippleEnabled&&(t.draped?r.uniforms.add(new Re("worldToScreenRatio",(m,y)=>1/y.screenToPCSRatio)):r.code.add(b`vec3 segmentCenter = mix((auxpos2 + position) * 0.5, (position + auxpos1) * 0.5, isEndVertex);
float worldToScreenRatio = computeWorldToScreenRatio(segmentCenter);`),r.code.add(b`float segmentLengthScreenDouble = length(segment);
float segmentLengthScreen = segmentLengthScreenDouble * 0.5;
float discreteWorldToScreenRatio = discretizeWorldToScreenRatio(worldToScreenRatio);
float segmentLengthRender = length(mix(auxpos2 - position, position - auxpos1, isEndVertex));
vStipplePatternStretch = worldToScreenRatio / discreteWorldToScreenRatio;`),t.draped?r.code.add(b`float segmentLengthPseudoScreen = segmentLengthScreen / pixelRatio * discreteWorldToScreenRatio / worldToScreenRatio;
float startPseudoScreen = uv0.x * discreteWorldToScreenRatio - mix(0.0, segmentLengthPseudoScreen, isEndVertex);`):r.code.add(b`float startPseudoScreen = mix(uv0.x, uv0.x - segmentLengthRender, isEndVertex) * discreteWorldToScreenRatio;
float segmentLengthPseudoScreen = segmentLengthRender * discreteWorldToScreenRatio;`),r.uniforms.add(new Re("stipplePatternPixelSize",m=>WY(m))),r.code.add(b`
      float patternLength = ${t.stippleScaleWithLineWidth?"lineSize * ":""} stipplePatternPixelSize;

      // Compute the coordinates at both start and end of the line segment, because we need both to clamp to in the fragment shader
      vStippleDistanceLimits = computeStippleDistanceLimits(startPseudoScreen, segmentLengthPseudoScreen, segmentLengthScreen, patternLength);

      vStippleDistance = mix(vStippleDistanceLimits.x, vStippleDistanceLimits.y, isEndVertex);

      // Adjust the coordinate to the displaced position (the pattern is shortened/overextended on the in/outside of joins)
      if (segmentLengthScreenDouble >= 0.001) {
        // Project the actual vertex position onto the line segment. Note that the resulting factor is within [0..1] at the
        // original vertex positions, and slightly outside of that range at the displaced positions
        vec2 stippleDisplacement = pos.xy - segmentOrigin;
        float stippleDisplacementFactor = dot(segment, stippleDisplacement) / (segmentLengthScreenDouble * segmentLengthScreenDouble);

        // Apply this offset to the actual vertex coordinate (can be screen or pseudo-screen space)
        vStippleDistance += (stippleDisplacementFactor - isEndVertex) * (vStippleDistanceLimits.y - vStippleDistanceLimits.x);
      }

      // Cancel out perspective correct interpolation because we want this length the really represent the screen distance
      vStippleDistanceLimits *= pos.w;
      vStippleDistance *= pos.w;

      // Disable stipple distance limits on caps
      vStippleDistanceLimits = isJoin ?
                                 vStippleDistanceLimits :
                                 isStartVertex ?
                                  vec2(-1e038, vStippleDistanceLimits.y) :
                                  vec2(vStippleDistanceLimits.x, 1e038);
    `)),r.code.add(b`
      // Convert back into NDC
      pos.xy = (pos.xy / viewport.zw) * pos.w;

      vColor = getColor();
      vColor.a *= coverage;

      ${t.wireframe&&!t.draped?"pos.z -= 0.001 * pos.w;":""}

      // transform final position to camera space for slicing
      vpos = (inverseProjectionMatrix * pos).xyz;
      gl_Position = pos;
      forwardObjectAndLayerIdColor();
    }
  }
  `),s&&e.include(vu,t),e.include(ps,t),i.include(sm),i.code.add(b`
  void main() {
    discardBySlice(vpos);
    ${s?"terrainDepthTest(gl_FragCoord, depth);":""}
  `),t.wireframe?i.code.add(b`vec4 finalColor = vec4(1.0, 0.0, 1.0, 1.0);`):(a&&i.code.add(b`
      float sdf = min(vSegmentSDF, vReverseSegmentSDF);
      vec2 fragmentPosition = vec2(
        min(sdf, 0.0),
        vLineDistance
      ) * gl_FragCoord.w;

      float fragmentRadius = length(fragmentPosition);
      float fragmentCapSDF = (fragmentRadius - vLineWidth) * 0.5; // Divide by 2 to transform from double pixel scale
      float capCoverage = clamp(0.5 - fragmentCapSDF, 0.0, 1.0);

      if (capCoverage < ${b.float(go)}) {
        discard;
      }
    `),h?i.code.add(b`
      vec2 stipplePosition = vec2(
        min(getStippleSDF() * 2.0 - 1.0, 0.0),
        vLineDistanceNorm * gl_FragCoord.w
      );
      float stippleRadius = length(stipplePosition * vLineWidth);
      float stippleCapSDF = (stippleRadius - vLineWidth) * 0.5; // Divide by 2 to transform from double pixel scale
      float stippleCoverage = clamp(0.5 - stippleCapSDF, 0.0, 1.0);
      float stippleAlpha = step(${b.float(go)}, stippleCoverage);
      `):i.code.add(b`float stippleAlpha = getStippleAlpha();`),i.uniforms.add(new sr("intrinsicColor",m=>m.color)),t.output!==N.ObjectAndLayerIdColor&&i.code.add(b`discardByStippleAlpha(stippleAlpha, stippleAlphaColorDiscard);`),i.code.add(b`vec4 color = intrinsicColor * vColor;`),t.innerColorEnabled&&(i.uniforms.add(new sr("innerColor",m=>m.innerColor??m.color),new Re("innerWidth",(m,y)=>m.innerWidth*y.camera.pixelRatio)),i.code.add(b`float distToInner = abs(vLineDistance * gl_FragCoord.w) - innerWidth;
float innerAA = clamp(0.5 - distToInner, 0.0, 1.0);
float innerAlpha = innerColor.a + color.a * (1.0 - innerColor.a);
color = mix(color, vec4(innerColor.rgb, innerAlpha), innerAA);`)),i.code.add(b`vec4 finalColor = blendStipple(color, stippleAlpha);`),t.falloffEnabled&&(i.uniforms.add(new Re("falloff",m=>m.falloff)),i.code.add(b`finalColor.a *= pow(max(0.0, 1.0 - abs(vLineDistanceNorm * gl_FragCoord.w)), falloff);`))),i.code.add(b`
    ${t.output===N.ObjectAndLayerIdColor?b`finalColor.a = 1.0;`:""}

    if (finalColor.a < ${b.float(go)}) {
      discard;
    }

    ${t.output===N.Alpha?b`fragColor = vec4(finalColor.a);`:""}
    ${t.output===N.Color?b`fragColor = highlightSlice(finalColor, vpos);`:""}
    ${t.output===N.Color&&t.transparencyPassType===ot.Color?"fragColor = premultiplyAlpha(fragColor);":""}
    ${t.output===N.Highlight?b`fragColor = vec4(1.0);`:""}
    ${t.output===N.Depth?b`outputDepth(linearDepth);`:""}
    ${t.output===N.ObjectAndLayerIdColor?b`outputObjectAndLayerIdColor();`:""}
  }
  `),e}const ylt=Object.freeze(Object.defineProperty({__proto__:null,RIBBONLINE_NUM_ROUND_JOIN_SUBDIVISIONS:L4,build:glt},Symbol.toStringTag,{value:"Module"})),XY={func:Kr.LESS},D4={func:Kr.ALWAYS},Wf={mask:255},fEe={mask:0},_lt=t=>({function:{func:Kr.NOTEQUAL,ref:t,mask:t},operation:{fail:fs.KEEP,zFail:fs.KEEP,zPass:fs.KEEP}}),vlt=t=>({function:{func:Kr.ALWAYS,ref:t,mask:t},operation:{fail:fs.KEEP,zFail:fs.KEEP,zPass:fs.REPLACE}}),iv={function:{func:Kr.ALWAYS,ref:Sl.OutlineVisualElementMask,mask:Sl.OutlineVisualElementMask},operation:{fail:fs.KEEP,zFail:fs.KEEP,zPass:fs.ZERO}},H_={function:{func:Kr.ALWAYS,ref:Sl.OutlineVisualElementMask,mask:Sl.OutlineVisualElementMask},operation:{fail:fs.KEEP,zFail:fs.KEEP,zPass:fs.REPLACE}},mEe={function:{func:Kr.EQUAL,ref:Sl.OutlineVisualElementMask,mask:Sl.OutlineVisualElementMask},operation:{fail:fs.KEEP,zFail:fs.KEEP,zPass:fs.KEEP}},gEe={function:{func:Kr.NOTEQUAL,ref:Sl.OutlineVisualElementMask,mask:Sl.OutlineVisualElementMask},operation:{fail:fs.KEEP,zFail:fs.KEEP,zPass:fs.KEEP}},yEe=new Map([[E.POSITION,0],[E.SUBDIVISIONFACTOR,1],[E.UV0,2],[E.AUXPOS1,3],[E.AUXPOS2,4],[E.COLOR,5],[E.COLORFEATUREATTRIBUTE,5],[E.SIZE,6],[E.SIZEFEATUREATTRIBUTE,6],[E.OPACITYFEATUREATTRIBUTE,7],[E.OBJECTANDLAYERIDCOLOR,8]]);let _Ee=class vEe extends Pr{initializeProgram(e){return new Cr(e.rctx,vEe.shader.get().build(this.configuration),yEe)}_makePipelineState(e,r){const i=this.configuration,s=e===ot.NONE,n=e===ot.FrontFace;return At({blending:i.output===N.Color||i.output===N.Alpha?s?uu:oy(e):null,depthTest:{func:rv(e)},depthWrite:s?i.writeDepth?Ol:null:c6(e),colorWrite:Vt,stencilWrite:i.hasOccludees?Wf:null,stencilTest:i.hasOccludees?r?H_:iv:null,polygonOffset:s||n?i.hasPolygonOffset?Kne:null:h6})}initializePipeline(){const e=this.configuration;if(e.occluder){const r=e.hasPolygonOffset?Kne:null;this._occluderPipelineTransparent=At({blending:uu,polygonOffset:r,depthTest:D4,depthWrite:null,colorWrite:Vt,stencilWrite:null,stencilTest:gEe}),this._occluderPipelineOpaque=At({blending:uu,polygonOffset:r,depthTest:D4,depthWrite:null,colorWrite:Vt,stencilWrite:fEe,stencilTest:mEe}),this._occluderPipelineMaskWrite=At({blending:null,polygonOffset:r,depthTest:XY,depthWrite:null,colorWrite:null,stencilWrite:Wf,stencilTest:H_})}return this._occludeePipelineState=this._makePipelineState(this.configuration.transparencyPassType,!0),this._makePipelineState(this.configuration.transparencyPassType,!1)}get primitiveType(){return this.configuration.wireframe?St.LINES:St.TRIANGLE_STRIP}getPipelineState(e,r){return r?this._occludeePipelineState:this.configuration.occluder?e===ue.TRANSPARENT_OCCLUDER_MATERIAL?this._occluderPipelineTransparent:e===ue.OCCLUDER_MATERIAL?this._occluderPipelineOpaque:this._occluderPipelineMaskWrite:super.getPipelineState(e,r)}};_Ee.shader=new Er(ylt,()=>ae(()=>import("./RibbonLine.glsl-0ee74fa4.js"),[],import.meta.url));const Kne={factor:0,units:-4};var Zl;(function(t){t[t.LEFT_JOIN_START=-2]="LEFT_JOIN_START",t[t.LEFT_JOIN_END=-1]="LEFT_JOIN_END",t[t.LEFT_CAP_START=-4]="LEFT_CAP_START",t[t.LEFT_CAP_END=-5]="LEFT_CAP_END",t[t.RIGHT_JOIN_START=2]="RIGHT_JOIN_START",t[t.RIGHT_JOIN_END=1]="RIGHT_JOIN_END",t[t.RIGHT_CAP_START=4]="RIGHT_CAP_START",t[t.RIGHT_CAP_END=5]="RIGHT_CAP_END"})(Zl||(Zl={}));let dS=class extends tv{constructor(e){super(e,new wlt),this._configuration=new Fi,this._vertexAttributeLocations=yEe}isClosed(e,r){return wEe(this.parameters,e,r)}getConfiguration(e,r){this._configuration.output=e,this._configuration.draped=r.slot===ue.DRAPED_MATERIAL;const i=this.parameters.stipplePattern!=null&&e!==N.Highlight;return this._configuration.stippleEnabled=i,this._configuration.stippleOffColorEnabled=i&&this.parameters.stippleOffColor!=null,this._configuration.stippleScaleWithLineWidth=i&&this.parameters.stippleScaleWithLineWidth,this._configuration.stipplePreferContinuous=i&&this.parameters.stipplePreferContinuous,this._configuration.hasSlicePlane=this.parameters.hasSlicePlane,this._configuration.hasOccludees=this.parameters.hasOccludees,this._configuration.roundJoins=this.parameters.join==="round",this._configuration.capType=this.parameters.cap,this._configuration.applyMarkerOffset=this.parameters.markerParameters!=null&&Tlt(this.parameters.markerParameters),this._configuration.hasPolygonOffset=this.parameters.hasPolygonOffset,this._configuration.writeDepth=this.parameters.writeDepth,this._configuration.vvSize=!!this.parameters.vvSize,this._configuration.vvColor=!!this.parameters.vvColor,this._configuration.vvOpacity=!!this.parameters.vvOpacity,this._configuration.innerColorEnabled=this.parameters.innerWidth>0&&this.parameters.innerColor!=null,this._configuration.falloffEnabled=this.parameters.falloff>0,this._configuration.occluder=this.parameters.renderOccluded===Mi.OccludeAndTransparentStencil,this._configuration.transparencyPassType=r.transparencyPassType,this._configuration.hasMultipassTerrain=r.multipassTerrain.enabled,this._configuration.cullAboveGround=r.multipassTerrain.cullAboveGround,this._configuration.wireframe=this.parameters.wireframe,this._configuration}intersectDraped(e,r,i,s,n,o){if(!i.options.selectionMode)return;const a=e.vertexAttributes.get(E.POSITION).data,l=e.vertexAttributes.get(E.SIZE);let c=this.parameters.width;if(this.parameters.vvSize){const _=e.vertexAttributes.get(E.SIZEFEATUREATTRIBUTE).data[0];c*=ge(this.parameters.vvSize.offset[0]+_*this.parameters.vvSize.factor[0],this.parameters.vvSize.minSize[0],this.parameters.vvSize.maxSize[0])}else l&&(c*=l.data[0]);const h=s[0],p=s[1],f=(c/2+4)*e.screenToWorldRatio;let m=Number.MAX_VALUE,y=0;for(let _=0;_<a.length-5;_+=3){const v=a[_],w=a[_+1],x=h-v,T=p-w,S=a[_+3]-v,O=a[_+4]-w,A=ge((S*x+O*T)/(S*S+O*O),0,1),I=S*A-x,M=O*A-T,k=I*I+M*M;k<m&&(m=k,y=_/3)}m<f*f&&n(o.dist,o.normal,y,!1)}intersect(e,r,i,s,n,o){if(!i.options.selectionMode||!e.visible)return;if(!mwe(r))return void Q.getLogger("esri.views.3d.webgl-engine.materials.RibbonLineMaterial").error("intersection assumes a translation-only matrix");const a=e.vertexAttributes,l=a.get(E.POSITION).data;let c=this.parameters.width;if(this.parameters.vvSize){const x=a.get(E.SIZEFEATUREATTRIBUTE).data[0];c*=ge(this.parameters.vvSize.offset[0]+x*this.parameters.vvSize.factor[0],this.parameters.vvSize.minSize[0],this.parameters.vvSize.maxSize[0])}else a.has(E.SIZE)&&(c*=a.get(E.SIZE).data[0]);const h=i.camera,p=Slt;fn(p,i.point);const f=c*h.pixelRatio/2+4*h.pixelRatio;se(pC[0],p[0]-f,p[1]+f,0),se(pC[1],p[0]+f,p[1]+f,0),se(pC[2],p[0]+f,p[1]-f,0),se(pC[3],p[0]-f,p[1]-f,0);for(let x=0;x<4;x++)if(!h.unprojectFromRenderScreen(pC[x],ym[x]))return;ia(h.eye,ym[0],ym[1],f9),ia(h.eye,ym[1],ym[2],m9),ia(h.eye,ym[2],ym[3],g9),ia(h.eye,ym[3],ym[0],y9);let m=Number.MAX_VALUE,y=0;const _=bEe(this.parameters,a,e.indices)?l.length-2:l.length-5;for(let x=0;x<_;x+=3){tl[0]=l[x]+r[12],tl[1]=l[x+1]+r[13],tl[2]=l[x+2]+r[14];const T=(x+3)%l.length;if(rl[0]=l[T]+r[12],rl[1]=l[T+1]+r[13],rl[2]=l[T+2]+r[14],hi(f9,tl)<0&&hi(f9,rl)<0||hi(m9,tl)<0&&hi(m9,rl)<0||hi(g9,tl)<0&&hi(g9,rl)<0||hi(y9,tl)<0&&hi(y9,rl)<0)continue;if(h.projectToRenderScreen(tl,Rv),h.projectToRenderScreen(rl,Pv),Rv[2]<0&&Pv[2]>0){he(Op,tl,rl);const O=h.frustum,A=-hi(O[ui.NEAR],tl)/fe(Op,O[ui.NEAR]);te(Op,Op,A),ce(tl,tl,Op),h.projectToRenderScreen(tl,Rv)}else if(Rv[2]>0&&Pv[2]<0){he(Op,rl,tl);const O=h.frustum,A=-hi(O[ui.NEAR],rl)/fe(Op,O[ui.NEAR]);te(Op,Op,A),ce(rl,rl,Op),h.projectToRenderScreen(rl,Pv)}else if(Rv[2]<0&&Pv[2]<0)continue;Rv[2]=0,Pv[2]=0;const S=pX(Pb(Rv,Pv,roe),p);S<m&&(m=S,ie(eoe,tl),ie(toe,rl),y=x/3)}const v=i.rayBegin,w=i.rayEnd;if(m<f*f){let x=Number.MAX_VALUE;if(Obe(Pb(eoe,toe,roe),Pb(v,w,Elt),Ov)){he(Ov,Ov,v);const T=Ce(Ov);te(Ov,Ov,1/T),x=T/di(v,w)}o(x,Ov,y,!1)}}get _layout(){const e=zi().vec3f(E.POSITION).f32(E.SUBDIVISIONFACTOR).vec2f(E.UV0).vec3f(E.AUXPOS1).vec3f(E.AUXPOS2);return this.parameters.vvSize?e.f32(E.SIZEFEATUREATTRIBUTE):e.f32(E.SIZE),this.parameters.vvColor?e.f32(E.COLORFEATUREATTRIBUTE):e.vec4f(E.COLOR),this.parameters.vvOpacity&&e.f32(E.OPACITYFEATUREATTRIBUTE),oe("enable-feature:objectAndLayerId-rendering")&&e.vec4u8(E.OBJECTANDLAYERIDCOLOR),e}createBufferWriter(){return new xlt(this._layout,this.parameters)}requiresSlot(e,r){return r===N.Color||r===N.Alpha||r===N.Highlight||r===N.Depth||r===N.ObjectAndLayerIdColor?e===ue.DRAPED_MATERIAL?!0:this.parameters.renderOccluded===Mi.OccludeAndTransparentStencil?e===ue.OPAQUE_MATERIAL||e===ue.OCCLUDER_MATERIAL||e===ue.TRANSPARENT_OCCLUDER_MATERIAL:r===N.Color||r===N.Alpha?e===(this.parameters.writeDepth?ue.TRANSPARENT_MATERIAL:ue.TRANSPARENT_DEPTH_WRITE_DISABLED_MATERIAL):e===ue.OPAQUE_MATERIAL:!1}createGLMaterial(e){return new blt(e)}validateParameters(e){e.join!=="miter"&&(e.miterLimit=0),e.markerParameters!=null&&(e.markerScale=e.markerParameters.width/e.width)}},blt=class extends K_{constructor(){super(...arguments),this._stipplePattern=null}dispose(){super.dispose(),this._stippleTextureRepository.release(this._stipplePattern),this._stipplePattern=null}_updateOccludeeState(e){e.hasOccludees!==this._material.parameters.hasOccludees&&this._material.setParameters({hasOccludees:e.hasOccludees})}beginSlot(e){this._output!==N.Color&&this._output!==N.Alpha||this._updateOccludeeState(e);const r=this._material.parameters.stipplePattern;return this._stipplePattern!==r&&(this._material.setParameters({stippleTexture:this._stippleTextureRepository.swap(r,this._stipplePattern)}),this._stipplePattern=r),this.ensureTechnique(_Ee,e)}},wlt=class extends aP{constructor(){super(...arguments),this.width=0,this.color=dh,this.join="miter",this.cap=xh.BUTT,this.miterLimit=5,this.writeDepth=!0,this.hasPolygonOffset=!1,this.stippleTexture=null,this.stippleScaleWithLineWidth=!1,this.stipplePreferContinuous=!0,this.markerParameters=null,this.markerScale=1,this.hasSlicePlane=!1,this.vvFastUpdate=!1,this.isClosed=!1,this.falloff=0,this.innerWidth=0,this.hasOccludees=!1,this.wireframe=!1}},xlt=class{constructor(e,r){this._parameters=r,this.numJoinSubdivisions=0,this.vertexBufferLayout=e;const i=r.stipplePattern?1:0;switch(this._parameters.join){case"miter":case"bevel":this.numJoinSubdivisions=i;break;case"round":this.numJoinSubdivisions=L4+i}}_isClosed(e){return bEe(this._parameters,e.vertexAttributes,e.indices)}allocate(e){return this.vertexBufferLayout.createBuffer(e)}elementCount(e){const i=e.indices.get(E.POSITION).length/2+1,s=this._isClosed(e);let n=s?2:2*2;return n+=((s?i:i-1)-(s?0:1))*(2*this.numJoinSubdivisions+4),n+=2,this._parameters.wireframe&&(n=2+4*(n-2)),n}write(e,r,i,s,n){const o=Clt,a=Alt,l=Olt,c=i.vertexAttributes.get(E.POSITION).data,h=i.indices&&i.indices.get(E.POSITION),p=i.vertexAttributes.get(E.DISTANCETOSTART)?.data;h&&h.length!==2*(c.length/3-1)&&console.warn("RibbonLineMaterial does not support indices");let f=1,m=0;this._parameters.vvSize?m=i.vertexAttributes.get(E.SIZEFEATUREATTRIBUTE).data[0]:i.vertexAttributes.has(E.SIZE)&&(f=i.vertexAttributes.get(E.SIZE).data[0]);let y=[1,1,1,1],_=0;this._parameters.vvColor?_=i.vertexAttributes.get(E.COLORFEATUREATTRIBUTE).data[0]:i.vertexAttributes.has(E.COLOR)&&(y=i.vertexAttributes.get(E.COLOR).data);const v=oe("enable-feature:objectAndLayerId-rendering")?i.objectAndLayerIdColor:null;let w=0;this._parameters.vvOpacity&&(w=i.vertexAttributes.get(E.OPACITYFEATUREATTRIBUTE).data[0]);const x=c.length/3,T=new Float32Array(s.buffer),S=oe("enable-feature:objectAndLayerId-rendering")?new Uint8Array(s.buffer):null,O=this.vertexBufferLayout.stride/4;let A=n*O;const I=A;let M=0;const k=p?(G,Y,P)=>M=p[P]:(G,Y,P)=>M+=di(G,Y),L=oe("enable-feature:objectAndLayerId-rendering"),D=(G,Y,P,V,z,H,Z)=>{if(T[A++]=Y[0],T[A++]=Y[1],T[A++]=Y[2],T[A++]=V,T[A++]=Z,T[A++]=z,T[A++]=G[0],T[A++]=G[1],T[A++]=G[2],T[A++]=P[0],T[A++]=P[1],T[A++]=P[2],T[A++]=this._parameters.vvSize?m:f,this._parameters.vvColor)T[A++]=_;else{const J=Math.min(4*H,y.length-4);T[A++]=y[J],T[A++]=y[J+1],T[A++]=y[J+2],T[A++]=y[J+3]}this._parameters.vvOpacity&&(T[A++]=w),L&&(v!=null&&(S[4*A]=v[0],S[4*A+1]=v[1],S[4*A+2]=v[2],S[4*A+3]=v[3]),A++)};A+=O,se(a,c[0],c[1],c[2]),e&&$e(a,a,e);const U=this._isClosed(i);if(U){const G=c.length-3;se(o,c[G],c[G+1],c[G+2]),e&&$e(o,o,e)}else se(l,c[3],c[4],c[5]),e&&$e(l,l,e),D(a,a,l,1,Zl.LEFT_CAP_START,0,0),D(a,a,l,1,Zl.RIGHT_CAP_START,0,0),ie(o,a),ie(a,l);const X=U?0:1,W=U?x:x-1;for(let G=X;G<W;G++){const Y=(G+1)%x*3;se(l,c[Y],c[Y+1],c[Y+2]),e&&$e(l,l,e),k(o,a,G),D(o,a,l,0,Zl.LEFT_JOIN_END,G,M),D(o,a,l,0,Zl.RIGHT_JOIN_END,G,M);const P=this.numJoinSubdivisions;for(let V=0;V<P;++V){const z=(V+1)/(P+1);D(o,a,l,z,Zl.LEFT_JOIN_END,G,M),D(o,a,l,z,Zl.RIGHT_JOIN_END,G,M)}D(o,a,l,1,Zl.LEFT_JOIN_START,G,M),D(o,a,l,1,Zl.RIGHT_JOIN_START,G,M),ie(o,a),ie(a,l)}U?(se(l,c[3],c[4],c[5]),e&&$e(l,l,e),M=k(o,a,W),D(o,a,l,0,Zl.LEFT_JOIN_END,X,M),D(o,a,l,0,Zl.RIGHT_JOIN_END,X,M)):(M=k(o,a,W),D(o,a,a,0,Zl.LEFT_CAP_END,W,M),D(o,a,a,0,Zl.RIGHT_CAP_END,W,M)),p9(T,I+O,T,I,O),A=p9(T,A-O,T,A,O),this._parameters.wireframe&&this._addWireframeVertices(s,I,A,O)}_addWireframeVertices(e,r,i,s){const n=new Float32Array(e.buffer,i*Float32Array.BYTES_PER_ELEMENT),o=new Float32Array(e.buffer,r*Float32Array.BYTES_PER_ELEMENT,i-r);let a=0;const l=c=>a=p9(o,c,n,a,s);for(let c=0;c<o.length-1;c+=2*s)l(c),l(c+2*s),l(c+1*s),l(c+2*s),l(c+1*s),l(c+3*s)}};function p9(t,e,r,i,s){for(let n=0;n<s;n++)r[i++]=t[e++];return i}function bEe(t,e,r){return wEe(t,e.get(E.POSITION).data,r?r.get(E.POSITION):null)}function wEe(t,e,r){return!!t.isClosed&&(r?r.length>2:e.length>6)}function Tlt(t){return t.anchor===mw.Tip&&t.hideOnShortSegments&&t.placement==="begin-end"&&t.worldSpace}const tl=C(),rl=C(),Op=C(),Ov=C(),Slt=C(),Rv=zo(),Pv=zo(),eoe=C(),toe=C(),roe=dp(),Elt=dp(),Clt=C(),Alt=C(),Olt=C(),pC=[zo(),zo(),zo(),zo()],ym=[C(),C(),C(),C()],f9=Ir(),m9=Ir(),g9=Ir(),y9=Ir();let YY=class{constructor(e){this._originSR=e,this._origins=new Map,this._objects=new Map,this._gridSize=5e5,this._rootOriginId="root/"+gc()}getOrigin(e){const r=this._origins.get(this._rootOriginId);if(r==null){const h=C4(e[0]+Math.random()-.5,e[1]+Math.random()-.5,e[2]+Math.random()-.5,this._rootOriginId);return this._origins.set(this._rootOriginId,h),h}const i=this._gridSize,s=Math.round(e[0]/i),n=Math.round(e[1]/i),o=Math.round(e[2]/i),a=`${s}/${n}/${o}`;let l=this._origins.get(a);const c=.5*i;if(he(to,e,r.vec3),to[0]=Math.abs(to[0]),to[1]=Math.abs(to[1]),to[2]=Math.abs(to[2]),to[0]<c&&to[1]<c&&to[2]<c){if(l){const h=Math.max(...to);if(he(to,e,l.vec3),to[0]=Math.abs(to[0]),to[1]=Math.abs(to[1]),to[2]=Math.abs(to[2]),Math.max(...to)<h)return l}return r}return l||(l=C4(s*i,n*i,o*i,a),this._origins.set(a,l)),l}_drawOriginBox(e,r=Lt(1,1,0,1)){const i=window.view,s=i._stage,n=r.toString();if(!this._objects.has(n)){this._material=new dS({width:2,color:r}),s.add(this._material);const m=new nEe(s,{pickable:!1}),y=new ay({castShadow:!1});s.add(y),m.add(y),this._objects.set(n,y)}const o=this._objects.get(n),a=[0,1,5,4,0,2,1,7,6,2,0,1,3,7,5,4,6,2,0],l=a.length,c=new Array(3*l),h=new Array,p=.5*this._gridSize;for(let m=0;m<l;m++)c[3*m]=e[0]+(1&a[m]?p:-p),c[3*m+1]=e[1]+(2&a[m]?p:-p),c[3*m+2]=e[2]+(4&a[m]?p:-p),m>0&&h.push(m-1,m);oi(c,this._originSR,0,c,i.renderSpatialReference,0,l);const f=new Vs(this._material,[[E.POSITION,new ke(c,3,!0)]],[[E.POSITION,h]],null,ss.Line);s.add(f),o.addGeometry(f)}get test(){const e=this;return{set gridSize(r){e._gridSize=r}}}};const to=C();let xEe=class{constructor(e,r,i,s=null){this.rctx=e,this.sliceHelper=s,this.lastFrameCamera=new ut,this.output=N.Color,this.renderOccludedMask=ioe,this.bindParameters=new k5(r,i,s!=null?s.plane:null),this.bindParameters.alignPixelEnabled=!0}resetRenderOccludedMask(){this.renderOccludedMask=ioe}},Rlt=class extends xEe{constructor(e,r,i,s,n){super(e,i,s,n),this.offscreenRenderingHelper=r,this.sliceHelper=n,this.time=0}};const ioe=Mi.Occlude|Mi.OccludeAndTransparent|Mi.OccludeAndTransparentStencil;let JA=class extends ut{constructor(){super(...arguments),this._projectionMatrix=be()}get projectionMatrix(){return this._projectionMatrix}};u([d()],JA.prototype,"_projectionMatrix",void 0),u([d({readOnly:!0})],JA.prototype,"projectionMatrix",null),JA=u([R("esri.views.3d.webgl-engine.lib.CascadeCamera")],JA);const soe=16;function JY(t){return Math.ceil(t/soe)*soe}var U2;(function(t){t[t.Highlight=0]="Highlight",t[t.Default=1]="Default"})(U2||(U2={}));let CI=class{constructor(){this.camera=new JA,this.lightMat=be()}},Plt=class{constructor(){this.maxNumCascadesHighQuality=4,this.maxNumCascadesLowQuality=4,this.textureSizeModHighQuality=1.3,this.textureSizeModLowQuality=.9,this.splitSchemeLambda=0}},QY=class{get depthTexture(){return this._fbo?.colorTexture}get textureSize(){return this._textureSize}get numCascades(){return this._numCascades}get cascadeDistances(){return bi(this._usedCascadeDistances,this._cascadeDistances[0],this._numCascades>1?this._cascadeDistances[1]:1/0,this._numCascades>2?this._cascadeDistances[2]:1/0,this._numCascades>3?this._cascadeDistances[3]:1/0)}constructor(e,r){this._rctx=e,this._viewingMode=r,this._enabled=!1,this._snapshots=new Array,this._textureSize=0,this._numCascades=1,this.settings=new Plt,this._projectionView=be(),this._projectionViewInverse=be(),this._modelViewLight=be(),this._cascadeDistances=[0,0,0,0,0],this._usedCascadeDistances=Wt(),this._cascades=[new CI,new CI,new CI,new CI],this._lastOrigin=null,this._maxTextureSize=Math.min(oe("esri-mobile")?2048:8192,this._rctx.parameters.maxTextureSize)}dispose(){this.enabled=!1,this.disposeOffscreenBuffers()}disposeOffscreenBuffers(){this._fbo=Ue(this._fbo),this._discardAllSnapshots()}set maxCascades(e){this.settings.maxNumCascadesHighQuality=ge(Math.floor(e),1,4)}get maxCascades(){return this.settings.maxNumCascadesHighQuality}set enabled(e){this._enabled=e,e||this.disposeOffscreenBuffers()}get enabled(){return this._enabled}get ready(){return this._enabled&&this.depthTexture!=null}getSnapshot(e){return this.enabled?this._snapshots[e]:null}get cascades(){for(let e=0;e<this._numCascades;++e)v9[e]=this._cascades[e];return v9.length=this._numCascades,v9}start(e,r,i,s,n){et(this.enabled),this._textureSize=this._computeTextureSize(e,n,s),this._ensureDepthTexture();const{near:o,far:a}=this._clampNearFar(i);this._computeCascadeDistances(a,o,s),this._setupMatrices(e,r);const{viewMatrix:l,projectionMatrix:c}=e;for(let h=0;h<this._numCascades;++h)this._constructCascade(h,c,l,r);this._lastOrigin=null,this.clear()}finish(e){et(this.enabled),this._rctx.bindFramebuffer(e)}getShadowMapMatrices(e){if(!this._lastOrigin||!la(e,this._lastOrigin)){this._lastOrigin=this._lastOrigin||C(),ie(this._lastOrigin,e);for(let r=0;r<this._numCascades;++r){Al(uoe,this._cascades[r].lightMat,e);for(let i=0;i<16;++i)hoe[16*r+i]=uoe[i]}}return hoe}takeCascadeSnapshotTo(e,r){et(this.enabled);const i=this._ensureSnapshot(r);this._bindFbo();const s=this._rctx,n=s.bindTexture(i,Et.TEXTURE_UNIT_FOR_UPDATES);s.gl.copyTexSubImage2D(is.TEXTURE_2D,0,e.camera.viewport[0],e.camera.viewport[1],e.camera.viewport[0],e.camera.viewport[1],e.camera.viewport[2],e.camera.viewport[3]),s.bindTexture(n,Et.TEXTURE_UNIT_FOR_UPDATES)}clear(){const e=this._rctx;this._bindFbo(),e.setClearColor(1,1,1,1),e.clearSafe(wi.COLOR_BUFFER_BIT|wi.DEPTH_BUFFER_BIT)}_computeTextureSize(e,r,i){const s=Math.min(window.devicePixelRatio,r)/e.pixelRatio,n=Math.max(e.fullWidth,e.fullHeight)*s,o=i?this.settings.textureSizeModHighQuality:this.settings.textureSizeModLowQuality;return Math.floor(Math.min(this._maxTextureSize,JY((this.numCascades===1?1:2)*n*o)))}_ensureDepthTexture(){if(this._fbo?.width===this._textureSize)return;const e=new vr(this._textureSize);e.wrapMode=$t.CLAMP_TO_EDGE,e.samplingMode=Ct.NEAREST,this._fbo?.dispose(),this._fbo=new hn(this._rctx,e,new r4(js.DEPTH_COMPONENT16,this._textureSize))}_ensureSnapshot(e){let r=this._snapshots[e];if(r!=null&&r.descriptor.width===this._textureSize)return r;this._discardSnapshot(e);const i=new vr;return i.wrapMode=$t.CLAMP_TO_EDGE,i.samplingMode=Ct.NEAREST,i.width=this._textureSize,i.height=this._textureSize,r=new Et(this._rctx,i),this._snapshots[e]=r,r}_discardSnapshot(e){this._snapshots[e]=Ue(this._snapshots[e])}_discardAllSnapshots(){for(let e=0;e<this._snapshots.length;++e)this._discardSnapshot(e);this._snapshots.length=0}_bindFbo(){const e=this._rctx;e.unbindTexture(this.depthTexture),e.bindFramebuffer(this._fbo)}_constructCascade(e,r,i,s){const n=this._cascades[e],o=-this._cascadeDistances[e],a=-this._cascadeDistances[e+1],l=(r[10]*o+r[14])/Math.abs(r[11]*o+r[15]),c=(r[10]*a+r[14])/Math.abs(r[11]*a+r[15]);et(l<c);for(let m=0;m<8;++m){bi(noe,m%4==0||m%4==3?-1:1,m%4==0||m%4==1?-1:1,m<4?l:c,1);const y=eh[m];su(y,noe,this._projectionViewInverse),y[0]/=y[3],y[1]/=y[3],y[2]/=y[3]}ca(_9,eh[0]),n.camera.viewMatrix=Al(Mlt,this._modelViewLight,_9);for(let m=0;m<8;++m)$e(eh[m],eh[m],n.camera.viewMatrix);let h=eh[0][2],p=eh[0][2];for(let m=1;m<8;++m)h=Math.min(h,eh[m][2]),p=Math.max(p,eh[m][2]);h-=200,p+=200,n.camera.near=-p,n.camera.far=-h,Dlt(i,s,h,p,n.camera),si(n.lightMat,n.camera.projectionMatrix,n.camera.viewMatrix);const f=this._textureSize/(this.numCascades===1?1:2);n.camera.viewport=[e%2==0?0:f,Math.floor(e/2)===0?0:f,f,f]}_setupMatrices(e,r){si(this._projectionView,e.projectionMatrix,e.viewMatrix),On(this._projectionViewInverse,this._projectionView);const i=this._viewingMode===De.Global?e.eye:se(_9,0,0,1);c5(this._modelViewLight,[0,0,0],[-r[0],-r[1],-r[2]],i)}_clampNearFar(e){let{near:r,far:i}=e;return r<2&&(r=2),i<2&&(i=2),r>=i&&(r=2,i=4),{near:r,far:i}}_computeCascadeDistances(e,r,i){const s=i?this.settings.maxNumCascadesHighQuality:this.settings.maxNumCascadesLowQuality;this._numCascades=Math.min(1+Math.floor(TYe(e/r,4)),s);const n=(e-r)/this._numCascades,o=(e/r)**(1/this._numCascades);let a=r,l=r;for(let c=0;c<this._numCascades+1;++c)this._cascadeDistances[c]=wt(a,l,this.settings.splitSchemeLambda),a*=o,l+=n}get gpuMemoryUsage(){return this._snapshots.reduce((e,r)=>e+(r?.gpuMemoryUsage??0),this._fbo?.gpuMemoryUsage??0)}get test(){return{cascades:this._cascades,textureSize:this._textureSize}}};const Mlt=be(),noe=Wt(),eh=[];for(let t=0;t<8;++t)eh.push(Wt());const ooe=Ve(),aoe=Ve(),Ilt=Ve(),loe=Ve(),coe=Ve(),_9=C(),v9=[],uoe=be(),hoe=new Array(64),Lc=Ve(),Ex=Ve(),Mv=[Ve(),Ve(),Ve(),Ve()],_n=Ve(),b9=Ve(),Fy=Ve(),fC=Ve(),Cx=Ve(),Ax=Ve(),AI=Ve();function $lt(t,e,r,i,s,n,o,a){or(Lc,0,0);for(let O=0;O<4;++O)Ld(Lc,Lc,t[O]);lc(Lc,Lc,.25),or(Ex,0,0);for(let O=4;O<8;++O)Ld(Ex,Ex,t[O]);lc(Ex,Ex,.25),nh(Mv[0],t[4],t[5],.5),nh(Mv[1],t[5],t[6],.5),nh(Mv[2],t[6],t[7],.5),nh(Mv[3],t[7],t[4],.5);let l=0,c=UN(Mv[0],Lc);for(let O=1;O<4;++O){const A=UN(Mv[O],Lc);A<c&&(c=A,l=O)}gf(_n,Mv[l],t[l+4]);const h=_n[0];let p,f;_n[0]=-_n[1],_n[1]=h,gf(b9,Ex,Lc),Ks(b9,_n)<0&&ZZ(_n,_n),nh(_n,_n,b9,r),VO(_n,_n),p=f=Ks(gf(Fy,t[0],Lc),_n);for(let O=1;O<8;++O){const A=Ks(gf(Fy,t[O],Lc),_n);A<p?p=A:A>f&&(f=A)}fn(i,Lc),lc(Fy,_n,p-e),Ld(i,i,Fy);let m=-1,y=1,_=0,v=0;for(let O=0;O<8;++O){gf(fC,t[O],i),VO(fC,fC);const A=_n[0]*fC[1]-_n[1]*fC[0];A>0?A>m&&(m=A,_=O):A<y&&(y=A,v=O)}nx(m>0,"leftArea"),nx(y<0,"rightArea"),lc(Cx,_n,p),Ld(Cx,Cx,Lc),lc(Ax,_n,f),Ld(Ax,Ax,Lc),AI[0]=-_n[1],AI[1]=_n[0];const w=IM(i,t[v],Ax,Ld(Fy,Ax,AI),1,s),x=IM(i,t[_],Ax,Fy,1,n),T=IM(i,t[_],Cx,Ld(Fy,Cx,AI),1,o),S=IM(i,t[v],Cx,Fy,1,a);nx(w,"rayRay"),nx(x,"rayRay"),nx(T,"rayRay"),nx(S,"rayRay")}function mr(t,e){return 3*e+t}const doe=Ve();function $l(t,e){return or(doe,t[e],t[e+3]),doe}const il=Ve(),We=Li();function Llt(t,e,r,i,s){gf(il,r,i),lc(il,il,.5),We[0]=il[0],We[1]=il[1],We[2]=0,We[3]=il[1],We[4]=-il[0],We[5]=0,We[6]=il[0]*il[0]+il[1]*il[1],We[7]=il[0]*il[1]-il[1]*il[0],We[8]=1,We[mr(0,2)]=-Ks($l(We,0),t),We[mr(1,2)]=-Ks($l(We,1),t);let n=Ks($l(We,0),r)+We[mr(0,2)],o=Ks($l(We,1),r)+We[mr(1,2)],a=Ks($l(We,0),i)+We[mr(0,2)],l=Ks($l(We,1),i)+We[mr(1,2)];n=-(n+a)/(o+l),We[mr(0,0)]+=We[mr(1,0)]*n,We[mr(0,1)]+=We[mr(1,1)]*n,We[mr(0,2)]+=We[mr(1,2)]*n,n=1/(Ks($l(We,0),r)+We[mr(0,2)]),o=1/(Ks($l(We,1),r)+We[mr(1,2)]),We[mr(0,0)]*=n,We[mr(0,1)]*=n,We[mr(0,2)]*=n,We[mr(1,0)]*=o,We[mr(1,1)]*=o,We[mr(1,2)]*=o,We[mr(2,0)]=We[mr(1,0)],We[mr(2,1)]=We[mr(1,1)],We[mr(2,2)]=We[mr(1,2)],We[mr(1,2)]+=1,n=Ks($l(We,1),e)+We[mr(1,2)],o=Ks($l(We,2),e)+We[mr(2,2)],a=Ks($l(We,1),r)+We[mr(1,2)],l=Ks($l(We,2),r)+We[mr(2,2)],n=-.5*(n/o+a/l),We[mr(1,0)]+=We[mr(2,0)]*n,We[mr(1,1)]+=We[mr(2,1)]*n,We[mr(1,2)]+=We[mr(2,2)]*n,n=Ks($l(We,1),e)+We[mr(1,2)],o=Ks($l(We,2),e)+We[mr(2,2)],a=-o/n,We[mr(1,0)]*=a,We[mr(1,1)]*=a,We[mr(1,2)]*=a,s[0]=We[0],s[1]=We[1],s[2]=0,s[3]=We[2],s[4]=We[3],s[5]=We[4],s[6]=0,s[7]=We[5],s[8]=0,s[9]=0,s[10]=1,s[11]=0,s[12]=We[6],s[13]=We[7],s[14]=0,s[15]=We[8]}function Dlt(t,e,r,i,s){const n=1/eh[0][3],o=1/eh[4][3];et(n<o);let a=n+Math.sqrt(n*o);const l=Math.sin(Pn(t[2]*e[0]+t[6]*e[1]+t[10]*e[2]));a/=l,$lt(eh,a,l,ooe,aoe,Ilt,loe,coe),Llt(ooe,aoe,loe,coe,s.projectionMatrix),s.projectionMatrix[10]=2/(r-i),s.projectionMatrix[14]=-(r+i)/(r-i)}function Nlt(t){return fp(t)&&t.intersector===ki.TERRAIN&&!!t.target}let Flt=class extends X5{constructor(e,r,i){super(e,r),this.triangleNr=i}};function TEe(t){return fp(t)&&t.intersector===ki.OVERLAY&&!!t.target}let gH=class{constructor(){this.adds=new kt,this.removes=new kt,this.updates=new kt({allocator:e=>e||new Ult,deallocator:e=>(e.renderGeometry=null,e)})}clear(){this.adds.clear(),this.removes.clear(),this.updates.clear()}prune(){this.adds.prune(),this.removes.prune(),this.updates.prune()}get empty(){return this.adds.length===0&&this.removes.length===0&&this.updates.length===0}},Ult=class{},klt=class{constructor(){this.adds=new Array,this.removes=new Array,this.updates=new Array}};var ji,Tn;(function(t){t[t.ADD=0]="ADD",t[t.UPDATE=1]="UPDATE",t[t.REMOVE=2]="REMOVE"})(ji||(ji={})),function(t){t[t.NONE=0]="NONE",t[t.VISIBILITY=1]="VISIBILITY",t[t.GEOMETRY=2]="GEOMETRY",t[t.TRANSFORMATION=4]="TRANSFORMATION",t[t.HIGHLIGHT=8]="HIGHLIGHT",t[t.OCCLUDEE=16]="OCCLUDEE"}(Tn||(Tn={}));function SEe(t){const e=new Map,r=i=>{let s=e.get(i);return s||(s=new klt,e.set(i,s)),s};return t.removes.forAll(i=>{w9(i)&&r(i.material).removes.push(i)}),t.adds.forAll(i=>{w9(i)&&r(i.material).adds.push(i)}),t.updates.forAll(i=>{w9(i.renderGeometry)&&r(i.renderGeometry.material).updates.push(i)}),e}function w9(t){return t.geometry.indexCount>=1}let EEe=class{constructor(e,r){this._material=e,this._repository=r,this._map=new Map}destroy(){this._map.forEach((e,r)=>{e!=null&&this._repository.release(this._material,r)})}load(e,r,i){if(!this._material.requiresSlot(r,i))return null;this._map.has(i)||this._map.set(i,this._repository.acquire(this._material,r,i));const s=this._map.get(i);if(s!=null){if(s.ensureResources(e)===wg.LOADED)return s;this._repository.requestRender()}return null}};function dP(t,e){switch(e.normalType){case Or.Compressed:t.attributes.add(E.NORMALCOMPRESSED,"vec2"),t.vertex.code.add(b`vec3 normalModel() {
float z = 1.0 - abs(normalCompressed.x) - abs(normalCompressed.y);
return vec3(normalCompressed + sign(normalCompressed) * min(z, 0.0), z);
}`);break;case Or.Attribute:t.attributes.add(E.NORMAL,"vec3"),t.vertex.code.add(b`vec3 normalModel() {
return normal;
}`);break;case Or.ScreenDerivative:t.fragment.code.add(b`vec3 screenDerivativeNormal(vec3 positionView) {
return normalize(cross(dFdx(positionView), dFdy(positionView)));
}`);break;default:e.normalType;case Or.COUNT:case Or.Ground:}}var Or;(function(t){t[t.Attribute=0]="Attribute",t[t.Compressed=1]="Compressed",t[t.Ground=2]="Ground",t[t.ScreenDerivative=3]="ScreenDerivative",t[t.COUNT=4]="COUNT"})(Or||(Or={}));function b6(t,e){switch(e.normalType){case Or.Attribute:case Or.Compressed:t.include(dP,e),t.varyings.add("vNormalWorld","vec3"),t.varyings.add("vNormalView","vec3"),t.vertex.uniforms.add(new qO("transformNormalGlobalFromModel",r=>r.transformNormalGlobalFromModel),new kh("transformNormalViewFromGlobal",r=>r.transformNormalViewFromGlobal)),t.vertex.code.add(b`void forwardNormal() {
vNormalWorld = transformNormalGlobalFromModel * normalModel();
vNormalView = transformNormalViewFromGlobal * vNormalWorld;
}`);break;case Or.Ground:t.include(LS,e),t.varyings.add("vNormalWorld","vec3"),t.vertex.code.add(b`
        void forwardNormal() {
          vNormalWorld = ${e.spherical?b`normalize(vPositionWorldCameraRelative);`:b`vec3(0.0, 0.0, 1.0);`}
        }
        `);break;case Or.ScreenDerivative:t.vertex.code.add(b`void forwardNormal() {}`);break;default:e.normalType;case Or.COUNT:}}let CEe=class extends lxe{constructor(){super(...arguments),this.transformNormalViewFromGlobal=Li()}},AEe=class extends cxe{constructor(){super(...arguments),this.transformNormalGlobalFromModel=Li(),this.toMapSpace=Wt()}},yH=class extends AEe{constructor(e=C()){super(),this.origin=e,this.slicePlaneLocalOrigin=this.origin}},TE=class{constructor(e){this.vertexBufferLayout=e}elementCount(e){return e.indices.get(E.POSITION).length}write(e,r,i,s,n){ASe(i,this.vertexBufferLayout,e,r,s,n)}};const Vlt=zi().vec3f(E.POSITION),zlt=zi().vec3f(E.POSITION).vec2f(E.UV0),Blt=zi().vec3f(E.POSITION).vec4u8(E.COLOR);zi().vec3f(E.POSITION).vec4u8(E.OBJECTANDLAYERIDCOLOR);const Glt=zi().vec3f(E.POSITION).vec2f(E.UV0).vec4u8(E.OBJECTANDLAYERIDCOLOR);zi().vec3f(E.POSITION).vec4u8(E.COLOR).vec4u8(E.OBJECTANDLAYERIDCOLOR);let KY=class extends tv{intersect(e,r,i,s,n,o){return mSe(e,i,s,n,void 0,o)}};function jlt(t){t.fragment.code.add(b`float normals2FoamIntensity(vec3 n, float waveStrength){
float normalizationFactor =  max(0.015, waveStrength);
return max((n.x + n.y)*0.3303545/normalizationFactor + 0.3303545, 0.0);
}`)}function Hlt(t){t.fragment.code.add(b`vec3 foamIntensity2FoamColor(float foamIntensityExternal, float foamPixelIntensity, vec3 skyZenitColor, float dayMod){
return foamIntensityExternal * (0.075 * skyZenitColor * pow(foamPixelIntensity, 4.) +  50.* pow(foamPixelIntensity, 23.0)) * dayMod;
}`)}let pP=class extends as{constructor(e,r){super(e,"int",Qr.Pass,(i,s,n)=>i.setUniform1i(e,r(s,n)))}},qlt=class extends as{constructor(e,r,i){super(e,"mat4",Qr.Draw,(s,n,o,a)=>s.setUniformMatrix4fv(e,r(n,o,a)),i)}},Wlt=class extends as{constructor(e,r,i){super(e,"mat4",Qr.Pass,(s,n,o)=>s.setUniformMatrix4fv(e,r(n,o)),i)}},Zlt=class extends ei{constructor(){super(...arguments),this.origin=C()}},Xlt=class extends Zlt{},Ylt=class extends ei{constructor(){super(...arguments),this.modelTransformation=un}},eJ=class extends Ylt{constructor(){super(...arguments),this.origin=C()}};function w6(t,e){e.receiveShadows&&(t.fragment.uniforms.add(new Wlt("shadowMapMatrix",(r,i)=>i.shadowMap.getShadowMapMatrices(r.origin),4)),OEe(t))}function gw(t,e){e.receiveShadows&&(t.fragment.uniforms.add(new qlt("shadowMapMatrix",(r,i)=>i.shadowMap.getShadowMapMatrices(r.origin),4)),OEe(t))}function OEe(t){const e=t.fragment;e.include(Ec),e.uniforms.add(new Je("shadowMapTex",(r,i)=>i.shadowMap.depthTexture),new pP("numCascades",(r,i)=>i.shadowMap.numCascades),new sr("cascadeDistances",(r,i)=>i.shadowMap.cascadeDistances)),e.code.add(b`int chooseCascade(float depth, out mat4 mat) {
vec4 distance = cascadeDistances;
int i = depth < distance[1] ? 0 : depth < distance[2] ? 1 : depth < distance[3] ? 2 : 3;
mat = i == 0 ? shadowMapMatrix[0] : i == 1 ? shadowMapMatrix[1] : i == 2 ? shadowMapMatrix[2] : shadowMapMatrix[3];
return i;
}
vec3 lightSpacePosition(vec3 _vpos, mat4 mat) {
vec4 lv = mat * vec4(_vpos, 1.0);
lv.xy /= lv.w;
return 0.5 * lv.xyz + vec3(0.5);
}
vec2 cascadeCoordinates(int i, vec3 lvpos) {
return vec2(float(i - 2 * (i / 2)) * 0.5, float(i / 2) * 0.5) + (numCascades == 1 ? 1.0 : 0.5) * lvpos.xy;
}
float readShadowMapDepth(vec2 uv, sampler2D _depthTex) {
return rgba2float(texture(_depthTex, uv));
}
float posIsInShadow(vec2 uv, vec3 lvpos, sampler2D _depthTex) {
return readShadowMapDepth(uv, _depthTex) < lvpos.z ? 1.0 : 0.0;
}
float filterShadow(vec2 uv, vec3 lvpos, float texSize, sampler2D _depthTex) {
float halfPixelSize = 0.5 / texSize;
vec2 st = fract((vec2(halfPixelSize) + uv) * texSize);
float s00 = posIsInShadow(uv + vec2(-halfPixelSize, -halfPixelSize), lvpos, _depthTex);
float s10 = posIsInShadow(uv + vec2(halfPixelSize, -halfPixelSize), lvpos, _depthTex);
float s11 = posIsInShadow(uv + vec2(halfPixelSize, halfPixelSize), lvpos, _depthTex);
float s01 = posIsInShadow(uv + vec2(-halfPixelSize, halfPixelSize), lvpos, _depthTex);
return mix(mix(s00, s10, st.x), mix(s01, s11, st.x), st.y);
}
float readShadowMap(const in vec3 _vpos, float _linearDepth) {
mat4 mat;
int i = chooseCascade(_linearDepth, mat);
if (i >= numCascades) { return 0.0; }
vec3 lvpos = lightSpacePosition(_vpos, mat);
if (lvpos.z >= 1.0) { return 0.0; }
if (lvpos.x < 0.0 || lvpos.x > 1.0 || lvpos.y < 0.0 || lvpos.y > 1.0) { return 0.0; }
vec2 uv = cascadeCoordinates(i, lvpos);
return filterShadow(uv, lvpos, float(textureSize(shadowMapTex, 0).x), shadowMapTex);
}`)}function poe(t){t.fragment.uniforms.add(new Je("texWaveNormal",e=>e.waveNormal),new Je("texWavePerturbation",e=>e.wavePertubation),new sr("waveParams",e=>bi(Jlt,e.waveStrength,e.waveTextureRepeat,e.flowStrength,e.flowOffset)),new Sr("waveDirection",e=>or(Qlt,e.waveDirection[0]*e.waveVelocity,e.waveDirection[1]*e.waveVelocity))),t.include(jlt),t.fragment.code.add(b`const vec2  FLOW_JUMP = vec2(6.0/25.0, 5.0/24.0);
vec2 textureDenormalized2D(sampler2D _tex, vec2 _uv) {
return 2.0 * texture(_tex, _uv).rg - 1.0;
}
float sampleNoiseTexture(vec2 _uv) {
return texture(texWavePerturbation, _uv).b;
}
vec3 textureDenormalized3D(sampler2D _tex, vec2 _uv) {
return 2.0 * texture(_tex, _uv).rgb - 1.0;
}
float computeProgress(vec2 uv, float time) {
return fract(time);
}
float computeWeight(vec2 uv, float time) {
float progress = computeProgress(uv, time);
return 1.0 - abs(1.0 - 2.0 * progress);
}
vec3 computeUVPerturbedWeigth(sampler2D texFlow, vec2 uv, float time, float phaseOffset) {
float flowStrength = waveParams[2];
float flowOffset = waveParams[3];
vec2 flowVector = textureDenormalized2D(texFlow, uv) * flowStrength;
float progress = computeProgress(uv, time + phaseOffset);
float weight = computeWeight(uv, time + phaseOffset);
vec2 result = uv;
result -= flowVector * (progress + flowOffset);
result += phaseOffset;
result += (time - progress) * FLOW_JUMP;
return vec3(result, weight);
}
const float TIME_NOISE_TEXTURE_REPEAT = 0.3737;
const float TIME_NOISE_STRENGTH = 7.77;
vec3 getWaveLayer(sampler2D _texNormal, sampler2D _dudv, vec2 _uv, vec2 _waveDir, float time) {
float waveStrength = waveParams[0];
vec2 waveMovement = time * -_waveDir;
float timeNoise = sampleNoiseTexture(_uv * TIME_NOISE_TEXTURE_REPEAT) * TIME_NOISE_STRENGTH;
vec3 uv_A = computeUVPerturbedWeigth(_dudv, _uv + waveMovement, time + timeNoise, 0.0);
vec3 uv_B = computeUVPerturbedWeigth(_dudv, _uv + waveMovement, time + timeNoise, 0.5);
vec3 normal_A = textureDenormalized3D(_texNormal, uv_A.xy) * uv_A.z;
vec3 normal_B = textureDenormalized3D(_texNormal, uv_B.xy) * uv_B.z;
vec3 mixNormal = normalize(normal_A + normal_B);
mixNormal.xy *= waveStrength;
mixNormal.z = sqrt(1.0 - dot(mixNormal.xy, mixNormal.xy));
return mixNormal;
}
vec4 getSurfaceNormalAndFoam(vec2 _uv, float _time) {
float waveTextureRepeat = waveParams[1];
vec3 normal = getWaveLayer(texWaveNormal, texWavePerturbation, _uv * waveTextureRepeat, waveDirection, _time);
float foam  = normals2FoamIntensity(normal, waveParams[0]);
return vec4(normal, foam);
}`)}const Jlt=Wt(),Qlt=Ve();function oR(t,e){e.spherical?t.vertex.code.add(b`vec3 getLocalUp(in vec3 pos, in vec3 origin) {
return normalize(pos + origin);
}`):t.vertex.code.add(b`vec3 getLocalUp(in vec3 pos, in vec3 origin) {
return vec3(0.0, 0.0, 1.0);
}`),e.spherical?t.vertex.code.add(b`mat3 getTBNMatrix(in vec3 n) {
vec3 t = normalize(cross(vec3(0.0, 0.0, 1.0), n));
vec3 b = normalize(cross(n, t));
return mat3(t, b, n);
}`):t.vertex.code.add(b`mat3 getTBNMatrix(in vec3 n) {
vec3 t = vec3(1.0, 0.0, 0.0);
vec3 b = normalize(cross(n, t));
return mat3(t, b, n);
}`)}function Klt(t){const e=t.fragment.code;e.add(b`vec3 evaluateDiffuseIlluminationHemisphere(vec3 ambientGround, vec3 ambientSky, float NdotNG)
{
return ((1.0 - NdotNG) * ambientGround + (1.0 + NdotNG) * ambientSky) * 0.5;
}`),e.add(b`float integratedRadiance(float cosTheta2, float roughness)
{
return (cosTheta2 - 1.0) / (cosTheta2 * (1.0 - roughness * roughness) - 1.0);
}`),e.add(b`vec3 evaluateSpecularIlluminationHemisphere(vec3 ambientGround, vec3 ambientSky, float RdotNG, float roughness)
{
float cosTheta2 = 1.0 - RdotNG * RdotNG;
float intRadTheta = integratedRadiance(cosTheta2, roughness);
float ground = RdotNG < 0.0 ? 1.0 - intRadTheta : 1.0 + intRadTheta;
float sky = 2.0 - ground;
return (ground * ambientGround + sky * ambientSky) * 0.5;
}`)}function tJ(t,e){const r=t.fragment.code;t.include(YR),e.pbrMode!==st.Normal&&e.pbrMode!==st.Schematic&&e.pbrMode!==st.Terrain&&e.pbrMode!==st.TerrainWithWater||(r.add(b`float normalDistribution(float NdotH, float roughness)
{
float a = NdotH * roughness;
float b = roughness / (1.0 - NdotH * NdotH + a * a);
return b * b * INV_PI;
}`),r.add(b`const vec4 c0 = vec4(-1.0, -0.0275, -0.572,  0.022);
const vec4 c1 = vec4( 1.0,  0.0425,  1.040, -0.040);
const vec2 c2 = vec2(-1.04, 1.04);
vec2 prefilteredDFGAnalytical(float roughness, float NdotV) {
vec4 r = roughness * c0 + c1;
float a004 = min(r.x * r.x, exp2(-9.28 * NdotV)) * r.x + r.y;
return c2 * a004 + r.zw;
}`)),e.pbrMode!==st.Normal&&e.pbrMode!==st.Schematic||(t.include(Klt),r.add(b`struct PBRShadingInfo
{
float NdotL;
float NdotV;
float NdotH;
float VdotH;
float LdotH;
float NdotNG;
float RdotNG;
float NdotAmbDir;
float NdotH_Horizon;
vec3 skyRadianceToSurface;
vec3 groundRadianceToSurface;
vec3 skyIrradianceToSurface;
vec3 groundIrradianceToSurface;
float averageAmbientRadiance;
float ssao;
vec3 albedoLinear;
vec3 f0;
vec3 f90;
vec3 diffuseColor;
float metalness;
float roughness;
};`),r.add(b`vec3 evaluateEnvironmentIllumination(PBRShadingInfo inputs) {
vec3 indirectDiffuse = evaluateDiffuseIlluminationHemisphere(inputs.groundIrradianceToSurface, inputs.skyIrradianceToSurface, inputs.NdotNG);
vec3 indirectSpecular = evaluateSpecularIlluminationHemisphere(inputs.groundRadianceToSurface, inputs.skyRadianceToSurface, inputs.RdotNG, inputs.roughness);
vec3 diffuseComponent = inputs.diffuseColor * indirectDiffuse * INV_PI;
vec2 dfg = prefilteredDFGAnalytical(inputs.roughness, inputs.NdotV);
vec3 specularColor = inputs.f0 * dfg.x + inputs.f90 * dfg.y;
vec3 specularComponent = specularColor * indirectSpecular;
return (diffuseComponent + specularComponent);
}`),r.add(b`float gamutMapChanel(float x, vec2 p){
return (x < p.x) ? mix(0.0, p.y, x/p.x) : mix(p.y, 1.0, (x - p.x) / (1.0 - p.x) );
}`),r.add(b`vec3 blackLevelSoftCompression(vec3 inColor, PBRShadingInfo inputs){
vec3 outColor;
vec2 p = vec2(0.02 * (inputs.averageAmbientRadiance), 0.0075 * (inputs.averageAmbientRadiance));
outColor.x = gamutMapChanel(inColor.x, p) ;
outColor.y = gamutMapChanel(inColor.y, p) ;
outColor.z = gamutMapChanel(inColor.z, p) ;
return outColor;
}`))}function ect(t,e){const r=t.fragment.code;t.include(YR),r.add(b`
  struct PBRShadingWater
  {
      float NdotL;   // cos angle between normal and light direction
      float NdotV;   // cos angle between normal and view direction
      float NdotH;   // cos angle between normal and half vector
      float VdotH;   // cos angle between view direction and half vector
      float LdotH;   // cos angle between light direction and half vector
      float VdotN;   // cos angle between view direction and normal vector
  };

  float dtrExponent = ${e.useCustomDTRExponentForWater?"2.2":"2.0"};
  `),r.add(b`vec3 fresnelReflection(float angle, vec3 f0, float f90) {
return f0 + (f90 - f0) * pow(1.0 - angle, 5.0);
}`),r.add(b`float normalDistributionWater(float NdotH, float roughness)
{
float r2 = roughness * roughness;
float NdotH2 = NdotH * NdotH;
float denom = pow((NdotH2 * (r2 - 1.0) + 1.0), dtrExponent) * PI;
return r2 / denom;
}`),r.add(b`float geometricOcclusionKelemen(float LoH)
{
return 0.25 / (LoH * LoH);
}`),r.add(b`vec3 brdfSpecularWater(in PBRShadingWater props, float roughness, vec3 F0, float F0Max)
{
vec3  F = fresnelReflection(props.VdotH, F0, F0Max);
float dSun = normalDistributionWater(props.NdotH, roughness);
float V = geometricOcclusionKelemen(props.LdotH);
float diffusionSunHaze = mix(roughness + 0.045, roughness + 0.385, 1.0 - props.VdotH);
float strengthSunHaze  = 1.2;
float dSunHaze = normalDistributionWater(props.NdotH, diffusionSunHaze)*strengthSunHaze;
return ((dSun + dSunHaze) * V) * F;
}
vec3 tonemapACES(const vec3 x) {
return (x * (2.51 * x + 0.03)) / (x * (2.43 * x + 0.59) + 0.14);
}`)}function REe(t,e){t.include(ect,e),t.include(N5),t.include(Hlt),e.hasCloudsReflections&&t.include(Fwe,e),e.hasScreenSpaceReflections&&t.include(UJe,e);const r=t.fragment;r.constants.add("fresnelSky","vec3",[.02,1,15]).add("fresnelMaterial","vec2",[.02,.1]).add("roughness","float",.015).add("foamIntensityExternal","float",1.7).add("ssrIntensity","float",.65).add("ssrHeightFadeStart","float",3e5).add("ssrHeightFadeEnd","float",5e5).add("waterDiffusion","float",.92).add("waterSeaColorMod","float",.8).add("correctionViewingPowerFactor","float",.4).add("skyZenitColor","vec3",[.52,.68,.9]).add("skyColor","vec3",[.67,.79,.9]).add("cloudFresnelModifier","vec2",[1.2,.01]),r.code.add(b`PBRShadingWater shadingInfo;
vec3 getSkyGradientColor(in float cosTheta, in vec3 horizon, in vec3 zenit) {
float exponent = pow((1.0 - cosTheta), fresnelSky[2]);
return mix(zenit, horizon, exponent);
}`),r.uniforms.add(new Re("lightingSpecularStrength",(i,s)=>s.lighting.mainLight.specularStrength),new Re("lightingEnvironmentStrength",(i,s)=>s.lighting.mainLight.environmentStrength)),r.code.add(b`vec3 getSeaColor(in vec3 n, in vec3 v, in vec3 l, vec3 color, in vec3 lightIntensity, in vec3 localUp, in float shadow, float foamIntensity, vec3 viewPosition, vec3 position) {
float reflectionHit = 0.0;
float reflectionHitDiffused = 0.0;
vec3 seaWaterColor = linearizeGamma(color);
vec3 h = normalize(l + v);
shadingInfo.NdotL = clamp(dot(n, l), 0.0, 1.0);
shadingInfo.NdotV = clamp(dot(n, v), 0.001, 1.0);
shadingInfo.VdotN = clamp(dot(v, n), 0.001, 1.0);
shadingInfo.NdotH = clamp(dot(n, h), 0.0, 1.0);
shadingInfo.VdotH = clamp(dot(v, h), 0.0, 1.0);
shadingInfo.LdotH = clamp(dot(l, h), 0.0, 1.0);
float upDotV = max(dot(localUp,v), 0.0);
vec3 skyHorizon = linearizeGamma(skyColor);
vec3 skyZenit = linearizeGamma(skyZenitColor);
vec3 skyColor = getSkyGradientColor(upDotV, skyHorizon, skyZenit );
float upDotL = max(dot(localUp,l),0.0);
float daytimeMod = 0.1 + upDotL * 0.9;
skyColor *= daytimeMod;
float shadowModifier = clamp(shadow, 0.8, 1.0);
vec3 fresnelModifier = fresnelReflection(shadingInfo.VdotN, vec3(fresnelSky[0]), fresnelSky[1]);
vec3 reflSky = lightingEnvironmentStrength * fresnelModifier * skyColor * shadowModifier;
vec3 reflSea = seaWaterColor * mix(skyColor, upDotL * lightIntensity * LIGHT_NORMALIZATION, 2.0 / 3.0) * shadowModifier;
vec3 specular = vec3(0.0);
if(upDotV > 0.0 && upDotL > 0.0) {
vec3 specularSun = brdfSpecularWater(shadingInfo, roughness, vec3(fresnelMaterial[0]), fresnelMaterial[1]);
vec3 incidentLight = lightIntensity * LIGHT_NORMALIZATION * shadow;
specular = lightingSpecularStrength * shadingInfo.NdotL * incidentLight * specularSun;
}
vec3 foam = vec3(0.0);
if(upDotV > 0.0) {
foam = foamIntensity2FoamColor(foamIntensityExternal, foamIntensity, skyZenitColor, daytimeMod);
}
float correctionViewingFactor = pow(max(dot(v, localUp), 0.0), correctionViewingPowerFactor);
vec3 normalCorrectedClouds = mix(localUp, n, correctionViewingFactor);
vec3 reflectedWorld = normalize(reflect(-v, normalCorrectedClouds));`),e.hasCloudsReflections&&r.code.add(b`vec4 cloudsColor = renderClouds(reflectedWorld, position);
cloudsColor.a = 1.0 - cloudsColor.a;
cloudsColor = pow(cloudsColor, vec4(GAMMA));
cloudsColor *= clamp(fresnelModifier.y * cloudFresnelModifier[0] - cloudFresnelModifier[1], 0.0, 1.0) * clamp((1.0 - totalFadeInOut), 0.0, 1.0);`),e.hasScreenSpaceReflections?(r.uniforms.add(new $i("view",(i,s)=>s.ssr.camera.viewMatrix),new Je("lastFrameColorTexture",(i,s)=>s.ssr.lastFrameColorTexture),new Re("fadeFactorSSR",(i,s)=>s.ssr.fadeFactor)),r.code.add(b`vec3 viewDir = normalize(viewPosition);
vec4 viewNormalVectorCoordinate = view *vec4(n, 0.0);
vec3 viewNormal = normalize(viewNormalVectorCoordinate.xyz);
vec4 viewUp = view * vec4(localUp, 0.0);
vec3 viewNormalCorrectedSSR = mix(viewUp.xyz, viewNormal, correctionViewingFactor);
vec3 reflected = normalize(reflect(viewDir, viewNormalCorrectedSSR));
vec3 hitCoordinate = screenSpaceIntersection(reflected, viewPosition, viewDir, viewUp.xyz);
vec3 reflectedColor = vec3(0.0);
if (hitCoordinate.z > 0.0)
{
vec2 reprojectedCoordinate = reprojectionCoordinate(hitCoordinate);
vec2 dCoords = smoothstep(0.3, 0.6, abs(vec2(0.5, 0.5) - hitCoordinate.xy));
float heightMod = smoothstep(ssrHeightFadeEnd, ssrHeightFadeStart, -viewPosition.z);
reflectionHit = clamp(1.0 - (1.3 * dCoords.y), 0.0, 1.0) * heightMod * fadeFactorSSR;
reflectionHitDiffused = waterDiffusion * reflectionHit;
reflectedColor = linearizeGamma(texture(lastFrameColorTexture, reprojectedCoordinate).xyz) *
reflectionHitDiffused * fresnelModifier.y * ssrIntensity;
}
float seaColorMod =  mix(waterSeaColorMod, waterSeaColorMod * 0.5, reflectionHitDiffused);
vec3 waterRenderedColor = tonemapACES((1.0 - reflectionHitDiffused) * reflSky + reflectedColor +
reflSea * seaColorMod + specular + foam);`)):r.code.add(b`vec3 waterRenderedColor = tonemapACES(reflSky + reflSea * waterSeaColorMod + specular + foam);`),e.hasCloudsReflections?e.hasScreenSpaceReflections?r.code.add(b`return waterRenderedColor * (1.0 - (1.0 - reflectionHit) * cloudsColor.a) + (1.0 - reflectionHit) * cloudsColor.xyz;
}`):r.code.add(b`return waterRenderedColor * (1.0 - cloudsColor.a) + cloudsColor.xyz;
}`):r.code.add(b`return waterRenderedColor;
}`)}function tct(t){const e=new wr,{vertex:r,fragment:i}=e;vc(r,t),e.include(xl,t),e.attributes.add(E.POSITION,"vec3"),e.attributes.add(E.UV0,"vec2");const s=new sr("waterColor",n=>n.color);if(t.output===N.Color&&t.isDraped)return e.varyings.add("vpos","vec3"),r.uniforms.add(s),r.code.add(b`
        void main(void) {
          if (waterColor.a < ${b.float(go)}) {
            // Discard this vertex
            gl_Position = vec4(1e38, 1e38, 1e38, 1.0);
            return;
          }

          vpos = position;
          gl_Position = transformPosition(proj, view, vpos);
        }
    `),i.uniforms.add(s),i.code.add(b`void main() {
fragColor = waterColor;
}`),e;switch(t.output!==N.Color&&t.output!==N.Alpha||(e.include(oR,t),e.include(mE,t),e.varyings.add("vuv","vec2"),e.varyings.add("vpos","vec3"),e.varyings.add("vnormal","vec3"),e.varyings.add("vtbnMatrix","mat3"),t.hasMultipassTerrain&&e.varyings.add("depth","float"),r.uniforms.add(s),r.code.add(b`
      void main(void) {
        if (waterColor.a < ${b.float(go)}) {
          // Discard this vertex
          gl_Position = vec4(1e38, 1e38, 1e38, 1.0);
          return;
        }

        vuv = uv0;
        vpos = position;

        vnormal = getLocalUp(vpos, localOrigin);
        vtbnMatrix = getTBNMatrix(vnormal);

        ${t.hasMultipassTerrain?"depth = (view * vec4(vpos, 1.0)).z;":""}

        gl_Position = transformPosition(proj, view, vpos);
        ${t.output===N.Color?"forwardLinearDepth();":""}
      }
    `)),e.include(vu,t),t.output){case N.Alpha:e.include(ps,t),i.uniforms.add(s),i.code.add(b`
        void main() {
          discardBySlice(vpos);
          ${t.hasMultipassTerrain?"terrainDepthTest(gl_FragCoord, depth);":""}

          fragColor = vec4(waterColor.a);
        }
      `);break;case N.Color:e.include(KN),e.include(LX,{pbrMode:st.Disabled,lightingSphericalHarmonicsOrder:2}),e.include(poe),e.include(ps,t),e.include(gw,t),e.include(REe,t),i.uniforms.add(s,new Re("timeElapsed",n=>n.timeElapsed),r.uniforms.get("view"),r.uniforms.get("localOrigin")),up(i,t),i.include(sm),Jg(i),im(i),i.code.add(b`
      void main() {
        discardBySlice(vpos);
        ${t.hasMultipassTerrain?"terrainDepthTest(gl_FragCoord, depth);":""}
        vec3 localUp = vnormal;
        // the created normal is in tangent space
        vec4 tangentNormalFoam = getSurfaceNormalAndFoam(vuv, timeElapsed);

        // we rotate the normal according to the tangent-bitangent-normal-Matrix
        vec3 n = normalize(vtbnMatrix * tangentNormalFoam.xyz);
        vec3 v = -normalize(vpos - cameraPosition);
        float shadow = ${t.receiveShadows?b`1.0 - readShadowMap(vpos, linearDepth)`:"1.0"};
        vec4 vPosView = view * vec4(vpos, 1.0);
        vec4 final = vec4(getSeaColor(n, v, mainLightDirection, waterColor.rgb, mainLightIntensity, localUp, shadow, tangentNormalFoam.w, vPosView.xyz, vpos + localOrigin), waterColor.w);

        // gamma correction
        fragColor = delinearizeGamma(final);
        fragColor = highlightSlice(fragColor, vpos);
        ${t.transparencyPassType===ot.Color?"fragColor = premultiplyAlpha(fragColor);":""}
      }
    `);break;case N.Normal:e.include(oR,t),e.include(poe,t),e.include(ps,t),e.varyings.add("vpos","vec3"),e.varyings.add("vuv","vec2"),r.uniforms.add(s),r.code.add(b`
        void main(void) {
          if (waterColor.a < ${b.float(go)}) {
            // Discard this vertex
            gl_Position = vec4(1e38, 1e38, 1e38, 1.0);
            return;
          }

          vuv = uv0;
          vpos = position;

          gl_Position = transformPosition(proj, view, vpos);
        }
    `),i.uniforms.add(new Re("timeElapsed",n=>n.timeElapsed)),i.code.add(b`void main() {
discardBySlice(vpos);
vec4 tangentNormalFoam = getSurfaceNormalAndFoam(vuv, timeElapsed);
tangentNormalFoam.xyz = normalize(tangentNormalFoam.xyz);
fragColor = vec4((tangentNormalFoam.xyz + vec3(1.0)) * 0.5, tangentNormalFoam.w);
}`);break;case N.Highlight:e.include(ny,t),e.varyings.add("vpos","vec3"),r.uniforms.add(s),r.code.add(b`
      void main(void) {
        if (waterColor.a < ${b.float(go)}) {
          // Discard this vertex
          gl_Position = vec4(1e38, 1e38, 1e38, 1.0);
          return;
        }

        vpos = position;
        gl_Position = transformPosition(proj, view, vpos);
      }
    `),e.include(ps,t),i.code.add(b`void main() {
discardBySlice(vpos);
outputHighlight();
}`);break;case N.ObjectAndLayerIdColor:e.include(nP,t),e.varyings.add("vpos","vec3"),r.uniforms.add(s),r.code.add(b`
      void main(void) {
        if (waterColor.a < ${b.float(go)}) {
          // Discard this vertex
          gl_Position = vec4(1e38, 1e38, 1e38, 1.0);
          return;
        }

        vpos = position;
        gl_Position = transformPosition(proj, view, vpos);
        forwardObjectAndLayerIdColor();
      }
    `),e.include(ps,t),i.code.add(b`void main() {
discardBySlice(vpos);
outputObjectAndLayerIdColor();
}`)}return e}const rct=Object.freeze(Object.defineProperty({__proto__:null,build:tct},Symbol.toStringTag,{value:"Module"}));let PEe=class MEe extends Pr{initializeConfiguration(e,r){r.spherical=e.viewingMode===De.Global,r.doublePrecisionRequiresObfuscation=e.rctx.driverTest.doublePrecisionRequiresObfuscation.result}initializeProgram(e){return new Cr(e.rctx,MEe.shader.get().build(this.configuration),br)}_setPipelineState(e){const r=this.configuration,i=e===ot.NONE,s=e===ot.FrontFace;return At({blending:r.output!==N.Normal&&r.output!==N.Highlight&&r.output!==N.ObjectAndLayerIdColor&&r.transparent?i?uu:oy(e):null,depthTest:{func:rv(e)},depthWrite:i?r.writeDepth?Ol:null:c6(e),colorWrite:Vt,polygonOffset:i||s?null:d6(r.enableOffset)})}initializePipeline(){return this._setPipelineState(this.configuration.transparencyPassType)}};PEe.shader=new Er(rct,()=>ae(()=>import("./WaterSurface.glsl-3546e0a1.js"),[],import.meta.url));let Un=class extends Uo{constructor(){super(...arguments),this.output=N.Color,this.transparencyPassType=ot.NONE,this.spherical=!1,this.receiveShadows=!1,this.hasSlicePlane=!1,this.transparent=!1,this.enableOffset=!0,this.writeDepth=!1,this.hasScreenSpaceReflections=!1,this.doublePrecisionRequiresObfuscation=!1,this.hasCloudsReflections=!1,this.objectAndLayerIdColorInstanced=!1,this.isDraped=!1,this.hasMultipassTerrain=!1,this.cullAboveGround=!1}};u([B({count:N.COUNT})],Un.prototype,"output",void 0),u([B({count:ot.COUNT})],Un.prototype,"transparencyPassType",void 0),u([B()],Un.prototype,"spherical",void 0),u([B()],Un.prototype,"receiveShadows",void 0),u([B()],Un.prototype,"hasSlicePlane",void 0),u([B()],Un.prototype,"transparent",void 0),u([B()],Un.prototype,"enableOffset",void 0),u([B()],Un.prototype,"writeDepth",void 0),u([B()],Un.prototype,"hasScreenSpaceReflections",void 0),u([B()],Un.prototype,"doublePrecisionRequiresObfuscation",void 0),u([B()],Un.prototype,"hasCloudsReflections",void 0),u([B()],Un.prototype,"objectAndLayerIdColorInstanced",void 0),u([B()],Un.prototype,"isDraped",void 0),u([B()],Un.prototype,"hasMultipassTerrain",void 0),u([B()],Un.prototype,"cullAboveGround",void 0),u([B({constValue:st.Water})],Un.prototype,"pbrMode",void 0),u([B({constValue:!0})],Un.prototype,"useCustomDTRExponentForWater",void 0),u([B({constValue:!0})],Un.prototype,"highStepCount",void 0),u([B({constValue:!1})],Un.prototype,"useFillLights",void 0);let ict=class extends K_{_updateShadowState(e){e.shadowMap.enabled!==this._material.parameters.receiveShadows&&this._material.setParameters({receiveShadows:e.shadowMap.enabled})}_updateSSRState(e){e.ssr.enabled!==this._material.parameters.hasScreenSpaceReflections&&this._material.setParameters({hasScreenSpaceReflections:e.ssr.enabled})}_updateCloudsReflectionState(e){const r=e.cloudsFade.data!=null;r!==this._material.parameters.hasCloudsReflections&&this._material.setParameters({hasCloudsReflections:r})}ensureResources(e){return this._techniqueRepository.constructionContext.waterTextureRepository.ensureResources(e)}beginSlot(e){return this._output===N.Color&&(this._updateShadowState(e),this._updateSSRState(e),this._updateCloudsReflectionState(e)),this._material.setParameters(this._techniqueRepository.constructionContext.waterTextureRepository.passParameters),this.ensureTechnique(PEe,e)}},IEe=class extends KY{constructor(e){super(e,new $Ee),this._configuration=new Un,this.animation=new Fxe}getConfiguration(e,r){return this._configuration.output=e,this._configuration.writeDepth=this.parameters.writeDepth,this._configuration.receiveShadows=this.parameters.receiveShadows,this._configuration.hasSlicePlane=this.parameters.hasSlicePlane,this._configuration.transparent=this.parameters.transparent,this._configuration.hasScreenSpaceReflections=this.parameters.hasScreenSpaceReflections,this._configuration.hasCloudsReflections=this.parameters.hasCloudsReflections,this._configuration.isDraped=this.parameters.isDraped,this._configuration.transparencyPassType=r.transparencyPassType,this._configuration.enableOffset=r.camera.relativeElevation<u6,this._configuration.hasMultipassTerrain=r.multipassTerrain.enabled,this._configuration.cullAboveGround=r.multipassTerrain.cullAboveGround,this._configuration}update(e){const r=Math.min(e.camera.relativeElevation,e.camera.distance);this.animation.enabled=Math.sqrt(this.parameters.waveTextureRepeat/this.parameters.waveStrength)*r<sct;const i=this.animation.advance(e);return this.setParameters({timeElapsed:Fq(this.animation.time)*this.parameters.animationSpeed},!1),this.animation.enabled&&i}requiresSlot(e,r){switch(r){case N.Normal:return e===ue.DRAPED_WATER;case N.Color:if(this.parameters.isDraped)return e===ue.DRAPED_MATERIAL;break;case N.Alpha:break;case N.Highlight:case N.ObjectAndLayerIdColor:return e===ue.OPAQUE_MATERIAL||e===ue.DRAPED_MATERIAL;default:return!1}let i=ue.OPAQUE_MATERIAL;return this.parameters.transparent&&(i=this.parameters.writeDepth?ue.TRANSPARENT_MATERIAL:ue.TRANSPARENT_DEPTH_WRITE_DISABLED_MATERIAL),e===i}createGLMaterial(e){return new ict(e)}createBufferWriter(){return new TE(oe("enable-feature:objectAndLayerId-rendering")?Glt:zlt)}},$Ee=class extends CY{constructor(){super(...arguments),this.waveStrength=.06,this.waveTextureRepeat=32,this.waveDirection=dr(1,0),this.waveVelocity=.05,this.flowStrength=.015,this.flowOffset=-.5,this.animationSpeed=.35,this.timeElapsed=0,this.color=Lt(0,0,0,0),this.transparent=!0,this.writeDepth=!0,this.hasSlicePlane=!1,this.isDraped=!1,this.receiveShadows=!0,this.hasScreenSpaceReflections=!1,this.hasCloudsReflections=!1,this.origin=C(),this.modelTransformation=null}};const sct=35e3;let rJ=class{constructor(e=0,r=0){this.from=e,this.to=r}get numElements(){return this.to-this.from}};function foe(t){const e=new Map;t.forAll(i=>e.set(i.from,i));let r=!0;for(;r;)r=!1,t.forEach(i=>{const s=e.get(i.to);s&&(i.to=s.to,e.delete(s.from),t.removeUnordered(s),r=!0)})}let moe=class extends rJ{constructor(e,r,i){super(r,i),this.geometry=e}get isVisible(){return this.geometry.visible}get hasHighlights(){return this.geometry.highlights!=null&&this.isVisible}get hasOccludees(){return this.geometry.occludees!=null}},nct=class{constructor(){this.first=0,this.count=0}},oct=class{constructor(){this._numElements=0,this._instances=new Map,this.holes=new kt({allocator:e=>e||new rJ,deallocator:null}),this.hasHiddenInstances=!1,this.hasHighlights=!1,this.hasOccludees=!1,this.drawCommandsDirty=!0,this.drawCommandsDefault=OI(),this.drawCommandsHighlight=OI(),this.drawCommandsOccludees=OI(),this.drawCommandsShadowHighlightRest=OI()}get numElements(){return this._numElements}get instances(){return this._instances}addInstance(e,r){this.deleteInstance(e),this._instances.set(e,r),this._numElements+=r.numElements}deleteInstance(e){const r=this._instances.get(e);r&&(this._numElements-=r.numElements,this._instances.delete(e))}updateInstance(e,r,i){const s=this._instances.get(e);s&&(this._numElements-=s.numElements,s.from=r,s.to=i,this._numElements+=s.numElements)}updateDrawState(e){e.isVisible?(e.hasHighlights&&(this.hasHighlights=!0),e.hasOccludees&&(this.hasOccludees=!0)):this.hasHiddenInstances=!0}updateDrawCommands(e){if(this.drawCommandsDefault.clear(),this.drawCommandsHighlight.clear(),this.drawCommandsOccludees.clear(),this.drawCommandsShadowHighlightRest.clear(),this.drawCommandsDirty=!1,this._instances.size===0)return;if(!this.needsMultipleCommands()){const i=this.drawCommandsDefault.pushNew(),s=this.holes.front();return this.vao!=null&&this.holes.length===1&&s.to===Math.floor(this.vao.byteSize/e)?(i.first=0,void(i.count=s.from)):(i.first=1/0,i.count=0,this._instances.forEach(n=>{i.first=Math.min(i.first,n.from),i.count=Math.max(i.count,n.to)}),void(i.count-=i.first))}const r=Array.from(this._instances.values()).sort((i,s)=>i.from===s.from?i.to-s.to:i.from-s.from);for(const i of r)i.isVisible&&(goe(i.hasOccludees?this.drawCommandsOccludees:this.drawCommandsDefault,i),goe(i.hasHighlights?this.drawCommandsHighlight:this.drawCommandsShadowHighlightRest,i))}needsMultipleCommands(){return this.hasOccludees||this.hasHighlights||this.hasHiddenInstances}};function act(t){return t.vao!=null}function OI(){return new kt({allocator:t=>t||new nct,deallocator:t=>t})}function goe(t,e){const r=t.back();if(r==null){const i=t.pushNew();return i.first=e.from,void(i.count=e.numElements)}if(lct(r,e)){const i=e.from-r.first+e.numElements;r.count=i}else{const i=t.pushNew();i.first=e.from,i.count=e.numElements}}function lct(t,e){return t.first+t.count>=e.from}let cct=class{constructor(e){this.origin=e,this.buffers=new Array}dispose(){this.buffers.forEach(e=>e.vao.dispose()),this.buffers.length=0}findBuffer(e){return this.buffers.find(r=>r.instances.has(e))}};const uct=wL+1;let hct=class{constructor(e,r,i){this._rctx=e,this._locations=r,this._layout=i,this._cache=e.newCache("VaoCache",dct)}dispose(){this._cache.destroy()}newVao(e){const r=e.toString(),i=this._cache.pop(r);if(i!=null){const n=i.pop();return i.length>0&&this._cache.put(r,i,e*i.length,uct),n}const s=new pp(this._rctx,this._locations,{geometry:this._layout},{geometry:Lr.createVertex(this._rctx,Tr.STATIC_DRAW)});return s.vertexBuffers.geometry.setSize(e),s}deleteVao(e){if(e==null)return null;const r=e.byteSize,i=r.toString(),s=this._cache.pop(i);return s!=null?(s.push(e),this._cache.put(i,s,r*s.length,-1)):this._cache.put(i,[e],r,-1),null}};function dct(t,e){if(e===ng.ALL)return void t.forEach(s=>s.dispose());const r=t.pop(),i=t.length*r.byteSize;return r.dispose(),i}let LEe=class{constructor(e,r,i){this._rctx=e,this._materialRepository=r,this.material=i,this._dataByOrigin=new Map,this._hasHighlights=!1,this._hasOccludees=!1,this._glMaterials=new EEe(this.material,this._materialRepository),this._bufferWriter=i.createBufferWriter(),this._vaoCache=new hct(e,i.vertexAttributeLocations,Cc(this._bufferWriter.vertexBufferLayout))}dispose(){this._glMaterials.destroy(),this._dataByOrigin.forEach(e=>e.dispose()),this._dataByOrigin.clear(),this._vaoCache.dispose()}get isEmpty(){return this._dataByOrigin.size===0}get hasHighlights(){return this._hasHighlights}get hasOccludees(){return this._hasOccludees}get hasWater(){return!this.isEmpty&&this.material instanceof IEe}get rendersOccluded(){return!this.isEmpty&&this.material.renderOccluded!==Mi.Occlude}get numGeometries(){let e=0;return this._dataByOrigin.forEach(r=>e+=r.buffers.reduce((i,s)=>i+s.instances.size,0)),e}forEachGeometry(e){this._dataByOrigin.forEach(r=>r.buffers.forEach(i=>i.instances.forEach(s=>e(s.geometry))))}modify(e){this._updateGeometries(e.updates),this._addAndRemoveGeometries(e.adds,e.removes),this._updateDrawCommands()}_updateGeometries(e){const r=this._bufferWriter,i=r.vertexBufferLayout.stride/4;for(const s of e){const n=s.renderGeometry,o=this._dataByOrigin.get(n.localOrigin.id),a=o?.findBuffer(n.id);if(a==null)return;const l=a.instances.get(n.id);if(s.updateType&(Tn.GEOMETRY|Tn.TRANSFORMATION)){const c=II(r.elementCount(l.geometry.geometry)*i),h=r.vertexBufferLayout.createView(c.buffer);this._writeGeometry(n,h,0),a.vao.vertexBuffers.geometry.setSubData(c,l.from*i,0,l.numElements*i),$I()}s.updateType&(Tn.HIGHLIGHT|Tn.OCCLUDEE|Tn.VISIBILITY)&&(a.drawCommandsDirty=!0)}}_computeDeltas(e,r){const i=new yE;for(const s of e){const n=s.localOrigin;if(n==null)continue;let o=i.get(n.id,null);o==null&&(o=new yoe(n.vec3),i.set(n.id,null,o)),o.changes.push(s)}for(const s of r){const n=s.localOrigin;if(n==null)continue;const o=this._dataByOrigin.get(n.id),a=o?.findBuffer(s.id);if(a==null)continue;let l=i.get(n.id,a);l==null&&(l=new yoe(n.vec3),i.set(n.id,a,l)),l.changes.push(s)}return i}_addAndRemoveGeometries(e,r){const{_bufferWriter:i,_dataByOrigin:s}=this,n=i.vertexBufferLayout.stride/4,o=this._computeDeltas(e,r);o.forEach((a,l)=>{const c=a.get(null),h=c!=null?c.changes:[];o.delete(l,null);let p=s.get(l);if(a.forEach((f,m)=>{if(o.delete(l,m),m==null)return void et(!1,"No VAO for removed geometries");if(m.instances.size===f.changes.length)return this._vaoCache.deleteVao(m.vao),dO(p.buffers,m),void(p.buffers.length===0&&h.length===0&&s.delete(l));const y=m.numElements,_=m.vao.byteSize/4,v=h.reduce((S,O)=>S+i.elementCount(O.geometry),0),w=f.changes.reduce((S,O)=>S+i.elementCount(O.geometry),0),x=Math.min((y+v-w)*n,MI),T=x>_;x>N4&&x<_/2?(f.changes.forEach(({id:S})=>m.deleteInstance(S)),m.instances.forEach(({geometry:S})=>h.push(S)),this._vaoCache.deleteVao(m.vao),dO(p.buffers,m)):T?this._applyAndRebuild(m,h,f):this._applyRemoves(m,f)}),h.length>0)for(p==null&&(p=new cct(c.origin),s.set(l,p)),p.buffers.forEach(f=>this._applyAdds(f,h));h.length>0;)p.buffers.push(this._applyAndRebuild(new oct,h,null))})}_updateDrawCommands(){this._hasHighlights=!1,this._hasOccludees=!1,this._dataByOrigin.forEach(e=>{e.buffers.forEach(r=>{r.drawCommandsDirty&&(r.hasHiddenInstances=!1,r.hasHighlights=!1,r.hasOccludees=!1,No(r.instances,i=>(r.updateDrawState(i),r.hasHiddenInstances&&r.hasHighlights&&r.hasOccludees)),r.updateDrawCommands(this._bufferWriter.vertexBufferLayout.stride)),this._hasHighlights=this._hasHighlights||r.hasHighlights,this._hasOccludees=this._hasOccludees||r.hasOccludees})})}_applyAndRebuild(e,r,i){if(i!=null)for(const y of i.changes)e.deleteInstance(y.id);const s=this._bufferWriter,n=s.vertexBufferLayout.stride,o=n/4,a=Math.floor(MI/o);let l=e.numElements;for(;r.length>0;){const y=r.pop(),_=s.elementCount(y.geometry);if(l+_>a&&l>0){r.push(y);break}l+=_;const v=new moe(y,0,0);et(e.instances.get(y.id)==null),e.addInstance(y.id,v)}const c=l*o,h=II(c),p=s.vertexBufferLayout.createView(h.buffer);let f=0;e.hasHiddenInstances=!1,e.hasHighlights=!1,e.hasOccludees=!1,e.instances.forEach((y,_)=>{this._writeGeometry(y.geometry,p,f);const v=f;f+=s.elementCount(y.geometry.geometry),e.updateInstance(_,v,f),e.updateDrawState(y)}),this._vaoCache.deleteVao(e.vao),e.vao=this._vaoCache.newVao(boe(c)),e.vao.vertexBuffers.geometry.setSubData(h,0,0,f*o),$I(),e.holes.clear();const m=e.holes.pushNew();return m.from=f,m.to=Math.floor(e.vao.byteSize/n),e.updateDrawCommands(n),e}_applyRemoves(e,r){if(r.changes.length===0)return;for(const a of r.changes){const l=a.id,c=e.instances.get(l);if(!c)continue;e.deleteInstance(l);const h=Rp.back();if(h){if(h.to===c.from){h.to=c.to;continue}if(h.from===c.to){h.from=c.from;continue}}const p=Rp.pushNew();p.from=c.from,p.to=c.to}foe(Rp);const i=this._bufferWriter.vertexBufferLayout.stride/4,s=Rp.reduce((a,l)=>Math.max(a,l.numElements),0)*i,n=II(s);n.fill(0,0,s);const o=e.vao.vertexBuffers.geometry;Rp.forAll(a=>o.setSubData(n,a.from*i,0,a.numElements*i)),$I(),e.holes.pushArray(Rp.data,Rp.length),Rp.forAll((a,l)=>Rp.data[l]=null),Rp.clear(),e.drawCommandsDirty=!0}_applyAdds(e,r){if(r.length===0)return;if(!act(e))return void this._applyAndRebuild(e,r,null);const i=this._bufferWriter,s=i.vertexBufferLayout.stride/4,n=e.numElements,o=r.reduce((w,x)=>w+i.elementCount(x.geometry),0),a=Math.min((n+o)*s,MI),l=4*a;if(e.vao.byteSize<boe(MI-N4)&&l>e.vao.byteSize)return void this._applyAndRebuild(e,r,null);foe(e.holes);const c=new Array;for(const w of r){const x=i.elementCount(w.geometry),T=pct(e.holes,x);c.push(T)}const h=e.vao.vertexBuffers.geometry;let p=0,f=0,m=0;const y=II(a),_=i.vertexBufferLayout.createView(y.buffer);r.forEach((w,x)=>{const T=c[x];if(T==null)return;if(m!==T){const A=m-f;A>0&&h.setSubData(y,f*s,0,A*s),f=T,p=0}const S=i.elementCount(w.geometry);this._writeGeometry(w,_,p),p+=S,m=T+S;const O=new moe(w,T,T+S);et(e.instances.get(w.id)==null),e.addInstance(w.id,O),e.drawCommandsDirty=!0});const v=m-f;v>0&&h.setSubData(y,f*s,0,v*s),WOe(r,(w,x)=>c[x]==null),$I()}_writeGeometry(e,r,i){const s=e.localOrigin.vec3;SYe(_oe,-s[0],-s[1],-s[2]);const n=si(fct,_oe,e.transformation);On(RI,n),xc(RI,RI),this._bufferWriter.write(n,RI,e.geometry,r,i)}updateAnimation(e){return this.material.update(e)}requiresSlot(e,r){return this.material.requiresSlot(e,r)}prepareTechnique(e){const{output:r,bindParameters:i}=e;if(!this.requiresSlot(i.slot,r))return null;const s=r===N.Highlight||r===N.ShadowHighlight;if(s&&!this._hasHighlights)return null;const n=r===N.ShadowExcludeHighlight,o=!(s||n);for(const a of this._dataByOrigin.values())for(const l of a.buffers){if(s&&!l.hasHighlights)continue;const c=(s?l.drawCommandsHighlight:n&&l.needsMultipleCommands()?l.drawCommandsShadowHighlightRest:l.drawCommandsDefault)||null,h=o&&l.drawCommandsOccludees||null;if(c?.length||h?.length){const p=this._glMaterials.load(e.rctx,i.slot,r),f=p!=null?p.beginSlot(i):null;if(f!=null)return f}}return null}render(e,r){const{output:i,bindParameters:s}=e,n=i===N.Highlight||i===N.ShadowHighlight,o=i===N.ShadowExcludeHighlight,a=!(n||o),l=this._rctx;l.appleAmdDriverHelper?.resetIndicesType(),l.bindTechnique(r,this.material.parameters,s);for(const c of this._dataByOrigin.values())for(const h of c.buffers){if(n&&!h.hasHighlights)continue;const p=(n?h.drawCommandsHighlight:o&&h.needsMultipleCommands()?h.drawCommandsShadowHighlightRest:h.drawCommandsDefault)||null,f=a&&h.drawCommandsOccludees||null;(p?.length||f?.length)&&(r.program.bindDraw(new yH(c.origin),s,this.material.parameters),r.ensureAttributeLocations(h.vao),l.bindVAO(h.vao),p?.length&&(r.bindPipelineState(l,s.slot,!1),p.forAll(m=>l.drawArrays(r.primitiveType,m.first,m.count))),f?.length&&(r.bindPipelineState(l,s.slot,!0),f.forAll(m=>l.drawArrays(r.primitiveType,m.first,m.count))))}}get test(){return{material:this.material,glMaterials:this._glMaterials,dataByOrigin:this._dataByOrigin}}},yoe=class{constructor(e){this.origin=e,this.changes=new Array}};function pct(t,e){let r;if(!t.some(s=>!(s.numElements<e)&&(r=s,!0)))return null;const i=r.from;return r.from+=e,r.from>=r.to&&t.removeUnordered(r),i}const _oe=be(),fct=be(),RI=be(),Rp=new kt({allocator:t=>t||new rJ,deallocator:null}),N4=65536,PI=4*N4,voe=1024,DEe=16777216,MI=DEe/4;let cD=new Float32Array(N4);function II(t){return cD.length<t&&(cD=new Float32Array(t)),cD}function boe(t){const e=4*t;return e<=voe?voe:e<PI?PI:Math.max(Math.min(Math.ceil(1.5*e/PI)*PI,DEe),e)}function $I(){cD=new Float32Array(2)}let jc=class extends Te{constructor(e){super(e),this._pending=new mct,this._changes=new gH,this._materialRenderers=new Map,this._sortedMaterialRenderers=new kt,this._geometries=new Map,this._hasHighlights=!1,this._hasWater=!1}destroy(){this._changes.prune(),this._materialRenderers.forEach(e=>e.dispose()),this._materialRenderers.clear(),this._sortedMaterialRenderers.clear(),this._geometries.clear(),this._pending.clear()}get updating(){return!this._pending.empty||this._changes.updates.length>0}get rctx(){return this.rendererContext.rctx}get _materialRepository(){return this.rendererContext.materialRepository}get _localOriginFactory(){return this.rendererContext.localOriginFactory}get hasHighlights(){return this._hasHighlights}get hasWater(){return this._hasWater}get rendersOccluded(){return No(this._materialRenderers,e=>e.rendersOccluded)}get isEmpty(){return!this.updating&&this._materialRenderers.size===0&&this._geometries.size===0}commitChanges(){if(!this.updating)return!1;this._processAddsRemoves();const e=SEe(this._changes);let r=!1,i=!1,s=!1;return e.forEach((n,o)=>{let a=this._materialRenderers.get(o);if(!a&&n.adds.length>0&&(a=new LEe(this.rctx,this._materialRepository,o),this._materialRenderers.set(o,a),r=!0,i=!0,s=!0),!a)return;const l=i||a.hasHighlights,c=s||a.hasWater;a.modify(n),i=i||l!==a.hasHighlights,s=s||c!==a.hasWater,a.isEmpty&&(this._materialRenderers.delete(o),a.dispose(),r=!0)}),this._changes.clear(),r&&this._updateSortedMaterialRenderers(),i&&(this._hasHighlights=No(this._materialRenderers,n=>n.hasHighlights)),s&&(this._hasWater=No(this._materialRenderers,n=>n.hasWater)),this.notifyChange("updating"),!0}addGeometries(e,r){if(e.length===0)return;const i=this._validateRenderGeometries(e);for(const n of i)this._geometries.set(n.id,n);const s=this._pending.empty;for(const n of i)this._pending.adds.add(n);s&&this.notifyChange("updating"),r===ji.UPDATE&&this._notifyGraphicGeometryChanged(e)}removeGeometries(e,r){const i=this._pending.empty,s=this._pending.adds;for(const n of e)s.has(n)?(this._pending.removed.add(n),s.delete(n)):this._pending.removed.has(n)||this._pending.removes.add(n),this._geometries.delete(n.id);i&&!this._pending.empty&&this.notifyChange("updating"),r===ji.UPDATE&&this._notifyGraphicGeometryChanged(e)}modifyGeometries(e,r){const i=this._changes.updates.length===0;for(const s of e){const n=this._changes.updates.pushNew();n.renderGeometry=this._validateRenderGeometry(s),n.updateType=r}switch(i&&this._changes.updates.length>0&&this.notifyChange("updating"),r){case Tn.TRANSFORMATION:case Tn.GEOMETRY:return this._notifyGraphicGeometryChanged(e);case Tn.VISIBILITY:return this._notifyGraphicVisibilityChanged(e)}}updateAnimation(e){let r=!1;return this._sortedMaterialRenderers.forAll(i=>r=i.updateAnimation(e)||r),r}render(e){this._sortedMaterialRenderers.forAll(r=>{if(r.material.shouldRender(e)){const i=r.prepareTechnique(e);i!=null&&r.render(e,i)}})}intersect(e,r,i,s,n){return this._geometries.forEach(o=>{if(s&&!s(o))return;this._intersectRenderGeometry(o,i,r,0,e,n);const a=this.rendererContext.longitudeCyclical;a&&(o.boundingSphere[0]-o.boundingSphere[3]<a.min&&this._intersectRenderGeometry(o,i,r,a.range,e,n),o.boundingSphere[0]+o.boundingSphere[3]>a.max&&this._intersectRenderGeometry(o,i,r,-a.range,e,n)),n++}),n}_updateSortedMaterialRenderers(){this._sortedMaterialRenderers.clear();let e=0;this._materialRenderers.forEach((r,i)=>{i.insertOrder=e++,this._sortedMaterialRenderers.push(r)}),this._sortedMaterialRenderers.sort((r,i)=>{const s=i.material.renderPriority-r.material.renderPriority;return s!==0?s:r.material.insertOrder-i.material.insertOrder})}_processAddsRemoves(){this._changes.adds.clear(),this._changes.removes.clear(),this._changes.adds.pushArray(Array.from(this._pending.adds)),this._changes.removes.pushArray(Array.from(this._pending.removes));for(let e=0;e<this._changes.updates.length;){const r=this._changes.updates.data[e];this._pending.has(r.renderGeometry)?this._changes.updates.removeUnorderedIndex(e):e++}this._pending.clear()}_intersectRenderGeometry(e,r,i,s,n,o){if(!e.visible)return;let a=0;s+=e.transformation[12],a=e.transformation[13],x9[0]=i[0]-s,x9[1]=i[1]-a,e.screenToWorldRatio=this.rendererContext.screenToWorldRatio,e.material.intersectDraped(e,null,n,x9,(l,c,h)=>{gct(r,h,e.material.renderPriority,o,n,e.layerUid,e.graphicUid)},r)}_notifyGraphicGeometryChanged(e){if(this.drapeSource.notifyGraphicGeometryChanged==null)return;let r;for(const i of e){const s=i.graphicUid;s!=null&&s!==r&&(this.drapeSource.notifyGraphicGeometryChanged(s),r=s)}}_notifyGraphicVisibilityChanged(e){if(this.drapeSource.notifyGraphicVisibilityChanged==null)return;let r;for(const i of e){const s=i.graphicUid;s!=null&&s!==r&&(this.drapeSource.notifyGraphicVisibilityChanged(s),r=s)}}_validateRenderGeometries(e){for(const r of e)this._validateRenderGeometry(r);return e}_validateRenderGeometry(e){return e.localOrigin==null&&(e.localOrigin=this._localOriginFactory.getOrigin(e.boundingSphere)),e}get test(){return{sortedMaterialRenderers:this._sortedMaterialRenderers}}};u([d()],jc.prototype,"drapeSource",void 0),u([d()],jc.prototype,"updating",null),u([d()],jc.prototype,"rctx",null),u([d()],jc.prototype,"rendererContext",void 0),u([d()],jc.prototype,"_materialRepository",null),u([d()],jc.prototype,"_localOriginFactory",null),u([d({readOnly:!0})],jc.prototype,"isEmpty",null),u([d()],jc.prototype,"_materialRenderers",void 0),u([d()],jc.prototype,"_geometries",void 0),jc=u([R("esri.views.3d.webgl-engine.lib.SortedRenderGeometryRenderer")],jc);let mct=class{constructor(){this.adds=new Set,this.removes=new Set,this.removed=new Set}get empty(){return this.adds.size===0&&this.removes.size===0&&this.removed.size===0}has(e){return this.adds.has(e)||this.removes.has(e)||this.removed.has(e)}clear(){this.adds.clear(),this.removes.clear(),this.removed.clear()}};function gct(t,e,r,i,s,n,o){const a=new Flt(n,o,e),l=c=>{c.set(ki.OVERLAY,a,t.dist,t.normal,t.transformation,r,i)};if((s.results.min.drapedLayerOrder==null||r>=s.results.min.drapedLayerOrder)&&(s.results.min.dist==null||s.results.ground.dist<=s.results.min.dist)&&l(s.results.min),s.options.store!==vo.MIN&&(s.results.max.drapedLayerOrder==null||r<s.results.max.drapedLayerOrder)&&(s.results.max.dist==null||s.results.ground.dist>s.results.max.dist)&&l(s.results.max),s.options.store===vo.ALL){const c=JX(s.ray);l(c),s.results.all.push(c)}}const x9=Ve();let iJ=class extends as{constructor(e,r){super(e,"vec2",Qr.Draw,(i,s,n,o)=>i.setUniform2fv(e,r(s,n,o)))}};const T9=4;function yct(){const t=new wr,e=t.fragment;t.include(Uh);const r=(T9+1)/2,i=1/(2*r*r);return e.include(_u),e.uniforms.add(new Je("depthMap",s=>s.depthTexture),new bh("tex",s=>s.colorTexture),new iJ("blurSize",s=>s.blurSize),new Re("projScale",(s,n)=>{const o=di(n.camera.eye,n.camera.center);return o>5e4?Math.max(0,s.projScale-(o-5e4)):s.projScale}),new Sr("nearFar",(s,n)=>n.camera.nearFar)),e.code.add(b`
    void blurFunction(vec2 uv, float r, float center_d, float sharpness, inout float wTotal, inout float bTotal) {
      float c = texture(tex, uv).r;
      float d = linearDepthFromTexture(depthMap, uv, nearFar);

      float ddiff = d - center_d;

      float w = exp(-r * r * ${b.float(i)} - ddiff * ddiff * sharpness);
      wTotal += w;
      bTotal += w * c;
    }
  `),e.code.add(b`
    void main(void) {
      float b = 0.0;
      float w_total = 0.0;

      float center_d = linearDepthFromTexture(depthMap, uv, nearFar);

      float sharpness = -0.05 * projScale / center_d;
      for (int r = -${b.int(T9)}; r <= ${b.int(T9)}; ++r) {
        float rf = float(r);
        vec2 uvOffset = uv + rf * blurSize;
        blurFunction(uvOffset, rf, center_d, sharpness, w_total, b);
      }

      fragColor = vec4(b / w_total);
    }
  `),t}const _ct=Object.freeze(Object.defineProperty({__proto__:null,build:yct},Symbol.toStringTag,{value:"Module"}));let NEe=class FEe extends Pr{initializeProgram(e){return new Cr(e.rctx,FEe.shader.get().build(),br)}initializePipeline(){return At({colorWrite:Vt})}};NEe.shader=new Er(_ct,()=>ae(()=>import("./SSAOBlur.glsl-711cba61.js"),[],import.meta.url));const vct="eXKEvZaUc66cjIKElE1jlJ6MjJ6Ufkl+jn2fcXp5jBx7c6KEflSGiXuXeW6OWs+tfqZ2Yot2Y7Zzfo2BhniEj3xoiXuXj4eGZpqEaHKDWjSMe7palFlzc3BziYOGlFVzg6Zzg7CUY5JrjFF7eYJ4jIKEcyyEonSXe7qUfqZ7j3xofqZ2c4R5lFZ5Y0WUbppoe1l2cIh2ezyUho+BcHN2cG6DbpqJhqp2e1GcezhrdldzjFGUcyxjc3aRjDyEc1h7Sl17c6aMjH92pb6Mjpd4dnqBjMOEhqZleIOBYzB7gYx+fnqGjJuEkWlwnCx7fGl+c4hjfGyRe5qMlNOMfnqGhIWHc6OMi4GDc6aMfqZuc6aMzqJzlKZ+lJ6Me3qRfoFue0WUhoR5UraEa6qMkXiPjMOMlJOGe7JrUqKMjK6MeYRzdod+Sl17boiPc6qEeYBlcIh2c1WEe7GDiWCDa0WMjEmMdod+Y0WcdntzhmN8WjyMjKJjiXtzgYxYaGd+a89zlEV7e2GJfnd+lF1rcK5zc4p5cHuBhL6EcXp5eYB7fnh8iX6HjIKEeaxuiYOGc66RfG2Ja5hzjlGMjEmMe9OEgXuPfHyGhPeEdl6JY02McGuMfnqGhFiMa3WJfnx2l4hwcG1uhmN8c0WMc39og1GBbrCEjE2EZY+JcIh2cIuGhIWHe0mEhIVrc09+gY5+eYBlnCyMhGCDl3drfmmMgX15aGd+gYx+fnuRfnhzY1SMsluJfnd+hm98WtNrcIuGh4SEj0qPdkqOjFF7jNNjdnqBgaqUjMt7boeBhnZ4jDR7c5pze4GGjEFrhLqMjHyMc0mUhKZze4WEa117kWlwbpqJjHZ2eX2Bc09zeId+e0V7WlF7jHJ2l72BfId8l3eBgXyBe897jGl7c66cgW+Xc76EjKNbgaSEjGx4fId8jFFjgZB8cG6DhlFziZhrcIh2fH6HgUqBgXiPY8dahGFzjEmMhEFre2dxhoBzc5SGfleGe6alc7aUeYBlhKqUdlp+cH5za4OEczxza0Gcc4J2jHZ5iXuXjH2Jh5yRjH2JcFx+hImBjH+MpddCl3dreZeJjIt8ZW18bm1zjoSEeIOBlF9oh3N7hlqBY4+UeYFwhLJjeYFwaGd+gUqBYxiEYot2fqZ2ondzhL6EYyiEY02Ea0VjgZB8doaGjHxoc66cjEGEiXuXiXWMiZhreHx8frGMe75rY02Ec5pzfnhzlEp4a3VzjM+EhFFza3mUY7Zza1V5e2iMfGyRcziEhDyEkXZ2Y4OBnCx7g5t2eyBjgV6EhEFrcIh2dod+c4Z+nJ5zjm15jEmUeYxijJp7nL6clIpjhoR5WrZraGd+fnuRa6pzlIiMg6ZzfHx5foh+eX1ufnB5eX1ufnB5aJt7UqKMjIh+e3aBfm5lbYSBhGFze6J4c39oc0mUc4Z+e0V7fKFVe0WEdoaGY02Ec4Z+Y02EZYWBfH6HgU1+gY5+hIWUgW+XjJ57ebWRhFVScHuBfJ6PhBx7WqJzlM+Ujpd4gHZziX6HjHmEgZN+lJt5boiPe2GJgX+GjIGJgHZzeaxufnB5hF2JtdN7jJ57hp57hK6ElFVzg6ZzbmiEbndzhIWHe3uJfoFue3qRhJd2j3xoc65zlE1jc3p8lE1jhniEgXJ7e657vZaUc3qBh52BhIF4aHKDa9drgY5+c52GWqZzbpqJe8tjnM+UhIeMfo2BfGl+hG1zSmmMjKJjZVaGgX15c1lze0mEp4OHa3mUhIWHhDyclJ6MeYOJkXiPc0VzhFiMlKaEboSJa5Jze41re3qRhn+HZYWBe0mEc4p5fnORbox5lEp4hGFjhGGEjJuEc1WEhLZjeHeGa7KlfHx2hLaMeX1ugY5+hIWHhKGPjMN7c1WEho1zhoBzZYx7fnhzlJt5exyUhFFziXtzfmmMa6qMYyiEiXxweV12kZSMeWqXSl17fnhzxmmMrVGEe1mcc4p5eHeGjK6MgY5+doaGa6pzlGV7g1qBh4KHkXiPeW6OaKqafqZ2eXZ5e1V7jGd7boSJc3BzhJd2e0mcYot2h1RoY8dahK6EQmWEWjx7e1l2lL6UgXyBdnR4eU9zc0VreX1umqaBhld7fo2Bc6KEc5Z+hDyEcIeBWtNrfHyGe5qMhMuMe5qMhEGEbVVupcNzg3aHhIF4boeBe0mEdlptc39ofFl5Y8uUlJOGiYt2UmGEcyxjjGx4jFF7a657ZYWBnElzhp57iXtrgZN+tfOEhIOBjE2HgU1+e8tjjKNbiWCDhE15gUqBgYN7fnqGc66ce9d7iYSBj0qPcG6DnGGcT3eGa6qMZY+JlIiMl4hwc3aRdnqBlGV7eHJ2hLZjfnuRhDyEeX6MSk17g6Z+c6aUjHmEhIF4gXyBc76EZW18fGl+fkl+jCxrhoVwhDyUhIqGlL2DlI6EhJd2tdN7eYORhEGMa2Faa6pzc3Bzc4R5lIRznM+UY9eMhDycc5Z+c4p5c4iGY117pb6MgXuPrbJafnx2eYOJeXZ5e657hDyEcziElKZjfoB5eHeGj4WRhGGEe6KGeX1utTStc76EhFGJnCyMa5hzfH6HnNeceYB7hmN8gYuMhIVrczSMgYF8h3N7c5pza5hzjJqEYIRdgYuMlL2DeYRzhGGEeX1uhLaEc4iGeZ1zdl6JhrVteX6Me2iMfm5lWqJzSpqEa6pzdnmchHx2c6OMhNdrhoR5g3aHczxzeW52gV6Ejm15frGMc0Vzc4Z+l3drfniJe+9rWq5rlF1rhGGEhoVwe9OEfoh+e7pac09+c3qBY0lrhDycdnp2lJ6MiYOGhGCDc3aRlL2DlJt5doaGdnp2gYF8gWeOjF2Uc4R5c5Z+jEmMe7KEc4mEeYJ4dmyBe0mcgXiPbqJ7eYB7fmGGiYSJjICGlF1reZ2PnElzbpqJfH6Hc39oe4WEc5eJhK6EhqyJc3qBgZB8c09+hEmEaHKDhFGJc5SGiXWMUpaEa89zc6OMnCyMiXtrho+Be5qMc7KEjJ57dmN+hKGPjICGbmiEe7prdod+hGCDdnmchBx7eX6MkXZ2hGGEa657hm98jFFjY5JreYOJgY2EjHZ2a295Y3FajJ6Mc1J+YzB7e4WBjF2Uc4R5eV12gYxzg1qBeId+c9OUc5pzjFFjgY5+hFiMlIaPhoR5lIpjjIKBlNdSe7KEeX2BfrGMhIqGc65zjE2UhK6EklZ+QmWEeziMWqZza3VzdnR4foh+gYF8n3iJiZhrnKp7gYF8eId+lJ6Me1lrcIuGjKJjhmN8c66MjFF7a6prjJ6UnJ5zezyUfruRWlF7nI5zfHyGe657h4SEe8tjhBx7jFFjc09+c39ojICMeZeJeXt+YzRzjHZ2c0WEcIeBeXZ5onSXkVR+gYJ+eYFwdldzgYF7eX2BjJ6UiXuXlE1jh4SEe1mchLJjc4Z+hqZ7eXZ5bm1zlL6Ue5p7iWeGhKqUY5pzjKJjcIeBe8t7gXyBYIRdlEp4a3mGnK6EfmmMZpqEfFl5gYxzjKZuhGFjhoKGhHx2fnx2eXuMe3aBiWeGvbKMe6KGa5hzYzB7gZOBlGV7hmN8hqZlYot2Y117a6pzc6KEfId8foB5rctrfneJfJ6PcHN2hFiMc5pzjH92c0VzgY2EcElzdmCBlFVzg1GBc65zY4OBboeBcHiBeYJ4ewxzfHx5lIRzlEmEnLKEbk1zfJ6PhmN8eYBljBiEnMOEiXxwezyUcIeBe76EdsKEeX2BdnR4jGWUrXWMjGd7fkl+j4WRlEGMa5Jzho+BhDyEfnqMeXt+g3aHlE1jczClhNN7ZW18eHx8hGFjZW18iXWMjKJjhH57gYuMcIuGWjyMe4ZtjJuExmmMj4WRdntzi4GDhFFzYIRdnGGcjJp7Y0F7e4WEkbCGiX57fnSHa657a6prhBCMe3Z+SmmMjH92eHJ2hK6EY1FzexhrvbKMnI5za4OEfnd+eXuMhImBe897hLaMjN+EfG+BeIOBhF1+eZeJi4GDkXZ2eXKEgZ6Ejpd4c2GHa1V5e5KUfqZuhCx7jKp7lLZrg11+hHx2hFWUoot2nI5zgbh5mo9zvZaUe3qRbqKMfqZ2kbCGhFiM";function x6(t){t.fragment.uniforms.add(new sr("projInfo",(e,r)=>bct(r))),t.fragment.uniforms.add(new Sr("zScale",(e,r)=>UEe(r))),t.fragment.code.add(b`vec3 reconstructPosition(vec2 fragCoord, float depth) {
return vec3((fragCoord * projInfo.xy + projInfo.zw) * (zScale.x * depth + zScale.y), depth);
}`)}function bct(t){const e=t.camera.projectionMatrix;return e[11]===0?bi(woe,2/(t.camera.fullWidth*e[0]),2/(t.camera.fullHeight*e[5]),(1+e[12])/e[0],(1+e[13])/e[5]):bi(woe,-2/(t.camera.fullWidth*e[0]),-2/(t.camera.fullHeight*e[5]),(1-e[8])/e[0],(1-e[9])/e[5])}const woe=Wt();function UEe(t){return t.camera.projectionMatrix[11]===0?or(xoe,0,1):or(xoe,1,0)}const xoe=Ve(),Toe=16;function wct(){const t=new wr,e=t.fragment;return t.include(Uh),e.include(_u),t.include(x6),e.uniforms.add(new Re("radius",(r,i)=>sJ(i.camera))),e.code.add(b`vec3 sphere[16];
void fillSphere() {
sphere[0] = vec3(0.186937, 0.0, 0.0);
sphere[1] = vec3(0.700542, 0.0, 0.0);
sphere[2] = vec3(-0.864858, -0.481795, -0.111713);
sphere[3] = vec3(-0.624773, 0.102853, -0.730153);
sphere[4] = vec3(-0.387172, 0.260319, 0.007229);
sphere[5] = vec3(-0.222367, -0.642631, -0.707697);
sphere[6] = vec3(-0.01336, -0.014956, 0.169662);
sphere[7] = vec3(0.122575, 0.1544, -0.456944);
sphere[8] = vec3(-0.177141, 0.85997, -0.42346);
sphere[9] = vec3(-0.131631, 0.814545, 0.524355);
sphere[10] = vec3(-0.779469, 0.007991, 0.624833);
sphere[11] = vec3(0.308092, 0.209288,0.35969);
sphere[12] = vec3(0.359331, -0.184533, -0.377458);
sphere[13] = vec3(0.192633, -0.482999, -0.065284);
sphere[14] = vec3(0.233538, 0.293706, -0.055139);
sphere[15] = vec3(0.417709, -0.386701, 0.442449);
}
float fallOffFunction(float vv, float vn, float bias) {
float f = max(radius * radius - vv, 0.0);
return f * f * f * max(vn - bias, 0.0);
}`),e.code.add(b`float aoValueFromPositionsAndNormal(vec3 C, vec3 n_C, vec3 Q) {
vec3 v = Q - C;
float vv = dot(v, v);
float vn = dot(normalize(v), n_C);
return fallOffFunction(vv, vn, 0.1);
}`),e.uniforms.add(new Sr("nearFar",(r,i)=>i.camera.nearFar),new Je("normalMap",r=>r.normalTexture),new Je("depthMap",r=>r.depthTexture),new Sr("zScale",(r,i)=>UEe(i)),new Re("projScale",r=>r.projScale),new Je("rnm",r=>r.noiseTexture),new Sr("rnmScale",(r,i)=>or(Soe,i.camera.fullWidth/r.noiseTexture.descriptor.width,i.camera.fullHeight/r.noiseTexture.descriptor.height)),new Re("intensity",r=>r.intensity),new Sr("screenSize",(r,i)=>or(Soe,i.camera.fullWidth,i.camera.fullHeight))),e.code.add(b`
    void main(void) {
      fillSphere();
      vec3 fres = normalize(2.0 * texture(rnm, uv * rnmScale).xyz - 1.0);
      float currentPixelDepth = linearDepthFromTexture(depthMap, uv, nearFar);

      if (-currentPixelDepth>nearFar.y || -currentPixelDepth<nearFar.x) {
        fragColor = vec4(0);
        return;
      }

      vec3 currentPixelPos = reconstructPosition(gl_FragCoord.xy,currentPixelDepth);

      // get the normal of current fragment
      vec4 norm4 = texture(normalMap, uv);
      vec3 norm = vec3(-1.0) + 2.0 * norm4.xyz;
      bool isTerrain = norm4.w < 0.5;

      float sum = 0.0;
      vec3 tapPixelPos;

      // note: the factor 2.0 should not be necessary, but makes ssao much nicer.
      // bug or deviation from CE somewhere else?
      float ps = projScale / (2.0 * currentPixelPos.z * zScale.x + zScale.y);

      for(int i = 0; i < ${b.int(Toe)}; ++i) {
        vec2 unitOffset = reflect(sphere[i], fres).xy;
        vec2 offset = vec2(-unitOffset * radius * ps);

        //don't use current or very nearby samples
        if( abs(offset.x) < 2.0 || abs(offset.y) < 2.0){
          continue;
        }

        vec2 tc = vec2(gl_FragCoord.xy + offset);
        if (tc.x < 0.0 || tc.y < 0.0 || tc.x > screenSize.x || tc.y > screenSize.y) continue;
        vec2 tcTap = tc / screenSize;
        float occluderFragmentDepth = linearDepthFromTexture(depthMap, tcTap, nearFar);

        if (isTerrain) {
          if (texture(normalMap, tcTap).w < 0.5) {
            continue;
          }
        }

        tapPixelPos = reconstructPosition(tc, occluderFragmentDepth);

        sum+= aoValueFromPositionsAndNormal(currentPixelPos, norm, tapPixelPos);
      }

      // output the result
      float A = max(1.0 - sum * intensity / float(${b.int(Toe)}), 0.0);

      // Anti-tone map to reduce contrast and drag dark region farther: (x^0.2 + 1.2 * x^4) / 2.2
      A = (pow(A, 0.2) + 1.2 * A*A*A*A) / 2.2;
      fragColor = vec4(A);
    }
  `),t}function sJ(t){return Math.max(10,20*t.computeScreenPixelSizeAtDist(Math.abs(4*t.relativeElevation)))}const Soe=Ve(),xct=Object.freeze(Object.defineProperty({__proto__:null,build:wct,getRadius:sJ},Symbol.toStringTag,{value:"Module"}));let kEe=class VEe extends Pr{initializeProgram(e){return new Cr(e.rctx,VEe.shader.get().build(),br)}initializePipeline(){return At({colorWrite:Vt})}};kEe.shader=new Er(xct,()=>ae(()=>import("./SSAO.glsl-c7beff6d.js"),[],import.meta.url));let Tct=class extends ei{constructor(){super(...arguments),this.projScale=1}},Sct=class extends Tct{constructor(){super(...arguments),this.intensity=1}},Ect=class extends ei{},Cct=class extends Ect{constructor(){super(...arguments),this.blurSize=Ve()}};const QA=2;let zEe=class{constructor(e,r,i,s){this._view=e,this._techniqueRepository=r,this._rctx=i,this._requestRender=s,this._quadVAO=null,this._passParameters=new Sct,this._drawParameters=new Cct}dispose(){this.enabled=!1,this._quadVAO=Ue(this._quadVAO)}destroy(){this.dispose()}disposeOffscreenBuffers(){this._ssaoFBO?.resize(0,0),this._blurFBO?.resize(0,0)}set enabled(e){e?this._enable():this._disable()}get enabled(){return this._enableTime!=null}get active(){return this.enabled&&this._ssaoTechnique.compiled&&this._blurTechnique.compiled}get colorTexture(){return this._ssaoFBO?.colorTexture}render(e,r,i,s){if(this._enableTime==null||i==null||s==null||this._ssaoFBO==null||this._blurFBO==null)return;if(!this.active)return this._enableTime=r,void this._requestRender();this._enableTime===0&&(this._enableTime=r);const n=this._rctx,o=e.camera,a=this._view.qualitySettings.fadeDuration,l=a>0?Math.min(a,r-this._enableTime)/a:1;this._passParameters.normalTexture=s,this._passParameters.depthTexture=i,this._passParameters.projScale=1/o.computeRenderPixelSizeAtDist(1),this._passParameters.intensity=4*Act/sJ(o)**6*l;const c=o.fullViewport,h=c[2],p=c[3],f=h/QA,m=p/QA;this._ssaoFBO.resize(h,p),this._blurFBO.resize(f,m),this._quadVAO==null&&(this._quadVAO=Rl(this._rctx)),n.bindFramebuffer(this._ssaoFBO),n.setViewport(0,0,h,p),n.bindTechnique(this._ssaoTechnique,this._passParameters,e).bindDraw(this._drawParameters,e,this._passParameters),n.bindVAO(this._quadVAO);const y=Fo(this._quadVAO,"geometry");n.drawArrays(St.TRIANGLE_STRIP,0,y);const _=n.bindTechnique(this._blurTechnique,this._passParameters,e);n.setViewport(0,0,f,m),n.bindFramebuffer(this._blurFBO),this._drawParameters.colorTexture=this._ssaoFBO.colorTexture,or(this._drawParameters.blurSize,0,QA/p),_.bindDraw(this._drawParameters,e,this._passParameters),n.setViewport(0,0,f,m),n.drawArrays(St.TRIANGLE_STRIP,0,y),n.bindFramebuffer(this._ssaoFBO),n.setViewport(0,0,h,p),n.setClearColor(1,1,1,0),n.clear(wi.COLOR_BUFFER_BIT),n.setViewport(0,0,f,m),this._drawParameters.colorTexture=this._blurFBO.colorTexture,or(this._drawParameters.blurSize,QA/h,0),_.bindDraw(this._drawParameters,e,this._passParameters),n.drawArrays(St.TRIANGLE_STRIP,0,y),n.setViewport(c[0],c[1],c[2],c[3]),l<1&&this._requestRender()}_enable(){if(this._enableTime!=null)return;const e=new vr;e.wrapMode=$t.CLAMP_TO_EDGE,this._ssaoFBO=new hn(this._rctx,e),this._blurFBO=new hn(this._rctx,e);const r=Uint8Array.from(atob(vct),i=>i.charCodeAt(0));e.pixelFormat=Tt.RGB,e.wrapMode=$t.REPEAT,e.hasMipmap=!0,e.width=32,e.height=32,this._passParameters.noiseTexture=new Et(this._rctx,e,r),this._ssaoTechnique==null&&(this._ssaoTechnique=this._techniqueRepository.acquire(kEe)),this._blurTechnique==null&&(this._blurTechnique=this._techniqueRepository.acquire(NEe)),this._enableTime=0,this._requestRender()}_disable(){this._enableTime=null,this._passParameters.noiseTexture=Ue(this._passParameters.noiseTexture),this._blurFBO=Ue(this._blurFBO),this._ssaoFBO=Ue(this._ssaoFBO)}get gpuMemoryUsage(){return(this._blurFBO?.gpuMemoryUsage??0)+(this._ssaoFBO?.gpuMemoryUsage??0)}};const Act=.5;let nJ=class BEe extends Pr{initializeProgram(e){return new Cr(e.rctx,BEe.shader.get().build(),br)}initializePipeline(){return this.configuration.hasAlpha?At({blending:xo(we.SRC_ALPHA,we.ONE,we.ONE_MINUS_SRC_ALPHA,we.ONE_MINUS_SRC_ALPHA),colorWrite:Vt}):At({colorWrite:Vt})}};nJ.shader=new Er(Wat,()=>ae(()=>import("./TextureOnly.glsl-f86c0480.js"),[],import.meta.url));let oJ=class extends pa{constructor(){super(...arguments),this.hasAlpha=!1}};u([B()],oJ.prototype,"hasAlpha",void 0);let Kp=class extends Te{get _bindParameters(){return this._renderContext.bindParameters}get _rctx(){return this.view._stage.renderView.renderingContext}get rctx(){return this._rctx}get materialRepository(){return this._materialRepository}get screenToWorldRatio(){return this._screenToWorldRatio}get localOriginFactory(){return this._localOriginFactory}constructor(e){super(e),this._overlays=null,this._overlayRenderTarget=null,this._hasHighlights=!1,this._rendersOccluded=!1,this._hasWater=!1,this._handles=new Oi,this._renderers=new Map,this._sortedDrapeSourceRenderersDirty=!1,this._sortedRenderers=new kt,this._passParameters=new eEe,this._materialRepository=null,this._screenToWorldRatio=1,this._localOriginFactory=null,this._camera=new ut,this.worldToPCSRatio=1,this.events=new os,this.longitudeCyclical=null}initialize(){const e=this.view._stage.renderView,{waterTextureRepository:r,stippleTextureRepository:i,markerTextureRepository:s}=e;this._shaderTechniqueRepository=new tEe({rctx:this._rctx,viewingMode:De.Local,stippleTextureRepository:i,markerTextureRepository:s,waterTextureRepository:r}),this._renderContext=new xEe(this._rctx,new QY(this._rctx,this.view.state.viewingMode),new zEe(this.view,this._shaderTechniqueRepository,this._rctx,()=>{})),this._handles.add([le(()=>r.updating,()=>this.events.emit("content-changed"),As),le(()=>this.spatialReference,n=>this._localOriginFactory=new YY(n),As),Ga(()=>this.view.allLayerViews,"after-changes",()=>this._sortedDrapeSourceRenderersDirty=!0)]),this._materialRepository=new rEe(e.textureRepository,this._shaderTechniqueRepository,n=>{(n.renderOccluded&F4)>0!==this._rendersOccluded&&this._updateRendersOccluded(),this.events.emit("content-changed"),this.notifyChange("updating"),this.notifyChange("isEmpty")},()=>this.events.emit("content-changed")),this._bindParameters.slot=ue.DRAPED_MATERIAL,this._bindParameters.highlightDepthTexture=Lwe(this._rctx),this._camera.near=1,this._camera.far=1e4,this._camera.relativeElevation=null,this._bindParameters.camera=this._camera,this._bindParameters.transparencyPassType=ot.NONE,this._bindParameters.newLighting.noonFactor=0,this._bindParameters.newLighting.globalFactor=0,this._bindParameters.newLighting.set([new NX(Oe(1,1,1))]),this._handles.add(this.view.resourceController.scheduler.registerTask(dt.STAGE,this))}destroy(){this._handles.destroy(),this._renderers.forEach(e=>e.destroy()),this._renderers.clear(),this._debugTextureTechnique=Ui(this._debugTextureTechnique),this._passParameters.texture=Ue(this._passParameters.texture),this._bindParameters.highlightDepthTexture=Ue(this._bindParameters.highlightDepthTexture),this._shaderTechniqueRepository=Me(this._shaderTechniqueRepository),this._temporaryFBO=Ue(this._temporaryFBO),this._quadVAO=Ue(this._quadVAO),this.disposeOverlays()}get updating(){return this._sortedDrapeSourceRenderersDirty||No(this._renderers,e=>e.updating)}get hasOverlays(){return this._overlays!=null&&this._overlayRenderTarget!=null}get gpuMemoryUsage(){return this._overlayRenderTarget!=null?this._overlayRenderTarget.gpuMemoryUsage:0}createGeometryDrapeSourceRenderer(e){return this.createDrapeSourceRenderer(e,jc)}createDrapeSourceRenderer(e,r,i){const s=this._renderers.get(e);s?.destroy();const n=new r({...i,rendererContext:this,drapeSource:e});return this._renderers.set(e,n),this._sortedDrapeSourceRenderersDirty=!0,"fullOpacity"in e&&this._handles.add(le(()=>e.fullOpacity,()=>this.events.emit("content-changed")),e),n}removeDrapeSourceRenderer(e){if(e==null)return;const r=this._renderers.get(e);r!=null&&(this._sortedDrapeSourceRenderersDirty=!0,this._renderers.delete(e),this._handles.remove(e),r.destroy())}collectUnusedRenderTargetMemory(){let e=!1;const r=e$e();if(this._overlayRenderTarget!=null)for(const i of this._overlayRenderTarget.renderTargets){const s=this.overlays[Pi.INNER].validTargets[i.type];e=this._overlayRenderTarget.validateUsageForTarget(s,i,r)||e}return e}get overlays(){return this._overlays??[]}ensureDrapeTargets(e){this._overlays!=null&&this._overlays.forEach(r=>r.hasTargetWithoutRasterImage=N$(e,i=>i.drapeTargetType===pH.WithoutRasterImage))}ensureDrapeSources(e){this._overlays!=null&&this._overlays.forEach(r=>{r.hasDrapedFeatureSource=N$(e,i=>i.drapeSourceType===eO.Features),r.hasDrapedRasterSource=N$(e,i=>i.drapeSourceType===eO.RasterImage)})}ensureOverlays(e,r){this._overlays==null&&(this._overlayRenderTarget=new jat(this._rctx),this._overlays=[new one(Pi.INNER,this._overlayRenderTarget),new one(Pi.OUTER,this._overlayRenderTarget)]),this.ensureDrapeTargets(e),this.ensureDrapeSources(r)}disposeOverlays(){this._overlays=null,this._overlayRenderTarget=Ue(this._overlayRenderTarget),this.events.emit("textures-disposed")}get running(){return this.updating}runTask(e){this._processDrapeSources(e,()=>!0)}_processDrapeSources(e,r){let i=!1;for(const[s,n]of this._renderers){if(e.done)break;(s.destroyed||r(s))&&n.commitChanges()&&(i=!0,e.madeProgress())}this._sortedDrapeSourceRenderersDirty&&(this._sortedDrapeSourceRenderersDirty=!1,i=!0,this._updateSortedDrapeSourceRenderers()),i&&(this._overlays!=null&&this._renderers.size===0&&this.disposeOverlays(),this.notifyChange("updating"),this.notifyChange("isEmpty"),this.events.emit("content-changed"),this._updateHasHighlights(),this._updateRendersOccluded(),this._updateHasWater())}processSyncDrapeSources(){this._processDrapeSources(za,e=>e.updatePolicy===v_.SYNC)}get isEmpty(){return!ni.OVERLAY_DRAW_DEBUG_TEXTURE&&!No(this._renderers,e=>!e.isEmpty)}get hasHighlights(){return this._hasHighlights}get hasWater(){return this._hasWater}get rendersOccluded(){return this._rendersOccluded}updateAnimation(e){let r=!1;return this._renderers.forEach(i=>r=i.updateAnimation(e)||r),r}updateDrapeSourceOrder(){this._sortedDrapeSourceRenderersDirty=!0}drawTarget(e,r,i){const s=e.canvasGeometries;if(s.numViews===0)return!1;const{alignPixelEnabled:n,contentPixelRatio:o}=i;this._screenToWorldRatio=o*e.mapUnitsPerPixel/xY;const a=r.output;if(this.isEmpty||a===N.Highlight&&!this.hasHighlights||a===N.Normal&&!this.hasWater||!e.hasSomeSizedView())return!1;const l=r.fbo;if(!l.isValid())return!1;const c=2*e.resolution,h=e.resolution;l.resize(c,h);const p=this._rctx;if(this._camera.pixelRatio=e.pixelRatio*o,this._renderContext.output=a,this._bindParameters.alignPixelEnabled=n,this._bindParameters.screenToWorldRatio=this._screenToWorldRatio,this._bindParameters.screenToPCSRatio=this._screenToWorldRatio*this.worldToPCSRatio,this._bindParameters.slot=a===N.Normal?ue.DRAPED_WATER:ue.DRAPED_MATERIAL,e.applyViewport(this._rctx),l.bind(p),e.index===Pi.INNER&&(p.setClearColor(0,0,0,0),p.clearSafe(wi.COLOR_BUFFER_BIT)),r.type===rs.Occluded&&(this._renderContext.renderOccludedMask=F4),ni.OVERLAY_DRAW_DEBUG_TEXTURE&&r.type!==rs.Occluded)for(let f=0;f<s.numViews;f++)this._setViewParameters(s.extents[f],e),this._drawDebugTexture(e.resolution,Rct[e.index]);return this._renderers.size>0&&this._sortedRenderers.forAll(({drapeSource:f,renderer:m})=>{if(r.type===rs.ColorNoRasterImage&&f.drapeSourceType===eO.RasterImage)return;const{fullOpacity:y}=f,_=y!=null&&y<1&&a===N.Color;_&&(this.bindTemporaryFramebuffer(this._rctx,c,h),p.clearSafe(wi.COLOR_BUFFER_BIT));for(let v=0;v<s.numViews;v++)this._setViewParameters(s.extents[v],e),m.render(this._renderContext);_&&this._temporaryFBO!=null&&(l.bind(p),this.view._stage.renderView.compositingHelper.compositeOverlay(this._renderContext.bindParameters,this._temporaryFBO.getTexture(),y,e.index))}),p.bindFramebuffer(null),l.generateMipMap(),this._renderContext.resetRenderOccludedMask(),!0}bindTemporaryFramebuffer(e,r,i){this._temporaryFBO==null&&(this._temporaryFBO=new K2e(e,!1)),this._temporaryFBO.resize(r,i),this._temporaryFBO.bind(e)}async reloadShaders(){await this._shaderTechniqueRepository.reloadAll()}notifyContentChanged(){this.events.emit("content-changed")}intersect(e,r,i,s){let n=0;for(const o of this._renderers.values())n=o.intersect?.(e,r,i,s,n)??n}_updateSortedDrapeSourceRenderers(){if(this._sortedRenderers.clear(),this._renderers.size===0)return;const e=this.view.map.allLayers;this._renderers.forEach((r,i)=>{const s=e.indexOf(i.layer),n=s>=0,o=this._renderers.size*(i.renderGroup??(n?I4.MapLayer:I4.ViewLayer))+(n?s:0);this._sortedRenderers.push(new Oct(i,r,o))}),this._sortedRenderers.sort((r,i)=>r.index-i.index)}_setViewParameters(e,r){const i=this._camera;i.viewport=[0,0,r.resolution,r.resolution],P0e(i.projectionMatrix,0,e[2]-e[0],0,e[3]-e[1],i.near,i.far),zR(i.viewMatrix,[-e[0],-e[1],0])}_updateHasWater(){const e=No(this._renderers,r=>r.hasWater);e!==this._hasWater&&(this._hasWater=e,this.events.emit("has-water",e))}_updateHasHighlights(){const e=No(this._renderers,r=>r.hasHighlights);e!==this._hasHighlights&&(this._hasHighlights=e,this.events.emit("has-highlights",e))}_updateRendersOccluded(){const e=No(this._renderers,r=>r.rendersOccluded);e!==this._rendersOccluded&&(this._rendersOccluded=e,this.events.emit("renders-occluded",e))}_drawDebugTexture(e,r){this._ensureDebugPatternResources(e,r);const i=this._rctx;i.bindTechnique(this._debugTextureTechnique,this._passParameters,null),i.bindVAO(this._quadVAO),i.drawArrays(St.TRIANGLE_STRIP,0,Fo(this._quadVAO,"geometry"))}_ensureDebugPatternResources(e,r){if(se(this._passParameters.color,r[0],r[1],r[2]),this._passParameters.texture)return;const i=new Uint8Array(e*e*4);let s=0;for(let a=0;a<e;a++)for(let l=0;l<e;l++){const c=Math.floor(l/10),h=Math.floor(a/10);c<2||h<2||10*c>e-20||10*h>e-20?(i[s++]=255,i[s++]=255,i[s++]=255,i[s++]=255):(i[s++]=255,i[s++]=255,i[s++]=255,i[s++]=1&c&&1&h?1&l^1&a?0:255:1&c^1&h?0:128)}const n=new vr(e);n.samplingMode=Ct.NEAREST,this._passParameters.texture=new Et(this._rctx,n,i);const o=new oJ;o.hasAlpha=!0,this._debugTextureTechnique=this._shaderTechniqueRepository.acquire(nJ,o),this._quadVAO=Rl(this._rctx)}get test(){return{drapedRenderers:Array.from(this._renderers.values()),getDrapeSourceRenderer:e=>this._renderers.get(e)}}};u([d()],Kp.prototype,"_sortedDrapeSourceRenderersDirty",void 0),u([d({autoDestroy:!0})],Kp.prototype,"_shaderTechniqueRepository",void 0),u([d({constructOnly:!0})],Kp.prototype,"view",void 0),u([d()],Kp.prototype,"worldToPCSRatio",void 0),u([d()],Kp.prototype,"spatialReference",void 0),u([d({type:Boolean,readOnly:!0})],Kp.prototype,"updating",null),u([d()],Kp.prototype,"isEmpty",null),Kp=u([R("esri.views.3d.terrain.OverlayRenderer")],Kp);let Oct=class{constructor(e,r,i){this.drapeSource=e,this.renderer=r,this.index=i}};const Rct=[[1,.5,.5],[.5,.5,1]],aJ=-2,F4=Mi.OccludeAndTransparent;function lJ(t,e,r,i){const s=hP(t.rings,!!t.hasZ,qf.CCW_IS_HOLE),n=Bo(s.position.length),o=h2e(s.position,t.spatialReference,0,n,0,s.position,0,s.position.length/3,e,r,i),a=o!=null;return new Ict(s.position,n,HEe(s.polygons,s.position,n),jEe(s.outlines,s.position,n),a,o)}function GEe(t,e){const r=hP(t.rings,!1,qf.CCW_IS_HOLE),i=oi(r.position,t.spatialReference,0,r.position,e,0,r.position.length/3);for(let s=2;s<r.position.length;s+=3)r.position[s]=aJ;return{position:r.position,polygons:HEe(r.polygons,r.position),outlines:jEe(r.outlines,r.position),projectionSuccess:i}}function jEe(t,e,r=null){return t.filter(({count:i})=>i>1).map(({index:i,count:s})=>{const n=3*i,o=3*s;return r!=null?new qEe(i,s,wh(e,n,o),wh(r,n,o)):new cJ(i,s,wh(e,n,o))})}function HEe(t,e,r=null){const i=new Array;for(const{index:s,count:n,holeIndices:o,pathLengths:a}of t){if(n<=1)continue;const l=3*s,c=3*n,h=o.map(f=>f-s),p=r!=null?new Pct(s,n,wh(e,3*s,3*n),wh(r,l,c),h,a):new Mct(s,n,wh(e,3*s,3*n),h,a);i.push(p)}return i}let cJ=class{constructor(e,r,i){this.index=e,this.count=r,this.position=i}},qEe=class extends cJ{constructor(e,r,i,s){super(e,r,i),this.mapPositions=s}},Pct=class extends qEe{constructor(e,r,i,s,n,o){super(e,r,i,s),this.holeIndices=n,this.pathLengths=o}},Mct=class extends cJ{constructor(e,r,i,s,n){super(e,r,i),this.holeIndices=s,this.pathLengths=n}},Ict=class{constructor(e,r,i,s,n,o){this.position=e,this.mapPositions=r,this.polygons=i,this.outlines=s,this.projectionSuccess=n,this.sampledElevation=o}};function yw(t,e,r,i,s,n=2){const o=1/(Math.abs(r)+Math.abs(i)+Math.abs(s)),a=r*o,l=i*o,c=s<=0?(a>=0?1:-1)*(1-Math.abs(l)):a,h=s<=0?(l>=0?1:-1)*(1-Math.abs(a)):l,p=e*n;t[p]=Eoe(c),t[p+1]=Eoe(h)}function $ct(t){const e=t.length/3,r=new Int16Array(2*e);let i=0;for(let s=0;s<e;++s)yw(r,s,t[i++],t[i++],t[i++]);return r}function Lct(t,e,r,i=2){const s=r*i,n=Coe(e[s]),o=Coe(e[s+1]),a=1-Math.abs(n)-Math.abs(o);t[2]=a,a<0?(t[0]=(n>=0?1:-1)*(1-Math.abs(o)),t[1]=(o>=0?1:-1)*(1-Math.abs(n))):(t[0]=n,t[1]=o),me(t,t)}function Eoe(t){return ge(Math.round(32767*t),-32767,32767)}function Coe(t){return ge(t/32767,-1,1)}function WEe(t,e){const r=t.fragment;switch(r.code.add(b`struct ShadingNormalParameters {
vec3 normalView;
vec3 viewDirection;
} shadingParams;`),e.doubleSidedMode){case Ji.None:r.code.add(b`vec3 shadingNormal(ShadingNormalParameters params) {
return normalize(params.normalView);
}`);break;case Ji.View:r.code.add(b`vec3 shadingNormal(ShadingNormalParameters params) {
return dot(params.normalView, params.viewDirection) > 0.0 ? normalize(-params.normalView) : normalize(params.normalView);
}`);break;case Ji.WindingOrder:r.code.add(b`vec3 shadingNormal(ShadingNormalParameters params) {
return gl_FrontFacing ? normalize(params.normalView) : normalize(-params.normalView);
}`);break;default:e.doubleSidedMode;case Ji.COUNT:}}var Ji;(function(t){t[t.None=0]="None",t[t.View=1]="View",t[t.WindingOrder=2]="WindingOrder",t[t.COUNT=3]="COUNT"})(Ji||(Ji={}));function ZEe({normalTexture:t,metallicRoughnessTexture:e,metallicFactor:r,roughnessFactor:i,emissiveTexture:s,emissiveFactor:n,occlusionTexture:o}){return t==null&&e==null&&s==null&&(n==null||la(n,ja))&&o==null&&(i==null||i===1)&&(r==null||r===1||r===0)}const T6=[1,1,.5],uJ=[0,.6,.2],Dct=[0,1,.2];function XEe(t){t.vertex.code.add(b`vec4 offsetBackfacingClipPosition(vec4 posClip, vec3 posWorld, vec3 normalWorld, vec3 camPosWorld) {
vec3 camToVert = posWorld - camPosWorld;
bool isBackface = dot(camToVert, normalWorld) > 0.0;
if (isBackface) {
posClip.z += 0.0000003 * posClip.w;
}
return posClip;
}`)}let Nct=class extends pa{constructor(){super(...arguments),this.instancedDoublePrecision=!1}};function YEe(t,e){e.instanced&&e.instancedDoublePrecision&&(t.attributes.add(E.MODELORIGINHI,"vec3"),t.attributes.add(E.MODELORIGINLO,"vec3"),t.attributes.add(E.MODEL,"mat3"),t.attributes.add(E.MODELNORMAL,"mat3"));const r=t.vertex;e.instancedDoublePrecision&&(r.include(n4,e),r.uniforms.add(new cu("viewOriginHi",(i,s)=>IQe(se(LI,s.camera.viewInverseTransposeMatrix[3],s.camera.viewInverseTransposeMatrix[7],s.camera.viewInverseTransposeMatrix[11]),LI)),new cu("viewOriginLo",(i,s)=>$Qe(se(LI,s.camera.viewInverseTransposeMatrix[3],s.camera.viewInverseTransposeMatrix[7],s.camera.viewInverseTransposeMatrix[11]),LI)))),r.code.add(b`
    vec3 calculateVPos() {
      ${e.instancedDoublePrecision?"return model * localPosition().xyz;":"return localPosition().xyz;"}
    }
    `),r.code.add(b`
    vec3 subtractOrigin(vec3 _pos) {
      ${e.instancedDoublePrecision?b`
          vec3 originDelta = dpAdd(viewOriginHi, viewOriginLo, -modelOriginHi, -modelOriginLo);
          return _pos - originDelta;`:"return vpos;"}
    }
    `),r.code.add(b`
    vec3 dpNormal(vec4 _normal) {
      ${e.instancedDoublePrecision?"return normalize(modelNormal * _normal.xyz);":"return normalize(_normal.xyz);"}
    }
    `),e.output===N.Normal&&(M2(r),r.code.add(b`
    vec3 dpNormalView(vec4 _normal) {
      ${e.instancedDoublePrecision?"return normalize((viewNormal * vec4(modelNormal * _normal.xyz, 1.0)).xyz);":"return normalize((viewNormal * _normal).xyz);"}
    }
    `)),e.hasVertexTangents&&r.code.add(b`
    vec4 dpTransformVertexTangent(vec4 _tangent) {
      ${e.instancedDoublePrecision?"return vec4(modelNormal * _tangent.xyz, _tangent.w);":"return _tangent;"}

    }
    `)}u([B()],Nct.prototype,"instancedDoublePrecision",void 0);const LI=C();function JEe(t){t.vertex.code.add(b`
    vec4 decodeSymbolColor(vec4 symbolColor, out int colorMixMode) {
      float symbolAlpha = 0.0;

      const float maxTint = 85.0;
      const float maxReplace = 170.0;
      const float scaleAlpha = 3.0;

      if (symbolColor.a > maxReplace) {
        colorMixMode = ${b.int(Us.Multiply)};
        symbolAlpha = scaleAlpha * (symbolColor.a - maxReplace);
      } else if (symbolColor.a > maxTint) {
        colorMixMode = ${b.int(Us.Replace)};
        symbolAlpha = scaleAlpha * (symbolColor.a - maxTint);
      } else if (symbolColor.a > 0.0) {
        colorMixMode = ${b.int(Us.Tint)};
        symbolAlpha = scaleAlpha * symbolColor.a;
      } else {
        colorMixMode = ${b.int(Us.Multiply)};
        symbolAlpha = 0.0;
      }

      return vec4(symbolColor.r, symbolColor.g, symbolColor.b, symbolAlpha);
    }
  `)}function QEe(t,e){e.hasSymbolColors?(t.include(JEe),t.attributes.add(E.SYMBOLCOLOR,"vec4"),t.varyings.add("colorMixMode","mediump float"),t.vertex.code.add(b`int symbolColorMixMode;
vec4 getSymbolColor() {
return decodeSymbolColor(symbolColor, symbolColorMixMode) * 0.003921568627451;
}
void forwardColorMixMode() {
colorMixMode = float(symbolColorMixMode) + 0.5;
}`)):(t.fragment.uniforms.add(new pP("colorMixMode",r=>wSe[r.colorMixMode])),t.vertex.code.add(b`vec4 getSymbolColor() { return vec4(1.0); }
void forwardColorMixMode() {}`))}function Bw(t,e){e.hasVertexColors?(t.attributes.add(E.COLOR,"vec4"),t.varyings.add("vColor","vec4"),t.vertex.code.add(b`void forwardVertexColor() { vColor = color; }`),t.vertex.code.add(b`void forwardNormalizedVertexColor() { vColor = color * 0.003921568627451; }`)):t.vertex.code.add(b`void forwardVertexColor() {}
void forwardNormalizedVertexColor() {}`)}function Fct(t){t.fragment.code.add(b`
    #define discardOrAdjustAlpha(color) { if (color.a < ${b.float(go)}) { discard; } }
  `)}let Db=class extends as{constructor(e,r){super(e,"float",Qr.Draw,(i,s,n)=>i.setUniform1f(e,r(s,n)))}};function Nb(t,e){KEe(t,e,new Re("textureAlphaCutoff",r=>r.textureAlphaCutoff))}function Uct(t,e){KEe(t,e,new Db("textureAlphaCutoff",r=>r.textureAlphaCutoff))}function KEe(t,e,r){const i=t.fragment;switch(e.alphaDiscardMode!==Yr.Mask&&e.alphaDiscardMode!==Yr.MaskBlend||i.uniforms.add(r),e.alphaDiscardMode){case Yr.Blend:return t.include(Fct);case Yr.Opaque:i.code.add(b`void discardOrAdjustAlpha(inout vec4 color) {
color.a = 1.0;
}`);break;case Yr.Mask:i.code.add(b`#define discardOrAdjustAlpha(color) { if (color.a < textureAlphaCutoff) { discard; } else { color.a = 1.0; } }`);break;case Yr.MaskBlend:t.fragment.code.add(b`#define discardOrAdjustAlpha(color) { if (color.a < textureAlphaCutoff) { discard; } }`)}}function eCe(t,e){const{vertex:r,fragment:i}=t,s=e.hasModelTransformation;if(s){const o=Li();r.uniforms.add(new $i("model",a=>a.modelTransformation??un)),r.uniforms.add(new kh("normalTransform",a=>(L_(o,a.modelTransformation??un),o)))}const n=e.hasColorTexture&&e.alphaDiscardMode!==Yr.Opaque;switch(e.output){case N.Depth:case N.Shadow:case N.ShadowHighlight:case N.ShadowExcludeHighlight:case N.ObjectAndLayerIdColor:vc(r,e),t.include(xl,e),t.include(Pf,e),t.include(Sg,e),t.include(jg,e),t.include(ps,e),t.include(nP,e),cw(t),t.varyings.add("depth","float"),n&&i.uniforms.add(new Je("tex",o=>o.texture)),r.code.add(b`
          void main(void) {
            vpos = calculateVPos();
            ${s?"vpos = (model * vec4(vpos, 1.0)).xyz;":""}
            vpos = subtractOrigin(vpos);
            vpos = addVerticalOffset(vpos, localOrigin);
            gl_Position = transformPositionWithDepth(proj, view, vpos, nearFar, depth);
            forwardTextureCoordinates();
            forwardObjectAndLayerIdColor();
          }
        `),t.include(Nb,e),i.code.add(b`
          void main(void) {
            discardBySlice(vpos);
            ${n?b`
                    vec4 texColor = texture(tex, ${e.hasColorTextureTransform?b`colorUV`:b`vuv0`});
                    discardOrAdjustAlpha(texColor);`:""}
            ${e.output===N.ObjectAndLayerIdColor?b`outputObjectAndLayerIdColor();`:b`outputDepth(depth);`}
          }
        `);break;case N.Normal:{vc(r,e),t.include(xl,e),t.include(dP,e),t.include(b6,e),t.include(Pf,e),t.include(Sg,e),n&&i.uniforms.add(new Je("tex",a=>a.texture)),e.normalType===Or.ScreenDerivative&&t.varyings.add("vPositionView","vec3");const o=e.normalType===Or.Attribute||e.normalType===Or.Compressed;r.code.add(b`
          void main(void) {
            vpos = calculateVPos();
            ${s?"vpos = (model * vec4(vpos, 1.0)).xyz;":""}

            ${o?b`vNormalWorld = ${s?"normalize(normalTransform * dpNormal(vvLocalNormal(normalModel())))":"dpNormalView(vvLocalNormal(normalModel()))"};`:b`
                  // Get vertex position in camera space for screen-space derivative normals
                  vPositionView = (view * vec4(vpos, 1.0)).xyz;
                `}
            vpos = subtractOrigin(vpos);
            vpos = addVerticalOffset(vpos, localOrigin);
            gl_Position = transformPosition(proj, view, vpos);
            forwardTextureCoordinates();
          }
        `),t.include(ps,e),t.include(Nb,e),i.code.add(b`
          void main() {
            discardBySlice(vpos);
            ${n?b`
                    vec4 texColor = texture(tex, ${e.hasColorTextureTransform?b`colorUV`:b`vuv0`});
                    discardOrAdjustAlpha(texColor);`:""}

            ${e.normalType===Or.ScreenDerivative?b`vec3 normal = screenDerivativeNormal(vPositionView);`:b`
                  vec3 normal = normalize(vNormalWorld);
                  if (gl_FrontFacing == false){
                    normal = -normal;
                  }`}
            fragColor = vec4(0.5 + 0.5 * normal, 1.0);
          }
        `);break}case N.Highlight:vc(r,e),t.include(xl,e),t.include(Pf,e),t.include(Sg,e),n&&i.uniforms.add(new Je("tex",o=>o.texture)),r.code.add(b`
          void main(void) {
            vpos = calculateVPos();
            ${s?"vpos = (model * vec4(vpos, 1.0)).xyz;":""}
            vpos = subtractOrigin(vpos);
            vpos = addVerticalOffset(vpos, localOrigin);
            gl_Position = transformPosition(proj, view, vpos);
            forwardTextureCoordinates();
          }
        `),t.include(ps,e),t.include(Nb,e),t.include(ny,e),i.code.add(b`
          void main() {
            discardBySlice(vpos);
            ${n?b`
                    vec4 texColor = texture(tex, ${e.hasColorTextureTransform?b`colorUV`:b`vuv0`});
                    discardOrAdjustAlpha(texColor);`:""}
            outputHighlight();
          }
        `)}}function tCe(t,e){const r=t.fragment;e.hasVertexTangents?(t.attributes.add(E.TANGENT,"vec4"),t.varyings.add("vTangent","vec4"),e.doubleSidedMode===Ji.WindingOrder?r.code.add(b`mat3 computeTangentSpace(vec3 normal) {
float tangentHeadedness = gl_FrontFacing ? vTangent.w : -vTangent.w;
vec3 tangent = normalize(gl_FrontFacing ? vTangent.xyz : -vTangent.xyz);
vec3 bitangent = cross(normal, tangent) * tangentHeadedness;
return mat3(tangent, bitangent, normal);
}`):r.code.add(b`mat3 computeTangentSpace(vec3 normal) {
float tangentHeadedness = vTangent.w;
vec3 tangent = normalize(vTangent.xyz);
vec3 bitangent = cross(normal, tangent) * tangentHeadedness;
return mat3(tangent, bitangent, normal);
}`)):r.code.add(b`mat3 computeTangentSpace(vec3 normal, vec3 pos, vec2 st) {
vec3 Q1 = dFdx(pos);
vec3 Q2 = dFdy(pos);
vec2 stx = dFdx(st);
vec2 sty = dFdy(st);
float det = stx.t * sty.s - sty.t * stx.s;
vec3 T = stx.t * Q2 - sty.t * Q1;
T = T - normal * dot(normal, T);
T *= inversesqrt(max(dot(T,T), 1.e-10));
vec3 B = sign(det) * cross(normal, T);
return mat3(T, B, normal);
}`),e.textureCoordinateType!==Ps.None&&(t.include(MX,e),r.uniforms.add(e.pbrTextureBindType===Qr.Pass?new Je("normalTexture",i=>i.textureNormal):new bh("normalTexture",i=>i.textureNormal)),r.code.add(b`vec3 computeTextureNormal(mat3 tangentSpace, vec2 uv) {
vec3 rawNormal = textureLookup(normalTexture, uv).rgb * 2.0 - 1.0;
return tangentSpace * rawNormal;
}`))}function fP(t,e){const r=t.fragment;e.receiveAmbientOcclusion?(r.uniforms.add(new Je("ssaoTex",(i,s)=>s.ssaoHelper.colorTexture)),r.constants.add("blurSizePixelsInverse","float",1/QA),r.code.add(b`float evaluateAmbientOcclusionInverse() {
vec2 ssaoTextureSizeInverse = 1.0 / vec2(textureSize(ssaoTex, 0));
return texture(ssaoTex, gl_FragCoord.xy * blurSizePixelsInverse * ssaoTextureSizeInverse).a;
}
float evaluateAmbientOcclusion() {
return 1.0 - evaluateAmbientOcclusionInverse();
}`)):r.code.add(b`float evaluateAmbientOcclusionInverse() { return 1.0; }
float evaluateAmbientOcclusion() { return 0.0; }`)}function mP(t){t.constants.add("ambientBoostFactor","float",sxe)}function SE(t){t.uniforms.add(new Re("lightingGlobalFactor",(e,r)=>r.lighting.globalFactor))}function _w(t,e){const r=t.fragment;switch(t.include(fP,e),e.pbrMode!==st.Disabled&&t.include(tJ,e),t.include(LX,e),t.include(YR),r.code.add(b`
    const float GAMMA_SRGB = 2.1;
    const float INV_GAMMA_SRGB = 0.4761904;
    ${e.pbrMode===st.Disabled?"":"const vec3 GROUND_REFLECTANCE = vec3(0.2);"}
  `),mP(r),SE(r),Jg(r),r.code.add(b`
    float additionalDirectedAmbientLight(vec3 vPosWorld) {
      float vndl = dot(${e.spherical?b`normalize(vPosWorld)`:b`vec3(0.0, 0.0, 1.0)`}, mainLightDirection);
      return smoothstep(0.0, 1.0, clamp(vndl * 2.5, 0.0, 1.0));
    }
  `),im(r),r.code.add(b`vec3 evaluateAdditionalLighting(float ambientOcclusion, vec3 vPosWorld) {
float additionalAmbientScale = additionalDirectedAmbientLight(vPosWorld);
return (1.0 - ambientOcclusion) * additionalAmbientScale * ambientBoostFactor * lightingGlobalFactor * mainLightIntensity;
}`),e.pbrMode){case st.Disabled:case st.WaterOnIntegratedMesh:case st.Water:t.include(KN),r.code.add(b`vec3 evaluateSceneLighting(vec3 normalWorld, vec3 albedo, float shadow, float ssao, vec3 additionalLight)
{
vec3 mainLighting = evaluateMainLighting(normalWorld, shadow);
vec3 ambientLighting = calculateAmbientIrradiance(normalWorld, ssao);
vec3 albedoLinear = pow(albedo, vec3(GAMMA_SRGB));
vec3 totalLight = mainLighting + ambientLighting + additionalLight;
totalLight = min(totalLight, vec3(PI));
vec3 outColor = vec3((albedoLinear / PI) * totalLight);
return pow(outColor, vec3(INV_GAMMA_SRGB));
}`);break;case st.Normal:case st.Schematic:r.code.add(b`const float fillLightIntensity = 0.25;
const float horizonLightDiffusion = 0.4;
const float additionalAmbientIrradianceFactor = 0.02;
vec3 evaluateSceneLightingPBR(vec3 normal, vec3 albedo, float shadow, float ssao, vec3 additionalLight, vec3 viewDir, vec3 normalGround, vec3 mrr, vec3 _emission, float additionalAmbientIrradiance)
{
vec3 viewDirection = -viewDir;
vec3 h = normalize(viewDirection + mainLightDirection);
PBRShadingInfo inputs;
inputs.NdotL = clamp(dot(normal, mainLightDirection), 0.001, 1.0);
inputs.NdotV = clamp(abs(dot(normal, viewDirection)), 0.001, 1.0);
inputs.NdotH = clamp(dot(normal, h), 0.0, 1.0);
inputs.VdotH = clamp(dot(viewDirection, h), 0.0, 1.0);
inputs.NdotNG = clamp(dot(normal, normalGround), -1.0, 1.0);
vec3 reflectedView = normalize(reflect(viewDirection, normal));
inputs.RdotNG = clamp(dot(reflectedView, normalGround), -1.0, 1.0);
inputs.albedoLinear = pow(albedo, vec3(GAMMA_SRGB));
inputs.ssao = ssao;
inputs.metalness = mrr[0];
inputs.roughness = clamp(mrr[1] * mrr[1], 0.001, 0.99);`),r.code.add(b`inputs.f0 = (0.16 * mrr[2] * mrr[2]) * (1.0 - inputs.metalness) + inputs.albedoLinear * inputs.metalness;
inputs.f90 = vec3(clamp(dot(inputs.f0, vec3(50.0 * 0.33)), 0.0, 1.0));
inputs.diffuseColor = inputs.albedoLinear * (vec3(1.0) - inputs.f0) * (1.0 - inputs.metalness);`),e.useFillLights?r.uniforms.add(new Mf("hasFillLights",(i,s)=>s.enableFillLights)):r.constants.add("hasFillLights","bool",!1),r.code.add(b`vec3 ambientDir = vec3(5.0 * normalGround[1] - normalGround[0] * normalGround[2], - 5.0 * normalGround[0] - normalGround[2] * normalGround[1], normalGround[1] * normalGround[1] + normalGround[0] * normalGround[0]);
ambientDir = ambientDir != vec3(0.0)? normalize(ambientDir) : normalize(vec3(5.0, -1.0, 0.0));
inputs.NdotAmbDir = hasFillLights ? abs(dot(normal, ambientDir)) : 1.0;
vec3 mainLightIrradianceComponent = inputs.NdotL * (1.0 - shadow) * mainLightIntensity;
vec3 fillLightsIrradianceComponent = inputs.NdotAmbDir * mainLightIntensity * fillLightIntensity;
vec3 ambientLightIrradianceComponent = calculateAmbientIrradiance(normal, ssao) + additionalLight;
inputs.skyIrradianceToSurface = ambientLightIrradianceComponent + mainLightIrradianceComponent + fillLightsIrradianceComponent ;
inputs.groundIrradianceToSurface = GROUND_REFLECTANCE * ambientLightIrradianceComponent + mainLightIrradianceComponent + fillLightsIrradianceComponent ;`),r.uniforms.add(new Re("lightingSpecularStrength",(i,s)=>s.lighting.mainLight.specularStrength),new Re("lightingEnvironmentStrength",(i,s)=>s.lighting.mainLight.environmentStrength)),r.code.add(b`vec3 horizonRingDir = inputs.RdotNG * normalGround - reflectedView;
vec3 horizonRingH = normalize(viewDirection + horizonRingDir);
inputs.NdotH_Horizon = dot(normal, horizonRingH);
vec3 mainLightRadianceComponent = lightingSpecularStrength * normalDistribution(inputs.NdotH, inputs.roughness) * mainLightIntensity * (1.0 - shadow);
vec3 horizonLightRadianceComponent = lightingEnvironmentStrength * normalDistribution(inputs.NdotH_Horizon, min(inputs.roughness + horizonLightDiffusion, 1.0)) * mainLightIntensity * fillLightIntensity;
vec3 ambientLightRadianceComponent = lightingEnvironmentStrength * calculateAmbientRadiance(ssao) + additionalLight;
inputs.skyRadianceToSurface = ambientLightRadianceComponent + mainLightRadianceComponent + horizonLightRadianceComponent;
inputs.groundRadianceToSurface = GROUND_REFLECTANCE * (ambientLightRadianceComponent + horizonLightRadianceComponent) + mainLightRadianceComponent;
inputs.averageAmbientRadiance = ambientLightIrradianceComponent[1] * (1.0 + GROUND_REFLECTANCE[1]);`),r.code.add(b`
        vec3 reflectedColorComponent = evaluateEnvironmentIllumination(inputs);
        vec3 additionalMaterialReflectanceComponent = inputs.albedoLinear * additionalAmbientIrradiance;
        vec3 emissionComponent = pow(_emission, vec3(GAMMA_SRGB));
        vec3 outColorLinear = reflectedColorComponent + additionalMaterialReflectanceComponent + emissionComponent;
        ${e.pbrMode===st.Schematic?b`vec3 outColor = pow(max(vec3(0.0), outColorLinear - 0.005 * inputs.averageAmbientRadiance), vec3(INV_GAMMA_SRGB));`:b`vec3 outColor = pow(blackLevelSoftCompression(outColorLinear, inputs), vec3(INV_GAMMA_SRGB));`}
        return outColor;
      }
    `);break;case st.Terrain:case st.TerrainWithWater:t.include(KN),r.code.add(b`const float roughnessTerrain = 0.5;
const float specularityTerrain = 0.5;
const vec3 fresnelReflectionTerrain = vec3(0.04);
vec3 evaluateTerrainLighting(vec3 n, vec3 c, float shadow, float ssao, vec3 al, vec3 vd, vec3 nup) {
vec3 viewDirection = -vd;
vec3 h = normalize(viewDirection + mainLightDirection);
float NdotL = clamp(dot(n, mainLightDirection), 0.001, 1.0);
float NdotV = clamp(abs(dot(n, viewDirection)), 0.001, 1.0);
float NdotH = clamp(dot(n, h), 0.0, 1.0);
float NdotNG = clamp(dot(n, nup), -1.0, 1.0);
vec3 albedoLinear = pow(c, vec3(GAMMA_SRGB));
float lightness = 0.3 * albedoLinear[0] + 0.5 * albedoLinear[1] + 0.2 * albedoLinear[2];
vec3 f0 = (0.85 * lightness + 0.15) * fresnelReflectionTerrain;
vec3 f90 =  vec3(clamp(dot(f0, vec3(50.0 * 0.33)), 0.0, 1.0));
vec3 mainLightIrradianceComponent = (1. - shadow) * NdotL * mainLightIntensity;
vec3 ambientLightIrradianceComponent = calculateAmbientIrradiance(n, ssao) + al;
vec3 ambientSky = ambientLightIrradianceComponent + mainLightIrradianceComponent;
vec3 indirectDiffuse = ((1.0 - NdotNG) * mainLightIrradianceComponent + (1.0 + NdotNG ) * ambientSky) * 0.5;
vec3 outDiffColor = albedoLinear * (1.0 - f0) * indirectDiffuse / PI;
vec3 mainLightRadianceComponent = normalDistribution(NdotH, roughnessTerrain) * mainLightIntensity;
vec2 dfg = prefilteredDFGAnalytical(roughnessTerrain, NdotV);
vec3 specularColor = f0 * dfg.x + f90 * dfg.y;
vec3 specularComponent = specularityTerrain * specularColor * mainLightRadianceComponent;
vec3 outColorLinear = outDiffColor + specularComponent;
vec3 outColor = pow(outColorLinear, vec3(INV_GAMMA_SRGB));
return outColor;
}`);break;default:e.pbrMode;case st.COUNT:}}function El(){const t=new Float32Array(9);return t[0]=1,t[4]=1,t[8]=1,t}function rCe(t){const e=new Float32Array(9);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e}function uD(t,e,r,i,s,n,o,a,l){const c=new Float32Array(9);return c[0]=t,c[1]=e,c[2]=r,c[3]=i,c[4]=s,c[5]=n,c[6]=o,c[7]=a,c[8]=l,c}function kct(t,e){return new Float32Array(t,e,9)}Object.freeze(Object.defineProperty({__proto__:null,clone:rCe,create:El,createView:kct,fromValues:uD},Symbol.toStringTag,{value:"Module"}));function Vct(t){t.vertex.uniforms.add(new kh("colorTextureTransformMatrix",e=>e.colorTextureTransformMatrix!=null?e.colorTextureTransformMatrix:El())),t.varyings.add("colorUV","vec2"),t.vertex.code.add(b`void forwardColorUV(){
colorUV = (colorTextureTransformMatrix * vec3(vuv0, 1.0)).xy;
}`)}function zct(t){t.vertex.uniforms.add(new kh("normalTextureTransformMatrix",e=>e.normalTextureTransformMatrix!=null?e.normalTextureTransformMatrix:El())),t.varyings.add("normalUV","vec2"),t.vertex.code.add(b`void forwardNormalUV(){
normalUV = (normalTextureTransformMatrix * vec3(vuv0, 1.0)).xy;
}`)}function Bct(t){t.vertex.uniforms.add(new kh("emissiveTextureTransformMatrix",e=>e.emissiveTextureTransformMatrix!=null?e.emissiveTextureTransformMatrix:El())),t.varyings.add("emissiveUV","vec2"),t.vertex.code.add(b`void forwardEmissiveUV(){
emissiveUV = (emissiveTextureTransformMatrix * vec3(vuv0, 1.0)).xy;
}`)}function Gct(t){t.vertex.uniforms.add(new kh("occlusionTextureTransformMatrix",e=>e.occlusionTextureTransformMatrix!=null?e.occlusionTextureTransformMatrix:El())),t.varyings.add("occlusionUV","vec2"),t.vertex.code.add(b`void forwardOcclusionUV(){
occlusionUV = (occlusionTextureTransformMatrix * vec3(vuv0, 1.0)).xy;
}`)}function jct(t){t.vertex.uniforms.add(new kh("metallicRoughnessTextureTransformMatrix",e=>e.metallicRoughnessTextureTransformMatrix!=null?e.metallicRoughnessTextureTransformMatrix:El())),t.varyings.add("metallicRoughnessUV","vec2"),t.vertex.code.add(b`void forwardMetallicRoughnessUV(){
metallicRoughnessUV = (metallicRoughnessTextureTransformMatrix * vec3(vuv0, 1.0)).xy;
}`)}function aR(t){t.include(sm),t.code.add(b`
    vec3 mixExternalColor(vec3 internalColor, vec3 textureColor, vec3 externalColor, int mode) {
      // workaround for artifacts in OSX using Intel Iris Pro
      // see: https://devtopia.esri.com/WebGIS/arcgis-js-api/issues/10475
      vec3 internalMixed = internalColor * textureColor;
      vec3 allMixed = internalMixed * externalColor;

      if (mode == ${b.int(Us.Multiply)}) {
        return allMixed;
      }
      if (mode == ${b.int(Us.Ignore)}) {
        return internalMixed;
      }
      if (mode == ${b.int(Us.Replace)}) {
        return externalColor;
      }

      // tint (or something invalid)
      float vIn = rgb2v(internalMixed);
      vec3 hsvTint = rgb2hsv(externalColor);
      vec3 hsvOut = vec3(hsvTint.x, hsvTint.y, vIn * hsvTint.z);
      return hsv2rgb(hsvOut);
    }

    float mixExternalOpacity(float internalOpacity, float textureOpacity, float externalOpacity, int mode) {
      // workaround for artifacts in OSX using Intel Iris Pro
      // see: https://devtopia.esri.com/WebGIS/arcgis-js-api/issues/10475
      float internalMixed = internalOpacity * textureOpacity;
      float allMixed = internalMixed * externalOpacity;

      if (mode == ${b.int(Us.Ignore)}) {
        return internalMixed;
      }
      if (mode == ${b.int(Us.Replace)}) {
        return externalOpacity;
      }

      // multiply or tint (or something invalid)
      return allMixed;
    }
  `)}function Hct(t){const e=new wr,{vertex:r,fragment:i,varyings:s}=e;if(vc(r,t),e.include(JR),s.add("vpos","vec3"),e.include(Sg,t),e.include(YEe,t),e.include(dSe,t),t.hasColorTextureTransform&&e.include(Vct),t.output===N.Color||t.output===N.Alpha){t.hasNormalTextureTransform&&e.include(zct),t.hasEmissionTextureTransform&&e.include(Bct),t.hasOcclusionTextureTransform&&e.include(Gct),t.hasMetallicRoughnessTextureTransform&&e.include(jct),up(r,t),e.include(dP,t),e.include(xl,t);const n=t.normalType===Or.Attribute||t.normalType===Or.Compressed;n&&t.offsetBackfaces&&e.include(XEe),e.include(tCe,t),e.include(b6,t),t.instancedColor&&e.attributes.add(E.INSTANCECOLOR,"vec4"),s.add("vPositionLocal","vec3"),e.include(Pf,t),e.include(mE,t),e.include(QEe,t),e.include(Bw,t),r.uniforms.add(new sr("externalColor",a=>a.externalColor)),s.add("vcolorExt","vec4"),t.hasMultipassTerrain&&s.add("depth","float");const o=t.hasModelTransformation;if(o){const a=Li();r.uniforms.add(new $i("model",l=>l.modelTransformation??un)),r.uniforms.add(new kh("normalTransform",l=>(L_(a,l.modelTransformation??un),a)))}r.code.add(b`
      void main(void) {
        forwardNormalizedVertexColor();
        vcolorExt = externalColor;
        ${t.instancedColor?"vcolorExt *= instanceColor * 0.003921568627451;":""}
        vcolorExt *= vvColor();
        vcolorExt *= getSymbolColor();
        forwardColorMixMode();

        if (vcolorExt.a < ${b.float(go)}) {
          gl_Position = vec4(1e38, 1e38, 1e38, 1.0);
        } else {
          vpos = calculateVPos();
          ${o?"vpos = (model * vec4(vpos, 1.0)).xyz;":""}
          vPositionLocal = vpos - view[3].xyz;
          vpos = subtractOrigin(vpos);
          ${n?b`vNormalWorld = ${o?"normalize(normalTransform * dpNormal(vvLocalNormal(normalModel())))":"dpNormal(vvLocalNormal(normalModel()))"};`:""}
          vpos = addVerticalOffset(vpos, localOrigin);
          ${t.hasVertexTangents?"vTangent = dpTransformVertexTangent(tangent);":""}
          gl_Position = transformPosition(proj, view, vpos);
          ${n&&t.offsetBackfaces?"gl_Position = offsetBackfacingClipPosition(gl_Position, vpos, vNormalWorld, cameraPosition);":""}
        }

        ${t.hasMultipassTerrain?"depth = (view * vec4(vpos, 1.0)).z;":""}
        forwardLinearDepth();
        forwardTextureCoordinates();
        ${t.hasColorTextureTransform?b`forwardColorUV();`:""}
        ${t.hasNormalTextureTransform?b`forwardNormalUV();`:""}
        ${t.hasEmissionTextureTransform?b`forwardEmissiveUV();`:""}
        ${t.hasOcclusionTextureTransform?b`forwardOcclusionUV();`:""}
        ${t.hasMetallicRoughnessTextureTransform?b`forwardMetallicRoughnessUV();`:""}
      }
    `)}switch(t.output){case N.Alpha:e.include(ps,t),e.include(Nb,t),e.include(vu,t),i.uniforms.add(new Re("opacity",n=>n.opacity),new Re("layerOpacity",n=>n.layerOpacity)),t.hasColorTexture&&i.uniforms.add(new Je("tex",n=>n.texture)),i.include(aR),i.code.add(b`
      void main() {
        discardBySlice(vpos);
        ${t.hasMultipassTerrain?"terrainDepthTest(gl_FragCoord, depth);":""}
        ${t.hasColorTexture?b`
                vec4 texColor = texture(tex, ${t.hasColorTextureTransform?b`colorUV`:b`vuv0`});
                ${t.textureAlphaPremultiplied?"texColor.rgb /= texColor.a;":""}
                discardOrAdjustAlpha(texColor);`:b`vec4 texColor = vec4(1.0);`}
        ${t.hasVertexColors?b`float opacity_ = layerOpacity * mixExternalOpacity(vColor.a * opacity, texColor.a, vcolorExt.a, int(colorMixMode));`:b`float opacity_ = layerOpacity * mixExternalOpacity(opacity, texColor.a, vcolorExt.a, int(colorMixMode));`}
        fragColor = vec4(opacity_);
      }
    `);break;case N.Color:e.include(ps,t),e.include(_w,t),e.include(fP,t),e.include(Nb,t),e.include(t.instancedDoublePrecision?w6:gw,t),e.include(vu,t),up(i,t),i.uniforms.add(r.uniforms.get("localOrigin"),new Ft("ambient",n=>n.ambient),new Ft("diffuse",n=>n.diffuse),new Re("opacity",n=>n.opacity),new Re("layerOpacity",n=>n.layerOpacity)),t.hasColorTexture&&i.uniforms.add(new Je("tex",n=>n.texture)),e.include($X,t),e.include(tJ,t),i.include(aR),e.include(WEe,t),mP(i),SE(i),im(i),i.code.add(b`
      void main() {
        discardBySlice(vpos);
        ${t.hasMultipassTerrain?"terrainDepthTest(gl_FragCoord, depth);":""}
        ${t.hasColorTexture?b`
                vec4 texColor = texture(tex, ${t.hasColorTextureTransform?b`colorUV`:b`vuv0`});
                ${t.textureAlphaPremultiplied?"texColor.rgb /= texColor.a;":""}
                discardOrAdjustAlpha(texColor);`:b`vec4 texColor = vec4(1.0);`}
        shadingParams.viewDirection = normalize(vpos - cameraPosition);
        ${t.normalType===Or.ScreenDerivative?b`
                vec3 normal = screenDerivativeNormal(vPositionLocal);`:b`
                shadingParams.normalView = vNormalWorld;
                vec3 normal = shadingNormal(shadingParams);`}
        ${t.pbrMode===st.Normal?"applyPBRFactors();":""}
        float ssao = evaluateAmbientOcclusionInverse();
        ssao *= getBakedOcclusion();

        vec3 posWorld = vpos + localOrigin;

        float additionalAmbientScale = additionalDirectedAmbientLight(posWorld);
        float shadow = ${t.receiveShadows?"readShadowMap(vpos, linearDepth)":t.spherical?"lightingGlobalFactor * (1.0 - additionalAmbientScale)":"0.0"};

        vec3 matColor = max(ambient, diffuse);
        ${t.hasVertexColors?b`
                vec3 albedo = mixExternalColor(vColor.rgb * matColor, texColor.rgb, vcolorExt.rgb, int(colorMixMode));
                float opacity_ = layerOpacity * mixExternalOpacity(vColor.a * opacity, texColor.a, vcolorExt.a, int(colorMixMode));`:b`
                vec3 albedo = mixExternalColor(matColor, texColor.rgb, vcolorExt.rgb, int(colorMixMode));
                float opacity_ = layerOpacity * mixExternalOpacity(opacity, texColor.a, vcolorExt.a, int(colorMixMode));`}
        ${t.hasNormalTexture?b`
                mat3 tangentSpace = ${t.hasVertexTangents?"computeTangentSpace(normal);":"computeTangentSpace(normal, vpos, vuv0);"}
                vec3 shadingNormal = computeTextureNormal(tangentSpace, ${t.hasNormalTextureTransform?b`normalUV`:"vuv0"});`:b`vec3 shadingNormal = normal;`}
        vec3 normalGround = ${t.spherical?b`normalize(posWorld);`:b`vec3(0.0, 0.0, 1.0);`}

        ${t.snowCover?b`
                float snow = smoothstep(0.5, 0.55, dot(normal, normalGround));
                albedo = mix(albedo, vec3(1), snow);
                shadingNormal = mix(shadingNormal, normal, snow);
                ssao = mix(ssao, 1.0, snow);`:""}

        vec3 additionalLight = ssao * mainLightIntensity * additionalAmbientScale * ambientBoostFactor * lightingGlobalFactor;

        ${t.pbrMode===st.Normal||t.pbrMode===st.Schematic?b`
                float additionalAmbientIrradiance = additionalAmbientIrradianceFactor * mainLightIntensity[2];
                ${t.snowCover?b`
                        mrr = mix(mrr, vec3(0.0, 1.0, 0.04), snow);
                        emission = mix(emission, vec3(0.0), snow);`:""}

                vec3 shadedColor = evaluateSceneLightingPBR(shadingNormal, albedo, shadow, 1.0 - ssao, additionalLight, shadingParams.viewDirection, normalGround, mrr, emission, additionalAmbientIrradiance);`:b`vec3 shadedColor = evaluateSceneLighting(shadingNormal, albedo, shadow, 1.0 - ssao, additionalLight);`}
        fragColor = highlightSlice(vec4(shadedColor, opacity_), vpos);
        ${t.transparencyPassType===ot.Color?b`fragColor = premultiplyAlpha(fragColor);`:""}
      }
    `)}return e.include(eCe,t),e}const qct=Object.freeze(Object.defineProperty({__proto__:null,build:Hct},Symbol.toStringTag,{value:"Module"}));let Wct=class extends CEe{constructor(){super(...arguments),this.isSchematic=!1,this.usePBR=!1,this.mrrFactors=Fa(T6),this.hasVertexColors=!1,this.hasSymbolColors=!1,this.doubleSided=!1,this.doubleSidedType="normal",this.cullFace=pi.Back,this.isInstanced=!1,this.hasInstancedColor=!1,this.emissiveFactor=Oe(0,0,0),this.instancedDoublePrecision=!1,this.normalType=Or.Attribute,this.receiveSSAO=!0,this.receiveShadows=!0,this.castShadows=!0,this.shadowMappingEnabled=!1,this.ambient=Oe(.2,.2,.2),this.diffuse=Oe(.8,.8,.8),this.externalColor=Lt(1,1,1,1),this.colorMixMode="multiply",this.opacity=1,this.layerOpacity=1,this.origin=C(),this.hasSlicePlane=!1,this.hasSliceHighlight=!0,this.offsetTransparentBackfaces=!1,this.vvSize=null,this.vvColor=null,this.vvOpacity=null,this.vvSymbolAnchor=null,this.vvSymbolRotationMatrix=null,this.modelTransformation=null,this.transparent=!1,this.writeDepth=!0,this.customDepthTest=ow.Less,this.textureAlphaMode=Yr.Blend,this.textureAlphaCutoff=R4,this.textureAlphaPremultiplied=!1,this.hasOccludees=!1,this.renderOccluded=Mi.Occlude}},Zct=class extends AEe{constructor(){super(...arguments),this.origin=C(),this.slicePlaneLocalOrigin=this.origin}},hJ=class iCe extends Pr{initializeConfiguration(e,r){r.spherical=e.viewingMode===De.Global,r.doublePrecisionRequiresObfuscation=e.rctx.driverTest.doublePrecisionRequiresObfuscation.result,r.textureCoordinateType=r.hasColorTexture||r.hasMetallicRoughnessTexture||r.hasEmissionTexture||r.hasOcclusionTexture||r.hasNormalTexture?Ps.Default:Ps.None,r.objectAndLayerIdColorInstanced=r.instanced}initializeProgram(e){return this._initializeProgram(e,iCe.shader)}_initializeProgram(e,r){return new Cr(e.rctx,r.get().build(this.configuration),br)}_convertDepthTestFunction(e){return e===ow.Lequal?Kr.LEQUAL:Kr.LESS}_makePipeline(e,r){const i=this.configuration,s=e===ot.NONE,n=e===ot.FrontFace;return At({blending:i.output!==N.Color&&i.output!==N.Alpha||!i.transparent?null:s?uu:oy(e),culling:Xct(i)?F5(i.cullFace):null,depthTest:{func:rv(e,this._convertDepthTestFunction(i.customDepthTest))},depthWrite:(s||n)&&i.writeDepth?Ol:null,colorWrite:Vt,stencilWrite:i.hasOccludees?Wf:null,stencilTest:i.hasOccludees?r?H_:iv:null,polygonOffset:s||n?null:d6(i.enableOffset)})}initializePipeline(){return this._occludeePipelineState=this._makePipeline(this.configuration.transparencyPassType,!0),this._makePipeline(this.configuration.transparencyPassType,!1)}getPipelineState(e,r){return r?this._occludeePipelineState:super.getPipelineState(e,r)}};function Xct(t){return t.cullFace!==pi.None||!t.hasSlicePlane&&!t.transparent&&!t.doubleSidedMode}hJ.shader=new Er(qct,()=>ae(()=>import("./DefaultMaterial.glsl-49fca43c.js"),[],import.meta.url));let zt=class extends Uo{constructor(){super(...arguments),this.output=N.Color,this.alphaDiscardMode=Yr.Opaque,this.doubleSidedMode=Ji.None,this.pbrMode=st.Disabled,this.cullFace=pi.None,this.transparencyPassType=ot.NONE,this.normalType=Or.Attribute,this.textureCoordinateType=Ps.None,this.customDepthTest=ow.Less,this.spherical=!1,this.hasVertexColors=!1,this.hasSymbolColors=!1,this.hasVerticalOffset=!1,this.hasSlicePlane=!1,this.hasSliceHighlight=!0,this.hasColorTexture=!1,this.hasMetallicRoughnessTexture=!1,this.hasEmissionTexture=!1,this.hasOcclusionTexture=!1,this.hasNormalTexture=!1,this.hasScreenSizePerspective=!1,this.hasVertexTangents=!1,this.hasOccludees=!1,this.hasMultipassTerrain=!1,this.hasModelTransformation=!1,this.offsetBackfaces=!1,this.vvSize=!1,this.vvColor=!1,this.receiveShadows=!1,this.receiveAmbientOcclusion=!1,this.textureAlphaPremultiplied=!1,this.instanced=!1,this.instancedColor=!1,this.objectAndLayerIdColorInstanced=!1,this.instancedDoublePrecision=!1,this.doublePrecisionRequiresObfuscation=!1,this.writeDepth=!0,this.transparent=!1,this.enableOffset=!0,this.cullAboveGround=!1,this.snowCover=!1,this.hasColorTextureTransform=!1,this.hasEmissionTextureTransform=!1,this.hasNormalTextureTransform=!1,this.hasOcclusionTextureTransform=!1,this.hasMetallicRoughnessTextureTransform=!1}};u([B({count:N.COUNT})],zt.prototype,"output",void 0),u([B({count:Yr.COUNT})],zt.prototype,"alphaDiscardMode",void 0),u([B({count:Ji.COUNT})],zt.prototype,"doubleSidedMode",void 0),u([B({count:st.COUNT})],zt.prototype,"pbrMode",void 0),u([B({count:pi.COUNT})],zt.prototype,"cullFace",void 0),u([B({count:ot.COUNT})],zt.prototype,"transparencyPassType",void 0),u([B({count:Or.COUNT})],zt.prototype,"normalType",void 0),u([B({count:Ps.COUNT})],zt.prototype,"textureCoordinateType",void 0),u([B({count:ow.COUNT})],zt.prototype,"customDepthTest",void 0),u([B()],zt.prototype,"spherical",void 0),u([B()],zt.prototype,"hasVertexColors",void 0),u([B()],zt.prototype,"hasSymbolColors",void 0),u([B()],zt.prototype,"hasVerticalOffset",void 0),u([B()],zt.prototype,"hasSlicePlane",void 0),u([B()],zt.prototype,"hasSliceHighlight",void 0),u([B()],zt.prototype,"hasColorTexture",void 0),u([B()],zt.prototype,"hasMetallicRoughnessTexture",void 0),u([B()],zt.prototype,"hasEmissionTexture",void 0),u([B()],zt.prototype,"hasOcclusionTexture",void 0),u([B()],zt.prototype,"hasNormalTexture",void 0),u([B()],zt.prototype,"hasScreenSizePerspective",void 0),u([B()],zt.prototype,"hasVertexTangents",void 0),u([B()],zt.prototype,"hasOccludees",void 0),u([B()],zt.prototype,"hasMultipassTerrain",void 0),u([B()],zt.prototype,"hasModelTransformation",void 0),u([B()],zt.prototype,"offsetBackfaces",void 0),u([B()],zt.prototype,"vvSize",void 0),u([B()],zt.prototype,"vvColor",void 0),u([B()],zt.prototype,"receiveShadows",void 0),u([B()],zt.prototype,"receiveAmbientOcclusion",void 0),u([B()],zt.prototype,"textureAlphaPremultiplied",void 0),u([B()],zt.prototype,"instanced",void 0),u([B()],zt.prototype,"instancedColor",void 0),u([B()],zt.prototype,"objectAndLayerIdColorInstanced",void 0),u([B()],zt.prototype,"instancedDoublePrecision",void 0),u([B()],zt.prototype,"doublePrecisionRequiresObfuscation",void 0),u([B()],zt.prototype,"writeDepth",void 0),u([B()],zt.prototype,"transparent",void 0),u([B()],zt.prototype,"enableOffset",void 0),u([B()],zt.prototype,"cullAboveGround",void 0),u([B()],zt.prototype,"snowCover",void 0),u([B()],zt.prototype,"hasColorTextureTransform",void 0),u([B()],zt.prototype,"hasEmissionTextureTransform",void 0),u([B()],zt.prototype,"hasNormalTextureTransform",void 0),u([B()],zt.prototype,"hasOcclusionTextureTransform",void 0),u([B()],zt.prototype,"hasMetallicRoughnessTextureTransform",void 0),u([B({constValue:!0})],zt.prototype,"hasVvInstancing",void 0),u([B({constValue:!1})],zt.prototype,"useCustomDTRExponentForWater",void 0),u([B({constValue:!1})],zt.prototype,"supportsTextureAtlas",void 0),u([B({constValue:!0})],zt.prototype,"useFillLights",void 0);function Yct(t){const e=new wr,{vertex:r,fragment:i,varyings:s}=e;return vc(r,t),e.include(JR),s.add("vpos","vec3"),e.include(Sg,t),e.include(YEe,t),e.include(dSe,t),t.output!==N.Color&&t.output!==N.Alpha||(up(e.vertex,t),e.include(dP,t),e.include(xl,t),t.offsetBackfaces&&e.include(XEe),t.instancedColor&&e.attributes.add(E.INSTANCECOLOR,"vec4"),s.add("vNormalWorld","vec3"),s.add("localvpos","vec3"),t.hasMultipassTerrain&&s.add("depth","float"),e.include(Pf,t),e.include(mE,t),e.include(QEe,t),e.include(Bw,t),r.uniforms.add(new sr("externalColor",n=>n.externalColor)),s.add("vcolorExt","vec4"),r.code.add(b`
        void main(void) {
          forwardNormalizedVertexColor();
          vcolorExt = externalColor;
          ${t.instancedColor?"vcolorExt *= instanceColor * 0.003921568627451;":""}
          vcolorExt *= vvColor();
          vcolorExt *= getSymbolColor();
          forwardColorMixMode();

          if (vcolorExt.a < ${b.float(go)}) {
            gl_Position = vec4(1e38, 1e38, 1e38, 1.0);
          } else {
            vpos = calculateVPos();
            localvpos = vpos - view[3].xyz;
            vpos = subtractOrigin(vpos);
            vNormalWorld = dpNormal(vvLocalNormal(normalModel()));
            vpos = addVerticalOffset(vpos, localOrigin);
            gl_Position = transformPosition(proj, view, vpos);
            ${t.offsetBackfaces?"gl_Position = offsetBackfacingClipPosition(gl_Position, vpos, vNormalWorld, cameraPosition);":""}
          }
          ${t.hasMultipassTerrain?b`depth = (view * vec4(vpos, 1.0)).z;`:""}
          forwardLinearDepth();
          forwardTextureCoordinates();
        }
      `)),t.output===N.Alpha&&(e.include(ps,t),e.include(Nb,t),e.include(vu,t),i.uniforms.add(new Re("opacity",n=>n.opacity),new Re("layerOpacity",n=>n.layerOpacity)),t.hasColorTexture&&i.uniforms.add(new Je("tex",n=>n.texture)),i.include(aR),i.code.add(b`
      void main() {
        discardBySlice(vpos);
        ${t.hasMultipassTerrain?b`terrainDepthTest(gl_FragCoord, depth);`:""}
        ${t.hasColorTexture?b`
                vec4 texColor = texture(tex, ${t.hasColorTextureTransform?b`colorUV`:b`vuv0`});
                ${t.textureAlphaPremultiplied?"texColor.rgb /= texColor.a;":""}
                discardOrAdjustAlpha(texColor);`:b`vec4 texColor = vec4(1.0);`}
        ${t.hasVertexColors?b`float opacity_ = layerOpacity * mixExternalOpacity(vColor.a * opacity, texColor.a, vcolorExt.a, int(colorMixMode));`:b`float opacity_ = layerOpacity * mixExternalOpacity(opacity, texColor.a, vcolorExt.a, int(colorMixMode));`}

        fragColor = vec4(opacity_);
      }
    `)),t.output===N.Color&&(e.include(ps,t),e.include(_w,t),e.include(fP,t),e.include(Nb,t),e.include(t.instancedDoublePrecision?w6:gw,t),e.include(vu,t),up(e.fragment,t),Jg(i),mP(i),SE(i),i.uniforms.add(r.uniforms.get("localOrigin"),r.uniforms.get("view"),new Ft("ambient",n=>n.ambient),new Ft("diffuse",n=>n.diffuse),new Re("opacity",n=>n.opacity),new Re("layerOpacity",n=>n.layerOpacity)),t.hasColorTexture&&i.uniforms.add(new Je("tex",n=>n.texture)),e.include($X,t),e.include(tJ,t),i.include(aR),im(i),i.code.add(b`
      void main() {
        discardBySlice(vpos);
        ${t.hasMultipassTerrain?b`terrainDepthTest(gl_FragCoord, depth);`:""}
        ${t.hasColorTexture?b`
                vec4 texColor = texture(tex, ${t.hasColorTextureTransform?b`colorUV`:b`vuv0`});
                ${t.textureAlphaPremultiplied?"texColor.rgb /= texColor.a;":""}
                discardOrAdjustAlpha(texColor);`:b`vec4 texColor = vec4(1.0);`}
        vec3 viewDirection = normalize(vpos - cameraPosition);
        ${t.pbrMode===st.Normal?"applyPBRFactors();":""}
        float ssao = evaluateAmbientOcclusionInverse();
        ssao *= getBakedOcclusion();

        float additionalAmbientScale = additionalDirectedAmbientLight(vpos + localOrigin);
        vec3 additionalLight = ssao * mainLightIntensity * additionalAmbientScale * ambientBoostFactor * lightingGlobalFactor;
        ${t.receiveShadows?"float shadow = readShadowMap(vpos, linearDepth);":t.spherical?"float shadow = lightingGlobalFactor * (1.0 - additionalAmbientScale);":"float shadow = 0.0;"}
        vec3 matColor = max(ambient, diffuse);
        ${t.hasVertexColors?b`
                vec3 albedo = mixExternalColor(vColor.rgb * matColor, texColor.rgb, vcolorExt.rgb, int(colorMixMode));
                float opacity_ = layerOpacity * mixExternalOpacity(vColor.a * opacity, texColor.a, vcolorExt.a, int(colorMixMode));`:b`
                vec3 albedo = mixExternalColor(matColor, texColor.rgb, vcolorExt.rgb, int(colorMixMode));
                float opacity_ = layerOpacity * mixExternalOpacity(opacity, texColor.a, vcolorExt.a, int(colorMixMode));`}
        ${t.snowCover?b`albedo = mix(albedo, vec3(1), 0.9);`:b``}
        ${b`
            vec3 shadingNormal = normalize(vNormalWorld);
            albedo *= 1.2;
            vec3 viewForward = vec3(view[0][2], view[1][2], view[2][2]);
            float alignmentLightView = clamp(dot(viewForward, -mainLightDirection), 0.0, 1.0);
            float transmittance = 1.0 - clamp(dot(viewForward, shadingNormal), 0.0, 1.0);
            float treeRadialFalloff = vColor.r;
            float backLightFactor = 0.5 * treeRadialFalloff * alignmentLightView * transmittance * (1.0 - shadow);
            additionalLight += backLightFactor * mainLightIntensity;`}
        ${t.pbrMode===st.Normal||t.pbrMode===st.Schematic?t.spherical?b`vec3 normalGround = normalize(vpos + localOrigin);`:b`vec3 normalGround = vec3(0.0, 0.0, 1.0);`:b``}
        ${t.pbrMode===st.Normal||t.pbrMode===st.Schematic?b`
                float additionalAmbientIrradiance = additionalAmbientIrradianceFactor * mainLightIntensity[2];
                ${t.snowCover?b`
                        mrr = vec3(0.0, 1.0, 0.04);
                        emission = vec3(0.0);`:""}

                vec3 shadedColor = evaluateSceneLightingPBR(shadingNormal, albedo, shadow, 1.0 - ssao, additionalLight, viewDirection, normalGround, mrr, emission, additionalAmbientIrradiance);`:b`vec3 shadedColor = evaluateSceneLighting(shadingNormal, albedo, shadow, 1.0 - ssao, additionalLight);`}
        fragColor = highlightSlice(vec4(shadedColor, opacity_), vpos);
        ${t.transparencyPassType===ot.Color?b`fragColor = premultiplyAlpha(fragColor);`:b``}
      }
    `)),e.include(eCe,t),e}const Jct=Object.freeze(Object.defineProperty({__proto__:null,build:Yct},Symbol.toStringTag,{value:"Module"}));let sCe=class nCe extends hJ{initializeConfiguration(e,r){super.initializeConfiguration(e,r),r.hasMetallicRoughnessTexture=!1,r.hasEmissionTexture=!1,r.hasOcclusionTexture=!1,r.hasNormalTexture=!1,r.hasModelTransformation=!1,r.normalType=Or.Attribute,r.doubleSidedMode=Ji.WindingOrder,r.hasVertexTangents=!1}initializeProgram(e){return this._initializeProgram(e,nCe.shader)}};sCe.shader=new Er(Jct,()=>ae(()=>import("./RealisticTree.glsl-43a66ea8.js"),[],import.meta.url));let Zf=class extends tv{constructor(e){super(e,eut),this.supportsEdges=!0,this._configuration=new zt,this._vertexBufferLayout=tut(this.parameters)}isVisibleForOutput(e){return e!==N.Shadow&&e!==N.ShadowExcludeHighlight&&e!==N.ShadowHighlight||this.parameters.castShadows}isVisible(){const e=this.parameters;if(!super.isVisible()||e.layerOpacity===0)return!1;const{hasInstancedColor:r,hasVertexColors:i,hasSymbolColors:s,vvColor:n}=e,o=e.colorMixMode==="replace",a=e.opacity>0,l=e.externalColor&&e.externalColor[3]>0,c=r||n||s;return i&&c?o||a:i?o?l:a:c?o||a:o?l:a}getConfiguration(e,r){return this._configuration.output=e,this._configuration.hasNormalTexture=!!this.parameters.normalTextureId,this._configuration.hasColorTexture=!!this.parameters.textureId,this._configuration.hasVertexTangents=this.parameters.hasVertexTangents,this._configuration.instanced=this.parameters.isInstanced,this._configuration.instancedDoublePrecision=this.parameters.instancedDoublePrecision,this._configuration.vvSize=!!this.parameters.vvSize,this._configuration.hasVerticalOffset=this.parameters.verticalOffset!=null,this._configuration.hasScreenSizePerspective=this.parameters.screenSizePerspective!=null,this._configuration.hasSlicePlane=this.parameters.hasSlicePlane,this._configuration.hasSliceHighlight=this.parameters.hasSliceHighlight,this._configuration.alphaDiscardMode=this.parameters.textureAlphaMode,this._configuration.normalType=this.parameters.normalType,this._configuration.transparent=this.parameters.transparent,this._configuration.writeDepth=this.parameters.writeDepth,this.parameters.customDepthTest!=null&&(this._configuration.customDepthTest=this.parameters.customDepthTest),this._configuration.hasOccludees=this.parameters.hasOccludees,this._configuration.cullFace=this.parameters.hasSlicePlane?pi.None:this.parameters.cullFace,this._configuration.hasMultipassTerrain=r.multipassTerrain.enabled,this._configuration.cullAboveGround=r.multipassTerrain.cullAboveGround,this._configuration.hasModelTransformation=this.parameters.modelTransformation!=null,e!==N.Color&&e!==N.Alpha||(this._configuration.hasVertexColors=this.parameters.hasVertexColors,this._configuration.hasSymbolColors=this.parameters.hasSymbolColors,this.parameters.treeRendering?this._configuration.doubleSidedMode=Ji.WindingOrder:this._configuration.doubleSidedMode=this.parameters.doubleSided&&this.parameters.doubleSidedType==="normal"?Ji.View:this.parameters.doubleSided&&this.parameters.doubleSidedType==="winding-order"?Ji.WindingOrder:Ji.None,this._configuration.instancedColor=this.parameters.hasInstancedColor,this._configuration.receiveShadows=this.parameters.receiveShadows&&this.parameters.shadowMappingEnabled,this._configuration.receiveAmbientOcclusion=!!r.ssaoHelper.active&&this.parameters.receiveSSAO,this._configuration.vvColor=!!this.parameters.vvColor,this._configuration.textureAlphaPremultiplied=!!this.parameters.textureAlphaPremultiplied,this._configuration.pbrMode=this.parameters.usePBR?this.parameters.isSchematic?st.Schematic:st.Normal:st.Disabled,this._configuration.hasMetallicRoughnessTexture=!!this.parameters.metallicRoughnessTextureId,this._configuration.hasEmissionTexture=!!this.parameters.emissiveTextureId,this._configuration.hasOcclusionTexture=!!this.parameters.occlusionTextureId,this._configuration.offsetBackfaces=!(!this.parameters.transparent||!this.parameters.offsetTransparentBackfaces),this._configuration.transparencyPassType=r.transparencyPassType,this._configuration.enableOffset=r.camera.relativeElevation<u6,this._configuration.snowCover=this.hasSnowCover(r),this._configuration.hasColorTextureTransform=!!this.parameters.colorTextureTransformMatrix,this._configuration.hasNormalTextureTransform=!!this.parameters.normalTextureTransformMatrix,this._configuration.hasEmissionTextureTransform=!!this.parameters.emissiveTextureTransformMatrix,this._configuration.hasOcclusionTextureTransform=!!this.parameters.occlusionTextureTransformMatrix,this._configuration.hasMetallicRoughnessTextureTransform=!!this.parameters.metallicRoughnessTextureTransformMatrix),this._configuration}hasSnowCover(e){return e.weather!=null&&e.weatherVisible&&e.weather.type==="snowy"&&e.weather.snowCover==="enabled"}intersect(e,r,i,s,n,o){if(this.parameters.verticalOffset!=null){const a=i.camera;se(E9,r[12],r[13],r[14]);let l=null;switch(i.viewingMode){case De.Global:l=me(Aoe,E9);break;case De.Local:l=ie(Aoe,sut)}let c=0;const h=he(nut,E9,a.eye),p=Ce(h),f=te(h,h,1/p);let m=null;this.parameters.screenSizePerspective&&(m=fe(l,f)),c+=vSe(a,p,this.parameters.verticalOffset,m??0,this.parameters.screenSizePerspective),te(l,l,c),hc(S9,l,i.transform.inverseRotation),s=he(rut,s,S9),n=he(iut,n,S9)}mSe(e,i,s,n,zj(i.verticalOffset),o)}requiresSlot(e,r){return r===N.Color||r===N.Alpha||r===N.Depth||r===N.Normal||r===N.Shadow||r===N.ShadowHighlight||r===N.ShadowExcludeHighlight||r===N.Highlight||r===N.ObjectAndLayerIdColor?e===(this.parameters.transparent?this.parameters.writeDepth?ue.TRANSPARENT_MATERIAL:ue.TRANSPARENT_DEPTH_WRITE_DISABLED_MATERIAL:ue.OPAQUE_MATERIAL)||e===ue.DRAPED_MATERIAL:!1}createGLMaterial(e){return new Qct(e)}createBufferWriter(){return new TE(this._vertexBufferLayout)}},Qct=class extends IX{constructor(e){super({...e,...e.material.parameters})}_updateShadowState(e){e.shadowMap.enabled!==this._material.parameters.shadowMappingEnabled&&this._material.setParameters({shadowMappingEnabled:e.shadowMap.enabled})}_updateOccludeeState(e){e.hasOccludees!==this._material.parameters.hasOccludees&&this._material.setParameters({hasOccludees:e.hasOccludees})}beginSlot(e){this._output!==N.Color&&this._output!==N.Alpha||(this._updateShadowState(e),this._updateOccludeeState(e));const r=this._material.parameters;this.updateTexture(r.textureId);const i=e.camera.viewInverseTransposeMatrix;return se(r.origin,i[3],i[7],i[11]),this._material.setParameters(this.textureBindParameters),this.ensureTechnique(r.treeRendering?sCe:hJ,e)}},Kct=class extends Wct{constructor(){super(...arguments),this.initTextureTransparent=!1,this.treeRendering=!1,this.hasVertexTangents=!1}};const eut=new Kct;function tut(t){const e=zi().vec3f(E.POSITION);return t.normalType===Or.Compressed?e.vec2i16(E.NORMALCOMPRESSED,{glNormalized:!0}):e.vec3f(E.NORMAL),t.hasVertexTangents&&e.vec4f(E.TANGENT),(t.textureId||t.normalTextureId||t.metallicRoughnessTextureId||t.emissiveTextureId||t.occlusionTextureId)&&e.vec2f(E.UV0),t.hasVertexColors&&e.vec4u8(E.COLOR),t.hasSymbolColors&&e.vec4u8(E.SYMBOLCOLOR),oe("enable-feature:objectAndLayerId-rendering")&&e.vec4u8(E.OBJECTANDLAYERIDCOLOR),e}const rut=C(),iut=C(),sut=Oe(0,0,1),Aoe=C(),S9=C(),E9=C(),nut=C(),out=["polygon","extent"];let aut=class extends om{constructor(e,r,i,s){super(e,r,i,s),this.ensureDrapedStatus(!1)}async doLoad(){if(!this._drivenProperties.size){const a=p6(this._getSymbolSize());if(a)throw new F("graphics3dextrudesymbollayer:invalid-size",a)}const e=this.symbolLayer?.material?.color,r=this._getCombinedOpacityAndColor(e),i=Fa(r),s=r[3],n=s<1||this.needsDrivenTransparentPass,o={usePBR:this._context.physicalBasedRenderingEnabled,isSchematic:!0,diffuse:i,ambient:i,opacity:s,transparent:n,cullFace:n?pi.None:pi.Back,hasVertexColors:!0,hasSlicePlane:this._context.slicePlaneEnabled,castShadows:this.symbolLayer.castShadows,offsetTransparentBackfaces:!0,normalType:Or.Compressed};this._material=new Zf(o),this._bottomMaterial=new Zf({...o,cullFace:pi.Back}),this._context.stage.add(this._material),this._context.stage.add(this._bottomMaterial)}destroy(){super.destroy(),this._material&&(this._context.stage.remove(this._material),this._context.stage.remove(this._bottomMaterial))}createGraphics3DGraphic(e){const r=e.graphic;if(!this._validateGeometry(r.geometry,out,this.symbolLayer.type))return null;const i=this._getVertexOpacityAndColor(e.renderingInfo,255),s=this.setGraphicElevationContext(r,new mp);return this._createAs3DShape(r,e.renderingInfo,i,s,r.uid)}layerOpacityChanged(e,r){const i=this.symbolLayer?.material?.color,s=this._getCombinedOpacity(i),n=s<1||this.needsDrivenTransparentPass;this._material.setParameters({opacity:s,transparent:n}),this._bottomMaterial.setParameters({opacity:s,transparent:n});const o=this._getLayerOpacity();e.forEach(a=>{const l=r(a);l?.layerOpacityChanged(o,this._context.isAsync)})}layerElevationInfoChanged(e,r){return this.updateGraphics3DGraphicElevationInfo(e,r,G_)}slicePlaneEnabledChanged(e,r){return this._material.setParameters({hasSlicePlane:this._context.slicePlaneEnabled}),this._bottomMaterial.setParameters({hasSlicePlane:this._context.slicePlaneEnabled}),e.forEach(i=>{const s=r(i);s?.slicePlaneEnabledChanged(this._context.slicePlaneEnabled,this._context.isAsync)}),!0}physicalBasedRenderingChanged(){return this._material.setParameters({usePBR:this._context.physicalBasedRenderingEnabled,isSchematic:!0}),this._bottomMaterial.setParameters({usePBR:this._context.physicalBasedRenderingEnabled,isSchematic:!0}),!0}_getExtrusionSize(e){let r;return r=e.size&&this._drivenProperties.size?Fat(e.size,2)??0:this._getSymbolSize(),r/=this._context.renderCoordsHelper.unitInMeters,r}applyRendererDiff(e,r){return this._drivenPropertiesChanged(r)?Is.RecreateSymbol:Is.RecreateGraphics}async queryForSnapping(e,r,i,s){const n=this._getExtrusionSize(i)*this._context.renderCoordsHelper.unitInMeters/xO(r),{objectId:o,target:a}=e,l=K(a);switch(l.z=(l.z??0)+n,e.type){case"edge":{const{start:c,end:h}=e,p=K(c),f=K(h);return p.z=(p.z??0)+n,f.z=(f.z??0)+n,[Hne(o,l,1/0,p,f)]}case"vertex":return[Lat(o,l,1/0),Hne(o,a,1/0,a,l)];default:return[]}}_getSymbolSize(){return this.symbolLayer.size??1}_createAs3DShape(e,r,i,s,n){const o=nR(e.geometry);if(o==null)return null;if(o.rings.length===0||!o.rings.some(M=>M.length>0))return this._logGeometryValidationWarnings(o.rings,"rings","ExtrudeSymbol3DLayer"),null;const a=lJ(o,this._context.elevationProvider,this._context.renderCoordsHelper,s);this._logGeometryCreationWarnings(a,o.rings,"rings","ExtrudeSymbol3DLayer");const l=$Y(o);if(l==null)return null;const c=new Array,h=new Array,p=pn(),f=be(),m=C(),y=this._context.renderCoordsHelper.viewingMode===De.Global;y||this._context.renderCoordsHelper.worldUpAtPosition(null,m),Tl(o.spatialReference,[l.x,l.y,0],f,this._context.renderCoordsHelper.spatialReference);const _=be();On(_,f);const v=Li();L_(v,_);const{polygons:w,mapPositions:x,position:T}=a;for(const M of w){const k=M.count;if(this._context.clippingExtent&&(xi(p),nu(p,M.mapPositions),!Gd(p,this._context.clippingExtent)))continue;const L=N2(M.mapPositions,M.holeIndices,3);if(L.length===0)continue;const D=L.length,U=6*k,X=l4(U+D),W=l4(D),G=Bo(3*U),Y=Bo(3*U),P=Bo(3*U),V=Bo(U);lut(T,x,L,M,G,P,Y,V,X,W,this._getExtrusionSize(r),m,y),F2(G,G,_);const z=this._context.stage.renderView.getObjectAndLayerIdColor({graphicUid:n,layerUid:this._context.layer.uid}),H=new put(G,P,$ct(Y),V);c.push(Ooe(this._material,X,X.length-W.length,H,i,z),Ooe(this._bottomMaterial,W,0,H,i,z)),h.push(H.heights)}if(c.length===0)return null;const S=new ay({geometries:c,layerUid:this._context.layer.uid,graphicUid:n,isElevationSource:!0});S.transformation=f;const O=W1e(this.symbolLayer,{opacity:this._getLayerOpacity()}),A=O!=null?{baseMaterial:this._material,edgeMaterials:[O],properties:{mergeGeometries:!0,hasSlicePlane:this._context.slicePlaneEnabled}}:null,I=new nm(this,S,c,null,null,(M,k,L,D,U)=>hut(M,k,L,D,U,h),s,A);return I.alignedSampledElevation=a.sampledElevation,I.needsElevationUpdates=G_(s.mode),I}};function Ooe(t,e,r,i,s,n){const o=gE(e.length),a=[[E.POSITION,new ke(i.positions,3,!0)],[E.NORMALCOMPRESSED,new ke(i.normals,2,!0)],[E.COLOR,new ke(s,4,!0)]],l=[[E.POSITION,e],[E.NORMALCOMPRESSED,e],[E.COLOR,o]];return new Vs(t,a,l,i.elevation,ss.Mesh,n,r)}function lut(t,e,r,i,s,n,o,a,l,c,h,p,f){const m=r.length/3;let y=0,_=2*i.count;cut(t,e,i.index,i.count,r,0,m,s,n,o,a,l,c,_,h,p,f);let v=2*i.count;_=0,Roe(s,n,a,o,y,i.pathLengths[0],i.count,v,l,_,h),v+=4*i.pathLengths[0],_+=2*i.pathLengths[0],y+=i.pathLengths[0];for(let w=1;w<i.pathLengths.length;++w)Roe(s,n,a,o,y,i.pathLengths[w],i.count,v,l,_,h),v+=4*i.pathLengths[w],_+=2*i.pathLengths[w],y+=i.pathLengths[w]}function cut(t,e,r,i,s,n,o,a,l,c,h,p,f,m,y,_,v){ie(sl,_);const w=y>0?1:-1;let x=3*r,T=0,S=3*T,O=i,A=3*O;for(let k=0;k<i;++k)v&&(sl[0]=t[x],sl[1]=t[x+1],sl[2]=t[x+2],me(sl,sl)),a[S]=t[x],a[S+1]=t[x+1],a[S+2]=t[x+2],l[S]=e[x],l[S+1]=e[x+1],l[S+2]=e[x+2],c[S]=-w*sl[0],c[S+1]=-w*sl[1],c[S+2]=-w*sl[2],h[T]=0,a[A]=t[x]+y*sl[0],a[A+1]=t[x+1]+y*sl[1],a[A+2]=t[x+2]+y*sl[2],l[A]=e[x],l[A+1]=e[x+1],l[A+2]=e[x+2],c[A]=w*sl[0],c[A+1]=w*sl[1],c[A+2]=w*sl[2],h[O]=y,S+=3,A+=3,x+=3,T+=1,O+=1;x=3*n,S=0,A=3*m;const I=y<0?Doe:Loe,M=y<0?Loe:Doe;for(let k=0;k<o;++k)f[S]=s[x+I[0]],f[S+1]=s[x+I[1]],f[S+2]=s[x+I[2]],p[A]=s[x+M[0]]+i,p[A+1]=s[x+M[1]]+i,p[A+2]=s[x+M[2]]+i,S+=3,A+=3,x+=3}function DI(t,e,r,i,s,n,o){i[n]=i[o],o*=3,t[n*=3]=t[o],t[n+1]=t[o+1],t[n+2]=t[o+2],e[n]=e[o],e[n+1]=e[o+1],e[n+2]=e[o+2],r[n]=s[0],r[n+1]=s[1],r[n+2]=s[2]}const mC=C();function Roe(t,e,r,i,s,n,o,a,l,c,h){let p=s,f=s+1,m=s+o,y=s+o+1,_=a,v=a+1,w=a+2*n,x=a+2*n+1;h<0&&(p=s+o+1,y=s),c*=3;for(let T=0;T<n;++T)T===n-1&&(h>0?(f=s,y=s+o):(f=s,p=s+o)),uut(t,p,f,m,mC),DI(t,e,i,r,mC,_,p),DI(t,e,i,r,mC,v,f),DI(t,e,i,r,mC,w,m),DI(t,e,i,r,mC,x,y),l[c++]=_,l[c++]=w,l[c++]=x,l[c++]=_,l[c++]=x,l[c++]=v,p++,f++,m++,y++,_+=2,v+=2,w+=2,x+=2}const C9=C(),Poe=C(),Moe=C(),Ioe=C(),$oe=C();function uut(t,e,r,i,s){e*=3,r*=3,i*=3,se(C9,t[e++],t[e++],t[e++]),se(Poe,t[r++],t[r++],t[r++]),se(Moe,t[i++],t[i++],t[i++]),he(Ioe,Poe,C9),he($oe,Moe,C9),at(s,$oe,Ioe),me(s,s)}const Ox=C();function hut(t,e,r,i,s,n){const o=t.stageObject,a=o.geometries,l=a.length,c=e.mode!=="absolute-height";let h=0;const p=o.transformation,f=lE(be(),p);for(let m=0;m<l;m+=2){const y=a[m];if(!DY(y))continue;const _=y.getMutableAttribute(E.POSITION).data,v=n[m/2],w=new fY(y.mapPositions),x=_.length/3;let T=0,S=!1,O=0;for(let A=0;A<x;A++){Ox[0]=_[T],Ox[1]=_[T+1],Ox[2]=_[T+2],i(w,NI),c&&(O+=NI.sampledElevation),ni.TESTS_DISABLE_OPTIMIZATIONS?(se(Ll,w.array[w.offset],w.array[w.offset+1],NI.z+v[T/3]),r!=null&&s.toRenderCoords(Ll,r,Ll),$e(Ll,Ll,f)):(se(Ll,_[T],_[T+1],_[T+2]),$e(Ll,Ll,p),s.setAltitude(Ll,NI.z+v[T/3]),$e(Ll,Ll,f)),_[T]=Ll[0],_[T+1]=Ll[1],_[T+2]=Ll[2];const I=dut/s.unitInMeters;(Math.abs(Ox[0]-_[T])>=I||Math.abs(Ox[1]-_[T+1])>=I||Math.abs(Ox[2]-_[T+2])>=I)&&(S=!0),w.offset+=3,T+=3}S&&(y.invalidateBoundingInfo(),o.geometryVertexAttrsUpdated(a[m]),a[m+1].invalidateBoundingInfo(),o.geometryVertexAttrsUpdated(a[m+1])),h+=O/x}return h/l}const Ll=C(),sl=C(),NI=new cP,Loe=[0,2,1],Doe=[0,1,2],dut=.01;let put=class{constructor(e,r,i,s){this.positions=e,this.elevation=r,this.normals=i,this.heights=s}};function fut(t,e,r,i,s){if(t==null)return null;const n=t.referencesGeometry()&&s?mut(e,i,s):e,o=t.repurposeFeature(n);try{return t.evaluate({...r,$feature:o},t.services)}catch(a){return Q.getLogger("esri.views.2d.support.arcadeOnDemand").warn("Feature arcade evaluation failed:",a),null}}const A9=new Map;function mut(t,e,r){const{transform:i,hasZ:s,hasM:n}=r;A9.has(e)||A9.set(e,gut(e));const o=A9.get(e)(t.geometry,i,s,n);return{...t,geometry:o}}function gut(t){const e={};switch(t){case"esriGeometryPoint":return(r,i,s,n)=>s1e(i,e,r,s,n);case"esriGeometryPolygon":return(r,i,s,n)=>n1e(i,e,r,s,n);case"esriGeometryPolyline":return(r,i,s,n)=>o1e(i,e,r,s,n);case"esriGeometryMultipoint":return(r,i,s,n)=>i1e(i,e,r,s,n);default:return Q.getLogger("esri.views.2d.support.arcadeOnDemand").error(new F("mapview-arcade",`Unable to handle geometryType: ${t}`)),r=>r}}const eNt=1.2,yut=Of;let S6=class{constructor(e,r,i,s){this.graphics3DSymbolLayer=e,this.renderGeometries=r,this.boundingBox=i,this._drapeSourceRenderer=s,this.type="draped",this.stage=null,this._visible=!1,this._addedToStage=!1,this.isElevationSource=!1}initialize(e){this.stage=e.stage}setVisibility(e){if(this.stage!=null&&this._visible!==e){if(this._visible=e,e&&!this._addedToStage)return this._addedToStage=!0,void this._drapeSourceRenderer.addGeometries(this.renderGeometries,ji.ADD);if(e||this._addedToStage){for(const r of this.renderGeometries)r.visible=this._visible;this._drapeSourceRenderer.modifyGeometries(this.renderGeometries,Tn.VISIBILITY)}}}destroy(){this.stage&&this._addedToStage&&this._drapeSourceRenderer.removeGeometries(this.renderGeometries,ji.REMOVE),this._addedToStage=!1,this._visible=!1,this.stage=null}getCenterObjectSpace(e=C()){return se(e,0,0,0)}getBoundingBoxObjectSpace(e=pn()){return xi(e)}addObjectState(e,r){e===zg.Highlight&&(this.renderGeometries.forEach(i=>{const s=i.geometry.addHighlight();r.addRenderGeometry(i,s,this)}),this._addedToStage&&this._drapeSourceRenderer.modifyGeometries(this.renderGeometries,Tn.HIGHLIGHT))}removeObjectState(e){this.renderGeometries.forEach(r=>{e.removeRenderGeometry(r)})}removeRenderGeometryObjectState(e,r){e.geometry.removeHighlight(r),this._addedToStage&&this._drapeSourceRenderer.modifyGeometries(this.renderGeometries,Tn.HIGHLIGHT)}computeAttachmentOrigin(e){for(const r of this.renderGeometries)r.geometry.computeAttachmentOrigin(Rx)&&(e.draped.origin[0]+=Rx[0],e.draped.origin[1]+=Rx[1],e.draped.num++)}async getProjectedBoundingBox(e,r,i,s,n){xi(n);for(let o=0;o<this.renderGeometries.length;o++){const a=this.renderGeometries[o];this._getRenderGeometryProjectedBoundingRect(a,e,Noe,i),B6e(n,Noe)}if(r){let o;Bd(n,Rx);const a=LY(n,r.service.spatialReference,r);try{o=await r.service.queryElevation(Rx[0],Rx[1],s,a,"ground")}catch{}o!=null&&(n[2]=Math.min(n[2],o),n[5]=Math.max(n[5],o))}return n}_getRenderGeometryProjectedBoundingRect(e,r,i,s){if(this.boundingBox)HF(Pp,this.boundingBox);else{const n=e.boundingSphere,o=n[3];Pp[0]=n[0]-o,Pp[1]=n[1]-o,Pp[2]=n[2]-o,Pp[3]=n[0]+o,Pp[4]=n[1]+o,Pp[5]=n[2]+o}return r(Pp,0,2),this.calculateRelativeScreenBounds&&s.push({location:Bd(Pp),screenSpaceBoundingRect:this.calculateRelativeScreenBounds()}),zW(Pp,i)}};const Noe=Ut(),Pp=pn(),Rx=C();let oCe=class{constructor(e,r,i,s=2048){this.text=e,this._alignment=r,this._parameters=i,this._maxSize=s,this._textWidths=[],this._lineWidths=[],this._renderPixelRatio=null,this._metricsCached=null,this.key=`TextRenderer-${this._parameters.key}-${this._alignment}--${e}`,this._lines=e.split(/\r?\n/)}get displayWidth(){return Math.ceil(this._displayWidth+2*this._backgroundHorizontalPadding)}get displayHeight(){const e=this._lineSpacing*(this._lines.length-1),r=this._lineHeight;return Math.ceil(e+r+2*this._haloSize+this._backgroundTopPadding+this._backgroundBottomPadding)}get renderedWidth(){return Math.ceil(this._toRenderUnit(this.displayWidth))}get renderedHeight(){return Math.ceil(this._toRenderUnit(this.displayHeight))}get firstRenderedBaselinePosition(){return this._toRenderUnit(this._firstLineYOffset+this._baselinePosition)}get _firstLineYOffset(){return this._backgroundTopPadding+this._haloSize}get _metrics(){if(this._metricsCached==null){const e=_H(Foe,FI,FI).getContext("2d");this._setFontProperties(e,this._fontSize);let r=2*this._haloSize;const i=this._parameters.definition.font;i.style!=="italic"&&i.style!=="oblique"&&i.weight!=="bold"&&i.weight!=="bolder"||(r+=.3*e.measureText("A").width),this._textWidths.length=0,this._lineWidths.length=0;let s,n,o=0,a=0,l=0;this._lines.forEach((y,_)=>{const v=e.measureText(y),w=v.width,x=w+r;this._textWidths.push(w),this._lineWidths.push(x),o=Math.max(o,x),a=Math.max(a,v.actualBoundingBoxAscent),l=Math.max(l,v.actualBoundingBoxDescent),_===0&&(s=v),_===this._lines.length-1&&(n=v)});const c=e.font;let h=koe.get(c);if(!h){const y=e.measureText(vut);h=new wut(y.actualBoundingBoxAscent,y.actualBoundingBoxDescent),koe.set(c,h)}a=Math.max(a,h.actualBoundingBoxAscent),l=Math.max(l,h.actualBoundingBoxDescent);const p=a+l,f=this._hasBackground?s.actualBoundingBoxAscent:a,m=this._hasBackground?n.actualBoundingBoxDescent:l;this._metricsCached=new but(a-f,l-m,p,o,a)}return this._metricsCached}get _lineSpacing(){return(this._lineHeight+this._linePadding)*this._parameters.definition.lineSpacingFactor}get _lineHeight(){return this._metrics.lineHeight}get _linePadding(){return this._lineHeight*_ut}get _baselinePosition(){return this._metrics.baselinePosition}get _renderedFontSize(){return this._toRenderUnit(this._fontSize)}get _fontSize(){return this._parameters.definition.size}get _renderedHaloSize(){return this._toRenderUnit(this._haloSize)}get _haloSize(){return this._parameters.haloSize}get _backgroundHorizontalPadding(){return this._hasBackground?this._parameters.definition.background.padding[0]:0}get _backgroundVerticalPadding(){return this._hasBackground?this._parameters.definition.background.padding[1]:0}get _backgroundTopPadding(){return Math.max(0,this._backgroundVerticalPadding-this._metrics.paddingTop)}get _backgroundBottomPadding(){return Math.max(0,this._backgroundVerticalPadding-this._metrics.paddingBottom)}get _hasBackground(){return!!this._parameters.backgroundStyle}get renderPixelRatio(){if(this._renderPixelRatio==null){const e=this._parameters.definition.pixelRatio;this._maxSize>0?this._renderPixelRatio=Math.min(e,Math.min(this._maxSize/this.displayWidth,this._maxSize/this.displayHeight)):this._renderPixelRatio=e}return this._renderPixelRatio}_getLineXOffset(e){switch(this._alignment){case b_.Left:return this._backgroundHorizontalPadding;case b_.Center:return(this.displayWidth-this._lineWidths[e])/2;case b_.Right:return this.displayWidth-this._backgroundHorizontalPadding-this._lineWidths[e]}}render(e,r=0,i=0){e.save();const s=r/=this.renderPixelRatio,n=i/=this.renderPixelRatio,o=this._haloSize,a=this._firstLineYOffset;r+=o,i+=a+this._baselinePosition;const l=this._haloSize>0;l&&this._renderHalo(e,s,n,o,a),this._setFontProperties(e,this._renderedFontSize);for(let c=0;c<this._lines.length;++c){const h=this._lines[c],p=this._getLineXOffset(c);l&&(e.globalCompositeOperation="destination-out",e.fillStyle="rgb(0, 0, 0)",this._fillText(e,h,r+p,i),this._renderLineDecoration(e,r+p,i,this._textWidths[c])),e.globalCompositeOperation="source-over",e.fillStyle=this._parameters.textStyle,this._fillText(e,h,r+this._getLineXOffset(c),i),this._renderLineDecoration(e,r+p,i,this._textWidths[c]),i+=this._lineSpacing}if(ni.TEXT_SHOW_BASELINE){e.strokeStyle=Uoe,e.setLineDash([2,2]),e.lineWidth=1;let c=n+a;for(let h=0;h<this._lines.length;++h){const p=c+this._baselinePosition;this._drawLine(e,[s,p],[s+this.displayWidth,p]),c+=this._lineSpacing}}if(ni.TEXT_SHOW_BORDER&&(e.strokeStyle=Uoe,e.setLineDash([]),e.lineWidth=1,this._drawBox(e,[s,n],[this.displayWidth,this.displayHeight])),this._hasBackground){const c=this._parameters.definition.background.borderRadius*this.renderPixelRatio;this._roundedRect(e,s,n,c),e.globalCompositeOperation="destination-over",e.fillStyle=this._parameters.backgroundStyle,e.fill()}e.restore()}_renderLineDecoration(e,r,i,s,n=!1){if(this._parameters.definition.font.decoration==="none"||s===0)return;const o=1,a=Math.max(this._parameters.definition.size/16,o);switch(this._parameters.definition.font.decoration){case"underline":i+=2*a;break;case"line-through":i-=.33*this._baselinePosition}const l=n?this._haloSize:0;e.strokeStyle=n?this._parameters.haloStyle:this._parameters.textStyle,e.lineWidth=this._toRenderUnit(a+2*l),e.beginPath(),e.moveTo(this._toRenderUnit(r-l),this._toRenderUnit(i)),e.lineTo(this._toRenderUnit(r+s+l),this._toRenderUnit(i)),e.stroke()}_roundedRect(e,r,i,s){r=this._toRenderUnit(r),i=this._toRenderUnit(i);const n=this.renderedWidth,o=this.renderedHeight;s!==0?(s=ge(s,0,Math.floor(o/2)),e.beginPath(),e.moveTo(r,i+s),e.arcTo(r,i,r+s,i,s),e.lineTo(r+n-s,i),e.arcTo(r+n,i,r+n,i+s,s),e.lineTo(r+n,i+o-s),e.arcTo(r+n,i+o,r+n-s,i+o,s),e.lineTo(r+s,i+o),e.arcTo(r,i+o,r,i+o-s,s),e.closePath()):e.rect(r,i,n,o)}_renderHalo(e,r,i,s,n){const o=this.renderedWidth,a=this.renderedHeight,l=_H(Foe,Math.max(o,FI),Math.max(a,FI)),c=l.getContext("2d");c.clearRect(0,0,o,a),this._setFontProperties(c,this._renderedFontSize),c.fillStyle=this._parameters.haloStyle,c.strokeStyle=this._parameters.haloStyle;const h=this._renderedHaloSize<3;c.lineJoin=h?"miter":"round",h?this._renderHaloEmulated(c,s,n):this._renderHaloNative(c,s,n);let p=n+this._baselinePosition;for(let f=0;f<this._lines.length;++f){const m=this._getLineXOffset(f);this._renderLineDecoration(c,s+m,p,this._textWidths[f],!0),p+=this._lineSpacing}e.globalAlpha=this._parameters.definition.halo.color[3],e.drawImage(l,0,0,o,a,this._toRenderUnit(r),this._toRenderUnit(i),o,a),e.globalAlpha=1}_renderHaloEmulated(e,r,i){i+=this._baselinePosition;for(let s=0;s<this._lines.length;++s){const n=this._lines[s],o=this._getLineXOffset(s);for(const[a,l]of aCe)this._fillText(e,n,r+o+this._haloSize*a,i+this._haloSize*l);i+=this._lineSpacing}}_renderHaloNative(e,r,i){const s=2*this._haloSize;i+=this._baselinePosition;for(let n=0;n<this._lines.length;++n){const o=this._lines[n],a=this._getLineXOffset(n),l=5,c=.1;for(let h=0;h<l;h++){const p=1-(l-1)*c+h*c;e.lineWidth=this._toRenderUnit(p*s),this._strokeText(e,o,r+a,i)}i+=this._lineSpacing}}_setFontProperties(e,r){e.font=this._parameters.fontString(r),e.textAlign="left",e.textBaseline="alphabetic"}get _displayWidth(){return this._metrics.displayWidth}_toRenderUnit(e){return e*this.renderPixelRatio}_toRoundedRenderUnit(e){return Math.round(e*this.renderPixelRatio)}_fillText(e,r,i,s){e.fillText(r,this._toRenderUnit(i),this._toRenderUnit(s))}_strokeText(e,r,i,s){e.strokeText(r,this._toRenderUnit(i),this._toRenderUnit(s))}_drawLine(e,r,i){e.beginPath(),e.moveTo(this._toRoundedRenderUnit(r[0])+.5,this._toRoundedRenderUnit(r[1])+.5),e.lineTo(this._toRoundedRenderUnit(i[0])+.5,this._toRoundedRenderUnit(i[1])+.5),e.stroke()}_drawBox(e,r,i){const s=this._toRenderUnit(r[0]),n=this._toRenderUnit(r[1]),o=this._toRenderUnit(i[0]),a=this._toRenderUnit(i[1]),l=Math.floor(s)+.5,c=Math.ceil(s+o)-.5,h=Math.floor(n)+.5,p=Math.ceil(n+a)-.5;e.beginPath(),e.moveTo(l,h),e.lineTo(c,h),e.lineTo(c,p),e.lineTo(l,p),e.lineTo(l,h),e.stroke()}};const aCe=[];for(let e=0;e<360;e+=360/16)aCe.push([Math.cos(Math.PI*e/180),Math.sin(Math.PI*e/180)]);var b_;function _H(t,e,r){return t.canvas||(t.canvas=document.createElement("canvas")),t.canvas.width=e,t.canvas.height=r,t.canvas}(function(t){t[t.Left=0]="Left",t[t.Center=1]="Center",t[t.Right=2]="Right"})(b_||(b_={}));const Foe={canvas:null},_ut=.2,FI=512,Uoe="rgb(255, 0, 255, 0.5)",vut=(()=>{let t="";for(let e=32;e<127;e++)t+=String.fromCharCode(e);return t})();let but=class{constructor(e,r,i,s,n){this.paddingTop=e,this.paddingBottom=r,this.lineHeight=i,this.displayWidth=s,this.baselinePosition=n}},wut=class{constructor(e,r){this.actualBoundingBoxAscent=e,this.actualBoundingBoxDescent=r}};const koe=new Map,xut=Object.freeze({left:0,center:.5,right:1}),hD=Object.freeze({"bottom-left":dr(0,0),bottom:dr(.5,0),"bottom-right":dr(1,0),left:dr(0,.5),center:dr(.5,.5),right:dr(1,.5),"top-left":dr(0,1),top:dr(.5,1),"top-right":dr(1,1)});function lCe(t){switch(t){case"left":return b_.Left;case"right":return b_.Right;default:return b_.Center}}function Voe(t){switch(t){case"bottom-left":case"left":case"top-left":return"left";case"bottom":case"center":case"top":return"center";case"bottom-right":case"right":case"top-right":return"right"}}function Tut(t){switch(t){case"bottom-left":case"bottom":case"bottom-right":return"bottom";case"left":case"center":case"right":return"center";case"top-left":case"top":case"top-right":return"top"}}function Sut(t,e){switch(e){case"bottom":return t==="left"?"bottom-left":t==="right"?"bottom-right":"bottom";case"center":return t;case"top":return t==="left"?"top-left":t==="right"?"top-right":"top"}}function Eut(t){return t==="middle"?"center":t}let k2=class{constructor(e,r={}){this.geometry=e,this.screenToWorldRatio=1,this._transformation=be(),this._shaderTransformation=null,this._boundingSphere=null,this.id=gc(),this.layerUid=r.layerUid,this.graphicUid=r.graphicUid,this.shaderTransformer=r.shaderTransformer,this.castShadow=r.castShadow??!1}get transformation(){return this._transformation}get boundingInfo(){return this.geometry.boundingInfo}updateTransformation(e){e(this._transformation),this._shaderTransformation=this._boundingSphere=null}shaderTransformationChanged(){this._shaderTransformation=null}get boundingSphere(){return this._boundingSphere?this._boundingSphere:this.boundingInfo?(this._boundingSphere=$e(gs(),this.boundingInfo.center,this.shaderTransformation),this._boundingSphere[3]=this.boundingInfo.radius*v2(this.shaderTransformation),this._boundingSphere):nbe}get hasShaderTransformation(){return this.shaderTransformer!=null}get material(){return this.geometry.material}get type(){return this.geometry.type}get shaderTransformation(){return this.shaderTransformer==null?this.transformation:(this._shaderTransformation||(this._shaderTransformation=Ls(be(),this.shaderTransformer(this.transformation))),this._shaderTransformation)}get indices(){return this.geometry.indices}get vertexAttributes(){return this.geometry.vertexAttributes}get highlights(){return this.geometry.highlights}get occludees(){return this.geometry.occludees}get visible(){return this.geometry.visible}set visible(e){this.geometry.visible=e}};const Cut=be(),zoe=Oe(0,0,1),Aut=16,Out=1.5,bb=MY,Rut=[bb/2,bb/2,1-bb/2,1-bb/2],Put=[rR*bb,rR*bb];let vH=class cCe extends om{getCachedSize(){return{size:this._getIconSize()}}constructor(e,r,i,s){super(e,r,i,s),this._cimLayers=null,this._cimSymbolMaterials=new Map,this._cimSymbolTextures=new Map,this._cimMaterialParametersInfo=null,this._cimRequiredFields=null,this._cimScaleFactorOrFunction=null,this._size=null,this._symbolTextureRatio=1,this._outlineSize=0,this._elevationOptions={supportsOffsetAdjustment:!0,supportsOnTheGround:!0}}async doLoad(e){this._validateOrThrow();const r=this._prepareMaterialParameters(),i=this._getPrimitive();if(i!=null)this._prepareResourcesPrimitive(r,i);else{const s=rGe(this.symbolLayer),n=Vb(s);n&&n.mediaType==="application/json"?await this._prepareResourcesCIM(r,JSON.parse(n.data),e):await this._prepareResourcesHref(r,s,e)}}_validateOrThrow(){if(this._drivenProperties.size)return;const e=p6(this._getIconSize());if(e)throw new F("graphics3diconsymbollayer:invalid-size",e)}_getIconSize(){const e=this.symbolLayer,r=Math.round(e.size!=null?Ms(e.size):Aut);return this._drivenProperties.size?Math.max(r,64):r}_generateTextureCIM(e){const r=this._getGraphicHash(e);let i=r===""?null:this._cimSymbolTextures.get(r);if(!i){const s={scaleFactor:this._cimScaleFactorOrFunction},n=this._context.sharedResources.cimSymbolRasterizer.rasterizeCIMSymbol3D(this._cimLayers,e,"esriGeometryPoint",s,void 0,void 0);this._cimMaterialParametersInfo.anchorPosition=this._getAnchorPos("relative",n.anchorPosition);const o={width:n.imageData.width,height:n.imageData.height};i=new zw(n.imageData,o),this._cimSymbolTextures.set(r,i),this._context.stage.add(i)}return i}_prepareMaterialParameters(){const e={anchorPosition:this._getAnchorPos(this.symbolLayer.anchor,this.symbolLayer.anchorPosition)},r=this.symbol;if(Mut(r)){const{screenLength:i,minWorldLength:s,maxWorldLength:n}=r.verticalOffset;e.verticalOffset={screenLength:Ms(i),minWorldLength:s||0,maxWorldLength:n??1/0}}return this._context.screenSizePerspectiveEnabled&&(e.screenSizePerspective=this._context.sharedResources.screenSizePerspectiveSettings),e.occlusionTest=!0,e.hasSlicePlane=this._context.slicePlaneEnabled,e}_prepareResourcesPrimitive(e,r){const i=this._getOutlineSize();if(O9(r)&&i===0)throw new Error("Nothing to render");if(this._outlineSize=i,e.color=this._getFillColor(),e.outlineColor=this._getOutlineColor(),e.outlineSize=this._outlineSize,this._context.sharedResources.textures!=null){const n=this._context.sharedResources.textures.fromData(`${r}-icon`,()=>rnt(r));this._texture=n.texture,this._releaseTexture=n,e.textureId=this._texture.id}e.textureIsSignedDistanceField=!0,e.distanceFieldBoundingBox=Rut;const s=this._getIconSize();this._size=[s,s],this._symbolTextureRatio=1/bb,this._createMaterialAndAddToStage(e,this._context.stage)}async _prepareResourcesHref(e,r,i){this._outlineSize=this._getOutlineSize(),e.color=this._getFillColor(),e.outlineColor=this._getOutlineColor(),e.outlineSize=this._outlineSize,e.textureIsSignedDistanceField=!1;const s=this._getIconSize(),n=s*this._context.graphicsCoreOwner.view.state.rasterPixelRatio;if(this._context.sharedResources.textures!=null){const o=await gu(this._context.sharedResources.textures.fromUrl(r,n,{signal:i}));if(o.ok===!1)throw Lo(o.error),new F("graphics3diconsymbollayer:request-failed",`Failed to load (Request for icon resource failed: ${r})`);this._releaseTexture=o.value;const a=o.value.texture,l=a.parameters.width/a.parameters.height;this._size=l>1?[s,Math.round(s/l)]:[Math.round(s*l),s],e.textureId=a.id}this._createMaterialAndAddToStage(e,this._context.stage)}async _prepareResourcesCIM(e,r,i){const s=new tE({data:r});if(!this._context.sharedResources.cimSymbolRasterizer){const h=(await ae(()=>import("./CIMSymbolRasterizer-797468b4.js"),["./CIMSymbolRasterizer-797468b4.js","./cimAnalyzer-653b100f.js","./TileClipper-ae6eca9e.js","./definitions-40cbc24b.js","./number-e491b09e.js","./BidiEngine-9a40f2f4.js","./imageutils-7ddd1810.js","./rasterizingUtils-4b81019f.js"],import.meta.url)).CIMSymbolRasterizer;Xt(i),this._context.sharedResources.cimSymbolRasterizer||(this._context.sharedResources.cimSymbolRasterizer=new h(this._context.renderCoordsHelper.spatialReference,!0))}const n=this._context.layer.fields?this._context.layer.fields.map(h=>h.toJSON()):null;let o,a;if(this._cimLayers=await this._context.sharedResources.cimSymbolRasterizer.analyzeCIMSymbol3D(s,n,this._context.renderer&&this._context.renderer.type==="dictionary"?this._context.renderer.fieldMap:null,"esriGeometryPoint",{signal:i}),this._context.renderer&&this._context.renderer.type==="dictionary"&&this._context.renderer.scaleExpression){const h=this._context.renderer;if(isNaN(h.scaleExpression)){const p=h.scaleExpression,f=await ENe(p,this._context.layer.spatialReference,n);a=(m,y,_)=>{const v=fut(f,m,{$view:_},"esriGeometryPoint",y);return v!==null?v:1}}else o=Number(h.scaleExpression)}this._cimScaleFactorOrFunction=o||a||1;const l=this._context.renderer?await this._context.renderer.getRequiredFields(this._context.layer.fieldsIndex):[];Xt(i);const c=this._context.layer.fieldsIndex;this._cimRequiredFields=l.map(h=>c.get(h).name),this._cimMaterialParametersInfo=e,this._cimMaterialParametersInfo.color=this._getFillColor(),this._cimMaterialParametersInfo.outlineColor=[0,0,0,0],this._cimMaterialParametersInfo.outlineSize=0,this._cimMaterialParametersInfo.textureIsSignedDistanceField=!1}_getPrimitive(){return this.symbolLayer.resource&&this.symbolLayer.resource.href?null:this.symbolLayer.resource&&this.symbolLayer.resource.primitive||aUe}_getOutlineSize(){let e=0;const r=this.symbolLayer;return r.outline!=null&&r.outline.size!=null?Math.max(Ms(r.outline.size),0):(e=O9(this._getPrimitive())?Out:0,Math.max(e,0))}_getOutlineColor(){const e=this._getLayerOpacity(),r=this.symbolLayer,i=r?.outline?.color;if(i!=null){const s=ze.toUnitRGB(i),n=i.a*e;return[s[0],s[1],s[2],n]}return[0,0,0,0]}_getFillColor(){if(O9(this._getPrimitive()))return yut;const e=this._getPrimitive()==null,r=this.symbolLayer?.material?.color;return this._getCombinedOpacityAndColor(r,{hasIntrinsicColor:e})}_getAnchorPos(e,r){return e==="relative"?dr((r.x||0)+.5,.5-(r.y||0)):e in hD?hD[e]:hD.center}_createMaterialAndAddToStage(e,r){if(this._cimLayers){this._fastUpdates=null;let i=e.textureId?this._cimSymbolMaterials.get(e.textureId):null;return i||(i=new D2(e),this._cimSymbolMaterials.set(e.textureId??0,i),r.add(i)),i}return this._fastUpdates=$2(this._context.renderer,this._fastVisualVariableConvertOptions()),this._fastUpdates&&(e={...e,...this._fastUpdates.materialParameters}),this._material=new D2(e),r.add(this._material),this._material}_setDrapingDependentMaterialParameters(){this.draped&&(this._forEachMaterial(e=>{e.setParameters({verticalOffset:null,screenSizePerspective:null,occlusionTest:!1,hasSlicePlane:!1,shaderPolygonOffset:0,isDraped:this.draped})}),this.layerOpacityChanged())}destroy(){super.destroy(),this._forEachMaterial(e=>this._context.stage.remove(e)),this._material=null,this._cimSymbolMaterials.clear(),this._cimSymbolTextures.forEach(e=>this._context.stage.remove(e)),this._cimSymbolTextures.clear(),this._releaseTexture=Ui(this._releaseTexture)}_getScaleFactor(e,r){if(this._drivenProperties.size&&e.size){for(let i=0;i<3;i++){const s=e.size[i];s&&s!=="symbol-value"&&s!=="proportional"&&(e.size[i]=Ms(s))}if(e.size[0]==="symbol-value")return 1;if(isFinite(+e.size[0]))return+e.size[0]/r;if(isFinite(+e.size[2]))return+e.size[2]/r}return 1}createGraphics3DGraphic(e){const r=e.graphic;if(!this._validateGeometry(r.geometry))return null;let i,s=[0,0];if(this._cimLayers){if(!this._cimLayers.length)return null;const p=this._generateTextureCIM(r),f={textureId:p.id,...this._cimMaterialParametersInfo};i=this._createMaterialAndAddToStage(f,this._context.stage),s=[p.parameters.width,p.parameters.height]}else s=this._size,i=this._material;const n=sR(r.geometry);if(n==null)return this.logger.warn(`unsupported geometry type for icon symbol: ${r.geometry.type}`),null;const o=e.renderingInfo,a=this._getVertexOpacityAndColor(o);let l=1;if(!this._fastUpdates?.visualVariables.size){const p=s[0]>s[1]?s[0]:s[1];l=this._getScaleFactor(o,p)}l*=this._symbolTextureRatio;const c=dr(s[0]*l,s[1]*l),h=this.setGraphicElevationContext(r,new mp);return this.ensureDrapedStatus(h.mode==="on-the-ground")&&this._setDrapingDependentMaterialParameters(),this.draped?this._createAsOverlay(r,n,i,a,c,e.layer.uid):this._createAs3DShape(r,n,i,a,c,h,r.uid)}layerOpacityChanged(){const e=this._getFillColor(),r=this._getOutlineColor();this._forEachMaterial(i=>{i.setParameters({color:e}),i.setParameters({outlineColor:r})})}layerElevationInfoChanged(e,r,i){const s=this._elevationContext.mode,n=lP(cCe.elevationModeChangeTypes,i,s);if(n!==ns.UPDATE)return n;const o=Nh(s)||s==="absolute-height";return this.updateGraphics3DGraphicElevationInfo(e,r,()=>o)}slicePlaneEnabledChanged(){return this.draped||this._forEachMaterial(e=>{e.setParameters({hasSlicePlane:this._context.slicePlaneEnabled})}),!0}physicalBasedRenderingChanged(){return!0}get pixelRatioChanged(){return this._getPrimitive()!=null}applyRendererDiff(e,r){for(const i in e.diff){if(i!=="visualVariables"||!L2(this._fastUpdates,r,this._fastVisualVariableConvertOptions()))return Is.RecreateSymbol;this._material!=null&&this._material.setParameters(this._fastUpdates.materialParameters)}return Is.FastUpdate}_defaultElevationInfoNoZ(){return Iut}_createAs3DShape(e,r,i,s,n,o,a){const l=this.getFastUpdateAttrValues(e),c=l&&this._fastUpdates?_=>nH(this._fastUpdates.materialParameters,l,_):void 0,h=this._context.layer.uid,p=this._context.stage.renderView.getObjectAndLayerIdColor({graphicUid:a,layerUid:h}),f=Pj(i,zoe,null,s,n,$ut,null,l,p),m=VY(this._context,r,f,o,a,c);if(m==null)return null;const y=new nm(this,m.object,[f],null,null,$b,o);return y.alignedSampledElevation=m.sampledElevation,y.needsElevationUpdates=Nh(o.mode)||o.mode==="absolute-height",y.getScreenSize=this._createScreenSizeGetter(n,c),y.calculateRelativeScreenBounds=_=>i.calculateRelativeScreenBounds(y.getScreenSize(),1,_),iR(y,r,this._context.elevationProvider),y}_createAsOverlay(e,r,i,s,n,o){i.renderPriority=this._renderPriority;const a=Wt();wo(r,a,this._context.overlaySR),a[2]=aJ;const l=this._context.clippingExtent;if(l!=null&&!VW(l,a))return null;const c=this.getFastUpdateAttrValues(e),h=c&&this._fastUpdates?_=>nH(this._fastUpdates.materialParameters,c,_):void 0,p=this._context.stage.renderView.getObjectAndLayerIdColor({graphicUid:e.uid,layerUid:this._context.layer.uid}),f=Pj(i,zoe,a,s,n,null,null,c,p),m=new k2(f,{layerUid:o,graphicUid:e.uid,shaderTransformer:h}),y=new S6(this,[m],null,this._context.drapeSourceRenderer);return y.getScreenSize=this._createScreenSizeGetter(n,h),y.calculateRelativeScreenBounds=_=>i.calculateRelativeScreenBounds(y.getScreenSize(),1,_),y}_createScreenSizeGetter(e,r){const i=this._outlineSize+2;if(this._fastUpdates&&r){const s=e[0]/this._symbolTextureRatio,n=e[1]/this._symbolTextureRatio;return(o=Ve())=>{const a=r(Cut);return o[0]=a[0]*s+i,o[1]=a[5]*n+i,o}}{const s=e[0]/this._symbolTextureRatio+i,n=e[1]/this._symbolTextureRatio+i;return(o=Ve())=>(o[0]=s,o[1]=n,o)}}_fastVisualVariableConvertOptions(){const e=Math.max(this._size[0],this._size[1]),r=Oe(e,e,e),i=fu(1),s=e*i,n=Oe(s,s,s);return new oP({size:!0,color:!0,rotation:!0,opacity:!1},r,n,i)}_getGraphicHash(e){let r="";for(const i of this._cimRequiredFields)r+=i+e.attributes[i];return r}_forEachMaterial(e){this._material!=null&&e(this._material),this._cimSymbolMaterials.forEach(e)}test(){return{...super.test(),material:this._material}}};function Mut(t){return t&&t.type==="point-3d"&&t.hasVisibleVerticalOffset()}function O9(t){return t!=null&&(t==="cross"||t==="x")}vH.PRIMITIVE_SIZE=Put,vH.elevationModeChangeTypes={definedChanged:ns.UPDATE,staysOnTheGround:ns.NONE,onTheGroundChanged:ns.RECREATE};const Iut={mode:"relative-to-ground",offset:0},$ut=Lt(0,0,0,1);function bH(t){switch(t){case"butt":return xh.BUTT;case"square":return xh.SQUARE;case"round":return xh.ROUND;default:return null}}function Boe(t){return t==="diamond"?"kite":t}function wH(t,e,r=null){const i=[],s=[],n=e.mapPositions;Lut(e,s,i);const o=s[0][1].data,a=i[0][1].length,l=gE(a);return Dut(e,s,i,l),Uut(e,s,i,l),Nut(e,s,i,l),Fut(e,s,i,l),kut(e,s,i,l),Vut(e,s,i,l),zut(e,s,i,o),new Vs(t,s,i,n,ss.Line,r)}function Lut(t,e,r){const{attributeData:{position:i},removeDuplicateStartEnd:s}=t,n=But(i)&&s,o=i.length/3-(n?1:0),a=new Array(2*(o-1)),l=n?i.slice(0,i.length-3):i;let c=0;for(let h=0;h<o-1;h++)a[c++]=h,a[c++]=h+1;e.push([E.POSITION,new ke(l,3,n)]),r.push([E.POSITION,a])}function Dut(t,e,r,i){if(t.attributeData.colorFeature!=null)return;const s=t.attributeData.color;e.push([E.COLOR,new ke(s??dh,4)]),r.push([E.COLOR,i])}function Nut(t,e,r,i){if(t.attributeData.normal==null)return;const s=t.attributeData.normal;e.push([E.NORMAL,new ke(s,3)]),r.push([E.NORMAL,i])}function Fut(t,e,r,i){t.attributeData.colorFeature!=null&&(e.push([E.COLORFEATUREATTRIBUTE,new ke([t.attributeData.colorFeature],1,!0)]),r.push([E.COLOR,i]))}function Uut(t,e,r,i){t.attributeData.sizeFeature==null&&(e.push([E.SIZE,new ke([t.attributeData.size??1],1,!0)]),r.push([E.SIZE,i]))}function kut(t,e,r,i){t.attributeData.sizeFeature!=null&&(e.push([E.SIZEFEATUREATTRIBUTE,new ke([t.attributeData.sizeFeature],1,!0)]),r.push([E.SIZEFEATUREATTRIBUTE,i]))}function Vut(t,e,r,i){const s=t.attributeData.opacityFeature;s!=null&&(e.push([E.OPACITYFEATUREATTRIBUTE,new ke([s],1,!0)]),r.push([E.OPACITYFEATUREATTRIBUTE,i]))}function zut(t,e,r,i){if(t.overlayInfo==null||t.overlayInfo.renderCoordsHelper.viewingMode!==De.Global||!t.overlayInfo.spatialReference.isGeographic)return;const s=Bo(i.length),n=Nr(t.overlayInfo.spatialReference);for(let f=0;f<s.length;f+=3)v5(i,f,s,f,n);const o=i.length/3,a=Yi(o+1);let l=Gut,c=jut,h=0,p=0;se(l,s[p++],s[p++],s[p++]),a[0]=0;for(let f=1;f<o+1;++f)f===o&&(p=0),se(c,s[p++],s[p++],s[p++]),h+=Uve(l,c),a[f]=h,[l,c]=[c,l];e.push([E.DISTANCETOSTART,new ke(a,1,!0)]),r.push([E.DISTANCETOSTART,r[0][1]])}function But(t){const e=t.length;return t[0]===t[e-3]&&t[1]===t[e-2]&&t[2]===t[e-1]}const Gut=C(),jut=C();function oNt(t,e){if(t==null||t.length===0)return[];const r=[];return t.forEach(i=>{const s=i.length,n=Bo(3*s);i.forEach((a,l)=>{n[3*l]=a[0],n[3*l+1]=a[1],n[3*l+2]=a[2]});const o={attributeData:{position:n,normal:e},removeDuplicateStartEnd:!1};r.push(o)}),r}function Hut(t,e,r,i){const s=t.type==="polygon"?qf.CCW_IS_HOLE:qf.NONE,n=t.type==="polygon"?t.rings:t.paths,{position:o,outlines:a}=hP(n,!!t.hasZ,s),l=Bo(o.length),c=h2e(o,t.spatialReference,0,l,0,o,0,o.length/3,e,r,i),h=c!=null;return{lines:h?uCe(a,o,l):[],projectionSuccess:h,sampledElevation:c}}function qut(t,e){const r=t.type==="polygon"?qf.CCW_IS_HOLE:qf.NONE,i=t.type==="polygon"?t.rings:t.paths,{position:s,outlines:n}=hP(i,!1,r),o=oi(s,t.spatialReference,0,s,e,0,s.length/3);for(let a=2;a<s.length;a+=3)s[a]=aJ;return{lines:o?uCe(n,s):[],projectionSuccess:o}}function uCe(t,e,r=null){const i=new Array;for(const{index:s,count:n}of t){if(n<=1)continue;const o=3*s,a=3*n;i.push({position:wh(e,3*s,3*n),mapPositions:r!=null?wh(r,o,a):void 0})}return i}function Wut(t){const e=new wr,r=t.hasMultipassTerrain&&(t.output===N.Color||t.output===N.Alpha),i=t.space===hu.World;e.include(oEe,t),e.include(pEe,t),t.output===N.Depth&&e.include(jg,t);const{vertex:s,fragment:n}=e;return n.include(Ec),vc(s,t),e.attributes.add(E.POSITION,"vec3"),e.attributes.add(E.UV0,"vec2"),e.attributes.add(E.AUXPOS1,"vec3"),e.varyings.add("vColor","vec4"),e.varyings.add("vpos","vec3"),e.varyings.add("vUV","vec2"),e.varyings.add("vSize","float"),F_(e),r&&e.varyings.add("depth","float"),t.hasTip&&e.varyings.add("vLineWidth","float"),s.uniforms.add(new Sr("nearFar",(o,a)=>a.camera.nearFar),new sr("viewport",(o,a)=>a.camera.fullViewport)),s.code.add(b`vec4 projectAndScale(vec4 pos) {
vec4 posNdc = proj * pos;
posNdc.xy *= viewport.zw / posNdc.w;
return posNdc;
}`),s.code.add(b`void clip(vec4 pos, inout vec4 prev) {
float vnp = nearFar[0] * 0.99;
if (prev.z > -nearFar[0]) {
float interpolation = (-vnp - pos.z) / (prev.z - pos.z);
prev = mix(pos, prev, interpolation);
}
}`),i?(e.attributes.add(E.NORMAL,"vec3"),M2(s),s.constants.add("tiltThreshold","float",.7),s.code.add(b`vec3 perpendicular(vec3 v) {
vec3 n = (viewNormal * vec4(normal.xyz, 1.0)).xyz;
vec3 n2 = cross(v, n);
vec3 forward = vec3(0.0, 0.0, 1.0);
float tiltDot = dot(forward, n);
return abs(tiltDot) < tiltThreshold ? n : n2;
}`)):s.code.add(b`vec2 perpendicular(vec2 v) {
return vec2(v.y, -v.x);
}`),s.code.add(b`
      #define vecN ${i?"vec3":"vec2"}

      vecN normalizedSegment(vecN pos, vecN prev) {
        vecN segment = pos - prev;
        float segmentLen = length(segment);

        // normalize or zero if too short
        return (segmentLen > 0.001) ? segment / segmentLen : ${i?"vec3(0.0, 0.0, 0.0)":"vec2(0.0, 0.0)"};
      }

      vecN displace(vecN pos, vecN prev, float displacementLen) {
        vecN segment = normalizedSegment(pos, prev);

        vecN displacementDirU = perpendicular(segment);
        vecN displacementDirV = segment;

        ${t.anchor===mw.Tip?"pos -= 0.5 * displacementLen * displacementDirV;":""}

        return pos + displacementLen * (uv0.x * displacementDirU + uv0.y * displacementDirV);
      }
    `),t.space===hu.Screen&&(s.uniforms.add(new $i("inverseProjectionMatrix",(o,a)=>a.camera.inverseProjectionMatrix)),s.code.add(b`vec3 inverseProject(vec4 posScreen) {
posScreen.xy = (posScreen.xy / viewport.zw) * posScreen.w;
return (inverseProjectionMatrix * posScreen).xyz;
}`),s.code.add(b`bool rayIntersectPlane(vec3 rayDir, vec3 planeOrigin, vec3 planeNormal, out vec3 intersection) {
float cos = dot(rayDir, planeNormal);
float t = dot(planeOrigin, planeNormal) / cos;
intersection = t * rayDir;
return abs(cos) > 0.001 && t > 0.0;
}`),s.uniforms.add(new Re("perScreenPixelRatio",(o,a)=>a.camera.perScreenPixelRatio)),s.code.add(b`
      vec4 toFront(vec4 displacedPosScreen, vec3 posLeft, vec3 posRight, vec3 prev, float lineWidth) {
        // Project displaced position back to camera space
        vec3 displacedPos = inverseProject(displacedPosScreen);

        // Calculate the plane that we want the marker to lie in. Note that this will always be an approximation since ribbon lines are generally
        // not planar and we do not know the actual position of the displaced prev vertices (they are offset in screen space, too).
        vec3 planeNormal = normalize(cross(posLeft - posRight, posLeft - prev));
        vec3 planeOrigin = posLeft;

        ${t.hasCap?`
                if(prev.z > posLeft.z) {
                  vec2 diff = posLeft.xy - posRight.xy;
                  planeOrigin.xy += perpendicular(diff) / 2.0;
                }
              `:""};

        // Move the plane towards the camera by a margin dependent on the line width (approximated in world space). This tolerance corrects for the
        // non-planarity in most cases, but sharp joins can place the prev vertices at arbitrary positions so markers can still clip.
        float offset = lineWidth * perScreenPixelRatio;
        planeOrigin *= (1.0 - offset);

        // Intersect camera ray with the plane and make sure it is within clip space
        vec3 rayDir = normalize(displacedPos);
        vec3 intersection;
        if (rayIntersectPlane(rayDir, planeOrigin, planeNormal, intersection) && intersection.z < -nearFar[0] && intersection.z > -nearFar[1]) {
          return vec4(intersection.xyz, 1.0);
        }

        // Fallback: use depth of pos or prev, whichever is closer to the camera
        float minDepth = planeOrigin.z > prev.z ? length(planeOrigin) : length(prev);
        displacedPos *= minDepth / length(displacedPos);
        return vec4(displacedPos.xyz, 1.0);
      }
  `)),xE(s,t),V5(e),s.code.add(b`void main(void) {
if (uv0.y == 0.0) {
gl_Position = vec4(1e038, 1e038, 1e038, 1.0);
}
else {
float lineWidth = getLineWidth();
float screenMarkerSize = getScreenMarkerSize();
vec4 pos  = view * vec4(position.xyz, 1.0);
vec4 prev = view * vec4(auxpos1.xyz, 1.0);
clip(pos, prev);`),i?(t.hideOnShortSegments&&s.code.add(b`if (areWorldMarkersHidden(pos, prev)) {
gl_Position = vec4(1e038, 1e038, 1e038, 1.0);
return;
}`),s.code.add(b`pos.xyz = displace(pos.xyz, prev.xyz, getWorldMarkerSize(pos));
vec4 displacedPosScreen = projectAndScale(pos);`)):(s.code.add(b`vec4 posScreen = projectAndScale(pos);
vec4 prevScreen = projectAndScale(prev);
vec4 displacedPosScreen = posScreen;
displacedPosScreen.xy = displace(posScreen.xy, prevScreen.xy, screenMarkerSize);`),t.space===hu.Screen&&s.code.add(b`vec2 displacementDirU = perpendicular(normalizedSegment(posScreen.xy, prevScreen.xy));
vec3 lineRight = inverseProject(posScreen + lineWidth * vec4(displacementDirU.xy, 0.0, 0.0));
vec3 lineLeft = pos.xyz + (pos.xyz - lineRight);
pos = toFront(displacedPosScreen, lineLeft, lineRight, prev.xyz, lineWidth);
displacedPosScreen = projectAndScale(pos);`)),s.code.add(b`
        ${r?"depth = pos.z;":""}
        linearDepth = calculateLinearDepth(nearFar,pos.z);

        // Convert back into NDC
        displacedPosScreen.xy = (displacedPosScreen.xy / viewport.zw) * displacedPosScreen.w;

        // Convert texture coordinate into [0,1]
        vUV = (uv0 + 1.0) / 2.0;

        ${i?"":"vUV *= displacedPosScreen.w;"}

        ${t.hasTip?"vLineWidth = lineWidth;":""}

        vSize = screenMarkerSize;
        vColor = getColor();

        // Use camera space for slicing
        vpos = pos.xyz;

        gl_Position = displacedPosScreen;
      }
    }
  `),r&&e.include(vu,t),e.include(ps,t),n.uniforms.add(new sr("intrinsicColor",o=>o.color),new Je("tex",o=>o.markerTexture)),n.include(sm),e.constants.add("texelSize","float",1/Lb),n.code.add(b`float markerAlpha(vec2 samplePos) {
samplePos += vec2(0.5, -0.5) * texelSize;
float sdf = rgba2float(texture(tex, samplePos)) - 0.5;
float distance = sdf * vSize;
distance -= 0.5;
return clamp(0.5 - distance, 0.0, 1.0);
}`),t.hasTip&&(e.constants.add("relativeMarkerSize","float",ZY/Lb),e.constants.add("relativeTipLineWidth","float",flt),n.code.add(b`
    float tipAlpha(vec2 samplePos) {
      // Convert coordinates s.t. they are in pixels and relative to the tip of an arrow marker
      samplePos -= vec2(0.5, 0.5 + 0.5 * relativeMarkerSize);
      samplePos *= vSize;

      float halfMarkerSize = 0.5 * relativeMarkerSize * vSize;
      float halfTipLineWidth = 0.5 * max(1.0, relativeTipLineWidth * vLineWidth);

      ${i?"halfTipLineWidth *= fwidth(samplePos.y);":""}

      float distance = max(abs(samplePos.x) - halfMarkerSize, abs(samplePos.y) - halfTipLineWidth);
      return clamp(0.5 - distance, 0.0, 1.0);
    }
  `)),e.constants.add("symbolAlphaCutoff","float",go),n.code.add(b`
  void main() {
    discardBySlice(vpos);
    ${r?"terrainDepthTest(gl_FragCoord, depth);":""}

    vec4 finalColor = intrinsicColor * vColor;

    ${i?"vec2 samplePos = vUV;":"vec2 samplePos = vUV * gl_FragCoord.w;"}

    ${t.hasTip?"finalColor.a *= max(markerAlpha(samplePos), tipAlpha(samplePos));":"finalColor.a *= markerAlpha(samplePos);"}

    ${t.output===N.ObjectAndLayerIdColor?b`finalColor.a = 1.0;`:""}

    if (finalColor.a < symbolAlphaCutoff) {
      discard;
    }

    ${t.output===N.Alpha?b`fragColor = vec4(finalColor.a);`:""}
    ${t.output===N.Color?b`fragColor = highlightSlice(finalColor, vpos);`:""}
    ${t.output===N.Color&&t.transparencyPassType===ot.Color?"fragColor = premultiplyAlpha(fragColor);":""}
    ${t.output===N.Highlight?b`fragColor = vec4(1.0);`:""}
    ${t.output===N.Depth?b`outputDepth(linearDepth);`:""}
  }
  `),e}const Zut=Object.freeze(Object.defineProperty({__proto__:null,build:Wut},Symbol.toStringTag,{value:"Module"})),hCe=new Map([[E.POSITION,0],[E.UV0,2],[E.AUXPOS1,3],[E.NORMAL,4],[E.COLOR,5],[E.COLORFEATUREATTRIBUTE,5],[E.SIZE,6],[E.SIZEFEATUREATTRIBUTE,6],[E.OPACITYFEATUREATTRIBUTE,7]]);let dCe=class pCe extends Pr{initializeProgram(e){return new Cr(e.rctx,pCe.shader.get().build(this.configuration),hCe)}_makePipelineState(e,r){const i=this.configuration,s=e===ot.NONE;return At({blending:i.output===N.Color||i.output===N.Alpha?s?uu:oy(e):null,depthTest:{func:rv(e)},depthWrite:s?i.writeDepth?Ol:null:c6(e),colorWrite:Vt,stencilWrite:i.hasOccludees?Wf:null,stencilTest:i.hasOccludees?r?H_:iv:null,polygonOffset:{factor:0,units:-10}})}initializePipeline(){return this.configuration.occluder&&(this._occluderPipelineTransparent=At({blending:uu,depthTest:D4,depthWrite:null,colorWrite:Vt,stencilWrite:null,stencilTest:gEe}),this._occluderPipelineOpaque=At({blending:uu,depthTest:D4,depthWrite:null,colorWrite:Vt,stencilWrite:fEe,stencilTest:mEe}),this._occluderPipelineMaskWrite=At({blending:null,depthTest:XY,depthWrite:null,colorWrite:null,stencilWrite:Wf,stencilTest:H_})),this._occludeePipelineState=this._makePipelineState(this.configuration.transparencyPassType,!0),this._makePipelineState(this.configuration.transparencyPassType,!1)}getPipelineState(e,r){return r?this._occludeePipelineState:this.configuration.occluder?e===ue.TRANSPARENT_OCCLUDER_MATERIAL?this._occluderPipelineTransparent:e===ue.OCCLUDER_MATERIAL?this._occluderPipelineOpaque:this._occluderPipelineMaskWrite:super.getPipelineState(e,r)}};dCe.shader=new Er(Zut,()=>ae(()=>import("./LineMarker.glsl-13f76e60.js"),[],import.meta.url));let Xut=class extends tv{constructor(e){super(e,new Jut),this._vertexAttributeLocations=hCe,this._configuration=new co,this._layout=this.createLayout()}dispose(){}getConfiguration(e,r){return this._configuration.output=e,this._configuration.space=r.slot===ue.DRAPED_MATERIAL?hu.Draped:this.parameters.worldSpace?hu.World:hu.Screen,this._configuration.hideOnShortSegments=this.parameters.hideOnShortSegments,this._configuration.hasCap=this.parameters.cap!==xh.BUTT,this._configuration.anchor=this.parameters.anchor,this._configuration.hasTip=this.parameters.hasTip,this._configuration.hasSlicePlane=this.parameters.hasSlicePlane,this._configuration.hasOccludees=this.parameters.hasOccludees,this._configuration.writeDepth=this.parameters.writeDepth,this._configuration.vvSize=!!this.parameters.vvSize,this._configuration.vvColor=!!this.parameters.vvColor,this._configuration.vvOpacity=!!this.parameters.vvOpacity,this._configuration.occluder=this.parameters.renderOccluded===Mi.OccludeAndTransparentStencil,this._configuration.transparencyPassType=r.transparencyPassType,this._configuration.hasMultipassTerrain=r.multipassTerrain.enabled,this._configuration.cullAboveGround=r.multipassTerrain.cullAboveGround,this._configuration}intersect(){}createLayout(){const e=zi().vec3f(E.POSITION).vec2f(E.UV0).vec3f(E.AUXPOS1);return this.parameters.worldSpace&&e.vec3f(E.NORMAL),this.parameters.vvSize?e.f32(E.SIZEFEATUREATTRIBUTE):e.f32(E.SIZE),this.parameters.vvColor?e.f32(E.COLORFEATUREATTRIBUTE):e.vec4f(E.COLOR),this.parameters.vvOpacity&&e.f32(E.OPACITYFEATUREATTRIBUTE),e}createBufferWriter(){return new Qut(this._layout,this.parameters)}requiresSlot(e,r){return r===N.Color||r===N.Alpha||r===N.Highlight||r===N.Depth?e===ue.DRAPED_MATERIAL?!0:this.parameters.renderOccluded===Mi.OccludeAndTransparentStencil?e===ue.OPAQUE_MATERIAL||e===ue.OCCLUDER_MATERIAL||e===ue.TRANSPARENT_OCCLUDER_MATERIAL:r===N.Color||r===N.Alpha?e===(this.parameters.writeDepth?ue.TRANSPARENT_MATERIAL:ue.TRANSPARENT_DEPTH_WRITE_DISABLED_MATERIAL):e===ue.OPAQUE_MATERIAL:!1}createGLMaterial(e){return new Yut(e)}},Yut=class extends IX{constructor(){super(...arguments),this._markerPrimitive=null}dispose(){super.dispose(),this._markerTextureRepository.release(this._markerPrimitive),this._markerPrimitive=null}_updateParameters(e){const r=this._material.parameters.markerPrimitive;return r!==this._markerPrimitive&&(this._material.setParameters({markerTexture:this._markerTextureRepository.swap(r,this._markerPrimitive)}),this._markerPrimitive=r),this._material.setParameters(this.textureBindParameters),this.ensureTechnique(dCe,e)}_updateOccludeeState(e){e.hasOccludees!==this._material.parameters.hasOccludees&&this._material.setParameters({hasOccludees:e.hasOccludees})}beginSlot(e){return this._output!==N.Color&&this._output!==N.Alpha||this._updateOccludeeState(e),this._updateParameters(e)}},Jut=class extends aP{constructor(){super(...arguments),this.width=0,this.color=[1,1,1,1],this.markerPrimitive="arrow",this.placement="end",this.cap=xh.BUTT,this.anchor=mw.Center,this.hasTip=!1,this.worldSpace=!1,this.hideOnShortSegments=!1,this.writeDepth=!0,this.hasSlicePlane=!1,this.vvFastUpdate=!1,this.hasOccludees=!1,this.markerTexture=null}},Qut=class{constructor(e,r){this.vertexBufferLayout=e,this._parameters=r}elementCount(){return this._parameters.placement==="begin-end"?12:6}write(e,r,i,s,n){const o=i.vertexAttributes.get(E.POSITION).data,a=o.length/3;let l=[1,0,0];const c=i.vertexAttributes.get(E.NORMAL);this._parameters.worldSpace&&c!=null&&(l=c.data);let h=1,p=0;this._parameters.vvSize?p=i.vertexAttributes.get(E.SIZEFEATUREATTRIBUTE).data[0]:i.vertexAttributes.has(E.SIZE)&&(h=i.vertexAttributes.get(E.SIZE).data[0]);let f=[1,1,1,1],m=0;this._parameters.vvColor?m=i.vertexAttributes.get(E.COLORFEATUREATTRIBUTE).data[0]:i.vertexAttributes.has(E.COLOR)&&(f=i.vertexAttributes.get(E.COLOR).data);let y=0;this._parameters.vvOpacity&&(y=i.vertexAttributes.get(E.OPACITYFEATUREATTRIBUTE).data[0]);const _=new Float32Array(s.buffer);let v=n*(this.vertexBufferLayout.stride/4);const w=(O,A,I,M)=>{if(_[v++]=O[0],_[v++]=O[1],_[v++]=O[2],_[v++]=I[0],_[v++]=I[1],_[v++]=A[0],_[v++]=A[1],_[v++]=A[2],this._parameters.worldSpace&&(_[v++]=l[0],_[v++]=l[1],_[v++]=l[2]),this._parameters.vvSize?_[v++]=p:_[v++]=h,this._parameters.vvColor)_[v++]=m;else{const k=Math.min(4*M,f.length-4);_[v++]=f[k],_[v++]=f[k+1],_[v++]=f[k+2],_[v++]=f[k+3]}this._parameters.vvOpacity&&(_[v++]=y)};let x;(function(O){O[O.ASCENDING=1]="ASCENDING",O[O.DESCENDING=-1]="DESCENDING"})(x||(x={}));const T=(O,A)=>{const I=se(Kut,o[3*O],o[3*O+1],o[3*O+2]),M=eht;let k=O+A;do se(M,o[3*k],o[3*k+1],o[3*k+2]),k+=A;while(T_(I,M)&&k>=0&&k<a);e&&($e(I,I,e),$e(M,M,e)),w(I,M,[-1,-1],O),w(I,M,[1,-1],O),w(I,M,[1,1],O),w(I,M,[-1,-1],O),w(I,M,[1,1],O),w(I,M,[-1,1],O)},S=this._parameters.placement;S!=="begin"&&S!=="begin-end"||T(0,x.ASCENDING),S!=="end"&&S!=="begin-end"||T(a-1,x.DESCENDING)}};const Kut=C(),eht=C(),Xo={dash:[4,3],dot:[1,3],"long-dash":[8,3],"short-dash":[4,1],"short-dot":[1,1]},tht={dash:Xo.dash,"dash-dot":[...Xo.dash,...Xo.dot],dot:Xo.dot,"long-dash":Xo["long-dash"],"long-dash-dot":[...Xo["long-dash"],...Xo.dot],"long-dash-dot-dot":[...Xo["long-dash"],...Xo.dot,...Xo.dot],none:null,"short-dash":Xo["short-dash"],"short-dash-dot":[...Xo["short-dash"],...Xo["short-dot"]],"short-dash-dot-dot":[...Xo["short-dash"],...Xo["short-dot"],...Xo["short-dot"]],"short-dot":Xo["short-dot"],solid:null},rht=8;function iht(t,e){return t==null?t:{pattern:t.slice(),pixelRatio:e}}function hNt(t){return{pattern:[t,t],pixelRatio:2}}function fCe(t){return t!=null&&t.type==="style"?sht(t.style):null}function sht(t){return t!=null?iht(tht[t],rht):null}const nht=["polyline","polygon","extent"],Goe=new oP({size:!0,color:!0,rotation:!1,opacity:!0});let mCe=class gCe extends om{constructor(e,r,i,s){super(e,r,i,s)}async doLoad(){if(this._fastUpdates=$2(this._context.renderer,Goe),!this._drivenProperties.size&&(this.symbolLayer.size!=null?this.symbolLayer.size:fu(1))<0)throw new F("graphics3dlinesymbollayer:invalid-size","Symbol sizes may not be negative values")}_getMaterialParameters(e,r=!1){const i=this._getCombinedOpacityAndColor(r&&this._markerColor||this._materialColor);this._patternHidesLine&&!r&&(i[3]=0);const s={width:this._computeMaterialWidth(this.symbolLayer?.size),color:i,hasPolygonOffset:!0,join:this.symbolLayer.join||"miter",cap:bH(this.symbolLayer.cap||"butt"),hasSlicePlane:this._context.slicePlaneEnabled,isClosed:e,stipplePattern:fCe(this.symbolLayer.pattern),stippleScaleWithLineWidth:!0};return this._fastUpdates?.visualVariables?{...s,...this._fastUpdates.materialParameters}:s}get _materialColor(){return this.symbolLayer.material?.color}get _markerColor(){return this.symbolLayer.marker?.color}get _lineMaterial(){return this._lineMaterialCached==null&&(this._lineMaterialCached=new dS(this._getMaterialParameters(!1)),this._context.stage.add(this._lineMaterialCached)),this._lineMaterialCached}get _ringMaterial(){return this._ringMaterialCached==null&&(this._ringMaterialCached=new dS(this._getMaterialParameters(!0)),this._context.stage.add(this._ringMaterialCached)),this._ringMaterialCached}get _wireframeLineMaterial(){return this._wireframeLineMaterialCached==null&&(this._wireframeLineMaterialCached=new dS({...this._getMaterialParameters(!1),wireframe:!0}),this._context.stage.add(this._wireframeLineMaterialCached)),this._wireframeLineMaterialCached}get _wireframeRingMaterial(){return this._wireframeRingMaterialCached==null&&(this._wireframeRingMaterialCached=new dS({...this._getMaterialParameters(!0),wireframe:!0}),this._context.stage.add(this._wireframeRingMaterialCached)),this._wireframeRingMaterialCached}get _markerMaterial(){return this._markerMaterialCached==null&&this.symbolLayer.marker!=null&&(this._markerMaterialCached=new Xut({...this._getMaterialParameters(!1,!0),placement:this.symbolLayer.marker.placement,markerPrimitive:Boe(this.symbolLayer.marker.style)}),this._context.stage.add(this._markerMaterialCached)),this._markerMaterialCached}destroy(){super.destroy(),this._forEachMaterial(e=>this._context.stage.remove(e)),this._lineMaterialCached=null,this._ringMaterialCached=null,this._wireframeLineMaterialCached=null,this._wireframeRingMaterialCached=null,this._markerMaterialCached=null}_getDrivenSize(e){return this._drivenProperties.size&&e.size?Ms(Uat(e.size)):1}_getDrivenColor(e){const r=Lt(1,1,1,1);return this._drivenProperties.color&&e.color&&(r[0]=e.color[0],r[1]=e.color[1],r[2]=e.color[2],e.color.length>0&&(r[3]=e.color[3])),this._drivenProperties.opacity&&e.opacity&&(r[3]=e.opacity),r}createGraphics3DGraphic(e){const r=e.graphic;if(!this._validateGeometry(r.geometry,nht,this.symbolLayer.type))return null;const i=this.setGraphicElevationContext(r,new mp);return this.ensureDrapedStatus(i.mode==="on-the-ground"),this.draped?this._createAsOverlay(e,this._context.layer.uid):this._createAs3DShape(e,i,r.uid)}applyRendererDiff(e,r){for(const i in e.diff){if(i!=="visualVariables")return Is.RecreateSymbol;{const s=this._fastUpdates;if(!L2(s,r,Goe))return Is.RecreateSymbol;this._forEachMaterial(n=>n.setParameters(s.materialParameters))}}return Is.FastUpdate}prepareSymbolLayerPatch(e){if(e.diff.type!=="partial")return;const r=e.diff.diff,i={};r.size?.type==="complete"&&(i.width=this._computeMaterialWidth(r.size.newValue),delete r.size),r.cap?.type==="complete"&&(i.cap=bH(r.cap.newValue??"butt"),delete r.cap);const s=this._prepareMarkerPatch(e,r);this._prepareMaterialPatch(e,r,s),e.symbolLayerStatePatches.push(()=>this._forEachMaterial(n=>n.setParameters(i)))}layerOpacityChanged(){this._forEachMaterial((e,r)=>this._updateMaterialLayerOpacity(e,r))}_forEachMaterial(e){this._lineMaterialCached!=null&&e(this._lineMaterialCached),this._ringMaterialCached!=null&&e(this._ringMaterialCached),this._wireframeLineMaterialCached!=null&&e(this._wireframeLineMaterialCached),this._wireframeRingMaterialCached!=null&&e(this._wireframeRingMaterialCached),this._markerMaterialCached!=null&&e(this._markerMaterialCached,!0)}_updateMaterialLayerOpacity(e,r=!1){const i=e.parameters.color,s=this.symbolLayer?.material?.color,n=this._patternHidesLine&&!r?0:this._getCombinedOpacity(s),o=Lt(i[0],i[1],i[2],n);e.setParameters({color:o})}layerElevationInfoChanged(e,r,i){const s=this._elevationContext.mode,n=lP(gCe.elevationModeChangeTypes,i,s);if(n!==ns.UPDATE)return n;const o=Nh(s);return this.updateGraphics3DGraphicElevationInfo(e,r,()=>o)}slicePlaneEnabledChanged(){const e={hasSlicePlane:this._context.slicePlaneEnabled};return this._forEachMaterial(r=>r.setParameters(e)),!0}physicalBasedRenderingChanged(){return!0}_getGeometryAsPolygonOrPolyline(e){switch(e.type){case"extent":if(e instanceof _r)return Jd.fromExtent(e);break;case"polygon":case"polyline":return e}return null}_createAs3DShape(e,r,i){const s=e.graphic,n=this._getGeometryAsPolygonOrPolyline(s.geometry),o=n.type==="polygon"?n.rings:n.paths,a=new Array,l=pn(),c=Hut(n,this._context.elevationProvider,this._context.renderCoordsHelper,r),h=n.type==="polygon"?"rings":"paths";this._logGeometryCreationWarnings(c,o,h,"LineSymbol3DLayer");for(let m=0;m<c.lines.length;m++){const y=c.lines[m],_=y.position,v=y.mapPositions;if(this._context.clippingExtent!=null&&(xi(l),nu(l,v),!Gd(l,this._context.clippingExtent)))continue;const w=this._createGeometry(n.type==="polygon"?this._ringMaterial:this._lineMaterial,e,_,v,n.type,tO.ELEVATED,i);a.push(w),ni.LINE_WIREFRAMES&&a.push(w.instantiate({material:n.type==="polygon"?this._wireframeRingMaterial:this._wireframeLineMaterial})),this._markerMaterial!=null&&a.push(w.instantiate({material:this._markerMaterial}))}if(a.length===0)return null;const p=new ay({geometries:a,castShadow:!1,layerUid:this._context.layer.uid,graphicUid:i}),f=new nm(this,p,a,null,null,Oot,r);return f.alignedSampledElevation=c.sampledElevation,f.needsElevationUpdates=Nh(r.mode),f}_createGeometry(e,r,i,s,n,o,a){const l=o===tO.DRAPED?{spatialReference:this._context.overlaySR,renderCoordsHelper:this._context.renderCoordsHelper}:null,c=n==="polygon",h=this._fastUpdates?.visualVariables.color,p=this._fastUpdates?.visualVariables.size,f=this._fastUpdates?.visualVariables.opacity,m=this._context.stage.renderView.getObjectAndLayerIdColor({graphicUid:a,layerUid:this._context.layer.uid}),y={position:i,size:p?null:this._getDrivenSize(r.renderingInfo),color:h?null:this._getDrivenColor(r.renderingInfo),sizeFeature:p?tp(p.field,r.graphic):null,colorFeature:h?tp(h.field,r.graphic):null,opacityFeature:f?tp(f.field,r.graphic):null};return wH(e,{overlayInfo:l,removeDuplicateStartEnd:c,mapPositions:s,attributeData:y},m)}_createAsOverlay(e,r){const i=e.graphic,s=this._getGeometryAsPolygonOrPolyline(i.geometry),n=s.type==="polygon"?s.rings:s.paths,o=s.type==="polygon"?this._ringMaterial:this._lineMaterial;o.renderPriority=this._renderPriority;const a=ni.LINE_WIREFRAMES?s.type==="polygon"?this._wireframeRingMaterial:this._wireframeLineMaterial:null,l=this._markerMaterial;a!=null&&(a.renderPriority=this._renderPriority-.001),l!=null&&(l.renderPriority=this._renderPriority-.002);const c=new Array,h=pn(),p=xi(),f=qut(s,this._context.overlaySR),m=s.type==="polygon"?"rings":"paths";this._logGeometryCreationWarnings(f,n,m,"LineSymbol3DLayer");for(const y of f.lines){if(xi(h),nu(h,y.position),!Gd(h,this._context.clippingExtent))continue;n2(p,h);const _=v=>{const w=this._createGeometry(v,e,y.position,void 0,s.type,tO.DRAPED,i.uid),x=new k2(w,{layerUid:r,graphicUid:i.uid});c.push(x)};if(l!=null){_(l);const v=this.symbolLayer.marker.placement;v!=="begin"&&v!=="begin-end"||nu(h,y.position,0,1),v!=="end"&&v!=="begin-end"||nu(h,y.position,y.position.length-3,1)}_(o),ni.LINE_WIREFRAMES&&_(a)}return new S6(this,c,p,this._context.drapeSourceRenderer)}get _patternHidesLine(){const e=this.symbolLayer.pattern;return e!=null&&e.type==="style"&&e.style==="none"}_computeMaterialWidth(e){return e=e??fu(1),this._drivenProperties.size?this._fastUpdates?.visualVariables.size?Ms(1):1:Ms(e)}_prepareMaterialPatch(e,r,i){const s=r.material;if(s==null)return void(i.changed&&i.useMaterialColor&&this._patchMaterialColor(this._getCombinedOpacityAndColor(this._materialColor),this._markerMaterialCached,e));if(s.type==="collection")return;const n=s.type==="complete"?s.newValue?.color:s.diff.color?.type==="complete"?s.diff.color.newValue:null,o=this._getCombinedOpacityAndColor(n);i.useMaterialColor&&this._patchMaterialColor(VR(o),this._markerMaterialCached,e),this._patternHidesLine&&(o[3]=0),this._patchMaterialColor(o,this._lineMaterialCached,e),delete r.material}_prepareMarkerPatch(e,r){const i=r.marker,s=this._markerMaterial;if(i==null||i.type!=="partial"||i.diff==null||i.diff.placement!=null||i.diff.style!=null&&i.diff.style.type!=="complete"||i.diff.color!=null&&i.diff.color.type!=="complete"||s==null)return{changed:!1,useMaterialColor:this._markerColor==null};const n=i.diff.color,o=n!=null,a=o?n.newValue:null,l=a==null&&this._markerColor==null;a&&this._patchMaterialColor(this._getCombinedOpacityAndColor(a),s,e);const c=i.diff.style?.newValue;return c&&e.symbolLayerStatePatches.push(()=>s.setParameters({markerPrimitive:Boe(c)})),delete r.marker,{changed:o,useMaterialColor:l}}_patchMaterialColor(e,r,i){r!=null&&i.symbolLayerStatePatches.push(()=>r.setParameters({color:e}))}};var tO;mCe.elevationModeChangeTypes={definedChanged:ns.RECREATE,staysOnTheGround:ns.NONE,onTheGroundChanged:ns.RECREATE},function(t){t[t.DRAPED=0]="DRAPED",t[t.ELEVATED=1]="ELEVATED"}(tO||(tO={}));let gC=null,U4=!0;function R9(t,e,r){if(!t||!e)throw new Error("Cannot construct image data without dimensions");if(U4)try{return new ImageData(t,e)}catch{U4=!1}return yCe(t,e,r)}function oht(t,e,r,i){if(!e||!r)throw new Error("Cannot construct image data without dimensions");if(U4)try{return new ImageData(t,e,r)}catch{U4=!1}const s=yCe(e,r,i);return s.data.set(t,0),s}function aht(){return gC||(gC=document.createElement("canvas"),gC.width=1,gC.height=1),gC}function yCe(t,e,r){return r||(r=aht()),r.getContext("2d").createImageData(t,e)}var VT;const P9=new WeakMap;let lht=0,ef=VT=class extends de{constructor(t){super(t),this.wrap="repeat"}get url(){return this._get("url")||null}set url(t){this._set("url",t),t&&this._set("data",null)}get data(){return this._get("data")||null}set data(t){this._set("data",t),t&&this._set("url",null)}writeData(t,e,r,i){if(t instanceof HTMLImageElement){const s={type:"image-element",src:Ng(t.src,i),crossOrigin:t.crossOrigin};e[r]=s}else if(t instanceof HTMLCanvasElement){const s=t.getContext("2d").getImageData(0,0,t.width,t.height),n={type:"canvas-element",imageData:this._encodeImageData(s)};e[r]=n}else if(t instanceof HTMLVideoElement){const s={type:"video-element",src:Ng(t.src,i),autoplay:t.autoplay,loop:t.loop,muted:t.muted,crossOrigin:t.crossOrigin,preload:t.preload};e[r]=s}else if(t instanceof ImageData){const s={type:"image-data",imageData:this._encodeImageData(t)};e[r]=s}}readData(t){switch(t.type){case"image-element":{const e=new Image;return e.src=t.src,e.crossOrigin=t.crossOrigin,e}case"canvas-element":{const e=this._decodeImageData(t.imageData),r=document.createElement("canvas");return r.width=e.width,r.height=e.height,r.getContext("2d").putImageData(e,0,0),r}case"image-data":return this._decodeImageData(t.imageData);case"video-element":{const e=document.createElement("video");return e.src=t.src,e.crossOrigin=t.crossOrigin,e.autoplay=t.autoplay,e.loop=t.loop,e.muted=t.muted,e.preload=t.preload,e}default:return}}get transparent(){const t=this.data,e=this.url;if(t instanceof HTMLCanvasElement)return this._imageDataContainsTransparent(t.getContext("2d").getImageData(0,0,t.width,t.height));if(t instanceof ImageData)return this._imageDataContainsTransparent(t);if(e){const r=e.substr(e.length-4,4).toLowerCase(),i=e.substr(0,15).toLocaleLowerCase();if(r===".png"||i==="data:image/png;")return!0}return!1}set transparent(t){this._overrideIfSome("transparent",t)}get contentHash(){const t=typeof this.wrap=="string"?this.wrap:typeof this.wrap=="object"?`${this.wrap.horizontal}/${this.wrap.vertical}`:"",e=(r="")=>`d:${r},t:${this.transparent},w:${t}`;return this.url!=null?e(this.url):this.data!=null?this.data instanceof HTMLImageElement||this.data instanceof HTMLVideoElement?e(this.data.src):(P9.has(this.data)||P9.set(this.data,++lht),e(P9.get(this.data))):e()}get memoryUsage(){let t=0;if(t+=this.url!=null?this.url.length:0,this.data!=null){const e=this.data;"data"in e?t+=e.data.byteLength:e instanceof HTMLImageElement?t+=e.naturalWidth*e.naturalHeight*3:e instanceof HTMLCanvasElement&&(t+=e.width*e.height*3)}return t}clone(){const t={url:this.url,data:this.data,wrap:this._cloneWrap()};return new VT(t)}cloneWithDeduplication(t){const e=t.get(this);if(e)return e;const r=this.clone();return t.set(this,r),r}_cloneWrap(){return typeof this.wrap=="string"?this.wrap:{horizontal:this.wrap.horizontal,vertical:this.wrap.vertical}}_encodeImageData(t){let e="";for(let r=0;r<t.data.length;r++)e+=String.fromCharCode(t.data[r]);return{data:btoa(e),width:t.width,height:t.height}}_decodeImageData(t){const e=atob(t.data),r=new Uint8ClampedArray(e.length);for(let i=0;i<e.length;i++)r[i]=e.charCodeAt(i);return oht(r,t.width,t.height)}_imageDataContainsTransparent(t){for(let e=3;e<t.data.length;e+=4)if(t.data[e]!==255)return!0;return!1}static from(t){return typeof t=="string"?new VT({url:t}):t instanceof HTMLImageElement||t instanceof HTMLCanvasElement||t instanceof ImageData||t instanceof HTMLVideoElement?new VT({data:t}):Bb(VT,t)}};u([d({type:String,json:{write:O_}})],ef.prototype,"url",null),u([d({json:{write:{overridePolicy(){return{enabled:!this.url}}}}}),d()],ef.prototype,"data",null),u([Fe("data")],ef.prototype,"writeData",null),u([Ee("data")],ef.prototype,"readData",null),u([d({type:Boolean,json:{write:{overridePolicy(){return{enabled:this._isOverridden("transparent")}}}}})],ef.prototype,"transparent",null),u([d({json:{write:!0}})],ef.prototype,"wrap",void 0),u([d({readOnly:!0})],ef.prototype,"contentHash",null),ef=VT=u([R("esri.geometry.support.MeshTexture")],ef);const rO=ef;let zT=class extends Vi(de){constructor(e){super(e),this.offset=[0,0],this.rotation=0,this.scale=[1,1]}};u([d({type:[Number],nonNullable:!0,json:{write:!0}})],zT.prototype,"offset",void 0),u([d({type:Number,nonNullable:!0,json:{write:!0}})],zT.prototype,"rotation",void 0),u([d({type:[Number],nonNullable:!0,json:{write:!0}})],zT.prototype,"scale",void 0),zT=u([R("esri.geometry.support.MeshTextureTransform")],zT);const GS=zT;var xH;let bd=xH=class extends de{constructor(t){super(t),this.color=null,this.colorTexture=null,this.colorTextureTransform=null,this.normalTexture=void 0,this.normalTextureTransform=void 0,this.alphaMode="auto",this.alphaCutoff=.5,this.doubleSided=!0}clone(){return this.cloneWithDeduplication(null,new Map)}cloneWithDeduplication(t,e){const r=t!=null?t.get(this):null;if(r)return r;const i=new xH(this.clonePropertiesWithDeduplication(e));return t?.set(this,i),i}clonePropertiesWithDeduplication(t){return{color:this.color!=null?this.color.clone():null,colorTexture:this.colorTexture?.cloneWithDeduplication(t),normalTexture:this.normalTexture?.cloneWithDeduplication(t),alphaMode:this.alphaMode,alphaCutoff:this.alphaCutoff,doubleSided:this.doubleSided,colorTextureTransform:this.colorTextureTransform?.clone(),normalTextureTransform:this.normalTextureTransform?.clone()}}get memoryUsage(){return this.getMemoryUsage()}getMemoryUsage(){let t=0;return t+=this.color!=null?16:0,this.colorTexture!=null&&(t+=this.colorTexture.memoryUsage),t+=this.colorTextureTransform!=null?20:0,this.normalTexture!=null&&(t+=this.normalTexture.memoryUsage),t+=this.normalTextureTransform!=null?20:0,t}};u([d({type:ze,json:{write:!0}})],bd.prototype,"color",void 0),u([d({type:rO,json:{write:!0}})],bd.prototype,"colorTexture",void 0),u([d({type:GS,json:{write:!0}})],bd.prototype,"colorTextureTransform",void 0),u([d({type:rO,json:{write:!0}})],bd.prototype,"normalTexture",void 0),u([d({type:GS,json:{write:!0}})],bd.prototype,"normalTextureTransform",void 0),u([d({nonNullable:!0,json:{write:!0}})],bd.prototype,"alphaMode",void 0),u([d({nonNullable:!0,json:{write:!0}})],bd.prototype,"alphaCutoff",void 0),u([d({nonNullable:!0,json:{write:!0}})],bd.prototype,"doubleSided",void 0),bd=xH=u([R("esri.geometry.support.MeshMaterial")],bd);const dJ=bd;var TH;let Wu=TH=class extends dJ{constructor(t){super(t),this.emissiveColor=null,this.emissiveTexture=null,this.emissiveTextureTransform=void 0,this.occlusionTexture=null,this.occlusionTextureTransform=void 0,this.metallic=1,this.roughness=1,this.metallicRoughnessTexture=null,this.metallicRoughnessTextureTransform=void 0}clone(){return this.cloneWithDeduplication(null,new Map)}cloneWithDeduplication(t,e){const r=t!=null?t.get(this):null;if(r)return r;const i=new TH(this.clonePropertiesWithDeduplication(e));return t?.set(this,i),i}getMemoryUsage(){let t=super.getMemoryUsage();return t+=this.emissiveColor!=null?16:0,this.emissiveTexture!=null&&(t+=this.emissiveTexture.memoryUsage),t+=this.emissiveTextureTransform!=null?20:0,this.occlusionTexture!=null&&(t+=this.occlusionTexture.memoryUsage),t+=this.occlusionTextureTransform!=null?20:0,this.metallicRoughnessTexture!=null&&(t+=this.metallicRoughnessTexture.memoryUsage),t+=this.metallicRoughnessTextureTransform!=null?20:0,t}clonePropertiesWithDeduplication(t){return{...super.clonePropertiesWithDeduplication(t),emissiveColor:this.emissiveColor?.clone(),emissiveTexture:this.emissiveTexture?.cloneWithDeduplication(t),emissiveTextureTransform:this.emissiveTextureTransform?.clone(),occlusionTexture:this.occlusionTexture?.cloneWithDeduplication(t),occlusionTextureTransform:this.occlusionTextureTransform?.clone(),metallic:this.metallic,roughness:this.roughness,metallicRoughnessTexture:this.metallicRoughnessTexture?.cloneWithDeduplication(t),metallicRoughnessTextureTransform:this.metallicRoughnessTextureTransform?.clone()}}};u([d({type:ze,json:{write:!0}})],Wu.prototype,"emissiveColor",void 0),u([d({type:rO,json:{write:!0}})],Wu.prototype,"emissiveTexture",void 0),u([d({type:GS,json:{write:!0}})],Wu.prototype,"emissiveTextureTransform",void 0),u([d({type:rO,json:{write:!0}})],Wu.prototype,"occlusionTexture",void 0),u([d({type:GS,json:{write:!0}})],Wu.prototype,"occlusionTextureTransform",void 0),u([d({type:Number,nonNullable:!0,json:{write:!0},range:{min:0,max:1}})],Wu.prototype,"metallic",void 0),u([d({type:Number,nonNullable:!0,json:{write:!0},range:{min:0,max:1}})],Wu.prototype,"roughness",void 0),u([d({type:rO,json:{write:!0}})],Wu.prototype,"metallicRoughnessTexture",void 0),u([d({type:GS,json:{write:!0}})],Wu.prototype,"metallicRoughnessTextureTransform",void 0),Wu=TH=u([R("esri.geometry.support.MeshMaterialMetallicRoughness")],Wu);const _Ce=Wu;var dD;const vCe="esri.geometry.support.MeshVertexAttributes",Px=Q.getLogger(vCe);let Pu=dD=class extends de{constructor(t){super(t),this.color=null,this.position=new Float64Array(0),this.uv=null,this.normal=null,this.tangent=null}castColor(t){return BT(t,Uint8Array,[Uint8ClampedArray],{loggerTag:".color=",stride:4},Px)}castPosition(t){return t&&t instanceof Float32Array&&Px.warn(".position=","Setting position attribute from a Float32Array may cause precision problems. Consider storing data in a Float64Array or a regular number array"),BT(t,Float64Array,[Float32Array],{loggerTag:".position=",stride:3},Px)}castUv(t){return BT(t,Float32Array,[Float64Array],{loggerTag:".uv=",stride:2},Px)}castNormal(t){return BT(t,Float32Array,[Float64Array],{loggerTag:".normal=",stride:3},Px)}castTangent(t){return BT(t,Float32Array,[Float64Array],{loggerTag:".tangent=",stride:4},Px)}clone(){const t={position:K(this.position),uv:K(this.uv),normal:K(this.normal),tangent:K(this.tangent),color:K(this.color)};return new dD(t)}clonePositional(){const t={position:K(this.position),normal:K(this.normal),tangent:K(this.tangent),uv:this.uv,color:this.color};return new dD(t)}get memoryUsage(){let t=0;return t+=this.position.byteLength,this.uv!=null&&(t+=this.uv.byteLength),this.normal!=null&&(t+=this.normal.byteLength),this.tangent!=null&&(t+=this.tangent.byteLength),this.color!=null&&(t+=this.color.byteLength),t}};function M9(t,e,r,i){const{loggerTag:s,stride:n}=e;return t.length%n!=0?(i.error(s,`Invalid array length, expected a multiple of ${n}`),new r([])):t}function BT(t,e,r,i,s){if(!t)return t;if(t instanceof e)return M9(t,i,e,s);for(const n of r)if(t instanceof n)return M9(new e(t),i,e,s);if(Array.isArray(t))return M9(new e(t),i,e,s);{const n=r.map(o=>`'${o.name}'`);return s.error(`Failed to set property, expected one of ${n}, but got ${t.constructor.name}`),new e([])}}function yC(t,e,r){e[r]=cht(t)}function cht(t){const e=new Array(t.length);for(let r=0;r<t.length;r++)e[r]=t[r];return e}u([d({json:{write:yC}})],Pu.prototype,"color",void 0),u([yr("color")],Pu.prototype,"castColor",null),u([d({nonNullable:!0,json:{write:yC}})],Pu.prototype,"position",void 0),u([yr("position")],Pu.prototype,"castPosition",null),u([d({json:{write:yC}})],Pu.prototype,"uv",void 0),u([yr("uv")],Pu.prototype,"castUv",null),u([d({json:{write:yC}})],Pu.prototype,"normal",void 0),u([yr("normal")],Pu.prototype,"castNormal",null),u([d({json:{write:yC}})],Pu.prototype,"tangent",void 0),u([yr("tangent")],Pu.prototype,"castTangent",null),Pu=dD=u([R(vCe)],Pu);var KA;const bCe="esri.geometry.support.MeshComponent",uht=Q.getLogger(bCe);let qm=KA=class extends de{static from(t){return Bb(KA,t)}constructor(t){super(t),this.faces=null,this.material=null,this.shading="source",this.trustSourceNormals=!1}castFaces(t){return BT(t,Uint32Array,[Uint16Array],{loggerTag:".faces=",stride:3},uht)}castMaterial(t){return Bb(t&&typeof t=="object"&&("metallic"in t||"roughness"in t||"metallicRoughnessTexture"in t)?_Ce:dJ,t)}clone(){return new KA({faces:K(this.faces),shading:this.shading,material:K(this.material),trustSourceNormals:this.trustSourceNormals})}cloneWithDeduplication(t,e){const r={faces:K(this.faces),shading:this.shading,material:this.material?this.material.cloneWithDeduplication(t,e):null,trustSourceNormals:this.trustSourceNormals};return new KA(r)}get memoryUsage(){let t=0;return this.faces!=null&&(t+=this.faces.byteLength),this.material!=null&&(t+=this.material.memoryUsage),t}};u([d({json:{write:!0}})],qm.prototype,"faces",void 0),u([yr("faces")],qm.prototype,"castFaces",null),u([d({type:dJ,json:{write:!0}})],qm.prototype,"material",void 0),u([yr("material")],qm.prototype,"castMaterial",null),u([d({type:String,json:{write:!0}})],qm.prototype,"shading",void 0),u([d({type:Boolean})],qm.prototype,"trustSourceNormals",void 0),qm=KA=u([R(bCe)],qm);const hht=qm,E6=Q.getLogger("esri.geometry.support.meshUtils.normalProjection");function dht(t,e,r,i,s){return A6(i)?(C6(Cg.TO_PCPF,dn.fromTypedArray(t),Lh.fromTypedArray(e),Lh.fromTypedArray(r),i,dn.fromTypedArray(s)),s):(E6.error("Cannot convert spatial reference to PCPF"),s)}function pNt(t,e,r,i,s){return A6(i)?(C6(Cg.FROM_PCPF,dn.fromTypedArray(t),Lh.fromTypedArray(e),Lh.fromTypedArray(r),i,dn.fromTypedArray(s)),s):(E6.error("Cannot convert to spatial reference from PCPF"),s)}function fNt(t,e,r){return oi(t,e,0,r,Gf(e),0,t.length/3),r}function mNt(t,e,r){return oi(t,Gf(r),0,e,r,0,t.length/3),e}function pht(t,e,r){return L_(jn,r),fw(e,t,jn),iX(jn)||y6(e,e),e}function fht(t,e,r){if(L_(jn,r),fw(e,t,jn,4),iX(jn)||y6(e,e,4),t!==e)for(let i=3;i<t.length;i+=4)e[i]=t[i];return e}function mht(t,e,r,i,s){if(!A6(i))return E6.error("Cannot convert spatial reference to PCPF"),s;C6(Cg.TO_PCPF,dn.fromTypedArray(t,4*Float32Array.BYTES_PER_ELEMENT),Lh.fromTypedArray(e),Lh.fromTypedArray(r),i,dn.fromTypedArray(s,4*Float32Array.BYTES_PER_ELEMENT));for(let n=3;n<t.length;n+=4)s[n]=t[n];return s}function gNt(t,e,r,i,s){if(!A6(i))return E6.error("Cannot convert to spatial reference from PCPF"),s;C6(Cg.FROM_PCPF,dn.fromTypedArray(t,16),Lh.fromTypedArray(e),Lh.fromTypedArray(r),i,dn.fromTypedArray(s,16));for(let n=3;n<t.length;n+=4)s[n]=t[n];return s}function C6(t,e,r,i,s,n){if(!e)return;const o=r.count,a=Gf(s);if(wCe(s))for(let l=0;l<o;l++)i.getVec(l,UI),e.getVec(l,Mp),Tl(a,UI,kI,a),Ph(jn,kI),t===Cg.FROM_PCPF&&Mh(jn,jn),hc(Mp,Mp,jn),n.setVec(l,Mp);else for(let l=0;l<o;l++){i.getVec(l,UI),e.getVec(l,Mp),Tl(a,UI,kI,a),Ph(jn,kI);const c=QD(r.get(l,1));let h=Math.cos(c);t===Cg.TO_PCPF&&(h=1/h),jn[0]*=h,jn[1]*=h,jn[2]*=h,jn[3]*=h,jn[4]*=h,jn[5]*=h,t===Cg.FROM_PCPF&&Mh(jn,jn),hc(Mp,Mp,jn),me(Mp,Mp),n.setVec(l,Mp)}return n}function A6(t){return wCe(t)||ght(t)}function wCe(t){return t.isWGS84||Xpe(t)||Qf(t)||Kf(t)}function ght(t){return t.isWebMercator}var Cg;(function(t){t[t.TO_PCPF=0]="TO_PCPF",t[t.FROM_PCPF=1]="FROM_PCPF"})(Cg||(Cg={}));const UI=C(),Mp=C(),kI=be(),jn=Li();var iO;(function(t){t[t.EnableFastUpdates=0]="EnableFastUpdates",t[t.DisableFastUpdates=1]="DisableFastUpdates",t[t.UpdateFastLocalOrigin=2]="UpdateFastLocalOrigin"})(iO||(iO={}));let xCe=class{constructor(e){this.data=e,this.type="encoded-mesh-texture",this.encoding=xg.KTX2_ENCODING}};function Fb(t){return t?.type==="encoded-mesh-texture"}async function yht(t){return new Promise((e,r)=>{const i=new Blob([t]),s=new FileReader;s.onload=()=>{const n=s.result;e(JSON.parse(n))},s.onerror=n=>{r(n)},s.readAsText(i)})}async function _ht(t,e){return e===xg.KTX2_ENCODING?new xCe(t):new Promise((r,i)=>{const s=new Blob([t],{type:e}),n=URL.createObjectURL(s),o=new Image,a=()=>{URL.revokeObjectURL(n),"decode"in o?o.decode().then(()=>r(o),()=>r(o)).then(c):(r(o),c())},l=h=>{URL.revokeObjectURL(n),i(h),c()},c=()=>{o.removeEventListener("load",a),o.removeEventListener("error",l)};o.addEventListener("load",a),o.addEventListener("error",l),o.src=n})}function vf(t){if(t==null)return null;const e=t.offset!=null?t.offset:$2e,r=t.rotation!=null?t.rotation:0,i=t.scale!=null?t.scale:L2e,s=uD(1,0,0,0,1,0,e[0],e[1],1),n=uD(Math.cos(r),-Math.sin(r),0,Math.sin(r),Math.cos(r),0,0,0,1),o=uD(i[0],0,0,0,i[1],0,0,0,1),a=El();return g2(a,n,o),g2(a,s,a),a}Q.getLogger("esri.views.3d.layers.graphics.Graphics3DMeshObject3DGraphicLayer");let vht=class extends nm{constructor(){super(...arguments),this._originalGeometries=[],this._fastTransformUpdatesEnabled=!1}get fastTransformUpdatesEnabled(){return this._fastTransformUpdatesEnabled}enableFastTransformUpdates(e,r){if(this._fastTransformUpdatesEnabled)return;this._fastTransformUpdatesEnabled=!0;const{stageObject:i}=this,s=i.geometries.slice();i.removeAllGeometries();const n=jB(I9,i.transformation),o=r.getOrigin(n);for(const a of s){const l=e(a.material),c=a.instantiate({material:l});c.localOrigin=o,i.addGeometry(c)}this._originalGeometries=s}disableFastTransformUpdates(e){if(!this._fastTransformUpdatesEnabled)return;this._fastTransformUpdatesEnabled=!1;const{stageObject:r}=this,i=r.geometries.map(s=>e(s.material));r.removeAllGeometries();for(let s=0;s<this._originalGeometries.length;s++){const n=this._originalGeometries[s],o=i[s];o.setParameters({modelTransformation:null}),o===n.material?r.addGeometry(n):r.addGeometry(n.instantiate({material:o}))}this._originalGeometries.length=0}updateFastLocalOrigin(e,r,i){if(!this._fastTransformUpdatesEnabled)return;const{stageObject:s}=this;if(s.geometries.length===0)return;const n=s.geometries[0].localOrigin,o=jB(I9,e),a=i.getOrigin(o);if(a===n)return;const l=r?.localMatrix??un;s.clearShaderTransformation(),s.transformation=e,s.geometries.forEach(c=>{c.transformation=l,c.localOrigin=a})}updateTransform(e,r,i){const{stageObject:s}=this,n=r?.localMatrix??un;if(!this._fastTransformUpdatesEnabled)return s.clearShaderTransformation(),s.transformation=e,s.geometries.forEach(m=>{m.transformation=n}),void this.resetEdgeObject(i);const o=s.transformation,a=s.geometries[0].transformation,l=e,c=n,h=si(joe,o,a),p=si(Hoe,l,c);s.shaderTransformation=l,this._setFastMaterialTransformation({matA:h,matB:p});const f=()=>c;for(const m of s.geometries)m.shaderTransformer=f;this.resetEdgeObject(i)}alignWithElevation(e,r,i,s){if(!this._fastTransformUpdatesEnabled)return void super.alignWithElevation(e,r,i,s);i!=null&&f6(this.elevationContext.featureExpressionInfoContext,i);const n=(m,y)=>B_(m,e,this.elevationContext,r,y),{stageObject:o}=this;if(!o.geometries[0].material.parameters.modelTransformation)return;const a=o.transformation,l=o.geometries[0].transformation,c=si(joe,a,l),h=Ls(bht,o.shaderTransformation);this.alignedSampledElevation=$b(this,this.elevationContext,e.spatialReference,n,r,h),o.shaderTransformation=h;const p=o.geometries[0].shaderTransformation,f=si(Hoe,h,p);this._setFastMaterialTransformation({matA:c,matB:f}),this.resetEdgeObject(s)}_setFastMaterialTransformation({matA:e,matB:r}){const{stageObject:i}=this;if(i.geometries.length===0)return;const s=i.geometries[0].localOrigin,n=zR(wht,te(I9,s.vec3,-1)),o=si(qoe,n,e),a=si(Woe,n,r),l=On(qoe,o),c=si(Woe,a,l);for(const h of i.geometries)h.material.setParameters({modelTransformation:c})}};const I9=C(),joe=be(),Hoe=be(),bht=be(),qoe=be(),Woe=be(),wht=be();let xht=class{constructor(){this._fastTransformOriginalMaterials=new Map,this._fastTransformClonedMaterials=new Map,this._graphicReferenceCount=0}enable(e,r,i){e.enableFastTransformUpdates(s=>{if(this._graphicReferenceCount<=1){if(this._fastTransformOriginalMaterials.has(s))return s;const o=r.byMaterial(s);return this._fastTransformOriginalMaterials.set(s,o),r.delete(s),s}const n=new Zf(s.parameters);return i.stage.add(n),this._fastTransformClonedMaterials.set(n,s),n},i.localOriginFactory)}disable(e,r,i){const s=new Set,n=new Set;e.disableFastTransformUpdates(o=>{if(!this._fastTransformClonedMaterials.has(o)){const c=o,h=this._fastTransformOriginalMaterials.get(c);return r.has(h.uid)?(s.add(c),r.byUid(h.uid).material):(n.add(c),h.material)}const a=o,l=this._fastTransformClonedMaterials.get(a);return this._fastTransformClonedMaterials.delete(a),i.stage.remove(a),a.dispose(),l});for(const o of s)this._fastTransformOriginalMaterials.delete(o),i.stage.remove(o),o.dispose();for(const o of n){const a=this._fastTransformOriginalMaterials.get(o);this._fastTransformOriginalMaterials.delete(o),r.set(a.uid,a)}}onAddGraphic(){this._graphicReferenceCount++}onRemoveGraphic(e,r,i){this._graphicReferenceCount--,this.disable(e,r,i)}forEachMaterialInfo(e){this._fastTransformOriginalMaterials.forEach(e)}forEachClonedMaterial(e){this._fastTransformClonedMaterials.forEach(e)}destroy(e){e.removeMany(Array.from(this._fastTransformClonedMaterials.keys())),e.removeMany(Array.from(this._fastTransformOriginalMaterials.values(),({material:r})=>r)),this._fastTransformClonedMaterials.clear(),this._fastTransformOriginalMaterials.clear()}},Tht=class{constructor(){this._byUid=new Map,this._byMaterial=new Map}get materials(){return Array.from(this._byUid.values(),e=>e.material)}byUid(e){return this._byUid.get(e)}byMaterial(e){return this._byMaterial.get(e)}set(e,r){this._byUid.set(e,r),this._byMaterial.set(r.material,r)}delete(e){const r=this._byMaterial.get(e)?.uid;r&&(this._byUid.delete(r),this._byMaterial.delete(e))}has(e){return this._byUid.has(e)}forEachMaterialInfo(e){this._byUid.forEach(e)}clear(){this._byUid.clear(),this._byMaterial.clear()}};function Sht(t){const e=new wr,{vertex:r,fragment:i}=e;return e.include(xl,t),e.include(Bw,t),e.include(hEe,t),vc(r,t),t.stippleEnabled&&(e.attributes.add(E.UV0,"vec2"),e.attributes.add(E.AUXPOS1,"vec3"),r.uniforms.add(new sr("viewport",(s,n)=>n.camera.fullViewport))),e.attributes.add(E.POSITION,"vec3"),e.varyings.add("vpos","vec3"),r.code.add(b`void main(void) {
vpos = position;
forwardNormalizedVertexColor();
gl_Position = transformPosition(proj, view, vpos);`),t.stippleEnabled&&(r.code.add(b`vec4 vpos2 = transformPosition(proj, view, auxpos1);
vec2 ndcToPixel = viewport.zw * 0.5;
float lineSegmentPixelSize = length((vpos2.xy / vpos2.w - gl_Position.xy / gl_Position.w) * ndcToPixel);`),t.draped?r.uniforms.add(new Re("worldToScreenRatio",(s,n)=>1/n.screenToPCSRatio)):r.code.add(b`vec3 segmentCenter = (position + auxpos1) * 0.5;
float worldToScreenRatio = computeWorldToScreenRatio(segmentCenter);`),r.code.add(b`float discreteWorldToScreenRatio = discretizeWorldToScreenRatio(worldToScreenRatio);`),t.draped?r.code.add(b`float startPseudoScreen = uv0.y * discreteWorldToScreenRatio - mix(0.0, lineSegmentPixelSize, uv0.x);
float segmentLengthPseudoScreen = lineSegmentPixelSize;`):r.code.add(b`float segmentLengthRender = length(position - auxpos1);
float startPseudoScreen = mix(uv0.y, uv0.y - segmentLengthRender, uv0.x) * discreteWorldToScreenRatio;
float segmentLengthPseudoScreen = segmentLengthRender * discreteWorldToScreenRatio;`),r.uniforms.add(new Re("stipplePatternPixelSize",s=>WY(s))),r.code.add(b`vec2 stippleDistanceLimits = computeStippleDistanceLimits(startPseudoScreen, segmentLengthPseudoScreen, lineSegmentPixelSize, stipplePatternPixelSize);
vStippleDistance = mix(stippleDistanceLimits.x, stippleDistanceLimits.y, uv0.x);
vStippleDistance *= gl_Position.w;`)),r.code.add(b`}`),t.output===N.Highlight&&e.include(ny,t),e.include(ps,t),i.uniforms.add(new Re("alphaCoverage",(s,n)=>Math.min(1,s.width*n.camera.pixelRatio))),t.hasVertexColors||i.uniforms.add(new sr("constantColor",s=>s.color)),i.code.add(b`
  void main() {
    discardBySlice(vpos);

    vec4 color = ${t.hasVertexColors?"vColor":"constantColor"};

    float stippleAlpha = getStippleAlpha();
    discardByStippleAlpha(stippleAlpha, stippleAlphaColorDiscard);

    vec4 finalColor = blendStipple(vec4(color.rgb, color.a * alphaCoverage), stippleAlpha);

    ${t.output===N.ObjectAndLayerIdColor?b`finalColor.a = 1.0;`:""}

    if (finalColor.a < ${b.float(go)}) {
      discard;
    }

    ${t.output===N.Color?b`fragColor = highlightSlice(finalColor, vpos);`:""}
    ${t.output===N.Highlight?b`outputHighlight();`:""}
  }
  `),e}const Eht=Object.freeze(Object.defineProperty({__proto__:null,build:Sht},Symbol.toStringTag,{value:"Module"}));let TCe=class SCe extends Pr{get _stippleEnabled(){return this.configuration.stippleEnabled&&this.configuration.output!==N.Highlight}initializeProgram(e){return new Cr(e.rctx,SCe.shader.get().build(this.configuration),br)}initializePipeline(){const e=this.configuration,r=xo(we.SRC_ALPHA,we.ONE,we.ONE_MINUS_SRC_ALPHA,we.ONE_MINUS_SRC_ALPHA),i=(s,n=null,o=null)=>At({blending:n,depthTest:XY,depthWrite:o,colorWrite:Vt,stencilWrite:e.hasOccludees?Wf:null,stencilTest:e.hasOccludees?s?H_:iv:null});return e.output===N.Color?(this._occludeePipelineState=i(!0,e.transparent||this._stippleEnabled?r:null,Ol),i(!1,e.transparent||this._stippleEnabled?r:null,Ol)):i(!1)}get primitiveType(){return St.LINES}getPipelineState(e,r){return r?this._occludeePipelineState:super.getPipelineState(e,r)}};TCe.shader=new Er(Eht,()=>ae(()=>import("./NativeLine.glsl-b5abf9fd.js"),[],import.meta.url));let zc=class extends Uo{constructor(){super(...arguments),this.output=N.Color,this.hasSlicePlane=!1,this.hasVertexColors=!1,this.transparent=!1,this.draped=!1,this.stippleEnabled=!1,this.stippleOffColorEnabled=!1,this.stipplePreferContinuous=!0,this.hasOccludees=!1}};u([B({count:N.COUNT})],zc.prototype,"output",void 0),u([B()],zc.prototype,"hasSlicePlane",void 0),u([B()],zc.prototype,"hasVertexColors",void 0),u([B()],zc.prototype,"transparent",void 0),u([B()],zc.prototype,"draped",void 0),u([B()],zc.prototype,"stippleEnabled",void 0),u([B()],zc.prototype,"stippleOffColorEnabled",void 0),u([B()],zc.prototype,"stipplePreferContinuous",void 0),u([B()],zc.prototype,"hasOccludees",void 0),u([B({constValue:!1})],zc.prototype,"stippleRequiresClamp",void 0),u([B({constValue:!1})],zc.prototype,"stippleScaleWithLineWidth",void 0),u([B({constValue:!1})],zc.prototype,"stippleRequiresStretchMeasure",void 0);var k4;(function(t){t[t.START=0]="START",t[t.END=1]="END"})(k4||(k4={}));let Zoe=class extends tv{constructor(e){super(e,new Oht),this._configuration=new zc}getConfiguration(e,r){this._configuration.output=e,this._configuration.hasSlicePlane=this.parameters.hasSlicePlane,this._configuration.hasVertexColors=this.parameters.hasVertexColors,this._configuration.transparent=this.parameters.color[3]<1||this.parameters.width<1,this._configuration.draped=r.slot===ue.DRAPED_MATERIAL;const i=this.parameters.stipplePattern!=null;return this._configuration.stippleEnabled=i,this._configuration.stippleOffColorEnabled=i&&this.parameters.stippleOffColor!=null,this._configuration.hasOccludees=this.parameters.hasOccludees,this._configuration.stipplePreferContinuous=this.parameters.stipplePreferContinuous,this._configuration}intersect(e,r,i,s,n,o){if(!i.options.selectionMode||!e.visible)return;if(!mwe(r))return void Q.getLogger("esri.views.3d.webgl-engine.materials.NativeLineMaterial").error("intersection assumes a translation-only matrix");const a=e.vertexAttributes.get(E.POSITION).data,l=i.camera,c=Pht;fn(c,i.point);const h=2;se(_C[0],c[0]-h,c[1]+h,0),se(_C[1],c[0]+h,c[1]+h,0),se(_C[2],c[0]+h,c[1]-h,0),se(_C[3],c[0]-h,c[1]-h,0);for(let _=0;_<4;_++)if(!l.unprojectFromRenderScreen(_C[_],_m[_]))return;ia(l.eye,_m[0],_m[1],$9),ia(l.eye,_m[1],_m[2],L9),ia(l.eye,_m[2],_m[3],D9),ia(l.eye,_m[3],_m[0],N9);let p=Number.MAX_VALUE,f=0;for(let _=0;_<a.length-5;_+=3){if(Oa[0]=a[_]+r[12],Oa[1]=a[_+1]+r[13],Oa[2]=a[_+2]+r[14],Ra[0]=a[_+3]+r[12],Ra[1]=a[_+4]+r[13],Ra[2]=a[_+5]+r[14],hi($9,Oa)<0&&hi($9,Ra)<0||hi(L9,Oa)<0&&hi(L9,Ra)<0||hi(D9,Oa)<0&&hi(D9,Ra)<0||hi(N9,Oa)<0&&hi(N9,Ra)<0)continue;if(l.projectToRenderScreen(Oa,$v),l.projectToRenderScreen(Ra,Lv),$v[2]<0&&Lv[2]>0){he(Ip,Oa,Ra);const w=l.frustum,x=-hi(w[ui.NEAR],Oa)/fe(Ip,w[ui.NEAR]);te(Ip,Ip,x),ce(Oa,Oa,Ip),l.projectToRenderScreen(Oa,$v)}else if($v[2]>0&&Lv[2]<0){he(Ip,Ra,Oa);const w=l.frustum,x=-hi(w[ui.NEAR],Ra)/fe(Ip,w[ui.NEAR]);te(Ip,Ip,x),ce(Ra,Ra,Ip),l.projectToRenderScreen(Ra,Lv)}else if($v[2]<0&&Lv[2]<0)continue;$v[2]=0,Lv[2]=0;const v=pX(Pb($v,Lv,Joe),c);v<p&&(p=v,ie(Xoe,Oa),ie(Yoe,Ra),f=_/3)}const m=i.rayBegin,y=i.rayEnd;if(p<h*h){let _=Number.MAX_VALUE;if(Obe(Pb(Xoe,Yoe,Joe),Pb(m,y,Rht),Iv)){he(Iv,Iv,m);const v=Ce(Iv);te(Iv,Iv,1/v),_=v/di(m,y)}o(_,Iv,f,!1)}}intersectDraped(e,r,i,s,n,o){if(!i.options.selectionMode)return;const a=e.vertexAttributes.get(E.POSITION).data,l=e.vertexAttributes.get(E.SIZE),c=l?l.data[0]:0,h=s[0],p=s[1],f=((c+1)/2+4)*e.screenToWorldRatio;let m=Number.MAX_VALUE,y=0;for(let _=0;_<a.length-5;_+=3){const v=a[_],w=a[_+1],x=h-v,T=p-w,S=a[_+3]-v,O=a[_+4]-w,A=ge((S*x+O*T)/(S*S+O*O),0,1),I=S*A-x,M=O*A-T,k=I*I+M*M;k<m&&(m=k,y=_/3)}m<f*f&&n(o.dist,o.normal,y,!1)}requiresSlot(e,r){return!(r!==N.Color&&r!==N.Highlight&&r!==N.ObjectAndLayerIdColor||e!==ue.OPAQUE_MATERIAL&&e!==ue.DRAPED_MATERIAL)}createGLMaterial(e){return new Cht(e)}createBufferWriter(){const e=this.parameters.hasVertexColors?Blt:Vlt;return this.parameters.stipplePattern==null?new TE(e):new Aht(e.clone().vec3f(E.AUXPOS1).vec2f(E.UV0))}},Cht=class extends K_{constructor(){super(...arguments),this._stipplePattern=null}dispose(){super.dispose(),this._stippleTextureRepository.release(this._stipplePattern),this._stipplePattern=null}_updateOccludeeState(e){e.hasOccludees!==this._material.parameters.hasOccludees&&this._material.setParameters({hasOccludees:e.hasOccludees})}beginSlot(e){this._output===N.Color&&this._updateOccludeeState(e);const r=this._material.parameters.stipplePattern;return this._stipplePattern!==r&&(this._material.setParameters({stippleTexture:this._stippleTextureRepository.swap(r,this._stipplePattern)}),this._stipplePattern=r),this.ensureTechnique(TCe,e)}},Aht=class{constructor(e){this.vertexBufferLayout=e}elementCount(e){return e.indices.get(E.POSITION).length}write(e,r,i,s,n){ASe(i,this.vertexBufferLayout,e,r,s,n),this._writeAuxpos1(e,i,s,n),this._writeUV0(e,i,s,n)}_writeAuxpos1(e,r,i,s){const n=i.getField(E.AUXPOS1,dn),o=r.indices.get(E.POSITION),a=r.vertexAttributes.get(E.POSITION).data,l=e,c=n.typedBufferStride,h=n.typedBuffer;s*=c;for(let p=0;p<o.length-1;p+=2)for(const f of[1,0]){const m=3*o[p+f],y=a[m],_=a[m+1],v=a[m+2],w=l[0]*y+l[4]*_+l[8]*v+l[12],x=l[1]*y+l[5]*_+l[9]*v+l[13],T=l[2]*y+l[6]*_+l[10]*v+l[14];h[s]=w,h[s+1]=x,h[s+2]=T,s+=c}}_writeUV0(e,r,i,s){const n=i.getField(E.UV0,ev),o=r.indices.get(E.POSITION),a=r.vertexAttributes.get(E.POSITION).data,l=r.vertexAttributes.get(E.DISTANCETOSTART)?.data,c=n.typedBufferStride,h=n.typedBuffer;let p=0;h[s*=c]=k4.START,h[s+1]=p,s+=c;const f=3*o[0],m=se(Oa,a[f],a[f+1],a[f+2]);e&&$e(m,m,e);const y=Ra,_=o.length-1;let v=1;const w=l?(T,S,O)=>p=l[O]:(T,S,O)=>p+=di(T,S);for(let T=1;T<_;T+=2){const S=3*o[T];se(y,a[S],a[S+1],a[S+2]),e&&$e(y,y,e),w(m,y,v++);for(let O=0;O<2;++O)h[s]=1-O,h[s+1]=p,s+=c;ie(m,y)}const x=3*o[_];se(y,a[x],a[x+1],a[x+2]),e&&$e(y,y,e),w(m,y,v),h[s]=k4.END,h[s+1]=p}},Oht=class extends CY{constructor(){super(...arguments),this.color=dh,this.hasVertexColors=!1,this.hasSlicePlane=!1,this.width=1,this.stipplePreferContinuous=!0,this.hasOccludees=!1,this.stippleTexture=null}};const Oa=C(),Ra=C(),Ip=C(),Iv=C(),$v=zo(),Lv=zo(),Xoe=C(),Yoe=C(),Joe=dp(),Rht=dp(),Pht=C(),_C=[zo(),zo(),zo(),zo()],_m=[C(),C(),C(),C()],$9=Ir(),L9=Ir(),D9=Ir(),N9=Ir(),Mht=["mesh"];let Iht=class extends om{constructor(e,r,i,s){super(e,r,i,s),this._materialInfoCache=new Tht,this._fastUpdateProcessor=new xht,this._textures=new Map,this.ensureDrapedStatus(!1)}async doLoad(){ni.DRAW_MESH_GEOMETRY_NORMALS&&(this._debugVertexNormalMaterial=new Zoe({color:[1,0,1,1]}),this._debugFaceNormalMaterial=new Zoe({color:[0,1,1,1]}))}destroy(){super.destroy(),this._context.stage.removeMany(this._materialInfoCache.materials),this._context.stage.removeMany(Array.from(this._textures.values())),this._materialInfoCache.clear(),this._textures.clear(),this._fastUpdateProcessor.destroy(this._context.stage)}createGraphics3DGraphic(e){const r=e.graphic;if(!this._validateGeometry(r.geometry,Mht,"fill on mesh-3d"))return null;const i=this.setGraphicElevationContext(r,new mp),s=e.renderingInfo;return this._createAs3DShape(r,s,i,r.uid)}onRemoveGraphic(e){this._fastUpdateProcessor.onRemoveGraphic(e,this._materialInfoCache,this._context)}layerOpacityChanged(e,r){const i=this._getLayerOpacity();this._updateMaterialParameters(s=>{s.material.setParameters({layerOpacity:i});const n=s.material.parameters;this._setMaterialTransparentParameter(n,s),s.material.setParameters({transparent:n.transparent})}),e.forEach(s=>{const n=r(s);n?.layerOpacityChanged(i,this._context.isAsync)})}layerElevationInfoChanged(e,r){return this.updateGraphics3DGraphicElevationInfo(e,r,G_)}slicePlaneEnabledChanged(e,r){return this._updateMaterialParameters(({material:i})=>{i.setParameters({hasSlicePlane:this._context.slicePlaneEnabled})}),e.forEach(i=>{const s=r(i);s?.slicePlaneEnabledChanged(this._context.slicePlaneEnabled,this._context.isAsync)}),!0}physicalBasedRenderingChanged(){const e=this._usePBR();return this._updateMaterialParameters(({material:r})=>r.setParameters({usePBR:e})),!0}updateTransform(e,r,i,s){const n=this._context.renderCoordsHelper.spatialReference,o=$ht,{origin:a,transform:l}=i;switch(Tl(r,se(ro,a.x,a.y,a.z??0),o,n),s){case iO.EnableFastUpdates:this._fastUpdateProcessor.enable(e,this._materialInfoCache,this._context);break;case iO.DisableFastUpdates:this._fastUpdateProcessor.disable(e,this._materialInfoCache,this._context);break;case iO.UpdateFastLocalOrigin:e.updateFastLocalOrigin(o,l,this._context.localOriginFactory)}const{elevationContext:c}=e;c.centerPointInElevationSR=this._getCenterPointInElevationSR(o);const{elevationProvider:h,renderCoordsHelper:p}=this._context,f=(m,y)=>B_(m,h,c,p,y);return e.alignedSampledElevation=$b(e,c,h.spatialReference,f,p,o),e.updateTransform(o,l,this._context.isAsync),!0}_requiresSymbolVertexColors(){return this._drivenProperties.color||this._drivenProperties.opacity}_colorOrTextureUid(e){return e==null?"-":e instanceof ze?e.toHex():e.contentHash}_materialPropertiesDefault(e,r){const i=this._requiresSymbolVertexColors(),s=!!e.vertexAttributes.color,n=!!e.vertexAttributes.tangent;return{hasSymbolVertexColors:i,hasVertexColors:s,hasVertexTangents:n,uid:`vc:${s},vt:${n},vct${r},svc:${i}`}}_textureTransformUid(e){const{offset:r,scale:i,rotation:s}=e??Dht;return`${r[0]},${r[1]},${s},${i[0]},${i[1]}`}_materialProperties(e,r,i){const s=this._materialPropertiesDefault(e,i);if(!r.material)return s;const{color:n,colorTexture:o,colorTextureTransform:a,normalTexture:l,normalTextureTransform:c,doubleSided:h,alphaCutoff:p,alphaMode:f}=r.material,m=this._colorOrTextureUid(n),y=this._colorOrTextureUid(o),_=this._textureTransformUid(a),v=this._colorOrTextureUid(l),w=this._textureTransformUid(c);if(s.color=n,s.colorTexture=o,s.normalTexture=l,s.uid=`${s.uid},cmuid:${m},ctmuid:${y},cttuid:${_},ntmuid:${v},nttuid:${w},ds:${h},ac:${p},am:${f}`,r.material instanceof _Ce){const{metallic:x,roughness:T,metallicRoughnessTexture:S,metallicRoughnessTextureTransform:O,emissiveColor:A,emissiveTexture:I,emissiveTextureTransform:M,occlusionTexture:k,occlusionTextureTransform:L}=r.material,D=this._colorOrTextureUid(S),U=this._textureTransformUid(O),X=this._colorOrTextureUid(A),W=this._colorOrTextureUid(I),G=this._textureTransformUid(M),Y=this._colorOrTextureUid(k),P=this._textureTransformUid(L);s.metallic=x,s.roughness=T,s.metallicRoughnessTexture=S,s.emissiveColor=A,s.emissiveTexture=I,s.occlusionTexture=k,s.colorTextureTransform=this._convertTextureTransform(a),s.normalTextureTransform=this._convertTextureTransform(c),s.emissiveTextureTransform=this._convertTextureTransform(M),s.occlusionTextureTransform=this._convertTextureTransform(L),s.metallicRoughnessTextureTransform=this._convertTextureTransform(O),s.uid=`${s.uid},mrm:${x},mrr:${T},mrt:${D},mrtt:${U},emuid:${X},etmuid:${W},ett:${G},otmuid:${Y},ott:${P}`}return s}_convertTextureTransform(e){if(!e)return null;const{scale:r,offset:i,rotation:s}=e;return{scale:r,offset:i,rotation:Dt(s)}}_setInternalColorValueParameters(e,r){r.diffuse=ze.toUnitRGB(e),r.opacity=e.a}_getLoadableTextureResource(e){return e.data?e.data:e.url}_getInternalTextureId(e){const r=this._getInternalTexture(e,Yr.Opaque);return r!=null?r.id:null}_getInternalTexture(e,r){const i=this._getLoadableTextureResource(e);if(!i)return null;const s=`${e.contentHash}/${r}`;let n=this._textures.get(s);return n||(n=new zw(Fb(i)?i.data:i,{mipmap:!0,wrap:this._castTextureWrap(e.wrap),noUnpackFlip:!0,preMultiplyAlpha:!Fb(i)&&r!==Yr.Opaque,encoding:Fb(i)&&i.encoding!=null?i.encoding:void 0}),this._textures.set(s,n),this._context.stage.add(n),this._context.stage.loadImmediate(n)),n}_castTextureWrap(e="repeat"){if(typeof e=="string"){const r=this._castTextureWrapIndividual(e);return{s:r,t:r}}return{s:this._castTextureWrapIndividual(e.horizontal),t:this._castTextureWrapIndividual(e.vertical)}}_castTextureWrapIndividual(e){switch(e){case"clamp":return $t.CLAMP_TO_EDGE;case"mirror":return $t.MIRRORED_REPEAT;default:return $t.REPEAT}}_setInternalMaterialParameters(e,r){if(e.color!=null&&this._setInternalColorValueParameters(e.color,r),e.colorTexture!=null){const i=this._getInternalTexture(e.colorTexture,r.textureAlphaMode);i!=null?(r.textureId=i.id,r.textureAlphaPremultiplied=!!i.parameters.preMultiplyAlpha):r.textureId=void 0}e.normalTexture!=null&&(r.normalTextureId=this._getInternalTextureId(e.normalTexture)),e.emissiveColor!=null&&(r.emissiveFactor=ze.toUnitRGB(e.emissiveColor)),e.emissiveTexture!=null&&(r.emissiveTextureId=this._getInternalTextureId(e.emissiveTexture)),e.occlusionTexture!=null&&(r.occlusionTextureId=this._getInternalTextureId(e.occlusionTexture)),e.metallicRoughnessTexture!=null&&(r.metallicRoughnessTextureId=this._getInternalTextureId(e.metallicRoughnessTexture)),r.colorTextureTransformMatrix=vf(e.colorTextureTransform),r.normalTextureTransformMatrix=vf(e.normalTextureTransform),r.occlusionTextureTransformMatrix=vf(e.occlusionTextureTransform),r.emissiveTextureTransformMatrix=vf(e.emissiveTextureTransform),r.metallicRoughnessTextureTransformMatrix=vf(e.metallicRoughnessTextureTransform)}_setExternalMaterialParameters(e){const r=this._drivenProperties.color;let i=this.symbolLayer.material!=null?this.symbolLayer.material.colorMixMode:null;if(r)e.externalColor=dh;else{const s=this.symbolLayer.material!=null?this.symbolLayer.material.color:null;s!=null?e.externalColor=ze.toUnitRGBA(s):(i=null,e.externalColor=dh)}i&&(e.colorMixMode=i),e.castShadows=!!this.symbolLayer.castShadows}_hasTransparentVertexColors(e){const r=e.vertexAttributes.color;if(r==null)return!1;for(let i=3;i<r.length;i+=4)if(r[i]!==255)return!0;return!1}_getOrCreateMaterial(e,r){const i=r.material?.color,s=r.material?.colorTexture,n=r.material?.alphaMode,o=n==="blend",a=n!=="opaque"&&(this._hasTransparentVertexColors(e)||i!=null&&i.a<1||s!=null&&s.transparent||o),l=this._materialProperties(e,r,a),c=this._materialInfoCache.byUid(l.uid);if(c)return c.material;const h={uid:l.uid,material:null,isComponentTransparent:a,alphaMode:r.material?r.material.alphaMode:"opaque"},p=ZEe({normalTexture:l.normalTexture,metallicRoughnessTexture:l.metallicRoughnessTexture,metallicFactor:l.metallic,roughnessFactor:l.roughness,emissiveTexture:l.emissiveTexture,emissiveFactor:ze.toUnitRGB(l.emissiveColor),occlusionTexture:l.occlusionTexture}),f={usePBR:this._usePBR(),isSchematic:p,hasVertexColors:l.hasVertexColors,hasSymbolColors:l.hasSymbolVertexColors,hasVertexTangents:l.hasVertexTangents,ambient:ja,diffuse:fg,opacity:1,doubleSided:!0,doubleSidedType:"winding-order",cullFace:pi.None,layerOpacity:this._getLayerOpacity(),hasSlicePlane:this._context.slicePlaneEnabled,initTextureTransparent:!0};f.mrrFactors=p?[...uJ]:[l.metallic,l.roughness,T6[2]],r.material&&(f.doubleSided=r.material.doubleSided,f.cullFace=r.material.doubleSided?pi.None:pi.Back,f.textureAlphaCutoff=r.material.alphaCutoff),this._setExternalMaterialParameters(f),this._setMaterialTransparentParameter(f,h),this._setInternalMaterialParameters(l,f);const m=new Zf(f);return h.material=m,this._materialInfoCache.set(l.uid,h),this._context.stage.add(m),m}_usePBR(){return this._context.physicalBasedRenderingEnabled}_setMaterialTransparentParameter(e,r){e.transparent=this.needsDrivenTransparentPass||r.isComponentTransparent||e.layerOpacity<1||e.opacity<1||e.externalColor&&e.externalColor[3]<1,r.alphaMode==="auto"?e.textureAlphaMode=e.transparent?Yr.MaskBlend:Yr.Opaque:e.textureAlphaMode=r.alphaMode==="opaque"?Yr.Opaque:r.alphaMode==="mask"?Yr.Mask:Yr.Blend}_addDebugNormals(e,r){const i=r.length,s=e.spatialReference.isGeographic?20015077/180:1,n=.1*Math.max(e.extent.width*s,e.extent.height*s,e.extent.zmax-e.extent.zmin),o=[],a=[],l=[],c=[];for(let m=0;m<i;m++){const y=r[m],_=y.vertexAttributes.get(E.POSITION),v=y.vertexAttributes.get(E.NORMAL),w=y.indices.get(E.POSITION),x=y.indices.get(E.NORMAL),T=_.data,S=v.data;for(let O=0;O<w.length;O++){const A=3*w[O],I=3*x[O];for(let M=0;M<3;M++)o.push(T[A+M]);for(let M=0;M<3;M++)o.push(T[A+M]+S[I+M]*n);if(a.push(a.length),a.push(a.length),O%3==0){this._calculateFaceNormal(T,w,O,$x),this._getFaceVertices(T,w,O,ro,Mx,Ix),ce(ro,ro,Mx),ce(ro,ro,Ix),te(ro,ro,1/3);for(let M=0;M<3;M++)l.push(ro[M]);for(let M=0;M<3;M++)l.push(ro[M]+$x[M]*n);c.push(c.length),c.push(c.length)}}}const h=r[0].transformation,p=new Vs(this._debugVertexNormalMaterial,[[E.POSITION,new ke(o,3,!0)]],[[E.POSITION,a]],null,ss.Line);r.push(p),p.transformation=h;const f=new Vs(this._debugFaceNormalMaterial,[[E.POSITION,new ke(l,3,!0)]],[[E.POSITION,c]],null,ss.Line);f.transformation=h,r.push(f)}_createAs3DShape(e,r,i,s){const n=e.geometry;if(n.type!=="mesh")return null;const o=this._createGeometryInfo(n,r,s);if(o==null)return null;const{geometries:a,objectTransformation:l}=o;ni.DRAW_MESH_GEOMETRY_NORMALS&&this._addDebugNormals(n,a);const c=new ay({geometries:a,layerUid:this._context.layer.uid,graphicUid:s});c.transformation=l;const h=W1e(this.symbolLayer,{opacity:this._getLayerOpacity()}),p=h!=null?new Dot(a[0].material,[h],{mergeGeometries:!0,hasSlicePlane:this._context.slicePlaneEnabled}):null,f=new vht(this,c,a,null,null,$b,i,p);this._fastUpdateProcessor.onAddGraphic(),f.needsElevationUpdates=G_(i.mode),f.useObjectOriginAsAttachmentOrigin=!0,i.centerPointInElevationSR=this._getCenterPointInElevationSR(c.transformation);const{elevationProvider:m,renderCoordsHelper:y}=this._context,_=(v,w)=>B_(v,m,i,y,w);return f.alignedSampledElevation=$b(f,i,m.spatialReference,_,y),f}_getCenterPointInElevationSR(e){const r=Dw(0,0,0,this._context.elevationProvider.spatialReference!=null?this._context.elevationProvider.spatialReference:null);return LZ([e[12],e[13],e[14]],this._context.renderCoordsHelper.spatialReference,r),r}_createComponentNormals(e,r,i,s){switch(i.shading||"flat"){default:case"source":return this._createComponentNormalsSource(e,r,i,s);case"flat":return this._createComponentNormalsFlat(e,s);case"smooth":return this._createComponentNormalsSmooth(e,s)}}_createComponentNormalsSource(e,r,i,s){if(r==null)return this._createComponentNormalsFlat(e,s);let n=!1;if(!i.trustSourceNormals)for(let o=0;o<s.length;o+=3){this._calculateFaceNormal(e,s,o,$x);for(let a=0;a<3;a++){const l=3*s[o+a];ro[0]=r[l],ro[1]=r[l+1],ro[2]=r[l+2],fe($x,ro)<0&&(r[l]=-r[l],r[l+1]=-r[l+1],r[l+2]=-r[l+2],n=!0)}}return new F9(r,s,n)}_createComponentNormalsFlat(e,r){const i=Yi(r.length),s=new Array(3*r.length);for(let n=0;n<r.length;n+=3){const o=this._calculateFaceNormal(e,r,n,$x);for(let a=0;a<3;a++)i[n+a]=o[a],s[n+a]=n/3}return new F9(i,s,!1)}_createComponentNormalsSmooth(e,r){const i={};for(let o=0;o<r.length;o+=3){const a=this._calculateFaceNormal(e,r,o,$x);for(let l=0;l<3;l++){const c=r[o+l];let h=i[c];h||(h={normal:C(),count:0},i[c]=h),ce(h.normal,h.normal,a),h.count++}}const s=Yi(3*r.length),n=new Array(3*r.length);for(let o=0;o<r.length;o++){const a=i[r[o]];a.count!==1&&(me(a.normal,a.normal),a.count=1);for(let l=0;l<3;l++)s[3*o+l]=a.normal[l];n[o]=o}return new F9(s,n,!1)}_getFaceVertices(e,r,i,s,n,o){const a=3*r[i],l=3*r[i+1],c=3*r[i+2];s[0]=e[a],s[1]=e[a+1],s[2]=e[a+2],n[0]=e[l],n[1]=e[l+1],n[2]=e[l+2],o[0]=e[c],o[1]=e[c+1],o[2]=e[c+2]}_calculateFaceNormal(e,r,i,s){return this._getFaceVertices(e,r,i,ro,Mx,Ix),he(Mx,Mx,ro),he(Ix,Ix,ro),at(ro,Mx,Ix),me(s,ro),s}_getOrCreateComponents(e){return e.components??Lht}_createPositionBuffer(e,r){let i=e.vertexAttributes.position;const s=r.reprojection===Xl.ECEF?r.transformBeforeProject:null;if(s!=null&&(i=F2(new Float64Array(i.length),i,s)),r.reprojection===Xl.NONE)return r.needsBufferCopy?new Float64Array(i):i;const n=s!=null?i:new Float64Array(i.length);return oi(i,e.spatialReference,0,n,this._context.renderCoordsHelper.spatialReference,0,i.length/3),n}_createNormalBuffer(e,r,i){let s=e.vertexAttributes.normal;if(s==null)return null;const n=i.reprojection===Xl.ECEF?i.transformBeforeProject:null;if(n!=null&&(s=pht(s,new Float32Array(s.length),n)),this._context.graphicsCoreOwner.view.viewingMode==="local"||i.reprojection===Xl.NONE)return i.needsBufferCopy&&e.vertexAttributes.normal===s?new Float32Array(s):s;const o=e.vertexAttributes.position,a=n!=null?s:new Float32Array(s.length);return dht(s,o,r,e.spatialReference,a)}_createTangentBuffer(e,r,i){let s=e.vertexAttributes.tangent;if(s==null)return null;const n=i.reprojection===Xl.ECEF?i.transformBeforeProject:null;if(n!=null&&(s=fht(s,new Float32Array(s.length),n)),this._context.graphicsCoreOwner.view.viewingMode==="local"||i.reprojection===Xl.NONE)return i.needsBufferCopy&&e.vertexAttributes.normal===s?new Float32Array(s):s;const o=e.vertexAttributes.position,a=n!=null?s:new Float32Array(s.length);return mht(s,o,r,e.spatialReference,a)}_createColorBuffer(e){return e.vertexAttributes.color}_createSymbolColorBuffer(e){if(this._requiresSymbolVertexColors()){const r=this._getVertexOpacityAndColor(e),i=Y1e(this.symbolLayer?.material?.colorMixMode),s=new Uint8Array(4);return J1e(r,i,s),s}return null}_createBuffers(e,r){const i=e.vertexAttributes&&e.vertexAttributes.position;if(!i)return this.logger.warn("Mesh geometry must contain position vertex attributes"),null;const s=e.vertexAttributes.normal,n=e.vertexAttributes.uv,o=e.vertexAttributes.tangent;if(s!=null&&s.length!==i.length)return this.logger.warn("Mesh normal vertex buffer must contain the same number of elements as the position buffer"),null;if(o!=null&&o.length/4!=i.length/3)return this.logger.warn("Mesh tangent vertex buffer must contain the same number of elements as the position buffer"),null;if(n!=null&&n.length/2!=i.length/3)return this.logger.warn("Mesh uv vertex buffer must contain the same number of elements as the position buffer"),null;const a=this._computeReprojectionInfo(e),l=this._createPositionBuffer(e,a),c=this._createColorBuffer(e),h=this._createSymbolColorBuffer(r),p=this._createNormalBuffer(e,l,a),f=this._createTangentBuffer(e,l,a);return{positionBuffer:l,normalBuffer:p,tangentBuffer:f,uvBuffer:n,colorBuffer:c,symbolColorBuffer:h,objectTransformation:a.reprojection===Xl.NONE&&a.objectTransformation!=null?a.objectTransformation:this._transformOriginLocal(e,l,p,f),geometryTransformation:a.reprojection===Xl.NONE&&a.geometryTransformation!=null?a.geometryTransformation:be()}}_computeReprojectionInfo(e){const{vertexSpace:r}=e,i=r.isRelative,s=r.isGeoreferenced?this._context.renderCoordsHelper.viewingMode===De.Local?Xl.NONE:Xl.ECEF:Xl.NONE;if(i){const{origin:n}=r,o=be(),a=e.transform?.localMatrix??un;if(s===Xl.NONE)return Tl(e.spatialReference,n,o,this._context.renderCoordsHelper.spatialReference),{reprojection:s,objectTransformation:o,geometryTransformation:y2(a),needsBufferCopy:!1};const l=zR(be(),n);return si(l,l,a),{reprojection:s,transformBeforeProject:l,needsBufferCopy:!0}}return{reprojection:s,needsBufferCopy:!0}}_transformOriginLocal(e,r,i,s){const n=this._context.renderCoordsHelper.spatialReference,o=e.anchor;VI[0]=o.x,VI[1]=o.y,VI[2]=o.z??0;const a=be();return Tl(e.spatialReference,VI,a,n),On(Qoe,a),F2(r,r,Qoe),i==null&&s==null||(Ph(vC,a),Mh(vC,vC),i!=null&&fw(i,i,vC),s!=null&&fw(s,s,vC,4)),a}_validateFaces(e,r){const i=e.vertexAttributes.position.length/3,s=r.faces;if(s){let n=-1;for(let o=0;o<s.length;o++){const a=s[o];a>n&&(n=a)}if(i<=n)return this.logger.warn(`Vertex index ${n} is out of bounds of the mesh position buffer`),!1}else if(i%3!=0)return this.logger.warn("Mesh position buffer length must be a multiple of 9 if no component faces are defined (3 values per vertex * 3 vertices per triangle)"),!1;return!0}_getOrCreateFaces(e,r){return r.faces??A2(e.vertexAttributes.position.length/3)}_isOutsideClippingArea(e){if(!this._context.clippingExtent)return!1;const r=e.vertexAttributes&&e.vertexAttributes.position;if(!r)return!1;const i=this._context.elevationProvider.spatialReference;let s;const n=r.length/3;return i==null||e.spatialReference.equals(i)?s=r:(s=new Float64Array(r.length),oi(e.vertexAttributes.position,e.spatialReference,0,s,i,0,n)),xi(U9),nu(U9,s,0,n),!Gd(U9,this._context.clippingExtent)}_createGeometryInfo(e,r,i){if(!Vf(e.spatialReference,this._context.graphicsCoreOwner.view.spatialReference))return this.logger.warn("Geometry spatial reference is not compatible with the view"),null;if(this._isOutsideClippingArea(e))return null;const s=this._createBuffers(e,r);if(s==null)return null;const{positionBuffer:n,uvBuffer:o,colorBuffer:a,symbolColorBuffer:l,normalBuffer:c,tangentBuffer:h,objectTransformation:p,geometryTransformation:f}=s,m=this._getOrCreateComponents(e),y=new Array;let _=!1;for(const v of m){if(!this._validateFaces(e,v))return null;const w=this._getOrCreateFaces(e,v);if(w.length===0)continue;const x=this._createComponentNormals(n,c,v,w);x.didFlipNormals&&(_=!0);const T=[[E.POSITION,new ke(n,3,!0)],[E.NORMAL,new ke(x.normals,3,!0)]],S=[[E.POSITION,w],[E.NORMAL,x.indices]];a!=null&&(T.push([E.COLOR,new ke(a,4,!0)]),S.push([E.COLOR,w])),l!=null&&(T.push([E.SYMBOLCOLOR,new ke(l,4,!0)]),S.push([E.SYMBOLCOLOR,gE(w.length)])),o!=null&&(T.push([E.UV0,new ke(o,2,!0)]),S.push([E.UV0,w])),h!=null&&(T.push([E.TANGENT,new ke(h,4,!0)]),S.push([E.TANGENT,w]));const O=this._context.stage.renderView.getObjectAndLayerIdColor({graphicUid:i,layerUid:this._context.layer.uid}),A=this._getOrCreateMaterial(e,v),I=new Vs(A,T,S,null,ss.Mesh,O);I.transformation=f,y.push(I)}return _&&this.logger.warn("Normals have been automatically flipped to be consistent with the counter clock wise face winding order. It is better to generate mesh geometries that have consistent normals."),{geometries:y,objectTransformation:p}}_updateMaterialParameters(e){this._materialInfoCache.forEachMaterialInfo(e),this._fastUpdateProcessor.forEachMaterialInfo(e),this._fastUpdateProcessor.forEachClonedMaterial((r,i)=>{i.setParameters(r.parameters)})}test(){return{...super.test(),materials:this._materialInfoCache.materials}}};class F9{constructor(e,r,i){this.normals=e,this.indices=r,this.didFlipNormals=i}}const VI=C(),ro=C(),Mx=C(),Ix=C(),$x=C(),Qoe=be(),vC=Li(),$ht=be(),U9=pn(),Lht=[new hht],Dht=new GS;var Xl;(function(t){t[t.NONE=0]="NONE",t[t.ECEF=1]="ECEF"})(Xl||(Xl={}));let Nht=class{constructor(e,r,i,s){this.graphics3DSymbolLayer=e,this.instanceIndex=r,this.elevationAligner=i,this.elevationContext=s,this.type="lod-instance",this._highlights=new Set,this.alignedSampledElevation=0,this.isElevationSource=!1,this.needsElevationUpdates=!1}initialize(){}setVisibility(e){const r=this._lodRenderer.instanceData;e!==r.getVisible(this.instanceIndex)&&r.setVisible(this.instanceIndex,e)}destroy(){this.instanceIndex!=null&&(this._lodRenderer.instanceData.removeInstance(this.instanceIndex),this.graphics3DSymbolLayer.notifyDestroyGraphicLayer(this))}alignWithElevation(e,r,i){if(this.elevationAligner){f6(this.elevationContext.featureExpressionInfoContext,i);const s=(o,a)=>B_(o,e,this.elevationContext,r,a),n=this.elevationAligner(this,this.elevationContext,e.spatialReference,s,r);n!=null&&(this.alignedSampledElevation=n)}}getCenterObjectSpace(e=C()){return this._lodRenderer.instanceData.getCombinedLocalTransform(this.instanceIndex,$p),$e(e,this._lodRenderer.baseBoundingSphere.center,$p)}getBoundingBoxObjectSpace(e=pn()){this._lodRenderer.instanceData.getCombinedLocalTransform(this.instanceIndex,$p);const r=this._lodRenderer.baseBoundingBox;xi(e);for(let i=0;i<8;++i)se(Mu,1&i?r[3]:r[0],2&i?r[4]:r[1],4&i?r[5]:r[2]),$e(Mu,Mu,$p),kf(e,Mu);return e}computeAttachmentOrigin(e){this._lodRenderer.instanceData.getGlobalTransform(this.instanceIndex,$p),e.render.origin[0]+=$p[12],e.render.origin[1]+=$p[13],e.render.origin[2]+=$p[14],e.render.num++}async getProjectedBoundingBox(e,r,i,s,n){const o=this.getBoundingBoxObjectSpace(n),a=Fht,l=BW(o)?1:a.length;this._lodRenderer.instanceData.getGlobalTransform(this.instanceIndex,$p);for(let h=0;h<l;h++){const p=a[h];Mu[0]=o[p[0]],Mu[1]=o[p[1]],Mu[2]=o[p[2]],$e(Mu,Mu,$p),Dv[3*h]=Mu[0],Dv[3*h+1]=Mu[1],Dv[3*h+2]=Mu[2]}if(!e(Dv,0,l))return null;xi(o);let c=null;this.calculateRelativeScreenBounds&&(c=this.calculateRelativeScreenBounds());for(let h=0;h<3*l;h+=3){for(let p=0;p<3;p++)o[p]=Math.min(o[p],Dv[h+p]),o[p+3]=Math.max(o[p+3],Dv[h+p]);c&&i.push({location:Dv.slice(h,h+3),screenSpaceBoundingRect:c})}if(r&&(Bd(o,k9),this.elevationContext.mode!=="absolute-height")){let h;const p=LY(o,r.service.spatialReference,r);try{h=await r.service.queryElevation(k9[0],k9[1],s,p,"ground")}catch{}h!=null&&Mge(o,0,0,-this.alignedSampledElevation+h)}return o}addObjectState(e,r){if(e===zg.Highlight){const i=new c4(e);this._addHighlightId(i),r.addExternal(s=>{this._removeHighlightId(s)},i)}}removeObjectState(e){this._highlights.forEach(r=>e.remove(r))}_addHighlightId(e){this._highlights.add(e),this._lodRenderer.instanceData.setHighlight(this.instanceIndex,!0)}_removeHighlightId(e){this._highlights.delete(e),this._lodRenderer.instanceData.setHighlight(this.instanceIndex,this._highlights.size>0)}get _lodRenderer(){return this.graphics3DSymbolLayer.lodRenderer}};const Dv=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],Mu=C(),k9=C(),Fht=[[0,1,2],[3,1,2],[0,4,2],[3,4,2],[0,1,5],[3,1,5],[0,4,5],[3,4,5]],$p=be();function Uht(t){const e=new Array;return t.stageResources.geometries.forEach(r=>{const i=t.stageResources.textures;e.push(new x2e(r,i))}),{components:e,minScreenSpaceRadius:t.lodThreshold??0,pivotOffset:t.pivotOffset}}function kht(t){return{levels:t.map(e=>Uht(e))}}function Vht(t,e,r){if(t.count!==e.count)return void g6.error("source and destination buffers need to have the same number of elements");const i=t.count,s=r[0],n=r[1],o=r[2],a=r[3],l=r[4],c=r[5],h=r[6],p=r[7],f=r[8],m=r[9],y=r[10],_=r[11],v=r[12],w=r[13],x=r[14],T=r[15],S=t.typedBuffer,O=t.typedBufferStride,A=e.typedBuffer,I=e.typedBufferStride;for(let M=0;M<i;M++){const k=M*O,L=M*I,D=A[L],U=A[L+1],X=A[L+2],W=A[L+3];S[k]=s*D+l*U+f*X+v*W,S[k+1]=n*D+c*U+m*X+w*W,S[k+2]=o*D+h*U+y*X+x*W,S[k+3]=a*D+p*U+_*X+T*W}}function zht(t,e,r){pJ(t.typedBuffer,e.typedBuffer,r,t.typedBufferStride,e.typedBufferStride)}function pJ(t,e,r,i=4,s=i){if(t.length/i!=e.length/s)return void g6.error("source and destination buffers need to have the same number of elements");const n=t.length/i,o=r[0],a=r[1],l=r[2],c=r[3],h=r[4],p=r[5],f=r[6],m=r[7],y=r[8];let _=0,v=0;for(let w=0;w<n;w++){const x=e[_],T=e[_+1],S=e[_+2],O=e[_+3];t[v]=o*x+c*T+f*S,t[v+1]=a*x+h*T+m*S,t[v+2]=l*x+p*T+y*S,t[v+3]=O,_+=s,v+=i}}function Bht(t,e){const r=Math.min(t.count,e.count),i=t.typedBuffer,s=t.typedBufferStride,n=e.typedBuffer,o=e.typedBufferStride;for(let a=0;a<r;a++){const l=a*s,c=a*o,h=n[c],p=n[c+1],f=n[c+2],m=h*h+p*p+f*f;if(m>0){const y=1/Math.sqrt(m);i[l]=y*h,i[l+1]=y*p,i[l+2]=y*f}}}function Ght(t,e,r){V4(t.typedBuffer,e,r,t.typedBufferStride)}function V4(t,e,r,i=4){const s=Math.min(t.length/i,e.count),n=e.typedBuffer,o=e.typedBufferStride;let a=0,l=0;for(let c=0;c<s;c++)t[l]=r*n[a],t[l+1]=r*n[a+1],t[l+2]=r*n[a+2],t[l+3]=r*n[a+3],a+=o,l+=i}Object.freeze(Object.defineProperty({__proto__:null,normalize:Bht,scale:V4,scaleView:Ght,transformMat3:pJ,transformMat3View:zht,transformMat4:Vht},Symbol.toStringTag,{value:"Module"}));function jht(t,e){fJ(t.typedBuffer,e.typedBuffer,t.typedBufferStride,e.typedBufferStride)}function fJ(t,e,r=2,i=r){const s=e.length/2;let n=0,o=0;if(ip(e)||JOe(e)){for(let l=0;l<s;++l)t[n]=e[o],t[n+1]=e[o+1],n+=r,o+=i;return}const a=QOe(e);if(YOe(e))for(let l=0;l<s;++l)t[n]=Math.max(e[o]/a,-1),t[n+1]=Math.max(e[o+1]/a,-1),n+=r,o+=i;else for(let l=0;l<s;++l)t[n]=e[o]/a,t[n+1]=e[o+1]/a,n+=r,o+=i}function Hht(t,e,r,i){const s=t.typedBuffer,n=t.typedBufferStride,o=i?.count??t.count;let a=(i?.dstIndex??0)*n;for(let l=0;l<o;++l)s[a]=e,s[a+1]=r,a+=n}Object.freeze(Object.defineProperty({__proto__:null,fill:Hht,normalizeIntegerBuffer:fJ,normalizeIntegerBufferView:jht},Symbol.toStringTag,{value:"Module"}));function qht(t,e){gP(t.typedBuffer,e.typedBuffer,t.typedBufferStride,e.typedBufferStride)}function gP(t,e,r=3,i=r){const s=e.length/i;let n=0,o=0;for(let a=0;a<s;++a)t[n]=e[o],t[n+1]=e[o+1],t[n+2]=e[o+2],n+=r,o+=i}function Wht(t,e,r,i,s){const n=t.typedBuffer,o=t.typedBufferStride,a=s?.count??t.count;let l=(s?.dstIndex??0)*o;for(let c=0;c<a;++c)n[l]=e,n[l+1]=r,n[l+2]=i,l+=o}Object.freeze(Object.defineProperty({__proto__:null,copy:gP,copyView:qht,fill:Wht},Symbol.toStringTag,{value:"Module"}));function Zht(t,e){mJ(t.typedBuffer,e,t.typedBufferStride)}function mJ(t,e,r=4){const i=e.typedBuffer,s=e.typedBufferStride,n=e.count;let o=0,a=0;for(let l=0;l<n;++l)t[o]=i[a],t[o+1]=i[a+1],t[o+2]=i[a+2],t[o+3]=i[a+3],o+=r,a+=s}function Xht(t,e,r,i,s,n){const o=t.typedBuffer,a=t.typedBufferStride,l=n?.count??t.count;let c=(n?.dstIndex??0)*a;for(let h=0;h<l;++h)o[c]=e,o[c+1]=r,o[c+2]=i,o[c+3]=s,c+=a}Object.freeze(Object.defineProperty({__proto__:null,copy:mJ,copyView:Zht,fill:Xht},Symbol.toStringTag,{value:"Module"}));let ECe=class{constructor(e){this._streamDataRequester=e}async loadJSON(e,r){return this._load("json",e,r)}async loadBinary(e,r){return Jf(e)?(Xt(r),Oq(e)):this._load("binary",e,r)}async loadImage(e,r){return this._load("image",e,r)}async _load(e,r,i){if(this._streamDataRequester==null)return(await qt(r,{responseType:Yht[e]})).data;const s=await gu(this._streamDataRequester.request(r,e,i));if(s.ok===!0)return s.value;throw Lo(s.error),new F("",`Request for resource failed: ${s.error}`)}};const Yht={image:"image",binary:"array-buffer",json:"json","image+type":void 0};function Jht(t={}){return{color:[1,1,1],opacity:1,alphaMode:"OPAQUE",alphaCutoff:.5,doubleSided:!1,castShadows:!0,receiveShadows:!0,receiveAmbientOcclustion:!0,textureColor:null,textureNormal:null,textureOcclusion:null,textureEmissive:null,textureMetallicRoughness:null,colorTextureTransform:null,normalTextureTransform:null,occlusionTextureTransform:null,emissiveTextureTransform:null,metallicRoughnessTextureTransform:null,emissiveFactor:[0,0,0],metallicFactor:1,roughnessFactor:1,colorMixMode:"multiply",...t}}function Qht(t,e={}){return{data:t,parameters:{wrap:{s:$t.REPEAT,t:$t.REPEAT,...e.wrap},noUnpackFlip:!0,mipmap:!1,...e}}}function pD(t,e){const r=t.count;e||(e=new t.TypedArrayConstructor(r));for(let i=0;i<r;i++)e[i]=t.get(i);return e}Object.freeze(Object.defineProperty({__proto__:null,makeDense:pD},Symbol.toStringTag,{value:"Module"}));let Koe=class{constructor(e){this._data=e,this._offset4=0,this._dataUint32=new Uint32Array(this._data,0,Math.floor(this._data.byteLength/4))}readUint32(){const e=this._offset4;return this._offset4+=1,this._dataUint32[e]}readUint8Array(e){const r=4*this._offset4;return this._offset4+=e/4,new Uint8Array(this._data,r,e)}remainingBytes(){return this._data.byteLength-4*this._offset4}};var sO,eae;(function(t){t.SCALAR="SCALAR",t.VEC2="VEC2",t.VEC3="VEC3",t.VEC4="VEC4",t.MAT2="MAT2",t.MAT3="MAT3",t.MAT4="MAT4"})(sO||(sO={})),function(t){t[t.ARRAY_BUFFER=34962]="ARRAY_BUFFER",t[t.ELEMENT_ARRAY_BUFFER=34963]="ELEMENT_ARRAY_BUFFER"}(eae||(eae={}));const CCe={baseColorFactor:[1,1,1,1],metallicFactor:1,roughnessFactor:1},Kht={pbrMetallicRoughness:CCe,emissiveFactor:[0,0,0],alphaMode:"OPAQUE",alphaCutoff:.5,doubleSided:!1},edt={ESRI_externalColorMixMode:"tint"},tae=(t={})=>{const e={...CCe,...t.pbrMetallicRoughness},r=tdt({...edt,...t.extras});return{...Kht,...t,pbrMetallicRoughness:e,extras:r}};function tdt(t){switch(t.ESRI_externalColorMixMode){case"multiply":case"tint":case"ignore":case"replace":break;default:t.ESRI_externalColorMixMode,t.ESRI_externalColorMixMode="tint"}return t}const rdt={magFilter:Ct.LINEAR,minFilter:Ct.LINEAR_MIPMAP_LINEAR,wrapS:$t.REPEAT,wrapT:$t.REPEAT},idt=t=>({...rdt,...t});function sdt(t){let e,r;return t.replace(/^(.*\/)?([^/]*)$/,(i,s,n)=>(e=s||"",r=n||"","")),{dirPart:e,filePart:r}}const zI={MAGIC:1179937895,CHUNK_TYPE_JSON:1313821514,CHUNK_TYPE_BIN:5130562,MIN_HEADER_LENGTH:20};let ndt=class S0{constructor(e,r,i,s){if(this._context=e,this.uri=r,this.json=i,this._glbBuffer=s,this._bufferLoaders=new Map,this._textureLoaders=new Map,this._textureCache=new Map,this._materialCache=new Map,this._nodeParentMap=new Map,this._nodeTransformCache=new Map,this._supportedExtensions=["KHR_texture_basisu"],this._baseUri=sdt(this.uri).dirPart,this._checkVersionSupported(),this._checkRequiredExtensionsSupported(),i.scenes==null)throw new F("gltf-loader-unsupported-feature","Scenes must be defined.");if(i.meshes==null)throw new F("gltf-loader-unsupported-feature","Meshes must be defined");if(i.nodes==null)throw new F("gltf-loader-unsupported-feature","Nodes must be defined.");this._computeNodeParents()}static async load(e,r,i){if(Jf(r)){const o=Vb(r);if(o&&o.mediaType!=="model/gltf-binary")try{const l=JSON.parse(o.isBase64?atob(o.data):o.data);return new S0(e,r,l)}catch{}const a=Oq(r);if(S0._isGLBData(a))return this._fromGLBData(e,r,a)}if(r.endsWith(".gltf")){const o=await e.loadJSON(r,i);return new S0(e,r,o)}const s=await e.loadBinary(r,i);if(S0._isGLBData(s))return this._fromGLBData(e,r,s);const n=await e.loadJSON(r,i);return new S0(e,r,n)}static _isGLBData(e){if(e==null)return!1;const r=new Koe(e);return r.remainingBytes()>=4&&r.readUint32()===zI.MAGIC}static async _fromGLBData(e,r,i){const s=await S0._parseGLBData(i);return new S0(e,r,s.json,s.binaryData)}static async _parseGLBData(e){const r=new Koe(e);if(r.remainingBytes()<12)throw new F("gltf-loader-error","GLB binary data is insufficiently large.");const i=r.readUint32(),s=r.readUint32(),n=r.readUint32();if(i!==zI.MAGIC)throw new F("gltf-loader-error","Magic first 4 bytes do not fit to expected GLB value.");if(e.byteLength<n)throw new F("gltf-loader-error","GLB binary data is smaller than header specifies.");if(s!==2)throw new F("gltf-loader-unsupported-feature","An unsupported GLB container version was detected. Only version 2 is supported.");let o,a,l=0;for(;r.remainingBytes()>=8;){const c=r.readUint32(),h=r.readUint32();if(l===0){if(h!==zI.CHUNK_TYPE_JSON)throw new F("gltf-loader-error","First GLB chunk must be JSON.");if(c<0)throw new F("gltf-loader-error","No JSON data found.");o=await yht(r.readUint8Array(c))}else if(l===1){if(h!==zI.CHUNK_TYPE_BIN)throw new F("gltf-loader-unsupported-feature","Second GLB chunk expected to be BIN.");a=r.readUint8Array(c)}else Q.getLogger("esri.views.3d.glTF").warn("[Unsupported Feature] More than 2 GLB chunks detected. Skipping.");l+=1}if(!o)throw new F("gltf-loader-error","No GLB JSON chunk detected.");return{json:o,binaryData:a}}async getBuffer(e,r){const i=this.json.buffers[e];if(i.uri==null){if(this._glbBuffer==null)throw new F("gltf-loader-error","GLB buffer not present");return this._glbBuffer}const s=await this._getBufferLoader(e,r);if(s.byteLength!==i.byteLength)throw new F("gltf-loader-error","Buffer byte lengths should match.");return s}async _getBufferLoader(e,r){const i=this._bufferLoaders.get(e);if(i)return i;const s=this.json.buffers[e].uri,n=this._context.loadBinary(this._resolveUri(s),r).then(o=>new Uint8Array(o));return this._bufferLoaders.set(e,n),n}async getAccessor(e,r){if(!this.json.accessors)throw new F("gltf-loader-unsupported-feature","Accessors missing.");const i=this.json.accessors[e];if(i?.bufferView==null)throw new F("gltf-loader-unsupported-feature","Some accessor does not specify a bufferView.");if(i.type in[sO.MAT2,sO.MAT3,sO.MAT4])throw new F("gltf-loader-unsupported-feature",`AttributeType ${i.type} is not supported`);const s=this.json.bufferViews[i.bufferView],n=await this.getBuffer(s.buffer,r),o=ldt[i.type],a=cdt[i.componentType],l=o*a,c=s.byteStride||l;return{raw:n.buffer,byteStride:c,byteOffset:n.byteOffset+(s.byteOffset||0)+(i.byteOffset||0),entryCount:i.count,isDenselyPacked:c===l,componentCount:o,componentByteSize:a,componentType:i.componentType,min:i.min,max:i.max,normalized:!!i.normalized}}async getIndexData(e,r){if(e.indices==null)return;const i=await this.getAccessor(e.indices,r);if(i.isDenselyPacked)switch(i.componentType){case Ke.UNSIGNED_BYTE:return new Uint8Array(i.raw,i.byteOffset,i.entryCount);case Ke.UNSIGNED_SHORT:return new Uint16Array(i.raw,i.byteOffset,i.entryCount);case Ke.UNSIGNED_INT:return new Uint32Array(i.raw,i.byteOffset,i.entryCount)}else switch(i.componentType){case Ke.UNSIGNED_BYTE:return pD(this._wrapAccessor(C2,i));case Ke.UNSIGNED_SHORT:return pD(this._wrapAccessor(H5,i));case Ke.UNSIGNED_INT:return pD(this._wrapAccessor(W5,i))}}async getPositionData(e,r){if(e.attributes.POSITION==null)throw new F("gltf-loader-unsupported-feature","No POSITION vertex data found.");const i=await this.getAccessor(e.attributes.POSITION,r);if(i.componentType!==Ke.FLOAT)throw new F("gltf-loader-unsupported-feature","Expected type FLOAT for POSITION vertex attribute, but found "+Ke[i.componentType]);if(i.componentCount!==3)throw new F("gltf-loader-unsupported-feature","POSITION vertex attribute must have 3 components, but found "+i.componentCount.toFixed());return this._wrapAccessor(dn,i)}async getNormalData(e,r){if(e.attributes.NORMAL==null)throw new F("gltf-loader-error","No NORMAL vertex data found.");const i=await this.getAccessor(e.attributes.NORMAL,r);if(i.componentType!==Ke.FLOAT)throw new F("gltf-loader-unsupported-feature","Expected type FLOAT for NORMAL vertex attribute, but found "+Ke[i.componentType]);if(i.componentCount!==3)throw new F("gltf-loader-unsupported-feature","NORMAL vertex attribute must have 3 components, but found "+i.componentCount.toFixed());return this._wrapAccessor(dn,i)}async getTangentData(e,r){if(e.attributes.TANGENT==null)throw new F("gltf-loader-error","No TANGENT vertex data found.");const i=await this.getAccessor(e.attributes.TANGENT,r);if(i.componentType!==Ke.FLOAT)throw new F("gltf-loader-unsupported-feature","Expected type FLOAT for TANGENT vertex attribute, but found "+Ke[i.componentType]);if(i.componentCount!==4)throw new F("gltf-loader-unsupported-feature","TANGENT vertex attribute must have 4 components, but found "+i.componentCount.toFixed());return new cp(i.raw,i.byteOffset,i.byteStride,i.byteOffset+i.byteStride*i.entryCount)}async getTextureCoordinates(e,r){if(e.attributes.TEXCOORD_0==null)throw new F("gltf-loader-error","No TEXCOORD_0 vertex data found.");const i=await this.getAccessor(e.attributes.TEXCOORD_0,r);if(i.componentCount!==2)throw new F("gltf-loader-unsupported-feature","TEXCOORD_0 vertex attribute must have 2 components, but found "+i.componentCount.toFixed());if(i.componentType===Ke.FLOAT)return this._wrapAccessor(ev,i);if(!i.normalized)throw new F("gltf-loader-unsupported-feature","Integer component types are only supported for a normalized accessor for TEXCOORD_0.");return udt(i)}async getVertexColors(e,r){if(e.attributes.COLOR_0==null)throw new F("gltf-loader-error","No COLOR_0 vertex data found.");const i=await this.getAccessor(e.attributes.COLOR_0,r);if(i.componentCount!==4&&i.componentCount!==3)throw new F("gltf-loader-unsupported-feature","COLOR_0 attribute must have 3 or 4 components, but found "+i.componentCount.toFixed());if(i.componentCount===4){if(i.componentType===Ke.FLOAT)return this._wrapAccessor(cp,i);if(i.componentType===Ke.UNSIGNED_BYTE)return this._wrapAccessor(ha,i);if(i.componentType===Ke.UNSIGNED_SHORT)return this._wrapAccessor(QR,i)}else if(i.componentCount===3){if(i.componentType===Ke.FLOAT)return this._wrapAccessor(dn,i);if(i.componentType===Ke.UNSIGNED_BYTE)return this._wrapAccessor(j5,i);if(i.componentType===Ke.UNSIGNED_SHORT)return this._wrapAccessor(q5,i)}throw new F("gltf-loader-unsupported-feature","Unsupported component type for COLOR_0 attribute: "+Ke[i.componentType])}hasPositions(e){return e.attributes.POSITION!==void 0}hasNormals(e){return e.attributes.NORMAL!==void 0}hasVertexColors(e){return e.attributes.COLOR_0!==void 0}hasTextureCoordinates(e){return e.attributes.TEXCOORD_0!==void 0}hasTangents(e){return e.attributes.TANGENT!==void 0}async getMaterial(e,r,i){let s=e.material?this._materialCache.get(e.material):void 0;if(!s){const n=e.material!=null?tae(this.json.materials[e.material]):tae(),o=n.pbrMetallicRoughness,a=this.hasVertexColors(e),l=this.getTexture(o.baseColorTexture,r),c=this.getTexture(n.normalTexture,r),h=i?this.getTexture(n.occlusionTexture,r):void 0,p=i?this.getTexture(n.emissiveTexture,r):void 0,f=i?this.getTexture(o.metallicRoughnessTexture,r):void 0,m=e.material!=null?e.material:-1;s={alphaMode:n.alphaMode,alphaCutoff:n.alphaCutoff,color:o.baseColorFactor,doubleSided:!!n.doubleSided,colorTexture:await l,normalTexture:await c,name:n.name,id:m,occlusionTexture:await h,emissiveTexture:await p,emissiveFactor:n.emissiveFactor,metallicFactor:o.metallicFactor,roughnessFactor:o.roughnessFactor,metallicRoughnessTexture:await f,hasVertexColors:a,ESRI_externalColorMixMode:n.extras.ESRI_externalColorMixMode,colorTextureTransform:o?.baseColorTexture?.extensions?.KHR_texture_transform,normalTextureTransform:n.normalTexture?.extensions?.KHR_texture_transform,occlusionTextureTransform:n.occlusionTexture?.extensions?.KHR_texture_transform,emissiveTextureTransform:n.emissiveTexture?.extensions?.KHR_texture_transform,metallicRoughnessTextureTransform:o?.metallicRoughnessTexture?.extensions?.KHR_texture_transform}}return s}async getTexture(e,r){if(!e)return;if((e.texCoord||0)!==0)throw new F("gltf-loader-unsupported-feature","Only TEXCOORD with index 0 is supported.");const i=e.index,s=this.json.textures[i],n=idt(s.sampler!=null?this.json.samplers[s.sampler]:{}),o=this._getTextureSourceId(s),a=this.json.images[o],l=await this._loadTextureImageData(i,s,r);return xpe(this._textureCache,i,()=>{const c=p=>p===33071||p===33648||p===10497,h=p=>{throw new F("gltf-loader-error",`Unexpected TextureSampler WrapMode: ${p}`)};return{data:l,wrapS:c(n.wrapS)?n.wrapS:h(n.wrapS),wrapT:c(n.wrapT)?n.wrapT:h(n.wrapT),minFilter:n.minFilter,name:a.name,id:i}})}getNodeTransform(e){if(e===void 0)return odt;let r=this._nodeTransformCache.get(e);if(!r){const i=this.getNodeTransform(this._getNodeParent(e)),s=this.json.nodes[e];s.matrix?r=si(be(),i,s.matrix):s.translation||s.rotation||s.scale?(r=y2(i),s.translation&&Al(r,r,s.translation),s.rotation&&(BI[3]=nX(BI,s.rotation),dc(r,r,BI[3],BI)),s.scale&&a5(r,r,s.scale)):r=y2(i),this._nodeTransformCache.set(e,r)}return r}_wrapAccessor(e,r){return new e(r.raw,r.byteOffset,r.byteStride,r.byteOffset+r.byteStride*(r.entryCount-1)+r.componentByteSize*r.componentCount)}_resolveUri(e){return _l(e,this._baseUri)}_getNodeParent(e){return this._nodeParentMap.get(e)}_checkVersionSupported(){const e=tw.parse(this.json.asset.version,"glTF");adt.validate(e)}_checkRequiredExtensionsSupported(){const e=this.json;if(e.extensionsRequired&&!e.extensionsRequired.every(r=>this._supportedExtensions.includes(r)))throw new F("gltf-loader-unsupported-feature","gltf loader was not able to load unsupported feature. Required extensions: "+e.extensionsRequired.join(", "))}_computeNodeParents(){this.json.nodes.forEach((e,r)=>{e.children&&e.children.forEach(i=>{this._nodeParentMap.set(i,r)})})}async _loadTextureImageData(e,r,i){const s=this._textureLoaders.get(e);if(s)return s;const n=this._createTextureLoader(r,i);return this._textureLoaders.set(e,n),n}_getTextureSourceId(e){if(e.extensions!==void 0&&e.extensions.KHR_texture_basisu!==null)return e.extensions.KHR_texture_basisu.source;if(e.source!==null)return e.source;throw new F("gltf-loader-unsupported-feature","Source is expected to be defined for a texture. It can also be omitted in favour of an KHR_texture_basisu extension tag.")}async _createTextureLoader(e,r){const i=this._getTextureSourceId(e),s=this.json.images[i];if(s.uri){if(s.uri.endsWith(".ktx2")){const l=await this._context.loadBinary(this._resolveUri(s.uri),r);return new xCe(new Uint8Array(l))}return this._context.loadImage(this._resolveUri(s.uri),r)}if(s.bufferView==null)throw new F("gltf-loader-unsupported-feature","Image bufferView must be defined.");if(s.mimeType==null)throw new F("gltf-loader-unsupported-feature","Image mimeType must be defined.");const n=this.json.bufferViews[s.bufferView],o=await this.getBuffer(n.buffer,r);if(n.byteStride!=null)throw new F("gltf-loader-unsupported-feature","byteStride not supported for image buffer");const a=o.byteOffset+(n.byteOffset||0);return _ht(new Uint8Array(o.buffer,a,n.byteLength),s.mimeType)}async getLoadedBuffersSize(){if(this._glbBuffer)return this._glbBuffer.byteLength;const e=await Wk(Array.from(this._bufferLoaders.values())),r=await Wk(Array.from(this._textureLoaders.values()));return e.reduce((i,s)=>i+(s?.byteLength??0),0)+r.reduce((i,s)=>i+(s?Fb(s)?s.data.byteLength:s.width*s.height*4:0),0)}};const odt=E0e(be(),Math.PI/2),adt=new tw(2,0,"glTF"),BI=Fh(),ldt={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},cdt={[Ke.BYTE]:1,[Ke.UNSIGNED_BYTE]:1,[Ke.SHORT]:2,[Ke.UNSIGNED_SHORT]:2,[Ke.FLOAT]:4,[Ke.INT]:4,[Ke.UNSIGNED_INT]:4};function udt(t){switch(t.componentType){case Ke.BYTE:return new Z5(t.raw,t.byteOffset,t.byteStride,t.byteOffset+t.byteStride*t.entryCount);case Ke.UNSIGNED_BYTE:return new G5(t.raw,t.byteOffset,t.byteStride,t.byteOffset+t.byteStride*t.entryCount);case Ke.SHORT:return new KR(t.raw,t.byteOffset,t.byteStride,t.byteOffset+t.byteStride*t.entryCount);case Ke.UNSIGNED_SHORT:return new HX(t.raw,t.byteOffset,t.byteStride,t.byteOffset+t.byteStride*t.entryCount);case Ke.UNSIGNED_INT:return new qX(t.raw,t.byteOffset,t.byteStride,t.byteOffset+t.byteStride*t.entryCount);case Ke.FLOAT:return new ev(t.raw,t.byteOffset,t.byteStride,t.byteOffset+t.byteStride*t.entryCount)}}let hdt=0;async function ACe(t,e,r={},i=!0){const s=await ndt.load(t,e,r),n="gltf_"+hdt++,o={lods:[],materials:new Map,textures:new Map,meta:ddt(s)},a=!(!s.json.asset.extras||s.json.asset.extras.ESRI_type!=="symbolResource"),l=new Map;await pdt(s,async(h,p,f,m)=>{const y=l.get(f)??0;l.set(f,y+1);const _=h.mode!==void 0?h.mode:St.TRIANGLES,v=_===St.TRIANGLES||_===St.TRIANGLE_STRIP||_===St.TRIANGLE_FAN?_:null;if(v==null)return void Q.getLogger("esri.views.3d.glTF").warn("[Unsupported Feature] Unsupported primitive mode ("+St[_]+"). Skipping primitive.");if(!s.hasPositions(h))return void Q.getLogger("esri.views.3d.glTF").warn("Skipping primitive without POSITION vertex attribute.");const w=s.getPositionData(h,r),x=s.getMaterial(h,r,i),T=s.hasNormals(h)?s.getNormalData(h,r):null,S=s.hasTangents(h)?s.getTangentData(h,r):null,O=s.hasTextureCoordinates(h)?s.getTextureCoordinates(h,r):null,A=s.hasVertexColors(h)?s.getVertexColors(h,r):null,I=s.getIndexData(h,r),M={transform:y2(p),attributes:{position:await w,normal:T?await T:null,texCoord0:O?await O:null,color:A?await A:null,tangent:S?await S:null},indices:await I,primitiveType:v,material:mdt(o,await x,n)};let k=null;o.meta!=null&&o.meta.ESRI_lod!=null&&o.meta.ESRI_lod.metric==="screenSpaceRadius"&&(k=o.meta.ESRI_lod.thresholds[f]),o.lods[f]=o.lods[f]||{parts:[],name:m,lodThreshold:k},o.lods[f].parts[y]=M});for(const h of o.lods)h.parts=h.parts.filter(p=>!!p);const c=await s.getLoadedBuffersSize();return{model:o,meta:{isEsriSymbolResource:a,uri:s.uri},customMeta:{},size:c}}function ddt(t){const e=t.json;let r=null;return e.nodes.forEach(i=>{const s=i.extras;s!=null&&(s.ESRI_proxyEllipsoid||s.ESRI_lod)&&(r=s)}),r}async function pdt(t,e){const r=t.json,i=r.scenes[r.scene||0].nodes,s=i.length>1,n=[];for(const a of i){const l=r.nodes[a];n.push(o(a,0)),fdt(l)&&!s&&l.extensions.MSFT_lod.ids.forEach((c,h)=>o(c,h+1))}async function o(a,l){const c=r.nodes[a],h=t.getNodeTransform(a);if(c.weights!=null&&Q.getLogger("esri.views.3d.glTF").warn("[Unsupported Feature] Morph targets are not supported."),c.mesh!=null){const p=r.meshes[c.mesh];for(const f of p.primitives)n.push(e(f,h,l,p.name))}for(const p of c.children||[])n.push(o(p,l))}await Promise.all(n)}function fdt(t){return t.extensions&&t.extensions.MSFT_lod&&Array.isArray(t.extensions.MSFT_lod.ids)}function mdt(t,e,r){const i=n=>{const o=`${r}_tex_${n&&n.id}${n&&n.name?"_"+n.name:""}`;if(n&&!t.textures.has(o)){const a=Qht(n.data,{wrap:{s:n.wrapS,t:n.wrapT},mipmap:gdt.includes(n.minFilter),noUnpackFlip:!0});t.textures.set(o,a)}return o},s=`${r}_mat_${e.id}_${e.name}`;if(!t.materials.has(s)){const n=Jht({color:[e.color[0],e.color[1],e.color[2]],opacity:e.color[3],alphaMode:e.alphaMode,alphaCutoff:e.alphaCutoff,doubleSided:e.doubleSided,colorMixMode:e.ESRI_externalColorMixMode,textureColor:e.colorTexture?i(e.colorTexture):void 0,textureNormal:e.normalTexture?i(e.normalTexture):void 0,textureOcclusion:e.occlusionTexture?i(e.occlusionTexture):void 0,textureEmissive:e.emissiveTexture?i(e.emissiveTexture):void 0,textureMetallicRoughness:e.metallicRoughnessTexture?i(e.metallicRoughnessTexture):void 0,emissiveFactor:[e.emissiveFactor[0],e.emissiveFactor[1],e.emissiveFactor[2]],colorTextureTransform:e.colorTextureTransform,normalTextureTransform:e.normalTextureTransform,occlusionTextureTransform:e.occlusionTextureTransform,emissiveTextureTransform:e.emissiveTextureTransform,metallicRoughnessTextureTransform:e.metallicRoughnessTextureTransform,metallicFactor:e.metallicFactor,roughnessFactor:e.roughnessFactor});t.materials.set(s,n)}return s}const gdt=[Ct.LINEAR_MIPMAP_LINEAR,Ct.LINEAR_MIPMAP_NEAREST];function ydt(t,e){switch(e){case St.TRIANGLES:return _dt(t);case St.TRIANGLE_STRIP:return vdt(t);case St.TRIANGLE_FAN:return bdt(t)}}function _dt(t){return typeof t=="number"?A2(t):W0(t)?new Uint16Array(t):t}function vdt(t){const e=typeof t=="number"?t:t.length;if(e<3)return[];const r=e-2,i=l4(3*r);if(typeof t=="number"){let s=0;for(let n=0;n<r;n+=1)n%2==0?(i[s++]=n,i[s++]=n+1,i[s++]=n+2):(i[s++]=n+1,i[s++]=n,i[s++]=n+2)}else{let s=0;for(let n=0;n<r;n+=1)n%2==0?(i[s++]=t[n],i[s++]=t[n+1],i[s++]=t[n+2]):(i[s++]=t[n+1],i[s++]=t[n],i[s++]=t[n+2])}return i}function bdt(t){const e=typeof t=="number"?t:t.length;if(e<3)return new Uint16Array(0);const r=e-2,i=r<=65536?new Uint16Array(3*r):new Uint32Array(3*r);if(typeof t=="number"){let a=0;for(let l=0;l<r;++l)i[a++]=0,i[a++]=l+1,i[a++]=l+2;return i}const s=t[0];let n=t[1],o=0;for(let a=0;a<r;++a){const l=t[a+2];i[o++]=s,i[o++]=n,i[o++]=l,n=l}return i}let wdt=class{constructor(){this.geometries=new Array,this.materials=new Array,this.textures=new Array}},xdt=class{constructor(e,r,i){this.name=e,this.lodThreshold=r,this.pivotOffset=i,this.stageResources=new wdt,this.numberOfVertices=0}};const Wm=Q.getLogger("esri.views.3d.layers.graphics.objectResourceUtils");async function OCe(t,e){const r=await Tdt(t,e),i=await Odt(r.textureDefinitions??{},e);let s=0;for(const n in i)if(i.hasOwnProperty(n)){const o=i[n];s+=o?.image?o.image.width*o.image.height*4:0}return{resource:r,textures:i,size:s+Xve(r)}}async function Tdt(t,e){const r=e!=null&&e.streamDataRequester;if(r)return Sdt(t,r,e);const i=await gu(qt(t,e));if(i.ok===!0)return i.value.data;Lo(i.error),RCe(i.error)}async function Sdt(t,e,r){const i=await gu(e.request(t,"json",r));if(i.ok===!0)return i.value;Lo(i.error),RCe(i.error.details.url)}function RCe(t){throw new F("",`Request for object resource failed: ${t}`)}function Edt(t){const e=t.params,r=e.topology;let i=!0;switch(e.vertexAttributes||(Wm.warn("Geometry must specify vertex attributes"),i=!1),e.topology){case"PerAttributeArray":break;case"Indexed":case null:case void 0:{const n=e.faces;if(n){if(e.vertexAttributes)for(const o in e.vertexAttributes){const a=n[o];a&&a.values?(a.valueType!=null&&a.valueType!=="UInt32"&&(Wm.warn(`Unsupported indexed geometry indices type '${a.valueType}', only UInt32 is currently supported`),i=!1),a.valuesPerElement!=null&&a.valuesPerElement!==1&&(Wm.warn(`Unsupported indexed geometry values per element '${a.valuesPerElement}', only 1 is currently supported`),i=!1)):(Wm.warn(`Indexed geometry does not specify face indices for '${o}' attribute`),i=!1)}}else Wm.warn("Indexed geometries must specify faces"),i=!1;break}default:Wm.warn(`Unsupported topology '${r}'`),i=!1}t.params.material||(Wm.warn("Geometry requires material"),i=!1);const s=t.params.vertexAttributes;for(const n in s)s[n].values||(Wm.warn("Geometries with externally defined attributes are not yet supported"),i=!1);return i}function Cdt(t,e){const r=new Array,i=new Array,s=new Array,n=new yE,o=t.resource,a=tw.parse(o.version||"1.0","wosr");Pdt.validate(a);const l=o.model.name,c=o.model.geometries,h=o.materialDefinitions??{},p=t.textures;let f=0;const m=new Map;for(let y=0;y<c.length;y++){const _=c[y];if(!Edt(_))continue;const v=Rdt(_),w=_.params.vertexAttributes,x=[];for(const D in w){const U=w[D],X=U.values;x.push([D,new ke(X,U.valuesPerElement,!0)])}const T=[];if(_.params.topology!=="PerAttributeArray"){const D=_.params.faces;for(const U in D)T.push([U,D[U].values])}const S=v.texture,O=p&&p[S];if(O&&!m.has(S)){const{image:D,parameters:U}=O,X=new zw(D,U);i.push(X),m.set(S,X)}const A=m.get(S),I=A?A.id:void 0,M=v.material;let k=n.get(M,S);if(k==null){const D=h[M.substring(M.lastIndexOf("/")+1)].params;D.transparency===1&&(D.transparency=0);const U=O&&O.alphaChannelUsage,X=D.transparency>0||U==="transparency"||U==="maskAndTransparency",W=O?PCe(O.alphaChannelUsage):void 0,G={ambient:Fa(D.diffuse),diffuse:Fa(D.diffuse),opacity:1-(D.transparency||0),transparent:X,textureAlphaMode:W,textureAlphaCutoff:.33,textureId:I,initTextureTransparent:!0,doubleSided:!0,cullFace:pi.None,colorMixMode:D.externalColorMixMode||"tint",textureAlphaPremultiplied:O?.parameters.preMultiplyAlpha??!1};e!=null&&e.materialParamsMixin&&Object.assign(G,e.materialParamsMixin),k=new Zf(G),n.set(M,S,k)}s.push(k);const L=new Vs(k,x,T);f+=T.find(D=>D[0]===E.POSITION)?.[1].length??0,r.push(L)}return{engineResources:[{name:l,stageResources:{textures:i,materials:s,geometries:r},pivotOffset:o.model.pivotOffset,numberOfVertices:f,lodThreshold:null}],referenceBoundingBox:Adt(r)}}function Adt(t){const e=xi();return t.forEach(r=>{const i=r.boundingInfo;i!=null&&(kf(e,i.bbMin),kf(e,i.bbMax))}),e}async function Odt(t,e){const r=new Array;for(const n in t){const o=t[n],a=o.images[0].data;if(!a){Wm.warn("Externally referenced texture data is not yet supported");continue}const l=o.encoding+";base64,"+a,c="/textureDefinitions/"+n,h=o.channels==="rgba"?o.alphaChannelUsage||"transparency":"none",p={noUnpackFlip:!0,wrap:{s:$t.REPEAT,t:$t.REPEAT},preMultiplyAlpha:PCe(h)!==Yr.Opaque},f=e!=null&&e.disableTextures?Promise.resolve(null):Gg(l,e);r.push(f.then(m=>({refId:c,image:m,parameters:p,alphaChannelUsage:h})))}const i=await Promise.all(r),s={};for(const n of i)s[n.refId]=n;return s}function PCe(t){switch(t){case"mask":return Yr.Mask;case"maskAndTransparency":return Yr.MaskBlend;case"none":return Yr.Opaque;default:return Yr.Blend}}function Rdt(t){const e=t.params;return{id:1,material:e.material,texture:e.texture,region:e.texture}}const Pdt=new tw(1,2,"wosr"),Lx=2.1;async function MCe(t,e){const r=ICe(B7(t));if(r.fileType==="wosr"){const p=await(e.cache?e.cache.loadWOSR(r.url,e):OCe(r.url,e)),{engineResources:f,referenceBoundingBox:m}=Cdt(p,e);return{lods:f,referenceBoundingBox:m,isEsriSymbolResource:!1,isWosr:!0}}const i=await(e.cache?e.cache.loadGLTF(r.url,e,!!e.usePBR):ACe(new ECe(e.streamDataRequester),r.url,e,e.usePBR)),s=i.model.meta?.ESRI_proxyEllipsoid,n=i.meta.isEsriSymbolResource&&s!=null&&i.meta.uri.includes("/RealisticTrees/");n&&!i.customMeta.esriTreeRendering&&(i.customMeta.esriTreeRendering=!0,Ldt(i,s));const o=!!e.usePBR,a=i.meta.isEsriSymbolResource?{usePBR:o,isSchematic:!1,treeRendering:n,mrrFactors:[...Dct]}:{usePBR:o,isSchematic:!1,treeRendering:!1,mrrFactors:[...T6]},l={...e.materialParamsMixin,treeRendering:n},{engineResources:c,referenceBoundingBox:h}=$Ce(i,a,l,e.skipHighLods&&r.specifiedLodIndex==null?{skipHighLods:!0}:{skipHighLods:!1,singleLodIndex:r.specifiedLodIndex});return{lods:c,referenceBoundingBox:h,isEsriSymbolResource:i.meta.isEsriSymbolResource,isWosr:!1}}function ICe(t){const e=t.match(/(.*\.(gltf|glb))(\?lod=([0-9]+))?$/);return e?{fileType:"gltf",url:e[1],specifiedLodIndex:e[4]!=null?Number(e[4]):null}:t.match(/(.*\.(json|json\.gz))$/)?{fileType:"wosr",url:t,specifiedLodIndex:null}:{fileType:"unknown",url:t,specifiedLodIndex:null}}function $Ce(t,e,r,i){const s=t.model,n=new Array,o=new Map,a=new Map,l=s.lods.length,c=xi();return s.lods.forEach((h,p)=>{const f=i.skipHighLods===!0&&(l>1&&p===0||l>3&&p===1)||i.skipHighLods===!1&&i.singleLodIndex!=null&&p!==i.singleLodIndex;if(f&&p!==0)return;const m=new xdt(h.name,h.lodThreshold,[0,0,0]);h.parts.forEach(y=>{const _=f?new Zf({}):Mdt(s,y,m,e,r,o,a),{geometry:v,vertexCount:w}=Idt(y,_??new Zf({})),x=v.boundingInfo;x!=null&&p===0&&(kf(c,x.bbMin),kf(c,x.bbMax)),_!=null&&(m.stageResources.geometries.push(v),m.numberOfVertices+=w)}),f||n.push(m)}),{engineResources:n,referenceBoundingBox:c}}function Mdt(t,e,r,i,s,n,o){const a=e.material+(e.attributes.normal?"_normal":"")+(e.attributes.color?"_color":"")+(e.attributes.texCoord0?"_texCoord0":"")+(e.attributes.tangent?"_tangent":""),l=t.materials.get(e.material),c=e.attributes.texCoord0!=null,h=e.attributes.normal!=null;if(l==null)return null;const p=$dt(l.alphaMode);if(!n.has(a)){if(c){const O=(A,I=!1)=>{if(A!=null&&!o.has(A)){const M=t.textures.get(A);if(M!=null){const k=M.data;o.set(A,new zw(Fb(k)?k.data:k,{...M.parameters,preMultiplyAlpha:!Fb(k)&&I,encoding:Fb(k)&&k.encoding!=null?k.encoding:void 0}))}}};O(l.textureColor,p!==Yr.Opaque),O(l.textureNormal),O(l.textureOcclusion),O(l.textureEmissive),O(l.textureMetallicRoughness)}const m=l.color[0]**(1/Lx),y=l.color[1]**(1/Lx),_=l.color[2]**(1/Lx),v=l.emissiveFactor[0]**(1/Lx),w=l.emissiveFactor[1]**(1/Lx),x=l.emissiveFactor[2]**(1/Lx),T=l.textureColor!=null&&c?o.get(l.textureColor):null,S=ZEe({normalTexture:l.textureNormal,metallicRoughnessTexture:l.textureMetallicRoughness,metallicFactor:l.metallicFactor,roughnessFactor:l.roughnessFactor,emissiveTexture:l.textureEmissive,emissiveFactor:l.emissiveFactor,occlusionTexture:l.textureOcclusion});n.set(a,new Zf({...i,transparent:p===Yr.Blend,customDepthTest:ow.Lequal,textureAlphaMode:p,textureAlphaCutoff:l.alphaCutoff,diffuse:[m,y,_],ambient:[m,y,_],opacity:l.opacity,doubleSided:l.doubleSided,doubleSidedType:"winding-order",cullFace:l.doubleSided?pi.None:pi.Back,hasVertexColors:!!e.attributes.color,hasVertexTangents:!!e.attributes.tangent,normalType:h?Or.Attribute:Or.ScreenDerivative,castShadows:!0,receiveSSAO:!0,textureId:T?.id,colorMixMode:l.colorMixMode,normalTextureId:l.textureNormal!=null&&c?o.get(l.textureNormal).id:void 0,textureAlphaPremultiplied:T!=null&&!!T.parameters.preMultiplyAlpha,occlusionTextureId:l.textureOcclusion!=null&&c?o.get(l.textureOcclusion).id:void 0,emissiveTextureId:l.textureEmissive!=null&&c?o.get(l.textureEmissive).id:void 0,metallicRoughnessTextureId:l.textureMetallicRoughness!=null&&c?o.get(l.textureMetallicRoughness).id:void 0,emissiveFactor:[v,w,x],mrrFactors:S?[...uJ]:[l.metallicFactor,l.roughnessFactor,i.mrrFactors[2]],isSchematic:S,colorTextureTransformMatrix:vf(l.colorTextureTransform),normalTextureTransformMatrix:vf(l.normalTextureTransform),occlusionTextureTransformMatrix:vf(l.occlusionTextureTransform),emissiveTextureTransformMatrix:vf(l.emissiveTextureTransform),metallicRoughnessTextureTransformMatrix:vf(l.metallicRoughnessTextureTransform),...s}))}const f=n.get(a);if(r.stageResources.materials.push(f),c){const m=y=>{y!=null&&r.stageResources.textures.push(o.get(y))};m(l.textureColor),m(l.textureNormal),m(l.textureOcclusion),m(l.textureEmissive),m(l.textureMetallicRoughness)}return f}function Idt(t,e){const r=t.attributes.position.count,i=ydt(t.indices||r,t.primitiveType),s=Yi(3*r),{typedBuffer:n,typedBufferStride:o}=t.attributes.position;F2(s,n,t.transform,3,o);const a=[[E.POSITION,new ke(s,3,!0)]],l=[[E.POSITION,i]];if(t.attributes.normal!=null){const c=Yi(3*r),{typedBuffer:h,typedBufferStride:p}=t.attributes.normal;L_(GI,t.transform),fw(c,h,GI,3,p),a.push([E.NORMAL,new ke(c,3,!0)]),l.push([E.NORMAL,i])}if(t.attributes.tangent!=null){const c=Yi(4*r),{typedBuffer:h,typedBufferStride:p}=t.attributes.tangent;L_(GI,t.transform),pJ(c,h,GI,4,p),a.push([E.TANGENT,new ke(c,4,!0)]),l.push([E.TANGENT,i])}if(t.attributes.texCoord0!=null){const c=Yi(2*r),{typedBuffer:h,typedBufferStride:p}=t.attributes.texCoord0;fJ(c,h,2,p),a.push([E.UV0,new ke(c,2,!0)]),l.push([E.UV0,i])}if(t.attributes.color!=null){const c=new Uint8Array(4*r);t.attributes.color.elementCount===4?t.attributes.color instanceof cp?V4(c,t.attributes.color,255):t.attributes.color instanceof ha?mJ(c,t.attributes.color):t.attributes.color instanceof QR&&V4(c,t.attributes.color,1/256):(c.fill(255),t.attributes.color instanceof dn?M4(c,t.attributes.color,255,4):t.attributes.color instanceof j5?gP(c,t.attributes.color.typedBuffer,4,t.attributes.color.typedBufferStride):t.attributes.color instanceof q5&&M4(c,t.attributes.color,1/256,4)),a.push([E.COLOR,new ke(c,4,!0)]),l.push([E.COLOR,i])}return{geometry:new Vs(e,a,l),vertexCount:r}}const GI=Li();function $dt(t){switch(t){case"BLEND":return Yr.Blend;case"MASK":return Yr.Mask;case"OPAQUE":case null:case void 0:return Yr.Opaque}}function Ldt(t,e){for(let r=0;r<t.model.lods.length;++r){const i=t.model.lods[r];for(const s of i.parts){const n=s.attributes.normal;if(n==null)return;const o=s.attributes.position,a=o.count,l=C(),c=C(),h=C(),p=new Uint8Array(4*a),f=new Float64Array(3*a),m=On(be(),s.transform);let y=0,_=0;for(let v=0;v<a;v++){o.getVec(v,c),n.getVec(v,l),$e(c,c,s.transform),he(h,c,e.center),eN(h,h,e.radius);const w=h[2],x=Ce(h),T=Math.min(.45+.55*x*x,1);eN(h,h,e.radius),m!==null&&$e(h,h,m),me(h,h),r+1!==t.model.lods.length&&t.model.lods.length>1&&Br(h,h,l,w>-1?.2:Math.min(-4*w-3.8,1)),f[y]=h[0],f[y+1]=h[1],f[y+2]=h[2],y+=3,p[_]=255*T,p[_+1]=255*T,p[_+2]=255*T,p[_+3]=255,_+=4}s.attributes.normal=new dn(f),s.attributes.color=new ha(p)}}}const INt=Object.freeze(Object.defineProperty({__proto__:null,fetch:MCe,gltfToEngineResources:$Ce,parseUrl:ICe},Symbol.toStringTag,{value:"Module"}));async function Ddt(t){if(t===null||t.styleName==null&&t.styleUrl==null)return null;const e=t.name;if(e==null)throw new F("symbolstyleutils:style-symbol-reference-name-missing","Missing name in style symbol reference");const r={portal:t.portal},i=await hZ(t,r).catch(()=>null);if(i===null)return null;const s=jZ(e,i.data);if(s&&!s.formatInfos?.some(a=>a.type==="gltf_basisu"))return null;const n=await HZ(i,e,r,"webRef",(a,l)=>h0e(a,l,["gltf_basisu","gltf"])).catch(()=>null);if(n===null||n.type!=="point-3d")return null;const o=n.symbolLayers.items[0];return o.type==="object"?o.resource:null}let Ndt=class{constructor(e,r,i){this._elementSize=r,this._buffer=Lr.createVertex(e,Tr.STATIC_DRAW),this.resize(i)}destroy(){this._buffer.dispose()}get elementSize(){return this._elementSize}get capacity(){return this._capacity}get array(){return this._array}get buffer(){return this._buffer}get memoryUsage(){return{cpu:this._capacity*this._elementSize,gpu:this._capacity*this._elementSize}}copyRange(e,r,i,s=0){const n=new Uint8Array(this.array,e*this.elementSize,(r-e)*this.elementSize);new Uint8Array(i.array,s*this.elementSize).set(n)}transferAll(){this._buffer.setData(this._array)}transferRange(e,r){const i=e*this._elementSize,s=r*this._elementSize;this._buffer.setSubData(new Uint8Array(this._array),i,i,s)}resize(e){const r=e*this._elementSize,i=new ArrayBuffer(r);this._array&&(e>=this._capacity?new Uint8Array(i).set(new Uint8Array(this._array)):new Uint8Array(i).set(new Uint8Array(this._array).subarray(0,e*this._elementSize))),this._array=i,this._buffer.setSize(r),this._capacity=e}},Fdt=class{constructor(e){this.modelOriginHi=e.getField(E.MODELORIGINHI,dn),this.modelOriginLo=e.getField(E.MODELORIGINLO,dn),this.model=e.getField(E.MODEL,U_),this.modelNormal=e.getField(E.MODELNORMAL,U_),this.featureAttribute=e.getField(E.INSTANCEFEATUREATTRIBUTE,cp),this.color=e.getField(E.INSTANCECOLOR,ha),this.objectAndLayerIdColor=e.getField(E.INSTANCEOBJECTANDLAYERIDCOLOR,ha)}},rae=class{constructor(e,r){this._headIndex=0,this._tailIndex=0,this._firstIndex=null,this._captureFirstIndex=!0,this._updating=!1,this._prevHeadIndex=0,this._resized=!1,this._rctx=e,this._instanceBufferLayout=r,this._elementSize=r.stride,this._capacity=1}destroy(){this._buffer&&this._buffer.destroy()}get buffer(){return this._buffer.buffer}get view(){return this._view}get capacity(){return this._capacity}get size(){const e=this._headIndex,r=this._tailIndex;return e>=r?e-r:e+this._capacity-r}get isEmpty(){return this._headIndex===this._tailIndex}get isFull(){return this._tailIndex===(this._headIndex+1)%this._capacity}get headIndex(){return this._headIndex}get tailIndex(){return this._tailIndex}get firstIndex(){return this._firstIndex}get memoryUsage(){return this._buffer?this._buffer.memoryUsage:{cpu:0,gpu:0}}reset(){this._headIndex=0,this._tailIndex=0,this._firstIndex=null}startUpdateCycle(){this._captureFirstIndex=!0}beginUpdate(){et(!this._updating,"already updating"),this._updating=!0,this._prevHeadIndex=this._headIndex}endUpdate(){et(this._updating,"not updating"),this.size<VOe*this.capacity&&this._shrink(),this._resized?(this._buffer.transferAll(),this._resized=!1):this._transferRange(this._prevHeadIndex,this._headIndex),this._updating=!1}allocateHead(){et(this._updating,"not updating"),this.isFull&&this._grow();const e=this.headIndex;return this._captureFirstIndex&&(this._firstIndex=e,this._captureFirstIndex=!1),this._incrementHead(),et(this._headIndex!==this._tailIndex,"invalid pointers"),e}freeTail(){et(this._updating,"not updating"),et(this.size>0,"invalid size");const e=this._tailIndex===this._firstIndex;this._incrementTail(),e&&(this._firstIndex=this._tailIndex)}_grow(){const e=Math.max(z4,Math.floor(this._capacity*oF));this._resize(e)}_shrink(){const e=Math.max(z4,Math.floor(this._capacity*kOe));this._resize(e)}_resize(e){if(et(this._updating,"not updating"),e===this._capacity)return;const r=new Ndt(this._rctx,this._elementSize,e);if(this._buffer){this._firstIndex&&(this._firstIndex=(this._firstIndex+this._capacity-this._tailIndex)%this._capacity);const i=this.size,s=this._compactInstances(r);et(s===i,"invalid compaction"),this._buffer.destroy(),this._tailIndex=0,this._headIndex=s,this._prevHeadIndex=0}this._resized=!0,this._capacity=e,this._buffer=r,this._view=new Fdt(this._instanceBufferLayout.createView(this._buffer.array))}_compactInstances(e){const r=this._headIndex,i=this._tailIndex;return i<r?(this._buffer.copyRange(i,r,e),r-i):i>r?(this._buffer.copyRange(i,this._capacity,e),r>0&&this._buffer.copyRange(0,r,e,this._capacity-i),r+(this._capacity-i)):0}_incrementHead(e=1){this._headIndex=(this._headIndex+e)%this._capacity}_incrementTail(e=1){this._tailIndex=(this._tailIndex+e)%this._capacity}_transferRange(e,r){e<r?this._buffer.transferRange(e,r):e>r&&(r>0&&this._buffer.transferRange(0,r),this._buffer.transferRange(e,this._capacity))}};const z4=64;var Ri;function Udt(t){let e=zi().mat4f64(E.LOCALTRANSFORM).mat4f64(E.GLOBALTRANSFORM).vec4f64(E.BOUNDINGSPHERE).vec3f64(E.MODELORIGIN).mat3f(E.MODEL).mat3f(E.MODELNORMAL).vec2f(E.MODELSCALEFACTORS);return t.includes(E.FEATUREATTRIBUTE)&&(e=e.vec4f(E.FEATUREATTRIBUTE)),t.includes(E.COLOR)&&(e=e.vec4u8(E.COLOR)),t.includes(E.OBJECTANDLAYERIDCOLOR)&&(e=e.vec4u8(E.OBJECTANDLAYERIDCOLOR)),e=e.u8(E.STATE).u8(E.LODLEVEL),e}(function(t){t[t.ALLOCATED=1]="ALLOCATED",t[t.DEFAULT_ACTIVE=2]="DEFAULT_ACTIVE",t[t.VISIBLE=4]="VISIBLE",t[t.HIGHLIGHT=8]="HIGHLIGHT",t[t.HIGHLIGHT_ACTIVE=16]="HIGHLIGHT_ACTIVE",t[t.REMOVE=32]="REMOVE",t[t.TRANSFORM_CHANGED=64]="TRANSFORM_CHANGED",t[t.ACTIVE=18]="ACTIVE"})(Ri||(Ri={}));let iae=class{constructor(e){this.localTransform=e.getField(E.LOCALTRANSFORM,ZO),this.globalTransform=e.getField(E.GLOBALTRANSFORM,ZO),this.modelOrigin=e.getField(E.MODELORIGIN,Lh),this.model=e.getField(E.MODEL,U_),this.modelNormal=e.getField(E.MODELNORMAL,U_),this.modelScaleFactors=e.getField(E.MODELSCALEFACTORS,ev),this.boundingSphere=e.getField(E.BOUNDINGSPHERE,B5),this.featureAttribute=e.getField(E.FEATUREATTRIBUTE,cp),this.color=e.getField(E.COLOR,ha),this.objectAndLayerIdColor=e.getField(E.OBJECTANDLAYERIDCOLOR,ha),this.state=e.getField(E.STATE,C2),this.lodLevel=e.getField(E.LODLEVEL,C2)}},GT=class extends Te{constructor(e,r){super(e),this.events=new os,this._capacity=0,this._size=0,this._next=0,this._layout=Udt(r),this._capacity=z4,this._buffer=this._layout.createBuffer(this._capacity),this._view=new iae(this._buffer)}get capacity(){return this._capacity}get size(){return this._size}get view(){return this._view}addInstance(){this._size+1>this._capacity&&this._grow();const e=this._findSlot();return this._view.state.set(e,Ri.ALLOCATED),this._size++,this.events.emit("instances-changed"),e}removeInstance(e){const r=this._view.state;et(e>=0&&e<this._capacity&&(r.get(e)&Ri.ALLOCATED)!=0,"invalid instance handle"),this._getStateFlag(e,Ri.ACTIVE)?this._setStateFlags(e,Ri.REMOVE):this.freeInstance(e),this.events.emit("instances-changed")}freeInstance(e){const r=this._view.state;et(e>=0&&e<this._capacity&&(r.get(e)&Ri.ALLOCATED)!=0,"invalid instance handle"),r.set(e,0),this._size--}setLocalTransform(e,r,i=!0){this._view.localTransform.setMat(e,r),i&&this.updateModelTransform(e)}getLocalTransform(e,r){this._view.localTransform.getMat(e,r)}setGlobalTransform(e,r,i=!0){this._view.globalTransform.setMat(e,r),i&&this.updateModelTransform(e)}getGlobalTransform(e,r){this._view.globalTransform.getMat(e,r)}updateModelTransform(e){const r=this._view,i=Dl,s=Qh;r.localTransform.getMat(e,sae),r.globalTransform.getMat(e,V9);const n=si(V9,V9,sae);se(i,n[12],n[13],n[14]),r.modelOrigin.setVec(e,i),Ph(s,n),r.model.setMat(e,s);const o=OWe(Dl,n);o.sort(),r.modelScaleFactors.set(e,0,o[1]),r.modelScaleFactors.set(e,1,o[2]),Nw(s,s),Mh(s,s),r.modelNormal.setMat(e,s),this._setStateFlags(e,Ri.TRANSFORM_CHANGED),this.events.emit("instance-transform-changed",{index:e})}getModelTransform(e,r){const i=this._view;i.model.getMat(e,Qh),i.modelOrigin.getVec(e,Dl),r[0]=Qh[0],r[1]=Qh[1],r[2]=Qh[2],r[3]=0,r[4]=Qh[3],r[5]=Qh[4],r[6]=Qh[5],r[7]=0,r[8]=Qh[6],r[9]=Qh[7],r[10]=Qh[8],r[11]=0,r[12]=Dl[0],r[13]=Dl[1],r[14]=Dl[2],r[15]=1}applyShaderTransformation(e,r){this.shaderTransformation!=null&&this.shaderTransformation.applyTransform(this,e,r)}getCombinedModelTransform(e,r){return this.getModelTransform(e,r),this.shaderTransformation!=null&&this.shaderTransformation.applyTransform(this,e,r),r}getCombinedLocalTransform(e,r){this._view.localTransform.getMat(e,r),this.shaderTransformation!=null&&this.shaderTransformation.applyTransform(this,e,r)}getCombinedMaxScaleFactor(e){let r=this._view.modelScaleFactors.get(e,1);return this.shaderTransformation!=null&&(this.shaderTransformation.scaleFactor(Dl,this,e),r*=Math.max(Dl[0],Dl[1],Dl[2])),r}getCombinedMedianScaleFactor(e){let r=this._view.modelScaleFactors.get(e,0);return this.shaderTransformation!=null&&(this.shaderTransformation.scaleFactor(Dl,this,e),r*=kdt(Dl[0],Dl[1],Dl[2])),r}getModel(e,r){this._view.model.getMat(e,r)}setFeatureAttribute(e,r){this._view.featureAttribute.setVec(e,r)}getFeatureAttribute(e,r){this._view.featureAttribute.getVec(e,r)}setColor(e,r){this._view.color.setVec(e,r)}setObjectAndLayerIdColor(e,r){this._view.objectAndLayerIdColor.setVec(e,r)}setVisible(e,r){r!==this.getVisible(e)&&(this._setStateFlag(e,Ri.VISIBLE,r),this.events.emit("instance-visibility-changed",{index:e}))}getVisible(e){return this._getStateFlag(e,Ri.VISIBLE)}setHighlight(e,r){r!==this.getHighlight(e)&&(this._setStateFlag(e,Ri.HIGHLIGHT,r),this.events.emit("instance-highlight-changed"))}getHighlight(e){return this._getStateFlag(e,Ri.HIGHLIGHT)}getState(e){return this._view.state.get(e)}getLodLevel(e){return this._view.lodLevel.get(e)}countFlags(e){let r=0;for(let i=0;i<this._capacity;++i)this.getState(i)&e&&++r;return r}_setStateFlags(e,r){const i=this._view.state;r=i.get(e)|r,i.set(e,r)}_clearStateFlags(e,r){const i=this._view.state;r=i.get(e)&~r,i.set(e,r)}_setStateFlag(e,r,i){i?this._setStateFlags(e,r):this._clearStateFlags(e,r)}_getStateFlag(e,r){return!!(this._view.state.get(e)&r)}_grow(){this._capacity=Math.max(z4,Math.floor(this._capacity*oF)),this._buffer=this._layout.createBuffer(this._capacity).copyFrom(this._buffer),this._view=new iae(this._buffer)}_findSlot(){const e=this._view.state;let r=this._next;for(;e.get(r)&Ri.ALLOCATED;)r=r+1===this._capacity?0:r+1;return this._next=r+1===this._capacity?0:r+1,r}};function kdt(t,e,r){return Math.max(Math.min(t,e),Math.min(Math.max(t,e),r))}u([d({constructOnly:!0})],GT.prototype,"shaderTransformation",void 0),u([d()],GT.prototype,"_size",void 0),u([d({readOnly:!0})],GT.prototype,"size",null),GT=u([R("esri.views.3d.webgl-engine.lib.lodRendering.InstanceData")],GT);const Dl=C(),Qh=Li(),sae=be(),V9=be();let Vdt=class extends Wd{constructor(e,r){super(i=>this._instanceData.view.boundingSphere.getVec(i,this._tmpSphere),{maximumDepth:25}),this._instanceData=e,this._boundingSphere=r,this._tmpSphere=gs(),this._tmpMat4=be()}addInstance(e){const r=this._instanceData.view.boundingSphere,i=this._instanceData.getCombinedModelTransform(e,this._tmpMat4);$e(this._tmpSphere,this._boundingSphere.center,i),this._tmpSphere[3]=this._boundingSphere.radius*v2(i),r.setVec(e,this._tmpSphere),this.add([e])}removeInstance(e){this.remove([e])}},zdt=class{constructor(e,r){this._worldSpaceRadius=e,this._minScreenSpaceRadii=r}selectLevel(e,r,i){const s=i.computeScreenPixelSizeAt(e),n=this._worldSpaceRadius*r/s;let o=0;for(let a=1;a<this._minScreenSpaceRadii.length;++a)n>=this._minScreenSpaceRadii[a]&&(o=a);return o}},Bdt=class extends X5{constructor(e,r,i,s,n,o){super(e,r),this.layerUid=e,this.graphicUid=r,this.geometryId=i,this.triangleNr=s,this.baseBoundingSphere=n,this.numLodLevels=o}};function gJ(t){return fp(t)&&t.intersector===ki.LOD&&!!t.target}let Gdt=class{constructor(e,r){const i=e.renderContext.rctx,s=r.geometry;this._materialRepository=e.materialRepository,s.material.setParameters({instancedDoublePrecision:!0});const n=s.material.createBufferWriter(),o=n.vertexBufferLayout,a=n.elementCount(s),l=o.createBuffer(a);n.write(null,null,s,l,0),this.geometry=s,this.material=s.material,this.glMaterials=new EEe(s.material,this._materialRepository),this.vertexBufferLayout=o,this.vbo=Lr.createVertex(i,Tr.STATIC_DRAW,l.buffer),this.vao=new pp(i,br,{geometry:Cc(o)},{geometry:this.vbo}),this.vertexCount=a}destroy(){this.glMaterials.destroy(),this.vbo.dispose(),this.vao.dispose()}get boundingInfo(){return this.geometry.boundingInfo}get triangleCount(){return this.vertexCount/3}intersect(e,r,i,s,n,o,a,l){const c=this.geometry.id;this.material.intersect(this.geometry,e.transform.transform,e,i,s,(h,p,f,m,y)=>{if(h>=0){if(r!=null&&!r(e.rayBegin,e.rayEnd,h))return;const _=new Bdt(o.layerUid,o.graphicUid(n),c,f,a,l);if((e.results.min.drapedLayerOrder==null||y>=e.results.min.drapedLayerOrder)&&(e.results.min.dist==null||h<e.results.min.dist)&&e.results.min.set(ki.LOD,_,h,p,e.transform.transform,y),e.options.store!==vo.MIN&&(e.results.max.drapedLayerOrder==null||y>=e.results.max.drapedLayerOrder)&&(e.results.max.dist==null||h>e.results.max.dist)&&e.results.max.set(ki.LOD,_,h,p,e.transform.transform,y),e.options.store===vo.ALL){const v=JX(e.results.min.ray);v.set(ki.LOD,_,h,p,e.transform.transform,y),e.results.all.push(v)}}})}},jdt=class LCe{static async create(e,r,i){const s=await Promise.allSettled(r.components.map(o=>e.controller.schedule(()=>new Gdt(e,o),i))),n=s.map(o=>o.status==="fulfilled"?o.value:null).filter(xw);if(sn(i)||n.length!==s.length){n.forEach(o=>o.destroy()),Xt(i);for(const o of s)if(o.status==="rejected")throw o.reason}return new LCe(r.minScreenSpaceRadius,n)}constructor(e,r){this.minScreenSpaceRadius=e,this.components=r}destroy(){this.components.forEach(e=>e.destroy())}intersect(e,r,i,s,n,o,a){this.components.forEach(l=>l.intersect(e,r,i,s,n,o,this.boundingSphere,a))}get boundingBox(){if(this._boundingBox==null){const e=xi();this.components.forEach(r=>{r.boundingInfo!=null&&(kf(e,r.boundingInfo.bbMin),kf(e,r.boundingInfo.bbMax))}),this._boundingBox=e}return this._boundingBox}get boundingSphere(){if(this._boundingSphere==null){const e=this.boundingBox,r=C();Bd(e,r),this._boundingSphere={center:r,radius:.5*Pge(e)}}return this._boundingSphere}get triangleCount(){return this.components.reduce((e,r)=>e+r.triangleCount,0)}};const Hdt=t=>{const e=t.baseBoundingSphere.radius,r=t.levels.map(i=>i.minScreenSpaceRadius);return new zdt(e,r)};let Zu=class extends Te{constructor(e,r){super(e),this.type=ki.LOD,this.isGround=!1,this._handles=new Oi,this._levels=[],this._defaultRenderInstanceData=[new Array],this._highlightRenderInstanceData=[new Array],this._allRenderInstanceData=[this._defaultRenderInstanceData[0],this._highlightRenderInstanceData[0]],this._instanceIndex=0,this._cycleStartIndex=0,this._slicePlane=!1,this._camera=new ut,this._updateCyclesWithStaticCamera=-1,this._needFullCycle=!1,this.slots=[ue.OPAQUE_MATERIAL,ue.TRANSPARENT_MATERIAL],this.canRender=!0,this._instanceData=new GT({shaderTransformation:e.shaderTransformation},e.optionalFields),this._handles.add(r.registerTask(dt.LOD_RENDERER,this))}initialize(){this._instanceBufferLayout=Wdt(this.optionalFields),this._glInstanceBufferLayout=Cc(this._instanceBufferLayout,1),this._handles.add([this._instanceData.events.on("instances-changed",()=>this._requestUpdateCycle()),this._instanceData.events.on("instance-transform-changed",({index:e})=>{this._requestUpdateCycle(),this.metadata.notifyGraphicGeometryChanged(e)}),this._instanceData.events.on("instance-visibility-changed",({index:e})=>{this._requestUpdateCycle(!0),this.metadata.notifyGraphicVisibilityChanged(e)}),this._instanceData.events.on("instance-highlight-changed",()=>this._requestUpdateCycle(!0))])}destroy(){this._handles.destroy()}get _enableLevelSelection(){return this.symbol.levels.length>1}get levels(){return this._levels}get baseBoundingBox(){return this._levels[this._levels.length-1].boundingBox}get baseBoundingSphere(){return this._levels[this._levels.length-1].boundingSphere}get baseMaterial(){return this._levels[this._levels.length-1].components[0].material}get slicePlaneEnabled(){return this._slicePlane}set slicePlaneEnabled(e){this._slicePlane=e}get layerUid(){return this.metadata.layerUid}get instanceData(){return this._instanceData}get memoryUsage(){const e={cpu:0,gpu:0};return this._allRenderInstanceData.forEach(r=>r.forEach(i=>{e.cpu+=i.memoryUsage.cpu,e.gpu+=i.memoryUsage.gpu})),e}get renderStats(){const e=this._instanceData.size,r=[];return this._levels.forEach((i,s)=>{const n=this._allRenderInstanceData[0][s].size+this._allRenderInstanceData[1][s].size,o=i.triangleCount;r.push({renderedInstances:n,renderedTriangles:n*o,trianglesPerInstance:o})}),{totalInstances:e,renderedInstances:r.reduce((i,s)=>i+s.renderedInstances,0),renderedTriangles:r.reduce((i,s)=>i+s.renderedTriangles,0),levels:r}}async initializeRenderContext(e,r){this._context=e;const i=e.renderContext.rctx,s=await Promise.allSettled(this.symbol.levels.map(o=>(this._defaultRenderInstanceData[0].push(new rae(i,this._instanceBufferLayout)),this._highlightRenderInstanceData[0].push(new rae(i,this._instanceBufferLayout)),jdt.create(e,o,r)))),n=s.map(o=>o.status==="fulfilled"?o.value:null).filter(xw);if(sn(r)||n.length!==s.length){n.forEach(o=>o.destroy()),Xt(r);for(const o of s)if(o.status==="rejected")throw o.reason}this._levels=n,this._levelSelector=Hdt(this)}uninitializeRenderContext(){this._invalidateOctree(),this._levels.forEach(e=>e.destroy()),this._defaultRenderInstanceData[0].forEach(e=>e.destroy()),this._highlightRenderInstanceData[0].forEach(e=>e.destroy())}get needsTransparentPass(){return this._levels.some(e=>e.components.some(r=>r.material.requiresSlot(ue.TRANSPARENT_MATERIAL,N.Color)))}get needsHighlight(){return this._highlightRenderInstanceData[0].some(e=>e.size>0)}prepareRender(e){if(!ni.LOD_INSTANCE_RENDERER_DISABLE_UPDATES){if(this._enableLevelSelection){const r=e.bindParameters.contentCamera.equals(this._camera);this._camera.copyFrom(e.bindParameters.contentCamera),r||this._requestUpdateCycle()}this._needFullCycle&&(this.runTask(za),this._needFullCycle=!1)}}prepareTechniques(e){if(!this.baseMaterial.isVisible()||!this.baseMaterial.isVisibleForOutput(e.output))return null;const r=this._getInstanceDatas(e.output);if(!r)return null;const i=new Array;return r.forEach(s=>this.levels.forEach((n,o)=>{n.components.forEach(a=>i.push(this._beginComponent(e,s[o],a)))})),i}render(e,r){const i=this._getInstanceDatas(e.output);if(!i)return;let s=0;e.rctx.bindVAO(),i.forEach(n=>this.levels.forEach((o,a)=>{o.components.forEach(l=>this._renderComponent(e,r[s++],n[a],l,a))}))}_getInstanceDatas(e){const r=e!==N.Highlight&&e!==N.ShadowHighlight,i=e!==N.ShadowExcludeHighlight;return r&&i?this._allRenderInstanceData:r?this._defaultRenderInstanceData:i?this._highlightRenderInstanceData:null}intersect(e,r,i,s){if(!this.baseMaterial.isVisible()||this._octree==null)return;const n=C();he(n,s,i);const o=a=>{this._instanceData.getCombinedModelTransform(a,aae),e.transform.set(aae),$e(lae,i,e.transform.inverse),$e(cae,s,e.transform.inverse);const l=this._instanceData.getState(a),c=this._instanceData.getLodLevel(a),h=this._levels.length;et((l&Ri.ACTIVE)!=0,"invalid instance state"),et(c>=0&&c<h,"invaid lod level"),this._levels[c].intersect(e,r,lae,cae,a,this.metadata,h)};this.baseMaterial.parameters.verticalOffset?this._octree.forEach(o):this._octree.forEachAlongRay(i,n,o)}queryDepthRange(e){return this._queryDepthRangeOctree(e)}notifyShaderTransformationChanged(){this._invalidateOctree(),this._requestUpdateCycle()}get _octree(){if(this._octreeCached==null){const e=this._instanceData,r=e.view?.state;if(!r)return null;this._octreeCached=new Vdt(e,this.baseBoundingSphere);for(let i=0;i<e.capacity;++i)r.get(i)&Ri.ACTIVE&&this._octreeCached.addInstance(i)}return this._octreeCached}_invalidateOctree(){this._octreeCached=Me(this._octreeCached)}_queryDepthRangeOctree(e){if(this._octree==null)return{near:1/0,far:-1/0};const r=e.viewForward,i=this._octree.findClosest(r,Wd.DepthOrder.FRONT_TO_BACK,e.frustum),s=this._octree.findClosest(r,Wd.DepthOrder.BACK_TO_FRONT,e.frustum);if(i==null||s==null)return{near:1/0,far:-1/0};const n=e.eye,o=this._instanceData.view;o.boundingSphere.getVec(i,Lp),he(Lp,Lp,n);const a=fe(Lp,r)-Lp[3];o.boundingSphere.getVec(s,Lp),he(Lp,Lp,n);const l=fe(Lp,r)+Lp[3];return{near:Math.max(e.near,a),far:Math.min(e.far,l)}}_requestUpdateCycle(e=!1){this._updateCyclesWithStaticCamera=-1,this._cycleStartIndex=this._instanceIndex,e&&(this._needFullCycle=!0,this._context.requestRender())}_startUpdateCycle(){this._updateCyclesWithStaticCamera++,this._allRenderInstanceData.forEach(e=>e.forEach(r=>r.startUpdateCycle()))}get running(){return this._instanceData.size>0&&this._updateCyclesWithStaticCamera<1}runTask(e){const{_enableLevelSelection:r,_camera:i,_levelSelector:s}=this;this._allRenderInstanceData.forEach(h=>h.forEach(p=>p.beginUpdate()));const n=this._instanceData,o=n.view;let a=n.size;const l=n.capacity;let c=this._instanceIndex;for(let h=0;h<a&&!e.done;++h){c===this._cycleStartIndex&&this._startUpdateCycle();const p=o.state.get(c);let f=0;if(!(p&Ri.ALLOCATED)){c=c+1===l?0:c+1,a++;continue}const m=o.lodLevel.get(c);if(p&Ri.DEFAULT_ACTIVE&&this._defaultRenderInstanceData[0][m].freeTail(),p&Ri.HIGHLIGHT_ACTIVE&&this._highlightRenderInstanceData[0][m].freeTail(),p&Ri.REMOVE)n.freeInstance(c);else if(p&Ri.VISIBLE){let y=0;r&&(o.modelOrigin.getVec(c,oae),y=s.selectLevel(oae,n.getCombinedMedianScaleFactor(c),i)),f=p&~(Ri.ACTIVE|Ri.TRANSFORM_CHANGED),y>=0&&(p&Ri.HIGHLIGHT?(nae(this._highlightRenderInstanceData[0][y],o,c),f|=Ri.HIGHLIGHT_ACTIVE):(nae(this._defaultRenderInstanceData[0][y],o,c),f|=Ri.DEFAULT_ACTIVE)),o.state.set(c,f),o.lodLevel.set(c,y)}else f=p&~(Ri.ACTIVE|Ri.TRANSFORM_CHANGED),o.state.set(c,f);if(this._octreeCached!=null){const y=!!(p&Ri.ACTIVE),_=!!(f&Ri.ACTIVE);!y&&_?this._octreeCached.addInstance(c):y&&!_?this._octreeCached.removeInstance(c):y&&_&&p&Ri.TRANSFORM_CHANGED&&(this._octreeCached.removeInstance(c),this._octreeCached.addInstance(c))}c=c+1===l?0:c+1,e.madeProgress()}this._instanceIndex=c,this._allRenderInstanceData.forEach(h=>h.forEach(p=>p.endUpdate())),this._context.requestRender()}_beginComponent(e,r,i){const{bindParameters:s,rctx:n,output:o}=e;if(r.size===0||!i.material.requiresSlot(s.slot,e.output))return null;const a=i.glMaterials.load(n,s.slot,o);return a!=null?a.beginSlot(s):null}_renderComponent(e,r,i,s,n){if(!r)return;const{bindParameters:o,rctx:a}=e;a.appleAmdDriverHelper?.resetIndicesType();const l=a.bindTechnique(r,s.material.parameters,o);a.bindVAO(s.vao),r.ensureAttributeLocations(s.vao),l.bindDraw(Zdt,o,s.material.parameters),ni.LOD_INSTANCE_RENDERER_COLORIZE_BY_LEVEL&&e.output===N.Color&&(l.setUniform4fv("externalColor",uae[Math.min(n,uae.length-1)]),l.setUniform1i("colorMixMode",wSe.replace));const c=a.capabilities.instancing,h=i.capacity,p=i.headIndex,f=i.tailIndex,m=i.firstIndex,y=this._glInstanceBufferLayout,_=(v,w)=>{OX(a,br,i.buffer,y,v),c.drawArraysInstanced(r.primitiveType,0,s.vertexCount,w-v),RX(a,br,i.buffer,y)};s.material.parameters.transparent&&m!=null?p>f?(et(m>=f&&m<=p,"invalid firstIndex"),_(m,p),_(f,m)):p<f&&(m<=p?(et(m>=0&&m<=p,"invalid firstIndex"),_(m,p),_(f,h),_(0,m)):(et(m>=f&&m<=h,"invalid firstIndex"),_(m,h),_(0,p),_(f,m))):p>f?_(f,p):p<f&&(_(0,p),_(f,h)),a.bindVAO(null)}};function nae(t,e,r){const i=t.allocateHead();qdt(e,r,t.view,i)}function qdt(t,e,r,i){LQe(t.modelOrigin,e,r.modelOriginHi,r.modelOriginLo,i),r.model.copyFrom(i,t.model,e),r.modelNormal.copyFrom(i,t.modelNormal,e),t.color&&r.color&&r.color.copyFrom(i,t.color,e),t.objectAndLayerIdColor&&r.objectAndLayerIdColor&&r.objectAndLayerIdColor.copyFrom(i,t.objectAndLayerIdColor,e),t.featureAttribute&&r.featureAttribute&&r.featureAttribute.copyFrom(i,t.featureAttribute,e)}function Wdt(t){let e=zi().vec3f(E.MODELORIGINHI).vec3f(E.MODELORIGINLO).mat3f(E.MODEL).mat3f(E.MODELNORMAL);return t!=null&&t.includes("featureAttribute")&&(e=e.vec4f(E.INSTANCEFEATUREATTRIBUTE)),t!=null&&t.includes("color")&&(e=e.vec4u8(E.INSTANCECOLOR)),t!=null&&t.includes("objectAndLayerIdColor")&&(e=e.vec4u8(E.INSTANCEOBJECTANDLAYERIDCOLOR)),e}u([d({constructOnly:!0})],Zu.prototype,"symbol",void 0),u([d({constructOnly:!0})],Zu.prototype,"optionalFields",void 0),u([d({constructOnly:!0})],Zu.prototype,"metadata",void 0),u([d({constructOnly:!0})],Zu.prototype,"shaderTransformation",void 0),u([d()],Zu.prototype,"_instanceData",void 0),u([d()],Zu.prototype,"_cycleStartIndex",void 0),u([d({readOnly:!0})],Zu.prototype,"_enableLevelSelection",null),u([d()],Zu.prototype,"_updateCyclesWithStaticCamera",void 0),u([d({readOnly:!0})],Zu.prototype,"running",null),Zu=u([R("esri.views.3d.webgl-engine.lib.lodRendering.LodRenderer")],Zu);const oae=C(),Lp=Wt(),aae=be(),lae=C(),cae=C(),uae=[Lt(1,0,1,1),Lt(0,0,1,1),Lt(0,1,0,1),Lt(1,1,0,1),Lt(1,0,0,1)],Zdt=new Zct;let hae=class{constructor(e,r,i,s,n,o,a,l,c,h,p,f){this.lodResources=e,this.lodRenderer=r,this.stageResources=i,this.originalMaterialParameters=s,this.resourceSize=n,this.isEsriSymbolResource=o,this.isWosr=a,this.resourceBoundingBox=l,this.symbolSize=c,this.extentPadding=h,this.physicalBasedRenderingEnabled=p,this.pivotOffset=f}},Xdt=class extends om{getCachedSize(){const[e,r,i]=this._resources!=null?this._resources.symbolSize:[1,1,1];return{width:e,depth:r,height:i}}constructor(e,r,i,s){super(e,r,i,s),this._resources=null,this._optionalFields=new Array,this._instanceIndexToGraphicUid=new Map,this._hasLoadedPBRTextures=!1,this._disposeResourceHandles=new Array,this.skipHighSymbolLodsChanged=!1,this.ensureDrapedStatus(!1),this._hasLoadedPBRTextures=i.physicalBasedRenderingEnabled}async doLoad(e){if(!this._drivenProperties.size&&p6(this.symbolLayer))throw new Error;if(this._isPrimitive){const r=this.symbolLayer.resource,i=r&&Fot(r.primitive)?r.primitive:qge;this._resources=await this._createResourcesForPrimitive(i,e)}else{const r=await Ddt(this.symbol.styleOrigin),i=r?.href??this.symbolLayer.resource.href;this._resources=await this._createResourcesForUrl(i,e)}this.layerOpacityChanged(),this.slicePlaneEnabledChanged(),this.physicalBasedRenderingChanged(),this.complexity=this.computeComplexity()}get extentPadding(){return this._resources!=null?this._resources.extentPadding:0}get _isPrimitive(){return!this.symbolLayer.resource?.href}get lodRenderer(){return this._resources?.lodRenderer}_setMaterialTransparencyParams(e,r=this.symbolLayer?.material?.color){const i=this._getCombinedOpacity(r),s=i<1||this.needsDrivenTransparentPass;return e.transparent=s,e.opacity=i,e.cullFace=s?pi.None:pi.Back,e}async _createResourcesForPrimitive(e,r){const i=this.symbolLayer,s=pn(J6e(e)),n=Fa(zP(s)),o=Fa(dU(n,i)),a=Ce(o),l=!1,c=!1,h={usePBR:this._context.physicalBasedRenderingEnabled,isSchematic:!0,mrrFactors:[...uJ],ambient:fg,diffuse:fg,hasSlicePlane:this._context.slicePlaneEnabled,hasSliceHighlight:!1,castShadows:this.symbolLayer.castShadows,offsetTransparentBackfaces:!this.symbolLayer.isPrimitive},p=!!h.usePBR;this._setMaterialTransparencyParams(h);const f=this.symbol;if(f.type==="point-3d"&&f.verticalOffset){const{screenLength:x,minWorldLength:T,maxWorldLength:S}=f.verticalOffset;h.verticalOffset={screenLength:Ms(x),minWorldLength:T||0,maxWorldLength:S??1/0},h.castShadows=!1}if(this._context.screenSizePerspectiveEnabled&&(h.screenSizePerspective=this._context.sharedResources.screenSizePerspectiveSettings),this._drivenProperties.color)h.externalColor=dh;else{const x=i.material!=null?i.material.color:null,T=x!=null?ze.toUnitRGBA(x):dh;h.externalColor=T}this._fastUpdates=$2(this._context.renderer,this._fastVisualVariableConvertOptions(s,o,n,null)),h.isInstanced=!0,this._fastUpdates?(Object.assign(h,this._fastUpdates.materialParameters),this._optionalFields.push(E.FEATUREATTRIBUTE)):this._hasPerInstanceColor()&&(h.hasInstancedColor=!0,this._optionalFields.push(E.COLOR)),oe("enable-feature:objectAndLayerId-rendering")&&this._optionalFields.push(E.OBJECTANDLAYERIDCOLOR);const m=new Zf(h),y=S2e(e,m);if(!y)throw new Error(`Unknown object symbol primitive: ${e}`);const _=wI(y).map(x=>({opacity:1,transparent:x.parameters.transparent})),v=await this._createStageResources(y,p,r),w=await this._createLodRenderer(y,r);return new hae(y,w,v,_,n,l,c,s,o,a,p,null)}async _createResourcesForUrl(e,r){const i={materialParamsMixin:{isInstanced:!0,hasSlicePlane:this._context.slicePlaneEnabled,castShadows:this.symbolLayer.castShadows},streamDataRequester:this._context.streamDataRequester,cache:this._context.sharedResources.objectResourceCache};this._fastUpdates=$2(this._context.renderer,this._fastVisualVariableConvertOptions(null,null,null,null)),this._fastUpdates?(Object.assign(i.materialParamsMixin,this._fastUpdates.materialParameters),this._optionalFields.push(E.FEATUREATTRIBUTE)):this._hasPerInstanceColor()&&(i.materialParamsMixin.hasInstancedColor=!0,this._optionalFields.push(E.COLOR)),oe("enable-feature:objectAndLayerId-rendering")&&this._optionalFields.push(E.OBJECTANDLAYERIDCOLOR);const s=this.symbol;if(s.type==="point-3d"&&s.verticalOffset){const{screenLength:L,minWorldLength:D,maxWorldLength:U}=s.verticalOffset;i.materialParamsMixin.verticalOffset={screenLength:Ms(L),minWorldLength:D||0,maxWorldLength:U??1/0},i.materialParamsMixin.castShadows=!1}i.signal=r,i.usePBR=this._context.physicalBasedRenderingEnabled,i.skipHighLods=this._context.skipHighSymbolLods;const n=i.usePBR,o=await MCe(e,i),a=o.isEsriSymbolResource,l=o.isWosr,c=kht(o.lods);c.levels.sort((L,D)=>L.minScreenSpaceRadius-D.minScreenSpaceRadius);const h=this._context,p=this.symbolLayer.material,f=this._getExternalColorParameters(p),m=this.symbolLayer?.material?.color,y=this._getCombinedOpacity(m,{hasIntrinsicColor:!0}),_=this.needsDrivenTransparentPass,v=wI(c),w=wI(c).map(L=>({opacity:L.parameters.opacity||1,transparent:L.parameters.transparent}));v.forEach(L=>{const D=L.parameters;L.setParameters(f);const U=D.opacity*y,X=U<1||_||D.transparent;L.setParameters({opacity:U,transparent:X}),h.screenSizePerspectiveEnabled&&L.setParameters({screenSizePerspective:h.sharedResources.screenSizePerspectiveSettings})});const x=o.referenceBoundingBox,T=Fa(zP(x)),S=Fa(c.levels[0].pivotOffset),O=Fa(dU(T,this.symbolLayer)),A=Ce(O),I=this._fastUpdates;L2(I,this._context.renderer,this._fastVisualVariableConvertOptions(x,O,T,S))&&v.forEach(L=>L.setParameters(I.materialParameters));const M=await this._createStageResources(c,n,r),k=await this._createLodRenderer(c,r);return new hae(c,k,M,w,T,a,l,x,O,A,n,S)}_addDisposeResource(e){this._disposeResourceHandles.push(e)}async _createStageResources(e,r,i){const s=this._context.stage,n=wI(e);r!==this._context.physicalBasedRenderingEnabled&&this.physicalBasedRenderingChanged(),s.addMany(n),this._addDisposeResource(()=>s.removeMany(n));const o=Ane(e);s.addMany(o),this._addDisposeResource(()=>s.removeMany(o)),await s.load(o,i),Xt(i);const a=One(e);return s.addMany(a),this._addDisposeResource(()=>s.removeMany(a)),{materials:n,textures:o,geometries:a}}async _createLodRenderer(e,r){const i=this._context.stage,s={layerUid:this._context.layer.uid,graphicUid:l=>this._instanceIndexToGraphicUid.get(l),notifyGraphicGeometryChanged:l=>this._context.notifyGraphicGeometryChanged(this._instanceIndexToGraphicUid.get(l)),notifyGraphicVisibilityChanged:l=>this._context.notifyGraphicVisibilityChanged(this._instanceIndexToGraphicUid.get(l))},n=this._fastUpdates,o=n?{applyTransform:(l,c,h)=>{l.getFeatureAttribute(c,jI),Ls(h,nH(n.materialParameters,jI,h))},scaleFactor:(l,c,h)=>{c.getFeatureAttribute(h,jI),Ant(l,n.materialParameters,jI)}}:null,a=new Zu({symbol:e,optionalFields:this._optionalFields,metadata:s,shaderTransformation:o},this._context.scheduler);return a.slicePlaneEnabled=this._context.slicePlaneEnabled,this._addDisposeResource(()=>{i.removeRenderPlugin(a),a.destroy()}),await i.addRenderPlugin(a.slots,a,r),a}_getExternalColorParameters(e){const r={};return this._drivenProperties.color?r.externalColor=dh:e!=null&&e.color!=null?r.externalColor=ze.toUnitRGBA(e.color):(r.externalColor=dh,r.colorMixMode="ignore"),r}destroy(){super.destroy(),this._cleanupResources()}_cleanupResources(){this._disposeResourceHandles.forEach(e=>e()),this._disposeResourceHandles.length=0,this._resources=null}createGraphics3DGraphic(e){const r=e.graphic;if(!this._validateGeometry(r.geometry))return null;const i=sR(r.geometry);if(i==null)return this.logger.warn(`unsupported geometry type for icon symbol: ${r.geometry.type}`),null;const s=this.setGraphicElevationContext(r,new mp),n=e.renderingInfo;return this._createAs3DShape(r,i,n,s,r.uid,e.layer.uid)}notifyDestroyGraphicLayer(e){this._instanceIndexToGraphicUid.delete(e.instanceIndex)}graphicLayerToGraphicId(){return 0}layerOpacityChanged(){if(this._resources==null)return;const e=this._drivenProperties.opacity,r=!this._isPrimitive,i=this._resources.stageResources.materials,s=this._resources.originalMaterialParameters;for(let n=0;n<i.length;n++){const o=i[n],a=this.symbolLayer?.material?.color,l=s[n],c=this._getCombinedOpacity(a,{hasIntrinsicColor:r})*l.opacity,h=c<1||e||l.transparent;o.setParameters({opacity:c,transparent:h}),this._isPrimitive&&o.setParameters({cullFace:h?pi.None:pi.Back})}}layerElevationInfoChanged(e,r){return this.updateGraphics3DGraphicElevationInfo(e,r,G_)}slicePlaneEnabledChanged(){if(this._resources==null)return!0;this._resources.lodRenderer.slicePlaneEnabled=this._context.slicePlaneEnabled;for(const e of this._resources.stageResources.materials)e.setParameters({hasSlicePlane:this._context.slicePlaneEnabled});return!0}physicalBasedRenderingChanged(){if(this._resources==null)return!0;const{stageResources:e,isWosr:r}=this._resources;for(const i of e.materials)this._isPrimitive?i.setParameters({usePBR:this._context.physicalBasedRenderingEnabled,isSchematic:!0}):r||i.setParameters({usePBR:this._context.physicalBasedRenderingEnabled,isSchematic:!1});return this._hasLoadedPBRTextures!==!1||this._context.physicalBasedRenderingEnabled!==!0||(this._hasLoadedPBRTextures=!0,!1)}applyRendererDiff(e,r){if(this._resources==null)return Is.RecreateSymbol;const{stageResources:{materials:i},lodRenderer:s,resourceBoundingBox:n,symbolSize:o,resourceSize:a,pivotOffset:l}=this._resources;for(const c in e.diff){if(c!=="visualVariables"||!L2(this._fastUpdates,r,this._fastVisualVariableConvertOptions(n,o,a,l)))return Is.RecreateSymbol;for(const h of i)h.setParameters(this._fastUpdates.materialParameters);s.notifyShaderTransformationChanged()}return Is.FastUpdate}computeComplexity(){if(this._resources==null)return super.computeComplexity();const e=this._resources.lodResources,r=T2e(e.levels[0]).reduce((n,o)=>n+o.indices.get(E.POSITION).length,0)/3,i=n=>Array.from(n.vertexAttributes.values()).reduce((o,a)=>o+Z0(a.data),0)+Array.from(n.indices.values()).reduce((o,a)=>o+Z0(a),0),s=Ane(e).reduce((n,o)=>n+(o.parameters.encoding&&o.parameters.encoding==="image/ktx2"?o.memoryEstimate:o.memoryEstimate/4),0)+One(e).reduce((n,o)=>n+i(o),0);return{primitivesPerFeature:r,primitivesPerCoordinate:0,drawCallsPerFeature:0,estimated:!1,memory:{...C2e(this.symbol,this.symbolLayer),resourceBytes:s}}}_hasLodRenderer(){return this._resources!=null}_createAs3DShape(e,r,i,s,n,o){if(!this._hasLodRenderer()||this._resources==null)return null;const a=this.getFastUpdateAttrValues(e),l=this._context.clippingExtent;if(wo(r,Dx,this._context.elevationProvider.spatialReference),l!=null&&!VW(l,Dx))return null;const c=this._requiresTerrainElevation(s),h=this._computeGlobalTransform(r,s,z9,HI),p=this._computeLocalTransform(this._resources,this.symbolLayer,i,dae),f=this._resources.lodRenderer.instanceData,m=f.addInstance();this._instanceIndexToGraphicUid.set(m,n),f.setLocalTransform(m,p,!1),f.setGlobalTransform(m,h),a&&f.setFeatureAttribute(m,a),this._fastUpdates==null&&this._hasPerInstanceColor()&&f.setColor(m,J3(i.color,i.opacity,255)),this._context.stage.renderView.objectAndLayerIdRenderHelper!=null&&f.setObjectAndLayerIdColor(m,this._context.stage.renderView.objectAndLayerIdRenderHelper.getObjectAndLayerIdColor({graphicUid:n,layerUid:o}));const y=new Nht(this,m,Aot,s);return c&&(y.alignedSampledElevation=HI.sampledElevation),y.needsElevationUpdates=G_(s.mode),iR(y,r,this._context.elevationProvider),y}_computeGlobalTransform(e,r,i,s){return B_(e,this._context.elevationProvider,r,this._context.renderCoordsHelper,s),Dx[0]=e.x,Dx[1]=e.y,Dx[2]=s.z,Tl(e.spatialReference,Dx,i,this._context.renderCoordsHelper.spatialReference),i}_computeLocalTransform(e,r,i,s){return Rh(s),this._applyObjectRotation(i,!1,s),this._applyObjectRotation(r,!0,s),this._applyObjectScale(e,i,s),this._applyAnchor(e,r,s),s}_applyObjectScale(e,r,i){if(this._fastUpdates?.requiresShaderTransformation)return;const s=this._drivenProperties.size&&r.size?r.size:e.symbolSize,n=Ene(s,e.symbolSize,e.resourceSize,this._context.renderCoordsHelper.unitInMeters);n[0]===1&&n[1]===1&&n[2]===1||a5(i,i,n)}prepareSymbolLayerPatch(e){if(e.diff.type!=="partial")return;const r=e.diff.diff;this._preparePatchTransform(e,r),this._preparePatchColor(e,r)}updateGeometry(e,r){if(this._resources==null)return!0;const i=r&&sR(r);if(i==null)return!1;const s=this.getGeometryElevationMode(r);return e.elevationContext.mode===s&&(this._computeGlobalTransform(i,e.elevationContext,z9,HI),this._requiresTerrainElevation(e.elevationContext)&&(e.alignedSampledElevation=HI.sampledElevation),this._resources.lodRenderer.instanceData.setGlobalTransform(e.instanceIndex,z9,!0),iR(e,i,this._context.elevationProvider),!0)}_preparePatchTransform(e,r){if(!(r.heading||r.tilt||r.roll||r.width||r.height||r.depth||r.anchor||r.anchorPosition)||this._resources==null)return;const i=(y,_,v)=>(y!=null&&y.type==="complete"?y.newValue:_)??v,s=i(r.heading,this.symbolLayer.heading,0),n=i(r.tilt,this.symbolLayer.tilt,0),o=i(r.roll,this.symbolLayer.roll,0),a=i(r.width,this.symbolLayer.width,void 0),l=i(r.height,this.symbolLayer.height,void 0),c=i(r.depth,this.symbolLayer.depth,void 0),h=i(r.anchor,this.symbolLayer.anchor,void 0),p=i(r.anchorPosition,this.symbolLayer.anchorPosition,void 0);delete r.heading,delete r.tilt,delete r.roll,delete r.width,delete r.height,delete r.depth,delete r.anchor,delete r.anchorPosition;const f={heading:s,tilt:n,roll:o,anchor:h,anchorPosition:p},m=this._resources;this.loadStatus===Qc.LOADED&&e.symbolLayerStatePatches.push(()=>{m.symbolSize=Fa(dU(m.resourceSize,{width:a,height:l,depth:c,isPrimitive:this.symbolLayer.isPrimitive}))}),e.graphics3DGraphicPatches.push((y,_)=>{const v=this._computeLocalTransform(m,f,_,dae),w=y.instanceIndex;m.lodRenderer.instanceData.setLocalTransform(w,v,!0)})}_preparePatchColor(e,r){if(!r.material||r.material.type!=="partial")return;const i=r.material.diff;if(!i.color||i.color.type!=="complete"||i.color.newValue==null||i.color.oldValue==null)return;const s=i.color.newValue,n=s!=null?ze.toUnitRGBA(s):dh;delete i.color;const o=this._resources;o!=null&&e.graphics3DGraphicPatches.push(a=>{let l;this._hasPerInstanceColor()?(o.lodRenderer.instanceData.setColor(a.instanceIndex,n),l=this._setMaterialTransparencyParams({},s)):l=this._setMaterialTransparencyParams({externalColor:n},s);for(const c of o.stageResources.materials)c.setParameters(l)})}_requiresTerrainElevation(e){return e.mode!=="absolute-height"}_applyObjectRotation(e,r,i){if(!this._fastUpdates?.requiresShaderTransformation||!r)return got(e.heading,e.tilt,e.roll,i)}_computeAnchor(e,r,i){const s=C();switch(i.anchor){case"center":ie(s,Bd(e)),ca(s,s);break;case"top":{const n=Bd(e);se(s,-n[0],-n[1],-e[5]);break}case"bottom":{const n=Bd(e);se(s,-n[0],-n[1],-e[2]);break}case"relative":{const n=Bd(e),o=zP(e),a=i.anchorPosition,l=a?Oe(a.x,a.y,a.z):ja;CF(s,o,l),ce(s,s,n),ca(s,s);break}default:r!=null?ca(s,r):ie(s,ja)}return s}_applyAnchor(e,r,i){if(this._fastUpdates?.requiresShaderTransformation)return;const s=this._computeAnchor(e.resourceBoundingBox,e.pivotOffset,r);s&&Al(i,i,s)}_hasPerInstanceColor(){return this._drivenProperties.color||this._drivenProperties.opacity}_fastVisualVariableConvertOptions(e,r,i,s){const n=e!=null?Fa(zP(e)):fg,o=e!=null?this._computeAnchor(e,s,this.symbolLayer):ja,a=this._context.renderCoordsHelper.unitInMeters,l=Ene(r??void 0,r,i,a),c=Oe(this.symbolLayer.tilt||0,this.symbolLayer.roll||0,this.symbolLayer.heading||0);return new oP({size:!0,color:!0,rotation:!0,opacity:!1},n,r??fg,a,o,l,c)}};const Dx=C(),dae=be(),z9=be(),jI=Wt(),HI=new cP;let Ydt=class{constructor(e,r,i,s){this.vertices=e,this.positionsES=r,this.offset=s;const n=e.length,o=Math.floor(n/2),a=this.offset+3*o,l=i[a],c=i[a+1],h=i[a+2];this.origin=Oe(l,c,h),this.positions=Yi(3*n);const p=this.offset+3*n;for(let f=this.offset;f<p;f+=3)this.positions[f]=i[f]-l,this.positions[f+1]=i[f+1]-c,this.positions[f+2]=i[f+2]-h;this.updatePathVertexInformation()}updatePathVertexInformation(){const e=this.vertices.length,r=this.vertices[0];let i=this.offset;const s=this.positions;r.vRight[0]=s[i+3]-s[i],r.vRight[1]=s[i+4]-s[i+1],r.vRight[2]=s[i+5]-s[i+2],i+=3;let n=Ce(r.vRight);r.vMinSiblingLength=n,me(r.vRight,r.vRight);let o=r;for(let a=1;a<e;++a){const l=this.vertices[a];if(l.vLeft=o.vRight,a<e-1){l.vRight[0]=s[i+3]-s[i],l.vRight[1]=s[i+4]-s[i+1],l.vRight[2]=s[i+5]-s[i+2];const c=Ce(l.vRight);l.vMinSiblingLength=Math.min(n,c),n=c,me(l.vRight,l.vRight)}else ie(l.vRight,l.vLeft),l.vMinSiblingLength=n;o=l,i+=3}}},Jdt=class{constructor(e,r,i,s,n,o={}){this.path=e,this.profile=r,this.extruder=i,this.startCap=s,this.endCap=n,this.options=o,this._extrusionVertexCount=0;const a=this.path.vertices.length-2;this.numExtrusionProfiles=i.numProfilesPerJoin()*a+2,this.numVerticesTotal=r.vertices.length*this.numExtrusionProfiles,this.startCap.vertexBufferStart=this.numVerticesTotal;const l=this.startCap.numVertices;this.numVerticesTotal+=l,this.endCap.vertexBufferStart=this.numVerticesTotal;const c=this.endCap.numVertices;this.numVerticesTotal+=c,this.pathVertexData=EQe(1*this.numVerticesTotal),this.profileRightAxes=Yi(4*this.numVerticesTotal),this.profileUpAxes=Yi(4*this.numVerticesTotal),this.profileVertexAndNormals=Yi(4*this.numVerticesTotal),this.positions=a4(e.positions,e.offset,3*e.vertices.length),this._rebuildGeometry(),this.buildTopology()}emitVertex(e,r,i,s,n){const o=4*this._extrusionVertexCount;if(this.profileRightAxes[o]=r.right[0],this.profileRightAxes[o+1]=r.right[1],this.profileRightAxes[o+2]=r.right[2],this.profileUpAxes[o]=r.up[0],this.profileUpAxes[o+1]=r.up[1],this.profileUpAxes[o+2]=r.up[2],this.profileVertexAndNormals[o]=i[0],this.profileVertexAndNormals[o+1]=i[1],this.profileVertexAndNormals[o+2]=s[0],this.profileVertexAndNormals[o+3]=s[1],this.pathVertexData[this._extrusionVertexCount]=e,n){const a=this.path.vertices[e],l=a.maxStretchDistance;this.profileRightAxes[o+3]=a.rotationRight[0]*l,this.profileUpAxes[o+3]=a.rotationRight[1]*l}else this.profileRightAxes[o+3]=0,this.profileUpAxes[o+3]=0;++this._extrusionVertexCount}emitCapVertex(e,r,i,s,n,o){const a=4*this._extrusionVertexCount;this.profileRightAxes[a]=r.right[0],this.profileRightAxes[a+1]=r.right[1],this.profileRightAxes[a+2]=r.right[2],this.profileRightAxes[a+3]=n,this.profileUpAxes[a]=r.up[0],this.profileUpAxes[a+1]=r.up[1],this.profileUpAxes[a+2]=r.up[2],this.profileUpAxes[a+3]=o,this.profileVertexAndNormals[a]=i[0],this.profileVertexAndNormals[a+1]=i[1],this.profileVertexAndNormals[a+2]=s[0],this.profileVertexAndNormals[a+3]=s[1],this.pathVertexData[this._extrusionVertexCount]=e,++this._extrusionVertexCount}_rebuildGeometry(){this._extrusionVertexCount=0;const{positions:e,offset:r,vertices:i}=this.path;this.positions=a4(e,r,3*i.length);let s=0;const n=(a,l,c,h,p)=>this.emitCapVertex(s,a,l,c,h,p),o=(a,l,c,h)=>this.emitVertex(s,a,l,c,h);for(this.startCap.rebuildConnectingProfileGeometry(i[s],this.profile,n),s=1;s<i.length-1;++s)this.extruder.extrude(i[s],this.profile,o);this.endCap.rebuildConnectingProfileGeometry(i[s],this.profile,n),s=0,this.startCap.rebuildCapGeometry(i[s],n),s=i.length-1,this.endCap.rebuildCapGeometry(i[s],n)}buildTopology(){const e=this.profile.vertices.length,r=this.profile.numSegments,i=this.numExtrusionProfiles-1;let s=3*(2*(r*i));this.startCap.indexBufferStart=s,this.startCap.firstProfileVertexIndex=0,s+=this.startCap.numIndices,this.endCap.indexBufferStart=s,this.endCap.firstProfileVertexIndex=e*(this.numExtrusionProfiles-1);const n=new Array,o=new Array,a=new Array,l=(c,h,p)=>{n.push(c),n.push(h),n.push(p),o.push(c),o.push(h),o.push(p),a.push(this.pathVertexData[c]),a.push(this.pathVertexData[h]),a.push(this.pathVertexData[p])};for(let c=0;c<r;++c){const h=this.profile.indices[2*c],p=this.profile.indices[2*c+1];for(let f=0;f<i;++f){const m=f*e+h,y=(f+1)*e+p,_=f*e+p;l(m,(f+1)*e+h,y),l(m,y,_)}}this.startCap.buildTopology(this.path.vertices[0],l),this.endCap.buildTopology(this.path.vertices[this.path.vertices.length-1],l),this.vertexIndices=If(n),this.normalIndices=If(o),this.pathVertexIndices=If(a)}onPathChanged(){this._rebuildGeometry()}},yJ=class{rebuildConnectingProfileGeometry(e,r,i){for(let s=0;s<r.vertices.length;++s)i(e.frame,r.vertices[s],r.normals[s],0,0)}},pae=class extends yJ{constructor(){super(),this.numVertices=0,this.numIndices=0}rebuildCapGeometry(){}buildTopology(){}},qI=class extends yJ{constructor(e,r=0,i=!1){super(),this.profile=e,this.profilePlaneOffset=r,this.flip=i}get numVertices(){return this.profile.vertices.length}get numIndices(){return 3*this.profile.numSegments}rebuildConnectingProfileGeometry(e,r,i){const s=this.profilePlaneOffset;for(let n=0;n<r.vertices.length;++n)i(e.frame,r.vertices[n],r.normals[n],s,0)}rebuildCapGeometry(e,r){const i=this.profile,s=this.flip?1:-1,n=this.profilePlaneOffset,o=DCe;or(o,0,0);for(let a=0;a<i.vertices.length;++a)r(e.frame,i.vertices[a],o,n,s)}buildTopology(e,r){const i=this.profile,s=this.vertexBufferStart+i.indices[0];for(let n=1;n<i.numSegments;++n){const o=i.indices[2*n],a=i.indices[2*n+1],l=this.vertexBufferStart+o,c=this.vertexBufferStart+a;this.flip?r(c,l,s):r(s,l,c)}}},fae=class extends yJ{constructor(e){super(),this.flip=!1,this.sign=0,this.breakNormals=!1,this.numSegments=3,this.profile=e.profile,this.flip=e.flip,this.sign=this.flip?1:-1,this.breakNormals=e.breakNormals,this.numSegments=e.subdivisions}get numVertices(){let e=this.profile.vertices.length*(this.numSegments-1)+this.profile.poles.length;return this.breakNormals&&(e+=this.profile.vertices.length),e}get numIndices(){let e=0;const r=this.profile;e+=2*r.numSegments*(this.numSegments-1);for(let i=0;i<r.numSegments;++i){const s=r.indices[2*i],n=r.indices[2*i+1];r.poleIndices[s]===r.poleIndices[n]?e+=1:e+=2}return 3*e}rebuildCapGeometry(e,r){const i=this.profile,s=e.frame,n=.5*this.sign,o=Qdt,a=DCe;or(a,0,0);for(const l of i.poles)l.normal?r(s,l.position,l.normal,n,0):r(s,l.position,a,n,this.sign);if(this.breakNormals)for(let l=0;l<i.vertices.length;++l)r(s,i.vertices[l],i.normals[l],0,0);for(let l=0;l<this.numSegments-1;++l){const c=(1-(l+1)/this.numSegments)*Math.PI*.5,h=Math.sin(c),p=Math.cos(c);for(let f=0;f<i.vertices.length;++f){const m=i.poles[i.poleIndices[f]];gf(o,i.vertices[f],m.position),lc(o,o,h),m.normal?(Ld(o,o,m.position),r(s,o,m.normal,n*p,0)):(VO(a,o),lc(a,a,h),Ld(o,o,m.position),r(s,o,a,n*p,this.sign*p))}}}buildTopology(e,r){const i=this.profile,s=this.breakNormals?this.vertexBufferStart+i.poles.length:this.firstProfileVertexIndex,n=this.breakNormals?this.vertexBufferStart+i.poles.length+i.vertices.length:this.vertexBufferStart+i.poles.length;for(let o=0;o<i.numSegments;++o){const a=i.indices[2*o],l=i.indices[2*o+1],c=this.vertexBufferStart+i.poleIndices[a],h=this.vertexBufferStart+i.poleIndices[l];let p=s+a,f=s+l;for(let m=0;m<this.numSegments-1;++m){const y=n+m*i.vertices.length+a,_=n+m*i.vertices.length+l;this.flip?(r(y,f,p),r(f,y,_)):(r(p,f,y),r(_,y,f)),p=y,f=_}this.flip?(r(c,f,p),c!==h&&r(c,h,f)):(r(p,f,c),c!==h&&r(f,h,c))}}};const Qdt=Ve(),DCe=Ve();let Kdt=class{numProfilesPerJoin(){return 1}extrude(e,r,i){for(let s=0;s<r.vertices.length;++s)i(e.frame,r.vertices[s],r.normals[s],!1)}},B9=class{constructor(e,r){this.cutoffAngle=e,this.numBendSubdivisions=r}numProfilesPerJoin(){return this.numBendSubdivisions+1}extrude(e,r,i){const s=tpt,{rotationAngle:n,rotationRight:o,frame:a}=e;if(Math.abs(n)>=this.cutoffAngle){const l=e.rotationFrameUp;for(let c=0;c<this.numBendSubdivisions+1;++c){mu(gae,.5*-n+c*n/this.numBendSubdivisions,l),ept(s,a,gae);for(let h=0;h<r.vertices.length;++h)Ks(r.vertices[h],o)*n>=0?i(s,r.vertices[h],r.normals[h],!1):i(a,e.applyMiterStretch(mae,r.vertices[h]),r.normals[h],!0)}}else for(let l=0;l<this.numBendSubdivisions+1;++l)for(let c=0;c<r.vertices.length;++c){const h=Ks(r.vertices[c],o)*n>=0;i(a,e.applyMiterStretch(mae,r.vertices[c]),r.normals[c],!h)}}},NCe=class{constructor(){this.up=C(),this.right=C()}};function ept(t,e,r){$e(t.up,e.up,r),$e(t.right,e.right,r)}const mae=Ve(),gae=be(),tpt=new NCe;let rpt=class extends Vs{constructor(e,r,i,s,n,o,a){super(e,r,i,null,ss.Mesh,a),this.path=s,this.geometrySR=n,this.stencilWidth=o}};var $f;function FCe(t){return"path"in t}(function(t){t[t.World=0]="World",t[t.Path=1]="Path"})($f||($f={}));let UCe=class{constructor(e){this.builder=e}onPathChanged(e){this.builder.onPathChanged()}},kCe=class extends UCe{constructor(e){super(e),this.vertexAttributeColor=Lt(255,255,255,255),this.size=new Array,this.vertexAttributePosition=Yi(3*this.builder.numVerticesTotal),this.vertexAttributeNormal=new Int16Array(2*this.builder.numVerticesTotal)}bakeVertexColors(e){this.vertexAttributeColor[0]=255*e[0],this.vertexAttributeColor[1]=255*e[1],this.vertexAttributeColor[2]=255*e[2],this.vertexAttributeColor[3]=255*(e.length>3?e[3]:1)}bake(e){this.size=e;const{numVerticesTotal:r,pathVertexData:i,path:s,positions:n,profileRightAxes:o,profileUpAxes:a,profileVertexAndNormals:l}=this.builder;for(let c=0;c<r;++c){let h=i[c];const p=h===0||h===s.vertices.length-1;h*=3;const f=apt;let m=0,y=0;const _=4*c,v=se(lpt,o[_],o[_+1],o[_+2]),w=se(cpt,a[_],a[_+1],a[_+2]),x=or(yae,l[_]*e[0],l[_+1]*e[1]);if(p)at(f,w,v),m=o[_+3]*e[0],y=a[_+3];else{const A=spt,I=npt;or(A,o[_+3],a[_+3]);const M=WZ(A);VO(A,A);const k=Ks(x,A);if(Math.abs(k)>M){or(I,-A[1],A[0]);const L=Ks(x,I);lc(A,A,M*Math.sign(k)),lc(I,I,L),Ld(x,A,I)}se(f,0,0,0)}const T=se(opt,v[0]*x[0]+w[0]*x[1],v[1]*x[0]+w[1]*x[1],v[2]*x[0]+w[2]*x[1]),S=3*c;this.vertexAttributePosition[S]=n[h]+T[0]+f[0]*m,this.vertexAttributePosition[S+1]=n[h+1]+T[1]+f[1]*m,this.vertexAttributePosition[S+2]=n[h+2]+T[2]+f[2]*m;const O=or(yae,l[_+2],l[_+3]);yw(this.vertexAttributeNormal,c,v[0]*O[0]+w[0]*O[1]+f[0]*y,v[1]*O[0]+w[1]*O[1]+f[1]*y,v[2]*O[0]+w[2]*O[1]+f[2]*y)}}createGeometryData(){const e=this.builder.vertexIndices.length;return new VCe([[E.POSITION,new ke(this.vertexAttributePosition,3,!0)],[E.NORMALCOMPRESSED,new ke(this.vertexAttributeNormal,2,!0)],[E.COLOR,new ke(this.vertexAttributeColor,4)]],[[E.POSITION,this.builder.vertexIndices],[E.NORMALCOMPRESSED,this.builder.normalIndices],[E.COLOR,gE(e)]])}onPathChanged(e){super.onPathChanged(e),this.bake(this.size)}intersect(e,r,i){const s=this.builder.vertexIndices,n=new ke(this.vertexAttributePosition,3),o=s.length/3;iP(e,r,0,o,s,n,void 0,void 0,i)}},ipt=class extends UCe{constructor(e,r,i,s){super(e),this.sizeAttributeValue=r,this.colorAttributeValue=i,this.opacityAttributeValue=s,this.vvData=null,this.baked=new kCe(e),this.vvData=Yi(4*this.builder.path.vertices.length);for(let n=0;n<this.builder.path.vertices.length;++n){this.vvData[4*n]=r,this.vvData[4*n+1]=i,this.vvData[4*n+2]=s;const o=n===0||n===this.builder.path.vertices.length-1;this.vvData[4*n+3]=o?1:0}}createGeometryData(){return new VCe([[E.POSITION,new ke(this.builder.positions,3,!0)],[E.PROFILERIGHT,new ke(this.builder.profileRightAxes,4,!0)],[E.PROFILEUP,new ke(this.builder.profileUpAxes,4,!0)],[E.PROFILEVERTEXANDNORMAL,new ke(this.builder.profileVertexAndNormals,4,!0)],[E.FEATUREVALUE,new ke(this.vvData,4,!0)]],[[E.POSITION,this.builder.pathVertexIndices],[E.PROFILERIGHT,this.builder.vertexIndices],[E.PROFILEUP,this.builder.vertexIndices],[E.PROFILEVERTEXANDNORMAL,this.builder.vertexIndices],[E.FEATUREVALUE,this.builder.pathVertexIndices]])}onPathChanged(e){super.onPathChanged(e);const r=e.getMutableAttribute(E.POSITION);r&&(r.data=this.builder.positions)}},VCe=class{constructor(e,r){this.vertexAttributes=e,this.indices=r}};const yae=Ve(),spt=Ve(),npt=Ve(),opt=C(),apt=C(),lpt=C(),cpt=C();function upt(t,e){let r=null;const i=t.vertices.length,s=.99619469809,n=C(),o=C(),a=C(),l=C(),c=C(),h=C(),p=Ir();let f=t.vertices[0];ie(o,e),se(n,0,1,0),u4(f.vRight,o,n,n,a,o,s),ie(f.frame.up,o),ie(f.frame.right,a);const m=t.positions;let y=t.offset;r=f;for(let _=1;_<i;++_){f=t.vertices[_],ce(c,f.vLeft,f.vRight);let v=Ce(c);v>0?(v=1/Math.sqrt(v),c[0]=c[0]*v,c[1]=c[1]*v,c[2]=c[2]*v):(c[0]=f.vRight[0],c[1]=f.vRight[1],c[2]=f.vRight[2]),h[0]=m[y]+r.frame.up[0],h[1]=m[y+1]+r.frame.up[1],h[2]=m[y+2]+r.frame.up[2],y+=3;const w=se(hpt,m[y],m[y+1],m[y+2]);ZR(w,c,p),Fw(p,yu(h,f.vLeft),l)?(l[0]-=m[y],l[1]-=m[y+1],l[2]-=m[y+2],me(o,l),at(a,c,o),me(a,a)):u4(c,r.frame.up,r.frame.right,n,a,o,s),ie(f.frame.up,o),ie(f.frame.right,a),r=f}}const hpt=C();let zCe=class{constructor(){this.vertices=new Array,this.normals=new Array,this.indices=new Array,this.poles=new Array,this.poleIndices=new Array}addVertex(e,r){return this.vertices.push(CA(e)),this.normals.push(CA(r)),this.vertices.length-1}addPole(e,r=null){return this.poles.push({position:CA(e),normal:r?CA(r):null}),this.poles.length-1}addSegment(e,r=null){this.indices.push(e.v0),this.indices.push(e.v1),r&&(this.poleIndices.push(r.v0),this.poleIndices.push(r.v1))}get numSegments(){return this.indices.length/2}translate(e,r){for(const i of this.vertices)i[0]+=e,i[1]+=r;for(const i of this.poles)i.position[0]+=e,i.position[1]+=r}};const BCe={top:[0,-.5],bottom:[0,.5]};function G9(t){const r=w2e,i=new zCe,s={v0:0,v1:0};i.addPole(dr(0,0));for(let o=0;o<r;++o){const a=2*o*Math.PI/r,l=Math.cos(a),c=Math.sin(a),h=dr(l*.5,c*.5),p=dr(l,c);i.addVertex(h,p)}for(let o=0;o<r-1;++o){const a={v0:o,v1:o+1};i.addSegment(a,s)}const n={v0:r-1,v1:0};if(i.addSegment(n,s),t!=="center"){const o=BCe[t];i.translate(o[0],o[1])}return i}const dpt={center:G9("center"),top:G9("top"),bottom:G9("bottom")},ppt={center:j9("center"),top:j9("top"),bottom:j9("bottom")};function j9(t){const i=new zCe,s=dr(.5*-1,.5*-1),n=dr(.5*1,.5*-1),o=dr(.5*1,.5*1),a=dr(.5*-1,.5*1),l=dr(0,-1),c=dr(1,0),h=dr(0,1),p=dr(-1,0);if(i.addPole(dr(0,.5*1),h),i.addPole(dr(0,.5*1)),i.addPole(dr(0,.5*-1)),i.addPole(dr(0,.5*-1),l),i.addVertex(s,l),i.addVertex(n,l),i.addSegment({v0:0,v1:1},{v0:3,v1:3}),i.addVertex(n,c),i.addVertex(o,c),i.addSegment({v0:2,v1:3},{v0:2,v1:1}),i.addVertex(o,h),i.addVertex(a,h),i.addSegment({v0:4,v1:5},{v0:0,v1:0}),i.addVertex(a,p),i.addVertex(s,p),i.addSegment({v0:6,v1:7},{v0:1,v1:2}),t!=="center"){const f=BCe[t];i.translate(f[0],f[1])}return i}function fpt(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t}function mpt(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=1,t}function GCe(t,e,r,i,s){return t[0]=e,t[1]=r,t[2]=i,t[3]=s,t}function gpt(t,e){if(t===e){const r=e[1];t[1]=e[2],t[2]=r}else t[0]=e[0],t[1]=e[2],t[2]=e[1],t[3]=e[3];return t}function ypt(t,e){const r=e[0],i=e[1],s=e[2],n=e[3];let o=r*n-s*i;return o?(o=1/o,t[0]=n*o,t[1]=-i*o,t[2]=-s*o,t[3]=r*o,t):null}function _pt(t,e){const r=e[0];return t[0]=e[3],t[1]=-e[1],t[2]=-e[2],t[3]=r,t}function vpt(t){return t[0]*t[3]-t[2]*t[1]}function jCe(t,e,r){const i=e[0],s=e[1],n=e[2],o=e[3],a=r[0],l=r[1],c=r[2],h=r[3];return t[0]=i*a+n*l,t[1]=s*a+o*l,t[2]=i*c+n*h,t[3]=s*c+o*h,t}function bpt(t,e,r){const i=e[0],s=e[1],n=e[2],o=e[3],a=Math.sin(r),l=Math.cos(r);return t[0]=i*l+n*a,t[1]=s*l+o*a,t[2]=i*-a+n*l,t[3]=s*-a+o*l,t}function wpt(t,e,r){const i=e[0],s=e[1],n=e[2],o=e[3],a=r[0],l=r[1];return t[0]=i*a,t[1]=s*a,t[2]=n*l,t[3]=o*l,t}function xpt(t,e){const r=Math.sin(e),i=Math.cos(e);return t[0]=i,t[1]=r,t[2]=-r,t[3]=i,t}function Tpt(t,e){return t[0]=e[0],t[1]=0,t[2]=0,t[3]=e[1],t}function Spt(t){return"mat2("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+")"}function Ept(t){return Math.sqrt(t[0]**2+t[1]**2+t[2]**2+t[3]**2)}function Cpt(t,e,r,i){return t[2]=i[2]/i[0],r[0]=i[0],r[1]=i[1],r[3]=i[3]-t[2]*r[1],[t,e,r]}function Apt(t,e,r){return t[0]=e[0]+r[0],t[1]=e[1]+r[1],t[2]=e[2]+r[2],t[3]=e[3]+r[3],t}function HCe(t,e,r){return t[0]=e[0]-r[0],t[1]=e[1]-r[1],t[2]=e[2]-r[2],t[3]=e[3]-r[3],t}function Opt(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]}function Rpt(t,e){const r=t[0],i=t[1],s=t[2],n=t[3],o=e[0],a=e[1],l=e[2],c=e[3],h=Xa();return Math.abs(r-o)<=h*Math.max(1,Math.abs(r),Math.abs(o))&&Math.abs(i-a)<=h*Math.max(1,Math.abs(i),Math.abs(a))&&Math.abs(s-l)<=h*Math.max(1,Math.abs(s),Math.abs(l))&&Math.abs(n-c)<=h*Math.max(1,Math.abs(n),Math.abs(c))}function Ppt(t,e,r){return t[0]=e[0]*r,t[1]=e[1]*r,t[2]=e[2]*r,t[3]=e[3]*r,t}function Mpt(t,e,r,i){return t[0]=e[0]+r[0]*i,t[1]=e[1]+r[1]*i,t[2]=e[2]+r[2]*i,t[3]=e[3]+r[3]*i,t}const Ipt=jCe,$pt=HCe;Object.freeze(Object.defineProperty({__proto__:null,LDU:Cpt,add:Apt,adjoint:_pt,copy:fpt,determinant:vpt,equals:Rpt,exactEquals:Opt,frob:Ept,fromRotation:xpt,fromScaling:Tpt,identity:mpt,invert:ypt,mul:Ipt,multiply:jCe,multiplyScalar:Ppt,multiplyScalarAndAdd:Mpt,rotate:bpt,scale:wpt,set:GCe,str:Spt,sub:$pt,subtract:HCe,transpose:gpt},Symbol.toStringTag,{value:"Module"}));function qCe(){return[1,0,0,1]}function Lpt(t){return[t[0],t[1],t[2],t[3]]}function Dpt(t,e,r,i){return[t,e,r,i]}function Npt(t,e){return new Float64Array(t,e,4)}Object.freeze(Object.defineProperty({__proto__:null,clone:Lpt,create:qCe,createView:Npt,fromValues:Dpt},Symbol.toStringTag,{value:"Module"}));let WCe=class{constructor(){this.vLeft=C(),this.vRight=C(),this.vMinSiblingLength=0,this.frame=new NCe}setFrameFromUpVector(e){ie(this.frame.up,e),ce(wC,this.vLeft,this.vRight),me(wC,wC),te(bae,this.frame.up,fe(wC,this.frame.up)),he(WI,wC,bae),me(WI,WI),at(this.frame.right,WI,this.frame.up)}get foldingAngle(){return Math.PI-this.rotationAngle}},Fpt=class extends WCe{get rotationFrameUp(){return this.frame.up}get rotationRight(){return Hve}get rotationAngle(){return te(Uy,this.frame.up,fe(this.frame.up,this.vLeft)),he(Uy,this.vLeft,Uy),ca(Uy,Uy),me(Uy,Uy),te(Fx,this.frame.up,fe(this.frame.up,this.vRight)),he(Fx,this.vRight,Fx),me(Fx,Fx),at(B4,this.rotationFrameUp,this.vLeft),Math.sign(fe(B4,this.vRight))*(Math.PI-Pn(fe(Uy,Fx)))}get maxStretchDistance(){return Math.abs(this.vMinSiblingLength/Math.cos(.5*this.foldingAngle))}applyMiterStretch(e,r){const i=this.rotationAngle;if(Math.abs(i)<=0)return r;const s=xV(Math.cos(.5*i));return or(e,(s-1+1)*r[0],r[1])}},Upt=class extends WCe{get rotationFrameUp(){const e=Math.sign(fe(this.frame.right,this.vRight));return at(bC,this.vRight,this.vLeft),te(bC,bC,e),me(bC,bC)}get rotationRight(){const e=this.rotationFrameUp,r=fe(e,this.frame.up),i=fe(e,this.frame.right);return te(Nx,this.frame.up,-i),te(vae,this.frame.right,r),ce(Nx,Nx,vae),me(Nx,Nx),kpt(_ae,this.frame,Nx),_ae}get rotationAngle(){const e=Math.sign(fe(this.frame.right,this.vRight));return ca(B4,this.vLeft),-e*(Math.PI-Pn(fe(B4,this.vRight)))}get maxStretchDistance(){return Math.abs(this.vMinSiblingLength*xV(Math.cos(.5*this.foldingAngle)))}applyMiterStretch(e,r){const i=this.rotationAngle;if(Math.abs(i)===0)return r;const s=xV(Math.cos(.5*i)),n=this.rotationRight,o=GCe(zpt,1+(s-1)*n[0]*n[0],(s-1)*n[0]*n[1],(s-1)*n[0]*n[1],1+(s-1)*n[1]*n[1]);return Lve(e,r,o)}};function kpt(t,e,r){or(t,fe(r,e.right),fe(r,e.up))}function Vpt(t){switch(t){case $f.World:return new Fpt;case $f.Path:return new Upt}}const bC=C(),_ae=Ve(),Nx=C(),vae=C(),B4=C(),Uy=C(),Fx=C(),bae=C(),wC=C(),WI=C(),zpt=qCe(),H9=8;function Bpt(t,e){const r=E.FEATUREVALUE;t.attributes.add(r,"vec4");const i=t.vertex;i.code.add(b`
  bool isCapVertex() {
    return ${r}.w == 1.0;
  }
  `),i.uniforms.add(new Sr("size",s=>s.size)),e.vvSize?(i.uniforms.add(new Ft("vvSizeMinSize",s=>s.vvSize.minSize),new Ft("vvSizeMaxSize",s=>s.vvSize.maxSize),new Ft("vvSizeOffset",s=>s.vvSize.offset),new Ft("vvSizeFactor",s=>s.vvSize.factor)),i.code.add(b`
    vec2 getSize() {
      return size * clamp(vvSizeOffset + ${r}.x * vvSizeFactor, vvSizeMinSize, vvSizeMaxSize).xz;
    }
    `)):i.code.add(b`vec2 getSize(){
return size;
}`),e.vvOpacity?(i.constants.add("vvOpacityNumber","int",H9),i.uniforms.add(new bl("vvOpacityValues",s=>s.vvOpacity.values,H9),new bl("vvOpacityOpacities",s=>s.vvOpacity.opacityValues,H9)),i.code.add(b`
    vec4 applyOpacity(vec4 color) {
      float value = ${r}.z;
      if (value <= vvOpacityValues[0]) {
        return vec4( color.xyz, vvOpacityOpacities[0]);
      }

      for (int i = 1; i < vvOpacityNumber; ++i) {
        if (vvOpacityValues[i] >= value) {
          float f = (value - vvOpacityValues[i-1]) / (vvOpacityValues[i] - vvOpacityValues[i-1]);
          return vec4( color.xyz, mix(vvOpacityOpacities[i-1], vvOpacityOpacities[i], f));
        }
      }

      return vec4( color.xyz, vvOpacityOpacities[vvOpacityNumber - 1]);
    }
    `)):i.code.add(b`vec4 applyOpacity(vec4 color){
return color;
}`),e.vvColor?(i.constants.add("vvColorNumber","int",zS),i.uniforms.add(new bl("vvColorValues",s=>s.vvColor.values,zS),new qSe("vvColorColors",s=>s.vvColor.colors,zS)),i.code.add(b`
    vec4 getColor() {
      float value = ${r}.y;
      if (value <= vvColorValues[0]) {
        return applyOpacity(vvColorColors[0]);
      }

      for (int i = 1; i < vvColorNumber; ++i) {
        if (vvColorValues[i] >= value) {
          float f = (value - vvColorValues[i-1]) / (vvColorValues[i] - vvColorValues[i-1]);
          return applyOpacity(mix(vvColorColors[i-1], vvColorColors[i], f));
        }
      }

      return applyOpacity(vvColorColors[vvColorNumber - 1]);
    }
    `)):i.code.add(b`vec4 getColor(){
return applyOpacity(vec4(1, 1, 1, 1));
}`),t.include(JR),t.attributes.add(E.PROFILERIGHT,"vec4"),t.attributes.add(E.PROFILEUP,"vec4"),t.attributes.add(E.PROFILEVERTEXANDNORMAL,"vec4"),i.code.add(b`vec3 calculateVPos() {
vec2 size = getSize();
vec3 origin = position;
vec3 right = profileRight.xyz;
vec3 up = profileUp.xyz;
vec3 forward = cross(up, right);
vec2 profileVertex = profileVertexAndNormal.xy * size;
vec2 profileNormal = profileVertexAndNormal.zw;
float positionOffsetAlongProfilePlaneNormal = 0.0;
float normalOffsetAlongProfilePlaneNormal = 0.0;`),i.code.add(b`if(!isCapVertex()) {
vec2 rotationRight = vec2(profileRight.w, profileUp.w);
float maxDistance = length(rotationRight);`),i.code.add(b`rotationRight = maxDistance > 0.0 ? normalize(rotationRight) : vec2(0, 0);
float rx = dot(profileVertex, rotationRight);
if (abs(rx) > maxDistance) {
vec2 rotationUp = vec2(-rotationRight.y, rotationRight.x);
float ry = dot(profileVertex, rotationUp);
profileVertex = rotationRight * maxDistance * sign(rx) + rotationUp * ry;
}
}else{
positionOffsetAlongProfilePlaneNormal = profileRight.w * size[0];
normalOffsetAlongProfilePlaneNormal = profileUp.w;
}
vec3 offset = right * profileVertex.x + up * profileVertex.y + forward * positionOffsetAlongProfilePlaneNormal;
return origin + offset;
}`),i.code.add(b`vec3 localNormal() {
vec3 right = profileRight.xyz;
vec3 up = profileUp.xyz;
vec3 forward = cross(up, right);
vec2 profileNormal = profileVertexAndNormal.zw;
vec3 normal = right * profileNormal.x + up * profileNormal.y;
if(isCapVertex()) {
normal += forward * profileUp.w;
}
return normal;
}`)}let Gpt=class extends aP{constructor(){super(...arguments),this.size=dr(1,1)}};function jpt(t){const e=new wr,{vertex:r,fragment:i}=e;switch(vc(r,t),e.varyings.add("vpos","vec3"),e.include(Bpt,t),t.output!==N.Color&&t.output!==N.Alpha||(e.include(xl,t),e.include(gw,t),e.include(mE,t),e.varyings.add("vnormal","vec3"),e.varyings.add("vcolor","vec4"),t.hasMultipassTerrain&&e.varyings.add("depth","float"),r.code.add(b`
      void main() {
        vpos = calculateVPos();
        vnormal = normalize(localNormal());

        ${t.hasMultipassTerrain?"depth = (view * vec4(vpos, 1.0)).z;":""}
        gl_Position = transformPosition(proj, view, vpos);

        ${t.output===N.Color?"forwardLinearDepth();":""}

        vcolor = getColor();
      }
    `)),e.include(vu,t),t.output){case N.Alpha:e.include(ps,t),i.uniforms.add(new Re("opacity",s=>s.opacity)),i.code.add(b`
      void main() {
        discardBySlice(vpos);
        ${t.hasMultipassTerrain?"terrainDepthTest(gl_FragCoord, depth);":""}
        float combinedOpacity = vcolor.a * opacity;
        fragColor = vec4(combinedOpacity);
      }
    `);break;case N.Color:e.include(ps,t),e.include(_w,t),e.include(fP,t),e.include(gw,t),e.include(WEe,t),up(i,t),mP(i),SE(i),i.uniforms.add(r.uniforms.get("localOrigin"),new Ft("ambient",s=>s.ambient),new Ft("diffuse",s=>s.diffuse),new Ft("specular",s=>s.specular),new Re("opacity",s=>s.opacity)),i.include(sm),im(i),i.code.add(b`
        void main() {
          discardBySlice(vpos);
          ${t.hasMultipassTerrain?"terrainDepthTest(gl_FragCoord, depth);":""}

          shadingParams.viewDirection = normalize(vpos - cameraPosition);
          shadingParams.normalView = vnormal;
          vec3 normal = shadingNormal(shadingParams);
          float ssao = evaluateAmbientOcclusionInverse();

          float additionalAmbientScale = additionalDirectedAmbientLight(vpos + localOrigin);
          vec3 additionalLight = ssao * mainLightIntensity * additionalAmbientScale * ambientBoostFactor * lightingGlobalFactor;
          ${t.receiveShadows?"float shadow = readShadowMap(vpos, linearDepth);":t.spherical?"float shadow = lightingGlobalFactor * (1.0 - additionalAmbientScale);":"float shadow = 0.0;"}
          vec3 albedo = vcolor.rgb * max(ambient, diffuse); // combine the old material parameters into a single one
          float combinedOpacity = vcolor.a * opacity;
          albedo += 0.25 * specular; // don't completely ignore specular for now

          vec3 shadedColor = evaluateSceneLighting(normal, albedo, shadow, 1.0 - ssao, additionalLight);
          fragColor = vec4(shadedColor, combinedOpacity);
          fragColor = highlightSlice(fragColor, vpos);
          ${t.transparencyPassType===ot.Color?"fragColor = premultiplyAlpha(fragColor);":""}
        }
      `);break;case N.Depth:case N.Shadow:case N.ShadowHighlight:case N.ShadowExcludeHighlight:e.include(xl,t),cw(e),e.varyings.add("depth","float"),r.code.add(b`void main() {
vpos = calculateVPos();
gl_Position = transformPositionWithDepth(proj, view, vpos, nearFar, depth);
}`),e.include(ps,t),e.include(jg,t),i.code.add(b`void main() {
discardBySlice(vpos);
outputDepth(depth);
}`);break;case N.Normal:e.include(xl,t),e.include(oR,t),M2(r),e.varyings.add("vnormal","vec3"),r.code.add(b`void main(void) {
vpos = calculateVPos();
vnormal = normalize((viewNormal * vec4(localNormal(), 1.0)).xyz);
gl_Position = transformPosition(proj, view, vpos);
}`),e.include(ps,t),i.code.add(b`void main() {
discardBySlice(vpos);
vec3 normal = normalize(vnormal);
if (gl_FrontFacing == false) normal = -normal;
fragColor = vec4(vec3(0.5) + 0.5 * normal, 1.0);
}`);break;case N.Highlight:e.include(xl,t),e.include(oR,t),e.varyings.add("vnormal","vec3"),r.code.add(b`void main(void) {
vpos = calculateVPos();
gl_Position = transformPosition(proj, view, vpos);
}`),e.include(ps,t),e.include(ny,t),i.code.add(b`void main() {
discardBySlice(vpos);
outputHighlight();
}`)}return e}const Hpt=Object.freeze(Object.defineProperty({__proto__:null,build:jpt},Symbol.toStringTag,{value:"Module"})),ZCe=new Map([[E.POSITION,0],[E.PROFILERIGHT,1],[E.PROFILEUP,2],[E.PROFILEVERTEXANDNORMAL,3],[E.FEATUREVALUE,4]]);let qpt=class extends Gpt{constructor(){super(...arguments),this.ambient=Oe(.2,.2,.2),this.diffuse=Oe(.8,.8,.8),this.specular=Oe(0,0,0),this.opacity=1,this.origin=C(),this.modelTransformation=null}},XCe=class YCe extends Pr{initializeConfiguration(e,r){r.spherical=e.viewingMode===De.Global,r.doublePrecisionRequiresObfuscation=e.rctx.driverTest.doublePrecisionRequiresObfuscation.result}initializeProgram(e){return new Cr(e.rctx,YCe.shader.get().build(this.configuration),ZCe)}initializePipeline(){const e=this.configuration.transparencyPassType,r=this.configuration,i=e===ot.NONE,s=e===ot.FrontFace;return At({blending:r.output!==N.Color&&r.output!==N.Alpha||!r.transparent?null:i?uu:oy(e),culling:r.hasSlicePlane&&!r.transparent&&r.doubleSidedMode!==Ji.None?bwe:null,depthTest:{func:rv(e)},depthWrite:i||s?Ol:null,colorWrite:Vt,stencilWrite:r.hasOccludees?Wf:null,stencilTest:r.hasOccludees?iv:null,polygonOffset:i||s?null:h6})}};XCe.shader=new Er(Hpt,()=>ae(()=>import("./Path.glsl-15c94ee9.js"),[],import.meta.url));let kn=class extends Uo{constructor(){super(...arguments),this.output=N.Color,this.doubleSidedMode=Ji.None,this.transparencyPassType=ot.NONE,this.spherical=!1,this.receiveShadows=!1,this.receiveAmbientOcclusion=!1,this.vvSize=!1,this.vvColor=!1,this.vvOpacity=!1,this.hasSlicePlane=!1,this.transparent=!1,this.hasOccludees=!1,this.hasMultipassTerrain=!1,this.cullAboveGround=!1,this.doublePrecisionRequiresObfuscation=!1}};u([B({count:N.COUNT})],kn.prototype,"output",void 0),u([B({count:Ji.COUNT})],kn.prototype,"doubleSidedMode",void 0),u([B({count:ot.COUNT})],kn.prototype,"transparencyPassType",void 0),u([B()],kn.prototype,"spherical",void 0),u([B()],kn.prototype,"receiveShadows",void 0),u([B()],kn.prototype,"receiveAmbientOcclusion",void 0),u([B()],kn.prototype,"vvSize",void 0),u([B()],kn.prototype,"vvColor",void 0),u([B()],kn.prototype,"vvOpacity",void 0),u([B()],kn.prototype,"hasSlicePlane",void 0),u([B()],kn.prototype,"transparent",void 0),u([B()],kn.prototype,"hasOccludees",void 0),u([B()],kn.prototype,"hasMultipassTerrain",void 0),u([B()],kn.prototype,"cullAboveGround",void 0),u([B()],kn.prototype,"doublePrecisionRequiresObfuscation",void 0),u([B({constValue:st.Disabled})],kn.prototype,"pbrMode",void 0),u([B({constValue:!0})],kn.prototype,"hasVvInstancing",void 0),u([B({constValue:!1})],kn.prototype,"useCustomDTRExponentForWater",void 0),u([B({constValue:!1})],kn.prototype,"useFillLights",void 0);let Wpt=class JCe extends tv{constructor(e){super(e,new Xpt),this.supportsEdges=!0,this._vertexAttributeLocations=ZCe,this._configuration=new kn,this._vertexBufferLayout=JCe.getVertexBufferLayout()}getConfiguration(e,r){return this._configuration.output=e,this._configuration.vvSize=!!this.parameters.vvSize,this._configuration.vvColor=!!this.parameters.vvColor,this._configuration.vvOpacity=!!this.parameters.vvOpacity,this._configuration.hasSlicePlane=this.parameters.hasSlicePlane,this._configuration.transparent=this.parameters.transparent,this._configuration.hasOccludees=this.parameters.hasOccludees,e!==N.Color&&e!==N.Alpha||(this._configuration.doubleSidedMode=this.parameters.doubleSided&&this.parameters.doubleSidedType==="normal"?Ji.View:this.parameters.doubleSided&&this.parameters.doubleSidedType==="winding-order"?Ji.WindingOrder:Ji.None,this._configuration.receiveShadows=this.parameters.receiveShadows,this._configuration.receiveAmbientOcclusion=!!r.ssaoHelper.active&&this.parameters.receiveSSAO),this._configuration.transparencyPassType=r.transparencyPassType,this._configuration.hasMultipassTerrain=r.multipassTerrain.enabled,this._configuration.cullAboveGround=r.multipassTerrain.cullAboveGround,this._configuration}isVisibleForOutput(e){return e!==N.Shadow&&e!==N.ShadowExcludeHighlight&&e!==N.ShadowHighlight||this.parameters.castShadows}isVisible(){return super.isVisible()&&this.parameters.opacity>0}intersect(e,r,i,s,n,o){const a=e;if(!FCe(a))return;const l=a.path,c=[this.parameters.size[0],this.parameters.size[1]];if(this.parameters.vvSize){const{offset:v,factor:w,minSize:x,maxSize:T}=this.parameters.vvSize,S=l.sizeAttributeValue;c[0]*=ge(v[0]+S*w[0],x[0],T[0]),c[1]*=ge(v[2]+S*w[2],x[2],T[2])}const h=Math.max(c[0],c[1]),p=e.boundingInfo;if(p==null)return void this._intersectTriangles(l,c,s,n,o);const f=Kb(p.bbMin[0]-h,p.bbMin[1]-h,p.bbMin[2]-h,p.bbMax[0]+h,p.bbMax[1]+h,p.bbMax[2]+h),m=[n[0]-s[0],n[1]-s[1],n[2]-s[2]],y=Math.sqrt(m[0]*m[0]+m[1]*m[1]+m[2]*m[2]),_=[y/m[0],y/m[1],y/m[2]];SY(f,s,_,i.tolerance)&&this._intersectTriangles(l,c,s,n,o)}_intersectTriangles(e,r,i,s,n){e.baked.size&&e.baked.size[0]===r[0]&&e.baked.size[1]===r[1]||e.baked.bake(r),e.baked.intersect(i,s,n)}createBufferWriter(){return new TE(this._vertexBufferLayout)}requiresSlot(e,r){switch(r){case N.Shadow:case N.ShadowHighlight:case N.ShadowExcludeHighlight:if(!this.parameters.castShadows)return!1;case N.Color:case N.Alpha:case N.Depth:case N.Normal:case N.Highlight:case N.ObjectAndLayerIdColor:return e===(this.parameters.transparent?ue.TRANSPARENT_MATERIAL:ue.OPAQUE_MATERIAL)||e===ue.DRAPED_MATERIAL;default:return!1}}createGLMaterial(e){return new Zpt(e)}static getVertexBufferLayout(){return zi().vec3f(E.POSITION).vec4f(E.PROFILERIGHT).vec4f(E.PROFILEUP).vec4f(E.PROFILEVERTEXANDNORMAL).vec4f(E.FEATUREVALUE)}},Zpt=class extends K_{_updateOccludeeState(e){e.hasOccludees!==this._material.parameters.hasOccludees&&this._material.setParameters({hasOccludees:e.hasOccludees})}_updateShadowState(e){this.technique!=null&&e.shadowMap.enabled===this.technique.configuration.receiveShadows||this._material.setParameters({receiveShadows:e.shadowMap.enabled})}beginSlot(e){return this._output!==N.Color&&this._output!==N.Alpha||(this._updateShadowState(e),this._updateOccludeeState(e)),this.ensureTechnique(XCe,e)}},Xpt=class extends qpt{constructor(){super(...arguments),this.doubleSided=!1,this.doubleSidedType="normal",this.receiveSSAO=!0,this.receiveShadows=!1,this.castShadows=!0,this.hasSlicePlane=!1,this.transparent=!1,this.hasOccludees=!1}};const Ypt=["polyline"];let Jpt=class extends om{constructor(e,r,i,s){super(e,r,i,s),this._intrinsicSize=dr(1,1),this._upVectorAlignment=$f.Path,this._stencilWidth=.1,this.ensureDrapedStatus(!1)}async doLoad(){const e=this.symbolLayer.width!=null?this.symbolLayer.width:this.symbolLayer.height,r=this.symbolLayer.height!=null?this.symbolLayer.height:e;this._vvConvertOptions=new oP({size:!0,color:!0,rotation:!1,opacity:!0},[1,1,1],[e,1,r],this._context.renderCoordsHelper.unitInMeters),this._fastUpdates=this._context.renderer?.visualVariables?.length>0?$2(this._context.renderer,this._vvConvertOptions):null;const i=this.symbolLayer.anchor||"center";this._upVectorAlignment=this.symbolLayer.profileRotation==="heading"?$f.World:$f.Path;const s=this.symbolLayer.profile||"circle";switch(s){default:case"circle":this._profile=dpt[i];break;case"quad":this._profile=ppt[i]}switch(this.symbolLayer.join){case"round":this._extruder=new B9(0,b2e);break;case"bevel":this._extruder=new B9(0,1);break;case"miter":this._extruder=new B9(.8*Math.PI,1);break;default:this._extruder=new Kdt}const n=this.symbolLayer.cap||"butt";switch(n){case"none":this._startCap=new pae,this._endCap=new pae;break;case"butt":default:this._startCap=new qI(this._profile,0),this._endCap=new qI(this._profile,0,!0);break;case"square":this._startCap=new qI(this._profile,-.5),this._endCap=new qI(this._profile,.5,!0);break;case"round":{const f=s==="quad";this._startCap=new fae({profile:this._profile,flip:!1,breakNormals:f,subdivisions:lH}),this._endCap=new fae({profile:this._profile,flip:!0,breakNormals:f,subdivisions:lH});break}}const o=this.symbolLayer?.material?.color,a=this._getCombinedOpacityAndColor(o),l=Fa(a),c=a[3],h=c<1||this.needsDrivenTransparentPass,p={diffuse:l,ambient:l,opacity:c,transparent:h,hasVertexColors:!1,hasSlicePlane:this._context.slicePlaneEnabled,castShadows:this.symbolLayer.castShadows,cullFace:h||n==="none"?pi.None:pi.Back,offsetTransparentBackfaces:!0};if(!this._drivenProperties.size&&(or(this._intrinsicSize,e,r),!aH(this._intrinsicSize[0])||!aH(this._intrinsicSize[1])))throw new F("graphics3dpathsymbollayer:invalid-size","Symbol sizes may not be negative values");if(this._fastUpdates&&this._fastUpdates.visualVariables.size||lc(this._intrinsicSize,this._intrinsicSize,1/this._context.renderCoordsHelper.unitInMeters),this._fastUpdates){const f={...p,...this._fastUpdates.materialParameters,size:kve(this._intrinsicSize)};this._material=new Wpt(f)}else p.hasVertexColors=this._drivenProperties.color||this._drivenProperties.opacity,p.normalType=Or.Compressed,this._material=new Zf(p);this._material.setParameters({usePBR:this._context.physicalBasedRenderingEnabled,isSchematic:!0}),this._context.stage.add(this._material)}destroy(){super.destroy(),this._context.stage.remove(this._material),this._material=null}createGraphics3DGraphic(e){const r=e.graphic;if(!this._validateGeometry(r.geometry,Ypt,this.symbolLayer.type))return null;const i=this.setGraphicElevationContext(r,new mp),s=e.renderingInfo;return this._createAs3DShape(r,s,i,r.uid)}layerOpacityChanged(){const e=this.symbolLayer?.material?.color,r=this._getCombinedOpacity(e),i=r<1||this.needsDrivenTransparentPass;this._material.setParameters({opacity:r,transparent:i})}layerElevationInfoChanged(e,r){return this.updateGraphics3DGraphicElevationInfo(e,r,G_)}slicePlaneEnabledChanged(){return this._material.setParameters({hasSlicePlane:this._context.slicePlaneEnabled}),!0}physicalBasedRenderingChanged(){return this._material.setParameters({usePBR:this._context.physicalBasedRenderingEnabled,isSchematic:!0}),!0}applyRendererDiff(e,r){for(const i in e.diff){if(i!=="visualVariables"||!L2(this._fastUpdates,r,this._vvConvertOptions))return Is.RecreateSymbol;this._material.setParameters(this._fastUpdates.materialParameters)}return Is.FastUpdate}_getVertexData(e){let r=0;const i=e.paths,s=[],n=e.spatialReference,o=this._context.elevationProvider.spatialReference,a=this._context.renderCoordsHelper.spatialReference;for(const p of i)r+=p.length;const l=Bo(3*r);let c,h=0;for(const p of i){s.push({offset:h,numVertices:p.length});for(const f of p)l[h++]=f[0],l[h++]=f[1],l[h++]=e.hasZ?f[2]:0}return o==null||n.equals(o)||oi(l,n,0,l,o,0,r)?(o==null||o.equals(a)?c=Rxe(l):(c=Bo(3*r),oi(l,o,0,c,a,0,r)),{pathVertexDataInfos:s,vertexDataES:l,vertexDataRS:c}):null}_createAs3DShape(e,r,i,s){const n=e.geometry,o=this._getVertexData(n);if(o==null)return this.logger.warn("PathSymbol3DLayer geometry failed to be created (failed to project geometry to view spatial reference)"),null;if(o.pathVertexDataInfos.length===0)return n.paths.length!==0&&n.paths.some(y=>y.length>0)||this.logger.warn("PathSymbol3DLayer geometry failed to be created (no paths were defined)"),null;const a=new Array,l=n.spatialReference,c=pn(),h=this._context.renderCoordsHelper,p=new fY(o.vertexDataES);for(const y of o.pathVertexDataInfos){const _=y.numVertices;if(_<2)continue;const v=y.offset;if(this._context.clippingExtent!=null&&(xi(c),nu(c,o.vertexDataES,v,_),!Gd(c,this._context.clippingExtent)))continue;const w=new Array,x=v+3*_;for(let L=v;L<x;L+=3){p.offset=L;const D=yot(p,this._context.elevationProvider,i,h);se(hs,o.vertexDataRS[L],o.vertexDataRS[L+1],o.vertexDataRS[L+2]),h.setAltitude(hs,D),o.vertexDataRS[L]=hs[0],o.vertexDataRS[L+1]=hs[1],o.vertexDataRS[L+2]=hs[2],w.push(Vpt(this._upVectorAlignment))}const T=new Ydt(w,o.vertexDataES,o.vertexDataRS,v);QCe(T,this._upVectorAlignment,this._context.renderCoordsHelper);const S=new Jdt(T,this._profile,this._extruder,this._startCap,this._endCap);let O=null;if(this._fastUpdates){const L=this._fastUpdates.visualVariables,D=tp(L.size?.field,e)??0,U=tp(L.color?.field,e)??0,X=tp(L.opacity?.field,e)??0;O=new ipt(S,D,U,X)}else{const L=[this._intrinsicSize[0],this._intrinsicSize[1]];if(this._drivenProperties.size){const X=r.size;L[0]*=wae(X[0],X[2]==="symbol-value"?this.symbolLayer.height||0:X[2],this.symbolLayer.width||0),L[1]*=wae(X[2],X[0]==="symbol-value"?this.symbolLayer.width||0:X[0],this.symbolLayer.height||0)}let D;this._drivenProperties.color&&(D=r.color),this._drivenProperties.opacity&&r.opacity!=null&&(D=D?[D[0],D[1],D[2],r.opacity]:[1,1,1,r.opacity]);const U=new kCe(S);U.bake(L),D&&U.bakeVertexColors(D),O=U}const{vertexAttributes:A,indices:I}=O.createGeometryData(),M=this._context.stage.renderView.getObjectAndLayerIdColor({graphicUid:s,layerUid:this._context.layer.uid}),k=new rpt(this._material,A,I,O,l,this._stencilWidth,M);k.transformation=Al(be(),un,S.path.origin),a.push(k)}if(a.length===0)return null;const f=new ay({geometries:a,layerUid:this._context.layer.uid,graphicUid:s}),m=new nm(this,f,a,null,null,(y,_,v,w,x)=>Kpt(y,_,w,x,this._upVectorAlignment),i);return m.alignedSampledElevation=0,m.needsElevationUpdates=G_(i.mode),m}};function QCe(t,e,r){const{origin:i,positions:s}=t;let n=t.offset;switch(e){default:case $f.World:for(const o of t.vertices)hs[0]=s[n++]+i[0],hs[1]=s[n++]+i[1],hs[2]=s[n++]+i[2],r.worldUpAtPosition(hs,hs),o.setFrameFromUpVector(hs);break;case $f.Path:hs[0]=s[n]+i[0],hs[1]=s[n+1]+i[1],hs[2]=s[n+2]+i[2],r.worldUpAtPosition(hs,hs),upt(t,hs)}}function wae(t,e,r){switch(t){case"symbol-value":return r;case"proportional":return e;default:return t}}function Qpt(t,e,r,i){let s=0;const{origin:n,vertices:o,positions:a,positionsES:l}=t,c=t.offset+3*o.length;for(let h=t.offset;h<c;h+=3)se(hs,l[h],l[h+1],l[h+2]),r(hs,q9),s+=q9.sampledElevation,hs[0]=a[h]+n[0],hs[1]=a[h+1]+n[1],hs[2]=a[h+2]+n[2],i.setAltitude(hs,q9.z),a[h]=hs[0]-n[0],a[h+1]=hs[1]-n[1],a[h+2]=hs[2]-n[2];return t.updatePathVertexInformation(),s/o.length}function Kpt(t,e,r,i,s){const n=t.stageObject,o=n.geometries;let a=0;for(const l of o){if(!FCe(l))continue;const c=l.path,h=c.builder.path;a+=Qpt(h,e,r,i),s!==$f.World&&QCe(h,s,i),c.onPathChanged(l),l.invalidateBoundingInfo(),n.geometryVertexAttrsUpdated(l)}return a/o.length}const hs=C(),q9=new cP;function eft(t,e,r,i,s=1){if(r.isGeographic&&i===De.Global){const c=Bo(e.length),h=e.length,p=Nr(r);for(let f=0;f<h;f+=3)v5(e,f,c,f,p);e=c}or(tn,Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY);for(let c=0;c<e.length;c+=3)tn[0]=Math.min(tn[0],e[c]),tn[1]=Math.min(tn[1],e[c+1]);const n=tn[0]%s,o=tn[1]%s,a=tn[0]-n,l=tn[1]-o;for(let c=0;c<e.length;c+=3){const h=c/3*4;t[h]=(e[c]-a)/s,t[h+1]=(e[c+1]-l)/s,t[h+2]=a/s,t[h+3]=l/s}}function KCe(t,e,r,i,s=1){se(Nv,1,0,0),se(Fv,0,1,0),se(kx,0,0,1),ift(W9,r),tft(r,xae)&&rft(xae,Nv,Fv,kx,i,W9),or(tn,Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY),or(Uv,Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY);for(let h=0;h<r.length;h+=3){se(Ux,r[h],r[h+1],r[h+2]);const p=fe(Nv,Ux),f=fe(Fv,Ux);tn[0]=Math.min(tn[0],p),tn[1]=Math.min(tn[1],f),Uv[0]=Math.max(Uv[0],p),Uv[1]=Math.max(Uv[1],f)}const n=fe(kx,W9);X9(ky,tn[0],tn[1],n,Nv,Fv,kx),X9(kv,Uv[0],tn[1],n,Nv,Fv,kx),X9(Vv,tn[0],Uv[1],n,Nv,Fv,kx),he(kv,kv,ky),te(kv,kv,.5),he(Vv,Vv,ky),te(Vv,Vv,.5),ce(ky,ky,kv),ce(ky,ky,Vv);const o=tn[0]%s,a=tn[1]%s,l=tn[0]-o,c=tn[1]-a;for(let h=0;h<r.length;h+=3){se(Ux,r[h],r[h+1],r[h+2]);const p=h/3,f=4*p;t[f]=(fe(Nv,Ux)-l)/s,t[f+1]=(fe(Fv,Ux)-c)/s,t[f+2]=l/s,t[f+3]=c/s;const m=9*p;for(let y=0;y<3;y++)e[m+y]=ky[y],e[m+y+3]=kv[y],e[m+y+6]=Vv[y]}}const W9=C(),Ux=C(),xae=Ir(),Nv=C(),Fv=C(),kx=C(),tn=Ve(),Uv=Ve(),ky=C(),kv=C(),Vv=C();function tft(t,e){const r=t.length/3-1;return fbe(t,e,0,Math.floor(r/3),Math.floor(r*(2/3)))}function rft(t,e,r,i,s,n){s!=null?(s.basisMatrixAtPosition(n,Dp),se(ZI,Dp[0],Dp[1],Dp[2]),se(XI,Dp[4],Dp[5],Dp[6]),se(Z9,Dp[8],Dp[9],Dp[10])):(se(ZI,1,0,0),se(XI,0,1,0),se(Z9,0,0,1));const o=t;fe(o,Z9)<0&&te(o,o,-1),ie(i,o);const a=fe(o,XI),l=fe(o,ZI);Math.abs(a)<Math.abs(l)?(hb(e,ZI,o,-l),me(e,e),at(r,e,o),me(r,r),te(r,r,-1)):(hb(r,XI,o,-a),me(r,r),at(e,r,o),me(e,e))}const Dp=be(),ZI=C(),XI=C(),Z9=C();function ift(t,e){se(xC,0,0,0);for(let r=0;r<e.length-3;r+=3)xC[0]+=e[r],xC[1]+=e[r+1],xC[2]+=e[r+2];te(t,xC,1/(e.length/3-1))}const xC=C();function X9(t,e,r,i,s,n,o){se(t,e*s[0]+r*n[0]+i*o[0],e*s[1]+r*n[1]+i*o[1],e*s[2]+r*n[2]+i*o[2])}function sft(t){const e=new wr,{vertex:r,fragment:i,attributes:s,varyings:n}=e;vc(r,t),e.include(xl,t),e.include(Bw,t),e.include(Sg,t),e.include(nP,t),s.add(E.POSITION,"vec3"),t.vvColor&&s.add(E.COLORFEATUREATTRIBUTE,"float"),n.add("vColor","vec4"),n.add("vpos","vec3");const o=t.hasMultipassTerrain&&(t.output===N.Color||t.output===N.Alpha);o&&n.add("depth","float"),r.uniforms.add(new sr("eColor",c=>c.color));const a=t.output===N.Depth;a&&(e.include(jg,t),cw(e),F_(e)),r.code.add(b`
    void main(void) {
      vpos = position;
      forwardNormalizedVertexColor();
      forwardObjectAndLayerIdColor();

      ${t.hasVertexColors?"vColor *= eColor;":t.vvColor?"vColor = eColor * interpolateVVColor(colorFeatureAttribute);":"vColor = eColor;"}
      ${o?"depth = (view * vec4(vpos, 1.0)).z;":""}
      gl_Position = ${a?b`transformPositionWithDepth(proj, view, vpos, nearFar, linearDepth);`:b`transformPosition(proj, view, vpos);`}
    }
  `),e.include(ps,t),o&&e.include(vu,t),i.include(sm);const l=t.output===N.Highlight;return l&&e.include(ny,t),i.code.add(b`
  void main() {
    discardBySlice(vpos);
    ${o?"terrainDepthTest(gl_FragCoord, depth);":""}
    vec4 fColor = vColor;

    ${t.output===N.ObjectAndLayerIdColor?b`fColor.a = 1.0;`:""}

    if (fColor.a < ${b.float(go)}) {
      discard;
    }

    ${t.output===N.Alpha?b`fragColor = vec4(fColor.a);`:""}

    ${t.output===N.Color?b`fragColor = highlightSlice(fColor, vpos); ${t.transparencyPassType===ot.Color?"fragColor = premultiplyAlpha(fragColor);":""}`:""}
    ${l?b`outputHighlight();`:""};
    ${t.output===N.Depth?b`outputDepth(linearDepth);`:""};
    ${t.output===N.ObjectAndLayerIdColor?b`outputObjectAndLayerIdColor();`:""}
  }
  `),e}const nft=Object.freeze(Object.defineProperty({__proto__:null,build:sft},Symbol.toStringTag,{value:"Module"}));let eAe=class tAe extends Pr{initializeProgram(e){return new Cr(e.rctx,tAe.shader.get().build(this.configuration),br)}_createPipeline(e,r){const i=this.configuration,s=e===ot.NONE,n=e===ot.FrontFace;return At({blending:i.output!==N.Color&&i.output!==N.Alpha||!i.transparent?null:s?uu:oy(e),culling:F5(i.cullFace),depthTest:{func:rv(e)},depthWrite:(s||n)&&i.writeDepth?Ol:null,colorWrite:Vt,stencilWrite:i.hasOccludees?Wf:null,stencilTest:i.hasOccludees?r?H_:iv:null,polygonOffset:s||n?i.polygonOffset?oft:null:d6(i.enableOffset)})}initializePipeline(){return this._occludeePipelineState=this._createPipeline(this.configuration.transparencyPassType,!0),this._createPipeline(this.configuration.transparencyPassType,!1)}getPipelineState(e,r){return r?this._occludeePipelineState:super.getPipelineState(e,r)}};eAe.shader=new Er(nft,()=>ae(()=>import("./ColorMaterial.glsl-7a3daa27.js"),[],import.meta.url));const oft={factor:1,units:1};let Ro=class extends Uo{constructor(){super(...arguments),this.output=N.Color,this.cullFace=pi.None,this.transparencyPassType=ot.NONE,this.hasSlicePlane=!1,this.hasVertexColors=!1,this.transparent=!1,this.polygonOffset=!1,this.enableOffset=!0,this.writeDepth=!0,this.hasOccludees=!1,this.hasMultipassTerrain=!1,this.cullAboveGround=!1,this.objectAndLayerIdColorInstanced=!1,this.vvColor=!1}};u([B({count:N.COUNT})],Ro.prototype,"output",void 0),u([B({count:pi.COUNT})],Ro.prototype,"cullFace",void 0),u([B({count:ot.COUNT})],Ro.prototype,"transparencyPassType",void 0),u([B()],Ro.prototype,"hasSlicePlane",void 0),u([B()],Ro.prototype,"hasVertexColors",void 0),u([B()],Ro.prototype,"transparent",void 0),u([B()],Ro.prototype,"polygonOffset",void 0),u([B()],Ro.prototype,"enableOffset",void 0),u([B()],Ro.prototype,"writeDepth",void 0),u([B()],Ro.prototype,"hasOccludees",void 0),u([B()],Ro.prototype,"hasMultipassTerrain",void 0),u([B()],Ro.prototype,"cullAboveGround",void 0),u([B()],Ro.prototype,"objectAndLayerIdColorInstanced",void 0),u([B()],Ro.prototype,"vvColor",void 0),u([B({constValue:!0})],Ro.prototype,"hasVvInstancing",void 0),u([B({constValue:!1})],Ro.prototype,"vvSize",void 0),u([B({constValue:!1})],Ro.prototype,"vvOpacity",void 0);let Tae=class extends KY{constructor(e){super(e,new lft),this.supportsEdges=!0,this._configuration=new Ro}getConfiguration(e,r){return this._configuration.output=e,this._configuration.cullFace=this.parameters.cullFace,this._configuration.hasVertexColors=this.parameters.hasVertexColors&&!this.parameters.vvColor,this._configuration.hasSlicePlane=this.parameters.hasSlicePlane,this._configuration.transparent=this.parameters.transparent,this._configuration.polygonOffset=this.parameters.polygonOffset,this._configuration.writeDepth=this.parameters.writeDepth,this._configuration.hasOccludees=this.parameters.hasOccludees,this._configuration.transparencyPassType=r.transparencyPassType,this._configuration.enableOffset=r.camera.relativeElevation<u6,this._configuration.hasMultipassTerrain=r.multipassTerrain.enabled,this._configuration.cullAboveGround=r.multipassTerrain.cullAboveGround,this._configuration.vvColor=!!this.parameters.vvColor,this._configuration}requiresSlot(e,r){return r===N.Color||r===N.Alpha||r===N.Highlight||r===N.Depth&&this.parameters.writeLinearDepth||r===N.ObjectAndLayerIdColor?e===ue.DRAPED_MATERIAL?!0:r===N.Highlight?e===ue.OPAQUE_MATERIAL:e===(this.parameters.transparent?this.parameters.writeDepth?ue.TRANSPARENT_MATERIAL:ue.TRANSPARENT_DEPTH_WRITE_DISABLED_MATERIAL:ue.OPAQUE_MATERIAL):!1}createGLMaterial(e){return new aft(e)}createBufferWriter(){const e=zi().vec3f(E.POSITION);return oe("enable-feature:objectAndLayerId-rendering")&&e.vec4u8(E.OBJECTANDLAYERIDCOLOR),this.parameters.vvColor?e.f32(E.COLORFEATUREATTRIBUTE):e.vec4u8(E.COLOR),new TE(e)}},aft=class extends K_{_updateOccludeeState(e){e.hasOccludees!==this._material.parameters.hasOccludees&&this._material.setParameters({hasOccludees:e.hasOccludees})}beginSlot(e){return this._output!==N.Color&&this._output!==N.Alpha||this._updateOccludeeState(e),this.ensureTechnique(eAe,e)}},lft=class extends aP{constructor(){super(...arguments),this.color=Of,this.transparent=!1,this.writeDepth=!0,this.writeLinearDepth=!1,this.hasVertexColors=!1,this.polygonOffset=!1,this.hasSlicePlane=!1,this.cullFace=pi.None,this.hasOccludees=!1}};var mo;(function(t){t[t.Horizontal=0]="Horizontal",t[t.Vertical=1]="Vertical",t[t.Cross=2]="Cross",t[t.ForwardDiagonal=3]="ForwardDiagonal",t[t.BackwardDiagonal=4]="BackwardDiagonal",t[t.DiagonalCross=5]="DiagonalCross",t[t.COUNT=6]="COUNT"})(mo||(mo={}));const SH=.70710678118,Sae=SH,cft=.08715574274;function uft(t){const e=new wr,r=t.hasMultipassTerrain&&(t.output===N.Color||t.output===N.Alpha),{vertex:i,fragment:s,attributes:n,varyings:o}=e;vc(i,t),e.include(xl,t),e.include(Bw,t),e.include(Sg,t),t.draped?i.uniforms.add(new Re("worldToScreenRatio",(c,h)=>1/h.screenToPCSRatio)):n.add(E.BOUNDINGRECT,"mat3"),n.add(E.POSITION,"vec3"),n.add(E.UVMAPSPACE,"vec4"),t.vvColor&&n.add(E.COLORFEATUREATTRIBUTE,"float"),o.add("vColor","vec4"),o.add("vpos","vec3"),o.add("vuv","vec2"),r&&o.add("depth","float"),i.uniforms.add(new sr("uColor",c=>c.color));const a=t.style===mo.ForwardDiagonal||t.style===mo.BackwardDiagonal||t.style===mo.DiagonalCross;a&&i.code.add(b`
      const mat2 rotate45 = mat2(${b.float(SH)}, ${b.float(-Sae)},
                                 ${b.float(Sae)}, ${b.float(SH)});
    `),t.draped||(up(i,t),i.uniforms.add(new Re("worldToScreenPerDistanceRatio",(c,h)=>1/h.camera.perScreenPixelRatio)),i.code.add(b`vec3 projectPointToLineSegment(vec3 center, vec3 halfVector, vec3 point) {
float projectedLength = dot(halfVector, point - center) / dot(halfVector, halfVector);
return center + halfVector * clamp(projectedLength, -1.0, 1.0);
}`),i.code.add(b`vec3 intersectRayPlane(vec3 rayDir, vec3 rayOrigin, vec3 planeNormal, vec3 planePoint) {
float d = dot(planeNormal, planePoint);
float t = (d - dot(planeNormal, rayOrigin)) / dot(planeNormal, rayDir);
return rayOrigin + t * rayDir;
}`),i.code.add(b`
      float boundingRectDistanceToCamera() {
        vec3 center = vec3(boundingRect[0][0], boundingRect[0][1], boundingRect[0][2]);
        vec3 halfU = vec3(boundingRect[1][0], boundingRect[1][1], boundingRect[1][2]);
        vec3 halfV = vec3(boundingRect[2][0], boundingRect[2][1], boundingRect[2][2]);
        vec3 n = normalize(cross(halfU, halfV));

        vec3 viewDir = - vec3(view[0][2], view[1][2], view[2][2]);

        float viewAngle = dot(viewDir, n);
        float minViewAngle = ${b.float(cft)};

        if (abs(viewAngle) < minViewAngle) {
          // view direction is (almost) parallel to plane -> clamp it to min angle
          float normalComponent = sign(viewAngle) * minViewAngle - viewAngle;
          viewDir = normalize(viewDir + normalComponent * n);
        }

        // intersect view direction with infinite plane that contains bounding rect
        vec3 planeProjected = intersectRayPlane(viewDir, cameraPosition, n, center);

        // clip to bounds by projecting to u and v line segments individually
        vec3 uProjected = projectPointToLineSegment(center, halfU, planeProjected);
        vec3 vProjected = projectPointToLineSegment(center, halfV, planeProjected);

        // use to calculate the closest point to camera on bounding rect
        vec3 closestPoint = uProjected + vProjected - center;

        return length(closestPoint - cameraPosition);
      }
    `)),i.code.add(b`
    vec2 scaledUV() {
      vec2 uv = uvMapSpace.xy ${a?" * rotate45":""};
      vec2 uvCellOrigin = uvMapSpace.zw ${a?" * rotate45":""};

      ${t.draped?"":b`
            float distanceToCamera = boundingRectDistanceToCamera();
            float worldToScreenRatio = worldToScreenPerDistanceRatio / distanceToCamera;
          `}

      // Logarithmically discretize ratio to avoid jittering
      float step = 0.1;
      float discreteWorldToScreenRatio = log(worldToScreenRatio);
      discreteWorldToScreenRatio = ceil(discreteWorldToScreenRatio / step) * step;
      discreteWorldToScreenRatio = exp(discreteWorldToScreenRatio);

      vec2 uvOffset = mod(uvCellOrigin * discreteWorldToScreenRatio, ${b.float(t.patternSpacing)});
      return uvOffset + (uv * discreteWorldToScreenRatio);
    }
  `);const l=t.output===N.Depth;return l&&(e.include(jg,t),cw(e),F_(e)),i.code.add(b`
    void main(void) {
      vuv = scaledUV();
      vpos = position;
      ${r?"depth = (view * vec4(vpos, 1.0)).z;":""}
      forwardNormalizedVertexColor();
      ${t.hasVertexColors?"vColor *= uColor;":t.vvColor?"vColor = uColor * interpolateVVColor(colorFeatureAttribute);":"vColor = uColor;"}
      gl_Position = ${l?b`transformPositionWithDepth(proj, view, vpos, nearFar, linearDepth);`:b`transformPosition(proj, view, vpos);`}
    }
  `),e.include(ps,t),s.include(sm),t.draped&&s.uniforms.add(new Re("texelSize",(c,h)=>1/h.camera.pixelRatio)),t.output===N.Highlight&&e.include(ny,t),r&&e.include(vu,t),t.output!==N.Highlight&&(s.code.add(b`
      const float lineWidth = ${b.float(t.lineWidth)};
      const float spacing = ${b.float(t.patternSpacing)};
      const float spacingINV = ${b.float(1/t.patternSpacing)};

      float coverage(float p, float txlSize) {
        p = mod(p, spacing);

        float halfTxlSize = txlSize / 2.0;

        float start = p - halfTxlSize;
        float end = p + halfTxlSize;

        float coverage = (ceil(end * spacingINV) - floor(start * spacingINV)) * lineWidth;
        coverage -= min(lineWidth, mod(start, spacing));
        coverage -= max(lineWidth - mod(end, spacing), 0.0);

        return coverage / txlSize;
      }
    `),t.draped||s.code.add(b`const int maxSamples = 5;
float sampleAA(float p) {
vec2 dxdy = abs(vec2(dFdx(p), dFdy(p)));
float fwidth = dxdy.x + dxdy.y;
ivec2 samples = 1 + ivec2(clamp(dxdy, 0.0, float(maxSamples - 1)));
vec2 invSamples = 1.0 / vec2(samples);
float accumulator = 0.0;
for (int j = 0; j < maxSamples; j++) {
if(j >= samples.y) {
break;
}
for (int i = 0; i < maxSamples; i++) {
if(i >= samples.x) {
break;
}
vec2 step = vec2(i,j) * invSamples - 0.5;
accumulator += coverage(p + step.x * dxdy.x + step.y * dxdy.y, fwidth);
}
}
accumulator /= float(samples.x * samples.y);
return accumulator;
}`)),s.code.add(b`
    void main() {
      discardBySlice(vpos);
      ${r?"terrainDepthTest(gl_FragCoord, depth);":""}
      vec4 color = vColor;
      color = highlightSlice(color, vpos);

      ${t.output!==N.Highlight?b`color.a *= ${hft(t)};`:""}

      ${t.output===N.ObjectAndLayerIdColor?b`color.a = 1.0;`:""}

      if (color.a < ${b.float(go)}) {
        discard;
      }

      ${t.output===N.Alpha?b`fragColor = vec4(color.a);`:""}

      ${t.output===N.Color?b`fragColor = color; ${t.transparencyPassType===ot.Color?"fragColor = premultiplyAlpha(fragColor);":""}`:""}
      ${t.output===N.Highlight?b`outputHighlight();`:""}
      ${t.output===N.Depth?b`outputDepth(linearDepth);`:""};
    }
  `),e}function hft(t){function e(r){return t.draped?b`coverage(vuv.${r}, texelSize)`:b`sampleAA(vuv.${r})`}switch(t.style){case mo.ForwardDiagonal:case mo.Horizontal:return e("y");case mo.BackwardDiagonal:case mo.Vertical:return e("x");case mo.DiagonalCross:case mo.Cross:return b`
        1.0 - (1.0 - ${e("x")}) * (1.0 - ${e("y")})
      `;default:return"0.0"}}const dft=Object.freeze(Object.defineProperty({__proto__:null,build:uft},Symbol.toStringTag,{value:"Module"}));let rAe=class iAe extends Pr{initializeProgram(e){return new Cr(e.rctx,iAe.shader.get().build(this.configuration),sAe)}_setPipelineState(e,r){const i=this.configuration,s=e===ot.NONE,n=e===ot.FrontFace;return At({blending:i.output===N.Color||i.output===N.Alpha?s?uu:oy(e):null,culling:F5(i.cullFace),depthTest:{func:rv(e)},depthWrite:s?i.writeDepth?Ol:null:c6(e),colorWrite:Vt,stencilWrite:i.hasOccludees?Wf:null,stencilTest:i.hasOccludees?r?H_:iv:null,polygonOffset:s||n?i.polygonOffset?pft:null:d6(i.enableOffset)})}initializePipeline(){return this._occludeePipelineState=this._setPipelineState(this.configuration.transparencyPassType,!0),this._setPipelineState(this.configuration.transparencyPassType,!1)}getPipelineState(e,r){return r?this._occludeePipelineState:super.getPipelineState(e,r)}};rAe.shader=new Er(dft,()=>ae(()=>import("./Pattern.glsl-bccb95a0.js"),[],import.meta.url));const pft={factor:1,units:1};let Vn=class extends Uo{constructor(){super(...arguments),this.output=N.Color,this.cullFace=pi.None,this.transparencyPassType=ot.NONE,this.hasSlicePlane=!1,this.hasVertexColors=!1,this.polygonOffset=!1,this.writeDepth=!0,this.hasOccludees=!1,this.enableOffset=!0,this.hasMultipassTerrain=!1,this.cullAboveGround=!1,this.vvColor=!1}};u([B({count:N.COUNT})],Vn.prototype,"output",void 0),u([B({count:pi.COUNT})],Vn.prototype,"cullFace",void 0),u([B({count:mo.COUNT})],Vn.prototype,"style",void 0),u([B({count:ot.COUNT})],Vn.prototype,"transparencyPassType",void 0),u([B()],Vn.prototype,"hasSlicePlane",void 0),u([B()],Vn.prototype,"hasVertexColors",void 0),u([B()],Vn.prototype,"polygonOffset",void 0),u([B()],Vn.prototype,"writeDepth",void 0),u([B()],Vn.prototype,"hasOccludees",void 0),u([B()],Vn.prototype,"patternSpacing",void 0),u([B()],Vn.prototype,"lineWidth",void 0),u([B()],Vn.prototype,"enableOffset",void 0),u([B()],Vn.prototype,"draped",void 0),u([B()],Vn.prototype,"hasMultipassTerrain",void 0),u([B()],Vn.prototype,"cullAboveGround",void 0),u([B()],Vn.prototype,"vvColor",void 0),u([B({constValue:!1})],Vn.prototype,"hasVvInstancing",void 0),u([B({constValue:!1})],Vn.prototype,"vvSize",void 0),u([B({constValue:!1})],Vn.prototype,"vvOpacity",void 0);const sAe=new Map([[E.POSITION,0],[E.COLOR,3],[E.UVMAPSPACE,4],[E.COLORFEATUREATTRIBUTE,5],[E.BOUNDINGRECT,6]]);let _J=class extends KY{constructor(e){super(e,new gft),this.supportsEdges=!0,this._vertexAttributeLocations=sAe,this._configuration=new Vn}getConfiguration(e,r){return this._configuration.output=e,this._configuration.cullFace=this.parameters.cullFace,this._configuration.hasVertexColors=this.parameters.hasVertexColors&&!this.parameters.vvColor,this._configuration.hasSlicePlane=this.parameters.hasSlicePlane,this._configuration.polygonOffset=this.parameters.polygonOffset,this._configuration.writeDepth=this.parameters.writeDepth,this._configuration.style=this.parameters.style,this._configuration.patternSpacing=this.parameters.patternSpacing,this._configuration.lineWidth=this.parameters.lineWidth,this._configuration.draped=this.parameters.draped,this._configuration.transparencyPassType=r.transparencyPassType,this._configuration.enableOffset=r.camera.relativeElevation<u6,this._configuration.hasMultipassTerrain=r.multipassTerrain.enabled,this._configuration.cullAboveGround=r.multipassTerrain.cullAboveGround,this._configuration.vvColor=!!this.parameters.vvColor,this._configuration}requiresSlot(e,r){return r===N.Color||r===N.Alpha||r===N.Highlight||r===N.Depth&&this.parameters.writeLinearDepth?e===ue.DRAPED_MATERIAL?!0:r===N.Highlight?e===ue.OPAQUE_MATERIAL:e===(this.parameters.writeDepth?ue.TRANSPARENT_MATERIAL:ue.TRANSPARENT_DEPTH_WRITE_DISABLED_MATERIAL):!1}createGLMaterial(e){return new fft(e)}createBufferWriter(){const e=zi().vec3f(E.POSITION).vec4f(E.UVMAPSPACE);return this.parameters.draped||e.mat3f(E.BOUNDINGRECT),this.parameters.vvColor?e.f32(E.COLORFEATUREATTRIBUTE):e.vec4u8(E.COLOR),new mft(e)}},fft=class extends K_{_updateParameters(e){return this.ensureTechnique(rAe,e)}_updateOccludeeState(e){e.hasOccludees!==this._material.parameters.hasOccludees&&this._material.setParameters({hasOccludees:e.hasOccludees})}beginSlot(e){return this._output!==N.Color&&this._output!==N.Alpha||this._updateOccludeeState(e),this._updateParameters(e)}},mft=class extends TE{write(e,r,i,s,n){for(const o of this.vertexBufferLayout.fields.keys()){const a=i.vertexAttributes.get(o),l=i.indices.get(o);if(a&&l)switch(o){case E.UVMAPSPACE:{et(a.size===4);const c=s.getField(o,cp);c&&I2(l,a.data,c,n);break}case E.BOUNDINGRECT:{et(a.size===9);const c=s.getField(o,U_);c&&this.writeBoundingRect(l,a.data,e,c,n);break}default:OSe(o,a,l,e,r,s,n)}}}writeBoundingRect(e,r,i,s,n){const o=i,a=s.typedBuffer,l=s.typedBufferStride,c=e.length;n*=l;for(let h=0;h<c;++h){const p=9*e[h],f=r[p],m=r[p+1],y=r[p+2];a[n]=o[0]*f+o[4]*m+o[8]*y+o[12],a[n+1]=o[1]*f+o[5]*m+o[9]*y+o[13],a[n+2]=o[2]*f+o[6]*m+o[10]*y+o[14];for(let _=3;_<9;++_)a[n+_]=r[p+_];n+=l}}},gft=class extends aP{constructor(){super(...arguments),this.color=Lt(1,1,1,1),this.writeDepth=!0,this.writeLinearDepth=!1,this.hasVertexColors=!1,this.polygonOffset=!1,this.hasSlicePlane=!1,this.cullFace=pi.None,this.hasOccludees=!1,this.style=mo.Cross,this.patternSpacing=10,this.lineWidth=1,this.draped=!0}};function yft(t,e){const r=t?.pattern??null;return r==null?new Tae(e):r.style==="none"||r.style==="solid"?(r.style==="none"&&(e.color=Lt(0,0,0,0),e.transparent=!0),new Tae(e)):(e.style=_ft(r.style),new _J(e))}function _ft(t){switch(t){case"horizontal":return mo.Horizontal;case"vertical":return mo.Vertical;case"cross":return mo.Cross;case"forward-diagonal":return mo.ForwardDiagonal;case"backward-diagonal":return mo.BackwardDiagonal;case"diagonal-cross":return mo.DiagonalCross;default:return}}function vft(t){return t.material instanceof _J&&!t.material.parameters.draped}function bft(t,e){if(vft(t)){const r=t.vertexAttributes.get(E.POSITION).data,i=t.getMutableAttribute(E.UVMAPSPACE).data,s=t.getMutableAttribute(E.BOUNDINGRECT).data;KCe(i,s,r,e)}}function wft(t,e,r,i,s){const n=d2e(t,e,r,i,s),o=t.stageObject.geometries;for(const a of o)bft(a,s);return n}const xft=["polyline","polygon","extent"],Eae=new oP({size:!1,color:!0,rotation:!1,opacity:!1});let nAe=class oAe extends om{constructor(e,r,i,s){super(e,r,i,s),this._needsUV=!1,this._hasOutline=!1}async doLoad(){this._fastUpdates=$2(this._context.renderer,Eae)}_ensureMaterials(){this._ensureFillMaterial(),this._ensureOutlineMaterial()}_ensureFillMaterial(){if(this._material!=null)return;const e=this.symbolLayer?.material?.color,r=this._getCombinedOpacityAndColor(e);this._material=yft(this.symbolLayer,{color:r,transparent:r[3]<1||this.needsDrivenTransparentPass,polygonOffset:!1,hasVertexColors:!0,writeLinearDepth:!0,draped:this.draped,hasSlicePlane:this._context.slicePlaneEnabled,...this._fastUpdates?.materialParameters}),this._needsUV=this._material instanceof _J,this._context.stage.add(this._material)}_ensureOutlineMaterial(){const e=this.symbolLayer.outline;if(this._outlineMaterial||!this._isValidOutline(e))return;this._hasOutline=!0;const r=i=>{const s=fCe(e.pattern);return new dS({width:i,color:this._getOutlineColor(),hasPolygonOffset:!0,hasSlicePlane:this._context.slicePlaneEnabled,isClosed:!0,stipplePattern:s,stippleScaleWithLineWidth:!0,cap:bH(e.patternCap||"butt")})};this._outlineMaterial=r(Ms(e.size)),this._context.stage.add(this._outlineMaterial)}_isValidOutline(e){return e!=null&&e.size!=null&&e.size>0&&e.color!=null&&(e.pattern==null||e.pattern.type!=="style"||e.pattern.style!=="none")}destroy(){super.destroy(),this._context.stage.remove(this._material),this._material=null,this._context.stage.remove(this._outlineMaterial),this._outlineMaterial=null}createGraphics3DGraphic(e){const r=e.graphic;if(!this._validateGeometry(r.geometry,xft,this.symbolLayer.type))return null;const i=this._getVertexOpacityAndColor(e.renderingInfo,255),s=this.setGraphicElevationContext(r,new mp);return this.ensureDrapedStatus(s.mode==="on-the-ground"),this._ensureMaterials(),this.draped?this._createAsOverlay(r,i):this._createAs3DShape(r,i,s)}applyRendererDiff(e,r){for(const i in e.diff){if(i!=="visualVariables"||!L2(this._fastUpdates,r,Eae))return Is.RecreateSymbol;this._material&&this._material.setParameters(this._fastUpdates.materialParameters)}return Is.FastUpdate}layerOpacityChanged(){if(this._material!=null){const e=this._material.parameters.color,r=this.symbolLayer?.material?.color,i=this._getCombinedOpacity(r);this._material.setParameters({color:[e[0],e[1],e[2],i],transparent:i<1||this.needsDrivenTransparentPass})}if(this._outlineMaterial!=null){const e=this._outlineMaterial.parameters.color;this._outlineMaterial.setParameters({color:[e[0],e[1],e[2],this._getOutlineOpacity()]})}}layerElevationInfoChanged(e,r,i){const s=this._elevationContext.mode,n=lP(oAe.elevationModeChangeTypes,i,s);if(n!==ns.UPDATE)return n;const o=Nh(s);return this.updateGraphics3DGraphicElevationInfo(e,r,()=>o)}slicePlaneEnabledChanged(){if(this._material&&this._material.setParameters({hasSlicePlane:this._context.slicePlaneEnabled}),this._outlineMaterial){const e={hasSlicePlane:this._context.slicePlaneEnabled};this._outlineMaterial.setParameters(e)}return!0}physicalBasedRenderingChanged(){return!0}_createAs3DShape(e,r,i){const s=nR(e.geometry);if(!s)return null;const n=lJ(s,this._context.elevationProvider,this._context.renderCoordsHelper,i),o=new Tft(n,r,this._context.layer.uid,e.uid),a=o.renderData.position.length/3;if(this._needsUV&&(o.uvMapSpace=Yi(4*a,!0),o.boundingRect=Bo(9*a,!0),KCe(o.uvMapSpace,o.boundingRect,o.renderData.position,this._context.renderCoordsHelper)),o.objectAndLayerIdColor=this._context.stage.renderView?.getObjectAndLayerIdColor(o),this._createAs3DShapeFill(e,o),this._hasOutline&&this._createAs3DShapeOutline(o),this._logGeometryCreationWarnings(o.renderData,s.rings,"rings","FillSymbol3DLayer"),o.outGeometries.length===0)return null;const l=new ay({geometries:o.outGeometries,castShadow:!1,layerUid:this._context.layer.uid,graphicUid:e.uid}),c=new nm(this,l,o.outGeometries,null,null,wft,i);return c.alignedSampledElevation=o.renderData.sampledElevation,c.needsElevationUpdates=Nh(i.mode),c}_createAs3DShapeFill(e,r){const i=r.renderData.polygons;for(const{position:s,mapPositions:n,holeIndices:o,index:a,count:l}of i){if(this._context.clippingExtent!=null&&(xi(Kh),nu(Kh,n),!Gd(Kh,this._context.clippingExtent)))continue;const c=N2(n,o,3);if(c.length===0)continue;const h=this._fastUpdates?.visualVariables.color,p=qne({material:this._material,indices:c,mapPositions:n,attributeData:{position:s,color:h?null:r.color,colorFeature:h?tp(h.field,e):null,uvMapSpace:this._needsUV?a4(r.uvMapSpace,4*a,4*l):null,boundingRect:this._needsUV?wh(r.boundingRect,9*a,9*l):null,objectAndLayerIdColor:r.objectAndLayerIdColor}});r.outGeometries.push(p)}}_createAs3DShapeOutline(e){if(!this._hasOutline)return;const r=e.renderData.outlines;for(let i=0;i<r.length;++i){const{mapPositions:s,position:n}=r[i];if(this._context.clippingExtent!=null&&(xi(Kh),nu(Kh,s),!Gd(Kh,this._context.clippingExtent)))continue;const o=wH(this._outlineMaterial,{overlayInfo:null,removeDuplicateStartEnd:!0,mapPositions:s,attributeData:{position:n}},e.objectAndLayerIdColor);e.outGeometries.push(o)}}_createAsOverlay(e,r){const i=nR(e.geometry);if(i==null)return null;this._material.renderPriority=this._renderPriority+this._renderPriorityStep/2,this._outlineMaterial!=null&&(this._outlineMaterial.renderPriority=this._renderPriority);const s=GEe(i,this._context.overlaySR),n=new Sft(s,r,this._context.layer.uid,e.uid),o=n.renderData.position.length/3;return this._needsUV&&(n.uvMapSpace=Yi(4*o,!0),eft(n.uvMapSpace,n.renderData.position,this._context.overlaySR,this._context.graphicsCoreOwner.view.state.viewingMode)),n.outBoundingBox=xi(),n.objectAndLayerIdColor=this._context.stage.renderView?.getObjectAndLayerIdColor(n),this._createAsOverlayFill(e,n),this._hasOutline&&this._createAsOverlayOutline(n),this._logGeometryCreationWarnings(n.renderData,i.rings,"rings","FillSymbol3DLayer"),n.outGeometries.length===0?null:new S6(this,n.outGeometries,n.outBoundingBox,this._context.drapeSourceRenderer)}_createAsOverlayFill(e,r){const i=r.renderData.polygons;for(const{position:s,holeIndices:n,index:o,count:a}of i){const l=xi(Kh);if(nu(l,s),!Gd(l,this._context.clippingExtent))continue;const c=N2(s,n,3);if(c.length===0)continue;n2(r.outBoundingBox,l);const h=this._fastUpdates?.visualVariables.color,p=qne({material:this._material,indices:c,attributeData:{position:s,color:h?null:r.color,colorFeature:h?tp(h.field,e):null,uvMapSpace:this._needsUV?a4(r.uvMapSpace,4*o,4*a):null,objectAndLayerIdColor:r.objectAndLayerIdColor}});r.outGeometries.push(new k2(p,r))}}_createAsOverlayOutline(e){if(!this._hasOutline)return;const r=e.renderData.outlines;for(let i=0;i<r.length;++i){const{position:s}=r[i];if(xi(Kh),nu(Kh,s),!Gd(Kh,this._context.clippingExtent))continue;n2(e.outBoundingBox,Kh);const n=wH(this._outlineMaterial,{overlayInfo:{spatialReference:this._context.overlaySR,renderCoordsHelper:this._context.renderCoordsHelper},removeDuplicateStartEnd:!0,attributeData:{position:s}},e.objectAndLayerIdColor);e.outGeometries.push(new k2(n,e))}}_getOutlineOpacity(){const e=this.symbolLayer?.outline?.color;return(this.draped?1:this._getLayerOpacity())*(e!=null?e.a:0)}_getOutlineColor(){const e=this.symbolLayer?.outline?.color,r=this._getOutlineOpacity();return J3(e!=null?ze.toUnitRGB(e):null,r)}test(){return{...super.test(),createAsOverlay:(e,r)=>this._createAsOverlay(e,r),createAs3DShape:(e,r,i)=>this._createAs3DShape(e,r,i)}}};nAe.elevationModeChangeTypes={definedChanged:ns.RECREATE,staysOnTheGround:ns.NONE,onTheGroundChanged:ns.RECREATE};const Kh=pn();let Tft=class extends v6{constructor(e,r,i,s){super(e,i,s),this.color=r}},Sft=class extends v6{constructor(e,r,i,s){super(e,i,s),this.color=r}};const Eft="arial-unicode-ms",Cae="woff2",Aae=new Map,aAe=new Set;let Cft=class{constructor(e,r){this.fontFace=e,this.promise=r}};async function Aft(t){const e=Pft(t),r=Aae.get(e);if(r)return r.promise;const i=new FontFace(t.family,`url('${Ur.fontsUrl}/woff2/${e}.${Cae}') format('${Cae}')`,{style:t.style,weight:t.weight}),s=document.fonts;if(s.has(i)&&i.status==="loading")return i.loaded;const n=i.load().then(()=>(s.add(i),i));return Aae.set(e,new Cft(i,n)),aAe.add(i),n}function Oft(t){return aAe.has(t)}function Rft(t){if(!t)return Eft;const e=t.toLowerCase().split(" ").join("-");switch(e){case"serif":return"noto-serif";case"sans-serif":return"arial-unicode-ms";case"monospace":return"ubuntu-mono";case"fantasy":return"cabin-sketch";case"cursive":return"redressed";default:return e}}function Pft(t){const e=Mft(t)+Ift(t);return Rft(t.family)+(e.length>0?e:"-regular")}function Mft(t){if(!t.weight)return"";switch(t.weight.toLowerCase()){case"bold":case"bolder":return"-bold"}return""}function Ift(t){if(!t.style)return"";switch(t.style.toLowerCase()){case"italic":case"oblique":return"-italic"}return""}let lAe=class cAe{constructor(e){this.definition=e,this.key=JSON.stringify(e),this.haloSize=Math.round(e.halo.size),this.textStyle=this._colorToRGBA(e.color),this.haloStyle=this._colorToRGB(e.halo.color),this.backgroundStyle=e.background.color[3]!==0?this._colorToRGBA(e.background.color):null}fontString(e){const r=this.definition.font;return`${r.style} ${r.weight} ${e}px ${r.family}, sans-serif`}_colorToRGB(e){return`rgb(${e.slice(0,3).map(r=>Math.floor(255*r)).toString()})`}_colorToRGBA(e){return`rgba(${e.slice(0,3).map(r=>Math.floor(255*r)).toString()},${e[3]})`}static async fromSymbol(e,r){const i=e?.material?.color,s=ze.toUnitRGBA(i)??Of,n=e.size!=null?Ms(e.size):12,o=e.lineHeight,a=e.background!=null?ze.toUnitRGBA(e.background.color):Of,l={family:e.font?.family??"sans-serif",decoration:e.font?.decoration??"none",weight:e.font?.weight??"normal",style:e.font?.style??"normal"},c=e.halo,h=c!=null&&c.color!=null&&c.size>0?{size:Ms(c.size),color:ze.toUnitRGBA(c.color)}:{size:0,color:Of},p=new cAe({color:s,size:n,background:{color:a,padding:e.background!=null?[.65*n,.5*n]:[0,0],borderRadius:e.background!=null?n*(6/16):0},lineSpacingFactor:o,font:l,halo:h,pixelRatio:r});if(e.font){let f=!1;const m=p.fontString(n);try{f=(await document.fonts.load(m)).some(y=>!Oft(y))}catch{Q.getLogger("esri.views.3d.webgl-engine.lib.TextRenderParameters").warnOnce(`Failed to preload font '${m}'. Some text symbology may be rendered using the default browser font.`)}if(!f&&!$ft.has(e.font.family))try{await Aft(e.font)}catch{}}return p}};const $ft=new Set(["Arial","Times New Roman","Courier New","serif","sans-serif","monospace","cursive","fantasy","system-ui","ui-serif","ui-sans-serif","ui-monospace","ui-rounded","math","emoji","fangsong"]);let Lft=class{constructor(e,r,i){this._renderer=new oCe(e,r,i)}get key(){return this._renderer.key}get baselineAnchorY(){return 1-this._renderer.firstRenderedBaselinePosition/this._renderer.renderedHeight}get displayWidth(){return this._renderer.displayWidth}get displayHeight(){return this._renderer.displayHeight}create(){const e=_H(Dft,this._renderer.renderedWidth,this._renderer.renderedHeight),r=e.getContext("2d");return r.save(),this._renderer.render(r,0,0),r.restore(),new zw(e,{wrap:{s:$t.CLAMP_TO_EDGE,t:$t.CLAMP_TO_EDGE},noUnpackFlip:!1,mipmap:!0,preMultiplyAlpha:!0})}};const Dft={canvas:null},Nft=[0,0,1];let Fft=class extends om{constructor(e,r,i,s){super(e,r,i,s),this._elevationOptions={supportsOffsetAdjustment:!0,supportsOnTheGround:!1},this.ensureDrapedStatus(!1)}async doLoad(){if(!this._drivenProperties.size){const e=p6(this.symbolLayer.size);if(e)throw new F("graphics3dtextsymbollayer:invalid-size",e)}await this._createTextRenderParameters()}async _createTextRenderParameters(){const e=this._context.graphicsCoreOwner.view.state.rasterPixelRatio;this._textRenderParameters=await lAe.fromSymbol(this.symbolLayer,e)}destroy(){super.destroy()}createGraphics3DGraphic(e){const r=e.graphic,i=sR(r.geometry);if(i==null)return this.logger.warn(`unsupported geometry type for text symbol: ${r.geometry.type}`),null;const s=this.symbolLayer.text;if(s==null||s==="")return null;const n=ZW(this.symbol)&&this.symbol.hasVisibleVerticalOffset()?this.symbol.verticalOffset:null;if(n!=null&&!Qge(this.symbolLayer))return this.logger.errorOncePerTick(`Callouts and vertical offset on text symbols are currently only supported with 'center' horizontal alignment (not with '${this.symbolLayer.horizontalAlignment}' alignment)`),null;const o=new c2e(n,this.symbolLayer.horizontalAlignment,Eut(this.symbolLayer.verticalAlignment));return this._createAs3DShape(r,i,s,o)}createLabel(e,r,i,s){const n=e.graphic,o=sR(n.geometry);if(o==null)return this.logger.warn(`unsupported geometry type for label: ${n.geometry.type}`),null;const a=r.text;return!a||/^\s+$/.test(a)?null:this._createAs3DShape(n,o,a,r,i,s)}setGraphicElevationContext(e,r,i=0){const s=super.setGraphicElevationContext(e,r);return s.addOffsetRenderUnits(i),s}layerOpacityChanged(){return this.logger.warn("layer opacity change not yet implemented in Graphics3DTextSymbolLayer"),!1}layerElevationInfoChanged(e,r){return Oae(e,r,(i,s)=>{this.updateGraphicElevationContext(s,i)}),ns.UPDATE}slicePlaneEnabledChanged(e,r){return Oae(e,r,i=>{for(const s of i.stageObject.geometries)s.material.setParameters({hasSlicePlane:this._context.slicePlaneEnabled})}),!0}physicalBasedRenderingChanged(){return!0}get pixelRatioChanged(){return!1}updateGraphicElevationContext(e,r){const i=r.elevationContext;this.setGraphicElevationContext(e,i,r.metadata!=null?r.metadata.elevationOffset:0),r.needsElevationUpdates=Nh(i.mode)||i.mode==="absolute-height"}_defaultElevationInfoNoZ(){return kft}_createAs3DShape(e,r,i,s,n,o){const a=this.setGraphicElevationContext(e,new mp,s.elevationOffset),l=e.geometry?.type==="polyline",c=e.uid;let h=null,p=null;if(o==null){const M=lCe(s.horizontalPlacement);h=new Lft(i,M,this._textRenderParameters);let k=null;if(this._context.sharedResources.textures!=null){p=this._context.sharedResources.textures.fromData(h.key,()=>h.create(),()=>{k?.release()});const L=this._context.stage.renderView.textureRepository.acquire(p.texture.id);if(L==null||bu(L))return p.release(),null;k=L}}const f=Uft(h,s),m={occlusionTest:!0,screenOffset:s.screenOffset,anchorPosition:f,polygonOffset:!0,color:[1,1,1,1],centerOffsetUnits:s.centerOffsetUnits,drawInSecondSlot:!0};if(o!=null?m.textureId=o.id:p!=null&&(m.textureId=p.texture.id),s.verticalOffset!=null){const{screenLength:M,minWorldLength:k,maxWorldLength:L}=s.verticalOffset;m.verticalOffset={screenLength:Ms(M),minWorldLength:k||0,maxWorldLength:L??1/0}}if(this._context.screenSizePerspectiveEnabled){const{screenSizePerspectiveSettings:M,screenSizePerspectiveSettingsLabels:k}=this._context.sharedResources;m.screenSizePerspective=k.overridePadding(this._textRenderParameters.haloSize+this._textRenderParameters.definition.background.padding[0]),m.screenSizePerspectiveAlignment=M}let y;if(l&&(m.shaderPolygonOffset=1e-4),m.hasSlicePlane=this._context.slicePlaneEnabled,n!=null){const M=JSON.stringify(m);y=n.get(M),y==null&&(y=new D2(m),n.add(M,y))}else y=new D2(m);const _=s.translation,v=h?dr(h.displayWidth,h.displayHeight):ap,w=s.centerOffset,x=Pj(y,Nft,_,null,v,w,[0,0],null),T=VY(this._context,r,x,a,c);if(T==null)return null;const S=new nm(this,T.object,[x],n==null?[y]:null,p,$b,a);S.alignedSampledElevation=T.sampledElevation,S.needsElevationUpdates=Nh(a.mode)||a.mode==="absolute-height";const{displayWidth:O,displayHeight:A}=h??s;S.getScreenSize=(M=Ve())=>(M[0]=O,M[1]=A,M);const I=new v2e(s.elevationOffset,i);return S.metadata=I,iR(S,r,this._context.elevationProvider),S}};function Oae(t,e,r){t&&t.forEach(i=>{const s=e(i);s!=null&&r(s,i.graphic)})}function Uft(t,e){if(e.verticalPlacement==="baseline"){const i=xut[e.horizontalPlacement],s=t!=null?t.baselineAnchorY:0;return dr(i,s)}const r=Sut(e.horizontalPlacement,e.verticalPlacement);return hD[r]}const kft={mode:"relative-to-ground",offset:0},Vft={"calm-small":{waveStrength:.005,perturbationStrength:.02,textureRepeat:12,waveVelocity:.01},"rippled-small":{waveStrength:.02,perturbationStrength:.09,textureRepeat:32,waveVelocity:.07},"slight-small":{waveStrength:.05,perturbationStrength:.07,textureRepeat:28,waveVelocity:.1},"moderate-small":{waveStrength:.075,perturbationStrength:.07,textureRepeat:24,waveVelocity:.1},"calm-medium":{waveStrength:.003125,perturbationStrength:.01,textureRepeat:8,waveVelocity:.02},"rippled-medium":{waveStrength:.035,perturbationStrength:.015,textureRepeat:12,waveVelocity:.07},"slight-medium":{waveStrength:.06,perturbationStrength:.015,textureRepeat:8,waveVelocity:.12},"moderate-medium":{waveStrength:.09,perturbationStrength:.03,textureRepeat:4,waveVelocity:.12},"calm-large":{waveStrength:.01,perturbationStrength:0,textureRepeat:4,waveVelocity:.05},"rippled-large":{waveStrength:.025,perturbationStrength:.01,textureRepeat:8,waveVelocity:.11},"slight-large":{waveStrength:.06,perturbationStrength:.02,textureRepeat:3,waveVelocity:.13},"moderate-large":{waveStrength:.14,perturbationStrength:.03,textureRepeat:2,waveVelocity:.15}},zft=["polyline","polygon","extent"];let EH=class k1 extends om{constructor(e,r,i,s){super(e,r,i,s)}async doLoad(){}destroy(){super.destroy(),this._context.stage.remove(this._material),this._material=null}createGraphics3DGraphic(e){const r=e.graphic;if(!this._validateGeometry(r.geometry,zft,this.symbolLayer.type))return null;const i=this.setGraphicElevationContext(r,new mp);return this.ensureDrapedStatus(i.mode==="on-the-ground"),this.ensureMaterial(),this.draped?this._createAsOverlay(r):this._createAs3DShape(r,i,r.uid)}ensureMaterial(){if(this._material!=null)return;const e=new $Ee,r=this.symbolLayer.color;r!=null&&(e.color=ze.toUnitRGBA(r));const i=this._getCombinedOpacity(r,{hasIntrinsicColor:!0});e.color=[e.color[0],e.color[1],e.color[2],i],e.transparent=i<1||this.needsDrivenTransparentPass,e.waveDirection=this.symbolLayer.waveDirection!=null?k1.headingVectorFromAngle(this.symbolLayer.waveDirection):dr(0,0);const s=this.symbolLayer.waveStrength+"-"+this.symbolLayer.waterbodySize,n=Vft[s];e.waveStrength=n.waveStrength,e.waveTextureRepeat=n.textureRepeat,e.waveVelocity=n.waveVelocity,e.flowStrength=n.perturbationStrength,e.hasSlicePlane=this._context.slicePlaneEnabled,e.isDraped=this.draped,this._material=new IEe(e),this._context.stage.add(this._material)}layerOpacityChanged(){if(this._material==null)return;const e=this._material.parameters.color,r=this._getCombinedOpacity(this.symbolLayer.color,{hasIntrinsicColor:!0}),i=r<1||this.needsDrivenTransparentPass;this._material.setParameters({color:[e[0],e[1],e[2],r],transparent:i})}layerElevationInfoChanged(e,r,i){const s=this._elevationContext.mode,n=lP(k1.elevationModeChangeTypes,i,s);if(n!==ns.UPDATE)return n;const o=Nh(s);return this.updateGraphics3DGraphicElevationInfo(e,r,()=>o)}slicePlaneEnabledChanged(){return this._material!=null&&this._material.setParameters({hasSlicePlane:this._context.slicePlaneEnabled}),!0}physicalBasedRenderingChanged(){return!0}_createAs3DShape(e,r,i){const s=nR(e.geometry);if(s==null)return null;const n=lJ(s,this._context.elevationProvider,this._context.renderCoordsHelper,r),o=n.position.length/3,a=Bo(2*o);this._createUVCoordsFromVertices(a,n.mapPositions,o,this._context.elevationProvider.spatialReference);const l=new Bft(n,a,this._context.layer.uid,e.uid);if(l.objectAndLayerIdColor=this._context.stage.renderView?.getObjectAndLayerIdColor(l),this._create3DShapeGeometries(l),this._logGeometryCreationWarnings(l.renderData,s.rings,"rings","WaterSymbol3DLayer"),l.outGeometries.length===0)return null;const c=new ay({geometries:l.outGeometries,castShadow:!1,layerUid:this._context.layer.uid,graphicUid:i}),h=new nm(this,c,l.outGeometries,null,null,d2e,r);return h.alignedSampledElevation=l.renderData.sampledElevation,h.needsElevationUpdates=Nh(r.mode),h}_createUVCoordsFromVertices(e,r,i,s){const n=Za(s);wc(Vy);for(let l=0;l<i;l++)or(Rae,r[3*l],r[3*l+1]),TS(Vy,Rae);Zb(Vy,Vy,n);const o=Vy[0]%k1.unitSizeOfTexture,a=Vy[1]%k1.unitSizeOfTexture;YI[0]=Vy[0]-o,YI[1]=Vy[1]-a;for(let l=0;l<i;l++)e[2*l]=(r[3*l]*n-YI[0])/k1.unitSizeOfTexture,e[2*l+1]=(r[3*l+1]*n-YI[1])/k1.unitSizeOfTexture}_create3DShapeGeometries(e){const r=e.renderData.polygons,i=e.uvCoords;for(const{count:s,index:n,position:o,mapPositions:a,holeIndices:l}of r){if(this._context.clippingExtent!=null&&(xi(zv),nu(zv,a),!Gd(zv,this._context.clippingExtent)))continue;const c=N2(a,l,3);if(c.length===0)continue;const h=wh(i,2*n,2*s),p=Wne({material:this._material,indices:c,mapPositions:a,attributeData:{position:o,uv0:h}},e.objectAndLayerIdColor);e.outGeometries.push(p)}}_createAsOverlay(e){const r=nR(e.geometry);if(r==null)return null;this._material.renderPriority=this._renderPriority;const i=GEe(r,this._context.overlaySR),s=i.position.length/3,n=Bo(2*s);this._createUVCoordsFromVertices(n,i.position,s,this._context.overlaySR);const o=new Gft(i,n,this._context.layer.uid,e.uid);return o.objectAndLayerIdColor=this._context.stage.renderView?.getObjectAndLayerIdColor(o),o.outBoundingBox=xi(),this._createAsOverlayWater(o),this._logGeometryCreationWarnings(o.renderData,r.rings,"rings","WaterSymbol3DLayer"),o.outGeometries.length===0?null:new S6(this,o.outGeometries,o.outBoundingBox,this._context.drapeSourceRenderer)}_createAsOverlayWater(e){const r=e.uvCoords,i=e.renderData.polygons;for(const{position:s,holeIndices:n,index:o,count:a}of i){if(xi(zv),nu(zv,s),!Gd(zv,this._context.clippingExtent))continue;n2(e.outBoundingBox,zv);const l=N2(s,n,3);if(l.length===0)continue;const c=wh(r,2*o,2*a),h=Wne({material:this._material,indices:l,attributeData:{position:s,uv0:c}},e.objectAndLayerIdColor);e.outGeometries.push(new k2(h,e))}}static headingVectorFromAngle(e){const r=Ve(),i=EF(e);return r[0]=Math.sin(i),r[1]=Math.cos(i),r}test(){return{...super.test(),create3DShape:e=>this._createAs3DShape(e.graphic,e.elevationContext,e.graphicUid),ensureMaterial:()=>this.ensureMaterial()}}};EH.unitSizeOfTexture=100,EH.elevationModeChangeTypes={definedChanged:ns.RECREATE,staysOnTheGround:ns.NONE,onTheGroundChanged:ns.RECREATE};const YI=Ve(),Vy=Ut(),Rae=Ve(),zv=pn();let Bft=class extends v6{constructor(e,r,i,s){super(e,i,s),this.uvCoords=r}},Gft=class extends v6{constructor(e,r,i,s){super(e,i,s),this.uvCoords=r}};function jft(t,e,r,i){const s=qft[t.type]?.[e.type]||Hft[e.type];return s?new s(t,e,r,i):(Q.getLogger("esri.views.3d.layers.graphics.Graphics3DSymbolLayerFactory").error("GraphicsLayerFactory#make",`unknown symbol type ${e.type}`),null)}const Hft={icon:vH,object:Xdt,line:mCe,path:Jpt,fill:nAe,extrude:aut,text:Fft,water:EH},qft={"mesh-3d":{fill:Iht}};let Wft=class extends FY{set symbol(e){this._symbol=e,e.symbolLayers.forEach((r,i)=>{const s=this.symbolLayers[i];s!=null&&(s.symbol=e,s.symbolLayer=r)})}get symbol(){return this._symbol}constructor(e,r,i){super(r.schedule),this._symbol=e,this._context=r,this._backgroundLayers=i,this._destroyed=!1,this.symbolLayers=new Array,this.referenced=0,this._extentPadding=0}async doLoad(e){let r=this._symbol.symbolLayers;this._extentPadding=0,this._backgroundLayers&&(r=this._backgroundLayers.concat(r));const i=r.length;for(;this.symbolLayers.length<r.length;)this.symbolLayers.push(null);this.symbolLayers.length=r.length;const s=[];for(let n=0;n<i;n++){const o=r.at(n);if(o.enabled===!1)continue;JI.renderPriority=1-(1+n)/i,JI.renderPriorityStep=1/i,JI.ignoreDrivers=o.ignoreDrivers;const a=jft(this.symbol,o,this._context,JI),l=wq(e,()=>{this.symbolLayers[n]=null,a.destroy()});l&&s.push(l),this.symbolLayers[n]=a}if(await g5(this.symbolLayers,async(n,o)=>{if(n!=null)try{await n.load(),this._extentPadding+=Math.max(this._extentPadding,n.extentPadding)}catch{this.symbolLayers[o]=null}}),s.forEach(n=>n.remove()),Xt(e),this.symbolLayers.length&&!this.symbolLayers.some(n=>!!n))throw new Error}getSymbolLayerSize(e){const r=this.symbolLayers[e];return r!=null?r.getCachedSize():null}get extentPadding(){return this._extentPadding}get symbologySnappingSupported(){return this.symbolLayers.some(e=>e!=null&&e.queryForSnapping)}createGraphics3DGraphic(e,r){const i=e.graphic,s=this.symbolLayers.map(o=>o?.createGraphics3DGraphic(e)??null),n=this._context.arcade||this._context.featureExpressionInfoContext&&this._context.featureExpressionInfoContext.arcade&&this._context.featureExpressionInfoContext.arcade.modules||null;return new Oat(i,r||this,s,e.layer,n)}get complexity(){return kY(this.symbolLayers.map(e=>e!=null?e.complexity:null))}globalPropertyChanged(e,r){const i=this.symbolLayers.length;for(let s=0;s<i;s++){const n=this.symbolLayers[s],o=a=>{const l=a.layers[s];return l instanceof nm?l:null};if(n!=null&&!n.globalPropertyChanged(e,r,o))return!1}return!0}applyRendererDiff(e,r){return this.loadStatus!==Qc.LOADED?Is.RecreateSymbol:this.symbolLayers.reduce((i,s)=>i!==Is.RecreateSymbol&&s!=null?Math.min(i,s.applyRendererDiff(e,r)):i,Is.FastUpdate)}prepareSymbolPatch(e){if(this.loadStatus===Qc.FAILED||e.diff.type!=="partial")return;const r=e.diff.diff;if(!r.symbolLayers||r.symbolLayers.type!=="partial")return;const i=r.symbolLayers.diff;this.symbolLayers.forEach((s,n)=>{if(s==null)return;const o=i[n];if(o){const a={diff:o,graphics3DGraphicPatches:[],symbolLayerStatePatches:[]};s.prepareSymbolLayerPatch(a),e.symbolStatePatches.push(...a.symbolLayerStatePatches),a.graphics3DGraphicPatches.length&&e.graphics3DGraphicPatches.push((l,c)=>{const h=l.layers[n];h!=null&&a.graphics3DGraphicPatches.forEach(p=>p(h,c))})}})}updateGeometry(e,r){return this._updateGeometryOrTransform(e,(i,s)=>i.updateGeometry(s,r))}updateTransform(e,r,i,s){return this._updateGeometryOrTransform(e,(n,o)=>n.updateTransform(o,r,i,s))}_updateGeometryOrTransform(e,r){for(let i=0;i<this.symbolLayers.length;i++){const s=this.symbolLayers[i];if(s==null)continue;const n=e.layers[i];if(!n||!r(s,n))return!1}return!0}onRemoveGraphic(e){for(let r=0;r<this.symbolLayers.length;r++){const i=this.symbolLayers[r];if(i==null)continue;const s=e.layers[r];s!=null&&i.onRemoveGraphic(s)}}getFastUpdateStatus(){let e=0,r=0,i=0;return this.symbolLayers.forEach(s=>{s!=null&&(s.loadStatus===Qc.LOADING?e++:s.isFastUpdatesEnabled()?i++:r++)}),{loading:e,slow:r,fast:i}}async queryForSnapping(e,r,i,s){const n=this.symbolLayers.filter(xw).filter(a=>a.queryForSnapping!=null).map(a=>a.queryForSnapping(e,r,i,s)),o=await Promise.all(n);return Xt(s),o.flat()}destroy(){if(this.destroyed)console.error("Graphics3DSymbol.destroy called when already destroyed!");else{super.destroy();for(const e of this.symbolLayers)e?.destroy();this.symbolLayers.length=0,this._destroyed=!0}}get destroyed(){return this._destroyed}};const JI=new Rat;let Zft=class extends FY{constructor(e,r,i){super(r),this.symbol=e,this._convert=i,this.symbologySnappingSupported=!1,this.graphics3DSymbol=null,this.referenced=0}getSymbolLayerSize(e){return this.graphics3DSymbol!=null?this.graphics3DSymbol.getSymbolLayerSize(e):null}get symbolLayers(){return this.graphics3DSymbol!=null?this.graphics3DSymbol.symbolLayers:[]}get extentPadding(){return this.graphics3DSymbol!=null?this.graphics3DSymbol.extentPadding:0}async doLoad(e){const r=await this.symbol.fetchSymbol({signal:e});r.id=this.symbol.id,this.graphics3DSymbol=this._convert(r),this.graphics3DSymbol!=null&&await this.graphics3DSymbol.load()}createGraphics3DGraphic(e){return this.graphics3DSymbol!=null?this.graphics3DSymbol.createGraphics3DGraphic(e,this):null}get complexity(){return this.graphics3DSymbol!=null?this.graphics3DSymbol.complexity:UY}globalPropertyChanged(e,r){return this.graphics3DSymbol!=null&&this.graphics3DSymbol.globalPropertyChanged(e,r)}applyRendererDiff(e,r){return this.graphics3DSymbol!=null?this.graphics3DSymbol.applyRendererDiff(e,r):Is.RecreateSymbol}prepareSymbolPatch(e){this.graphics3DSymbol!=null&&this.graphics3DSymbol.prepareSymbolPatch(e)}updateGeometry(e,r){return this.graphics3DSymbol!=null&&this.graphics3DSymbol.updateGeometry(e,r)}updateTransform(e,r,i,s){return this.graphics3DSymbol?.updateTransform(e,r,i,s)??!1}onRemoveGraphic(){}getFastUpdateStatus(){return this.graphics3DSymbol!=null?this.graphics3DSymbol.getFastUpdateStatus():{loading:1,fast:0,slow:0}}destroy(){this.graphics3DSymbol!=null&&this.graphics3DSymbol.destroy(),this.graphics3DSymbol=void 0,super.destroy()}get destroyed(){return this.graphics3DSymbol===void 0}};function vJ(t){return t instanceof Zft?t.graphics3DSymbol:t instanceof Wft?t:null}const lR=Q.getLogger("esri.views.3d.layers.graphics.labelPlacement");function Xft(t){const e=smt(t);if(e==null)return null;const r=Yft(t,e);if(r==null)return null;const i=r.anchor,s=!!e.hasLabelVerticalOffset;return Qft({anchor:i,verticalOffset:e.verticalOffset,screenOffset:Ve(),centerOffset:Lt(0,0,0,-1),centerOffsetUnits:"world",translation:C(),elevationOffset:0,hasLabelVerticalOffset:s},r,t)}function Yft(t,e){if(e.anchor)return e;const r=t.labelClass.labelPlacement,i=Zd[r],s=i||G4(t);return r&&!i&&lR.warnOncePerTick(`the requested label placement '${r}' is currently unsupported in SceneView.`),Jft(s,t)}function bJ(t){const e=t.graphics3DGraphic.graphics3DSymbol,r=vJ(e);return r!=null?r.symbol.symbolLayers.at(0):null}function Jft(t,e){const r=e.graphics3DGraphic.graphic.geometry;if(r==null)return null;if(e.disablePlacement!=null)return e.labelClass.labelPlacement?(lR.warnOncePerTick(Pae(t?.placement,e.disablePlacement.logEntityDescription)),G4(e)):t;const i=r.type;switch(i){case"polyline":case"polygon":case"extent":case"multipoint":if(e.labelClass.labelPlacement)return lR.warnOncePerTick(Pae(t?.placement,`'${i}' geometries`)),G4(e);break;case"point":case"mesh":return t}return t}function Pae(t,e){return`the requested label placement '${t}' is currently unsupported for ${e} in SceneView.`}function G4(t){const e=t.graphics3DGraphic.graphic.geometry;if(e==null)return null;switch(e.type){case"polyline":case"extent":case"multipoint":return{placement:"center-center",normalizedOffset:null,anchor:"center"};case"polygon":{const r=bJ(t);return r!=null&&r.type==="extrude"?Zd["above-center"]:{placement:"center-center",normalizedOffset:null,anchor:"center"}}case"point":case"mesh":return Zd["above-center"];default:return}}function Qft(t,e,r){const i=r.graphics3DGraphic.graphic.geometry;if(i==null)return null;switch(i.type){case"point":emt(t,e,r);break;case"polygon":Kft(t,e,r);break;case"mesh":wJ(t,e,r.graphics3DGraphic.layers[0])}return t}function Kft(t,e,r){const i=bJ(r);if(i!=null)switch(i.type){case"extrude":{const s=r.graphics3DGraphic.layers[0];s!=null?(s.getBoundingBoxObjectSpace(nO),Bd(nO,t.translation),t.translation[2]=Z_(nO)/2):se(t.translation,0,0,0),wJ(t,e,s);break}}}function emt(t,e,r){const i=bJ(r);if(i==null)return;const s=r.graphics3DGraphic.layers[0];switch(s!=null?s.getCenterObjectSpace(t.translation):se(t.translation,0,0,0),i.type){case"icon":case"text":tmt(t,e,r,s);break;case"object":wJ(t,e,s)}}function tmt(t,e,r,i){const{graphics3DGraphic:s}=r,n=i!=null?i.getScreenSize():null;if(s.isDraped||n==null)t.hasLabelVerticalOffset||t.anchor==="center"||(Zd[r.labelClass.labelPlacement]&&lR.warnOncePerTick(`the requested placement '${e.placement}' is currently unsupported for draped graphics`),t.anchor="center");else{const o=rmt(r);t.screenOffset[0]=n[0]/2*(e.normalizedOffset[0]-o[0]);const a=n[1]/2*(e.normalizedOffset[1]-o[1]);t.hasLabelVerticalOffset?(t.centerOffset[1]=a,t.centerOffsetUnits="screen"):t.screenOffset[1]=a}}function rmt(t,e=nmt){const{graphics3DGraphic:r}=t,i=r.layers[0],s=i!=null?i.stageObject.geometries[0].material:null;if(s&&s instanceof D2){const n=s.parameters.anchorPosition;e[0]=2*(n[0]-.5),e[1]=2*(n[1]-.5)}else e[0]=0,e[1]=0;return e}function wJ(t,e,r){const i=r!=null?r.getBoundingBoxObjectSpace(nO):nO,s=Oe(i[3]-i[0],i[4]-i[1],i[5]-i[2]),n=Math.sqrt(s[0]*s[0]+s[1]*s[1]);t.centerOffset[0]=n/2*e.normalizedOffset[0];const o=t.translation[2],a=s[2]/2*e.normalizedOffset[1];t.translation[2]=0,t.elevationOffset=o+a;const l=Ce(s);t.centerOffset[2]=l/2*e.normalizedOffset[2]}function imt(t){return t==="above-center"}function smt(t){const e=t.labelClass.labelPlacement,{labelSymbol:r,graphics3DGraphic:i}=t,s=vJ(i.graphics3DSymbol),n=uc(s,a=>a.symbol.type==="point-3d"?a.symbol:null),o=Zd[e]||G4(t);return n!=null&&n.supportsCallout()&&n.hasVisibleVerticalOffset()&&!i.isDraped?{placement:null,hasLabelVerticalOffset:!1,verticalOffset:Mae(n.verticalOffset),anchor:null,normalizedOffset:null}:!r||!r.hasVisibleVerticalOffset()||n!=null&&n.supportsCallout()&&n.verticalOffset&&!i.isDraped?{placement:null,verticalOffset:null,anchor:null,normalizedOffset:null,hasLabelVerticalOffset:!1}:o&&imt(o.placement)?{placement:"above-center",verticalOffset:Mae(r.verticalOffset),anchor:"bottom",normalizedOffset:[0,o.normalizedOffset[1],0],hasLabelVerticalOffset:!0}:(lR.errorOncePerTick("Callouts and vertical offset on labels are currently only supported with 'above-center' label placement (not with "+e+" placement)"),null)}function Mae(t){const{screenLength:e,minWorldLength:r,maxWorldLength:i}=t;return{screenLength:e,minWorldLength:r,maxWorldLength:i}}const Zd={"above-center":{placement:"above-center",normalizedOffset:[0,1,0],anchor:"bottom"},"above-left":{placement:"above-left",normalizedOffset:[-1,1,0],anchor:"bottom-right"},"above-right":{placement:"above-right",normalizedOffset:[1,1,0],anchor:"bottom-left"},"below-center":{placement:"below-center",normalizedOffset:[0,-1,2],anchor:"top"},"below-left":{placement:"below-left",normalizedOffset:[-1,-1,0],anchor:"top-right"},"below-right":{placement:"below-right",normalizedOffset:[1,-1,0],anchor:"top-left"},"center-center":{placement:"center-center",normalizedOffset:[0,0,1],anchor:"center"},"center-left":{placement:"center-left",normalizedOffset:[-1,0,0],anchor:"right"},"center-right":{placement:"center-right",normalizedOffset:[1,0,0],anchor:"left"}},Iae={"above-center":["default","esriServerPointLabelPlacementAboveCenter"],"above-left":["esriServerPointLabelPlacementAboveLeft"],"above-right":["esriServerPointLabelPlacementAboveRight"],"below-center":["esriServerPointLabelPlacementBelowCenter"],"below-left":["esriServerPointLabelPlacementBelowLeft"],"below-right":["esriServerPointLabelPlacementBelowRight"],"center-center":["esriServerPointLabelPlacementCenterCenter"],"center-left":["esriServerPointLabelPlacementCenterLeft"],"center-right":["esriServerPointLabelPlacementCenterRight"]};for(const t in Iae){const e=Iae[t],r=Zd[t];e.forEach(i=>{Zd[i]=r})}Object.freeze&&(Object.freeze(Zd),Object.keys(Zd).forEach(t=>{Object.freeze(Zd[t]),Object.freeze(Zd[t]?.normalizedOffset)}));const nmt=[0,0],nO=pn();let $ae=class{constructor(e){this._stage=e,this._materials=new Map}get(e){return this._materials.get(e)}add(e,r){this._materials.set(e,r),this._stage.add(r)}dispose(){this._stage.removeMany(Array.from(this._materials.values())),this._materials.clear()}};const QI=4096;let omt=class{constructor(){this.offset={x:0,y:0},this.uvMinMax=Wt()}},amt=class{constructor(e,r){this.textId=e,this.textRenderer=r,this.placement=new omt,this.rendered=!1}},lmt=class{constructor(e,r,i){this.size=e,this.cursor=r,this.lineHeight=i}resize(e){this.size.height=e}resetCursor(){this.cursor.x=oO,this.cursor.y=oO+uAe,this.lineHeight=0}getUsage(){return(this.cursor.x+this.cursor.y*this.size.width)/(this.size.width*this.size.height)}},e3=class extends Te{constructor(e){super(e),this.type=ss.Texture,this.id=gc(),this.events=new os,this._glTexture=null,this._needsClear=!1,this._elementsToAddOrUpdate=new Map,this._elementsToRemove=new Map,this._elementsToRender=new Map,this._elements=new Map,this._stageObjects=new Map,this.updating=!1}initialize(){this._canvas=document.createElement("canvas"),this._canvas.setAttribute("id","textAtlasCanvas"),this._canvas.setAttribute("style","display:none"),this._ctx=this._canvas.getContext("2d"),this._stage=this.view._stage,this._stage.add(this),this._atlas=new lmt({width:QI,height:256},{x:0,y:0},0),this._updateCanvasElementSize(this._atlas),this._resetAtlasCursor()}unload(){this._glTexture=Ue(this._glTexture),this.updating=!1,this.events.emit("unloaded")}get requiresFrameUpdates(){return!1}_createDescriptor(e){const r=new vr;return r.wrapMode=$t.CLAMP_TO_EDGE,r.flipped=!0,r.samplingMode=Ct.LINEAR_MIPMAP_LINEAR,r.hasMipmap=!0,r.preMultiplyAlpha=!0,r.maxAnisotropy=e.parameters.maxMaxAnisotropy,r}get glTexture(){return this._glTexture}load(e){return this._glTexture!=null||(this._glTexture=new Et(e,this._createDescriptor(e),this._canvas),this._frameWorker=this.view.resourceController.scheduler.registerTask(dt.TEXT_TEXTURE_ATLAS,this),this.setDirty()),this._glTexture}dispose(){this._elements=null,this._elementsToAddOrUpdate=null,this._elementsToRemove=null,this._elementsToRender=null,this._frameWorker=Ii(this._frameWorker),this._glTexture&&(this._stage.remove(this),this._glTexture=Ue(this._glTexture)),this._canvas.width=0,this._canvas.height=0,this._canvas=null,this._ctx=null}_updateCanvasElementSize(e){this._canvas.setAttribute("width",e.size.width.toString()),this._canvas.setAttribute("height",e.size.height.toString())}_resizeAtlas(e){this._atlas.resize(e),this._glTexture!=null&&this._glTexture.resize(this._atlas.size.width,e),this._updateCanvasElementSize(this._atlas)}_resetAtlasCursor(){this._atlas.resetCursor(),this._needsClear=!0}_addAtlasElement(e,r,i,s){const n=this._atlas,{renderedWidth:o,renderedHeight:a}=e.textRenderer;e.placement.offset.x=n.cursor.x,e.placement.offset.y=n.cursor.y,bi(e.placement.uvMinMax,e.placement.offset.x/n.size.width,1-(e.placement.offset.y+a)/n.size.height,(e.placement.offset.x+o)/n.size.width,1-e.placement.offset.y/n.size.height),n.cursor.x+=i,n.lineHeight=Math.max(n.lineHeight,s),this._elements.set(r,e)}_removeAtlasElement(e){if(e&&this._elements.has(e.textId)){const r=e.placement.offset;this._ctx.clearRect(r.x,r.y,e.textRenderer.renderedWidth,e.textRenderer.renderedHeight),this._elements.delete(e.textId)}}_ensureStageObjects(e){const r=this._stageObjects.get(e);if(r)return r;const i=new Set;return this._stageObjects.set(e,i),i}_addStageObject(e,r){this._ensureStageObjects(e).add(r)}_removeStageObject(e,r){const i=this._stageObjects.get(e);i&&i.delete(r)&&(r.geometries[0].setAttributeData(E.SIZE,[0,0]),r.geometryVertexAttrsUpdated(r.geometries[0]))}_processAddition(e,r){const i=this._atlas,s=e.textId,n=e.textRenderer.renderedWidth,o=e.textRenderer.renderedHeight,a=n+oO,l=o+oO+uAe;if(i.cursor.x+a<i.size.width&&i.cursor.y+l<i.size.height)this._addAtlasElement(e,s,a,l),this._elementsToRender.set(s,e),this._elementsToAddOrUpdate.delete(s);else{if(!(i.cursor.y+l+i.lineHeight<i.size.height)){const c=i.cursor.y+l+i.lineHeight-i.size.height,h=i.size.height+c<QI;if(h){const p=Math.ceil(i.size.height*Math.max(1.3,(c+i.size.height)/i.size.height));this._resizeAtlas(Math.min(JY(p),QI))}return!r||!h&&i.size.height===QI?(this._processRemovals(),pS.OK):(this._repack(),pS.REPACK)}i.cursor.x=oO,i.cursor.y+=i.lineHeight,i.lineHeight=0,this._addAtlasElement(e,s,a,l),this._elementsToRender.set(s,e),this._elementsToAddOrUpdate.delete(s)}return pS.OK}_processRemovals(){this._elementsToRemove.forEach((e,r)=>{const i=this._stageObjects.get(r);i&&i.size!==0||this._removeAtlasElement(e),i&&i.size===0&&this._stageObjects.delete(r)}),this._elementsToRemove.clear()}_repack(){this._processRemovals(),this._elements.forEach((e,r)=>{e.rendered=!1,this._elementsToAddOrUpdate.set(r,e)}),this._elements.clear(),this._resetAtlasCursor(),this._elementsToRender.clear()}_processRenderingRequest(e){this._ctx.clearRect(e.placement.offset.x,e.placement.offset.y,e.textRenderer.renderedWidth,e.textRenderer.renderedHeight),e.textRenderer.render(this._ctx,e.placement.offset.x,e.placement.offset.y);const r=this._stageObjects.get(e.textId);r&&r.forEach(i=>{i.geometries[0].setAttributeData(E.UV0,e.placement.uvMinMax),i.geometries[0].setAttributeData(E.SIZE,[e.textRenderer.displayWidth,e.textRenderer.displayHeight]),i.geometryVertexAttrsUpdated(i.geometries[0])}),e.rendered=!0}get running(){return this.updating}runTask(e,r=!0){if(this._glTexture==null)return jo.YIELD;let i=!1;if(No(this._elementsToAddOrUpdate,(n,o)=>{if(this._elements.get(o)?.rendered){const l=this._stageObjects.get(o);return l&&l.forEach(c=>{const h=c.geometries[0],p=this._elements.get(o);h.setAttributeData(E.UV0,p.placement.uvMinMax),h.setAttributeData(E.SIZE,[p.textRenderer.displayWidth,p.textRenderer.displayHeight]),c.geometryVertexAttrsUpdated(c.geometries[0])}),this._elementsToAddOrUpdate.delete(o),e.madeProgress(),!1}return this._processAddition(this._elementsToAddOrUpdate.get(o),r)===pS.REPACK&&(i=!0,!0)}),i)return this.runTask(za,!1),void e.madeProgress();let s=!1;this._elementsToRender.size>0&&this._needsClear&&(this._ctx.clearRect(0,0,this._canvas.width,this._canvas.height),this._needsClear=!1),No(this._elementsToRender,(n,o)=>(this._processRenderingRequest(n),this._elementsToRender.delete(o),s=!0,e.madeProgress(),e.done)),s&&this._glTexture.setData(this._canvas),this.updating=this._elementsToRender.size>0,!this.updating&&Jat.orderedRepackingEnabled&&(this.repackOrdered(),e.madeProgress())}addTextTexture(e,r){const i=e.key;this._elementsToAddOrUpdate.has(i)||this._elementsToAddOrUpdate.set(i,new amt(i,e)),this._addStageObject(i,r),this._elementsToRemove.delete(i),this.setDirty()}removeTextTexture(e,r){const i=e.key;this._elementsToRemove.set(i,this._elements.get(i)),this._removeStageObject(i,r)}setDirty(){this._glTexture&&(this.updating=!0)}repackOrdered(){if(this._elements.size===0)return;const e=[];this._elements.forEach((i,s)=>e.push({element:i,key:s}));let r=!0;for(let i=0;i<e.length-1;i++)if(e[i].key.localeCompare(e[i+1].key)>0){r=!1;break}if(!r||this._elementsToRemove.size){e.sort((i,s)=>i.key.localeCompare(s.key)),this._elements.clear();for(const{element:i,key:s}of e)this._elements.set(s,i);this._repack(),this.setDirty()}}get test(){const{_elements:e,_stageObjects:r,_elementsToRemove:i,_atlas:s}=this,n=this;return{elements:e,stageObjects:r,elementsToRemove:i,atlas:s,resizeAtlas:o=>n._resizeAtlas(o),run:(o,a)=>n.runTask(o,a)}}};u([d({constructOnly:!0})],e3.prototype,"view",void 0),u([d({type:Boolean})],e3.prototype,"updating",void 0),e3=u([R("esri.views.3d.webgl-engine.lib.TextTextureAtlas")],e3);const oO=2,uAe=2;var pS;(function(t){t[t.OK=0]="OK",t[t.REPACK=1]="REPACK"})(pS||(pS={}));let Lae=class{constructor(e,r){this.labelingContext=e,this.graphics3DGraphic=r,this.hasGraphics3DResources=!1,this.visible=!1,this.rendered=!1,this.textInitialized=!1,this.textRenderers=new Array,this.textLabelPlacements=new Array}},cmt=class{constructor(e,r,i,s,n){this.labelClass=e,this.graphics3DSymbol=r,this.graphics3DCalloutSymbolLayer=i,this.textRenderParameters=s,this.labelFunction=n,this.calloutSymbolLayerIndex=0}},umt=class{constructor(e,r,i,s,n,o,a,l){this.layer=r,this.graphics3DCore=i,this.scaleVisibility=s,this.emptySymbolLabelSupported=n,this.elevationInfoOverride=o,this.disablePlacement=a,this.active=l,this.labelClassAbortController=new AbortController,this.labelClassContexts=new Array,this.graphics=new Map,this.labelsToInitialize=new Map,this.stageLayer=new nEe(e,{pickable:!0,disableOctree:!0},r.uid)}destroy(){this.stageLayer.destroy()}},V1=class extends Te{constructor(e){super(e),this._dirty=!1,this._labels=new Map,this._labelsToAdd=new Map,this._labelsToRemove=new Map,this._labelingContexts=new Array}setup(){this.dispose(),this._handles=new Oi,this._handles.add([le(()=>this.view.state?.camera,()=>this.setDirty()),le(()=>this.view.state?.rasterPixelRatio,()=>this._resetAllLabels()),this.view.resourceController.scheduler.registerTask(dt.LABELER,this)]),this._textTextureAtlas=new e3({view:this.view}),this._hudMaterialCollection=new $ae(this.view._stage),this._calloutMaterialCollection=new $ae(this.view._stage)}dispose(){this._handles=Me(this._handles),this._textTextureAtlas=Ue(this._textTextureAtlas),this._hudMaterialCollection=Ue(this._hudMaterialCollection),this._calloutMaterialCollection=Ue(this._calloutMaterialCollection),this._labelingContexts.length=0,this._labels.clear(),this._labelsToAdd.clear(),this._labelsToRemove.clear()}destroy(){this.dispose(),ed.graphic=null,ed.renderingInfo=null,ed.layer=null}_activateLabelingContext(e){e.graphics.forEach((r,i)=>{const s=new Lae(e,r);this._labels.set(i,s),e.labelsToInitialize.set(i,s),r.setVisibilityFlag(Zn.LABEL,ko.USER,!0)}),e.active=!0}_deactivateLabelingContext(e){e.graphics.forEach((r,i)=>{r.setVisibilityFlag(Zn.LABEL,ko.USER,!1),this.setLabelGraphicVisibility(r,!1),this._labels.delete(i)}),e.active=!1}_addLabelTextureToAtlas(e){for(const r of e.graphics3DGraphic.labelLayers){if(!r._labelClass)continue;const i=e.textRenderers[r._labelIndex];i&&this._textTextureAtlas.addTextTexture(i,r.stageObject)}e.rendered=!0}_removeLabelTextureFromAtlas(e){for(const r of e.graphics3DGraphic.labelLayers){if(!r._labelClass)continue;const i=e.textRenderers[r._labelIndex];i!=null&&this._textTextureAtlas.removeTextTexture(i,r.stageObject)}e.rendered=!1}get running(){return this.view.ready&&(this._dirty||this.deconflictor.running)}runTask(e){return this._updateLabels(e),!this._dirty&&this.deconflictor.running&&this.deconflictor.runTask(e),jo.YIELD}_updateLabels(e){if(this._dirty){this._dirty=!1;for(const r of this._labelingContexts)if(r.active){if(!Dae(r)){if(hmt(r)){this._deactivateLabelingContext(r);continue}if(this._createLabelClassContext(r),Y9(r)){this._dirty=!0;continue}if(!Dae(r))continue}No(r.labelsToInitialize,(i,s)=>(this._ensureGraphics3DResources(i)&&(this._labels.set(s,i),this.deconflictor.setDirty(),e.madeProgress()),(i.visible&&i.textInitialized||!i.visible&&i.hasGraphics3DResources)&&(r.labelsToInitialize.delete(s),e.madeProgress()),e.done))&&(this._dirty=!0)}this._labelsToRemove.forEach(r=>this._removeLabelTextureFromAtlas(r)),this._labelsToAdd.forEach(r=>this._addLabelTextureToAtlas(r)),this._labelsToRemove.clear(),this._labelsToAdd.clear(),this._dirty||this.notifyChange("updating")}}async _createLabelClassContextAsync(e){const r=e.labelClassAbortController?.signal;await e.layer.when?.(),Xt(r),e.scaleVisibility&&e.scaleVisibility.updateScaleRangeActive();const i=e.graphics3DCore,s=i.layer,n=s.labelingInfo&&s.labelingInfo.filter(o=>!!o.symbol);!n||n.length===0||(await g5(n,async(o,a)=>{const l=o.symbol,c=vJ(i.getOrCreateGraphics3DSymbol(l));if(c==null)return void Q.getLogger(this).error("Failed to create Graphics3DSymbol for label");await c.load(),Xt(r);let h=null;ZW(l)&&l.hasVisibleCallout()&&(h=iat(l,i.symbolCreationContext),await h.load(),Xt(r));const p=await gu(a2e(o,e.layer.fieldsIndex,this.view.spatialReference));if(Xt(r),p.ok===!0){const f=await this._createTextRenderParameters(c.symbol);Xt(r),e.labelClassContexts[a]=new cmt(o,c,h,f,p.value)}else Q.getLogger(this).error(`Label expression failed to evaluate: ${p.error}`)}),Xt(r))}async _createLabelClassContext(e){return e.labelClassPromise==null&&(e.labelClassPromise=this._createLabelClassContextAsync(e).catch(r=>{if(ms(r))throw r;e.labelClassContexts.length=0}).then(()=>{e.labelClassAbortController=null,this.notifyChange("updating")}).catch(()=>{}),this.notifyChange("updating")),e.labelClassPromise}async _createTextRenderParameters(e){const r=e.symbolLayers.at(0);return r?.type!=="text"?null:lAe.fromSymbol(r,this.view.state.rasterPixelRatio)}_destroyLabelClassContext(e){for(const i of e.labelClassContexts)--i.graphics3DSymbol.referenced;const r=e.labelClassAbortController;e.labelClassAbortController=new AbortController,pu(r),e.labelClassContexts.length=0,e.labelClassPromise=null,this.notifyChange("updating")}_createTextSymbolGraphic(e,r,i,s,n){const o=new c2e(i.verticalOffset,Voe(i.anchor),Tut(i.anchor),e.text,i.translation,i.elevationOffset,i.centerOffset,i.screenOffset,i.centerOffsetUnits,e.displayWidth,e.displayHeight);return ed.graphic=r,ed.renderingInfo=null,ed.layer=s,n.createLabel(ed,o,this._hudMaterialCollection,this._textTextureAtlas)}_createLineCalloutGraphic(e,r,i,s,n){return ed.graphic=e,ed.layer=n,ed.renderingInfo=new tat(null,r,s.translation,s.centerOffset,s.screenOffset,s.centerOffsetUnits,s.elevationOffset,this._calloutMaterialCollection),i.createGraphics3DGraphic(ed)}_ensureGraphics3DResources(e){if(e.hasGraphics3DResources)return!1;const r=e.graphics3DGraphic;if(r.destroyed)return!1;this._ensureTextTextureResources(e);const i=e.labelingContext,s=i.labelClassContexts;if(!s||s.length===0||!i.emptySymbolLabelSupported&&r.layers.length===0)return!1;let n=!1;const o=r.graphic,a=i.layer,l=KI(i.layer);for(let c=0;c<s.length;c++){const h=e.textRenderers[c],p=e.textLabelPlacements[c];if(h==null||p==null)continue;const f=s[c],m=f.graphics3DSymbol,y=m.symbol&&m.symbol.type==="label-3d"?m.symbol:null,_=m.symbolLayers[0];if(!_)continue;_.setElevationInfoOverride(i.elevationInfoOverride);const v=this._createTextSymbolGraphic(h,o,p,a,_);if(v==null)return!1;v._labelClass=f.labelClass,v._labelIndex=c,r.addLabelGraphic(v,i.stageLayer),r.deconflictionPriority=f.textRenderParameters?.definition.size??0,r.setVisibilityFlag(Zn.LABEL,ko.USER,l),r.setVisibilityFlag(Zn.LABEL,ko.SCALE_RANGE,!0),r.setVisibilityFlag(Zn.LABEL,ko.DECONFLICTION,!1),n=!0;const w=f.graphics3DCalloutSymbolLayer;if(w&&p.hasLabelVerticalOffset){w.setElevationInfoOverride(i.elevationInfoOverride);const x=this._createLineCalloutGraphic(o,y,w,p,a);x!=null&&(f.calloutSymbolLayerIndex=r.labelLayers.length,r.addLabelGraphic(x,i.stageLayer))}break}return i.scaleVisibility&&n&&i.scaleVisibility.updateGraphicLabelScaleVisibility(r),e.hasGraphics3DResources=!0,!0}_destroyGraphics3DResources(e){const r=e.labelingContext.labelClassContexts;for(const i of e.graphics3DGraphic.labelLayers){if(i._labelClass==null)continue;const s=r[i._labelIndex].graphics3DSymbol.symbolLayers[0];s?.onRemoveGraphic(i)}e.graphics3DGraphic.deconflictionPriority=0,e.graphics3DGraphic.clearLabelGraphics(),e.hasGraphics3DResources=!1}_ensureTextTextureResources(e){if(e.textInitialized)return;const r=e.labelingContext,i=r.labelClassContexts;if(!i||i.length===0)return;const s=e.graphics3DGraphic.graphic;for(let n=0;n<i.length;n++){const o=i[n];if(e.textRenderers[n]=null,e.textLabelPlacements[n]=null,o?.textRenderParameters==null)continue;const a=o.labelFunction;let l;if(a.type==="arcade")try{const w=a.needsHydrationToEvaluate()?lot(s,r.layer):s;l=a.evaluate(w)}catch{l=null}else l=a.evaluate(s);if(l==null||l===""||/^\s+$/.test(l))continue;const c=o.graphics3DSymbol,h=c.symbol?.type==="label-3d"?c.symbol:null;if(!c.symbolLayers[0])continue;const p=e.graphics3DGraphic,f=o.labelClass,m=r.disablePlacement,y=Xft({graphics3DGraphic:p,labelSymbol:h,labelClass:f,disablePlacement:m});if(y==null)continue;const _=Voe(y.anchor),v=lCe(_);e.textRenderers[n]=new oCe(l,v,o.textRenderParameters),e.textLabelPlacements[n]=y}e.textInitialized=!0}_destroyTextTextureResources(e){e.textInitialized=!1,e.textRenderers.length=0,e.textLabelPlacements.length=0}_addGraphic(e,r){const i=r.graphic.uid;if(e.graphics.set(i,r),e.active){const s=new Lae(e,r);this._labels.set(i,s),e.labelsToInitialize.set(i,s)}this.setDirty(),this.deconflictor.setDirty()}_removeGraphic(e,r){const i=r.graphic.uid,s=this._labels.get(i);e.graphics.delete(i),s&&(this._destroyGraphic(s,i),e.labelsToInitialize.delete(i),this.setDirty(),this.deconflictor.setDirty())}_destroyGraphic(e,r){this._labels.has(r)&&(this._labels.delete(r),this._labelsToAdd.delete(r),this._labelsToRemove.delete(r)),e.textInitialized&&(this._removeLabelTextureFromAtlas(e),this._destroyTextTextureResources(e)),e.hasGraphics3DResources&&this._destroyGraphics3DResources(e)}async _labelingInfoChange(e,r){if(!r)return this._visibilityInfoChange(e),this._resetLabels(e),this._createLabelClassContext(e);for(const i of r){const s=e.graphics.get(i);s&&(this._removeGraphic(e,s),this._addGraphic(e,s))}}_globalPropertyChanged(e,r){for(const i of r.labelClassContexts){const s=new Map;r.graphics.forEach(o=>s.set(o.graphic.uid,o));const n=o=>o.labelLayers[0];if(i.graphics3DSymbol.symbolLayers[0].globalPropertyChanged(e,s,n),i.graphics3DCalloutSymbolLayer){const o=a=>a.labelLayers[i.calloutSymbolLayerIndex];i.graphics3DCalloutSymbolLayer.globalPropertyChanged(e,s,o)}}}_visibilityInfoChange(e){const r=KI(e.layer);r&&!e.active&&this._activateLabelingContext(e),!r&&e.active&&this._deactivateLabelingContext(e),this.setDirty()}_resetAllLabels(){for(const e of this._labelingContexts)this._resetLabels(e)}_resetLabels(e){e.graphics.forEach((r,i)=>{const s=this._labels.get(i);s&&(this._destroyGraphic(s,i),s.visible=!1,s.rendered=!1,e.labelsToInitialize.set(i,s))}),this._destroyLabelClassContext(e),this.setDirty(),this.deconflictor.setDirty()}_findLabelingContext(e){for(const r of this._labelingContexts)if(r.graphics3DCore===e)return r;return null}addGraphicsOwner(e,r,i){const s=i&&i.emptySymbolLabelSupported||!1,n=i&&i.elevationInfoOverride||null,o=i&&i.disablePlacement||null;if(this._findLabelingContext(e))return;const a=e.layer,l=new umt(this.view._stage,a,e,r,s,n,o,KI(a));return this._labelingContexts.push(l),this.setDirty(),{addGraphic:c=>this._addGraphic(l,c),removeGraphic:c=>this._removeGraphic(l,c),featureReductionChange:()=>{},layerLabelsEnabled:()=>KI(l.layer),labelingInfoChange:c=>this._labelingInfoChange(l,c),elevationInfoChange:()=>this._globalPropertyChanged("elevationInfo",l),slicePlaneEnabledChange:()=>this._globalPropertyChanged("slicePlaneEnabled",l),visibilityInfoChange:()=>this._visibilityInfoChange(l),reset:()=>this._resetLabels(l),clear:()=>{}}}removeGraphicsOwner(e){const r=this._findLabelingContext(e);if(!r)return;const i=this._labelingContexts.indexOf(r);this._labelingContexts.splice(i,1),r.graphics.forEach(s=>this._removeGraphic(r,s)),r.destroy(),this.setDirty()}setLabelGraphicVisibility(e,r){const i=e.graphic.uid,s=this._labels.get(i);s&&s.visible!==r&&(r&&!s.rendered?(this._labelsToAdd.set(i,s),this._labelsToRemove.delete(i),s.textInitialized||s.labelingContext.labelsToInitialize.set(i,s)):!r&&s.rendered&&(this._labelsToRemove.set(i,s),this._labelsToAdd.delete(i)),s.visible=r,this.setDirty())}setDirty(){!this._dirty&&this._labelingContexts.length>0&&(this._dirty=!0,this.notifyChange("updating"))}get updating(){return this._dirty||this._textTextureAtlas?.updating||this.deconflictor.updating||this._labelingContexts.some(e=>Y9(e))}get updatingProgress(){if(!this.updating||!this._textTextureAtlas)return 1;const e=this._labelingContexts.length>0?this._labelingContexts.reduce((r,i)=>r+(Y9(i)?0:1),0)/this._labelingContexts.length:1;return(this._dirty?0:.3)+(this._textTextureAtlas.updating?0:.1)+.1*e+.5*this.deconflictor.updatingProgress}get test(){return{textTextureAtlas:this._textTextureAtlas,resetAllLabels:()=>this._resetAllLabels()}}};function Y9(t){return!!t.labelClassPromise&&!!t.labelClassAbortController}function Dae(t){return t.labelClassContexts&&t.labelClassContexts.length}function hmt(t){return t.labelClassContexts===null}function KI(t){return t.labelsVisible===!0&&!!t.labelingInfo?.some(e=>!!e.symbol)}u([d({constructOnly:!0})],V1.prototype,"view",void 0),u([d({constructOnly:!0})],V1.prototype,"deconflictor",void 0),u([d()],V1.prototype,"_textTextureAtlas",void 0),u([d({type:Boolean,readOnly:!0})],V1.prototype,"updating",null),V1=u([R("esri.views.3d.layers.graphics.Labeler")],V1);const ed=new rat(null,null,null);let t3=class jT{constructor(e,r,i,s=null){this.lij=[0,0,0],this.extent=Ut(),this.resolution=0,this.loadPriority=0,this.measures={visibility:ta.VISIBLE_ON_SURFACE,screenRect:Ut(),distance:0,shouldSplit:!1},this.used=!1,s&&this.acquire(e,r,i,s)}acquire(e,r,i,s){this.tilingScheme=s,this.id=jT.id(e,r,i),this.lij[0]=e,this.lij[1]=r,this.lij[2]=i,s.getExtent(e,r,i,this.extent),this.resolution=s.resolutionAtLevel(e)}release(){this.tilingScheme=null}getChildren(e){const r=this.lij[0]+1,i=2*this.lij[1],s=2*this.lij[2];return e?(e[0].acquire(r,i,s,this.tilingScheme),e[1].acquire(r,i+1,s,this.tilingScheme),e[2].acquire(r,i,s+1,this.tilingScheme),e[3].acquire(r,i+1,s+1,this.tilingScheme),e):[new jT(r,i,s,this.tilingScheme),new jT(r,i+1,s,this.tilingScheme),new jT(r,i,s+1,this.tilingScheme),new jT(r,i+1,s+1,this.tilingScheme)]}copyMeasurementsFrom(e){this.measures.visibility=e.measures.visibility,this.measures.shouldSplit=e.measures.shouldSplit,this.measures.distance=e.measures.distance,Lg(e.measures.screenRect,this.measures.screenRect)}static id(e,r,i){return`${e}/${r}/${i}`}};var ta;(function(t){t[t.INVISIBLE=0]="INVISIBLE",t[t.VISIBLE_WHEN_EXTENDED=1]="VISIBLE_WHEN_EXTENDED",t[t.VISIBLE_ON_SURFACE=2]="VISIBLE_ON_SURFACE"})(ta||(ta={}));const hAe=.5*Math.PI,dmt=hAe/Math.PI*180;let pmt=class{constructor(e){this._renderCoordsHelper=e.renderCoordsHelper,this._extent=new Array(4),this._planes=new Array(6),this._maxSpan=0,this._center={origin:C(),direction:C()};for(let r=0;r<4;r++)this._extent[r]={origin:C(),direction:C(),cap:{next:null,direction:C()}},this._planes[r]=Ir();this._planes[ui.NEAR]=Ir(),this._planes[ui.FAR]=Ir(),this._planesWithoutFar=this._planes.slice(0,5)}update(e,r,i,s=!0){const n=this._extent;this._toRenderBoundingExtent(e,r,i),ce(this._center.origin,n[0].origin,n[2].origin),te(this._center.origin,this._center.origin,.5),this._renderCoordsHelper.worldUpAtPosition(this._center.origin,this._center.direction),s||te(this._center.direction,this._center.direction,-1);for(let o=0;o<4;o++){const a=n[o];this._renderCoordsHelper.worldUpAtPosition(a.origin,a.direction);const l=n[o===3?0:o+1];a.cap.next=l.origin,Hg(a.cap.direction,a.origin,l.origin),BO(a.direction,a.cap.direction,a.origin,this._planes[o]),s||te(a.direction,a.direction,-1)}BO(n[0].cap.direction,n[1].cap.direction,n[0].origin,this._planes[ui.NEAR]),s?cG(this._planes[ui.NEAR],this._planes[ui.FAR]):(P5(this._planes[ui.FAR],this._planes[ui.NEAR]),cG(this._planes[ui.NEAR],this._planes[ui.NEAR])),this._maxSpan=Math.max(Math.abs(e[0]-e[2]),Math.abs(e[1]-e[3])),this._maxSpanSpatialReference=r,this._minGlobalAltitude=.9*Nr(this._maxSpanSpatialReference).radius}isVisibleInFrustum(e,r,i=!1){if(e==null)return!1;if(this._renderCoordsHelper.viewingMode===De.Global){const n=this._maxSpanSpatialReference.isGeographic?dmt:hAe*r;if(this._maxSpan>n)return!0;if(e.altitude!=null&&e.altitude>=this._minGlobalAltitude)return this._isVisibleInFrustumGlobal(e)}if(this._maxSpan===0){const n=this._extent[0];return!(i||!e.intersectsRay(yu(n.origin,n.direction)))}for(let n=0;n<this._extent.length;n++){const o=this._extent[n];if(!i&&e.intersectsRay(yu(o.origin,o.direction))||e.intersectsLineSegment(Pb(o.origin,o.cap.next,mmt),o.cap.direction))return!0}const s=i?this._planes:this._planesWithoutFar;for(let n=0;n<e.lines.length;n++){const o=e.lines[n];if(ret(s,o.origin,o.endpoint,o.direction))return!0}return!1}_toRenderBoundingExtentGlobal(e,r,i){lW(e,td),td[2]=i,Tl(r,td,J9,this._renderCoordsHelper.spatialReference),On(Nae,J9),xi(Nl);for(const{x0:n,x1:o,y0:a,y1:l}of fmt)for(let c=0;c<5;c++){const h=c/4;td[0]=wt(e[n],e[o],h),td[1]=wt(e[a],e[l],h),td[2]=i,Ws(td,r,td,this._renderCoordsHelper.spatialReference),$e(td,td,Nae),kf(Nl,td)}se(this._extent[0].origin,Nl[0],Nl[1],Nl[2]),se(this._extent[1].origin,Nl[3],Nl[1],Nl[2]),se(this._extent[2].origin,Nl[3],Nl[4],Nl[2]),se(this._extent[3].origin,Nl[0],Nl[4],Nl[2]);for(let n=0;n<4;++n)$e(this._extent[n].origin,this._extent[n].origin,J9)}_toRenderBoundingExtentLocal(e,r,i){qR(e,r,vm,this._renderCoordsHelper.spatialReference),se(this._extent[0].origin,vm[0],vm[1],i),se(this._extent[1].origin,vm[2],vm[1],i),se(this._extent[2].origin,vm[2],vm[3],i),se(this._extent[3].origin,vm[0],vm[3],i)}_toRenderBoundingExtent(e,r,i){switch(this._renderCoordsHelper.viewingMode){case De.Global:this._toRenderBoundingExtentGlobal(e,r,i);break;case De.Local:this._toRenderBoundingExtentLocal(e,r,i);break;default:this._renderCoordsHelper.viewingMode}}_isVisibleInFrustumGlobal(e){if(hi(e.planes[ui.NEAR],this._center.origin)<0&&fe(this._center.direction,e.direction)<0)return!0;for(let r=0;r<4;r++){const i=this._extent[r];if(hi(e.planes[ui.NEAR],i.origin)<0&&fe(i.direction,e.direction)<0)return!0}return!1}};const fmt=[{x0:0,y0:1,x1:2,y1:1},{x0:0,y0:3,x1:2,y1:3},{x0:0,y0:1,x1:0,y1:3},{x0:2,y0:1,x1:2,y1:3}],td=C(),J9=be(),Nae=be(),Nl=pn(),vm=Ut(),mmt=dp();let gmt=class{constructor(e){this._renderCoordsHelper=e,this._surfaceElevation=0,this._cache=new Map,this._frustum=new G0(e),this._extendedFrustum=new G0(e),this._intersector=new pmt({renderCoordsHelper:e}),this._renderCoordsHelper=e}begin(e,r){this._surfaceElevation=r,this._aboveGround=this._renderCoordsHelper.getAltitude(e.eye)>r,this._frustum.update(e),this._shortenFrustumFarPlane(this._frustum),this._updateExtendedFrustum(e)}end(){this._cache.clear()}calculate(e){if(this._allTilesInvisible)return ta.INVISIBLE;const r=this._renderCoordsHelper.viewingMode===De.Global&&e.lij[0]>=ymt&&e.lij[0]<_mt,i=this._getOrCalculateSingleTileVisibility(e,!r);return i!==ta.INVISIBLE&&r?this._calculateAggregatedChildrenVisibility(e):i}_shortenFrustumFarPlane(e){const r=G0.nearFarLineIndices,i=e.mutablePoints;for(const s of r){const[n,o]=s,a=i[n],l=i[o];he(Dc,l,a),te(Dc,Dc,bmt),ce(i[o],a,Dc)}e.updatePoints(i)}_calculateAggregatedChildrenVisibility(e){let r=ta.INVISIBLE;const i=this._cache.get(e.id);if(i!=null)return i;const s=Vae.acquire();e.getChildren(s);for(const n of s){const o=this.calculate(n);if(o!==ta.INVISIBLE&&(r=o,o===ta.VISIBLE_ON_SURFACE))break}return Vae.release(s),this._cache.set(e.id,r),r}_getOrCalculateSingleTileVisibility(e,r){const i=this._cache.get(e.id);if(i!=null)return i;const s=this._calculateSingleTileVisibility(e);return r&&this._cache.set(e.id,s),s}_calculateSingleTileVisibility(e){return!this._aboveGround&&this._renderCoordsHelper.viewingMode===De.Global&&e.lij[0]<vmt?this._calculateSingleTileVisibilitySided(e,!1)===ta.INVISIBLE?this._calculateSingleTileVisibilitySided(e,!0):void 0:this._calculateSingleTileVisibilitySided(e,this._aboveGround)}_calculateSingleTileVisibilitySided(e,r){this._intersector.update(e.extent,e.tilingScheme.spatialReference,this._surfaceElevation,r);const i=Nr(e.tilingScheme.spatialReference).radius;return this._intersector.isVisibleInFrustum(this._extendedFrustum,i)?this._intersector.isVisibleInFrustum(this._frustum,i,!0)?ta.VISIBLE_ON_SURFACE:ta.VISIBLE_WHEN_EXTENDED:ta.INVISIBLE}_updateExtendedFrustum(e){this._extendedFrustum.update(e),this._shortenFrustumFarPlane(this._extendedFrustum);const r=this._renderCoordsHelper.worldUpAtPosition(e.eye,Dc);this._aboveGround||ca(r,r);const i=Pn(-fe(r,e.viewForward));if(this._allTilesInvisible=i>(Math.PI+e.fovY)/2,this._allTilesInvisible||(this._hasExtendedFrustum=i>e.fovY/2,!this._hasExtendedFrustum))return;const s=this._extendedFrustumParameters(),n=this._extendedFrustum.mutablePoints;for(let o=0;o<4;o++){const a=s.pointIndices[o],l=n[a],c=this._renderCoordsHelper.getAltitude(l);if(s.needsAltitudeAdjustment(c)){switch(this._renderCoordsHelper.worldUpAtPosition(l,Dc),a){case Ye.FAR_BOTTOM_LEFT:case Ye.FAR_TOP_LEFT:case Ye.NEAR_BOTTOM_LEFT:case Ye.NEAR_TOP_LEFT:uG(this._extendedFrustum.planes[ui.LEFT],Dc,Dc);break;case Ye.FAR_BOTTOM_RIGHT:case Ye.FAR_TOP_RIGHT:case Ye.NEAR_BOTTOM_RIGHT:case Ye.NEAR_TOP_RIGHT:uG(this._extendedFrustum.planes[ui.RIGHT],Dc,Dc)}te(Dc,Dc,s.direction),this._renderCoordsHelper.intersectInfiniteManifold(yu(l,Dc),s.zWithMargin,l)}}if(this._extendedFrustum.updatePoints(n),ia(n[Ye.NEAR_BOTTOM_LEFT],n[Ye.NEAR_BOTTOM_RIGHT],n[Ye.NEAR_TOP_RIGHT],Uae),ia(n[Ye.NEAR_BOTTOM_RIGHT],n[Ye.NEAR_TOP_RIGHT],n[Ye.NEAR_TOP_LEFT],kae),fe(Uae,kae)<0){const o=this._extendedFrustum.mutablePoints;this._aboveGround?[o[Ye.NEAR_BOTTOM_LEFT],o[Ye.NEAR_BOTTOM_RIGHT]]=[o[Ye.NEAR_BOTTOM_RIGHT],o[Ye.NEAR_BOTTOM_LEFT]]:[o[Ye.NEAR_TOP_LEFT],o[Ye.NEAR_TOP_RIGHT]]=[o[Ye.NEAR_TOP_RIGHT],o[Ye.NEAR_TOP_LEFT]],this._extendedFrustum.updatePoints(o)}}_extendedFrustumParameters(){return this._aboveGround?this._extendedFrustumParametersAboveSurface():this._extendedFrustumParametersBelowSurface()}_extendedFrustumParametersAboveSurface(){const e=this._surfaceElevation-Fae;return{zWithMargin:e,pointIndices:G0.planePointIndices.bottom,direction:-1,needsAltitudeAdjustment:r=>r>e}}_extendedFrustumParametersBelowSurface(){const e=this._surfaceElevation+Fae;return{zWithMargin:e,pointIndices:G0.planePointIndices.top,direction:1,needsAltitudeAdjustment:r=>r<e}}};const ymt=2,_mt=6,vmt=12,bmt=.95,Fae=1,Dc=C(),Uae=Ir(),kae=Ir(),Vae=new Vo(Array,t=>{t.length!==4&&(t[0]=new t3,t[1]=new t3,t[2]=new t3,t[3]=new t3)},t=>{t[0].release(),t[1].release(),t[2].release(),t[3].release()});let wmt=class{constructor(e){this._camera=new ut,this._focusOnMap=[0,0],this._screenRect=Ut(),this._tileSize=e.tileSize,this._renderCoordsHelper=e.renderCoordsHelper,this._tilingScheme=e.tilingScheme,this._visibility=new gmt(e.renderCoordsHelper)}begin(e,r,i){this._camera.copyFrom(e),this._surfaceElevation=i,this._focusOnMap[0]=r.x,this._focusOnMap[1]=r.y,aW(0,0,e.fullWidth,e.fullHeight,this._screenRect),this._visibility.begin(this._camera,i)}end(){this._visibility.end()}updateTile(e){e.measures.visibility=this._visibility.calculate(e),e.measures.distance=cNe(e.extent,this._focusOnMap),e.measures.visibility!==ta.INVISIBLE&&this._updateScreenMeasure(e)}_updateScreenMeasure(e){const r=xmt,i=1<<r,s=e.measures.screenRect;wc(s);let n=0;const o=e.lij[0]+r,a=e.lij[1]<<r,l=e.lij[2]<<r,c=this._tileSizeWithBias(e),h=c*c;for(let p=0;p<i;p++)for(let f=0;f<i;f++)if(n+=this._computeScreenArea(e,o,a+p,l+f,s),n>h)return void(e.measures.shouldSplit=!0);e.measures.shouldSplit=!1}_tileSizeWithBias(e){return e.measures.visibility===ta.VISIBLE_WHEN_EXTENDED?this._tileSize*Tmt:this._tileSize}_computeScreenArea(e,r,i,s,n){const o=e.measures.visibility===ta.VISIBLE_WHEN_EXTENDED;this._projectToScreen(r,i,s,o,zy),wc(Q9);for(let a=0;a<4;a++)TS(Q9,zy[a]);return f_(n,Q9,n),Aie(zy[0],zy[1],zy[2])+Aie(zy[0],zy[2],zy[3])}_projectToScreen(e,r,i,s,n){this._tilingScheme.ensureMaxLod(e),this._tilingScheme.getExtent(e,r,i,TC),this._toRenderCoords(TC,0,3,By[0]),this._toRenderCoords(TC,2,3,By[1]),this._toRenderCoords(TC,2,1,By[2]),this._toRenderCoords(TC,0,1,By[3]),s&&(this._projectToPlane(By,this._camera.frustum[ui.NEAR]),this._projectToPlane(By,this._camera.frustum[ui.TOP]),this._projectToPlane(By,this._camera.frustum[ui.BOTTOM]));for(let o=0;o<4;o++)this._camera.projectToRenderScreen(By[o],zae),this._camera.renderToScreen(zae,n[o])}_projectToPlane(e,r){for(let s=0;s<4;s++)EC[s]=hi(r,e[s]);const i=Math.max(EC[0],EC[1],EC[2],EC[3]);if(i>0){const s=te(SC,r,-i);for(let n=0;n<4;n++)ce(e[n],e[n],s)}}_toRenderCoords(e,r,i,s){return SC[0]=e[r],SC[1]=e[i],SC[2]=this._surfaceElevation,this._renderCoordsHelper.toRenderCoords(SC,this._tilingScheme.spatialReference,s),s}};const Q9=Ut(),xmt=2,Tmt=5,zy=[Zi(),Zi(),Zi(),Zi()],TC=Ut(),SC=C(),By=[C(),C(),C(),C()],EC=[0,0,0,0],zae=zo();function H4t(t,e,r){if(t==null||r==null)return!1;let i=!0;return en[0]=t.xmin!=null?t.xmin:0,en[1]=t.ymin!=null?t.ymin:0,en[2]=t.zmin!=null?t.zmin:0,i=i&&oi(en,t.spatialReference,0,e,r,0,1),en[0]=t.xmax!=null?t.xmax:0,en[1]=t.ymax!=null?t.ymax:0,en[2]=t.zmax!=null?t.zmax:0,i=i&&oi(en,t.spatialReference,0,e,r,3,1),t.xmin==null&&(e[0]=-1/0),t.ymin==null&&(e[1]=-1/0),t.zmin==null&&(e[2]=-1/0),t.xmax==null&&(e[3]=1/0),t.ymax==null&&(e[4]=1/0),t.zmax==null&&(e[5]=1/0),i}function dAe(t,e,r){if(t==null||r==null)return!1;let i=!0;return en[0]=t.xmin!=null?t.xmin:0,en[1]=t.ymin!=null?t.ymin:0,en[2]=t.zmin!=null?t.zmin:0,i=i&&oi(en,t.spatialReference,0,en,r,0,1),e[0]=en[0],e[1]=en[1],en[0]=t.xmax!=null?t.xmax:0,en[1]=t.ymax!=null?t.ymax:0,en[2]=t.zmax!=null?t.zmax:0,i=i&&oi(en,t.spatialReference,0,en,r,0,1),e[2]=en[0],e[3]=en[1],t.xmin==null&&(e[0]=-1/0),t.ymin==null&&(e[1]=-1/0),t.xmax==null&&(e[2]=1/0),t.ymax==null&&(e[3]=1/0),i}const en=C();let uo=class extends Te{get tilingScheme(){const e=this.tilingSchemeOwner.tilingScheme;return e?e.clone():null}set filterExtent(e){if(e!=null&&!e.spatialReference.equals(this.viewState.spatialReference))return void Q.getLogger(this).error("#extent","extent spatial reference needs to be in the same spatial reference as the view");const r=this._get("filterExtent");if(r===e||r!=null&&e&&r.equals(e))return;const i=e!=null?e.clone():null;this._set("filterExtent",i),this._setDirty()}get _filterExtentRect(){if(this.filterExtent==null)return null;const e=Ut();return dAe(this.filterExtent,e,this.tilingScheme.spatialReference),e}get _rootTileIds(){const{tilingScheme:e}=this;return this._filterExtentRect&&e?e.rootTilesInExtent(this._filterExtentRect):[[0,0,0]]}set suspended(e){e!==this._get("suspended")&&(this._set("suspended",e),this._setDirty())}get updating(){return this._dirty||!!this._pendingTiles}constructor(e){super(e),this.tiles=new Pt,this.tileSize=512,this._idToTile=new Map,this._handles=new Oi,this._clients=new Set,this._dirty=!1,this._pendingTiles=null,this._newTiles=new kt}initialize(){this._handles.add([le(()=>[this.tilingScheme,this.tileSize],()=>this._reset(),jr),le(()=>[this.tileSize,this.cameraOnSurface?.location,this.tilingScheme,this.viewState?.contentCamera,this.focus?.location],()=>this._setDirty(),As)]),this.scheduler&&(this._frameWorker=this.scheduler.registerTask(dt.FEATURE_TILE_TREE,this))}destroy(){this._frameWorker=Ii(this._frameWorker),this._handles=Me(this._handles)}addClient(){const e=Emt();return this._clients.add(e),this._clients.size===1&&this._setDirty(),bo(()=>this._removeClient(e))}_removeClient(e){this._clients.delete(e),this._hasClients||this._clear()}get _hasClients(){return this._clients.size>0}_setDirty(){!this._hasClients||this.suspended||this._dirty||(this._frameWorker?(this._dirty=!0,this.notifyChange("updating")):this.runTask(za))}_clear(){this.tiles.removeAll(),this._idToTile.clear(),this._reset(),this._dirty=!1,this.notifyChange("updating")}get running(){return this.updating}runTask(e){this._dirty=!1,this._pendingTiles||(this._startUpdate(),this._frameWorker!=null&&(this._frameWorker.priority=dt.FEATURE_TILE_TREE_ACTIVE)),this._subdivideTilesForView(e),this._pendingTiles||this._frameWorker==null||(this._frameWorker.priority=dt.FEATURE_TILE_TREE),this.notifyChange("updating")}_startUpdate(){if(this.suspended)return;if(!this.tilingScheme)return void this._clear();this._tileMeasurements||(this._tileMeasurements=new wmt({renderCoordsHelper:this.renderCoordsHelper,tilingScheme:this.tilingScheme,tileSize:this.tileSize}));const e=this.viewState.contentCamera;this._tileMeasurements.begin(e,this.focus.location,this.cameraOnSurface.location.z??0),this._pendingTiles=this._getRootTiles()}_reset(){this._newTiles.clear(),this._tileMeasurements=null,this._pendingTiles=null,this._setDirty()}_getRootTiles(){const{tilingScheme:e}=this;return this._rootTileIds.map(r=>new t3(r[0],r[1],r[2],e))}_purgeHorizonTiles(e){e.sort((r,i)=>{const s=r.measures.screenRect,n=i.measures.screenRect;return s[1]+s[3]-(n[1]+n[3])}),wc(e$);for(let r=0;r<e.length;r++)if(f_(e$,e.data[r].measures.screenRect,e$),op(e$)>Cmt)return e.data.slice(r,e.length);return[]}_subdivideTilesForView(e){if(!this._pendingTiles)return;const{tilingScheme:r}=this;for(;this._pendingTiles.length>0&&!e.done;){const i=this._pendingTiles.pop();e.madeProgress(),this._filterExtentRect&&!MR(this._filterExtentRect,i.extent)||(this._tileMeasurements.updateTile(i),i.measures.visibility!==ta.INVISIBLE&&(i.measures.shouldSplit?(r.ensureMaxLod(i.lij[0]+1),this._pendingTiles.push(...i.getChildren())):this._newTiles.push(i)))}this._pendingTiles.length===0&&(this._updateTiles(this._purgeHorizonTiles(this._newTiles)),this._newTiles.clear(),this._tileMeasurements.end(),this._pendingTiles=null)}_updateTiles(e){for(const s of this.tiles.items)s.used=!1;const r=e.filter(s=>{const n=this._idToTile.get(s.id);return n?(n.copyMeasurementsFrom(s),n.used=!0):this._idToTile.set(s.id,s),!n}),i=this.tiles.items.filter(s=>!s.used&&(this._idToTile.delete(s.id),!0));this.tiles.removeMany(i),this.tiles.addMany(r),this._sortTiles()}_sortTiles(){this.viewState.fixedContentCamera||this.tiles.sort((e,r)=>e.measures.visibility!==r.measures.visibility?e.measures.visibility===ta.VISIBLE_ON_SURFACE?-1:1:e.measures.distance-r.measures.distance),this.tiles.forEach((e,r)=>e.loadPriority=r)}};u([d({constructOnly:!0})],uo.prototype,"scheduler",void 0),u([d({constructOnly:!0})],uo.prototype,"renderCoordsHelper",void 0),u([d({constructOnly:!0})],uo.prototype,"tilingSchemeOwner",void 0),u([d({constructOnly:!0})],uo.prototype,"cameraOnSurface",void 0),u([d({constructOnly:!0})],uo.prototype,"focus",void 0),u([d({constructOnly:!0})],uo.prototype,"viewState",void 0),u([d({constructOnly:!0})],uo.prototype,"terrain",void 0),u([d()],uo.prototype,"tiles",void 0),u([d()],uo.prototype,"tileSize",void 0),u([d({readOnly:!0})],uo.prototype,"tilingScheme",null),u([d()],uo.prototype,"filterExtent",null),u([d({readOnly:!0})],uo.prototype,"_filterExtentRect",null),u([d({readOnly:!0})],uo.prototype,"_rootTileIds",null),u([d({value:!1})],uo.prototype,"suspended",null),u([d({readOnly:!0})],uo.prototype,"updating",null),uo=u([R("esri.views.3d.layers.support.FeatureTileTree3D")],uo);let Smt=0;function Emt(){return Smt++}const e$=Ut(),Cmt=10;let Ki=class extends Te{constructor(){super(...arguments),this._propertiesPool=new kg({camera:ut},this),this._lastSeenCameraProjectionValues=new ut,this.mode=$r.ANIMATING,this._cssCamera=new ut,this._camera=new ut,this.rasterPixelRatio=1,this.contentPixelRatio=1,this.events=new os,this.viewingMode=De.Global,this._cameraChanged=!1,this._updateQueue=new Array,this._processingUpdates=!1}init(e,r){this._set("viewingMode",e),this._set("spatialReference",r),this._set("constraints",new Hm({mode:this.viewingMode}))}exit(){this.cameraController?.destroy(),this.cameraController=null,this._propertiesPool.destroy(),this._propertiesPool=new kg({camera:ut},this)}destroy(){this.cameraController?.destroy(),this.cameraController=null,this._propertiesPool?.destroy(),this._propertiesPool=null}createInitialCamera(){if(this.viewingMode===De.Global){const e=Nr(this.spatialReference).radius;this.camera=new ut({eye:Oe(4*e,0,0),center:Oe(e,0,0),up:Oe(0,0,1)})}else this.camera=new ut({eye:Oe(0,0,100),center:Oe(0,0,0),up:Oe(0,1,0)})}get animation(){return this.cameraController instanceof JO&&this.cameraController.viewAnimation!=null?this.cameraController.viewAnimation:null}get camera(){return this._camera}get cssCamera(){const e=this._cssCamera.copyFrom(this.camera),{height:r,width:i,pixelRatio:s}=this.camera;return e.pixelRatio=1,e.height=Math.round(r/s),e.width=Math.round(i/s),e}set camera(e){e!==Iu&&Iu.copyFrom(e),Iu.computeUp(this.viewingMode),this.events.emit("before-camera-change",Iu);const r=this._camera;if(this._cameraProjectionChanged(this._lastSeenCameraProjectionValues,Iu)&&(this._lastSeenCameraProjectionValues.copyFrom(Iu),this.events.emit("camera-projection-changed",this._lastSeenCameraProjectionValues)),!r.equals(Iu)&&(this._camera=this._propertiesPool.get("camera").copyFrom(Iu),this._cameraChanged=!r.almostEquals(Iu),this._cameraChanged)){const i=wpe(()=>{this._cameraChanged=!1,i.remove()})}}get pixelRatio(){return this.camera.pixelRatio}get alignPixelEnabled(){return this.pixelRatio===this.rasterPixelRatio&&this.mode===$r.IDLE}get updating(){return!this.alignPixelEnabled}get contentCamera(){return this._contentCamera??this.camera}set contentCamera(e){this._contentCamera=e!=null?e.clone():null}get fixedContentCamera(){return this._contentCamera!=null}get isGlobal(){return this.viewingMode===De.Global}get isLocal(){return this.viewingMode===De.Local}get navigating(){return!(!this.cameraController||!this.cameraController.isInteractive)}get stationary(){return!this._cameraChanged&&!this.navigating}get cameraController(){return this._get("cameraController")}set cameraController(e){this.stopActiveCameraController()?(this.cameraController?.destroy(),e&&(this.removeHandles(Bae),this.addHandles(Eh(()=>e.state===qi.Finished||e.state===qi.Stopped,()=>{this._set("cameraController",null),this.updateCamera(r=>e.onControllerEnd(r))},{sync:!0,once:!0}),Bae),e.onControllerStart(this.camera)),this._set("cameraController",e)):e&&(e.state=qi.Rejected)}switchCameraController(e){return this.cameraController=e,e.state!==qi.Rejected}stopActiveCameraController(){return!(this.cameraController&&!this.cameraController.stopController())}updateCamera(e){this._updateQueue.push(e),this._processUpdateQueue()}_processUpdateQueue(){if(this._updateQueue.length===0||this._processingUpdates)return;this._processingUpdates=!0;const e=this._updateQueue.shift();Iu.copyFrom(this._get("camera")),e(Iu),this.camera=Iu,this._processingUpdates=!1,this._processUpdateQueue()}_cameraProjectionChanged(e,r){return e.fov!==r.fov||e.fullViewport[0]!==r.fullViewport[0]||e.fullViewport[1]!==r.fullViewport[1]||e.fullViewport[2]!==r.fullViewport[2]||e.fullViewport[3]!==r.fullViewport[3]||e.padding[er.TOP]!==r.padding[er.TOP]||e.padding[er.RIGHT]!==r.padding[er.RIGHT]||e.padding[er.BOTTOM]!==r.padding[er.BOTTOM]||e.padding[er.LEFT]!==r.padding[er.LEFT]}};u([d()],Ki.prototype,"mode",void 0),u([d({readOnly:!0,type:T2})],Ki.prototype,"animation",null),u([d({type:ut})],Ki.prototype,"camera",null),u([d({type:ut})],Ki.prototype,"cssCamera",null),u([d()],Ki.prototype,"_cssCamera",void 0),u([d()],Ki.prototype,"_camera",void 0),u([d({readOnly:!0})],Ki.prototype,"pixelRatio",null),u([d()],Ki.prototype,"rasterPixelRatio",void 0),u([d()],Ki.prototype,"contentPixelRatio",void 0),u([d({readOnly:!0})],Ki.prototype,"alignPixelEnabled",null),u([d({readOnly:!0})],Ki.prototype,"updating",null),u([d({})],Ki.prototype,"_contentCamera",void 0),u([d({type:ut})],Ki.prototype,"contentCamera",null),u([d({readOnly:!0})],Ki.prototype,"fixedContentCamera",null),u([d({readOnly:!0})],Ki.prototype,"constraints",void 0),u([d({readOnly:!0})],Ki.prototype,"events",void 0),u([d({readOnly:!0})],Ki.prototype,"isGlobal",null),u([d({readOnly:!0})],Ki.prototype,"isLocal",null),u([d({readOnly:!0})],Ki.prototype,"viewingMode",void 0),u([d({readOnly:!0})],Ki.prototype,"spatialReference",void 0),u([d()],Ki.prototype,"navigating",null),u([d()],Ki.prototype,"stationary",null),u([d()],Ki.prototype,"_cameraChanged",void 0),u([d()],Ki.prototype,"cameraController",null),Ki=u([R("esri.views.3d.state.ViewState")],Ki);const Amt=Ki,Iu=new ut,Bae="ViewStateHandles";let Omt=class{constructor(e,r,i){this.viewingMode=e,this._forEachLayer=r,this._view=i,this._externalIntersectionHandlers=new kt,this._tolerance=O2,this._tmpRay=Xn(),this._tmpRegion=Ut(),this._validateHUDIntersector=Dh(this.viewingMode),this._validateHUDIntersector.options.hud=!1}intersectScreen(e,r,i){return this.intersectRay(this._getPickRay(e,this._tmpRay),Gae(this.viewingMode),r,i)}intersectScreenFreePointFallback(e,r,i){return this.intersectRayFreePointFallback(this._getPickRay(e,this._tmpRay),r,i)}intersectRayFreePointFallback(e,r,i){return this.intersectRay(e,Gae(this.viewingMode),r,i)||this._intersectRayFreePointLocal(e,r)}intersectRay(e,r,i,s){return r.options.selectionMode=!1,r.options.store=vo.MIN,this.computeIntersection(e,r,s),!!r.results.min&&r.results.min.getIntersectionPoint(i)}getCenterRayWithSubpixelOffset(e,r,i=.5,s=.5){return e.getRenderCenter(i$,i,s),i$[0]+=.0466,i$[1]-=.0123,aY(e,i$,r)}intersectIntersectorScreen(e,r,i){this.computeIntersection(this._getPickRay(e,this._tmpRay),r,i)}intersectToolIntersectorScreen(e,r,i){const s=this._getPickRay(e,this._tmpRay);this.intersectToolIntersectorRay(s,r,i)}intersectToolIntersectorRay(e,r,i){r.options.selectionMode=!0,this.computeIntersection(e,r,i);const s=r.results.min;this._view.basemapTerrain&&this._view.basemapTerrain.opaque||fp(s)&&s.intersector!==ki.TERRAIN||(r.options.selectionMode=!1,this.computeIntersection(e,r,i))}setTolerance(e=O2){this._tolerance=e}addIntersectionHandler(e){this._externalIntersectionHandlers.push(e),this._externalIntersectionHandlers.sort((r,i)=>r.type===ki.TERRAIN?1:i.type===ki.TERRAIN?-1:0)}removeIntersectionHandler(e){this._externalIntersectionHandlers.removeUnordered(e)!=null&&this._externalIntersectionHandlers.sort((r,i)=>r.type===ki.TERRAIN?1:i.type===ki.TERRAIN?-1:0)}_getPickRay(e,r){const i=this._view.state.camera;return iTe(i,e,r)}_intersectRayFreePointLocal(e,r){return this.viewingMode!==De.Local||e==null||ce(r,e.origin,me(Le.get(),e.direction)),!1}intersectElevationFromScreen(e,r,i=0,s=null){return this._intersectElevation(this._getPickRay(e,this._tmpRay),r,i,s)}_intersectElevation(e,r,i=0,s=null){if(e==null)return null;const n=r!=null?r.mode:"absolute-height",o=r?.offset??0,a=n!=="on-the-ground"?o+i:0,l=a/this._view.renderCoordsHelper.unitInMeters;if(n==="absolute-height"){if(this._view.renderCoordsHelper.intersectInfiniteManifold(e,a,r$)){const x=this._view.computeMapPointFromVec3d(r$);return x.z??(x.z=0),x.z-=o,x}return null}const c=this._view.state.camera,h=Le.get();c.projectToRenderScreen(e.origin,h);const p=new jae(null,this._forEachLayer),f=this._view.slicePlane,m=f!=null?mse(f):null,y=Dh(this.viewingMode);y.options.store=vo.MIN,y.options.verticalOffset=l;const _=e.origin,v=ce(Le.get(),_,e.direction);y.reset(_,v,c),y.point=h;const w=s?"type"in s&&s.type==="graphics"?x=>x.layerUid!==s.uid:x=>x.graphicUid!==s.uid:null;switch(n){case"relative-to-scene":{const x=T=>(!w||w(T))&&!!T.lastValidElevationBB;y.intersect(p.layers,h,this._tolerance,null,x),this._externalIntersectionHandlers.forAll(T=>{if(T.type===ki.I3S||T.type===ki.TERRAIN){const S=T.slicePlaneEnabled?m:null;T.intersect(y,S,y.rayBegin,y.rayEnd,h)}});break}case"on-the-ground":case"relative-to-ground":this._externalIntersectionHandlers.forAll(x=>{if(x.isGround){const T=x.slicePlaneEnabled?m:null;x.intersect(y,T,y.rayBegin,y.rayEnd,h)}})}if(y.results.min.getIntersectionPoint(r$)){const x=this._view.computeMapPointFromVec3d(r$);return x.z=i,x}return null}computeIntersection(e,r,i){if(e==null)return;const s=this._view.state.camera,n=Le.get();s.projectToRenderScreen(e.origin,n);const o=new jae(i,this._forEachLayer);r.options.selectOpaqueTerrainOnly=!i||!("include"in i||"exclude"in i);const a=e.origin,l=ce(Le.get(),e.origin,e.direction);r.reset(a,l,s),r.intersect(o.layers,n,this._tolerance);const c=this._view.slicePlane,h=c!=null?mse(c):null;r.intersect(o.sliceableLayers,n,this._tolerance,h);const p=i&&(i.requiresGroundFeedback||i.enableDraped);this._externalIntersectionHandlers.forAll(y=>{const _=y.layerUid,v=Array.isArray(_),w=v?_:[_];v&&(r.options.filteredLayerUids=[]);let x=!1;for(const T of w)o.filterLayerUid(T)?x=!0:v&&r.options.filteredLayerUids.push(T);if(r.options.isFiltered=!x,y.isGround&&p||!r.options.isFiltered){const T=y.slicePlaneEnabled?h:null;y.intersect(r,T,a,l,n)}});const f=Le.get(),m=this._view.basemapTerrain;if(i&&i.enableDraped&&m.spatialReference!=null&&r.results.ground.getIntersectionPoint(f)){const y=m.overlayManager.renderer,_=this._view.renderCoordsHelper.spatialReference,v=Le.get();this._view.renderCoordsHelper.fromRenderCoords(f,v,m.spatialReference),v[2]=this._view.elevationProvider?.getElevation(f[0],f[1],f[2],_,"ground")??0,y.intersect(r,v,r.results.ground,w=>o.filterRenderGeometry(w))}r.sortResults(),this._processHUDResults(r)}_processHUDResults(e){const r=e.results.hud;Lg(this._tmpRegion,OV);const i=this._view.state.camera,s=[],n=this._tmpRegion,o=w=>{const x=new Pmt(w);i.projectToRenderScreen(w.target.center,x.screenPoint),x.screenPoint[0]=Math.floor(x.screenPoint[0]),x.screenPoint[1]=Math.floor(x.screenPoint[1]),s.push(x),TS(n,x.screenPoint)};e.sortResults(r.all),r.min.dist!=null&&o(r.min);for(const w of r.all)r.min.target.object!==w.target.object&&r.max.target.object!==w.target.object&&o(w);if(r.max.dist!=null&&r.max.target.object!==r.min.target.object&&o(r.max),!s.length)return;n[0]===n[2]&&(n[2]+=1),n[1]===n[3]&&(n[3]+=1);const a=i.fullWidth,l=i.fullHeight,c=Math.max(0,n[0]-r3),h=Math.max(0,n[1]-r3),p=Math.min(ru(n)+2*r3,a-c),f=Math.min(op(n)+2*r3,l-h),m=new Uint8Array(p*f*4);this._view._stage.renderer.readHUDVisibility(c,h,p,f,m);let y=!0;const _=e.results.max.dist==null;let v=0;for(const w of s)for(const x of Rmt)if(m[4*(Math.min(w.screenPoint[0]+x[0],a)-n[0]+(Math.min(w.screenPoint[1]+x[1],l)-n[1])*p)]){y&&(e.results.min.copy(w.result),y=!1),_&&e.results.max.copy(w.result),e.options.store===vo.ALL&&e.results.all.splice(v++,0,w.result);break}}};const r3=1,Rmt=(()=>{const t=[],e=r3;for(let r=-e;r<=e;r++)for(let i=-e;i<=e;i++)t.push([i+e,r+e]);return t})();let Pmt=class{constructor(e){this.result=e,this.screenPoint=zo()}},t$;function Gae(t){return t$&&t$.viewingMode===t||(t$=Dh(t)),t$}let jae=class{constructor(e,r){this.layers=new Array,this.sliceableLayers=new Array,this.include=e?.include,this.exclude=e?.exclude,r(i=>{i.pickable&&this.filterLayerUid(i.apiLayerUid)&&(i.sliceable?this.sliceableLayers:this.layers).push(i)})}filterLayerUid(e){const{include:r,exclude:i}=this;return e==null?r==null&&i==null:(r==null||r.has(e))&&(i==null||!i.has(e))}filterRenderGeometry(e){return this.filterLayerUid(e.layerUid)}};function Hae(t){return typeof t=="object"&&"intersect"in t}const r$=C(),i$=zo();let J4t=class{constructor(e,r){this.spatialReference=e,this._view=r}getElevation(e,r,i){return this._view.elevationProvider.getElevation(e,r,0,this.spatialReference,i)}async queryElevation(e,r,i,s,n){return this._view.elevationProvider.queryElevation(e,r,0,this.spatialReference,n,i,s)}},Mmt=class{constructor(e,r,i,s){this.spatialReference=r,this._getElevationQueryProvider=i,this._queries=new Array,this._queryOptions={...s,ignoreInvisibleLayers:!0},this._frameTask=e.registerTask(dt.ELEVATION_QUERY,this)}destroy(){this._frameTask.remove()}queryElevation(e,r,i,s=0){const n=qs(),o={x:e,y:r,minDemResolution:s,result:n,signal:i};return this._queries.push(o),nn(i,()=>{aq(this._queries,o),n.reject(Dr())}),n.promise}get running(){return this._queries.length>0}runTask(e){const r=this._queries;this._queries=[];const i=this._getElevationQueryProvider();if(!i)return r.forEach(h=>h.result.reject()),void e.madeProgress();const s=r.map(h=>[h.x,h.y]),n=r.reduce((h,p)=>Math.min(h,p.minDemResolution),1/0),o=new OR({points:s,spatialReference:this.spatialReference}),a=r.length>1&&r.some(h=>!!h.signal)?new AbortController:null,l=a!=null?a.signal:r[0].signal;if(a!=null){let h=0;r.forEach(p=>nn(p.signal,()=>{h++,p.result.reject(Dr()),h===r.length&&a.abort()}))}const c={...this._queryOptions,minDemResolution:n,signal:l};i.queryElevation(o,c).then(h=>{r.forEach((p,f)=>{p.signal!=null&&p.signal.aborted?p.result.reject(Dr()):p.result.resolve(h.geometry.points[f][2])})}).catch(h=>{r.forEach(p=>p.result.reject(h))}),e.madeProgress()}get test(){const e=this;return{update:()=>e._queries.length>0&&e.runTask(za)}}},i3=class extends os.EventedMixin(Te){get spatialReference(){return this.view?.basemapTerrain?.spatialReference}constructor(e){super(e),this._im=new Array,this._ground=new Array,this._scene=new Array,this._handles=new Map,this.lastElevationQuery=null,this.elevationCacheEnabled=!1}destroy(){this._elevationQueryCached=Me(this._elevationQueryCached)}get _elevationQuery(){return this._elevationQueryCached==null&&(this._elevationQueryCached=new Mmt(this.view.resourceController.scheduler,this.view.spatialReference,()=>this.view.map&&this.view.map.ground,{maximumAutoTileRequests:4})),this._elevationQueryCached}enableElevationCache(e){e||(this.lastElevationQuery=null),this.elevationCacheEnabled=e}getElevation(e,r,i,s,n){if(this.elevationCacheEnabled&&this.lastElevationQuery!=null){const a=this.lastElevationQuery;if(e===a.x&&r===a.y&&i===a.z&&Rn(s,a.spatialReference)&&n===a.queryContext)return a.result}let o=null;return o=s$(o,this._im,e,r,i,s,n),o==null&&(o=s$(o,this._ground,e,r,i,s,n)),n==="scene"&&(o=s$(o,this._scene,e,r,i,s,n)),this.elevationCacheEnabled&&(this.lastElevationQuery={x:e,y:r,z:i,spatialReference:s,queryContext:n,result:o}),o}getSphereElevationBounds(e,r){let i=1/0,s=-1/0;for(const n of[this._im,this._ground,this._scene])n.forEach(o=>{if(o.getSphereElevationBounds){const a=o.getSphereElevationBounds(e,r);a!=null&&(i=Math.min(i,a.min),s=Math.max(s,a.max))}});return{min:i,max:s}}queryElevation(e,r,i,s,n,o=null,a=0){const l=qs();return this._elevationQuery.queryElevation(e,r,o,a).then(c=>{n==="scene"&&(c=s$(c,this._scene,e,r,i,s,n)),l.resolve(c)}).catch(c=>{ms(c)?l.reject(c):l.resolve(this.getElevation(e,r,i,s,n))}),l.promise}register(e,r){this._handles.set(r,r.on("elevation-change",i=>this.emit("elevation-change",i))),this._providersFromContext(e).push(r)}unregister(e){this._handles.has(e)&&(this._handles.get(e)?.remove(),this._handles.delete(e));for(const r of[this._im,this._ground,this._scene]){const i=r.indexOf(e);i>-1&&r.splice(i,1)}}_providersFromContext(e){switch(e){case"ground":return this._ground;case"im":return this._im;case"scene":return this._scene}}};function s$(t,e,r,i,s,n,o){for(const a of e){const l=a.getElevation(r,i,s,n,o);l!=null&&(t=t!=null?Math.max(l,t):l)}return t}u([d({constructOnly:!0})],i3.prototype,"view",void 0),u([d()],i3.prototype,"spatialReference",null),i3=u([R("esri.views.3d.support.CombinedElevationProvider")],i3);let s3=class CH{static isValidProfile(e){return e in CH.profiles}static getDefaultProfile(){return oe("esri-iPhone")?"low":"medium"}static apply(e,r){const i=CH.profiles[e];r.graphics3D.maxTotalNumberOfFeatures=i.graphics3D.maxTotalNumberOfFeatures,r.graphics3D.maxTotalNumberOfPrimitives=i.graphics3D.maxTotalNumberOfPrimitives,r.graphics3D.polygonLodFactor=i.graphics3D.polygonLodFactor,r.graphics3D.polylineLodFactor=i.graphics3D.polylineLodFactor,r.graphics3D.snapshotAvailable=i.graphics3D.snapshotAvailable,r.graphics3D.skipHighSymbolLods=i.graphics3D.skipHighSymbolLods;const s=r.sceneService.object,n=i.sceneService.object;s.lodFactor=n.lodFactor,s.lodCrossfadeinDuration=n.lodCrossfadeinDuration,s.lodCrossfadeoutDuration=n.lodCrossfadeoutDuration,s.lodCrossfadeUncoveredDuration=n.lodCrossfadeUncoveredDuration,r.sceneService.point.lodFactor=i.sceneService.point.lodFactor,r.sceneService.integratedMesh.lodFactor=i.sceneService.integratedMesh.lodFactor,r.sceneService.pointCloud.lodFactor=i.sceneService.pointCloud.lodFactor,r.sceneService.uncompressedTextureDownsamplingEnabled=i.sceneService.uncompressedTextureDownsamplingEnabled,r.tiledSurface.lodBias=i.tiledSurface.lodBias,r.tiledSurface.angledSplitBias=i.tiledSurface.angledSplitBias,r.tiledSurface.reduceTileLevelDifferences=i.tiledSurface.reduceTileLevelDifferences,r.tiledSurface.textureFadeDuration=i.tiledSurface.textureFadeDuration,r.heatmap.pixelRatio=i.heatmap.pixelRatio,r.heatmap.maxTotalNumberOfFeatures=i.heatmap.maxTotalNumberOfFeatures,r.fadeDuration=i.fadeDuration,r.antialiasingEnabled=i.antialiasingEnabled,r.physicallyBasedRenderingEnabled=i.physicalBasedRenderingEnabled,r.highQualityTransparency=i.highQualityTransparency,r.highResolutionAtmosphere=i.highResolutionAtmosphere,r.reflections=i.reflections,r.ambientOcclusion=i.ambientOcclusion,r.memoryLimit=i.memoryLimit,r.additionalCacheMemory=i.additionalCacheMemory,r.frameRate=i.frameRate,r.maximumPixelRatio=i.maximumPixelRatio}};function qae(){const t=!!oe("esri-mobile"),e=!!oe("ios"),r=400;return{low:{graphics3D:{maxTotalNumberOfFeatures:25e3,maxTotalNumberOfPrimitives:85e4,polygonLodFactor:.5,polylineLodFactor:1,snapshotAvailable:!1,skipHighSymbolLods:!0},heatmap:{pixelRatio:.125,maxTotalNumberOfFeatures:25e3},sceneService:{object:{lodFactor:.2,lodCrossfadeinDuration:0,lodCrossfadeoutDuration:0,lodCrossfadeUncoveredDuration:0},point:{lodFactor:1},integratedMesh:{lodFactor:.6},pointCloud:{lodFactor:.5},uncompressedTextureDownsamplingEnabled:!0},tiledSurface:{lodBias:-1,angledSplitBias:.5,reduceTileLevelDifferences:!1,textureFadeDuration:0},fadeDuration:0,antialiasingEnabled:!1,physicalBasedRenderingEnabled:!1,highQualityTransparency:!1,highResolutionAtmosphere:!1,reflections:!1,ambientOcclusion:!1,memoryLimit:200,additionalCacheMemory:0,frameRate:0,maximumPixelRatio:1},medium:{graphics3D:{maxTotalNumberOfFeatures:5e4,maxTotalNumberOfPrimitives:17e5,polygonLodFactor:t?.8:1,polylineLodFactor:t?1.2:1.5,snapshotAvailable:!e,skipHighSymbolLods:!1},heatmap:{pixelRatio:.25,maxTotalNumberOfFeatures:5e4},sceneService:{object:{lodFactor:1,lodCrossfadeinDuration:0,lodCrossfadeoutDuration:0,lodCrossfadeUncoveredDuration:r},point:{lodFactor:1},integratedMesh:{lodFactor:1},pointCloud:{lodFactor:1},uncompressedTextureDownsamplingEnabled:t},tiledSurface:{lodBias:0,angledSplitBias:1,reduceTileLevelDifferences:!oe("disable-feature:reduce-map-tile-levels"),textureFadeDuration:r},fadeDuration:r,antialiasingEnabled:!0,physicalBasedRenderingEnabled:!0,highQualityTransparency:!0,highResolutionAtmosphere:!1,reflections:!1,ambientOcclusion:!1,memoryLimit:t?600:750,additionalCacheMemory:t?-100:150,frameRate:0,maximumPixelRatio:1},high:{graphics3D:{maxTotalNumberOfFeatures:5e4,maxTotalNumberOfPrimitives:17e5,polygonLodFactor:t?1.2:2,polylineLodFactor:t?1.2:2,snapshotAvailable:!e,skipHighSymbolLods:!1},heatmap:{pixelRatio:.5,maxTotalNumberOfFeatures:5e4},sceneService:{object:{lodFactor:1,lodCrossfadeinDuration:0,lodCrossfadeoutDuration:0,lodCrossfadeUncoveredDuration:r},point:{lodFactor:1},integratedMesh:{lodFactor:1},pointCloud:{lodFactor:1},uncompressedTextureDownsamplingEnabled:!1},tiledSurface:{lodBias:0,angledSplitBias:1,reduceTileLevelDifferences:!oe("disable-feature:reduce-map-tile-levels"),textureFadeDuration:r},fadeDuration:r,antialiasingEnabled:!0,physicalBasedRenderingEnabled:!0,highQualityTransparency:!0,highResolutionAtmosphere:!0,reflections:!0,ambientOcclusion:!0,memoryLimit:t?900:1500,additionalCacheMemory:t?-150:0,frameRate:0,maximumPixelRatio:t?1:1/0}}}s3.test={reset(){const t=qae();for(const e of Object.keys(t))s3.profiles[e]=t[e]}},function(t){t.profiles=qae()}(s3||(s3={}));const fD=s3;function pAe(){return new Float32Array(4)}function Imt(t){const e=new Float32Array(4);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e}function Xf(t,e,r,i){const s=new Float32Array(4);return s[0]=t,s[1]=e,s[2]=r,s[3]=i,s}function $mt(t,e){return new Float32Array(t,e,4)}function fAe(){return pAe()}function mAe(){return Xf(1,1,1,1)}function gAe(){return Xf(1,0,0,0)}function yAe(){return Xf(0,1,0,0)}function _Ae(){return Xf(0,0,1,0)}function vAe(){return Xf(0,0,0,1)}const Lmt=fAe(),Dmt=mAe(),Nmt=gAe(),Fmt=yAe(),Umt=_Ae(),kmt=vAe();Object.freeze(Object.defineProperty({__proto__:null,ONES:Dmt,UNIT_W:kmt,UNIT_X:Nmt,UNIT_Y:Fmt,UNIT_Z:Umt,ZEROS:Lmt,clone:Imt,create:pAe,createView:$mt,fromValues:Xf,ones:mAe,unitW:vAe,unitX:gAe,unitY:yAe,unitZ:_Ae,zeros:fAe},Symbol.toStringTag,{value:"Module"}));const Wae=new ze([0,255,255]),Zae=new ze([0,0,0]),Xae=1,Yae=.25,Jae=.4,Qae=.2;let tf=class extends Te{constructor(){super(...arguments),this.color=Wae.clone(),this.haloColor=null,this.haloOpacity=Xae,this.fillOpacity=Yae,this.shadowOpacity=Jae,this.shadowColor=Zae.clone(),this.shadowDifference=Qae}static toEngineOptions(e){const r=ze.toUnitRGBA(e.color??Wae),i=e.haloColor!=null?ze.toUnitRGBA(e.haloColor):r,s=ze.toUnitRGBA(e.shadowColor??Zae),n=e.haloOpacity??Xae,o=e.fillOpacity??Yae,a=e.shadowOpacity??Jae,l=e.shadowDifference??Qae;return{color:Xf(r[0],r[1],r[2],r[3]),haloColor:Xf(i[0],i[1],i[2],i[3]),haloOpacity:n,haloOpacityOccluded:.25*n,fillOpacity:o,fillOpacityOccluded:.25*o,shadowOpacity:a,shadowColor:Lt(s[0],s[1],s[2],s[3]),occludedShadowOpacity:a*(1-l)}}};u([d({type:ze})],tf.prototype,"color",void 0),u([d({type:ze})],tf.prototype,"haloColor",void 0),u([d()],tf.prototype,"haloOpacity",void 0),u([d()],tf.prototype,"fillOpacity",void 0),u([d()],tf.prototype,"shadowOpacity",void 0),u([d({type:ze})],tf.prototype,"shadowColor",void 0),u([d()],tf.prototype,"shadowDifference",void 0),tf=u([R("esri.views.3d.support.HighlightOptions")],tf);const AH=tf;function Vmt(t,e){return e?{...e,query:{...t??{},...e.query}}:{query:t}}function zmt(t){return typeof t=="string"?cn(t):K(t)}function Bmt(t,e,r){const i={};for(const s in t){if(s==="declaredClass")continue;const n=t[s];if(n!=null&&typeof n!="function")if(Array.isArray(n)){i[s]=[];for(let o=0;o<n.length;o++)i[s][o]=Bmt(n[o])}else if(typeof n=="object")if(n.toJSON){const o=n.toJSON(r&&r[s]);i[s]=e?o:JSON.stringify(o)}else i[s]=e?n:JSON.stringify(n);else i[s]=n}return i}function rFt(t){return{geometryType:mW(t[0]),geometries:t.map(e=>e.toJSON())}}function Gmt(t,e,r){const i=xNe(e);return t.map(s=>{const n=i.fromJSON(s);return n.spatialReference=r,n})}let z1=class extends de{constructor(e){super(e),this.geometries=[],this.outSpatialReference=null,this.transformation=null,this.transformForward=null}toJSON(){const e=this.geometries.map(s=>s.toJSON()),r=this.geometries[0],i={};return i.outSR=this.outSpatialReference.wkid||JSON.stringify(this.outSpatialReference.toJSON()),i.inSR=r.spatialReference.wkid||JSON.stringify(r.spatialReference.toJSON()),i.geometries=JSON.stringify({geometryType:mW(r),geometries:e}),this.transformation&&(i.transformation=this.transformation.wkid||JSON.stringify(this.transformation)),this.transformForward!=null&&(i.transformForward=this.transformForward),i}};u([d()],z1.prototype,"geometries",void 0),u([d({json:{read:{source:"outSR"}}})],z1.prototype,"outSpatialReference",void 0),u([d()],z1.prototype,"transformation",void 0),u([d()],z1.prototype,"transformForward",void 0),z1=u([R("esri.rest.support.ProjectParameters")],z1);const xJ=z1,jmt=Zs(xJ);async function bAe(t,e,r){e=jmt(e);const i=zmt(t),s={...i.query,f:"json",...e.toJSON()},n=e.outSpatialReference,o=mW(e.geometries[0]),a=Vmt(s,r);return qt(i.path+"/project",a).then(({data:{geometries:l}})=>Gmt(l,o,n))}async function TJ(t=null,e){if(Ur.geometryServiceUrl)return Ur.geometryServiceUrl;if(!t)throw new F("internal:geometry-service-url-not-configured");let r;r="portal"in t?t.portal||Qn.getDefault():t,await r.load({signal:e});const i=r.helperServices?.geometry?.url;if(!i)throw new F("internal:geometry-service-url-not-configured");return i}async function Hmt(t,e,r=null,i){const s=await TJ(r,i),n=new xJ;n.geometries=[t],n.outSpatialReference=e;const o=await bAe(s,n,{signal:i});if(o&&Array.isArray(o)&&o.length===1)return o[0];throw new F("internal:geometry-service-projection-failed")}const qmt=Object.freeze(Object.defineProperty({__proto__:null,getGeometryServiceURL:TJ,projectGeometry:Hmt},Symbol.toStringTag,{value:"Module"}));let Wmt=class{constructor(e,r){this.spatialReference=r,this.unitInMeters=Za(this.spatialReference,Nr(this.spatialReference).metersPerDegree),this._geometryServiceURLPromise=TJ(e&&e.get("portalItem")).catch(()=>{throw new F("mapcoordshelper:missing-geometry-service","Must specify geometryService in esri/config")})}async toGeographic(e){const r=await this._geometryServiceURLPromise;let i,s=!0;Array.isArray(e[0])&&typeof e[0]!="number"?i=e:(i=[e],s=!1);const n=i.map(l=>l instanceof pt?l:new pt(l,this.spatialReference)),o=new xJ({geometries:n,outSpatialReference:je.WGS84}),a=(await bAe(r,o)).map(l=>l.type==="point"?[l.x,l.y]:void 0).filter(l=>!!l);return s?a:a[0]}},Od=class extends Te{constructor(){super(...arguments),this.minTotalNumberOfFeatures=2e3,this.maxTotalNumberOfFeatures=5e4,this.maxTotalNumberOfPrimitives=17e5,this.snapshotAvailable=!0,this.polygonLodFactor=1,this.polylineLodFactor=1,this.skipHighSymbolLods=!1}};u([d()],Od.prototype,"minTotalNumberOfFeatures",void 0),u([d()],Od.prototype,"maxTotalNumberOfFeatures",void 0),u([d()],Od.prototype,"maxTotalNumberOfPrimitives",void 0),u([d()],Od.prototype,"snapshotAvailable",void 0),u([d()],Od.prototype,"polygonLodFactor",void 0),u([d()],Od.prototype,"polylineLodFactor",void 0),u([d()],Od.prototype,"skipHighSymbolLods",void 0),Od=u([R("esri.views.3d.support.QualitySettings.Graphics3DSettings")],Od);let Lf=class extends Te{constructor(){super(...arguments),this.lodFactor=1}};u([d()],Lf.prototype,"lodFactor",void 0),Lf=u([R("esri.views.3d.support.QualitySettings.LoDFactorSettings")],Lf);let j4=class extends Lf{constructor(){super(...arguments),this.lodCrossfadeinDuration=0,this.lodCrossfadeoutDuration=0,this.lodCrossfadeUncoveredDuration=0}};j4=u([R("esri.views.3d.support.QualitySettings.LoDFactor3DObjectSettings")],j4);let ig=class extends Te{constructor(){super(...arguments),this.object=new j4,this.point=new Lf,this.integratedMesh=new Lf,this.pointCloud=new Lf,this.uncompressedTextureDownsamplingEnabled=!1}};u([d({type:j4})],ig.prototype,"object",void 0),u([d({type:Lf})],ig.prototype,"point",void 0),u([d({type:Lf})],ig.prototype,"integratedMesh",void 0),u([d({type:Lf})],ig.prototype,"pointCloud",void 0),u([d()],ig.prototype,"uncompressedTextureDownsamplingEnabled",void 0),ig=u([R("esri.views.3d.support.QualitySettings.SceneServiceSettings")],ig);let D0=class extends Te{constructor(){super(...arguments),this.lodBias=0,this.angledSplitBias=1,this.reduceTileLevelDifferences=!0,this.textureFadeDuration=400}};u([d()],D0.prototype,"lodBias",void 0),u([d()],D0.prototype,"angledSplitBias",void 0),u([d()],D0.prototype,"reduceTileLevelDifferences",void 0),u([d()],D0.prototype,"textureFadeDuration",void 0),D0=u([R("esri.views.3d.support.QualitySettings.TiledSurfaceSettings")],D0);let fS=class extends Te{constructor(){super(...arguments),this.pixelRatio=1,this.maxTotalNumberOfFeatures=5e4}};u([d()],fS.prototype,"pixelRatio",void 0),u([d()],fS.prototype,"maxTotalNumberOfFeatures",void 0),fS=u([R("esri.views.3d.support.QualitySettings.HeatmapSettings")],fS);let Po=class extends Te{constructor(){super(...arguments),this.graphics3D=new Od,this.sceneService=new ig,this.tiledSurface=new D0,this.heatmap=new fS,this.fadeDuration=400,this.antialiasingEnabled=!0,this.physicallyBasedRenderingEnabled=!1,this.highQualityTransparency=!0,this.highResolutionAtmosphere=!1,this.reflections=!1,this.ambientOcclusion=!1,this.memoryLimit=750,this.additionalCacheMemory=0,this.frameRate=void 0,this.maximumPixelRatio=1/0}};u([d({type:Od})],Po.prototype,"graphics3D",void 0),u([d({type:ig})],Po.prototype,"sceneService",void 0),u([d({type:D0})],Po.prototype,"tiledSurface",void 0),u([d({type:fS})],Po.prototype,"heatmap",void 0),u([d()],Po.prototype,"fadeDuration",void 0),u([d()],Po.prototype,"antialiasingEnabled",void 0),u([d()],Po.prototype,"physicallyBasedRenderingEnabled",void 0),u([d()],Po.prototype,"highQualityTransparency",void 0),u([d()],Po.prototype,"highResolutionAtmosphere",void 0),u([d()],Po.prototype,"reflections",void 0),u([d()],Po.prototype,"ambientOcclusion",void 0),u([d()],Po.prototype,"memoryLimit",void 0),u([d()],Po.prototype,"additionalCacheMemory",void 0),u([d()],Po.prototype,"frameRate",void 0),u([d()],Po.prototype,"maximumPixelRatio",void 0),Po=u([R("esri.views.3d.support.QualitySettings.QualitySettings")],Po);const Kae=Po;function Zmt(t){return B2(t)&&t.length>=3}function Xmt(t){return(G2(t)||Array.isArray(t))&&t.length>=3}function Ymt(t){return Zmt(t)||Xmt(t)}let Jmt=class OH{constructor(e,r,i,s){this.viewingMode=e,this.spatialReference=r,this.unitInMeters=i,this._coordinateSystem=s,this._tmpCoordinateSystem=WZe(s)}set extent(e){e&&ZZe(this._coordinateSystem,e,this._coordinateSystem)}getAltitude(e){return rXe(this._coordinateSystem,e)}setAltitude(e,r,i=e){return Gbe(this._coordinateSystem,i,r,e)}setAltitudeOfTransformation(e,r){iXe(this._coordinateSystem,r,e,r)}worldUpAtPosition(e,r){return QZe(this._coordinateSystem,e,r)}worldBasisAtPosition(e,r,i){return KZe(this._coordinateSystem,e,r,i)}basisMatrixAtPosition(e,r){const i=this.worldBasisAtPosition(e,pc.X,Le.get()),s=this.worldBasisAtPosition(e,pc.Y,Le.get()),n=this.worldBasisAtPosition(e,pc.Z,Le.get());return tm(r,i[0],i[1],i[2],0,s[0],s[1],s[2],0,n[0],n[1],n[2],0,0,0,0,1),r}headingAtPosition(e,r){const i=this.worldUpAtPosition(e,Le.get()),s=this.worldBasisAtPosition(e,pc.Y,Le.get()),n=sbe(r,s,i);return qa(n)}intersectManifoldClosestSilhouette(e,r,i){return XU(this._coordinateSystem,r,this._tmpCoordinateSystem),tXe(this._tmpCoordinateSystem,e,i),i}intersectManifold(e,r,i){XU(this._coordinateSystem,r,this._tmpCoordinateSystem);const s=Le.get();return eXe(this._tmpCoordinateSystem,e,s)?ie(i,s):null}intersectInfiniteManifold(e,r,i){if(this.viewingMode===De.Global)return this.intersectManifold(e,r,i);XU(this._coordinateSystem,r,this._tmpCoordinateSystem);const s=this._tmpCoordinateSystem.value,n=Le.get();return Fw(s.plane,e,n)?ie(i,n):null}toRenderCoords(e,r,i){return b4(e)?wo(e,r,this.spatialReference):Ws(e,r,i,this.spatialReference)}fromRenderCoords(e,r,i=null){return b4(r)?(i!=null&&(r.spatialReference=i),LZ(e,this.spatialReference,r)):Ymt(r)?Ws(e,this.spatialReference,r,i)?r:null:Ug(e,this.spatialReference,r)}static create(e,r){switch(e){case De.Local:return new OH(De.Local,r,Za(r),JZe());case De.Global:return new OH(De.Global,r,1,YZe(r))}}static renderUnitScaleFactor(e,r){return iK(e)/iK(r)}};var bf;(function(t){t[t.ELEVATION=0]="ELEVATION",t[t.BASEMAP=1]="BASEMAP",t[t.I3S_INDEX=2]="I3S_INDEX",t[t.I3S_DATA=3]="I3S_DATA",t[t.SYMBOLOGY=4]="SYMBOLOGY"})(bf||(bf={}));const Qmt=(()=>{const t=new Array;return t[bf.ELEVATION]=10,t[bf.BASEMAP]=10,t[bf.I3S_INDEX]=10,t[bf.I3S_DATA]=10,t[bf.SYMBOLOGY]=5,t})(),Kmt=30;function wAe(t){return"usedMemory"in t&&"unloadedMemory"in t&&"ignoresMemoryFactor"in t}function egt(t){return new hl({view:t})}const n$=1,K9=1,tgt=.75,rgt=.6,ele=1.3;let hl=class extends Te{constructor(e){super(e),this._quality=1,this._usedMemory=0,this._updating=!1,this.minQuality=.1,this._stableQuality=0,this._downscaleMemoryUsed=0,this._canFastRecover=!1,this._memoryPredicted=0,this._cacheStorage=new Xye,this._warnMemoryUsage=null,this._numQualityChanges=0,this._maxMemory=750,this._additionalCacheMemory=0}destroy(){this._cacheStorage.destroy()}set maxMemory(e){e==null||e<=0||(this._stableQuality=0,this._canFastRecover=!1,this._maxMemory<e&&this._updateQuality(n$),this._maxMemory=e)}get maxMemory(){return this._maxMemory}set additionalCacheMemory(e){e!=null&&(this._additionalCacheMemory=e)}get additionalCacheMemory(){return this._additionalCacheMemory}get memoryFactor(){return this._quality}get updating(){return this._updating}get usedMemory(){return this._usedMemory}newCache(e,r){return new q8e(e,this._cacheStorage,r)}resetStableQuality(){this._stableQuality=0}disableMemCache(){this.additionalCacheMemory=-4096}update(){if(this._updateMemory(),this._memoryPredicted<=0&&!this._updating)return;let e=this._layersUpdating();if(this._memoryPredicted<rgt&&this._canFastRecover)this._downscaleMemoryUsed=0,this._stableQuality=0,this._canFastRecover=!1,this._updateQuality(n$);else if(e)(this._memoryPredicted>1.1*K9||this._usedMemory>K9)&&(this._stableQuality>0?(this._downscaleMemoryUsed=0,this._updateQuality(this._stableQuality)):this._quality>this.minQuality&&this._downscaleMemoryUsed<this._usedMemory&&(this._updateQuality(this._quality/ele),this._downscaleMemoryUsed=this._usedMemory,this._canFastRecover=!1));else if(this._downscaleMemoryUsed=0,this._usedMemory>K9)this._stableQuality=0,this._canFastRecover=!1,e=this._updateQuality(this._quality/ele),this._downscaleMemoryUsed=this._memoryPredicted;else if(this._stableQuality!==this._quality)if(this._usedMemory<tgt&&this._quality<n$){this._stableQuality=this._quality;const r=.05;e=this._updateQuality(this._quality+r)}else this._quality<1&&(this._canFastRecover=!0);this._updating=e}_updateQuality(e){return(e=Math.min(Math.max(e,this.minQuality),n$))!==this._quality&&(this._quality=e,++this._numQualityChanges,!0)}_layersUpdating(){return this.view.allLayerViews.some(e=>!!e.updating)}_updateMemory(){if(!this.view)return;let e=0;this.view.basemapTerrain&&(e+=this.view.basemapTerrain.usedMemory);const r=this.view?._stage&&this.view._stage.renderView&&this.view._stage.renderer?.edgeView;r!=null&&(e+=r.usedMemory);let i=0;this.view.allLayerViews&&this.view.allLayerViews.forEach(a=>{if(wAe(a)){const l=a.ignoresMemoryFactor?this._quality:1;e+=a.usedMemory*l,i+=a.unloadedMemory*l}});const s=this._warnMemoryUsage==null||Math.round(10*e)!==Math.round(10*this._warnMemoryUsage),n=1048576*this.maxMemory;if(e>n&&s){this._warnMemoryUsage=e;const a=c=>(c/1048576).toLocaleString(void 0,{maximumFractionDigits:1})+" MB",l=Math.round(100*this._quality);Q.getLogger(this).warn(`Memory Limit exceeded! Limit: ${a(n)} Current: ${a(e)} Projected: ${a(e+i)} Quality: ${l}%`)}this._usedMemory=e/n,this._memoryPredicted=(e+i)/n;const o=n-e;this._cacheStorage.maxSize=Math.max(0,o+1048576*this.additionalCacheMemory)}get test(){const e=this;return{cacheStorage:this._cacheStorage,resetQualityChanges:()=>{const r=e._numQualityChanges;return e._numQualityChanges=0,r}}}};u([d({constructOnly:!0})],hl.prototype,"view",void 0),u([d()],hl.prototype,"maxMemory",null),u([d()],hl.prototype,"additionalCacheMemory",null),u([d()],hl.prototype,"memoryFactor",null),u([d()],hl.prototype,"updating",null),u([d()],hl.prototype,"usedMemory",null),u([d()],hl.prototype,"_quality",void 0),u([d()],hl.prototype,"_usedMemory",void 0),u([d()],hl.prototype,"_updating",void 0),u([d()],hl.prototype,"_stableQuality",void 0),u([d()],hl.prototype,"_maxMemory",void 0),u([d()],hl.prototype,"_additionalCacheMemory",void 0),hl=u([R("esri.views.3d.support.MemoryController")],hl);let igt=class{constructor(e){this.client=e,this._cancelled=!1,this.size=0,this.duration=0}},sgt=class{constructor(e){this.typeWorkerQuota=e,this.tasks=new Array,this.numWorkers=0,this.statistics=new ngt}},ngt=class{constructor(){this.requests=0,this.size=0,this.duration=0,this.speed=0}},ogt=class{constructor(e,r,i,s){this._workerFunc=e,this._callbackFunc=r,this._maxTotalNumWorkers=i,this._totalNumWorkers=0,this._clients=s.map(n=>new sgt(n))}destroy(){this._clients.length=0}hasQuota(e){const r=this._clients[e];return!!r&&(this._totalNumWorkers<this._maxTotalNumWorkers||r.numWorkers+r.tasks.length<r.typeWorkerQuota)}push(e){const r=this._clients[e.client];r&&(this._totalNumWorkers<this._maxTotalNumWorkers?(r.numWorkers++,this._totalNumWorkers++,this._workerFunc(e,(i,s)=>this._taskCallback(i,s))):r.tasks.push(e))}cancel(e){this._taskFinished(e),e._cancelled=!0}_taskFinished(e){const r=this._clients[e.client];this._totalNumWorkers--,r&&(r.numWorkers--,r.statistics.requests++,r.statistics.size+=e.size||0,r.statistics.duration+=e.duration||0,r.statistics.speed=r.statistics.duration>0?r.statistics.size/r.statistics.duration:0,et(r.numWorkers>=0)),this._next()}_next(){for(const e of this._clients)if(e&&e.numWorkers<e.typeWorkerQuota&&this._processQueue(e))return;for(const e of this._clients)if(e&&this._processQueue(e))return}_processQueue(e){for(;e.tasks.length>0;)if(this._workerFunc(e.tasks.shift(),(r,i)=>this._taskCallback(r,i)))return e.numWorkers++,this._totalNumWorkers++,!0;return!1}_taskCallback(e,r){e._cancelled||(this._callbackFunc(e,r),this._taskFinished(e))}getStatsForType(e){const r=this._clients[e];return r?{quota:r.typeWorkerQuota,workers:r.numWorkers,queueSize:r.tasks.length,requestStats:r.statistics}:null}get test(){const e=this;return{set workerFunc(r){e._workerFunc=r}}}},mD=class extends Te{constructor(){super(...arguments),this._tasks=new Map,this._onLoadQueue=new Array,this._doneQueue=new Array,this.updating=!1}setup(e,r,i){this._loadQueue=new ogt((s,n)=>this._startLoading(s,n),(s,n)=>this._doneLoadingCB(s,n),e,r),i&&(this._frameTask=i.registerTask(dt.STREAM_DATA_LOADER,this))}destroy(){this._frameTask=Ii(this._frameTask),this._tasks.forEach(e=>pu(e.abortController)),this._loadQueue=Me(this._loadQueue),this._onLoadQueue=null,this._doneQueue=null,this._tasks=null}hasDownloadSlots(e){return this._loadQueue.hasQuota(e)}request(e,r,i,s={}){const n=qs();n.__signal=s!=null?s.signal:null;const o=this._createOrUpdateTask(e,r,i,s,n);return nn(s,()=>this._cancelRequest(o,n)),n.promise}_createTask(e,r,i,s,n,o){const a=new cgt(e,r,i,s,n);return this._updateTask(a,o),this._tasks.set(n,a),this._tasks.size===1&&this._set("updating",!0),this._loadQueue.push(a),a}_cancelRequest(e,r){dO(e.resolvers,r),r.reject(Dr()),e.resolvers.length===0&&(e.status===Yu.DOWNLOADING&&(e.status=Yu.CANCELLED,this._loadQueue.cancel(e),e.abortController?.abort(),e.request=null,e.abortController=null),e.status=Yu.CANCELLED,this._tasks.delete(e.key),this._tasks.size===0&&this._set("updating",!1))}_updateTask(e,r){e.resolvers.push(r)}_createOrUpdateTask(e,r,i,s,n){const o=ugt(s!=null&&s.uid||e,r,i),a=this._tasks.get(o);return a?(this._updateTask(a,n),a):this._createTask(e,s,r,i,o,n)}_doneLoadingCB(e,r){this._loadQueue&&(et(e.status===Yu.DOWNLOADING),e.status=Yu.DOWNLOADED,this._frameTask?this._doneQueue.push({task:e,err:r}):this._doneLoading(e,r))}get running(){return this._doneQueue.length>0||this._onLoadQueue.length>0}runTask(e){for(;!e.done&&this._onLoadQueue.length>0;){const r=this._onLoadQueue.shift();Xt(r.task.abortController),r.task.abortController=null,r.callback(r.task),e.madeProgress()}for(;!e.done&&this._doneQueue.length>0;){const r=this._doneQueue.shift();r.task.status!==Yu.DOWNLOADED&&(r.err=r.err||Dr()),this._doneLoading(r.task,r.err),e.madeProgress()}}_doneLoading(e,r){if(r&&!ms(r)&&e.numRetries>0)return--e.numRetries,void this._loadQueue.push(e);let i=e.result instanceof HTMLImageElement?0:e.resolvers.length;for(const s of e.resolvers)if(r)ms(r)?s.reject(r):s.reject(new F("stream-data-loader:request-error",`Failed to request resource at '${e.url}'. ${r}`,{url:e.url,error:r}));else{--i;const n=i<=0?e.result:K(e.result);s.resolve(n)}this._tasks.delete(e.key),this._tasks.size===0&&this._set("updating",!1)}_startLoading(e,r){if(e.status===Yu.CANCELLED)return!1;let i,s;switch(e.startTime=performance.now(),e.status=Yu.DOWNLOADING,e.docType){case"binary":s="array-buffer",i=0;break;case"image":s="image";break;case"image+type":s="array-buffer";break;default:s="json"}e.abortController=new AbortController;const n=e.abortController.signal;e.request=qt(e.url,{...e.options,responseType:s,timeout:i,signal:n});let o=()=>{};const a=c=>{e.duration=performance.now()-e.startTime,e.size=c instanceof ArrayBuffer?c.byteLength:e.size||0,e.result=c,this._frameTask?this._onLoadQueue.push({callback:r,task:e}):(e.abortController=null,r(e))},l=c=>{e.status===Yu.DOWNLOADING&&r(e,c),o()};return e.docType!=="image+type"?(e.request.then(c=>a(c.data),l),!0):(e.request.then(c=>{const h=c.data,p=lgt(h);if(s="image",e.size=h.byteLength,p==="unknown")return e.request=qt(e.url,{responseType:s,timeout:i,signal:n}),void e.request.then(y=>a(y.data),l);const f=new Blob([h],{type:p}),m=window.URL.createObjectURL(f);o=()=>window.URL.revokeObjectURL(m),e.request=qt(m,{responseType:s,timeout:i,signal:n}),e.request.then(y=>a(new O6(y.data,p,o)),l)},l),!0)}get test(){return{loadQueue:this._loadQueue}}};u([d({readOnly:!0})],mD.prototype,"updating",void 0),mD=u([R("esri.views.3d.support.StreamDataLoader")],mD);const agt={numRetries:0};function lgt(t){if(t.byteLength<2)return"unknown";const e=new Uint8Array(t,0,t.byteLength);return e[0]===137&&e[1]===80?"image/png":e[0]===71&&e[1]===73?"image/gif":e[0]===66&&e[1]===77?"image/bmp":e[0]===255&&e[1]===216?"image/jpeg":"unknown"}let O6=class{constructor(e,r,i){this.image=e,this.type=r,this.release=i}get isOpaque(){return this.type==="image/jpeg"}},cgt=class extends igt{constructor(e,r,i,s,n){super(s),this.url=e,this.options=r,this.docType=i,this.key=n,this.result=null,this.status=Yu.QUEUED,this.request=null,this.abortController=null,this.resolvers=new Array,this.startTime=0,this.numRetries=agt.numRetries}};function ugt(t,e,r){return`${t}:${e}:${r}`}var Yu;(function(t){t[t.QUEUED=1]="QUEUED",t[t.DOWNLOADING=2]="DOWNLOADING",t[t.DOWNLOADED=3]="DOWNLOADED",t[t.CANCELLED=4]="CANCELLED"})(Yu||(Yu={}));let gD=class extends Te{constructor(){super(...arguments),this.updating=!1}};function hgt(t){return new wd({view:t})}u([d({readOnly:!0})],gD.prototype,"updating",void 0),gD=u([R("esri.views.3d.support.ResourceControllerMain")],gD);let wd=class extends gD{constructor(){super(...arguments),this._immediateTask=x2,this._normalTask=x2,this._updatingObjects=kO([]),this._frameTask=null}get immediate(){return this._immediateTask}get normal(){return this._normalTask}initialize(){this._scheduler=FXe(),this._memoryController=egt(this.view),this._streamDataLoader=new mD,this._streamDataLoader.setup(Kmt,Qmt,this._scheduler),this.addHandles([le(()=>this.view.state?.mode,e=>{e!=null&&(this._scheduler.state=e)},jr),le(()=>this.view.stationary,()=>this._stationaryChangedHandler())]),this._frameTask=JS({update:e=>this._frame(e)}),this._immediateTask=this._scheduler.registerTask(dt.RESOURCE_CONTROLLER_IMMEDIATE),this._normalTask=this._scheduler.registerTask(dt.RESOURCE_CONTROLLER)}destroy(){this._immediateTask.remove(),this._normalTask.remove(),this._frameTask=Ii(this._frameTask),this._streamDataLoader=Me(this._streamDataLoader),this._memoryController=Me(this._memoryController),this._scheduler=Me(this._scheduler),this.view=null}get updating(){return!!(this._memoryController?.updating||this._streamDataLoader?.updating||this._immediateTask?.updating)||this._updatingObjects?.value.some(e=>e.updating)}get scheduler(){return this._scheduler}get memoryController(){return this._memoryController}createStreamDataRequester(e){const r=this._streamDataLoader;return{request:(i,s,n)=>r.request(i,s,e,n),get busy(){return!r.hasDownloadSlots(e)}}}addUpdatingObject(e){const r=this._updatingObjects;return r.value=[...r.value,e],bo(()=>{r.value=r.value.filter(i=>i!==e)})}_frame(e){this.view.suspended||this.view.stateManager&&(this.view.stateManager.step(Fq(e.deltaTime)),!this._scheduler)||(this._scheduler.updateBudget(e)?(this._memoryController.update(),this._scheduler.frame()):this._memoryController.updating&&this._memoryController.update())}_stationaryChangedHandler(){this.memoryController.resetStableQuality()}get test(){return{getQueueStats:e=>this._streamDataLoader.test.loadQueue.getStatsForType(e)}}};u([d()],wd.prototype,"view",void 0),u([d()],wd.prototype,"_scheduler",void 0),u([d()],wd.prototype,"_memoryController",void 0),u([d()],wd.prototype,"_streamDataLoader",void 0),u([d()],wd.prototype,"_immediateTask",void 0),u([d()],wd.prototype,"_normalTask",void 0),u([d()],wd.prototype,"_updatingObjects",void 0),u([d({readOnly:!0})],wd.prototype,"updating",null),wd=u([R("esri.views.3d.support.ResourceControllerImpl")],wd);function dgt(t){return wAe(t)}function pgt(t){return"performanceInfo"in t}var ra,nt;(function(t){t[t.INSIDE=0]="INSIDE",t[t.INTERSECTS=1]="INTERSECTS",t[t.OUTSIDE=2]="OUTSIDE"})(ra||(ra={})),function(t){t[t.NORTH=0]="NORTH",t[t.NORTH_EAST=1]="NORTH_EAST",t[t.EAST=2]="EAST",t[t.SOUTH_EAST=3]="SOUTH_EAST",t[t.SOUTH=4]="SOUTH",t[t.SOUTH_WEST=5]="SOUTH_WEST",t[t.WEST=6]="WEST",t[t.NORTH_WEST=7]="NORTH_WEST"}(nt||(nt={}));const Vx=C(),fgt=C(),bm=C(),wm=C();function mgt(t,e,r=0){const i=t.extent;if(i==null)return!1;if(r===0)return Nfe(i,e);const s=Math.min(i[2]-i[0],i[3]-i[1]);return lNe(i,e,r*s)}function o$(t,e,r,i){ie(Vx,r),Vx[i]=e[i];const s=he(Vx,Vx,e),n=he(fgt,t,e),o=fe(n,s),a=fe(s,s);let l;l=o<=0?e:a<=o?r:ce(Vx,e,te(s,s,o/a));const c=he(Vx,t,l);return Math.PI/2-Math.atan(c[2]/Math.sqrt(c[0]*c[0]+c[1]*c[1]))}function ggt(t,e,r){const i=t.extent;if(i==null)return 0;bm[0]=i[0],bm[1]=i[1],bm[2]=r,wm[0]=i[2],wm[1]=i[3],wm[2]=r;let s=1/0,n=1/0;return e[0]<bm[0]?s=o$(e,bm,wm,0):e[0]>wm[0]&&(s=o$(e,wm,bm,0)),e[1]<bm[1]?n=o$(e,bm,wm,1):e[1]>wm[1]&&(n=o$(e,wm,bm,1)),Math.min(s,n)}function ygt(t,e,r){if(t==null)return TX();if(t.spatialReference.isGeographic&&!$_(t.spatialReference))return new F("tilingscheme:local-unsupported-spatial-reference","The tiling scheme spatial reference is not supported in local scenes");const i=ac.checkUnsupported(t);if(i!=null)return i;if(r==null)return new F("tilingscheme:extent-not-exist","The layer does not provide a layer extent.");const s=_gt(t,r);if(s)return s;const n=t.spatialReference;return e==null||n.equals(e)||e.isWGS84&&n.isWebMercator?null:new F("tilingscheme:spatial-reference-mismatch","The tiling scheme does not match the spatial reference of the local scene")}function _gt(t,e){const r=t.lods,i=r[0].resolution*2**r[0].level,s=[i*t.size[0],i*t.size[1]],n=[t.origin.x,t.origin.y],o=Lfe(e),a=Ut();ac.computeRowColExtent(o,s,n,a);const l=(a[2]-a[0])*(a[3]-a[1]);if(l>iS){const c=r[0].scale*2**r[0].level;let h=Math.max((o[3]-o[1])/t.size[1],(o[2]-o[0])/t.size[0])*c/i;const p=Math.floor(Math.log(h)/Math.log(10));return h=Math.ceil(h/10**p)*10**p,new F("tilingscheme:too-many-root-tiles","Scale of level 0 of the tiling scheme (1:"+Math.floor(c).toLocaleString()+") is too large for the layer's extent. Suggested scale: 1:"+h.toLocaleString()+".",{level0Scale:c,suggestedLevel0Scale:h,requiredNumRootTiles:l,allowedNumRootTiles:iS})}return null}const vgt=Object.freeze(Object.defineProperty({__proto__:null,checkIfTileInfoSupportedForViewSR:ygt,isInsideExtent:mgt,tiltToExtentEdge:ggt},Symbol.toStringTag,{value:"Module"}));function bgt(){return!0}function wgt(){return 0}function xgt(t,e){if(t==null)return TX();const r=t.lods.length-1,i=t.spatialReference,s=$_(i)||Qf(i)||Kf(i);if(i.isWebMercator){if(!ac.makeWebMercatorAuxiliarySphere(r).compatibleWith(t))return new F("tilingscheme:incompatible-global-web-mercator","The tiling scheme is not compatible with the ArcGIS Online Web Mercator tiling scheme")}else{if(!s)return new F("tilingscheme:global-unsupported-spatial-reference","The tiling scheme spatial reference is not supported in global scenes");if(!ac.makeGCSWithTileSize(t.spatialReference,t.size[0],r).compatibleWith(t))return t.spatialReference.isWGS84?new F("tilingscheme:incompatible-global-wgs84","The tiling scheme is not compatible with the ArcGIS Online WGS84 tiling scheme"):new F("tilingscheme:incompatible-global","The tiling scheme is not compatible with the ArcGIS Online tiling scheme")}return e==null||t.spatialReference.equals(e)?void 0:new F("tilingscheme:spatial-reference-mismatch","The tiling scheme does not match the spatial reference of the global scene")}const Tgt=Object.freeze(Object.defineProperty({__proto__:null,checkIfTileInfoSupportedForViewSR:xgt,isInsideExtent:bgt,tiltToExtentEdge:wgt},Symbol.toStringTag,{value:"Module"})),Sgt={[De.Global]:Tgt,[De.Local]:vgt};function pf(t,e){t||console.warn("Terrain: "+e)}let ln=!1,H4=!1;function Egt(t){H4=t,ln=ln||t}function Cgt(t){ln=t}function xe(t,e){if(ln&&!t){const r=new Error().stack?.slice(5);throw console.warn("Terrain internal: "+(e??"")+" at "+r),new Error("Assertion failed"+(e?": "+e:""))}}function RH(t){return R6(t)?{fullExtent:t.fullExtent,minScale:t.layer.minScale,maxScale:t.layer.maxScale,tilemapCache:null}:t.layer}function q4(t){return t?.type==="imagery-tile"||t?.type==="wcs"}function R6(t){return t?.type==="imagery-tile-3d"}function SJ(t){return t?.type==="tile-3d"}function cR(t){return t?.type==="vector-tile-3d"}function xAe(t){return t?.type==="wmts-3d"}function PH(t){return t?.type==="elevation-3d"}function CC(t){return t?.type==="group"}function W4(t){return t&&(SJ(t)||xAe(t)||R6(t)||cR(t))}function MH(t){return t&&(SJ(t)||R6(t)||cR(t)||xAe(t))}function uR(t){return MH(t)||PH(t)}function Agt(t){const e=t?.sourceLayerInfo?.data;return e!=null&&"type"in e&&e.type==="raster-tile"}function TAe(t){return SAe(t?.sourceLayerInfo)}function Ogt(t){const e=t?.sourceLayerInfo?.data;return e!=null&&"type"in e&&e.type==="tile-texture"}function Rgt(t){const e=t?.sourceLayerInfo?.data;return e instanceof HTMLImageElement||e instanceof O6||e instanceof HTMLCanvasElement||e instanceof ImageData}function SAe(t){return t?.data!=null&&"type"in t.data&&t.data.type==="vector-tile"}function jS(t){return t!=null&&"release"in t&&t.release(),null}function tle(t){return t.fetchTile&&t.hasOverriddenFetchTile!==!1}function EJ(t,e,r,i){return Sgt[i].checkIfTileInfoSupportedForViewSR(t,r,e)}function P6(t,e,r){let i=null,s=null;if(t?.type==="wmts"){const n=Pgt(t,e,r);i=n.tileInfo,s=n.fullExtent}else{s=q4(t)?t.getCompatibleFullExtent(e):t.fullExtent;const n=r===De.Local;if(q4(t))i=t.getCompatibleTileInfo(e,s,n);else if(t?.type==="vector-tile"){const o=n&&!Mgt(e)||Igt.force512VTL,a=t.tileInfo.spatialReference.isGeographic;i=o?t.tileInfo:t.tileInfo.getOrCreateCompatible(256,a?1:2)}else i=t.tileInfo}return i!=null&&s!=null&&EJ(i,s,e,r)==null?{tileInfo:i,fullExtent:s}:null}function Pgt(t,e,r){const i=NUe(t);if(i!=null){if(!Pt.isCollection(i))return{tileInfo:i.tileInfo,fullExtent:i.fullExtent};{const s=i.find(n=>EJ(n.tileInfo,n.fullExtent,e,r)==null);if(s)return{tileInfo:s.tileInfo,fullExtent:s.fullExtent}}}return{tileInfo:null,fullExtent:null}}function Mgt(t){return t.isWGS84||t.isWebMercator||Xpe(t)||!_O(t)}const Igt={force512VTL:!1};function rle(t){return"["+t[0]+","+t[1]+","+t[2]+"]"}function xm(t){return"("+t[0]+","+t[1]+","+t[2]+")"}function uh(t,e,r=Dgt){return Math.abs(t-e)<r}function Z4(t){return t===nt.NORTH_EAST?nt.SOUTH_WEST:t===nt.NORTH_WEST?nt.SOUTH_EAST:t===nt.SOUTH_WEST?nt.NORTH_EAST:nt.NORTH_WEST}function X4(t){return t===nt.NORTH?nt.SOUTH:t===nt.EAST?nt.WEST:t===nt.SOUTH?nt.NORTH:nt.EAST}function $gt(t){return t===nt.NORTH_WEST||t===nt.SOUTH_WEST}function Lgt(t){return t===nt.NORTH_WEST||t===nt.NORTH_EAST}function ile(t){return t===nt.NORTH_WEST||t===nt.WEST||t===nt.SOUTH_WEST}function sle(t){return t===nt.NORTH_EAST||t===nt.EAST||t===nt.SOUTH_EAST}function nle(t){return t===nt.SOUTH_EAST||t===nt.SOUTH||t===nt.SOUTH_WEST}function ole(t){return t===nt.NORTH_EAST||t===nt.NORTH||t===nt.NORTH_WEST}const Tf=[nt.NORTH,nt.EAST,nt.SOUTH,nt.WEST],hR=[nt.NORTH_EAST,nt.SOUTH_EAST,nt.SOUTH_WEST,nt.NORTH_WEST],Dgt=1e-5;let Ngt=class{constructor(e,r){if(this.layer=null,this.memory=0,this.displayedNumberOfFeatures=0,this.maximumNumberOfFeatures=null,this.totalNumberOfFeatures=null,this.layer=e.layer,this.memory=uR(e)?r.basemapTerrain.getUsedMemoryForLayerView(e):e.usedMemory,pgt(e)){const i=e.performanceInfo;this.displayedNumberOfFeatures=i.displayedNumberOfFeatures,this.maximumNumberOfFeatures=i.maximumNumberOfFeatures,this.totalNumberOfFeatures=i.totalNumberOfFeatures}}},Fgt=class{constructor(e){if(this.totalMemory=0,this.usedMemory=0,this.quality=1,this.load=0,this.terrainMemory=0,this.edgesMemory=0,this.layerPerformanceInfos=new Array,e.resourceController!=null){const i=e.resourceController.memoryController;this.totalMemory=(i.maxMemory??0)*cN.MEGABYTES,this.usedMemory=Math.round(i.usedMemory*this.totalMemory),this.quality=i.memoryFactor,this.load=e.resourceController.scheduler.load}this.terrainMemory=e.basemapTerrain?.usedMemory??0;const r=e._stage&&e._stage.renderView&&e._stage.renderer.edgeView;this.edgesMemory=r!=null?r.usedMemory:0,e.allLayerViews.items.forEach(i=>{(dgt(i)||uR(i))&&this.layerPerformanceInfos.push(new Ngt(i,e))}),this.layerPerformanceInfos.sort((i,s)=>s.memory-i.memory)}},Ugt=class{constructor(e){this._gltfLoading=new Map,this._wosrLoading=new Map,this._gltfMemCache=e("gltf-resources",()=>{}),this._wosrMemCache=e("wosr-resources",()=>{})}destroy(){this._gltfLoading.forEach(e=>e.abortController.abort()),this._wosrLoading.forEach(e=>e.abortController.abort()),this._gltfMemCache.destroy(),this._wosrMemCache.destroy()}loadGLTF(e,r,i){const s=i?`gltfPBR:${e}`:`gltf:${e}`,n=this._gltfMemCache.get(s);return n!=null?Promise.resolve(n):this._loadOnce(this._gltfLoading,this._gltfMemCache,s,o=>ACe(new ECe(o.streamDataRequester),e,o,i),r)}loadWOSR(e,r){const i=`wosr:${e}:${r.disableTextures}`,s=this._wosrMemCache.get(i);return s!=null?Promise.resolve(s):this._loadOnce(this._wosrLoading,this._wosrMemCache,i,n=>OCe(e,n),r)}async _loadOnce(e,r,i,s,n){Xt(n);const o=nn(n,()=>this._abortLoad(e,i));let a=e.get(i);if(a)a.refCount++;else{const l=new AbortController;a={refCount:1,abortController:l,promise:s({...n,signal:l.signal})},e.set(i,a)}try{const l=await a.promise;return r.put(i,l,l.size),e.delete(i),Xt(n),l}finally{Ii(o)}}_abortLoad(e,r){const i=e.get(r);i!=null&&--i.refCount>0||(e.delete(r),i?.abortController.abort())}},kgt=class extends sS{constructor(e,r,i){super(r,i),this._streamDataRequester=e}async fromUrl(e,r,i){Xt(i);const s=i!=null?i.signal:null,n=this.makeUid(e,r);let o=this._textureRequests.get(n);if(!o){const a=new AbortController,l=this._streamDataRequester.request(e,"image",{uid:n,signal:a.signal});o=new Ybe,o.abortController=a;const c=o;this._textureRequests.set(n,o),o.textureAsync=l.then(async h=>{const p=this._createTexture(e,h,r);return c.texture=p,c.abortController=null,this._stage.add(p),await this._stage.load(p),{uid:n,texture:p,release:()=>this._release(n)}},h=>{throw c.abortController=null,h})}o.referenceCount++;try{return await Mde(o.textureAsync,s)}catch(a){throw this._release(n),a}}_createTexture(e,r,i){const s={width:r.width,height:r.height,wrap:{s:$t.CLAMP_TO_EDGE,t:$t.CLAMP_TO_EDGE},preMultiplyAlpha:!0};if(Bde(e)){if(i||r.width===0&&r.height===0){const n=r.width?r.height/r.width:1;i=i||64,n>1?(r.width=Math.round(i/n),r.height=i):(r.width=i,r.height=Math.round(i*n))}this._stage.renderView?.renderingContext.driverTest.svgPremultipliesAlpha.result&&(s.preMultiplyAlpha=!1)}return new zw(r,s)}},Vgt=class{constructor(e){this.streamDataRequester=null,this._graphicsOwners=[],this._screenSizePerspectiveHandles=null,this.cimSymbolRasterizer=null,this._viewState=e.viewState,this._view=e.view,this._pointsOfInterest=e.pointsOfInterest,this.streamDataRequester=e.resourceController.createStreamDataRequester(bf.SYMBOLOGY),this.objectResourceCache=new Ugt((i,s)=>e.resourceController.memoryController.newCache(i,s)),this.textures=new kgt(this.streamDataRequester,e.view._stage,e.resourceController.scheduler);const r=Nr(this._view.spatialReference).radius;this.screenSizePerspectiveSettings=rSe(e.viewingMode,r),this.screenSizePerspectiveSettingsLabels=lst(e.viewingMode,r)}destroy(){this.textures.destroy(),this.streamDataRequester=null}addGraphicsOwner(e){if(!e)return bo();this._graphicsOwners.push(e);const r=le(()=>e.layer?.screenSizePerspectiveEnabled,()=>this._updateScreenSizePerspectiveEnabled());return this._updateScreenSizePerspectiveEnabled(),bo(()=>{r.remove(),dO(this._graphicsOwners,e),this._updateScreenSizePerspectiveEnabled()})}_updateScreenSizePerspectiveEnabled(){const e=this._graphicsOwners.some(r=>r.layer?.screenSizePerspectiveEnabled===!0);if(e&&!this._screenSizePerspectiveHandles){this._screenSizePerspectiveHandles=new Oi;const r=()=>this._updateScreenSizePerspectiveSettings();this._screenSizePerspectiveHandles.add([le(()=>this._pointsOfInterest.centerOnSurfaceInfrequent.distance,r,jr),this._viewState.events.on("camera-projection-changed",r)]),this._updateScreenSizePerspectiveSettings()}else e||(this._screenSizePerspectiveHandles=Me(this._screenSizePerspectiveHandles))}_updateScreenSizePerspectiveSettings(){const e=this._pointsOfInterest;a$.distance=e.centerOnSurfaceInfrequent.distance,a$.fovY=this._viewState.camera.fovY,this.screenSizePerspectiveSettings.update(a$),this.screenSizePerspectiveSettingsLabels.update(a$),this._view._stage.renderView.requestRender()}get test(){return{screenSizePerspectiveHandles:this._screenSizePerspectiveHandles}}};const a$={distance:0,fovY:0};let HT=class{constructor(e,r,i=""){this.graphics=e,this._symbol=new K0({symbolLayers:[new Q0({material:{color:r},outline:{color:[255,255,255],size:1},resource:{primitive:"circle"}}),new Pw({text:i,halo:{color:"white",size:1/.75},material:{color:r},size:12})]})}show(e,r){if(r==null)return;this.hide();const i=new pt({x:e[0],y:e[1],z:e[2],spatialReference:r});this._graphic=new Oh({geometry:i,symbol:this._symbol}),this.graphics.add(this._graphic)}hide(){this._graphic!=null&&(this.graphics.remove(this._graphic),this._graphic=null)}},H0=class extends Te{constructor(e){super(e),this.handles=new Oi}destroy(){this.handles.destroy()}};u([d({constructOnly:!0})],H0.prototype,"renderCoordsHelper",void 0),u([d({constructOnly:!0})],H0.prototype,"surface",void 0),u([d({constructOnly:!0})],H0.prototype,"state",void 0),H0=u([R("esri.views.3d.support.PointOfInterest")],H0);const zgt=Array;let xd=class extends H0{constructor(e){super(e),this._dirty=!1,this._propertiesPool=new kg({location:pt,renderLocation:zgt},this),this._estimatedSurfaceAltitude=0,this._pendingElevationQueryController=null,this.renderLocation=C(),this._tmpPoint=new pt}initialize(){if(this.scheduler&&this.handles.add(this.scheduler.registerTask(this.task,this)),this.runTask(),this.map){const e=()=>this._setDirty();this.handles.add(Ga(()=>this.map?.ground?.layers,"change",e,{onListenerAdd:e,onListenerRemove:e}))}this._updateRenderLocation()}destroy(){this._cancelPendingRequest(),this._propertiesPool=Me(this._propertiesPool)}get _camera(){return this.state.contentCamera}get location(){const e=this._propertiesPool.get("location");return this.renderCoordsHelper.fromRenderCoords(this.renderLocation,e,this.state.spatialReference),e}get scale(){const e=this._camera,r=di(e.eye,this.renderLocation),i={renderCoordsHelper:this.renderCoordsHelper,state:{camera:e}};return hw(i,r,0)}get updating(){return this._dirty||this._pendingElevationQueryController!=null}updateRenderLocation(){this._setDirty(),this._updateRenderLocation()}_setDirty(){this._dirty||(this._dirty=!0,this.notifyChange("updating"))}_cancelPendingRequest(){const e=this._pendingElevationQueryController;e&&(this._pendingElevationQueryController=null,e.abort(),this.notifyChange("updating"))}get running(){return!this._pendingElevationQueryController&&this._dirty}runTask(){if(this._cancelPendingRequest(),this._dirty=!1,this.notifyChange("updating"),!this.map||!this.map.ground)return this._updateSurfaceAltitude(0),jo.YIELD;const e=this.state.spatialReference;this.renderCoordsHelper.fromRenderCoords(this._camera.eye,this._tmpPoint,e);const r=(this._tmpPoint.z??0)>Bgt&&this.renderCoordsHelper.viewingMode===De.Global&&(e.isWGS84||e.isWebMercator);let i=new AbortController;return this.map.ground.queryElevation(this._tmpPoint,{signal:i.signal,cache:this.cache,minDemResolution:r?Ggt:0}).then(s=>this._updateSurfaceAltitude(s.geometry.z??0)).catch(s=>{ms(s)||this._updateSurfaceAltitude(0)}).catch(()=>{}).then(()=>{this._pendingElevationQueryController===i&&(this._pendingElevationQueryController=null,this.notifyChange("updating")),i=null}),this._pendingElevationQueryController=i,jo.YIELD}_updateSurfaceAltitude(e){this._estimatedSurfaceAltitude!==e&&(this._estimatedSurfaceAltitude=e,this._updateRenderLocation())}_updateRenderLocation(){this.renderCoordsHelper.setAltitude(ek,this._estimatedSurfaceAltitude,this._camera.eye),la(this._get("renderLocation"),ek)||(this._set("renderLocation",ie(this._propertiesPool.get("renderLocation"),ek)),this.notifyChange("renderLocation"))}};u([d({constructOnly:!0})],xd.prototype,"scheduler",void 0),u([d({constructOnly:!0})],xd.prototype,"cache",void 0),u([d({constructOnly:!0})],xd.prototype,"task",void 0),u([d({readOnly:!0})],xd.prototype,"location",null),u([d({constructOnly:!0})],xd.prototype,"map",void 0),u([d({readOnly:!0})],xd.prototype,"renderLocation",void 0),u([d({readOnly:!0})],xd.prototype,"scale",null),u([d({readOnly:!0})],xd.prototype,"updating",null),xd=u([R("esri.views.3d.support.CameraOnSurface")],xd);const ek=C(),Bgt=1e5,Ggt=1e6,jgt=Array;let Ju=class extends H0{constructor(e){super(e),this._propertiesPool=new kg({location:pt,renderLocation:jgt},this),this._currentSurfaceAltitude=0,this._latestSurfaceAltitude=0,this.distance=0,this.renderLocation=C(),this.updating=!1}initialize(){this._frameWorker=this.scheduler.registerTask(this.task,this),this.runTask()}destroy(){this._frameWorker=Ii(this._frameWorker),this._propertiesPool=Me(this._propertiesPool)}get _camera(){return this.state.contentCamera}get location(){const e=this._propertiesPool.get("location");return this.renderCoordsHelper.fromRenderCoords(this.renderLocation,e,this.state.spatialReference),e}updateRenderLocation(){this.updating=!0,this._updateRenderLocation()}get estimatedSurfaceAltitude(){return this._latestSurfaceAltitude}get running(){return this.updating}runTask(){return this._latestSurfaceAltitude=this.estimateSurfaceAltitudeAtCenter(),this._updateRenderLocation(),this.updating=!1,jo.YIELD}_updateRenderLocation(){const e=qgt;let r=this._calculateSurfaceIntersection(this._currentSurfaceAltitude,e);const i=this._currentSurfaceAltitude!==this._latestSurfaceAltitude;!r&&i&&(r=this._calculateSurfaceIntersection(this._latestSurfaceAltitude,e),r&&(this._currentSurfaceAltitude=this._latestSurfaceAltitude));const s=Wgt;r&&this._latestSurfaceAltitudeChangesDistanceSignificantly(e,s)&&(ie(e,s),this._currentSurfaceAltitude=this._latestSurfaceAltitude),r?this.distance=di(this._camera.eye,e):(te(e,this._camera.viewForward,this._get("distance")),ce(e,e,this._camera.eye)),la(this._get("renderLocation"),e)||this._set("renderLocation",ie(this._propertiesPool.get("renderLocation"),e))}_calculateSurfaceIntersection(e,r){const i=this._camera;if(!this.renderCoordsHelper.intersectManifold(i.ray,e,r))return!1;if(this.state.isGlobal){const s=Nr(this.renderCoordsHelper.spatialReference).radius,n=s+e,o=na(i.eye),a=o<n*n,l=di(i.eye,r);if(a&&l>s/4){const c=n-Math.sqrt(o);return te(r,i.viewForward,c),ce(r,r,i.eye),!0}}else{const s=this.surface?.ready?this.surface.extent:null;s!=null&&qR(s,this.surface?.spatialReference,AC,this.renderCoordsHelper.spatialReference)&&(r[0]=ge(r[0],AC[0],AC[2]),r[1]=ge(r[1],AC[1],AC[3]))}return!0}_latestSurfaceAltitudeChangesDistanceSignificantly(e,r){if(this._latestSurfaceAltitude===this._currentSurfaceAltitude||e==null)return!1;if(this._calculateSurfaceIntersection(this._latestSurfaceAltitude,r)){if(ni.TESTS_DISABLE_OPTIMIZATIONS)return!0;const i=this._camera.eye,s=di(i,e),n=di(i,r);if(Math.abs(n-s)/s>Hgt)return!0}return!1}};u([d({constructOnly:!0})],Ju.prototype,"scheduler",void 0),u([d({constructOnly:!0})],Ju.prototype,"task",void 0),u([d()],Ju.prototype,"distance",void 0),u([d({constructOnly:!0})],Ju.prototype,"estimateSurfaceAltitudeAtCenter",void 0),u([d({readOnly:!0})],Ju.prototype,"location",null),u([d({readOnly:!0})],Ju.prototype,"renderLocation",void 0),u([d()],Ju.prototype,"updating",void 0),Ju=u([R("esri.views.3d.support.CenterOnSurface")],Ju);const Hgt=.05,qgt=C(),Wgt=C(),AC=Ut();let Zgt=class{constructor(e){this._handles=new Oi,this.events=new os,this._contentLayerViews=e.contentLayerViews,this._handles.add(this._contentLayerViews.on("change",r=>this._layerViewsChanged(r))),this._layerViewsChanged({added:this._contentLayerViews.toArray(),removed:[],moved:[],target:this._contentLayerViews})}destroy(){this._handles=Me(this._handles),this._contentLayerViews.destroy()}_layerViewsChanged(e){e.added.forEach(r=>{r.declaredClass==="esri.views.3d.layers.SceneLayerView3D"&&this._handles.add(r.on("visible-geometry-changed",()=>this._contentChanged()),r.uid)}),e.removed.forEach(r=>this._handles.remove(r.uid))}_contentChanged(){this.events.emit("request-update",Xgt)}};const Xgt={},Ygt=Array;let rf=class extends H0{constructor(e){super(e),this._propertiesPool=new kg({location:pt,renderLocation:Ygt},this),this._dirty=!0,this.renderLocation=this._propertiesPool.get("renderLocation")}initialize(){this.handles.add([le(()=>this.centerOnSurface.renderLocation,()=>this.updateRenderLocation()),le(()=>this.state.contentCamera,()=>this.updateRenderLocation())]),this.scheduler&&this.handles.add(this.scheduler.registerTask(dt.POINT_OF_INTEREST_FREQUENT,this))}destroy(){this._propertiesPool=Me(this._propertiesPool)}get updating(){return this._dirty||this.centerOnSurface.updating}get location(){const e=this._propertiesPool.get("location");return this.renderCoordsHelper.fromRenderCoords(this.renderLocation,e,this.state.spatialReference),e}get running(){return this._dirty}runTask(){const e=this._get("renderLocation"),r=this.centerOnSurface.renderLocation,i=this.renderCoordsHelper,s=this.state.contentCamera;this._dirty=!1,i.worldUpAtPosition(r,ale);const n=Math.max(0,(Math.acos(fe(ale,s.viewForward))-.5*Math.PI)*(s.aboveGround?1:-1));if(Number.isNaN(n)){if(!e||!T_(e,r)){const c=this._propertiesPool.get("renderLocation");ie(c,r),this._set("renderLocation",c)}return jo.YIELD}const o=1-ge(n/(.5*Math.PI),0,1),a=o*o*o;this._calculateScreenHorizontalEdgeOnSurface(lle);const l=this._propertiesPool.get("renderLocation");return Br(l,r,lle,a),e&&T_(e,l)||this._set("renderLocation",l),jo.YIELD}_calculateScreenHorizontalEdgeOnSurface(e){const r=this.state.contentCamera,i=r.getRenderCenter(zo());if(i[1]=r.aboveGround?r.padding[er.BOTTOM]:r.fullHeight-r.padding[er.TOP],this.estimateSurfaceIntersectionAtRenderPoint(i,e))return e;const s=this.renderCoordsHelper.getAltitude(this.centerOnSurface.renderLocation);if(r.unprojectFromRenderScreen(i,OC)){he(OC,OC,r.eye);const n=me(OC,OC);if(this.renderCoordsHelper.intersectManifold(yu(r.eye,n),s,e))return e}return this.renderCoordsHelper.setAltitude(e,s,r.eye)}updateRenderLocation(){this._dirty=!0}};u([d()],rf.prototype,"_dirty",void 0),u([d({constructOnly:!0})],rf.prototype,"scheduler",void 0),u([d({constructOnly:!0})],rf.prototype,"centerOnSurface",void 0),u([d({constructOnly:!0})],rf.prototype,"estimateSurfaceIntersectionAtRenderPoint",void 0),u([d({readOnly:!0})],rf.prototype,"updating",null),u([d({readOnly:!0})],rf.prototype,"location",null),u([d({readOnly:!0})],rf.prototype,"renderLocation",void 0),rf=u([R("esri.views.3d.support.pointsOfInterest.Focus")],rf);const ale=C(),OC=C(),lle=C();let Zm=class extends Te{get surface(){return this.view.map?.ground}get surfaceView(){return this.view.basemapTerrain}get renderLocation(){if(!this.location)return null;const e=C();return this.view.renderCoordsHelper.toRenderCoords(this.location,e),e}constructor(e){super(e),this.location=null,this._updateController=null,this._handles=new Oi}initialize(){this.view.state.isLocal&&(this._handles.add([le(()=>[this.surfaceView?.spatialReference,this.surfaceView?.extent],()=>this._update()),Ga(()=>this.surface?.layers,"change",()=>this._update())]),this._update())}destroy(){this._handles.destroy()}_update(){if(this._updateController&&(this._updateController.abort(),this._updateController=null),!this.surfaceView||this.surfaceView.extent==null||this.surfaceView.spatialReference==null)return void this._set("location",null);const e=lW(this.surfaceView.extent),r=new pt({x:e[0],y:e[1],z:0,spatialReference:this.surfaceView.spatialReference});this.surface&&this.surface.layers.length>0?(this._set("location",null),this._updateController=new AbortController,this.surface.queryElevation(r,{noDataValue:0,signal:this._updateController.signal,cache:this.cache}).then(i=>{this._updateController=null,this._set("location",i.geometry)}).catch(i=>{ms(i)||i&&i.name==="elevation-query:invalid-layer"||console.error("StableSurfaceCenter failed to update: ",i)})):this._set("location",r)}};u([d({constructOnly:!0})],Zm.prototype,"view",void 0),u([d({constructOnly:!0})],Zm.prototype,"cache",void 0),u([d()],Zm.prototype,"surface",null),u([d()],Zm.prototype,"surfaceView",null),u([d({readOnly:!0})],Zm.prototype,"location",void 0),u([d({readOnly:!0})],Zm.prototype,"renderLocation",null),Zm=u([R("esri.views.3d.terrain.StableSurfaceCenter")],Zm);let Xm=class extends Te{constructor(e){super(e),this._tileGeometryUpdateExtent=wc(),this._tileGeometryUpdateSpatialReference=null,this.events=new os,this.updating=!1}initialize(){this.addHandles([this.surface.on("elevation-change",e=>this._tileGeometryChanged(e)),this.scheduler.registerTask(dt.SURFACE_GEOMETRY_UPDATES,this)])}get running(){return this.updating}runTask(){return this.updating&&(this._tileGeometryUpdateSpatialReference&&this._centerIntersectsExtent(this._tileGeometryUpdateExtent,this._tileGeometryUpdateSpatialReference)&&this.events.emit("request-update",Jgt),wc(this._tileGeometryUpdateExtent),this._set("updating",!1)),jo.YIELD}_tileGeometryChanged(e){this._tileGeometryUpdateSpatialReference=e.spatialReference,f_(this._tileGeometryUpdateExtent,e.extent,this._tileGeometryUpdateExtent),this._set("updating",!0)}_furthestCenterOnSurface(){let e=this.centerOnSurfaces[0];for(let r=1;r<this.centerOnSurfaces.length;r++){const i=this.centerOnSurfaces[r];i.distance>e.distance&&(e=i)}return e}_centerIntersectsExtent(e,r){const i=this.state.contentCamera.eye,s=Qgt,n=this._furthestCenterOnSurface();return this.renderCoordsHelper.fromRenderCoords(i,Bv,r),this.renderCoordsHelper.fromRenderCoords(n.renderLocation,Gv,r),Bv[0]<Gv[0]?(s[0]=Bv[0],s[2]=Gv[0]):(s[0]=Gv[0],s[2]=Bv[0]),Bv[1]<Gv[1]?(s[1]=Bv[1],s[3]=Gv[1]):(s[1]=Gv[1],s[3]=Bv[1]),MR(s,e)}};u([d({constructOnly:!0})],Xm.prototype,"state",void 0),u([d({constructOnly:!0})],Xm.prototype,"centerOnSurfaces",void 0),u([d({constructOnly:!0})],Xm.prototype,"renderCoordsHelper",void 0),u([d({constructOnly:!0})],Xm.prototype,"scheduler",void 0),u([d({constructOnly:!0})],Xm.prototype,"surface",void 0),u([d({readOnly:!0})],Xm.prototype,"updating",void 0),Xm=u([R("esri.views.3d.support.SurfaceGeometryUpdates")],Xm);const Jgt={},Bv=C(),Gv=C(),Qgt=wc();let pl=class extends Te{constructor(e){super(e),this._handles=new Oi,this._tmpRay=Xn(),this._centerRayDirty=!0,this._surfaceAltitudeAtCenter=0,this._surfaceAltitudeAtCenterDirty=!0,this._contentAltitudeAtCenter=0,this._contentAltitudeAtCenterDirty=!0,this._propertiesPool=new kg({renderPointOfView:Kgt},this),this.renderPointOfView=C(),this._pois=new Array,this._debugCenters=new Map}initialize(){const{state:e,basemapTerrain:r,renderCoordsHelper:i,map:s}=this.view;this._surfaceIntersector=Dh(e.viewingMode),e.isGlobal?this._surfaceIntersector.options.backfacesTerrain=!1:this._surfaceIntersector.options.backfacesTerrain=!0,this._surfaceIntersector.options.invisibleTerrain=!1,this._surfaceIntersector.options.store=vo.MIN,this._contentIntersector=Dh(e.viewingMode);const n=()=>this._estimateSurfaceAltitudeAtCenter(),o=this.view.resourceController.scheduler,a=this.view.basemapTerrain?.elevationQueryCache,l={state:e,scheduler:o,surface:r,renderCoordsHelper:i};this._set("centerOnSurfaceInfrequent",new Ju({...l,task:dt.POINT_OF_INTEREST_INFREQUENT,estimateSurfaceAltitudeAtCenter:n})),this._set("centerOnSurfaceFrequent",new Ju({...l,task:dt.POINT_OF_INTEREST_FREQUENT,estimateSurfaceAltitudeAtCenter:n})),this._set("centerOnContent",new Ju({...l,task:dt.POINT_OF_INTEREST_FREQUENT,estimateSurfaceAltitudeAtCenter:()=>this._estimateContentAltitudeAtCenter()})),this._set("cameraOnSurface",new xd({...l,cache:a,task:dt.POINT_OF_INTEREST_INFREQUENT,map:s})),this._set("surfaceGeometryUpdates",new Xm({...l,centerOnSurfaces:[this.centerOnSurfaceFrequent,this.centerOnContent,this.centerOnSurfaceInfrequent]})),this._set("contentGeometryUpdates",new Zgt({contentLayerViews:this.view.allLayerViews,renderCoordsHelper:i})),this._set("surfaceOrigin",new Zm({cache:a,view:this.view})),this._set("focus",new rf({state:e,scheduler:o,surface:r,renderCoordsHelper:i,centerOnSurface:this.centerOnSurfaceFrequent,estimateSurfaceIntersectionAtRenderPoint:(h,p)=>this._estimateSurfaceIntersectionAtRenderPoint(h,this.view.state.contentCamera,p)})),this._pois.push(this.centerOnContent,this.centerOnSurfaceFrequent,this.centerOnSurfaceInfrequent,this.cameraOnSurface,this.focus);const c=this.view.graphics;this._debugCenters.set(this.centerOnContent,new HT(c,"red","CenterOnContent")),this._debugCenters.set(this.centerOnSurfaceFrequent,new HT(c,"red","CenterOnSurface")),this._debugCenters.set(this.centerOnSurfaceInfrequent,new HT(c,"red","CenterOnSurface")),this._debugCenters.set(this.cameraOnSurface,new HT(c,"blue","CameraOnSurface")),this._debugCenters.set(this.focus,new HT(c,"green","Focus")),this._handles.add([le(()=>e.contentCamera,h=>this._cameraChanged(h),jr),le(()=>r.extent,()=>this._updateCenterPointsOfInterest()),Eh(()=>!r.updating,()=>this._updateCenterPointsOfInterest(),jr),Ga(()=>this.surfaceGeometryUpdates.events,"request-update",()=>this._updateCenterPointsOfInterest()),Ga(()=>this.contentGeometryUpdates.events,"request-update",()=>this._updateCenterOnContent()),Eh(()=>ni.SHOW_POI,h=>this._setDebug(h),Vr)]),this._cameraChanged(this.view.state.contentCamera);for(const h of this._pois)h.runTask()}destroy(){this._setDebug(!1),this._handles.destroy(),this._propertiesPool.destroy();for(const e of this._pois)e.destroy();this.surfaceOrigin.destroy()}get updating(){return!(!this.surfaceGeometryUpdates?.updating&&!this._pois.some(e=>e.updating))}get _centerRay(){return this._centerRayDirty&&(this._centerRayCached=this.view.sceneIntersectionHelper.getCenterRayWithSubpixelOffset(this.view.state.contentCamera,this._tmpRay),this._centerRayDirty=!1),this._centerRayCached}_estimateContentAltitudeAtCenter(){if(!this._contentAltitudeAtCenterDirty)return this._contentAltitudeAtCenter;this._contentAltitudeAtCenterDirty=!1;const e=this._centerRay;return e==null||(this.view.sceneIntersectionHelper.intersectRay(e,this._contentIntersector,zx,tyt)?this._contentAltitudeAtCenter=this.view.renderCoordsHelper.getAltitude(zx):this._contentAltitudeAtCenter=this._estimateSurfaceAltitudeAtCenter()),this._contentAltitudeAtCenter}_estimateSurfaceAltitudeAtCenter(){if(!this.view.basemapTerrain)return 0;if(!this._surfaceAltitudeAtCenterDirty)return this._surfaceAltitudeAtCenter;this._surfaceAltitudeAtCenterDirty=!1;const e=this._centerRay;if(e==null)return this._surfaceAltitudeAtCenter;const r=e.origin,i=ce(zx,e.origin,e.direction);return this._surfaceIntersector.resetWithRay(e,this.view.state.contentCamera),this.view.basemapTerrain.intersect(this._surfaceIntersector,null,r,i),this._surfaceIntersector.results.min.getIntersectionPoint(zx)&&(this._surfaceAltitudeAtCenter=this.view.renderCoordsHelper.getAltitude(zx)),this._surfaceAltitudeAtCenter}_estimateSurfaceIntersectionAtRenderPoint(e,r,i){const s=aY(r,e,eyt);if(s==null)return null;const n=s.origin,o=ce(zx,s.origin,s.direction);return this._surfaceIntersector.resetWithRay(s,r),this.view.basemapTerrain.intersect(this._surfaceIntersector,null,n,o),this._surfaceIntersector.results.min.getIntersectionPoint(i)?i:null}_cameraChanged(e){this._updateCenterPointsOfInterest();const r=e.eye;la(this.renderPointOfView,r)||this._set("renderPointOfView",ie(this._propertiesPool.get("renderPointOfView"),r))}_updateCenterPointsOfInterest(){this._centerRayDirty=!0,this._surfaceAltitudeAtCenterDirty=!0,this._contentAltitudeAtCenterDirty=!0;for(const e of this._pois)e.updateRenderLocation()}_updateCenterOnContent(){this._contentAltitudeAtCenterDirty=!0,this.centerOnContent.updateRenderLocation()}_setDebug(e){if(!e)return this._debugCenters.forEach(r=>r.hide()),void this._handles.remove("debug");for(const r of this._pois)this._handles.add(le(()=>r.renderLocation,i=>this._debugCenters.get(r)?.show(i,r.renderCoordsHelper.spatialReference),Vr),"debug")}get test(){return{update:()=>{this.surfaceGeometryUpdates.runTask();for(const e of this._pois)e.runTask()},surfaceGeometryUpdates:this.surfaceGeometryUpdates}}};u([d({readOnly:!0})],pl.prototype,"centerOnContent",void 0),u([d({readOnly:!0})],pl.prototype,"centerOnSurfaceFrequent",void 0),u([d({readOnly:!0})],pl.prototype,"centerOnSurfaceInfrequent",void 0),u([d({readOnly:!0})],pl.prototype,"cameraOnSurface",void 0),u([d({readOnly:!0})],pl.prototype,"focus",void 0),u([d({readOnly:!0})],pl.prototype,"renderPointOfView",void 0),u([d({readOnly:!0})],pl.prototype,"surfaceOrigin",void 0),u([d({readOnly:!0})],pl.prototype,"contentGeometryUpdates",void 0),u([d({readOnly:!0})],pl.prototype,"surfaceGeometryUpdates",void 0),u([d({constructOnly:!0})],pl.prototype,"view",void 0),u([d({readOnly:!0})],pl.prototype,"updating",null),pl=u([R("esri.views.3d.support.PointsOfInterest")],pl);const Kgt=Array,zx=C(),eyt=Xn(),tyt={exclude:new Set([z0])};let ryt=class{constructor(e){this._store=e}destroy(){this._store.destroy()}get(e){return this._store.get(e)}put(e,r){this._store.put(e,r,r.values.byteLength+256)}},iyt=class{constructor(e,r,i,s){this._hasNoDataValues=null,this._minValue=null,this._maxValue=null,"pixelData"in e?(this.values=e.pixelData,this.width=e.width,this.height=e.height,this.noDataValue=e.noDataValue):(this.values=e,this.width=r,this.height=i,this.noDataValue=s)}get hasNoDataValues(){if(this._hasNoDataValues==null){const e=this.noDataValue;this._hasNoDataValues=this.values.includes(e)}return this._hasNoDataValues}get minValue(){return this._ensureBounds(),this._minValue}get maxValue(){return this._ensureBounds(),this._maxValue}_ensureBounds(){if(this._minValue!=null)return;const{noDataValue:e,values:r}=this;let i=1/0,s=-1/0,n=!0;for(const o of r)o===e?this._hasNoDataValues=!0:(i=o<i?o:i,s=o>s?o:s,n=!1);n?(this._minValue=0,this._maxValue=0):(this._minValue=i,this._maxValue=s>-3e38?s:0)}},EAe=class{constructor(e,r,i,s,n={}){this._mainMethod=r,this._transferLists=i,this._listeners=[],this._promise=_0e(e,{...n,schedule:s}).then(o=>{if(this._thread===void 0){this._thread=o,this._promise=null,n.hasInitialize&&this.broadcast({},"initialize");for(const a of this._listeners)this._connectListener(a)}else o.close()}),this._promise.catch(o=>Q.getLogger("esri.core.workers.WorkerHandle").error(`Failed to initialize ${e} worker: ${o}`))}on(e,r){const i={removed:!1,eventName:e,callback:r,threadHandle:null};return this._listeners.push(i),this._connectListener(i),bo(()=>{i.removed=!0,aq(this._listeners,i),this._thread&&i.threadHandle!=null&&i.threadHandle.remove()})}destroy(){this._thread&&(this._thread.close(),this._thread=null),this._promise=null,this._listeners.length=0,this._transferLists={}}invoke(e,r){return this.invokeMethod(this._mainMethod,e,r)}invokeMethod(e,r,i){if(this._thread){const s=this._transferLists[e],n=s?s(r):[];return this._thread.invoke(e,r,{transferList:n,signal:i})}return this._promise?this._promise.then(()=>(Xt(i),this.invokeMethod(e,r,i))):Promise.reject(null)}broadcast(e,r){return this._thread?Promise.all(this._thread.broadcast(r,e)).then(()=>{}):this._promise?this._promise.then(()=>this.broadcast(e,r)):Promise.reject()}get promise(){return this._promise}_connectListener(e){this._thread&&this._thread.on(e.eventName,e.callback).then(r=>{e.removed||(e.threadHandle=r)})}},cle=class extends EAe{constructor(e=null){super("LercWorker","_decode",{_decode:r=>[r.buffer]},e,{strategy:"dedicated"}),this.schedule=e,this.ref=0}decode(e,r,i){return e&&e.byteLength!==0?this.invoke({buffer:e,options:r},i):Promise.resolve(null)}release(){--this.ref<=0&&(aO.forEach((e,r)=>{e===this&&aO.delete(r)}),this.destroy())}};const aO=new Map;function syt(t=null){let e=aO.get(t);return e||(t!=null?(e=new cle(r=>t.immediate.schedule(r)),aO.set(t,e)):(e=new cle,aO.set(null,e))),++e.ref,e}var nc,ule,hle;(function(t){t[t.FILL=1]="FILL",t[t.LINE=2]="LINE",t[t.SYMBOL=3]="SYMBOL",t[t.CIRCLE=4]="CIRCLE"})(nc||(nc={})),function(t){t[t.BACKGROUND=0]="BACKGROUND",t[t.FILL=1]="FILL",t[t.OUTLINE=2]="OUTLINE",t[t.LINE=3]="LINE",t[t.ICON=4]="ICON",t[t.CIRCLE=5]="CIRCLE",t[t.TEXT=6]="TEXT",t[t.TILEINFO=7]="TILEINFO"}(ule||(ule={})),function(t){t[t.PAINTER_CHANGED=0]="PAINTER_CHANGED",t[t.LAYOUT_CHANGED=1]="LAYOUT_CHANGED",t[t.LAYER_CHANGED=2]="LAYER_CHANGED",t[t.LAYER_REMOVED=3]="LAYER_REMOVED",t[t.SPRITES_CHANGED=4]="SPRITES_CHANGED"}(hle||(hle={}));let nyt=class{constructor(e){this.xTile=0,this.yTile=0,this.hash=0,this.priority=1,this.colliders=[],this.textVertexRanges=[],this.iconVertexRanges=[],this.tile=e}},zFt=class{constructor(){this.tileSymbols=[],this.parts=[{startTime:0,startOpacity:0,targetOpacity:0,show:!1},{startTime:0,startOpacity:0,targetOpacity:0,show:!1}],this.show=!1}};function GFt(t,e,r,i,s,n){const o=r-s;if(o>=0)return(e>>o)+(i-(n<<o))*(t>>o);const a=-o;return e-(n-(i<<a))*(t>>a)<<a}let jFt=class{constructor(e,r,i){this._rows=Math.ceil(r/i),this._columns=Math.ceil(e/i),this._cellSize=i,this.cells=new Array(this._rows);for(let s=0;s<this._rows;s++){this.cells[s]=new Array(this._columns);for(let n=0;n<this._columns;n++)this.cells[s][n]=[]}}getCell(e,r){const i=Math.min(Math.max(Math.floor(r/this._cellSize),0),this._rows-1),s=Math.min(Math.max(Math.floor(e/this._cellSize),0),this._columns-1);return this.cells[i]&&this.cells[i][s]||null}getCellSpan(e,r,i,s){return[Math.min(Math.max(Math.floor(e/this._cellSize),0),this.columns-1),Math.min(Math.max(Math.floor(r/this._cellSize),0),this.rows-1),Math.min(Math.max(Math.floor(i/this._cellSize),0),this.columns-1),Math.min(Math.max(Math.floor(s/this._cellSize),0),this.rows-1)]}get cellSize(){return this._cellSize}get columns(){return this._columns}get rows(){return this._rows}};function oyt(t,e,r,i,s,n){const o=e[i++];for(let a=0;a<o;a++){const l=new nyt(n);l.xTile=e[i++],l.yTile=e[i++],l.hash=e[i++],l.priority=e[i++];const c=e[i++];for(let f=0;f<c;f++){const m=e[i++],y=e[i++],_=e[i++],v=e[i++],w=!!e[i++],x=e[i++],T=r[i++],S=r[i++],O=e[i++],A=e[i++];l.colliders.push({xTile:m,yTile:y,dxPixels:_,dyPixels:v,hard:w,partIndex:x,width:O,height:A,minLod:T,maxLod:S})}const h=t[i++];for(let f=0;f<h;f++)l.textVertexRanges.push([t[i++],t[i++]]);const p=t[i++];for(let f=0;f<p;f++)l.iconVertexRanges.push([t[i++],t[i++]]);s.push(l)}return i}function qFt(t,e,r){for(const[i,s]of t.symbols)ayt(t,e,r,s,i)}function ayt(t,e,r,i,s){const n=t.layerData.get(s);if(n.type===nc.SYMBOL){for(const o of i){const a=o.unique;let l;if(o.selectedForRendering){const c=a.parts[0],h=c.startOpacity,p=c.targetOpacity;t.allSymbolsFadingOut=t.allSymbolsFadingOut&&p===0;const f=r?Math.floor(127*h)|p<<7:p?255:0;l=f<<24|f<<16|f<<8|f}else l=0;for(const[c,h]of o.iconVertexRanges)for(let p=c;p<c+h;p+=4)n.iconOpacity[p/4]=l;if(o.selectedForRendering){const c=a.parts[1],h=c.startOpacity,p=c.targetOpacity;t.allSymbolsFadingOut=t.allSymbolsFadingOut&&p===0;const f=r?Math.floor(127*h)|p<<7:p?255:0;l=f<<24|f<<16|f<<8|f}else l=0;for(const[c,h]of o.textVertexRanges)for(let p=c;p<c+h;p+=4)n.textOpacity[p/4]=l}n.lastOpacityUpdate=e,n.opacityChanged=!0}}let M6=class{constructor(e,r){this.layerUIDs=[],this.isDestroyed=!1,this._data=e;let i=1;const s=new Uint32Array(e);this.layerUIDs=[];const n=s[i++];for(let o=0;o<n;o++)this.layerUIDs[o]=s[i++];this.bufferDataOffset=i,r&&(this.layer=r.getStyleLayerByUID(this.layerUIDs[0]))}get isPreparedForRendering(){return this._data==null}get offset(){return this.bufferDataOffset}get data(){return this._data}destroy(){this.isDestroyed||(this.doDestroy(),this.isDestroyed=!0)}prepareForRendering(e){this._data!=null&&(this.doPrepareForRendering(e,this._data,this.bufferDataOffset),this._data=null)}},lyt=class extends M6{constructor(e,r){super(e,r),this.type=nc.LINE,this.lineIndexStart=0,this.lineIndexCount=0;const i=new Uint32Array(e);let s=this.bufferDataOffset;this.lineIndexStart=i[s++],this.lineIndexCount=i[s++];const n=i[s++];if(n>0){this.patternMap=new Map;for(let o=0;o<n;o++){const a=i[s++],l=i[s++],c=i[s++];this.patternMap.set(a,[l,c])}}this.bufferDataOffset=s}get memoryUsed(){return(this.data?.byteLength??0)+(this.vao?.memoryEstimate??0)}hasData(){return this.lineIndexCount>0}triangleCount(){return this.lineIndexCount/3}doDestroy(){this.vao=Ue(this.vao)}doPrepareForRendering(e,r,i){const s=new Uint32Array(r),n=new Int32Array(s.buffer),o=s[i++],a=Lr.createVertex(e,Tr.STATIC_DRAW,new Int32Array(n.buffer,4*i,o));i+=o;const l=s[i++],c=Lr.createIndex(e,Tr.STATIC_DRAW,new Uint32Array(s.buffer,4*i,l));i+=l;const h=this.layer.lineMaterial;this.vao=new $h(e,h.getAttributeLocations(),h.getLayoutInfo(),{geometry:a},c)}},cyt=class extends M6{constructor(e,r){super(e,r),this.type=nc.FILL,this.fillIndexStart=0,this.fillIndexCount=0,this.outlineIndexStart=0,this.outlineIndexCount=0;const i=new Uint32Array(e);let s=this.bufferDataOffset;this.fillIndexStart=i[s++],this.fillIndexCount=i[s++],this.outlineIndexStart=i[s++],this.outlineIndexCount=i[s++];const n=i[s++];if(n>0){this.patternMap=new Map;for(let o=0;o<n;o++){const a=i[s++],l=i[s++],c=i[s++];this.patternMap.set(a,[l,c])}}this.bufferDataOffset=s}get memoryUsed(){return(this.data?.byteLength??0)+(this.fillVAO?.memoryEstimate??0)+(this.outlineVAO?.memoryEstimate??0)}hasData(){return this.fillIndexCount>0||this.outlineIndexCount>0}triangleCount(){return(this.fillIndexCount+this.outlineIndexCount)/3}doDestroy(){this.fillVAO=Ue(this.fillVAO),this.outlineVAO=Ue(this.outlineVAO)}doPrepareForRendering(e,r,i){const s=new Uint32Array(r),n=new Int32Array(s.buffer),o=s[i++],a=Lr.createVertex(e,Tr.STATIC_DRAW,new Int32Array(n.buffer,4*i,o));i+=o;const l=s[i++],c=Lr.createIndex(e,Tr.STATIC_DRAW,new Uint32Array(s.buffer,4*i,l));i+=l;const h=s[i++],p=Lr.createVertex(e,Tr.STATIC_DRAW,new Int32Array(n.buffer,4*i,h));i+=h;const f=s[i++],m=Lr.createIndex(e,Tr.STATIC_DRAW,new Uint32Array(s.buffer,4*i,f));i+=f;const y=this.layer,_=y.fillMaterial,v=y.outlineMaterial;this.fillVAO=new $h(e,_.getAttributeLocations(),_.getLayoutInfo(),{geometry:a},c),this.outlineVAO=new $h(e,v.getAttributeLocations(),v.getLayoutInfo(),{geometry:p},m)}},uyt=class extends M6{constructor(e,r,i){super(e,r),this.type=nc.SYMBOL,this.iconPerPageElementsMap=new Map,this.glyphPerPageElementsMap=new Map,this.symbolInstances=[],this.isIconSDF=!1,this.opacityChanged=!1,this.lastOpacityUpdate=0,this.symbols=[];const s=new Uint32Array(e),n=new Int32Array(e),o=new Float32Array(e);let a=this.bufferDataOffset;this.isIconSDF=!!s[a++];const l=s[a++];for(let f=0;f<l;f++){const m=s[a++],y=s[a++],_=s[a++];this.iconPerPageElementsMap.set(m,[y,_])}const c=s[a++];for(let f=0;f<c;f++){const m=s[a++],y=s[a++],_=s[a++];this.glyphPerPageElementsMap.set(m,[y,_])}const h=s[a++],p=s[a++];this.iconOpacity=new Int32Array(h),this.textOpacity=new Int32Array(p),a=oyt(s,n,o,a,this.symbols,i),this.bufferDataOffset=a}get memoryUsed(){return(this.data?.byteLength??0)+(this.iconVAO?.memoryEstimate??0)+(this.textVAO?.memoryEstimate??0)+Z0(this.iconOpacity)+Z0(this.textOpacity)}hasData(){return this.iconPerPageElementsMap.size>0||this.glyphPerPageElementsMap.size>0}triangleCount(){let e=0;for(const[r,i]of this.iconPerPageElementsMap)e+=i[1];for(const[r,i]of this.glyphPerPageElementsMap)e+=i[1];return e/3}doDestroy(){this.iconVAO=Ue(this.iconVAO),this.textVAO=Ue(this.textVAO)}updateOpacityInfo(){if(!this.opacityChanged)return;this.opacityChanged=!1;const e=this.iconOpacity,r=this.iconVAO.vertexBuffers.opacity;e.length>0&&e.byteLength===r.byteLength&&r.setSubData(e,0,0,e.length);const i=this.textOpacity,s=this.textVAO.vertexBuffers.opacity;i.length>0&&i.byteLength===s.byteLength&&s.setSubData(i,0,0,i.length)}doPrepareForRendering(e,r,i){const s=new Uint32Array(r),n=new Int32Array(s.buffer),o=s[i++],a=Lr.createVertex(e,Tr.STATIC_DRAW,new Int32Array(n.buffer,4*i,o));i+=o;const l=s[i++],c=Lr.createIndex(e,Tr.STATIC_DRAW,new Uint32Array(s.buffer,4*i,l));i+=l;const h=s[i++],p=Lr.createVertex(e,Tr.STATIC_DRAW,new Int32Array(n.buffer,4*i,h));i+=h;const f=s[i++],m=Lr.createIndex(e,Tr.STATIC_DRAW,new Uint32Array(s.buffer,4*i,f));i+=f;const y=Lr.createVertex(e,Tr.STATIC_DRAW,this.iconOpacity.buffer),_=Lr.createVertex(e,Tr.STATIC_DRAW,this.textOpacity.buffer),v=this.layer,w=v.iconMaterial,x=v.textMaterial;this.iconVAO=new $h(e,w.getAttributeLocations(),w.getLayoutInfo(),{geometry:a,opacity:y},c),this.textVAO=new $h(e,x.getAttributeLocations(),x.getLayoutInfo(),{geometry:p,opacity:_},m)}},hyt=class extends M6{constructor(e,r){super(e,r),this.type=nc.CIRCLE,this.circleIndexStart=0,this.circleIndexCount=0;const i=new Uint32Array(e);let s=this.bufferDataOffset;this.circleIndexStart=i[s++],this.circleIndexCount=i[s++],this.bufferDataOffset=s}get memoryUsed(){return(this.data?.byteLength??0)+(this.vao?.memoryEstimate??0)}hasData(){return this.circleIndexCount>0}triangleCount(){return this.circleIndexCount/3}doDestroy(){this.vao=Ue(this.vao)}doPrepareForRendering(e,r,i){const s=new Uint32Array(r),n=new Int32Array(s.buffer),o=s[i++],a=Lr.createVertex(e,Tr.STATIC_DRAW,new Int32Array(n.buffer,4*i,o));i+=o;const l=s[i++],c=Lr.createIndex(e,Tr.STATIC_DRAW,new Uint32Array(s.buffer,4*i,l));i+=l;const h=this.layer.circleMaterial;this.vao=new $h(e,h.getAttributeLocations(),h.getLayoutInfo(),{geometry:a},c)}};const QFt=!0,KFt=32,dle=200,dyt=1/oe("mapview-transitions-duration");let pyt=class extends os{constructor(){super(...arguments),this._fadeOutResolver=null,this._fadeInResolver=null,this._clips=null,this.computedVisible=!0,this.computedOpacity=1,this.fadeTransitionEnabled=!1,this.inFadeTransition=!1,this._isReady=!1,this._opacity=1,this.parent=null,this._stage=null,this._visible=!0}get clips(){return this._clips}set clips(e){this._clips=e,this.requestRender()}get isReady(){return this._isReady}get opacity(){return this._opacity}set opacity(e){this._opacity!==e&&(this._opacity=Math.min(1,Math.max(e,0)),this.requestRender())}get stage(){return this._stage}set stage(e){if(this._stage===e)return;const r=this._stage;this._stage=e,e?this._stage?.untrashDisplayObject(this)||(this.onAttach(),this.emit("attach")):r?.trashDisplayObject(this)}get transforms(){return this._getTransforms()}_getTransforms(){return this._transforms==null&&(this._transforms=this._createTransforms()),this._transforms}get visible(){return this._visible}set visible(e){this._visible!==e&&(this._visible=e,this.requestRender())}fadeIn(){return this._fadeInResolver||(this._fadeOutResolver&&(this._fadeOutResolver(),this._fadeOutResolver=null),this.opacity=1,this.computedOpacity=0,this.fadeTransitionEnabled=!0,this._fadeInResolver=qs(),this.requestRender()),this._fadeInResolver.promise}fadeOut(){return this._fadeOutResolver||(this.opacity=0,this._fadeInResolver&&(this._fadeInResolver(),this._fadeInResolver=null),this.fadeTransitionEnabled=!0,this._fadeOutResolver=qs(),this.requestRender()),this._fadeOutResolver.promise}endTransitions(){this._fadeInResolver?.(),this._fadeInResolver=null,this._fadeOutResolver?.(),this._fadeOutResolver=null,this.computedOpacity=this.visible?this.opacity:0,this.requestRender()}beforeRender(e){this.updateTransitionProperties(e.deltaTime,e.state.scale)}afterRender(e){this._fadeInResolver&&this.computedOpacity===this.opacity?(this._fadeInResolver(),this._fadeInResolver=null):this._fadeOutResolver&&this.computedOpacity===0&&(this._fadeOutResolver(),this._fadeOutResolver=null)}remove(){this.parent?.removeChild(this)}setTransform(e){}processRender(e){this.stage&&this.computedVisible&&this.doRender(e)}requestRender(){this.stage&&this.stage.requestRender()}processDetach(){this._fadeInResolver&&(this._fadeInResolver(),this._fadeInResolver=null),this._fadeOutResolver&&(this._fadeOutResolver(),this._fadeOutResolver=null),this.onDetach(),this.emit("detach")}updateTransitionProperties(e,r){if(this.fadeTransitionEnabled){const i=this._fadeOutResolver||!this.visible?0:this.opacity,s=this.computedOpacity;if(s===i)this.computedVisible=this.visible;else{const n=e*dyt;this.computedOpacity=s>i?Math.max(i,s-n):Math.min(i,s+n),this.computedVisible=this.computedOpacity>0;const o=i===this.computedOpacity;this.inFadeTransition=!o,o||this.requestRender()}}else this.computedOpacity=this.opacity,this.computedVisible=this.visible}onAttach(){}onDetach(){}doRender(e){}ready(){this._isReady||(this._isReady=!0,this.emit("isReady"),this.requestRender())}},IH=class B1{static getId(e,r,i,s){return typeof e=="object"?`${e.level}/${e.row}/${e.col}/${e.world}`:`${e}/${r}/${i}/${s}`}constructor(e,r,i,s){this.set(e,r,i,s)}get key(){return this}get id(){return this.toString()}set id(e){this.set(e)}get hash(){const e=4095&this.row,r=4095&this.col,i=63&this.level;return(3&this.world)<<30|r<<22|e<<8|i}acquire(e,r,i,s){this.set(e,r,i,s)}contains(e){const r=e.level-this.level;return r>=0&&this.row===e.row>>r&&this.col===e.col>>r&&this.world===e.world}equals(e){return this.level===e.level&&this.row===e.row&&this.col===e.col&&this.world===e.world}clone(){return new B1(this)}release(){this.level=0,this.row=0,this.col=0,this.world=0}set(e,r,i,s){if(e==null)this.level=0,this.row=0,this.col=0,this.world=0;else if(typeof e=="object")this.level=e.level||0,this.row=e.row||0,this.col=e.col||0,this.world=e.world||0;else if(typeof e=="string"){const[n,o,a,l]=e.split("/");this.level=parseFloat(n),this.row=parseFloat(o),this.col=parseFloat(a),this.world=parseFloat(l)}else this.level=+e,this.row=+r,this.col=+i,this.world=+s||0;return this}toString(){return`${this.level}/${this.row}/${this.col}/${this.world}`}getParentKey(){return this.level<=0?null:new B1(this.level-1,this.row>>1,this.col>>1,this.world)}getChildKeys(){const e=this.level+1,r=this.row<<1,i=this.col<<1,s=this.world;return[new B1(e,r,i,s),new B1(e,r,i+1,s),new B1(e,r+1,i,s),new B1(e,r+1,i+1,s)]}compareRowMajor(e){return this.row<e.row?-1:this.row>e.row?1:this.col<e.col?-1:this.col>e.col?1:0}};IH.pool=new Vo(IH,null,null,25,50);let fyt=class extends pyt{constructor(e,r,i,s,n,o,a=n,l=o){super(),this.triangleCountReportedInDebug=0,this.triangleCount=0,this.texture=null,this.key=new IH(e),this.resolution=r,this.x=i,this.y=s,this.width=n,this.height=o,this.rangeX=a,this.rangeY=l}destroy(){this.texture&&(this.texture.dispose(),this.texture=null)}setTransform(e){const r=this.resolution/(e.resolution*e.pixelRatio),i=this.transforms.tileMat3,[s,n]=e.toScreenNoRotation([0,0],[this.x,this.y]),o=this.width/this.rangeX*r,a=this.height/this.rangeY*r;KZ(i,o,0,0,0,a,0,s,n,1),g2(this.transforms.dvs,e.displayViewMat3,i)}},tk=class CAe extends fyt{constructor(e,r,i,s,n,o,a,l=null){super(e,r,i,s,n,o,4096,4096),this.styleRepository=a,this._memCache=l,this.type="vector-tile",this._referenced=0,this._hasSymbolBuckets=!1,this._memoryUsedByLayerData=0,this.layerData=new Map,this.layerCount=0,this.status="loading",this.allSymbolsFadingOut=!1,this.lastOpacityUpdate=0,this.symbols=new Map,this.isCoverage=!1,this.neededForCoverage=!1,this.decluttered=!1,this.invalidating=!1,this.parentTile=null,this.childrenTiles=new Set,this._processed=!1,this._referenced=1,this.id=e.id}get hasSymbolBuckets(){return this._hasSymbolBuckets}get isFading(){return this._hasSymbolBuckets&&performance.now()-this.lastOpacityUpdate<dle}get isHoldingForFade(){return this._hasSymbolBuckets&&(!this.allSymbolsFadingOut||performance.now()-this.lastOpacityUpdate<dle)}get wasRequested(){return this.status==="errored"||this.status==="loaded"||this.status==="reloading"}setData(e){this.changeDataImpl(e),this.requestRender(),this.ready(),this.invalidating=!1,this._processed=!0}deleteLayerData(e){let r=!1;for(const i of e)if(this.layerData.has(i)){const s=this.layerData.get(i);this._memoryUsedByLayerData-=s.memoryUsed,s.type===nc.SYMBOL&&this.symbols.has(i)&&(this.symbols.delete(i),r=!0),s.destroy(),this.layerData.delete(i),this.layerCount--}this._memCache?.updateSize(this.key.id,this,this._memoryUsedByLayerData),r&&this.emit("symbols-changed"),this.requestRender()}processed(){return this._processed}hasData(){return this.layerCount>0}dispose(){this.status!=="unloaded"&&(AAe.delete(this),CAe._destroyRenderBuckets(this.layerData),this.layerData=null,this.layerCount=0,this._memoryUsedByLayerData=0,this.destroy(),this.status="unloaded")}release(){return--this._referenced==0&&(this.dispose(),this.stage=null,!0)}retain(){++this._referenced}get referenced(){return this._referenced}get memoryUsed(){return this._memoryUsedByLayerData+256}changeDataImpl(e){let r=!1;if(e){const{bucketsWithData:i,emptyBuckets:s}=e,n=this._createRenderBuckets(i);if(s&&s.byteLength>0){const o=new Uint32Array(s);for(const a of o)this._deleteLayerData(a)}for(const[o,a]of n)this._deleteLayerData(o),a.type===nc.SYMBOL&&(this.symbols.set(o,a.symbols),r=!0),this._memoryUsedByLayerData+=a.memoryUsed,this.layerData.set(o,a),this.layerCount++;this._memCache?.updateSize(this.key.id,this,this.memoryUsed)}this._hasSymbolBuckets=!1;for(const[i,s]of this.layerData)s.type===nc.SYMBOL&&(this._hasSymbolBuckets=!0);r&&this.emit("symbols-changed")}attachWithContext(e){this.stage={context:e,trashDisplayObject(r){r.processDetach()},untrashDisplayObject:()=>!1}}setTransform(e){super.setTransform(e);const r=this.resolution/(e.resolution*e.pixelRatio),i=this.width/this.rangeX*r,s=this.height/this.rangeY*r,n=[0,0];e.toScreen(n,[this.x,this.y]);const o=this.transforms.tileUnitsToPixels;eX(o),HN(o,o,n),tX(o,o,Math.PI*e.rotation/180),rX(o,o,[i,s,1])}_createTransforms(){return{dvs:El(),tileMat3:El(),tileUnitsToPixels:El()}}static _destroyRenderBuckets(e){if(!e)return;const r=new Set;e.forEach(i=>{r.has(i)||(i.destroy(),r.add(i))}),e.clear()}_createRenderBuckets(e){const r=new Map,i=new Map;for(const s of e){const n=this._deserializeBucket(s,i);for(const o of n.layerUIDs)r.set(o,n)}return r}_deserializeBucket(e,r){let i=r.get(e);if(i)return i;switch(new Uint32Array(e)[0]){case nc.FILL:i=new cyt(e,this.styleRepository);break;case nc.LINE:i=new lyt(e,this.styleRepository);break;case nc.SYMBOL:i=new uyt(e,this.styleRepository,this);break;case nc.CIRCLE:i=new hyt(e,this.styleRepository)}return r.set(e,i),i}_deleteLayerData(e){if(!this.layerData.has(e))return;const r=this.layerData.get(e);this._memoryUsedByLayerData-=r.memoryUsed,r.destroy(),this.layerData.delete(e),this.layerCount--}};const AAe=new Map;function myt(){AAe.forEach((t,e)=>{console.log(`
${e.key}:`),t[0].forEach(r=>console.log(r)),console.log("========"),t[1].forEach(r=>console.log(r))})}const r5t={value:.5,readOnly:!0},gyt={readOnly:!0,value:.5,get(){return this.updating?this.updatingProgressValue:1}};let mS=class{constructor(e=0,r=0){this.min=e,this.max=r,this.level=0,this.hasNoDataValues=!1}copyFrom(e){this.min=e.min,this.max=e.max,this.level=e.level,this.hasNoDataValues=e.hasNoDataValues}},yyt=class{constructor(e,r){this.data=e,this.safeWidth=.99999999*(e.width-1),this.dx=(e.width-1)/(r[2]-r[0]),this.dy=(e.width-1)/(r[3]-r[1]),this.x0=r[0],this.y1=r[3]}},_yt=class{constructor(e,r,i){this.type="elevation",this.level=e[0],this.i=e[1],this.j=e[2],this.extent=r,this.samplerData=new yyt(i,r)}computeMinMaxValue(e,r,i,s){s.min=1/0,s.max=-1/0,s.hasNoDataValues=!1;const n=e-this.level;if(n<=0)return s;const o=2**n;if(!(Math.floor(r/o)===this.i&&Math.floor(i/o)===this.j))return s;let a=1/0,l=-1/0;const c=this.samplerData.data.width,h=this.samplerData.data.values,p=.5*GO;let f=(c-1)/o,m=(i-this.j*o)*f,y=(r-this.i*o)*f;if(f<1){const _=Math.floor(m),v=Math.floor(y),w=_+v*c,x=h[w],T=h[w+1],S=h[w+c],O=h[w+c+1];if(x+T+S+O<p){const A=m-_,I=y-v,M=_M(x,T,S,O,A,I),k=_M(x,T,S,O,A+f,I),L=_M(x,T,S,O,A,I+f),D=_M(x,T,S,O,A+f,I+f);return s.min=Math.min(M,k,L,D),s.max=Math.max(M,k,L,D),s}m=_,y=v,f=1}else m=Math.floor(m),y=Math.floor(y),f=Math.ceil(f);for(let _=m;_<=m+f;_++)for(let v=y;v<=y+f;v++){const w=h[_+v*c];w<p?(a=Math.min(a,w),l=Math.max(l,w)):s.hasNoDataValues=!0}return s.min=a,s.max=l,s}};const vyt=.5*GO;function Wi(t,e,r){if(r==null)return null;for(const i of r){if(!i)continue;const s=i.safeWidth;let n=ge(i.dy*(i.y1-e),0,s),o=ge(i.dx*(t-i.x0),0,s);const a=Math.floor(n),l=Math.floor(o),c=i.data.width,h=a*c+l,p=i.data.values,f=p[h],m=p[h+1],y=h+c,_=p[y],v=p[y+1];if(f+_+m+v<vyt){n-=a,o-=l;const w=f+(m-f)*o;return w+(_+(v-_)*o-w)*n}}return null}let Xu=class extends Te{constructor(e){super(e)}initialize(){this.addHandles([this.layerViews.on("change",()=>this.notifyChange("stencilEnabledExtents"))])}destroy(){}get layerViewsExtent(){return this._computeLayerViewsExtent()}get tiledLayersExtent(){return this._computeTiledLayersExtent()}get stencilEnabledExtents(){return this._computeStencilEnabledExtents()}_computeStencilEnabledExtents(){const e=[];return this.layerViews.forEach(r=>{const i=r.layer;if(i.operationalLayerType==="IntegratedMeshLayer"&&this.viewSpatialReference!=null){const s=OAe(i.fullExtent,this.viewSpatialReference);s!=null&&e.push(Lfe(s))}}),e}};function byt(t,e){return t===De.Global?new $H(e):new LH(e)}u([d({readOnly:!0})],Xu.prototype,"layerViewsExtent",null),u([d({readOnly:!0})],Xu.prototype,"tiledLayersExtent",null),u([d({readOnly:!0})],Xu.prototype,"stencilEnabledExtents",null),u([d()],Xu.prototype,"viewSpatialReference",void 0),u([d()],Xu.prototype,"tilingScheme",void 0),u([d()],Xu.prototype,"defaultTiledLayersExtent",void 0),u([d({constructOnly:!0})],Xu.prototype,"layers",void 0),u([d({constructOnly:!0})],Xu.prototype,"layerViews",void 0),Xu=u([R("esri.views.3d.terrain.ExtentHelper")],Xu);let $H=class extends Xu{_computeLayerViewsExtent(){return this._globalExtent}_computeTiledLayersExtent(){return this._globalExtent}get _globalExtent(){return this.viewSpatialReference.isWebMercator?Zbe:TXe}};$H=u([R("esri.views.3d.terrain.ExtentHelperGlobal")],$H);let LH=class extends Xu{_computeLayerViewsExtent(){const e=wc(),r=this.viewSpatialReference;this.layerViews.forEach(n=>{const o=n.layer;if(n.isResolved()&&(o.type!=="graphics"||!o.internal)){const a=OAe("fullExtentInLocalViewSpatialReference"in n&&n.fullExtentInLocalViewSpatialReference||n.layer.fullExtent,r);f_(e,a,e)}});const i=EV(e)?e:null,s=this._get("layerViewsExtent");return Tb(i,s)?s:i}_computeTiledLayersExtent(){const e=this.tilingScheme;if(!e)return null;const r=this.viewSpatialReference,i=wc();this.layers.forEach(o=>{if(o.loaded&&A3(o)){const a=P6(o,r,De.Local);if(a==null)return;const{tileInfo:l,fullExtent:c}=a;l!=null&&c!=null&&(q4(o)||e.compatibleWith(l)&&c.spatialReference.equals(e.spatialReference))&&f_(i,c,i)}}),f_(i,this.defaultTiledLayersExtent,i);const s=EV(i)?i:null,n=this._get("tiledLayersExtent");return Tb(s,n)?n:s}};function OAe(t,e){return t==null||t.spatialReference.equals(e)?t:$Z(t,t.spatialReference,e)}LH=u([R("esri.views.3d.terrain.ExtentHelperLocal")],LH);var tr;(function(t){t[t.ELEVATION=0]="ELEVATION",t[t.MAP=1]="MAP"})(tr||(tr={}));const G1=[tr.ELEVATION,tr.MAP];function RAe(){const t=globalThis.require?.modules;if(t){const e=Object.keys(t);for(const r of e)r.search(".glsl")!==-1&&delete t[r]}}const wyt=[[-.1,-2,3.9,2],[-.1,-3.9,3.9,.1],[-2,-3.9,2,.1],[-3.9,-3.9,.1,.1],[-3.9,-2,.1,2],[-3.9,-.1,.1,3.9],[-2,-.1,2,3.9],[-.1,-.1,3.9,3.9]];let Gy,Pa=class extends Te{get running(){return this._placementDirty&&(this._drapeSources.size>0||this.view.graphics.length>0||ni.OVERLAY_DRAW_DEBUG_TEXTURE)&&!!this._spatialReference&&!this.suspended&&this.surface.ready}get _isSpherical(){return this.view.state.isGlobal}get _worldToPCSRatio(){return this._spatialReference!=null&&this._spatialReference.isGeographic&&!this.view.state.isLocal?Nr(this._spatialReference).metersPerDegree:1}get suspended(){return this.surface.suspended}get updating(){return this.running||this.renderer.updating||this._contentUpdated}get hasHighlights(){return this.renderer.hasHighlights}get rendersOccluded(){return this.renderer.rendersOccluded}constructor(e){super(e),this._handles=new Oi,this._spatialReference=null,this._renderSR=null,this._overlaySREqualsRenderSR=!0,this._drapeSources=new Set,this._drapeTargets=new Set,this._placementDirty=!1,this._contentUpdated=!1,this._drawTexturesDirty=!1,this._drawTexturesAnimateDirty=!1,this._hasUnusedRenderTargets=!1,this._longitudeCyclical=null,this._latestOriginId=0,this._maxResolution=oe("esri-mobile")?2048:4096,this._animationTimeLast=0,this._removeRenderOverlayCallback=()=>{}}initialize(){const e=this.view;this.renderer=new Kp({view:e,worldToPCSRatio:this._worldToPCSRatio,spatialReference:this._spatialReference});const r=()=>this.setDrawTexturesDirty();this._groundIntersector=Dh(this.view.state.viewingMode),this._groundIntersector.options.backfacesTerrain=!0,this._groundIntersector.options.invisibleTerrain=!0,this._groundIntersector.options.hud=!1,this._handles.add([this.renderer.events.on("has-highlights",()=>{r(),this.notifyChange("hasHighlights")}),this.renderer.events.on("has-water",s=>e._stage?.renderer.setParameters({hasOverlayWater:s})),this.renderer.events.on("renders-occluded",()=>{r(),this.notifyChange("rendersOccluded")}),this.renderer.events.on("content-changed",r),le(()=>e.state.camera.pixelRatio,r),le(()=>e.state.alignPixelEnabled,r),this.renderer.events.on("textures-disposed",()=>this.updateOverlayResult()),le(()=>[e.pointsOfInterest?.renderPointOfView,e.pointsOfInterest?.centerOnSurfaceFrequent?.location],()=>this.setPlacementDirty()),le(()=>[e.state?.pixelRatio,e.state?.contentPixelRatio],()=>this.setPlacementDirty(),jr),this.surface.on("elevation-change",()=>this.setPlacementDirty()),e.on("resize",()=>this.setPlacementDirty()),e.resourceController.scheduler.registerTask(dt.OVERLAY,this),e._stage.renderView.events.on("force-camera-for-screenshot",s=>{this._updateOverlays(za,s.camera,ds.BACKGROUND),this.renderer.hasOverlays&&this._drawOverlayTextures(this.renderer.overlays,ds.BACKGROUND,s)})]);let i=s=>this._renderOverlayCallback(s);this._removeRenderOverlayCallback=()=>{i=()=>{}},e._stage?.renderer.setParameters({renderOverlay:s=>i(s)})}_renderOverlayCallback(e){this._contentUpdated=!1;const r=this.renderer;r.processSyncDrapeSources(),r.hasOverlays&&(this._dispatchAnimationUpdate(e),this._drawOverlayTextures(r.overlays,ds.UPDATE,this.view.state)),this._hasUnusedRenderTargets&&this._collectUnusedRenderTargetMemory()}destroy(){this._handles=Me(this._handles),this._removeRenderOverlayCallback(),this.view?._stage?.renderer.setParameters({renderOverlay:()=>{}}),Gy!=null&&(Gy.hide(),Gy=null)}get hasOverlays(){return this.renderer.hasOverlays}setSpatialReference(e){this._spatialReference=e,this.renderer.spatialReference=e,this._longitudeCyclical=null;const r=this.view.renderSpatialReference;e!=null&&r!=null?(this._renderSR=r,this._overlaySREqualsRenderSR=e.equals(this._renderSR),this._isSpherical&&(this._longitudeCyclical=e.isWebMercator?new C_(-20037508342787e-6,20037508342787e-6):new C_(-180,180),this.renderer.longitudeCyclical=this._longitudeCyclical),this.renderer&&(this.renderer.worldToPCSRatio=this._worldToPCSRatio)):this.renderer.disposeOverlays()}get gpuMemoryUsage(){return this.renderer.gpuMemoryUsage}registerDrapeSource(e,r,i){this._drapeSources.add(e),this.renderer.ensureOverlays(this._drapeTargets,this._drapeSources);const s=this.renderer.createDrapeSourceRenderer(e,r,i);return this._updateDrapeSourceExtent(e),this._setContentDirty(),this.notifyChange("running"),s}registerGeometryDrapeSource(e){return this.registerDrapeSource(e,jc)}_updateDrapeSourceExtent(e){this.renderer.overlays.length===2&&e.setDrapingExtent!=null&&this._spatialReference!=null&&e.setDrapingExtent(this.renderer.overlays,this._spatialReference)}unregisterDrapeSource(e){this._drapeSources.has(e)&&(this._drapeSources.delete(e),this.renderer.removeDrapeSourceRenderer(e),this.renderer.ensureDrapeSources(this._drapeSources),this._setContentDirty(),this.notifyChange("running"))}registerDrapeTarget(e){this._drapeTargets.add(e),this.renderer.ensureOverlays(this._drapeTargets,this._drapeSources)}updateOverlayResult(){this.view._stage?.renderer.setParameters({overlays:this.renderer.overlays})}unregisterDrapeTarget(e){this._drapeTargets.delete(e),this.renderer.ensureDrapeTargets(this._drapeTargets)}_setContentDirty(){this.setPlacementDirty(),this.setDrawTexturesDirty()}setPlacementDirty(){this._placementDirty=!0}runTask(e){return this._updateOverlays(e,this.view.state.contentCamera,ds.UPDATE)}_updateOverlays(e,r,i){if(!this._spatialReference)return jo.YIELD;const s=this._computeOverlayResolution(r);this._computeOverlayExtents(r,s,Tm);const n=ru(Tm.inner)/ru(Tm.outer);this.renderer.ensureOverlays(this._drapeTargets,this._drapeSources);const o=this._updateOverlay(Pi.INNER,Tm.inner,s,1*Tm.pixelRatioAdjustment,Tm.mapUnitsPerPixel),a=this._updateOverlay(Pi.OUTER,Tm.outer,s,n*Tm.pixelRatioAdjustment,Tm.mapUnitsPerPixel);o!==uf.EXTENT&&a!==uf.EXTENT||(this._drapeSources.forEach(l=>this._updateDrapeSourceExtent(l)),this.surface.updateTileOverlayParams(i)),o===uf.NONE&&a===uf.NONE||this.setDrawTexturesDirty(),this._placementDirty=!1,e.madeProgress()}_computeOverlayResolution(e){const r=this.view.state.contentPixelRatio,i=e.fullWidth/e.pixelRatio*r,s=e.fullHeight/e.pixelRatio*r,n=Math.ceil(1.5*Math.max(i,s));return Math.min(JY(n),this._maxResolution)}_updateOverlay(e,r,i,s,n){if(this.renderer.overlays.length===0)return uf.NONE;const o=this.renderer.overlays[e],a=o.mapUnitsPerPixel;if(o.mapUnitsPerPixel=n,o.pixelRatio=s,xyt(r,o.extent)&&i===o.resolution)return a===n?uf.NONE:uf.RERENDER_ONLY;Lg(o.extent,r),o.resolution=i;const l=lW(o.extent);return o.renderLocalOrigin=C4(l[0],l[1],0,"OV_"+this._latestOriginId++),uf.EXTENT}setTileParameters(e){const r=e.renderData.overlay;if(this.renderer.overlays.length>0){const i=this.renderer.overlays[Pi.INNER],s=this.renderer.overlays[Pi.OUTER],n=e.extent;this._rectInsideRect(i.extent,n)||this._rectanglesOverlap(n,i.extent)||this._rectanglesOverlap(n,s.extent)?(this._setTileOverlayData(n,Pi.INNER,r),this._setTileOverlayData(n,Pi.OUTER,r)):(this._clearTileOverlayData(Pi.INNER,r),this._clearTileOverlayData(Pi.OUTER,r))}else this._clearTileOverlayData(Pi.INNER,r),this._clearTileOverlayData(Pi.OUTER,r)}overlayPixelSizeInMapUnits(e){if(this.renderer.overlays.length===0)return 0;const r=this.renderer.overlays[Pi.INNER],i=this.renderer.overlays[Pi.OUTER],s=this._pointIsInExtent(e,r.extent)?r:i;return(s.extent[2]-s.extent[0])/s.resolution}_setTileOverlayData(e,r,i){if(this.renderer.overlays.length===0)return;const s=this.renderer.overlays[r].extent,n=ru(s),o=op(s);let a=e[0];if(this._longitudeCyclical){a=this._longitudeCyclical.minimalMonotonic(s[0],a);const l=this._longitudeCyclical.minimalMonotonic(s[0],e[2]);a>l&&(a=l-(e[2]-e[0]))}i.setScale(r,ru(e)/n,op(e)/o),i.setOffset(r,(a-s[0])/n,(e[1]-s[1])/o)}_clearTileOverlayData(e,r){r.setScale(e,-1,-1),r.setOffset(e,-1,-1)}async reloadShaders(){RAe(),await this.renderer.reloadShaders(),this.setDrawTexturesDirty(),this.runTask(za)}_dispatchAnimationUpdate(e){const r=e-this._animationTimeLast;if(r>=this.surface.view._stage.renderer.animationTimestep||this.view.state.forcedAnimationTime!=null||this._drawTexturesDirty||this._drawTexturesAnimateDirty){const i=r/this.surface.view._stage.renderer.animationTimeDilation,s=new xSe(this.view.state.camera,i,this.view.state.forcedAnimationTime);this.renderer.updateAnimation(s)&&(this._drawTexturesAnimateDirty=!0),this._animationTimeLast=e}}setDrawTexturesDirty(){this.renderer.hasOverlays?(this._contentUpdated=!0,this._drawTexturesDirty=!0,this.view._stage.renderView.requestRender()):this.setPlacementDirty()}_intersectGroundFromView(e,r,i,s){const n=this.view.sceneIntersectionHelper.getCenterRayWithSubpixelOffset(e,Eyt,r,i);if(n==null)return!1;const o=n.origin,a=ce(l$,n.origin,n.direction);return this._groundIntersector.reset(o,a,e),this._groundIntersector.intersect([]),this.view.basemapTerrain.intersect(this._groundIntersector,null,o,a),this._groundIntersector.results.min.getIntersectionPoint(s)}_findHorizonBasedPointOfInterest(e,r){let i=.5;const s=.55,n=this.view.renderCoordsHelper.getAltitude(e.eye),o=this.view.pointsOfInterest.centerOnSurfaceFrequent,a=1e-5,l=ge(o.estimatedSurfaceAltitude,e.aboveGround?-1/0:n+a,e.aboveGround?n-a:1/0),c=e.aboveGround;if(this.view.viewingMode==="global"){const h=l$;pE(O5(R5,Nr(this.view.spatialReference).radius+l),yu(e.eye,e.viewForward),h),he(h,h,e.eye);const p=A_.normalize(sbe(e.viewForward,h,e.viewRight))/e.fovY+.5,f=p<=0||p>=1?.5:s;i=c?f*p:p+f*(1-p)}else{const h=.5*Math.PI-Math.acos(-e.viewForward[2]),p=Math.tan(h),f=Lt(0,p,1,0),m=su(f,f,e.projectionMatrix)[1],y=ge(.5+.5*m,0,1);i=y===1||y===0?.5:c?y*s:1-(1-y)*s}return!!this._intersectGroundFromView(e,.5,i,r)&&AF(r,e.eye)<o.distance*o.distance}_computeOverlayExtents(e,r,i){const s=this.view.pointsOfInterest.centerOnSurfaceFrequent.renderLocation,n=C();this._findHorizonBasedPointOfInterest(e,n)||ie(n,s),ni.OVERLAY_SHOW_CENTER?(Gy==null&&(Gy=new HT(this.view.graphics,"red")),Gy.show(n,this._renderSR)):Gy?.hide();const o=Math.max(.1,di(e.eye,n)),a=V_(this.view.renderCoordsHelper,s,e.eye);this._overlaySREqualsRenderSR||Ws(n,this._renderSR,n,this._spatialReference);const l=this.surface.extent,c=!this._isSpherical&&this._spatialReference!=null&&this._spatialReference.isGeographic,h=c&&this._spatialReference!=null?1/Nr(this._spatialReference).metersPerDegree:1,p=this.view.state.contentPixelRatio,f=e.perScreenPixelRatio/p*o*h;i.mapUnitsPerPixel=f/this._worldToPCSRatio;let m=r*f/2*xY,y=!1,_=c?90:1/0;this._isSpherical&&l!=null&&this._spatialReference!=null&&(this._spatialReference.isWebMercator?(m/=Math.cos(QD(n[1])),_=l[3]):(y=!0,m/=Nr(this._spatialReference).metersPerDegree,_=90),m>=_&&(m=_,n[1]=0,this._spatialReference.isWebMercator&&(n[0]=0)));let v=1;y&&(v=1/Math.max(.2,Math.cos(Math.abs(Dt(n[1])))),m*v>180&&(v=180/m),i.mapUnitsPerPixel*=v);const w=Math.log(2)/12;m=Math.exp(Math.round(Math.log(m)/w)*w);const x=m*v,T=32,S=.5*r/(T*x),O=.5*r/(T*m);n[0]=Math.round(n[0]*S)/S,n[1]=Math.round(n[1]*O)/O;const A=i.inner;A[0]=n[0]-x,A[1]=n[1]-m,A[2]=n[0]+x,A[3]=n[1]+m,this._isSpherical&&this._shiftExtentToFitBounds(A,1/0,_);const I=i.outer;if(6*x>ru(l))Lg(I,l);else if(Math.PI/2-Math.abs(a-Math.PI/2)<=.25*Math.PI)I[0]=A[0]-x,I[1]=A[1]-m,I[2]=A[2]+x,I[3]=A[3]+m;else{Ws(e.eye,this._renderSR,l$,this._spatialReference),gf(jv,n,l$);let k=-Math.atan2(jv[1],jv[0])+.125*Math.PI;k<0&&(k+=2*Math.PI);const L=Math.floor(k/(.25*Math.PI));Zb(jv,wyt[L],2*m),jv[0]*=v,jv[2]*=v,sW(I,A,jv)}if(this._isSpherical)I[0]=this._longitudeCyclical.clamp(I[0]),I[2]=this._longitudeCyclical.clamp(I[2]),I[1]=Math.max(I[1],-_),I[3]=Math.min(I[3],_);else{const k=CV(A,l,Tyt),L=CV(I,l,Syt);mK(k,L)&&(I[2]=I[0],I[3]=I[1])}const M=Math.abs(A[2]-A[0])/r;i.mapUnitsPerPixel=Math.max(i.mapUnitsPerPixel,M),i.pixelRatioAdjustment=i.mapUnitsPerPixel/M}_drawOverlayTextures(e,r,i){if(e.length===0||!this._drawTexturesDirty&&!this._drawTexturesAnimateDirty)return;const s=this._drawTexturesDirty;this._drawTexturesDirty=!1,this._drawTexturesAnimateDirty=!1;const n=this._drawOverlay(e[Pi.INNER],i),o=this._drawOverlay(e[Pi.OUTER],i);n!==E2.CHANGED&&o!==E2.CHANGED||this.surface.updateTileOverlayParams(ds.UPDATE),this._collectUnusedRenderTargetMemory(),this.updateOverlayResult(),s?(this.surface.requestRender(r),r===ds.UPDATE&&this.surface.requestUpdate()):this.surface.requestRender(ds.BACKGROUND)}_drawOverlay(e,r){return this._longitudeCyclical?e.setupGeometryViewsCyclical(this._longitudeCyclical):e.setupGeometryViewsDirect(),e.draw(this.renderer,r)}_collectUnusedRenderTargetMemory(){this._hasUnusedRenderTargets=!1,this.renderer.hasOverlays&&(this._hasUnusedRenderTargets=this.renderer.collectUnusedRenderTargetMemory())}_rectanglesOverlap(e,r){return e!=null&&(this._longitudeCyclical?(this._longitudeCyclical.contains(r[0],r[2],e[0])||this._longitudeCyclical.contains(r[0],r[2],e[2])||this._longitudeCyclical.contains(e[0],e[2],r[0]))&&!(e[1]>r[3]||e[3]<r[1]):MR(e,r))}_rectInsideRect(e,r){return r!=null&&(this._longitudeCyclical?this._longitudeCyclical.contains(e[0],e[2],r[0])&&this._longitudeCyclical.contains(e[0],e[2],r[2])&&r[1]>e[1]&&r[3]<e[3]:mK(e,r))}_pointIsInExtent(e,r){if(this._longitudeCyclical)return this._longitudeCyclical.contains(r[0],r[2],e.x)&&e.y>=r[1]&&e.y<=r[3];const i=e.x,s=e.y;return i>r[0]&&i<r[2]&&s>r[1]&&s<r[3]}_shiftExtentToFitBounds(e,r,i){let s=0,n=0;e[0]<-r?s=e[0]+r:e[2]>r&&(s=r-e[2]),e[1]<-i?n=e[1]+i:e[3]>i&&(n=i-e[3]),nN(e,s,n)}get test(){return{renderer:this.renderer,update:()=>this.runTask(za)}}};function xyt(t,e){const i=ni.TESTS_DISABLE_OPTIMIZATIONS?0:1e-5*Math.max(t[2]-t[0],t[3]-t[1],e[2]-e[0],e[3]-e[1]);return Math.abs(e[0]-t[0])<=i&&Math.abs(e[1]-t[1])<=i&&Math.abs(e[2]-t[2])<=i&&Math.abs(e[3]-t[3])<=i}u([d()],Pa.prototype,"_spatialReference",void 0),u([d({readOnly:!0})],Pa.prototype,"running",null),u([d()],Pa.prototype,"_placementDirty",void 0),u([d()],Pa.prototype,"_contentUpdated",void 0),u([d()],Pa.prototype,"_isSpherical",null),u([d()],Pa.prototype,"_worldToPCSRatio",null),u([d({autoDestroy:!0})],Pa.prototype,"renderer",void 0),u([d({constructOnly:!0})],Pa.prototype,"view",void 0),u([d({constructOnly:!0})],Pa.prototype,"surface",void 0),u([d()],Pa.prototype,"suspended",null),u([d()],Pa.prototype,"updating",null),u([d({type:Boolean})],Pa.prototype,"hasHighlights",null),u([d({type:Boolean})],Pa.prototype,"rendersOccluded",null),Pa=u([R("esri.views.3d.terrain.OverlayManager")],Pa);const jv=Wt(),l$=C(),Tm={inner:Ut(),outer:Ut(),mapUnitsPerPixel:0,pixelRatioAdjustment:1},Tyt=Ut(),Syt=Ut(),Eyt=Xn();var uf;(function(t){t[t.NONE=0]="NONE",t[t.EXTENT=1]="EXTENT",t[t.RERENDER_ONLY=2]="RERENDER_ONLY"})(uf||(uf={}));let PAe=class DH{constructor(e,r){this._factoryCallback=e,this._lengthCallback=r,this._pool=new Map}acquire(e){if(!DH.test.disabled){const r=this._pool.get(e);if(r&&r.length!==0)return r.pop()}try{return this._factoryCallback(e)}catch(r){const i=window.performance&&window.performance.memory;let s="";throw i&&(s=`
  totalJSHeapSize: ${i.totalJSHeapSize}, usedJSHeapSize: ${i.usedJSHeapSize}, jsHeapSizeLimit: ${i.jsHeapSizeLimit}`),console.log("Array allocation of size "+e+" failed: "+r+s),r}}release(e){if(DH.test.disabled)return;const r=this._lengthCallback(e);let i=this._pool.get(r);i||(i=new kt({shrink:!0}),this._pool.set(r,i)),i.push(e)}clear(){this._pool.clear()}get test(){return{size:this._pool.size}}};PAe.test={disabled:!1};let Cyt=class{constructor(){this.indices=null,this.vertexAttributes=null,this.boundingBox=xi(),this.indexCount=0,this.numVerticesPerSide=0,this.uvRange=[0,0,1,1],this.outerEdges=[null,null,null,null],this.innerEdges=[null,null,null,null]}},ple=class{constructor(e,r,i,s,n){this.attributes=e,this.localOrigin=r,this.index0=i,this.stride=s,this.count=n}getVertexIndex(e){return this.getAttributeIndex(e)}getAttributeIndex(e){return xe(0<=e&&e<this.count),this.index0+this.stride*e}_getVertexRaw(e,r){this.attributes.position.getVec(e,r)}getVertexPos(e,r){this._getVertexRaw(this.getAttributeIndex(r),e),ce(e,e,this.localOrigin)}getNormal(e,r){const{typedBuffer:i,typedBufferStride:s}=this.attributes.normalCompressed;Lct(e,i,this.getAttributeIndex(r),s)}_setNormal(e,r,i,s){const{typedBuffer:n,typedBufferStride:o}=this.attributes.normalCompressed;yw(n,e,r,i,s,o)}_setUV(e,r,i){rp(this.attributes.uv0,e,r,i)}setNormalFromValues(e,r,i,s){this._setNormal(this.getAttributeIndex(e),r,i,s)}setVertexFromValuesRawPositionUV(e,r,i,s,n,o){const a=this.getAttributeIndex(e);this.attributes.position.setValues(a,r,i,s),this._setUV(a,n,o)}setVertexFromValuesRawPositionUVNormal(e,r,i,s,n,o,a,l,c){const h=this.getAttributeIndex(e);this.attributes.position.setValues(h,r,i,s),this._setUV(h,n,o),this._setNormal(h,a,l,c)}};const Ayt=zi().vec3f(E.POSITION).vec2i16(E.UV0).vec2i16(E.NORMALCOMPRESSED,{glNormalized:!0}),CJ=new PAe(t=>Ayt.createBuffer(t),t=>t.count);function Oyt(){CJ.clear()}function MAe(t){return CJ.acquire(t)}function Ryt(t){CJ.release(t.vertexAttributes),t.vertexAttributes=null,t.indices=null}const fle=16384;function rp(t,e,r,i){t.setValues(e,r*fle,i*fle)}function Th(t,e,r,i){t<i[0]?i[0]=t:t>i[3]&&(i[3]=t),e<i[1]?i[1]=e:e>i[4]&&(i[4]=e),r<i[2]?i[2]=r:r>i[5]&&(i[5]=r)}let Pyt=class{constructor(){this.sinLonLUT=new Array($A+1),this.cosLonLUT=new Array($A+1),this.sinLatLUT=new Array($A+1),this.cosLatLUT=new Array($A+1)}update(e,r,i){const s=r[0],n=r[2];for(let o=0;o<=e;o++){const a=o/e,l=s*(1-a)+n*a;this.sinLonLUT[o]=Math.sin(l),this.cosLonLUT[o]=Math.cos(l);const c=i(a);this.sinLatLUT[o]=Math.sin(c),this.cosLatLUT[o]=Math.cos(c)}}},c$=class{constructor(){this.cornerTiles=[null,null,null,null],this.cornerTileSamplerVersions=[-1,-1,-1,-1]}},Myt=class{constructor(){this.cornerNeighborData=[new c$,new c$,new c$,new c$],this.edgeResolutions=[-1,-1,-1,-1],this.edgePeerNeighbors=[null,null,null,null],this.edgePeerNeighborSamplerVersions=[-1,-1,-1,-1],this.cornerPeerNeighbors=[null,null,null,null]}},Iyt=class{constructor(){this.numVerticesPerSide=0,this.samplerData=null,this.clippingArea=null,this.wireframe=!1,this.samplerDataVersion=0,this.neighborData=new Myt}},IAe=class yD{constructor(e){this._getFadeDuration=e,this._fadeStart=0,this._delayedTime=0}clear(){this._current=Me(this._current),this._next=Me(this._next),this._waiting=Me(this._waiting),this._delayed=Me(this._delayed)}get current(){if(this._current==null)return null;if(!this._isFadingEnabled){const r=this._delayed||this._waiting||this._next||this._current;r!==this._current&&(this._current=null,this.clear(),this._current=r)}let e=yD.test.fadeMoment;if(this._delayed!=null&&(e=e||performance.now(),e>=this._delayedTime&&(this._push(this._delayed,Ag.Immediate),this._delayed=null)),this._next!=null){e=e||performance.now();const r=this._fadeDuration,i=this._current!=null&&this._next.texture===this._current.texture,s=this._next.type!==rn.FADING,n=e-this._fadeStart>=r;(i||s||n)&&(Me(this._current),this._current=this._next,this._next=this._waiting,this._waiting=null,this._fadeStart=this._alignFadeStart(e))}return this._current}get next(){return this._next}get fadeFactor(){if(this._next==null)return 1;const e=yD.test.fadeMoment||performance.now(),r=Math.max(0,e-this._fadeStart),i=this._fadeDuration;return r>i?0:1-r/i}get isFading(){return this._next!=null||this._delayed!=null}push(e,r=Ag.Immediate){this._delayed=Me(this._delayed),this._push(e,r)}_push(e,r){if(this._isFadingEnabled||this.clear(),this._current==null)return void(this._current=e);const i=yD.test.fadeMoment||performance.now();return r!==Ag.Immediate?(this._delayed=e,void(this._delayedTime=i+r)):this._next==null?(this._next=e,void(this._fadeStart=this._alignFadeStart(i))):void(e!=null&&(Me(this._waiting),this._waiting=e))}get _fadeDuration(){return this._waiting==null?this._getFadeDuration():.5*this._getFadeDuration()}_alignFadeStart(e){const r=this._getFadeDuration();return e+r-e%r}get _isFadingEnabled(){return this._getFadeDuration()>0}};var Ag;IAe.test={fadeMoment:0},function(t){t[t.Immediate=0]="Immediate",t[t.Delayed=5e3]="Delayed"}(Ag||(Ag={}));var V2;(function(t){t[t.BACK_TO_FRONT=-1]="BACK_TO_FRONT",t[t.NONE=0]="NONE",t[t.FRONT_TO_BACK=1]="FRONT_TO_BACK"})(V2||(V2={}));let $Ae=class{constructor(){this._queue=new kt,this.remove=()=>{}}get done(){return this._queue.length===0&&(!this._last||this._last.isLeaf)}resetOne(e){this._queue.clear(),this._queue.push(e),this._last=void 0}reset(e=null){this._queue.clear(),e!=null&&this._queue.pushArray(e),this._last=void 0}skipSubtree(){this._last=void 0}next(){const e=this._last?.children;return e&&e[0]&&this._queue.pushArray(e),this._last=this._queue.pop(),this._last}},$yt=class{constructor(){this._q=new kt}get done(){return this._q.length===0}reset(e){if(this._q.clear(),e!=null){this._q.pushArray(e);for(let r=0;r<this._q.length;++r){const i=this._q.data[r];i.isLeaf||this._q.pushArray(i.children)}}}next(){return this._q.pop()}};function lO(t,e,r){if(e==null||e.fullExtent==null)return!1;const i=e.fullExtent,s=t.extent;if(r){if(s[0]<i.xmin||s[1]<i.ymin||s[2]>i.xmax||s[3]>i.ymax)return!1}else if(i.xmin>s[2]||i.ymin>s[3]||i.xmax<s[0]||i.ymax<s[1])return!1;const n=t.surface.tilingScheme.levels[t.level].scale,o=e.minScale;if(o>0&&n>1.00000001*o)return!1;const a=e.maxScale;return!(a>0&&n<.99999999*a)}function Og(t,e){const r=t.lij,i=e.lij;return r[0]-i[0]||r[1]-i[1]||r[2]-i[2]}function LAe(t,e,r=null){r==null||r.length===0?t===V2.BACK_TO_FRONT?e.sort(Lyt):e.sort(Dyt):e.sort((i,s)=>Nyt(i,s,t,r))}function Lyt(t,e){const r=e.screenDepth-t.screenDepth;if(r!==0)return r;const i=t.lij,s=e.lij;return i[0]-s[0]||i[1]-s[1]||i[2]-s[2]}function Dyt(t,e){const r=t.screenDepth-e.screenDepth;if(r!==0)return r;const i=t.lij,s=e.lij;return i[0]-s[0]||i[1]-s[1]||i[2]-s[2]}function DAe(t,e,r){const i=t.screenDepth,s=e.screenDepth;return i<s?-r:i>s?r:Og(t,e)}function Nyt(t,e,r,i){return mle(t,i)===mle(e,i)?DAe(t,e,r):t?r:-r}function mle(t,e){for(const r of e)if(t.intersectsExtent(r))return!0;return!1}function Fyt(t,e){const r=t.distanceToPOI-e.distanceToPOI;if(r!==0)return r;const i=t.lij,s=e.lij;return i[0]-s[0]||i[1]-s[1]||i[2]-s[2]}function Uyt(t,e){const r=t.length;for(let i=0;i<r;++i)t.at(i).updateDistanceToPOI(e);t.sort(Fyt)}function kyt(t,e,r){let i=1,s=0,n=0;for(;t!==e;)if(i*=.5,s*=.5,n*=.5,1&t.lij[2]&&(s+=.5),!(1&t.lij[1])&&(n+=.5),(t=t.parent)==null)throw new Error("tile was not a descendant of upsampleTile");r.init(e,s,n,i)}function Vyt(t){for(let e=0;e<t.length;e++){const r=t[e],i=r.parent;if(i)for(let s=0;s<4;s++){const n=i.children[s];if(n&&n!==r)return!0}}return!1}function _5t(t,e){if(!t||!e||t[0]===e[0])return!1;const r=t[0]<e[0],i=r?t:e,s=r?e:t,n=1<<s[0]-i[0];return Math.floor(s[1]/n)===i[1]&&Math.floor(s[2]/n)===i[2]}let AJ=class{get updating(){return!!this._tileRequested}init(e,r,i,s){this.tile=e,this._layerIdx=r,this._layerClass=i,this._suspended=s,this._tileLayerInfo=e.getLayerInfo(r,i),this._tileRequested=null;const n=this._findAncestorWithData();this._setUpsampleTile(n)}startLoading(){return this._requestNext()}dispose(){this._tileRequested&&(this._tileRequested.unrequestLayerData(this._layerIdx,this._layerClass,this),this._tileRequested=null),this.tile=null,this._tileLayerInfo=null}setSuspension(e){e!==this._suspended&&(this._suspended=e,e?this._tileRequested&&(this._tileRequested.unrequestLayerData(this._layerIdx,this._layerClass,this),this._tileRequested=null):this._tileLayerInfo.data||this.update())}update(){const e=this._findAncestorWithData();return this._setUpsampleTile(e),this._requestNext()}dataArrived(e,r){this._setUpsampleTile(e,r),this._tileRequested=null,e===this.tile?this.tile.updateRenderData(this._layerClass,rn.FADING,r):this._requestNext()}dataMissing(){this._tileRequested=null,this._tileLayerInfo.data=null,this._requestNext()}_agentDone(){this.tile.agentDone(this._layerIdx,this._layerClass),this.dispose()}_requestNext(){if(this._suspended)return!0;const e=this._findNextDownload();if(this._tileRequested){if(e===this._tileRequested)return!0;this._tileRequested.unrequestLayerData(this._layerIdx,this._layerClass,this),this._tileRequested=null}return e!=null?e.requestLayerData(this._layerIdx,this._layerClass,this)&&(this._tileRequested=e):this._agentDone(),!!this._tileRequested}_findNextDownload(){const e=this._layerIdx,r=this._layerClass,i=this.tile.surface.layerViewByIndex(e,r),s=RH(i),{minLevel:n,maxLevel:o}=i.dataLevelRange,a=this._desiredMinLevelDelta,l=this._progressiveLevelModulo+a,c=this._scaleRangeEnabled?lO:()=>!0;let h=this.tile;const p=h.level;let f;const m=this._tileLayerInfo.upsampleInfo,y=m!=null?m.tile.level:-1,_=m!=null&&y-p>=a,v=s?.tilemapCache,w=i.type==="vector-tile-3d"?i.schemaHelper:null;for(;h&&c(h,s,!1)&&h.level>=n;){const x=h.level,T=p-x,S=h.layerInfo[r][e];if(S.data&&T>=a){(!_||x>y)&&this._setUpsampleTile(h),S.dataInvalidated&&(f=h);break}const O=w?.getLevelRowColumn(h.lij)??h.lij;if(v?.getAvailability(O[0],O[1],h.lij[2])!=="unavailable"&&x<=o&&!S.data&&!S.dataMissing&&((!f||h.level===n||x%Wbe==0||p-f.level<a)&&(f=h),T>=l))break;h=h.parent}if(f!=null&&p-f.level<a)if(m)f=null;else{const x=this._findAncestorWithData();x!=null&&(this._setUpsampleTile(x),f=x.layerInfo[r][e].dataInvalidated?x:null)}return f}_findAncestorWithData(){const e=this.tile.elevationLevel,r=this._desiredMinLevelDelta;let i;for(let s=this.tile;s;s=s.parent)if(s.hasLayerData(this._layerIdx,this._layerClass)){if(e-s.level>=r)return s;i=s}return i}_setUpsampleTile(e,r){this._tileLayerInfo.setUpsampleInfo(this.tile,e),this.tile.updateRenderData(this._layerClass,rn.FADING,r)}get test(){return{findNextDownload:()=>this._findNextDownload(),tileLayerInfo:this._tileLayerInfo}}},zyt=class extends AJ{get _desiredMinLevelDelta(){throw gle}get _progressiveLevelModulo(){throw gle}dispose(){}};const gle=new Error("Abstract method called on TileAgent"),Fl=new zyt;let NAe=class extends AJ{constructor(){super(...arguments),this._scaleRangeEnabled=!1}get _desiredMinLevelDelta(){return bG(this.tile.level)-(this.tile.elevationLevel-this.tile.level)}get _progressiveLevelModulo(){return 0}},FAe=class extends AJ{constructor(){super(),this._scaleRangeEnabled=!0}get _desiredMinLevelDelta(){return 0}get _progressiveLevelModulo(){return Wbe}};var Ub,vw;(function(t){t[t.Stretch=0]="Stretch",t[t.Lut=1]="Lut",t[t.Hillshade=2]="Hillshade",t[t.COUNT=3]="COUNT"})(Ub||(Ub={})),function(t){t[t.Noop=0]="Noop",t[t.PerBand=1]="PerBand",t[t.COUNT=2]="COUNT"}(vw||(vw={}));function Byt(t){t.fragment.uniforms.add(new Je("u_colormap",e=>e.u_colormap),new Re("u_colormapOffset",e=>e.colormap.u_colormapOffset),new Re("u_colormapMaxIndex",e=>e.colormap.u_colormapMaxIndex),new Re("u_opacity",e=>e.common.u_opacity)),t.fragment.code.add(b`vec4 colormap(vec4 currentPixel, bool isFloat) {
float colorIndex = isFloat ? currentPixel.r - u_colormapOffset : currentPixel.r * 255.0 - u_colormapOffset;
vec4 result;
if (currentPixel.a == 0.0 || colorIndex > u_colormapMaxIndex) {
result = vec4(0.0, 0.0, 0.0, 0.0);
} else {
vec2 texelCoordinates = vec2((colorIndex + 0.5), 0.5);
result = texelFetch(u_colormap, ivec2(texelCoordinates), 0);
}
return result;
}`)}function Gyt(t){t.fragment.uniforms.add(new Je("u_transformGrid",e=>e.u_transformGrid),new Sr("u_transformSpacing",e=>e.common.u_transformSpacing),new Sr("u_targetImageSize",e=>e.common.u_targetImageSize)),t.fragment.code.add(b`vec2 projectPixelLocation(vec2 coords) {
vec2 index_image = floor(coords * u_targetImageSize);
vec2 oneTransformPixel = vec2(4.0, 1.0);
vec2 index_transform = floor(index_image / u_transformSpacing) * oneTransformPixel;
vec2 pos = fract((index_image + 0.5) / u_transformSpacing);
vec2 transform_location = index_transform + 0.5;
vec2 srcLocation;
if (pos.s <= pos.t) {
vec3 ll_abc = texelFetch(u_transformGrid, ivec2(transform_location), 0).rgb;
vec3 ll_def = texelFetch(u_transformGrid, ivec2(transform_location.s + 1.0, transform_location.t), 0).rgb;
srcLocation.s = dot(ll_abc, vec3(pos, 1.0));
srcLocation.t = dot(ll_def, vec3(pos, 1.0));
} else {
vec3 ur_abc = texelFetch(u_transformGrid, ivec2(transform_location.s + 2.0, transform_location.t), 0).rgb;
vec3 ur_def = texelFetch(u_transformGrid, ivec2(transform_location.s + 3.0, transform_location.t), 0).rgb;
srcLocation.s = dot(ur_abc, vec3(pos, 1.0));
srcLocation.t = dot(ur_def, vec3(pos, 1.0));
}
return srcLocation;
}`)}let UAe=class extends ei{constructor(){super(...arguments),this.scale=1,this.offset=ap}};function kAe(t){t.attributes.add(E.POSITION,"vec2"),t.attributes.add(E.UV0,"vec2"),t.vertex.uniforms.add(new Re("scale",e=>e.scale)),t.vertex.uniforms.add(new Sr("offset",e=>e.offset)),t.varyings.add("uv","vec2"),t.varyings.add("vuv","vec2"),t.vertex.code.add(b`void main(void) {
gl_Position = vec4(position, 0.0, 1.0);
uv = uv0 * scale + offset;
vuv = uv0;
}`)}let jyt=class extends UAe{constructor(e,r,i){super(),this.common=e,this.u_image=r,this.u_transformGrid=i}};function Hyt(t,e){t.include(Gyt),t.fragment.uniforms.add(new Je("u_image",i=>i.u_image),new Mf("u_flipY",i=>i.common.u_flipY),new Mf("u_applyTransform",i=>i.common.u_applyTransform));const{requireBilinearWithNN:r}=e;r&&t.fragment.uniforms.add(new Sr("u_srcImageSize",i=>i.common.u_srcImageSize)),t.fragment.code.add(b`vec2 getPixelLocation(vec2 coords) {
vec2 targetLocation = u_flipY ? vec2(coords.s, 1.0 - coords.t) : coords;
if (!u_applyTransform) {
return targetLocation;
}
return projectPixelLocation(targetLocation);
}
bool isOutside(vec2 coords){
if (coords.t>1.00001 ||coords.t<-0.00001 || coords.s>1.00001 ||coords.s<-0.00001) {
return true;
} else {
return false;
}
}`),r?t.fragment.code.add(b`vec4 sampleBilinear(sampler2D sampler, vec2 coords, vec2 texSize) {
vec2 texelStart = floor(coords * texSize);
vec2 coord0 = texelStart / texSize;
vec2 coord1 = (texelStart +  vec2(1.0, 0.0)) / texSize;
vec2 coord2 = (texelStart +  vec2(0.0, 1.0)) / texSize;
vec2 coord3 = (texelStart +  vec2(1.0, 1.0)) / texSize;
vec4 color0 = texture(sampler, coord0);
vec4 color1 = texture(sampler, coord1);
vec4 color2 = texture(sampler, coord2);
vec4 color3 = texture(sampler, coord3);
vec2 blend = fract(coords * texSize);
vec4 color01 = mix(color0, color1, blend.x);
vec4 color23 = mix(color2, color3, blend.x);
vec4 color = mix(color01, color23, blend.y);
float alpha = floor(color0.a * color1.a * color2.a * color3.a + 0.5);
color = color * alpha + (1.0 - alpha) * texture(sampler, coords);
return color;
}
vec4 getPixel(vec2 pixelLocation) {
return sampleBilinear(u_image, pixelLocation, u_srcImageSize);
}`):t.fragment.code.add(b`vec4 getPixel(vec2 pixelLocation) {
return texture(u_image, pixelLocation);
}`)}var Pe;(function(t){t[t.Normal=0]="Normal",t[t.Average=1]="Average",t[t.Lighten=2]="Lighten",t[t.Lighter=3]="Lighter",t[t.Plus=4]="Plus",t[t.Screen=5]="Screen",t[t.ColorDodge=6]="ColorDodge",t[t.Darken=7]="Darken",t[t.Multiply=8]="Multiply",t[t.ColorBurn=9]="ColorBurn",t[t.Overlay=10]="Overlay",t[t.SoftLight=11]="SoftLight",t[t.HardLight=12]="HardLight",t[t.VividLight=13]="VividLight",t[t.Hue=14]="Hue",t[t.Saturation=15]="Saturation",t[t.Luminosity=16]="Luminosity",t[t.Color=17]="Color",t[t.DestinationOver=18]="DestinationOver",t[t.DestinationAtop=19]="DestinationAtop",t[t.DestinationIn=20]="DestinationIn",t[t.DestinationOut=21]="DestinationOut",t[t.SourceAtop=22]="SourceAtop",t[t.SourceIn=23]="SourceIn",t[t.SourceOut=24]="SourceOut",t[t.Xor=25]="Xor",t[t.Difference=26]="Difference",t[t.Exclusion=27]="Exclusion",t[t.Minus=28]="Minus",t[t.Invert=29]="Invert",t[t.Reflect=30]="Reflect",t[t.COUNT=31]="COUNT"})(Pe||(Pe={}));const NH={normal:Pe.Normal,average:Pe.Average,lighten:Pe.Lighten,lighter:Pe.Lighter,screen:Pe.Screen,plus:Pe.Plus,"color-dodge":Pe.ColorDodge,darken:Pe.Darken,multiply:Pe.Multiply,"color-burn":Pe.ColorBurn,overlay:Pe.Overlay,"soft-light":Pe.SoftLight,"hard-light":Pe.HardLight,"vivid-light":Pe.VividLight,hue:Pe.Hue,saturation:Pe.Saturation,luminosity:Pe.Luminosity,color:Pe.Color,difference:Pe.Difference,exclusion:Pe.Exclusion,minus:Pe.Minus,invert:Pe.Invert,reflect:Pe.Reflect,"destination-over":Pe.DestinationOver,"destination-atop":Pe.DestinationAtop,"destination-in":Pe.DestinationIn,"destination-out":Pe.DestinationOut,"source-atop":Pe.SourceAtop,"source-in":Pe.SourceIn,"source-out":Pe.SourceOut,xor:Pe.Xor};function qyt(t){return t===Pe.DestinationOver||t===Pe.DestinationAtop||t===Pe.DestinationIn||t===Pe.DestinationOut||t===Pe.SourceAtop||t===Pe.SourceIn||t===Pe.SourceOut||t===Pe.Xor}function OJ(t){t.code.add(b`
    float lineFactorAtPosition(float value) {
      float pos = value * ${b.float(257)};
      if(pos < 0.5 || pos > ${b.float(257-.5)}) {
        return 1.0;
      }

      pos = pos + 0.5;
      float modulo = mod(pos, 16.0);
      return modulo <= 2.0 ?  1.0 - abs(modulo - 1.0) : 0.0;
    }

    float lineFactorAtUV(vec2 uv) {
      return max(lineFactorAtPosition(uv.x), lineFactorAtPosition(uv.y));
    }

    float lineFactor(vec2 uv) {
      vec2 offset = fwidth(uv) * 0.25;
      return (lineFactorAtUV(vec2(uv.x + offset.x, uv.y + offset.y)) +
              lineFactorAtUV(vec2(uv.x - offset.x, uv.y + offset.y)) +
              lineFactorAtUV(vec2(uv.x + offset.x, uv.y - offset.y)) +
              lineFactorAtUV(vec2(uv.x - offset.x, uv.y - offset.y))) / 4.0;
    }

    vec3 gridColor(vec2 uv) {
      float line = lineFactor(uv) * 0.1 + 0.9;
      return vec3(1.0, 0.972, 0.918) * line;
    }`)}function Wyt(t,e){const r=e.blendMode;r!==Pe.Normal&&(r===Pe.Reflect&&t.code.add(b`float reflectBlend(in float cb, in float cl) {
return (cl == 1.0) ? cl : min(cb * cb / (1.0 - cl), 1.0);
}`),r!==Pe.ColorDodge&&r!==Pe.VividLight||t.code.add(b`float colorDodge(in float cb, in float cl) {
return (cb == 0.0) ? 0.0 : (cl == 1.0) ? 1.0 : min(1.0, cb / (1.0 - cl));
}`),r!==Pe.ColorBurn&&r!==Pe.VividLight||t.code.add(b`float colorBurn(in float cb, in float cl) {
return (cb == 1.0) ? 1.0 : (cl == 0.0) ? 0.0 : 1.0 - min(1.0, (1.0 - cb) / cl);
}`),r===Pe.Overlay&&t.code.add(b`float overlay(in float cb, in float cl) {
return (1.0 - step(0.5, cl)) * (1.0 - 2.0 * (1.0 - cl ) * (1.0 - cb)) + step(0.5, cl) * (2.0 * cl * cb);
}`),r===Pe.HardLight&&t.code.add(b`float hardLight(in float cb, in float cl) {
return (1.0 - step(0.5, cl)) * (2.0 * cl * cb) + step(0.5, cl) * (1.0 - 2.0 * (1.0 - cl) * (1.0 - cb));
}`),r===Pe.SoftLight&&t.code.add(b`float softLight(in float cb, in float cl) {
if (cl <= 0.5) {
return cb - (1.0 - 2.0 * cl) * cb * (1.0 - cb);
}
if (cb <= 0.25) {
return cb + (2.0 * cl - 1.0) * cb * ((16.0 * cb - 12.0) * cb + 3.0);
}
return cb + (2.0 * cl - 1.0) * (sqrt(cb) - cb);
}`),r===Pe.VividLight&&t.code.add(b`float vividLight(in float cb, in float cl) {
return (1.0 - step(0.5, cl)) * colorBurn(cb, 2.0 * cl) + step(0.5, cl) * colorDodge(cb, (2.0 * (cl - 0.5)));
}`),r!==Pe.Hue&&r!==Pe.Saturation&&r!==Pe.Color&&r!==Pe.Luminosity||(t.code.add(b`float minv3(in vec3 c) {
return min(min(c.r, c.g), c.b);
}
float maxv3(in vec3 c) {
return max(max(c.r, c.g), c.b);
}
float lumv3(in vec3 c) {
return dot(c, vec3(0.3, 0.59, 0.11));
}
vec3 clipColor(vec3 color) {
float lum = lumv3(color);
float mincol = minv3(color);
float maxcol = maxv3(color);
if (mincol < 0.0) {
color = lum + ((color - lum) * lum) / (lum - mincol);
}
if (maxcol > 1.0) {
color = lum + ((color - lum) * (1.0 - lum)) / (maxcol - lum);
}
return color;
}
vec3 setLum(vec3 cbase, vec3 clum) {
return clipColor(cbase + vec3(lumv3(clum) - lumv3(cbase)));
}`),r!==Pe.Hue&&r!==Pe.Saturation||t.code.add(b`float satv3(vec3 c) {
return maxv3(c) - minv3(c);
}
vec3 setLumSat(vec3 cbase, vec3 csat, vec3 clum)
{
float minbase = minv3(cbase);
float sbase = satv3(cbase);
float ssat = satv3(csat);
return setLum(sbase > 0.0 ? (cbase - minbase) * ssat / sbase : vec3(0.0), clum);
}`)),t.code.add(b`
    vec4 applyBlendMode(vec3 cl, float ol, vec3 cb, float ob) {
      ${r===Pe.Multiply?b`return vec4(cl * ol * cb * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:r===Pe.Average?b`return vec4((cb + cl) * 0.5 * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:r===Pe.Lighten?b`return vec4(max(cb, cl) * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:r===Pe.Darken?b`return vec4(min(cl, cb) * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:r===Pe.Lighter?b`return vec4(cl * ol + cb * ob, ol + ob);`:r===Pe.Plus?b`return clamp(vec4(cl.rgb + cb.rgb, ol + ob), 0.0, 1.0);`:r===Pe.Minus?b`return vec4(clamp(vec3(cb.rgb - cl.rgb), 0.0, 1.0), ob * ol);`:r===Pe.Screen?b`return vec4((cl + cb - cl * cb) * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:r===Pe.Difference?b`return vec4(abs(cb - cl) * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:r===Pe.Invert?b`return vec4((1.0 - cb) * ol * ob + cb * ob * (1.0 - ol), ob);`:r===Pe.DestinationOver?b`return vec4(cl * ol * (1.0 - ob) + cb * ob, ol + ob - ol * ob);`:r===Pe.DestinationAtop?b`return vec4(cl * ol * (1.0 - ob) + cb * ob * ol, ol);`:r===Pe.DestinationOut?b`return vec4(cb * ob * (1.0 - ol), ob * (1.0 - ol));`:r===Pe.SourceAtop?b`return vec4(cl * ol * ob + cb * ob * (1.0 - ol), ob);`:r===Pe.SourceOut?b`return vec4(cl * ol * (1.0 - ob), ol * (1.0 - ob));`:r===Pe.Xor?b`return vec4(cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), ol * (1.0 - ob) + ob * (1.0 - ol));`:r===Pe.DestinationIn?b`return vec4(cb * ob * ol, ol * ob);`:r===Pe.SourceIn?b`return vec4(cl * ol * ob, ol * ob);`:r===Pe.Hue?b`
          vec3 f = setLumSat(cl, cb, cb);
          return vec4(f * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:r===Pe.Saturation?b`
          vec3 f = setLumSat(cb, cl, cb);
          return vec4(f * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:r===Pe.Color?b`
          vec3 f = setLum(cl, cb);
          return vec4(f * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:r===Pe.Luminosity?b`
          vec3 f = setLum(cb, cl);
          return vec4(f * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:r===Pe.Exclusion?b`
          vec3 f = cl + cb - 2.0 * cl * cb;
          return vec4(f * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:r===Pe.Reflect?b`
          vec3 f = vec3(reflectBlend(cb.r, cl.r), reflectBlend(cb.g, cl.g), reflectBlend(cb.b, cl.b));
          return vec4(f * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:r===Pe.ColorDodge?b`
          vec3 f = vec3(colorDodge(cb.r, cl.r), colorDodge(cb.g, cl.g), colorDodge(cb.b, cl.b));
          return vec4(f * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:r===Pe.ColorBurn?b`
          vec3 f = vec3(colorBurn(cb.r, cl.r), colorBurn(cb.g, cl.g), colorBurn(cb.b, cl.b));
          return vec4(f * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:r===Pe.Overlay?b`
          vec3 f = vec3(overlay(cb.r, cl.r), overlay(cb.g, cl.g), overlay(cb.b, cl.b));
          return vec4(f * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:r===Pe.SoftLight?b`
          vec3 f = vec3(softLight(cb.r, cl.r), softLight(cb.g, cl.g), softLight(cb.b, cl.b));
          return vec4(f * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:r===Pe.HardLight?b`
          vec3 f = vec3(hardLight(cb.r, cl.r), hardLight(cb.g, cl.g), hardLight(cb.b, cl.b));
          return vec4(f * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:r===Pe.VividLight?b`
          vec3 f = vec3(vividLight(cb.r, cl.r), vividLight(cb.g, cl.g), vividLight(cb.b, cl.b));
          return vec4(f * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:b``}
    }
  `))}var Sn,Xd,Nd;(function(t){t[t.Composite=0]="Composite",t[t.ColorComposite=1]="ColorComposite",t[t.GridComposite=2]="GridComposite",t[t.GroupBackgroundComposite=3]="GroupBackgroundComposite",t[t.COUNT=4]="COUNT"})(Sn||(Sn={})),function(t){t[t.NotRequired=0]="NotRequired",t[t.Required=1]="Required",t[t.COUNT=2]="COUNT"}(Xd||(Xd={})),function(t){t[t.Off=0]="Off",t[t.On=1]="On",t[t.COUNT=2]="COUNT"}(Nd||(Nd={}));function VAe(t,e){const r=e.output===Sn.GridComposite,i=e.output===Sn.ColorComposite,s=e.output===Sn.GroupBackgroundComposite,n=e.output===Sn.Composite;r&&t.fragment.include(OJ),i&&t.fragment.uniforms.add(new Ft("backgroundColor",c=>c.backgroundColor));const o=e.baseOpacityMode===Xd.Required;o&&t.fragment.uniforms.add(new Re("baseOpacity",c=>c.baseOpacity)),n&&t.fragment.uniforms.add(new Je("fboColor",c=>c.fboTexture));const a=e.blendMode!==Pe.Normal,l=e.premultipliedSource===Nd.On;t.fragment.include(Wyt,e),t.fragment.code.add(b`
    vec4 getBackground(vec2 uv) {
      return ${o?b`baseOpacity *`:""} ${s?b`vec4(0.0, 0.0, 0.0, 0.0)`:i?b`vec4(backgroundColor, 1.0)`:r?b`vec4(gridColor(uv), 1.0)`:b`texelFetch(fboColor, ivec2(gl_FragCoord.xy), 0)`};
    }

    vec4 blendLayers(vec4 bgColor, vec4 colorLayer, float opacity) {
      ${a?b`
          vec3 cl = colorLayer.a == 0.0 ? colorLayer.rgb : colorLayer.rgb / colorLayer.a;
          vec3 cb = bgColor.a == 0.0 ? bgColor.rgb : bgColor.rgb / bgColor.a;
          return applyBlendMode(clamp(cl, vec3(0.0), vec3(1.0)), colorLayer.a * opacity, cb, bgColor.a);`:b`
          float composeAlpha = colorLayer.a * opacity;
          return ${!l&&(n&&!o||s)?b`colorLayer * opacity;`:b`bgColor * (1.0 - composeAlpha) + colorLayer * opacity;`}`}
    }`)}let I6=class extends jyt{constructor(e,r,i,s,n,o){super(e,s,n),this.colormap=r,this.symbolizer=i,this.u_colormap=o,this.backgroundColor=ja,this.fboTexture=null,this.baseOpacity=1}},Zyt=class extends I6{},Xyt=class extends I6{};function Yyt(t){const e=new wr;return e.include(kAe),e.include(Hyt,t),e.include(Byt,t),e.include(VAe,t),e.fragment.code.add(b`vec4 applyBackgroundBlend(vec4 layerColor) {
vec4 bgColor = getBackground(vuv);
return blendLayers(bgColor, layerColor, u_opacity);
}`),t.colorizerType===Ub.Stretch?Qyt(e,t):t.colorizerType===Ub.Lut?Jyt(e):t.colorizerType===Ub.Hillshade&&Kyt(e,t),e}function Jyt(t){t.fragment.code.add(b`void main() {
vec2 pixelLocation = getPixelLocation(uv);
if (isOutside(pixelLocation)) {
fragColor = applyBackgroundBlend(vec4(0.0, 0.0, 0.0, 0.0));
return;
}
vec4 currentPixel = getPixel(pixelLocation);
fragColor = applyBackgroundBlend(colormap(currentPixel, true));
}`)}function Qyt(t,e){t.fragment.uniforms.add(new pP("u_bandCount",i=>i.symbolizer.u_bandCount),new bl("u_minCutOff",i=>i.symbolizer.u_minCutOff,3),new bl("u_maxCutOff",i=>i.symbolizer.u_maxCutOff,3),new bl("u_factor",i=>i.symbolizer.u_factor,3),new Re("u_minOutput",i=>i.symbolizer.u_minOutput),new Re("u_maxOutput",i=>i.symbolizer.u_maxOutput),new Mf("u_useGamma",i=>i.symbolizer.u_useGamma),new bl("u_gamma",i=>i.symbolizer.u_gamma,3),new bl("u_gammaCorrection",i=>i.symbolizer.u_gammaCorrection,3),new Re("u_opacity",i=>i.common.u_opacity)),t.fragment.code.add(b`float stretchOneValue(float val, float minCutOff, float maxCutOff, float minOutput, float maxOutput, float factor, bool useGamma, float gamma, float gammaCorrection) {
if (val >= maxCutOff) {
return maxOutput;
} else if (val <= minCutOff) {
return minOutput;
}
float stretchedVal;
if (useGamma) {
float tempf = 1.0;
float outRange = maxOutput - minOutput;
float relativeVal = (val - minCutOff) / (maxCutOff - minCutOff);
if (gamma > 1.0) {
tempf -= pow(1.0 / outRange, relativeVal * gammaCorrection);
}
stretchedVal = (tempf * outRange * pow(relativeVal, 1.0 / gamma) + minOutput) / 255.0;
} else {
stretchedVal = minOutput + (val - minCutOff) * factor;
}
return stretchedVal;
}`);const r=e.applyColormap?b`fragColor = applyBackgroundBlend(colormap(vec4(grayVal, grayVal, grayVal, currentPixel.a), !u_useGamma));`:b`fragColor = applyBackgroundBlend(vec4(grayVal, grayVal, grayVal, currentPixel.a));`;t.fragment.code.add(b`
      void main() {
        vec2 pixelLocation = getPixelLocation(uv);
        if (isOutside(pixelLocation)) {
          fragColor = applyBackgroundBlend(vec4(0.0, 0.0, 0.0, 0.0));
          return;
        }

        vec4 currentPixel = getPixel(pixelLocation);
        ${e.stretchType===vw.Noop?b`
        fragColor = applyBackgroundBlend(currentPixel);`:b`
        if (currentPixel.a == 0.0) {
          fragColor = applyBackgroundBlend(vec4(0.0, 0.0, 0.0, 0.0));
          return;
        }
        if (u_bandCount == 1) {
          float grayVal = stretchOneValue(currentPixel.r, u_minCutOff[0], u_maxCutOff[0], u_minOutput, u_maxOutput, u_factor[0], u_useGamma, u_gamma[0], u_gammaCorrection[0]);
          ${r}
        } else {
          float redVal = stretchOneValue(currentPixel.r, u_minCutOff[0], u_maxCutOff[0], u_minOutput, u_maxOutput, u_factor[0], u_useGamma, u_gamma[0], u_gammaCorrection[0]);
          float greenVal = stretchOneValue(currentPixel.g, u_minCutOff[1], u_maxCutOff[1], u_minOutput, u_maxOutput, u_factor[1], u_useGamma, u_gamma[1], u_gammaCorrection[1]);
          float blueVal = stretchOneValue(currentPixel.b, u_minCutOff[2], u_maxCutOff[2], u_minOutput, u_maxOutput, u_factor[2], u_useGamma, u_gamma[2], u_gammaCorrection[2]);
          fragColor = applyBackgroundBlend(vec4(redVal, greenVal, blueVal, currentPixel.a));
        }`}
      }`)}function Kyt(t,e){const r=t.fragment;r.uniforms.add(new Je("u_image",s=>s.u_image),new pP("u_hillshadeType",s=>s.symbolizer.u_hillshadeType),new bl("u_sinZcosAs",s=>s.symbolizer.u_sinZcosAs,6),new bl("u_sinZsinAs",s=>s.symbolizer.u_sinZsinAs,6),new bl("u_cosZs",s=>s.symbolizer.u_cosZs,6),new bl("u_weights",s=>s.symbolizer.u_weights,6),new Sr("u_factor",s=>s.symbolizer.u_factor),new Re("u_minValue",s=>s.symbolizer.u_minValue),new Re("u_maxValue",s=>s.symbolizer.u_maxValue),new Sr("u_srcImageSize",s=>s.common.u_srcImageSize)),r.include(sm),r.code.add(b`vec4 overlay(float val, float minValue, float maxValue, float hillshade, float alpha) {
val = clamp((val - minValue) / (maxValue - minValue), 0.0, 1.0);
vec4 color = colormap(vec4(val, val, val, 1.0), false);
vec3 hsv = rgb2hsv(color.rgb);
hsv.z = hillshade;
return vec4(hsv2rgb(hsv), 1.0) * alpha * color.a;
}`),r.code.add(b`float getNeighborHoodAlpha(float a, float b, float c, float d, float e, float f, float g, float h, float i){
if (a == 0.0 || a == 0.0 || a==0.0 || a == 0.0 || a == 0.0 || a==0.0 || a == 0.0 || a == 0.0 || a==0.0) {
return 0.0;
}  else {
return e;
}
}`);const i=e.applyColormap?b`fragColor = applyBackgroundBlend(overlay(ve.r, u_minValue, u_maxValue, hillshade, alpha));`:b`hillshade *= alpha;
fragColor = applyBackgroundBlend(vec4(hillshade, hillshade, hillshade, alpha));`;r.code.add(b`
    void main() {
      vec2 pixelLocation = getPixelLocation(uv);
      if (isOutside(pixelLocation)) {
        fragColor = applyBackgroundBlend(vec4(0.0, 0.0, 0.0, 0.0));
        return;
      }

      vec4 currentPixel = getPixel(pixelLocation);
      if (currentPixel.a == 0.0) {
        fragColor = applyBackgroundBlend(vec4(0.0, 0.0, 0.0, 0.0));
        return;
      }

      //mirror edge pixels
      vec2 axy = vec2(-1.0, -1.0);
      vec2 bxy = vec2(0.0, -1.0);
      vec2 cxy = vec2(1.0, -1.0);
      vec2 dxy = vec2(-1.0, 0.0);
      vec2 fxy = vec2(1.0, 0.0);
      vec2 gxy = vec2(-1.0, 1.0);
      vec2 hxy = vec2(0.0, 1.0);
      vec2 ixy = vec2(1.0, 1.0);
      vec2 onePixel = 1.0 / u_srcImageSize;
      if (pixelLocation.s < onePixel.s) {
        axy[0] = 1.0;
        dxy[0] = 1.0;
        gxy[0] = 1.0;
      }
      if (pixelLocation.t < onePixel.t) {
        axy[1] = 1.0;
        bxy[1] = 1.0;
        cxy[1] = 1.0;
      }
      if (pixelLocation.s > 1.0 - onePixel.s) {
        cxy[0] = -1.0;
        fxy[0] = -1.0;
        ixy[0] = -1.0;
      }
      if (pixelLocation.t > 1.0 - onePixel.t) {
        gxy[1] = -1.0;
        hxy[1] = -1.0;
        ixy[1] = -1.0;
      }

      // calculate hillshade
      vec4 va = texture(u_image, pixelLocation + onePixel * axy);
      vec4 vb = texture(u_image, pixelLocation + onePixel * bxy);
      vec4 vc = texture(u_image, pixelLocation + onePixel * cxy);
      vec4 vd = texture(u_image, pixelLocation + onePixel * dxy);
      vec4 ve = texture(u_image, pixelLocation);
      vec4 vf = texture(u_image, pixelLocation + onePixel * fxy);
      vec4 vg = texture(u_image, pixelLocation + onePixel * gxy);
      vec4 vh = texture(u_image, pixelLocation + onePixel * hxy);
      vec4 vi = texture(u_image, pixelLocation + onePixel * ixy);

      // calculate the rate of z change along the x, y, and diagonal direction
      float dzx = (vc + 2.0 * vf + vi - va - 2.0 * vd - vg).r * u_factor.s;
      float dzy = (vg + 2.0 * vh + vi - va - 2.0 * vb - vc).r * u_factor.t;
      float dzd = sqrt(1.0 + dzx * dzx + dzy * dzy);
      float hillshade = 0.0;

      // traditional single light source
      if (u_hillshadeType == 0){
        float cosDelta = u_sinZsinAs[0] * dzy - u_sinZcosAs[0] * dzx;
        float z = (u_cosZs[0] + cosDelta) / dzd;
        if (z < 0.0)  z = 0.0;
        hillshade = z;
      } else {
        // multi-directional with 6 light sources
        for (int k = 0; k < 6; k++) {
        float cosDelta = u_sinZsinAs[k] * dzy - u_sinZcosAs[k] * dzx;
        float z = (u_cosZs[k] + cosDelta) / dzd;
        if (z < 0.0) z = 0.0;
        hillshade = hillshade + z * u_weights[k];
        if (k == 5) break;
        }
      }

      // set color
      float alpha = getNeighborHoodAlpha(va.a, vb.a, vc.a, vd.a, ve.a, vf.a, vg.a, vh.a, vi.a);
      alpha *= u_opacity;
      ${i}
    }
  `)}const e0t=Object.freeze(Object.defineProperty({__proto__:null,ColorizerHillshadeUniforms:Xyt,ColorizerStretchUniforms:Zyt,ColorizerUniforms:I6,build:Yyt},Symbol.toStringTag,{value:"Module"}));function t0t(t,e,r="nearest",i=!1){const s=!(i&&e.pixelType==="u8"),n=s?ks.FLOAT:ks.UNSIGNED_BYTE,o=e.pixels==null||e.pixels.length===0?null:s?e.getAsRGBAFloat():e.getAsRGBA(),a=t.capabilities.textureFloat?.textureFloatLinear,l=new vr;return l.width=e.width,l.height=e.height,l.internalFormat=t.type===lr.WEBGL2&&s?Xe.RGBA32F:Tt.RGBA,l.samplingMode=!a||r!=="bilinear"&&r!=="cubic"?Ct.NEAREST:Ct.LINEAR,l.dataType=n,l.wrapMode=$t.CLAMP_TO_EDGE,new Et(t,l,o)}function r0t(t,e){const{spacing:r,offsets:i,coefficients:s,size:[n,o]}=e,a=r[0]>1,l=new vr;l.width=a?4*n:n,l.height=o,l.internalFormat=t.type===lr.WEBGL2?Xe.RGBA32F:Tt.RGBA,l.dataType=ks.FLOAT,l.samplingMode=Ct.NEAREST,l.wrapMode=$t.CLAMP_TO_EDGE;const c=new Float32Array(a?n*o*16:2*i.length);if(a&&s!=null)for(let h=0,p=0;h<s.length;h++)c[p++]=s[h],h%3==2&&(c[p++]=1);else for(let h=0;h<o;h++)for(let p=0;p<n;p++){const f=4*(h*n+p),m=2*(p*o+h);c[f]=i[m],c[f+1]=i[m+1],c[f+3]=i[m]===-1?0:1}return new Et(t,l,c)}function yle(t,e){const r=new vr;return r.internalFormat=Tt.RGBA,r.width=e.length/4,r.height=1,r.samplingMode=Ct.NEAREST,r.wrapMode=$t.CLAMP_TO_EDGE,new Et(t,r,e)}function i0t(t,e,r,i=1,s=!0){return{u_flipY:s,u_applyTransform:!!t,u_opacity:i,u_transformSpacing:t?t.spacing:ap,u_transformGridSize:t?t.size:ap,u_targetImageSize:e,u_srcImageSize:r}}function s0t(t,e){return{u_colormapOffset:e||0,u_colormapMaxIndex:t?t.length/4-1:0}}function n0t(t){return{u_bandCount:t.bandCount,u_minOutput:t.outMin,u_maxOutput:t.outMax,u_minCutOff:t.minCutOff,u_maxCutOff:t.maxCutOff,u_factor:t.factor,u_useGamma:t.useGamma,u_gamma:t.gamma,u_gammaCorrection:t.gammaCorrection}}function o0t(t){return{u_hillshadeType:t.hillshadeType,u_sinZcosAs:t.sinZcosAs,u_sinZsinAs:t.sinZsinAs,u_cosZs:t.cosZs,u_weights:t.weights,u_factor:t.factor,u_minValue:t.minValue,u_maxValue:t.maxValue}}const _le={bandCount:3,outMin:0,outMax:1,minCutOff:[0,0,0],maxCutOff:[255,255,255],factor:[1/255,1/255,1/255],useGamma:!1,gamma:[1,1,1],gammaCorrection:[1,1,1],colormap:null,colormapOffset:null,stretchType:"none",type:"stretch"};let a0t=class{constructor(e,r,i=null,s=null){this.type="raster-tile",this._memoryUsed=null,this._source=null,this._symbolizerParameters=null,this._bandIds=null,this._interpolation=null,this._dirty=!1,this._transformGrid=null,this.isRendereredSource=!1,this.symbolizerRenderer=null,this.rawPixelData=null,this.lij=null,this.opacity=1,this.lij=e,this.source=r,this.width=i||r.width,this.height=s||r.height}get source(){return this._source}set source(e){this._source=e,this._rasterTexture=Ue(this._rasterTexture),this._memoryUsed=null}get symbolizerParameters(){return this.isRendereredSource?{..._le,maxCutOff:[1,1,1],factor:[1,1,1]}:this._symbolizerParameters||_le}set symbolizerParameters(e){this._symbolizerParameters=e}get bandIds(){return this._bandIds}set bandIds(e){e!=null&&e.length>0?this._bandIds&&e.every((r,i)=>!!this._bandIds?.[i]&&r===this._bandIds[i])||(this._bandIds=e,this._dirty=!0):this._bandIds=null}get interpolation(){return this._interpolation||"nearest"}set interpolation(e){if(this._interpolation=e,this._rasterTexture!=null){const r=this._getRasterTextureInterpolation(e);this._rasterTexture.setSamplingMode(r==="bilinear"?Ct.LINEAR:Ct.NEAREST)}}get transformGrid(){return this._transformGrid}set transformGrid(e){this._transformGrid=e,this._transformGridTexture=Ue(this._transformGridTexture),this._memoryUsed=null}bind(e){return!!(this.source&&this.source.pixels&&this.source.pixels.length>0)&&((this._rasterTexture==null||this._dirty)&&this._updateRasterTexture(e,this.bandIds),this._rasterTexture!=null&&(this._updateColormapTexture(e),this.transformGrid&&this._transformGridTexture==null&&(this._transformGridTexture=r0t(e,this.transformGrid))),!0)}getUniforms(){const{symbolizerParameters:e,transformGrid:r,width:i,height:s,opacity:n}=this,o=i0t(r,[i,s],[this.source.width,this.source.height],n),a=s0t(e.colormap,e.colormapOffset),l=this.symbolizerParameters.type==="stretch"?n0t(this.symbolizerParameters):null,c=this.symbolizerParameters.type==="hillshade"?o0t(this.symbolizerParameters):null;return new I6(o,a,l||c,this._rasterTexture,this._transformGridTexture,this._colormapTexture)}get isBilinearWithStretchColorRamp(){const{symbolizerParameters:e}=this;return this.interpolation==="bilinear"&&e.colormap!=null&&e.type==="stretch"}get memoryUsage(){if(this._memoryUsed==null){const e=[this._rasterTexture,this._transformGridTexture,this._colormapTexture];this._memoryUsed=e.map(r=>r!=null?r.descriptor.width*r.descriptor.height*4:0).reduce((r,i)=>r+i,0)}return this._memoryUsed}release(){return this._rasterTexture=Ue(this._rasterTexture),this._transformGridTexture=Ue(this._transformGridTexture),this._colormapTexture=Ue(this._colormapTexture),this.source=null,this.transformGrid=null,this.rawPixelData=null,!0}_updateRasterTexture(e,r){const i=this.source?this.source.extractBands(r):null;if(!(i&&i.pixels&&i.pixels.length>0))return void(this._rasterTexture=Ue(this._rasterTexture));const s=r==null&&this.bandIds==null||r!=null&&this.bandIds!=null&&r.join("")===this.bandIds.join("");if(this._rasterTexture!=null&&s)return;this._rasterTexture=Ue(this._rasterTexture);const n=this._getRasterTextureInterpolation(this.interpolation);this._rasterTexture=t0t(e,i,n,this.isRendereredSource||this.hasStretchTypeNone())}hasStretchTypeNone(){return"stretchType"in this.symbolizerParameters&&this.symbolizerParameters.stretchType==="none"&&!this.symbolizerParameters.useGamma&&this.source.pixelType==="u8"}_getRasterTextureInterpolation(e){return this.symbolizerParameters.type==="lut"||e==="nearest"||e==="majority"||this.isBilinearWithStretchColorRamp?"nearest":"bilinear"}_updateColormapTexture(e){const r=this._colormap,i=this.symbolizerParameters.colormap;return i?r?i.length!==r.length||i.some((s,n)=>s!==r[n])?(this._colormapTexture=Ue(this._colormapTexture),this._colormapTexture=yle(e,i),void(this._colormap=i)):void 0:(this._colormapTexture=yle(e,i),void(this._colormap=i)):(this._colormapTexture=Ue(this._colormapTexture),void(this._colormap=null))}},_D=class{constructor(){this.waitingAgents=new kt,this._upsampleInfo=null,this.loadingAgent=null,this.requestPromise=null,this.requestAbort=null,this.pendingUpdates=0}static acquire(e){const r=rk.acquire();return r._init(e),r}release(){this.dispose(),vD.delete(this),rk.release(this)}dispose(){this.loadingAgent=Ue(this.loadingAgent),this.abortRequest(),this._unsetUpsampleInfo(),this.pendingUpdates=0,this._data=jS(this._data)}static prune(){rk.prune(0)}_init(e){this.waitingAgents.clear(),this._data=jS(this._data),this.dataMissing=!1,this.dataInvalidated=!1,this._unsetUpsampleInfo(),this.abortRequest(),this.loadingAgent=null,this.pendingUpdates=0,this._pool=e,this.elevationBounds=null}invalidateSourceData(){this.dataInvalidated=!0,this.dataMissing=!1,this._unsetUpsampleInfo()}abortRequest(){this.requestAbort=pu(this.requestAbort),this.requestPromise=null}get upsampleInfo(){return this._upsampleInfo}_unsetUpsampleInfo(){this._upsampleInfo!=null&&(this._upsampleInfo.tile.unrefMapData(),this._pool.release(this._upsampleInfo),this._upsampleInfo=null)}setUpsampleInfo(e,r){if(e!==r&&r!=null){if(this._upsampleInfo==null)this._upsampleInfo=this._pool.acquire();else{if(this._upsampleInfo.tile===r)return;this._upsampleInfo.tile.unrefMapData()}r.refMapData(),kyt(e,r,this._upsampleInfo)}else this._unsetUpsampleInfo()}get data(){return this._data}set data(e){jS(this._data),this._data=e}};const rk=new Vo(_D,null,()=>{}),vD=new Map;function l0t(){vD.size>0&&(console.log(`${vD.size} live TilePerLayerInfo allocations:`),vD.forEach(t=>console.log(t,`
`)))}let qT=class{constructor(e){this._texture=e,this.type="tile-texture",this._refCount=1}retain(){++this._refCount}release(){--this._refCount,this._refCount===0&&this._texture.dispose()}get texture(){return this._texture}generateMipmap(){this._texture.generateMipmap()}get descriptor(){return this._texture.descriptor}get gpuMemoryUsage(){return this._texture.gpuMemoryUsage}};var gt;(function(t){t[t.NONE=0]="NONE",t[t.SPLIT=1]="SPLIT",t[t.ELEVATION=2]="ELEVATION",t[t.MERGE=4]="MERGE",t[t.RENDERDATA=8]="RENDERDATA",t[t.GEOMETRY=16]="GEOMETRY",t[t.TEXTURE_NOFADING=32]="TEXTURE_NOFADING",t[t.TEXTURE_FADING=64]="TEXTURE_FADING"})(gt||(gt={}));const c0t=.1;let RJ=class{constructor(){this.lij=[0,0,0],this._children=[null,null,null,null],this._pendingUpdates=0,this.renderData=null,this._dirty=!0,this._previouslyRendered=!1,this.extent=Ut(),this._elevationBounds=Ve(),this.layerInfo=[[],[]],this.extentInRadians=Ut(),this.centerAtSeaLevel=C(),this._center=[C(),gs(),C()],this.up=eW(),this._isWithinClippingArea=!0,this._intersectsClippingArea=!0,this._maxTesselation=0,this._usedMemory=null,this._mapTileMemoryInternal=0,this._mapDataRefCount=0,this.screenDepth=0,this.renderOrder=0,this._edgeLen=0,this._edgeLen2=0,this._curvatureHeight=0,this.extentMidX=0,this.extentMidY=0,this.distanceToPOI=-1,this._lastPOI=C()}static prune(){PJ.prune(0),MJ.prune(0),_D.prune()}get _isCached(){return!this.shouldLoad&&this._mapDataRefCount<=0}get maxTesselation(){return this._maxTesselation}get isWithinClippingArea(){return this._isWithinClippingArea}get intersectsClippingArea(){return this._intersectsClippingArea}get clippingArea(){return this._clippingArea}get parent(){return this._parent}get children(){return this._children}get surface(){return this._surface}get elevationBounds(){return this._elevationBounds}get level(){return this.lij[0]}get key(){return`${this.lij[0]}/${this.lij[1]}/${this.lij[2]}`}get edgeLen(){return this._edgeLen}get radius(){return this._center[Fs.MIDDLE][3]}get visible(){return this._dirty&&this.computeVisibility(),this._visible}get frustumVisibility(){return this._dirty&&this.computeVisibility(),this._frustumVisibility}computeVisibility(){this._dirty=!1;const e=this.parent,r=e?.frustumVisibility??ra.INTERSECTS;this._frustumVisibility=r===ra.INSIDE?ra.INSIDE:r===ra.OUTSIDE?ra.OUTSIDE:this._calculateFrustumVisibilityStatus(this.surface.frustum);const i=this._frustumVisibility!==ra.OUTSIDE&&this._intersectsClippingArea;i!==this._visible&&(this._visible=i,this._surface.emit("tiles-visibility-changed"),this._surface.renderer.setDirty(),this.updateAgentSuspension())}get loadable(){return this.visible||this._surface.view.state.fixedContentCamera}get rendered(){const e=!!this.renderData;return e!==this._previouslyRendered&&(this._surface.emit("tiles-visibility-changed"),this._previouslyRendered=e,this._surface.renderer.setDirty()),e}get shouldLoad(){return this.isLeaf}init(e,r,i){this.lij[0]=e[0],this.lij[1]=e[1],this.lij[2]=e[2],this.ellipsoid=Nr(i.tilingScheme.spatialReference),i.tilingScheme.getExtent(e[0],e[1],e[2],this.extent),i.tilingScheme.convertExtentToRadians(this.extent,this.extentInRadians),this.extentMidX=.5*(this.extent[0]+this.extent[2]),this.extentMidY=.5*(this.extent[1]+this.extent[3]),this._isWithinClippingArea=!0,this._intersectsClippingArea=!0,this._clippingArea=null,this._mapDataRefCount=0,i.upsampleMapCache.pop(this.key),this._edgeLen=0,this._edgeLen2=0,this._center[Fs.MIDDLE][3]=0,this.elevationLevel=e?e[0]:0,r&&r.elevationBounds?fn(this._elevationBounds,r.elevationBounds):or(this._elevationBounds,0,0),this._pendingUpdates=0,this.renderData=null,this.screenDepth=0,this._visible=!1,this._previouslyRendered=!1,this._parent=r,this.unsetChildren(),this._surface=i,this.updateVisibility();for(const s of G1){const n=i.numLayers(s),o=this.layerInfo[s];for(const a of o)a.release();o.length=n;for(let a=0;a<n;a++)o[a]=_D.acquire(this._surface.upsampleInfoPool),s===tr.ELEVATION&&this.findElevationBoundsForLayer(a,-1)}this.computeElevationBounds(),this._maxTesselation=Math.min(i.tilingScheme.pixelSize,$A)}release(){pf(!this.renderData,"tile.renderData was not unloaded"),this._surface.upsampleMapCache.pop(this.key);for(const e of G1){for(const r of this.layerInfo[e])r.release();this.layerInfo[e].length=0}this._parent=null;for(let e=0;e<4;++e)this._children[e]=null;this._surface=null,this.setMemoryDirty()}refMapData(){++this._mapDataRefCount,this._isCached||this._surface.upsampleMapCache.pop(this.key)}unrefMapData(){if(--this._mapDataRefCount,this._isCached){this.setMemoryDirty();const e=this._cachedMemory;e>0&&this._surface.upsampleMapCache.put(this.key,this,e)}}setMemoryDirty(){this._usedMemory=null}get usedMemory(){return this._ensureUsedMemory()+(this._isCached?0:this._mapTileMemoryInternal)}get _cachedMemory(){return this._isCached?this._mapTileMemory:0}get _mapTileMemory(){return this._ensureUsedMemory(),this.layerInfo[tr.MAP].reduce((e,r)=>e+(r instanceof tk?r.memoryUsed/r.referenced:0),this._mapTileMemoryInternal)}get _cpuImageMemorySize(){const r=this._surface.tilingScheme.pixelSize;return r*r*4}_ensureUsedMemory(){if(this._usedMemory!=null)return this._usedMemory;this._usedMemory=0,this._mapTileMemoryInternal=0;let e=0;for(const{data:i}of this.layerInfo[tr.MAP])i instanceof tk?e+=this._getTerrainDataMemory(i):this._mapTileMemoryInternal+=this._getTerrainDataMemory(i);const r=this._cpuImageMemorySize;for(const i of this.layerInfo[tr.ELEVATION])this._usedMemory+=i.data?r:0;return this.renderData&&(this._usedMemory+=this.renderData.estimatedGeometryMemoryUsage,this._mapTileMemoryInternal+=this.renderData.texture?.gpuMemoryUsage??0),this._isCached&&this._surface.upsampleMapCache.updateSize(this.key,this,this._mapTileMemoryInternal+e),this._usedMemory}getUsedMemoryForLayer(e,r){const i=this.layerInfo[e][r];return i?.data?e===tr.MAP?this._isCached?0:this._getTerrainDataMemory(i.data):e===tr.ELEVATION?this._cpuImageMemorySize:0:0}_getTerrainDataMemory(e){return e instanceof qT?e.texture.gpuMemoryUsage:e instanceof HTMLImageElement||e instanceof O6?this._cpuImageMemorySize:e instanceof a0t?e.memoryUsage:e instanceof tk?e.memoryUsed/e.referenced:0}updateScreenDepth(e){const r=this._center[Fs.MIDDLE],i=e,s=r[0],n=r[1],o=r[2],a=i[2]*s+i[6]*n+i[10]*o+i[14];this.screenDepth=a<0?0:a/(i[3]*s+i[7]*n+i[11]*o+i[15])}shouldSplit(e,r,i){if(!this.visible||e.frustum!=null&&(!this._intersectsClippingArea||this._calculateFrustumVisibilityStatus(e.frustum)===ra.OUTSIDE))return gt.NONE;const s=this.level;he(h$,this._center[Fs.MIDDLE],r);let n=na(h$),o=h$,a=Fs.MIDDLE;he(ik,this._center[Fs.TOP],r);const l=na(ik);l<n&&(n=l,o=ik,a=Fs.TOP),he(sk,this._center[Fs.BOTTOM],r);const c=na(sk);if(c<n&&(n=c,o=sk,a=Fs.BOTTOM),this._edgeLen2>n&&s<e.maxLod)return gt.SPLIT;const h=i!=null?i-s:1/0,p=Math.sqrt(n),f=e.fovX*p*2,m=this._edgeLen/f,y=()=>{if(s<e.maxLod)return this.elevationLevel=s,gt.NONE;const I=s+Math.ceil(-Math.log2(e.relativeWidthLimit/m));return I!==this.elevationLevel?(this.elevationLevel=I,gt.ELEVATION):gt.NONE};if(h<=.5)return y();const _=fe(this.up,h$),v=this._elevationBounds[1]-this._elevationBounds[0],w=v/this.edgeLen;if(e.aboveGround&&_>0&&w<.001&&_/p-Math.sin(this._curvatureHeight/(this.edgeLen*Math.SQRT1_2)*Math.PI)-w>0)return gt.NONE;const x=i!=null?3-Math.min(h,2):1;if(m*x<e.relativeWidthLimit||s>=e.maxLod)return y();if(s<7)return gt.SPLIT;te(io,this.up,_),he(io,io,o);const T=na(io);if(T<=this.radius*this.radius)return gt.SPLIT;te(io,io,this.radius/Math.sqrt(T)),ce(io,io,this._center[a]),he(io,r,io);const S=Math.min(1,(Math.abs(fe(io,this.up))+.5*v+this._curvatureHeight)/Ce(io)),O=c0t/e.angledSplitBias,A=e.fovY*p*2;return S*(this._edgeLen/A*x)<O*e.relativeHeightLimit?gt.NONE:gt.SPLIT}setChildren(e,r,i,s){pf(!!(e&&r&&i&&s),"Null child passed"),this._children[0]=e,this._children[1]=r,this._children[2]=i,this._children[3]=s}unsetChildren(){this._children[0]=null,this._children[1]=null,this._children[2]=null,this._children[3]=null}get isLoaded(){return this.renderData?.hasGeometry??!1}load(){this.refMapData();for(const e of G1)this._createOrUpdateAgents(0,e);this.surface.renderer.loadTile(this)}unload(e){e.unloadTile(this);for(const r of G1){const i=this.layerInfo[r];for(const s of i)s.loadingAgent&&s.loadingAgent!==Fl&&(u$(s.loadingAgent),s.loadingAgent=null),s.pendingUpdates=0}this.resetPendingUpdate(gt.GEOMETRY),this.resetPendingUpdate(gt.TEXTURE_NOFADING),this.resetPendingUpdate(gt.TEXTURE_FADING),this.unrefMapData()}unloadMapData(){const e=this.layerInfo[tr.MAP];for(const r of e)r.loadingAgent&&r.loadingAgent!==Fl&&(u$(r.loadingAgent),r.loadingAgent=null),r.pendingUpdates=0;this.renderData&&this.renderData.releaseTexture(),this.setMemoryDirty()}updateClippingStatus(e){if(Tb(e,this._clippingArea))return!1;const r=this._intersectsClippingArea,i=this._isWithinClippingArea;e!=null?(this._intersectsClippingArea=this.intersectsExtent(e),this._isWithinClippingArea=this._isWithinExtent(e)):(this._intersectsClippingArea=!0,this._isWithinClippingArea=!0),this._clippingArea=e,this.updateVisibility();const s=i&&this._isWithinClippingArea,n=!(i||r||this._isWithinClippingArea||this._intersectsClippingArea);return!this.renderData||s||n||this.setPendingUpdate(gt.GEOMETRY),!0}updateVisibility(){this._dirty=!0,this._surface.setTileTreeDirty()}getLayerInfo(e,r){return this.layerInfo[r][e]}hasLayerData(e,r){const i=this.layerInfo[r][e];return!(!i||!i.data||i.dataInvalidated)}get updating(){if(this.hasPendingUpdates)return!0;for(const e of G1){const r=this.layerInfo[e];for(const i of r)if(i.loadingAgent&&i.loadingAgent!==Fl&&i.loadingAgent.updating)return!0}return!1}_isSuspended(e){return!!this.hasPendingUpdate(gt.SPLIT)||e!==tr.ELEVATION&&!this.loadable}get hasPendingUpdates(){return this._pendingUpdates!==0}hasPendingUpdate(e){return(this._pendingUpdates&e)===e}setPendingUpdate(e){this._pendingUpdates|=e,e===gt.SPLIT||e===gt.MERGE?this._surface.setTileTreeDirty():this._surface.requestUpdate()}resetPendingUpdate(e){return!!this.hasPendingUpdate(e)&&(this._pendingUpdates&=~e,!0)}requestLayerData(e,r,i){const s=this.layerInfo[r][e];if(s.waitingAgents.has(i))return console.warn("agent already requested this piece of map data (tile %s, agent tile %s, layer: %d/%d)",this.lij.toString(),i.tile.lij.toString(),r,e),!0;if(s.waitingAgents.push(i),s.data&&!s.dataInvalidated){console.warn("agent requested existing data (tile %s, agent tile %s, layer: %d/%d)",this.lij.toString(),i.tile.lij.toString(),r,e);const a=s.data&&"type"in s.data&&s.data.type==="vector-tile";return i.dataArrived(this,a),!0}if(s.requestPromise)return!0;pu(s.requestAbort),s.requestAbort=new AbortController;const n=this._surface.requestTileData(this,e,r,s.requestAbort);if(!n)return s.requestAbort=null,!1;const o=()=>{s.requestPromise===n&&(s.requestPromise=null,s.requestAbort=null)};return s.requestPromise=n,n.then(o,o),!0}get isLeaf(){return this._children[0]==null}hasLij(e){return this.lij[0]===e[0]&&this.lij[1]===e[1]&&this.lij[2]===e[2]}findByLij(e){if(this.hasLij(e))return this;const r=this._children;return r[0]?r[0].findByLij(e)||r[1].findByLij(e)||r[2].findByLij(e)||r[3].findByLij(e):null}distanceToSquared(e){return na(he(io,this._center[Fs.MIDDLE],e))}containsPoint(e){const r=this.extent;return e[0]>=r[0]&&e[1]>=r[1]&&e[0]<=r[2]&&e[1]<=r[3]}containsPointXY(e,r){const i=this.extent;return e>=i[0]&&r>=i[1]&&e<=i[2]&&r<=i[3]}unrequestLayerData(e,r,i){const s=this.layerInfo[r][e],n=s.waitingAgents,o=n.removeUnordered(i)!=null;pf(o,"agent has not requested this piece of map data"),n.length<1&&(s.abortRequest(),this.setMemoryDirty())}dataArrived(e,r,i){const s=i!=null&&"type"in i&&i.type==="vector-tile",n=this.layerInfo[r][e];n.data=i,n.dataInvalidated=!1,n.waitingAgents.forAll(o=>o.dataArrived(this,s)),n.waitingAgents.clear(),this.setMemoryDirty()}dataMissing(e,r,i){i.notInTilemap||console.error(`Tile ${this.lij.toString()} layer ${r}/${e} error ${i}`);const s=this.layerInfo[r][e];s.dataMissing=!0,s.waitingAgents.forAll(n=>n.dataMissing()),s.waitingAgents.clear(),this.setMemoryDirty()}updateRenderData(e,r,i){switch(i&&this.forEachLoadedNeighbor(s=>s.updateRenderData(e,r)),e){case tr.MAP:return this._updateTexture(r);case tr.ELEVATION:return this._updateGeometry()}}_updateTexture(e){this.renderData&&(this.resetPendingUpdate(e===rn.FADING?gt.TEXTURE_NOFADING:gt.TEXTURE_FADING),this.setPendingUpdate(e===rn.FADING?gt.TEXTURE_FADING:gt.TEXTURE_NOFADING))}_updateGeometry(){this.setPendingUpdate(gt.GEOMETRY);for(const e of this.layerInfo[tr.ELEVATION])e.pendingUpdates|=gt.GEOMETRY}invalidateLayerData(e,r){this.layerInfo[r][e].invalidateSourceData(),this.restartAgents(r)}computeElevationBounds(){const e=this._elevationBounds,r=e[0],i=e[1];or(e,1/0,-1/0);const s=this.layerInfo[tr.ELEVATION];let n=!0;for(const o of s)o.elevationBounds!=null&&(e[0]=Math.min(e[0],o.elevationBounds.min),e[1]=Math.max(e[1],o.elevationBounds.max),o.elevationBounds.hasNoDataValues||(n=!1));n&&(e[0]=Math.min(e[0],0),e[1]=Math.max(e[1],0)),r===e[0]&&i===e[1]||(this.updateRadiusAndCenter(),this._surface.setTileTreeDirty())}_updateCenter(){const e=this._elevationBounds,r=.5*(e[0]+e[1]),i=this._center;te(io,this.up,r),ce(i[Fs.MIDDLE],this.centerAtSeaLevel,io),te(io,this.up,e[0]),ce(i[Fs.TOP],this.centerAtSeaLevel,io),te(io,this.up,e[1]),ce(i[Fs.BOTTOM],this.centerAtSeaLevel,io)}findElevationBoundsForLayer(e,r){const i=this.layerInfo[tr.ELEVATION][e],s=bG(this.level),n=Math.max(this.elevationLevel-s,0),o=i.elevationBounds;if(o!=null&&o.level>=r&&o.level<=n)return;const a=this._surface.layerViewByIndex(e,tr.ELEVATION),l=RH(a);if(!lO(this,l,!1))return;const c=h0t;let h=!1;const p=i.data;if(p&&p.level<=n){const f=i.data;c.min=f.samplerData.data.minValue,c.max=f.samplerData.data.maxValue,c.hasNoDataValues=f.samplerData.data.hasNoDataValues,c.level=this.level,h=!0}else{let f,m,y=0;for(let _=this._parent;_&&(!m||y<s)&&(y=this.elevationLevel-_.level,f=m||f,m=_.layerInfo[tr.ELEVATION][e].data,!(!m&&f&&_.level<=n));_=_.parent);m=m||f,m&&(m.computeMinMaxValue(this.lij[0],this.lij[1],this.lij[2],c),c.min!==1/0&&(c.level=m.level,h=!0))}h&&(i.elevationBounds==null&&(i.elevationBounds=new mS),i.elevationBounds.copyFrom(c))}modifyLayers(e,r,i){const s=this.layerInfo[i];for(const a of s)a.loadingAgent&&a.loadingAgent!==Fl&&(u$(a.loadingAgent),a.loadingAgent=null),a.waitingAgents.clear();for(let a=0;a<s.length;++a)e[a]===void 0&&s[a].release();const n=new Array(...s),o=r.length;s.length=o;for(let a=0;a<o;a++){const l=r[a];s[a]=l>-1?n[l]:_D.acquire(this._surface.upsampleInfoPool)}this.setMemoryDirty()}restartAgents(e){this.renderData&&(this._createOrUpdateAgents(0,e),this.updateRenderData(e,rn.FADING))}updateAgents(e){if(this.renderData){const r=this.layerInfo[e];for(const i of r)i.loadingAgent===Fl&&(i.loadingAgent=null);this._createOrUpdateAgents(0,e)}}updateAgentSuspension(){for(const e of G1){const r=this._isSuspended(e);for(const i of this.layerInfo[e])i.loadingAgent&&i.loadingAgent!==Fl&&(i.loadingAgent.setSuspension(r),i.loadingAgent===Fl&&this.updateRenderData(e,rn.FADING))}}removeLayerAgent(e,r){const i=this.layerInfo[r][e];i.loadingAgent&&i.loadingAgent!==Fl&&i.loadingAgent.dispose(),i.loadingAgent=null}agentDone(e,r){const i=this.layerInfo[r][e];i.loadingAgent=Fl,i.data||i.upsampleInfo!=null||this._createOrUpdateAgents(e+1,r)}_hasBlendableAncestor(e){return e.blendMode!=="normal"||a2(e.parent)&&this._hasBlendableAncestor(e.parent)}_hasBlendModes(e,r,i){for(let s=e;s<r;++s){const n=this._surface.layerViewByIndex(s,i);if(W4(n)&&n?.layer?.blendMode!=="normal"||a2(n?.layer?.parent)&&this._hasBlendableAncestor(n?.layer?.parent))return!0}return!1}_createOrUpdateAgents(e,r){const i=this.layerInfo[r];if(i.length===0)return;const s=this._isSuspended(r);for(let n=e;n<i.length;++n){const o=i[n];let a=!1;const l=this._surface.layerViewByIndex(n,r),c=RH(l);if(o.loadingAgent?lO(this,c,!1)?(o.loadingAgent!==Fl&&o.loadingAgent.setSuspension(s),o.loadingAgent!==Fl&&(a=o.loadingAgent.update())):o.dispose():lO(this,c,!1)&&(o.loadingAgent=u0t(this,n,r,s),a=o.loadingAgent.startLoading(),a?o.loadingAgent===Fl&&this.setPendingUpdate(gt.GEOMETRY):(u$(o.loadingAgent),o.loadingAgent=Fl)),o.loadingAgent===Fl&&this.updateRenderData(r,rn.FADING),!this._hasBlendModes(e,i.length,r)&&a&&l.isOpaque)return}}_isWithinExtent(e){const r=this.extent;return r[0]>=e[0]&&e[2]>=r[2]&&r[1]>=e[1]&&e[3]>=r[3]}intersectsExtent(e){const r=this.extent;return r[2]>=e[0]&&e[2]>=r[0]&&r[3]>=e[1]&&e[3]>=r[1]}getElevationVerticesPerSide(e){const r=this.elevationLevel-this.level,i=Math.max(this.level-e,bG(this.level)-r),s=ge(1+(this.maxTesselation>>i),2,this.maxTesselation+1),n=this.getDefaultVerticesPerSide();return Math.max(s,n)}get test(){return{cachedMemory:this._cachedMemory}}_findLIJ(e,r){if(!e)return null;const i=this.surface.rootTiles;if(i!=null){for(const s of i)if(d0t(s,e)){let n=s,o=e[0]-n.level-1;for(;o>=0&&!n.isLeaf&&!r(n);){const a=e[1]>>o&1,l=e[2]>>o&1;n=n.children[2*a+l],o--}return r(n)?n:null}}return null}findNeighborTile(e,r){const i=this.lij,s=this.getNeighborLIJ(i,e);return s?p0t(i,s)?r(this)?this:null:this._findLIJ(s,r):null}findCorner(e,r){const i=e===nt.NORTH_EAST?1:e===nt.NORTH_WEST?0:e===nt.SOUTH_WEST?2:3;let s=this;for(;s.children[0]&&(!r||!r(s));)s=s.children[i];return s}findNeighborCornerTileExact(e,r){return this.findNeighborTile(e,i=>r(i)||i.level===this.level)?.findCorner(Z4(e),r)||null}forAllSubtreeOnSide(e,r){const i=e===nt.NORTH?[0,1]:e===nt.NORTH_EAST?[1]:e===nt.EAST?[1,3]:e===nt.SOUTH_EAST?[3]:e===nt.SOUTH?[2,3]:e===nt.SOUTH_WEST?[2]:e===nt.WEST?[0,2]:[0],s=n=>{const o=n.children;!r(n)&&o[0]&&i.forEach(a=>s(o[a]))};s(this)}forallNeighbors(e){hR.forEach(r=>this.findNeighborCornerTileExact(r,e)),Tf.forEach(r=>this.findNeighborTile(r,i=>i.level===this.level||e(i))?.forAllSubtreeOnSide(X4(r),e))}getNeighborEdgeStartVertexIndex(e,r){if(!r)return 0;const i=this.level-r.level;if(xe(!ln||i>=0),i===0)return 0;const s=2**i,n=(1&e)==1,o=n?0:1,a=r.lij[o+1]*s,l=this.lij[o+1],c=l-a,h=n?s-1-c:c;return ln&&(xe(a<=l&&l<a+s),xe(0<=h&&h<s)),h}forEachLoadedNeighbor(e){const r=this.level,i=s=>s.level===r||s.isLoaded;Tf.forEach(s=>{const n=this.findNeighborTile(s,i);n!=null&&n!==this&&n.forAllSubtreeOnSide(X4(s),o=>!!o.isLoaded&&(e(o,s),!0))}),hR.forEach(s=>{const n=this.findNeighborTile(s,i)?.findCorner(Z4(s),o=>o.isLoaded);xe(!n||FH(this,n,s)),n?.isLoaded&&e(n,s)})}getNeighborLIJ(e,r){const i=ole(r)?-1:nle(r)?1:0,s=ile(r)?-1:sle(r)?1:0,n=[e[0],e[1]+i,e[2]+s];return n[1]<0?null:this.surface.isGlobal?this.wrapLIJ(n):n[2]<0?null:n}wrapLIJ(e){return!e||e[1]<0||e[1]>=2**e[0]?null:this.surface.wrapEastWest(e)}get westNeighborWestExtent(){return this.extent[0]*(this.isWestEnd?-1:1)}get eastNeighborEastExtent(){return this.extent[2]*(this.isEastEnd?-1:1)}get isEastEnd(){return this.lij[2]===this.surface.lijEastEnd(this.level)-1}get isWestEnd(){return this.lij[2]===0}get isNorthEnd(){return this.lij[1]===0}get isSouthEnd(){const e=this.surface.extent,r=e?.[1]??null;return r!=null&&this.extent[1]+Xa()>=r}checkGeometryWaterproofness(){H4&&(xe(this.isLoaded),this.renderData?.checkGeometryWaterproofness())}shouldHaveNeighbor(e){const r=this.extent,i=this.surface.rootTilesExtent,s=.25*(r[2]-r[0]);if(ole(e)&&r[3]+s>=i[3]||nle(e)&&r[1]-s<=i[1])return!1;const n=this.surface.isGlobal;return!(!n&&ile(e)&&r[0]-s<=i[0])&&!(!n&&sle(e)&&r[2]+s>=i[2])}updateDistanceToPOI(e){const r=this._lastPOI;if(this.distanceToPOI>=0&&r[0]===e[0]&&r[1]===e[1]&&r[2]===e[2])return;ie(this._lastPOI,e);const i=this._center[Fs.MIDDLE],s=e[0]-i[0],n=e[1]-i[1],o=e[2]-i[2];this.distanceToPOI=s*s+n*n+o*o}};function u0t(t,e,r,i){const s=r===tr.ELEVATION?MJ.acquire():PJ.acquire();return s.init(t,e,r,i),s}function u$(t){t.dispose(),t instanceof NAe?MJ.release(t):t instanceof FAe&&PJ.release(t)}const PJ=new Vo(FAe),MJ=new Vo(NAe),h0t=new mS;var Fs;function d0t(t,e){const r=t.level,i=e[0];if(r>i)return!1;const s=i-r,n=Math.floor(e[1]/2**s),o=Math.floor(e[2]/2**s);return n===t.lij[1]&&o===t.lij[2]}function p0t(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]}function f0t(t,e,r){if(t==null||e==null)return!1;if(t.level===0&&e.level===0&&(t.isEastEnd&&e.isWestEnd&&r===nt.EAST||t.isWestEnd&&e.isEastEnd&&r===nt.WEST))return!0;const i=Math.max(1e-6*(t.extent[2]-t.extent[0]),1);switch(r){case nt.NORTH:return uh(t.extent[3],e.extent[1],i);case nt.SOUTH:return uh(t.extent[1],e.extent[3],i);case nt.EAST:return uh(t.extent[2],e.extent[0],i)||uh(t.extent[2],-e.extent[0],i);case nt.WEST:return uh(t.extent[0],e.extent[2],i)||uh(t.extent[0],-e.extent[2],i)}}function FH(t,e,r){return t!=null&&e!=null&&e!==t&&(t.level>=e.level?vle(t,e,r):vle(e,t,Z4(r)))}function vle(t,e,r){xe(t.level>=e.level);const i=$gt(r),s=Lgt(r),n=t.extent,o=e.extent,a=[i?n[0]:n[2],s?n[3]:n[1]],l=[i?o[2]:o[0],s?o[1]:o[3]],c=1e-5*(n[2]-n[0]),h=uh(a[0],l[0],c)||t.surface.isGlobal&&uh(a[0],-l[0],c),p=uh(a[1],l[1],c);if(h&&p)return!0;if(t.level===e.level||!h&&!p)return xe(!1),!1;const f=h?ble(o[1],o[3],n[1],n[3],c):ble(o[0],o[2],n[0],n[2],c);return xe(f),f}function ble(t,e,r,i,s){return t-s<=r&&r<=i&&i<=e+s}(function(t){t[t.TOP=0]="TOP",t[t.MIDDLE=1]="MIDDLE",t[t.BOTTOM=2]="BOTTOM"})(Fs||(Fs={}));const h$=C(),ik=C(),sk=C(),io=C();let m0t=class{constructor(){this._scales=Lt(-1,-1,-1,-1),this._offsets=Lt(-1,-1,-1,-1)}clear(){this._scales[0]=this._scales[1]=this._scales[2]=this._scales[3]=-1,this._offsets[0]=this._offsets[1]=this._offsets[2]=this._offsets[3]=-1}setScale(e,r,i){this._scales[2*e]=r,this._scales[2*e+1]=i}setOffset(e,r,i){this._offsets[2*e]=r,this._offsets[2*e+1]=i}get scales(){return this._scales}get offsets(){return this._offsets}};function g0t(t,e){t.varyings.add("tbnTangent","vec3"),t.varyings.add("tbnBiTangent","vec3"),e.spherical?t.vertex.code.add(b`void forwardVertexTangent(vec3 n) {
tbnTangent = normalize(cross(vec3(0.0, 0.0, 1.0), n));
tbnBiTangent = normalize(cross(n, tbnTangent));
}`):t.vertex.code.add(b`void forwardVertexTangent(vec3 n) {
tbnTangent = vec3(1.0, 0.0, 0.0);
tbnBiTangent = normalize(cross(n, tbnTangent));
}`),t.fragment.code.add(b`mat3 getTBNMatrix(vec3 n) {
return mat3(tbnTangent, tbnBiTangent, n);
}`)}let IJ=class extends CEe{constructor(){super(...arguments),this.slicePlaneLocalOrigin=C(),this.origin=this.slicePlaneLocalOrigin,this.modelTransformation=null}};var cc;(function(t){t[t.Material=0]="Material",t[t.ShadowMap=1]="ShadowMap",t[t.Highlight=2]="Highlight"})(cc||(cc={}));let y0t=class extends IJ{constructor(){super(...arguments),this.identifier=cc.Material,this.output=N.Color,this.transparent=!1,this.integratedMesh=!1}},_0t=class extends IJ{constructor(){super(...arguments),this.identifier=cc.ShadowMap}},v0t=class extends IJ{constructor(){super(...arguments),this.identifier=cc.Highlight}},Y4=class extends as{constructor(e,r){super(e,"vec4",Qr.Draw,(i,s,n)=>i.setUniform4fv(e,r(s,n)))}};var Rg;function b0t(t,e){const{vertex:r,fragment:i}=t;r.uniforms.add(new Y4("overlayTexOffset",(s,n)=>w0t(s,n)),new Y4("overlayTexScale",(s,n)=>x0t(s,n))),i.constants.add("overlayOpacity","float",1),i.uniforms.add(new Je("ovColorTex",(s,n)=>UH(s,n))),zAe(t,e)}function zAe(t,e){e.pbrMode!==st.Water&&e.pbrMode!==st.WaterOnIntegratedMesh&&e.pbrMode!==st.TerrainWithWater||t.include(REe,e);const{vertex:r,fragment:i}=t;t.varyings.add("vtcOverlay","vec4"),r.code.add(b`void setOverlayVTC(in vec2 uv) {
vtcOverlay = vec4(uv, uv) * overlayTexScale + overlayTexOffset;
}`),i.code.add(b`bool isValid(vec2 uv, vec2 dxdy) {
return (uv.x >= 0.0 + dxdy.x) && (uv.x <= 1.0 - dxdy.x) && (uv.y >= 0.0 + dxdy.y) && (uv.y <= 1.0 - dxdy.y);
}
vec4 getOverlayColor(sampler2D ov0Tex, vec4 texCoords) {
vec4 color0 = texture(ov0Tex, vec2(texCoords.x * 0.5, texCoords.y));
vec4 color1 = texture(ov0Tex, vec2(texCoords.z * 0.5 + 0.5, texCoords.w));
bool isValid0 = isValid(texCoords.xy, fwidth(texCoords.xy));
bool isValid1 = isValid(texCoords.zw, vec2(0.0, 0.0));
return mix(color1 * float(isValid1), color0, float(isValid0));
}`),i.code.add(b`vec4 getCombinedOverlayColor() {
return overlayOpacity * getOverlayColor(ovColorTex, vtcOverlay);
}`),i.code.add(b`vec4 getOverlayColorTexel(vec4 texCoords) {
vec2 texDim =  vec2(textureSize(ovColorTex, 0));
vec4 color0 = texelFetch(ovColorTex, ivec2(vec2(texCoords.x * 0.5, texCoords.y)*texDim), 0);
vec4 color1 = texelFetch(ovColorTex, ivec2(vec2(texCoords.z * 0.5 + 0.5, texCoords.w)*texDim), 0);
bool isValid0 = isValid(texCoords.xy, fwidth(texCoords.xy));
bool isValid1 = isValid(texCoords.zw, vec2(0.0, 0.0));
return mix(color1 * float(isValid1), color0, float(isValid0));
}`),e.pbrMode!==st.Water&&e.pbrMode!==st.WaterOnIntegratedMesh&&e.pbrMode!==st.TerrainWithWater||(Jg(i),im(i),i.code.add(b`vec4 getOverlayWaterColor(vec4 maskInput, vec4 colorInput, vec3 vposEyeDir,
float shadow, vec3 localUp, mat3 tbn, vec3 position, vec3 positionWorld) {
vec3 n = normalize(tbn *  (2.0 * maskInput.rgb - vec3(1.0)));
vec3 v = vposEyeDir;
vec3 final = getSeaColor(n, v, mainLightDirection, colorInput.rgb, mainLightIntensity, localUp, 1.0 - shadow, maskInput.w, position, positionWorld);
return vec4(final, colorInput.w);
}`))}function UH(t,e){return e.overlays.length===0?null:t.identifier===cc.Material&&t.output===N.Color?e.overlays[Pi.INNER].getColorTextureNoRasterImage():t.identifier===cc.Material&&t.output===N.ObjectAndLayerIdColor?e.overlays[Pi.INNER].getColorTexture(Da.ObjectAndLayerIdColor):t.identifier===cc.Highlight?e.overlays[Pi.INNER].getValidTexture(rs.Highlight):null}function w0t(t,e){for(const r of e.overlays){const{index:i,extent:s}=r;Dfe(s)>0&&(HS[2*i]=t.toMapSpace[0]/ru(s)-s[0]/ru(s),HS[2*i+1]=t.toMapSpace[1]/op(s)-s[1]/op(s))}return HS}function x0t(t,e){for(const r of e.overlays){const{index:i,extent:s}=r;Dfe(s)>0&&(HS[2*i]=t.toMapSpace[2]/ru(s),HS[2*i+1]=t.toMapSpace[3]/op(s))}return HS}(function(t){t[t.Disabled=0]="Disabled",t[t.Enabled=1]="Enabled",t[t.EnabledWithWater=2]="EnabledWithWater",t[t.COUNT=3]="COUNT"})(Rg||(Rg={}));const HS=Wt();var Sf;(function(t){t[t.LayerOnly=0]="LayerOnly",t[t.ColorComposite=1]="ColorComposite",t[t.GridComposite=2]="GridComposite",t[t.COUNT=3]="COUNT"})(Sf||(Sf={}));let T0t=class extends eJ{constructor(){super(...arguments),this.overlayOpacity=1,this.overlaySource=Da.None}};function RC(t,e){t.vertex.uniforms.add(new J4("overlayTexOffset"),new J4("overlayTexScale")),t.fragment.uniforms.add(new Re("overlayOpacity",r=>r.overlayOpacity),new Je("ovColorTex",(r,i)=>i.overlays.length===0?null:i.overlays[Pi.INNER].getColorTexture(r.overlaySource))),zAe(t,e)}function S0t(t,e){const{vertex:r,fragment:i,varyings:s}=t;s.add("vtc","vec2"),r.uniforms.add(new J4("texOffsetAndScale")),i.uniforms.add(new wle("tex")),i.uniforms.add(new nk("textureOpacities"));const n=e.textureFadingEnabled&&!e.renderOccluded;n&&(r.uniforms.add(new J4("nextTexOffsetAndScale")),s.add("nvtc","vec2"),i.uniforms.add(new wle("texNext")),i.uniforms.add(new nk("nextTexOpacities")),i.uniforms.add(new E0t("fadeFactor")));const o=e.tileBlendInput===Sf.ColorComposite,a=e.tileBlendInput===Sf.GridComposite;a&&i.include(OJ),o&&i.uniforms.add(new nk("backgroundColor")),r.code.add(b`
  void forwardTextureCoordinatesWithTransform(in vec2 uv) {
    vtc = uv * texOffsetAndScale.zw + texOffsetAndScale.xy;
    ${n?b`nvtc = uv * nextTexOffsetAndScale.zw + nextTexOffsetAndScale.xy;`:b``}
  }`),i.code.add(b`
    vec4 getColor(vec4 color, vec2 uv, vec3 opacities) {
      ${a||o?b`
              if (opacities.y <= 0.0) {
                return color * opacities.z * opacities.x;
              }
              vec4 bg = vec4(${o?b`backgroundColor`:b`gridColor(uv)`} * opacities.y, opacities.y);
              vec4 layer = color * opacities.z;
              return (bg * (1.0 - layer.a) + layer) * opacities.x;`:b`return color;`}
    }`),n?i.code.add(b`vec4 getTileColor() {
vec4 color = getColor(texture(tex, vtc), vtc, textureOpacities);
if (fadeFactor >= 1.0) {
return color;
}
vec4 nextColor = getColor(texture(texNext, nvtc), nvtc, nextTexOpacities);
return mix(nextColor, color, fadeFactor);
}`):i.code.add(b`vec4 getTileColor() {
return getColor(texture(tex, vtc), vtc, textureOpacities);
}`)}let E0t=class extends as{constructor(e){super(e,"float")}},nk=class extends as{constructor(e){super(e,"vec3")}},J4=class extends as{constructor(e){super(e,"vec4")}},wle=class extends as{constructor(e){super(e,"sampler2D")}},BAe=class extends T0t{};function C0t(t){const e=new wr,{vertex:r,fragment:i,varyings:s}=e;e.include(JR),e.include(dP,t),e.include(Pf,t);const n=()=>{e.include(oR,t),r.code.add(b`vec3 getNormal() {
float z = 1.0 - abs(normalCompressed.x) - abs(normalCompressed.y);
vec3 n = vec3(normalCompressed + vec2(normalCompressed.x >= 0.0 ? 1.0 : -1.0,
normalCompressed.y >= 0.0 ? 1.0 : -1.0) * min(z, 0.0), z);
return normalize(n);
}`)};vc(r,t),e.include(xl,t);const o=t.overlayMode!==Rg.Disabled,a=o&&t.invisible;switch(t.output){case N.Color:{e.include(S0t,t),e.include(_w,t),o&&e.include(RC,{...t,pbrMode:t.pbrMode===st.Terrain?st.TerrainWithWater:st.Water});const l=t.overlayMode===Rg.EnabledWithWater;l&&e.include(g0t,t),s.add("vnormal","vec3"),s.add("vpos","vec3"),s.add("vup","vec3"),n(),t.screenSizePerspective&&M2(r);const c=t.receiveShadows&&!t.renderOccluded;c&&e.include(mE,t),t.screenSizePerspective&&(s.add("screenSizeDistanceToCamera","float"),s.add("screenSizeCosAngle","float")),r.code.add(b`
        void main(void) {
          //Position
          vpos = position;
          vec3 positionWorld = position + localOrigin;
          gl_Position = transformPosition(proj, view, vpos);

          //Normal
          vnormal = getNormal();

          //Up
          vup = getLocalUp(position, localOrigin);

          ${l?b`forwardVertexTangent(vnormal);`:b``}

          //Texture UV
          vec2 uv = getUV0();
          forwardTextureCoordinatesWithTransform(uv);
          ${o?b`setOverlayVTC(uv);`:""}
          ${t.tileBorders?b`forwardTextureCoordinates();`:""}

          ${t.screenSizePerspective?b`
          vec3 viewPos = (view * vec4(vpos, 1.0)).xyz;
          screenSizeDistanceToCamera = length(viewPos);
          vec3 viewSpaceNormal = (viewNormal * vec4(normalize(positionWorld), 1.0)).xyz;
          screenSizeCosAngle = abs(viewSpaceNormal.z);`:""}

          ${c?b`forwardLinearDepth();`:""}

        }
      `),e.include(ps,t),e.include(_w,t),e.include(fP,t),e.include(gw,t),up(i,t),mP(i),SE(i),i.uniforms.add(r.uniforms.get("localOrigin"),new Ft("viewDirection",(h,p)=>me(xle,se(xle,p.camera.viewMatrix[12],p.camera.viewMatrix[13],p.camera.viewMatrix[14])))),l&&i.uniforms.add(new Je("ovWaterTex",(h,p)=>p.overlays.length===0?null:p.overlays[Pi.INNER].getNormalTexture(h.overlaySource)),new uSe("view",(h,p)=>Al(A0t,p.camera.viewMatrix,h.origin))),i.code.add(b`const float sliceOpacity = 0.2;
float lum(vec3 c) {
return (min(min(c.r, c.g), c.b) + max(max(c.r, c.g), c.b)) * 0.5;
}`),Jg(i),im(i),i.code.add(b`
        void main() {
          vec3 normal = normalize(vnormal);
          float vndl = dot(normal, mainLightDirection);

          float additionalAmbientScale = smoothstep(0.0, 1.0, clamp(vndl*2.5, 0.0, 1.0));
          float shadow = ${t.receiveShadows&&!t.renderOccluded?"readShadowMap(vpos, linearDepth)":t.spherical?"lightingGlobalFactor * (1.0 - additionalAmbientScale)":"0.0"};

          float ssao = evaluateAmbientOcclusionInverse();
          vec4 tileColor = getTileColor();

          ${o?b`
              vec4 overlayColorOpaque = getOverlayColor(ovColorTex, vtcOverlay);
              vec4 overlayColor = overlayOpacity * overlayColorOpaque;
              ${t.invisible?b`if (overlayColor.a == 0.0) { discard; }`:""}
              vec4 groundColor = tileColor;
              tileColor = tileColor * (1.0 - overlayColor.a) + overlayColor;`:""}

          // If combined alpha is 0 we can discard pixel. The performance impact by having a discard here
          // is neglectable because terrain typically renders first into the framebuffer.
          if(tileColor.a <= 0.0) {
            discard;
          }

          bool sliced = rejectBySlice(vpos);
          if (sliced) {
            tileColor *= sliceOpacity;
          }

          vec3 albedo = tileColor.rgb;

          // heuristic shading function used in the old terrain, now used to add ambient lighting

          vec3 additionalLight = ssao * mainLightIntensity * additionalAmbientScale * ambientBoostFactor * lightingGlobalFactor;

          ${t.pbrMode===st.Terrain||t.pbrMode===st.TerrainWithWater?b`fragColor = vec4(evaluateTerrainLighting(normal, albedo, shadow, 1.0 - ssao, additionalLight, normalize(vpos - cameraPosition), vup), tileColor.a);`:b`fragColor = vec4(evaluateSceneLighting(normal, albedo, shadow, 1.0 - ssao, additionalLight), tileColor.a);`}
          ${l?b`
              vec4 overlayWaterMask = getOverlayColor(ovWaterTex, vtcOverlay);
              float waterNormalLength = length(overlayWaterMask);
              if (waterNormalLength > 0.95) {
                mat3 tbnMatrix = mat3(tbnTangent, tbnBiTangent, vnormal);
                vec4 waterOverlayColor = vec4(overlayColor.w > 0.0 ? overlayColorOpaque.xyz/overlayColor.w : vec3(1.0), overlayColor.w);
                vec4 viewPosition = view*vec4(vpos, 1.0);
                vec4 waterColorLinear = getOverlayWaterColor(overlayWaterMask, waterOverlayColor, -normalize(vpos - cameraPosition), shadow, vnormal, tbnMatrix, viewPosition.xyz,  vpos + localOrigin);
                vec4 waterColorNonLinear = delinearizeGamma(vec4(waterColorLinear.xyz, 1.0));
                float opacity = sliced ? sliceOpacity : 1.0;
                // un-gamma the ground color to mix in linear space
                fragColor = mix(groundColor, waterColorNonLinear, waterColorLinear.w) * opacity;
              }`:""}
          ${t.screenSizePerspective?b`
            float perspectiveScale = screenSizePerspectiveScaleFloat(1.0, screenSizeCosAngle, screenSizeDistanceToCamera, vec4(0.0, 0.0, 0.0, 0.0));
            if (perspectiveScale <= 0.25) {
              fragColor = mix(fragColor, vec4(1.0, 0.0, 0.0, 1.0), perspectiveScale * 4.0);
            }
            else if (perspectiveScale <= 0.5) {
              fragColor = mix(fragColor, vec4(0.0, 0.0, 1.0, 1.0), (perspectiveScale - 0.25) * 4.0);
            }
            else if (perspectiveScale >= 0.99) {
              fragColor = mix(fragColor, vec4(0.0, 1.0, 0.0, 1.0), 0.2);
            }
            else {
              fragColor = mix(fragColor, vec4(1.0, 0.0, 1.0, 1.0), (perspectiveScale - 0.5) * 2.0);
            }`:""}
          ${t.visualizeNormals?t.spherical?b`
                  vec3 localUp = normalize(vpos + localOrigin);
                  vec3 right = normalize(cross(vec3(0.0, 0.0, 1.0), localUp));
                  vec3 forward = normalize(cross(localUp, right));
                  mat3 tbn = mat3(right, forward, localUp);
                  vec3 tNormal = normalize(normal * tbn);
                  fragColor = vec4(vec3(0.5) + 0.5 * tNormal, 0.0);
              `:b`
                  vec3 tNormal = normalize(normal);
                  fragColor = vec4(vec3(0.5) + 0.5 * tNormal, 0.0);
              `:""}
          ${t.tileBorders?b`
              vec2 dVuv = fwidth(vuv0);
              vec2 edgeFactors = smoothstep(vec2(0.0), 1.5 * dVuv, min(vuv0, 1.0 - vuv0));
              float edgeFactor = 1.0 - min(edgeFactors.x, edgeFactors.y);
              fragColor = mix(fragColor, vec4(1.0, 0.0, 0.0, 1.0), edgeFactor);`:""}
          fragColor = highlightSlice(fragColor, vpos);
        }
      `)}break;case N.Depth:a&&e.include(RC,t),e.include(jg,t),F_(e),cw(e),r.code.add(b`
              void main(void) {
                ${a?b`setOverlayVTC(getUV0());`:""}
                gl_Position = transformPositionWithDepth(proj, view, position, nearFar, linearDepth);
              }
          `),i.code.add(b`
              void main() {
                ${a?b`if (getCombinedOverlayColor().a == 0.0) { discard; }`:""}
                outputDepth(linearDepth);
              }
          `);break;case N.Shadow:case N.ShadowHighlight:case N.ShadowExcludeHighlight:e.include(jg,t),F_(e),cw(e),r.code.add(b`void main(void) {
gl_Position = transformPositionWithDepth(proj, view, position, nearFar, linearDepth);
}`),i.code.add(b`void main() {
outputDepth(linearDepth);
}`);break;case N.Normal:a&&e.include(RC,t),s.add("vnormal","vec3"),M2(r),n(),r.code.add(b`
            void main(void) {
              ${a?b`setOverlayVTC(getUV0());`:""}
              gl_Position = transformPosition(proj, view, position);
              vnormal = normalize((viewNormal * vec4(getNormal(), 1.0)).xyz);
            }
        `),i.code.add(b`
            void main() {
              ${a?b`if (getCombinedOverlayColor().a == 0.0) { discard; }`:""}
              vec3 normal = normalize(vnormal);
              if (gl_FrontFacing == false) {
                normal = -normal;
              }
              fragColor = vec4(vec3(0.5) + 0.5 * normal, 0.0);
            }
        `);break;case N.Highlight:o&&e.include(RC,t),r.code.add(b`
          void main() {
            ${o?b`setOverlayVTC(getUV0());`:""}
            gl_Position = transformPosition(proj, view, position);
          }
        `),e.include(ny,t),i.code.add(b`
          void main() {
            ${o?b`if (getCombinedOverlayColor().a == 0.0) { discard; }`:""}
            outputHighlight();
          }
        `)}return t.output===N.ObjectAndLayerIdColor&&(e.include(RC,{...t,pbrMode:st.Disabled}),r.code.add(b`void main(void) {
gl_Position = transformPosition(proj, view, position);
setOverlayVTC(getUV0());
}`),i.code.add(b`void main() {
fragColor = getOverlayColorTexel(vtcOverlay);
}`)),e}const A0t=be(),xle=C(),O0t=Object.freeze(Object.defineProperty({__proto__:null,TerrainPassParameters:BAe,build:C0t},Symbol.toStringTag,{value:"Module"}));let GAe=class jAe extends Pr{constructor(){super(...arguments),this.useStencil=!1}initializeConfiguration(e,r){r.spherical=e.viewingMode===De.Global}initializeProgram(e){return new Cr(e.rctx,jAe.shader.get().build(this.configuration),HAe)}initializePipeline(){return this._stencilPipelineState=this._createPipeline(!0),this._createPipeline(!1)}_createPipeline(e){const r=this.configuration,i=r.backfaceCullingEnabled&&!r.renderOccluded;return At({blending:r.renderOccluded?Tc(we.ONE,we.ONE_MINUS_SRC_ALPHA):null,culling:i?CX:null,depthTest:r.renderOccluded?null:{func:Kr.LESS},depthWrite:r.renderOccluded?null:Ol,colorWrite:Vt,stencilTest:e?_lt(Sl.IntegratedMeshMaskExcluded):null})}getPipelineState(e,r){return this.useStencil?this._stencilPipelineState:super.getPipelineState(e,r)}};GAe.shader=new Er(O0t,()=>ae(()=>import("./Terrain.glsl-953de87f.js"),[],import.meta.url));const HAe=new Map([[E.POSITION,0],[E.UV0,1],[E.NORMALCOMPRESSED,2]]);let R0t=class{constructor(){this.geometry=new Cyt,this.intersectionData=null,this.geometryState=null,this._textureRef=new IAe(()=>this.tile.surface.textureFadeDuration),this.overlay=new m0t,this._geometryStateChangedSinceLastUpdate=!0,this._hasGeometry=!1,this._numVerticesPerSideChanged=!1,this._samplerDataChanged=!1,this._clippingAreaChanged=!1,this._wireframeChanged=!1,this._dirtyEdgeResolutions=15,this._dirtyEdges=15,this._dirtyCorners=15}get tile(){return this._tile}init(e){this.clear(),this._tile=e;const r=this.geometry;r.indices=null,r.vertexAttributes=null,xi(r.boundingBox),r.indexCount=0,r.numVerticesPerSide=0,this.intersectionData=null,this.geometryState=new Iyt,this.localOrigin=null,this.overlay.clear()}clear(){this.releaseGeometry(),this.releaseTexture(),this._textureRef.clear(),this._tile=null,this.intersectionData=null,this.geometryState=null}updateGeometryIfNeeded(e){if((!this._vao||this._geometryStateChangedSinceLastUpdate||this._wireframeChanged||this._clippingAreaChanged||this._samplerDataChanged||this._numVerticesPerSideChanged||this._dirtyCorners||this._dirtyEdgeResolutions||this._dirtyEdges)&&(this._updateGeometry(e),this._geometryStateChangedSinceLastUpdate=!1),ln&&this.tile.intersectsClippingArea)for(let r=0;r<4;++r)xe(this.geometry.outerEdges[r].count===this.geometryState.neighborData.edgeResolutions[r]+1)}_calculateEdgeResolution(e,r){const i=this.tile,s=this.geometryState.numVerticesPerSide-1;if(!i.surface.isGlobal){const l=i.surface.extent;if(l!=null&&(e===0&&i.extent[3]>l[3]||e===1&&i.extent[2]>l[2]||e===2&&i.extent[1]<l[1]||e===3&&i.extent[0]<l[0]))return s}const n=i.level,o=Tf[e];if(!r)return xe(i.surface?.rootTiles==null||i.surface.updatingRootTiles||!i.shouldHaveNeighbor(o)),s;if(r.isLoaded){const l=r,c=l.renderData.geometryState,h=n-l.level;if(xe(h>=0),h===0){const m=c.numVerticesPerSide-1;return Math.max(m,s)}const p=2**h,f=c.neighborData.edgeResolutions[(e+2)%4]/p;return Math.max(1,f)}xe(!r.isLeaf);let a=s;return r.forAllSubtreeOnSide(X4(o),l=>l===i||(l.isLoaded?(a=Math.max(a,2**(l.level-n)),!0):(xe(!l.isLeaf),!1))),a}updateNeighborData(){const e=this.tile;if(!e.intersectsClippingArea)return;const r=e.renderData.geometryState.neighborData,i=a=>(a.isLoaded||a.level===e.level)&&a?.intersectsClippingArea,s=r.edgePeerNeighbors,n=r.edgePeerNeighborSamplerVersions;for(let a=0;a<4;++a){const l=e.findNeighborTile(Tf[a],i),c=ob(e,l),h=c?.renderData?.geometryState.samplerDataVersion??-1,p=s[a],f=c!==ob(e,p),m=n[a]!==h;s[a]=l,(f||m)&&(n[a]=h,this._markEdgeDirty(a));const y=r.edgeResolutions[a],_=this._calculateEdgeResolution(a,l);xe(Xb(_)),xe(_>=1),r.edgeResolutions[a]=_,y!==_&&this._markEdgeResolutionDirty(a)}const o=r.cornerPeerNeighbors;for(let a=0;a<4;++a){const l=e.findNeighborTile(hR[a],i);o[a]=l;const c=ob(e,s[a]),h=ob(e,s[(a+1)%4]),p=ob(e,l);rd[a]=p,rd[(a+1)%4]=h,rd[(a+2)%4]=e,rd[(a+3)%4]=c,xe(rd.some(_=>_?.isLoaded||_===e));const f=rd.reduce((_,v)=>Math.min(_,v?.level??1/0),1/0);rd.forEach((_,v)=>{_&&_?.level>f&&(rd[v]=null)}),xe(rd.some(_=>_?.isLoaded||_===e));const m=r.cornerNeighborData[a].cornerTiles,y=r.cornerNeighborData[a].cornerTileSamplerVersions;for(let _=0;_<4;++_){const v=rd[_],w=v?.renderData.geometryState.samplerDataVersion??-1,x=m[_]!==v,T=!x&&y[_]!==w;(x||T)&&(m[_]=v,y[_]=w,this._markCornerDirty(a))}xe(m.some(_=>_?.isLoaded||_===e))}ln&&xe(this.geometryState.neighborData.edgeResolutions.every(a=>a>0));for(let a=0;a<4;++a)rd[a]=null}_updateGeometry(e){if(!this.tile.intersectsClippingArea)return;ln&&xe(!this.tile.intersectsClippingArea||this.geometryState.neighborData.edgeResolutions.every(l=>l>0)),this.intersectionData=null;const r=this.tile,i=this._vao,s=this.geometry.vertexAttributes,n=!i||!s||this._wireframeChanged||this._numVerticesPerSideChanged||this._samplerDataChanged||this._clippingAreaChanged||this._dirtyEdgeResolutions,o=!n&&(this._dirtyEdges!==0||this._dirtyEdgeResolutions!==0),a=!o&&this._dirtyCorners!==0;n?(this.releaseGeometry(),this._createGeometry(e)):o||a?r.updateEdgeElevations():a?r.updateCornerElevations():console.warn("Update for no reason?"),this._numVerticesPerSideChanged=!1,this._samplerDataChanged=!1,this._dirtyEdgeResolutions=0,this._dirtyEdges=0,this._dirtyCorners=0,this._clippingAreaChanged=!1,this._wireframeChanged=!1}get hasGeometry(){return this._hasGeometry}releaseGeometry(){return this._hasGeometry=!1,this.intersectionData=null,!!this._vao&&(this._vao.dispose(),this._vao=null,Ryt(this.geometry),!0)}ensureTexture(e,r){return this._texture!=null&&this._texture.descriptor.width!==e&&this.releaseTexture(),this._texture==null&&(this._texture=r(),this.tile.setMemoryDirty()),this._texture}releaseTexture(){this._texture!=null&&(this._texture.release(),this._texture=null,this.tile.setMemoryDirty())}_markCornerDirty(e){const r=1<<e;this._dirtyCorners|=r}_markEdgeDirty(e){const r=1<<e;this._dirtyEdges|=r,this._markCornerDirty((e+0)%4),this._markCornerDirty((e+3)%4)}_markEdgeResolutionDirty(e){const r=1<<e;this._dirtyEdgeResolutions|=r,this._markEdgeDirty(e)}_markAllEdgesAndCornersDirty(){this._dirtyCorners=15,this._dirtyEdges=15,this._dirtyEdgeResolutions=15}updateGeometryState(){const e=this._getElevationInfo(),r=this.tile,i=e.samplerData?r.getElevationVerticesPerSide(e.maxTileLevel):r.getDefaultVerticesPerSide(),s=Math.max(i,5);let n=r.clippingArea;r.intersectsClippingArea&&!r.isWithinClippingArea||(n=null);const o=this.geometryState;let a=!1;o.numVerticesPerSide!==s&&(this._numVerticesPerSideChanged=!0,o.numVerticesPerSide=s,o.samplerDataVersion++,a=!0),e.changed&&(this._samplerDataChanged=!0,o.samplerData=e.samplerData,o.samplerDataVersion++,a=!0),Pg(o.clippingArea,n)||(this._clippingAreaChanged=!0,o.clippingArea=n,a=!0);const l=r.surface.wireframe;return o.wireframe!==l&&(this._wireframeChanged=!0,o.wireframe=l,a=!0),this._geometryStateChangedSinceLastUpdate||(this._geometryStateChangedSinceLastUpdate=a),a&&this._markAllEdgesAndCornersDirty(),this._hasGeometry=!0,this._geometryStateChangedSinceLastUpdate}_createGeometry(e){this.tile.createGeometry();const r=this.geometry.vertexAttributes,i=this.geometry.indices,s=e.gl;this._vao=new pp(e,HAe,{geometry:Cc(r.layout)},{geometry:Lr.createVertex(e,s.STATIC_DRAW,r.buffer)},Lr.createIndex(e,s.STATIC_DRAW,i)),this._hasGeometry=!0}get vao(){return this._vao}setTextureReference(e,r=Ag.Immediate){e!=null&&e.texture!==this._texture&&this.releaseTexture(),this._textureRef.push(e,r)}get textureReference(){return this._textureRef.current}get nextTextureReference(){return this._textureRef.next}get textureFadeFactor(){return this._textureRef.fadeFactor}get textureIsFading(){return this._textureRef.isFading}_getElevationInfo(){const e=this.geometryState.samplerData,r=this.tile.layerInfo[tr.ELEVATION],i=r.length,s=new Array(i);let n=0,o=0,a=!1;for(let h=0;h<i;h++){const p=r[h];if(p.upsampleInfo!=null){const f=p.upsampleInfo.tile,m=f.layerInfo[tr.ELEVATION][h].data,y=m&&m.samplerData;e&&e[n]===y||(a=!0),s[n++]=y,o=Math.max(o,f.lij[0])}else if(p.data){const f=this.tile.surface.layerViewByIndex(h,tr.ELEVATION);if(lO(this.tile,f.layer,!1)){const m=p.data;e&&e[n]===m.samplerData||(a=!0),s[n++]=m.samplerData,o=this.tile.level}}}e!=null&&e.length!==n&&(a=!0);const l=n>0,c=l?s:null;return l&&(s.length=n),{changed:a,samplerData:c,maxTileLevel:o}}get estimatedGeometryMemoryUsage(){const e=this.intersectionData?.estimatedMemoryUsage??0;return(this.geometry.indices?.byteLength??0)+(this.geometry.vertexAttributes?.byteLength??0)+e}get texture(){return this._texture}get test(){return{hasTexture:this._texture!=null}}checkGeometryWaterproofness(){if(!ln)return;const e=this.tile;if(!e.isLoaded||!e.intersectsClippingArea||e.level===0)return void xe(e?.isLoaded);const r=e.surface.extent;if(r!=null&&!e.intersectsExtent(r))return;const i=Tf.map((a,l)=>r!=null&&(l<2?-1:1)*(e.extent[3-l]-r[3-l])<0),s=e.level;xe(this._dirtyCorners===0),xe(this._dirtyEdges===0),xe(this._dirtyEdgeResolutions===0),xe(!this._numVerticesPerSideChanged),xe(!this._samplerDataChanged),xe(!this._clippingAreaChanged),xe(!this._wireframeChanged);const n=hR.map(a=>e.findNeighborCornerTileExact(a,l=>!l.intersectsClippingArea||l.isLoaded||l.level===e.level)??null).map(a=>a?.intersectsClippingArea?a:null),o=this.geometryState.neighborData;for(let a=0;a<4;++a){const l=o.cornerPeerNeighbors[a],c=n[a];xe(c===l,`Tile[${e.lij}].corner[${a}] out of date: cur=[${l?.lij}] exp=[${c?.lij}]`)}Tf.forEach((a,l)=>{if(i[l])return;const c=e.findNeighborTile(a,z=>(z.level===s||z?.isLoaded)&&z?.intersectsClippingArea);if(!c){const z=!e.surface.updatingRootTiles&&e.surface.rootTiles!=null&&e.surface.rootTiles.length>0&&e.shouldHaveNeighbor(a);return void xe(!z)}xe(c.isLoaded||c.level===e.level),xe(c===this.geometryState.neighborData.edgePeerNeighbors[l]);const h=s-c.level;if(!c.isLoaded)return xe(!c.isLeaf),void xe(h===0);const p=c.renderData;xe(f0t(e,c,a)),xe(h>=0);const f=2**h;if(h<0)return void xe(!1);const m=e.renderData,y=m.geometry,_=y.outerEdges[l],v=y.numVerticesPerSide-1,w=p.geometry;if(!w)return void xe(!1);const x=this.geometryState.neighborData.edgePeerNeighbors[l];if(x?.isLoaded){const z=x.renderData;xe(x==x),xe(m.geometryState.neighborData.edgePeerNeighborSamplerVersions[l]===z.geometryState.samplerDataVersion),xe(this.geometryState.neighborData.edgePeerNeighborSamplerVersions[l]===z.geometryState.samplerDataVersion)}const T=(l+2)%4,S=w.outerEdges[T],O=_.count-1,A=S.count-1;xe(O*f===A,`Tile[${e.lij}]:e${l},res=${O} edgeRes mismatch with Neighbor[${c.lij}]:e${T},res=${A} (expected:${O*f})`);const I=e.extent,M=a===nt.NORTH||a===nt.SOUTH,k=S.count-1,L=k/2**h,D=_.count-1;if(L<1)return void xe(D===1);xe(L===D),xe(Xb(L));const U=w.numVerticesPerSide-1;xe(h>0||L===Math.max(U,v));const X=e.getNeighborEdgeStartVertexIndex(l,c);xe(0<=X&&X<f);const W=X*L;xe(0<=W&&W<=k-L);let G=0,Y=W;_.getVertexPos(Np,0),_.getVertexPos(Fp,_.count-1);const P=di(Np,Fp),V=Math.max(P0t,1e-4*P);for(let z=0;z<=L;++z){_.getVertexPos(Np,G),S.getVertexPos(Fp,Y);const H=z/L,Z=M?I[0]+H*(I[2]-I[0]):a===nt.WEST?I[0]:I[2],J=M?a===nt.SOUTH?I[1]:I[3]:I[1]+H*(I[3]-I[1]),re=e.surface.extent;if(re==null||PF(re,Z,J)){const ye=PR(Np,Fp),Ne=Kl(Np)-nr.radius,yt=Kl(Fp)-nr.radius,Ot=ye<V;if(!Ot){console.warn(`Tile edge vertex position mismatch: between [${e.lij}].edge${l}[${G}/${_.count}] and [${c.lij}].edge${T}[${Y}/${S.count}]`),re!=null&&console.warn("  surface extent= ",re," x,y=",Z,",",J);const _e=C();he(_e,m.localOrigin,p.localOrigin),Kl(_e)>0&&console.warn(`   localOrigins: ${m.localOrigin} vs ${p.localOrigin} d=${Kl(_e)} [${_e}]`),(()=>{const Ae=$s(Np),xt=$s(Fp);e.updateEdgeElevations(),c.updateEdgeElevations(),_.getVertexPos(Np,G),S.getVertexPos(Fp,Y);const ve=C();Cn(ve,Np,Ae),Kl(ve)>0&&console.warn(`  XXX Tile[${e.lij}] edge out of date: ${Ae} vs ${Np} d=${Kl(ve)} [${ve}]`),Cn(ve,Fp,xt),Kl(ve)>0&&console.warn(`  XXX Neighbor[${c.lij}] edge out of date: ${xt} vs ${Fp} d=${Kl(ve)} [${ve}]`)})(),xe(Ot,`Mismatch in tile [${e.lij}].edge[${l}][${G}/${_.count}] vs neighbor [${c.lij}].edge[${T}][${Y}/${S.count}] ${xm(Np)} vs ${xm(Fp)}  dist=${ye} h(t|n|d)=${Ne}|${yt}|${yt-Ne}`)}_.getNormal(Bx,G),S.getNormal(Gx,Y),me(Tle,Bx),me(Sle,Gx);const lt=fe(Tle,Sle),_t=1-lt<.01||!1||e===c;if(!_t){const _e=C();Cn(_e,Bx,Gx);const Ae=()=>`Mismatch in tile edge normal ${rle(e.lij)} (${G}/${_.count-1}) edge ${l} vs neighbor ${rle(c.lij)}  (${Y}/${S.count-1}) nedge ${T} :${xm(Bx)} vs ${xm(Gx)}  dot = ${lt} : ${xm(_e)}`;console.warn("Mismatch in tile edge normal: ",Ae());{e.updateEdgeElevations(),c.updateEdgeElevations();const xt=C(),ve=C();_.getNormal(xt,G),S.getNormal(ve,Y),T_(Bx,xt)||console.warn("Missing update in tile normal: ",xm(Bx)," => ",xm(xt)),T_(Gx,ve)||console.warn("Missing update in neighbor normal: ",xm(Gx)," => ",xm(ve))}xe(_t,Ae())}}G+=1,Y+=1}})}};const Np=C(),Fp=C(),Bx=C(),Gx=C(),Tle=C(),Sle=C(),P0t=1,rd=[null,null,null,null];function ob(t,e){return e?.isLoaded||e===t?e:null}const M0t=65536;function I0t(t,e){const r=t.tile,{extent:i,extentInRadians:s,surface:n}=r,o=t.localOrigin,a=t.geometryState,l=n.isWebMercator,c=a.numVerticesPerSide,h=c-1,p=(c-2)**2,f=l&&(e===lh.HAS_SOUTH_POLE||e===lh.HAS_BOTH_POLES),m=l&&(e===lh.HAS_NORTH_POLE||e===lh.HAS_BOTH_POLES),y=6,_=((f?1:0)+(m?1:0))*y*(h+1),v=a.neighborData,w=v.edgeResolutions.reduce((I,M)=>I+M+1,0),x=MAe(p+_+w),T=t.geometry;T.numVerticesPerSide=a.numVerticesPerSide,T.vertexAttributes=x;const S=T.boundingBox;xi(S);const O=$J(t);ho.update(h,s,O),$0t(t),t3e(t,p),qAe(t);const A=[];if((()=>{let I=p+w;const M=o[0],k=o[1],L=o[2],D=r.ellipsoid.radius,U=i[1],X=i[3],W=(G,Y)=>{const P=Y*c;Th(-M,-k,G*D-L,S),A.push({connectedRowOffset:P,connectedOuterEdgeOffset:G===1?0:2,rowOffset:I,latitudeResolution:y});const V=XAe(G===-1?U:X,D),z=G*Math.PI/2-V,H=.99*(G===1?1:-1),Z=D+0,J=x.position,re=x.uv0,{typedBuffer:ye,typedBufferStride:Ne}=x.normalCompressed;for(let yt=1;yt<=y;++yt){const Ot=V+z*(yt/y),lt=Math.cos(Ot),_t=Math.sin(Ot);for(let _e=0;_e<=h;_e++){const Ae=_e/h,xt=ho.sinLonLUT[_e],ve=ho.cosLonLUT[_e]*lt,Be=xt*lt,qe=_t,ft=ve*Z-M,ct=Be*Z-k,Ge=qe*Z-L;Th(ft,ct,Ge,S),J.setValues(I,ft,ct,Ge),rp(re,I,Ae,H),yw(ye,I,ve,Be,qe,Ne),++I}}};f&&W(-1,0),m&&W(1,h)})(),e3e(T,a.numVerticesPerSide,A,[0,c-1],[0,c-1],a.wireframe),t.intersectionData=null,ln)for(let I=0;I<4;++I)xe(T.outerEdges[I].count===v.edgeResolutions[I]+1)}function $0t(t){const e=t.tile;if(!e.intersectsClippingArea)return;const r=t.geometryState,i=r.numVerticesPerSide,s=i-2,n=i-1,o=t.geometry,a=o.vertexAttributes,l=a.position,c=a.uv0,{typedBuffer:h,typedBufferStride:p}=a.normalCompressed,f=e.extent,m=f[0],y=f[2],_=f[1],v=f[3],w=e.ellipsoid.radius,x=r.samplerData,T=t.localOrigin,S=T[0],O=T[1],A=T[2],I=l.typedBuffer,M=l.typedBufferStride,k=1/n,L=o.boundingBox;let D=0;if(1<=s){const U=k,X=_*(1-U)+v*U,W=ho.sinLatLUT[1],G=ho.cosLatLUT[1];for(let Y=1;Y<=s;Y++){const P=Y*k,V=m*(1-P)+y*P,z=ho.sinLonLUT[Y],H=ho.cosLonLUT[Y],Z=w+Wi(V,X,x),J=Z*H*G-S,re=Z*z*G-O,ye=Z*W-A;Th(J,re,ye,L);const Ne=(Y-1)*M;I[Ne]=J,I[Ne+1]=re,I[Ne+2]=ye,rp(c,Y-1,P,U)}}for(let U=1;U<=s;U++){const X=U*k,W=_*(1-X)+v*X,G=ho.sinLatLUT[U],Y=ho.cosLatLUT[U],P=U+1,V=P*k,z=_*(1-V)+v*V,H=ho.sinLatLUT[P],Z=ho.cosLatLUT[P],J=ho.sinLonLUT[0],re=ho.cosLonLUT[0],ye=w+Wi(m,W,x);let Ne=re*Y*ye-S,yt=J*Y*ye-O,Ot=G*ye-A;const lt=D*M;let _t=I[lt],_e=I[lt+1],Ae=I[lt+2];for(let xt=1;xt<=s;xt++){const ve=xt*k,Be=m*(1-ve)+y*ve,qe=ho.sinLonLUT[xt],ft=ho.cosLonLUT[xt];let ct=0,Ge=0,vt=0;if(xt<s){const fr=(D+1)*M;ct=I[fr],Ge=I[fr+1],vt=I[fr+2]}else{const fr=ho.sinLonLUT[n],ai=ho.cosLonLUT[n],zs=w+Wi(y,W,x);ct=ai*Y*zs-S,Ge=fr*Y*zs-O,vt=G*zs-A}const cr=Ne,rr=yt,fi=Ot;Ne=_t,yt=_e,Ot=Ae,_t=ct,_e=Ge,Ae=vt;const rt=ct-cr,it=Ge-rr,mt=vt-fi;let Yt=0,ir=0,Hr=0;if(U>1){const fr=(D-s)*M;Yt=I[fr],ir=I[fr+1],Hr=I[fr+2]}else{const fr=ho.sinLatLUT[0],ai=ho.cosLatLUT[0],zs=w+Wi(Be,_,x);Yt=ft*ai*zs-S,ir=qe*ai*zs-O,Hr=fr*zs-A}const mi=w+Wi(Be,z,x),Jt=ft*Z*mi-S,gi=qe*Z*mi-O,Di=H*mi-A;if(U<s){const fr=D+s,ai=fr*M;I[ai]=Jt,I[ai+1]=gi,I[ai+2]=Di,Th(Jt,gi,Di,L),rp(c,fr,ve,V)}const zr=Yt-Jt,xr=ir-gi,Bi=Hr-Di;let ys=ft*Y,Mr=qe*Y,ti=G;ti*ti<.999&&(ys=mt*xr-it*Bi,Mr=rt*Bi-mt*zr,ti=it*zr-rt*xr);const qr=1/Math.sqrt(ys*ys+Mr*Mr+ti*ti);yw(h,D,ys*qr,Mr*qr,ti*qr,p),++D}}}function L0t(t){t.tile.intersectsClippingArea&&(qAe(t),$6(t))}function D0t(t){t.tile.intersectsClippingArea&&(ZAe(t),WAe(t,!0),$6(t))}function qAe(t){t.tile.intersectsClippingArea&&(ZAe(t),WAe(t))}function WAe(t,e=!1){const r=t.geometryState,i=t.geometry,s=r.neighborData,n=t.tile,o=n.level,a=n.extent,l=n.ellipsoid.radius,c=n.extentInRadians,h=c[0],p=c[2],f=c[1],m=c[3],y=r.samplerData,_=a[0],v=a[2],w=a[1],x=a[3],T=$J(t),S=i.boundingBox,O=t.localOrigin,A=O[0],I=O[1],M=O[2],k=i.vertexAttributes,L=k.position,D=L.typedBuffer,U=L.typedBufferStride,X=k.uv0;for(let W=0;W<4;++W){const G=W===1||W===3,Y=s.edgeResolutions[W];xe(Xb(Y));const P=Y+1,V=ob(n,s.edgePeerNeighbors[W]);if(s3e(n,V,W)){r3e(t,W,V);continue}const z=V!=null;xe(!z||V.level===n.level),xe(!z||Og(n,V)<=0);const H=V?.renderData,Z=H?.geometryState;if(ln){const rt=n.surface;if(!V&&rt&&!rt.updatingRootTiles){const it=Tf[W],mt=n.findNeighborTile(it,Yt=>Yt.isLoaded||Yt.isLeaf||Yt.level===n.level);mt?mt.intersectsClippingArea&&(xe(!mt.isLoaded),xe(!mt.isLeaf),xe(mt.level===o)):xe(rt?.rootTiles==null||!n.shouldHaveNeighbor(it))}}const J=W===1?a[2]:a[0],re=V?.extent,ye=re&&G?W===1?re[0]:re[2]:J,Ne=W===0?a[3]:a[1],yt=W===1?1:0,Ot=W===0?1:0,lt=W===1?p:h,_t=W===0?m:f,_e=Math.sin(lt),Ae=Math.cos(lt),xt=Math.sin(_t),ve=Math.cos(_t),Be=Z?.samplerData,qe=z?(rt,it,mt)=>.5*(Wi(rt,it,y)+Wi(mt,it,Be)):(rt,it,mt)=>Wi(rt,it,y),ft=i.outerEdges[W],ct=e&&P>3?P-3:1,Ge=y!=null&&y.some(rt=>rt!=null),vt=Be!=null&&Be.some(rt=>rt!=null),cr=Ge||vt,rr=1/Y,fi=ft.index0;xe(!re||uh(re[2]-re[0],a[2]-a[0])),(()=>{const rt=W===1?-1:W===3?1:0,it=W===0?-1:W===2?1:0,mt=(a[2]-a[0])*rr,Yt=rt*mt,ir=it*mt,Hr=G?rt*((p-h)*rr):0,mi=G?0:it*rr,Jt=Ot,gi=G?lt+Hr:lt,Di=G?Math.sin(gi):_e,zr=G?Math.cos(gi):Ae,xr=G?lt-Hr:lt,Bi=G?Math.sin(xr):_e,ys=G?Math.cos(xr):Ae,Mr=G?_t:T(Jt+mi),ti=G?xt:Math.sin(Mr),qr=G?ve:Math.cos(Mr),fr=G?_t:T(Jt-mi),ai=G?xt:Math.sin(fr),zs=G?ve:Math.cos(fr);let Kn=0,eo=0,mn=0;{const Wr=0*rr,Mn=G?J:_*(1-Wr)+v*Wr,So=G?ye:Mn,fa=G?w*(1-Wr)+x*Wr:Ne,ne=G?lt:h*(1-Wr)+p*Wr,Ti=G?_e:Math.sin(ne),Bh=G?Ae:Math.cos(ne),In=G?T(Wr):_t,Gh=G?Math.sin(In):xt,Qe=G?Math.cos(In):ve,Pl=l+qe(Mn,fa,So);Kn=Bh*Qe*Pl,eo=Ti*Qe*Pl,mn=Gh*Pl}let gn=0,Gi=0,yn=0;{const Wr=1*rr,Mn=G?J:_*(1-Wr)+v*Wr,So=G?ye:Mn,fa=G?w*(1-Wr)+x*Wr:Ne,ne=G?lt:h*(1-Wr)+p*Wr,Ti=G?_e:Math.sin(ne),Bh=G?Ae:Math.cos(ne),In=G?T(Wr):_t,Gh=G?Math.sin(In):xt,Qe=G?Math.cos(In):ve,Pl=l+qe(Mn,fa,So);gn=Bh*Qe*Pl,Gi=Ti*Qe*Pl,yn=Gh*Pl}for(let Wr=1;Wr<P-1;Wr+=ct){let Mn=0,So=0,fa=0;{const ma=(Wr+1)*rr,Ml=G?J:_*(1-ma)+v*ma,yp=G?ye:Ml,Ln=G?w*(1-ma)+x*ma:Ne,Qi=G?lt:h*(1-ma)+p*ma,uy=G?_e:Math.sin(Qi),av=G?Ae:Math.cos(Qi),lv=G?T(ma):_t,Gw=G?Math.sin(lv):xt,cv=G?Math.cos(lv):ve,hy=l+qe(Ml,Ln,yp);Mn=av*cv*hy,So=uy*cv*hy,fa=Gw*hy}const ne=Mn,Ti=So,Bh=fa,In=gn,Gh=Gi,Qe=yn;gn=ne,Gi=Ti,yn=Bh;{const ma=fi+Wr,Ml=ma*U,yp=In-A,Ln=Gh-I,Qi=Qe-M;D[Ml]=yp,D[Ml+1]=Ln,D[Ml+2]=Qi,Th(yp,Ln,Qi,S);const uy=Wr*rr;rp(X,ma,G?yt:uy,G?uy:Ot)}const Pl=Kn,$n=eo,sv=mn;Kn=In,eo=Gh,mn=Qe;const nv=In,Ya=Gh,am=Qe,ov=1/Math.sqrt(nv*nv+Ya*Ya+am*am),Qt=am*ov;let ly=0,lm=0,cy=0;if(cr&&Qt*Qt<.999){let ma=0,Ml=0,yp=0;{const Ln=W===0?-1:1;ma=Ln*(ne-Pl),Ml=Ln*(Ti-$n),yp=Ln*(Bh-sv)}{const Ln=Wr*rr,Qi=G?J:_*(1-Ln)+v*Ln,uy=G?ye:Qi,av=G?w*(1-Ln)+x*Ln:Ne,lv=G?lt:h*(1-Ln)+p*Ln,Gw=G?_e:Math.sin(lv),cv=G?Ae:Math.cos(lv),hy=G?T(Ln):_t,vP=G?Math.sin(hy):xt,Ja=G?Math.cos(hy):ve;let EE=nv,CE=Ya,j=am;if(z){const pe=l+Wi(uy-Yt,av-ir,Be),Se=G?Ja:zs;EE=(G?ys:cv)*Se*pe,CE=(G?Bi:Gw)*Se*pe,j=(G?vP:ai)*pe}{const pe=l+Wi(Qi+Yt,av+ir,y),Se=G?Ja:qr,ur=(G?zr:cv)*Se*pe,Bs=(G?Di:Gw)*Se*pe,yi=(G?vP:ti)*pe;z||(EE=2*nv-ur,CE=2*Ya-Bs,j=2*am-yi);const ga=W===3?-1:1,uv=ga*(EE-ur),HJ=ga*(CE-Bs),qJ=ga*(j-yi);ly=yp*HJ-Ml*qJ,lm=ma*qJ-yp*uv,cy=Ml*uv-ma*HJ;const U6=1/Math.sqrt(ly*ly+lm*lm+cy*cy);ly*=U6,lm*=U6,cy*=U6}}}else ly=nv*ov,lm=Ya*ov,cy=am*ov;ft.setNormalFromValues(Wr,ly,lm,cy)}})()}}function ZAe(t){i3e(t)}function XAe(t,e){return Math.PI/2-2*Math.atan(Math.exp(-t/e))}function N0t(t,e,r,i){return XAe(t*(1-i)+e*i,r)}function F0t(t,e,r){return t*(1-r)+e*r}function $J(t){const e=t.tile;if(e.surface.isWebMercator){const i=e.extent,s=e.ellipsoid.radius;return n=>N0t(i[1],i[3],s,n)}const r=e.extentInRadians;return i=>F0t(r[1],r[3],i)}function U0t(t,e){const r=t.tile.extent,i=t.geometryState,s=r[0],n=r[1],o=r[2]-s,a=r[3]-n,l=i.clippingArea,c=l!=null?Math.max(0,(l[0]-s)/o):0,h=l!=null?Math.max(0,(l[1]-n)/a):0,p=l!=null?Math.min(1,(l[2]-s)/o):1,f=l!=null?Math.min(1,(l[3]-n)/a):1,m=i.numVerticesPerSide,y=(m-2)**2,_=i.neighborData.edgeResolutions.reduce((T,S)=>T+S+1,0),v=MAe(y+_),w=t.geometry,x=w.boundingBox;xi(x),w.numVerticesPerSide=i.numVerticesPerSide,w.vertexAttributes=v,bi(w.uvRange,c,h,p,f),k0t(t),t3e(t,y),YAe(t),e3e(w,i.numVerticesPerSide,[],[0,m-1],[0,m-1],i.wireframe),t.intersectionData=null}function k0t(t){const e=t.tile;if(!e.intersectsClippingArea)return;const r=e.surface,i=t.geometryState,s=i.samplerData,n=t.localOrigin,o=r.isWebMercatorOnPlateeCarree,a=i.clippingArea,l=a??LJ,c=e.extent,h=c[0],p=c[1],f=c[2],m=c[3],y=Math.max(h,l[0]),_=Math.min(f,l[2]),v=Math.max(p,l[1]),w=Math.min(m,l[3]),x=e.ellipsoid.radius,T=e.horizontalScale,S=i.numVerticesPerSide,O=S-1,A=S-2,I=t.geometry,M=I.vertexAttributes,k=M.position,L=M.uv0,{typedBuffer:D,typedBufferStride:U}=M.normalCompressed,X=I.uvRange,W=X[0],G=X[1],Y=X[2],P=X[3],V=I.boundingBox,z=n[0],H=n[1],Z=n[2],J=k.typedBuffer,re=k.typedBufferStride;let ye=0;const Ne=ge(p,v,w),yt=o?(Math.PI/2-2*Math.atan(Math.exp(-Ne/x)))*x:Ne*T,Ot=1/O,lt=ge(p*(1-Ot)+m*Ot,v,w);let _t=yt,_e=o?(Math.PI/2-2*Math.atan(Math.exp(-lt/x)))*x:lt*T;for(let Ae=1;Ae<=A;Ae++){const xt=Ae/O,ve=ge(p*(1-xt)+m*xt,v,w),Be=ge(xt,G,P),qe=_e,ft=(Ae-1)/O,ct=ge(p*(1-ft)+m*ft,v,w),Ge=_t,vt=(Ae+1)/O,cr=ge(p*(1-vt)+m*vt,v,w),rr=o?(Math.PI/2-2*Math.atan(Math.exp(-cr/x)))*x:cr*T,fi=ge(vt,G,P);_t=_e,_e=rr;const rt=ge(h,y,_);let it=rt*T,mt=Wi(rt,ve,s);const Yt=1/O,ir=ge(Yt,W,Y),Hr=ge(h*(1-ir)+f*ir,y,_);let mi=ir,Jt=Hr,gi=Hr*T,Di=Wi(Hr,ve,s);if(Ae===1){const zr=gi-z,xr=_t-H,Bi=Di-Z,ys=0*re;J[ys]=zr,J[ys+1]=xr,J[ys+2]=Bi,Th(zr,xr,Bi,V);const Mr=ge(Yt,W,Y);rp(L,ye,Mr,Be)}for(let zr=1;zr<=A;zr++){const xr=gi,Bi=Di,ys=(zr+1)/O,Mr=ge(ys,W,Y),ti=ge(h*(1-ys)+f*ys,y,_),qr=Jt;Jt=ti;{const Gi=ye+1,yn=Gi*re;if(Ae===1||zr===A){const Wr=ti*T,Mn=Wi(ti,ve,s);if(Ae===1&&zr<A){const So=Wr-z,fa=qe-H,ne=Mn-Z;J[yn]=So,J[yn+1]=fa,J[yn+2]=ne,Th(So,fa,ne,V),rp(L,Gi,Mr,Be)}gi=Wr,Di=Mn}else gi=J[yn]+z,Di=J[yn+2]+Z}const fr=gi,ai=Di,zs=it,Kn=mt;it=xr,mt=Bi;const eo=(ye-A)*re,mn=Ae===1?Wi(qr,ct,s):J[eo+2]+Z,gn=Wi(qr,cr,s);if(Ae<A){const Gi=ye+A,yn=Gi*re,Wr=xr-z,Mn=rr-H,So=gn-Z;J[yn]=Wr,J[yn+1]=Mn,J[yn+2]=So,Th(Wr,Mn,So,V);const fa=mi;mi=Mr,rp(L,Gi,fa,fi)}{const Gi=fr-zs,yn=Ge-rr,Wr=yn*(ai-Kn),Mn=Gi*(mn-gn),So=-yn*Gi,fa=Wr*Wr+Mn*Mn+So*So;if(fa===0)yw(D,ye,0,0,1,U);else{const ne=1/Math.sqrt(fa);yw(D,ye,Wr*ne,Mn*ne,So*ne,U)}}++ye}}}function V0t(t,e){t.tile.intersectsClippingArea&&(QAe(t),JAe(t,!0),$6(t))}function z0t(t,e){t.tile.intersectsClippingArea&&(YAe(t),$6(t))}function YAe(t,e){t.tile.intersectsClippingArea&&(QAe(t),JAe(t,!1))}function JAe(t,e){const r=t.geometryState,i=r.neighborData,s=t.tile,n=s.surface,o=s.extent,a=r.clippingArea,l=a??LJ,c=o[0],h=o[2],p=o[1],f=o[3],m=[f>l[3],h>l[2],p<l[1],c<l[0]],y=t.geometry,_=s.horizontalScale,v=KAe(n.isWebMercatorOnPlateeCarree,s.ellipsoid.radius,_),w=y.boundingBox,x=y.uvRange[0],T=y.uvRange[1],S=y.uvRange[2],O=y.uvRange[3],A=Math.max(c,l[0]),I=Math.min(h,l[2]),M=Math.max(p,l[1]),k=Math.min(f,l[3]),L=t.localOrigin,D=L[0],U=L[1],X=L[2],W=r.samplerData;for(let G=0;G<4;++G){const Y=G===1||G===3,P=i.edgeResolutions[G];xe(Xb(P));const V=P+1,z=m[G],H=ob(s,i.edgePeerNeighbors[G]);if(!z&&s3e(s,H,G)){r3e(t,G,H);continue}const Z=H!=null&&!z,J=H?.renderData,re=J?.geometryState;if(ln&&(xe(!Z||H.level===s.level),xe(!Z||Og(s,H)<=0),s&&!H&&!n.updatingRootTiles)){const rt=Tf[G],it=s.findNeighborTile(rt,mt=>mt.isLoaded||mt.isLeaf||mt.level===s.level);n.updatingRootTiles||(it?it.intersectsClippingArea&&(xe(!it.isLoaded),xe(!it.isLeaf),xe(it.level===s.level)):xe(n?.rootTiles==null||!s.shouldHaveNeighbor(rt)))}const ye=ge(G===1?h:c,A,I),Ne=ge(G===0?f:p,M,k),yt=re?.samplerData,Ot=y.outerEdges[G],lt=e&&V>3?V-3:1,_t=ge(G===1?1:0,x,S),_e=ge(G===0?1:0,T,O),Ae=Z?(rt,it)=>.5*(Wi(rt,it,yt)+Wi(rt,it,W)):(rt,it)=>Wi(rt,it,W),xt=(h-c)/P,ve=Y?G===1?xt:-xt:0,Be=Y?0:G===0?xt:-xt,qe=-ve,ft=-Be;let ct=0,Ge=0,vt=0;{const rt=0/P,it=Y?ye:ge(c*(1-rt)+h*rt,A,I),mt=Y?ge(p*(1-rt)+f*rt,M,k):Ne,Yt=Ae(it,mt);ct=it*_,Ge=v(mt),vt=Yt}let cr=0,rr=0,fi=0;{const rt=1/P,it=Y?ye:ge(c*(1-rt)+h*rt,A,I),mt=Y?ge(p*(1-rt)+f*rt,M,k):Ne,Yt=Ae(it,mt);cr=it*_,rr=v(mt),fi=Yt}for(let rt=1;rt<V-1;rt+=lt){const it=rt/P,mt=cr,Yt=rr,ir=fi;{const Mr=Y?_t:ge(it,x,S),ti=Y?ge(it,T,O):_e,qr=mt-D,fr=Yt-U,ai=ir-X;Th(mt,fr,ai,w),Ot.setVertexFromValuesRawPositionUV(rt,qr,fr,ai,Mr,ti)}{const Mr=(rt+1)/P,ti=Y?ye:ge(c*(1-Mr)+h*Mr,A,I),qr=Y?ge(p*(1-Mr)+f*Mr,M,k):Ne,fr=Ae(ti,qr);cr=ti*_,rr=v(qr),fi=fr}const Hr=cr,mi=fi,Jt=ct,gi=Ge,Di=vt;ct=mt,Ge=Yt,vt=ir;let zr=0,xr=0,Bi=0;if(Y){const Mr=rr-Yt,ti=mi-ir,qr=gi-Yt,fr=Di-ir,ai=ge(p*(1-it)+f*it,M,k),zs=ye+qe,Kn=zs*_-mt,eo=Wi(zs,ai,W)-ir,mn=G===3?-1:1;if(zr=mn*(-qr+Mr)*eo,xr=mn*Kn*(-fr+ti),Bi=-mn*Kn*(-qr+Mr),Z){const gn=ye+ve,Gi=gn*_-mt;zr=(-qr+Mr)*(eo-(Wi(gn,ai,yt)-ir)),xr=(Kn-Gi)*(-fr+ti),Bi=-(Kn-Gi)*(-qr+Mr)}}else{const Mr=Hr-mt,ti=mi-ir,qr=Jt-mt,fr=Di-ir,ai=ge(c*(1-it)+h*it,A,I),zs=Ne+ft,Kn=Wi(ai,zs,W)-ir,eo=v(zs)-Yt,mn=G===2?-1:1;if(zr=mn*eo*(-fr+ti),xr=mn*(-qr+Mr)*Kn,Bi=-mn*eo*(-qr+Mr),Z){const gn=ai,Gi=Ne+Be,yn=v(Gi)-Yt;zr=(-eo+yn)*(-fr+ti),xr=(-qr+Mr)*(-Kn+(Wi(gn,Gi,yt)-ir)),Bi=-(-eo+yn)*(-qr+Mr)}}const ys=1/Math.sqrt(zr*zr+xr*xr+Bi*Bi);Ot.setNormalFromValues(rt,zr*ys,xr*ys,Bi*ys)}}}function QAe(t,e){i3e(t)}function B0t(t,e){return(Math.PI/2-2*Math.atan(Math.exp(-t/e)))*e}function G0t(t,e){return t*e}function KAe(t,e,r){return t?i=>B0t(i,e):i=>G0t(i,r)}function e3e(t,e,r,i,s,n){const o=e-1,a=t.vertexAttributes.count,l=2*(Math.min(e-2,i[1])-Math.max(1,i[0]))*(Math.min(e-2,s[1])-Math.max(1,s[0])),c=Tf.map((T,S)=>S===0&&s[1]<e-2||S===1&&i[1]<e-2||S===2&&s[0]>1||S===3&&i[0]>1),h=t.outerEdges.reduce((T,S,O)=>T+(c[O]?0:o-2+S.count-1),0),p=r.reduce((T,S)=>T+o*(2*(S.latitudeResolution-1)+1),0),f=n?2:1,m=3*(l+h+p)*f,y=a>=M0t?new Uint32Array(m):new Uint16Array(m);let _=0;const v=e-2,w=o-2;xe(w>=0);const x=(T,S,O,A,I,M)=>{const k=T*I,L=M[k],D=M[k+1],U=M[k+2],X=S*I,W=M[X],G=M[X+1],Y=M[X+2],P=O*I,V=M[P],z=M[P+1],H=M[P+2],Z=A*I,J=M[Z],re=M[Z+1],ye=M[Z+2];return(W-J)*(W-J)+(G-re)*(G-re)+(Y-ye)*(Y-ye)>(L-V)*(L-V)+(D-z)*(D-z)+(U-H)*(U-H)};if(n){const T=(O,A,I)=>{y[_++]=O,y[_++]=A,y[_++]=A,y[_++]=I,y[_++]=I,y[_++]=O,ln&&(xe(O<a),xe(A<a),xe(I<a),xe(_<=m))};(()=>{for(let O=Math.max(s[0],1)-1;O<Math.min(s[1],e-2)-1;++O){const A=O*v;for(let I=Math.max(i[0],1)-1;I<Math.min(i[1],e-2)-1;++I){const M=O*v+I,k=M+1,L=k+v,D=L-1,U=A+I,X=U+1,W=X+v,G=W-1,Y=t.vertexAttributes.position.typedBuffer,P=t.vertexAttributes.position.typedBufferStride;x(U,X,W,G,P,Y)?(T(M,k,L),T(L,D,M)):(T(M,k,D),T(D,L,k))}}})(),xe(_===3*l*f),(()=>{for(let O=0;O<4;++O){const A=_;if(c[O])continue;const I=t.outerEdges[O],M=t.innerEdges[O];let k=0,L=0;const D=I.count,U=M.count;xe(U===o-1);let X=0;const W=O===1||O===2?(G,Y,P)=>T(G,Y,P):(G,Y,P)=>T(G,P,Y);for(;k<D-1||L<U-1;){const G=M.getVertexIndex(L),Y=I.getVertexIndex(k),P=k<D-1,V=L<U-1;P&&(!V||(P?0+o*(k+.5)/(D-1):0)<=(V?1+w*(L+.5)/(U-1):0))?(++k,ln&&xe(k<D),W(G,Y,I.getVertexIndex(k)),X++):(++L,ln&&xe(L<U),W(G,Y,M.getVertexIndex(L)),X++)}ln&&(xe(k===D-1),xe(L===U-1),xe(X===D+U-2),xe(X===o-2+I.count-1),xe(_===A+3*X*f))}})(),xe(_===3*(l+h)*f);const S=O=>{const A=t.outerEdges[O.connectedOuterEdgeOffset];let I=A.getVertexIndex(0),M=A.stride;for(let k=0;k<O.latitudeResolution;++k){const L=k===0?O.rowOffset:I+e;for(let D=0;D<o;D++)T(I,I+1,L+D),k<O.latitudeResolution-1&&T(I+1,L+D+1,L+D),I+=M;I=L,M=1}};r.forEach(S)}else{(()=>{const S=Math.max(s[0],1)-1,O=Math.min(s[1],e-2)-1,A=Math.max(i[0],1)-1,I=Math.min(i[1],e-2)-1;for(let M=S;M<O;++M){const k=M*v;for(let L=A;L<I;++L){const D=k+L,U=D+1,X=U+v,W=X-1,G=t.vertexAttributes.position.typedBuffer,Y=t.vertexAttributes.position.typedBufferStride;x(D,U,X,W,Y,G)?(y[_]=D,y[_+1]=U,y[_+2]=X,y[_+3]=X,y[_+4]=W,y[_+5]=D):(y[_]=D,y[_+1]=U,y[_+2]=W,y[_+3]=W,y[_+4]=U,y[_+5]=X),_+=6}}})(),xe(_===3*l*f),(()=>{for(let S=0;S<4;++S){if(c[S])continue;const O=t.outerEdges[S],A=t.innerEdges[S];let I=0,M=0;const k=O.count,L=A.count;xe(L===o-1);const D=S===1||S===2,U=D?1:2,X=D?2:1,W=O.index0,G=O.stride,Y=A.index0,P=A.stride;for(;I<k-1||M<L-1;){const V=Y+M*P,z=W+I*G,H=I<k-1,Z=M<L-1,J=H&&(!Z||(H?0+o*(I+.5)/(k-1):0)<=(Z?1+w*(M+.5)/(L-1):0));J?++I:++M;const re=J?z+G:V+P;y[_]=V,y[_+U]=z,y[_+X]=re,_+=3}}})(),xe(_===3*(l+h)*f);const T=S=>{const O=t.outerEdges[S.connectedOuterEdgeOffset];let A=O.getVertexIndex(0),I=O.stride;for(let M=0;M<S.latitudeResolution;++M){const k=M===0?S.rowOffset:A+e;for(let L=0;L<o;L++){const D=k+L;y[_]=A,y[_+1]=A+1,y[_+2]=D,M<S.latitudeResolution-1?(y[_+3]=A+1,y[_+4]=D+1,y[_+5]=D,_+=6):_+=3,A+=I}A=k,I=1}};r.forEach(T)}xe(_===m),t.indices=y,t.indexCount=m}function t3e(t,e){const r=t.localOrigin,i=t.geometry,s=t.geometryState.neighborData.edgeResolutions,n=i.numVerticesPerSide-2,o=i.vertexAttributes;let a=e;for(let l=0;l<4;++l){{const c=l===0||l===2,h=(l===0?n-1:0)*n+(l===1?n-1:0),p=(c?0:1)*n+(c?1:0);i.innerEdges[l]=new ple(o,r,h,p,n)}{const c=a,h=s[l]+1;i.outerEdges[l]=new ple(o,r,c,1,h),a+=h}}}function r3e(t,e,r){const i=(e+2)%4,s=t.geometryState,n=t.tile,o=s.neighborData,a=n.level-r.level,l=e===1||e===3,c=o.edgeResolutions[e];xe(Xb(c));const h=c+1,p=t.geometry,f=p.boundingBox,m=p.outerEdges[e],y=p.uvRange[0],_=p.uvRange[1],v=p.uvRange[2],w=p.uvRange[3],x=ge(e===1?1:0,y,v),T=ge(e===0?1:0,_,w),S=r.renderData,O=S.geometryState,A=S.geometry.outerEdges[i],I=n.getNeighborEdgeStartVertexIndex(e,r)*c,M=c*2**a;xe(O.neighborData.edgeResolutions[i]===M),xe(A.count-1===M);const k=S.localOrigin[0]-t.localOrigin[0],L=S.localOrigin[1]-t.localOrigin[1],D=S.localOrigin[2]-t.localOrigin[2],U=m.attributes,X=m.index0,W=m.stride,G=U.position.typedBuffer,Y=U.position.typedBufferStride,P=U.normalCompressed.typedBuffer,V=U.normalCompressed.typedBufferStride,z=U.uv0,H=A.attributes,Z=A.index0,J=A.stride,re=H.position.typedBuffer,ye=H.position.typedBufferStride,Ne=H.normalCompressed.typedBuffer,yt=H.normalCompressed.typedBufferStride;for(let Ot=1;Ot<h-1;++Ot){const lt=X+W*Ot,_t=Z+J*(I+Ot),_e=lt*Y,Ae=_t*ye,xt=re[Ae]+k,ve=re[Ae+1]+L,Be=re[Ae+2]+D;G[_e]=xt,G[_e+1]=ve,G[_e+2]=Be,Th(xt,ve,Be,f);const qe=lt*V,ft=_t*yt;P[qe]=Ne[ft],P[qe+1]=Ne[ft+1];const ct=Ot/c,Ge=l?x:ge(ct,y,v),vt=l?ge(ct,_,w):T;rp(z,lt,Ge,vt)}}function i3e(t){const e=t.geometryState,r=e.neighborData,i=t.localOrigin,s=r.cornerNeighborData,n=t.geometry,o=n.outerEdges,a=n.boundingBox,l=t.tile,c=t.tile.surface.view?.viewingMode==="local",h=l.ellipsoid.radius,p=l.extentInRadians,f=l.horizontalScale;let m=0,y=0,_=0;const v=(_e,Ae,xt)=>{const ve=p[Ae===0?1:3],Be=p[_e===0?0:2],qe=Math.cos(ve),ft=Math.sin(ve),ct=Math.sin(Be),Ge=Math.cos(Be),vt=h+xt;m=Ge*qe*vt,y=ct*qe*vt,_=ft*vt},w=c?(()=>{const _e=t.geometryState.clippingArea,Ae=l.extent,xt=_e!=null&&(Ae[3]>_e[3]||Ae[2]>_e[2]||Ae[1]<_e[1]||Ae[0]<_e[0]),ve=KAe(l.surface.isWebMercatorOnPlateeCarree,l.ellipsoid.radius,f);return(Be,qe,ft)=>{const ct=Be===0?X[0]:X[2],Ge=qe===0?X[1]:X[3],vt=xt?ge(ct,_e[0],_e[2]):ct,cr=xt?ge(Ge,_e[1],_e[3]):Ge,rr=ft;m=vt*f,y=ve(cr),_=rr}})():v;let x=0,T=0,S=0,O=0,A=0,I=0,M=0,k=0,L=0;const D=c&&t.tile.surface.isWebMercatorOnPlateeCarree,U=(_e,Ae,xt,ve,Be)=>{let qe=0,ft=0,ct=0;if(c){const Ge=Ae*f,vt=D?(Math.PI/2-2*Math.atan(Math.exp(-xt/h)))*h:xt*f;qe=Ge-m,ft=vt-y,ct=ve-_}else{const Ge=$J(_e),vt=_e.tile,cr=vt.extent,rr=vt.extentInRadians,fi=(Ae-cr[0])/(cr[2]-cr[0]),rt=(xt-cr[1])/(cr[3]-cr[1]),it=rr[0]*(1-fi)+rr[2]*fi,mt=Ge(rt),Yt=Math.cos(mt),ir=Math.sin(mt),Hr=Math.sin(it),mi=Math.cos(it),Jt=h+ve;qe=mi*Yt*Jt-m,ft=Hr*Yt*Jt-y,ct=ir*Jt-_}switch(Be){case 0:M+=qe,k+=ft,L+=ct;break;case 1:O-=qe,A-=ft,I-=ct;break;case 2:M-=qe,k-=ft,L-=ct;break;case 3:O+=qe,A+=ft,I+=ct}},X=l.extent,W=e.clippingArea,G=W??LJ,Y=X[0],P=X[2],V=X[1],z=X[3],H=[z>G[3],P>G[2],V<G[1],Y<G[0]],Z=Math.max(Y,G[0]),J=Math.min(P,G[2]),re=Math.max(V,G[1]),ye=Math.min(z,G[3]),Ne=n.uvRange[0],yt=n.uvRange[1],Ot=n.uvRange[2],lt=n.uvRange[3],_t=_e=>{const Ae=s[_e].cornerTiles;x=0,T=0,S=1,O=0,A=0,I=0,M=0,k=0,L=0;let xt=1/0;for(let Ge=0;Ge<4;++Ge)xt=Math.min(xt,Ae[Ge]?.level??1/0);for(let Ge=0;Ge<4;++Ge){const vt=Ae[Ge];PC[Ge]=vt?.level===xt?vt:null}let ve=1,Be=0;for(let Ge=0;Ge<4;++Ge){const vt=PC[Ge];vt&&(ve=Math.max(ve,vt?.renderData.geometryState.numVerticesPerSide),Be=vt.extent[2]-vt.extent[0])}const qe=Be,ft=ve;xe(ft>1);const ct=qe/ft;for(let Ge=0;Ge<4;++Ge){const vt=PC[(Ge+3)%4],cr=PC[Ge%4];if(!vt&&!cr)continue;const rr=Ge===0?1:Ge===1?2:Ge===2?3:0,fi=Ge===0?2:Ge===1?3:Ge===2?0:1;if(vt&&cr){const rt=ok[Ge][0]*ct,it=ok[Ge][1]*ct,mt=vt.extent,Yt=mt[rr===0||rr===1?2:0]+rt,ir=mt[rr===0||rr===3?3:1]+it,Hr=cr.extent,mi=Hr[fi===0||fi===1?2:0]+rt,Jt=Hr[fi===0||fi===3?3:1]+it,gi=vt.renderData,Di=cr.renderData,zr=Wi(Yt,ir,gi.geometryState.samplerData),xr=Wi(mi,Jt,Di.geometryState.samplerData);U(gi,Yt,ir,.5*(zr+xr),Ge)}else{const rt=vt??cr,it=vt?rr:fi,mt=rt.extent,Yt=ok[Ge],ir=mt[it===0||it===1?2:0]+Yt[0]*ct,Hr=mt[it===0||it===3?3:1]+Yt[1]*ct,mi=rt.renderData,Jt=Wi(ir,Hr,mi.geometryState.samplerData);U(mi,ir,Hr,Jt,Ge)}}if(!c){const Ge=Math.sqrt(m*m+y*y+_*_);x=m/Ge,T=y/Ge,S=_/Ge}if(c||S*S<.999){const Ge=Math.sqrt(O*O+A*A+I*I);O/=Ge,A/=Ge,I/=Ge;const vt=Math.sqrt(M*M+k*k+L*L);M/=vt,k/=vt,L/=vt,x=I*k-A*L,T=O*L-I*M,S=A*M-O*k;const cr=1/Math.sqrt(x*x+T*T+S*S);x*=cr,T*=cr,S*=cr}};for(let _e=0;_e<4;++_e){const Ae=_e,xt=(_e+1)%4,ve=_e===0||_e===1?1:0,Be=_e===0||_e===3?1:0,qe=ge(ve,Ne,Ot),ft=ge(Be,yt,lt),ct=o[Ae],Ge=_e===0||_e===3?ct.count-1:0,vt=o[xt],cr=_e===0||_e===1?vt.count-1:0,rr=s[_e].cornerTiles;let fi=-1;for(let mt=0;mt<4;++mt){const Yt=rr[mt];Yt&&(fi===-1||Og(rr[fi],Yt)>0)&&(fi=mt)}const rt=fi,it=rr[rt];if(it!==l){const mt=l.level-it.level,Yt=2**mt,ir=[it.lij[0]+mt,it.lij[1]*Yt,it.lij[2]*Yt],Hr=[ir[1]+Yt===l.lij[1],_e===0&&(rt===1||rt===0&&it!==rr[3])||_e===1&&(rt===0||rt===1&&it!==rr[2]),ir[1]===l.lij[1]+1,_e===2&&(rt===3||rt===2&&it!==rr[1])||_e===3&&(rt===2||rt===3&&it!==rr[0])],mi=Hr.reduce((xr,Bi)=>xr+(Bi?1:0),0);xe(mi===1||mi===2);let Jt=-1,gi=-1;const Di=it.renderData;if(mi===1){const xr=Hr.findIndex(ys=>ys);xe(0<=xr&&xr<=3),Jt=(xr+2)%4;const Bi=t.geometryState.neighborData.edgeResolutions[xr];gi=l.getNeighborEdgeStartVertexIndex(xr,it)*Bi+Bi*(xr===0&&_e===0||xr===1&&_e===0||xr===2&&_e===1||xr===3&&_e===3?1:0)}else{xe(Hr[1]||Hr[3]),Jt=Hr[1]?3:1;const xr=Di.geometryState.neighborData.edgeResolutions[Jt];gi=_e===0||_e===3?0:xr}const zr=Di.geometry.outerEdges[Jt];{const xr=ct.index0+Ge*ct.stride,Bi=vt.index0+cr*vt.stride,ys=zr.index0+gi*zr.stride;{const Mr=zr.attributes.position,ti=Mr.typedBuffer,qr=ys*Mr.typedBufferStride,fr=t.localOrigin,ai=zr.localOrigin,zs=ti[qr]+ai[0]-fr[0],Kn=ti[qr+1]+ai[1]-fr[1],eo=ti[qr+2]+ai[2]-fr[2];Th(zs,Kn,eo,a);{const mn=ct.attributes.position,gn=mn.typedBuffer,Gi=xr*mn.typedBufferStride;gn[Gi]=zs,gn[Gi+1]=Kn,gn[Gi+2]=eo}{const mn=vt.attributes.position,gn=mn.typedBuffer,Gi=Bi*mn.typedBufferStride;gn[Gi]=zs,gn[Gi+1]=Kn,gn[Gi+2]=eo}}rp(ct.attributes.uv0,xr,qe,ft),rp(vt.attributes.uv0,Bi,qe,ft);{const Mr=zr.attributes.normalCompressed.typedBuffer,ti=ys*zr.attributes.normalCompressed.typedBufferStride;{const qr=ct.attributes.normalCompressed,fr=qr.typedBuffer,ai=xr*qr.typedBufferStride;fr[ai]=Mr[ti],fr[ai+1]=Mr[ti+1]}{const qr=vt.attributes.normalCompressed,fr=qr.typedBuffer,ai=Bi*qr.typedBufferStride;fr[ai]=Mr[ti],fr[ai+1]=Mr[ti+1]}}}}else{const mt=H[Ae],Yt=H[xt];let ir;if(mt||Yt){const gi=ge(Y*(1-ve)+P*ve,Z,J),Di=ge(V*(1-Be)+z*Be,re,ye),zr=e.samplerData;ir=Wi(gi,Di,zr)}else ir=j0t(rr);w(ve,Be,ir),_t(_e);const Hr=m-i[0],mi=y-i[1],Jt=_-i[2];Th(Hr,mi,Jt,a),ct.setVertexFromValuesRawPositionUVNormal(Ge,Hr,mi,Jt,qe,ft,x,T,S),vt.setVertexFromValuesRawPositionUVNormal(cr,Hr,mi,Jt,qe,ft,x,T,S)}}for(let _e=0;_e<4;++_e)PC[_e]=null}function j0t(t){const e=t.reduce((n,o)=>Math.min(n,o?.level??1/0),1/0);ln&&(xe(!t[0]||!t[2]||FH(t[0],t[2],nt.SOUTH_WEST)),xe(!t[1]||!t[3]||FH(t[1],t[3],nt.NORTH_WEST)));let r=0,i=0;for(let n=0;n<4;++n){const o=t[n];if(o&&o.level===e){const a=n===0||n===1,l=n===0||n===3,c=o.extent,h=c[a?0:2],p=c[l?1:3],f=o.renderData?.geometryState?.samplerData;i+=Wi(h,p,f),r++}}const s=r?i/r:0;return xe(s!=null),s}function $6(t){const e=t.vao,r=t.geometry.vertexAttributes.position.typedBuffer;e.vertexBuffers.geometry.setSubData(r,0,0,r.length)}const ok=[[0,1],[1,0],[0,-1],[-1,0]],ho=new Pyt,LJ=aW(-1/0,-1/0,1/0,1/0),PC=[null,null,null,null];function s3e(t,e,r){if(!e)return!1;const i=Og(t,e);return i>0||i===0&&r>=2}let H0t=class extends RJ{get horizontalScale(){return this._horizontalScaleFactor}constructor(e,r,i){super(),this._horizontalScaleFactor=1,this._extentInRenderSR=Ut(),e!==void 0&&this.init(e,r,i)}init(e,r,i){super.init(e,r,i);const s=i.view.renderSpatialReference,n=i.spatialReference,o=s!=null&&bO(s)&&n!=null&&n.isGeographic?this.ellipsoid.radius*Math.PI/180:1;this._horizontalScaleFactor=o;const a=this.surface.isWebMercatorOnPlateeCarree,l=this._extentInRenderSR,c=this.extent;if(a){const h=Oe(c[0],c[1],0);Ws(h,je.WebMercator,h,je.PlateCarree);const p=Oe(c[2],c[3],0);Ws(p,je.WebMercator,p,je.PlateCarree),l[0]=h[0],l[1]=h[1],l[2]=p[0],l[3]=p[1]}else for(let h=0;h<4;++h)l[h]=c[h]*o;this.centerAtSeaLevel[0]=.5*(l[0]+l[2]),this.centerAtSeaLevel[1]=.5*(l[1]+l[3]),this.centerAtSeaLevel[2]=0,this._edgeLen=Math.max(l[2]-l[0],l[3]-l[1]),this._edgeLen2=this._edgeLen*this._edgeLen,this.updateRadiusAndCenter()}updateRadiusAndCenter(){this._updateCenter();const e=this._extentInRenderSR,r=.5*(e[2]-e[0]),i=.5*(e[3]-e[1]),s=Math.sqrt(r*r+i*i),n=.5*(this.elevationBounds[0]-this.elevationBounds[1]),o=Math.max(s,n);this._center[Fs.MIDDLE][3]=o}_calculateFrustumVisibilityStatus(e){const r=this._aabb(),i=r[0],s=r[1],n=r[2],o=r[3],a=r[4],l=r[5];let c=!0;for(let h=0;h<6;h++){const p=e[h],f=p[0],m=p[1],y=p[2],_=p[3];if(f*(f>0?i:o)+m*(m>0?s:a)+y*(y>0?n:l)+_>=0)return ra.OUTSIDE;c=c&&f*(f<0?i:o)+m*(m<0?s:a)+y*(y<0?n:l)+_<=0}return c?ra.INSIDE:ra.INTERSECTS}_aabb(){const e=this._extentInRenderSR;return q6e(e[0],e[1],this.elevationBounds[0],e[2],e[3],this.elevationBounds[1])}intersectsRay(e,r,i,s){return d$[0]=1/r[0],d$[1]=1/r[1],d$[2]=1/r[2],EY(this._aabb(),e,d$,i,s)}createGeometry(){U0t(this.renderData,this._horizontalScaleFactor),this.setMemoryDirty()}getDefaultVerticesPerSide(){return this.level<9?3:2}updateCornerElevations(){V0t(this.renderData,this._horizontalScaleFactor)}updateEdgeElevations(){z0t(this.renderData,this._horizontalScaleFactor)}};const d$=C();let q0t=class{constructor(){this.extent=Wt(),this.minLevel=0,this.maxLevel=0,this.callback=null}},bD=class extends Te{constructor(){super(...arguments),this._queries=new kt({initialSize:10}),this._queriesInvPtr=0,this._queryQueue=new kt({initialSize:30}),this._queryPool=new Vo(q0t)}queryVisibleLevelRange(e,r,i,s){const n=this._queryPool.acquire();mh(n.extent,e),n.minLevel=r??-Number.MAX_VALUE,n.maxLevel=i??Number.MAX_VALUE,n.callback=s,this._queryQueue.push(n),this.notifyChange("updating")}get updating(){return this._queryQueue.length!==0}prepare(){for(;this._queries.length<this._queries.data.length&&this._queryQueue.length>0;){const e=this._queryQueue.pop();this._queries.push(e)}this._queriesInvPtr=this._queries.length}process(){for(let e=0;e<this._queries.length;e++){const r=this._queries.data[e];this._queryPool.release(r),r.callback(e>=this._queriesInvPtr),r.callback=null}this._queries.clear(),this.notifyChange("updating")}queriesForTile(e){const r=e.level;let i=0;for(;i<this._queriesInvPtr;){const s=this._queries.data[i],n=s.extent;r>=s.minLevel&&r<=s.maxLevel&&n[0]<=e.extent[2]&&n[2]>=e.extent[0]&&n[1]<=e.extent[3]&&n[3]>=e.extent[1]?(this._queries.swapElements(i,this._queriesInvPtr-1),this._queriesInvPtr--):i++}}};u([d()],bD.prototype,"updating",null),bD=u([R("esri.views.3d.terrain.ScaleRangeQueries")],bD);let W0t=class extends RJ{get convexHull(){return this._convexHull}constructor(e,r,i){super(),this._convexHull=new Array(24),this._boundingSphere=gs(),e!==void 0&&this.init(e,r,i)}init(e,r,i){super.init(e,r,i);const s=this.ellipsoid.radius,n=this.extentInRadians[0],o=this.extentInRadians[1],a=this.extentInRadians[2],l=this.extentInRadians[3],c=e[0],h=wt(o,l,.5),p=wt(n,a,.5),f=c===0?0:Math.min(Math.abs(o),Math.abs(l));this._edgeLen=(a-n)*Math.cos(f)*s,this._edgeLen2=this._edgeLen*this._edgeLen,this._curvatureHeight=s-Math.sqrt(s*s-this._edgeLen2/4),j_e(this.centerAtSeaLevel,p,h,this.ellipsoid.radius),me(this.up,this.centerAtSeaLevel),this.updateRadiusAndCenter()}updateRadiusAndCenter(){this._updateBoundingVolumes();const e=this._center;if(this.lij[0]===0)se(e[Fs.MIDDLE],0,0,0),se(e[Fs.TOP],0,0,0),se(e[Fs.BOTTOM],0,0,0),e[Fs.MIDDLE][3]=this.ellipsoid.radius+this.elevationBounds[1];else{this._updateCenter();const r=e[Fs.MIDDLE],i=this.convexHull;let s=0;for(let n=0;n<8;++n)s=Math.max(s,Z0t(r,i,3*n));e[Fs.MIDDLE][3]=Math.sqrt(s)}}_calculateFrustumVisibilityStatus(e){if(!a_(e,this._boundingSphere))return ra.OUTSIDE;if(this.lij[0]<10)return ra.INTERSECTS;const r=this.convexHull,i=this.surface.view.state.camera.near;let s=!0;for(let n=0;n<fE;n++){const o=n===ui.NEAR,a=e[n],l=a[0],c=a[1],h=a[2],p=a[3]-(o?i:0);let f=!1;for(let m=0;m<8;++m){const y=3*m;if(l*r[y]+c*r[y+1]+h*r[y+2]+p<0){if(f=!0,!s)break}else s=!1}if(!f)return ra.OUTSIDE}return s?ra.INSIDE:ra.INTERSECTS}computeElevationBounds(){super.computeElevationBounds(),this._updateBoundingVolumes()}createGeometry(){I0t(this.renderData,this._getPatchType()),this._updateBoundingVolumes(),this.setMemoryDirty()}_updateBoundingVolumes(){this._updateConvexHull(),this._updateBoundingSphere(),ln&&this._checkBVs()}_updateBoundingSphere(){const e=this._boundingSphere,r=e,i=this.elevationBounds,s=this.ellipsoid.radius,n=i[1];if(this.level===0)se(r,0,0,0),e[3]=s+n;else{const o=this.extentInRadians,a=.5*(o[0]+o[2]),l=o[1],c=o[3];Hv(Ale,a,l,s),Hv(Ole,a,c,s),ce(r,Ale,Ole);const h=.5*(i[0]+i[1]);te(r,r,(s+h)/Kl(r));const p=this.convexHull;let f=0;const m=(_,v)=>{const w=_[0]-p[3*v],x=_[1]-p[3*v+1],T=_[2]-p[3*v+2];return Math.sqrt(w*w+x*x+T*T)};for(let _=0;_<8;++_){const v=m(r,_);f=Math.max(f,v)}const y=f;e[3]=y+2}}_updateConvexHull(){const e=this.extentInRadians,r=this.ellipsoid.radius;if(this.level===0)return;const i=this.elevationBounds,s=this._getPatchType(),n=this.surface.isWebMercator,o=n&&s===lh.HAS_NORTH_POLE,a=n&&s===lh.HAS_SOUTH_POLE,l=a||o,c=Math.PI/2,h=e[0],p=e[2],f=a?-c:e[1],m=o?c:e[3],y=.5*(h+p),_=i[0],v=r+(l?Math.min(0,_-1):_),w=(Y,P,V)=>Hv(Y,P,V,v),x=C(),T=C(),S=C(),O=C();w(x,h,f),w(T,h,m),w(S,p,m),w(O,p,f);const A=(Y,P)=>{for(let V=0;V<3;++V)this._convexHull[3*P+V]=Y[V]};A(x,0),A(T,1),A(S,2),A(O,3);const I=i[1],M=r+(l?Math.max(0,I+1):I),k=C(),L=C(),D=C();Hv(L,y,m,v),Hv(D,y,f,v),ce(k,L,D),me(k,k);const U=C(),X=C(),W=(Y,P)=>{Cn(X,Y,P),me(X,X);const V=-fe(Y,U)/fe(X,U);xe(V>=0),te(X,X,V),ce(Y,Y,X)};if(2**this.lij[0]>2*this.lij[1]){const Y=D,P=C();at(P,Cle,Y),me(P,P),at(U,Y,P),me(U,U),xe(uh(fe(U,Y)/Kl(Y),0)),W(x,T),W(O,S),A(x,0),A(O,3)}else if(2**this.lij[0]!==2*this.lij[1]){const Y=L,P=C();at(P,Cle,Y),me(P,P),at(U,P,Y),me(U,U),W(T,x),W(S,O),A(T,1),A(S,2)}const G=(Y,P)=>{const V=M/fe(P,k);for(let z=0;z<3;++z)this._convexHull[3*Y+z]=P[z]*V};G(4,x),G(5,T),G(6,S),G(7,O)}_getPatchType(){const e=this.lij[1],r=e===0,i=e===(1<<this.level)-1;return r?i?lh.HAS_BOTH_POLES:lh.HAS_NORTH_POLE:i?lh.HAS_SOUTH_POLE:lh.REGULAR}intersectsRay(e,r,i,s){const n=this._boundingSphere,o=n[3]+i,a=r[0]*r[0]+r[1]*r[1]+r[2]*r[2],l=n[0]-e[0],c=n[1]-e[1],h=n[2]-e[2],p=(l*r[0]+c*r[1]+h*r[2])/a,f=r[0]*p-l,m=r[1]*p-c,y=r[2]*p-h;return f*f+m*m+y*y<o*o}getDefaultVerticesPerSide(){return this.level<Ele.length?Ele[this.level]+1:2}updateCornerElevations(){D0t(this.renderData),this._updateBoundingVolumes()}updateEdgeElevations(){L0t(this.renderData),this._updateBoundingVolumes()}_checkBVs(){if(!ln||this.level<=2)return;const e=this._boundingSphere,r=e[3],i=e,s=C(),n=this.ellipsoid.radius,o=this.elevationBounds;o[1],o[0];const a=n+o[0],l=1,c=0,h=this._center[Fs.MIDDLE][3],p=this.convexHull,f=(ve,Be)=>{for(let qe=0;qe<3;++qe)ve[qe]=p[3*Be+qe]};{const ve=C(),Be=C(),qe=C(),ft=C(),ct=C(),Ge=(vt,cr,rr,fi)=>{f(Be,vt),f(qe,cr),f(ft,rr),Cn(Be,Be,qe),Cn(ft,ft,qe),at(ve,Be,ft),me(ve,ve);const rt=fe(ve,qe);f(ct,fi);const it=fe(ve,ct),mt=Math.abs(it-rt);xe(uh(mt,0),`Non coplanar ${vt},${cr},${rr},${fi} diff = ${mt}`)};Ge(0,1,2,3),Ge(4,5,6,7),Ge(0,1,4,5),Ge(1,2,5,6),Ge(2,3,6,7),Ge(3,0,7,4)}const m=Bo(24),y=(ve,Be,qe)=>{const ft=4*ve;for(let ct=0;ct<3;++ct)m[ft+ct]=Be[ct];m[ft+3]=qe},_=C(),v=C(),w=C(),x=C(),T=(ve,Be,qe,ft)=>{f(_,Be),f(v,qe),f(w,ft),Cn(_,_,v),me(_,_),Cn(w,w,v),me(w,w),at(x,_,w),me(x,x);const ct=fe(x,v);y(ve,x,ct)};T(0,0,1,2),T(1,1,0,4),T(2,1,5,2),T(3,3,2,6),T(4,4,0,3),T(5,4,6,5);const S=1,O=(ve,Be,qe,ft)=>{const ct=4*ve;return m[ct]*Be+m[ct+1]*qe+m[ct+2]*ft-m[ct+3]},A=(ve,Be,qe,ft)=>O(ve,Be,qe,ft)>=-S,I=(ve,Be)=>A(ve,Be[0],Be[1],Be[2]),M=2**this.lij[0]>2*this.lij[1],k=(ve,Be,qe)=>Math.sqrt(n3e(ve,Be,qe,i[0],i[1],i[2]))<r,L=ve=>k(ve[0],ve[1],ve[2]),D=(ve,Be)=>k(ve[Be],ve[Be+1],ve[Be+2]),U=this.extentInRadians,X=.5*(U[0]+U[2]),W=U[1],G=U[3],Y=C(),P=C();Hv(Y,X,G,a),Hv(P,X,W,a);const V=M?"Upper":"Lower";let z=!0;for(let ve=0;ve<6;++ve){for(let Be=0;Be<8;++Be){const qe=3*Be,ft=A(ve,p[qe],p[qe+1],p[qe+2]);z&&(z=ft),xe(ft,`Tile[${this.lij}] Convex hull point ${Be} outside of plane ${ve}`)}xe(I(ve,P),`Tile[${this.lij}] (${V}) bottom mid outside of plane ${ve}`),xe(I(ve,Y),`Tile[${this.lij}] (${V}) top mid outside of plane ${ve}`)}xe(z,"Not all convex hull points are inside  convex hull polyhedron"),xe(L(P),`Tile[${this.lij}] (${V}) bottom mid outside of bounding sphere`),xe(L(Y),`Tile[${this.lij}] (${V}) top mid outside of bounding sphere`);for(let ve=0;ve<8;++ve){const Be=D(p,3*ve);xe(Be,`Tile[${this.lij}] Convex hull point ${ve} outside of bounding sphere`)}for(let ve=0;ve<6;++ve)for(let Be=0;Be<8;++Be){const qe=3*Be;A(ve,p[qe],p[qe+1],p[qe+2])||console.error(`Tile[${this.lij}] Convex hull point ${Be} outside of plane ${ve}`)}const H=this.extentInRadians,Z=Math.max(H[2]-H[0],H[3]-H[1]),J=Math.round(Z*n),re=this.renderData;if(!re)return;const{geometry:ye,localOrigin:Ne}=re,yt=ye.vertexAttributes?.position;if(!yt)return;const Ot=yt.count,lt=C(),_t=ye.numVerticesPerSide-2,_e=_t*_t,Ae=re.geometryState.neighborData,xt=Ae.edgeResolutions.reduce((ve,Be)=>ve+Be+1,0);for(let ve=0;ve<Ot;++ve){const Be=ve<_e,qe=!Be&&ve<_e+xt;let ft=!1,ct=-1;if(qe){let Jt=_e;for(let gi=0;gi<4;++gi){const Di=Ae.edgeResolutions[gi];if(ve===Jt||ve===Jt+Di-1){ft=!0;break}if(Jt+=Di,ve<Jt){ct=gi;break}}}const Ge=qe?Ae.edgePeerNeighbors[ct]:null,vt=qe&&Ge&&Og(this,Ge)>0;yt.getVec(ve,s),ce(lt,s,Ne);const cr=Kl(lt)-n;let rr=0,fi=!1;const rt=o[0]-cr,it=cr-o[1],mt=rt>l,Yt=it>l,ir=mt||Yt,Hr=()=>{const Jt=Be?"internal":qe&&!ft?"edge":ft?"corner":"pole";return`Tile[${this.lij}].vertex[${ve}]:${Jt}`+(mt?"(below)":Yt?"(above)":"")+(vt?"(Neighbor)":"")},mi=PR(lt,i);if(mi>=r+c){const Jt=mi-r;ir||(console.error(`${Hr()} is out of the bounding sphere by ${Jt.toFixed(0)} / ${r.toFixed(0)}[tol=${c}] h=${cr.toFixed(0)} / [${o[0].toFixed(0)}..${o[1].toFixed(0)}] (${(Jt/r).toFixed(0)})`),fi=!0)}for(let Jt=0;Jt<6;++Jt)if(!A(Jt,lt[0],lt[1],lt[2])){const gi=O(Jt,lt[0],lt[1],lt[2]),Di=ve%_t,zr=(ve-Di)/_t;Jt===0&&rt||Jt===5&&it||(console.error(`${Hr()} (${Di},${zr})|${_t}] is out of the bounding trapezoid plane ${Jt} h=${Math.round(cr)} / [${Math.round(o[0])}..${Math.round(o[1])}] dist=${Math.round(gi)} radii = ${Math.round(r)}/${Math.round(h)}} : maxL = ${J}`),++rr)}if(fi||rr>0)break}}};const Ele=[128,64,64,32,16,8,8,4];function Z0t(t,e,r){return n3e(t[0],t[1],t[2],e[r],e[r+1],e[r+2])}function n3e(t,e,r,i,s,n){const o=i-t,a=s-e,l=n-r;return o*o+a*a+l*l}const Hv=(t,e,r,i)=>{const s=Math.cos(e),n=Math.sin(e),o=Math.cos(r),a=Math.sin(r);t[0]=i*o*s,t[1]=i*o*n,t[2]=i*a},Cle=[0,0,1],Ale=C(),Ole=C();let Td=class extends Te{constructor(){super(...arguments),this.fovX=0,this.fovY=0,this.relativeWidthLimit=0,this.relativeHeightLimit=0,this.maxLod=0,this.angledSplitBias=0,this.aboveGround=!0}};u([d()],Td.prototype,"fovX",void 0),u([d()],Td.prototype,"fovY",void 0),u([d()],Td.prototype,"relativeWidthLimit",void 0),u([d()],Td.prototype,"relativeHeightLimit",void 0),u([d()],Td.prototype,"maxLod",void 0),u([d()],Td.prototype,"angledSplitBias",void 0),u([d()],Td.prototype,"aboveGround",void 0),u([d()],Td.prototype,"frustum",void 0),Td=u([R("esri.views.3d.terrain.SplitLimits")],Td);let o3e=class extends pa{constructor(){super(...arguments),this.blendMode=Pe.Normal}};u([B({count:Pe.COUNT})],o3e.prototype,"blendMode",void 0);let cO=class extends o3e{constructor(){super(...arguments),this.output=Sn.Composite,this.baseOpacityMode=Xd.NotRequired,this.premultipliedSource=Nd.Off}};u([B({count:Sn.COUNT})],cO.prototype,"output",void 0),u([B({count:Xd.COUNT})],cO.prototype,"baseOpacityMode",void 0),u([B()],cO.prototype,"premultipliedSource",void 0);var bw;function X0t(t){const e=new wr;if(e.include(kAe),t.background===bw.Only){const r=t.output===Sn.ColorComposite;return r?e.fragment.uniforms.add(new Ft("backgroundColor",i=>i.backgroundColor)):e.fragment.include(OJ),e.fragment.code.add(b`
    void main() {
      fragColor = vec4(${r?b`backgroundColor`:b`gridColor(uv)`}, 1.0);
    }
  `),e}return e.include(VAe,t),e.fragment.uniforms.add(new Je("tex",r=>r.texture)),e.fragment.uniforms.add(new Re("opacity",r=>r.opacity)),e.fragment.code.add(b`void main() {
vec4 bgColor = getBackground(uv);
fragColor = blendLayers(bgColor, texture(tex, uv), opacity);
}`),e}(function(t){t[t.BelowLayer=0]="BelowLayer",t[t.Only=1]="Only",t[t.COUNT=2]="COUNT"})(bw||(bw={}));const Y0t=Object.freeze(Object.defineProperty({__proto__:null,get BackgroundMode(){return bw},build:X0t},Symbol.toStringTag,{value:"Module"}));let J0t=class extends UAe{constructor(){super(...arguments),this.opacity=1,this.baseOpacity=1,this.texture=null,this.fboTexture=null,this.backgroundColor=ja}},a3e=class l3e extends Pr{initializeProgram(e){return new Cr(e.rctx,l3e.shader.get().build(this.configuration),br)}initializePipeline(){return At({blending:Tc(we.ONE,we.ONE_MINUS_SRC_ALPHA),colorWrite:Vt})}};a3e.shader=new Er(Y0t,()=>ae(()=>import("./BlendLayers.glsl-e3eae6ae.js"),[],import.meta.url));let c3e=class extends cO{constructor(){super(...arguments),this.background=bw.BelowLayer}};u([B()],c3e.prototype,"background",void 0);let ak=class{constructor(e,r,i,s,n,o){this.texture=e,this.type=r,e.retain(),this.offsetAndScale=Lt(i.offset[0],i.offset[1],i.scale,i.scale),this.opacities=Oe(s,n,o)}destroy(){this.texture.release()}};function wD(){return[1,0,0,1,0,0]}function Q0t(t){return[t[0],t[1],t[2],t[3],t[4],t[5]]}function K0t(t,e,r,i,s,n){return[t,e,r,i,s,n]}function e_t(t,e){return new Float64Array(t,e,6)}Object.freeze(Object.defineProperty({__proto__:null,clone:Q0t,create:wD,createView:e_t,fromValues:K0t},Symbol.toStringTag,{value:"Module"}));function t_t(t){return t instanceof Float32Array&&t.length>=2}function r_t(t){return Array.isArray(t)&&t.length>=2}function lk(t){return t_t(t)||r_t(t)}const i_t=96,s_t=39.37;function DJ(t,e){return e.type?or(t,e.x,e.y):fn(t,e)}function n_t(t){return Za(t)}function o_t(t,e){const r=t.targetGeometry,i=e.targetGeometry;return r.x=i.x,r.y=i.y,r.spatialReference=i.spatialReference,t.scale=e.scale,t.rotation=e.rotation,t}const a_t=function(){const t=Ve();return function(e,r,i){const s=r.targetGeometry;DJ(t,s);const n=.5*L6(r);return e.xmin=t[0]-n*i[0],e.ymin=t[1]-n*i[1],e.xmax=t[0]+n*i[0],e.ymax=t[1]+n*i[1],e.spatialReference=s.spatialReference,e}}();function L6(t){return t.scale*l_t(t.targetGeometry)}function l_t(t){return t!=null&&aa(t.spatialReference)?1/(n_t(t.spatialReference)*s_t*i_t):1}function c_t(t){return EF(t.rotation)||0}const NJ=function(){const t=Ve(),e=Ve(),r=Ve();return function(i,s,n,o,a,l){return ZZ(t,s),lc(e,n,.5*l),or(r,1/o*l,-1/o*l),GZ(i,e),a&&zZ(i,i,a),xve(i,i,r),BZ(i,i,t),i}}(),u_t=function(){const t=Ve();return function(e,r,i,s){const n=L6(r),o=c_t(r);return DJ(t,r.targetGeometry),NJ(e,t,i,n,o,s)}}(),h_t=function(){const t=Ve();return function(e,r,i,s){const n=L6(r);return DJ(t,r.targetGeometry),NJ(e,t,i,n,0,s)}}();function d_t(t){const e=d_(t);return e?e.valid[1]-e.valid[0]:0}function p_t(t,e){return Math.round(d_t(t)/e)}var kH;const Sm=[0,0];let E0=kH=class extends de{constructor(t){super(t),this._viewpoint2D={center:Ve(),rotation:0,scale:0,spatialReference:void 0},this.center=[0,0],this.extent=new _r,this.id=0,this.inverseTransform=wD(),this.resolution=0,this.rotation=0,this.scale=0,this.transform=wD(),this.transformNoRotation=wD(),this.displayMat3=El(),this.displayViewMat3=El(),this.viewMat3=El(),this.viewMat2d=_ve(),this.worldScreenWidth=0,this.size=[0,0]}set pixelRatio(t){this._set("pixelRatio",t),this._update()}set size(t){this._set("size",t),this._update()}set viewpoint(t){if(t){const e=this._viewpoint2D,r=t.targetGeometry;e.center[0]=r.x,e.center[1]=r.y,e.rotation=t.rotation,e.scale=t.scale,e.spatialReference=r.spatialReference}this._update()}copy(t){const e=this.size,r=this.viewpoint;return r&&e?(this.viewpoint=o_t(r,t.viewpoint),this._set("size",fn(e,t.size))):(this.viewpoint=t.viewpoint.clone(),this._set("size",[t.size[0],t.size[1]])),this._set("pixelRatio",t.pixelRatio),this}clone(){return new kH({size:this.size,viewpoint:this.viewpoint.clone(),pixelRatio:this.pixelRatio})}toMap(t,e,r){return lk(e)?T1(t,e,this.inverseTransform):(Sm[0]=e,Sm[1]=r,T1(t,Sm,this.inverseTransform))}toScreen(t,e,r){return lk(e)?T1(t,e,this.transform):(Sm[0]=e,Sm[1]=r,T1(t,Sm,this.transform))}toScreenNoRotation(t,e,r){return lk(e)?T1(t,e,this.transformNoRotation):(Sm[0]=e,Sm[1]=r,T1(t,Sm,this.transformNoRotation))}getScreenTransform(t,e){const{center:r}=this._viewpoint2D,i=this._get("pixelRatio")||1,s=this._get("size");return NJ(t,r,s,e,0,i),t}_update(){const{center:t,spatialReference:e,scale:r,rotation:i}=this._viewpoint2D,s=this._get("pixelRatio")||1,n=this._get("size"),o=new lp({targetGeometry:new pt(t[0],t[1],e),scale:r,rotation:i});if(this._set("viewpoint",o),!n||!e||!r)return;this.resolution=L6(o),this.rotation=i,this.scale=r,this.spatialReference=e,fn(this.center,t);const a=n[0]!==0?2/n[0]:0,l=n[1]!==0?-2/n[1]:0;KZ(this.displayMat3,a,0,0,0,l,0,-1,1,1);const c=eX(this.viewMat3),h=ch(n[0]/2,n[1]/2),p=ch(-n[0]/2,-n[1]/2),f=EF(i);HN(c,c,h),tX(c,c,f),HN(c,c,p),g2(this.displayViewMat3,this.displayMat3,c);const m=GZ(this.viewMat2d,h);return zZ(m,m,f),BZ(m,m,p),a_t(this.extent,o,n),u_t(this.transform,o,n,s),bve(this.inverseTransform,this.transform),h_t(this.transformNoRotation,o,n,s),this.worldScreenWidth=p_t(this.spatialReference,this.resolution),this._set("id",this.id+1),this}};u([d({readOnly:!0})],E0.prototype,"id",void 0),u([d({value:1,json:{write:!0}})],E0.prototype,"pixelRatio",null),u([d({json:{write:!0}})],E0.prototype,"size",null),u([d()],E0.prototype,"spatialReference",void 0),u([d({type:lp,json:{write:!0}})],E0.prototype,"viewpoint",null),E0=kH=u([R("esri.views.2d.ViewState")],E0);const f_t=E0;var VH,zH,Rle,Ple,Mle,Ile,$le,Lle,Dle,Nle,Fle,Ule,kle,Vle,zle,Ble,Gle,jle,Hle,qle,Wle,Zle,Xle,Yle,Jle,Qle,Kle,ece,tce,rce,ice,sce,nce,oce,ace,lce,cce,uce,hce,dce,pce,fce,mce,gce,yce,_ce,vce,bce,wce,xce,Tce,Sce,Ece,Cce,Ace,Oce,Rce,Pce,Mce,Ice,$ce;(function(t){t[t.BUTT=0]="BUTT",t[t.ROUND=1]="ROUND",t[t.SQUARE=2]="SQUARE",t[t.UNKNOWN=4]="UNKNOWN"})(VH||(VH={})),function(t){t[t.BEVEL=0]="BEVEL",t[t.ROUND=1]="ROUND",t[t.MITER=2]="MITER",t[t.UNKNOWN=4]="UNKNOWN"}(zH||(zH={})),function(t){t[t.SCREEN=0]="SCREEN",t[t.MAP=1]="MAP"}(Rle||(Rle={})),function(t){t[t.Tint=0]="Tint",t[t.Ignore=1]="Ignore",t[t.Multiply=99]="Multiply"}(Ple||(Ple={})),function(t){t.Both="Both",t.JustBegin="JustBegin",t.JustEnd="JustEnd",t.None="None"}(Mle||(Mle={})),function(t){t[t.Mosaic=0]="Mosaic",t[t.Centered=1]="Centered"}(Ile||(Ile={})),function(t){t[t.Normal=0]="Normal",t[t.Superscript=1]="Superscript",t[t.Subscript=2]="Subscript"}($le||($le={})),function(t){t[t.MSSymbol=0]="MSSymbol",t[t.Unicode=1]="Unicode"}(Lle||(Lle={})),function(t){t[t.Unspecified=0]="Unspecified",t[t.TrueType=1]="TrueType",t[t.PSOpenType=2]="PSOpenType",t[t.TTOpenType=3]="TTOpenType",t[t.Type1=4]="Type1"}(Dle||(Dle={})),function(t){t[t.Display=0]="Display",t[t.Map=1]="Map"}(Nle||(Nle={})),function(t){t.None="None",t.Loop="Loop",t.Oscillate="Oscillate"}(Fle||(Fle={})),function(t){t[t.Z=0]="Z",t[t.X=1]="X",t[t.Y=2]="Y"}(Ule||(Ule={})),function(t){t[t.XYZ=0]="XYZ",t[t.ZXY=1]="ZXY",t[t.YXZ=2]="YXZ"}(kle||(kle={})),function(t){t[t.Rectangle=0]="Rectangle",t[t.RoundedRectangle=1]="RoundedRectangle",t[t.Oval=2]="Oval"}(Vle||(Vle={})),function(t){t[t.None=0]="None",t[t.Alpha=1]="Alpha",t[t.Screen=2]="Screen",t[t.Multiply=3]="Multiply",t[t.Add=4]="Add"}(zle||(zle={})),function(t){t[t.TTB=0]="TTB",t[t.RTL=1]="RTL",t[t.BTT=2]="BTT"}(Ble||(Ble={})),function(t){t[t.None=0]="None",t[t.SignPost=1]="SignPost",t[t.FaceNearPlane=2]="FaceNearPlane"}(Gle||(Gle={})),function(t){t[t.Float=0]="Float",t[t.String=1]="String",t[t.Boolean=2]="Boolean"}(jle||(jle={})),function(t){t[t.Intersect=0]="Intersect",t[t.Subtract=1]="Subtract"}(Hle||(Hle={})),function(t){t.OpenEnded="OpenEnded",t.Block="Block",t.Crossed="Crossed"}(qle||(qle={})),function(t){t.FullGeometry="FullGeometry",t.PerpendicularFromFirstSegment="PerpendicularFromFirstSegment",t.ReversedFirstSegment="ReversedFirstSegment",t.PerpendicularToSecondSegment="PerpendicularToSecondSegment",t.SecondSegmentWithTicks="SecondSegmentWithTicks",t.DoublePerpendicular="DoublePerpendicular",t.OppositeToFirstSegment="OppositeToFirstSegment",t.TriplePerpendicular="TriplePerpendicular",t.HalfCircleFirstSegment="HalfCircleFirstSegment",t.HalfCircleSecondSegment="HalfCircleSecondSegment",t.HalfCircleExtended="HalfCircleExtended",t.OpenCircle="OpenCircle",t.CoverageEdgesWithTicks="CoverageEdgesWithTicks",t.GapExtentWithDoubleTicks="GapExtentWithDoubleTicks",t.GapExtentMidline="GapExtentMidline",t.Chevron="Chevron",t.PerpendicularWithArc="PerpendicularWithArc",t.ClosedHalfCircle="ClosedHalfCircle",t.TripleParallelExtended="TripleParallelExtended",t.ParallelWithTicks="ParallelWithTicks",t.Parallel="Parallel",t.PerpendicularToFirstSegment="PerpendicularToFirstSegment",t.ParallelOffset="ParallelOffset",t.OffsetOpposite="OffsetOpposite",t.OffsetSame="OffsetSame",t.CircleWithArc="CircleWithArc",t.DoubleJog="DoubleJog",t.PerpendicularOffset="PerpendicularOffset",t.LineExcludingLastSegment="LineExcludingLastSegment",t.MultivertexArrow="MultivertexArrow",t.CrossedArrow="CrossedArrow",t.ChevronArrow="ChevronArrow",t.ChevronArrowOffset="ChevronArrowOffset",t.PartialFirstSegment="PartialFirstSegment",t.Arch="Arch",t.CurvedParallelTicks="CurvedParallelTicks",t.Arc90Degrees="Arc90Degrees"}(Wle||(Wle={})),function(t){t.Mitered="Mitered",t.Bevelled="Bevelled",t.Rounded="Rounded",t.Square="Square",t.TrueBuffer="TrueBuffer"}(Zle||(Zle={})),function(t){t.ClosePath="ClosePath",t.ConvexHull="ConvexHull",t.RectangularBox="RectangularBox"}(Xle||(Xle={})),function(t){t.BeginningOfLine="BeginningOfLine",t.EndOfLine="EndOfLine"}(Yle||(Yle={})),function(t){t.Mitered="Mitered",t.Bevelled="Bevelled",t.Rounded="Rounded",t.Square="Square"}(Jle||(Jle={})),function(t){t.Fast="Fast",t.Accurate="Accurate"}(Qle||(Qle={})),function(t){t.BeginningOfLine="BeginningOfLine",t.EndOfLine="EndOfLine"}(Kle||(Kle={})),function(t){t.Sinus="Sinus",t.Square="Square",t.Triangle="Triangle",t.Random="Random"}(ece||(ece={})),function(t){t[t.None=0]="None",t[t.Default=1]="Default",t[t.Force=2]="Force"}(tce||(tce={})),function(t){t[t.Buffered=0]="Buffered",t[t.Left=1]="Left",t[t.Right=2]="Right",t[t.AlongLine=3]="AlongLine"}(rce||(rce={})),function(t){t[t.Linear=0]="Linear",t[t.Rectangular=1]="Rectangular",t[t.Circular=2]="Circular",t[t.Buffered=3]="Buffered"}(ice||(ice={})),function(t){t[t.Discrete=0]="Discrete",t[t.Continuous=1]="Continuous"}(sce||(sce={})),function(t){t[t.AcrossLine=0]="AcrossLine",t[t.AloneLine=1]="AloneLine"}(nce||(nce={})),function(t){t[t.Left=0]="Left",t[t.Right=1]="Right",t[t.Center=2]="Center",t[t.Justify=3]="Justify"}(oce||(oce={})),function(t){t[t.Base=0]="Base",t[t.MidPoint=1]="MidPoint",t[t.ThreePoint=2]="ThreePoint",t[t.FourPoint=3]="FourPoint",t[t.Underline=4]="Underline",t[t.CircularCW=5]="CircularCW",t[t.CircularCCW=6]="CircularCCW"}(ace||(ace={})),function(t){t.Butt="Butt",t.Round="Round",t.Square="Square"}(lce||(lce={})),function(t){t.NoConstraint="NoConstraint",t.HalfPattern="HalfPattern",t.HalfGap="HalfGap",t.FullPattern="FullPattern",t.FullGap="FullGap",t.Custom="Custom"}(cce||(cce={})),function(t){t[t.None=-1]="None",t[t.Custom=0]="Custom",t[t.Circle=1]="Circle",t[t.OpenArrow=2]="OpenArrow",t[t.ClosedArrow=3]="ClosedArrow",t[t.Diamond=4]="Diamond"}(uce||(uce={})),function(t){t[t.ExtraLeading=0]="ExtraLeading",t[t.Multiple=1]="Multiple",t[t.Exact=2]="Exact"}(hce||(hce={})),function(t){t.Bevel="Bevel",t.Round="Round",t.Miter="Miter"}(dce||(dce={})),function(t){t[t.Default=0]="Default",t[t.String=1]="String",t[t.Numeric=2]="Numeric"}(pce||(pce={})),function(t){t[t.InsidePolygon=0]="InsidePolygon",t[t.PolygonCenter=1]="PolygonCenter",t[t.RandomlyInsidePolygon=2]="RandomlyInsidePolygon"}(fce||(fce={})),function(t){t[t.Tint=0]="Tint",t[t.Replace=1]="Replace",t[t.Multiply=2]="Multiply"}(mce||(mce={})),function(t){t[t.ClipAtBoundary=0]="ClipAtBoundary",t[t.RemoveIfCenterOutsideBoundary=1]="RemoveIfCenterOutsideBoundary",t[t.DoNotTouchBoundary=2]="DoNotTouchBoundary",t[t.DoNotClip=3]="DoNotClip"}(gce||(gce={})),function(t){t.NoConstraint="NoConstraint",t.WithMarkers="WithMarkers",t.WithFullGap="WithFullGap",t.WithHalfGap="WithHalfGap",t.Custom="Custom"}(yce||(yce={})),function(t){t.Fixed="Fixed",t.Random="Random",t.RandomFixedQuantity="RandomFixedQuantity"}(_ce||(_ce={})),function(t){t.LineMiddle="LineMiddle",t.LineBeginning="LineBeginning",t.LineEnd="LineEnd",t.SegmentMidpoint="SegmentMidpoint"}(vce||(vce={})),function(t){t.OnPolygon="OnPolygon",t.CenterOfMass="CenterOfMass",t.BoundingBoxCenter="BoundingBoxCenter"}(bce||(bce={})),function(t){t[t.Low=0]="Low",t[t.Medium=1]="Medium",t[t.High=2]="High"}(wce||(wce={})),function(t){t[t.MarkerCenter=0]="MarkerCenter",t[t.MarkerBounds=1]="MarkerBounds"}(xce||(xce={})),function(t){t[t.None=0]="None",t[t.PropUniform=1]="PropUniform",t[t.PropNonuniform=2]="PropNonuniform",t[t.DifUniform=3]="DifUniform",t[t.DifNonuniform=4]="DifNonuniform"}(Tce||(Tce={})),function(t){t.Tube="Tube",t.Strip="Strip",t.Wall="Wall"}(Sce||(Sce={})),function(t){t[t.Random=0]="Random",t[t.Increasing=1]="Increasing",t[t.Decreasing=2]="Decreasing",t[t.IncreasingThenDecreasing=3]="IncreasingThenDecreasing"}(Ece||(Ece={})),function(t){t[t.Relative=0]="Relative",t[t.Absolute=1]="Absolute"}(Cce||(Cce={})),function(t){t[t.Normal=0]="Normal",t[t.LowerCase=1]="LowerCase",t[t.Allcaps=2]="Allcaps"}(Ace||(Ace={})),function(t){t[t.LTR=0]="LTR",t[t.RTL=1]="RTL"}(Oce||(Oce={})),function(t){t.Draft="Draft",t.Picture="Picture",t.Text="Text"}(Rce||(Rce={})),function(t){t[t.Top=0]="Top",t[t.Center=1]="Center",t[t.Baseline=2]="Baseline",t[t.Bottom=3]="Bottom"}(Pce||(Pce={})),function(t){t[t.Right=0]="Right",t[t.Upright=1]="Upright"}(Mce||(Mce={})),function(t){t[t.Small=0]="Small",t[t.Medium=1]="Medium",t[t.Large=2]="Large"}(Ice||(Ice={})),function(t){t[t.Calm=0]="Calm",t[t.Rippled=1]="Rippled",t[t.Slight=2]="Slight",t[t.Moderate=3]="Moderate"}($ce||($ce={}));var BH,ab,GH,Q4,jH,K4,HH,lb,qH;(function(t){t[t.BACKGROUND=0]="BACKGROUND",t[t.FILL=1]="FILL",t[t.LINE=2]="LINE",t[t.SYMBOL=3]="SYMBOL",t[t.CIRCLE=4]="CIRCLE"})(BH||(BH={})),function(t){t[t.VISIBLE=0]="VISIBLE",t[t.NONE=1]="NONE"}(ab||(ab={})),function(t){t[t.POINT=0]="POINT",t[t.LINE=1]="LINE",t[t.LINE_CENTER=2]="LINE_CENTER"}(GH||(GH={})),function(t){t[t.MAP=0]="MAP",t[t.VIEWPORT=1]="VIEWPORT",t[t.AUTO=2]="AUTO"}(Q4||(Q4={})),function(t){t[t.AUTO=0]="AUTO",t[t.LEFT=1]="LEFT",t[t.CENTER=2]="CENTER",t[t.RIGHT=3]="RIGHT"}(jH||(jH={})),function(t){t[t.CENTER=0]="CENTER",t[t.LEFT=1]="LEFT",t[t.RIGHT=2]="RIGHT",t[t.TOP=3]="TOP",t[t.BOTTOM=4]="BOTTOM",t[t.TOP_LEFT=5]="TOP_LEFT",t[t.TOP_RIGHT=6]="TOP_RIGHT",t[t.BOTTOM_LEFT=7]="BOTTOM_LEFT",t[t.BOTTOM_RIGHT=8]="BOTTOM_RIGHT"}(K4||(K4={})),function(t){t[t.NONE=0]="NONE",t[t.UPPERCASE=1]="UPPERCASE",t[t.LOWERCASE=2]="LOWERCASE"}(HH||(HH={})),function(t){t[t.MAP=0]="MAP",t[t.VIEWPORT=1]="VIEWPORT"}(lb||(lb={})),function(t){t[t.HORIZONTAL=0]="HORIZONTAL",t[t.VERTICAL=1]="VERTICAL"}(qH||(qH={}));let id=class{};id.backgroundLayoutDefinition={visibility:{type:"enum",values:["visible","none"],default:ab.VISIBLE}},id.fillLayoutDefinition={visibility:{type:"enum",values:["visible","none"],default:ab.VISIBLE}},id.lineLayoutDefinition={visibility:{type:"enum",values:["visible","none"],default:ab.VISIBLE},"line-cap":{type:"enum",values:["butt","round","square"],default:VH.BUTT},"line-join":{type:"enum",values:["bevel","round","miter"],default:zH.MITER},"line-miter-limit":{type:"number",default:2},"line-round-limit":{type:"number",default:1.05}},id.symbolLayoutDefinition={visibility:{type:"enum",values:["visible","none"],default:ab.VISIBLE},"symbol-avoid-edges":{type:"boolean",default:!1},"symbol-placement":{type:"enum",values:["point","line","line-center"],default:GH.POINT},"symbol-sort-key":{type:"number",default:-1},"symbol-spacing":{type:"number",minimum:1,default:250},"icon-allow-overlap":{type:"boolean",default:!1},"icon-anchor":{type:"enum",values:["center","left","right","top","bottom","top-left","top-right","bottom-left","bottom-right"],default:K4.CENTER},"icon-ignore-placement":{type:"boolean",default:!1},"icon-image":{type:"string"},"icon-keep-upright":{type:"boolean",default:!1},"icon-offset":{type:"array",value:"number",length:2,default:[0,0]},"icon-optional":{type:"boolean",default:!1},"icon-padding":{type:"number",minimum:0,default:2},"icon-rotate":{type:"number",default:0},"icon-rotation-alignment":{type:"enum",values:["map","viewport","auto"],default:Q4.AUTO},"icon-size":{type:"number",minimum:0,default:1},"text-allow-overlap":{type:"boolean",default:!1},"text-anchor":{type:"enum",values:["center","left","right","top","bottom","top-left","top-right","bottom-left","bottom-right"],default:K4.CENTER},"text-field":{type:"string"},"text-font":{type:"array",value:"string",default:["Open Sans Regular","Arial Unicode MS Regular"]},"text-ignore-placement":{type:"boolean",default:!1},"text-justify":{type:"enum",values:["auto","left","center","right"],default:jH.CENTER},"text-keep-upright":{type:"boolean",default:!0},"text-letter-spacing":{type:"number",default:0},"text-line-height":{type:"number",default:1.2},"text-max-angle":{type:"number",minimum:0,default:45},"text-max-width":{type:"number",minimum:0,default:10},"text-offset":{type:"array",value:"number",length:2,default:[0,0]},"text-optional":{type:"boolean",default:!1},"text-padding":{type:"number",minimum:0,default:2},"text-rotate":{type:"number",default:0},"text-rotation-alignment":{type:"enum",values:["map","viewport","auto"],default:Q4.AUTO},"text-size":{type:"number",minimum:0,default:16},"text-transform":{type:"enum",values:["none","uppercase","lowercase"],default:HH.NONE},"text-writing-mode":{type:"array",value:"enum",values:["horizontal","vertical"],default:[qH.HORIZONTAL]}},id.circleLayoutDefinition={visibility:{type:"enum",values:["visible","none"],default:ab.VISIBLE}},id.backgroundPaintDefinition={"background-color":{type:"color",default:[0,0,0,1]},"background-opacity":{type:"number",minimum:0,maximum:1,default:1},"background-pattern":{type:"string"}},id.fillPaintDefinition={"fill-antialias":{type:"boolean",default:!0},"fill-color":{type:"color",default:[0,0,0,1]},"fill-opacity":{type:"number",minimum:0,maximum:1,default:1},"fill-outline-color":{type:"color",default:[0,0,0,0]},"fill-pattern":{type:"string"},"fill-translate":{type:"array",value:"number",length:2,default:[0,0]},"fill-translate-anchor":{type:"enum",values:["map","viewport"],default:lb.MAP}},id.linePaintDefinition={"line-blur":{type:"number",minimum:0,default:0},"line-color":{type:"color",default:[0,0,0,1]},"line-dasharray":{type:"array",value:"number",default:[]},"line-gap-width":{type:"number",minimum:0,default:0},"line-offset":{type:"number",default:0},"line-opacity":{type:"number",minimum:0,maximum:1,default:1},"line-pattern":{type:"string"},"line-translate":{type:"array",value:"number",length:2,default:[0,0]},"line-translate-anchor":{type:"enum",values:["map","viewport"],default:lb.MAP},"line-width":{type:"number",minimum:0,default:1}},id.symbolPaintDefinition={"icon-color":{type:"color",default:[0,0,0,1]},"icon-halo-blur":{type:"number",minimum:0,default:0},"icon-halo-color":{type:"color",default:[0,0,0,0]},"icon-halo-width":{type:"number",minimum:0,default:0},"icon-opacity":{type:"number",minimum:0,maximum:1,default:1},"icon-translate":{type:"array",value:"number",length:2,default:[0,0]},"icon-translate-anchor":{type:"enum",values:["map","viewport"],default:lb.MAP},"text-color":{type:"color",default:[0,0,0,1]},"text-halo-blur":{type:"number",minimum:0,default:0},"text-halo-color":{type:"color",default:[0,0,0,0]},"text-halo-width":{type:"number",minimum:0,default:0},"text-opacity":{type:"number",minimum:0,maximum:1,default:1},"text-translate":{type:"array",value:"number",length:2,default:[0,0]},"text-translate-anchor":{type:"enum",values:["map","viewport"],default:lb.MAP}},id.rasterPaintDefinition={"raster-opacity":{type:"number",minimum:0,maximum:1,default:1},"raster-hue-rotate":{type:"number",default:0},"raster-brightness-min":{type:"number",minimum:0,maximum:1,default:0},"raster-brightness-max":{type:"number",minimum:0,maximum:1,default:1},"raster-saturation":{type:"number",minimum:-1,maximum:1,default:0},"raster-contrast":{type:"number",minimum:-1,maximum:1,default:0},"raster-fade-duration":{type:"number",minimum:0,default:300}},id.circlePaintDefinition={"circle-blur":{type:"number",minimum:0,default:0},"circle-color":{type:"color",default:[0,0,0,1]},"circle-opacity":{type:"number",minimum:0,maximum:1,default:1},"circle-radius":{type:"number",minimum:0,default:5},"circle-stroke-color":{type:"color",default:[0,0,0,1]},"circle-stroke-opacity":{type:"number",minimum:0,maximum:1,default:1},"circle-stroke-width":{type:"number",minimum:0,default:0},"circle-translate":{type:"array",value:"number",length:2,default:[0,0]},"circle-translate-anchor":{type:"enum",values:["map","viewport"],default:lb.MAP}};const m_t=.125;let g_t=class{constructor(){this._renderParams={context:null,drawPhase:1,state:new f_t({viewpoint:new lp({targetGeometry:new pt(0,0),scale:1,rotation:0}),size:[256,256]}),stationary:!0,pixelRatio:1,displayLevel:-1,requiredLevel:-1,globalOpacity:1,renderPass:"background",styleLayer:null,styleLayerUID:-1,painter:null,glyphMosaic:null,spriteMosaic:null,profiler:null,renderingOptions:null,requestRender:null,allowDelayedRender:!1,deltaTime:-1,timeline:null,time:0,hasClipping:!1,blendMode:null,dataUploadCounter:0,effects:null,inFadeTransition:!1,requireFBO:!1,highlightGradient:null}}dispose(){this._renderParams=null}render(e,r,i,s,n,o,a,l,c,h,p){this._render(e,r,i,s,n,o,a,l,c,h,p)}renderSymbols(e,r,i,s,n,o,a,l,c,h,p){this._render(e,r,i,s,n,o,a,l,c,h,p,BH.SYMBOL)}_render(e,r,i,s,n,o,a,l,c,h,p,f){const m=r[0]-o.getLevelShift(r[0]),y=this._renderParams;y.context=e,y.painter=s,y.glyphMosaic=s.glyphMosaic,y.spriteMosaic=s.spriteMosaic,y.pixelRatio=h*p,y.displayLevel=m,y.requiredLevel=m;const _=o.getScale(r[0]),[v,w]=o.getOffset(r,a*_),x=m_t*a*_/c,T=i.transforms.dvs;T[0]=x,T[4]=-x,T[6]=-1-v-l[0]*a*2,T[7]=1+w+(1-l[1])*a*2-2,y.state.size[0]=c/p,y.state.size[1]=c/p,y.state.pixelRatio=p,i.stage||i.attachWithContext(e),i.triangleCount=0,s.drawTile(y,i,n,f)}},u3e=class h3e extends Pr{initializeProgram(e){return new Cr(e.rctx,h3e.shader.get().build(this.configuration),br)}initializePipeline(){return At({blending:Tc(we.ONE,we.ONE_MINUS_SRC_ALPHA),colorWrite:Vt})}};u3e.shader=new Er(e0t,()=>ae(()=>import("./RasterColorizer.glsl-bc8be028.js"),[],import.meta.url));let n3=class extends cO{constructor(){super(...arguments),this.colorizerType=Ub.Stretch,this.stretchType=vw.Noop,this.applyColormap=!0,this.requireBilinearWithNN=!1}};u([B({count:Ub.COUNT})],n3.prototype,"colorizerType",void 0),u([B({count:vw.COUNT})],n3.prototype,"stretchType",void 0),u([B()],n3.prototype,"applyColormap",void 0),u([B()],n3.prototype,"requireBilinearWithNN",void 0);let Lce=class{constructor(e){this._rctx=e,this._fbos=new Map}get(e){return this._getPool(e)}dispose(){this._fbos.forEach(e=>e.dispose()),this._fbos.clear()}_getPool(e){const r=this._fbos.get(e);if(r)return r;const i=new hn(this._rctx,new vr(e),new r4(js.DEPTH_COMPONENT16,e));return this._fbos.set(e,i),i}};const y_t=Q.getLogger("esri.views.3d.terrain");let __t=class{constructor(e,r){this._rctx=e,this._techniqueRepository=r,this._fbos=[],this._vectorTileHelper=new g_t,this._bindParameters=new k5(null,null,null),this._blendLayersTechniqueConfig=new c3e,this._current=0,this._lastUsedIds=new Array,this._lastCreatedBufferId=0,this._onHoldIds=new Array,this._vaoQuad=Rl(this._rctx,XR)}dispose(){this._fbos.forEach(Ue),this._fbos=null,this._vtFBO=Ue(this._vtFBO),this._vaoQuad=Ue(this._vaoQuad),this._vectorTileHelper=Ue(this._vectorTileHelper),this._backgroundTechnique=Ui(this._backgroundTechnique),this._applyOpacityTechnique=Ui(this._applyOpacityTechnique),this._blendLayersTechnique=Ui(this._blendLayersTechnique)}_getBlendLayersTechnique(e,r,i,s=Nd.Off,n=bw.BelowLayer){return this._blendLayersTechniqueConfig.output=r,this._blendLayersTechniqueConfig.blendMode=e,this._blendLayersTechniqueConfig.baseOpacityMode=i,this._blendLayersTechniqueConfig.premultipliedSource=s,this._blendLayersTechniqueConfig.background=n,this._blendLayersTechnique=this._techniqueRepository.releaseAndAcquire(a3e,this._blendLayersTechniqueConfig,this._blendLayersTechnique),this._blendLayersTechnique}drawBackground(e,r){const i=this._getBlendLayersTechnique(Pe.Normal,r?Sn.ColorComposite:Sn.GridComposite,Xd.NotRequired,Nd.Off,bw.Only),s=this._rctx.bindTechnique(i,e,this._bindParameters);this._render(s)}_render(e){this._rctx.bindVAO(this._vaoQuad),e.assertCompatibleVertexAttributeLocations(this._vaoQuad),this._rctx.drawArrays(St.TRIANGLE_STRIP,0,Fo(this._vaoQuad,"geometry"))}drawGroup(e,r,i,s,n,o=Nd.On){r===Sn.Composite&&(e.fboTexture=this._fbos[this.getLastOnHoldId()].get(i).colorTexture),e.texture=this.currentFBO(i).colorTexture,this.closeGroup(i);const a=this._getBlendLayersTechnique(s,r,n,o),l=this._rctx.bindTechnique(a,e,this._bindParameters);this._render(l)}drawRasterData(e,r,i,s,n,o=Nd.Off){if(e.texture==null)return;e.fboTexture=r===Sn.GroupBackgroundComposite||s===Pe.Normal&&n===Xd.NotRequired&&o===Nd.Off?null:this.switch(i).colorTexture;const a=this._getBlendLayersTechnique(s,r,n,o),l=this._rctx.bindTechnique(a,e,this._bindParameters);this._render(l)}drawImageryTileData(e,r,i,s,n,o){const a=o.sourceLayerInfo.data;if(!a.source||(o.tile.surface.layerViewByIndex(o.layerIndex,tr.MAP).ensureSymbolizerParameters(a),!a.bind(this._rctx)))return;e.fboTexture=s===Pe.Normal&&n===Xd.NotRequired?null:this.switch(i).colorTexture;const l=this._getRasterColorizerTechnique(a,r,s,n);a.opacity=e.opacity;const c=a.getUniforms();c.scale=o.scale,c.offset=o.offset,c.backgroundColor=e.backgroundColor,c.fboTexture=e.fboTexture,c.baseOpacity=e.baseOpacity;const h=this._rctx.bindTechnique(l,c,null);this._render(h)}_getRasterColorizerTechnique(e,r,i,s){const n=e.symbolizerParameters,o=["stretch","lut","hillshade"].indexOf(n.type);return this._rasterColorizerConfig==null&&(this._rasterColorizerConfig=new n3,this._rctx.gl.getExtension("WEBGL_color_buffer_float"),this._rctx.gl.getExtension("OES_texture_float")),this._rasterColorizerConfig.output=r,this._rasterColorizerConfig.blendMode=i,this._rasterColorizerConfig.baseOpacityMode=s,this._rasterColorizerConfig.colorizerType=o,this._rasterColorizerConfig.applyColormap=!!n.colormap,this._rasterColorizerConfig.requireBilinearWithNN=e.isBilinearWithStretchColorRamp,this._rasterColorizerConfig.stretchType=e.hasStretchTypeNone()?vw.Noop:vw.PerBand,this._rasterColorizerTechnique=this._techniqueRepository.releaseAndAcquire(u3e,this._rasterColorizerConfig,this._rasterColorizerTechnique),this._rasterColorizerTechnique}drawVectorData(e,r,i,s,n,o,a,l,c){const h=this._rctx,p=o.sourceLayerInfo.data,f=o.tile.surface.layerViewByIndex(o.layerIndex,tr.MAP),m=n===Xd.Required||e.opacity<1||s!==Pe.Normal||r!==Sn.Composite,y=m?Nd.On:Nd.Off;this._getBlendLayersTechnique(s,r,n,y).bindPipelineState(h);let _=null,v=null;m?(v=this.currentFBO(i),this._vtFBO==null&&(this._vtFBO=new Lce(this._rctx)),_=this._vtFBO.get(i),h.bindFramebuffer(_),this._clearCurrentFBO()):c&&h.clearSafe(wi.DEPTH_BUFFER_BIT);try{this._vectorTileHelper.render(h,o.sourceLod,p,f.painter,f.layer.styleRepository,f.schemaHelper,Math.round(1/o.scale),o.offset,l,a,f.contentZoom),o.vtlNeighborInfos.forAll(w=>this._vectorTileHelper.renderSymbols(h,w.sourceLod,w.sourceLayerInfo.data,f.painter,f.layer.styleRepository,f.schemaHelper,1,w.offset,l,a,f.contentZoom))}catch(w){y_t.warnOnce("A render call containing vector tiles did not resolve correctly.",w)}return _==null||(h.bindFramebuffer(v),e.texture=_.colorTexture,e.offset=ap,e.scale=1,this.drawRasterData(e,r,i,s,n,y),c)}copyFBOToTexture(e){const r=this._rctx,i=r.bindTexture(e.texture,Et.TEXTURE_UNIT_FOR_UPDATES),s=e.descriptor;r.gl.copyTexImage2D(is.TEXTURE_2D,0,s.pixelFormat,0,0,s.width,s.height,0),e.generateMipmap(),r.bindTexture(i,Et.TEXTURE_UNIT_FOR_UPDATES)}_clearCurrentFBO(){this._rctx.setClearColor(0,0,0,0),this._rctx.setClearDepth(1),this._rctx.clearSafe(wi.COLOR_BUFFER_BIT|wi.DEPTH_BUFFER_BIT)}_initFBO(e,r,i){this._rctx.bindFramebuffer(e),i&&(this._rctx.setViewport(0,0,r,r),this._clearCurrentFBO())}ensureBuffer(e){this._lastUsedIds.length=0,this._lastUsedIds.push(1),this._lastCreatedBufferId=1,this._onHoldIds.length=0,this.bind(e)}bind(e,r=0,i=!0){if(this._current=r,r>=this._fbos.length)for(let s=this._fbos.length;s<=r;s++)this._fbos.push(new Lce(this._rctx));this._initFBO(this._fbos[r].get(e),e,i)}_bindNextFreeBuffer(e){this._lastUsedIds.length>0?this.bind(e,this._lastUsedIds.pop()):(this._lastCreatedBufferId++,this.bind(e,this._lastCreatedBufferId))}openGroup(e){this._onHoldIds.push(this._current),this._bindNextFreeBuffer(e)}switch(e){const r=this.currentFBO(e),i=this._current;return this._bindNextFreeBuffer(e),this._lastUsedIds.push(i),r}getLastOnHoldId(){return this._onHoldIds[this._onHoldIds.length-1]}closeGroup(e){const r=this._current;this._bindNextFreeBuffer(e),this._lastUsedIds.push(r),this._lastUsedIds.push(this._onHoldIds.pop())}unbind(){this._rctx.bindFramebuffer(null)}currentFBO(e){return this._fbos[this._current].get(e)}},v_t=class{constructor(){this.sourceLod=[0,0,0],this.offset=[0,0],this.scale=1,this.layerIndex=0,this.vtlNeighborInfos=new kt({allocator:e=>e||new b_t})}},b_t=class{constructor(){this.sourceLayerInfo=null,this.sourceLod=[0,0,0],this.offset=[-1,0]}},w_t=class{constructor(e,r,i,s){this.start=e,this.end=r,this.blendMode=i,this.opacity=s}},x_t=class{constructor(e,r,i){this._rctx=e,this.tileSize=r,this._techniqueRepository=i,this._passParameters=new J0t,this._backgroundTexture=null,this._backgroundColor=null,this._backgroundDirty=!1,this._blackTex=null,this._maxAnisotropy=this._rctx.parameters.maxMaxAnisotropy,this._composition=new __t(this._rctx,this._techniqueRepository),this._blackTex=new qT(mJe(this._rctx,[0,0,0,1])),this._ensureBackgroundTexture(this.tileSize)}dispose(){this._composition=Ue(this._composition),this._backgroundTexture=Ui(this._backgroundTexture),this._blackTex=Ui(this._blackTex)}get backgroundIsGrid(){return this._backgroundColor==null}get backgroundColor(){return this._backgroundColor}updateTileTexture(e,r){if(!e.renderData)return;const i=e.surface,s=i.baseOpacity;let n=0,o=0,a=this.tileSize,l=!1;const c=i.view.state.contentPixelRatio;let h=!1;eF.clear(),jx.length=0;const p=e.layerInfo[tr.MAP];let f=p.length,m=0,y=null;for(;m<p.length;m++){const v=i.layerViewByIndex(m,tr.MAP),w=v.layer.opacity;Dce[m]=w;const x=v.fullOpacity;if(Nce[m]=x,fye(v.layer)&&f>=p.length&&(f=m),W4(v)){Fce[m]=v.layer.blendMode;let S=v.layer.blendMode!=="normal";if(a2(v.layer.parent)){const O=WH(v.layer.parent);O!=null&&O!==""&&(S=d3e(v.layer.parent)||S)}S&&(h=S,l=!1)}if(w===0&&!h){p[m].pendingUpdates&=~(gt.TEXTURE_NOFADING&gt.TEXTURE_FADING);continue}++o;const T=ck(e,m);if(T){if(p[m].pendingUpdates&=~(gt.TEXTURE_NOFADING&gt.TEXTURE_FADING),a2(v.layer.parent)){const S=WH(v.layer.parent);S!=null&&S!==""&&p3e(v.layer.parent,m)}cR(v)?a=Math.max(a,this.tileSize*c):s===1&&x===1&&(v.isOpaque||this._dataToTexture(T)&&T.sourceLayerInfo.data.descriptor.isOpaque)&&(l=!0),++n,y===null&&(y=m)}}const _=a/this.tileSize;this._ensureBackgroundTexture(this.tileSize),n!==0&&y!==null?n===1&&!h&&this._useLayerTexture(e,y,f,Nce[y])||this._composeMapLayers(e,r,m-1,f,Dce,Fce,a,_,!l||h,eF,h):this._useBackgroundTexture(e,o)}_ensureBackgroundTexture(e){this._backgroundTexture==null&&(this._backgroundTexture=this._buildTexture(e),this._backgroundDirty=!0),this._backgroundDirty&&(this._composition.bind(e),this._passParameters.offset=ap,this._passParameters.scale=1,this._passParameters.opacity=1,this.backgroundColor!=null&&(this._passParameters.backgroundColor=this.backgroundColor),this._composition.drawBackground(this._passParameters,this.backgroundColor!=null),this._composition.copyFBOToTexture(this._backgroundTexture),this._composition.unbind(),this._backgroundDirty=!1)}_useBackgroundTexture(e,r){let i=Ag.Immediate;(e.surface.view.layerViewManager.updating||r>0)&&(i=Ag.Delayed);const s=e.renderData;this._backgroundTexture&&s.textureReference==null&&(i=Ag.Immediate),s.setTextureReference(this._backgroundTexture!=null?new ak(this._backgroundTexture,rn.FADING,Uce,e.surface.baseOpacity,0,1):null,i)}_useLayerTexture(e,r,i,s){const n=r<i,o=n?1:e.surface.baseOpacity,a=n?e.surface.baseOpacity:1,l=ck(e,r);return!!this._dataToTexture(l)&&(e.renderData.setTextureReference(new ak(l.sourceLayerInfo.data,rn.FADING,l,o,a,s)),!0)}_composeMapLayers(e,r,i,s,n,o,a,l,c,h,p){this._composition.ensureBuffer(a);const f=e.surface.baseOpacity;let m=!1,y=Ct.LINEAR_MIPMAP_LINEAR,_=!1,v=0;for(let T=i;T>=0;T--){const S=ck(e,T);if(!S||n[T]===0&&!p)continue;const O=T<s&&f<1&&!m;this._passParameters.baseOpacity=O?f:1;const A=this._passParameters.baseOpacity<1?Xd.Required:Xd.NotRequired;O&&(m=!0);let I=!1;h.forEach(D=>{D.start===T&&(jx.push(D),this._composition.openGroup(a),I=!0)});const M=v===0,k=I?Sn.GroupBackgroundComposite:c&&M?this.backgroundIsGrid?Sn.GridComposite:Sn.ColorComposite:Sn.Composite,L=NH[o[T]];for(TAe(S)?(this._passParameters.opacity=n[T],_=this._composition.drawVectorData(this._passParameters,k,a,L,A,S,l,this.tileSize,_)):Agt(S)?(this._passParameters.opacity=n[T],this._composition.drawImageryTileData(this._passParameters,k,a,L,A,S),this._hasNearestInterpolation(S)&&(y=Ct.NEAREST)):this._dataToTexture(S)&&(this._passParameters.texture=S.sourceLayerInfo.data.texture,this._passParameters.offset=S.offset,this._passParameters.scale=S.scale,this._passParameters.opacity=n[T],this._composition.drawRasterData(this._passParameters,k,a,L,A));jx.length>0&&jx[jx.length-1].end===T;){const D=jx.pop();this._passParameters.opacity=D.opacity,this._passParameters.offset=ap,this._passParameters.scale=1;const U=c&&M?this.backgroundIsGrid?Sn.GridComposite:Sn.ColorComposite:Sn.Composite;this._composition.drawGroup(this._passParameters,U,a,NH[D.blendMode],A)}v++}const w=e.renderData,x=w.ensureTexture(a,()=>this._buildTexture(a,y));this._composition.copyFBOToTexture(x),this._composition.unbind(),w.setTextureReference(new ak(x,r,Uce,m?1:f,0,1))}_hasNearestInterpolation(e){const r=e.sourceLayerInfo.data;return!!r.source&&r.interpolation==="nearest"}_dataToTexture(e){if(Rgt(e)){const r=e.sourceLayerInfo;r.data=this._buildTexture(r.data),e.tile.setMemoryDirty()}return Ogt(e)}setBackground(e){this._backgroundColor!==e&&(this._backgroundColor=e,this._backgroundDirty=!0)}_buildTexture(e,r=Ct.LINEAR_MIPMAP_LINEAR){if(e==null)return null;const i=new vr;i.wrapMode=$t.CLAMP_TO_EDGE,i.samplingMode=r,i.maxAnisotropy=this._maxAnisotropy,i.preMultiplyAlpha=!0,i.flipped=!0,i.hasMipmap=!0;const s=this._rctx;let n;if(typeof e=="number")i.width=i.height=e,n=new qT(new Et(s,i));else if(e instanceof O6)i.isOpaque=e.isOpaque,n=new qT(new Et(s,i,e.image)),e.release();else try{i.width=e.width,i.height=e.height,n=new qT(new Et(s,i,e))}catch{n=new qT($we(s)),console.warn("TileRenderer: failed to execute 'texImage2D', cross-origin image may not be loaded.")}const o=s.bindTexture(n.texture,Et.TEXTURE_UNIT_FOR_UPDATES);return n.generateMipmap(),s.bindTexture(o,Et.TEXTURE_UNIT_FOR_UPDATES),n}get test(){return{backgroundTexture:this._backgroundTexture}}};function ck(t,e){Ta.layerIndex=e,Ta.vtlNeighborInfos.clear();const r=t.layerInfo[tr.MAP][e];if(r.data)return or(Ta.offset,0,0),Ta.tile=t,Ta.scale=1,Ta.sourceLod=t.lij,Ta.sourceLayerInfo=r,TAe(Ta)&&t.forEachLoadedNeighbor((s,n)=>{if(s.level!==t.level)return;const o=s.layerInfo[tr.MAP][e];if(!SAe(o)||r.data===o.data)return;const a=Ta.vtlNeighborInfos.pushNew();a.offset=Ym[n],a.sourceLod=s.lij,a.sourceLayerInfo=o}),Ta;const i=r.upsampleInfo;if(i){const s=i.tile.layerInfo[tr.MAP][e];return Ta.tile=i.tile,fn(Ta.offset,i.offset),Ta.scale=i.scale,Ta.sourceLod=i.tile.lij,Ta.sourceLayerInfo=s,Ta}return null}function WH(t){return t.get("uid")}function d3e(t){let e=t.blendMode!=="normal";return a2(t.parent)&&(e=d3e(t.parent)||e),e}function p3e(t,e){a2(t.parent)&&p3e(t.parent,e);const r=WH(t);if(r!=null&&r!==""){const i=eF.get(r);i?i.start=e:eF.set(r,new w_t(e,e,t.blendMode,t.opacity))}}const Dce=new Array,Nce=new Array,Fce=new Array,eF=new Map,jx=new Array,Ta=new v_t,Uce={offset:[0,0],scale:1},Ym=new Array;Ym[nt.NORTH]=[0,-1],Ym[nt.NORTH_EAST]=[-1,-1],Ym[nt.EAST]=[-1,0],Ym[nt.SOUTH_EAST]=[-1,1],Ym[nt.SOUTH]=[0,1],Ym[nt.SOUTH_WEST]=[1,1],Ym[nt.WEST]=[1,0],Ym[nt.NORTH_WEST]=[1,-1];const f3e=200,uk=40,T_t=.8,S_t=10,o3=1e-6;function E_t(t,e,r){const i=e,s=r;let n=0,o=1/0;for(let a=0;a<3;++a){{const l=t[a];if(i[a]<l){if(s[a]<=o3)return!1;const c=(l-i[a])/s[a];n=Math.max(n,c)}else if(s[a]<=-o3){const c=(l-i[a])/s[a];o=Math.min(o,c)}if(n>o)return!1}{const l=t[a+3];if(i[a]>l){if(s[a]>=-o3)return!1;const c=(l-i[a])/s[a];n=Math.max(n,c)}else if(s[a]>=o3){const c=(l-i[a])/s[a];o=Math.min(o,c)}if(n>o)return!1}}return!0}let kce=class{constructor(e,r,i,s,n){this.aabb=e,this.axis=r,this.d=i,this.midStartIndex=s,this.rightStartIndex=n}},FJ=class ZH{constructor(e,r,i,s){this.globalTriangleVertexIndices=e,this.firstTriangleIndex=r,this.positionAttribute=s,this._rayDirection=C(),this.bspNodeTree=new Array;const n=i-r,o=n<=m3e?new Uint16Array(n):new Uint32Array(n);this.indices=o;for(let a=0;a<n;++a)o[a]=a;{const a=P_t(e,r,i,s.data,s.stride),l=ge(Math.log2(n/uk),2,S_t),c=(h,p,f)=>{const m=O_t(o,a,h,p),y=p-h;if(y<=uk){const S=new kce(m,void 0,0,h,p);return this.bspNodeTree.push(S),S}const{axis:_,midValue:v}=R_t(m),w=A_t(o,a,h,p,_,v),x=(S,O)=>{if(f>l)return;const A=O-S;return A<uk||A>=T_t*y?void 0:c(S,O,f+1)},T=new kce(m,_,v,w.next,w.mid);return this.bspNodeTree.push(T),T.leftNode=x(h,w.next),T.rightNode=x(w.mid,p),T};c(0,n,0),this.triangleVertexIndices=M_t(o,e,r,i)}}intersectRayTriangleRange(e,r){{if(e>=r)return;const i=this.triangleVertexIndices,s=this.positionAttribute.data,n=this.positionAttribute.stride,o=this._rayOrigin,a=o[0],l=o[1],c=o[2],h=this._rayDirection,p=h[0],f=h[1],m=h[2];for(let y=e,_=3*e;y<r;++y){let v=i[_++]*n;const w=s[v++],x=s[v++],T=s[v];v=i[_++]*n;const S=s[v++],O=s[v++],A=s[v];v=i[_++]*n;const I=S-w,M=O-x,k=A-T,L=s[v++]-w,D=s[v++]-x,U=s[v]-T,X=f*U-D*m,W=m*L-U*p,G=p*D-L*f,Y=I*X+M*W+k*G;if(Math.abs(Y)<=Number.EPSILON)continue;const P=a-w,V=l-x,z=c-T,H=P*X+V*W+z*G;if(Y>0){if(H<0||H>Y)continue}else if(H>0||H<Y)continue;const Z=V*k-M*z,J=z*I-k*P,re=P*M-I*V,ye=p*Z+f*J+m*re;if(Y>0){if(ye<0||H+ye>Y)continue}else if(ye>0||H+ye<Y)continue;const Ne=(L*Z+D*J+U*re)/Y;if(Ne>=0){const yt=this.indices[y]+this.firstTriangleIndex,Ot=TY(I,M,k,L,D,U,C_t);this._callback(Ne,Ot,yt,!1)}}}ZH.numFacesTested+=r-e}intersectRay(e,r){ZH.numFacesTested=0;const i=Oe(e.r0[0],e.r0[1],e.r0[2]),s=Oe(e.r1[0],e.r1[1],e.r1[2]),n=s[0]-i[0],o=s[1]-i[1],a=s[2]-i[2];if(n*n+o*o+a*a<o3)return;this._rayOrigin=i;const l=this._rayDirection;l[0]=n,l[1]=o,l[2]=a;const c=this.triangleVertexIndices.length/3;this._callback=r;const h=this.bspNodeTree[0];this.intersectRayBSP(h,0,c)}intersectRayBSP(e,r,i){const s=this._rayOrigin,n=this._rayDirection;if(!E_t(e.aabb,s,n))return;const o=e.axis,a=e.d;if(s[o]<a||n[o]<0){const l=r,c=e.midStartIndex;if(l<c){const h=e.leftNode;h!==void 0?this.intersectRayBSP(h,l,c):this.intersectRayTriangleRange(l,c)}}if(this.intersectRayTriangleRange(e.midStartIndex,e.rightStartIndex),s[o]>a||n[o]>0){const l=e.rightStartIndex,c=i;if(l<c){const h=e.rightNode;h!==void 0?this.intersectRayBSP(h,l,c):this.intersectRayTriangleRange(l,c)}}}get estimatedMemoryUsage(){return this.triangleVertexIndices.byteLength+this.indices.byteLength}};FJ.numFacesTested=0;const C_t=C(),Hx=[1/0,1/0,1/0],qx=[-1/0,-1/0,-1/0];function A_t(t,e,r,i,s,n){let o=r,a=i;for(;o<a;){const c=t[o];e[6*c+s+3]<=n?++o:(--a,t[o]=t[a],t[a]=c)}let l=o;for(a=i;l<a;){const c=t[a-1];e[6*c+s]>=n?--a:(t[a-1]=t[l],t[l]=c,++l)}return{next:o,mid:l}}function O_t(t,e,r,i){if(i<=r)return Kb(NaN,NaN,NaN,NaN,NaN,NaN);{const s=6*t[r];for(let n=0;n<3;++n)Hx[n]=e[s+0+n],qx[n]=e[s+3+n]}for(let s=r+1;s<i;++s){const n=6*t[s];for(let o=0;o<3;++o)Hx[o]=Math.min(Hx[o],e[n+0+o]),qx[o]=Math.max(qx[o],e[n+3+o])}return Kb(Hx[0],Hx[1],Hx[2],qx[0],qx[1],qx[2])}function R_t(t){const e=t[3]-t[0],r=t[4]-t[1],i=t[5]-t[2],s=e>r?e>i?0:r>i?1:2:r>i?1:i>e?2:0;return{axis:s,midValue:(t[s]+t[s+3])/2}}function P_t(t,e,r,i,s){const n=r-e,o=new Float32Array(6*n);for(let a=0;a<n;++a){const l=3*(a+e),c=t[l]*s,h=t[l+1]*s,p=t[l+2]*s;for(let f=0;f<3;++f){const m=i[c+f],y=i[h+f],_=i[p+f];o[6*a+f]=Math.min(m,y,_),o[6*a+3+f]=Math.max(m,y,_)}}return o}function M_t(t,e,r,i){const s=i-r;let n=0;for(let a=r;a<i;++a)for(let l=0;l<3;++l)n=Math.max(e[3*a+l],n);const o=n<=m3e?new Uint16Array(3*s):new Uint32Array(3*s);for(let a=0;a<s;++a){const l=3*(t[a]+r);for(let c=0;c<3;++c){const h=e[l+c];o[3*a+c]=h}}return o}const m3e=65535;let Ns=class extends Uo{constructor(){super(...arguments),this.output=N.Color,this.overlayMode=Rg.Disabled,this.tileBlendInput=Sf.LayerOnly,this.spherical=!1,this.doublePrecisionRequiresObfuscation=!1,this.receiveShadows=!1,this.hasSlicePlane=!1,this.backfaceCullingEnabled=!1,this.textureFadingEnabled=!1,this.renderOccluded=!1,this.hasScreenSpaceReflections=!1,this.hasCloudsReflections=!1,this.invisible=!1,this.tileBorders=!1,this.visualizeNormals=!1,this.screenSizePerspective=!1,this.receiveAmbientOcclusion=!1,this.pbrMode=st.Terrain}};u([B({count:N.COUNT})],Ns.prototype,"output",void 0),u([B({count:Rg.COUNT})],Ns.prototype,"overlayMode",void 0),u([B({count:Sf.COUNT})],Ns.prototype,"tileBlendInput",void 0),u([B()],Ns.prototype,"spherical",void 0),u([B()],Ns.prototype,"doublePrecisionRequiresObfuscation",void 0),u([B()],Ns.prototype,"receiveShadows",void 0),u([B()],Ns.prototype,"hasSlicePlane",void 0),u([B()],Ns.prototype,"backfaceCullingEnabled",void 0),u([B()],Ns.prototype,"textureFadingEnabled",void 0),u([B()],Ns.prototype,"renderOccluded",void 0),u([B()],Ns.prototype,"hasScreenSpaceReflections",void 0),u([B()],Ns.prototype,"hasCloudsReflections",void 0),u([B()],Ns.prototype,"invisible",void 0),u([B()],Ns.prototype,"tileBorders",void 0),u([B()],Ns.prototype,"visualizeNormals",void 0),u([B()],Ns.prototype,"screenSizePerspective",void 0),u([B()],Ns.prototype,"receiveAmbientOcclusion",void 0),u([B({count:st.COUNT})],Ns.prototype,"pbrMode",void 0),u([B({constValue:Or.Compressed})],Ns.prototype,"normalType",void 0),u([B({constValue:Ps.Compressed})],Ns.prototype,"textureCoordinateType",void 0),u([B({constValue:!1})],Ns.prototype,"highStepCount",void 0),u([B({constValue:!1})],Ns.prototype,"useCustomDTRExponentForWater",void 0),u([B({constValue:!1})],Ns.prototype,"useFillLights",void 0);const hk=7,I_t=10,dk=pn();var wn;(function(t){t[t.Opaque=0]="Opaque",t[t.Semitransparent=1]="Semitransparent",t[t.TransparentWithDraped=2]="TransparentWithDraped",t[t.Empty=3]="Empty"})(wn||(wn={}));let Hl=class extends Te{get _isGlobal(){return this._stage.viewingMode===De.Global}constructor(e){super(e),this.type=ki.TERRAIN,this.isGround=!0,this._tileSize=256,this._techniqueConfiguration=new Ns,this._passParameters=new BAe,this._rctx=null,this._renderDataPool=new Vo(R0t),this._patchGroups=new Map,this._patchGroupsDirty=!0,this._patchSortingDirty=!0,this._tileIterator=new $Ae,this._highestVisibleLODTile=null,this._visible=!0,this._transparencyState=wn.Opaque,this._castShadows=!0,this._emptyTex=null,this._tileRenderer=null,this._stencilEnabledLayerExtents=new Array,this._numTilesRendered=0,this._numTilesCulled=0,this._numOriginsRendered=0,this.needsHighlight=!1,this.renderOccludedFlags=Mi.Occlude}initialize(){const e=[ue.OPAQUE_TERRAIN,ue.TRANSPARENT_TERRAIN,ue.OCCLUDED_TERRAIN];this._stage.addRenderPlugin(e,this)}destroy(){this._stage.removeRenderPlugin(this),Oyt()}get canRender(){return this._visible&&!!this._rootTiles&&!this.renderingDisabled}set renderingDisabled(e){this._set("renderingDisabled",!!e),this.setDirty()}set transparency(e){this._transparencyState!==e&&(this._techniqueConfiguration.invisible=e===wn.TransparentWithDraped||e===wn.Empty,this._transparencyState=e,this.setNeedsRender())}get transparency(){return this._transparencyState}get needsLinearDepth(){return this._overlayRenderer.hasWater}get renderPatchBorders(){return!!this._techniqueConfiguration.tileBorders}set renderPatchBorders(e){this._techniqueConfiguration.tileBorders!==e&&(this._techniqueConfiguration.tileBorders=e,this.setNeedsRender(),this.notifyChange("renderPatchBorders"))}get visualizeNormals(){return!!this._techniqueConfiguration.visualizeNormals}set visualizeNormals(e){this._techniqueConfiguration.visualizeNormals!==e&&(this._techniqueConfiguration.visualizeNormals=e,this.setNeedsRender(),this.notifyChange("visualizeNormals"))}get cullBackFaces(){return this._techniqueConfiguration.backfaceCullingEnabled}set cullBackFaces(e){this._techniqueConfiguration.backfaceCullingEnabled!==e&&(this._techniqueConfiguration.backfaceCullingEnabled=e,this.notifyChange("cullBackFaces"),this.setNeedsRender())}set renderOrder(e){this._set("renderOrder",e),this._setSortingDirty()}get layerUid(){return z0}get slicePlaneEnabled(){return this._techniqueConfiguration.hasSlicePlane}set slicePlaneEnabled(e){this._techniqueConfiguration.hasSlicePlane!==e&&(this._techniqueConfiguration.hasSlicePlane=e,this.setNeedsRender())}set textureFadingEnabled(e){this._techniqueConfiguration.textureFadingEnabled!==e&&(this._techniqueConfiguration.textureFadingEnabled=e,this.setNeedsRender())}set pbrMode(e){this._techniqueConfiguration.pbrMode!==e&&(this._techniqueConfiguration.pbrMode=e,this.setNeedsRender())}setDebugScreenSizePerspective(e){this._techniqueConfiguration.screenSizePerspective!==e&&(this._techniqueConfiguration.screenSizePerspective=e,this.setNeedsRender())}setRootTiles(e){this._rootTiles=e,this.setDirty()}setNeedsHighlight(e){this.needsHighlight=e,this.setNeedsRender()}setRenderOccludedOverlay(e){this.renderOccludedFlags=e?F4:Mi.Occlude,this.setNeedsRender()}setStencilEnabledLayerExtents(e){this._stencilEnabledLayerExtents=e,this._setSortingDirty()}setTileSize(e){this._tileSize=e,this._tileRenderer!=null&&(this._tileRenderer.tileSize=e),this.setDirty()}_prepareTileForLoading(e){e.renderData||(e.renderData=this._renderDataPool.acquire(),e.renderData.init(e),e.renderData.localOrigin=this._getLocalOriginOfTile(e))}loadTile(e){this._prepareTileForLoading(e),this.updateTileGeometryState(e),this.updateTileTexture(e,gt.TEXTURE_FADING)}updateTileTexture(e,r){this._tileRenderer!=null&&(this._tileRenderer.updateTileTexture(e,r===gt.TEXTURE_FADING?rn.FADING:rn.UNFADED),this.setNeedsRender(),e.resetPendingUpdate(r))}updateTileGeometryState(e){for(const i of e.layerInfo[tr.ELEVATION])i.pendingUpdates&=~gt.GEOMETRY;e.resetPendingUpdate(gt.GEOMETRY);const r=e.renderData.updateGeometryState();return r&&this.setDirty(),r}updateGeometryIfNeeded(e){e.isLoaded&&e.renderData.updateGeometryIfNeeded(this._rctx)}unloadTile(e){const r=e.renderData;r&&(r.releaseGeometry(),this._renderDataPool.release(r),r.clear(),e.renderData=null,e.setMemoryDirty(),this.setDirty())}_getLocalOriginOfTile(e){const r=I_t-hk,i=Math.max(0,Math.floor((e.level-r)/hk)*hk);if(this._isGlobal&&i===0)return ja;for(;e.parent&&e.level>i;)e=e.parent;return e.centerAtSeaLevel}setVisibility(e){this._visible=e,this.setDirty()}getStats(){return{numTilesRendered:this._numTilesRendered,numTilesCulled:this._numTilesCulled,numOriginsRendered:this._numOriginsRendered}}set wireframe(e){this._get("wireframe")!==e&&(this._set("wireframe",e),this.setNeedsRender())}setDirty(e=ds.UPDATE){this._patchGroupsDirty=!0,this._context.requestRender(e)}_setSortingDirty(e=ds.UPDATE){this._patchSortingDirty=!0,this._context.requestRender(e)}setNeedsRender(e=ds.UPDATE){this._context.requestRender(e)}initializeRenderContext(e){this._context=e,this._rctx=e.renderContext.rctx,this._techniqueRepository=e.techniqueRepository,this._tileRenderer=new x_t(this._rctx,this._tileSize,this._techniqueRepository),this.updateTileBackground(),this._emptyTex=$we(this._rctx)}uninitializeRenderContext(){this._emptyTex=Ue(this._emptyTex),this._tileRenderer=Ue(this._tileRenderer)}intersect(e,r,i,s){if(!this._rootTiles||e.options.selectOpaqueTerrainOnly&&e.options.selectionMode&&this.transparency!==wn.Opaque)return;const n=$_t,o=L_t;he(n,s,i),se(o,1/n[0],1/n[1],1/n[2]);const a=e.results.min,l=e.results.max,c=e.results.ground,h=e.options.store===vo.MIN,p=!!e.results.ground.target,f=Let(e.verticalOffset),m=e.tolerance;let y,_=h&&a.dist!=null?a.dist:1/0;const v=x=>{const T=x.renderData;if(!T?.vao)return;const S=T.geometry;HF(dk,S.boundingBox);const O=T.localOrigin;f!=null&&(f.localOrigin=O,f.applyToAabb(dk));const A=dk;if(Wx[0]=i[0]-O[0],Wx[1]=i[1]-O[1],Wx[2]=i[2]-O[2],!EY(A,Wx,o,m,_))return;const I=(G,Y,P)=>{G.set(this.type,x,Y,P,un),_=h&&a.dist!=null?a.dist:1/0},M=(G,Y)=>{if(Y!=null&&G>=0&&(e.options.backfacesTerrain||fe(Y,n)<0)&&(e.options.invisibleTerrain||!e.options.selectionMode||r==null||r(i,s,G))){if((c.dist==null||G<c.dist)&&I(c,G,Y),e.options.isFiltered)return;e.options.store===vo.ALL&&(y==null?(y=JX(e.ray),I(y,G,Y),e.results.all.push(y)):G<y.dist&&I(y,G,Y)),(a.dist==null||G<a.dist)&&I(a,G,Y),e.options.store!==vo.MIN&&(l.dist==null||G>l.dist)&&I(l,G,Y)}},k=D_t;he(k,s,O);const L=S.indices,D=S.vertexAttributes,U=D.getField(E.POSITION,dn),X=new ke(U.typedBuffer,3,!1,D.stride/4),W=S.indexCount/3;if(!f&&W>f3e){const G=x.renderData;G.intersectionData==null&&(G.intersectionData=new FJ(L,0,W,X)),G.intersectionData.intersectRay({r0:Wx,r1:k},M)}else iP(Wx,k,0,W,L,X,null,f,M)},w=this._rootTiles;w!=null&&(()=>{const x=this._tileIterator;x.reset(w);const T=e.options.invisibleTerrain;for(let S=x.next();S;S=x.next())!(S.visible||T&&S.intersectsClippingArea)||f==null&&!S.intersectsRay(i,n,m,_)||p&&this._useStencilForTile(S)?x.skipSubtree():v(S)})()}processScaleRangeQueries(e,r){if(!r.done)for(this._updatePatchGroups();e.updating&&!r.done;){e.prepare();for(const i of this._patchGroups.values())for(const s of i)s.renderData?.textureReference!=null&&e.queriesForTile(s);e.process(),r.madeProgress()}}prepareTechnique(e){if(e.bindParameters.slot===ue.OCCLUDED_TERRAIN){if(!(e.renderOccludedMask&F4))return null}else{const r=this.transparency===wn.Opaque?ue.OPAQUE_TERRAIN:ue.TRANSPARENT_TERRAIN;if(e.bindParameters.slot!==r)return null}switch(e.output){case N.Color:return this.transparency===wn.Empty?null:(this._techniqueConfiguration.hasScreenSpaceReflections=e.bindParameters.ssr.enabled,this._techniqueConfiguration.hasCloudsReflections=e.bindParameters.cloudsFade.data!=null,this._techniqueConfiguration.receiveShadows=e.bindParameters.shadowMap.ready,this._techniqueConfiguration.receiveAmbientOcclusion=e.bindParameters.ssaoHelper.active,this._techniqueConfiguration.overlayMode=this._overlayRenderer.isEmpty?Rg.Disabled:this._overlayRenderer.hasWater?Rg.EnabledWithWater:Rg.Enabled,this._updateTechnique(N.Color,e.bindParameters.slot===ue.OCCLUDED_TERRAIN));case N.Shadow:case N.ShadowExcludeHighlight:return this._castShadows&&e.bindParameters.lighting.globalFactor===1?(this._techniqueConfiguration.receiveShadows=this._techniqueConfiguration.receiveAmbientOcclusion=!1,this._updateTechnique(N.Shadow,!1)):null;case N.Depth:return this.transparency===wn.Empty?null:(this._techniqueConfiguration.receiveShadows=this._techniqueConfiguration.receiveAmbientOcclusion=!1,this._updateTechnique(N.Depth,!1));case N.Normal:return this.transparency===wn.Empty?null:(this._techniqueConfiguration.receiveShadows=this._techniqueConfiguration.receiveAmbientOcclusion=!1,this._updateTechnique(N.Normal,!1));case N.ObjectAndLayerIdColor:return this.transparency===wn.Empty?null:this._updateTechnique(N.ObjectAndLayerIdColor,!1);case N.Highlight:return this.transparency!==wn.Empty&&this.needsHighlight?(this._techniqueConfiguration.receiveShadows=this._techniqueConfiguration.receiveAmbientOcclusion=!1,this._updateTechnique(N.Highlight,!1)):null}return null}render(e,r){const i=e.bindParameters.lighting.globalFactor===1;switch(this._updatePatchGroups(),r.useStencil=!1,e.output){case N.Color:{const s=e.bindParameters.slot===ue.OCCLUDED_TERRAIN?Da.Occluded:Da.ColorAndWater;this.transparency===wn.Opaque?this._renderMaterialPass(e,r,s):e.offscreenRenderingHelper.renderToTargets(()=>this._renderMaterialPass(e,r,s),e.offscreenRenderingHelper.tmpColor,e.offscreenRenderingHelper.mainDepth,[0,0,0,0]);break}case N.Depth:case N.Normal:this._renderAuxiliaryPass(e,r,Da.ColorAndWater);break;case N.Highlight:this.needsHighlight&&this._renderAuxiliaryPass(e,r,Da.Highlight);break;case N.Shadow:case N.ShadowExcludeHighlight:this._castShadows&&i&&this._renderAuxiliaryPass(e,r,Da.None);break;case N.ObjectAndLayerIdColor:this._renderAuxiliaryPass(e,r,Da.ObjectAndLayerIdColor)}}_renderMaterialPass(e,r,i){const{rctx:s}=e;this._passParameters.overlaySource=i,s.bindTechnique(r,this._passParameters,e.bindParameters),this._numTilesRendered=0,this._numTilesCulled=0,this._numOriginsRendered=0,this._renderPatchGroups(e,r,i)}_renderAuxiliaryPass(e,r,i){const s=e.rctx;this._passParameters.overlaySource=i,s.bindTechnique(r,this._passParameters,e.bindParameters),this._renderPatchGroupsAuxiliary(e,r,i)}updateTileBackground(e=null){if(this._tileRenderer==null)return;const r=this._tileRenderer;let i=null;if(e!=null){const s=ze.toUnitRGBA(e);i=Oe(s[0]||0,s[1]||0,s[2]||0)}r.setBackground(i),this._allTiles.forAll(s=>r.updateTileTexture(s,rn.FADING)),this._techniqueConfiguration.tileBlendInput=r.backgroundIsGrid?Sf.GridComposite:r.backgroundColor!=null?Sf.ColorComposite:Sf.LayerOnly,this.setNeedsRender()}_updatePatchGroups(){if(this._patchGroupsDirty&&(this._highestVisibleLODTile=null,this._rebuildPatchGroups(),this._patchGroupsDirty=!1,this._patchSortingDirty=!0),this._patchSortingDirty&&this.renderOrder!==V2.NONE){const e=Array.from(this._patchGroups.values()),r=this._stencilEnabledLayerExtents;for(const i of e)LAe(this.renderOrder,i,r);e.sort((i,s)=>DAe(i[0],s[0],this.renderOrder)),this._patchGroups=new Map(e.map(i=>[i[0].renderData.localOrigin,i])),this._patchSortingDirty=!1}}_rebuildPatchGroups(){const e=this._rootTiles;if(e!=null){e[0]?.surface.checkAllTilesWaterproofness(),this._patchGroups.clear();for(const r of e)this._rebuildPatchGroupsForRootTile(r)}}_rebuildPatchGroupsForRootTile(e){const r=this._tileIterator;for(r.resetOne(e);!r.done;){const i=r.next(),s=i.renderData;if(!s){this._numTilesCulled++;continue}if(!i.visible){this._numTilesCulled++,r.skipSubtree();continue}const n=s.localOrigin;let o=this._patchGroups.get(n);o||(o=new Array,this._patchGroups.set(n,o)),o.push(i),(!this._highestVisibleLODTile||i.elevationLevel>this._highestVisibleLODTile.elevationLevel)&&(this._highestVisibleLODTile=i),r.skipSubtree()}}_useStencilForTile(e){for(const r of this._stencilEnabledLayerExtents)if(e.intersectsExtent(r))return!0;return!1}_renderPatchGroupsAuxiliary(e,r,i){const s=this._stencilEnabledLayerExtents.length>0;this._patchGroups.forEach(n=>{const o=n[0].renderData.localOrigin;r.program.bindDraw(new yH(o),e.bindParameters,this._passParameters);for(let a=0;a<n.length;a++)this._renderPatch(e,r,n[a],St.TRIANGLES,s,i)}),e.rctx.bindVAO(null)}_renderPatchGroups(e,r,i){const s=e.bindParameters.camera,n=r.program;if(this._techniqueConfiguration.screenSizePerspective&&this.pointsOfInterest){const p=rSe(this._stage.viewingMode,this._ellipsoidRadius),f=this.pointsOfInterest.centerOnSurfaceFrequent.distance;p.update({distance:f,fovY:s.fovY})}const o=this._stencilEnabledLayerExtents.length>0,a=i===Da.Occluded;a&&(n.bindTexture("tex",this._emptyTex),n.setUniform3fv("textureOpacities",ja),n.setUniform4fv("texOffsetAndScale",Of));const l=this._tileRenderer!=null&&this._tileRenderer.backgroundColor!=null?this._tileRenderer.backgroundColor:ja;this._techniqueConfiguration.tileBlendInput===Sf.ColorComposite&&n.setUniform3fv("backgroundColor",l);const c=this.wireframe?St.LINES:St.TRIANGLES;this._techniqueConfiguration.textureFadingEnabled&&n.bindTexture("texNext",this._emptyTex);const h=this._patchGroups;for(const p of h.values()){const f=p[0].renderData.localOrigin;r.program.bindDraw(new yH(f),e.bindParameters,this._passParameters),this._numOriginsRendered++;for(const m of p){const y=m.renderData,_=y.textureReference;if(_!=null){if(!a){n.setUniform4fv("texOffsetAndScale",_.offsetAndScale),n.bindTexture("tex",_.texture.texture);const v=y.textureFadeFactor,w=v<1?y.nextTextureReference:null;this._techniqueConfiguration.textureFadingEnabled&&w!=null&&v<1?(n.setUniform1f("fadeFactor",v),n.setUniform4fv("nextTexOffsetAndScale",w.offsetAndScale),n.setUniform3fv("nextTexOpacities",w.opacities),n.bindTexture("texNext",w.texture.texture)):n.setUniform1f("fadeFactor",1),y.textureIsFading&&this.setNeedsRender(),n.setUniform3fv("textureOpacities",_.opacities)}this._renderPatch(e,r,m,c,o,i),m.renderOrder=this._numTilesRendered,this._numTilesRendered++}}}e.rctx.bindVAO(null)}_renderPatch(e,r,i,s,n,o){const a=i.renderData,l=a.vao,c=l.indexBuffer;if(c==null)return void(ln&&console.error("Rendered tile with no indices: ",i.lij," : ",a));const h=r.program;o===Da.None||this._overlayRenderer.isEmpty||this._bindOverlayPatchData(h,a.overlay),n&&(r.useStencil=this._useStencilForTile(i),r.bindPipelineState(e.rctx,e.bindParameters.slot));const p=a.geometry.indexCount;e.rctx.bindVAO(l),h.assertCompatibleVertexAttributeLocations(l),e.rctx.drawElements(s,p,c.indexType,0)}_bindOverlayPatchData(e,r){e.setUniform4fv("overlayTexOffset",r.offsets),e.setUniform4fv("overlayTexScale",r.scales)}_updateTechnique(e,r){return this._techniqueConfiguration.output=e,this._techniqueConfiguration.renderOccluded=r,this._shaderTechnique=this._techniqueRepository.releaseAndAcquire(GAe,this._techniqueConfiguration,this._shaderTechnique),this._shaderTechnique}get test(){return{tileRenderer:this._tileRenderer}}};u([d({constructOnly:!0})],Hl.prototype,"_overlayRenderer",void 0),u([d({constructOnly:!0})],Hl.prototype,"_stage",void 0),u([d({readOnly:!0})],Hl.prototype,"_isGlobal",null),u([d({constructOnly:!0})],Hl.prototype,"_allTiles",void 0),u([d({constructOnly:!0})],Hl.prototype,"_ellipsoidRadius",void 0),u([d({value:!1})],Hl.prototype,"renderingDisabled",null),u([d()],Hl.prototype,"renderPatchBorders",null),u([d()],Hl.prototype,"visualizeNormals",null),u([d()],Hl.prototype,"cullBackFaces",null),u([d({value:V2.FRONT_TO_BACK})],Hl.prototype,"renderOrder",null),u([d()],Hl.prototype,"wireframe",null),Hl=u([R("esri.views.3d.terrain.TerrainRenderer")],Hl);const $_t=C(),L_t=C(),Wx=C(),D_t=C();let N_t=class{constructor(){this.numNodes=0,this.numLeaves=0,this.numVisible=0,this.numRendered=0,this.numSplit=0,this.numMerged=0,this.numRenderedPerLevel=new Array,this.numLoadedPerLevel=new Array}},sf=class extends Te{constructor(e){super(e),this._handles=new Oi}initialize(){this._handles.add(this.layers.on("change",()=>this._update())),this._handles.add(le(()=>this.extentHelper.layerViewsExtent,()=>this._setAdHocTilingScheme())),this._update(),this.tilingSchemeLocked||this._setAdHocTilingScheme()}destroy(){this._handles=Me(this._handles),this._waitTask=null,this.layers.destroy()}_update(){if(this._waitTask=null,this.tilingSchemeLocked)return;let e;if(this.layers.some(r=>!(!A3(r)||r.isRejected())&&!(r.isFulfilled()&&!F_t(r,this.viewSpatialReference,this.viewingMode))&&(e=r,!(r?.type==="vector-tile"||q4(r)))),e)if(e.isResolved()){const r=P6(e,this.viewSpatialReference,this.viewingMode);if(r!=null){const i=new ac(r.tileInfo);this._lockTilingScheme(i)}}else this._updateWhen(e)}_updateWhen(e){const r=e.when().catch(()=>{}).then(()=>{r!==this._waitTask||this.destroyed||this._update()});this._waitTask=r}_lockTilingScheme(e){if(this.viewingMode===De.Global){const r=e.levels.length-1;e.spatialReference.isWebMercator?e=ac.makeWebMercatorAuxiliarySphere(r):$_(e.spatialReference)&&(e=ac.makeGCSWithTileSize(e.spatialReference,e.pixelSize,r))}this.tilingSchemeLocked=!0,this.tilingScheme=e,this.extentHelper.tilingScheme=this.tilingScheme,this._updateTiledLayerExtent(),this._handles.removeAll(),this._handles.add(le(()=>this.extentHelper.tiledLayersExtent,()=>this._updateTiledLayerExtent()))}_updateTiledLayerExtent(){this._set("extent",this.extentHelper.tiledLayersExtent)}_setAdHocTilingScheme(){if(this.viewingMode===De.Global){const e=this.extentHelper.viewSpatialReference,r=$_(e)||Qf(e)||Kf(e);e.isWebMercator?this.tilingScheme=ac.WebMercatorAuxiliarySphere:r&&(this.tilingScheme=ac.makeGCSWithTileSize(e,256)),this._set("extent",this.extentHelper.layerViewsExtent)}else{const e=this.extentHelper.layerViewsExtent;e==null||Tb(e,this.extent)||(this.tilingScheme=ac.fromExtent(e,this.extentHelper.viewSpatialReference),this._set("extent",e))}}get test(){return{lockTilingScheme:e=>this._lockTilingScheme(e),done:!this._waitTask}}};function F_t(t,e,r){return P6(t,e,r)!=null}u([d()],sf.prototype,"tilingScheme",void 0),u([d({readOnly:!0})],sf.prototype,"extent",void 0),u([d({value:!1})],sf.prototype,"tilingSchemeLocked",void 0),u([d({constructOnly:!0})],sf.prototype,"viewSpatialReference",void 0),u([d({constructOnly:!0})],sf.prototype,"layers",void 0),u([d({constructOnly:!0})],sf.prototype,"extentHelper",void 0),u([d({constructOnly:!0})],sf.prototype,"viewingMode",void 0),sf=u([R("esri.views.3d.terrain.TilingSchemeLogic")],sf);let U_t=class{constructor(){this.offset=Ve(),this.scale=0,this.tile=null}init(e,r,i,s){this.tile=e,this.offset[0]=r,this.offset[1]=i,this.scale=s}dispose(){this.tile=null,this.offset[0]=0,this.offset[1]=0,this.scale=0}},jt=class extends os.EventedMixin(Te){constructor(e){super(e),this._scaleRangeQueries=new bD,this._iteratorPool=new Vo($Ae,r=>r.remove=()=>this._iteratorPool.release(r)),this._postorderIterator=new $yt,this._hasPendingUpdates=!1,this._pendingUpdates=0,this._asyncWorkItems=0,this._allTilesDirty=!0,this._allTilesSorted=!0,this._visibleCached=!1,this._usedMemory=null,this._performanceInfo=new N_t,this._viewChanged=!1,this._inFrameTask=!1,this._viewChangeUpdateDirty=!1,this._eyePosRenderSR=C(),this._eyePosSurfaceSR=C(),this._splitLimits=new Td,this._frustum=WO(),this._viewProjectionMatrix=be(),this._layerViews=[new Array,new Array],this._layerIndexByUid=[new Map,new Map],this._basemapLayerViewHandles=new Map,this._handles=new Oi,this._watchUpdatingTracking=new Cf,this._frameTask=x2,this._allTiles=new kt,this._upsampleInfoPool=new Vo(U_t),this._rootTilesExtent=Ut(),this.updatingProgress=.5,this._maxNumUpdating=1,this.maxTextureScale=1.2,this._spatialReference=je.WebMercator,this.visibleElevationBounds=new mS(1/0,-1/0),this.rootTileElevationBounds=new mS(1/0,-1/0),this._updatingRootTiles=!1,this._pendingTilesForElevationUpdateEvent=new Set,this._pendingTilesToUpdate=new Set,this.totalGeometryUpdates=0,this.totalTileUpdates=0,this.oneBatchPerFrameTask=!0,this._layerViewsDirty=!1,this.unloadedMemory=0,this.ignoresMemoryFactor=!1,this._isWebMercator=!1,this._isWebMercatorOnPlateeCarree=!1,this.overlayManager=new Pa({...e,surface:this}),this._isGlobal=!e.view?.state?.isLocal}initialize(){this._lercDecoder=syt(this.view.resourceController),this._tilePool=this.view.state.isLocal?new Vo(H0t):new Vo(W0t);const e=this.view.resourceController.memoryController;this._upsampleMapCache=e.newCache("terrain-upsample",o=>o.unloadMapData()),this._elevationQueryCache=new ryt(e.newCache("elevation-query")),this._handles.add([le(()=>this.overlayManager.hasHighlights,o=>this._renderer.setNeedsHighlight(o)),le(()=>this.overlayManager.rendersOccluded,o=>this._renderer.setRenderOccludedOverlay(o)),le(()=>this.overlayManager.renderer.isEmpty,()=>this._evaluateTransparency())],"overlayManager"),this._renderer=new Hl({_overlayRenderer:this.overlayManager.renderer,_ellipsoidRadius:Nr(this.view.spatialReference).radius,_stage:this.view._stage,_allTiles:this._allTiles}),this._handles.add([le(()=>this.baseOpacity,()=>{this._handleLayerViewChanges(),this._updateTileTextures(this._evaluateTransparency()?rn.UNFADED:rn.IMMEDIATE)},As),le(()=>this.hasCompositeBlendMode,()=>this._updateTileTextures(this._evaluateTransparency()?rn.UNFADED:rn.IMMEDIATE),As),le(()=>this.renderingDisabled,()=>this.view?._stage?.renderer.setParameters({terrainRenderingEnabled:!this.renderingDisabled}),jr),le(()=>this.backgroundColor,o=>{this._handleLayerViewChanges(),this._renderer.updateTileBackground(o)},As),le(()=>this.snapLevel,()=>this._viewChanged=!0,jr),le(()=>this.view.pointsOfInterest,o=>{this._renderer.pointsOfInterest=o,this._watchUpdatingTracking.removeAll(),o&&this._watchUpdatingTracking.add(()=>o.focus.renderLocation,()=>this._allTilesSorted=!1)}),le(()=>ni.TERRAIN_TILE_TREE_SHOW_TILES,o=>{o&&!this._treeDebugger?ae(()=>import("./TerrainTileTree3DDebugger-58c4378e.js"),["./TerrainTileTree3DDebugger-58c4378e.js","./TileTreeDebugger-67b84aad.js"],import.meta.url).then(({TerrainTileTree3DDebugger:a})=>{!this._treeDebugger&&ni.TERRAIN_TILE_TREE_SHOW_TILES&&(this._treeDebugger=new a({view:this.view}))}):o||(this._treeDebugger=Me(this._treeDebugger))},Vr)]);const{spatialReference:r}=this.view;this._extentHelper=byt(this.viewingMode,{layers:this.view.map.allLayers,layerViews:this.view.allLayerViews,viewSpatialReference:r});const i=new zO({getCollections:()=>this.view?.defaultsFromMap?.mapCollections?.map(({layers:o})=>o),getChildrenFunction:o=>o&&"layers"in o?o.layers:null}),s=new sf({layers:i,extentHelper:this._extentHelper,viewingMode:this.viewingMode,viewSpatialReference:r});this._set("tilingSchemeLogic",s),this._updateTilingScheme(),this._elevationDataRequester=this.view.resourceController.createStreamDataRequester(bf.ELEVATION),this._mapDataRequester=this.view.resourceController.createStreamDataRequester(bf.BASEMAP);const n=this.view.resourceController.scheduler;this._frameTask=n.registerTask(dt.TERRAIN_SURFACE,this),this._handles.add([le(()=>this._extentHelper.stencilEnabledExtents,o=>this._renderer.setStencilEnabledLayerExtents(o),Vr),le(()=>this.tilingSchemeLogic.tilingScheme,()=>this._updateTilingScheme(),jr),le(()=>this.extent,()=>this._updateRootTiles(),Vr),this.view.on("resize",()=>this._viewChangeUpdate()),le(()=>{const o=this.view,a=o.state;return[this._lodBias,this.lodSnapping,o.resourceController?.memoryController?.memoryFactor,a.camera,a.contentCamera,a.fixedContentCamera]},()=>this._viewChangeUpdate(),As),le(()=>this.view.qualitySettings?.tiledSurface?.textureFadeDuration,o=>this._renderer.textureFadingEnabled=o>0,Vr),le(()=>this.view.qualitySettings?.physicallyBasedRenderingEnabled,o=>this._renderer.pbrMode=o?st.Terrain:st.Disabled,Vr),le(()=>this._userClippingExtent,()=>this._updateClippingExtent(),jr)]),this._handles.add(this.view.allLayerViews.on("after-changes",()=>this._layerViewsDirty=!0)),this._layerViewsDirty=!0,this._handleLayerViewChanges()}destroy(){this._frameTask.remove(),this._handles.destroy(),this._watchUpdatingTracking.destroy(),this._lercDecoder=Ui(this._lercDecoder),this._removeAllTiles(),this._upsampleMapCache=Me(this._upsampleMapCache),this._elevationQueryCache=Me(this._elevationQueryCache),this._set("tilingSchemeLogic",Me(this.tilingSchemeLogic)),this._basemapLayerViewHandles.forEach((e,r)=>this._unregisterTiledLayerView(r)),this._elevationDataRequester=null,this._mapDataRequester=null,this._set("overlayManager",Me(this.overlayManager)),this._tilePool=Me(this._tilePool),RJ.prune(),this._treeDebugger=Me(this._treeDebugger),this._renderer=Me(this._renderer),this._iteratorPool=Me(this._iteratorPool),this._set("view",null),this._extentHelper=Me(this._extentHelper),this._upsampleInfoPool=Me(this._upsampleInfoPool),myt(),l0t()}get renderer(){return this._renderer}get frustum(){return this._frustum}get snapLevel(){if(this.lodSnapping===Z3.ON){const e=this.view,r=this.tilingScheme,i=e.pointsOfInterest?.cameraOnSurface?.scale;if(r&&i){const s=e.state.contentCamera;let n=i6(e,s.eye,s.viewForward,s.up).tilt;n>90&&(n=180-n);const o=2*(n/90)**2,a=r.levelAtScale(i)-o,l=Math.min(a,this._splitLimits.maxLod||1/0);return l<=0?null:l}}return null}get lodSnapping(){return this.view.qualitySettings.tiledSurface.reduceTileLevelDifferences?Z3.ON:Z3.OFF}get upsampleInfoPool(){return this._upsampleInfoPool}get upsampleMapCache(){return this._upsampleMapCache}get elevationQueryCache(){return this._elevationQueryCache}get mapTileRequester(){return this._mapDataRequester}get _userClippingExtent(){const{spatialReference:e}=this,{clippingArea:r}=this.view;if(r==null||e==null)return null;const i=Ut(),s=dAe(r,i,e)?i:null,n=this._get("extent");return Tb(s,n)?n:s}get rootTilesExtent(){return this._rootTilesExtent}get extent(){const e=CV(this.groundExtent,this._userClippingExtent,Ut()),r=this._get("extent");return Tb(e,r)?r:e}get groundExtent(){return this._tilingSchemeExtent!=null?this._tilingSchemeExtent:this._rootTilesExtent}get _tilingSchemeExtent(){return this.tilingSchemeLogic?.extent}get updating(){return this._hasPendingUpdates||(this._maxNumUpdating=1),!!((this.running||this._watchUpdatingTracking?.updating||this._asyncWorkItems>0)&&this.ready&&!this.suspended||this.overlayManager?.updating)}get running(){return(this._hasPendingUpdates||this._viewChanged||this._allTilesDirty||!this._allTilesSorted||this._layerViewsDirty||this._scaleRangeQueries.updating||this._frameTask.updating)&&this.ready&&!this.suspended}get updatingProgressValue(){return this._maxNumUpdating=Math.max(this._pendingUpdates,this._maxNumUpdating),1-this._pendingUpdates/this._maxNumUpdating}get baseOpacity(){return this.view?.map?.ground?.opacity??1}set baseOpacity(e){this.view.map.ground.opacity=e}get viewingMode(){return this.view.state.viewingMode}get ready(){return this._rootTiles!=null}set renderOrder(e){this._renderer.renderOrder=e,this._set("renderOrder",e)}get rootTiles(){return this._rootTiles}get spatialReference(){return this.tilingScheme?.spatialReference??null}get backgroundColor(){return this.view.map.ground.surfaceColor}set backgroundColor(e){this.view.map.ground.surfaceColor=e}set slicePlaneEnabled(e){this._renderer.slicePlaneEnabled=e,this._set("slicePlaneEnabled",e),this._evaluateTransparency()}get tilingSchemeLocked(){return this.tilingSchemeLogic?.tilingSchemeLocked??!1}get wireframe(){return this._renderer?.wireframe}set wireframe(e){e!==this._renderer.wireframe&&(this._renderer.wireframe=e,this._updateAllTileGeometries())}set _visible(e){e!==this._visibleCached&&(this._visibleCached=e,this._renderer.setVisibility(e),this.suspended=!e)}get opaque(){return this._renderer.transparency===wn.Opaque}set suspended(e){this._set("suspended",e),this._viewChangeUpdate()}get textureFadeDuration(){return this.view.qualitySettings.tiledSurface.textureFadeDuration??0}intersect(e,r,i,s){this._renderer.intersect(e,r,i,s)}getElevation(e,r,i,s){const n=this._rootTiles;if(n==null||!n.length||n[0].layerInfo[tr.ELEVATION].length===0)return null;const o=nl;return o[0]=e,o[1]=r,o[2]=i,Ws(o,s,o,this._spatialReference)?zce(n,o[0],o[1]):(Q.getLogger(this).error("TerrainSurface.getElevation(): could not project given point to tiling scheme coordinate system"),null)}getElevations(e,r,i){const s=this._rootTiles,n=s?s[0].layerInfo[tr.ELEVATION].length:0;if(s!=null&&s.length&&n!==0)for(let o=0;o<r;++o){const a=3*o;i(o,zce(s,e[a],e[a+1]))}else for(let o=0;o<r;++o)i(o,null)}getScale(e){if(!this.tilingScheme)return null;if(!wo(e,nl,this.spatialReference))return Q.getLogger(this).error("TerrainSurface.getScale(): could not project given point to tiling scheme coordinate system"),null;const r=this._rootTiles;if(r!=null){for(const i of r)if(i?.containsPoint(nl)){let s=i;for(;s.children[0]&&!s.rendered;){const n=s.children[0].extent;let o=0;nl[0]>n[2]&&(o+=1),nl[1]<n[1]&&(o+=2),s=s.children[o]}return this._getLodBiasCorrectedScale(s.level)}}return 1/0}getSphereElevationBounds(e,r){if(nl[0]=e[0],nl[1]=e[1],nl[2]=e[2],nl[3]=e[3],!Ws(nl,r,nl,this.tilingScheme?.spatialReference))return Q.getLogger(this).error("TerrainSurface.getSphereElevationBounds(): could not project given point to tiling scheme coordinate system"),null;let i=1/0,s=-1/0;const n=a=>{if(a&&fK(a.extent,nl))if(a.isLeaf||a.rendered)i=Math.min(i,a.elevationBounds[0]),s=Math.max(s,a.elevationBounds[1]);else for(const l of a.children)n(l)},o=this._rootTiles;if(o!=null)for(const a of o)n(a);return{min:i,max:s}}getSphereScale(e,r){if(!this.tilingScheme)return null;if(!wo(e,nl,this.spatialReference))return Q.getLogger(this).error("TerrainSurface.getSphereScale(): could not project given point to tiling scheme coordinate system"),null;nl[3]=r;let i=null;const s=o=>{if(o&&fK(o.extent,nl)){const a=o.children;if(a[0]&&!o.rendered)for(const l of a)s(l);else{const l=this._getLodBiasCorrectedScale(o.level);i=i==null?l:Math.min(i,l)}}},n=this._rootTiles;if(n!=null)for(const o of n)s(o);return i}queryVisibleScaleRange(e,r,i,s){const n=r?this.tilingScheme.levelAtScale(r):0,o=i?this.tilingScheme.levelAtScale(i):1/0,a=this._lodBias;this._scaleRangeQueries.queryVisibleLevelRange(e,n+a,o+a,s)}_evaluateTransparency(){const e=this.baseOpacity,r=this.overlayManager.renderer.isEmpty,i=this._renderer.transparency,s=this._allSurfaceLayersTransparent()?r?wn.Empty:wn.TransparentWithDraped:e>=1&&!this.hasCompositeBlendMode&&!this._renderer.slicePlaneEnabled?wn.Opaque:wn.Semitransparent,n=i!==s;return n&&(this._renderer.transparency=s,this.view?._stage?.renderer.setParameters({terrainTransparency:this._renderer.transparency})),n}_updateTilingScheme(){const e=this.tilingSchemeLogic.tilingScheme;if(e===this.tilingScheme)return;pf(!!e,"tiling scheme cannot be reset to undefined"),this._isGlobal=!this.view?.state?.isLocal,this.tilingScheme&&this._removeAllTiles();const r=e?.spatialReference??je.WebMercator;this._spatialReference=r,this._isWebMercator=!!r?.isWebMercator,this._isWebMercatorOnPlateeCarree=this._isWebMercator&&bO(this.view?.renderSpatialReference),this._set("tilingScheme",e),this._updateClippingExtent(),e&&(this._updateTiledLayers(),this._renderer.setTileSize(e.pixelSize),this.overlayManager.setSpatialReference(e.spatialReference),this._updateRootTiles())}_acquireTile(e,r,i,s){const n=this._tilePool.acquire();return p$[0]=e,p$[1]=r,p$[2]=i,n.init(p$,s,this),n}get updatingRootTiles(){return this._updatingRootTiles}_updateRootTiles(){const{extent:e,tilingScheme:r}=this;if(!r)return;const i=z_t;let s=r.rootTilesInExtent(e,i,5*iS);if(this._rootTiles!=null){if(s.length>iS)return void Q.getLogger(this).warn(SXe);const n=this._rootTiles.map(a=>a.lij),o=zOe(n,s,Vce);if(this._updatingRootTiles=!0,o.removed.length>0||o.added.length>0){const a=this._rootTiles.filter(l=>!(o.removed.findIndex(c=>Vce(c,l.lij))>-1)||(this._purgeTile(l),!1));o.added.forEach(l=>a.push(this._newRootTile(l))),this._setRootTiles(a)}}else this._updatingRootTiles=!0,s.length>iS&&(Q.getLogger(this).warn(EXe),s=r.rootTilesInExtent(e,i,iS)),this._setRootTiles(s.map(n=>this._newRootTile(n)));Tb(i,this._rootTilesExtent)||(this._rootTilesExtent=Ut(i)),this._visible=!0,this._viewChangeUpdate(),this.overlayManager.setPlacementDirty(),this.notifyChange("ready"),this._updateAllTileGeometries(),this._updatingRootTiles=!1,this.checkAllTilesWaterproofness()}_updateAllTileGeometries(){const e=this._allTiles.filter(r=>r.isLoaded&&r.intersectsClippingArea);e.forEach(r=>this._renderer.updateTileGeometryState(r)),e.forEach(r=>r.renderData.updateNeighborData()),this._updateTilesGeometries(e),this._pendingTilesToUpdate.clear()}_updateTilesGeometries(e){if(e.length===0)return;e.sort(Og);const r=this.renderer;e.forEach(i=>r.updateGeometryIfNeeded(i)),e.forEach(i=>this._pendingTilesForElevationUpdateEvent.add(i))}_shouldSplit(e){return e.shouldSplit(this._splitLimits,this._eyePosRenderSR,this.snapLevel)===gt.SPLIT}_newRootTile(e){const r=this._acquireTile(0,e[1],e[2],null);return this._shouldSplit(r)&&r.setPendingUpdate(gt.SPLIT),this._loadTile(r),this._markTileToUpdate(r),this._updateRootTileElevationBounds(),r}_setRootTiles(e){if(this._rootTiles=e,this._allTiles.clear(),e!=null){const r=this._iteratorPool.acquire();for(r.reset(e);!r.done;)this._allTiles.push(r.next());r.remove()}this._renderer.setRootTiles(this._rootTiles),this._updateTilesVisibility(e)}_runViewChangeUpdateIfDirty(){this._viewChangeUpdateDirty&&(this._viewChangeUpdateDirty=!1,this._viewChangeUpdate())}_viewChangeUpdate(){this.view&&!this.suspended&&this.tilingScheme&&this._visibleCached&&(this._inFrameTask?this._viewChangeUpdateDirty=!0:(this._viewChangeUpdateDirty=!1,this._updateViewDependentParameters(),this._updateTilesVisibility(this._rootTiles)))}_updateClippingStatus(e){e.updateClippingStatus(this.extent)&&e.resetPendingUpdate(gt.GEOMETRY)&&this._updateTileGeometryState(e)}_updateTilesVisibility(e){if(e==null)return;const r=Vyt(e),i=this.visibleElevationBounds;let s=r?i.min:1/0,n=r?i.max:-1/0;const o=this.extent,a=this._viewProjectionMatrix;this.setTileTreeDirty();const l=this._iteratorPool.acquire();for(l.reset(e);!l.done;){const c=l.next();c.updateClippingStatus(o)&&c.resetPendingUpdate(gt.GEOMETRY)&&this._updateTileGeometryState(c),c.setPendingUpdate(gt.RENDERDATA),c.computeVisibility(),c.updateScreenDepth(a),c.renderData&&(s=Math.min(c.elevationBounds[0],s),n=Math.max(c.elevationBounds[1],n))}l.remove(),this._viewChanged=!0,this._allTilesDirty=!0,this._batchUpdatePendingTileGeometries(),isFinite(s)&&isFinite(n)&&(i.min!==s||i.max!==n)&&(this.visibleElevationBounds=new mS(s,n))}_updateRootTileElevationBounds(){let e=1/0,r=-1/0;const i=this._rootTiles;i?.forEach(({elevationBounds:n})=>{e=Math.min(e,n[0]),r=Math.max(r,n[1])});const s=this.rootTileElevationBounds;s.min===e&&s.max===r||(this.rootTileElevationBounds=new mS(e,r))}_updateViewDependentParameters(){const{camera:e,contentCamera:r}=this.view.state,i=Math.tan(.5*r.fovX),s=Math.tan(.5*r.fovY),n=this.tilingScheme.pixelSize,o=2**-this._lodBias*e.pixelRatio;this._splitLimits.aboveGround=e.aboveGround,this._splitLimits.fovX=i,this._splitLimits.fovY=s,this._splitLimits.relativeWidthLimit=n/e.width*this.maxTextureScale*o,this._splitLimits.relativeHeightLimit=n/e.height*this.maxTextureScale*o,this._splitLimits.maxLod=this.tilingScheme.getMaxLod(),this._splitLimits.angledSplitBias=this.view.qualitySettings.tiledSurface.angledSplitBias,this.view.state.fixedContentCamera?(this._splitLimits.frustum==null&&(this._splitLimits.frustum=WO()),i4(this._splitLimits.frustum,r.frustum)):this._splitLimits.frustum=null,i4(this._frustum,e.frustum),si(this._viewProjectionMatrix,r.projectionMatrix,r.viewMatrix),ie(this._eyePosRenderSR,r.eye),Ws(e.eye,this.view.renderSpatialReference,this._eyePosSurfaceSR,this.spatialReference)}_updateRenderData(e){e.rendered&&!e.shouldLoad&&(g3e(e)?this._loadChildren(e):V_t(e)&&this._loadParent(e))}_updateTileGeometryState(e){e.updateVisibility(),this._renderer.updateTileGeometryState(e)&&this._markTileToUpdate(e),this._usedMemory=null}_markAllTileNeighborsForGeometryUpdate(e){const r=this._pendingTilesToUpdate;e.forEachLoadedNeighbor(i=>{r.add(i)})}_updateTileTexture(e,r){const i=e.resetPendingUpdate(gt.TEXTURE_FADING)?gt.TEXTURE_FADING:!!e.resetPendingUpdate(gt.TEXTURE_NOFADING)&&gt.TEXTURE_NOFADING;i&&(this._renderer.updateTileTexture(e,i),this._usedMemory=null,r.madeProgress())}_emitElevationUpdateEventForTiles(){const e=fk.extent;wc(e),this._pendingTilesForElevationUpdateEvent.forEach(r=>f_(e,r.extent,e)),this._pendingTilesForElevationUpdateEvent.clear(),fk.spatialReference=this.spatialReference,this.emit("elevation-change",fk)}runTask(e){this._handleLayerViewChanges(e),this._frameTask.processQueue(e),this.renderer.processScaleRangeQueries(this._scaleRangeQueries,e),this._inFrameTask=!0,this._pendingUpdates=0,this._hasPendingUpdates=!1,this._updateAllTilesStatus(e),this._sortTiles(e);const r=!this.view.state.fixedContentCamera;this._mergeAndSplit(e,r),this._updateElevation(e),this._updateTextures(e),r||this._mergeAndSplit(e,!0),this._inFrameTask=!1,this._runViewChangeUpdateIfDirty(),this._batchUpdatePendingTileGeometries(),this._emitElevationUpdateEventForTiles(),e.done&&e.hasProgressed&&this.requestUpdate(),this.notifyChange("updatingProgressValue")}_updateAllTilesStatus(e){if(!this._viewChanged||!this._rootTiles||e.done)return;this._viewChanged=!1;const r=this._iteratorPool.acquire();r.reset(this._rootTiles);const i=this.snapLevel,s=this._splitLimits,n=this._eyePosRenderSR;for(;!r.done;){const o=r.next(),a=o.shouldSplit(s,n,i);if(a!==gt.SPLIT){if(o.resetPendingUpdate(gt.SPLIT)&&o.updateAgentSuspension(),a===gt.ELEVATION&&o.updateAgents(tr.ELEVATION),r.skipSubtree(),!o.isLeaf){o.setPendingUpdate(gt.MERGE),o.resetPendingUpdate(gt.SPLIT);const l=this._iteratorPool.acquire();l.resetOne(o);const c=this._viewProjectionMatrix;for(let h=l.next();!l.done;h=l.next())this._updateClippingStatus(h),h.updateVisibility(),h.updateScreenDepth(c);l.remove()}}else o.resetPendingUpdate(gt.MERGE),o.isLeaf&&(o.setPendingUpdate(gt.SPLIT),r.skipSubtree()),o.rendered&&o.setPendingUpdate(gt.RENDERDATA)}r.remove(),this.requestUpdate(),(this.shortBatches||!this.oneBatchPerFrameTask)&&this._batchUpdatePendingTileGeometries(),e.madeProgress()}_sortTiles(e){e.done||this._allTilesSorted||(Uyt(this._allTiles,this.view.pointsOfInterest.focus.renderLocation),this._allTilesSorted=!0,this._treeDebugger&&this._treeDebugger.update(),e.madeProgress())}_markTileToUpdate(e){xe(e.isLoaded),e.intersectsClippingArea&&(this._pendingTilesToUpdate.add(e),this._markAllTileNeighborsForGeometryUpdate(e))}_batchUpdatePendingTileGeometries(){const e=this._pendingTilesToUpdate;if(e.size===0)return;const r=Array.from(this._pendingTilesToUpdate.keys()).filter(n=>n.isLoaded&&n.intersectsClippingArea),i=(n,o)=>{!o?.isLoaded||!o.intersectsClippingArea||o.level<n.level||e.has(o)||(e.add(o),r.push(o),o.renderData.updateNeighborData())};r.sort(Og);const s=r.length;for(let n=0;n<s;++n){const o=r[n];xe(o.isLoaded),xe(o.intersectsClippingArea);const a=o.renderData;a.updateNeighborData();const l=a._dirtyEdgeResolutions,c=a.geometryState.neighborData.cornerPeerNeighbors,h=p=>{const f=hR[p];i(o,c[p]?.findCorner(Z4(f),m=>m.isLoaded))};for(let p=0;p<4;++p)if(l&1<<p){const f=a.geometryState.neighborData.edgePeerNeighbors[p];f&&f?.level>=o.level&&f.forAllSubtreeOnSide(X4(Tf[p]),m=>!(!m.isLoaded||!m.intersectsClippingArea)&&(xe(e.has(m)||Og(o,m)<0),i(o,m),!0)),h((p+1)%4),h(p)}}e.clear(),this._updateTilesGeometries(r),ln&&H4&&this.checkAllTilesWaterproofness()}_mergeAndSplit(e,r){if(this.suspended||e.done||!this._allTilesDirty)return;this._allTilesDirty=!1,this.requestUpdate();let i=!1;const s=this.view.state.fixedContentCamera;let n=!1;for(;!e.done;){n=!0;let o=!1;const a=!this._allTiles.some(l=>{if(!i&&!s&&!l.visible)return e.done;let c=l;if(l.resetPendingUpdate(gt.MERGE)){if(!r)return l.setPendingUpdate(gt.MERGE),e.done;for(;c.parent?.resetPendingUpdate(gt.MERGE);)c=c.parent;this._mergeTile(c),o=!0,e.madeProgress()}else l.resetPendingUpdate(gt.SPLIT)&&(this._splitTile(l),o=!0,e.madeProgress());return!e.done&&c===l&&l.resetPendingUpdate(gt.RENDERDATA)&&(this._updateRenderData(l),e.madeProgress()),e.done});if(o&&(this._allTilesSorted=!1,this._allTilesDirty=!0),a){if(!i){i=!0;continue}if(!o)break}else this._allTilesDirty=!0}n?e.madeProgress():this._allTilesDirty=!0,!this.oneBatchPerFrameTask&&this._batchUpdatePendingTileGeometries(),this._sortTiles(e)}_updateElevation(e){e.done||(this._allTiles.some(r=>(r.resetPendingUpdate(gt.GEOMETRY)&&(this._updateTileGeometryState(r),this._updateTileTexture(r,e),this.shortBatches&&this._batchUpdatePendingTileGeometries(),e.madeProgress()),e.done)),!this.oneBatchPerFrameTask&&this._batchUpdatePendingTileGeometries())}_updateTextures(e){e.done||this._allTiles.some(r=>(this._updateTileTexture(r,e),e.done))}_updateClippingExtent(){this.spatialReference&&(this.updateTileOverlayParams(ds.UPDATE),this.overlayManager.setPlacementDirty(),this._updateRootTiles())}get _lodBias(){const e=this.view.resourceController.memoryController.memoryFactor;return this.view.qualitySettings.tiledSurface.lodBias-(1-e)*xXe}_getLodBiasCorrectedScale(e){const r=this.tilingScheme.levels,i=ge(e-this._lodBias,0,r.length-1),s=i-Math.floor(i);return r[Math.floor(i)].scale*(1-s)+r[Math.ceil(i)].scale*s}_removeAllTiles(){this._rootTiles!=null&&(this._rootTiles.forEach(e=>this._purgeTile(e)),this._setRootTiles(null),this.notifyChange("ready")),this._allTiles.clear(),this._visible=!1}_purgeDescendantTiles(e){if(!e.children[0])return!1;let r=!1;for(let i=0;i<4;++i)r=this._purgeTile(e.children[i])||r;return e.unsetChildren(),r}_purgeTile(e){const r=this._purgeDescendantTiles(e)||e.rendered;return this._allTiles.removeUnordered(e),this._unloadTile(e),this._tilePool.release(e),r}_unloadTile(e){this._pendingTilesToUpdate.delete(e),this._pendingTilesForElevationUpdateEvent.delete(e),e.unload(this._renderer)}_splitTile(e){pf(e.isLeaf,"tile that is already split should not be split again!");const r=e.level+1,i=2*e.lij[1],s=2*e.lij[2];e.setChildren(this._createTile(r,i,s,e),this._createTile(r,i,s+1,e),this._createTile(r,i+1,s,e),this._createTile(r,i+1,s+1,e)),e.setPendingUpdate(gt.RENDERDATA),e.updateAgentSuspension(),this._allTiles.pushArray(e.children),this._allTilesDirty=!0,++this._performanceInfo.numSplit}_emitTileScaleChange(e,r=e.level){f$.spatialReference=this.spatialReference,f$.extent=e.extent,f$.scale=this._getLodBiasCorrectedScale(r),this.emit("scale-change",f$)}_createTile(e,r,i,s){pf(!!s,"_createTile sanity check");const n=this._acquireTile(e,r,i,s);return n.updateClippingStatus(this.extent),n.updateScreenDepth(this._viewProjectionMatrix),this._shouldSplit(n)&&n.setPendingUpdate(gt.SPLIT),n}get shortBatches(){return this.view.state.mode!==$r.IDLE}_mergeTile(e){pf(!e.hasPendingUpdate(gt.SPLIT),"_mergeTile sanity check"),this._purgeDescendantTiles(e)&&(pf(!e.renderData,"_mergeTile sanity check"),this._loadTile(e),this._markTileToUpdate(e),this._emitTileScaleChange(e),this.shortBatches&&this._batchUpdatePendingTileGeometries()),this._allTilesDirty=!0,++this._performanceInfo.numMerged}_loadChildren(e){pf(e.rendered,"parent should be rendered"),this._unloadTile(e);const r=e.children;r.forEach(i=>this._loadTile(i)),r.forEach(i=>this._pendingTilesToUpdate.add(i)),this._markAllTileNeighborsForGeometryUpdate(e),this._emitTileScaleChange(e,e.level+1),this.shortBatches&&this._batchUpdatePendingTileGeometries()}_loadParent(e){const r=e.parent;this._unloadChildren(r),this._loadTile(r),this._markTileToUpdate(r),this._emitTileScaleChange(r,r.level),this.shortBatches&&this._batchUpdatePendingTileGeometries()}_unloadChildren(e){const r=e.children;if(r[0])for(let i=0;i<4;++i){const s=r[i];this._unloadChildren(s),this._unloadTile(s)}}_loadTile(e){e.load(),e.setPendingUpdate(gt.RENDERDATA),this.requestUpdate(),this._allTilesDirty=!0,this.overlayManager&&this.overlayManager.hasOverlays&&this.overlayManager.setTileParameters(e)}_elevationDataArrived(e,r,i){const s=new _yt(e.lij,e.extent,i);e.dataArrived(r,tr.ELEVATION,s);const n=[e],o=e.level,a=this._iteratorPool.acquire();for(a.reset(n);!a.done;){const l=a.next();l.findElevationBoundsForLayer(r,o),l.computeElevationBounds()}o===0&&this._updateRootTileElevationBounds(),a.remove(),this._updateTilesVisibility(n)}_handleLayerViewChanges(e=za){if(!this._layerViewsDirty)return;this._layerViewsDirty=!1;let r=!1;const i=new Set;let s=-1;for(const n of this.view.allLayerViews.items)if(i.add(n.uid),uR(n)||CC(n))if(this._basemapLayerViewHandles.has(n.uid)&&!CC(n)){const o=this._layerClassFromLayerView(n),a=this._getLayerIdxByUID(o,n.uid);a!=null&&((a<s||s==null)&&(r=!0),s=a)}else this._registerTiledLayerView(n),n.layer.loaded&&(r=!0);this._basemapLayerViewHandles.forEach((n,o)=>{i.has(o)||(this._unregisterTiledLayerView(o),r=!0)}),r&&this._updateTiledLayers(),this.hasCompositeBlendMode=this._hasCompositeBlendMode(),this._evaluateTransparency(),e.madeProgress()}_allSurfaceLayersTransparent(){let e=this.view.map?.ground?.opacity===0;for(const r of this.view.allLayerViews.items)if(MH(r)&&!fye(r.layer)&&r.fullOpacity!==0)return e=!1,e;return e}_hasCompositeBlendMode(){for(const e of this.view.allLayerViews.items)if((W4(e)||CC(e))&&qyt(NH[e.layer.blendMode]))return!0;return!1}_layerClassFromLayerView(e){return PH(e)?tr.ELEVATION:tr.MAP}_registerTiledLayerView(e){const r=[];if((W4(e)||CC(e))&&r.push(le(()=>e.layer.blendMode,()=>{this.hasCompositeBlendMode=this._hasCompositeBlendMode(),this._updateTileTextures(rn.UNFADED)})),!CC(e)){const i=this._layerClassFromLayerView(e);r.push(le(()=>e.suspended,()=>this._updateTiledLayers())),r.push(le(()=>e.fullOpacity,()=>this._updateTileTextures(rn.UNFADED))),r.push(le(()=>"effectiveScaleRange"in e.layer?e.layer.effectiveScaleRange:null,()=>this._restartAllAgents(i))),r.push(e.on("data-changed",()=>{const s=this._getLayerIdxByUID(i,e.uid);s!=null&&this._invalidateLayerData(s,i)}))}this._unregisterTiledLayerView(e.uid),this._basemapLayerViewHandles.set(e.uid,r)}_unregisterTiledLayerView(e){const r=this._basemapLayerViewHandles.get(e);if(r){for(const i of r)i.remove();this._basemapLayerViewHandles.delete(e)}}_updateTiledLayers(){if(!this.tilingScheme||this.view.suspended)return;const e=this.view.allLayerViews,r=[[],[]];let i=null;e.forEach(s=>{if(!s.layer||s.suspended||!uR(s)||!s.fullExtent)return;const n=this._layerClassFromLayerView(s);if(n===tr.MAP){const o=s.displayLevelRange.maxLevel;o!==1/0&&(i===null||o>i)&&(i=o)}r[n].push(s)});for(const s of G1){const n=this._layerViews[s],o=r[s];o.reverse();const a=o.length;let l=n.length!==a;const c=new Array(a),h=new Array(n.length);this._layerIndexByUid[s].clear();for(let p=0;p<a;p++){const f=o[p].uid;this._layerIndexByUid[s].set(f,p);const m=n.indexOf(o[p]);c[p]=m,p!==m&&(l=!0),m>-1&&(h[m]=p)}if(l){const p=this._postorderIterator;for(p.reset(this._rootTiles);!p.done;)p.next().modifyLayers(h,c,s);this._layerViews[s]=o,this._restartAllAgents(s),this._updateTilesVisibility(this._rootTiles)}}this.tilingScheme.ensureMaxLod(i)&&this._viewChangeUpdate()}_restartAllAgents(e){const r=this._postorderIterator;for(r.reset(this._rootTiles);!r.done;){const i=r.next();i.restartAgents(e),e===tr.ELEVATION&&i.computeElevationBounds()}this._updateRootTileElevationBounds()}layerViewByIndex(e,r){return this._layerViews[r][e]}numLayers(e){return this._layerViews[e].length}_updateTileTextures(e){this._allTiles.forAll(r=>{r.updateAgents(tr.MAP),e===rn.IMMEDIATE?this.renderer.updateTileTexture(r,gt.TEXTURE_NOFADING):r.updateRenderData(tr.MAP,e)}),this._evaluateTransparency()}_invalidateLayerData(e,r){this._allTiles.forAll(i=>i.removeLayerAgent(e,r)),this._allTiles.forAll(i=>i.invalidateLayerData(e,r))}setTileTreeDirty(){this._allTilesDirty=!0}requestRender(e=ds.UPDATE){this.renderer.setNeedsRender(e)}requestUpdate(){++this._pendingUpdates==1&&(this._hasPendingUpdates=!0)}requestTileData(e,r,i,s){const n=this.layerViewByIndex(r,i),o=n.layer;return!o.tilemapCache||cR(n)?this._requestTileData(e,i,n,s):(++this._asyncWorkItems,o.tilemapCache.fetchAvailability(e.lij[0],e.lij[1],e.lij[2],{...s,timeout:6e3}).then(()=>--this._asyncWorkItems).catch(a=>{throw--this._asyncWorkItems,Xt(s),ms(a)||this._dataMissing(e,i,n,{notInTilemap:!0}),a}).then(()=>this._frameTask.schedule(()=>this._requestTileData(e,i,n,s),s.signal)))}_requestTileData(e,r,i,s){return r===tr.ELEVATION?PH(i)?this._requestElevationTileData(e,i,s):Promise.reject():MH(i)?this._requestMapTileData(e,i,s):Promise.reject()}_requestElevationTileData(e,r,i){++this._asyncWorkItems;const s=a=>{if(sn(i))return;const l=this._layerIndexByUid[tr.ELEVATION].get(r.uid);l!=null?(this._usedMemory=null,this.requestUpdate(),this._elevationDataArrived(e,l,a)):Q.getLogger(this).warn("TerrainSurface: received data from unknown layer %d %s",tr.ELEVATION,e.lij.toString())},n=a=>{ms(a)||(this._dataMissing(e,tr.ELEVATION,r,a),this.requestUpdate())};if(tle(r.layer))return r.layer.fetchTile(e.lij[0],e.lij[1],e.lij[2],{noDataValue:GO,signal:i.signal}).then(a=>{if(!sn(i))return this._frameTask.schedule(()=>s(a),i.signal,n);Q.getLogger(this).warnOnce("A call to fetchTile resolved even though the request was aborted. fetchTile should not resolve if options.signal.aborted is true.")},n).finally(()=>{--this._asyncWorkItems});const o=r.getTileUrl(e.lij[0],e.lij[1],e.lij[2]);return this._elevationDataRequester.request(o,"binary",i).then(a=>this._lercDecoder.decode(a,{noDataValue:GO},i.signal)).then(a=>{a?s(new iyt(a)):n(new Error("LERC decoding failed"))},n).finally(()=>{--this._asyncWorkItems})}_requestMapTileData(e,r,i){++this._asyncWorkItems;const s=(h,p)=>{--this._asyncWorkItems,jS(p),sn(i)||(this._dataMissing(e,tr.MAP,r,h),this.requestUpdate())},n=h=>p=>s(p,h),o=h=>this._frameTask.schedule(()=>{--this._asyncWorkItems,this.requestUpdate(),sn(i)?jS(h):this._mapTileDataArrived(e,r,h)},i.signal,n(h)).catch(n(h)),a=(h,p=null)=>this._frameTask.schedule(()=>s(h,p));if(cR(r)){const h=r.schemaHelper.getLevelRowColumn(e.lij);return r.fetchTile(h[0],h[1],h[2],i).then(o,a)}if(R6(r))return r.fetchTile(e.lij[0],e.lij[1],e.lij[2],i).then(o,a);if(SJ(r)&&tle(r.layer))return r.layer.fetchTile(e.lij[0],e.lij[1],e.lij[2],i).then(h=>{if(sn(i))return Q.getLogger(this).warnOnce("A call to fetchTile resolved even though the request was aborted. fetchTile should not resolve if options.signal.aborted is true."),void a(Dr());o(h)},a);let l=r.getTileUrl(e.lij[0],e.lij[1],e.lij[2]);i7e(r.layer)&&r.layer.refreshTimestamp&&(l+=`${l.includes("?")?"&":"?"}_ts=${r.layer.refreshTimestamp}`);const c=r.hasMixedImageFormats?"image+type":"image";return this._mapDataRequester.request(l,c,i).then(o,a)}_mapTileDataArrived(e,r,i){const s=this._getLayerIdxByUID(tr.MAP,r.uid);s!=null?e.dataArrived(s,tr.MAP,i):(jS(i),Q.getLogger(this).warn("TerrainSurface: received data from unknown layer"))}_getLayerIdxByUID(e,r){return this._layerIndexByUid[e].get(r)}_dataMissing(e,r,i,s){const n=this._getLayerIdxByUID(r,i.uid);n!=null?e.dataMissing(n,r,s):Q.getLogger(this).warn("TerrainSurface: received data from unknown layer")}updateTileOverlayParams(e){this._rootTiles&&this.overlayManager&&(this._allTiles.forAll(r=>{r.renderData&&this.overlayManager.setTileParameters(r)}),this._renderer.setNeedsRender(e))}get performanceInfo(){const e=this._performanceInfo;return e.numNodes=this._allTiles.length,e.numLeaves=e.numVisible=e.numRendered=e.numLoadedPerLevel.length=e.numRenderedPerLevel.length=0,this._allTiles.forAll(r=>{r.isLeaf&&e.numLeaves++;const i=r.level;r.renderData&&(e.numLoadedPerLevel[i]=(e.numLoadedPerLevel[i]||0)+1),r.visible&&(e.numVisible++,r.rendered&&(e.numRenderedPerLevel[i]=(e.numRenderedPerLevel[i]||0)+1,e.numRendered++))}),e}get usedMemory(){return this.tilingScheme?(this._usedMemory==null&&(this._usedMemory=this._recalculateUsedMemory()),this._usedMemory!=null?this._usedMemory:0):0}_recalculateUsedMemory(){return this.tilingScheme?this._allTiles.reduce((e,r)=>e+r.usedMemory,0):null}getUsedMemoryForLayerView(e){let r=this.overlayManager.gpuMemoryUsage;const i=this._layerClassFromLayerView(e),s=this._getLayerIdxByUID(i,e.uid);return s!=null&&this._allTiles.forAll(n=>r+=n.getUsedMemoryForLayer(i,s)),r}getTile(e){if(e==null||this._rootTiles==null)return null;const r=e.split("/").map(a=>+a);if(r[0]===0)return this._rootTiles.find(a=>a.lij[1]===r[1]&&a.lij[2]===r[2]);const i=2**r[0],s=Math.floor(r[1]/i),n=Math.floor(r[2]/i);let o;if(this._rootTiles.some(a=>a.lij[1]===s&&a.lij[2]===n&&(o=a,!0)),o){let a=1<<r[0]-1;for(;o.lij[0]<r[0];){let l=r[1]&a?2:0;if((r[2]&a)>0&&l++,!o.children[l])return null;o=o.children[l],a>>=1}return pf(o.lij[0]===r[0]&&o.lij[1]===r[1]&&o.lij[2]===r[2],"not the right tile?"),o}return null}get renderPatchBorders(){return this._renderer.renderPatchBorders}set renderPatchBorders(e){this._renderer.renderPatchBorders=e}get visualizeNormals(){return this._renderer.visualizeNormals}set visualizeNormals(e){this._renderer.visualizeNormals=e}get renderingDisabled(){return this._renderer.renderingDisabled}set renderingDisabled(e){this._renderer.renderingDisabled=e}get test(){const e=this;return{renderer:e._renderer,lercDecoder:e._lercDecoder,forceReload:()=>{e._rootTiles!=null&&e._rootTiles.length>0&&(e._mergeTile(e._rootTiles[0]),e._viewChangeUpdate())},getTiles:()=>e._allTiles.toArray(),getRenderedTiles(){pk.clear(),e._allTiles.forAll(i=>{i.visible&&i.rendered&&pk.push(i)});const r=pk.toArray();return LAe(e.renderOrder,r),r},lockTilingScheme(r,i){e._extentHelper.defaultTiledLayersExtent=i,e.tilingSchemeLogic.test.lockTilingScheme(r)}}}checkAllTilesWaterproofness(){if(!H4)return;const e=this._rootTiles;if(e==null)return;const r=o=>o?.renderData?.geometry?.indices?.length>0,i=(o,a)=>{r(o)&&console.error("Tile[",o.lij,"] has geometry although parent[",a.lij,"] has geom")},s=o=>{if(o.intersectsClippingArea)if(o.renderData&&!o.renderData.geometryState&&console.error("Tile[",o.lij,"] has renderData but not geometryState"),o.renderData&&!o.renderData.geometry&&console.error("Tile[",o.lij,"] has renderData but not geometryInfo"),!o.renderData?.geometry||(o.renderData.geometry.indices?.length??0)>0||console.error("Tile[",o.lij,"] has renderData but no indices - geometryInfo: ",o.renderData.geometry),r(o)){o.checkGeometryWaterproofness();for(const a of o.children)i(a,o)}else if(o.isLeaf)console.error("Tile[",o.lij,"] has no geometry and no children, from root to leaf");else for(const a of o.children)s(a)},n=o=>{const a=o.parent?.visible??!0,l=o.visible;o.computeVisibility();const c=o.visible;if(l!==c&&a&&console.error(" Tile[",o.lij,"] has out of date visibility: ",l," instead of ",c),!o.isLeaf)for(const h of o.children)n(h)};for(const o of e)s(o),n(o)}get isGlobal(){return this._isGlobal}get isWebMercator(){return this._isWebMercator}get isWebMercatorOnPlateeCarree(){return this._isWebMercatorOnPlateeCarree}isEastEndWrap(e){return this.isGlobal&&e[2]===this.lijEastEnd(e[0])-1}isWestEndWrap(e){return this.isGlobal&&e[2]===0}lijEastEnd(e){return 2**(e+(this.spatialReference!=null&&this.spatialReference.isGeographic?1:0))}wrapEastWest(e){const r=this.lijEastEnd(e[0]),i=e[2];if(0<=i&&i<r)return e;if(!this.isGlobal)return null;const s=(i+(i<0?r:0))%r;return[e[0],e[1],s]}enableInternalChecks(e){Cgt(e)}enableWaterproofnessChecks(e){Egt(e)}};u([d()],jt.prototype,"_renderer",void 0),u([d({constructOnly:!0})],jt.prototype,"_scaleRangeQueries",void 0),u([d({constructOnly:!0})],jt.prototype,"view",void 0),u([d({constructOnly:!0})],jt.prototype,"overlayManager",void 0),u([d()],jt.prototype,"_hasPendingUpdates",void 0),u([d()],jt.prototype,"_asyncWorkItems",void 0),u([d()],jt.prototype,"_allTilesDirty",void 0),u([d()],jt.prototype,"_allTilesSorted",void 0),u([d()],jt.prototype,"_viewChanged",void 0),u([d()],jt.prototype,"_splitLimits",void 0),u([d({readOnly:!0})],jt.prototype,"_watchUpdatingTracking",void 0),u([d()],jt.prototype,"_frameTask",void 0),u([d({readOnly:!0})],jt.prototype,"snapLevel",null),u([d({readOnly:!0})],jt.prototype,"lodSnapping",null),u([d()],jt.prototype,"_userClippingExtent",null),u([d()],jt.prototype,"_rootTilesExtent",void 0),u([d({readOnly:!0})],jt.prototype,"extent",null),u([d({readOnly:!0})],jt.prototype,"groundExtent",null),u([d({readOnly:!0})],jt.prototype,"_tilingSchemeExtent",null),u([d({readOnly:!0})],jt.prototype,"updating",null),u([d({readOnly:!0})],jt.prototype,"running",null),u([d(gyt)],jt.prototype,"updatingProgress",void 0),u([d({readOnly:!0})],jt.prototype,"updatingProgressValue",null),u([d()],jt.prototype,"_maxNumUpdating",void 0),u([d()],jt.prototype,"baseOpacity",null),u([d()],jt.prototype,"hasCompositeBlendMode",void 0),u([d({readOnly:!0})],jt.prototype,"viewingMode",null),u([d()],jt.prototype,"maxTextureScale",void 0),u([d({readOnly:!0})],jt.prototype,"ready",null),u([d({value:V2.FRONT_TO_BACK})],jt.prototype,"renderOrder",null),u([d({readOnly:!0})],jt.prototype,"rootTiles",null),u([d()],jt.prototype,"_rootTiles",void 0),u([d({readOnly:!0})],jt.prototype,"spatialReference",null),u([d({type:ze})],jt.prototype,"backgroundColor",null),u([d({value:!1})],jt.prototype,"slicePlaneEnabled",null),u([d({readOnly:!0})],jt.prototype,"tilingScheme",void 0),u([d({readOnly:!0})],jt.prototype,"tilingSchemeLocked",null),u([d({readOnly:!0})],jt.prototype,"tilingSchemeLogic",void 0),u([d()],jt.prototype,"wireframe",null),u([d({value:!1})],jt.prototype,"suspended",null),u([d()],jt.prototype,"textureFadeDuration",null),u([d()],jt.prototype,"visibleElevationBounds",void 0),u([d()],jt.prototype,"rootTileElevationBounds",void 0),u([d()],jt.prototype,"_layerViewsDirty",void 0),u([d()],jt.prototype,"renderPatchBorders",null),u([d()],jt.prototype,"visualizeNormals",null),u([d()],jt.prototype,"renderingDisabled",null),jt=u([R("esri.views.3d.terrain.TerrainSurface")],jt);const k_t=jt;function Vce(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]}function g3e(t){const e=t.children;if(!e[0])return!1;for(const r of e)if(r.shouldLoad)return!0;for(const r of e)if(g3e(r))return!0;return!1}function V_t(t){return t.isLeaf&&(t.parent?.shouldLoad??!1)}const nl=Wt(),z_t=Ut(),p$=[0,0,0],pk=new kt,fk={spatialReference:null,extent:Ut(),context:"ground"},f$={spatialReference:null,extent:null,scale:0};function zce(t,e,r){for(const i of t){if(!i.containsPointXY(e,r))continue;let s=i;for(;s&&!s.renderData;){const o=(e>s.extentMidX?1:0)+(r<s.extentMidY?2:0);s=s.children[o]}const n=s?.renderData?.geometryState.samplerData??null;return Wi(e,r,n)}return null}let B_t=class{constructor(e,r,i){this.operation=e,this.geometry=r,this.states=i}},a3=class extends Te{constructor(e){super(e),this._residentGeomRecords=new Map,this._dirtyGeomRecords=new Map,this.dirty=!1}commitLayer(e,r){const i=this._dirtyGeomRecords.get(e);i&&(i.forEach((s,n)=>{const o=this._ensureGeomRecord(e,n);s.forEach(({geometry:a,operation:l,states:c},h)=>{let p=!1;if(l===ji.UPDATE){const f=o.get(h);if(f){if(c&Tn.TRANSFORMATION){const m=this.model.getObject(n);this.model.updateRenderGeometryTransformation(m,a,f)&&(p=!0)}p||r.updates.push({renderGeometry:f,updateType:c})}else et(!1,"ModelDirtySet.getAddRemoveListFilteredByLayers: invalid update")}if(l===ji.REMOVE||p){const f=o.get(h);f?(r.removes.push(f),o.delete(h)):l===ji.REMOVE&&et(!1,"ModelDirtySet.getAddRemoveListFilteredByLayers: invalid remove")}if(l===ji.ADD||p){const f=this.model.getObject(n);if(f!=null){const m=this.model.getRenderGeometry(f,a);r.adds.push(m),o.set(h,m)}}}),o.size===0&&this._residentGeomRecords.get(e).delete(n)}),this._residentGeomRecords.get(e).size===0&&this._residentGeomRecords.delete(e),this._dirtyGeomRecords.delete(e),this.dirty=this._hasDirtyGeometryRecords)}getResidentRenderGeometries(e,r){const i=this._residentGeomRecords.get(e);i&&i.forEach(s=>s.forEach(n=>r.push(n)))}_objectStateChanged(e,r){for(const i of r.geometries)this._updateOrCreateDirtyRecord(r,i,null,ji.UPDATE,e)}visibilityChanged(e){this._objectStateChanged(Tn.VISIBILITY,e)}highlightChanged(e){this._objectStateChanged(Tn.HIGHLIGHT,e)}occlusionChanged(e){this._objectStateChanged(Tn.OCCLUDEE,e)}objectGeometryUpdated(e){this._updateOrCreateDirtyRecord(e.object,e.geometry,null,ji.UPDATE,Tn.GEOMETRY)}layerAdded(e){e.objects.forAll(r=>this._layerObjectAdded(e,r))}layerRemoved(e){e.objects.forAll(r=>this._layerObjectRemoved(e,r))}layerObjectAdded(e){this._layerObjectAdded(e.layer,e.object)}_layerObjectAdded(e,r){const i=e.id;for(const s of r.geometries)this._objectGeometryAdded(r,s,i)}layerObjectRemoved(e){this._layerObjectRemoved(e.layer,e.object)}layerObjectsAdded(e){for(const r of e.objects)this._layerObjectAdded(e.layer,r)}layerObjectsRemoved(e){for(const r of e.objects)this._layerObjectRemoved(e.layer,r)}_layerObjectRemoved(e,r){const i=e.id;for(const s of r.geometries)this._objectGeometryRemoved(r,s,i)}shaderTransformationChanged(e){const r=this._residentGeomRecords.get(e.id);r&&r.forEach((i,s)=>{const n=this.model.getObject(s);n&&n.hasVolativeTransformation()&&i.forEach(o=>o.shaderTransformationChanged())})}objectTransformation(e){const r=this._getParentLayerId(e),i=e.id;this._ensureGeomRecord(r,i).forEach(s=>{this._updateOrCreateDirtyRecord(e,s.geometry,r,ji.UPDATE,Tn.TRANSFORMATION)})}objectShaderTransformation(){}objectGeometryAdded(e){this._objectGeometryAdded(e.object,e.geometry)}_objectGeometryAdded(e,r,i=null){this._updateOrCreateDirtyRecord(e,r,i,ji.ADD)}objectGeometryRemoved(e){this._objectGeometryRemoved(e.object,e.geometry)}_objectGeometryRemoved(e,r,i=null){this._updateOrCreateDirtyRecord(e,r,i,ji.REMOVE)}_updateOrCreateDirtyRecord(e,r,i,s,n=Tn.NONE){i=i??this._getParentLayerId(e);const o=e.id,a=r.id,l=this._ensureDirtyRecord(i,o),c=l.get(a);if(c){const h=c.operation;h===ji.REMOVE&&s===ji.ADD&&c.states!==Tn.NONE?c.operation=ji.UPDATE:h===ji.REMOVE&&s===ji.ADD||h===ji.ADD&&s===ji.REMOVE?l.delete(a):h!==ji.UPDATE||s!==ji.REMOVE&&s!==ji.UPDATE?(et((h===ji.REMOVE||h===ji.ADD)&&s===ji.UPDATE,"ModelDirtySet.objectGeometryAdded: inconsistent state"),c.states|=n):(c.operation=s,c.states|=n)}else l.set(a,new B_t(s,r,n));this.dirty=this._hasDirtyGeometryRecords}_ensureGeomRecord(e,r){let i=this._residentGeomRecords.get(e);i||(i=new Map,this._residentGeomRecords.set(e,i));let s=i.get(r);return s||(s=new Map,i.set(r,s)),s}get _hasDirtyGeometryRecords(){return No(this._dirtyGeomRecords,e=>No(e,r=>r&&r.size>0))}_ensureDirtyRecord(e,r){let i=this._dirtyGeomRecords.get(e);i||(i=new Map,this._dirtyGeomRecords.set(e,i));let s=i.get(r);return s||(s=new Map,i.set(r,s)),s}_getParentLayerId(e){return e.parentLayer?e.parentLayer.id:u$e}formatDebugInfo(){const e=["ADD","UPD",void 0,"REM"];let r="";return this._dirtyGeomRecords.forEach((i,s)=>{i.forEach((n,o)=>{r.length>0&&(r+=`
`),r+=s+"."+o;const a=[];n.forEach(l=>{const c=l.operation;a[c]||(a[c]=[]),a[c].push(l.geometry.id)});for(let l=0;l<a.length;l++)if(a[l]){r+=" "+e[l-1]+": ";for(let c=0;c<a[l].length;c++)r+=a[l][c]+", "}})}),r}get test(){const e=this;return{get residentLayerCount(){return e._residentGeomRecords.size},get residentObjectCount(){return Array.from(e._residentGeomRecords.values()).reduce((r,i)=>r+i.size,0)},commit:r=>e._dirtyGeomRecords.forEach((i,s)=>e.commitLayer(s,r))}}};u([d({constructOnly:!0})],a3.prototype,"model",void 0),u([d()],a3.prototype,"dirty",void 0),a3=u([R("esri.views.3d.webgl-engine.lib.ModelDirtySet")],a3);const G_t=a3;let xD=class extends Te{constructor(){super(...arguments),this.dirtySet=new G_t({model:this}),this._content=new Map,this._originFactory=new YY(null)}getObject(e){return this._content.get(e)}add(e){const r=e.id;et(!this._content.has(r),"Model/Stage already contains object to be added"),this._content.set(r,e),$4(e)&&this.dirtySet.layerAdded(e)}remove(e){et(this._content.has(e.id),"Model/Stage doesn't contain object to be removed"),this._content.delete(e.id),e.unload(),$4(e)&&this.dirtySet.layerRemoved(e)}addMany(e){for(const r of e)r!=null&&(et(!this._content.has(r.id),"Model/Stage already contains object to be added"),this._content.set(r.id,r))}removeMany(e){for(const r of e)et(this._content.has(r.id),"Model/Stage doesn't contain object to be removed"),this._content.delete(r.id),r.unload()}has(e){return this._content.has(e.id)}forEachOfType(e,r){this._content.forEach(i=>{i.type===e&&r(i)})}getRenderGeometry(e,r){const{shaderTransformer:i,localOrigin:s}=r,n=new k2(r,{shaderTransformer:i,castShadow:e.castShadow});return n.updateTransformation(o=>e.getCombinedStaticTransformation(r,o)),n.localOrigin=s??this._originFactory.getOrigin(n.boundingSphere),n}updateRenderGeometryTransformation(e,r,i){if(e==null)return!1;i.updateTransformation(n=>e.getCombinedStaticTransformation(r,n));const s=this._originFactory.getOrigin(i.boundingSphere);return i.localOrigin!==s}getStats(){const e={},r=Array.from(this._content.values());for(let i=0;i<ss.COUNT;++i)e[i]=r.filter(s=>s.type===i).length;return{contentTypes:e,dirtySet:this.dirtySet.formatDebugInfo()}}get test(){return{content:Array.from(this._content.values())}}};u([d({constructOnly:!0})],xD.prototype,"dirtySet",void 0),xD=u([R("esri.views.3d.webgl-engine.parts.Model")],xD);let j_t=class{constructor(e){this._totalCount=e,this._indexRanges=[0,e]}allVisible(){return this.componentCount()===this._totalCount}allInvisible(){return this._indexRanges.length===0}componentCount(){const e=this._indexRanges;let r=0;for(let i=0;i<e.length;i+=2)r+=e[i+1];return r}reset(e){e==="all"||e.length===this._totalCount?this._indexRanges=[0,this._totalCount]:this._indexRanges=H_t(e)}forEachComponent(e){const r=this._indexRanges;for(let i=0;i<r.length;i+=2){const s=r[i],n=s+r[i+1];for(let o=s;o<n;o++)if(!e(o))return!1}return!0}forEachComponentRange(e){const r=this._indexRanges;for(let i=0;i<r.length;i+=2){const s=r[i];if(!e(s,s+r[i+1]))return!1}return!0}computeOffsetRanges(e){const r=new Array(this._indexRanges.length),i=this._indexRanges;for(let s=0;s<i.length;s+=2){const n=i[s],o=n+i[s+1],a=e[n],l=e[o];r[s]=a,r[s+1]=l-a}return r}};function H_t(t){const e=new Array;if(t.length===0)return e;let r=t[0],i=1;for(let s=1;s<t.length;s++){const n=t[s];r+i===n?i+=1:(e.push(r),e.push(i),r=n,i=1)}return e.push(r),e.push(i),e}let q_t=class{constructor(e,r){this.offsets=r,this.pickability=null,this.highlightCounts=null,this.verticalOffsets=null,this.cachedGeometryRanges=null,this.cachedHighlightRanges=null,this.cachedDefaultRanges=null;const i=this.count;this.visibility=new j_t(i),this.materialDataBuffer=e.getBuffer(i),this.materialDataIndices=new Uint16Array(i);for(let s=0;s<i;s++)this.materialDataIndices[s]=this.materialDataBuffer.acquireIndex()}destroy(){for(let e=0;e<this.count;e++)this.materialDataBuffer.releaseIndex(this.materialDataIndices[e])}get count(){return this.offsets.length-1}get geometryRanges(){return this.cachedGeometryRanges==null&&(this.cachedGeometryRanges=this.visibility.computeOffsetRanges(this.offsets)),this.cachedGeometryRanges}get highlightRanges(){return this.highlightCounts==null?null:(this._updateCachedHighlightRanges(),this.cachedHighlightRanges)}get defaultShadowMapRanges(){return this.highlightCounts==null?this.geometryRanges:(this._updateCachedHighlightRanges(),this.cachedDefaultRanges)}highlightsDirty(){this.cachedHighlightRanges=null,this.cachedDefaultRanges=null}visibilityDirty(){this.cachedGeometryRanges=null,this.highlightsDirty()}_updateCachedHighlightRanges(){if((this.cachedHighlightRanges==null||this.cachedDefaultRanges==null)&&this.highlightCounts!=null){const{highlightRanges:e,defaultRanges:r}=W_t(this.highlightCounts,this.visibility,this.offsets);this.cachedHighlightRanges=e,this.cachedDefaultRanges=r}}};function W_t(t,e,r){const i=[],s=[];let n=r.length,o=r.length;return e.forEachComponent(a=>(t[a]>0?(n!==a-1&&(i.length&&i.push(r[n+1]-i[i.length-1]),i.push(r[a])),n=a):(o!==a-1&&(s.length&&s.push(r[o+1]-s[s.length-1]),s.push(r[a])),o=a),!0)),i.length&&i.push(r[n+1]-i[i.length-1]),s.length&&s.push(r[o+1]-s[s.length-1]),{highlightRanges:i,defaultRanges:s}}let l3=class extends Te{constructor(){super(...arguments),this.visible=qS.Hidden}};var qS;u([d({autoDestroy:!0})],l3.prototype,"renderable",void 0),u([d({autoDestroy:!0})],l3.prototype,"components",void 0),l3=u([R("esri.views.3d.webgl-engine.collections.Component.ComponentObject")],l3),function(t){t[t.Hidden=0]="Hidden",t[t.Visible=1]="Visible"}(qS||(qS={}));function Z_t(t,e,r,i){if(r>=e)return t;t==null&&(t=X_t());const s=t.isVisibleBit;let n=t.data;const o=_3e(n),a=r/o|0,l=r-o*a,c=(e-1)/o|0,h=n,p=i===s;if(!(r<h.length*o)&&p){const f=a+1,m=Math.ceil(h.length*oF),y=c+1;let _=Math.max(f,m);_=Math.min(_,y),n=new Uint32Array(_),n.set(h)}return a<n.length&&(n[a]=J_t(n[a],l,p)),t.data=n,t}function y3e(t,e){if(t==null)return!0;const{isVisibleBit:r,data:i}=t,s=_3e(i);return e<i.length*s?Y_t(r,i,e,s):!t.isVisibleBit}function X_t(t=!0){return{isVisibleBit:!t,data:new Uint32Array(0)}}function Y_t(t,e,r,i){const s=r/i|0,n=r-s*i;return Q_t(e[s],n)===t}function _3e(t){return t.BYTES_PER_ELEMENT*8}function J_t(t,e,r){return t&~(1<<e)|(r?1:0)<<e}function Q_t(t,e){return(t&1<<e)!=0}let K_t=class{constructor(e,r){this._components=r,this._indices=e.indices!=null?If(e.indices):A2(e.positions.length/3),this._positions=e.positions,this._componentIntersectionData=new Array(r.count)}getComponentAabb(e,r){this._perComponentAabbs||(this._perComponentAabbs=this._computePerComponentAabbs());for(let i=0;i<6;i++)r[i]=this._perComponentAabbs[6*e+i];return r}getComponentPositions(e,r){r.indices=this._indices,r.data=this._positions,r.stride=3,r.startIndex=this._components.offsets[e],r.endIndex=this._components.offsets[e+1]}intersect(e,r,i,s,n,o,a){const l=new ke(this._positions,3,!1,3),c=this._indices,h=this._components.offsets,p=_Se(e,r,evt),f=e[2],m=r[2];this._components.visibility.forEachComponent(y=>{if(!y3e(this._components.pickability,y))return!0;const _=this.getComponentAabb(y,tvt);if(o!=null){const T=o[y];n!=null?n.componentOffset=T:(e[2]=f-T,r[2]=m-T)}if(n?.applyToAabb(_),!SY(_,e,p,i))return!0;const v=h[y]/3,w=h[y+1]/3,x=(T,S,O)=>a(y,T,hc(S,S,s),O);return n==null&&w-v>f3e?(this._componentIntersectionData[y]==null&&(this._componentIntersectionData[y]=new FJ(this._indices,v,w,l)),this._componentIntersectionData[y].intersectRay({r0:e,r1:r},x)):iP(e,r,v,w,c,l,void 0,n,x),!0})}_computePerComponentAabbs(){const e=this._components.count,r=Yi(6*e),i=this._indices,s=this._positions,n=this._components.offsets;let o=0;for(let a=0;a<e;a++){const l=n[a],c=n[a+1];let h=1/0,p=1/0,f=1/0,m=-1/0,y=-1/0,_=-1/0;for(let v=l;v<c;v++){const w=3*i[v],x=s[w],T=s[w+1],S=s[w+2];h=Math.min(h,x),p=Math.min(p,T),f=Math.min(f,S),m=Math.max(m,x),y=Math.max(y,T),_=Math.max(_,S)}r[o++]=h,r[o++]=p,r[o++]=f,r[o++]=m,r[o++]=y,r[o++]=_}return r}get positions(){return this._positions}get indices(){return this._indices}};const evt=C(),tvt=pn();let rvt=class{constructor(e,r,i){this.material=e,this.geometry=r,this.meta=i}destroy(){this.material.dispose(),this.geometry.dispose()}},ivt=class{constructor(e,r,i,s){this.vao=e,this.primitiveType=r,this.parameters=i,this.indexed=s}dispose(){this.vao.dispose()}},svt=class{constructor(){this.near=Number.MAX_VALUE,this.far=-Number.MAX_VALUE}};function nvt(t,e){return{near:t,far:e}}function yP(t){return t?dR(t,1/0,-1/0):nvt(1/0,-1/0)}function dR(t,e,r){return t.near=e,t.far=r,t}function z2(t,e,r=t){return e!=null&&(r.near=Math.min(t.near,e.near),r.far=Math.max(t.far,e.far)),r}function m$(t,e){return t.near<=e&&e<=t.far}const XH={near:0,far:0};function ovt(t,e){const r=yP(),{eye:i,frustum:s,viewForward:n}=t;e.forAll(o=>{const a=o.offsetObb!=null?o.offsetObb:o.obb,l=fe(Cn(Bc,a.center,i),n),c=I5(a,n);if(m$(r,l-c)&&m$(r,l+c))return;const h=hvt(a,s);if(h===-1)return;if(h===0)return Em.far=l+c,Em.near=l-c,void z2(r,Em);const p=g$.pushNew();p.near=l-c,p.far=l+c,p.mask=h,p.object=o});for(let o=0;o<g$.length;o++){const a=g$.data[o];if(m$(r,a.near)&&m$(r,a.far))continue;Em.far=a.far,Em.near=1/0,uvt(a.object.offsetObb!=null?a.object.offsetObb:a.object.obb,i,avt,c=>{let h=lvt;for(let p=0;p<v3e&&c.length>0;p++){if(!(a.mask&1<<p))continue;cvt(s[p],c,h);const f=c;c=h,h=f}for(let p=0;p<c.length;p+=3){se(fl,c.data[p],c.data[p+1],c.data[p+2]);const f=fe(Cn(fl,fl,i),n);Em.near=Math.min(Em.near,f)}})===0&&(Em.near=0),z2(r,Em)}return g$.length=0,r}const g$=new kt({allocator:t=>t||{near:1/0,far:-1/0,mask:0,object:null},deallocator:t=>(t.object=X2(t.object),t)}),Em=yP(),fl=C(),qv=C(),avt=new kt({deallocator:null}),lvt=new kt({deallocator:null});function cvt(t,e,r){r.length=0;const i=e.length-3;mk(fl,e,i);const s=hi(t,fl);s<=0&&(r.push(fl[0]),r.push(fl[1]),r.push(fl[2]));let n=0,o=s;for(;n<i;n+=3){mk(qv,e,n);const a=hi(t,qv);o*a<0&&(Br(fl,qv,fl,a/(a-o)),ml(r,fl)),a<=0&&ml(r,qv),o=a,ie(fl,qv)}o*s<0&&(mk(qv,e,i),Br(fl,qv,fl,s/(s-o)),ml(r,fl))}function mk(t,e,r){return se(t,e.data[r],e.data[r+1],e.data[r+2])}function ml(t,e){t.push(e[0]),t.push(e[1]),t.push(e[2])}function uvt(t,e,r,i){Bf(Gce,t.quaternion),Cn(Bc,e,t.center),yc(Bc,Bc,Gce);const s=8*((Bc[0]<-t.halfSize[0]?-1:Bc[0]>t.halfSize[0]?1:0)+3*(Bc[1]<-t.halfSize[1]?-1:Bc[1]>t.halfSize[1]?1:0)+9*(Bc[2]<-t.halfSize[2]?-1:Bc[2]>t.halfSize[2]?1:0)+13),n=Bce[s];if(n===0)return n;S5(y$,t.quaternion),rX(y$,y$,t.halfSize);const o=(a,l)=>{const c=Bce[s+l+1];return se(a,((1&c)<<1)-1,(2&c)-1,((4&c)>>1)-1),hc(a,a,y$),ce(a,t.center,a)};return r.length=0,ml(r,o(gk,0)),ml(r,o(jce,1)),ml(r,o(Bc,2)),ml(r,o(Hce,3)),i(r),n===1||(r.length=0,ml(r,gk),ml(r,Hce),ml(r,o(Bc,4)),ml(r,o(qce,5)),i(r),n===2||(r.length=0,ml(r,gk),ml(r,qce),ml(r,o(Bc,6)),ml(r,jce),i(r))),n}const Bce=(()=>{const t=new Array(216);let e=0;const r=i=>{for(let s=0;s<i.length;s++)t[e+s]=i[s];e+=8};return r([3,0,6,2,3,1,5,4]),r([2,0,2,3,1,5,4,0]),r([3,1,0,2,3,7,5,4]),r([2,0,1,3,2,6,4,0]),r([1,0,1,3,2,0,0,0]),r([2,1,5,7,3,2,0,0]),r([3,2,0,1,3,7,6,4]),r([2,2,0,1,3,7,6,0]),r([3,3,0,1,5,7,6,2]),r([2,0,1,5,4,6,2,0]),r([1,0,1,5,4,0,0,0]),r([2,1,3,7,5,4,0,0]),r([1,0,2,6,4,0,0,0]),r([0,0,0,0,0,0,0,0]),r([1,1,3,7,5,0,0,0]),r([2,2,3,7,6,4,0,0]),r([1,2,3,7,6,0,0,0]),r([2,3,1,5,7,6,2,0]),r([3,4,0,1,5,7,6,2]),r([2,5,7,6,4,0,1,0]),r([3,5,0,1,3,7,6,4]),r([2,4,5,7,6,2,0,0]),r([1,4,5,7,6,0,0,0]),r([2,5,1,3,7,6,4,0]),r([3,6,0,2,3,7,5,4]),r([2,6,2,3,7,5,4,0]),r([3,7,6,2,3,1,5,4]),t})(),v3e=4;function hvt(t,e){let r=0;for(let i=0;i<v3e;i++){const s=O1(t,e[i]);if(s>0)return-1;s===0&&(r|=1<<i)}return r}const y$=Li(),Gce=Fh(),Bc=C(),gk=C(),jce=C(),Hce=C(),qce=C();let dvt=class{constructor(e){this._objects=e}submit(e,r){this._objects.preSubmit(r),this._objects.visibleObjects.forAll(i=>i.renderable.material.submit(e,r,i))}queryShadowCasterDepthRange(e){return this._objects.visibleObjects.length?ovt(e,this._objects.visibleObjects):null}};function pvt(t){const e=zi().vec3f(E.POSITION);return t.normals&&e.vec2i16(E.NORMALCOMPRESSED,{glNormalized:!0}),t.textureCoordinates===Ps.Default?e.vec2f(E.UV0):t.textureCoordinates===Ps.Atlas&&(e.vec2f(E.UV0),e.vec4u16(E.UVREGION,{glNormalized:!0})),t.colors&&e.vec4u8(E.COLOR,{glNormalized:!0}),e}let fvt=class{constructor(){this.externalColor=Wt(),this.externalColorMixMode=Us.Multiply,this.castShadows=!0,this.pickable=!0,this.elevationOffset=0}},mvt=class extends as{constructor(e,r){super(e,"int",Qr.Draw,(i,s,n)=>i.setUniform1i(e,r(s,n)))}};var Df;(function(t){t[t.Uniform=0]="Uniform",t[t.Varying=1]="Varying",t[t.COUNT=2]="COUNT"})(Df||(Df={}));const UJ=429496.7296;function b3e(t,e){tR(t/UJ*.5+.5,e)}function gvt(t,e){switch(e.componentData){case Df.Varying:return yvt(t,e);case Df.Uniform:return _vt(t);case Df.COUNT:return;default:e.componentData}}function yvt(t,e){const{vertex:r,fragment:i}=t;r.include(Ec),r.uniforms.add(new bh("componentColorTex",n=>n.componentParameters.texture.texture)),t.attributes.add(E.COMPONENTINDEX,"float"),t.varyings.add("vExternalColorMixMode","mediump float"),t.varyings.add("vExternalColor","vec4");const s=e.output===N.ObjectAndLayerIdColor;s&&t.varyings.add("vObjectAndLayerIdColor","vec4"),t.include(JEe),r.constants.add("elevationScale","float",2*UJ),r.constants.add("stride","float",oe("enable-feature:objectAndLayerId-rendering")?3:2),r.code.add(b`vec2 getComponentTextureCoordinates(float componentIndex, float typeOffset) {
float index = componentIndex * stride + typeOffset;
float texSize = float(textureSize(componentColorTex, 0).x);
float coordX = mod(index, texSize);
float coordY = floor(index / texSize);
return vec2(coordX, coordY) + 0.5;
}`),r.code.add(b`
  vec4 _readComponentColor() {
    vec2 textureCoordinates = getComponentTextureCoordinates(componentIndex, 0.0);

    return texelFetch(componentColorTex, ivec2(textureCoordinates), 0);
   }

   float readElevationOffset() {
    vec2 textureCoordinates = getComponentTextureCoordinates(componentIndex, 1.0);

    vec4 encodedElevation = texelFetch(componentColorTex, ivec2(textureCoordinates), 0);
    return (rgba2float(encodedElevation) - 0.5) * elevationScale;
  }

  ${s?b`
          void forwardObjectAndLayerIdColor() {
            vec2 textureCoordinates = getComponentTextureCoordinates(componentIndex, 2.0);

            vObjectAndLayerIdColor = texelFetch(componentColorTex, ivec2(textureCoordinates), 0);
          }`:b`void forwardObjectAndLayerIdColor() {}`}

  vec4 forwardExternalColor(out bool castShadows) {
    vec4 componentColor = _readComponentColor() * 255.0;

    float shadowFlag = mod(componentColor.b * 255.0, 2.0);
    componentColor.b -= shadowFlag;
    castShadows = shadowFlag >= 1.0;

    int decodedColorMixMode;
    vExternalColor = decodeSymbolColor(componentColor, decodedColorMixMode) * 0.003921568627451; // = 1/255;
    vExternalColorMixMode = float(decodedColorMixMode) + 0.5; // add 0.5 to avoid interpolation artifacts

    return vExternalColor;
  }
`),i.code.add(b`
  void readExternalColor(out vec4 externalColor, out int externalColorMixMode) {
    externalColor = vExternalColor;
    externalColorMixMode = int(vExternalColorMixMode);
  }

  void outputObjectAndLayerIdColor() {
     ${s?b`fragColor = vObjectAndLayerIdColor;`:""}
  }
`)}function _vt(t){const{vertex:e,fragment:r}=t;e.uniforms.add(new Y4("externalColor",i=>i.componentParameters.externalColor)),r.uniforms.add(new mvt("externalColorMixMode",i=>i.componentParameters.externalColorMixMode)),t.varyings.add("vExternalColor","vec4"),e.code.add(b`float readElevationOffset() {
return 0.0;
}
void forwardObjectAndLayerIdColor() {
}
vec4 forwardExternalColor(out bool castShadows) {
vExternalColor = externalColor;
castShadows = true;
return externalColor;
}`),r.code.add(b`void readExternalColor(out vec4 color, out int colorMixMode) {
color = vExternalColor;
colorMixMode = externalColorMixMode;
}
void outputObjectAndLayerIdColor() {
fragColor = vec4(1.0,0.0,0.0,0.0);
}`)}var ph;function vvt(t,e){const r=t.vertex;switch(r.code.add(b`#define VERTEX_DISCARD_CUTOFF (1.0 - 1.0 / 255.0)`),e.vertexDiscardMode){case ph.None:r.code.add(b`#define vertexDiscardByOpacity(_opacity_) {}`);break;case ph.Opaque:r.code.add(b`#define vertexDiscardByOpacity(_opacity_) { if (_opacity_ >  VERTEX_DISCARD_CUTOFF) {  gl_Position = vec4(1e38, 1e38, 1e38, 1.0); return; } }`);break;case ph.Transparent:r.code.add(b`#define vertexDiscardByOpacity(_opacity_) { if (_opacity_ <= VERTEX_DISCARD_CUTOFF) {  gl_Position = vec4(1e38, 1e38, 1e38, 1.0); return; } }`)}}(function(t){t[t.None=0]="None",t[t.Transparent=1]="Transparent",t[t.Opaque=2]="Opaque",t[t.COUNT=3]="COUNT"})(ph||(ph={}));var Nf;function P6t(t){return t&&Qf(t)?Nf.Mars:t&&Kf(t)?Nf.Moon:Nf.Earth}(function(t){t[t.Earth=1]="Earth",t[t.Mars=2]="Mars",t[t.Moon=3]="Moon",t[t.COUNT=4]="COUNT"})(Nf||(Nf={}));var eu;(function(t){t[t.None=0]="None",t[t.NoOverlay=1]="NoOverlay",t[t.ColorOverlay=2]="ColorOverlay",t[t.ColorOverlayWithWater=3]="ColorOverlayWithWater",t[t.COUNT=4]="COUNT"})(eu||(eu={}));let hr=class extends pa{constructor(){super(...arguments),this.output=N.Color,this.textureCoordinateType=Ps.None,this.componentData=Df.Uniform,this.cullFace=pi.Back,this.vertexDiscardMode=ph.None,this.doubleSidedMode=Ji.WindingOrder,this.alphaDiscardMode=Yr.Opaque,this.integratedMeshMode=eu.None,this.transparencyPassType=ot.NONE,this.ellipsoidMode=Nf.Earth,this.pbrMode=st.Disabled,this.normalType=Or.Attribute,this.spherical=!1,this.doublePrecisionRequiresObfuscation=!1,this.hasVertexColors=!1,this.hasNormals=!1,this.hasSlicePlane=!1,this.hasBaseColorTexture=!1,this.receiveAmbientOcclusion=!0,this.receiveShadows=!0,this.blendingEnabled=!0,this.hasScreenSpaceReflections=!1,this.hasPolygonOffset=!1,this.hasMetallicRoughnessTexture=!1,this.hasEmissionTexture=!1,this.hasOcclusionTexture=!1,this.hasNormalTexture=!1,this.hasOccludees=!1,this.hasMultipassTerrain=!1,this.cullAboveGround=!1,this.hasCloudsReflections=!0,this.snowCover=!1,this.objectAndLayerIdColor=!1}};u([B({count:N.COUNT})],hr.prototype,"output",void 0),u([B({count:Ps.COUNT})],hr.prototype,"textureCoordinateType",void 0),u([B({count:Df.COUNT})],hr.prototype,"componentData",void 0),u([B({count:pi.COUNT})],hr.prototype,"cullFace",void 0),u([B({count:ph.COUNT})],hr.prototype,"vertexDiscardMode",void 0),u([B({count:Ji.COUNT})],hr.prototype,"doubleSidedMode",void 0),u([B({count:Yr.COUNT})],hr.prototype,"alphaDiscardMode",void 0),u([B({count:eu.COUNT})],hr.prototype,"integratedMeshMode",void 0),u([B({count:ot.COUNT})],hr.prototype,"transparencyPassType",void 0),u([B({count:Nf.COUNT})],hr.prototype,"ellipsoidMode",void 0),u([B({count:st.COUNT})],hr.prototype,"pbrMode",void 0),u([B({count:Or.COUNT})],hr.prototype,"normalType",void 0),u([B()],hr.prototype,"spherical",void 0),u([B()],hr.prototype,"doublePrecisionRequiresObfuscation",void 0),u([B()],hr.prototype,"hasVertexColors",void 0),u([B()],hr.prototype,"hasNormals",void 0),u([B()],hr.prototype,"hasSlicePlane",void 0),u([B()],hr.prototype,"hasBaseColorTexture",void 0),u([B()],hr.prototype,"receiveAmbientOcclusion",void 0),u([B()],hr.prototype,"receiveShadows",void 0),u([B()],hr.prototype,"blendingEnabled",void 0),u([B()],hr.prototype,"hasScreenSpaceReflections",void 0),u([B()],hr.prototype,"hasPolygonOffset",void 0),u([B()],hr.prototype,"hasMetallicRoughnessTexture",void 0),u([B()],hr.prototype,"hasEmissionTexture",void 0),u([B()],hr.prototype,"hasOcclusionTexture",void 0),u([B()],hr.prototype,"hasNormalTexture",void 0),u([B()],hr.prototype,"hasOccludees",void 0),u([B()],hr.prototype,"hasMultipassTerrain",void 0),u([B()],hr.prototype,"cullAboveGround",void 0),u([B()],hr.prototype,"hasCloudsReflections",void 0),u([B()],hr.prototype,"snowCover",void 0),u([B()],hr.prototype,"objectAndLayerIdColor",void 0),u([B({constValue:Qr.Draw})],hr.prototype,"pbrTextureBindType",void 0),u([B({constValue:!0})],hr.prototype,"hasSliceHighlight",void 0),u([B({constValue:!1})],hr.prototype,"hasSliceInVertexProgram",void 0),u([B({constValue:!1})],hr.prototype,"useCustomDTRExponentForWater",void 0),u([B({constValue:!1})],hr.prototype,"hasVertexTangents",void 0),u([B({constValue:!0})],hr.prototype,"supportsTextureAtlas",void 0),u([B({constValue:!1})],hr.prototype,"highStepCount",void 0),u([B({constValue:!1})],hr.prototype,"instancedDoublePrecision",void 0),u([B({constValue:!0})],hr.prototype,"useFillLights",void 0),u([B({constValue:!1})],hr.prototype,"objectAndLayerIdColorInstanced",void 0);function Wce(t,e){t.include(Bw,e),t.fragment.include(aR);const r=t.fragment;r.uniforms.add(new Y4("baseColor",i=>i.baseColor)),r.uniforms.add(new Db("objectOpacity",i=>i.objectOpacity)),e.hasVertexColors?r.code.add(b`vec3 _baseColor() {
return baseColor.rgb * vColor.rgb;
}
float _baseOpacity() {
return baseColor.a * vColor.a;
}`):r.code.add(b`vec3 _baseColor() {
return baseColor.rgb;
}
float _baseOpacity() {
return baseColor.a;
}`),r.code.add(b`vec4 computeMaterialColor(vec4 textureColor, vec4 externalColor, int externalColorMixMode) {
vec3 baseColor = _baseColor();
float baseOpacity = _baseOpacity();
vec3 color = mixExternalColor(
baseColor,
textureColor.rgb,
externalColor.rgb,
externalColorMixMode
);
float opacity = objectOpacity * mixExternalOpacity(
baseOpacity,
textureColor.a,
externalColor.a,
externalColorMixMode
);
return vec4(color, opacity);
}`)}function Zce(t,e){const r=t.fragment;switch(e.doubleSidedMode){case Ji.None:r.code.add(b`vec3 _adjustDoublesided(vec3 normal) {
return normal;
}`);break;case Ji.View:t.include(LS,e),r.code.add(b`vec3 _adjustDoublesided(vec3 normal) {
return dot(normal, vPositionWorldCameraRelative) > 0.0 ? -normal : normal;
}`);break;case Ji.WindingOrder:r.code.add(b`vec3 _adjustDoublesided(vec3 normal) {
return gl_FrontFacing ? normal : -normal;
}`);break;default:e.doubleSidedMode;case Ji.COUNT:}switch(e.normalType){case Or.Attribute:case Or.Compressed:t.include(b6,e),r.code.add(b`vec3 shadingNormalWorld() {
return _adjustDoublesided(normalize(vNormalWorld));
}
vec3 shadingNormal_view() {
vec3 normal = normalize(vNormalView);
return gl_FrontFacing ? normal : -normal;
}`);break;case Or.ScreenDerivative:t.include(LS,e),r.code.add(b`vec3 shadingNormalWorld() {
return normalize(cross(
dFdx(vPositionWorldCameraRelative),
dFdy(vPositionWorldCameraRelative)
));
}
vec3 shadingNormal_view() {
return normalize(cross(dFdx(vPosition_view),dFdy(vPosition_view)));
}`);break;case Or.Ground:e.spherical?(t.include(LS,e),r.code.add(b`vec3 shadingNormalWorld() {
return normalize(positionWorld());
}`)):r.code.add(b`vec3 shadingNormalWorld() {
return vec3(0.0, 0.0, 1.0);
}`),r.code.add(b`vec3 shadingNormal_view() {
return normalize(cross(dFdx(vPosition_view),dFdy(vPosition_view))).xyz;
}`);break;default:e.normalType;case Or.COUNT:}}function bvt(t,e){const r=t.fragment;if(e.hasBaseColorTexture&&(e.output===N.Color||e.alphaDiscardMode!==Yr.Opaque)){t.include(MX,e);const i=e.textureCoordinateType===Ps.Atlas;r.uniforms.add(new bh("baseColorTexture",s=>s.texture)),i?(t.include(Dwe),r.code.add(b`vec4 readBaseColorTexture() {
return textureAtlasLookup(baseColorTexture, vuv0, vuvRegion);
}`)):r.code.add(b`vec4 readBaseColorTexture() {
return texture(baseColorTexture, vuv0);
}`)}else r.code.add(b`vec4 readBaseColorTexture() { return vec4(1.0); }`)}function wvt(t){const e=new wr;e.include(LS,t),e.include(b6,t),e.include(Bw,t),e.include(Pf,t),e.include(mE,t),e.include(gvt,t),e.include(Uct,t),e.include(unt,t),e.include(bvt,t),e.include(vvt,t);const{vertex:r,fragment:i}=e;t.pbrMode!==st.Normal&&t.pbrMode!==st.Schematic||(e.include($X,t),t.hasNormalTexture&&e.include(tCe,t));const s=t.output===N.Shadow||t.output===N.ShadowHighlight||t.output===N.ShadowExcludeHighlight;s&&t.componentData===Df.Varying?r.code.add(b`#define discardShadows(castShadows) { if(!castShadows) { gl_Position = vec4(1e38, 1e38, 1e38, 1.0); return; } }`):r.code.add(b`#define discardShadows(castShadows) {}`);const n=t.integratedMeshMode===eu.ColorOverlay||t.integratedMeshMode===eu.ColorOverlayWithWater,o=n&&t.output===N.Color&&t.pbrMode===st.WaterOnIntegratedMesh;return n&&(e.include(_w,t),e.include(b0t,t),t.spherical?r.code.add(b`
      const float invEllipsoidRadius = ${b.float(1/(t.ellipsoidMode===Nf.Earth?nr.radius:t.ellipsoidMode===Nf.Mars?Af.radius:$g.radius))};
      vec2 projectOverlay(vec3 pos) {
        return pos.xy / (1.0 + invEllipsoidRadius * pos.z);
      }
      `):r.code.add(b`vec2 projectOverlay(vec3 pos) { return pos.xy; }`)),o&&(e.varyings.add("tbnTangent","vec3"),e.varyings.add("tbnBiTangent","vec3"),e.varyings.add("groundNormal","vec3")),r.code.add(b`
    void main() {
      bool castShadows;
      vec4 externalColor = forwardExternalColor(castShadows);
      discardShadows(castShadows);

      vertexDiscardByOpacity(externalColor.a);

      ${t.output===N.ObjectAndLayerIdColor?b`externalColor.a = 1.0;`:""}

      if (externalColor.a < ${b.float(go)}) {
        // Discard this vertex
        gl_Position = vec4(1e38, 1e38, 1e38, 1.0);
        return;
      }

      forwardPosition(readElevationOffset());
      forwardNormal();
      forwardTextureCoordinates();
      forwardVertexColor();
      forwardLinearDepth();
      ${t.output===N.ObjectAndLayerIdColor?b`forwardObjectAndLayerIdColor();`:""}
      ${o?t.spherical?b`
                groundNormal = normalize(positionWorld());
                tbnTangent = normalize(cross(vec3(0.0, 0.0, 1.0), groundNormal));
                tbnBiTangent = normalize(cross(groundNormal, tbnTangent));`:b`
                groundNormal = vec3(0.0, 0.0, 1.0);
                tbnTangent = vec3(1.0, 0.0, 0.0);
                tbnBiTangent = vec3(0.0, 1.0, 0.0);`:""}
      ${n?b`setOverlayVTC(projectOverlay(position));`:""}
    }
  `),t.output===N.Alpha&&(i.include(_u),e.include(vu,t),e.include(Wce,t),n&&i.uniforms.add(new Je("ovColorTex",(a,l)=>UH(a,l))),i.code.add(b`
      void main() {
        discardBySlice(vPositionWorldCameraRelative);
        ${t.hasMultipassTerrain?b`terrainDepthTest(gl_FragCoord, vPosition_view.z);`:""}

        vec4 textureColor = readBaseColorTexture();
        discardOrAdjustAlpha(textureColor);

        vec4 externalColor;
        int externalColorMixMode;
        readExternalColor(externalColor, externalColorMixMode);

        vec4 materialColor = computeMaterialColor(
          textureColor,
          externalColor,
          externalColorMixMode
        );
        ${n?b`
                vec4 overlayColor = getOverlayColor(ovColorTex, vtcOverlay);
                materialColor = materialColor * (1.0 - overlayColor.a) + overlayColor;`:""}

        fragColor = vec4(materialColor.a);
      }
    `)),t.output===N.Color&&(i.include(_u),e.include(vu,t),e.include(Wce,t),e.include(Zce,t),e.include(_w,t),t.receiveShadows?(e.include(w6,t),i.code.add(b`float evaluateShadow() {
return readShadowMap(vPositionWorldCameraRelative, linearDepth);
}`)):i.code.add(b`float evaluateShadow() { return 0.0; }`),n&&i.uniforms.add(new Je("ovColorTex",(a,l)=>UH(a,l))),i.code.add(b`
      void main() {
        discardBySlice(vPositionWorldCameraRelative);
        ${t.hasMultipassTerrain?b`terrainDepthTest(gl_FragCoord, vPosition_view.z);`:""}

        vec4 textureColor = readBaseColorTexture();
        discardOrAdjustAlpha(textureColor);

        vec4 externalColor;
        int externalColorMixMode;
        readExternalColor(externalColor, externalColorMixMode);

        vec4 materialColor = computeMaterialColor(
          textureColor,
          externalColor,
          externalColorMixMode
        );
        ${n?b`vec4 overlayColor = getOverlayColor(ovColorTex, vtcOverlay);`:""}
    `),t.pbrMode===st.Normal||t.pbrMode===st.Schematic?(im(i),i.code.add(b`
        ${t.pbrMode===st.Normal?b`
                applyPBRFactors();
                if (int(externalColorMixMode) == 3) {
                  mrr = vec3(0.0, 0.6, 0.2);
                }`:""}
        vec3 normalVertex = shadingNormalWorld();
        float additionalIrradiance = 0.02 * mainLightIntensity[2];
      `),t.hasNormalTexture?i.code.add(b`mat3 tangentSpace = computeTangentSpace(normalVertex, vPositionWorldCameraRelative, vuv0);
vec3 shadingNormal = computeTextureNormal(tangentSpace, vuv0);`):i.code.add(b`vec3 shadingNormal = normalVertex;`),i.code.add(b`${t.spherical?b`vec3 normalGround = normalize(positionWorld());`:b`vec3 normalGround = vec3(0.0, 0.0, 1.0);`}
      `),i.code.add(b`
        vec3 viewDir = normalize(vPositionWorldCameraRelative);
        float ssao = 1.0 - occlusion * (1.0 - evaluateAmbientOcclusion());

        ${t.snowCover?b`
                vec3 surfaceNormal = normalize(shadingNormalWorld());
                float snow = smoothstep(0.5, 0.55, dot(surfaceNormal, normalize(positionWorld())));
                materialColor.rgb = mix(materialColor.rgb, vec3(1), snow);

                shadingNormal = mix(shadingNormal, surfaceNormal, snow);
                ssao = mix(ssao, 0.0, snow);
                mrr = mix(mrr, vec3(0.0, 1.0, 0.04), snow);
                emission = mix(emission, vec3(0.0), snow);`:""}

        ${n?b` materialColor = materialColor * (1.0 - overlayColor.a) + overlayColor;`:""}

        vec3 additionalLight = evaluateAdditionalLighting(ssao, positionWorld());
        vec4 shadedColor = vec4(evaluateSceneLightingPBR(shadingNormal, materialColor.rgb, evaluateShadow(), ssao, additionalLight, viewDir, normalGround, mrr, emission, additionalIrradiance), materialColor.a);
        `)):(t.receiveShadows?i.code.add(b`float shadow = evaluateShadow();`):t.spherical?(SE(i),i.code.add(b`float additionalAmbientScale = additionalDirectedAmbientLight(positionWorld());
float shadow = lightingGlobalFactor * (1.0 - additionalAmbientScale);`)):i.code.add(b`float shadow = 0.0;`),o&&i.uniforms.add(new Je("ovNormalTex",(a,l)=>kJ(l))),t.snowCover&&i.code.add(b`vec3 surfaceNormal = normalize(cross(dFdx(vPositionWorldCameraRelative), dFdy(vPositionWorldCameraRelative)));
float snow = smoothstep(0.5, 0.55, dot(surfaceNormal, normalize(positionWorld())));
materialColor.rgb = mix(materialColor.rgb, vec3(1), snow);`),i.code.add(b`
        float ambientOcclusion = evaluateAmbientOcclusion();
        vec3 additionalLight = evaluateAdditionalLighting(ambientOcclusion, positionWorld());

        ${n?b` materialColor = materialColor * (1.0 - overlayColor.a) + overlayColor;`:""}

        vec4 shadedColor = vec4(evaluateSceneLighting(shadingNormalWorld(), materialColor.rgb, shadow, ambientOcclusion, additionalLight), materialColor.a);
      ${o?b`
              vec4 overlayWaterMask = getOverlayColor(ovNormalTex, vtcOverlay);
              float waterNormalLength = length(overlayWaterMask);
              if (waterNormalLength > 0.95) {
                mat3 tbnMatrix = mat3(tbnTangent, tbnBiTangent, groundNormal);
                vec4 waterColorLinear = getOverlayWaterColor(overlayWaterMask, overlayColor, -normalize(vPositionWorldCameraRelative), shadow, groundNormal, tbnMatrix, vPosition_view, positionWorld());
                vec4 waterColorNonLinear = delinearizeGamma(vec4(waterColorLinear.xyz, 1.0));
                // un-gamma the ground color to mix in linear space
                shadedColor = mix(shadedColor, waterColorNonLinear, waterColorLinear.w);
              }`:""}
      `)),i.code.add(b`
        fragColor = highlightSlice(shadedColor, vPositionWorldCameraRelative);
        ${t.transparencyPassType===ot.Color?"fragColor = premultiplyAlpha(fragColor);":""}
      }
    `)),(t.output===N.Depth||s)&&(e.include(jg,t),i.code.add(b`void main() {
discardBySlice(vPositionWorldCameraRelative);
vec4 textureColor = readBaseColorTexture();
discardOrAdjustAlpha(textureColor);
outputDepth(linearDepth);
}`)),t.output===N.Normal&&(e.include(Zce,t),i.code.add(b`
      void main() {
        discardBySlice(vPositionWorldCameraRelative);

        vec4 textureColor = readBaseColorTexture();
        discardOrAdjustAlpha(textureColor);

        // note: the alpha component needs to be 1.0 in order for this material
        // to influence ambient occlusion, see the ssao fragment shader
        float alpha = ${t.normalType===Or.Ground?"0.0":"1.0"};
        fragColor = vec4(vec3(.5) + .5 * shadingNormal_view(), alpha);
      }
    `)),t.output===N.ObjectAndLayerIdColor&&e.fragment.code.add(b`
      void main() {
        discardBySlice(vPositionWorldCameraRelative);

        vec4 textureColor = readBaseColorTexture();
        discardOrAdjustAlpha(textureColor);

        ${n?b`fragColor = getOverlayColorTexel(vtcOverlay);`:"outputObjectAndLayerIdColor();"}
      }
    `),t.output===N.Highlight&&(e.include(ny,t),i.code.add(b`
      void main() {
        discardBySlice(vPositionWorldCameraRelative);

        vec4 textureColor = readBaseColorTexture();
        discardOrAdjustAlpha(textureColor);

        ${n?b`
                vec4 overlayColor = getCombinedOverlayColor();
                if (overlayColor.a == 0.0) {
                  fragColor = vec4(0.0);
                  return;
                }`:""}

        outputHighlight();
      }
    `)),e}function kJ(t){return t.overlays.length===0?null:t.overlays[Pi.INNER].getValidTexture(rs.Water)}const xvt=Object.freeze(Object.defineProperty({__proto__:null,build:wvt,getOverlayNormalTexture:kJ},Symbol.toStringTag,{value:"Module"}));let w3e=class x3e extends Pr{initializeConfiguration(e,r){r.spherical=e.viewingMode===De.Global,r.doublePrecisionRequiresObfuscation=e.rctx.driverTest.doublePrecisionRequiresObfuscation.result}initializeProgram(e){return new Cr(e.rctx,x3e.shader.get().build(this.configuration),T3e)}_setPipelineState(e){const r=this.configuration,i=r.integratedMeshMode!==eu.None,s=e===ot.NONE,n=e===ot.FrontFace;return At({blending:r.output!==N.Color&&r.output!==N.Alpha||!r.blendingEnabled?null:s?uu:oy(e),culling:F5(r.cullFace),depthTest:{func:rv(e)},depthWrite:s||n?Ol:null,colorWrite:Vt,stencilWrite:i||r.hasOccludees?Wf:null,stencilTest:i?vlt(Sl.IntegratedMeshMaskExcluded):r.hasOccludees?iv:null,polygonOffset:s||n?r.hasPolygonOffset?{factor:2,units:2}:null:h6})}initializePipeline(){return this._setPipelineState(this.configuration.transparencyPassType)}};w3e.shader=new Er(xvt,()=>ae(()=>import("./ComponentShader.glsl-3bd37f8c.js"),[],import.meta.url));const T3e=new Map([[E.POSITION,0],[E.NORMAL,1],[E.NORMALCOMPRESSED,1],[E.COLOR,2],[E.UV0,3],[E.UVREGION,4],[E.COMPONENTINDEX,5]]);let Tvt=class extends ei{constructor(){super(...arguments),this._dirty=!0}_setDirty(){this._dirty=!0}_setClean(){if(this._dirty=!1,this._parameterBlocks!=null)for(const e of this._parameterBlocks)this[e]._setClean()}get dirty(){return this._dirty||this._checkParameterBlocksDirty()}_checkParameterBlocksDirty(){if(this._parameterBlocks==null)return!1;for(const e of this._parameterBlocks)if(this[e].dirty)return!0;return!1}},VJ=class{constructor(){this._dirty=!0}_setDirty(){this._dirty=!0}_setClean(){this._dirty=!1}get dirty(){return this._dirty}};function es(t={}){return(e,r)=>{const i=e._parameterCount??0;if(e._parameterCount=i+1,t.vectorOps){const s=t.vectorOps;Object.defineProperty(e,r,{get(){return this[i]},set(n){const o=this[i];if(o==null)this[i]=n;else{if(s.equals(o,n))return;s.copy(o,n)}this._setDirty()}})}else Object.defineProperty(e,r,{get(){return this[i]},set(s){this[i]!==s&&(t.dispose&&this[i]&&this[i].dispose(),this[i]=s,this._setDirty())}})}}function Xce(){return(t,e)=>{const r=t._parameterCount??0;t._parameterCount=r+1,t._parameterBlocks=t._parameterBlocks||[],t._parameterBlocks.push(r),Object.defineProperty(t,e,{get(){return this[r]},set(i){this[r]!==i&&(this[r]=i,this._setDirty())}})}}let D6=class{constructor(e){this._low=C(),this._high=C(),e&&this.set(e)}get low(){return this._low}get high(){return this._high}set(e){ie(this._low,ie(Yce,e));const r=Cn(Yce,e,this._low);ie(this._high,r)}get(e){return ce(e,this._low,this._high)}getLowScaled(e){return te(e,this._low,1)}};const Yce=Hi();let zn=class extends Tvt{constructor(e,r){super(),this.toMapSpace=r,this.baseColor=Lt(1,1,1,1),this.usePBR=!1,this.hasParametersFromSource=!1,this.mrrFactors=Fa(T6),this.emissiveFactor=Oe(0,0,0),this.baseColorTexture=null,this.metallicRoughnessTexture=null,this.emissionTexture=null,this.occlusionTexture=null,this.normalTexture=null,this.objectOpacity=1,this.commonMaterialParameters=new TD,this.componentParameters=new uO,this.textureAlphaCutoff=R4,this.alphaDiscardMode=Yr.Opaque,this.isIntegratedMesh=!1,this.polygonOffsetEnabled=!1,this.ellipsoidMode=Nf.Earth,this.hasOccludees=!1,this._techniqueConfiguration=new hr;const i=new D6(e.position),s=rCe(e.rotationScale);Nw(s,s),this.transformNormalGlobalFromModel=I1e(Mh(s,s)),this.transformWorldFromModelTL=i.low,this.transformWorldFromModelTH=i.high,this.transformWorldFromModelRS=e.rotationScale}dispose(){this._technique=Ui(this._technique),this.baseColorTexture=null,this.metallicRoughnessTexture=null,this.emissionTexture=null,this.occlusionTexture=null,this.normalTexture=null}get texture(){return this.baseColorTexture!=null?this.baseColorTexture.glTexture:null}get textureMetallicRoughness(){return this.metallicRoughnessTexture!=null?this.metallicRoughnessTexture.glTexture:null}get textureEmissive(){return this.emissionTexture!=null?this.emissionTexture.glTexture:null}get textureOcclusion(){return this.occlusionTexture!=null?this.occlusionTexture.glTexture:null}get textureNormal(){return this.normalTexture!=null?this.normalTexture.glTexture:null}prepareTechnique(e,r,i,s){const n=this._techniqueConfiguration;n.hasVertexColors=s.colors,n.hasNormals=s.normals,n.textureCoordinateType=s.textureCoordinates,n.hasMetallicRoughnessTexture=this.metallicRoughnessTexture!=null,n.hasEmissionTexture=this.emissionTexture!=null,n.hasOcclusionTexture=this.occlusionTexture!=null,n.hasNormalTexture=this.normalTexture!=null,n.transparencyPassType=r.identifier===cc.Material&&i.transparencyPassType!=null?i.transparencyPassType:ot.NONE,n.hasMultipassTerrain=r.identifier===cc.Material&&i.multipassTerrain!=null&&i.multipassTerrain.enabled,n.cullAboveGround=r.identifier===cc.Material&&i.multipassTerrain!=null&&i.multipassTerrain.cullAboveGround,n.ellipsoidMode=this.ellipsoidMode,n.componentData=this.componentParameters.type,n.cullFace=this.commonMaterialParameters.cullFace,n.doubleSidedMode=this.commonMaterialParameters.doubleSided?Ji.View:Ji.None,n.hasBaseColorTexture=this.baseColorTexture!=null;const o=this._computeWhichMaterialPass();n.blendingEnabled=o===Ia.Transparent||o===Ia.OpaqueAndTransparent,n.alphaDiscardMode=this.alphaDiscardMode,n.integratedMeshMode=this.isIntegratedMesh?Evt(i)?kJ(i)?eu.ColorOverlayWithWater:eu.ColorOverlay:eu.NoOverlay:eu.None,n.hasPolygonOffset=this.polygonOffsetEnabled;const a=this.hasParametersFromSource&&this.baseColorTexture==null;if(n.pbrMode=n.integratedMeshMode===eu.ColorOverlayWithWater?st.WaterOnIntegratedMesh:this.usePBR?a?st.Schematic:st.Normal:st.Disabled,n.normalType=n.integratedMeshMode===eu.None?n.hasNormals?Or.Compressed:Or.ScreenDerivative:Or.Ground,n.hasSlicePlane=i.slicePlane!=null&&this.commonMaterialParameters.hasSlicePlane,r.identifier===cc.ShadowMap)n.output=N.Shadow,n.vertexDiscardMode=ph.None;else if(r.identifier===cc.Highlight)n.output=N.Highlight,n.vertexDiscardMode=ph.None;else{switch(this._computeWhichMaterialPass()===Ia.OpaqueAndTransparent?n.vertexDiscardMode=r.transparent?ph.Opaque:ph.Transparent:n.vertexDiscardMode=ph.None,n.output=r.output,n.receiveAmbientOcclusion=!1,n.receiveShadows=!1,r.output){case N.Color:n.receiveAmbientOcclusion=i.ssaoHelper.active,n.hasOccludees=i.hasOccludees,n.receiveShadows=i.shadowMap.ready,n.hasScreenSpaceReflections=i.ssr.enabled,n.hasCloudsReflections=i.cloudsFade.data!=null;break;case N.Alpha:n.hasOccludees=i.hasOccludees;break;case N.ObjectAndLayerIdColor:n.objectAndLayerIdColor=!0}n.snowCover=this.hasSnowCover(i)}return this._technique=e.releaseAndAcquire(w3e,n,this._technique),this._setClean(),this._technique}hasSnowCover(e){return e.weather!=null&&e.weatherVisible&&e.weather.type==="snowy"&&e.weather.snowCover==="enabled"}submit(e,r,i){if(this.objectOpacity===0)return;const s=i.renderable.geometry,n=i.components,o=i.renderable.meta.cameraDepthSquared,a=n.geometryRanges,l=n.highlightRanges,c=n.defaultShadowMapRanges;switch(this._computeWhichMaterialPass()){case Ia.Opaque:e.materialOpaque.submitDraw(this,s,a,o);break;case Ia.Transparent:e.materialTransparent.submitDraw(this,s,a,o);break;case Ia.OpaqueAndTransparent:e.materialOpaque.submitDraw(this,s,a,o),e.materialTransparent.submitDraw(this,s,a,o);break;case Ia.IntegratedMesh:e.materialIntegratedMesh.submitDraw(this,s,a,o),Svt(r)&&e.highlightIntegratedMesh.submitDraw(this,s,a,o)}const h=this.componentParameters.castShadows!==En.None;h&&e.shadowMap.submitDraw(this,s,a,o),l!=null&&(e.highlight.submitDraw(this,s,l,o),h&&e.highlightShadowMap.submitDraw(this,s,l,o)),h&&c!=null&&e.defaultShadowMap.submitDraw(this,s,c,o)}_computeWhichMaterialPass(){return this.isIntegratedMesh?Ia.IntegratedMesh:this.objectOpacity<1?Ia.Transparent:this.componentParameters.opaqueOverride===En.All?Ia.Opaque:this.baseColor[3]<1||this.alphaDiscardMode===Yr.Blend||this.alphaDiscardMode===Yr.MaskBlend?Ia.Transparent:this.componentParameters.transparent===En.None?Ia.Opaque:this.componentParameters.transparent===En.All?Ia.Transparent:Ia.OpaqueAndTransparent}};var Ia,En;u([es({vectorOps:Mfe})],zn.prototype,"baseColor",void 0),u([es()],zn.prototype,"usePBR",void 0),u([es()],zn.prototype,"hasParametersFromSource",void 0),u([es({vectorOps:hK})],zn.prototype,"mrrFactors",void 0),u([es({vectorOps:hK})],zn.prototype,"emissiveFactor",void 0),u([es({dispose:!0})],zn.prototype,"baseColorTexture",void 0),u([es({dispose:!0})],zn.prototype,"metallicRoughnessTexture",void 0),u([es({dispose:!0})],zn.prototype,"emissionTexture",void 0),u([es({dispose:!0})],zn.prototype,"occlusionTexture",void 0),u([es({dispose:!0})],zn.prototype,"normalTexture",void 0),u([es()],zn.prototype,"objectOpacity",void 0),u([Xce()],zn.prototype,"commonMaterialParameters",void 0),u([Xce()],zn.prototype,"componentParameters",void 0),u([es()],zn.prototype,"textureAlphaCutoff",void 0),u([es()],zn.prototype,"alphaDiscardMode",void 0),u([es()],zn.prototype,"isIntegratedMesh",void 0),u([es()],zn.prototype,"polygonOffsetEnabled",void 0),u([es()],zn.prototype,"ellipsoidMode",void 0),u([es()],zn.prototype,"hasOccludees",void 0),function(t){t[t.Opaque=0]="Opaque",t[t.Transparent=1]="Transparent",t[t.OpaqueAndTransparent=2]="OpaqueAndTransparent",t[t.IntegratedMesh=3]="IntegratedMesh"}(Ia||(Ia={}));let TD=class extends VJ{constructor(){super(...arguments),this.doubleSided=!1,this.cullFace=pi.Back,this.hasSlicePlane=!0}};u([es()],TD.prototype,"doubleSided",void 0),u([es()],TD.prototype,"cullFace",void 0),u([es()],TD.prototype,"hasSlicePlane",void 0);let uO=class extends VJ{constructor(){super(...arguments),this.externalColor=Lt(1,1,1,1),this.externalColorMixMode=Us.Multiply,this.castShadows=En.All}get transparent(){return this.externalColor[3]<1?En.All:En.None}get opaqueOverride(){return this.externalColorMixMode===Us.Replace&&this.externalColor[3]===1?En.All:En.None}get visible(){return this.externalColor[3]>0?En.All:En.None}get type(){return Df.Uniform}};u([es({vectorOps:Mfe})],uO.prototype,"externalColor",void 0),u([es()],uO.prototype,"externalColorMixMode",void 0),u([es()],uO.prototype,"castShadows",void 0),function(t){t[t.All=0]="All",t[t.Some=1]="Some",t[t.None=2]="None"}(En||(En={}));let c3=class extends VJ{constructor(){super(...arguments),this.texture=null,this.transparent=En.None,this.opaqueOverride=En.None,this.castShadows=En.None}get type(){return Df.Varying}};function Svt(t){return t.overlays.length!==0&&t.overlays[Pi.INNER].getValidTexture(rs.Highlight)!=null}function Evt(t){return t.overlays.length!==0&&t.overlays[Pi.INNER].getColorTextureNoRasterImage()!=null}u([es()],c3.prototype,"texture",void 0),u([es()],c3.prototype,"transparent",void 0),u([es()],c3.prototype,"opaqueOverride",void 0),u([es()],c3.prototype,"castShadows",void 0);const tF=zi().vec3f(E.POSITION).u16(E.COMPONENTINDEX).u16(E.U16PADDING),S3e=zi().vec2u8(E.SIDENESS),Cvt=Cc(S3e),E3e=zi().vec3f(E.POSITION0).vec3f(E.POSITION1).u16(E.COMPONENTINDEX).u8(E.VARIANTOFFSET,{glNormalized:!0}).u8(E.VARIANTSTROKE).u8(E.VARIANTEXTENSION,{glNormalized:!0}).u8(E.U8PADDING,{glPadding:!0}).u16(E.U16PADDING,{glPadding:!0}),YH=E3e.clone().vec3f(E.NORMAL),JH=E3e.clone().vec3f(E.NORMALA).vec3f(E.NORMALB),C3e=new Map([[E.POSITION0,0],[E.POSITION1,1],[E.COMPONENTINDEX,2],[E.VARIANTOFFSET,3],[E.VARIANTSTROKE,4],[E.VARIANTEXTENSION,5],[E.NORMAL,6],[E.NORMALA,6],[E.NORMALB,7],[E.SIDENESS,8]]);function Jce(t,e,r){const i=e/3,s=new Uint32Array(r+1),n=new Uint32Array(r+1),o=(w,x)=>{w<x?s[w+1]++:n[x+1]++};for(let w=0;w<i;w++){const x=t[3*w],T=t[3*w+1],S=t[3*w+2];o(x,T),o(T,S),o(S,x)}let a=0,l=0;for(let w=0;w<r;w++){const x=s[w+1],T=n[w+1];s[w+1]=a,n[w+1]=l,a+=x,l+=T}const c=new Uint32Array(6*i),h=s[r],p=(w,x,T)=>{if(w<x){const S=s[w+1]++;c[2*S]=x,c[2*S+1]=T}else{const S=n[x+1]++;c[2*h+2*S]=w,c[2*h+2*S+1]=T}};for(let w=0;w<i;w++){const x=t[3*w],T=t[3*w+1],S=t[3*w+2];p(x,T,w),p(T,S,w),p(S,x,w)}const f=(w,x)=>{const T=2*w,S=x-w;for(let O=1;O<S;O++){const A=c[T+2*O],I=c[T+2*O+1];let M=O-1;for(;M>=0&&c[T+2*M]>A;M--)c[T+2*M+2]=c[T+2*M],c[T+2*M+3]=c[T+2*M+1];c[T+2*M+2]=A,c[T+2*M+3]=I}};for(let w=0;w<r;w++)f(s[w],s[w+1]),f(h+n[w],h+n[w+1]);const m=new Int32Array(3*i),y=(w,x)=>w===t[3*x]?0:w===t[3*x+1]?1:w===t[3*x+2]?2:-1,_=(w,x)=>{const T=y(w,x);m[3*x+T]=-1},v=(w,x,T,S)=>{const O=y(w,x);m[3*x+O]=S;const A=y(T,S);m[3*S+A]=x};for(let w=0;w<r;w++){let x=s[w];const T=s[w+1];let S=n[w];const O=n[w+1];for(;x<T&&S<O;){const A=c[2*x],I=c[2*h+2*S];A===I?(v(w,c[2*x+1],I,c[2*h+2*S+1]),x++,S++):A<I?(_(w,c[2*x+1]),x++):(_(I,c[2*h+2*S+1]),S++)}for(;x<T;)_(w,c[2*x+1]),x++;for(;S<O;)_(c[2*h+2*S],c[2*h+2*S+1]),S++}return m}let A3e=class{updateSettings(e){this.settings=e,this._edgeHashFunction=e.reducedPrecision?Ovt:Avt}write(e,r,i){const s=this._edgeHashFunction(i);v$.seed=s;const n=v$.getIntRange(0,255),o=v$.getIntRange(0,this.settings.variants-1),a=.7,l=v$.getFloat(),c=255*(.5*Rvt(-(1-Math.min(l/a,1))+Math.max(0,l-a)/(1-a),1.2)+.5);e.position0.setVec(r,i.position0),e.position1.setVec(r,i.position1),e.componentIndex.set(r,i.componentIndex),e.variantOffset.set(r,n),e.variantStroke.set(r,o),e.variantExtension.set(r,c)}trim(e,r){return e.slice(0,r)}};const zJ=new Float32Array(6),rF=new Uint32Array(zJ.buffer),u_=new Uint32Array(1);function Avt(t){const e=zJ;e[0]=t.position0[0],e[1]=t.position0[1],e[2]=t.position0[2],e[3]=t.position1[0],e[4]=t.position1[1],e[5]=t.position1[2],u_[0]=5381;for(let r=0;r<rF.length;r++)u_[0]=31*u_[0]+rF[r];return u_[0]}function Ovt(t){const e=zJ;e[0]=Zx(t.position0[0]),e[1]=Zx(t.position0[1]),e[2]=Zx(t.position0[2]),e[3]=Zx(t.position1[0]),e[4]=Zx(t.position1[1]),e[5]=Zx(t.position1[2]),u_[0]=5381;for(let r=0;r<rF.length;r++)u_[0]=31*u_[0]+rF[r];return u_[0]}const Qce=1e4;function Zx(t){return Math.round(t*Qce)/Qce}function Rvt(t,e){const r=t<0?-1:1;return Math.abs(t)**e*r}let iF=class{constructor(){this._commonWriter=new A3e}updateSettings(e){this._commonWriter.updateSettings(e)}allocate(e){return YH.createBuffer(e)}write(e,r,i){this._commonWriter.write(e,r,i),ce(_$,i.faceNormal0,i.faceNormal1),me(_$,_$),e.normal.setVec(r,_$)}trim(e,r){return this._commonWriter.trim(e,r)}};iF.Layout=YH,iF.glLayout=Cc(YH,1);let sF=class{constructor(){this._commonWriter=new A3e}updateSettings(e){this._commonWriter.updateSettings(e)}allocate(e){return JH.createBuffer(e)}write(e,r,i){this._commonWriter.write(e,r,i),e.normalA.setVec(r,i.faceNormal0),e.normalB.setVec(r,i.faceNormal1)}trim(e,r){return this._commonWriter.trim(e,r)}};sF.Layout=JH,sF.glLayout=Cc(JH,1);const _$=C(),v$=new m3,j1=-1;var nF;function Pvt(t,e,r,i=Nvt){const s=t.vertices.position,n=t.vertices.componentIndex,o=Dt(i.anglePlanar),a=Dt(i.angleSignificantEdge),l=Math.cos(a),c=Math.cos(o),h=QH.edge,p=h.position0,f=h.position1,m=h.faceNormal0,y=h.faceNormal1,_=Dvt(t),v=Lvt(t),w=v.length/4,x=e.allocate(w);let T=0;const S=w,O=r.allocate(S);let A=0,I=0,M=0;const k=HOe(0,w),L=new Float32Array(w);L.forEach((G,Y,P)=>{s.getVec(v[4*Y],p),s.getVec(v[4*Y+1],f),P[Y]=di(p,f)}),k.sort((G,Y)=>L[Y]-L[G]);const D=new Array,U=new Array;for(let G=0;G<w;G++){const Y=k[G],P=L[Y],V=v[4*Y],z=v[4*Y+1],H=v[4*Y+2],Z=v[4*Y+3],J=Z===j1;if(s.getVec(V,p),s.getVec(z,f),J)se(m,_[3*H],_[3*H+1],_[3*H+2]),ie(y,m),h.componentIndex=n.get(V),h.cosAngle=fe(m,y);else{if(se(m,_[3*H],_[3*H+1],_[3*H+2]),se(y,_[3*Z],_[3*Z+1],_[3*Z+2]),h.componentIndex=n.get(V),h.cosAngle=fe(m,y),Ivt(h,c))continue;h.cosAngle<-.9999&&ie(y,m)}I+=P,M++,J||Mvt(h,l)?(e.write(x,T++,h),D.push(P)):$vt(h,o)&&(r.write(O,A++,h),U.push(P))}const X=new Float32Array(D.reverse()),W=new Float32Array(U.reverse());return{regular:{instancesData:e.trim(x,T),lodInfo:{lengths:X}},silhouette:{instancesData:r.trim(O,A),lodInfo:{lengths:W}},averageEdgeLength:I/M}}function Mvt(t,e){return t.cosAngle<e}function Ivt(t,e){return t.cosAngle>e}function $vt(t,e){const r=Pn(t.cosAngle),i=QH.fwd,s=QH.ortho;return Hg(i,t.position1,t.position0),r*(fe(at(s,t.faceNormal0,t.faceNormal1),i)>0?-1:1)>e}function Lvt(t){const e=t.faces.length/3,r=t.faces,i=t.neighbors;let s=0;for(let a=0;a<e;a++){const l=i[3*a],c=i[3*a+1],h=i[3*a+2],p=r[3*a],f=r[3*a+1],m=r[3*a+2];s+=l===j1||p<f?1:0,s+=c===j1||f<m?1:0,s+=h===j1||m<p?1:0}const n=new Int32Array(4*s);let o=0;for(let a=0;a<e;a++){const l=i[3*a],c=i[3*a+1],h=i[3*a+2],p=r[3*a],f=r[3*a+1],m=r[3*a+2];(l===j1||p<f)&&(n[o++]=p,n[o++]=f,n[o++]=a,n[o++]=l),(c===j1||f<m)&&(n[o++]=f,n[o++]=m,n[o++]=a,n[o++]=c),(h===j1||m<p)&&(n[o++]=m,n[o++]=p,n[o++]=a,n[o++]=h)}return n}function Dvt(t){const e=t.faces.length/3,r=t.vertices.position,i=t.faces,s=yk.v0,n=yk.v1,o=yk.v2,a=new Float32Array(3*e);for(let l=0;l<e;l++){const c=i[3*l],h=i[3*l+1],p=i[3*l+2];r.getVec(c,s),r.getVec(h,n),r.getVec(p,o),he(n,n,s),he(o,o,s),at(s,n,o),me(s,s),a[3*l]=s[0],a[3*l+1]=s[1],a[3*l+2]=s[2]}return a}(function(t){t[t.SOLID=0]="SOLID",t[t.SKETCH=1]="SKETCH"})(nF||(nF={}));const QH={edge:{position0:C(),position1:C(),faceNormal0:C(),faceNormal1:C(),componentIndex:0,cosAngle:0},ortho:C(),fwd:C()},yk={v0:C(),v1:C(),v2:C()},Nvt={anglePlanar:4,angleSignificantEdge:35};function Fvt(t){const e=Uvt(t.data,t.skipDeduplicate,t.indices,t.indicesLength);return Kce.updateSettings(t.writerSettings),eue.updateSettings(t.writerSettings),Pvt(e,Kce,eue)}function Uvt(t,e,r,i){if(e){const o=Jce(r,i,t.count);return new kvt(r,i,o,t)}const s=dH(t.buffer,t.stride/4,{originalIndices:r,originalIndicesLength:i}),n=Jce(s.indices,i,s.uniqueCount);return{faces:s.indices,facesLength:s.indices.length,neighbors:n,vertices:tF.createView(s.buffer)}}let kvt=class{constructor(e,r,i,s){this.faces=e,this.facesLength=r,this.neighbors=i,this.vertices=s}};const Kce=new iF,eue=new sF,G6t=zi().vec3f(E.POSITION0).vec3f(E.POSITION1),Vvt=zi().vec3f(E.POSITION0).vec3f(E.POSITION1).u16(E.COMPONENTINDEX).u16(E.U16PADDING,{glPadding:!0});let zvt=class{constructor(e){this._maxCount=e,this._nextIndex=0,this._recycledIndices=[]}get activeCount(){return this._nextIndex-this._recycledIndices.length}get availableCount(){return this._recycledIndices.length+this._maxCount-this._nextIndex}acquire(){return this._recycledIndices.length>0?this._recycledIndices.pop():this.availableCount?this._nextIndex++:void 0}release(e){this._recycledIndices.push(e)}},Bvt=class{constructor(e,r=1){this._rctx=e,this._fieldCount=r,this.textureWidth=4096,this._dirty=!0;const i=new vr;i.samplingMode=Ct.NEAREST,i.wrapMode=$t.CLAMP_TO_EDGE,i.width=this.textureWidth,i.height=1,this._texture=new Et(this._rctx,i),this._data=new ha(new ArrayBuffer(4*this.textureWidth))}dispose(){this._texture.dispose(),this._texture=void 0,this._data=void 0}setData(e,r,i,s,n,o){const a=e*this._fieldCount+r;this._dirty=!0,this._data.set(a,0,i),this._data.set(a,1,s),this._data.set(a,2,n),this._data.set(a,3,o)}setDataElement(e,r,i,s){const n=e*this._fieldCount+r;this._dirty=!0,this._data.set(n,i,s)}getDataElement(e,r,i){const s=e*this._fieldCount+r;return this._dirty=!0,this._data.get(s,i)}resizeToFit(e){const r=(e+1)*this._fieldCount;if(r>this._data.count){const i=Math.ceil(r/this.textureWidth)*this.textureWidth,s=new ha(new ArrayBuffer(4*i));s.typedBuffer.set(this._data.typedBuffer),this._data=s}}updateTexture(){if(!this._dirty)return;const e=this._texture.descriptor.width,r=this._texture.descriptor.height;this._data.count>e*r&&this._texture.resize(e,this._data.count/e),this._texture.setData(this._data.typedBuffer),this._dirty=!1}get texture(){return this._texture}};const O3e=65536;let Gvt=class{constructor(e,r=1){this.textureBuffer=new Bvt(e,r),this._indexManager=new zvt(O3e)}dispose(){this.textureBuffer.dispose(),this.textureBuffer=void 0}get availableCount(){return this._indexManager.availableCount}get activeCount(){return this._indexManager.activeCount}acquireIndex(){const e=this._indexManager.acquire();return this.textureBuffer.resizeToFit(e),e}releaseIndex(e){this._indexManager.release(e)}},R3e=class{constructor(e,r=1){this._rctx=e,this._fieldCount=r,this._buffers=[]}garbageCollect(){this._buffers=this._buffers.filter(e=>e.activeCount!==0||(e.dispose(),!1))}destroy(){this._buffers.forEach(e=>e.dispose()),this._buffers=[]}getBuffer(e){for(const i of this._buffers)if(i.availableCount>=e)return i;if(e>O3e)return null;const r=new Gvt(this._rctx,this._fieldCount);return this._buffers.push(r),r}updateTextures(){for(const e of this._buffers)e.textureBuffer.updateTexture()}};const tue=Q.getLogger("esri.views.3d.webgl-engine.collections.Component.ComponentObjectCollection");class jvt{constructor(e,r){this._renderManager=e,this._viewingMode=r,this._objects=[new kt,new kt],this._renderSubmit=new dvt(this),this._renderManager.register(this._renderSubmit),this._hasObjectAndLayerId=oe("enable-feature:objectAndLayerId-rendering"),this._componentBufferManager=new R3e(e.rctx,2+(this._hasObjectAndLayerId?1:0))}destroy(){et(this._objects[qS.Hidden].length===0&&this._objects[qS.Visible].length===0,"ObjectCollection should be empty upon disposal"),this._componentBufferManager.destroy();const e=this._objects.flatMap(r=>r.toArray());for(const r of e)r?.destroy()}createObject(e){const r=new l3;return r.toMapSpace=e.toMapSpace,r.transform=e.transform,r.obb=bre(e.obb),r.components=new q_t(this._componentBufferManager,If(e.geometry.componentOffsets)),r.renderable=this._createRenderable(e,r.components),r.intersectionGeometry=new K_t(e.geometry.positionData,r.components),this._objects[r.visible].push(r),r}destroyObject(e){const r=e;this._objects[r.visible].removeUnordered(r),r.destroy(),this._notifyDirty()}setObjectVisibility(e,r){const i=e;r!==i.visible&&(this._objects[i.visible].removeUnordered(i),this._objects[r].push(i),i.visible=r,this._notifyDirty())}preSubmit(e){const r=e.camera.eye;this.visibleObjects.forAll(i=>i.renderable.meta.cameraDepthSquared=yo(r,i.obb.center))}getMaterial(e){return e.renderable.material}updateMaterial(e,r){const i=e.renderable.material;r(i),i.dirty&&this._notifyDirty()}setAllComponentVisibilities(e,r){const i=e;i.components.visibility.reset(r),i.components.visibilityDirty(),this._notifyDirty()}forEachVisibleComponent(e,r){return e.components.visibility.forEachComponent(r)}getComponentCount(e){const r=e,i=r.components.visibility.componentCount();return{visible:i,invisible:r.components.count-i}}setComponentData(e,r){const i=e,s=i.renderable.material,n=i.components,o=n.materialDataBuffer,a=n.materialDataIndices,l=new fvt,c=o.textureBuffer,h=new Uint8Array(4),p=new Uint32Array(h.buffer);let f=0,m=0,y=0,_=n.verticalOffsets,v=1/0,w=-1/0,x=!1,T=!1,S=0;for(let O=0;O<n.count;O++){r(O,l),f+=+(l.externalColor[3]<1),m+=+(l.externalColorMixMode===Us.Replace&&l.externalColor[3]===1),y+=+l.castShadows,J1e(l.externalColor,l.externalColorMixMode,h),h[2]=254&h[2]|+l.castShadows,c.setData(a[O],0,h[0],h[1],h[2],h[3]),x||(x=O>0&&S!==p[0]),S=p[0],T||(T=l.elevationOffset!==0),T&&_==null&&(_=new Array(O).fill(0)),_!=null&&(_[O]=l.elevationOffset),v=Math.min(v,l.elevationOffset),w=Math.max(w,l.elevationOffset),b3e(l.elevationOffset,h),c.setData(a[O],1,h[0],h[1],h[2],h[3]);const A=l.objectAndLayerIdColor;A!=null&&c.setData(a[O],2,A[0],A[1],A[2],A[3]),l.pickable!==y3e(n.pickability,O)&&(n.pickability=Z_t(n.pickability,n.count,O,l.pickable))}n.verticalOffsets=T?_:null,i.offsetObb=T?tZe(i.obb,v,w,this._viewingMode,i.offsetObb!=null?i.offsetObb:bre(i.obb)):null,x||T||this._hasObjectAndLayerId?(s.componentParameters=new c3,s.componentParameters.castShadows=_k(y,n.count),s.componentParameters.transparent=_k(f,n.count),s.componentParameters.opaqueOverride=_k(m,n.count),s.componentParameters.texture=c,c.updateTexture()):(s.componentParameters=new uO,s.componentParameters.castShadows=l.castShadows?En.All:En.None,s.componentParameters.externalColor=l.externalColor,s.componentParameters.externalColorMixMode=l.externalColorMixMode),this._notifyDirty()}getComponentAabb(e,r,i,s=!1){e.intersectionGeometry.getComponentAabb(r,i);const n=e,o=n.components.verticalOffsets;if(s||o==null)return i;const a=o[r];if(this._viewingMode===De.Local||a===0)return i[2]+=a,i[5]+=a,i;const l=$et(a);return l.localOrigin=n.transform.position,l.applyToAabb(i)}getComponentObb(e){return e.obb}getObjectTransform(e){return e.transform}getComponentPositions(e,r,i){return e.intersectionGeometry.getComponentPositions(r,i)}intersect(e,r,i,s,n,o){const a=e;n!=null&&(n.localOrigin=a.transform.position);const l=Nw(rue,a.transform.rotationScale);Cn(b$,r,a.transform.position),Cn(w$,i,a.transform.position),hc(b$,b$,l),hc(w$,w$,l);const c=Mh(rue,l);return a.intersectionGeometry.intersect(b$,w$,s,c,n,a.components.verticalOffsets,o)}addEdges(e,r,i,s){const n=e,{indices:o,positions:a}=n.intersectionGeometry,l=n.components.offsets;return r.addComponentObject(e,n.transform,{center:n.obb.center,radius:eZe(n.obb)},a,o,l,i,s)}async extractEdgeInformation(e,r,i){const s=e,n=s.components.visibility;if(n.allInvisible())return{buffer:Vvt.createBuffer(0),origin:[0,0,0]};const{indices:o,positions:a}=s.intersectionGeometry,l=s.components.offsets,c=tF.createBuffer(a.length/3);gP(c.position.typedBuffer,a,c.position.typedBufferStride,3),Q2e(c.position,c.position,s.transform.rotationScale),this._setComponentIndices(c.componentIndex,o,l);const h=c.count,p=this._computeVisibilityIndices(o,n,l,h);return{origin:$s(s.transform.position),buffer:await r.extractComponentsEdgeLocations({indices:p,indicesLength:p.length,skipDeduplicate:!0,data:c,writerSettings:{reducedPrecision:!1,variants:0}},i)}}_setComponentIndices(e,r,i){let s=0;for(let n=0;n<i.length-1;n++){const o=i[n],a=i[n+1];for(let l=o;l<a;l++){const c=r?r[l]:l;e.set(c,s)}s++}}_computeVisibilityIndices(e,r,i,s){if(e&&r.allVisible())return e;let n=0;r.forEachComponentRange((l,c)=>(n+=i[c]-i[l],!0));const o=ip(e)?new Array(n):e?.BYTES_PER_ELEMENT===2||s<=65536?new Uint16Array(n):new Uint32Array(n);let a=0;return r.forEachComponentRange((l,c)=>{const h=i[l],p=i[c];for(let f=h;f<p;f++)o[a++]=e?e[f]:f;return!0}),o}addComponentHighlight(e,r){const i=e.components;i.highlightCounts==null&&(i.highlightCounts=new Uint32Array(i.count+1)),i.highlightCounts[r]++===0&&(i.highlightsDirty(),this._notifyDirty()),i.highlightCounts[i.count]++}removeComponentHighlight(e,r){const i=e.components;if(i.highlightCounts==null)return void tue.warn("Removing non-existing highlight.");const s=i.highlightCounts[r],n=i.highlightCounts[i.count];if(s!==0){if(s>1)return i.highlightCounts[r]=s-1,void(i.highlightCounts[i.count]=n-1);i.highlightCounts[r]=0,i.highlightsDirty(),this._notifyDirty(),n===1?i.highlightCounts=null:i.highlightCounts[i.count]=n-1}else tue.warn("Removing non-existing highlight.")}clearHighlights(e){const r=e.components;r.highlightCounts!=null&&(r.highlightCounts=null,r.highlightsDirty(),this._notifyDirty())}getObjectGPUMemoryUsage(e){return e.renderable.meta.gpuMemoryEstimate}get visibleObjects(){return this._objects[qS.Visible]}_createRenderable(e,r){const i=this._renderManager.rctx,s=e.geometry,n=s.vertices.layoutParameters,o=Lr.createVertex(i,Tr.STATIC_DRAW,s.vertices.data),a=uc(s.indices,_=>Lr.createIndex(i,Tr.STATIC_DRAW,_)),l=Cc(pvt(n)),c=new Uint16Array(s.vertices.count);for(let _=0;_<r.count;_++){const v=r.offsets[_],w=r.offsets[_+1],x=r.materialDataIndices[_];if(s.indices!=null)for(let T=v;T<w;T++)c[s.indices[T]]=x;else for(let T=v;T<w;T++)c[T]=x}const h=Lr.createVertex(i,Tr.STATIC_DRAW,c.buffer),p=new zn(e.transform,e.toMapSpace),f=new $h(i,T3e,{data:l,componentIndices:Hvt},{data:o,componentIndices:h},a),m=new ivt(f,St.TRIANGLES,n,a!=null),y={cameraDepthSquared:.5,gpuMemoryEstimate:o.byteLength+h.byteLength+(a!=null?a.byteLength:0)};return new rvt(p,m,y)}_notifyDirty(){this._renderManager.notifyDirty()}}const Hvt=Cc(zi().u16(E.COMPONENTINDEX));function _k(t,e){return t===e?En.All:t===0?En.None:En.Some}const rue=El(),b$=C(),w$=C();let P3e=class extends ei{constructor(){super(...arguments),this.scale=Ve()}};function qvt(t){const e=new wr;e.attributes.add(E.POSITION,"vec2"),e.varyings.add("uv0","vec2"),e.varyings.add("uv1","vec2"),e.vertex.uniforms.add(new Sr("scale",i=>i.scale)),e.vertex.code.add(b`void main(void) {
gl_Position = vec4(position, 0.0, 1.0);
uv0 = position * 0.5 + vec2(0.5);
uv1 = (position * 0.5 + vec2(0.5)) * scale;
}`),e.fragment.uniforms.add(new Je("tex",i=>i.texture),new Je("depthTexture",i=>i.depthTexture),new Sr("scale",i=>i.scale),new Sr("clampUV",i=>Wvt(i)));const r=t.haze;return e.fragment.code.add(b`
    void main() {
      ${r?b`vec4`:b`float`} depthSample = texture(depthTexture, uv0) ${r?"":b`.r`};
      if (depthSample ${r?b`== vec4(0)`:b`!= 1.0`} ) {
          fragColor = vec4(0);
          return;
      }
      fragColor = texture(tex, min(uv1, clampUV));
    }
    `),e}function Wvt(t){if(!t.texture)return iue;const e=or(iue,t.texture.descriptor.width,t.texture.descriptor.height),r=qZ(e,e,t.scale),i=$ve(r,r);return Fve(i,t.scale,i)}const iue=Ve(),Zvt=Object.freeze(Object.defineProperty({__proto__:null,AtmosphereCompositingPassParameters:P3e,build:qvt},Symbol.toStringTag,{value:"Module"}));let M3e=class I3e extends Pr{initializeProgram(e){return new Cr(e.rctx,I3e.shader.get().build(this.configuration),br)}initializePipeline(){return this.configuration.haze?At({blending:xo(we.ONE,we.ZERO,we.ONE_MINUS_SRC_COLOR,we.ONE),depthTest:{func:Kr.ALWAYS},colorWrite:Vt}):At({blending:Tc(we.SRC_ALPHA,we.ONE_MINUS_SRC_ALPHA),depthTest:{func:Kr.ALWAYS},colorWrite:Vt})}};M3e.shader=new Er(Zvt,()=>ae(()=>import("./AtmosphereCompositing.glsl-08615195.js"),[],import.meta.url));let $3e=class extends ei{constructor(){super(...arguments),this.opacity=1}};function Xvt(t){const e=new wr;return e.include(Uh),e.fragment.uniforms.add(new Je("tex",r=>r.texture)),t.hasOpacityFactor&&e.fragment.uniforms.add(new Re("opacity",r=>r.opacity)),e.fragment.code.add(b`
    void main() {
      fragColor = texture(tex, uv) ${t.hasOpacityFactor?"* opacity":""};
    }`),e}const Yvt=Object.freeze(Object.defineProperty({__proto__:null,CompositingPassParameters:$3e,build:Xvt},Symbol.toStringTag,{value:"Module"}));var oa;(function(t){t[t.None=0]="None",t[t.Alpha=1]="Alpha",t[t.PremultipliedAlpha=2]="PremultipliedAlpha",t[t.COUNT=3]="COUNT"})(oa||(oa={}));let KH=class extends pa{constructor(){super(...arguments),this.alphaMode=oa.None,this.hasOpacityFactor=!1}};u([B({count:oa.COUNT})],KH.prototype,"alphaMode",void 0),u([B()],KH.prototype,"hasOpacityFactor",void 0);let L3e=class D3e extends Pr{initializeProgram(e){return new Cr(e.rctx,D3e.shader.get().build(this.configuration),br)}initializePipeline(){switch(this.configuration.alphaMode){case oa.None:return At({colorWrite:Vt});case oa.Alpha:return At({blending:xo(we.SRC_ALPHA,we.ONE,we.ONE_MINUS_SRC_ALPHA,we.ONE_MINUS_SRC_ALPHA),colorWrite:Vt});case oa.PremultipliedAlpha:case oa.COUNT:return At({blending:Tc(we.ONE,we.ONE_MINUS_SRC_ALPHA),colorWrite:Vt})}}};L3e.shader=new Er(Yvt,()=>ae(()=>import("./Compositing.glsl-deec90ce.js"),[],import.meta.url));let N3e=class extends ei{};function Jvt(){const t=new wr;return t.include(Uh),t.fragment.uniforms.add(new Je("tex",e=>e.texture)),t.fragment.code.add(b`void main() {
fragColor = vec4(1.0 - texture(tex, uv).a);
}`),t}const Qvt=Object.freeze(Object.defineProperty({__proto__:null,HUDCompositingPassParameters:N3e,build:Jvt},Symbol.toStringTag,{value:"Module"}));let F3e=class U3e extends Pr{initializeProgram(e){return new Cr(e.rctx,U3e.shader.get().build(),br)}initializePipeline(){return At({colorWrite:{r:!1,g:!0,b:!1,a:!1}})}};F3e.shader=new Er(Qvt,()=>ae(()=>import("./HUDCompositing.glsl-c6b44c52.js"),[],import.meta.url));let k3e=class extends ei{};function Kvt(){const t=new wr;return t.include(Uh),t.fragment.uniforms.add(new Je("colorTexture",e=>e.colorTexture),new Je("alphaTexture",e=>e.alphaTexture),new Je("frontFaceTexture",e=>e.frontFaceTexture)),t.fragment.code.add(b`void main() {
vec4 srcColor = texture(colorTexture, uv);
if(srcColor.a <= 1e-5){
discard;
}
float srcAlpha = texture(alphaTexture, uv).r;
vec4 frontFace = texture(frontFaceTexture, uv);
fragColor = vec4(mix(srcColor.rgb/srcColor.a, frontFace.rgb, frontFace.a), 1.0 - srcAlpha);
}`),t}const e1t=Object.freeze(Object.defineProperty({__proto__:null,OITCompositingPassParameters:k3e,build:Kvt},Symbol.toStringTag,{value:"Module"}));let V3e=class z3e extends Pr{initializeProgram(e){return new Cr(e.rctx,z3e.shader.get().build(),br)}initializePipeline(){return At({blending:xo(we.SRC_ALPHA,we.ONE,we.ONE_MINUS_SRC_ALPHA,we.ONE_MINUS_SRC_ALPHA),colorWrite:Vt})}};V3e.shader=new Er(e1t,()=>ae(()=>import("./OITCompositing.glsl-47c06b04.js"),[],import.meta.url));let B3e=class extends ei{constructor(){super(...arguments),this.overlayIndex=Pi.INNER,this.opacity=1}};function t1t(){const t=new wr;return t.include(Uh),t.fragment.uniforms.add(new Je("tex",e=>e.texture)),t.fragment.uniforms.add(new pP("overlayIdx",e=>e.overlayIndex)),t.fragment.uniforms.add(new Re("opacity",e=>e.opacity)),t.fragment.code.add(b`void main() {
vec2 overlayUV = overlayIdx == 0 ? vec2(uv.x * 0.5, uv.y) : vec2(uv.x * 0.5 + 0.5, uv.y);
fragColor = texture(tex, overlayUV) * opacity;
}`),t}const r1t=Object.freeze(Object.defineProperty({__proto__:null,OverlayCompositingPassParameters:B3e,build:t1t},Symbol.toStringTag,{value:"Module"}));let G3e=class j3e extends Pr{initializeProgram(e){return new Cr(e.rctx,j3e.shader.get().build(),br)}initializePipeline(){return At({blending:Tc(we.ONE,we.ONE_MINUS_SRC_ALPHA),colorWrite:Vt})}};G3e.shader=new Er(r1t,()=>ae(()=>import("./OverlayCompositing.glsl-56ad42f7.js"),[],import.meta.url));let i1t=class{constructor(e,r){this._rctx=e,this._techniqueRepository=r,this._configuration=new KH,this._atmosphereConfiguration=new t4,this._passParameters=new $3e,this._atmosphereParameters=new P3e,this._oitParameters=new k3e,this._hudParameters=new N3e,this._overlayParameters=new B3e}destroy(){this._vao=Ue(this._vao)}compositeOIT(e,r,i,s){this._oitParameters.colorTexture=r,this._oitParameters.alphaTexture=i,this._oitParameters.frontFaceTexture=s;const n=this._rctx,o=this._techniqueRepository.acquire(V3e);n.bindTechnique(o,this._oitParameters,e);const a=this._ensureVAO();n.bindVAO(a),n.drawArrays(St.TRIANGLE_STRIP,0,Fo(a,"geometry")),o.release()}compositeHUD(e,r){this._hudParameters.texture=r;const i=this._rctx,s=this._techniqueRepository.acquire(F3e);i.bindTechnique(s,this._hudParameters,e);const n=this._ensureVAO();i.bindVAO(n),i.drawArrays(St.TRIANGLE_STRIP,0,Fo(n,"geometry")),s.release()}compositeOverlay(e,r,i,s){this._overlayParameters.texture=r,this._overlayParameters.opacity=i,this._overlayParameters.overlayIndex=s;const n=this._rctx,o=this._techniqueRepository.acquire(G3e);n.bindTechnique(o,this._overlayParameters,e);const a=this._ensureVAO();n.bindVAO(a),n.drawArrays(St.TRIANGLE_STRIP,0,Fo(a,"geometry")),o.release()}compositeAtmosphere(e,r,i,s,n){const o=this._rctx;this._atmosphereParameters.texture=r,this._atmosphereParameters.depthTexture=i,this._atmosphereParameters.scale=s,this._atmosphereConfiguration.haze=n;const a=this._techniqueRepository.acquire(M3e,this._atmosphereConfiguration);o.bindTechnique(a,this._atmosphereParameters,e);const l=this._ensureVAO();o.bindVAO(l),o.drawArrays(St.TRIANGLE_STRIP,0,Fo(l,"geometry")),a.release()}composite(e,r,i=oa.None,s=1){const n=this._rctx;this._configuration.alphaMode=i,this._configuration.hasOpacityFactor=s!==1,this._passParameters.texture=r,this._passParameters.opacity=s;const o=this._techniqueRepository.acquire(L3e,this._configuration);n.bindTechnique(o,this._passParameters,e);const a=this._ensureVAO();n.bindVAO(a),n.drawArrays(St.TRIANGLE_STRIP,0,Fo(a,"geometry")),o.release()}_ensureVAO(){return this._vao==null&&(this._vao=Rl(this._rctx)),this._vao}};const s1t=1e4,eq=100,n1t=500,o1t=500,a1t=.1;function l1t(t,e,r){return RY(e,t)*(r[1]-r[0])+r[0]}function c1t(t,e,r){let i=0;if(!e.some(n=>(i+=n.numGeometries,i>=s1t)))return y1t.compute(t,e);const s=yP();return r.forAll(n=>{n.visible&&z2(s,u1t(t,n))}),s}function u1t(t,e){if(!e.visible)return;const r=yP(),i=e.getSpatialQueryAccelerator();return i!=null?h1t(r,t,i):d1t(r,t,e.objects),r}function h1t(t,e,r){const i=e.eye,s=e.viewForward,n=e.frustum,o=l=>l.visible,a=r.objectCount;if(a<n1t)dR(th,e.near,Math.min(t.near,e.far)),r.forEachInDepthRange(i,s,Wd.DepthOrder.FRONT_TO_BACK,th,(l,c)=>{tq(t,e,l),th.far=t.near,c.setRange(th)},n,o),dR(th,Math.max(t.far,e.near),e.far),r.forEachInDepthRange(i,s,Wd.DepthOrder.BACK_TO_FRONT,th,(l,c)=>{tq(t,e,l),th.near=t.far,c.setRange(th)},n,o);else{const l=Math.max(Math.min(a,o1t),Math.ceil(a*a1t)),c=r.findClosest(s,Wd.DepthOrder.FRONT_TO_BACK,n,o,l),h=r.findClosest(s,Wd.DepthOrder.BACK_TO_FRONT,n,o,l);c&&h&&(sue(t,e,c.boundingVolumeWorldSpace.bounds),sue(t,e,h.boundingVolumeWorldSpace.bounds))}}function d1t(t,e,r){Xx.clear(),r.forAll(i=>{i.visible&&i.geometries.length!==0&&Xx.add(i)}),Xx.empty||(Xx.sort(e),dR(th,e.near,Math.min(t.near,e.far)),Xx.forEachInDepthRange(th,Wd.DepthOrder.FRONT_TO_BACK,(i,s)=>{s<t.near&&tq(t,e,i)}),dR(th,Math.max(t.far,e.near),e.far),Xx.forEachInDepthRange(th,Wd.DepthOrder.BACK_TO_FRONT,(i,s,n)=>{t.far=Math.max(t.far,n)}))}function tq(t,e,r){if(!r.visible||!a_(e.frustum,r.boundingVolumeWorldSpace.bounds))return;const i=r.transformation,s=g1t;r.geometries.forEach(n=>{si(s,i,n.shaderTransformation);const o=v2(s);H3e(t,e,n.boundingInfo,s,o)})}function H3e(t,e,r,i,s){if(r==null)return;$e(Na,r.center,i);const{eye:n,viewForward:o}=e,a=o[0]*(Na[0]-n[0])+o[1]*(Na[1]-n[1])+o[2]*(Na[2]-n[2]);if(Na[3]=r.radius*s,!(a-Na[3]>t.near&&a+Na[3]<t.far)&&a_(e.frustum,Na))if(r.radius>eq&&r.getChildren())for(const l of r.getChildren())H3e(t,e,l,i,s);else rq.unionDepthRangeWithAABB(t,e.viewProjectionMatrix,i,r.bbMin,r.bbMax)}function sue(t,e,r){const i=e.eye,s=e.viewForward,n=(r[0]-i[0])*s[0]+(r[1]-i[1])*s[1]+(r[2]-i[2])*s[2];t.near=Math.min(t.near,n-r[3]),t.far=Math.max(t.far,n+r[3])}let p1t=class{constructor(){this._items=new kt({allocator:e=>e||{obj:null,distance:0,near:0,far:0},deallocator:e=>(e.obj=null,e.distance=0,e.near=0,e.far=0,e)})}get length(){return this._items.length}get empty(){return this._items.length===0}clear(){this._items.clear()}add(e){this._items.pushNew().obj=e}sort(e){const r=e.eye,i=e.viewForward;this._items.forAll(s=>{const n=s.obj.boundingVolumeWorldSpace.bounds,o=(n[0]-r[0])*i[0]+(n[1]-r[1])*i[1]+(n[2]-r[2])*i[2];s.distance=o,s.near=o-n[3],s.far=o+n[3]}),this._items.sort((s,n)=>s.distance-n.distance)}forEachInDepthRange(e,r,i){if(r===Wd.DepthOrder.FRONT_TO_BACK)for(let s=0;s<this._items.length;++s){const n=this._items.data[s];n.far<e.near||n.near>e.far||i(n.obj,n.near,n.far)}else for(let s=this._items.length-1;s>=0;--s){const n=this._items.data[s];n.far<e.near||n.near>e.far||i(n.obj,n.near,n.far)}}},f1t=class{constructor(){this._view=be(),this._viewProj=be(),this._frustum=WO(),this._geometries=new Array,this._near=[],this._far=[],this._nearCandidates=[],this._farCandidates=[],this._looseRange={near:0,far:0}}compute(e,r){this._reset(),Ls(this._view,e.viewMatrix),si(this._viewProj,e.projectionMatrix,this._view),i4(this._frustum,e.frustum);const i=this._view,s=i[2],n=i[6],o=i[10],a=i[14];r.forAll(f=>f.forEachGeometry(m=>{if(!m.visible||!m.castShadow)return;const y=m.boundingSphere,_=s*y[0]+n*y[1]+o*y[2]+a,v=_-y[3],w=_+y[3];this._geometries.push(m),this._near.push(-w),this._far.push(-v)}));const l=new svt;if(this._geometries.length===0)return l;for(let f=0;f<this._geometries.length;++f)this._near[f]>l.far&&(l.far=this._near[f]),this._near[f]>2&&this._far[f]<l.near&&(l.near=this._far[f]);const c=this._looseRange;c.near=Math.max(.5*l.near,2),c.far=2*l.far;let h=0,p=0;for(let f=0;f<this._geometries.length;++f)this._near[f]<l.near&&(this._near[f]>=c.near?l.near=this._near[f]:this._nearCandidates[h++]=f),this._far[f]>l.far&&(this._far[f]<=c.far?l.far=this._far[f]:this._farCandidates[p++]=f);if(this._nearCandidates.length===0&&this._farCandidates.length===0)return l;this._nearCandidates.sort((f,m)=>this._near[f]<this._near[m]?-1:this._near[f]>this._near[m]?1:0),this._farCandidates.sort((f,m)=>this._far[f]<this._far[m]?1:this._far[f]>this._far[m]?-1:0);for(let f=0;f<this._nearCandidates.length;++f){const m=this._nearCandidates[f];if(this._near[m]<l.near){const y=this._geometries[m],_=y.boundingInfo;this._includeNearBoundingInfoRec(_,y.shaderTransformation,l)}}for(let f=0;f<this._farCandidates.length;++f){const m=this._farCandidates[f];if(this._far[m]>l.far){const y=this._geometries[m],_=y.boundingInfo;this._includeFarBoundingInfoRec(_,y.shaderTransformation,l)}}return this._reset(),l}_reset(){this._geometries.length=0,this._near.length=0,this._far.length=0,this._nearCandidates.length=0,this._farCandidates.length=0}_includeNearBoundingInfoRec(e,r,i){if(e==null)return;const s=e.center;$e(Na,s,r);const n=v2(r),o=Na[0],a=Na[1],l=Na[2],c=e.radius*n,h=this._frustum;if(h[0][0]*o+h[0][1]*a+h[0][2]*l+h[0][3]>c||h[1][0]*o+h[1][1]*a+h[1][2]*l+h[1][3]>c||h[2][0]*o+h[2][1]*a+h[2][2]*l+h[2][3]>c||h[3][0]*o+h[3][1]*a+h[3][2]*l+h[3][3]>c)return;const p=this._view[2]*o+this._view[6]*a+this._view[10]*l+this._view[14],f=p+c;if(!(-(p-c)<2||-f>=i.near))if(-f>this._looseRange.near)i.near=-f;else{if(c>eq){const m=e.getChildren();if(m!==void 0){for(const y of m)this._includeNearBoundingInfoRec(y,r,i);return}}rq.unionDepthRangeWithAABB(i,this._viewProj,r,e.bbMin,e.bbMax)}}_includeFarBoundingInfoRec(e,r,i){if(e==null)return;let s=e.radius;const n=e.center;$e(Na,n,r);const o=v2(r),a=Na[0],l=Na[1],c=Na[2];s*=o;const h=this._frustum;if(h[0][0]*a+h[0][1]*l+h[0][2]*c+h[0][3]>s||h[1][0]*a+h[1][1]*l+h[1][2]*c+h[1][3]>s||h[2][0]*a+h[2][1]*l+h[2][2]*c+h[2][3]>s||h[3][0]*a+h[3][1]*l+h[3][2]*c+h[3][3]>s)return;const p=this._view[2]*a+this._view[6]*l+this._view[10]*c+this._view[14]-s;if(!(-p<=i.far))if(-p<this._looseRange.far)i.far=-p;else{if(s>eq){const f=e.getChildren();if(f!==void 0){for(const m of f)this._includeFarBoundingInfoRec(m,r,i);return}}rq.unionDepthRangeWithAABB(i,this._viewProj,r,e.bbMin,e.bbMax)}}},m1t=class{constructor(){this._modelViewProj=be(),this._clipPosition=[Wt(),Wt(),Wt(),Wt(),Wt(),Wt(),Wt(),Wt()]}unionDepthRangeWithAABB(e,r,i,s,n){const o=this._modelViewProj;si(o,r,i);let a=!1;for(let l=0;l<8;++l){const c=this._clipPosition[l],h=l===0||l===3||l===4||l===7?s[0]:n[0],p=l===0||l===1||l===4||l===5?s[1]:n[1],f=l<4?s[2]:n[2];c[0]=o[0]*h+o[4]*p+o[8]*f+o[12],c[1]=o[1]*h+o[5]*p+o[9]*f+o[13],c[2]=o[2]*h+o[6]*p+o[10]*f+o[14],c[3]=o[3]*h+o[7]*p+o[11]*f+o[15]}for(let l=0;l<12;++l){const c=this._clipPosition[vk[l][0]],h=this._clipPosition[vk[l][1]],p=this._clipPosition[vk[l][2]],f=this._clipTriangle(c,h,p);let m=!0;for(let y=0;y<f.length;++y)if(f[y][3]>=2){m=!1;break}if(!m){a=!0;for(let y=0;y<f.length;++y){const _=f[y][3];Number.isFinite(_)&&(e.near=Math.min(_,e.near),e.far=Math.max(_,e.far))}}}return a}_inside(e,r){return r===0?e[0]>=-e[3]:r===1?e[1]>=-e[3]:r===2?e[0]<=e[3]:r===3?e[1]<=e[3]:void et(!1)}_intersect(e,r,i){let s=0;return i===0?s=(-e[3]-e[0])/(r[0]-e[0]+r[3]-e[3]):i===1?s=(-e[3]-e[1])/(r[1]-e[1]+r[3]-e[3]):i===2?s=(e[3]-e[0])/(r[0]-e[0]-r[3]+e[3]):i===3&&(s=(e[3]-e[1])/(r[1]-e[1]-r[3]+e[3])),OF(Wt(),e,r,s)}_clipTriangle(e,r,i){let s=[e,r,i];for(let n=0;n<4;++n){const o=s;s=[];for(let a=0;a<o.length;++a){const l=o[a],c=o[(a+1)%o.length];this._inside(c,n)?(this._inside(l,n)||s.push(this._intersect(l,c,n)),s.push(c)):this._inside(l,n)&&s.push(this._intersect(l,c,n))}}return s}};const vk=[[0,1,3],[2,3,1],[1,5,2],[6,2,5],[5,4,6],[7,6,4],[4,0,7],[3,7,0],[3,2,7],[6,7,2],[4,5,0],[1,0,5]],Na=gs(),g1t=be(),th=yP(),Xx=new p1t,y1t=new f1t,rq=new m1t;let _1t=class{},v1t=class extends ei{constructor(){super(...arguments),this.textures=new _1t}};function b1t(){const t=new wr;return t.attributes.add(E.POSITION,"vec2"),t.vertex.uniforms.add(new sr("drawPosition",(e,r)=>w1t(e,r))),t.varyings.add("vUV","vec2"),t.vertex.code.add(b`void main(void) {
vUV = position;
gl_Position = vec4(drawPosition.xy + vec2(position - 0.5) * drawPosition.zw, 0.0, 1.0);
}`),t.fragment.uniforms.add(new Je("textureInput",e=>e.textures.input)),t.fragment.uniforms.add(new Je("textureMask",e=>e.textures.mask)),t.fragment.uniforms.add(new Je("textureOverlay",e=>e.textures.overlay)),t.fragment.uniforms.add(new Mf("maskEnabled",e=>e.magnifier.maskEnabled)),t.fragment.uniforms.add(new Mf("overlayEnabled",e=>e.magnifier.overlayEnabled)),t.fragment.code.add(b`const float barrelFactor = 1.1;
vec2 barrel(vec2 uv) {
vec2 uvn = uv * 2.0 - 1.0;
if (uvn.x == 0.0 && uvn.y == 0.0) {
return vec2(0.5, 0.5);
}
float theta = atan(uvn.y, uvn.x);
float r = pow(length(uvn), barrelFactor);
return r * vec2(cos(theta), sin(theta)) * 0.5 + 0.5;
}
void main() {
float mask = maskEnabled ? texture(textureMask, vUV).a : 1.0;
vec4 inputColor = texture(textureInput, barrel(vUV)) * mask;
vec4 overlayColor = overlayEnabled ? texture(textureOverlay, vUV) : vec4(0);
fragColor = overlayColor + (1.0 - overlayColor.a) * inputColor;
}`),t}function w1t(t,e){const r=e.camera.pixelRatio,i=t.magnifier.offset.x*r,s=t.magnifier.offset.y*r;ff(t.magnifier.position,nue);const n=e.camera.screenToRender(nue,x1t),o=Math.ceil(r*t.magnifier.size),a=e.camera.fullWidth,l=e.camera.fullHeight;return bi(T1t,(n[0]+i)/a*2-1,(n[1]-s)/l*2-1,o/a*2,o/l*2)}const nue=Zi(),x1t=wge(),T1t=Wt();async function S1t(t){const e=ae(()=>import("./mask-svg-023bbc42.js"),[],import.meta.url),r=ae(()=>import("./overlay-svg-d62383f3.js"),[],import.meta.url),i=Gg((await e).default,{signal:t}),s=Gg((await r).default,{signal:t}),n={mask:await i,overlay:await s};return Xt(t),n}let WT=class extends Te{constructor(){super(...arguments),this._handles=new Oi,this._magnifier=null,this._imageSources=null,this._imageLoadTask=null,this._resources=null,this._passParameters=new v1t,this.events=new os,this.attributeLocations=new Map([[E.POSITION,0]]),this._tmpScreenPoint=Zi(),this._tmpRenderPoint=wge()}get updating(){return this._imageSources==null&&this._imageLoadTask!=null&&!this._imageLoadTask.task.finished}get magnifier(){return this._magnifier}set magnifier(e){if(e===this._magnifier)return;this._handles.removeAll(),this._magnifier=e;const r=()=>{this._updateResourceLoading(),this.events.emit("request-render")};this._magnifier!=null&&this._handles.add(le(()=>uc(this._magnifier,i=>i.version),r)),r()}get enabled(){return this._validMagnifier!=null}get _validMagnifier(){return this._magnifier!=null&&this._magnifier.visible&&this._magnifier.position!=null&&this._magnifier.size>0?this._magnifier:null}get _factor(){return this._magnifier!=null&&this._magnifier.factor||1}destroy(){this._magnifier=null,this._handles.destroy(),this._imageLoadTask!=null&&(this._imageLoadTask.task.abort(),this._imageLoadTask=null),this._disposeResources()}render(e,r){const i=this._validMagnifier;if(i==null)return;const s=r.camera.pixelRatio,n=Math.ceil(s*i.size);if(this._updateResources(e,n),this._resources==null)return;const o=this._passParameters.textures,a=Math.ceil(1/this._factor*n);o.input.resize(a,a),ff(i.position,this._tmpScreenPoint);const l=r.camera.screenToRender(this._tmpScreenPoint,this._tmpRenderPoint),c=r.camera.fullWidth,h=r.camera.fullHeight,p=.5*a,f=.5*a;l[0]=ge(l[0],p,c-p-1),l[1]=ge(l[1],f,h-f-1);const m=Math.floor(l[0]-p),y=Math.floor(l[1]-f),_=this._resources.program;_.bindTexture("textureInput",o.input),e.gl.copyTexImage2D(o.input.descriptor.target,0,o.input.descriptor.pixelFormat,m,y,a,a,0),this._passParameters.magnifier=i,e.useProgram(_),_.bindPass(this._passParameters,r),e.bindVAO(this._resources.vao),e.setPipelineState(this._resources.pipelineState),e.drawArrays(St.TRIANGLE_STRIP,0,4)}_updateResourceLoading(){const e=this._validMagnifier;if(e==null)return;const r=e.maskUrl,i=e.overlayUrl;this._imageLoadTask==null||this._imageLoadTask.maskUrl===r&&this._imageLoadTask.overlayUrl===i||(this._imageLoadTask.task.abort(),this._imageLoadTask=null,this._imageSources=null),this._imageSources==null&&this._imageLoadTask==null&&(this._imageLoadTask={maskUrl:r,overlayUrl:i,task:uE(async s=>{const n=r==null||i==null?S1t(s):null,o=r!=null?Gg(r,{signal:s}):n.then(l=>l.mask),a=i!=null?Gg(i,{signal:s}):n.then(l=>l.overlay);this._imageSources={mask:await o,overlay:await a},this._disposeResources(),this.events.emit("request-render")})},this._imageLoadTask.task.promise.then(()=>this.notifyChange("updating"),()=>this.notifyChange("updating")))}_updateResources(e,r){if(!this.enabled)return void this._disposeResources();if(this._resources!=null){if(this._passParameters.textures.size!==r){const s=this._createTextureResources(e,r);if(s==null)return void this._disposeResources();this._disposeTextureResources(this._passParameters.textures),this._passParameters.textures=s}return}const i=this._createTextureResources(e,r);i!=null&&(this._resources={program:this._createProgram(e),vao:Rl(e,AX,this.attributeLocations,0,1),pipelineState:At({blending:Tc(we.ONE,we.ONE_MINUS_SRC_ALPHA),depthTest:null,depthWrite:null,colorWrite:Vt})},this._passParameters.textures=i)}_disposeResources(){this._resources!=null&&(this._disposeTextureResources(this._passParameters.textures),this._resources.program.dispose(),this._resources.vao.dispose(),this._resources=null)}_disposeTextureResources(e){e.mask.dispose(),e.overlay.dispose(),e.input.dispose()}_createTextureResources(e,r){if(this._imageSources==null)return null;this._imageSources.overlay.width=r,this._imageSources.overlay.height=r,this._imageSources.mask.width=r,this._imageSources.mask.height=r;const i=new vr;i.internalFormat=Tt.RGBA,i.wrapMode=$t.CLAMP_TO_EDGE,i.flipped=!0,i.preMultiplyAlpha=!Bde(this._imageSources.overlay.src)||!e.driverTest.svgPremultipliesAlpha.result;const s=new Et(e,i,this._imageSources.overlay);i.pixelFormat=i.internalFormat=Tt.ALPHA,i.preMultiplyAlpha=!1;const n=new Et(e,i,this._imageSources.mask);return i.pixelFormat=i.internalFormat=Tt.RGBA,i.flipped=!1,{input:new Et(e,i),mask:n,overlay:s,size:r}}_createProgram(e){return new Cr(e,b1t(),this.attributeLocations)}};u([d()],WT.prototype,"_imageSources",void 0),u([d()],WT.prototype,"_imageLoadTask",void 0),u([d({readOnly:!0})],WT.prototype,"updating",null),WT=u([R("esri/views/3d/webgl-engine/lib/MagnifierHelper")],WT);let E1t=class{constructor(){this.declaredClass="esri.views.3d.webgl-engine.lib.ObjectAndLayerIdRenderHelper",this.colorZero=new ha(new ArrayBuffer(4)),this._uidToRenderColor=new Map,this._colorToUID=new Map,this._layerUidToGraphicsUidToObjectId=new Map,this._layerUidToId=new Map,this._layerUidToPopupEnabled=new Map}setUidToObjectAndLayerId(e,r,i,s,n,o=null,a=null,l=null){if(!(e&&r&&i&&s)||(this._layerUidToId.set(s,i),this._layerUidToPopupEnabled.set(s,n),!n))return;let c=this._layerUidToGraphicsUidToObjectId.get(s);c||(c=new Map,this._layerUidToGraphicsUidToObjectId.set(s,c)),c.set(r,{objectId:e,attributeNodeId:o,attributeIndex:a,subLayerId:l})}getObjectAndLayerIdColor(e){const r=this.getObjectAndLayerIdColorArray(e);return Lt(r.get(0,1),r.get(0,2),r.get(0,3),255)}getObjectAndLayerIdColorArray(e){if(!e.layerUid||!e.graphicUid)return this.colorZero;const r=this._layerUidToPopupEnabled.get(e.layerUid);if(r===void 0)return Q.getLogger(this).warn("popupEnabled is undefined for layerUid "+e.layerUid),this.colorZero;if(r===!1)return this.colorZero;let i=this._uidToRenderColor.get(e.layerUid);i||(i=new Map,this._uidToRenderColor.set(e.layerUid,i));let s=i.get(e.graphicUid);if(!s){for(;!s;){const o=Math.floor(16777214*Math.random())+1;this._colorToUID.has(o)||(s=o)}if(s>16777215)throw new Error("Object ID Overflow");i.set(e.graphicUid,s),this._colorToUID.set(s,e)}const n=new ArrayBuffer(4);return new DataView(n).setUint32(0,s,!1),new ha(n)}getColorToObjectAndLayerIdMapping(){const e=new Map;for(const[r,i]of this._colorToUID.entries()){const s=this._layerUidToGraphicsUidToObjectId.get(i.layerUid);let n=null;s?(n=s.get(i.graphicUid),n||Q.getLogger(this).warn("getColorMapping: no entry found for graphicsId "+i.graphicUid)):Q.getLogger(this).warn("getColorMapping: no entry found for layerUid "+i.layerUid);const o=this._layerUidToId.get(i.layerUid);o||Q.getLogger(this).warn("no layerId found for uid "+i.layerUid),n&&o&&e.set(r,n.attributeNodeId?{type:"object-and-layer-and-i3s-id",oid:n.objectId,lid:o,attrId:n.attributeNodeId,attrIdx:n.attributeIndex,subLayerId:n.subLayerId}:{type:"object-and-layer-id",oid:n.objectId,lid:o})}return e}};var pR;(function(t){t[t.FrontToBack=0]="FrontToBack",t[t.BackToFront=1]="BackToFront"})(pR||(pR={}));let jy=class{constructor(e,r,i=pR.FrontToBack){this._rctx=e,this._techniqueRepository=r,this._sorting=i,this._draws=new kt({initialSize:32,allocator:s=>s||{material:null,geometry:null,geometryRanges:null,bindDrawParams:null,depthSquaredHint:0,indexType:0}}),this._previouslyBoundDraw=new Map}submitDraw(e,r,i,s){const n=this._draws.pushNew();n.geometry=r,n.geometryRanges=i,n.material=e,n.depthSquaredHint=s,n.indexType=(r.indexed?r.vao.indexBuffer.indexType:null)??0}prepare(e,r){return this._draws.map(i=>i.material.prepareTechnique(this._techniqueRepository,e,r,i.geometry.parameters))}dispatch(e,r,i){const s=this._rctx;this._previouslyBoundDraw.clear();let n=null;const o=this._draws.length;for(let a=0;a<o;a++){const l=i[a];l===n&&l.configuration.transparencyPassType===ot.NONE||(s.bindTechnique(l,e,r),n=l);const c=this._draws.data[a],h=c.geometry;s.bindVAO(h.vao),this._previouslyBoundDraw.get(l)!==c.material&&(l.program.bindDraw(c.material,r,e),this._previouslyBoundDraw.set(l,c.material));const p=c.geometryRanges,f=p.length;if(c.indexType!==0){const m=SD.get(c.indexType);for(let y=0;y<f;y+=2){const _=p[y],v=p[y+1];s.drawElements(h.primitiveType,v,c.indexType,_*m)}}else for(let m=0;m<f;m+=2){const y=p[m],_=p[m+1];s.drawArrays(h.primitiveType,y,_)}}}prepareSubmit(){this._draws.clear()}finishSubmit(){const e=this._sorting===pR.FrontToBack?1:-1;this._draws.sort((r,i)=>{const s=e*(r.depthSquaredHint-i.depthSquaredHint);return s!==0?s:r.geometry.vao.byteSize-i.geometry.vao.byteSize})}get count(){return this._draws.length}};const SD=new Map;SD.set(Ke.UNSIGNED_BYTE,1),SD.set(Ke.UNSIGNED_SHORT,2),SD.set(Ke.UNSIGNED_INT,4);let C1t=class{constructor(e,r){this.rctx=e,this.shaderTechniqueRepository=r,this.canRender=!0,this._materialPassParameters=new y0t,this._shadowPassParameters=new _0t,this._highlightPassParameters=new v0t,this._systems=new Set,this._passes={materialOpaque:new jy(e,r),materialTransparent:new jy(e,r,pR.BackToFront),materialIntegratedMesh:new jy(e,r),shadowMap:new jy(e,r),highlight:new jy(e,r),highlightIntegratedMesh:new jy(e,r),highlightShadowMap:new jy(e,r),defaultShadowMap:new jy(e,r)}}destroy(){this._context=null,this._systems.clear()}register(e){this._systems.add(e)}prepareRender(e){if(this._systems.size!==0){for(const r of Object.values(this._passes))r.prepareSubmit();this._systems.forEach(r=>r.submit(this._passes,e.bindParameters));for(const r of Object.values(this._passes))r.finishSubmit();this.shaderTechniqueRepository.frameUpdate()}}prepareTechniques(e){return this._systems.size===0?null:(this._configure(e),this._materialPassParameters.output=e.output,this._invoke(e,(r,i)=>r.prepare(i,e.bindParameters)))}render(e,r){this._invoke(e,(i,s)=>i.dispatch(s,e.bindParameters,r))}_invoke(e,r){switch(e.bindParameters.slot){case ue.OPAQUE_MATERIAL:switch(e.output){case N.Color:case N.Depth:case N.Normal:case N.ObjectAndLayerIdColor:return r(this._passes.materialOpaque,this._materialPassParameters);case N.Highlight:return r(this._passes.highlight,this._highlightPassParameters);case N.Shadow:return r(this._passes.shadowMap,this._shadowPassParameters);case N.ShadowHighlight:return r(this._passes.highlightShadowMap,this._shadowPassParameters);case N.ShadowExcludeHighlight:return r(this._passes.defaultShadowMap,this._shadowPassParameters)}break;case ue.TRANSPARENT_MATERIAL:switch(e.output){case N.Color:case N.Alpha:case N.Depth:case N.Normal:case N.ObjectAndLayerIdColor:return r(this._passes.materialTransparent,this._materialPassParameters)}break;case ue.INTEGRATED_MESH:switch(e.output){case N.Color:case N.Depth:case N.Normal:case N.ObjectAndLayerIdColor:return r(this._passes.materialIntegratedMesh,this._materialPassParameters);case N.Highlight:return r(this._passes.highlightIntegratedMesh,this._highlightPassParameters)}}return null}notifyDirty(){this._context.requestRender()}slots(){return[ue.OPAQUE_MATERIAL,ue.TRANSPARENT_MATERIAL,ue.INTEGRATED_MESH]}initializeRenderContext(e){this._context=e}uninitializeRenderContext(){}queryDepthRange(e){const r={near:1/0,far:-1/0};return this._systems.forEach(i=>{const s=i.queryShadowCasterDepthRange(e);s!=null&&z2(r,s,r)}),r}_configure(e){const r=e.output===N.Shadow||e.output===N.ShadowHighlight||e.output===N.ShadowExcludeHighlight?this._shadowPassParameters:e.output===N.Highlight?this._highlightPassParameters:this._materialPassParameters;this._updateParameters(e,r)}_updateParameters(e,r){const i=e.bindParameters.camera,s=i.viewInverseTransposeMatrix;se(bk,s[3],s[7],s[11]),wk.set(bk),ie(r.transformWorldFromViewTH,wk.high),ie(r.transformWorldFromViewTL,wk.low),ie(r.slicePlaneLocalOrigin,bk),Ph(r.transformViewFromCameraRelativeRS,i.viewMatrix),Ls(r.transformProjFromView,i.projectionMatrix),r.identifier===cc.Material&&(this._materialPassParameters.transparent=e.bindParameters.slot===ue.TRANSPARENT_MATERIAL,this._materialPassParameters.integratedMesh=e.bindParameters.slot===ue.INTEGRATED_MESH,Mh(oue,r.transformViewFromCameraRelativeRS),Nw(r.transformNormalViewFromGlobal,oue))}get needsHighlight(){return this._passes.highlight.count>0||this._passes.highlightIntegratedMesh.count>0}get needsTransparentPass(){return this._passes.materialTransparent.count>0}};const bk=C(),oue=Li(),wk=new D6;let A1t=class{constructor(){this._step=cue,this._dilation=1,this._firstIdleTime=0}frame(e,r){if(r?this._firstIdleTime===0&&(this._firstIdleTime=performance.now()):this._firstIdleTime=0,oe("disable-feature:high-quality-idle"))this._dilation=1;else{const s=r?performance.now()-this._firstIdleTime:0;if(s>=aue+R1t)return this._step=1/0,void(this._dilation=1);this._dilation=s>=aue?P1t:1}const i=ge(e/O1t,cue,I1t);this._step===1/0?this._step=i:this._step=this._step*lue+i*(1-lue)}get value(){return this._step}get timeDilation(){return this._dilation}clear(){this._step=this._firstIdleTime=0}};const O1t=.5,aue=12e4,R1t=1e4,P1t=10,lue=.9,M1t=30,cue=1e3/1,I1t=1e3/M1t,$1t=8.6,L1t=.4;function D1t(){const t=new wr,{vertex:e,fragment:r}=t,i=e.code,s=r.code;return t.attributes.add(E.POSITION,"vec2"),t.varyings.add("uv","vec2"),t.attributes.add(E.UV0,"vec2"),e.uniforms.add(new Je("coverageTex",n=>n.coverageTexture)),i.add(b`void main() {
vec4 cov = texture(coverageTex, uv0);
if (cov.r == 0.0) {
gl_Position = vec4(0.0);
return;
}
gl_Position = vec4(position, 0.0, 1.0);
uv = position.xy * 0.5 + vec2(0.5);
}`),r.uniforms.add(new Je("tex",n=>n.blurColorTexture),new Je("origin",n=>n.highlightColorTexture),new sr("uColor",n=>n.color),new sr("haloColor",n=>n.haloColor),new sr("opacities",n=>bi(N1t,n.haloOpacity,n.haloOpacityOccluded,n.fillOpacity,n.fillOpacityOccluded))),r.constants.add("outlineSize","float",$1t),r.constants.add("blurSize","float",L1t),s.add(b`void main() {
vec4 blurredHighlightValue = texture(tex, uv);
float highlightIntensity = blurredHighlightValue.a;
if (highlightIntensity == 0.0) {
discard;
}
vec4 origin_color = texture(origin, uv);
float outlineIntensity;
float fillIntensity;
if (blurredHighlightValue.g > blurredHighlightValue.b) {
outlineIntensity = haloColor.w * opacities[1];
fillIntensity = uColor.w * opacities[3];
}
else {
outlineIntensity = haloColor.w * opacities[0];
fillIntensity = uColor.w * opacities[2];
}
float inner = 1.0 - outlineSize / 9.0;
float outer = 1.0 - (outlineSize + blurSize) / 9.0;
float outlineFactor = smoothstep(outer, inner, highlightIntensity);
float fillFactor = any(notEqual(origin_color, vec4(0.0, 0.0, 0.0, 0.0))) ? 1.0 : 0.0;
float intensity = outlineIntensity * outlineFactor * (1.0 - fillFactor) + fillIntensity * fillFactor;
fragColor = vec4(mix(haloColor.rgb, uColor.rgb, fillFactor), intensity);
}`),t}const N1t=Wt(),F1t=Object.freeze(Object.defineProperty({__proto__:null,build:D1t},Symbol.toStringTag,{value:"Module"}));let q3e=class W3e extends Pr{initializeProgram(e){return new Cr(e.rctx,W3e.shader.get().build(),br)}initializePipeline(){return At({blending:xo(we.SRC_ALPHA,we.ONE,we.ONE_MINUS_SRC_ALPHA,we.ONE_MINUS_SRC_ALPHA),colorWrite:Vt})}};q3e.shader=new Er(F1t,()=>ae(()=>import("./HighlightApply.glsl-4d019776.js"),[],import.meta.url));let Z3e=class extends ei{constructor(){super(...arguments),this.blurSize=Ve()}};function U1t(){const t=new wr,{vertex:e,fragment:r}=t,i=e.code,s=r.code;return t.attributes.add(E.POSITION,"vec2"),t.attributes.add(E.UV0,"vec2"),t.varyings.add("blurCoordinate","vec3"),e.uniforms.add(new Je("coverageTex",n=>n.coverageTexture)),r.uniforms.add(new iJ("blurSize",n=>n.blurSize)),i.add(b`void main() {
gl_Position = vec4(position, 0.0, 1.0);
vec4 cov = texture(coverageTex, uv0);
if (cov.r == 0.0) {
gl_Position = vec4(0.0);
}
blurCoordinate = vec3(gl_Position.xy * 0.5 + vec2(0.5), max(cov.g, cov.b));
}`),r.uniforms.add(new bh("tex",n=>n.blurInputTexture)),s.add(b`void main() {
vec2 uv = blurCoordinate.xy;
vec4 center = texture(tex, uv);
if (blurCoordinate.z == 1.0) {
fragColor = center;
} else {
vec4 sum = vec4(0.0);
sum += center * 0.204164;
sum += texture(tex, uv + blurSize * 1.407333) * 0.304005;
sum += texture(tex, uv - blurSize * 1.407333) * 0.304005;
sum += texture(tex, uv + blurSize * 3.294215) * 0.093913;
sum += texture(tex, uv - blurSize * 3.294215) * 0.093913;
fragColor = sum;
}
}`),t}const k1t=Object.freeze(Object.defineProperty({__proto__:null,HighlightBlurDrawParameters:Z3e,build:U1t},Symbol.toStringTag,{value:"Module"}));let X3e=class Y3e extends Pr{initializeProgram(e){return new Cr(e.rctx,Y3e.shader.get().build(),br)}initializePipeline(){return At({colorWrite:Vt})}};X3e.shader=new Er(k1t,()=>ae(()=>import("./HighlightBlur.glsl-48baa064.js"),[],import.meta.url));let J3e=class extends ei{constructor(){super(...arguments),this.invFramebufferDim=Ve()}};function V1t(){const t=new wr,{vertex:e,fragment:r}=t,i=e.code,s=r.code;return t.attributes.add(E.POSITION,"vec2"),i.add(b`void main() {
gl_Position = vec4(vec2(1.0) - position * 2.0, 0.0, 1.0);
}`),r.uniforms.add(new bh("tex",n=>n.inputTexture)),r.uniforms.add(new iJ("invFramebufferDim",n=>n.invFramebufferDim)),s.add(b`void main() {
vec2 coord = gl_FragCoord.xy * invFramebufferDim;
vec4 value = texture(tex, coord);
float mx = floor(max(value.g, value.b));
fragColor = vec4(ceil(value.r), mx, mx, 1.0);
}`),t}const z1t=Object.freeze(Object.defineProperty({__proto__:null,HighlightDownsampleDrawParameters:J3e,build:V1t},Symbol.toStringTag,{value:"Module"}));let Q3e=class K3e extends Pr{initializeProgram(e){return new Cr(e.rctx,K3e.shader.get().build(),br)}initializePipeline(){return At({colorWrite:Vt})}};Q3e.shader=new Er(z1t,()=>ae(()=>import("./HighlightDownsample.glsl-433399b8.js"),[],import.meta.url));let uue=class extends ei{constructor(){super(...arguments),this.color=Xf(1,0,1,1),this.haloColor=Xf(1,0,1,1),this.haloOpacity=1,this.haloOpacityOccluded=.25,this.fillOpacity=.2,this.fillOpacityOccluded=.05,this.shadowColor=Lt(1,0,1,1),this.shadowOpacity=.15,this.occludedShadowOpacity=.075}};const B1t=32;let G1t=class{constructor(e,r){this._techniqueRep=e,this._rctx=r,this._viewportToRestore=Wt(),this._passParameters=new uue,this._downsampleDrawParameters=new J3e,this._blurDrawParameters=new Z3e,this._grid={coverageMipmap:null,vao:null,verticalCellCount:0,horizontalCellCount:0,cellPixelSize:0,mipmapLevels:0,viewportWidth:0,viewportHeight:0}}_assertResources(){if(this._quadVAO)return;this._quadVAO=Rl(this._rctx);const e=new vr;e.wrapMode=$t.CLAMP_TO_EDGE,this._blur0Fbo=new hn(this._rctx,e),this._blur1Fbo=new hn(this._rctx,e),this._blurTechnique=this._techniqueRep.acquire(X3e),this._downsampleTechnique=this._techniqueRep.acquire(Q3e),this._applyTechnique=this._techniqueRep.acquire(q3e)}dispose(){if(this._blurTechnique=Ui(this._blurTechnique),this._downsampleTechnique=Ui(this._downsampleTechnique),this._applyTechnique=Ui(this._applyTechnique),this._grid.coverageMipmap)for(let e=1;e<this._grid.coverageMipmap.length;e++)this._grid.coverageMipmap[e].dispose();this._grid.vao&&this._grid.vao.dispose(),this._quadVAO&&(this._quadVAO.dispose(),this._quadVAO=null),this._blur0Fbo=Ue(this._blur0Fbo),this._blur1Fbo=Ue(this._blur1Fbo)}setDefaultOptions(e){this._passParameters={...new uue,...e}}render(e,r,i){this._passParameters.highlightColorTexture=r.colorTexture,this._assertResources();const s=e.camera;mh(this._viewportToRestore,s.fullViewport);const n=s.fullWidth,o=s.fullHeight,a=s.pixelRatio,l=Math.ceil(n/a),c=Math.ceil(o/a);this._blur0Fbo.resize(l,c),this._blur1Fbo.resize(l,c);const h=this._rctx;h.bindVAO(this._quadVAO);let p=null;this._gridUpdateResources(r,B1t),this._gridComputeMipmap(e),this._passParameters.coverageTexture=this._grid.coverageMipmap[this._grid.mipmapLevels].colorTexture,p=this._grid.vao;const f=h.bindTechnique(this._blurTechnique,this._passParameters,e);h.bindVAO(p),h.bindFramebuffer(this._blur0Fbo),h.setViewport(0,0,l,c),h.setClearColor(0,0,0,0),h.clear(wi.COLOR_BUFFER_BIT),this._blurDrawParameters.blurInputTexture=r.colorTexture,or(this._blurDrawParameters.blurSize,1/l,0),f.bindDraw(this._blurDrawParameters,e,this._passParameters),h.drawArrays(this._blurTechnique.primitiveType,0,Fo(p,"geometry")),h.bindFramebuffer(this._blur1Fbo),h.clear(wi.COLOR_BUFFER_BIT),this._blurDrawParameters.blurInputTexture=this._blur0Fbo.colorTexture,or(this._blurDrawParameters.blurSize,0,1/c),f.bindDraw(this._blurDrawParameters,e,this._passParameters),h.drawArrays(this._blurTechnique.primitiveType,0,Fo(p,"geometry")),h.bindFramebuffer(i),h.setViewport(this._viewportToRestore[0],this._viewportToRestore[1],this._viewportToRestore[2],this._viewportToRestore[3]),this._passParameters.blurColorTexture=this._blur1Fbo.colorTexture,h.bindTechnique(this._applyTechnique,this._passParameters,e),h.drawArrays(this._applyTechnique.primitiveType,0,Fo(p,"geometry")),h.bindVAO(null)}_gridUpdateResources(e,r){const i=this._rctx,s=this._grid;let n=!1;if(s.coverageMipmap===null&&(s.coverageMipmap=[e],n=!0),s.viewportWidth===e.width&&s.viewportHeight===e.height||(n=!0,s.viewportWidth=e.width,s.viewportHeight=e.height),s.coverageMipmap[0]=e,s.cellPixelSize!==r&&(s.cellPixelSize=r,n=!0),n){for(let l=1;l<s.coverageMipmap.length;l++)s.coverageMipmap[l].dispose();s.mipmapLevels=Math.ceil(Math.log(s.cellPixelSize)*Math.LOG2E),s.coverageMipmap.length=s.mipmapLevels+1;for(let l=0;l<s.mipmapLevels;l++){const c=s.coverageMipmap[l],h=new vr(Math.ceil(c.width/2),Math.ceil(c.height/2));h.pixelFormat=Tt.RGB,h.dataType=ks.UNSIGNED_SHORT_5_6_5,h.wrapMode=$t.CLAMP_TO_EDGE,s.coverageMipmap[l+1]=new hn(i,h)}}const o=Math.ceil(e.height/s.cellPixelSize),a=Math.ceil(e.width/s.cellPixelSize);if(!s.vao||s.verticalCellCount!==o||s.horizontalCellCount!==a){s.verticalCellCount=o,s.horizontalCellCount=a;const l=o+1,c=a+1,h=1/o,p=1/a,f=6,m=4,y=new Float32Array(f*m*l*c);let _=0;for(let v=0;v<l;v++)for(let w=0;w<c;w++)y[_]=(w-.5)*p*2-1,y[_+1]=(v-.5)*h*2-1,y[_+2]=w*p,y[_+3]=v*h,y[_+4]=(w+.5)*p*2-1,y[_+5]=(v-.5)*h*2-1,y[_+6]=w*p,y[_+7]=v*h,y[_+8]=(w-.5)*p*2-1,y[_+9]=(v+.5)*h*2-1,y[_+10]=w*p,y[_+11]=v*h,y[_+12]=(w-.5)*p*2-1,y[_+13]=(v+.5)*h*2-1,y[_+14]=w*p,y[_+15]=v*h,y[_+16]=(w+.5)*p*2-1,y[_+17]=(v-.5)*h*2-1,y[_+18]=w*p,y[_+19]=v*h,y[_+20]=(w+.5)*p*2-1,y[_+21]=(v+.5)*h*2-1,y[_+22]=w*p,y[_+23]=v*h,_+=f*m;s.vao&&s.vao.dispose(),s.vao=new pp(i,br,{geometry:XR},{geometry:Lr.createVertex(i,Tr.STATIC_DRAW,y)})}}_gridComputeMipmap(e){const r=this._rctx,i=this._grid,s=r.bindTechnique(this._downsampleTechnique,this._passParameters,e);r.bindVAO(this._quadVAO);for(let n=0;n<i.mipmapLevels;n++){r.bindFramebuffer(i.coverageMipmap[n+1]);const o=i.coverageMipmap[n+1].width,a=i.coverageMipmap[n+1].height;this._downsampleDrawParameters.inputTexture=i.coverageMipmap[n].colorTexture,or(this._downsampleDrawParameters.invFramebufferDim,1/o,1/a),s.bindDraw(this._downsampleDrawParameters,e,this._passParameters),r.setViewport(0,0,o,a),r.drawArrays(St.TRIANGLE_STRIP,0,Fo(this._quadVAO,"geometry"))}}get gpuMemoryUsage(){let e=(this._blur0Fbo!=null?this._blur0Fbo.gpuMemoryUsage:0)+(this._blur1Fbo!=null?this._blur1Fbo.gpuMemoryUsage:0);if(this._grid.coverageMipmap)for(const r of this._grid.coverageMipmap)e+=r.gpuMemoryUsage;return e}get test(){return{coverage:this._grid.coverageMipmap,blur:[this._blur0Fbo,this._blur1Fbo]}}};const j1t={dataType:ks.UNSIGNED_BYTE,internalFormat:Tt.RGBA},H1t={};let q1t=class{constructor(e){this._rctx=e,this._activeTargets=new Set,this._colorTextures=new Map,this._depthTextures=new Map,this._fbos=new Map}dispose(){this._depthTextures.forEach(e=>e.dispose()),this._depthTextures.clear(),this._colorTextures.forEach(e=>e.dispose()),this._colorTextures.clear(),this._fbos.forEach(e=>e.dispose()),this._fbos.clear(),this._activeTargets.clear()}disposeTargetResource(e){const r=e.id;this._activeTargets.has(r)&&(this._activeTargets.delete(r),this._disposeWithFramebuffers(this._depthTextures,r),this._disposeWithFramebuffers(this._colorTextures,r))}_disposeWithFramebuffers(e,r){const i=e.get(r);i&&(this._fbos.forEach((s,n)=>{s.colorTexture!==i&&s.depthStencilAttachment!==i||(s.detachColorTexture(),s.detachDepthStencilTexture(),s.dispose(),this._fbos.delete(n))}),i.dispose(),e.delete(r))}_getDepthTexture(e,r,i){let s=this._depthTextures.get(e.id);if(!s||s.descriptor.width===r&&s.descriptor.height===i||(s.dispose(),s=null),!s){const n=new vr(r,i);n.pixelFormat=Tt.DEPTH_STENCIL,n.dataType=ks.UNSIGNED_INT_24_8,n.samplingMode=Ct.NEAREST,n.wrapMode=$t.CLAMP_TO_EDGE,s=new Et(this._rctx,n),this._depthTextures.set(e.id,s),this._activeTargets.add(e.id)}return s}getAllocatedDepthTexture(e){return this._depthTextures.get(e.id)}getColorTexture(e,r,i){let s=this._colorTextures.get(e.id);if(s&&(s.descriptor.width===r&&s.descriptor.height===i||(s.dispose(),s=X2())),!s){const n=new vr(r,i);n.internalFormat=e.internalFormat,n.dataType=e.dataType,n.samplingMode=e.samplingMode!=null?e.samplingMode:Ct.LINEAR,n.wrapMode=$t.CLAMP_TO_EDGE,s=new Et(this._rctx,n),this._colorTextures.set(e.id,s),this._activeTargets.add(e.id)}return s}getAllocatedColorTexture(e){return this._colorTextures.get(e.id)}registerDepthTarget(e={}){return{id:gc(),...H1t,...e}}registerColorTarget(e={}){return{id:gc(),...j1t,...e}}getFramebuffer(e,r,i,s){const n=this._getKey(i,s);let o=this._fbos.get(n);const a=this.getColorTexture(i,e,r),l=s?this._getDepthTexture(s,e,r):void 0;return o?((o.width!==e||o.height!==r||o.colorTexture!==a||o.depthStencilAttachment!==l)&&(o.detachColorTexture(),o.detachDepthStencilTexture(),o.resize(e,r),o.attachColorTexture(a),o.attachDepthStencil(l)),o):(o=new hn(this._rctx,a,l),this._fbos.set(n,o),o)}_getKey(e,r){return`${e.id}_${r?r.id:"X"}_${e.name}${r?"_"+r.name:""}`}get gpuMemoryUsage(){let e=0;const r=new Set,i=s=>{r.has(s)||(r.add(s),e+=s.gpuMemoryUsage)};return this._colorTextures.forEach(i),this._depthTextures.forEach(i),e}},W1t=class{constructor(e,r){this._rctx=e,this._compositingHelper=r,this._mainColorTarget=0,this.width=4,this.height=4,this._background={type:"color",color:[0,0,0,1]},this._renderTargetHelper=new q1t(e);const i=this._renderTargetHelper;this._mainColorTargets=[i.registerColorTarget({name:"mainColorTarget0"}),i.registerColorTarget({name:"mainColorTarget1"})],this.frontFaceTarget=i.registerColorTarget({name:"frontFaceTarget"}),this.colorFloatTarget=i.registerColorTarget({name:"colorFloatTarget",dataType:ks.HALF_FLOAT,internalFormat:Xe.RGBA16F,samplingMode:Ct.NEAREST}),this.alphaFloatTarget=i.registerColorTarget({name:"alphaFloatTarget",dataType:ks.HALF_FLOAT,internalFormat:Xe.R16F,samplingMode:Ct.NEAREST}),this.mainDepth=i.registerDepthTarget({name:"mainDepth"}),this.linearDepth=i.registerColorTarget({name:"linearDepth",samplingMode:Ct.NEAREST}),this.terrainLinearDepth=i.registerColorTarget({name:"terrainLinearDepth"}),this.geometryLinearDepth=i.registerColorTarget({name:"geometryLinearDepth"}),this.normal=i.registerColorTarget({name:"normal"}),this.highlight=i.registerColorTarget({name:"highlight",internalFormat:Xe.RGBA4,dataType:ks.UNSIGNED_SHORT_4_4_4_4}),this.hudVisibility=i.registerColorTarget({name:"hudVisibility",internalFormat:Xe.RGBA4,dataType:ks.UNSIGNED_SHORT_4_4_4_4}),this.tmpColor=i.registerColorTarget({name:"tmpColor"}),this.tmpDepth=i.registerDepthTarget({name:"tmpDepth"}),this.hudColor=i.registerColorTarget({name:"hudColor"})}dispose(){this._renderTargetHelper.dispose()}set background(e){this._background=e}get background(){return this._background}get currentColorTarget(){return this._mainColorTargets[this._mainColorTarget]}get previousColorTarget(){return this._mainColorTargets[1-this._mainColorTarget]}get framebuffer(){return this.getFramebuffer(this.currentColorTarget,this.mainDepth)}getFramebuffer(e,r){return this._renderTargetHelper.getFramebuffer(this.width,this.height,e,r)}get colorTexture(){return this._renderTargetHelper.getAllocatedColorTexture(this.currentColorTarget)}get depthTexture(){return this._renderTargetHelper.getAllocatedDepthTexture(this.mainDepth)}get linearDepthTexture(){return this._renderTargetHelper.getAllocatedColorTexture(this.linearDepth)}get terrainLinearDepthTexture(){return this._renderTargetHelper.getAllocatedColorTexture(this.terrainLinearDepth)}get geometryLinearDepthTexture(){return this._renderTargetHelper.getAllocatedColorTexture(this.geometryLinearDepth)}get lastFrameColorTexture(){return this._renderTargetHelper.getAllocatedColorTexture(this.previousColorTarget)}get normalTexture(){return this._renderTargetHelper.getAllocatedColorTexture(this.normal)}get highlightTexture(){return this._renderTargetHelper.getAllocatedColorTexture(this.highlight)}get hudVisibilityTexture(){return this._getColorTexture(this.hudVisibility)}get tmpColorTexture(){return this._getColorTexture(this.tmpColor)}get hudColorTexture(){return this._getColorTexture(this.hudColor)}get mainColorTexture(){return this._getColorTexture(this.currentColorTarget)}setupRenderTarget(e){e?this._mainColorTarget=this._mainColorTarget?0:1:(this._mainColorTarget=0,this.disposeTarget(this._mainColorTargets[1]))}initializeFrame(e){const r=this._rctx;this.width=e.fullWidth,this.height=e.fullHeight,_b(this,r.parameters.maxTextureSize),this.bindTarget(this.currentColorTarget,this.mainDepth),r.setClearStencil(0);const i=this._background.color;r.setClearColor(i[0]*i[3],i[1]*i[3],i[2]*i[3],i[3]),r.clearSafe(wi.COLOR_BUFFER_BIT|wi.DEPTH_BUFFER_BIT|wi.STENCIL_BUFFER_BIT)}composite(e){this.colorTexture!=null&&this._compositingHelper.composite(e,this.colorTexture,oa.None)}renderTmpAndCompositeToMain(e,r,i,s=!1){this.renderToTargets(e,this.tmpColor,s?this.tmpDepth:this.mainDepth,Z1t),this._compositingHelper.composite(r,this._getColorTexture(this.tmpColor),i)}compositeAtmosphereToMain(e,r,i,s){this.bindTarget(this.currentColorTarget),this._compositingHelper.compositeAtmosphere(e,this._renderTargetHelper.getColorTexture(this.tmpColor,this.width,this.height),i,s,r),this.bindTarget(this.currentColorTarget,this.mainDepth)}renderHUDVisibility(e,r=!1){this.renderToTargets(e,this.hudVisibility,r?this.tmpDepth:this.mainDepth,X1t)}compositeTransparentTerrainOntoHUDVisibility(e){this.renderToTargets(()=>this._compositingHelper.compositeHUD(e,this._getColorTexture(this.tmpColor)),this.hudVisibility,this.tmpDepth)}renderOITPass(e,r,i){let s,n;switch(r){case ot.Color:s=this.colorFloatTarget,n=[0,0,0,0];break;case ot.Alpha:s=this.alphaFloatTarget,n=[1,1,1,1];break;case ot.FrontFace:s=this.frontFaceTarget,n=[0,0,0,0];break;case ot.NONE:case ot.COUNT:return}i?this.renderToTargets(e,s,this.tmpDepth,n,!0,!0):this.renderToTargets(e,s,this.mainDepth,n,!1)}compositeTransparentTerrainOntoMain(e){this.bindFramebuffer(),this._compositingHelper.composite(e,this._getColorTexture(this.tmpColor),oa.PremultipliedAlpha)}compositeOccludedOntoMain(e,r){this.bindFramebuffer(),this._compositingHelper.composite(e,this._getColorTexture(this.tmpColor),oa.PremultipliedAlpha,r)}compositeTransparentOntoOpaque(e,r){r?(this.bindTarget(this.hudColor,this.tmpDepth),this._rctx.setClearColor(0,0,0,1e-13),this._rctx.clearSafe(wi.COLOR_BUFFER_BIT)):this.bindFramebuffer(),this._compositingHelper.compositeOIT(e,this._getColorTexture(this.colorFloatTarget),this._getColorTexture(this.alphaFloatTarget),this._getColorTexture(this.frontFaceTarget))}bindFramebuffer(){this._rctx.bindFramebuffer(this.framebuffer)}renderDepthDetached(e){this.bindTarget(this.currentColorTarget),e(),this.bindTarget(this.currentColorTarget,this.mainDepth)}disposeTarget(e){this._renderTargetHelper.disposeTargetResource(e)}renderToFBO(e,r,i=!1,s=!1){const n=this._rctx;let o=0;if(r){const l=Math.max(1e-13,r[3]);n.setClearColor(r[0],r[1],r[2],l),o|=wi.COLOR_BUFFER_BIT}i&&(o|=wi.DEPTH_BUFFER_BIT),s===!1?s=0:(s===!0&&(s=255),o|=wi.STENCIL_BUFFER_BIT),o&&n.clearSafe(o,s),e(),n.gl.flush(),this.bindTarget(this.currentColorTarget,this.mainDepth)}renderToTargets(e,r,i,s,n=!1,o=!1){const a=this.bindTarget(r,i);return this.renderToFBO(e,s,n,o),a}bindTarget(e,r){const i=this._renderTargetHelper.getFramebuffer(this.width,this.height,e,r);return this._rctx.bindFramebuffer(i),i}_getColorTexture(e){return this._renderTargetHelper.getColorTexture(e,this.width,this.height)}get gpuMemoryUsage(){let e=0;return this._renderTargetHelper&&(e+=this._renderTargetHelper.gpuMemoryUsage),e}};const Z1t=[0,0,0,0],X1t=[0,1,0,1];let u3=class extends Te{constructor(e){super({}),this._context=e,this._renderPlugins=new kt,this._slots=[];for(let r=0;r<ue.MAX_SLOTS;++r)this._slots[r]=[]}normalizeCtorArgs(){return{}}add(e,r,i){const s=()=>{if(i?.aborted)throw r.uninitializeRenderContext(),Dr();this._renderPlugins.push(r);for(const o of e)this._slots[o].push(r);this._context.requestRender()},n=r.initializeRenderContext(this._context,i);if(bu(n))return n.then(s);s(),this.notifyChange("_renderPlugins")}remove(e){if(this._renderPlugins.removeUnordered(e)!=null){for(let r=0;r<this._slots.length;++r)this._slots[r]=this._slots[r].filter(i=>i!==e);e.uninitializeRenderContext(),this._context.requestRender(),this.notifyChange("_renderPlugins")}}prepareRender(){this._renderPlugins.forAll(e=>{e.prepareRender&&e.prepareRender(this._context.renderContext)})}updateAnimation(e){let r=!1;return this._renderPlugins.forAll(i=>{i.updateAnimation&&(r=i.updateAnimation(e)||r)}),r}prepareSlots(e){for(const r of e)this._context.renderContext.bindParameters.slot=r,this._slots[r].filter(i=>{i.canRender&&(hue(i)&&i.prepareTechnique(this._context.renderContext),due(i)&&i.prepareTechniques(this._context.renderContext))})}render(){const e=this._slots[this._context.renderContext.bindParameters.slot],r=new Array;e.filter(i=>{if(!i.canRender)return!1;if(hue(i)){const s=i.prepareTechnique(this._context.renderContext);return s!=null&&(r.push(s),!0)}if(due(i)){const s=i.prepareTechniques(this._context.renderContext);return s!=null&&(r.push(s),!0)}return r.push(null),!0}).forEach((i,s)=>i.render(this._context.renderContext,r[s]))}queryDepthRange(e){const r=Y1t;return r.near=1/0,r.far=-1/0,this._renderPlugins.forAll(i=>{if(i.queryDepthRange){const s=i.queryDepthRange(e);s&&z2(r,s,r)}}),r}get updating(){return this._renderPlugins.some(e=>e.running)}get needsTransparentPass(){return this._renderPlugins.some(e=>e.needsTransparentPass)}get needsHighlight(){return this._renderPlugins.some(e=>e.needsHighlight)}get needsLinearDepth(){return this._renderPlugins.some(e=>e.needsLinearDepth)}get needsLaserlineWithContrastControl(){const e=this._slots[ue.LASERLINES_CONTRAST_CONTROL];return!!e&&e.length>0}get renderOccludedFlags(){return this._renderPlugins.reduce((e,r)=>e|r.renderOccludedFlags,Mi.None)}};function hue(t){return"prepareTechnique"in t}function due(t){return"prepareTechniques"in t}u([d()],u3.prototype,"_renderPlugins",void 0),u([d({readOnly:!0})],u3.prototype,"updating",null),u3=u([R("esri.views.3d.webgl-engine.lib.RenderPluginManager")],u3);const Y1t={near:0,far:0};let eOe=class extends eJ{};const N6=255,J1t=1/N6;function Q1t(t){const e=new wr,r=e.fragment;return r.include(Ec),r.include(_u),e.include(x6),e.include(Uh),e.include(w6,t),r.uniforms.add(new Je("depthMap",i=>i.linearDepthTexture),new $i("inverseViewMatrix",(i,s)=>On(pue,Al(pue,s.camera.viewMatrix,s.camera.center))),new Sr("nearFar",(i,s)=>s.camera.nearFar)),r.constants.add("sampleValue","float",J1t),r.code.add(b`void main(void) {
float depth = rgba2float(texture(depthMap, uv));
if (depth == 0.0) {
discard;
}
float currentPixelDepth = linearDepthFromFloat(depth, nearFar);
if (-currentPixelDepth > nearFar.y || -currentPixelDepth < nearFar.x) {
discard;
}
vec4 currentPixelPos = vec4(reconstructPosition(gl_FragCoord.xy, currentPixelDepth), 1.0);
vec4 worldSpacePos = inverseViewMatrix * currentPixelPos;
mat4 shadowMatrix;
float linearDepth = -currentPixelDepth;
int i = chooseCascade(linearDepth, shadowMatrix);
if (i >= numCascades) {
discard;
}
vec3 lvpos = lightSpacePosition(worldSpacePos.xyz, shadowMatrix);
if (lvpos.z >= 1.0 || lvpos.x < 0.0 || lvpos.x > 1.0 || lvpos.y < 0.0 || lvpos.y > 1.0) {
discard;
}
vec2 uvShadow = cascadeCoordinates(i, lvpos);
float depthShadow = readShadowMapDepth(uvShadow, shadowMapTex);
bool shadow = depthShadow < lvpos.z;
if (!shadow) {
discard;
}
fragColor = vec4(sampleValue);
}`),e}const pue=be(),K1t=Object.freeze(Object.defineProperty({__proto__:null,ShadowCastAccumulatePassParameters:eOe,ShadowCastMaxSamples:N6,build:Q1t},Symbol.toStringTag,{value:"Module"}));var ww;(function(t){t[t.Gradient=0]="Gradient",t[t.Threshold=1]="Threshold",t[t.COUNT=2]="COUNT"})(ww||(ww={}));let iq=class extends pa{constructor(){super(...arguments),this.visualization=ww.Gradient,this.bandsEnabled=!1}};u([B({count:ww.COUNT})],iq.prototype,"visualization",void 0),u([B()],iq.prototype,"bandsEnabled",void 0);let tOe=class extends ei{constructor(e){super(),this._data=e,this.sampleScale=0,this.opacityFromElevation=1,this.color=VR(ebt),this.bandSize=.1,this.threshold=.5}get shadowCastMap(){return this._data.shadowCastTexture}};const ebt=Lt(.01,0,.25,1);function tbt(t){const e=new wr,r=e.fragment;r.include(Ec),r.include(_u),e.include(x6),e.include(Uh);const{visualization:i,bandsEnabled:s}=t;r.constants.add("inverseSampleValue","float",N6),r.uniforms.add(new Je("shadowCastMap",a=>a.shadowCastMap),new Re("sampleScale",a=>a.sampleScale),new Re("opacityFromElevation",a=>a.opacityFromElevation),new sr("uColor",a=>a.color));const n=i===ww.Gradient,o=i===ww.Threshold;return n&&s?r.uniforms.add(new Re("bandSize",a=>a.bandSize)):o&&r.uniforms.add(new Re("threshold",a=>a.threshold)),r.code.add(b`
      void main(void) {
        vec4 record = texture(shadowCastMap, uv);
        float pixelSamples = record.r * inverseSampleValue;
        if (pixelSamples < 1.0) {
          discard;
        }

        float strength = pixelSamples * sampleScale;

        ${o?b`
            if (strength <= threshold) {
              discard;
            }`:""}

        ${n&&s?b`strength = ceil(strength / bandSize) * bandSize;`:""}

        fragColor = vec4(uColor.xyz, uColor.a * opacityFromElevation ${n?b`* strength`:""});
      }
    `),e}const rbt=Object.freeze(Object.defineProperty({__proto__:null,ShadowCastVisualizePassParameters:tOe,build:tbt},Symbol.toStringTag,{value:"Module"}));let rOe=class iOe extends Pr{constructor(e,r){super(e,r,()=>this.destroy())}initializeProgram(e){return new Cr(e.rctx,iOe.shader.get().build(this.configuration),br)}initializePipeline(){return At({blending:uu,colorWrite:Vt,depthTest:null,depthWrite:null})}get primitiveType(){return St.TRIANGLE_STRIP}};rOe.shader=new Er(rbt,()=>ae(()=>import("./ShadowCastVisualize.glsl-359c8cfa.js"),[],import.meta.url));const ibt=4e4,sbt=5e4,sOe=1/512;let ED=class extends Te{constructor(e,r,i,s){super({}),this._techniqueRepository=e,this._rctx=r,this._data=i,this._requestRender=s,this._passParameters=new tOe(this._data),this._techniqueConfig=new iq,this._enabled=!1,this._vao=Rl(r),this._techniqueConfig.visualization=ww.Gradient}normalizeCtorArgs(){return{}}dispose(){this._stop(),this._vao=Ue(this._vao),this._techniqueRepository.release(this._technique),this._technique=null}get _visualizeShadowCastTechnique(){return this._technique=this._techniqueRepository.releaseAndAcquire(rOe,this._techniqueConfig,this._technique),this._technique}render(e){if(!this._showVisualization)return;this._passParameters.sampleScale=1/this._data.computedSamples;const r=this._visualizeShadowCastTechnique;this._rctx.bindVAO(this._vao),this._rctx.bindTechnique(r,this._passParameters,e),this._rctx.drawArrays(r.primitiveType,0,Fo(this._vao,"geometry"))}setOptions(e){e.enabled!==void 0&&this._setEnabled(e.enabled),e.color!==void 0&&this._setColor(e.color),e.threshold!==void 0&&(this._threshold=e.threshold),e.visualization!==void 0&&(this._visualization=e.visualization),e.bandSize!==void 0&&(this._bandSize=e.bandSize),e.bandsEnabled!==void 0&&(this._bandsEnabled=e.bandsEnabled)}get opacityFromElevation(){return this._passParameters.opacityFromElevation}set opacityFromElevation(e){this._passParameters.opacityFromElevation!==e&&(this._passParameters.opacityFromElevation=e,this.notifyChange("opacityFromElevation"))}get _showVisualization(){return this._enabled&&this._data.computedSamples>0&&this.opacityFromElevation>sOe}get _threshold(){return this._passParameters.threshold}set _threshold(e){this._threshold!==e&&(this._passParameters.threshold=e,this._requestRenderIfRunning())}get _visualization(){return this._techniqueConfig.visualization}set _visualization(e){e!==this._visualization&&(this._techniqueConfig.visualization=e,this._techniqueRepository.release(this._technique),this._technique=null,this._requestRenderIfRunning())}get _bandSize(){return this._passParameters.bandSize}set _bandSize(e){e!==this._bandSize&&(this._passParameters.bandSize=e,this._requestRenderIfRunning())}get _bandsEnabled(){return this._techniqueConfig.bandsEnabled}set _bandsEnabled(e){e!==this._bandsEnabled&&(this._techniqueConfig.bandsEnabled=e,this._techniqueRepository.release(this._technique),this._technique=null,this._requestRenderIfRunning())}_setColor(e){const r=this._passParameters.color;wS(e,r)||(mh(this._passParameters.color,e),this._requestRenderIfRunning())}_setEnabled(e){e!==this._enabled&&(e?this._start():this._stop())}_requestRenderIfRunning(){this._enabled&&this._requestRender()}_start(){this._enabled=!0,this._requestRender()}_stop(){this._enabled=!1,this._requestRender()}};u([d()],ED.prototype,"opacityFromElevation",null),ED=u([R("esri.views.3d.webgl-engine.lib.ShadowCastRenderer")],ED);let BJ=class extends pa{constructor(){super(...arguments),this.receiveShadows=!0}};u([B()],BJ.prototype,"receiveShadows",void 0);let nOe=class oOe extends Pr{constructor(e){super(e,new BJ,()=>this.destroy())}initializeProgram(e){return new Cr(e.rctx,oOe.shader.get().build(this.configuration),br)}initializePipeline(){return At({blending:xo(we.ONE,we.ONE,we.ONE,we.ONE),colorWrite:Vt,depthTest:null,depthWrite:null})}get primitiveType(){return St.TRIANGLE_STRIP}};nOe.shader=new Er(K1t,()=>ae(()=>import("./ShadowCastAccumulate.glsl-bbb296ea.js"),[],import.meta.url));let dl=class extends Te{constructor(e,r,i,s,n,o){super({}),this._rctx=e,this._stage=i,this._prepareForShadowMapPass=s,this._renderToShadowMap=n,this._requestRender=o,this._progress=0,this._sampleCount=0,this._passParameters=new eOe,this._cachedLightDirections=[],this._depthRange=XH,this._previewing=!1,this._handles=new Oi,this._cameraForcedForScreenshot=!1,this._bindParameters=new k5(new QY(e,i.viewingMode),null,null),this._bindParameters.shadowMap.enabled=!0,this._vao=Rl(e),this._accumulationRenderer=new ED(r,e,this,o);const a=this._stage.view.resourceController.scheduler;this._handles.add([a.registerTask(dt.SHADOW_ACCUMULATOR,this),le(()=>i.renderView,l=>{this._handles.remove(fue),l!=null&&this._handles.add(l.events.on("force-camera-for-screenshot",()=>this._cameraForcedForScreenshot=!0),fue)},As),le(()=>this._previewing,()=>this._requestRenderIfEnabled(),jr)])}normalizeCtorArgs(){return{}}dispose(){this._disable(),this._handles.destroy(),this._accumulationRenderer=Ue(this._accumulationRenderer),this._bindParameters.shadowMap.dispose(),this._fbo=Ue(this._fbo),this._vao=Ue(this._vao),this._accumulationTechniqueCached=Ui(this._accumulationTechniqueCached),this._cachedLightDirections.length=0,this._sampleCount=0}get computedSamples(){return this._progress}get shadowCastTexture(){return this._fbo?.colorTexture}get isAccumulating(){return this._isPreviewing||this._isRefining}get _accumulationTechnique(){if(this._accumulationTechniqueCached==null){const e={rctx:this._rctx,viewingMode:this._stage.viewingMode};this._accumulationTechniqueCached=new nOe(e)}return this._accumulationTechniqueCached}get _isRefining(){return this._isActive&&!this._isDoneAccumulating&&!this._previewing}get _isPreviewing(){return this._isActive&&this._previewing}get _isActive(){return this._fbo!=null&&this._sampleCount>0}get canAccumulate(){return this._passParameters.linearDepthTexture!==null&&this._depthRange!==XH&&this._opacityFromElevation>sOe}get _isDoneAccumulating(){return this._progress>=this._sampleCount}get _lightDirections(){return this._cachedLightDirections}set _lightDirections(e){const r=this._cachedLightDirections;if(Pg(r,e,T_))return;const i=Math.min(N6,e.length);r.length=i,this._sampleCount=i;for(let s=0;s<i;++s)r[s]=ie(r[s]??C(),e[s]);this._invalidate()}get _opacityFromElevation(){return this._accumulationRenderer.opacityFromElevation}set _opacityFromElevation(e){this._accumulationRenderer.opacityFromElevation=e}get running(){return this._isRefining&&this.canAccumulate&&this._progress>0}runTask(e){for(this._prepareForShadowMapPass(this._bindParameters);!e.done&&!this._isDoneAccumulating;)this._accumulateShadow(),e.madeProgress();this._requestRender()}renderAccumulation(e,r,i,s){if(this._depthRange=r,this._updateCamera(i),this._bindParameters.contentCamera=s,this._passParameters.linearDepthTexture=e,this._passParameters.origin=this._bindParameters.camera.center,this.notifyChange("canAccumulate"),!this.isAccumulating||!this.canAccumulate)return;(this._previewing||this._progress===0||this._cameraForcedForScreenshot)&&this._clear();const n=this._cameraForcedForScreenshot?this._sampleCount:Math.min(nbt,this._sampleCount-this._progress);for(let o=0;o<n;++o)this._accumulateShadow();this._cameraForcedForScreenshot=!1,this._requestRender()}render(e){this._accumulationRenderer.render(e)}setOptions(e){if(e.enabled!==void 0){const r=this._fbo!=null;e.enabled!==r&&(e.enabled?this._enable():this._disable())}e.previewing!==void 0&&(this._previewing=e.previewing),e.lightDirections!==void 0&&(this._lightDirections=e.lightDirections),this._accumulationRenderer.setOptions(e)}readAccumulatedShadow(e,r){return!this._isActive||!this._fbo||this._progress<1||e<0||e>=this._fbo.width||r<0||r>=this._fbo.height?0:(this._fbo.readPixels(e,r,1,1,Tt.RGBA,ks.UNSIGNED_BYTE,mue),mue[0]/this._progress)}_enable(){this._progress=0;const e=new vr;e.wrapMode=$t.CLAMP_TO_EDGE,this._fbo=new hn(this._rctx,e)}_disable(){this._fbo=Ue(this._fbo)}_invalidate(){this._progress=0,this._requestRenderIfEnabled()}_clear(){this._rctx.bindFramebuffer(this._fbo),this._rctx.setClearColor(0,0,0,0),this._rctx.clearSafe(wi.COLOR_BUFFER_BIT),this._progress=0}_accumulateShadow(){this._renderToShadowMap(this._bindParameters,this._sampleLightDirection(),this._depthRange);const e=this._accumulationTechnique;this._rctx.bindFramebuffer(this._fbo),this._rctx.bindTechnique(e,this._passParameters,this._bindParameters),this._rctx.bindVAO(this._vao),this._rctx.drawArrays(e.primitiveType,0,Fo(this._vao,"geometry"))}_sampleLightDirection(){return this._progress++,this._lightDirections[this._progress*obt%this._lightDirections.length]}_updateCamera(e){!e.equals(this._bindParameters.camera)&&this._fbo&&(this._bindParameters.camera.copyFrom(e),this._fbo.resize(e.fullWidth,e.fullHeight),this._opacityFromElevation=1-TO(ibt,sbt,e.relativeElevation))}_requestRenderIfEnabled(){this._fbo&&this._requestRender()}get test(){const e=this;return{lightDirections:this._lightDirections,get isDone(){return e._isDoneAccumulating},get isActive(){return e._isActive}}}};u([d()],dl.prototype,"_progress",void 0),u([d()],dl.prototype,"_sampleCount",void 0),u([d()],dl.prototype,"_fbo",void 0),u([d()],dl.prototype,"_depthRange",void 0),u([d()],dl.prototype,"_previewing",void 0),u([d()],dl.prototype,"_accumulationRenderer",void 0),u([d()],dl.prototype,"_isRefining",null),u([d()],dl.prototype,"_isActive",null),u([d()],dl.prototype,"canAccumulate",null),u([d()],dl.prototype,"_isDoneAccumulating",null),u([d()],dl.prototype,"_opacityFromElevation",null),u([d()],dl.prototype,"running",null),dl=u([R("esri.views.3d.webgl-engine.lib.ShadowAccumulator")],dl);const nbt=6,fue="renderView",obt=104729,mue=new Uint8Array(4),gue={highlightedThreshold:.99999,selfShadowThreshold:.025};function abt(t){const e=new wr;e.include(gw,t);const r=e.fragment;return r.include(Ec),r.include(_u),e.include(x6),e.include(Uh),r.uniforms.add(new Je("defaultDepthTex",(i,s)=>s.shadowMap.getSnapshot(U2.Default)),new Je("highlightDepthTex",(i,s)=>s.shadowMap.getSnapshot(U2.Highlight)),new Je("depthMap",(i,s)=>s.linearDepthTexture),new Je("highlightMap",(i,s)=>s.highlightColorTexture),new sr("uColor",i=>i.shadowColor),new Sr("nearFar",(i,s)=>s.camera.nearFar),new Re("opacity",i=>i.shadowOpacity),new Re("occludedOpacity",i=>i.occludedShadowOpacity),new Re("terminationFactor",i=>i.opacityElevation*i.dayNightTerminator),new Ft("lightingMainDirectionView",(i,s)=>me(_ue,$e(_ue,s.lighting.mainLight.direction,s.camera.viewInverseTransposeMatrix))),new Sr("texelSize",(i,s)=>s.linearDepthTexture!=null?or(lbt,1/s.linearDepthTexture.descriptor.width,1/s.linearDepthTexture.descriptor.height):ap),new $i("inverseViewMatrix",(i,s)=>On(yue,Al(yue,s.camera.viewMatrix,s.camera.center)))),r.constants.add("unoccludedHighlightFlag","vec4",HSe).add("highlightedThreshold","float",gue.highlightedThreshold).add("selfShadowThreshold","float",gue.selfShadowThreshold),r.code.add(b`vec3 normalFromDepth(vec3 pixelPos, vec2 fragCoord, vec2 uv, vec2 texelSize, sampler2D depthMap, vec2 nearFar) {
float leftPixelDepth = linearDepthFromTexture(depthMap, uv + vec2(-1.0, 0.0) * texelSize, nearFar);
float rightPixelDepth = linearDepthFromTexture(depthMap, uv + vec2(1.0, 0.0) * texelSize, nearFar);
float bottomPixelDepth = linearDepthFromTexture(depthMap, uv + vec2(0.0, -1.0) * texelSize, nearFar);
float topPixelDepth = linearDepthFromTexture(depthMap, uv + vec2(0.0, 1.0) * texelSize, nearFar);
bool pickLeft = abs(pixelPos.z - leftPixelDepth) < abs(pixelPos.z - rightPixelDepth);
bool pickBottom = abs(pixelPos.z - bottomPixelDepth) < abs(pixelPos.z - topPixelDepth);
vec3 fragCoordHorizontal = pickLeft
? vec3(fragCoord + vec2(-1.0, 0.0), leftPixelDepth)
: vec3(fragCoord + vec2(1.0, 0.0), rightPixelDepth);
vec3 fragCoordVertical = pickBottom
? vec3(fragCoord + vec2(0.0, -1.0), bottomPixelDepth)
: vec3(fragCoord + vec2(0.0, 1.0), topPixelDepth);
vec3 verticalPixelPos = reconstructPosition(fragCoordHorizontal.xy, fragCoordHorizontal.z);
vec3 horizontalPixelPos = reconstructPosition(fragCoordVertical.xy, fragCoordVertical.z);
vec3 normal = normalize(cross(verticalPixelPos - pixelPos, horizontalPixelPos - pixelPos));
return pickLeft == pickBottom ? normal : -normal;
}`),r.code.add(b`void main(void) {
vec4 highlightInfo = texture(highlightMap, uv);
float visiblyHighlighted = (1.0 - clamp(distance(unoccludedHighlightFlag, highlightInfo), 0.0, 1.0)) * highlightInfo.a;
if (visiblyHighlighted > highlightedThreshold) {
discard;
}
float depth = rgba2float(texture(depthMap, uv));
if (depth == 0.0) {
discard;
}
float currentPixelDepth = linearDepthFromFloat(depth, nearFar);
if (-currentPixelDepth>nearFar.y || -currentPixelDepth<nearFar.x) {
discard;
}
vec4 currentPixelPos = vec4(reconstructPosition(gl_FragCoord.xy, currentPixelDepth), 1.0);
vec4 worldSpacePos = inverseViewMatrix * currentPixelPos;
mat4 shadowMatrix;
float linearDepth = -currentPixelDepth;
int i = chooseCascade(linearDepth, shadowMatrix);
if (i >= numCascades) {
discard;
}
vec3 lvpos = lightSpacePosition(worldSpacePos.xyz, shadowMatrix);
if (lvpos.z >= 1.0 || lvpos.x < 0.0 || lvpos.x > 1.0 || lvpos.y < 0.0 || lvpos.y > 1.0) {
discard;
}
vec2 uvShadow = cascadeCoordinates(i, lvpos);
float depthHighlight = readShadowMapDepth(uvShadow, highlightDepthTex);
bool shadowHighlight = depthHighlight < lvpos.z;
if (!shadowHighlight) {
discard;
}
float depthDefault = readShadowMapDepth(uvShadow, defaultDepthTex);
bool shadowDefault = depthDefault < lvpos.z;
vec3 normal = normalFromDepth(currentPixelPos.xyz, gl_FragCoord.xy, uv, texelSize, depthMap, nearFar);
bool shaded = dot(normal, lightingMainDirectionView) < selfShadowThreshold;
float fragOpacity = (shadowDefault || shaded) ? occludedOpacity : opacity;
fragColor = vec4(uColor.rgb, uColor.a * fragOpacity * terminationFactor);
}`),e}const yue=be(),_ue=C(),lbt=Ve(),cbt=Object.freeze(Object.defineProperty({__proto__:null,build:abt},Symbol.toStringTag,{value:"Module"}));let ubt=class extends eJ{constructor(){super(...arguments),this.shadowColor=Lt(1,0,1,1),this.shadowOpacity=.2,this.occludedShadowOpacity=.1,this.opacityElevation=1,this.dayNightTerminator=1}},aOe=class lOe extends Pr{constructor(e){super(e,new BJ,()=>this.destroy())}initializeProgram(e){return new Cr(e.rctx,lOe.shader.get().build(this.configuration),br)}initializePipeline(){return At({blending:xo(we.SRC_ALPHA,we.ONE,we.ONE_MINUS_SRC_ALPHA,we.ONE_MINUS_SRC_ALPHA),colorWrite:Vt,depthTest:null,depthWrite:null})}get primitiveType(){return St.TRIANGLE_STRIP}};aOe.shader=new Er(cbt,()=>ae(()=>import("./ShadowHighlight.glsl-ff7fb830.js"),[],import.meta.url));const hbt=.001953125,dbt=4e4,pbt=5e4;let fbt=class{constructor(e,r){this._rctx=e,this._viewingMode=r,this._maxOpacity=1,this._passParameters=new ubt,this._drawParameters=new Xlt,this._vao=Rl(this._rctx)}get _technique(){return this._techniqueCached==null&&(this._techniqueCached=new aOe({rctx:this._rctx,viewingMode:this._viewingMode})),this._techniqueCached}render(e,r){if(!e.shadowMap.enabled||!e.linearDepthTexture||!this.isVisible)return;const i=this._technique;this._drawParameters.origin=e.camera.center,this._rctx.bindFramebuffer(r),this._rctx.bindTechnique(i,this._passParameters,e).bindDraw(this._drawParameters,e,this._passParameters),this._rctx.bindVAO(this._vao),this._rctx.drawArrays(i.primitiveType,0,Fo(this._vao,"geometry"))}get gpuMemoryUsage(){return this._vao?.memoryEstimate??0}setDefaultOptions(e){this._passParameters={...this._passParameters,...e},this._updateMaxOpacity()}updateParameters(e,r){this._passParameters.opacityElevation=1-TO(dbt,pbt,e.relativeElevation);const i=this._viewingMode===De.Global?me(vue,e.center):se(vue,0,0,1),s=fe(i,r);this._passParameters.dayNightTerminator=TO(0,1,ge(30*s,0,1))}dispose(){this._vao=Ue(this._vao),this._techniqueCached=Ui(this._techniqueCached)}get isVisible(){const{opacityElevation:e,dayNightTerminator:r}=this._passParameters;return this._maxOpacity*e*r>=hbt}_updateMaxOpacity(){const e=Math.max(this._passParameters.shadowOpacity,this._passParameters.occludedShadowOpacity);this._maxOpacity=e*this._passParameters.shadowColor[3]}};const vue=C(),bue=Yg();let mbt=class{constructor(){this._plane=Yg()}get isEnabled(){return!Fbe(this.plane,bue)}get plane(){return this._plane}set plane(e){Uw(e||bue,this._plane)}},gbt=class extends ei{};function fR(t){t.uniforms.add(new sr("resolution",e=>{const{descriptor:r}=e.colorTexture,i=r.width,s=r.height;return bi(ybt,1/i,1/s,i,s)}))}const ybt=Wt(),Yx={maxSearchSteps:8,maxDistanceAreaTex:16};function _bt(){const t=new wr,{attributes:e,varyings:r,vertex:i,fragment:s}=t;return e.add(E.POSITION,"vec2"),r.add("uv","vec2"),r.add("offsets[2]","vec4"),r.add("maxOffset","vec4"),r.add("pixelCoord","vec2"),fR(i),i.code.add(b`
      void main() {
        uv = position * 0.5 + vec2(0.5);
        gl_Position = vec4(position, 0, 1);

        pixelCoord = uv * resolution.zw;
        offsets[0] = uv.xyxy + resolution.xyxy * vec4( -0.25, 0.125, 1.25, 0.125 );
        offsets[1] = uv.xyxy + resolution.xyxy * vec4( -0.125, 0.25, -0.125, -1.25 );
        maxOffset = vec4( offsets[0].xz, offsets[1].yw ) + vec4( -2.0, 2.0, -2.0, 2.0 ) * resolution.xxyy * float( ${b.int(Yx.maxSearchSteps)} );
      }
    `),s.uniforms.add(new Je("edgesTexture",n=>n.edges.colorTexture)),s.uniforms.add(new Je("areaTexture",n=>n.areaTexture)),s.uniforms.add(new Je("searchTexture",n=>n.searchTexture)),fR(s),s.code.add(b`
      #define SMAA_AREATEX_PIXEL_SIZE ( 1.0 / vec2( 160.0, 560.0 ) )
      #define SMAA_AREATEX_SUBTEX_SIZE ( 1.0 / 7.0 )

      vec4 sampleLevelZeroOffset(sampler2D tex, vec2 coord, vec2 offset) {
        return texture(tex, coord + offset.x * resolution.xy, 0.0);
      }

      float searchLength(sampler2D searchTex, vec2 e, float bias, float scale) {
        e.r = bias + e.r * scale;
        return 255.0 * texture( searchTex, e, 0.0 ).r;
      }

      float searchXLeft( sampler2D edgesTex, sampler2D searchTex, vec2 texcoord, float end ) {
        vec2 e = vec2( 0.0, 1.0 );
        for ( int i = 0; i < ${b.int(Yx.maxSearchSteps)}; i ++ ) {
          e = texture( edgesTex, texcoord, 0.0 ).rg;
          texcoord -= vec2( 2.0, 0.0 ) * resolution.xy;
          if ( ! ( texcoord.x > end && e.g > 0.8281 && e.r == 0.0 ) ) break;
        }
        texcoord.x += 0.25 * resolution.x;
        texcoord.x += resolution.x;
        texcoord.x += 2.0 * resolution.x;
        texcoord.x -= resolution.x * searchLength(searchTex, e, 0.0, 0.5);
        return texcoord.x;
      }

      float searchXRight( sampler2D edgesTex, sampler2D searchTex, vec2 texcoord, float end ) {
        vec2 e = vec2( 0.0, 1.0 );
        for ( int i = 0; i < ${b.int(Yx.maxSearchSteps)}; i ++ ) {
          e = texture( edgesTex, texcoord, 0.0 ).rg;
          texcoord += vec2( 2.0, 0.0 ) * resolution.xy;
          if ( ! ( texcoord.x < end && e.g > 0.8281 && e.r == 0.0 ) ) break;
        }
        texcoord.x -= 0.25 * resolution.x;
        texcoord.x -= resolution.x;
        texcoord.x -= 2.0 * resolution.x;
        texcoord.x += resolution.x * searchLength( searchTex, e, 0.5, 0.5 );
        return texcoord.x;
      }

      float searchYUp( sampler2D edgesTex, sampler2D searchTex, vec2 texcoord, float end ) {
        vec2 e = vec2( 1.0, 0.0 );
        for ( int i = 0; i < ${b.int(Yx.maxSearchSteps)}; i ++ ) {
          e = texture( edgesTex, texcoord, 0.0 ).rg;
          texcoord += vec2( 0.0, 2.0 ) * resolution.xy;
          if ( ! ( texcoord.y > end && e.r > 0.8281 && e.g == 0.0 ) ) break;
        }
        texcoord.y -= 0.25 * resolution.y;
        texcoord.y -= resolution.y;
        texcoord.y -= 2.0 * resolution.y;
        texcoord.y += resolution.y * searchLength( searchTex, e.gr, 0.0, 0.5 );
        return texcoord.y;
      }

      float searchYDown( sampler2D edgesTex, sampler2D searchTex, vec2 texcoord, float end ) {
        vec2 e = vec2( 1.0, 0.0 );
        for ( int i = 0; i < ${b.int(Yx.maxSearchSteps)}; i ++ ) {
          e = texture( edgesTex, texcoord, 0.0 ).rg;
          texcoord -= vec2( 0.0, 2.0 ) * resolution.xy;
          if ( ! ( texcoord.y < end && e.r > 0.8281 && e.g == 0.0 ) ) break;
        }
        texcoord.y += 0.25 * resolution.y;
        texcoord.y += resolution.y;
        texcoord.y += 2.0 * resolution.y;
        texcoord.y -= resolution.y * searchLength( searchTex, e.gr, 0.5, 0.5 );
        return texcoord.y;
      }

      vec2 getArea( sampler2D areaTex, vec2 dist, float e1, float e2, float offset ) {
        vec2 texcoord = float( ${b.int(Yx.maxDistanceAreaTex)} ) * round( 4.0 * vec2( e1, e2 ) ) + dist;
        texcoord = SMAA_AREATEX_PIXEL_SIZE * texcoord + ( 0.5 * SMAA_AREATEX_PIXEL_SIZE );
        texcoord.y += SMAA_AREATEX_SUBTEX_SIZE * offset;
        return texture( areaTex, texcoord, 0.0 ).rg;
      }

      void main() {
        ivec4 subsampleIndices = ivec4(0.0);
        vec4 weights = vec4(0.0);
        vec2 e = texture( edgesTexture, uv ).rg;
        if ( e.g > 0.0 ) {
          vec2 d;
          vec2 coords;
          coords.x = searchXLeft( edgesTexture, searchTexture, offsets[0].xy, maxOffset.x );
          coords.y = offsets[1].y;
          d.x = coords.x;
          float e1 = texture( edgesTexture, coords, 0.0 ).r;
          coords.x = searchXRight( edgesTexture, searchTexture, offsets[0].zw, maxOffset.y );
          d.y = coords.x;
          d = d * resolution.z - pixelCoord.x;
          vec2 sqrt_d = sqrt( abs(d) );
          coords.y -= 1.0 * resolution.y;
          float e2 = sampleLevelZeroOffset( edgesTexture, coords, vec2( 1.0, 0.0 ) ).r;
          weights.rg = getArea( areaTexture, sqrt_d, e1, e2, float( subsampleIndices.y ) );
        }

        if ( e.r > 0.0 ) {
          vec2 d;
          vec2 coords;
          coords.y = searchYUp( edgesTexture, searchTexture, offsets[1].xy, maxOffset.z );
          coords.x = offsets[0].x;
          d.x = coords.y;
          float e1 = texture( edgesTexture, coords, 0.0 ).g;
          coords.y = searchYDown( edgesTexture, searchTexture, offsets[1].zw, maxOffset.w );
          d.y = coords.y;
          d = d * resolution.w - pixelCoord.y;
          vec2 sqrt_d = sqrt(abs(d));
          coords.y -= 1.0 * resolution.y;
          float e2 = sampleLevelZeroOffset( edgesTexture, coords, vec2(0.0, 1.0)).g;
          weights.ba = getArea( areaTexture, sqrt_d, e1, e2, float( subsampleIndices.x ) );

          // for some reason the following lines are necessary to prevent
          // texture lookup precision issues on some Intel integrated graphics chips
          vec4 dbg = (offsets[0] + offsets[1] + maxOffset + coords.xyyx);
          weights.r += 0.00000001 * dot(vec4(0, 1, 0, 1), dbg);
        }
        fragColor = weights;
      }
    `),t}const vbt=Object.freeze(Object.defineProperty({__proto__:null,build:_bt},Symbol.toStringTag,{value:"Module"}));let cOe=class uOe extends Pr{initializeProgram(e){return new Cr(e.rctx,uOe.shader.get().build(),br)}initializePipeline(){return At({colorWrite:Vt})}};cOe.shader=new Er(vbt,()=>ae(()=>import("./BlendWeights.glsl-dd157f1c.js"),[],import.meta.url));function bbt(){const t=new wr,{attributes:e,varyings:r,vertex:i,fragment:s}=t;return e.add(E.POSITION,"vec2"),r.add("uv","vec2"),r.add("offsets[2]","vec4"),fR(i),i.code.add(b`void main() {
uv = position * 0.5 + vec2(0.5);
gl_Position = vec4(position, 0, 1);
offsets[0] = uv.xyxy + resolution.xyxy * vec4( -1.0, 0.0, 0.0, 1.0 );
offsets[1] = uv.xyxy + resolution.xyxy * vec4( 1.0, 0.0, 0.0, -1.0 );
}`),s.uniforms.add(new Je("blendWeightsTexture",n=>n.blend.colorTexture),new Je("colorTexture",n=>n.colorTexture)),fR(s),s.code.add(b`void main() {
vec4 a;
a.rb = texture(blendWeightsTexture, uv).rb;
a.g = texture(blendWeightsTexture, offsets[1].zw).g;
a.a = texture(blendWeightsTexture, offsets[1].xy).a;
if ( dot(a, vec4(1.0)) < 1e-5 ) {
fragColor = texture( colorTexture, uv, 0.0 );
} else {
vec2 offset;
offset.x = a.a > a.b ? a.a : -a.b;
offset.y = a.g > a.r ? -a.g : a.r;
if ( abs( offset.x ) > abs( offset.y )) {
offset.y = 0.0;
} else {
offset.x = 0.0;
}
vec4 C = texture( colorTexture, uv, 0.0 );
vec4 Cop = texture( colorTexture, uv + sign( offset ) * resolution.xy, 0.0 );
float s = abs( offset.x ) > abs( offset.y ) ? abs( offset.x ) : abs( offset.y );
fragColor = mix(C, Cop, s);
}
}`),t}const wbt=Object.freeze(Object.defineProperty({__proto__:null,build:bbt},Symbol.toStringTag,{value:"Module"}));let hOe=class dOe extends Pr{initializeProgram(e){return new Cr(e.rctx,dOe.shader.get().build(),br)}initializePipeline(){return At({colorWrite:Vt})}};hOe.shader=new Er(wbt,()=>ae(()=>import("./Blur.glsl-09cb2043.js"),[],import.meta.url));const wue={threshold:.05,localConstrastAdaption:2};function xbt(){const t=new wr,{attributes:e,varyings:r,vertex:i,fragment:s}=t;return e.add(E.POSITION,"vec2"),fR(i),r.add("uv","vec2"),r.add("offsets[3]","vec4"),i.code.add(b`void main() {
uv = position * 0.5 + vec2(0.5);
gl_Position = vec4(position, 0, 1);
offsets[0] = uv.xyxy + resolution.xyxy * vec4( -1.0, 0.0, 0.0,  1.0 );
offsets[1] = uv.xyxy + resolution.xyxy * vec4(  1.0, 0.0, 0.0, -1.0 );
offsets[2] = uv.xyxy + resolution.xyxy * vec4( -2.0, 0.0, 0.0,  2.0 );
}`),s.uniforms.add(new Je("colorTexture",n=>n.colorTexture)),s.code.add(b`
    float absMax3(vec3 v) {
      vec3 t = abs(v);
      return max(max(t.r, t.g), t.b);
    }

    void main() {
      // Calculate color deltas:
      vec4 delta;
      vec3 C = texture(colorTexture, uv).rgb;

      vec3 Cleft = texture(colorTexture, offsets[0].xy).rgb;
      delta.x = absMax3(C - Cleft);

      vec3 Ctop = texture(colorTexture, offsets[0].zw).rgb;
      delta.y = absMax3(C - Ctop);

      vec2 edges = step(vec2(${b.float(wue.threshold)}), delta.xy);

      // discard if there is no edge:
      if (dot(edges, vec2(1.0)) == 0.0) {
        discard;
      }

      // Calculate right and bottom deltas:
      vec3 Cright = texture(colorTexture, offsets[1].xy).rgb;
      delta.z = absMax3(C - Cright);

      vec3 Cbottom  = texture(colorTexture, offsets[1].zw).rgb;
      delta.w = absMax3(C - Cbottom);

      // Calculate the maximum delta in the direct neighborhood:
      float maxDelta = max(max(max(delta.x, delta.y), delta.z), delta.w);

      // Calculate left-left and top-top deltas:
      vec3 Cleftleft  = texture(colorTexture, offsets[2].xy).rgb;
      delta.z = absMax3(C - Cleftleft);

      vec3 Ctoptop = texture(colorTexture, offsets[2].zw).rgb;
      delta.w = absMax3(C - Ctoptop);

      // Calculate the final maximum delta:
      maxDelta = max(max(maxDelta, delta.z), delta.w);

      // Local contrast adaptation in action:
      edges.xy *= step(maxDelta, float(${b.float(wue.localConstrastAdaption)}) * delta.xy);

      fragColor = vec4(edges, 0.0, 0.0);
    }
  `),t}const Tbt=Object.freeze(Object.defineProperty({__proto__:null,build:xbt},Symbol.toStringTag,{value:"Module"}));let pOe=class fOe extends Pr{initializeProgram(e){return new Cr(e.rctx,fOe.shader.get().build(),br)}initializePipeline(){return At({colorWrite:Vt})}};pOe.shader=new Er(Tbt,()=>ae(()=>import("./EdgeDetect.glsl-1d154bda.js"),[],import.meta.url));let h3=class extends Te{constructor(e,r){super({}),this._rctx=e,this._techniqueRep=r,this._passParameters=new gbt,this._isEnabled=!1}normalizeCtorArgs(){return{}}dispose(){this._abortController=pu(this._abortController),this.disable()}_loadResources(e){if(this._abortController!=null)return!1;if(this._passParameters.searchTexture!=null)return!0;this._abortController=new AbortController;const r=this._abortController.signal;return ae(()=>import("./SmaaRenderPassData-660b7d34.js"),[],import.meta.url).then(i=>this._loadTextures(i,r)).then(()=>e()).finally(()=>this._abortController=null),!1}_loadTextures(e,r){return Xt(r),Promise.all([this._loadTextureFromBase64(e.areaTexture,Ct.LINEAR,Tt.RGB),this._loadTextureFromBase64(e.searchTexure,Ct.NEAREST,Tt.LUMINANCE)]).then(([i,s])=>{sn(r)?(i.dispose(),s.dispose(),Xt(r)):(this._passParameters.areaTexture=i,this._passParameters.searchTexture=s)})}get updating(){return this._abortController!=null}enable(e){if(this._isEnabled)return!0;if(!this._edgeDetectTechnique||!this._blendWeightsTechnique||!this._blurTechnique){const s=new pa;this._edgeDetectTechnique=this._techniqueRep.releaseAndAcquire(pOe,s,this._edgeDetectTechnique),this._blendWeightsTechnique=this._techniqueRep.releaseAndAcquire(cOe,s,this._blendWeightsTechnique),this._blurTechnique=this._techniqueRep.releaseAndAcquire(hOe,s,this._blurTechnique)}if(!this._loadResources(e))return!1;this._vao=fJe(this._rctx);const r=new vr(4,4);r.pixelFormat=Tt.RG,r.internalFormat=Xe.RG8,r.wrapMode=$t.CLAMP_TO_EDGE,this._passParameters.edges=new hn(this._rctx,r);const i=new vr(4,4);return i.pixelFormat=Tt.RGBA,i.wrapMode=$t.CLAMP_TO_EDGE,this._passParameters.blend=new hn(this._rctx,i),this._isEnabled=!0,!0}disable(){this._isEnabled&&(this._vao=Ue(this._vao),this._passParameters.areaTexture=Ue(this._passParameters.areaTexture),this._passParameters.searchTexture=Ue(this._passParameters.searchTexture),this._passParameters.blend=Ue(this._passParameters.blend),this._passParameters.edges=Ue(this._passParameters.edges),this._isEnabled=!1)}get _validPassParameters(){return this._isEnabled?this._passParameters:null}render(e){const r=this._validPassParameters;if(r==null)return;r.colorTexture=e;const i=this._rctx,s=i.getBoundFramebufferObject(),n=e.descriptor.width,o=e.descriptor.height;i.bindVAO(this._vao),i.setViewport(0,0,n,o),r.edges.resize(n,o),i.bindFramebuffer(r.edges),i.setClearColor(0,0,0,1),i.clear(wi.COLOR_BUFFER_BIT),i.bindTechnique(this._edgeDetectTechnique,r,null),i.drawArrays(St.TRIANGLES,0,3),r.blend.resize(n,o),i.bindFramebuffer(r.blend),i.setClearColor(0,0,1,1),i.clear(wi.COLOR_BUFFER_BIT),i.bindTechnique(this._blendWeightsTechnique,r,null),i.drawArrays(St.TRIANGLES,0,3),i.bindFramebuffer(s),i.setClearColor(0,1,0,1),i.clear(wi.COLOR_BUFFER_BIT),i.bindTechnique(this._blurTechnique,r,null),i.drawArrays(St.TRIANGLES,0,3)}_loadTextureFromBase64(e,r,i){return Gg(e).then(s=>{const n=new vr;return n.pixelFormat=i,n.wrapMode=$t.CLAMP_TO_EDGE,n.width=s.width,n.height=s.height,n.samplingMode=r,new Et(this._rctx,n,s)})}};u([d()],h3.prototype,"_abortController",void 0),u([d({readOnly:!0})],h3.prototype,"updating",null),h3=u([R("esri.views.3d.webgl-engine.lib.SmaaRenderPass")],h3);function Sbt(t,e){const r=-t[0],i=-t[1],s=-t[2],n=e[3],o=e[7],a=e[11],l=e[15];e[0]+=n*r,e[1]+=n*i,e[2]+=n*s,e[4]+=o*r,e[5]+=o*i,e[6]+=o*s,e[8]+=a*r,e[9]+=a*i,e[10]+=a*s,e[12]+=l*r,e[13]+=l*i,e[14]+=l*s}function Ebt(t,e){const r=t[0],i=t[1],s=t[2];e[12]+=r*e[0]+i*e[4]+s*e[8],e[13]+=r*e[1]+i*e[5]+s*e[9],e[14]+=r*e[2]+i*e[6]+s*e[10],e[14]+=r*e[3]+i*e[7]+s*e[11]}let Cbt=class{constructor(e){this._factory=e,this._originData=new Map}acquire(e){return this.register(this._factory.getOrigin(e))}register(e){const r=this._originData.get(e.id)||new Abt(e);return r.refCount++,this._originData.has(r.origin.id)||this._originData.set(r.origin.id,r),r}release(e){e.refCount--,e.refCount===0&&this._originData.delete(e.origin.id)}updateViewMatrices(e){this._originData.forEach(r=>{Ls(r.viewMatrix,e),Ebt(r.origin.vec3,r.viewMatrix)})}},Abt=class{constructor(e){this.origin=e,this.refCount=0,this.viewMatrix=be()}},Obt=class extends lxe{constructor(e,r){super(),this.distanceFalloffFactor=e,this.transparency=r,this.transformNormalViewFromGlobal=Li()}},Rbt=class extends cxe{constructor(){super(...arguments),this.transformNormalViewFromGlobal=Li(),this.slicePlaneLocalOrigin=C(),this.transformNormalGlobalFromModel=Li()}};function Pbt(t){const e=b`bool isNaN( float val )
{
return ( val < 0.0 || 0.0 < val || val == 0.0 ) ? false : true;
}`;t.code.add(e)}const Mbt=dr(.5,-4e-4);function Ibt(t,e){const r=t.vertex;r.include(Pbt),r.constants.add("depthBias","vec2",Mbt),r.uniforms.add(new Sr("inverseViewport",(i,s)=>s.inverseViewport)),e.legacy?(r.uniforms.add(new $i("proj",(i,s)=>s.camera.projectionMatrix)),r.code.add(b`vec2 calculateProjectedBiasXY(vec4 projPos, vec3 globalNormal) {
float offsetXY = depthBias.x;
vec4 projNormal = proj * localView * vec4(globalNormal, 0.0);
return offsetXY * projPos.w * 2.0 * inverseViewport * normalize(projNormal.xyz).xy;
}`)):(r.uniforms.add(new kh("transformNormalViewFromGlobal",i=>i.transformNormalViewFromGlobal),new $i("transformProjFromView",i=>i.transformProjFromView)),r.code.add(b`vec2 calculateProjectedBiasXY(vec4 projPos, vec3 globalNormal) {
float offsetXY = depthBias.x;
vec4 projNormal = transformProjFromView * vec4(transformNormalViewFromGlobal * globalNormal, 0.0);
return offsetXY * projPos.w * 2.0 * inverseViewport * normalize(projNormal.xyz).xy;
}`)),r.code.add(b`float _calculateProjectedBiasZ(vec4 projPos) {
float offsetZ = depthBias.y;
return sqrt(max(projPos.z,0.0)) * offsetZ;
}
vec4 adjustProjectedPosition(vec4 projPos, vec3 worldNormal, float lineWidth) {
vec2 offsetXY = calculateProjectedBiasXY(projPos, worldNormal);
if (!isNaN(offsetXY.x) && !isNaN(offsetXY.y)) {
projPos.xy += offsetXY;
}
projPos.z += _calculateProjectedBiasZ(projPos);
return projPos;
}`)}function $bt(t,e){const r=t.fragment;r.constants.add("coverageTestThreshold","float",.01),e.antialiasing?r.code.add(b`#define discardByCoverage(radius, coverage) { if (coverage < coverageTestThreshold) discard; }`):r.code.add(b`#define discardByCoverage(radius, coverage) { float coverageLimit = radius <= 0.5 ? coverageTestThreshold : 0.75; if (coverage < coverageLimit) discard; }`)}function Lbt(t,e){const r=t.vertex;e.silhouette?(r.code.add(b`bool isSilhouetteEdge(vec3 viewDir, vec3 normalA, vec3 normalB) {
float faceAVisible = dot(viewDir, normalA);
float faceBVisible = dot(viewDir, normalB);
return faceAVisible * faceBVisible < 0.0;
}`),e.legacy?r.code.add(b`bool discardNonSilhouetteEdges(vec3 viewPos, vec3 worldPos) {
vec3 viewNormalA = _modelToViewNormal(normalA);
vec3 viewNormalB = _modelToViewNormal(normalB);
vec3 viewDir = -viewPos;
if (isSilhouetteEdge(viewDir, viewNormalA, viewNormalB)) {
return false;
}
gl_Position = vec4(10.0, 10.0, 10.0, 1.0);
return true;
}`):r.code.add(b`bool discardNonSilhouetteEdges(vec3 viewPos, vec3 worldPos) {
vec3 worldNormalA = _modelToWorldNormal(normalA);
vec3 worldNormalB = _modelToWorldNormal(normalB);
vec3 viewDir = -worldPos;
if (isSilhouetteEdge(viewDir, worldNormalA, worldNormalB)) {
return false;
}
gl_Position = vec4(10.0, 10.0, 10.0, 1.0);
return true;
}`)):r.code.add(b`bool discardNonSilhouetteEdges(vec3 viewPos, vec3 worldPos) {
return false;
}`)}function Dbt(t,e){const r=t.vertex;r.include(Ec),r.uniforms.add(new Re("distanceFalloffFactor",i=>i.distanceFalloffFactor)),r.code.add(b`float distanceBasedPerspectiveFactor(float distance) {
return clamp(sqrt(distanceFalloffFactor / distance), 0.0, 1.0);
}`),r.uniforms.add(new bh("componentDataTex",i=>i.componentDataTexture)),t.attributes.add(E.COMPONENTINDEX,"float"),r.constants.add("componentColorFieldOffset","float",0),r.constants.add("componentOtherFieldOffset","float",1),r.constants.add("componentVerticalOffsetFieldOffset","float",2),r.constants.add("componentFieldCount","float",3),r.constants.add("lineWidthFractionFactor","float",8),r.constants.add("extensionLengthOffset","float",128),r.constants.add("verticalOffsetScale","float",2*UJ),r.code.add(b`vec2 _componentTextureCoords(float componentIndex, float fieldOffset) {
float fieldIndex = componentFieldCount * componentIndex + fieldOffset;
float texSize = float(textureSize(componentDataTex, 0).x);
float colIndex = mod(fieldIndex, texSize);
float rowIndex = floor(fieldIndex / texSize);
return vec2(colIndex, rowIndex) + 0.5;
}
struct ComponentData {
vec4 color;
float lineWidth;
float extensionLength;
float type;
float verticalOffset;
};
ComponentData readComponentData() {
vec2 colorIndex = _componentTextureCoords(componentIndex, componentColorFieldOffset);
vec2 otherIndex = _componentTextureCoords(componentIndex, componentOtherFieldOffset);
vec2 verticalOffsetIndex = _componentTextureCoords(componentIndex, componentVerticalOffsetFieldOffset);
vec4 colorValue = texelFetch(componentDataTex, ivec2(colorIndex), 0);
vec4 otherValue = texelFetch(componentDataTex, ivec2(otherIndex), 0);
float verticalOffset = (rgba2float(texelFetch(componentDataTex, ivec2(verticalOffsetIndex), 0)) - 0.5) * verticalOffsetScale;
return ComponentData(
vec4(colorValue.rgb, colorValue.a * otherValue.w),
otherValue.x * (255.0 / lineWidthFractionFactor),
otherValue.y * 255.0 - extensionLengthOffset,
-(otherValue.z * 255.0) + 0.5,
verticalOffset
);
}`),e.legacy?r.code.add(b`vec3 _modelToWorldNormal(vec3 normal) {
return (model * vec4(normal, 0.0)).xyz;
}
vec3 _modelToViewNormal(vec3 normal) {
return (localView * model * vec4(normal, 0.0)).xyz;
}`):(r.uniforms.add(new qO("transformNormalGlobalFromModel",i=>i.transformNormalGlobalFromModel)),r.code.add(b`vec3 _modelToWorldNormal(vec3 normal) {
return transformNormalGlobalFromModel * normal;
}`)),e.silhouette?(t.attributes.add(E.NORMALA,"vec3"),t.attributes.add(E.NORMALB,"vec3"),r.code.add(b`vec3 worldNormal() {
return _modelToWorldNormal(normalize(normalA + normalB));
}`)):(t.attributes.add(E.NORMAL,"vec3"),r.code.add(b`vec3 worldNormal() {
return _modelToWorldNormal(normal);
}`)),e.legacy?r.code.add(b`void worldAndViewFromModelPosition(vec3 modelPos, float verticalOffset, out vec3 worldPos, out vec3 viewPos) {
worldPos = (model * vec4(modelPos, 1.0)).xyz;
viewPos = (localView * vec4(worldPos, 1.0)).xyz;
}`):(r.include(n4,e),r.include(n4,e),r.uniforms.add(new kh("transformViewFromCameraRelativeRS",i=>i.transformViewFromCameraRelativeRS),new qO("transformWorldFromModelRS",i=>i.transformWorldFromModelRS),new cu("transformWorldFromModelTL",i=>i.transformWorldFromModelTL),new cu("transformWorldFromModelTH",i=>i.transformWorldFromModelTH),new Ft("transformWorldFromViewTL",i=>i.transformWorldFromViewTL),new Ft("transformWorldFromViewTH",i=>i.transformWorldFromViewTH)),r.code.add(b`
      void worldAndViewFromModelPosition(vec3 modelPos, float verticalOffset, out vec3 worldPos, out vec3 viewPos) {
        vec3 rotatedModelPosition = transformWorldFromModelRS * modelPos;

        vec3 transformCameraRelativeFromModel = dpAdd(
          transformWorldFromModelTL,
          transformWorldFromModelTH,
          -transformWorldFromViewTL,
          -transformWorldFromViewTH
        );

        worldPos = transformCameraRelativeFromModel + rotatedModelPosition;

        if (verticalOffset != 0.0) {
          vec3 vUp = ${e.spherical?b`normalize(transformWorldFromModelTL + rotatedModelPosition);`:b`vec3(0.0, 0.0, 1.0);`}
          worldPos += verticalOffset * vUp;
        }

        viewPos = transformViewFromCameraRelativeRS * worldPos;
      }
    `)),r.uniforms.add(new $i("transformProjFromView",(i,s)=>s.camera.projectionMatrix)),r.code.add(b`vec4 projFromViewPosition(vec3 position) {
return transformProjFromView * vec4(position, 1.0);
}`),r.code.add(b`float calculateExtensionLength(float extensionLength, float lineLength) {
return extensionLength / (log2(max(1.0, 256.0 / lineLength)) * 0.2 + 1.0);
}`)}function Nbt(t){return t.mode===an.SKETCH||t.mode===an.MIXED}var an,cb;(function(t){t[t.SOLID=0]="SOLID",t[t.SKETCH=1]="SKETCH",t[t.MIXED=2]="MIXED",t[t.COUNT=3]="COUNT"})(an||(an={})),function(t){t[t.REGULAR=0]="REGULAR",t[t.SILHOUETTE=1]="SILHOUETTE"}(cb||(cb={}));function GJ(t,e){const r=t.vertex;switch(t.attributes.add(E.SIDENESS,"vec2"),e.mode===an.MIXED?r.code.add(b`struct UnpackedAttributes {
vec2 sideness;
vec2 sidenessNorm;
float lineWidthPixels;
float extensionLengthPixels;
float type;
};`):r.code.add(b`struct UnpackedAttributes {
vec2 sideness;
vec2 sidenessNorm;
float lineWidthPixels;
float extensionLengthPixels;
};`),e.mode){case an.MIXED:r.code.add(b`UnpackedAttributes unpackAttributes(ComponentData component) {
vec2 sidenessNorm = sideness;
vec2 sideness = sidenessNorm * 2.0 - 1.0;
float fType = component.type;
float extensionLengthPixels = component.extensionLength;
float lineWidth = component.lineWidth;
if (fType <= 0.0) {
extensionLengthPixels *= variantExtension * 2.0 - 1.0;
}
return UnpackedAttributes(sideness, sidenessNorm, lineWidth, extensionLengthPixels, fType);
}`);break;case an.SKETCH:r.code.add(b`UnpackedAttributes unpackAttributes(ComponentData component) {
vec2 sidenessNorm = sideness;
vec2 sideness = sidenessNorm * 2.0 - 1.0;
float extensionLengthPixels = component.extensionLength;
extensionLengthPixels *= variantExtension * 2.0 - 1.0;
float lineWidth = component.lineWidth;
return UnpackedAttributes(sideness, sidenessNorm, lineWidth, extensionLengthPixels);
}`);break;case an.SOLID:r.code.add(b`UnpackedAttributes unpackAttributes(ComponentData component) {
vec2 sidenessNorm = sideness;
vec2 sideness = sidenessNorm * 2.0 - 1.0;
float extensionLengthPixels = component.extensionLength;
float lineWidth = component.lineWidth;
return UnpackedAttributes(sideness, sidenessNorm, lineWidth, extensionLengthPixels);
}`);break;case an.COUNT:break;default:e.mode}}function Fbt(t,e){const r=t.vertex;switch(t.include(GJ,e),e.mode){case an.SOLID:r.code.add(b`float calculateLineAmplitude(UnpackedAttributes unpackedAttributes) {
return 0.0;
}`);break;case an.SKETCH:r.uniforms.add(new Db("strokesAmplitude",i=>i.strokesTexture.amplitude)),r.code.add(b`float calculateLineAmplitude(UnpackedAttributes unpackedAttributes) {
return strokesAmplitude;
}`);break;case an.MIXED:r.uniforms.add(new Db("strokesAmplitude",i=>i.strokesTexture.amplitude)),r.code.add(b`float calculateLineAmplitude(UnpackedAttributes unpackedAttributes) {
float type = unpackedAttributes.type;
if (type <= 0.0) {
return strokesAmplitude;
}
else {
return 0.0;
}
}`)}}function Ubt(t,e){t.include(GJ,e);const{vertex:r,fragment:i}=t;switch(Nbt(e)&&(r.uniforms.add(new bh("strokesTexture",s=>s.strokesTexture.texture)),r.uniforms.add(new Db("strokesLog2Resolution",s=>Math.log2(s.strokesTexture.resolution)),new Db("strokeVariants",s=>s.strokesTexture.variants)),t.varyings.add("vStrokeUV","vec2"),i.uniforms.add(new bh("strokesTexture",s=>s.strokesTexture.texture),new Db("strokesNormalizationScale",s=>s.strokesTexture.normalizationScale)),r.code.add(b`void calculateStyleOutputsSketch(float lineLength, UnpackedAttributes unpackedAttributes) {
vec2 sidenessNorm = unpackedAttributes.sidenessNorm;
float lineIndex = clamp(ceil(log2(lineLength)), 0.0, strokesLog2Resolution);
vStrokeUV = vec2(exp2(lineIndex) * sidenessNorm.y, lineIndex * strokeVariants + variantStroke + 0.5) / vec2(textureSize(strokesTexture, 0));
vStrokeUV.x += variantOffset;
}`),t.fragment.include(Ec),i.code.add(b`float calculateLineOffsetSketch() {
float offsetNorm = rgba2float(texture(strokesTexture, vStrokeUV));
return (offsetNorm - 0.5) * strokesNormalizationScale;
}
float calculateLinePressureSketch() {
return rgba2float(texture(strokesTexture, vStrokeUV + vec2(0.0, 0.5)));
}`)),e.mode){case an.SOLID:r.code.add(b`void calculateStyleOutputs(UnpackedAttributes unpackedAttributes) {}`),i.code.add(b`float calculateLineOffset() {
return 0.0;
}
float calculateLinePressure() {
return 1.0;
}`);break;case an.SKETCH:r.code.add(b`void calculateStyleOutputs(UnpackedAttributes unpackedAttributes)
{
calculateStyleOutputsSketch(vLineLengthPixels, unpackedAttributes);
}`),i.code.add(b`float calculateLineOffset() {
return calculateLineOffsetSketch();
}
float calculateLinePressure() {
return calculateLinePressureSketch();
}`);break;case an.MIXED:t.varyings.add("vType","float"),r.code.add(b`void calculateStyleOutputs(UnpackedAttributes unpackedAttributes)
{
vType = unpackedAttributes.type;
if (unpackedAttributes.type <= 0.0) {
calculateStyleOutputsSketch(vLineLengthPixels, unpackedAttributes);
}
}`),i.code.add(b`float calculateLineOffset() {
if (vType <= 0.0) {
return calculateLineOffsetSketch();
}
else {
return 0.0;
}
}
float calculateLinePressure() {
if (vType <= 0.0) {
return calculateLinePressureSketch();
}
else {
return 1.0;
}
}`)}}function kbt(t){const e=new wr,{vertex:r,fragment:i}=e;return t.legacy&&r.uniforms.add(new xue("model"),new xue("localView")),e.include(Ibt,t),e.include(Dbt,t),e.include(Fbt,t),e.include(GJ,t),e.include(Ubt,t),e.include(ps,t),e.include(Lbt,t),e.include($bt,t),e.include(vu,t),e.varyings.add("vColor","vec4"),e.varyings.add("vRadius","float"),e.varyings.add("vPosition","vec3"),e.varyings.add("vWorldPosition","vec3"),e.varyings.add("vViewPos","vec3"),e.varyings.add("vLineLengthPixels","float"),e.varyings.add("vSizeFalloffFactor","float"),r.uniforms.add(new Sr("pixelToNDC",(s,n)=>or(Vbt,2/n.camera.fullViewport[2],2/n.camera.fullViewport[3])),new sr("viewport",(s,n)=>n.camera.fullViewport),new Re("pixelRatio",(s,n)=>n.camera.pixelRatio)),e.attributes.add(E.POSITION0,"vec3"),e.attributes.add(E.POSITION1,"vec3"),e.attributes.add(E.VARIANTOFFSET,"float"),e.attributes.add(E.VARIANTSTROKE,"float"),e.attributes.add(E.VARIANTEXTENSION,"float"),r.code.add(b`
    const float opaqueCutoff = 1.0 / 255.0;

    void calculateGeometricOutputs(vec3 viewPosV0, vec3 viewPosV1, vec3 worldPosV0, vec3 worldPosV1, vec3 worldNormal, UnpackedAttributes unpackedAttributes) {
      vec2 sideness = unpackedAttributes.sideness;
      vec2 sidenessNorm = unpackedAttributes.sidenessNorm;

      vWorldPosition = mix(worldPosV0, worldPosV1, sidenessNorm.y).xyz;

      vec3 viewPos = mix(viewPosV0, viewPosV1, sidenessNorm.y);
      vViewPos = viewPos;

      vec4 projPosV0 = projFromViewPosition(viewPosV0);
      vec4 projPosV1 = projFromViewPosition(viewPosV1);
      vec4 projPos = projFromViewPosition(viewPos);

      vec3 screenSpaceLineNDC = (projPosV1.xyz / projPosV1.w - projPosV0.xyz / projPosV0.w);
      vec2 ndcToPixel = viewport.zw * 0.5;
      vec2 screenSpaceLinePixels = screenSpaceLineNDC.xy * ndcToPixel;
      float lineLengthPixels = length(screenSpaceLinePixels);

      float dzPerPixel = screenSpaceLineNDC.z / lineLengthPixels;
      vec2 screenSpaceDirection = screenSpaceLinePixels / lineLengthPixels;
      vec2 perpendicularScreenSpaceDirection = vec2(screenSpaceDirection.y, -screenSpaceDirection.x) * sideness.x;

      float falloffFactor = distanceBasedPerspectiveFactor(-viewPos.z) * pixelRatio;
      float lineWidthPixels = unpackedAttributes.lineWidthPixels * falloffFactor;

      float extensionLengthPixels = calculateExtensionLength(unpackedAttributes.extensionLengthPixels, lineLengthPixels) * falloffFactor;
      float lineAmplitudePixels = calculateLineAmplitude(unpackedAttributes) * pixelRatio;

      vSizeFalloffFactor = falloffFactor;

      float lineWidthAndAmplitudePixels = lineWidthPixels + lineAmplitudePixels + lineAmplitudePixels;
      float extendedLineLengthPixels = lineLengthPixels + extensionLengthPixels + extensionLengthPixels;

      ${t.antialiasing?b`
        const float aaPaddingPixels = 1.0;

        // Line size with padding
        float halfAAPaddedLineWidthAndAmplitudePixels = lineWidthAndAmplitudePixels * 0.5 + aaPaddingPixels;
        float aaPaddedRoundedCapSizePixels = lineWidthPixels * 0.5 + aaPaddingPixels;`:b`
        float halfAAPaddedLineWidthAndAmplitudePixels = max(lineWidthAndAmplitudePixels, 1.0) * 0.5;
        float aaPaddedRoundedCapSizePixels = max(lineWidthPixels, 1.0) * 0.5;`}

      // Half line width in NDC including padding for anti aliasing
      vec2 halfAAPaddedLineWidthAndAmplitudeNDC = halfAAPaddedLineWidthAndAmplitudePixels * pixelToNDC;
      vec2 aaPaddedRoundedCapSizeNDC = aaPaddedRoundedCapSizePixels * pixelToNDC;
      vec2 extensionLengthNDC = extensionLengthPixels * pixelToNDC;

      // Compute screen space position of vertex, offsetting for line size and end caps
      vec2 ndcOffset = (
          screenSpaceDirection * sideness.y * (aaPaddedRoundedCapSizeNDC + extensionLengthNDC)
        + perpendicularScreenSpaceDirection * halfAAPaddedLineWidthAndAmplitudeNDC
      );

      projPos.xy += ndcOffset * projPos.w;
      projPos.z += (dzPerPixel * (aaPaddedRoundedCapSizePixels + extensionLengthPixels)) * sideness.y * projPos.w;

      projPos = adjustProjectedPosition(projPos, worldNormal, 1.0 + max((lineWidthAndAmplitudePixels - 1.0) * 0.5, 0.0));

      // Line length with end caps
      float aaPaddedLineWithCapsLengthPixels = extendedLineLengthPixels + aaPaddedRoundedCapSizePixels + aaPaddedRoundedCapSizePixels;

      float pixelPositionAlongLine = aaPaddedLineWithCapsLengthPixels * sidenessNorm.y - aaPaddedRoundedCapSizePixels;

      // Position in pixels with origin at first vertex of line segment
      vPosition = vec3(
        halfAAPaddedLineWidthAndAmplitudePixels * sideness.x,
        pixelPositionAlongLine,
        pixelPositionAlongLine / extendedLineLengthPixels
      );

      // The line width radius in pixels
      vRadius = lineWidthPixels * 0.5;
      vLineLengthPixels = extendedLineLengthPixels;

      // discard short edges below a certain length threshold
      ${t.mode===an.SKETCH?b`
        if (lineLengthPixels <= 3.0) {
          gl_Position = vec4(10.0, 10.0, 10.0, 1.0);
          return;
        }`:t.mode===an.MIXED?b`
        if (lineLengthPixels <= 3.0 && unpackedAttributes.type <= 0.0) {
           gl_Position = vec4(10.0, 10.0, 10.0, 1.0);
           return;
        }`:""}
      gl_Position = projPos;
    }

    void main() {
      ComponentData component = readComponentData();
      UnpackedAttributes unpackedAttributes = unpackAttributes(component);

      vec3 worldPosV0, worldPosV1, viewPosV0, viewPosV1;
      worldAndViewFromModelPosition(position0, component.verticalOffset, worldPosV0, viewPosV0);
      worldAndViewFromModelPosition(position1, component.verticalOffset, worldPosV1, viewPosV1);

      // Component color
      vColor = component.color;

      // Discard fully transparent edges
      if (vColor.a < opaqueCutoff) {
        gl_Position = vec4(10.0, 10.0, 10.0, 1.0);
        return;
      }

      if (discardNonSilhouetteEdges(viewPosV0, worldPosV0)) {
        return;
      }

      // General geometric computation for all types of edges
      calculateGeometricOutputs(viewPosV0, viewPosV1, worldPosV0, worldPosV1, worldNormal(), unpackedAttributes);

      // Specific computation for different edge styles
      calculateStyleOutputs(unpackedAttributes);
    }
  `),i.code.add(b`
    vec2 lineWithCapsDistance(float radius, vec2 position, float lineLength) {
      float positionX = position.x - calculateLineOffset();

      if (radius < 1.0) {
        float coverageX = clamp(min(radius, positionX + 0.5) - max(-radius, positionX - 0.5), 0.0, 1.0);
        float coverageY = clamp(min(lineLength, position.y + 0.5) - max(0.0, position.y - 0.5), 0.0, 1.0);
        return vec2(0.5 - min(coverageX, coverageY), 0.0);
      }
      else {
        // Between -radius -> 0 for start cap, 0 for line, 0 -> radius
        float positionOnCap = position.y - clamp(position.y, 0.0, lineLength);

        vec2 lineToPosition = vec2(positionX, positionOnCap);
        return vec2(length(lineToPosition) - radius, positionOnCap / radius);
      }
    }

    void main() {
      ${t.hasMultipassTerrain?"terrainDepthTest(gl_FragCoord, vViewPos.z);":""}
      float radius = vRadius * calculateLinePressure();

      vec2 distance = lineWithCapsDistance(radius, vPosition.xy, vLineLengthPixels);
      float coverage = clamp(0.5 - distance.x, 0.0, 1.0);

      discardByCoverage(radius, coverage);
      discardBySlice(vWorldPosition);

      fragColor = vec4(vColor.rgb, vColor.a * coverage);
    }
  `),e}const Vbt=Ve();let xue=class extends as{constructor(e){super(e,"mat4")}};const zbt=Object.freeze(Object.defineProperty({__proto__:null,build:kbt},Symbol.toStringTag,{value:"Module"}));let mOe=class gOe extends Pr{initializeProgram(e){return new Cr(e.rctx,gOe.shader.get().build(this.configuration),C3e)}initializePipeline(e){return e.blendMinMax?At({blending:xo(we.ONE,we.ONE,we.ZERO,we.ONE,jf.ADD,e.blendMinMax.MAX),depthTest:{func:Kr.LEQUAL},colorWrite:Vt}):At({depthTest:{func:Kr.LEQUAL},depthWrite:Ol,colorWrite:Vt})}};mOe.shader=new Er(zbt,()=>ae(()=>import("./EdgeShader.glsl-00fe1dd9.js"),[],import.meta.url));let nf=class extends Uo{constructor(){super(...arguments),this.mode=an.SOLID,this.hasSlicePlane=!1,this.silhouette=!1,this.legacy=!1,this.antialiasing=!1,this.doublePrecisionRequiresObfuscation=!1,this.hasMultipassTerrain=!1,this.cullAboveGround=!1,this.spherical=!1}};u([B({count:an.COUNT})],nf.prototype,"mode",void 0),u([B()],nf.prototype,"hasSlicePlane",void 0),u([B()],nf.prototype,"silhouette",void 0),u([B()],nf.prototype,"legacy",void 0),u([B()],nf.prototype,"antialiasing",void 0),u([B()],nf.prototype,"doublePrecisionRequiresObfuscation",void 0),u([B()],nf.prototype,"hasMultipassTerrain",void 0),u([B()],nf.prototype,"cullAboveGround",void 0),u([B()],nf.prototype,"spherical",void 0);const Bbt=8,xk=128,Gbt={type:"uber",hasSlicePlane:!1,strokesTexture:null,legacy:!0,spherical:!0},jbt={solid:an.SOLID,sketch:an.SKETCH,uber:an.MIXED};let Tk=class yOe{constructor(e,r,i){this._rctx=e,this._shaderTechniqueRepository=r,this._configuration=new nf,this.refCount=0,this._renderables=new Set,this._sortedRenderables={[Bt.TRANSPARENT]:{[Bt.TRANSPARENT]:new kt,[Bt.OPAQUE]:new kt},[Bt.OPAQUE]:{[Bt.TRANSPARENT]:new kt,[Bt.OPAQUE]:new kt}},this._renderablesDirty=!1,this._drawParameters=new Rbt,this._settings={...Gbt,...i},this.key=yOe.getKey(this._settings.type,this._settings.hasSlicePlane,this._settings.legacy);const s=this._settings.strokesTexture.variants;this.writerSettings={variants:s,reducedPrecision:ni.TESTS_DISABLE_OPTIMIZATIONS},this._configuration.legacy=this._settings.legacy,this._configuration.mode=jbt[this._settings.type],this._configuration.silhouette=!1,this._configuration.antialiasing=!!this._rctx.capabilities.blendMinMax,this._configuration.hasSlicePlane=this._settings.hasSlicePlane,this._configuration.doublePrecisionRequiresObfuscation=e.driverTest.doublePrecisionRequiresObfuscation.result,this._configuration.spherical=i.spherical}dispose(){this._technique=Ui(this._technique)}addRenderable(e){this._renderables.add(e),this._renderablesDirty=!0}removeRenderable(e){this._renderables.delete(e),this._renderablesDirty=!0}setRenderablesDirty(){this._renderablesDirty=!0}forEachRenderable(e,r){if(this._renderablesDirty&&this._sortRenderables(),r!==Bt.INVISIBLE){const i=this._sortedRenderables[r];i[Bt.TRANSPARENT].forAll(e),i[Bt.OPAQUE].forAll(e)}}updateTechnique(e,r){return this._configuration.hasMultipassTerrain=!!e.multipassTerrain.enabled,this._configuration.cullAboveGround=!!e.multipassTerrain.cullAboveGround,this._configuration.silhouette=r,this._technique=this._shaderTechniqueRepository.releaseAndAcquire(mOe,this._configuration,this._technique),this._technique}bindRegularEdges(e,r){return this._lastOriginId=null,this._rctx.bindTechnique(this.updateTechnique(r,!1),e,r)}bindSilhouetteEdges(e,r){return this._lastOriginId=null,this._rctx.bindTechnique(this.updateTechnique(r,!0),e,r)}renderRegularEdges(e,r,i,s,n){this._render(e,r,r.regular.vao,i,s,n)}renderSilhouetteEdges(e,r,i,s,n){this._render(e,r,r.silhouette.vao,i,s,n)}_render(e,r,i,s,n,o){o>0&&(this._bindDraw(e,r,s,n),this._rctx.bindVAO(i),this._rctx.capabilities.instancing.drawArraysInstanced(St.TRIANGLE_FAN,0,4,o))}_bindDraw(e,r,i,s){if(this._drawParameters.componentDataTexture=r.components.buffer.textureBuffer.texture,this._drawParameters.strokesTexture=this._settings.strokesTexture,"origin"in r.transform)this._lastOriginId!==r.transform.origin.origin.id&&(e.setUniformMatrix4fv("localView",r.transform.origin.viewMatrix),this._lastOriginId=r.transform.origin.origin.id),e.setUniformMatrix4fv("model",r.transform.modelMatrix),this._drawParameters.slicePlaneLocalOrigin=r.transform.origin.origin.vec3;else{const n=new D6(r.transform.position),o=Mh(Tue,Nw(Tue,r.transform.rotationScale));this._drawParameters.transformWorldFromModelTL=n.low,this._drawParameters.transformWorldFromModelTH=n.high,this._drawParameters.transformWorldFromModelRS=r.transform.rotationScale,this._drawParameters.transformNormalGlobalFromModel=o;const a=s.camera.viewInverseTransposeMatrix;se(this._drawParameters.slicePlaneLocalOrigin,a[3],a[7],a[11])}e.bindDraw(this._drawParameters,s,i)}_sortRenderables(){this._renderablesDirty=!1,this._sortedRenderables[Bt.TRANSPARENT][Bt.TRANSPARENT].clear(),this._sortedRenderables[Bt.TRANSPARENT][Bt.OPAQUE].clear(),this._sortedRenderables[Bt.OPAQUE][Bt.TRANSPARENT].clear(),this._sortedRenderables[Bt.OPAQUE][Bt.OPAQUE].clear(),this._renderables.forEach(r=>{r.objectTransparency!==Bt.INVISIBLE&&r.edgeTransparency!==Bt.INVISIBLE&&this._sortedRenderables[r.objectTransparency][r.edgeTransparency].push(r)});const e=(r,i)=>"origin"in r.transform?"origin"in i.transform?r.transform.origin.origin.id<i.transform.origin.origin.id?-1:r.transform.origin.origin.id>i.transform.origin.origin.id?1:0:1:0;this._sortedRenderables[Bt.TRANSPARENT][Bt.TRANSPARENT].sort(e),this._sortedRenderables[Bt.TRANSPARENT][Bt.OPAQUE].sort(e),this._sortedRenderables[Bt.OPAQUE][Bt.TRANSPARENT].sort(e),this._sortedRenderables[Bt.OPAQUE][Bt.OPAQUE].sort(e)}static getKey(e,r,i){return`edges-t:${e}:${r}:${i}`}};const Tue=El();function DUt(t,e){return e.push(t.buffer),{buffer:t.buffer,layout:new xQe(t.layout)}}function x$(t){return new Exe(t.layout).createView(t.buffer)}let Hbt=class extends EAe{constructor(e){super("EdgeProcessingWorker","extract",{extract:r=>[r.dataBuffer],extractComponentsEdgeLocations:r=>[r.dataBuffer],extractEdgeLocations:r=>[r.dataBuffer]},e)}async process(e,r,i){if(i)return Fvt(e);const s=await this.invoke(new Sk(e),r);return this._unpackOutput(s)}async extractEdgeLocations(e,r){const i=await this.invokeMethod("extractEdgeLocations",new Sk(e),r);return x$(i)}async extractComponentsEdgeLocations(e,r){const i=await this.invokeMethod("extractComponentsEdgeLocations",new Sk(e),r);return x$(i)}_unpackOutput(e){return{regular:{instancesData:x$(e.regular.instancesData),lodInfo:{lengths:new Float32Array(e.regular.lodInfo.lengths)}},silhouette:{instancesData:x$(e.silhouette.instancesData),lodInfo:{lengths:new Float32Array(e.silhouette.lodInfo.lengths)}},averageEdgeLength:e.averageEdgeLength}}},Sk=class{constructor(e){this.dataBuffer=e.data.buffer,this.writerSettings=e.writerSettings,this.skipDeduplicate=e.skipDeduplicate,this.indices=ip(e.indices)?e.indices:e.indices.buffer,this.indicesType=ip(e.indices)?"Array":hF(e.indices)?"Uint32Array":"Uint16Array",this.indicesLength=e.indicesLength}};function qbt(t){const r=MC.resolution,i=r/2,s=new Uint8Array(4*r*r),n=4*r*i,o=MC.amplitude,a=2*o,l=4*r,c=Math.log2(r)+1,h=MC.strokes.length;let p=(c-1)*h*l;for(const{distance:y,pressure:_}of MC.strokes){let v=y,w=_,x=p;for(let T=0;T<c;T++){T!==0&&(v=Sue(v,mR.DISTANCE),w=Sue(w,mR.PRESSURE));for(let S=0;S<MC.resolution;S++){const O=.5+(v?v[S%v.length]/a:0),A=w?w[S%w.length]:1;tR(O,s,x),tR(A,s,x+n),x+=4}x-=l*(h+1)}p+=l}const f=new vr;f.width=f.height=r;const m=new Et(t,f,s);return new Zbt(r,a,o,h,m)}function Sue(t,e){if(!t)return null;const r=t.length/2,i=Wbt*r,s=new Array(r);let n=0;const o=e===mR.PRESSURE;for(let a=0;a<t.length;a+=2){const l=(t[a]+t[a+1])/2;s[n++]=o?Math.min(i,1-(1-l)*Eue):Math.min(i,l*Eue)}return s}var mR;(function(t){t[t.DISTANCE=0]="DISTANCE",t[t.PRESSURE=1]="PRESSURE"})(mR||(mR={}));const Wbt=.1,Eue=.5;let Zbt=class{constructor(e,r,i,s,n){this.resolution=e,this.normalizationScale=r,this.amplitude=i,this.variants=s,this.texture=n}dispose(){this.texture=Ue(this.texture)}};const MC={amplitude:8,resolution:256,strokes:[{distance:[-1.59027,-1.59426,-1.59674,-1.59766,-1.59702,-1.59479,-1.59095,-1.5855,-1.57843,-1.56973,-1.55942,-1.5475,-1.53398,-1.5189,-1.50226,-1.4841,-1.46446,-1.44337,-1.42088,-1.39703,-1.37188,-1.34547,-1.31786,-1.28912,-1.2593,-1.22847,-1.19668,-1.16402,-1.13053,-1.09629,-1.06137,-1.02582,-.98972,-.95313,-.91611,-.87872,-.84102,-.80306,-.76488,-.72654,-.68807,-.64952,-.61092,-.57232,-.53375,-.49527,-.45692,-.41874,-.38078,-.34309,-.3057,-.26867,-.23204,-.19585,-.16015,-.12497,-.09036,-.05634,-.02296,.00977,.04183,.07321,.10389,.13386,.16313,.19169,.21956,.24672,.27321,.299,.32413,.34858,.37237,.3955,.41798,.43981,.461,.48154,.50145,.52073,.53939,.55744,.57488,.5917,.6079,.62347,.63837,.65259,.66609,.67885,.69083,.70201,.71235,.72183,.73042,.73812,.7449,.75076,.7557,.75973,.76284,.76507,.76642,.76692,.76659,.76545,.76352,.76083,.7574,.75324,.74837,.74279,.73652,.72959,.72199,.71377,.70493,.69553,.68558,.67515,.66426,.65298,.64135,.62944,.6173,.60499,.59257,.58008,.56759,.55513,.54275,.5305,.51842,.50654,.4949,.48353,.47246,.4617,.45128,.44121,.43149,.42213,.41313,.40448,.39617,.38818,.3805,.37309,.36594,.35902,.35229,.34572,.33927,.33292,.32663,.32035,.31407,.30774,.30135,.29486,.28824,.28148,.27454,.26739,.26002,.25241,.24454,.23639,.22796,.21922,.21016,.20076,.19098,.18082,.17023,.1592,.14768,.13566,.1231,.10996,.09624,.08188,.06688,.05121,.03485,.01778,0,-.0185,-.03771,-.05763,-.07824,-.09952,-.12144,-.14396,-.16706,-.19069,-.21481,-.23938,-.26436,-.28971,-.31539,-.34136,-.36759,-.39404,-.42067,-.44746,-.47437,-.50136,-.52839,-.55544,-.58248,-.60948,-.63642,-.66329,-.6901,-.71684,-.74352,-.77015,-.79675,-.82332,-.84988,-.87644,-.90301,-.92958,-.95615,-.98272,-1.00926,-1.03575,-1.06217,-1.08847,-1.11463,-1.1406,-1.16633,-1.19178,-1.2169,-1.24164,-1.26595,-1.28979,-1.31312,-1.3359,-1.35809,-1.37963,-1.4005,-1.42064,-1.44,-1.45853,-1.47616,-1.49285,-1.50853,-1.52313,-1.53659,-1.54886,-1.55986,-1.56955,-1.57788,-1.5848],pressure:[-.01365,-.00206,.01025,.02327,.03696,.05129,.06619,.08163,.09755,.11393,.1307,.14784,.16531,.18308,.20111,.21938,.23786,.25651,.2753,.29419,.31315,.33215,.35115,.37015,.38913,.40806,.42694,.44576,.46449,.48313,.50167,.5201,.53839,.55653,.57448,.59222,.60971,.62692,.6438,.66033,.67648,.69221,.70753,.72242,.73688,.75093,.76456,.77779,.79063,.80309,.81517,.82686,.83817,.84911,.85967,.86987,.87972,.88924,.89845,.90734,.91594,.92425,.93229,.94005,.94754,.95475,.96166,.96826,.97451,.9804,.98588,.99092,.99549,.99957,.99685,.99381,.99131,.98936,.98796,.98711,.98681,.98706,.98787,.98923,.99113,.99357,.99654,1,.99607,.99171,.98695,.98181,.97634,.97057,.96452,.95824,.95175,.94506,.93818,.93113,.92389,.91647,.90887,.90109,.89314,.88501,.87672,.86831,.85978,.85119,.84256,.83393,.82533,.8168,.80836,.80002,.79181,.78374,.77582,.7681,.76059,.75331,.74629,.73955,.73311,.72697,.72116,.71568,.71054,.70572,.70121,.697,.69304,.68931,.68576,.68236,.67905,.67582,.67262,.66941,.66619,.66291,.65957,.65613,.65259,.64892,.6451,.6411,.6369,.63248,.62783,.62295,.61783,.61247,.60688,.60104,.59498,.58868,.58216,.57542,.56845,.56125,.5538,.5461,.53813,.52986,.52129,.51239,.50316,.49359,.4837,.47349,.46299,.45223,.44124,.43005,.41869,.40719,.39557,.38386,.37207,.36023,.34836,.33648,.32464,.31287,.30119,.28963,.27822,.26698,.25594,.2451,.23448,.22409,.21391,.20394,.19415,.18452,.17503,.16565,.15636,.14713,.13794,.1288,.11968,.11058,.10151,.09247,.08346,.07447,.06552,.05659,.0477,.03885,.03007,.02137,.01278,.00433,-.00393,-.012,-.01983,-.02738,-.03463,-.04155,-.0481,-.05429,-.0601,-.06553,-.07057,-.07524,-.07954,-.08347,-.08703,-.09022,-.09303,-.09544,-.09744,-.09898,-.10004,-.10059,-.1006,-.10005,-.09892,-.0972,-.09487,-.09192,-.08833,-.08409,-.07918,-.07357,-.06724,-.06019,-.0524,-.04386,-.03455,-.02448]},{distance:[-3.46259,-3.47131,-3.47668,-3.47863,-3.47712,-3.4721,-3.46352,-3.45138,-3.43566,-3.41635,-3.39347,-3.36704,-3.33709,-3.30368,-3.26684,-3.22667,-3.18322,-3.1366,-3.08689,-3.0342,-2.97865,-2.92036,-2.85946,-2.79607,-2.73034,-2.66241,-2.59242,-2.52052,-2.44686,-2.37159,-2.29485,-2.2168,-2.13757,-2.05731,-1.97616,-1.89426,-1.81174,-1.72875,-1.64543,-1.56191,-1.47833,-1.39483,-1.3115,-1.22847,-1.14581,-1.06361,-.98193,-.90083,-.82036,-.74054,-.66141,-.583,-.50532,-.4284,-.35228,-.277,-.20261,-.12916,-.05672,.01463,.08485,.15384,.22153,.28784,.35269,.41602,.47776,.53787,.59629,.653,.70799,.76123,.81274,.86253,.9106,.95698,1.0017,1.04477,1.0862,1.126,1.16415,1.20065,1.23546,1.26857,1.29994,1.32953,1.35731,1.38321,1.40719,1.42921,1.44922,1.46719,1.48309,1.49691,1.50862,1.51825,1.52581,1.53133,1.53486,1.53644,1.53616,1.53409,1.53031,1.52493,1.51803,1.50972,1.50009,1.48924,1.47725,1.46421,1.45019,1.43527,1.4195,1.40295,1.38568,1.36778,1.34929,1.3303,1.31087,1.29108,1.27099,1.25066,1.23018,1.2096,1.18898,1.16838,1.14785,1.12745,1.10721,1.08719,1.06741,1.04791,1.02871,1.00986,.99136,.97324,.95551,.93819,.92127,.90476,.88866,.87296,.85767,.84277,.82823,.81406,.80022,.7867,.77346,.76049,.74774,.73519,.72278,.71049,.69827,.68606,.67381,.66145,.64893,.63618,.62313,.60973,.5959,.5816,.56675,.5513,.53516,.51826,.50053,.4819,.46231,.44169,.42002,.39725,.37336,.34834,.32219,.2949,.2665,.23698,.20638,.17469,.14193,.10809,.07316,.03714,0,-.03827,-.07772,-.11836,-.16022,-.20332,-.24768,-.29332,-.34024,-.38844,-.43788,-.48854,-.54036,-.59329,-.64724,-.70211,-.75782,-.81425,-.87128,-.92881,-.98674,-1.04498,-1.10346,-1.1621,-1.22086,-1.27969,-1.33854,-1.3974,-1.45625,-1.51511,-1.57396,-1.63283,-1.69173,-1.75067,-1.80968,-1.86875,-1.9279,-1.98712,-2.04639,-2.10568,-2.16495,-2.22416,-2.28322,-2.34208,-2.40063,-2.4588,-2.51647,-2.57354,-2.62989,-2.68543,-2.74002,-2.79357,-2.84597,-2.89711,-2.94689,-2.99521,-3.04195,-3.087,-3.13023,-3.17152,-3.21075,-3.24779,-3.28252,-3.3148,-3.34451,-3.37154,-3.39577,-3.41709,-3.43539,-3.45059],pressure:[.87183,.87151,.87129,.87118,.87117,.87128,.87149,.87182,.87225,.8728,.87347,.87424,.87513,.87613,.87723,.87845,.87978,.88122,.88276,.88441,.88616,.88801,.88996,.892,.89414,.89637,.89868,.90108,.90356,.90611,.90874,.91144,.91421,.91704,.91993,.92287,.92587,.92892,.93201,.93514,.93831,.94151,.94474,.94799,.95126,.95456,.95786,.96118,.9645,.96783,.97116,.97448,.9778,.98111,.98441,.9877,.99096,.99421,.99742,.99938,.99622,.9931,.99001,.98697,.98397,.98101,.97811,.97526,.97246,.96972,.96703,.96441,.96185,.95935,.95691,.95455,.95225,.95002,.94786,.94577,.94376,.94182,.93995,.93817,.93646,.93483,.93328,.93181,.93042,.92911,.92788,.92673,.92566,.92467,.92376,.92293,.92217,.92149,.92088,.92034,.91987,.91947,.91913,.91886,.91864,.91849,.91838,.91833,.91834,.91839,.91849,.91863,.91883,.91907,.91935,.91968,.92005,.92046,.92092,.92142,.92195,.92253,.92314,.9238,.92449,.92521,.92598,.92677,.9276,.92847,.92936,.93029,.93125,.93224,.93325,.9343,.93537,.93646,.93758,.93872,.93988,.94106,.94225,.94346,.94469,.94593,.94718,.94844,.94971,.95098,.95226,.95354,.95482,.9561,.95738,.95867,.95995,.96122,.9625,.96377,.96504,.9663,.96757,.96883,.97009,.97135,.97261,.97387,.97513,.9764,.97767,.97895,.98023,.98153,.98284,.98416,.98549,.98684,.98821,.9896,.99101,.99244,.99389,.99537,.99688,.99842,1,.99839,.99675,.99508,.99336,.99161,.98982,.98799,.98613,.98422,.98228,.98029,.97827,.97622,.97414,.97202,.96987,.9677,.96551,.9633,.96107,.95882,.95656,.9543,.95202,.94975,.94747,.94519,.94292,.94065,.93838,.93613,.93388,.93164,.92941,.9272,.92499,.9228,.92062,.91846,.91631,.91418,.91207,.90998,.90792,.90588,.90387,.90189,.89995,.89804,.89617,.89434,.89256,.89083,.88914,.88752,.88595,.88443,.88299,.88161,.8803,.87907,.87791,.87683,.87584,.87494,.87412,.8734,.87278,.87225]},{distance:[.39335,.43437,.47737,.52234,.56923,.61801,.66864,.72109,.7753,.83123,.88882,.94801,1.00875,1.07097,1.13461,1.1996,1.26586,1.33333,1.40193,1.47158,1.54221,1.61373,1.68607,1.75913,1.83284,1.90711,1.98186,2.05699,2.13243,2.20809,2.28387,2.35971,2.4355,2.51117,2.58663,2.66179,2.73658,2.81092,2.88473,2.95792,3.03043,3.10217,3.17308,3.24309,3.31211,3.3801,3.44697,3.51267,3.57712,3.64028,3.70208,3.76247,3.8214,3.87881,3.93467,3.98892,4.04152,4.09244,4.14164,4.18908,4.23474,4.27859,4.32061,4.36077,4.39905,4.43544,4.46992,4.50249,4.53314,4.56185,4.58864,4.61349,4.63642,4.65745,4.67657,4.69381,4.7092,4.72274,4.73447,4.74441,4.75259,4.75903,4.76376,4.76682,4.76822,4.768,4.76618,4.76279,4.75786,4.75142,4.74348,4.73409,4.72326,4.71102,4.69739,4.68241,4.6661,4.64849,4.6296,4.60948,4.58816,4.56567,4.54204,4.51732,4.49154,4.46473,4.43694,4.4082,4.37854,4.348,4.31662,4.28443,4.25145,4.21773,4.1833,4.14819,4.11243,4.07606,4.03912,4.00162,3.96361,3.92512,3.88618,3.84683,3.80708,3.76697,3.72653,3.68579,3.64478,3.60351,3.56202,3.52033,3.47845,3.43642,3.39425,3.35196,3.30957,3.2671,3.22455,3.18196,3.13933,3.09668,3.05402,3.01136,2.96873,2.92613,2.88357,2.84108,2.79865,2.75631,2.71407,2.67195,2.62994,2.58807,2.54634,2.50477,2.46338,2.42216,2.38114,2.34032,2.29971,2.25933,2.21916,2.17923,2.13954,2.10008,2.06087,2.02189,1.98316,1.94468,1.90644,1.86845,1.83069,1.79316,1.75586,1.71877,1.68189,1.6452,1.60868,1.57232,1.53611,1.50004,1.46407,1.4282,1.39241,1.35668,1.321,1.28535,1.24972,1.2141,1.17849,1.14286,1.10723,1.07158,1.03593,1.00028,.96464,.92902,.89344,.85793,.8225,.78719,.75203,.71705,.68231,.64784,.61369,.57991,.54656,.51368,.48134,.44959,.41849,.3881,.35848,.32967,.30174,.27474,.24872,.22373,.19982,.17702,.15539,.13497,.11579,.09791,.08137,.06621,.05248,.04022,.02948,.02029,.01271,.00677,.00252,0,-76e-5,27e-5,.00314,.00788,.01451,.02307,.03357,.04604,.0605,.07697,.09546,.11599,.13858,.16322,.18992,.21869,.24952,.28241,.31735,.35434],pressure:[.95248,.95236,.95228,.95223,.95222,.95224,.95231,.95241,.95256,.95274,.95296,.95322,.95352,.95385,.95423,.95465,.9551,.9556,.95613,.9567,.95731,.95796,.95864,.95936,.96012,.96091,.96173,.96259,.96348,.9644,.96535,.96633,.96734,.96838,.96944,.97053,.97164,.97277,.97393,.9751,.97629,.9775,.97873,.97997,.98122,.98249,.98376,.98505,.98634,.98763,.98893,.99023,.99154,.99284,.99414,.99544,.99673,.99802,.9993,.99942,.99816,.99691,.99568,.99445,.99324,.99205,.99087,.98972,.98858,.98746,.98636,.98528,.98423,.9832,.98219,.98121,.98025,.97931,.9784,.97752,.97666,.97582,.97501,.97423,.97347,.97274,.97203,.97135,.9707,.97007,.96948,.9689,.96836,.96784,.96735,.96689,.96646,.96605,.96567,.96533,.965,.96471,.96445,.96421,.964,.96382,.96367,.96355,.96346,.96339,.96335,.96334,.96336,.9634,.96348,.96358,.9637,.96385,.96403,.96423,.96446,.96471,.96499,.96529,.96561,.96595,.96631,.96669,.96709,.96751,.96795,.9684,.96887,.96935,.96984,.97035,.97087,.9714,.97194,.97249,.97304,.97361,.97418,.97476,.97534,.97592,.97651,.97711,.9777,.9783,.9789,.9795,.9801,.9807,.9813,.9819,.9825,.98309,.98369,.98428,.98486,.98545,.98603,.98661,.98718,.98775,.98832,.98888,.98944,.99,.99056,.99112,.99167,.99223,.99279,.99335,.99392,.99449,.99507,.99565,.99624,.99684,.99745,.99807,.9987,.99934,1,.99933,.99866,.99797,.99727,.99656,.99583,.9951,.99435,.99359,.99283,.99205,.99126,.99046,.98966,.98885,.98803,.9872,.98637,.98554,.9847,.98387,.98303,.98219,.98134,.9805,.97967,.97883,.978,.97717,.97634,.97552,.97471,.97389,.97309,.97229,.9715,.97071,.96993,.96915,.96838,.96762,.96687,.96612,.96539,.96466,.96395,.96324,.96255,.96187,.9612,.96055,.95991,.95929,.95869,.95811,.95754,.957,.95648,.95599,.95552,.95508,.95467,.95428,.95393,.9536,.95331,.95305,.95283,.95264]},{distance:[2.85606,2.86149,2.86432,2.8645,2.862,2.85686,2.84912,2.83886,2.82618,2.81117,2.79393,2.77456,2.75314,2.72975,2.70447,2.67734,2.64844,2.61784,2.58564,2.55196,2.5169,2.48057,2.44305,2.40438,2.36462,2.32383,2.28208,2.23943,2.19591,2.15153,2.10628,2.06016,2.01321,1.96548,1.91702,1.86793,1.8183,1.76829,1.71803,1.66767,1.61737,1.56726,1.51746,1.46803,1.41902,1.37044,1.32228,1.27452,1.22716,1.18023,1.13376,1.08781,1.04244,.99769,.95357,.91003,.86701,.82447,.78238,.74069,.69938,.65836,.61758,.57699,.53656,.49627,.45611,.41611,.37632,.33683,.29776,.25924,.22141,.18441,.14839,.11346,.07972,.04727,.01619,-.01348,-.0417,-.0684,-.09351,-.11698,-.13875,-.1588,-.17713,-.19381,-.20889,-.22242,-.23444,-.24501,-.25421,-.26216,-.26897,-.27473,-.27951,-.28336,-.28631,-.28836,-.28948,-.28963,-.28873,-.28673,-.28355,-.27916,-.27354,-.26673,-.25878,-.2498,-.23992,-.22929,-.21802,-.20623,-.19398,-.18134,-.16836,-.1551,-.14163,-.12809,-.11461,-.1013,-.08826,-.07557,-.06335,-.0517,-.04077,-.03065,-.02143,-.01321,-.00606,0,.00496,.00888,.01181,.01385,.01511,.0157,.01574,.01533,.01458,.01358,.0124,.01112,.00979,.00851,.00738,.0065,.006,.00596,.00646,.00754,.00924,.01161,.01471,.01858,.02323,.02865,.03481,.04169,.0493,.05765,.06677,.07671,.08754,.09934,.11222,.12628,.14159,.15823,.17624,.19561,.21632,.23828,.26142,.28563,.31083,.33696,.36397,.39185,.42057,.4501,.48036,.51125,.54264,.5744,.60646,.63871,.67105,.70337,.73556,.76751,.79918,.83048,.86139,.8919,.92202,.95184,.98144,1.01094,1.04045,1.0701,1.10002,1.13029,1.16103,1.1923,1.22416,1.25664,1.28979,1.32364,1.35824,1.39363,1.42985,1.4669,1.50475,1.54332,1.58252,1.62227,1.6625,1.70312,1.744,1.78501,1.82598,1.8668,1.90734,1.94754,1.98732,2.02666,2.06555,2.10402,2.1421,2.17985,2.2173,2.25448,2.29139,2.328,2.36424,2.4,2.43515,2.46955,2.50309,2.53565,2.56717,2.59761,2.62692,2.65505,2.68191,2.7074,2.73138,2.75375,2.7744,2.79324,2.81017,2.82504,2.83772,2.8481],pressure:[.22758,.23641,.24578,.25568,.26609,.27699,.28835,.30016,.31237,.32495,.33789,.35113,.36466,.37843,.39241,.40658,.4209,.43535,.44989,.4645,.47916,.49385,.50853,.5232,.53784,.55243,.56696,.58141,.59578,.61004,.62419,.63821,.65209,.6658,.67934,.69268,.70582,.71873,.73139,.7438,.75594,.76779,.77935,.79061,.80156,.81221,.82254,.83258,.84231,.85176,.86091,.86978,.87837,.88669,.89473,.9025,.91,.91725,.92425,.931,.93752,.9438,.94985,.95566,.96124,.96658,.97168,.97652,.98109,.98539,.98939,.99309,.99646,.99949,.99783,.99552,.99361,.99209,.99098,.99029,.99003,.99019,.99079,.99181,.99324,.9951,.99735,1,.99698,.99361,.98992,.98592,.98163,.97709,.97231,.96731,.96212,.95676,.95122,.94554,.93973,.93378,.92773,.92157,.91532,.90899,.90258,.89612,.88961,.88308,.87653,.87,.8635,.85705,.85068,.8444,.83823,.83219,.82628,.82052,.81493,.80952,.8043,.79929,.7945,.78994,.78561,.78151,.77765,.77402,.77062,.76742,.76443,.76161,.75896,.75645,.75406,.75175,.74951,.7473,.74511,.74289,.74064,.73833,.73592,.73341,.73078,.728,.72507,.72197,.71869,.71522,.71156,.70769,.70363,.69936,.69489,.69021,.68533,.68023,.67492,.66939,.66363,.65765,.65145,.64501,.63833,.63143,.62428,.61691,.60931,.60148,.59344,.58521,.57679,.5682,.55948,.55063,.54167,.53264,.52354,.51439,.50522,.49603,.48686,.47773,.46865,.45964,.45072,.44192,.43324,.42469,.41629,.40804,.39994,.392,.3842,.37655,.36903,.36164,.35437,.3472,.34012,.33312,.3262,.31933,.31251,.30574,.299,.2923,.28563,.27899,.27239,.26583,.25933,.25288,.24652,.24025,.2341,.22808,.22221,.21653,.21104,.20576,.20072,.19592,.19138,.18712,.18313,.17943,.17602,.17292,.17013,.16766,.16551,.16369,.16222,.1611,.16036,.16001,.16007,.16055,.16148,.16286,.16471,.16705,.16988,.17321,.17706,.18144,.18636,.19182,.19785,.20443,.21158,.2193]},{distance:[-2.31317,-2.3191,-2.32189,-2.32154,-2.31811,-2.31174,-2.30254,-2.29062,-2.27609,-2.25904,-2.23954,-2.21767,-2.19355,-2.16732,-2.13907,-2.10885,-2.07672,-2.04268,-2.00677,-1.96911,-1.92985,-1.88914,-1.84713,-1.80397,-1.75979,-1.71467,-1.66864,-1.62171,-1.57395,-1.52546,-1.47625,-1.42628,-1.3755,-1.32384,-1.27131,-1.218,-1.16408,-1.10972,-1.05508,-1.00031,-.94551,-.89077,-.83615,-.7817,-.72757,-.6739,-.62076,-.56821,-.51625,-.46484,-.41397,-.36366,-.314,-.26506,-.21689,-.16957,-.12316,-.07766,-.03301,.01085,.05399,.09643,.13827,.17967,.22079,.26176,.30265,.34342,.38397,.42414,.46381,.50285,.54115,.57863,.61524,.65093,.6856,.71914,.75153,.78275,.81283,.84182,.86972,.89651,.92208,.94634,.96919,.99052,1.01025,1.02835,1.04484,1.05976,1.07309,1.08479,1.09492,1.1036,1.11096,1.11714,1.12224,1.12627,1.12916,1.13083,1.13125,1.13036,1.12816,1.12466,1.11992,1.11397,1.10677,1.09827,1.08849,1.07746,1.06527,1.05203,1.03786,1.02283,1.00695,.99025,.97279,.9546,.93573,.9163,.8965,.8765,.85647,.83652,.81687,.79775,.77939,.76199,.74568,.73049,.71635,.70316,.69082,.67925,.66834,.65804,.64831,.63911,.63032,.62184,.61363,.60564,.59788,.59036,.58308,.57597,.5689,.56177,.55447,.5469,.53896,.53062,.5219,.51283,.5034,.49355,.48335,.47287,.46223,.45154,.44085,.43012,.41923,.40805,.39648,.38441,.37176,.35849,.34458,.32999,.31461,.29833,.28109,.26288,.2437,.22361,.20265,.18082,.15807,.13434,.1096,.0838,.0569,.02894,0,-.0298,-.0604,-.09173,-.12364,-.15594,-.18843,-.22092,-.25331,-.28559,-.31781,-.35006,-.38244,-.41502,-.44785,-.48098,-.5144,-.54811,-.58218,-.61666,-.65153,-.68677,-.72232,-.75807,-.79397,-.83002,-.86628,-.90281,-.93968,-.97693,-1.01465,-1.05282,-1.09139,-1.13031,-1.16956,-1.20917,-1.24905,-1.28907,-1.32908,-1.36891,-1.40844,-1.44765,-1.48658,-1.52527,-1.56376,-1.60206,-1.64016,-1.67801,-1.71552,-1.75264,-1.78936,-1.8257,-1.86161,-1.89702,-1.93182,-1.96584,-1.99894,-2.03102,-2.06203,-2.0919,-2.12056,-2.14794,-2.17397,-2.19852,-2.22138,-2.24235,-2.26129,-2.27805,-2.29243,-2.30422],pressure:[.9681,.97424,.98046,.98674,.99309,.9995,.99404,.98754,.981,.97444,.96785,.96124,.95462,.94801,.94139,.93479,.92822,.92167,.91515,.90868,.90225,.89589,.88959,.88336,.87722,.87115,.86519,.85932,.85356,.84792,.84239,.83699,.83173,.8266,.82162,.81679,.81211,.80759,.80324,.79906,.79505,.79121,.78756,.78409,.78081,.77771,.77481,.77211,.76959,.76728,.76516,.76324,.76153,.76001,.75869,.75757,.75665,.75593,.7554,.75507,.75493,.75498,.75523,.75565,.75627,.75706,.75803,.75917,.76049,.76197,.76361,.76541,.76737,.76947,.77172,.77409,.7766,.77923,.78198,.78484,.7878,.79086,.79401,.79724,.80055,.80394,.8074,.81092,.8145,.81813,.82182,.82556,.82934,.83317,.83703,.84093,.84487,.84884,.85284,.85687,.86094,.86503,.86915,.87329,.87746,.88166,.88587,.89011,.89436,.89863,.90291,.9072,.91149,.91579,.92009,.92438,.92867,.93295,.9372,.94144,.94566,.94985,.954,.95812,.96219,.96623,.97021,.97415,.97802,.98184,.9856,.9893,.99293,.9965,1,.99657,.9932,.98991,.98668,.98352,.98042,.97738,.9744,.97148,.9686,.96577,.96298,.96023,.95751,.95482,.95214,.94949,.94684,.9442,.94156,.93892,.93627,.93361,.93094,.92825,.92555,.92284,.9201,.91735,.91458,.91179,.90899,.90616,.90332,.90047,.8976,.89472,.89183,.88893,.88603,.88314,.88024,.87735,.87448,.87162,.86878,.86597,.86319,.86044,.85774,.85508,.85247,.84993,.84744,.84503,.84269,.84042,.83825,.83616,.83417,.83227,.83048,.8288,.82724,.82578,.82445,.82324,.82215,.82119,.82037,.81967,.81911,.81868,.81839,.81824,.81823,.81835,.81862,.81903,.81957,.82026,.82109,.82206,.82317,.82443,.82583,.82737,.82906,.83089,.83287,.83499,.83726,.83968,.84223,.84494,.84778,.85077,.8539,.85717,.86058,.86412,.86781,.87163,.87559,.87968,.88391,.88826,.89275,.89737,.90211,.90698,.91198,.91709,.92233,.92768,.93315,.93873,.94441,.95019,.95607,.96205]},{distance:[4.72925,4.81721,4.9037,4.98859,5.07177,5.15311,5.23249,5.3098,5.38491,5.45772,5.52811,5.59598,5.66122,5.72375,5.78346,5.84028,5.8941,5.94486,5.99248,6.03689,6.07803,6.11584,6.15028,6.18128,6.20882,6.23285,6.25336,6.27031,6.28369,6.29348,6.29969,6.3023,6.30133,6.29678,6.28867,6.27703,6.26187,6.24324,6.22116,6.19567,6.16683,6.13468,6.09928,6.06068,6.01896,5.97417,5.92639,5.87569,5.82217,5.76589,5.70696,5.64545,5.58147,5.5151,5.44644,5.37559,5.30265,5.2277,5.15085,5.0722,4.99184,4.90987,4.82639,4.74151,4.65533,4.56794,4.47945,4.38996,4.29959,4.20843,4.11658,4.02416,3.93125,3.83796,3.74437,3.65057,3.55666,3.46272,3.36884,3.27509,3.18155,3.08831,2.99545,2.90303,2.81114,2.71984,2.62922,2.53933,2.45026,2.36207,2.27484,2.18862,2.10349,2.01951,1.93675,1.85528,1.77515,1.69644,1.61919,1.54348,1.46935,1.39685,1.32605,1.25698,1.18967,1.12417,1.06049,.99863,.93862,.88044,.82408,.76953,.71676,.66574,.61644,.56882,.52282,.47841,.43553,.39413,.35414,.31551,.27817,.24206,.20712,.17328,.14048,.10866,.07776,.04772,.01848,-.00999,-.03776,-.06487,-.09134,-.11721,-.14251,-.16725,-.19144,-.21509,-.2382,-.26076,-.28275,-.30416,-.32496,-.34511,-.36459,-.38334,-.40134,-.41852,-.43485,-.45026,-.46471,-.47815,-.49052,-.50179,-.51189,-.52081,-.52849,-.5349,-.54003,-.54383,-.54627,-.54734,-.54702,-.54528,-.54211,-.53752,-.53149,-.52403,-.51515,-.50487,-.4932,-.48015,-.46575,-.45001,-.43297,-.41463,-.39503,-.37419,-.35213,-.32887,-.30443,-.27885,-.25214,-.22432,-.19541,-.16544,-.13442,-.10235,-.06926,-.03514,0,.03616,.07336,.11159,.15088,.19125,.23272,.27531,.31906,.36401,.41019,.45764,.5064,.55651,.60802,.66096,.71538,.77129,.82874,.88776,.94836,1.01056,1.07438,1.13982,1.20687,1.27554,1.34581,1.41766,1.49107,1.56599,1.64239,1.72025,1.79951,1.88013,1.96209,2.04532,2.12979,2.21546,2.30226,2.39017,2.47911,2.56905,2.65991,2.75164,2.84416,2.93742,3.03133,3.12582,3.2208,3.31619,3.41191,3.50785,3.60393,3.70006,3.79612,3.89202,3.98765,4.08291,4.17767,4.27182,4.36525,4.45783,4.54944,4.63995],pressure:[.30942,.30838,.30765,.30724,.30715,.30738,.30795,.30884,.31007,.31164,.31354,.31578,.31837,.32129,.32455,.32815,.33209,.33636,.34097,.34591,.35117,.35675,.36265,.36887,.37539,.38221,.38933,.39674,.40442,.41238,.4206,.42907,.43779,.44675,.45593,.46533,.47493,.48473,.49471,.50486,.51517,.52563,.53623,.54694,.55777,.5687,.57971,.59079,.60194,.61313,.62435,.6356,.64686,.65811,.66935,.68056,.69174,.70286,.71391,.72489,.73579,.74659,.75728,.76785,.7783,.7886,.79876,.80877,.81861,.82827,.83776,.84706,.85617,.86507,.87378,.88227,.89056,.89863,.90649,.91412,.92153,.92872,.93568,.94241,.94892,.95519,.96122,.96702,.97258,.97791,.98299,.98783,.99242,.99677,.99911,.99525,.99164,.98827,.98515,.98228,.97966,.97728,.97514,.97324,.97159,.97017,.96898,.96801,.96727,.96674,.96641,.96629,.96635,.96661,.96703,.96762,.96838,.96928,.97032,.97149,.97279,.9742,.97572,.97734,.97905,.98085,.98273,.98468,.98669,.98877,.99091,.99311,.99535,.99765,1,.9976,.99516,.99267,.99014,.98755,.98491,.98222,.97947,.97666,.97378,.97083,.96781,.96471,.96153,.95826,.9549,.95144,.94787,.9442,.94042,.93651,.93249,.92834,.92407,.91966,.91512,.91045,.90564,.90069,.8956,.89037,.885,.87949,.87384,.86806,.86214,.85608,.84988,.84356,.83711,.83053,.82383,.81702,.81009,.80306,.79594,.78872,.78141,.77403,.76657,.75905,.75148,.74385,.73619,.72849,.72076,.71302,.70526,.69749,.68972,.68195,.67419,.66644,.65871,.65099,.64329,.63561,.62795,.62032,.61271,.60512,.59755,.59001,.58248,.57497,.56749,.56002,.55256,.54512,.5377,.5303,.52291,.51554,.50819,.50087,.49358,.48632,.4791,.47192,.4648,.45773,.45072,.44378,.43692,.43015,.42346,.41687,.41039,.40403,.39779,.39168,.38571,.37989,.37423,.36873,.36342,.35828,.35335,.34862,.34409,.3398,.33573,.3319,.32831,.32498,.32192,.31912,.3166,.31436,.31242,.31077]}]};function Cue(t){let e=null;for(const r of t){const i=r.type;if(Xbt(r)){if(e==null)e=i;else if(e!==i)return"uber"}}return e??"uber"}function Aue(t){let e=Bt.INVISIBLE;for(const{material:r}of t)if(_Oe(r)){if(r.color[3]*r.opacity<1)return Bt.TRANSPARENT;e=Bt.OPAQUE}return e}function Oue(t){let e=Bt.INVISIBLE;for(const{material:r}of t)if(_Oe(r)){switch(r.objectTransparency){case Bt.TRANSPARENT:case Bt.INVISIBLE:return Bt.TRANSPARENT;case Bt.OPAQUE:if(r.opacity<1)return Bt.TRANSPARENT}e=Bt.OPAQUE}return e}function _Oe(t){return t.size*t.color[3]*t.opacity>0}function Xbt(t){return t.size*t.color[3]>0}function Rue(t,e,r,i){for(let s=0;s<t.length;s++){const n=t[s].index,o=e[s],a=e[s+1];if(i)for(let l=o;l<a;l++){const c=i[l];r.set(c,n)}else for(let l=o;l<a;l++)r.set(l,n)}}let Sd=class extends Te{constructor(t){super(t),this._updatingHandles=new Cf,this._perObjectData=new Map,this._perObjectDataEvictionCache=new Set,this._renderers=new Map,this._gpuMemoryUsage=0,this._workerAbort=new AbortController,this._tmpModelPosition=C(),this._localOrigins=new Cbt(new YY(t.renderSR))}initialize(){this._worker=new Hbt(this.schedule),this._componentColorManager=new R3e(this.rctx,3);const t=S3e.createBuffer(4);for(let e=0;e<4;e++)t.sideness.set(e,0,e===0||e===3?0:1),t.sideness.set(e,1,e===0||e===1?0:1);this._verticesBufferObject=Lr.createVertex(this.rctx,Tr.STATIC_DRAW,t.buffer)}destroy(){this.destroyed||(this._perObjectData.forEach(t=>this._discardObjectEntry(t)),this._perObjectData.clear(),this._strokesTexture=Ue(this._strokesTexture),this._componentColorManager=Me(this._componentColorManager),this._workerAbort.abort(),this._worker.destroy(),this._verticesBufferObject=Ue(this._verticesBufferObject),this._renderers.clear(),this._updatingHandles.destroy(),this._set("schedule",twt))}get updating(){return this._updatingHandles.updating}get usedMemory(){return this._gpuMemoryUsage}shouldRender(){return this._renderers.size>0}async addComponentObject(t,e,r,i,s,n,o,a){if(this.hasObject(t))return this.getObjectMemoryUsage(t);let l;const c=new Mue(new Promise(p=>l=p),r.center,r.radius);this._perObjectData.set(t,c);const h=await this._updatingHandles.addPromise(this._addComponentGeometry(e,c,i,s,n,o,a));return this.setNeedsRender(),l(),h}async addOrUpdateObject3D(t,e,r,i){if(this.destroyed)return void Q.getLogger(this).warn("Attempt to add an object to a destroyed instance");const s=this._perObjectData.get(t);let n;s?.renderables.length>0&&this._perObjectDataEvictionCache.add(s);const o=t.boundingVolumeWorldSpace.bounds,a=new Mue(new Promise(c=>n=c),o,bg(o));this._perObjectData.set(t,a);const l=new Array;if(r.mergeGeometries&&t.geometries.length>1&&Ybt(t))l.push(this._addObjectMergedGeometries(t,a,e,r,i));else for(let c=0;c<t.geometries.length;c++){const h=t.geometries[c];h.material.supportsEdges&&l.push(this._addGeometry(t,a,h,e[0],r,i))}await this._updatingHandles.addPromise(Promise.all(l)),this._perObjectDataEvictionCache.delete(a),this._discardObjectEntry(s),this.setNeedsRender(),n()}_discardObjectEntry(t){t&&(t.renderables.length&&(t.renderables.forEach(e=>this._removeRenderable(e)),this.setNeedsRender()),t.loaded=null)}hasObject(t){return this._perObjectData.has(t)}async updateAllComponentOpacities(t,e){const r=await this._updatingHandles.addPromise(this._getObjectEntry(t));if(r==null)return;const i=e instanceof Array?s=>e[s]:()=>e;r.renderables.forEach(s=>{const n=s.components.meta.length;for(let o=0;o<n;o++){const a=i(o),l=s.components.meta[o],c=l.index;l.material.opacity=a,s.components.buffer.textureBuffer.setDataElement(c,1,3,255*a)}this._updateTransparency(s)}),this.setNeedsRender()}async getObjectMemoryUsage(t){const e=await this._getObjectEntry(t);return e!=null?e.renderables.reduce((r,i)=>r+i.statistics.gpuMemoryUsage,0):0}async updateAllComponentMaterials(t,e,r,i){const s=t instanceof ay,n=!!r.hasSlicePlane,o=Cue(e),a=Tk.getKey(o,n,s),l=await this._updatingHandles.addPromise(this._getObjectEntry(t));l!=null&&(l.renderables.forEach(c=>{if(a!==c.rendererKey){const h=this._renderers.get(c.rendererKey),p=this._acquireRenderer(o,n,s);h.removeRenderable(c),--h.refCount,c.rendererKey=a,p.addRenderable(c)}for(let h=0;h<e.length;h++)c.components.meta[h].material=e[h];i&&this._updateComponentBuffer(c.components),this._updateTransparency(c)}),this.setNeedsRender())}async updateAllVerticalOffsets(t,e){const r=await this._updatingHandles.addPromise(this._getObjectEntry(t));r!=null&&(r.renderables.forEach(i=>{const s=i.components.meta;for(let n=0;n<s.length;n++)i.components.meta[n].verticalOffset=e?.[n]??0;this._updateComponentBuffer(i.components)}),this.setNeedsRender())}async updateObjectVisibility(t,e){const r=await this._updatingHandles.addPromise(this._getObjectEntry(t));r!=null&&(r.renderables.forEach(i=>i.visible=e),this.setNeedsRender())}removeObject(t){const e=this._perObjectData.get(t);e&&(this._perObjectData.delete(t),this._discardObjectEntry(e))}async _getObjectEntry(t){const e=this._perObjectData.get(t);if(!e)throw new Error("no object");return await e.loaded,e.loaded==null?null:e}render(t,e){if(this._componentColorManager==null)return;this._localOrigins.updateViewMatrices(t.camera.viewMatrix);const r=t.camera.viewInverseTransposeMatrix,i=C(),s=new D6;let n=0,o=0;if(this._renderers.forEach(l=>{if(l.refCount===0)this._renderers.delete(l.key),l.dispose();else{let c=!0,h=!0;l.forEachRenderable(p=>{p.visible&&(n+=p.statistics.averageEdgeLength,o++,c&&p.regular&&(l.updateTechnique(t,!1),c=!1),h&&p.silhouette&&(l.updateTechnique(t,!0),h=!1))},e)}}),this._componentColorManager.garbageCollect(),this._componentColorManager.updateTextures(),o===0)return;const a=new Obt(40*n/o,e);se(i,r[3],r[7],r[11]),s.set(i),ie(a.transformWorldFromViewTH,s.high),ie(a.transformWorldFromViewTL,s.low),Ph(a.transformViewFromCameraRelativeRS,t.camera.viewMatrix),Mh(Due,a.transformViewFromCameraRelativeRS),Nw(a.transformNormalViewFromGlobal,Due),a.transformProjFromView=t.camera.projectionMatrix,this._updateObjectCameraDistances(t),this._renderers.forEach(l=>{this._renderRegularEdges(l,t,a),this._renderSilhouetteEdges(l,t,a)})}_updateTransparency(t){const e=Aue(t.components.meta),r=Oue(t.components.meta);e===t.edgeTransparency&&r===t.objectTransparency||(t.edgeTransparency=e,t.objectTransparency=r,this._renderers.get(t.rendererKey).setRenderablesDirty())}_computeModelTransformWithLocalOrigin(t,e,r){t.getCombinedShaderTransformation(e,r);const i=e.localOrigin!=null?this._localOrigins.register(e.localOrigin):this._localOrigins.acquire(se(this._tmpModelPosition,r[12],r[13],r[14]));return e.localOrigin=i.origin,Sbt(i.origin.vec3,r),i}_updateComponentBuffer(t){const{meta:e,buffer:r}=t,i=new Uint8Array(4);for(let s=0;s<e.length;s++){const n=e[s].material,o=e[s].index,a=ge(Math.round(n.size*Bbt),0,255),l=ge(n.extensionLength,-xk,255-xk)+xk,c=n.type==="solid"?nF.SOLID:nF.SKETCH,h=255*n.opacity,p=n.color,f=255*p[0],m=255*p[1],y=255*p[2],_=255*p[3];r.textureBuffer.setData(o,0,f,m,y,_),r.textureBuffer.setData(o,1,a,l,c,h),b3e(e[s].verticalOffset,i),r.textureBuffer.setData(o,2,i[0],i[1],i[2],i[3])}}_createComponentBuffers(t){if(this._componentColorManager==null)return null;const e=new Array,r=this._componentColorManager.getBuffer(t.length);for(let s=0;s<t.length;s++){const n=t[s],o=r.acquireIndex();e.push({index:o,verticalOffset:0,material:n})}const i=new Jbt(r,e);return this._updateComponentBuffer(i),i}_extractEdges(t,e,r,i,s,n=s.length){return this._worker.process({data:e,indices:s,indicesLength:n,writerSettings:t,skipDeduplicate:r},this._workerAbort.signal,i)}_createRenderable(t,e,r,i,s){const n=c=>this._verticesBufferObject!=null?new Qbt(new pp(this.rctx,C3e,{vertices:Cvt,instances:c===cb.REGULAR?iF.glLayout:sF.glLayout},{vertices:this._verticesBufferObject,instances:Lr.createVertex(this.rctx,Tr.STATIC_DRAW,c===cb.REGULAR?t.regular.instancesData.buffer:t.silhouette.instancesData.buffer)}),c===cb.REGULAR?t.regular.lodInfo:t.silhouette.lodInfo):null,o=t.regular.lodInfo.lengths.length>0?n(cb.REGULAR):null,a=t.silhouette.lodInfo.lengths.length>0?n(cb.SILHOUETTE):null,l=(o?.vao.memoryEstimate??0)+(a?.vao.memoryEstimate??0);return new ewt(o,a,{gpuMemoryUsage:l,externalMemoryUsage:s,averageEdgeLength:t.averageEdgeLength},r,Aue(e.meta),Oue(e.meta),e,i)}async _addGeometry(t,e,r,i,s,n){const o=r.vertexAttributes.get(E.POSITION),a=r.indices.get(E.POSITION),l=be(),c=this._computeModelTransformWithLocalOrigin(t,r,l),h=new Lue(o,a,l,c);return this._addPositionData(e,h,r.edgeIndicesLength,i,s,n)}async _addPositionData(t,e,r,i,s,n=!1){if(t.loaded==null)return;const o=this._createComponentBuffers([i]);if(o==null||r<=0)return;const a=this._acquireRenderer(i.type,!!s.hasSlicePlane,!0),{modelTransform:l,origin:c}=e,h=e.indices,p=e.position,f=p.data.length/p.size,m=tF.createBuffer(f);for(let v=0;v<f;v++)m.position.set(v,0,p.data[v*p.size]),m.position.set(v,1,p.data[v*p.size+1]),m.position.set(v,2,p.data[v*p.size+2]);Rue(o.meta,[0,m.componentIndex.count],m.componentIndex);const y=await this._updatingHandles.addPromise(this._extractEdges(a.writerSettings,m,!1,n,h,r));if(t.loaded==null)return;const _=this._createRenderable(y,o,new Kbt(l,c),a.key,!1);t.renderables.push(_),a.addRenderable(_),this._gpuMemoryUsage+=_.statistics.gpuMemoryUsage}async _addComponentGeometry(t,e,r,i,s,n,o){if(e.loaded==null)return 0;const a=this._createComponentBuffers(n);if(a==null)return 0;const l=Cue(n),c=this._acquireRenderer(l,o.hasSlicePlane||!1,!1),h=tF.createBuffer(r.length/3);gP(h.position.typedBuffer,r,h.position.typedBufferStride,3),Rue(a.meta,s,h.componentIndex,i);const p=!0,f=c.writerSettings,m=await this._updatingHandles.addPromise(this._extractEdges(f,h,p,!1,i));if(e.loaded==null)return 0;const y=this._createRenderable(m,a,t,c.key,!0);return e.renderables.push(y),c.addRenderable(y),y.statistics.gpuMemoryUsage}async _addObjectMergedGeometries(t,e,r,i,s){const n=new Map;let o=0,a=null,l=0;for(let w=0;w<t.geometries.length;w++){const x=t.geometries[w];if(!x.material.supportsEdges)continue;!a&&x.localOrigin&&(a=x);const T=x.vertexAttributes.get(E.POSITION);l+=T.data.length/T.size,o+=x.edgeIndicesLength}const c=l>=65536?Uint32Array:Uint16Array,h=o?new c(o):null,p=[];let f=0;for(let w=0;w<t.geometries.length;w++){const x=t.geometries[w];if(!x.material.supportsEdges)continue;const T=x.vertexAttributes.get(E.POSITION),S=x.indices.get(E.POSITION);let O=n.get(T.data);if(O==null){O=p.length/3;for(let A=0;A<T.data.length;A+=T.size)p.push(T.data[A]),p.push(T.data[A+1]),p.push(T.data[A+2]);n.set(T.data,O)}if(S)for(let A=0;A<x.edgeIndicesLength;A++)h[f++]=O+S[A]}const m=a||t.geometries[0],y=be(),_=this._computeModelTransformWithLocalOrigin(t,m,y);for(let w=0;w<t.geometries.length;w++)t.geometries[w].localOrigin=_.origin;const v=new Lue({data:p,size:3},h,y,_);await this._updatingHandles.addPromise(this._addPositionData(e,v,h.length,r[0],i,s))}_acquireRenderer(t,e,r){const i=Tk.getKey(t,e,r);let s=this._renderers.get(i);return this._strokesTexture==null&&(this._strokesTexture=qbt(this.rctx)),s||(s=new Tk(this.rctx,this.techniqueRepository,{type:t,hasSlicePlane:e,strokesTexture:this._strokesTexture,legacy:r,spherical:this.viewingMode===De.Global}),this._renderers.set(i,s)),++s.refCount,s}_removeRenderable(t){Pue(t.regular),Pue(t.silhouette);const e=this._renderers.get(t.rendererKey);if(e){e.removeRenderable(t),--e.refCount,"origin"in t.transform&&this._localOrigins.release(t.transform.origin),this._gpuMemoryUsage-=t.statistics.externalMemoryUsage?0:t.statistics.gpuMemoryUsage;for(const r of t.components.meta)t.components.buffer.releaseIndex(r.index)}}_updateObjectCameraDistances(t){const e=t.camera.eye,r=t.camera.viewForward,i=C(),s=n=>{Cn(i,n.center,e);const o=fe(i,r),a=n.radius,l=o<-a?1/0:o<a?0:o-a;n.renderables.forEach(c=>c.distanceToCamera=l)};this._perObjectData.forEach(s),this._perObjectDataEvictionCache.forEach(s)}_renderRegularEdges(t,e,r){const i=t.bindRegularEdges(r,e),s=r.transparency,n=e.camera.perScreenPixelRatio;t.forEachRenderable(o=>{if(!Iue(o)||!o.visible)return;const a=T$(o.regular.lod.lengths,o.distanceToCamera,n);t.renderRegularEdges(i,o,r,e,a)},s)}_renderSilhouetteEdges(t,e,r){const i=t.bindSilhouetteEdges(r,e),s=r.transparency,n=e.camera.perScreenPixelRatio;t.forEachRenderable(o=>{if(!$ue(o)||!o.visible)return;const a=T$(o.silhouette.lod.lengths,o.distanceToCamera,n);t.renderSilhouetteEdges(i,o,r,e,a)},s)}get test(){return{hasRenderedPrimitives:t=>{let e=!1;const r=t.perScreenPixelRatio,i=(s,n)=>s.forEachRenderable(o=>{o.visible&&!e&&(Iue(o)&&(e=T$(o.regular.lod.lengths,o.distanceToCamera,r)>0),!e&&$ue(o)&&(e=T$(o.silhouette.lod.lengths,o.distanceToCamera,r)>0))},n);return this._renderers.forEach(s=>{e||(i(s,Bt.OPAQUE),i(s,Bt.TRANSPARENT))}),e}}}};function Pue(t){t!=null&&(t.vao.vertexBuffers.instances.dispose(),t.vao.disposeVAOOnly(),t.vao=null)}function Ybt(t){let e=null,r=null;for(let i=0;i<t.geometries.length;i++){const s=t.geometries[i];if(s.material.supportsEdges){if(e){if(!Pg(e,s.transformation))return!1}else e=s.transformation;if(r||s.localOrigin==null){if(r&&r.localOrigin!=null&&s.localOrigin!=null&&r.localOrigin.id!==s.localOrigin.id)return!1}else r=s}}return!0}u([d({constructOnly:!0})],Sd.prototype,"rctx",void 0),u([d({constructOnly:!0})],Sd.prototype,"renderSR",void 0),u([d({constructOnly:!0})],Sd.prototype,"viewingMode",void 0),u([d({constructOnly:!0})],Sd.prototype,"techniqueRepository",void 0),u([d({constructOnly:!0})],Sd.prototype,"setNeedsRender",void 0),u([d({constructOnly:!0})],Sd.prototype,"schedule",void 0),u([d({readOnly:!0})],Sd.prototype,"_updatingHandles",void 0),u([d({readOnly:!0})],Sd.prototype,"updating",null),Sd=u([R("esri.views.3d.webgl-engine.lib.edgeRendering.EdgeView")],Sd);class Mue{constructor(e,r,i){this.center=r,this.radius=i,this.renderables=new Array,this.loaded=e,this.loaded.then(()=>{this.loaded!=null&&(this.loaded=!0)})}}let Jbt=class{constructor(e,r){this.buffer=e,this.meta=r}};class Qbt{constructor(e,r){this.vao=e,this.lod=r}}class Kbt{constructor(e,r){this.modelMatrix=e,this.origin=r}}let ewt=class{constructor(e,r,i,s,n,o,a,l){this.regular=e,this.silhouette=r,this.statistics=i,this.transform=s,this.edgeTransparency=n,this.objectTransparency=o,this.components=a,this.rendererKey=l,this.distanceToCamera=0,this.visible=!0}};function Iue(t){return t.regular!=null}function $ue(t){return t.silhouette!=null}function T$(t,e,r){const i=e*r,s=hhe(t,i,!0);return s===-1?i<t[0]?t.length:0:t.length-s}class Lue{constructor(e,r,i,s){this.position=e,this.indices=r,this.modelTransform=i,this.origin=s}}const Due=Li(),twt=()=>Promise.reject();function gp(t){return window.WebGL2RenderingContext&&t instanceof window.WebGL2RenderingContext}let Nue=class{constructor(e,r,i,s,n,o,a,l,c){this.createQuery=e,this.deleteQuery=r,this.resultAvailable=i,this.getResult=s,this.disjoint=n,this.beginTimeElapsed=o,this.endTimeElapsed=a,this.createTimestamp=l,this.timestampBits=c}},Jm=!1;function rwt(t,e){if(e.disjointTimerQuery)return null;let r=t.getExtension("EXT_disjoint_timer_query_webgl2");return r&&gp(t)?new Nue(()=>t.createQuery(),i=>{t.deleteQuery(i),Jm=!1},i=>t.getQueryParameter(i,t.QUERY_RESULT_AVAILABLE),i=>t.getQueryParameter(i,t.QUERY_RESULT),()=>t.getParameter(r.GPU_DISJOINT_EXT),i=>{Jm||(Jm=!0,t.beginQuery(r.TIME_ELAPSED_EXT,i))},()=>{t.endQuery(r.TIME_ELAPSED_EXT),Jm=!1},i=>r.queryCounterEXT(i,r.TIMESTAMP_EXT),()=>t.getQuery(r.TIMESTAMP_EXT,r.QUERY_COUNTER_BITS_EXT)):(r=t.getExtension("EXT_disjoint_timer_query"),r?new Nue(()=>r.createQueryEXT(),i=>{r.deleteQueryEXT(i),Jm=!1},i=>r.getQueryObjectEXT(i,r.QUERY_RESULT_AVAILABLE_EXT),i=>r.getQueryObjectEXT(i,r.QUERY_RESULT_EXT),()=>t.getParameter(r.GPU_DISJOINT_EXT),i=>{Jm||(Jm=!0,r.beginQueryEXT(r.TIME_ELAPSED_EXT,i))},()=>{r.endQueryEXT(r.TIME_ELAPSED_EXT),Jm=!1},i=>r.queryCounterEXT(i,r.TIMESTAMP_EXT),()=>r.getQueryEXT(r.TIMESTAMP_EXT,r.QUERY_COUNTER_BITS_EXT)):null)}function iwt(t,e){const r=t.capabilities.disjointTimerQuery;return r==null?null:new swt(r,e)}let swt=class{constructor(e,r){this._timer=e,this._queryPool=new Array,this._queryResults=new Map,this._currentQuery=null,r.forEach(i=>{const s=this._timer.createQuery(),n=this._timer.createQuery();this._queryPool.push(s,n),this._queryResults.set(i,null)})}start(){Jm||(this._currentQuery=this._queryPool.pop(),this._currentQuery!=null&&(this._timer.disjoint(),this._timer.beginTimeElapsed(this._currentQuery)))}stop(e){if(this._timer.disjoint()||this._currentQuery==null||!this._queryResults.has(e))return this.abort(),null;this._timer.endTimeElapsed();const r=this._queryResults.get(e);if(r==null)return this._queryResults.set(e,this._currentQuery),this._currentQuery=null,null;if(!this._timer.resultAvailable(r))return this._queryPool.unshift(this._currentQuery),this._currentQuery=null,null;const i=this._timer.getResult(r)/1e6;return this._queryPool.unshift(r),this._queryResults.set(e,this._currentQuery),this._currentQuery=null,i}abort(){this._currentQuery!=null&&(this._timer.deleteQuery(this._currentQuery),this._queryPool.unshift(this._timer.createQuery()),this._currentQuery=null)}dispose(){this._currentQuery!=null&&this._timer.deleteQuery(this._currentQuery),this._queryPool.forEach(e=>{this._timer.deleteQuery(e)}),this._queryResults.forEach(e=>{e!=null&&this._timer.deleteQuery(e)})}};var vi;(function(t){t.OVERLAY="overlay",t.PREPARE="prepare",t.SHADOW_MAP="shadow map",t.LINEAR_DEPTH="linear depth",t.ACCUMULATED_SHADOWS="accumulated shadows",t.NORMALS="normals",t.OBJECT_AND_LAYER_ID_COLOR="object/layer id color",t.SSAO="SSAO",t.OPAQUE="opaque",t.OPAQUE_EDGES="opaque edges",t.VOXEL="voxel",t.TRANSPARENT="transparent",t.TRANSPARENT_EDGES="transparent edges",t.HUD_VISIBILITY="HUD visibility",t.TRANSPARENT_TERRAIN="transparent terrain",t.ENVIRONMENT="environment",t.LASER_LINE="laser line",t.OCCLUDED="occluded",t.ANTIALIASING="antialiasing",t.HIGHLIGHTS="highlights",t.HUD="HUD",t.HUD_OCCLUDED="HUD occluded",t.FINISH="finish"})(vi||(vi={}));const Fue="Total";let nwt=class{constructor(e){this._rctx=e,this._startTimeStampCPU=0,this._lastTimeStampCPU=0,this._totalCPUTime=new pg(Fue),this._cpuTimeSamplers=new Map(Object.values(vi).map(r=>[r,new pg(r)])),this._enableGPUTimer=0,this._totalGPUTime=new pg("GPU"),this._gpuTimeSamplers=new Map(Object.values(vi).map(r=>[r,new pg(r)])),this._totalTime=0,this._totalFrameCount=0}get totalCPUTimeSampler(){return this._totalCPUTime}get cpuTimeSamplers(){return Array.from(this._cpuTimeSamplers.values())}get totalGPUTimeSampler(){return this._totalGPUTime}get gpuTimeSamplers(){return Array.from(this._gpuTimeSamplers.values())}get gpuSamplingEnabled(){return this._gpuTimerPool!=null}get totalTime(){return this._totalTime}get totalFrameCount(){return this._totalFrameCount}get elapsedTime(){return performance.now()-this._startTimeStampCPU}enableGPUPerformanceInfo(){if(this._gpuTimerPool==null){const e=[...Object.values(vi),Fue];this._gpuTimerPool=iwt(this._rctx,e)}return this._gpuTimerPool==null?{hasGPUTimerSupport:!1,remove:()=>{}}:(++this._enableGPUTimer,{hasGPUTimerSupport:!0,remove:Dq(()=>{--this._enableGPUTimer,this._enableGPUTimer===0&&(this._gpuTimerPool=Ue(this._gpuTimerPool))})})}startFrame(){this._startTimeStampCPU=this._lastTimeStampCPU=performance.now(),this._gpuTimerPool!=null&&this._gpuTimerPool.start()}advance(e){const r=performance.now();if(this._cpuTimeSamplers.get(e).record(r-this._lastTimeStampCPU),this._lastTimeStampCPU=r,this._gpuTimerPool!=null){const i=this._gpuTimerPool.stop(e);this._gpuTimeSamplers.get(e).record(i),this._gpuTimerPool.start()}}finishFrame(){if(this._gpuTimerPool!=null){const r=this._gpuTimerPool.stop(vi.FINISH);this._gpuTimeSamplers.get(vi.FINISH).record(r)}const e=performance.now()-this._startTimeStampCPU;this._totalTime=this._totalTime+e,this._totalCPUTime.record(e),this._gpuTimerPool!=null&&this._totalGPUTime.record(this.gpuTimeSamplers.reduce((r,i)=>r+(i.last||0),0)),++this._totalFrameCount}},ql=class extends Te{get _bindParameters(){return this._renderContext.bindParameters}updateRenderFeature(t=null,e=!oe("disable-feature:high-quality-idle")){this._renderStateFeatures=Xie(e,t),this.notifyChange("_renderStateFeatures"),this._requestRender()}isFeatureEnabled(t,e=this._state){return this._renderStateFeatures?.get(e,t)??!1}setFeatureEnabled(t,e,r){this._renderStateFeatures?.set(e,t,r),this.notifyChange("_renderStateFeatures"),this._requestRender()}get _antialiasing(){return this._antialiasingEnabled||this.isFeatureEnabled(Hs.Antialiasing)}get _highQualityTransparency(){return this._highQualityTransparencyEnabled||this.isFeatureEnabled(Hs.HighQualityTransparency)}get hasReflections(){return this.hasWater&&(this._ssrEnabled||this.isFeatureEnabled(Hs.WaterReflection))}get hasWater(){return this._hasWater||this._hasOverlayWater}constructor(t,e,r,i,s,n,o,a){super({}),this._stage=t,this._materialRepository=e,this._techniqueRepository=i,this._rctx=s,this._compositingHelper=n,this._magnifierHelper=o,this._requestRender=a,this._materialRenderers=new kt,this._needsTransparentPass=!1,this._hasHUDElements=!1,this._hasHighlights=!1,this._hasWater=!1,this._hasOverlayWater=!1,this._renderOverlay=l=>{},this._isRendering=!1,this._fallbackDepthStencilTexture=null,this._sliceHelper=new mbt,this._state=$r.IDLE,this._renderStateFeatures=null,this._antialiasingEnabled=!0,this._highQualityTransparencyEnabled=!0,this._terrainRenderingEnabled=!0,this._terrainTransparency=wn.Opaque,this._ssrEnabled=!1,this._ssaoEnabled=!1,this._hasAnimations=!1,this._animationTimestep=new A1t,this._handles=new Oi,this._renderHiddenTransparentEdges=()=>{},this._oitUsed=!1,this.updateRenderFeature(t.view.qualityProfile),this._smaaPass=new h3(this._rctx,i),a(),this._offscreen=new W1t(this._rctx,this._compositingHelper),this.performanceInfo=new nwt(this._rctx),this._shadowMap=new QY(this._rctx,t.viewingMode),this._ssaoHelper=new zEe(t.view,i,this._rctx,a),this._highlight=new G1t(i,this._rctx),this._shadowHighlight=new fbt(this._rctx,t.viewingMode),this._shadowAccumulator=new dl(this._rctx,i,t,l=>{const c=this.shadowsEnabled;this._shadowMap.enabled=!0,this._prepare(l.camera,l.contentCamera),this._renderPlugins.prepareRender(),this._shadowMap.enabled=c},(l,c,h)=>{l.shadowMap.start(l.camera,c,h,!0,this._stage.view.qualitySettings.maximumPixelRatio),this._renderShadowCascades(N.Shadow,l.shadowMap),l.camera.setGLViewport(this._rctx),this._prepare(l.camera,l.contentCamera)},a),this._renderContext=new Rlt(this._rctx,this._offscreen,this._shadowMap,this._ssaoHelper,this._sliceHelper),this._renderPlugins=new u3({renderContext:this._renderContext,techniqueRepository:i,textureRepository:r,materialRepository:this._materialRepository,requestRender:a,controller:t}),this.renderPassManager=new C1t(this._rctx,this._techniqueRepository),this._renderPlugins.add(this.renderPassManager.slots(),this.renderPassManager),this._handles.add([le(()=>this._stage.view.state.camera,()=>a(),As),le(()=>ni.EDGES_SHOW_HIDDEN_TRANSPARENT_EDGES,l=>{this._renderHiddenTransparentEdges=l?()=>this._renderEdges(Bt.TRANSPARENT):()=>{},a()},Vr),le(()=>this._ssaoEnabled||this.isFeatureEnabled(Hs.SSAO),l=>this._ssaoHelper.enabled=l,As)])}normalizeCtorArgs(){return{}}destroy(){this._handles.destroy(),this._smaaPass.dispose(),this._gpuTimerHandle=Ii(this._gpuTimerHandle),this._materialRenderers.forAll(t=>t.dispose()),this._materialRenderers.clear(),this._offscreen.dispose(),this._fallbackDepthStencilTexture=Ue(this._fallbackDepthStencilTexture),this._shadowMap.dispose(),this._ssaoHelper.destroy(),this._highlight.dispose(),this._shadowHighlight.dispose(),this._shadowAccumulator.dispose(),this._edgeView=Me(this._edgeView),this.renderPassManager.destroy(),Mxe.prune()}disposeOffscreenBuffers(){this._offscreen.dispose(),this._shadowMap.disposeOffscreenBuffers(),this._smaaPass.disable(),this._ssaoHelper.disposeOffscreenBuffers()}get updating(){return this._antialiasing&&this._smaaPass.updating||this._edgeView!=null&&this._edgeView.updating||this._shadowAccumulator.running||this._renderPlugins.updating||!this.isCameraFinal}ensureEdgeView(){if(this._edgeView==null){const t=this._stage.view.resourceController;this._edgeView=new Sd({rctx:this._rctx,renderSR:this._stage.view.renderSpatialReference,viewingMode:this._stage.viewingMode,techniqueRepository:this._techniqueRepository,setNeedsRender:()=>this._requestRender(),schedule:owt(t)}),this._handles.add(le(()=>uc(this._edgeView,e=>e.updating),()=>this._requestRender(),jr)),this._requestRender()}return this._edgeView}get edgeView(){return this._edgeView}get isCameraFinal(){return yZ(this._bindParameters.ssr.reprojectionMatrix,un)}set _reprojectionMatrix(t){oq(this._bindParameters.ssr.reprojectionMatrix,t)&&this.notifyChange("isCameraFinal")}get shadowsEnabled(){return!!this._shadowMap?.enabled}setParameters(t){const{_shadowMap:e,_bindParameters:r}=this;if(t.qualitySettings?.reflections!==void 0&&this._ssrEnabled!==t.qualitySettings.reflections&&(this._ssrEnabled=t.qualitySettings.reflections,this._requestRender()),t.qualitySettings?.ambientOcclusion!==void 0&&this._ssaoEnabled!==t.qualitySettings.ambientOcclusion&&(this._ssaoEnabled=t.qualitySettings.ambientOcclusion,this._requestRender()),t.shadowMap!==void 0&&this._shadowMap.enabled!==t.shadowMap&&(this._shadowMap.enabled=t.shadowMap,this._requestRender()),t.shadowMapMaxCascades!==void 0&&e.maxCascades!==t.shadowMapMaxCascades&&(e.maxCascades=t.shadowMapMaxCascades,this._requestRender()),t.environment!=null){t.environment.weather!=null&&(this._bindParameters.weather=t.environment.weather,this._bindParameters.weatherVisible=!!t.weatherVisible);const i=t.environment.lighting.type!=="virtual";r.enableFillLights!==i&&(r.enableFillLights=i,this._requestRender())}t.background&&this._offscreen.background!==t.background&&(this._offscreen.background=t.background,this._requestRender()),t.antialiasingEnabled!==void 0&&this._antialiasingEnabled!==t.antialiasingEnabled&&(this._antialiasingEnabled=t.antialiasingEnabled,this._requestRender()),t.highQualityTransparency!==void 0&&this._highQualityTransparencyEnabled!==t.highQualityTransparency&&(this._highQualityTransparencyEnabled=t.highQualityTransparency,this._requestRender()),t.defaultHighlightOptions!==void 0&&(this._highlight.setDefaultOptions(t.defaultHighlightOptions),this._shadowHighlight.setDefaultOptions(t.defaultHighlightOptions),this._requestRender()),t.overlays!==void 0&&this._bindParameters.overlays!==t.overlays&&(this._bindParameters.overlays=t.overlays,this._requestRender()),t.hasOverlayWater!==void 0&&this._hasOverlayWater!==t.hasOverlayWater&&(this._hasOverlayWater=t.hasOverlayWater,this._requestRender()),t.renderOverlay!==void 0&&this._renderOverlay!==t.renderOverlay&&(this._renderOverlay=t.renderOverlay,this._requestRender()),t.slicePlane!==void 0&&this._sliceHelper.plane!==t.slicePlane&&(this._sliceHelper.plane=t.slicePlane,this._requestRender()),t.terrainRenderingEnabled!==void 0&&this._terrainRenderingEnabled!==t.terrainRenderingEnabled&&(this._terrainRenderingEnabled=t.terrainRenderingEnabled,this._requestRender()),t.terrainTransparency!==void 0&&this._terrainTransparency!==t.terrainTransparency&&(this._terrainTransparency=t.terrainTransparency,this._requestRender()),t.shadowCastOptions!==void 0&&this._shadowAccumulator.setOptions(t.shadowCastOptions)}get hasSlicePlane(){return!!this._sliceHelper.plane}get renderPlugins(){return this._renderPlugins}get _hasOITSupport(){return this._rctx.driverTest.floatBufferBlend.result}get _oitEnabled(){return this._highQualityTransparency&&this._hasOITSupport}modify(t,e){this._isRendering&&console.warn("Renderer.modify called while rendering");const{adds:r,removes:i,updates:s}=t;if(r.length===0&&i.length===0&&s.length===0)return;const n=SEe(t);let o=!1;n.forEach((a,l)=>{if(e.done)return;let c=this._materialRenderers.find(h=>h.material===l);c==null&&a.adds.length>0&&(c=new LEe(this._rctx,this._materialRepository,l),this._materialRenderers.push(c)),c&&(c.modify(a),c.isEmpty&&(o=!0)),a.removes.forEach(h=>t.removes.removeUnordered(h)),a.adds.forEach(h=>t.adds.removeUnordered(h)),a.updates.forEach(h=>t.updates.removeUnordered(h)),e.madeProgress()}),o&&this._materialRenderers.filterInPlace(a=>!a.isEmpty||(a.dispose(),!1)),this._hasHighlights=this._materialRenderers.some(a=>a.hasHighlights),this._bindParameters.hasOccludees=this._materialRenderers.some(a=>a.hasOccludees),this._hasWater=this._materialRenderers.some(a=>a.hasWater),this._hasHUDElements=this._materialRenderers.some(a=>a.requiresSlot(ue.LINE_CALLOUTS_HUD_DEPTH,N.Color)||a.requiresSlot(ue.HUD_MATERIAL,N.Color)||a.requiresSlot(ue.LABEL_MATERIAL,N.Color)),this._requestRender()}updateAnimation(t){const e=this._hasAnimations;return this._hasAnimations=!1,this._materialRenderers.forAll(r=>this._hasAnimations=r.updateAnimation(t)||this._hasAnimations),this._hasAnimations=this._renderPlugins.updateAnimation(t)||this._hasAnimations,this._hasAnimations!==e&&(this._gpuTimerHandle=e?Ii(this._gpuTimerHandle):this.performanceInfo.enableGPUPerformanceInfo()),this._hasAnimations}get animationTimestep(){return this._animationTimestep.value}get animationTimeDilation(){return this._animationTimestep.timeDilation}resetAnimation(){this._animationTimestep.clear()}render(t,e,r,i,s){this._isRendering=!0,this._oitUsed=!1,this.performanceInfo.startFrame();const{camera:n,contentCamera:o,mode:a,alignPixelEnabled:l}=r;this._state=a,this._renderOverlay(s),this.performanceInfo.advance(vi.OVERLAY),this._renderContext.time=s,this._bindParameters.transparencyPassType=ot.NONE,this._bindParameters.alignPixelEnabled=l;const c=this._offscreen;c.setupRenderTarget(this.hasReflections);const h=Yg(this._sliceHelper.plane);i===aw.OFF&&(this._sliceHelper.plane=null),this._rctx.bindFramebuffer(t),n.setGLViewport(this._rctx),this._prepare(n,o),this._renderPlugins.prepareRender(),this.performanceInfo.advance(vi.PREPARE);const p=this._computeDepthRange(n);this._renderShadowMap(t,n,this._bindParameters.lighting.mainLight.direction,p),this.performanceInfo.advance(vi.SHADOW_MAP),c.initializeFrame(n),this._ensureBindParameters(n,o);const f=this._terrainRenderingEnabled&&(this._terrainTransparency===wn.Semitransparent||this._terrainTransparency===wn.TransparentWithDraped),m=this._highQualityTransparency&&f,y=this._needsTransparentPass||this._renderPlugins.needsTransparentPass;this._prepareShaders(m,y),this._renderLinearDepth(),this.performanceInfo.advance(vi.LINEAR_DEPTH),this._accumulateShadows(p,n,o),this.performanceInfo.advance(vi.ACCUMULATED_SHADOWS),this._renderNormal(),this.performanceInfo.advance(vi.NORMALS),this._ensureBindParametersSSR(s),this._renderSSAO(s),this.performanceInfo.advance(vi.SSAO),this._renderContext.output=N.Color,c.bindFramebuffer(),this._renderOpaqueGeometry(),this.performanceInfo.advance(vi.OPAQUE),this._renderTerrainLinearDepth(m),this._setMultipassTerrain(m),this._renderEdges(Bt.OPAQUE),this.performanceInfo.advance(vi.OPAQUE_EDGES),this._offscreen.bindTarget(this._offscreen.currentColorTarget,this._offscreen.mainDepth),this._renderSlot(ue.VOXEL),this.performanceInfo.advance(vi.VOXEL),this._renderHiddenTransparentEdges(),y&&(this._oitEnabled?this._renderOITPass(gS.Geometry):this._renderTransparentGeometry()),this.performanceInfo.advance(vi.TRANSPARENT),this._renderGeometryLinearDepth(m);const _=this._renderHUDVisibility(m);m||this._renderInternalSlot(ue.LINE_CALLOUTS),this.performanceInfo.advance(vi.HUD_VISIBILITY),this._renderObjectAndLayerIdColor(e),this.performanceInfo.advance(vi.OBJECT_AND_LAYER_ID_COLOR),this._renderEdges(Bt.TRANSPARENT,m),this.performanceInfo.advance(vi.TRANSPARENT_EDGES),this._renderTransparentTerrain(),f&&_&&(m?this._renderLineCallouts(Jl.Occluded):c.compositeTransparentTerrainOntoHUDVisibility(this._bindParameters),this._renderHUD(Jl.Occluded,c.framebuffer),this.performanceInfo.advance(vi.HUD_OCCLUDED)),this.performanceInfo.advance(vi.TRANSPARENT_TERRAIN),this._setTerrainCulling(!1),f&&(c.compositeTransparentTerrainOntoMain(this._bindParameters),m&&(this._renderEdges(Bt.OPAQUE),this.performanceInfo.advance(vi.OPAQUE_EDGES),y&&(this._oitEnabled?this._renderOITPass(gS.Geometry):this._renderTransparentGeometry()),this.performanceInfo.advance(vi.TRANSPARENT),this._renderEdges(Bt.TRANSPARENT),this.performanceInfo.advance(vi.TRANSPARENT_EDGES))),m&&this._renderLineCallouts(Jl.NotOccluded),this._setMultipassEnabled(!1),this._shadowAccumulator.render(this._bindParameters),c.renderToTargets(()=>{this._renderInternalSlot(ue.TRANSPARENT_DEPTH_WRITE_DISABLED_MATERIAL),this._renderSlot(ue.POSTPROCESSING_ENVIRONMENT_TRANSPARENT),this._renderSlot(ue.LASERLINES)},c.currentColorTarget,c.mainDepth),this.performanceInfo.advance(vi.ENVIRONMENT),this._renderPlugins.needsLaserlineWithContrastControl&&c.renderTmpAndCompositeToMain(()=>this._renderSlot(ue.LASERLINES_CONTRAST_CONTROL),this._bindParameters,oa.PremultipliedAlpha),this.performanceInfo.advance(vi.LASER_LINE),this._renderOccluded(),this.performanceInfo.advance(vi.OCCLUDED);const v=i===aw.ON&&this._magnifierHelper.enabled,w=v&&t==null?this._offscreen.getFramebuffer(this._offscreen.tmpColor,this._offscreen.tmpDepth):t;this._rctx.bindFramebuffer(w);const x=this._offscreen.colorTexture;this._renderAntiAliasing(x)||x==null||this._compositingHelper.composite(this._bindParameters,x,oa.None),this.performanceInfo.advance(vi.ANTIALIASING),this._renderHUD(Jl.NotOccluded,w),this.performanceInfo.advance(vi.HUD),this._renderHighlights(w,this._bindParameters),this.performanceInfo.advance(vi.HIGHLIGHTS),v&&this._magnifierHelper.render(this._rctx,this._bindParameters),w!==t&&(this._rctx.bindFramebuffer(t),this._compositingHelper.composite(this._bindParameters,this._offscreen.tmpColorTexture,oa.None)),this._disposeOITBuffers(),this._renderContext.lastFrameCamera.copyFrom(this._bindParameters.camera),this._sliceHelper.plane=h,this._isRendering=!1,this.onPostRender&&this.onPostRender(),this.performanceInfo.finishFrame()}_prepareShaders(t,e){this._renderContext.output=N.Color,this._prepareOpaqueGeometrySlots(),this._setMultipassTerrain(t),this._prepareSlots(ue.TRANSPARENT_TERRAIN),this._setMultipassTerrain(!1),t||this._prepareInternalSlots(this._materialRenderers,ue.LINE_CALLOUTS),e&&this._prepareTransparencySlots(),this._prepareInternalSlots(this._materialRenderers,ue.TRANSPARENT_DEPTH_WRITE_DISABLED_MATERIAL),this._prepareSlots(ue.POSTPROCESSING_ENVIRONMENT_TRANSPARENT,ue.LASERLINES),this._rctx.gl.flush()}_renderObjectAndLayerIdColor(t){if(t!=null&&oe("enable-feature:objectAndLayerId-rendering")){const e=this._renderContext.output;this._rctx.bindFramebuffer(t),this._offscreen.renderToFBO(()=>this._renderGeometryAndTransparentTerrainPass(N.ObjectAndLayerIdColor),[0,0,0,0],!0,!0),this._rctx.bindFramebuffer(t),this._offscreen.renderToFBO(()=>{this._bindParameters.renderTransparentlyOccludedHUD=Jl.NotOccluded,this._renderInternalSlot(ue.HUD_MATERIAL)},void 0,!0,!0),this._renderContext.output=e}}finish(t){this._hasAnimations||this._animationTimestep.clear();const e=this.performanceInfo.gpuSamplingEnabled,r=t===ds.BACKGROUND;if(r||e){const i=r?this.performanceInfo.elapsedTime:0,s=e?this.performanceInfo.totalGPUTimeSampler.last:this._rctx.gl.getError(),n=Math.max(i,s);this._animationTimestep.frame(n,r)}}readDepthPixels(t,e,r){const i=this._offscreen.bindTarget(this._offscreen.linearDepth,this._offscreen.tmpDepth);if(!this._needsLinearDepth){this._ensureBindParameters(t,t),this._bindParameters.camera.setGLViewport(this._rctx),this._rctx.setClearColor(0,0,0,0);const s=wi.COLOR_BUFFER_BIT|wi.DEPTH_BUFFER_BIT|wi.STENCIL_BUFFER_BIT;this._rctx.clearSafe(s),this._renderGeometryAndTransparentTerrainPass(N.Depth)}i.readPixels(e[0],e[1],e[2],e[3],Tt.RGBA,ks.UNSIGNED_BYTE,r)}readHUDVisibility(t,e,r,i,s){this._offscreen.bindTarget(this._offscreen.hudVisibility).readPixels(t,e,r,i,Tt.RGBA,ks.UNSIGNED_BYTE,s)}readAccumulatedShadow(t){return this._shadowAccumulator.readAccumulatedShadow(t[0],t[1])}_setMultipassTerrain(t){this._setMultipassEnabled(t),this._setTerrainCulling(t)}_setMultipassEnabled(t){this._bindParameters.multipassTerrain.enabled=this._bindParameters.multipassGeometry.enabled=t}_setTerrainCulling(t){this._bindParameters.multipassTerrain.cullAboveGround=t}_prepareSlots(...t){this._renderPlugins.prepareSlots(t)}_renderSlot(t){this._bindParameters.slot=t,this._renderPlugins.render()}_renderEdges(t,e=!1){const r=this._edgeView;r!=null&&r.shouldRender()&&this._offscreen.renderTmpAndCompositeToMain(()=>r.render(this._bindParameters,t),this._bindParameters,oa.Alpha,e)}_renderShadowMap(t,e,r,i){const s=this._shadowMap;s.enabled&&(s.start(e,r,i,this.isFeatureEnabled(Hs.HighResolutionShadows),this._stage.view.qualitySettings.maximumPixelRatio),this._shadowHighlight.updateParameters(e,r),this._needsShadowHighlight?(this._renderShadowCascades(N.ShadowHighlight,this._shadowMap,n=>s.takeCascadeSnapshotTo(n,U2.Highlight)),s.clear(),this._renderShadowCascades(N.ShadowExcludeHighlight,this._shadowMap,n=>{s.takeCascadeSnapshotTo(n,U2.Default),this._renderGeometryAndTransparentTerrainPass(N.ShadowHighlight)})):this._renderShadowCascades(N.Shadow),s.finish(t),e.setGLViewport(this._rctx))}_renderShadowCascades(t,e=this._shadowMap,r=i=>{}){for(const i of e.cascades)i.camera.setGLViewport(this._rctx),this._prepare(i.camera,i.camera),this._renderGeometryAndTransparentTerrainPass(t),r(i)}get _needsLinearDepth(){return this._ssaoHelper.active||this._renderPlugins.needsLinearDepth||this.hasReflections||this._needsShadowHighlight||this._needsShadowCast}_renderLinearDepth(){this._needsLinearDepth?this._offscreen.renderToTargets(()=>this._renderGeometryAndTransparentTerrainPass(N.Depth),this._offscreen.linearDepth,this._offscreen.tmpDepth,[0,0,0,0],!0,!0):this._offscreen.disposeTarget(this._offscreen.linearDepth),this._bindParameters.linearDepthTexture=this._offscreen.linearDepthTexture}_renderTerrainLinearDepth(t){if(t){const e=this._renderContext.output;this._renderContext.output=N.Depth,this._offscreen.renderToTargets(()=>this._renderTransparentTerrain(),this._offscreen.terrainLinearDepth,this._offscreen.tmpDepth,[-1e10,-1e10,-1e10,1],!0,!0),this._renderContext.output=e}else this._offscreen.disposeTarget(this._offscreen.terrainLinearDepth);this._bindParameters.multipassTerrain.linearDepthTexture=this._offscreen.terrainLinearDepthTexture}_renderGeometryLinearDepth(t){if(t){const e=this._renderContext.output;this._offscreen.renderToTargets(()=>this._renderGeometryPass(N.Depth),this._offscreen.geometryLinearDepth,this._offscreen.tmpDepth,[1,1,1,1],!0,!0),this._renderContext.output=e}else this._offscreen.disposeTarget(this._offscreen.geometryLinearDepth);this._bindParameters.multipassGeometry.linearDepthTexture=this._offscreen.geometryLinearDepthTexture}get _needsNormal(){return this._ssaoHelper.active}_renderNormal(){this._needsNormal?this._offscreen.renderToTargets(()=>{this._renderGeometryAndTransparentTerrainPass(N.Normal)},this._offscreen.normal,this._offscreen.tmpDepth,[0,0,0,0],!0,!0):this._offscreen.disposeTarget(this._offscreen.normal)}get _needsDepthRange(){return this._shadowMap.enabled||this._needsShadowCast}_computeDepthRange(t){if(!this._needsDepthRange)return XH;const e=c1t(t,this._materialRenderers,this._stage.layers);return z2(e,this.renderPlugins.queryDepthRange(t)),e.near=Math.max(t.near,e.near),e.far=Math.min(t.far,e.far),e}_renderGeometryAndTransparentTerrainPass(t){this._renderContext.output=t,this._prepareSlots(ue.TRANSPARENT_TERRAIN),this._renderGeometryPass(t),this._renderTransparentTerrain()}_renderGeometryPass(t){this._renderContext.output=t,this._prepareSlots(ue.TRANSPARENT_MATERIAL),this._renderOpaqueGeometry(),this._renderTransparentGeometry()}_renderSSAO(t){this._ssaoHelper.render(this._bindParameters,t,this._offscreen.linearDepthTexture,this._offscreen.normalTexture)}_prepareOpaqueGeometrySlots(){this._prepareSlots(ue.INTEGRATED_MESH,ue.OPAQUE_TERRAIN,ue.OPAQUE_MATERIAL,ue.POSTPROCESSING_ENVIRONMENT_OPAQUE),this._prepareInternalSlots(this._materialRenderers,ue.OPAQUE_MATERIAL)}_renderOpaqueGeometry(){this._renderSlot(ue.INTEGRATED_MESH),this._renderSlot(ue.OPAQUE_TERRAIN),this._renderInternalSlot(ue.OPAQUE_MATERIAL),this._renderSlot(ue.OPAQUE_MATERIAL),this._renderSlot(ue.POSTPROCESSING_ENVIRONMENT_OPAQUE)}_renderTransparentGeometry(){this._renderInternalSlot(ue.TRANSPARENT_MATERIAL),this._renderSlot(ue.TRANSPARENT_MATERIAL)}_renderTransparentTerrain(){this._renderSlot(ue.TRANSPARENT_TERRAIN)}_renderHUDVisibility(t){let e=!1;return this._renderContext.offscreenRenderingHelper&&this._renderContext.offscreenRenderingHelper.renderHUDVisibility(()=>{this._bindParameters.hudVisibilityTexture=this._renderContext.offscreenRenderingHelper.hudVisibilityTexture,e=this._renderInternalSlot(ue.OCCLUSION_PIXELS)},t),e}_renderLineCallouts(t){this._bindParameters.renderTransparentlyOccludedHUD=t,t===Jl.Occluded?this._offscreen.renderToTargets(()=>this._renderInternalSlot(ue.LINE_CALLOUTS),this._offscreen.currentColorTarget,this._offscreen.tmpDepth,void 0,!0,!0):this._renderInternalSlot(ue.LINE_CALLOUTS)}_renderHUD(t,e){this._hasHUDElements&&(this._oitEnabled?(this._renderOITPass(gS.HUD,t),this._rctx.bindFramebuffer(e),this._compositingHelper.composite(this._bindParameters,this._offscreen.hudColorTexture,oa.PremultipliedAlpha)):t===Jl.Occluded?this._offscreen.renderToTargets(()=>this._renderHUDElements(Jl.Occluded),this._offscreen.currentColorTarget,this._offscreen.tmpDepth,void 0,!0,!0):this._renderHUDElements(t))}_renderHUDElements(t){this._bindParameters.renderTransparentlyOccludedHUD=t,this._prepareInternalSlots(this._materialRenderers,ue.LINE_CALLOUTS_HUD_DEPTH,ue.HUD_MATERIAL,ue.LABEL_MATERIAL),this._renderInternalSlot(ue.LINE_CALLOUTS_HUD_DEPTH),this._renderInternalSlot(ue.HUD_MATERIAL),this._renderInternalSlot(ue.LABEL_MATERIAL)}get _needsHighlight(){return this._hasHighlights||this._renderPlugins.needsHighlight}get _needsShadowHighlight(){return this._shadowMap.enabled&&this._shadowHighlight.isVisible&&this._needsHighlight}_renderHighlights(t,e){if(!this._needsHighlight)return void this._offscreen.disposeTarget(this._offscreen.highlight);const r=this._highlight,i=this._offscreen.renderToTargets(()=>{this._renderGeometryAndTransparentTerrainPass(N.Highlight),this._rctx.clearSafe(wi.DEPTH_BUFFER_BIT),this._renderHUDElements(Jl.Both)},this._offscreen.highlight,this._offscreen.tmpDepth,[0,0,0,0],!0,!0);this._bindParameters.highlightColorTexture=i.colorTexture,this._needsShadowHighlight&&this._shadowHighlight.render(e,t),r.render(this._bindParameters,i,t)}get _needsShadowCast(){return this._shadowAccumulator.isAccumulating}_accumulateShadows(t,e,r){this._needsShadowCast&&this._offscreen.linearDepthTexture!=null&&this._shadowAccumulator.renderAccumulation(this._offscreen.linearDepthTexture,t,e,r)}_prepareTransparencySlots(){this._renderContext.output=N.Alpha,this._bindParameters.transparencyPassType=ot.Alpha,this._prepareInternalSlots(this._materialRenderers,ue.TRANSPARENT_MATERIAL),this._prepareSlots(ue.TRANSPARENT_MATERIAL),this._renderContext.output=N.Color,this._bindParameters.transparencyPassType=ot.Color,this._prepareInternalSlots(this._materialRenderers,ue.TRANSPARENT_MATERIAL),this._prepareSlots(ue.TRANSPARENT_MATERIAL),this._bindParameters.transparencyPassType=ot.FrontFace,this._prepareInternalSlots(this._materialRenderers,ue.TRANSPARENT_MATERIAL),this._prepareSlots(ue.TRANSPARENT_MATERIAL),this._bindParameters.transparencyPassType=ot.NONE}_renderOITPass(t,e=Jl.Both){const r=t===gS.HUD,i=r?()=>this._renderHUDElements(e):()=>this._renderTransparentGeometry(),s=o=>{this._bindParameters.transparencyPassType=o,this._offscreen.renderOITPass(i,o,r)},n=this._renderContext.output;this._renderContext.output=N.Alpha,s(ot.Alpha),this._renderContext.output=N.Color,s(ot.Color),s(ot.FrontFace),this._offscreen.compositeTransparentOntoOpaque(this._bindParameters,r),this._bindParameters.transparencyPassType=ot.NONE,this._renderContext.output=n,this._oitUsed=!0}_disposeOITBuffers(){this._oitUsed||(this._offscreen.disposeTarget(this._offscreen.alphaFloatTarget),this._offscreen.disposeTarget(this._offscreen.colorFloatTarget),this._offscreen.disposeTarget(this._offscreen.frontFaceTarget))}_renderOccluded(){let t=0;Nc.clear(),this._materialRenderers.forAll(n=>{n.material&&n.material.isVisible()&&n.material.renderOccluded===Mi.OccludeAndTransparentStencil&&(t|=n.material.renderOccluded,Nc.push(n))});const e=this._offscreen,r=(n,o,a,l,c)=>{t&o&&(e.renderToTargets(a,e.tmpColor,e.mainDepth,[0,0,0,0],l,c),e.compositeOccludedOntoMain(this._bindParameters,n))};Nc.length!==0&&(this._prepareInternalSlots(Nc,ue.OCCLUDER_MATERIAL,ue.TRANSPARENT_OCCLUDER_MATERIAL),this._renderInternalSlot(ue.OCCLUDER_MATERIAL,Nc),r(.5,Mi.OccludeAndTransparentStencil,()=>this._renderInternalSlot(ue.TRANSPARENT_OCCLUDER_MATERIAL,Nc),!1,!1)),Nc.clear(),this._materialRenderers.forAll(n=>{n.material&&n.material.isVisible()&&(n.material.renderOccluded===Mi.OccludeAndTransparent||n.material.renderOccluded===Mi.Transparent||n.material.renderOccluded===Mi.Opaque)&&(t|=n.material.renderOccluded,Nc.push(n))});const i=this._renderPlugins.renderOccludedFlags;if(t|=i,!t)return;const s=n=>{this._renderContext.renderOccludedMask=n,this._prepareInternalSlots(Nc,ue.OPAQUE_MATERIAL,ue.TRANSPARENT_MATERIAL,ue.TRANSPARENT_DEPTH_WRITE_DISABLED_MATERIAL),i>Mi.Occlude&&this._renderSlot(ue.OCCLUDED_TERRAIN),this._renderInternalSlot(ue.OPAQUE_MATERIAL,Nc),this._renderInternalSlot(ue.TRANSPARENT_MATERIAL,Nc),this._renderInternalSlot(ue.TRANSPARENT_DEPTH_WRITE_DISABLED_MATERIAL,Nc),this._renderContext.resetRenderOccludedMask()};this._renderContext.output=N.Color,r(.5,Mi.OccludeAndTransparent,()=>s(Mi.OccludeAndTransparent),!0,Sl.OutlineVisualElementMask),r(.5,Mi.Transparent,()=>s(Mi.Transparent),!0,Sl.OutlineVisualElementMask),r(1,Mi.Opaque,()=>s(Mi.Opaque),!0,Sl.OutlineVisualElementMask),Nc.clear()}_renderAntiAliasing(t){if(this._antialiasing){if(this._smaaPass.enable(()=>this._requestRender())&&t!=null)return this._smaaPass.render(t),!0}else this._smaaPass.disable();return!1}_prepare(t,e){this._needsTransparentPass=this._materialRenderers.some(r=>r.requiresSlot(ue.TRANSPARENT_MATERIAL,N.Color)),this._bindParameters.camera=t,this._bindParameters.contentCamera=e}_ensureBindParameters(t,e){this._bindParameters.camera=t,this._bindParameters.contentCamera=e;const r=this._renderContext.offscreenRenderingHelper;this._bindParameters.hudVisibilityTexture=r.hudVisibilityTexture,this._bindParameters.mainColorTexture=r.mainColorTexture,this._bindParameters.highlightDepthTexture=r.depthTexture??this._getFallbackDepthTexture()}_ensureBindParametersSSR(t){if(this._bindParameters.ssr.enabled=this.hasReflections,this._bindParameters.ssr.enabled){this._ssrEnableTime==null&&(this._ssrEnableTime=t),this._renderContext.lastFrameCamera.equals(this._bindParameters.camera)?this._reprojectionMatrix=un:(On(kue,this._bindParameters.camera.viewMatrix),On(Uue,this._bindParameters.camera.projectionMatrix),si(Jx,kue,Uue),si(Jx,this._renderContext.lastFrameCamera.viewMatrix,Jx),si(Jx,this._renderContext.lastFrameCamera.projectionMatrix,Jx),this._reprojectionMatrix=Jx),this._bindParameters.ssr.lastFrameColorTexture=this._offscreen.lastFrameColorTexture;const e=this._stage.view.qualitySettings.fadeDuration;this._bindParameters.ssr.fadeFactor=e>0?Math.min(e,t-this._ssrEnableTime)/e:1,this._bindParameters.ssr.fadeFactor<1&&this._requestRender()}else this._reprojectionMatrix=un,this._bindParameters.ssr.lastFrameColorTexture=null,this._ssrEnableTime=null}_prepareInternalSlots(t,...e){for(const r of e)this._bindParameters.slot=r,t.forAll(i=>{i.material.shouldRender(this._renderContext)&&i.prepareTechnique(this._renderContext)})}_renderInternalSlot(t,e=this._materialRenderers){let r=!1;return this._bindParameters.slot=t,e.forAll(i=>{if(i.material.shouldRender(this._renderContext)){const s=i.prepareTechnique(this._renderContext);s!=null&&(i.render(this._renderContext,s),r=!0)}}),r}_getFallbackDepthTexture(){return this._fallbackDepthStencilTexture||(this._fallbackDepthStencilTexture=Lwe(this._rctx)),this._fallbackDepthStencilTexture}get gpuMemoryUsage(){return{offscreen:this._offscreen?.gpuMemoryUsage??0,highlights:(this._highlight?.gpuMemoryUsage??0)+(this._shadowHighlight?.gpuMemoryUsage??0),shadows:this._shadowMap?.gpuMemoryUsage??0,ssao:this._ssaoHelper?.gpuMemoryUsage??0}}get test(){const t=this;return{offscreen:this._offscreen,shadowMap:this._shadowMap,ssao:this._ssaoHelper,highlight:this._highlight,lighting:this._bindParameters.lighting,materialRenderers:this._materialRenderers,shadowAccumulator:this._shadowAccumulator,weatherIsFading:this._bindParameters.cloudsFade.isFading,resetRenderStateFeatures:()=>{t._renderStateFeatures=Xie()},getFramebufferTexture:e=>{switch(e){case N0.Color:return t._offscreen.colorTexture;case N0.LinearDepth:return t._offscreen.linearDepthTexture;case N0.Normals:return t._offscreen.normalTexture;case N0.ShadowMap:return t._shadowMap.depthTexture;case N0.HudVisibility:return t._offscreen.hudVisibilityTexture;case N0.Highlight:return t._offscreen.highlightTexture}}}}};var gS,N0;u([d()],ql.prototype,"_renderPlugins",void 0),u([d()],ql.prototype,"_shadowAccumulator",void 0),u([d()],ql.prototype,"_state",void 0),u([d()],ql.prototype,"_renderStateFeatures",void 0),u([d()],ql.prototype,"_antialiasingEnabled",void 0),u([d({readOnly:!0})],ql.prototype,"_antialiasing",null),u([d()],ql.prototype,"_ssaoEnabled",void 0),u([d()],ql.prototype,"_smaaPass",void 0),u([d({autoDestroy:!0})],ql.prototype,"_edgeView",void 0),u([d()],ql.prototype,"updating",null),u([d()],ql.prototype,"isCameraFinal",null),ql=u([R("esri.views.3d.webgl-engine.lib.Renderer")],ql),function(t){t[t.Geometry=0]="Geometry",t[t.HUD=1]="HUD"}(gS||(gS={})),function(t){t[t.Color=0]="Color",t[t.LinearDepth=1]="LinearDepth",t[t.Normals=2]="Normals",t[t.ShadowMap=3]="ShadowMap",t[t.HudVisibility=4]="HudVisibility",t[t.Highlight=5]="Highlight"}(N0||(N0={}));const Nc=new kt,Uue=be(),kue=be(),Jx=be();function owt(t){return e=>t.immediate.schedule(e)}let vOe=class bOe{constructor(e){this._rctx=e,this._indexBuffer=this._createIndexbuffer(),this._program=this._createHelperProgram()}static getShaderSources(){return{vertex:`#version 300 es
    precision highp float;

    void main(void) {
      gl_Position = vec4(0.0, 0.0, float(gl_VertexID)-2.0, 1.0);
    }`,fragment:`#version 300 es
    precision highp float;

    out vec4 fragColor;

    void main(void) {
      fragColor = vec4(0.0, 0.0, 0.0, 1.0);
    }`}}_createHelperProgram(){const e=bOe.getShaderSources();return this._rctx.programCache.acquire(e.vertex,e.fragment,new Map([]))}_createIndexbuffer(){return Lr.createIndex(this._rctx,Tr.STATIC_DRAW,new Uint32Array([0]))}resetIndicesType(){this._program.compiled&&this._indexBuffer&&(this._rctx.bindVAO(null),this._rctx.useProgram(this._program),this._rctx.bindBuffer(this._indexBuffer,bt.ELEMENT_ARRAY_BUFFER),this._rctx.drawElements(St.POINTS,1,Ke.UNSIGNED_INT,0))}dispose(){this._program.dispose(),this._indexBuffer.dispose()}},Vue=class{constructor(){this.blend=!1,this.blendColor={r:0,g:0,b:0,a:0},this.blendFunction={srcRGB:we.ONE,dstRGB:we.ZERO,srcAlpha:we.ONE,dstAlpha:we.ZERO},this.blendEquation={mode:jf.ADD,modeAlpha:jf.ADD},this.colorMask={r:!0,g:!0,b:!0,a:!0},this.faceCulling=!1,this.cullFace=qd.BACK,this.frontFace=S2.CCW,this.scissorTest=!1,this.scissorRect={x:0,y:0,width:0,height:0},this.depthTest=!1,this.depthFunction=Kr.LESS,this.clearDepth=1,this.depthWrite=!0,this.depthRange={zNear:0,zFar:1},this.viewport=null,this.stencilTest=!1,this.polygonOffsetFill=!1,this.polygonOffset=[0,0],this.stencilFunction={face:qd.FRONT_AND_BACK,func:Kr.ALWAYS,ref:0,mask:1},this.clearStencil=0,this.stencilWriteMask=1,this.stencilOperation={face:qd.FRONT_AND_BACK,fail:fs.KEEP,zFail:fs.KEEP,zPass:fs.KEEP},this.clearColor={r:0,g:0,b:0,a:0},this.program=null,this.vertexBuffer=null,this.indexBuffer=null,this.uniformBuffer=null,this.pixelPackBuffer=null,this.pixelUnpackBuffer=null,this.copyReadBuffer=null,this.copyWriteBuffer=null,this.uniformBufferBindingPoints=new Array,this.readFramebuffer=null,this.drawFramebuffer=null,this.renderbuffer=null,this.activeTexture=0,this.textureUnitMap=new Array,this.vertexArrayObject=null}},awt=class{constructor(e){this._allocations=new Map,e?Error.stackTraceLimit=1/0:(this.add=()=>{},this.remove=()=>{})}add(e){this._allocations.set(e,new Error().stack)}remove(e){this._allocations.delete(e)}get information(){let e="";if(this._allocations.size>0){e+=`${this._allocations.size} live object allocations:
`;const r=new Map;this._allocations.forEach(i=>{r.set(i,(r.get(i)??0)+1)}),r.forEach((i,s)=>{const n=s.split(`
`);n.shift(),n.shift(),e+=`${i}: ${n.shift()}
`,n.forEach(o=>e+=`   ${o}
`)})}return e}};const lwt={RECORD_ALLOCATIONS:!1};let cwt=class{constructor(){for(this._current=new Array,this._max=new Array,this._allocations=new awt(lwt.RECORD_ALLOCATIONS);this._current.length<An.COUNT;)this._current.push(0),this._max.push(0)}resetMax(){for(this._max.length=0;this._max.length<this._current.length;)this._max.push(0)}increment(e,r){const i=++this._current[e];this._max[e]=Math.max(i,this._max[e]),this._allocations.add(r)}decrement(e,r){--this._current[e],this._allocations.remove(r)}get max(){return this._max}get current(){return this._current}get total(){return this.current.reduce((e,r)=>e+r,0)}get resourceInformation(){let e="";if(this.total>0){e+=`Live objects:
`;for(let r=0;r<An.COUNT;++r){const i=this._current[r];i>0&&(e+=`${An[r]}: ${i}
`)}}return e+=this._allocations.information,e}},uwt=class{constructor(e,r,i){const s=r.textureFilterAnisotropic,n=i.maxAnisotropy??1/0;this.versionString=e.getParameter(e.VERSION),this.maxVertexTextureImageUnits=e.getParameter(e.MAX_VERTEX_TEXTURE_IMAGE_UNITS),this.maxVertexAttributes=e.getParameter(e.MAX_VERTEX_ATTRIBS),this.maxMaxAnisotropy=s?Math.min(e.getParameter(s.MAX_TEXTURE_MAX_ANISOTROPY),n):1,this.maxTextureImageUnits=e.getParameter(e.MAX_TEXTURE_IMAGE_UNITS),this.maxTextureSize=e.getParameter(e.MAX_TEXTURE_SIZE),this.maxRenderbufferSize=e.getParameter(e.MAX_RENDERBUFFER_SIZE),this.maxViewportDims=e.getParameter(e.MAX_VIEWPORT_DIMS),gp(e)?(this.maxUniformBufferBindings=e.getParameter(e.MAX_UNIFORM_BUFFER_BINDINGS),this.maxVertexUniformBlocks=e.getParameter(e.MAX_VERTEX_UNIFORM_BLOCKS),this.maxFragmentUniformBlocks=e.getParameter(e.MAX_FRAGMENT_UNIFORM_BLOCKS),this.maxUniformBlockSize=e.getParameter(e.MAX_UNIFORM_BLOCK_SIZE),this.uniformBufferOffsetAlignment=e.getParameter(e.UNIFORM_BUFFER_OFFSET_ALIGNMENT),this.maxArrayTextureLayers=e.getParameter(e.MAX_ARRAY_TEXTURE_LAYERS),this.maxSamples=e.getParameter(e.MAX_SAMPLES)):(this.maxUniformBufferBindings=0,this.maxVertexUniformBlocks=0,this.maxFragmentUniformBlocks=0,this.maxUniformBlockSize=0,this.uniformBufferOffsetAlignment=1,this.maxArrayTextureLayers=1,this.maxSamples=1)}};const hwt=["layout","centroid","smooth","case","mat2x2","mat2x3","mat2x4","mat3x2","mat3x3","mat3x4","mat4x2","mat4x3","mat4x4","uint","uvec2","uvec3","uvec4","samplerCubeShadow","sampler2DArray","sampler2DArrayShadow","isampler2D","isampler3D","isamplerCube","isampler2DArray","usampler2D","usampler3D","usamplerCube","usampler2DArray","coherent","restrict","readonly","writeonly","resource","atomic_uint","noperspective","patch","sample","subroutine","common","partition","active","filter","image1D","image2D","image3D","imageCube","iimage1D","iimage2D","iimage3D","iimageCube","uimage1D","uimage2D","uimage3D","uimageCube","image1DArray","image2DArray","iimage1DArray","iimage2DArray","uimage1DArray","uimage2DArray","image1DShadow","image2DShadow","image1DArrayShadow","image2DArrayShadow","imageBuffer","iimageBuffer","uimageBuffer","sampler1DArray","sampler1DArrayShadow","isampler1D","isampler1DArray","usampler1D","usampler1DArray","isampler2DRect","usampler2DRect","samplerBuffer","isamplerBuffer","usamplerBuffer","sampler2DMS","isampler2DMS","usampler2DMS","sampler2DMSArray","isampler2DMSArray","usampler2DMSArray","trunc","round","roundEven","isnan","isinf","floatBitsToInt","floatBitsToUint","intBitsToFloat","uintBitsToFloat","packSnorm2x16","unpackSnorm2x16","packUnorm2x16","unpackUnorm2x16","packHalf2x16","unpackHalf2x16","outerProduct","transpose","determinant","inverse","texture","textureSize","textureProj","textureLod","textureOffset","texelFetch","texelFetchOffset","textureProjOffset","textureLodOffset","textureProjLod","textureProjLodOffset","textureGrad","textureGradOffset","textureProjGrad","textureProjGradOffset"];var zue,wOe={exports:{}};(zue=["precision","highp","mediump","lowp","attribute","const","uniform","varying","break","continue","do","for","while","if","else","in","out","inout","float","int","void","bool","true","false","discard","return","mat2","mat3","mat4","vec2","vec3","vec4","ivec2","ivec3","ivec4","bvec2","bvec3","bvec4","sampler1D","sampler2D","sampler3D","samplerCube","sampler1DShadow","sampler2DShadow","struct","asm","class","union","enum","typedef","template","this","packed","goto","switch","default","inline","noinline","volatile","public","static","extern","external","interface","long","short","double","half","fixed","unsigned","input","output","hvec2","hvec3","hvec4","dvec2","dvec3","dvec4","fvec2","fvec3","fvec4","sampler2DRect","sampler3DRect","sampler2DRectShadow","sizeof","cast","namespace","using"])!==void 0&&(wOe.exports=zue);const dwt=BR(wOe.exports);var Bue,sq={exports:{}};sq.exports,Bue=sq,function(t){var e=["<<=",">>=","++","--","<<",">>","<=",">=","==","!=","&&","||","+=","-=","*=","/=","%=","&=","^^","^=","|=","(",")","[","]",".","!","~","*","/","%","+","-","<",">","&","^","|","?",":","=",",",";","{","}"];e!==void 0&&(Bue.exports=e)}();const Gue=BR(sq.exports);var xOe={exports:{}};(function(t){(function(e){var r=function(){return["abs","acos","all","any","asin","atan","ceil","clamp","cos","cross","dFdx","dFdy","degrees","distance","dot","equal","exp","exp2","faceforward","floor","fract","gl_BackColor","gl_BackLightModelProduct","gl_BackLightProduct","gl_BackMaterial","gl_BackSecondaryColor","gl_ClipPlane","gl_ClipVertex","gl_Color","gl_DepthRange","gl_DepthRangeParameters","gl_EyePlaneQ","gl_EyePlaneR","gl_EyePlaneS","gl_EyePlaneT","gl_Fog","gl_FogCoord","gl_FogFragCoord","gl_FogParameters","gl_FragColor","gl_FragCoord","gl_FragData","gl_FragDepth","gl_FragDepthEXT","gl_FrontColor","gl_FrontFacing","gl_FrontLightModelProduct","gl_FrontLightProduct","gl_FrontMaterial","gl_FrontSecondaryColor","gl_LightModel","gl_LightModelParameters","gl_LightModelProducts","gl_LightProducts","gl_LightSource","gl_LightSourceParameters","gl_MaterialParameters","gl_MaxClipPlanes","gl_MaxCombinedTextureImageUnits","gl_MaxDrawBuffers","gl_MaxFragmentUniformComponents","gl_MaxLights","gl_MaxTextureCoords","gl_MaxTextureImageUnits","gl_MaxTextureUnits","gl_MaxVaryingFloats","gl_MaxVertexAttribs","gl_MaxVertexTextureImageUnits","gl_MaxVertexUniformComponents","gl_ModelViewMatrix","gl_ModelViewMatrixInverse","gl_ModelViewMatrixInverseTranspose","gl_ModelViewMatrixTranspose","gl_ModelViewProjectionMatrix","gl_ModelViewProjectionMatrixInverse","gl_ModelViewProjectionMatrixInverseTranspose","gl_ModelViewProjectionMatrixTranspose","gl_MultiTexCoord0","gl_MultiTexCoord1","gl_MultiTexCoord2","gl_MultiTexCoord3","gl_MultiTexCoord4","gl_MultiTexCoord5","gl_MultiTexCoord6","gl_MultiTexCoord7","gl_Normal","gl_NormalMatrix","gl_NormalScale","gl_ObjectPlaneQ","gl_ObjectPlaneR","gl_ObjectPlaneS","gl_ObjectPlaneT","gl_Point","gl_PointCoord","gl_PointParameters","gl_PointSize","gl_Position","gl_ProjectionMatrix","gl_ProjectionMatrixInverse","gl_ProjectionMatrixInverseTranspose","gl_ProjectionMatrixTranspose","gl_SecondaryColor","gl_TexCoord","gl_TextureEnvColor","gl_TextureMatrix","gl_TextureMatrixInverse","gl_TextureMatrixInverseTranspose","gl_TextureMatrixTranspose","gl_Vertex","greaterThan","greaterThanEqual","inversesqrt","length","lessThan","lessThanEqual","log","log2","matrixCompMult","max","min","mix","mod","normalize","not","notEqual","pow","radians","reflect","refract","sign","sin","smoothstep","sqrt","step","tan","texture2D","texture2DLod","texture2DProj","texture2DProjLod","textureCube","textureCubeLod","texture2DLodEXT","texture2DProjLodEXT","textureCubeLodEXT","texture2DGradEXT","texture2DProjGradEXT","textureCubeGradEXT","textureSize","texelFetch"]}();r!==void 0&&(t.exports=r)})()})(xOe);const pwt=BR(xOe.exports);var sd=999,jue=9999,Ek=0,Ck=1,Hue=2,que=3,Wue=4,S$=5,fwt=6,mwt=7,gwt=8,Zue=9,ywt=10,Xue=11,_wt=["block-comment","line-comment","preprocessor","operator","integer","float","ident","builtin","keyword","whitespace","eof","integer"];function vwt(){var t,e,r,i=0,s=0,n=sd,o=[],a=[],l=1,c=0,h=0,p=!1,f=!1,m="";return function(U){return a=[],U!==null?_(U.replace?U.replace(/\r\n/g,`
`):U):v()};function y(U){U.length&&a.push({type:_wt[n],data:U,position:h,line:l,column:c})}function _(U){var X;for(i=0,r=(m+=U).length;t=m[i],i<r;){switch(X=i,n){case Ek:i=O();break;case Ck:i=S();break;case Hue:i=T();break;case que:i=A();break;case Wue:i=k();break;case Xue:i=M();break;case S$:i=L();break;case jue:i=D();break;case Zue:i=x();break;case sd:i=w()}X!==i&&(m[X]===`
`?(c=0,++l):++c)}return s+=i,m=m.slice(i),a}function v(U){return o.length&&y(o.join("")),n=ywt,y("(eof)"),a}function w(){return o=o.length?[]:o,e==="/"&&t==="*"?(h=s+i-1,n=Ek,e=t,i+1):e==="/"&&t==="/"?(h=s+i-1,n=Ck,e=t,i+1):t==="#"?(n=Hue,h=s+i,i):/\s/.test(t)?(n=Zue,h=s+i,i):(p=/\d/.test(t),f=/[^\w_]/.test(t),h=s+i,n=p?Wue:f?que:jue,i)}function x(){return/[^\s]/g.test(t)?(y(o.join("")),n=sd,i):(o.push(t),e=t,i+1)}function T(){return t!=="\r"&&t!==`
`||e==="\\"?(o.push(t),e=t,i+1):(y(o.join("")),n=sd,i)}function S(){return T()}function O(){return t==="/"&&e==="*"?(o.push(t),y(o.join("")),n=sd,i+1):(o.push(t),e=t,i+1)}function A(){if(e==="."&&/\d/.test(t))return n=S$,i;if(e==="/"&&t==="*")return n=Ek,i;if(e==="/"&&t==="/")return n=Ck,i;if(t==="."&&o.length){for(;I(o););return n=S$,i}if(t===";"||t===")"||t==="("){if(o.length)for(;I(o););return y(t),n=sd,i+1}var U=o.length===2&&t!=="=";if(/[\w_\d\s]/.test(t)||U){for(;I(o););return n=sd,i}return o.push(t),e=t,i+1}function I(U){for(var X,W,G=0;;){if(X=Gue.indexOf(U.slice(0,U.length+G).join("")),W=Gue[X],X===-1){if(G--+U.length>0)continue;W=U.slice(0,1).join("")}return y(W),h+=W.length,(o=o.slice(W.length)).length}}function M(){return/[^a-fA-F0-9]/.test(t)?(y(o.join("")),n=sd,i):(o.push(t),e=t,i+1)}function k(){return t==="."||/[eE]/.test(t)?(o.push(t),n=S$,e=t,i+1):t==="x"&&o.length===1&&o[0]==="0"?(n=Xue,o.push(t),e=t,i+1):/[^\d]/.test(t)?(y(o.join("")),n=sd,i):(o.push(t),e=t,i+1)}function L(){return t==="f"&&(o.push(t),e=t,i+=1),/[eE]/.test(t)||t==="-"&&/[eE]/.test(e)?(o.push(t),e=t,i+1):/[^\d]/.test(t)?(y(o.join("")),n=sd,i):(o.push(t),e=t,i+1)}function D(){if(/[^\d\w_]/.test(t)){var U=o.join("");return n=dwt.indexOf(U)>-1?gwt:pwt.indexOf(U)>-1?mwt:fwt,y(o.join("")),n=sd,i}return o.push(t),e=t,i+1}}function bwt(t){var e=vwt(),r=[];return r=(r=r.concat(e(t))).concat(e(null))}function wwt(t){return bwt(t)}function xwt(t){return t.map(e=>e.type!=="eof"?e.data:"").join("")}const Ak=["GL_OES_standard_derivatives","GL_EXT_frag_depth","GL_EXT_draw_buffers","GL_EXT_shader_texture_lod"];function Twt(t,e="100",r="300 es"){const i=/^\s*\#version\s+([0-9]+(\s+[a-zA-Z]+)?)\s*/;for(const s of t)if(s.type==="preprocessor"){const n=i.exec(s.data);if(n){const o=n[1].replaceAll(/\s\s+/g," ");if(o===r)return o;if(o===e)return s.data="#version "+r,e;throw new Error("unknown glsl version: "+o)}}return t.splice(0,0,{type:"preprocessor",data:"#version "+r},{type:"whitespace",data:`
`}),null}function Swt(t,e){for(let r=e-1;r>=0;r--){const i=t[r];if(i.type!=="whitespace"&&i.type!=="block-comment"){if(i.type!=="keyword")break;if(i.data==="attribute"||i.data==="in")return!0}}return!1}function d3(t,e,r,i){i=i||r;for(const s of t)if(s.type==="ident"&&s.data===r)return i in e?e[i]++:e[i]=0,d3(t,e,i+"_"+e[i],i);return r}function TOe(t,e,r="afterVersion"){function i(l,c){for(let h=c;h<l.length;h++){const p=l[h];if(p.type==="operator"&&p.data===";")return h}return null}function s(l){let c=-1,h=0,p=-1;for(let f=0;f<l.length;f++){const m=l[f];if(m.type==="preprocessor"&&(/\#(if|ifdef|ifndef)\s+.+/.test(m.data)?++h:/\#endif\s*.*/.test(m.data)&&--h),r!=="afterVersion"&&r!=="afterPrecision"||m.type==="preprocessor"&&/^#version/.test(m.data)&&(p=Math.max(p,f)),r==="afterPrecision"&&m.type==="keyword"&&m.data==="precision"){const y=i(l,f);if(y===null)throw new Error("precision statement not followed by any semicolons!");p=Math.max(p,y)}c<p&&h===0&&(c=f)}return c+1}const n={data:`
`,type:"whitespace"},o=l=>l<t.length&&/[^\r\n]$/.test(t[l].data);let a=s(t);o(a-1)&&t.splice(a++,0,n);for(const l of e)t.splice(a++,0,l);o(a-1)&&o(a)&&t.splice(a,0,n)}function Ewt(t,e,r,i="lowp"){TOe(t,[{type:"keyword",data:"out"},{type:"whitespace",data:" "},{type:"keyword",data:i},{type:"whitespace",data:" "},{type:"keyword",data:r},{type:"whitespace",data:" "},{type:"ident",data:e},{type:"operator",data:";"}],"afterPrecision")}function Cwt(t,e,r,i,s="lowp"){TOe(t,[{type:"keyword",data:"layout"},{type:"operator",data:"("},{type:"keyword",data:"location"},{type:"whitespace",data:" "},{type:"operator",data:"="},{type:"whitespace",data:" "},{type:"integer",data:i.toString()},{type:"operator",data:")"},{type:"whitespace",data:" "},{type:"keyword",data:"out"},{type:"whitespace",data:" "},{type:"keyword",data:s},{type:"whitespace",data:" "},{type:"keyword",data:r},{type:"whitespace",data:" "},{type:"ident",data:e},{type:"operator",data:";"}],"afterPrecision")}function Awt(t,e){let r,i,s=-1;for(let n=e;n<t.length;n++){const o=t[n];if(o.type==="operator"&&(o.data==="["&&(r=n),o.data==="]")){i=n;break}o.type==="integer"&&(s=parseInt(o.data,10))}return r&&i&&t.splice(r,i-r+1),s}function Yue(t,e){if(t.startsWith("#version 300"))return t;const r=wwt(t);if(Twt(r,"100","300 es")==="300 es")return t;let i=null,s=null;const n={},o={};for(let a=0;a<r.length;++a){const l=r[a];switch(l.type){case"keyword":e===Kc.VERTEX_SHADER&&l.data==="attribute"?l.data="in":l.data==="varying"&&(l.data=e===Kc.VERTEX_SHADER?"out":"in");break;case"builtin":if(/^texture(2D|Cube)(Proj)?(Lod|Grad)?(EXT)?$/.test(l.data.trim())&&(l.data=l.data.replaceAll(/(2D|Cube|EXT)/g,"")),e===Kc.FRAGMENT_SHADER&&l.data==="gl_FragColor"&&(i||(i=d3(r,n,"fragColor"),Ewt(r,i,"vec4")),l.data=i),e===Kc.FRAGMENT_SHADER&&l.data==="gl_FragData"){const c=Awt(r,a+1),h=d3(r,n,"fragData");Cwt(r,h,"vec4",c,"mediump"),l.data=h}else e===Kc.FRAGMENT_SHADER&&l.data==="gl_FragDepthEXT"&&(s||(s=d3(r,n,"gl_FragDepth")),l.data=s);break;case"ident":if(hwt.includes(l.data)){if(e===Kc.VERTEX_SHADER&&Swt(r,a))throw new Error("attribute in vertex shader uses a name that is a reserved word in glsl 300 es");l.data in o||(o[l.data]=d3(r,n,l.data)),l.data=o[l.data]}}}for(let a=r.length-1;a>=0;--a){const l=r[a];if(l.type==="preprocessor"){const c=l.data.match(/\#extension\s+(.*)\:/);if(c&&c[1]&&Ak.includes(c[1].trim())){const f=r[a+1];r.splice(a,f&&f.type==="whitespace"?2:1)}const h=l.data.match(/\#ifdef\s+(.*)/);h&&h[1]&&Ak.includes(h[1].trim())&&(l.data="#if 1");const p=l.data.match(/\#ifndef\s+(.*)/);p&&p[1]&&Ak.includes(p[1].trim())&&(l.data="#if 0")}}return Owt(t,xwt(r))}function Owt(t,e){return e}const Rwt=4294967295;let Pwt=class{constructor(e,r,i,s,n=new Map){this._context=e,this._locations=s,this._uniformBlockBindings=n,this._refCount=1,this._compiled=!1,this._nameToUniformLocation={},this._nameToUniform1={},this._nameToUniform1v=new Map,this._nameToUniform2=new Map,this._nameToUniform3=new Map,this._nameToUniform4=new Map,this._nameToUniformMatrix3=new Map,this._nameToUniformMatrix4=new Map,e||console.error("RenderingContext isn't initialized!"),r.length===0&&console.error("Shaders source should not be empty!"),this._context.type===lr.WEBGL2&&(r=Yue(r,Kc.VERTEX_SHADER),i=Yue(i,Kc.FRAGMENT_SHADER)),this._vShader=Jue(this._context,Kc.VERTEX_SHADER,r),this._fShader=Jue(this._context,Kc.FRAGMENT_SHADER,i),this._vShader&&this._fShader||console.error("Error loading shaders!"),this._context.instanceCounter.increment(An.Shader,this),kG()&&(this.vertexShader=r,this.fragmentShader=i);const o=this._context.gl,a=o.createProgram();if(o.attachShader(a,this._vShader),o.attachShader(a,this._fShader),this._locations.forEach((l,c)=>o.bindAttribLocation(a,l,c)),o.linkProgram(a),kG()&&!o.getProgramParameter(a,o.LINK_STATUS)&&console.error(`Could not link shader
validated: ${o.getProgramParameter(a,o.VALIDATE_STATUS)}, gl error ${o.getError()}, vertex: ${o.getShaderParameter(this._vShader,o.COMPILE_STATUS)}, fragment: ${o.getShaderParameter(this._fShader,o.COMPILE_STATUS)}, info log: ${o.getProgramInfoLog(a)}, vertex source: ${this.vertexShader}, fragment source: ${this.fragmentShader}`),this._context.type===lr.WEBGL2){const l=o;for(const[c,h]of this._uniformBlockBindings){const p=l.getUniformBlockIndex(a,c);p<Rwt&&l.uniformBlockBinding(a,p,h)}}this._glName=a,this._context.instanceCounter.increment(An.Program,this)}get glName(){return this._glName}get hasGLName(){return this._glName!=null}get compiled(){if(this._compiled)return!0;const e=this._context.gl.getExtension("KHR_parallel_shader_compile");return e==null||this.glName==null?(this._compiled=!0,!0):(this._compiled=!!this._context.gl.getProgramParameter(this.glName,e.COMPLETION_STATUS_KHR),this._compiled)}dispose(){if(--this._refCount>0)return;const e=this._context.gl;this._vShader&&(e.deleteShader(this._vShader),this._vShader=null,this._context.instanceCounter.decrement(An.Shader,this)),this._fShader&&(e.deleteShader(this._fShader),this._fShader=null),this._glName&&(e.deleteProgram(this._glName),this._glName=null,this._context.instanceCounter.decrement(An.Program,this))}ref(){++this._refCount}_getUniformLocation(e){return this._nameToUniformLocation[e]===void 0&&this.glName!=null&&(this._nameToUniformLocation[e]=this._context.gl.getUniformLocation(this.glName,e)),this._nameToUniformLocation[e]}hasUniform(e){return this._getUniformLocation(e)!==null}setUniform1i(e,r){const i=this._nameToUniform1[e];i!==void 0&&r===i||(this._context.gl.uniform1i(this._getUniformLocation(e),r),this._nameToUniform1[e]=r)}setUniform1iv(e,r){Up(this._nameToUniform1v,e,r)&&this._context.gl.uniform1iv(this._getUniformLocation(e),r)}setUniform2iv(e,r){Up(this._nameToUniform2,e,r)&&this._context.gl.uniform2iv(this._getUniformLocation(e),r)}setUniform3iv(e,r){Up(this._nameToUniform3,e,r)&&this._context.gl.uniform3iv(this._getUniformLocation(e),r)}setUniform4iv(e,r){Up(this._nameToUniform4,e,r)&&this._context.gl.uniform4iv(this._getUniformLocation(e),r)}setUniform1f(e,r){const i=this._nameToUniform1[e];i!==void 0&&r===i||(this._context.gl.uniform1f(this._getUniformLocation(e),r),this._nameToUniform1[e]=r)}setUniform1fv(e,r){Up(this._nameToUniform1v,e,r)&&this._context.gl.uniform1fv(this._getUniformLocation(e),r)}setUniform2f(e,r,i){const s=this._nameToUniform2.get(e);s===void 0?(this._context.gl.uniform2f(this._getUniformLocation(e),r,i),this._nameToUniform2.set(e,[r,i])):r===s[0]&&i===s[1]||(this._context.gl.uniform2f(this._getUniformLocation(e),r,i),s[0]=r,s[1]=i)}setUniform2fv(e,r){Up(this._nameToUniform2,e,r)&&this._context.gl.uniform2fv(this._getUniformLocation(e),r)}setUniform3f(e,r,i,s){const n=this._nameToUniform3.get(e);n===void 0?(this._context.gl.uniform3f(this._getUniformLocation(e),r,i,s),this._nameToUniform3.set(e,[r,i,s])):r===n[0]&&i===n[1]&&s===n[2]||(this._context.gl.uniform3f(this._getUniformLocation(e),r,i,s),n[0]=r,n[1]=i,n[2]=s)}setUniform3fv(e,r){Up(this._nameToUniform3,e,r)&&this._context.gl.uniform3fv(this._getUniformLocation(e),r)}setUniform4f(e,r,i,s,n){const o=this._nameToUniform4.get(e);o===void 0?(this._context.gl.uniform4f(this._getUniformLocation(e),r,i,s,n),this._nameToUniform4.set(e,[r,i,s,n])):o!==void 0&&r===o[0]&&i===o[1]&&s===o[2]&&n===o[3]||(this._context.gl.uniform4f(this._getUniformLocation(e),r,i,s,n),o[0]=r,o[1]=i,o[2]=s,o[3]=n)}setUniform4fv(e,r){Up(this._nameToUniform4,e,r)&&this._context.gl.uniform4fv(this._getUniformLocation(e),r)}setUniformMatrix3fv(e,r,i=!1){Up(this._nameToUniformMatrix3,e,r)&&this._context.gl.uniformMatrix3fv(this._getUniformLocation(e),i,r)}setUniformMatrix4fv(e,r,i=!1){Up(this._nameToUniformMatrix4,e,r)&&this._context.gl.uniformMatrix4fv(this._getUniformLocation(e),i,r)}stop(){}};function Jue(t,e,r){const i=t.gl,s=i.createShader(e);return i.shaderSource(s,r),i.compileShader(s),kG()&&!i.getShaderParameter(s,i.COMPILE_STATUS)&&(console.error("Compile error in ".concat(e===Kc.VERTEX_SHADER?"vertex":"fragment"," shader")),console.error(i.getShaderInfoLog(s)),console.error(Mwt(r))),s}function Mwt(t){let e=2;return t.replaceAll(`
`,()=>`
`+Iwt(e++)+":")}function Iwt(t){return t>=1e3?t.toString():("  "+t).slice(-3)}function Up(t,e,r){const i=t.get(e);return i?oq(i,r):(t.set(e,Array.from(r)),!0)}let $wt=class{constructor(e){this._rctx=e,this._store=new yE}dispose(){this._store.forEach(e=>e.forEach(r=>r.dispose())),this._store.clear()}acquire(e,r,i,s){const n=this._store.get(e,r);if(n!=null)return n.ref(),n;const o=new Pwt(this._rctx,e,r,i,s);return o.ref(),this._store.set(e,r,o),o}get test(){let e=0;return this._store.forEach(r=>r.forEach(i=>e+=i.hasGLName?2:1)),{cachedWebGLObjects:e}}},_P=class{constructor(){this._result=!1}dispose(){this._program=Ue(this._program)}get result(){return this._program!=null&&(this._result=this._test(this._program),this.dispose()),this._result}},Lwt=class extends _P{constructor(e){super(),this._rctx=e,this._helperProgram=null,this._rctx.type===lr.WEBGL2&&oe("mac")&&oe("chrome")&&(this._program=this._prepareProgram(),this._helperProgram=this._prepareHelperProgram())}dispose(){super.dispose(),this._helperProgram?.dispose(),this._helperProgram=null}_test(e){const r=this._rctx;r.resetState();const i=new vr(1);i.wrapMode=$t.CLAMP_TO_EDGE,i.samplingMode=Ct.NEAREST;const s=new hn(r,i),n=Lr.createIndex(this._rctx,Tr.STATIC_DRAW,new Uint8Array([0]));r.bindFramebuffer(s),r.setViewport(0,0,1,1),r.useProgram(this._helperProgram),r.bindBuffer(n,bt.ELEMENT_ARRAY_BUFFER),r.drawElements(St.POINTS,1,Ke.UNSIGNED_BYTE,0),r.useProgram(e),r.bindVAO(null),r.drawArrays(St.TRIANGLES,0,258);const o=new Uint8Array(4);return s.readPixels(0,0,1,1,Tt.RGBA,ks.UNSIGNED_BYTE,o),s.dispose(),n.dispose(),o[0]===255}_prepareProgram(){const r=`#version 300 es
    precision highp float;

    out float triangleId;

    const vec3 triangleVertices[3] = vec3[3](vec3(-0.5, -0.5, 0.0), vec3(0.5, -0.5, 0.0), vec3(0.0, 0.5, 0.0));

    void main(void) {
      triangleId = floor(float(gl_VertexID)/3.0);

      vec3 position = triangleVertices[gl_VertexID % 3];
      float offset = triangleId / ${b.float(85)};
      position.z = 0.5 - offset;

      gl_Position = vec4(position, 1.0);
    }
    `,i=`#version 300 es
    precision highp float;

    in float triangleId;

    out vec4 fragColor;

    void main(void) {
      fragColor = triangleId == ${b.float(85)} ? vec4(0.0, 1.0, 0.0, 1.0) : vec4(1.0, 0.0, 0.0, 1.0);
    }
    `;return this._rctx.programCache.acquire(r,i,new Map([]))}_prepareHelperProgram(){const e=vOe.getShaderSources();return this._rctx.programCache.acquire(e.vertex,e.fragment,new Map([]))}},Dwt=class extends _P{constructor(e){super(),this._rctx=e,this._program=Que(this._rctx,!1),this._obfuscated=Que(this._rctx,!0)}dispose(){super.dispose(),this._obfuscated=Ue(this._obfuscated)}_test(e){if(oe("force-double-precision-obfuscation"))return!0;if(this._obfuscated==null)return!1;const r=this._runProgram(e),i=this._runProgram(this._obfuscated);return r!==0&&(i===0||r/i>5)}_runProgram(e){const r=this._rctx;r.resetState();const i=new vr(1);i.wrapMode=$t.CLAMP_TO_EDGE,i.samplingMode=Ct.NEAREST;const s=new hn(r,i),n=Lr.createVertex(r,Tr.STATIC_DRAW,new Uint16Array([0,0,1,0,0,1,1,1])),o=new $h(r,new Map([["position",0]]),{geometry:[new _o("position",2,Ke.UNSIGNED_SHORT,0,4)]},{geometry:n}),a=Oe(5633261287538229e-9,2626832878767164e-9,1.4349880495278358e6),l=Oe(563327146742708e-8,2.6268736381334523e6,1434963231608387e-9),c=new Float32Array(6);Aj(a,c,3);const h=new Float32Array(6);Aj(l,h,3),r.useProgram(e),e.setUniform3f("u_highA",c[0],c[2],c[4]),e.setUniform3f("u_lowA",c[1],c[3],c[5]),e.setUniform3f("u_highB",h[0],h[2],h[4]),e.setUniform3f("u_lowB",h[1],h[3],h[5]),r.bindFramebuffer(s),r.setViewport(0,0,1,1),r.bindVAO(o),r.drawArrays(St.TRIANGLE_STRIP,0,4);const p=new Uint8Array(4);s.readPixels(0,0,1,1,Tt.RGBA,ks.UNSIGNED_BYTE,p),o.dispose(),s.dispose();const f=(a[2]-l[2])/25,m=RY(p);return Math.abs(f-m)}};function Que(t,e){const r=`

  precision highp float;

  attribute vec2 position;

  uniform vec3 u_highA;
  uniform vec3 u_lowA;
  uniform vec3 u_highB;
  uniform vec3 u_lowB;

  varying vec4 v_color;

  ${e?"#define DOUBLE_PRECISION_REQUIRES_OBFUSCATION":""}

  #ifdef DOUBLE_PRECISION_REQUIRES_OBFUSCATION

  vec3 dpPlusFrc(vec3 a, vec3 b) {
    return mix(a, a + b, vec3(notEqual(b, vec3(0))));
  }

  vec3 dpMinusFrc(vec3 a, vec3 b) {
    return mix(vec3(0), a - b, vec3(notEqual(a, b)));
  }

  vec3 dpAdd(vec3 hiA, vec3 loA, vec3 hiB, vec3 loB) {
    vec3 t1 = dpPlusFrc(hiA, hiB);
    vec3 e = dpMinusFrc(t1, hiA);
    vec3 t2 = dpMinusFrc(hiB, e) + dpMinusFrc(hiA, dpMinusFrc(t1, e)) + loA + loB;
    return t1 + t2;
  }

  #else

  vec3 dpAdd(vec3 hiA, vec3 loA, vec3 hiB, vec3 loB) {
    vec3 t1 = hiA + hiB;
    vec3 e = t1 - hiA;
    vec3 t2 = ((hiB - e) + (hiA - (t1 - e))) + loA + loB;
    return t1 + t2;
  }

  #endif

  const float MAX_RGBA_FLOAT =
    255.0 / 256.0 +
    255.0 / 256.0 / 256.0 +
    255.0 / 256.0 / 256.0 / 256.0 +
    255.0 / 256.0 / 256.0 / 256.0 / 256.0;

  const vec4 FIXED_POINT_FACTORS = vec4(1.0, 256.0, 256.0 * 256.0, 256.0 * 256.0 * 256.0);

  vec4 float2rgba(const float value) {
    // Make sure value is in the domain we can represent
    float valueInValidDomain = clamp(value, 0.0, MAX_RGBA_FLOAT);

    // Decompose value in 32bit fixed point parts represented as
    // uint8 rgba components. Decomposition uses the fractional part after multiplying
    // by a power of 256 (this removes the bits that are represented in the previous
    // component) and then converts the fractional part to 8bits.
    vec4 fixedPointU8 = floor(fract(valueInValidDomain * FIXED_POINT_FACTORS) * 256.0);

    // Convert uint8 values (from 0 to 255) to floating point representation for
    // the shader
    const float toU8AsFloat = 1.0 / 255.0;

    return fixedPointU8 * toU8AsFloat;
  }

  void main() {
    vec3 val = dpAdd(u_highA, u_lowA, -u_highB, -u_lowB);

    v_color = float2rgba(val.z / 25.0);

    gl_Position = vec4(position * 2.0 - 1.0, 0.0, 1.0);
  }
  `,i=`
  precision highp float;

  varying vec4 v_color;

  void main() {
    gl_FragColor = v_color;
  }
  `;return t.programCache.acquire(r,i,new Map([["position",0]]))}let Nwt=class extends _P{constructor(e){if(super(),this._rctx=e,!e.gl)return;if(e.type===lr.WEBGL1)return void(this._result=!(!e.capabilities.textureFloat?.textureFloat||!e.capabilities.colorBufferFloat?.textureFloat));if(!(e.capabilities.textureFloat?.textureFloat&&e.capabilities.colorBufferFloat?.textureFloat&&e.capabilities.colorBufferFloat?.floatBlend))return;const r=`
    precision highp float;
    attribute vec2 a_pos;

    void main() {
      gl_Position = vec4(a_pos * 2.0 - 1.0, 0.0, 1.0);
    }
    `,i=`
     precision highp float;

     void main() {
      gl_FragColor = vec4(0.5, 0.5, 0.5, 0.5);
     }
    `;this._program=e.programCache.acquire(r,i,new Map([["a_pos",0]]))}_test(e){const r=this._rctx,i=new vr(1);i.wrapMode=$t.CLAMP_TO_EDGE,i.dataType=ks.FLOAT,i.internalFormat=Xe.RGBA32F,i.samplingMode=Ct.NEAREST;const s=new hn(r,i),n=Lr.createVertex(r,Tr.STATIC_DRAW,new Uint16Array([0,0,1,0,0,1,1,1])),o=new $h(r,new Map([["a_pos",0]]),{geometry:[new _o("a_pos",2,Ke.UNSIGNED_SHORT,0,4)]},{geometry:n});r.useProgram(e);const a=r.getBoundFramebufferObject(),{x:l,y:c,width:h,height:p}=r.getViewport();r.bindFramebuffer(s),r.setViewport(0,0,1,1),r.bindVAO(o),r.drawArrays(St.TRIANGLE_STRIP,0,4);const f=At({blending:JSe});r.setPipelineState(f),r.drawArrays(St.TRIANGLE_STRIP,0,4);const m=r.gl.getError();return r.setViewport(l,c,h,p),r.bindFramebuffer(a),o.dispose(),s.dispose(),m!==1282||(console.warn("Device claims support for WebGL extension EXT_float_blend but does not support it. Using fall back."),!1)}},Fwt=class extends _P{constructor(e){super(),this._rctx=e;const r=`
      precision highp float;
      attribute vec2 a_pos;
      uniform highp sampler2D u_texture;
      varying vec4 v_color;

      float getBit(in float bitset, in int bitIndex) {
        float offset = pow(2.0, float(bitIndex));
        return mod(floor(bitset / offset), 2.0);
      }

      void main() {
        vec4 value = texture2D(u_texture, vec2(0.0));
        float bit = getBit(value.x * 255.0, 1);

        v_color = bit * vec4(1.0);
        gl_Position = vec4(a_pos * 2.0 - 1.0, 0.0, 1.0);
      }
      `,i=`
      precision highp float;
      varying vec4 v_color;

      void main() {
        gl_FragColor = v_color;
      }
      `;this._program=e.programCache.acquire(r,i,new Map([["a_pos",0]]))}_test(e){const r=this._rctx,i=new vr(1);i.wrapMode=$t.CLAMP_TO_EDGE,i.samplingMode=Ct.NEAREST;const s=new hn(r,i),n=new Uint8Array(4),o=Lr.createVertex(r,Tr.STATIC_DRAW,new Uint16Array([0,0,1,0,0,1,1,1])),a=new $h(r,new Map([["a_position",0]]),{geometry:[new _o("a_position",2,Ke.SHORT,0,4)]},{geometry:o});r.useProgram(e);const l=new Et(r,i,new Uint8Array([2,255,0,0]));e.setUniform1i("u_texture",0),r.bindTexture(l,0);const c=r.getBoundFramebufferObject();r.bindFramebuffer(s),r.useProgram(e);const{x:h,y:p,width:f,height:m}=r.getViewport();r.setViewport(0,0,1,1),r.bindVAO(a),r.drawArrays(St.TRIANGLE_STRIP,0,4),r.setViewport(h,p,f,m),s.readPixels(0,0,1,1,Tt.RGBA,ks.UNSIGNED_BYTE,n),a.dispose(),s.dispose();const y=n[0]!==255||n[1]!==255||n[2]!==255||n[3]!==255;return y&&Q.getLogger("esri.views.webgl.testSamplerPrecision").warn(`A problem was detected with your graphics driver. Your driver does not appear to honor sampler precision specifiers, which may result in rendering issues due to numerical instability. We recommend ensuring that your drivers have been updated to the latest version. Applying lowp sampler workaround. [${n[0]}.${n[1]}.${n[2]}.${n[3]}]`),r.bindFramebuffer(c),y}};new _o("a_pos",2,Ke.BYTE,0,2);new _o("a_pos",2,Ke.BYTE,0,4),new _o("a_tex",2,Ke.BYTE,2,4);const Uwt={geometry:[new _o("a_pos",2,Ke.UNSIGNED_SHORT,0,4)]};let kwt=class extends _P{constructor(e){super(),this._rctx=e;const r=`
    precision highp float;

    attribute vec2 a_pos;
    varying vec2 v_uv;

    void main() {
      v_uv = a_pos;
      gl_Position = vec4(a_pos * 2.0 - 1.0, 0.0, 1.0);
    }
    `,i=`
    precision highp float;

    varying vec2 v_uv;

    uniform sampler2D u_texture;

    void main() {
      gl_FragColor = texture2D(u_texture, v_uv);
    }
    `;this._program=e.programCache.acquire(r,i,new Map([["a_pos",0]]))}dispose(){super.dispose()}_test(e){const r=this._rctx;if(!r.gl)return e.dispose(),!0;const i=new vr(1);i.wrapMode=$t.CLAMP_TO_EDGE,i.samplingMode=Ct.NEAREST;const s=new hn(r,i),n=Lr.createVertex(r,Tr.STATIC_DRAW,new Uint16Array([0,0,1,0,0,1,1,1])),o=new $h(r,new Map([["a_pos",0]]),Uwt,{geometry:n}),a=new vr;a.samplingMode=Ct.LINEAR,a.wrapMode=$t.CLAMP_TO_EDGE;const l=new Et(r,a,p3);r.useProgram(e),r.bindTexture(l,0),e.setUniform1i("u_texture",0);const c=r.getBoundFramebufferObject(),{x:h,y:p,width:f,height:m}=r.getViewport();r.bindFramebuffer(s),r.setViewport(0,0,1,1),r.setClearColor(0,0,0,0),r.setBlendingEnabled(!1),r.clearSafe(wi.COLOR_BUFFER_BIT),r.bindVAO(o),r.drawArrays(St.TRIANGLE_STRIP,0,4);const y=new Uint8Array(4);return s.readPixels(0,0,1,1,Tt.RGBA,ks.UNSIGNED_BYTE,y),o.dispose(),s.dispose(),l.dispose(),r.setViewport(h,p,f,m),r.bindFramebuffer(c),y[0]!==255}};const p3=new Image;p3.src="data:image/svg+xml,%3C%3Fxml version='1.0' encoding='UTF-8'%3F%3E%3Csvg width='5' height='5' version='1.1' viewBox='0 0 5 5' xmlns='http://www.w3.org/2000/svg'%3E%3Crect width='5' height='5' fill='%23f00' fill-opacity='.5'/%3E%3C/svg%3E%0A",p3.width=5,p3.height=5,p3.decode();let Vwt=class{constructor(e){this.rctx=e,this.floatBufferBlend=new Nwt(e),this.svgPremultipliesAlpha=new kwt(e),this.doublePrecisionRequiresObfuscation=new Dwt(e),this.ignoresSamplerPrecision=new Fwt(e),this.drawArraysRequiresIndicesTypeReset=new Lwt(e)}dispose(){this.ignoresSamplerPrecision.dispose(),this.doublePrecisionRequiresObfuscation.dispose(),this.svgPremultipliesAlpha.dispose(),this.floatBufferBlend.dispose(),this.drawArraysRequiresIndicesTypeReset.dispose()}};function zwt(t,e){if(e.disjointTimerQuery)return null;if(gp(t))return{drawBuffers:t.drawBuffers.bind(t),MAX_DRAW_BUFFERS:t.MAX_DRAW_BUFFERS,MAX_COLOR_ATTACHMENTS:t.MAX_COLOR_ATTACHMENTS};if(e.drawBuffers)return null;const r=t.getExtension("WEBGL_draw_buffers");return r?{drawBuffers:r.drawBuffersWEBGL.bind(r),MAX_DRAW_BUFFERS:r.MAX_DRAW_BUFFERS_WEBGL,MAX_COLOR_ATTACHMENTS:r.MAX_COLOR_ATTACHMENTS_WEBGL}:null}function Bwt(t){if(gp(t))return t;const e=t.getExtension("ANGLE_instanced_arrays");return e?{drawArraysInstanced:e.drawArraysInstancedANGLE.bind(e),drawElementsInstanced:e.drawElementsInstancedANGLE.bind(e),vertexAttribDivisor:e.vertexAttribDivisorANGLE.bind(e)}:null}function Gwt(t,e){if(e.compressedTextureETC)return null;const r=t.getExtension("WEBGL_compressed_texture_etc");return r?{COMPRESSED_R11_EAC:r.COMPRESSED_R11_EAC,COMPRESSED_SIGNED_R11_EAC:r.COMPRESSED_SIGNED_R11_EAC,COMPRESSED_RG11_EAC:r.COMPRESSED_RG11_EAC,COMPRESSED_SIGNED_RG11_EAC:r.COMPRESSED_SIGNED_RG11_EAC,COMPRESSED_RGB8_ETC2:r.COMPRESSED_RGB8_ETC2,COMPRESSED_SRGB8_ETC2:r.COMPRESSED_SRGB8_ETC2,COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2:r.COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2,COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2:r.COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2,COMPRESSED_RGBA8_ETC2_EAC:r.COMPRESSED_RGBA8_ETC2_EAC,COMPRESSED_SRGB8_ALPHA8_ETC2_EAC:r.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC}:null}function jwt(t,e){if(e.compressedTextureS3TC)return null;const r=t.getExtension("WEBGL_compressed_texture_s3tc");return r?{COMPRESSED_RGB_S3TC_DXT1:r.COMPRESSED_RGB_S3TC_DXT1_EXT,COMPRESSED_RGBA_S3TC_DXT1:r.COMPRESSED_RGBA_S3TC_DXT1_EXT,COMPRESSED_RGBA_S3TC_DXT3:r.COMPRESSED_RGBA_S3TC_DXT3_EXT,COMPRESSED_RGBA_S3TC_DXT5:r.COMPRESSED_RGBA_S3TC_DXT5_EXT}:null}function Hwt(t,e){if(gp(t))return{MIN:t.MIN,MAX:t.MAX};if(e.blendMinMax)return null;{const r=t.getExtension("EXT_blend_minmax");return r?{MIN:r.MIN_EXT,MAX:r.MAX_EXT}:null}}function qwt(t,e){if(e.textureFilterAnisotropic)return null;const r=t.getExtension("EXT_texture_filter_anisotropic")||t.getExtension("MOZ_EXT_texture_filter_anisotropic")||t.getExtension("WEBKIT_EXT_texture_filter_anisotropic");return r?{MAX_TEXTURE_MAX_ANISOTROPY:r.MAX_TEXTURE_MAX_ANISOTROPY_EXT,TEXTURE_MAX_ANISOTROPY:r.TEXTURE_MAX_ANISOTROPY_EXT}:null}function Wwt(t,e){if(gp(t))return{textureFloat:!0,textureFloatLinear:!e.textureFloatLinear&&!!t.getExtension("OES_texture_float_linear"),textureHalfFloat:!0,textureHalfFloatLinear:!0,HALF_FLOAT:t.HALF_FLOAT,R16F:t.R16F,RG16F:t.RG16F,RGBA16F:t.RGBA16F,R32F:t.R32F,RG32F:t.RG32F,RGBA32F:t.RGBA32F,R11F_G11F_B10F:t.R11F_G11F_B10F,RGB16F:t.RGB16F};if(t instanceof WebGLRenderingContext){const r=!e.textureHalfFloat&&t.getExtension("OES_texture_half_float");return{textureFloat:!e.textureFloat&&!!t.getExtension("OES_texture_float"),textureFloatLinear:!e.textureFloatLinear&&!!t.getExtension("OES_texture_float_linear"),textureHalfFloat:!!r,textureHalfFloatLinear:!e.textureHalfFloatLinear&&!!t.getExtension("OES_texture_half_float_linear"),HALF_FLOAT:r?r.HALF_FLOAT_OES:void 0}}return null}function Zwt(t,e){if(gp(t)){const r=!e.colorBufferHalfFloat&&t.getExtension("EXT_color_buffer_half_float")||!e.colorBufferFloat&&t.getExtension("EXT_color_buffer_float"),i=!e.colorBufferFloat&&t.getExtension("EXT_color_buffer_float"),s=!e.floatBlend&&!e.colorBufferFloat&&t.getExtension("EXT_float_blend");return r||i||s?{textureFloat:!!i,textureHalfFloat:!!r,floatBlend:!!s,R16F:t.R16F,RG16F:t.RG16F,RGBA16F:t.RGBA16F,R32F:t.R32F,RG32F:t.RG32F,RGBA32F:t.RGBA32F,R11F_G11F_B10F:t.R11F_G11F_B10F,RGB16F:t.RGB16F}:null}if(t instanceof WebGLRenderingContext){const r=!e.colorBufferHalfFloat&&t.getExtension("EXT_color_buffer_half_float"),i=!e.colorBufferFloat&&t.getExtension("WEBGL_color_buffer_float"),s=!e.floatBlend&&!e.colorBufferFloat&&t.getExtension("EXT_float_blend");return r||i||s?{textureFloat:!!i,textureHalfFloat:!!r,floatBlend:!!s,RGBA16F:r?r.RGBA16F_EXT:void 0,RGB16F:r?r.RGB16F_EXT:void 0,RGBA32F:i?i.RGBA32F_EXT:void 0}:null}return null}function Kue(t,e,r,i,s){if(i&&gp(t))return!0;if(e[r])return!1;for(const n of s)if(t.getExtension(n))return!0;return!1}function Xwt(t,e){if(!gp(t)||e.textureNorm16)return null;const r=t.getExtension("EXT_texture_norm16");return r?{R16:r.R16_EXT,RG16:r.RG16_EXT,RGB16:r.RGB16_EXT,RGBA16:r.RGBA16_EXT,R16_SNORM:r.R16_SNORM_EXT,RG16_SNORM:r.RG16_SNORM_EXT,RGB16_SNORM:r.RGB16_SNORM_EXT,RGBA16_SNORM:r.RGBA16_SNORM_EXT}:null}function Ywt(t,e){const r=e.loseContext&&t.getExtension("WEBGL_lose_context");return r?{loseRenderingContext:()=>r.loseContext()}:null}function Jwt(t,e){if(gp(t))return{createVertexArray:t.createVertexArray.bind(t),deleteVertexArray:t.deleteVertexArray.bind(t),bindVertexArray:t.bindVertexArray.bind(t)};if(e.vao)return null;const r=t.getExtension("OES_vertex_array_object")||t.getExtension("MOZ_OES_vertex_array_object")||t.getExtension("WEBKIT_OES_vertex_array_object");return r?{createVertexArray:r.createVertexArrayOES.bind(r),deleteVertexArray:r.deleteVertexArrayOES.bind(r),bindVertexArray:r.bindVertexArrayOES.bind(r)}:null}let Qwt=class{constructor(e,r){this._gl=e,this._instancing=null,this._vertexArrayObject=null,this._compressedTextureETC=null,this._compressedTextureS3TC=null,this._textureFilterAnisotropic=null,this._textureFloat=null,this._colorBufferFloat=null,this._minMaxBlending=null,this._loseContext=null,this._drawBuffers=null,this._textureNorm16=null,this._depthTexture=null,this._textureFloatLinear=null,this._disabledExtensions=r.disabledExtensions||{},this._debugWebGLExtensions=r.debugWebGLExtensions||{}}get drawBuffers(){return this._drawBuffers||(this._drawBuffers=zwt(this._gl,this._disabledExtensions)),this._drawBuffers}get instancing(){return this._instancing||(this._instancing=Bwt(this._gl)),this._instancing}get vao(){return this._vertexArrayObject||(this._vertexArrayObject=Jwt(this._gl,this._disabledExtensions)),this._vertexArrayObject}get compressedTextureETC(){return this._compressedTextureETC||(this._compressedTextureETC=Gwt(this._gl,this._disabledExtensions)),this._compressedTextureETC}get compressedTextureS3TC(){return this._compressedTextureS3TC||(this._compressedTextureS3TC=jwt(this._gl,this._disabledExtensions)),this._compressedTextureS3TC}get textureFilterAnisotropic(){return this._textureFilterAnisotropic||(this._textureFilterAnisotropic=qwt(this._gl,this._disabledExtensions)),this._textureFilterAnisotropic}get disjointTimerQuery(){return this._disjointTimerQuery||(this._disjointTimerQuery=rwt(this._gl,this._disabledExtensions)),this._disjointTimerQuery}get textureFloat(){return this._textureFloat||(this._textureFloat=Wwt(this._gl,this._disabledExtensions)),this._textureFloat}get colorBufferFloat(){return this._colorBufferFloat||(this._colorBufferFloat=Zwt(this._gl,this._disabledExtensions)),this._colorBufferFloat}get blendMinMax(){return this._minMaxBlending||(this._minMaxBlending=Hwt(this._gl,this._disabledExtensions)),this._minMaxBlending}get depthTexture(){return this._depthTexture===null&&(this._depthTexture=Kue(this._gl,this._disabledExtensions,"depthTexture",!0,["WEBGL_depth_texture","MOZ_WEBGL_depth_texture","WEBKIT_WEBGL_depth_texture"])),this._depthTexture}get loseContext(){return this._loseContext||(this._loseContext=Ywt(this._gl,this._debugWebGLExtensions)),this._loseContext}get textureNorm16(){return this._textureNorm16||(this._textureNorm16=Xwt(this._gl,this._disabledExtensions)),this._textureNorm16}get textureFloatLinear(){return this._textureFloatLinear===null&&(this._textureFloatLinear=Kue(this._gl,this._disabledExtensions,"textureFloatLinear",!1,["OES_texture_float_linear"])),this._textureFloatLinear}enable(e){return this[e]}},Kwt=class{constructor(e,r){this.gl=e,this.instanceCounter=new cwt,this.programCache=new $wt(this),this._state=new Vue,this._numOfDrawCalls=0,this._numOfTriangles=0,this.type=gp(e)?lr.WEBGL2:lr.WEBGL1,this._loadExtensions(),this.configure(r)}get gl2(){return this.type===lr.WEBGL1?null:this.gl}configure(e){this._capabilities=new Qwt(this.gl,e),this._parameters=new uwt(this.gl,this._capabilities,e),Et.TEXTURE_UNIT_FOR_UPDATES=this._parameters.maxTextureImageUnits-1;const r=this.gl.getParameter(this.gl.VIEWPORT);this._state=new Vue,this._state.viewport={x:r[0],y:r[1],width:r[2],height:r[3]},this._stateTracker=new rJe({setBlending:i=>{if(i){this.setBlendingEnabled(!0),this.setBlendEquationSeparate(i.opRgb,i.opAlpha),this.setBlendFunctionSeparate(i.srcRgb,i.dstRgb,i.srcAlpha,i.dstAlpha);const s=i.color;this.setBlendColor(s.r,s.g,s.b,s.a)}else this.setBlendingEnabled(!1)},setCulling:i=>{i?(this.setFaceCullingEnabled(!0),this.setCullFace(i.face),this.setFrontFace(i.mode)):this.setFaceCullingEnabled(!1)},setPolygonOffset:i=>{i?(this.setPolygonOffsetFillEnabled(!0),this.setPolygonOffset(i.factor,i.units)):this.setPolygonOffsetFillEnabled(!1)},setDepthTest:i=>{i?(this.setDepthTestEnabled(!0),this.setDepthFunction(i.func)):this.setDepthTestEnabled(!1)},setStencilTest:i=>{if(i){this.setStencilTestEnabled(!0);const s=i.function;this.setStencilFunction(s.func,s.ref,s.mask);const n=i.operation;this.setStencilOp(n.fail,n.zFail,n.zPass)}else this.setStencilTestEnabled(!1)},setDepthWrite:i=>{i?(this.setDepthWriteEnabled(!0),this.setDepthRange(i.zNear,i.zFar)):this.setDepthWriteEnabled(!1)},setColorWrite:i=>{i?this.setColorMask(i.r,i.g,i.b,i.a):this.setColorMask(!1,!1,!1,!1)},setStencilWrite:i=>{i?this.setStencilWriteMask(i.mask):this.setStencilWriteMask(0)}}),this.enforceState(),Ue(this._driverTest),this._driverTest=new Vwt(this)}dispose(){Ue(this._driverTest),this.programCache.dispose(),this.bindVAO(null),this.unbindBuffer(bt.ARRAY_BUFFER),this.unbindBuffer(bt.ELEMENT_ARRAY_BUFFER),this.type===lr.WEBGL2&&(this.unbindBuffer(bt.UNIFORM_BUFFER),this._state.uniformBufferBindingPoints.length=0,this.unbindBuffer(bt.PIXEL_PACK_BUFFER),this.unbindBuffer(bt.PIXEL_UNPACK_BUFFER),this.unbindBuffer(bt.COPY_READ_BUFFER),this.unbindBuffer(bt.COPY_WRITE_BUFFER)),this._state.textureUnitMap.length=0,Qu()&&console.log(this.instanceCounter.resourceInformation)}get driverTest(){return this._driverTest}get contextAttributes(){return this.gl.getContextAttributes()}get parameters(){return this._parameters}setPipelineState(e){this._stateTracker.setPipeline(e)}setBlendingEnabled(e){this._state.blend!==e&&(e===!0?this.gl.enable(this.gl.BLEND):this.gl.disable(this.gl.BLEND),this._state.blend=e,this._stateTracker.invalidateBlending())}externalProgramUpdate(){this._state.program?.stop(),this._state.program=null}externalTextureUnitUpdate(e,r){for(let i=0;i<e.length;++i)this._state.textureUnitMap[e[i]]=null;r>=0&&(this._state.activeTexture=r)}externalVertexArrayObjectUpdate(){const e=this.capabilities.vao;e&&(e.bindVertexArray(null),this._state.vertexArrayObject=null),this._state.vertexBuffer=null,this._state.indexBuffer=null}externalVertexBufferUpdate(){this._state.vertexBuffer=null}externalIndexBufferUpdate(){this._state.indexBuffer=null}setBlendColor(e,r,i,s){e===this._state.blendColor.r&&r===this._state.blendColor.g&&i===this._state.blendColor.b&&s===this._state.blendColor.a||(this.gl.blendColor(e,r,i,s),this._state.blendColor.r=e,this._state.blendColor.g=r,this._state.blendColor.b=i,this._state.blendColor.a=s,this._stateTracker.invalidateBlending())}setBlendFunction(e,r){e===this._state.blendFunction.srcRGB&&r===this._state.blendFunction.dstRGB||(this.gl.blendFunc(e,r),this._state.blendFunction.srcRGB=e,this._state.blendFunction.srcAlpha=e,this._state.blendFunction.dstRGB=r,this._state.blendFunction.dstAlpha=r,this._stateTracker.invalidateBlending())}setBlendFunctionSeparate(e,r,i,s){this._state.blendFunction.srcRGB===e&&this._state.blendFunction.srcAlpha===i&&this._state.blendFunction.dstRGB===r&&this._state.blendFunction.dstAlpha===s||(this.gl.blendFuncSeparate(e,r,i,s),this._state.blendFunction.srcRGB=e,this._state.blendFunction.srcAlpha=i,this._state.blendFunction.dstRGB=r,this._state.blendFunction.dstAlpha=s,this._stateTracker.invalidateBlending())}setBlendEquation(e){this._state.blendEquation.mode!==e&&(this.gl.blendEquation(e),this._state.blendEquation.mode=e,this._state.blendEquation.modeAlpha=e,this._stateTracker.invalidateBlending())}setBlendEquationSeparate(e,r){this._state.blendEquation.mode===e&&this._state.blendEquation.modeAlpha===r||(this.gl.blendEquationSeparate(e,r),this._state.blendEquation.mode=e,this._state.blendEquation.modeAlpha=r,this._stateTracker.invalidateBlending())}setColorMask(e,r,i,s){this._state.colorMask.r===e&&this._state.colorMask.g===r&&this._state.colorMask.b===i&&this._state.colorMask.a===s||(this.gl.colorMask(e,r,i,s),this._state.colorMask.r=e,this._state.colorMask.g=r,this._state.colorMask.b=i,this._state.colorMask.a=s,this._stateTracker.invalidateColorWrite())}setClearColor(e,r,i,s){this._state.clearColor.r===e&&this._state.clearColor.g===r&&this._state.clearColor.b===i&&this._state.clearColor.a===s||(this.gl.clearColor(e,r,i,s),this._state.clearColor.r=e,this._state.clearColor.g=r,this._state.clearColor.b=i,this._state.clearColor.a=s)}setFaceCullingEnabled(e){this._state.faceCulling!==e&&(e===!0?this.gl.enable(this.gl.CULL_FACE):this.gl.disable(this.gl.CULL_FACE),this._state.faceCulling=e,this._stateTracker.invalidateCulling())}setPolygonOffsetFillEnabled(e){this._state.polygonOffsetFill!==e&&(e===!0?this.gl.enable(this.gl.POLYGON_OFFSET_FILL):this.gl.disable(this.gl.POLYGON_OFFSET_FILL),this._state.polygonOffsetFill=e,this._stateTracker.invalidatePolygonOffset())}setPolygonOffset(e,r){this._state.polygonOffset[0]===e&&this._state.polygonOffset[1]===r||(this._state.polygonOffset[0]=e,this._state.polygonOffset[1]=r,this.gl.polygonOffset(e,r),this._stateTracker.invalidatePolygonOffset())}setCullFace(e){this._state.cullFace!==e&&(this.gl.cullFace(e),this._state.cullFace=e,this._stateTracker.invalidateCulling())}setFrontFace(e){this._state.frontFace!==e&&(this.gl.frontFace(e),this._state.frontFace=e,this._stateTracker.invalidateCulling())}setScissorTestEnabled(e){this._state.scissorTest!==e&&(e===!0?this.gl.enable(this.gl.SCISSOR_TEST):this.gl.disable(this.gl.SCISSOR_TEST),this._state.scissorTest=e)}setScissorRect(e,r,i,s){this._state.scissorRect.x===e&&this._state.scissorRect.y===r&&this._state.scissorRect.width===i&&this._state.scissorRect.height===s||(this.gl.scissor(e,r,i,s),this._state.scissorRect.x=e,this._state.scissorRect.y=r,this._state.scissorRect.width=i,this._state.scissorRect.height=s)}setDepthTestEnabled(e){this._state.depthTest!==e&&(e===!0?this.gl.enable(this.gl.DEPTH_TEST):this.gl.disable(this.gl.DEPTH_TEST),this._state.depthTest=e,this._stateTracker.invalidateDepthTest())}setClearDepth(e){this._state.clearDepth!==e&&(this.gl.clearDepth(e),this._state.clearDepth=e)}setDepthFunction(e){this._state.depthFunction!==e&&(this.gl.depthFunc(e),this._state.depthFunction=e,this._stateTracker.invalidateDepthTest())}setDepthWriteEnabled(e){this._state.depthWrite!==e&&(this.gl.depthMask(e),this._state.depthWrite=e,this._stateTracker.invalidateDepthWrite())}setDepthRange(e,r){this._state.depthRange.zNear===e&&this._state.depthRange.zFar===r||(this.gl.depthRange(e,r),this._state.depthRange.zNear=e,this._state.depthRange.zFar=r,this._stateTracker.invalidateDepthWrite())}setStencilTestEnabled(e){this._state.stencilTest!==e&&(e===!0?this.gl.enable(this.gl.STENCIL_TEST):this.gl.disable(this.gl.STENCIL_TEST),this._state.stencilTest=e,this._stateTracker.invalidateStencilTest())}setClearStencil(e){e!==this._state.clearStencil&&(this.gl.clearStencil(e),this._state.clearStencil=e)}setStencilFunction(e,r,i){this._state.stencilFunction.func===e&&this._state.stencilFunction.ref===r&&this._state.stencilFunction.mask===i||(this.gl.stencilFunc(e,r,i),this._state.stencilFunction.face=qd.FRONT_AND_BACK,this._state.stencilFunction.func=e,this._state.stencilFunction.ref=r,this._state.stencilFunction.mask=i,this._stateTracker.invalidateStencilTest())}setStencilFunctionSeparate(e,r,i,s){this._state.stencilFunction.face===e&&this._state.stencilFunction.func===r&&this._state.stencilFunction.ref===i&&this._state.stencilFunction.mask===s||(this.gl.stencilFuncSeparate(e,r,i,s),this._state.stencilFunction.face=e,this._state.stencilFunction.func=r,this._state.stencilFunction.ref=i,this._state.stencilFunction.mask=s,this._stateTracker.invalidateStencilTest())}setStencilWriteMask(e){this._state.stencilWriteMask!==e&&(this.gl.stencilMask(e),this._state.stencilWriteMask=e,this._stateTracker.invalidateStencilWrite())}setStencilOp(e,r,i){this._state.stencilOperation.face===qd.FRONT_AND_BACK&&this._state.stencilOperation.fail===e&&this._state.stencilOperation.zFail===r&&this._state.stencilOperation.zPass===i||(this.gl.stencilOp(e,r,i),this._state.stencilOperation.face=qd.FRONT_AND_BACK,this._state.stencilOperation.fail=e,this._state.stencilOperation.zFail=r,this._state.stencilOperation.zPass=i,this._stateTracker.invalidateStencilTest())}setStencilOpSeparate(e,r,i,s){this._state.stencilOperation.face===e&&this._state.stencilOperation.fail===r&&this._state.stencilOperation.zFail===i&&this._state.stencilOperation.zPass===s||(this.gl.stencilOpSeparate(e,r,i,s),this._state.stencilOperation.face=e,this._state.stencilOperation.fail=r,this._state.stencilOperation.zFail=i,this._state.stencilOperation.zPass=s,this._stateTracker.invalidateStencilTest())}setActiveTexture(e,r=!1){const i=this._state.activeTexture;return e>=0&&(r||e!==this._state.activeTexture)&&(this.gl.activeTexture(s8+e),this._state.activeTexture=e),i}clear(e){e&&this.gl.clear(e)}clearSafe(e,r=255){e&&(e&wi.COLOR_BUFFER_BIT&&this.setColorMask(!0,!0,!0,!0),e&wi.DEPTH_BUFFER_BIT&&this.setDepthWriteEnabled(!0),e&wi.STENCIL_BUFFER_BIT&&this.setStencilWriteMask(r),this.gl.clear(e))}drawArrays(e,r,i){if(Qu()&&(this._numOfDrawCalls++,this._numOfTriangles+=ehe(e,i)),this.gl.drawArrays(e,r,i),Qu()){const s=uie(this);s&&console.error("drawArrays:",s)}}drawElements(e,r,i,s){if(Qu()&&(this._numOfDrawCalls++,this._numOfTriangles+=ehe(e,r)),this.gl.drawElements(e,r,i,s),Qu()){const n=uie(this);if(n){const o=this.getBoundVAO(),a=o?.indexBuffer,l=o?.vertexBuffers,c={indexBuffer:a,vertexBuffers:l},h={mode:e,count:r,type:i,offset:s},p=a?.size??0,f=s+r,m=p<f?`. Buffer is too small. Attempted to draw index ${f} of ${p}`:"";console.error(`drawElements: ${n}${m}`,{args:h,vao:c})}}}logInfo(){Qu()&&console.log(`DrawCalls: ${this._numOfDrawCalls}, Triangles: ${this._numOfTriangles}`)}resetInfo(){Qu()&&(this._numOfDrawCalls=0,this._numOfTriangles=0)}get capabilities(){return this._capabilities}setViewport(e,r,i,s){i=Math.max(Math.round(i),1),s=Math.max(Math.round(s),1);const n=this._state.viewport;n.x===e&&n.y===r&&n.width===i&&n.height===s||(n.x=e,n.y=r,n.width=i,n.height=s,this.gl.viewport(e,r,i,s))}getViewport(){const e=this._state.viewport;return{x:e.x,y:e.y,width:e.width,height:e.height}}useProgram(e){this._state.program!==e&&(this._state.program?.stop(),this._state.program=e,this.gl.useProgram(e?.glName??null))}bindTexture(e,r,i=!1){(r>=this.parameters.maxTextureImageUnits||r<0)&&console.error("Input texture unit is out of range of available units!");const s=this._state.textureUnitMap[r];return e==null||e.glName==null?(s!=null&&(this.setActiveTexture(r,i),this.gl.bindTexture(s.descriptor.target,null)),this._state.textureUnitMap[r]=null,s):i||s!==e?(this.setActiveTexture(r,i),this.gl.bindTexture(e.descriptor.target,e.glName),e.applyChanges(),this._state.textureUnitMap[r]=e,s):(e.isDirty&&(this.setActiveTexture(r,i),e.applyChanges()),s)}unbindTexture(e){if(e!=null)for(let r=0;r<this.parameters.maxTextureImageUnits;r++)this._state.textureUnitMap[r]===e&&(this.bindTexture(null,r),this._state.textureUnitMap[r]=null)}bindFramebuffer(e,r=!1){if(r||this._state.readFramebuffer!==e||this._state.drawFramebuffer!==e){if(e==null)return this.gl.bindFramebuffer(po.FRAMEBUFFER,null),this._state.readFramebuffer=null,void(this._state.drawFramebuffer=null);e.initializeAndBind(po.FRAMEBUFFER),this._state.readFramebuffer=e,this._state.drawFramebuffer=e}}bindFramebufferSeparate(e,r,i=!1){const s=r===po.READ_FRAMEBUFFER,n=s?this._state.readFramebuffer:this._state.drawFramebuffer;(i||n!==e)&&(e==null?this.gl.bindFramebuffer(r,null):e.initializeAndBind(r),s?this._state.readFramebuffer=e??null:this._state.drawFramebuffer=e??null)}blitFramebuffer(e,r,i=0,s=0,n=e.width,o=e.height,a=0,l=0,c=r.width,h=r.height,p=wi.COLOR_BUFFER_BIT,f=Ct.NEAREST){this.bindFramebufferSeparate(e,po.READ_FRAMEBUFFER),this.bindFramebufferSeparate(r,po.DRAW_FRAMEBUFFER),this.gl.blitFramebuffer(i,s,n,o,a,l,c,h,p,f)}bindBuffer(e,r){if(e)switch(r??(r=e.bufferType),r){case bt.ARRAY_BUFFER:this._state.vertexBuffer=Ul(this.gl,e,r,this._state.vertexBuffer);break;case bt.ELEMENT_ARRAY_BUFFER:this._state.indexBuffer=Ul(this.gl,e,r,this._state.indexBuffer);break;case bt.UNIFORM_BUFFER:this._state.uniformBuffer=Ul(this.gl,e,r,this._state.uniformBuffer);break;case bt.PIXEL_PACK_BUFFER:this._state.pixelPackBuffer=Ul(this.gl,e,r,this._state.pixelPackBuffer);break;case bt.PIXEL_UNPACK_BUFFER:this._state.pixelUnpackBuffer=Ul(this.gl,e,r,this._state.pixelUnpackBuffer);break;case bt.COPY_READ_BUFFER:this._state.copyReadBuffer=Ul(this.gl,e,r,this._state.copyReadBuffer);break;case bt.COPY_WRITE_BUFFER:this._state.copyWriteBuffer=Ul(this.gl,e,r,this._state.copyWriteBuffer)}}bindRenderbuffer(e){const r=this.gl;e||(r.bindRenderbuffer(r.RENDERBUFFER,null),this._state.renderbuffer=null),this._state.renderbuffer!==e&&(r.bindRenderbuffer(r.RENDERBUFFER,e.glName),this._state.renderbuffer=e)}_getBufferBinding(e,r){if(r>=this.parameters.maxUniformBufferBindings||r<0)return console.error("Uniform buffer binding point is out of range!"),null;const i=this._state.uniformBufferBindingPoints;let s=i[r];return s==null&&(s={buffer:null,offset:0,size:0},i[r]=s),s}bindBufferBase(e,r,i){const s=this._getBufferBinding(e,r);s!=null&&(s.buffer===i&&s.offset===0&&s.size===0||(this.gl.bindBufferBase(e,r,i?i.glName:null),s.buffer=i,s.offset=0,s.size=0))}bindBufferRange(e,r,i,s,n){const o=this._getBufferBinding(e,r);if(o!=null&&!(o.buffer===i&&o.offset===s&&o.size===n)){if(s%this._parameters.uniformBufferOffsetAlignment!=0)return void console.error("Uniform buffer binding offset is not a multiple of the context offset alignment");this.gl.bindBufferRange(e,r,i.glName,s,n),o.buffer=i,o.offset=s,o.size=n}}bindUBO(e,r,i,s){r!=null?(Qu()&&(s??r.byteLength)>this._parameters.maxUniformBlockSize&&console.error("Attempting to bind more data than the maximum uniform block size"),r.initialize(),i!==void 0&&s!==void 0?this.bindBufferRange(bt.UNIFORM_BUFFER,e,r.buffer,i,s):this.bindBufferBase(bt.UNIFORM_BUFFER,e,r.buffer)):this.bindBufferBase(bt.UNIFORM_BUFFER,e,null)}unbindUBO(e){for(let r=0,i=this._state.uniformBufferBindingPoints.length;r<i;r++){const s=this._state.uniformBufferBindingPoints[r];s!=null&&s.buffer===e.buffer&&this.bindBufferBase(bt.UNIFORM_BUFFER,r,null)}}unbindBuffer(e){switch(e){case bt.ARRAY_BUFFER:this._state.vertexBuffer=Ul(this.gl,null,e,this._state.vertexBuffer);break;case bt.ELEMENT_ARRAY_BUFFER:this._state.indexBuffer=Ul(this.gl,null,e,this._state.indexBuffer);break;case bt.UNIFORM_BUFFER:this._state.uniformBuffer=Ul(this.gl,null,e,this._state.uniformBuffer);break;case bt.PIXEL_PACK_BUFFER:this._state.pixelPackBuffer=Ul(this.gl,null,e,this._state.pixelPackBuffer);break;case bt.PIXEL_UNPACK_BUFFER:this._state.pixelUnpackBuffer=Ul(this.gl,null,e,this._state.pixelUnpackBuffer);break;case bt.COPY_READ_BUFFER:this._state.copyReadBuffer=Ul(this.gl,null,e,this._state.copyReadBuffer);break;case bt.COPY_WRITE_BUFFER:this._state.copyWriteBuffer=Ul(this.gl,null,e,this._state.copyWriteBuffer)}}bindVAO(e=null){e!=null?this._state.vertexArrayObject!==e&&(e.bind(),this._state.vertexArrayObject=e):this._state.vertexArrayObject&&(this._state.vertexArrayObject.unbind(),this._state.vertexArrayObject=null)}async clientWaitAsync(e=10){const r=this.gl,i=r.fenceSync(UG.SYNC_GPU_COMMANDS_COMPLETE,0);if(!i)throw new Error("Client wait failed, could not create sync object");let s;this.instanceCounter.increment(An.Sync,i),r.flush();do await pO(e),s=r.clientWaitSync(i,0,0);while(s===e4.TIMEOUT_EXPIRED);if(this.instanceCounter.decrement(An.Sync,i),r.deleteSync(i),s===e4.WAIT_FAILED)throw new Error("Client wait failed")}getBoundFramebufferObject(e=po.FRAMEBUFFER){return e===po.READ_FRAMEBUFFER?this._state.readFramebuffer:this._state.drawFramebuffer}getBoundVAO(){return this._state.vertexArrayObject}resetState(){this.useProgram(null),this.bindVAO(null),this.bindFramebuffer(null,!0),this.unbindBuffer(bt.ARRAY_BUFFER),this.unbindBuffer(bt.ELEMENT_ARRAY_BUFFER),this.type===lr.WEBGL2&&(this.unbindBuffer(bt.UNIFORM_BUFFER),this._state.uniformBufferBindingPoints.length=0,this.unbindBuffer(bt.PIXEL_PACK_BUFFER),this.unbindBuffer(bt.PIXEL_UNPACK_BUFFER),this.unbindBuffer(bt.COPY_READ_BUFFER),this.unbindBuffer(bt.COPY_WRITE_BUFFER));for(let e=0;e<this.parameters.maxTextureImageUnits;++e)this.bindTexture(null,e);this.setBlendingEnabled(!1),this.setBlendFunction(we.ONE,we.ZERO),this.setBlendEquation(jf.ADD),this.setBlendColor(0,0,0,0),this.setFaceCullingEnabled(!1),this.setCullFace(qd.BACK),this.setFrontFace(S2.CCW),this.setPolygonOffsetFillEnabled(!1),this.setPolygonOffset(0,0),this.setScissorTestEnabled(!1),this.setScissorRect(0,0,this.gl.canvas.width,this.gl.canvas.height),this.setDepthTestEnabled(!1),this.setDepthFunction(Kr.LESS),this.setDepthRange(0,1),this.setStencilTestEnabled(!1),this.setStencilFunction(Kr.ALWAYS,0,0),this.setStencilOp(fs.KEEP,fs.KEEP,fs.KEEP),this.setClearColor(0,0,0,0),this.setClearDepth(1),this.setClearStencil(0),this.setColorMask(!0,!0,!0,!0),this.setStencilWriteMask(4294967295),this.setDepthWriteEnabled(!0),this.setViewport(0,0,this.gl.canvas.width,this.gl.canvas.height)}enforceState(){const e=this.capabilities.vao;e&&e.bindVertexArray(null);const{gl:r,gl2:i}=this;for(let n=0;n<this.parameters.maxVertexAttributes;n++)r.disableVertexAttribArray(n);if(this._state.vertexBuffer?r.bindBuffer(this._state.vertexBuffer.bufferType,this._state.vertexBuffer.glName):r.bindBuffer(bt.ARRAY_BUFFER,null),this._state.indexBuffer?r.bindBuffer(this._state.indexBuffer.bufferType,this._state.indexBuffer.glName):r.bindBuffer(bt.ELEMENT_ARRAY_BUFFER,null),i!=null){this._state.uniformBuffer?i.bindBuffer(this._state.uniformBuffer.bufferType,this._state.uniformBuffer.glName):i.bindBuffer(bt.UNIFORM_BUFFER,null);for(let n=0;n<this._parameters.maxUniformBufferBindings;n++){const o=this._state.uniformBufferBindingPoints[n];if(o!=null){const{buffer:a,offset:l,size:c}=o;a!==null?l===0&&c===0?i.bindBufferBase(bt.UNIFORM_BUFFER,n,a.glName):i.bindBufferRange(bt.UNIFORM_BUFFER,n,a.glName,l,c):i.bindBufferBase(bt.UNIFORM_BUFFER,n,null)}}this._state.pixelPackBuffer?i.bindBuffer(this._state.pixelPackBuffer.bufferType,this._state.pixelPackBuffer.glName):i.bindBuffer(bt.PIXEL_PACK_BUFFER,null),this._state.pixelUnpackBuffer?i.bindBuffer(this._state.pixelUnpackBuffer.bufferType,this._state.pixelUnpackBuffer.glName):i.bindBuffer(bt.PIXEL_UNPACK_BUFFER,null),this._state.copyReadBuffer?i.bindBuffer(this._state.copyReadBuffer.bufferType,this._state.copyReadBuffer.glName):i.bindBuffer(bt.COPY_READ_BUFFER,null),this._state.copyWriteBuffer?i.bindBuffer(this._state.copyWriteBuffer.bufferType,this._state.copyWriteBuffer.glName):i.bindBuffer(bt.COPY_WRITE_BUFFER,null),i.bindFramebuffer(po.READ_FRAMEBUFFER,null),i.readBuffer(i.BACK),this._state.readFramebuffer&&(i.bindFramebuffer(po.READ_FRAMEBUFFER,this._state.readFramebuffer.glName),i.readBuffer(qc.COLOR_ATTACHMENT0)),i.bindFramebuffer(po.DRAW_FRAMEBUFFER,this._state.drawFramebuffer?.glName??null)}else this._state.readFramebuffer=this._state.drawFramebuffer,r.bindFramebuffer(po.FRAMEBUFFER,this._state.drawFramebuffer?.glName??null);if(e&&this._state.vertexArrayObject){const n=this._state.vertexArrayObject;this._state.vertexArrayObject&&(this._state.vertexArrayObject.unbind(),this._state.vertexArrayObject=null),this.bindVAO(n)}r.useProgram(this._state.program?.glName??null),r.blendColor(this._state.blendColor.r,this._state.blendColor.g,this._state.blendColor.b,this._state.blendColor.a),r.bindRenderbuffer(r.RENDERBUFFER,this._state.renderbuffer?this._state.renderbuffer.glName:null),this._state.blend===!0?r.enable(this.gl.BLEND):r.disable(this.gl.BLEND),r.blendEquationSeparate(this._state.blendEquation.mode,this._state.blendEquation.modeAlpha),r.blendFuncSeparate(this._state.blendFunction.srcRGB,this._state.blendFunction.dstRGB,this._state.blendFunction.srcAlpha,this._state.blendFunction.dstAlpha),r.clearColor(this._state.clearColor.r,this._state.clearColor.g,this._state.clearColor.b,this._state.clearColor.a),r.clearDepth(this._state.clearDepth),r.clearStencil(this._state.clearStencil),r.colorMask(this._state.colorMask.r,this._state.colorMask.g,this._state.colorMask.b,this._state.colorMask.a),r.cullFace(this._state.cullFace),r.depthFunc(this._state.depthFunction),r.depthRange(this._state.depthRange.zNear,this._state.depthRange.zFar),this._state.depthTest===!0?r.enable(r.DEPTH_TEST):r.disable(r.DEPTH_TEST),r.depthMask(this._state.depthWrite),r.frontFace(this._state.frontFace),r.lineWidth(1),this._state.faceCulling===!0?r.enable(r.CULL_FACE):r.disable(r.CULL_FACE),r.polygonOffset(this._state.polygonOffset[0],this._state.polygonOffset[1]),this._state.polygonOffsetFill===!0?r.enable(r.POLYGON_OFFSET_FILL):r.disable(r.POLYGON_OFFSET_FILL),r.scissor(this._state.scissorRect.x,this._state.scissorRect.y,this._state.scissorRect.width,this._state.scissorRect.height),this._state.scissorTest===!0?r.enable(r.SCISSOR_TEST):r.disable(r.SCISSOR_TEST),r.stencilFunc(this._state.stencilFunction.func,this._state.stencilFunction.ref,this._state.stencilFunction.mask),r.stencilOpSeparate(this._state.stencilOperation.face,this._state.stencilOperation.fail,this._state.stencilOperation.zFail,this._state.stencilOperation.zPass),this._state.stencilTest===!0?r.enable(r.STENCIL_TEST):r.disable(r.STENCIL_TEST),r.stencilMask(this._state.stencilWriteMask);for(let n=0;n<this.parameters.maxTextureImageUnits;n++){r.activeTexture(s8+n),r.bindTexture(is.TEXTURE_2D,null),r.bindTexture(is.TEXTURE_CUBE_MAP,null),this.type===lr.WEBGL2&&(r.bindTexture(is.TEXTURE_3D,null),r.bindTexture(is.TEXTURE_2D_ARRAY,null));const o=this._state.textureUnitMap[n];o!=null&&r.bindTexture(o.descriptor.target,o.glName)}r.activeTexture(s8+this._state.activeTexture);const s=this._state.viewport;r.viewport(s.x,s.y,s.width,s.height),this.resetInfo()}_loadExtensions(){this.type===lr.WEBGL1&&this.gl.getExtension("OES_element_index_uint"),this.gl.getExtension("KHR_parallel_shader_compile")}};function Ul(t,e,r,i){return e?i!==e&&t.bindBuffer(r,e.glName):t.bindBuffer(r,null),e}function ehe(t,e){switch(t){case St.POINTS:return 2*e;case St.TRIANGLES:return e/3;case St.TRIANGLE_STRIP:case St.TRIANGLE_FAN:return e-2;default:return 0}}let ext=class extends Kwt{constructor(e,r,i){super(e,r),this.newCache=i,this._refCount=1,this._appleAmdDriverHelper=null}destroy(){--this._refCount>0||this.dispose()}ref(){++this._refCount}dispose(){super.dispose(),this._appleAmdDriverHelper?.dispose()}bindTechnique(e,r,i,s){return this.useProgram(e.program),e.bindPipelineState(this,i?.slot,!!s),e.program.bindPass(r,i),e.program}get appleAmdDriverHelper(){return this.driverTest.drawArraysRequiresIndicesTypeReset.result?(this._appleAmdDriverHelper=this._appleAmdDriverHelper??new vOe(this),this._appleAmdDriverHelper):null}get test(){return this.programCache.test}},ZT=class extends Te{constructor(e,r,i){super({}),this._stage=e,this._techniqueRepository=r,this._rctx=i,this._textures=new Map,this._loadingCount=0,this._frameUpdates=new Map,this.events=new os,this._frameTask=e.view.resourceController.scheduler.registerTask(dt.TEXTURE_UNLOAD)}normalizeCtorArgs(){return{}}destroy(){this._frameTask.remove(),this._stage.forEachOfType(ss.Texture,e=>e.unload())}get updating(){return this._loadingCount>0||this._frameTask.updating}get textureTechnique(){return this._textureTechnique==null&&(this._textureTechnique=this._techniqueRepository.acquire(nJ,new oJ)),this._textureTechnique}acquire(e){const r=this._textures.get(e);return r?(r.ref(),r.loadingPromise??r):this._createNewRef(e)}update(){let e=!1;this._frameUpdates.forEach(r=>{const i=r.texture.frameUpdate(r.previousToken);i>=0&&i!==r.previousToken&&(r.previousToken=i,e=!0)}),e&&this.events.emit("changed",ds.BACKGROUND)}_createNewRef(e){const r=this._stage.getObject(e);if(r==null)return et(r!==void 0),null;const i=r.events.on("unloaded",()=>{i.remove(),this._onTextureUnloaded(e)}),s=new txt(e,()=>{this._frameTask.schedule(()=>{s.isUnreferenced&&r.unload()})});return this._textures.set(e,s),s.ref(),r.glTexture!=null?(this._updateGLTexture(s,r.glTexture),r.requiresFrameUpdates&&this._frameUpdates.set(e,{texture:r,previousToken:-1}),s):(this._loadingCount++,s.loadingPromise=this._stage.schedule(()=>{const n=r.load(this._rctx),o=l=>(this._loadingCount--,s.loadingPromise=null,this._updateGLTexture(s,l),r.requiresFrameUpdates&&this._frameUpdates.set(e,{texture:r,previousToken:-1}),s),a=l=>(this._loadingCount--,s.loadingPromise=null,ms(l)||Q.getLogger(this).error(l),null);return bu(n)?n.then(o,a):o(n)}),s.loadingPromise)}_updateGLTexture(e,r){e.glTexture=r,this.events.emit("changed",ds.UPDATE)}_onTextureUnloaded(e){this._textures.delete(e),this._frameUpdates.delete(e)}};u([d()],ZT.prototype,"_loadingCount",void 0),u([d()],ZT.prototype,"_frameTask",void 0),u([d()],ZT.prototype,"updating",null),ZT=u([R("esri.views.3d.webgl-engine.lib.TextureRepository")],ZT);let txt=class{constructor(e,r){this.id=e,this._release=r,this._refCount=0}get isUnreferenced(){return this._refCount===0}ref(){++this._refCount}release(){--this._refCount,this._refCount>0||(this._refCount!==0?(Q.getLogger("esri.views.3d.webgl-engine.lib.TextureRepository.RefCountedTextureImpl").error("Cannot dereference texture that has no references!"),this._refCount=0):this._release())}};function rxt(t,e){return new aEe(r=>mlt(r,t),r=>r,e)}let f3=class extends Te{constructor(){super(...arguments),this._passParameters=new ixt,this._loading=0}get passParameters(){return this._passParameters}destroy(){this._passParameters.waveNormal=Ue(this._passParameters.waveNormal),this._passParameters.wavePertubation=Ue(this._passParameters.wavePertubation)}get updating(){return this._loading>0}ensureResources(e){if(this._loading>0)return wg.LOADING;if(this._passParameters.waveNormal!=null&&this._passParameters.wavePertubation!=null)return wg.LOADED;const r=new vr;return r.samplingMode=Ct.LINEAR_MIPMAP_LINEAR,r.hasMipmap=!0,r.maxAnisotropy=8,++this._loading,Gg(kr("esri/images/materials/water/normals.jpg")).then(i=>this._passParameters.waveNormal=new Et(e,{...r,width:i.width,height:i.height},i)).catch(i=>Q.getLogger(this).error("Failed to load water material normal texture.",i)).finally(()=>--this._loading),++this._loading,Gg(kr("esri/images/materials/water/perturbation.jpg")).then(i=>this._passParameters.wavePertubation=new Et(e,{...r,width:i.width,height:i.height},i)).catch(i=>Q.getLogger(this).error("Failed to load water material pertubation texture.",i)).finally(()=>--this._loading),wg.LOADING}};u([d()],f3.prototype,"_loading",void 0),u([d({type:Boolean,readOnly:!0})],f3.prototype,"updating",null),f3=u([R("esri.views.3d.webgl-engine.materials.internal.WaterTextureRepository")],f3);let ixt=class extends ei{};const the=2048,sxt=1.5,nxt=8;function oxt(t,e){const{format:r,quality:i,rotation:s,disableDecorations:n}=t||{},o=jJ(t,e.padding),a=pxt(t,{width:e.width-o.left-o.right,height:e.height-o.top-o.bottom}),{width:l,height:c}=dxt(t,a),h=gxt(r),p=wxt[h];return{format:h,quality:ge(i??p,0,100),area:a,width:l,height:c,rotation:s,disableDecorations:!!n,ignoreBackground:!(!t||!t.ignoreBackground),ignorePadding:!(!t||!t.ignorePadding)}}function axt(t,e){const r=oxt(t,e),i=r.area,s=r.width/i.width,n=jJ(r,e.padding),o=n.left+n.right,a=n.top+n.bottom,l=e.width-o,c=e.height-a,h=Math.floor(l*s+o),p=Math.floor(c*s+a),f=t&&t.layers?t.layers:[],m=r.ignoreBackground,y=r.ignorePadding;return{framebufferWidth:h,framebufferHeight:p,region:{x:Math.floor(i.x*s)+n.left,y:Math.floor(i.y*s)+n.top,width:r.width,height:r.height},format:r.format,quality:r.quality,rotation:r.rotation,pixelRatio:s,layers:f,disableDecorations:r.disableDecorations,ignoreBackground:m,ignorePadding:y,objectAndLayerIdColor:!1}}function Ok(t,e,r){const{ctx:i,canvas:s}=SOe(t,r),n=i.getImageData(0,0,t.width,t.height),o=cxt(s,e);return EOe(s),{dataUrl:o,data:n}}function Rk(t,e){const{ctx:r,canvas:i}=SOe(t,e),s=r.getImageData(0,0,t.width,t.height);return EOe(i),s}function SOe(t,e){const r=lxt();e.premultipliedAlpha&&_xt(t),r.width=t.width,r.height=t.height;const i=r.getContext("2d",{willReadFrequently:!0});return i.putImageData(t,0,0),e.flipY&&yxt(i),{ctx:i,canvas:r}}function EOe(t){t.width=0,t.height=0}function lxt(){return Pk==null&&(Pk=document.createElement("canvas")),Pk}let Pk=null;function cxt(t,e){const r=vxt[e.format],i=e.quality/100;return t.toDataURL(r,i)}function uxt(t,e,r,i=0,s=0,n=t.width-i,o=t.height-s,a=!1){const{data:l}=t,{width:c,height:h,data:p}=e,f=n/c,m=o/h,y=Math.ceil(f/2),_=Math.ceil(m/2),v=t.width;for(let w=0;w<h;w++)for(let x=0;x<c;x++){const T=4*(x+(a?h-w-1:w)*c);let S=0,O=0,A=0,I=0,M=0,k=0;const L=(w+.5)*m;for(let D=Math.floor(w*m);D<(w+1)*m;D++){const U=Math.abs(L-(D+.5))/_,X=(x+.5)*f,W=U*U;for(let G=Math.floor(x*f);G<(x+1)*f;G++){const Y=Math.abs(X-(G+.5))/y,P=Math.sqrt(W+Y*Y);if(P>=1)continue;let V=2*P*P*P-3*P*P+1;const z=4*(i+G+(s+D)*v);k+=V*l[z+3],O+=V,!r&&l[z+3]<255&&(V=V*l[z+3]/255),A+=V*l[z],I+=V*l[z+1],M+=V*l[z+2],S+=V}}p[T]=A/S,p[T+1]=I/S,p[T+2]=M/S,p[T+3]=k/O}return e}function hxt(t,e,r){if(!e)return t;const{framebufferWidth:i,framebufferHeight:s,pixelRatio:n,region:o}=t,a=jJ(t,r),l=a.left+a.right,c=a.top+a.bottom,h=i-l,p=s-c,f=Math.min(nxt,Math.min((the-l)/h,(the-c)/p));return f<sxt?t:{...t,framebufferWidth:Math.round(h*f)+l,framebufferHeight:Math.round(p*f)+c,pixelRatio:n*f,resample:{region:{x:Math.round((o.x-a.left)*f)+a.left,y:Math.round((o.y-a.top)*f)+a.top,width:Math.round(o.width*f),height:Math.round(o.height*f)},width:i,height:s}}}function dxt(t,e){if(!t)return e;const r=t.width,i=t.height;if(r!=null&&i!=null)return{width:Math.floor(r),height:Math.floor(i)};if(r==null&&i==null)return e;const s=e.width/e.height;return i==null?{width:Math.floor(r),height:Math.floor(r/s)}:{width:Math.floor(i*s),height:Math.floor(i)}}function pxt(t,e){const r={x:0,y:0,width:e.width,height:e.height};if(t&&t.area){t.area.x!=null&&(r.x=Math.floor(t.area.x)),t.area.y!=null&&(r.y=Math.floor(t.area.y));const i=t.area.width!=null?Math.floor(t.area.width):null,s=t.area.height!=null?Math.floor(t.area.height):null;if(r.width=e.width-r.x,r.height=e.height-r.y,i!=null&&s!=null)r.width=Math.min(r.width,i),r.height=Math.min(r.height,s);else if(i==null&&s!=null){const n=Math.min(r.width,i);r.height=n/r.width*r.height,r.width=n}else if(i!=null&&s==null){const n=Math.min(r.height,s);r.width=n/r.height*r.width,r.height=n}}return fxt(mxt(r,t),e)}function fxt(t,e){const r=Math.floor(Math.max(t.x,0)),i=Math.floor(Math.max(t.y,0)),s={x:r,y:i,width:Math.floor(Math.min(t.width,e.width-r)),height:Math.floor(Math.min(t.height,e.height-i))},n=s.width/s.height,o=t.width/t.height;if(o===n)return s;if(o>n){const c=Math.floor(s.width/o),h=s.height-c;return{x:s.x,y:Math.floor(s.y+h/2),width:s.width,height:c}}const a=Math.floor(s.height*o),l=s.width-a;return{x:Math.floor(s.x+l/2),y:s.y,width:a,height:s.height}}function mxt(t,e){if(!e||e.width==null||e.height==null)return t;const r=e.width/e.height,i=t.width/t.height;if(i===r)return t;if(i<r){const n=Math.floor(t.height*r);return t.x-=(n-t.width)/2,t.width=n,t}const s=Math.floor(t.width/r);return t.y-=(s-t.height)/2,t.height=s,t}function jJ(t,e){return!e||t&&t.ignorePadding?xxt:e}function gxt(t){switch(t){case"png":case"jpg":case"jpeg":return t;default:return bxt}}function yxt(t){t.save(),t.globalCompositeOperation="copy",t.scale(1,-1),t.translate(0,-t.canvas.height),t.drawImage(t.canvas,0,0),t.restore()}function _xt(t){const e=t.data,r=e.length;for(let i=0;i<r;i+=4){const s=e[i+3];if(s!==255&&s>0){const n=255/s;e[i]=e[i]*n,e[i+1]=e[i+1]*n,e[i+2]=e[i+2]*n}}}const vxt={png:"image/png",jpg:"image/jpeg",jpeg:"image/jpeg"},rhe=98,bxt="png",wxt={png:100,jpg:rhe,jpeg:rhe},xxt={top:0,right:0,bottom:0,left:0};let Txt=class{constructor(e,r){this.parameters=e,this.frameHasDecorations=r}},Sxt=class{constructor(e,r,i,s){this._rctx=e,this._renderFunctions=r,this._forceCameraHook=i,this._disposeOffscreenBuffers=s,this.supersample=!0,this._screenshotQueue=new Array}destroy(){this._rctx=null}async takeScreenshot(e){await this._renderFunctions.prepareOverlay(),this._renderFunctions.requestRenderScene(ds.BACKGROUND);const r=qs();return this._screenshotQueue.push({settings:e,resolver:r}),r.promise}update(e,r){for(const i of this._screenshotQueue){if(this._rctx==null){i.resolver.reject();continue}const s={...i.settings,pixelRatio:i.settings.pixelRatio*e.parameters.camera.pixelRatio},n=this._renderScreenshot(e,s,r);i.resolver(n)}this._screenshotQueue.length=0}_renderScreenshotOverlay(e,r,i){e.width=r.width,e.height=r.height;const s=e.getContext("2d"),n=i.pixelRatio;return s.save(),s.translate(0,r.height),s.scale(1,-1),i.region&&s.translate(-i.region.x,-i.region.y),s.scale(n,n),r=this._renderFunctions.renderOverlay(e,r),s.restore(),r}_readbackScreenshot(e,r){return e.resample?this._readbackScreenshotResampled({...e,resample:e.resample},r):this._readbackScreenshotImmediate(e,r)}_readbackScreenshotResampled(e,r){const{framebufferWidth:i,framebufferHeight:s,region:n,resample:o}=e,a=this._ensureScreenshotEncodeCanvas();let l=R9(i,s,a);this._rctx.gl.readPixels(0,0,i,s,Tt.RGBA,Ke.UNSIGNED_BYTE,new Uint8Array(l.data.buffer)),r(),l=this._renderScreenshotOverlay(a,l,{...e,region:void 0});const c=R9(n.width,n.height,a);return uxt(l,c,!0,o.region.x,s-(o.region.y+o.region.height),o.region.width,o.region.height)}_readbackScreenshotImmediate(e,r){const{framebufferHeight:i,region:s}=e,n=this._ensureScreenshotEncodeCanvas(),o=R9(s.width,s.height,n);return this._rctx.gl.readPixels(s.x,i-(s.y+s.height),s.width,s.height,Tt.RGBA,Ke.UNSIGNED_BYTE,new Uint8Array(o.data.buffer)),r(),this._renderScreenshotOverlay(n,o,e)}_renderScreenshot(e,r,i){let s=null;const n=e.parameters.camera,o={width:r.framebufferWidth,height:r.framebufferHeight};_b(o,Math.min(this._rctx.parameters.maxTextureSize,this._rctx.parameters.maxRenderbufferSize));let a=!1;const l=r.disableDecorations&&e.frameHasDecorations,c=o.width!==n.fullWidth||o.height!==n.fullHeight,h=r.ignorePadding&&n.pixelRatio!==r.pixelRatio,p=c||l||h||r.objectAndLayerIdColor,f=r.objectAndLayerIdColor?new hn(this._rctx,new vr(o.width,o.height),new r4(js.DEPTH_STENCIL,o.width,o.height)):null;if(p){const v=n.clone();if(r.ignorePadding){const O=VR(v.padding);for(let A=0;A<4;A++)O[A]=Math.round(O[A]/v.pixelRatio*r.pixelRatio);v.padding=O}v.fullWidth=o.width,v.fullHeight=o.height,v.pixelRatio=r.pixelRatio;const w=n.fovX-v.fovX,x=n.fovY-v.fovY;w<0&&w<x?v.fovX=n.fovX:x<0&&x<w&&(v.fovY=n.fovY);const T={camera:v,contentCamera:v,mode:$r.IDLE,alignPixelEnabled:!0,contentPixelRatio:v.pixelRatio};this._forceCameraHook(T),a=!0,s=new hn(this._rctx,new vr(o.width,o.height),new r4(js.DEPTH_STENCIL,o.width,o.height));const S=r.disableDecorations?aw.OFF:aw.ON;this._renderFunctions.renderScene(s,f,T,S,i),this._disposeOffscreenBuffers()}const m=()=>{this._rctx.bindFramebuffer(null),Ue(s)},y=this._readbackScreenshot(r,m);m();let _=null;if(r.objectAndLayerIdColor){const v=()=>{this._rctx.bindFramebuffer(null),Ue(f)};this._rctx.bindFramebuffer(f),_=this._readbackScreenshot(r,v),this._rctx.bindFramebuffer(null),v()}if(p&&!this._rctx.contextAttributes.alpha)for(let v=3;v<y.data.length;v+=4)y.data[v]=255;if(_&&!this._rctx.contextAttributes.alpha)for(let v=3;v<_.data.length;v+=4)_.data[v]=255;return a&&this._forceCameraHook(e.parameters),[y,_]}_ensureScreenshotEncodeCanvas(){return this._screenshotEncodeCanvas||(this._screenshotEncodeCanvas=document.createElement("canvas")),this._screenshotEncodeCanvas}},Bn=class extends Te{constructor(t){super({}),this.events=new os,this.waterTextureRepository=new f3,this._magnifierHelper=new WT,this.objectAndLayerIdRenderHelper=oe("enable-feature:objectAndLayerId-rendering")?new E1t:null,this._needsUpdate=!0,this._needsRender=!0,this._idleSuspend=!0,this._needsWaterReflectionUpdate=!1,this._lastAnimationUpdate=0,this._container=t.container,this._viewingMode=t.viewingMode,this._initializeContext(t),this.addHandles([le(()=>this.waterTextureRepository?.updating,()=>this.requestRender(),Vr),le(()=>t.view.qualityProfile,i=>this.renderer?.updateRenderFeature(i),As),this._magnifierHelper.events.on("request-render",()=>this.requestRender())]);const{memoryController:e}=t.view.resourceController;this.stippleTextureRepository=nlt(this._rctx,e),this.markerTextureRepository=rxt(this._rctx,e),this._shaderTechniqueRepository=new tEe({rctx:this._rctx,viewingMode:t.viewingMode,stippleTextureRepository:this.stippleTextureRepository,waterTextureRepository:this.waterTextureRepository,markerTextureRepository:this.markerTextureRepository}),this._textureRepository=new ZT(t,this._shaderTechniqueRepository,this._rctx),this.addHandles(this._textureRepository.events.on("changed",i=>this.requestRender(i))),this._materialRepository=new rEe(this._textureRepository,this._shaderTechniqueRepository,()=>this.requestRender(),()=>this.requestRender()),this._compositingHelper=new i1t(this._rctx,this._shaderTechniqueRepository),this.renderer=new ql(t,this._materialRepository,this._textureRepository,this._shaderTechniqueRepository,this._rctx,this._compositingHelper,this._magnifierHelper,i=>this.requestRender(i));const r={renderScene:(i,s,n,o,a)=>this.renderer.render(i,s,n,o,a),requestRenderScene:i=>this.requestRender(i),prepareOverlay:()=>t.options.screenshot.prepareOverlay(),renderOverlay:(i,s)=>t.options.screenshot.renderOverlay(i,s)};this._screenshotManager=new Sxt(this._rctx,r,i=>this.events.emit("force-camera-for-screenshot",i),()=>this.renderer.disposeOffscreenBuffers()),this._registerFrameTask(t)}normalizeCtorArgs(){return{}}destroy(){this._container.contains(this._canvas)&&this._container.removeChild(this._canvas),this._frameTask=Ii(this._frameTask),this._shaderTechniqueRepository=Me(this._shaderTechniqueRepository)}requestRender(t=ds.UPDATE){this._needsRender=!0,t===ds.UPDATE&&(this._needsUpdate=!0)}get updating(){return this._needsUpdate||this._needsWaterReflectionUpdate||this.renderer.updating||this._textureRepository.updating||this.waterTextureRepository.updating||this._magnifierHelper.updating}get textureRepository(){return this._textureRepository}get compositingHelper(){return this._compositingHelper}set magnifier(t){this._magnifierHelper.magnifier=t}setIdleSuspend(t){this._idleSuspend!==t&&(this._idleSuspend=t,this.requestRender())}get renderingContext(){return this._rctx}get capabilities(){return this._rctx.capabilities}get canvas(){return this._canvas}takeScreenshot(t){return this._screenshotManager.takeScreenshot(t).then(e=>e[0])}takeScreenshotWithOID(t){return t.objectAndLayerIdColor=!0,this._screenshotManager.takeScreenshot(t)}getAlpha(){return!!this._rctx.contextAttributes.alpha}getMinimalDepthForArea(t,e,r,i,s,n=s){const o=i.constrainWindowSize(e,r,s*i.pixelRatio,n*i.pixelRatio),a=this._ensureDepthBuffer(o);this.renderer.readDepthPixels(i,o,a);let l=Number.MAX_VALUE;for(let c=0;c<o[2]*o[3];c++){const h=l1t(4*c,a,i.nearFar);l>h&&h!==i.nearFar[0]&&h!==i.nearFar[1]&&(l=h)}if(t!=null){const c=t.pickDepth(e*i.pixelRatio,r*i.pixelRatio,i);c!=null&&l>c&&c!==i.nearFar[0]&&c!==i.nearFar[1]&&(l=c)}return l===Number.MAX_VALUE?void 0:l}_ensureDepthBuffer(t){const e=4*t[2]*t[3];return(this._tmpDepthBuffer==null||this._tmpDepthBuffer.byteLength<e)&&(this._tmpDepthBuffer=new Uint8Array(e)),this._tmpDepthBuffer}async reloadShaders(){RAe(),await this._shaderTechniqueRepository.reloadAll(),this.requestRender()}_registerFrameTask(t){const e=t.view.state;let r=!1,i=ds.BACKGROUND,s=!1;const n={preRender:({time:o})=>{r=this.updating,i=this._needsUpdate?ds.UPDATE:ds.BACKGROUND,t.commitSyncLayers();const a=o-this._lastAnimationUpdate;if(a>this.renderer.animationTimestep||e.forcedAnimationTime!=null||r||this._needsRender){const l=a/this.renderer.animationTimeDilation,c=new xSe(e.camera,l,e.forcedAnimationTime);this.renderer.updateAnimation(c)&&this.requestRender(ds.BACKGROUND),this._lastAnimationUpdate=o}},render:({time:o})=>{if((this._needsRender||!this._idleSuspend||!this.renderer.isCameraFinal||this._needsWaterReflectionUpdate)&&e.camera.fullWidth>0&&e.camera.fullHeight>0){const a=this._needsUpdate&&this._idleSuspend&&this.renderer.isCameraFinal;this._needsRender=!1,this._needsUpdate=!1,this._needsWaterReflectionUpdate=!1,this.renderer.render(null,null,e,aw.ON,o),s=!0,a&&this.renderer.hasReflections&&(this.requestRender(ds.BACKGROUND),this._needsWaterReflectionUpdate=!0)}},update:({time:o})=>{const a=new Txt(e,this.renderer.hasSlicePlane||this._magnifierHelper.enabled);this._textureRepository.update(),this._screenshotManager.update(a,o)},finish:()=>{s&&(this.renderer.finish(e.mode===$r.IDLE?i:ds.UPDATE),s=!1)}};this._frameTask=JS(n)}_initializeContext(t){const e=t.options;this._canvas=e.canvas,this._canvas||(this._canvas=document.createElement("canvas")),this._canvas.setAttribute("style","width: 100%; height:100%; display:block;");const r={alpha:e.alpha||!1,premultipliedAlpha:!0,antialias:!1,depth:!0,stencil:e.stencil??!0,powerPreference:"high-performance",preserveDrawingBuffer:e.preserveDrawingBuffer??!1},i=nJe("3d",this._canvas,r);i!=null?(this._rctx=this._newRenderingContext(i,t),this._loadShaderOnlyExtensions(),!e.alpha&&this._rctx.contextAttributes.alpha&&Q.getLogger(this).error("WebGL context has alpha channel even though no alpha channel was requested"),!this._rctx.contextAttributes.alpha&&oe("safari")>=11&&(this._container.style.backgroundColor="black"),this._container.appendChild(this._canvas)):Q.getLogger(this).error("A WebGL2 context could not be created.")}_newRenderingContext(t,e){const r={disabledExtensions:e.options.deactivatedWebGLExtensions||{},debugWebGLExtensions:e.options.debugWebGLExtensions||{},maxAnisotropy:8},i=(s,n)=>e.view.resourceController.memoryController.newCache(s,n);return new ext(t,r,i)}_loadShaderOnlyExtensions(){this._rctx.capabilities.enable("textureFloat")}getObjectAndLayerIdColor(t){return this.objectAndLayerIdRenderHelper!=null?this.objectAndLayerIdRenderHelper.getObjectAndLayerIdColor(t):null}get componentObjectCollection(){return this._componentObjectCollection==null&&(this._componentObjectCollection=new jvt(this.renderer.renderPassManager,this._viewingMode)),this._componentObjectCollection}set componentObjectCollection(t){this._componentObjectCollection=t}};u([d({type:Boolean,readOnly:!0})],Bn.prototype,"updating",null),u([d({autoDestroy:!0})],Bn.prototype,"_rctx",void 0),u([d({autoDestroy:!0})],Bn.prototype,"_container",void 0),u([d({autoDestroy:!0})],Bn.prototype,"_canvas",void 0),u([d({autoDestroy:!0})],Bn.prototype,"stippleTextureRepository",void 0),u([d({autoDestroy:!0})],Bn.prototype,"markerTextureRepository",void 0),u([d({autoDestroy:!0})],Bn.prototype,"waterTextureRepository",void 0),u([d({autoDestroy:!0})],Bn.prototype,"_magnifierHelper",void 0),u([d({readOnly:!0})],Bn.prototype,"objectAndLayerIdRenderHelper",void 0),u([d({autoDestroy:!0})],Bn.prototype,"_textureRepository",void 0),u([d({autoDestroy:!0})],Bn.prototype,"_compositingHelper",void 0),u([d({autoDestroy:!0,readOnly:!0})],Bn.prototype,"renderer",void 0),u([d({autoDestroy:!0})],Bn.prototype,"_screenshotManager",void 0),u([d()],Bn.prototype,"componentObjectCollection",null),u([d({autoDestroy:!0})],Bn.prototype,"_componentObjectCollection",void 0),u([d()],Bn.prototype,"_needsUpdate",void 0),u([d()],Bn.prototype,"_needsWaterReflectionUpdate",void 0),Bn=u([R("esri.views.3d.webgl-engine.parts.RenderView")],Bn);let Gc=class extends Te{constructor(e){super(e),this._model=new xD,this._layers=new kt,this._asyncChangeSet=new gH,this._syncChangeSet=new gH,this._layerSyncSet=new Set}initialize(){this._set("renderView",new Bn(this)),this._frameTask=this.view.resourceController.scheduler.registerTask(dt.STAGE,this),this.addHandles(this._frameTask)}destroy(){this.removeAllHandles()}get viewingMode(){return this.view.state.viewingMode}get updating(){return this.running||this.renderView.updating||this._frameTask.updating}get renderer(){return this.renderView?.renderer}add(e){this._model.add(e),$4(e)&&this._addLayer(e),this.renderView.requestRender()}remove(e){e==null||this.destroyed||(this._model.remove(e),$4(e)&&this._removeLayer(e),this.renderView.requestRender())}addMany(e){e!=null&&(this._model.addMany(e),this.renderView.requestRender())}removeMany(e){e!=null&&(this._model?.removeMany(e),this.renderView?.requestRender())}async load(e,r){e!=null&&(Array.isArray(e)||(e=[e]),await Promise.all(e.filter(i=>i.glTexture==null).map(i=>this.schedule(()=>this._model.has(i)?i.load(this.renderView.renderingContext):null),r)))}loadImmediate(e){return e.load(this.renderView.renderingContext)}forEachOfType(e,r){this._model.forEachOfType(e,r)}handleEvent(e,r){this.destroyed||(this._model.dirtySet[e](r),this.renderView.requestRender())}get running(){return this._model.dirtySet.dirty||!this._asyncChangeSet.empty}runTask(e){this._frameTask.processQueue(e),this._commit(e)}_commit(e){const r=this._model.dirtySet;this._asyncChangeSet.empty||e.done||(this.renderer.modify(this._asyncChangeSet,e),this.renderView.requestRender(),e.madeProgress()),this._layers.forAll(i=>{if(e.done)return;const s=this._layerSyncSet.has(i.id)||i.updatePolicy===v_.SYNC,n=s?this._syncChangeSet:this._asyncChangeSet;r.commitLayer(i.id,n),this._layerSyncSet.delete(i.id),n.empty||(this.renderer.modify(n,s?za:e),this.renderView.requestRender(),e.madeProgress())}),this._syncChangeSet.empty||(this.renderer.modify(this._syncChangeSet,za),this.renderView.requestRender(),e.madeProgress()),this._layers.forAll(i=>{e.done||this._layerSyncSet.has(i.id)||i.updatePolicy!==v_.ASYNC||(r.commitLayer(i.id,this._asyncChangeSet),this._asyncChangeSet.empty||(this.renderer.modify(this._asyncChangeSet,e),this.renderView.requestRender(),e.madeProgress()))}),this._layerSyncSet.clear(),this.notifyChange("running")}commitSyncLayers(){const e=this._model.dirtySet;this._layers.forAll(r=>{(this._layerSyncSet.has(r.id)||r.updatePolicy===v_.SYNC)&&(e.commitLayer(r.id,this._syncChangeSet),this._layerSyncSet.delete(r.id))});for(const r of this._layerSyncSet)e.commitLayer(r,this._syncChangeSet);this._layerSyncSet.clear(),this._syncChangeSet.empty||(this.renderer.modify(this._syncChangeSet,za),this.renderView.requestRender())}_commitLayer(e){this._model.dirtySet.commitLayer(e.id,this._syncChangeSet),this._layerSyncSet.delete(e.id),this._syncChangeSet.empty||(this.renderer.modify(this._syncChangeSet,za),this.renderView.requestRender())}schedule(e,r){return this._frameTask.schedule(e,r)}reschedule(e,r){return this._frameTask.reschedule(e,r)}syncLayer(e){this._layerSyncSet.add(e),this.renderView.requestRender()}getObject(e){return this._model.getObject(e)}get layers(){return this._layers}_addLayer(e){this._layers.includes(e)||this._layers.push(e)}_removeLayer(e){this._commitLayer(e),this._layers.removeUnordered(e)!=null&&(this._model.dirtySet.getResidentRenderGeometries(e.id,this._syncChangeSet.removes),this.renderer.modify(this._syncChangeSet,za))}addRenderPlugin(e,r,i){const s=this.renderer.renderPlugins.add(e,r,i),n=()=>{Hae(r)&&this.view.sceneIntersectionHelper.addIntersectionHandler(r)};if(bu(s))return s.then(n);n()}removeRenderPlugin(e){this.destroyed||(Hae(e)&&this.view.sceneIntersectionHelper.removeIntersectionHandler(e),this.renderer.renderPlugins.remove(e))}get performanceInfo(){return{renderer:this.renderer.performanceInfo,model:this._model.getStats()}}get test(){const e=this;return{getCount:r=>e._model.test.content.filter(i=>i.type===r).length,model:e._model}}};Gc.DebugSettings={endFrameContentValidation:!1},u([d({constructOnly:!0})],Gc.prototype,"view",void 0),u([d({constructOnly:!0})],Gc.prototype,"options",void 0),u([d({readOnly:!0})],Gc.prototype,"viewingMode",null),u([d({constructOnly:!0})],Gc.prototype,"container",void 0),u([d({readOnly:!0})],Gc.prototype,"updating",null),u([d({constructOnly:!0})],Gc.prototype,"_model",void 0),u([d({autoDestroy:!0})],Gc.prototype,"renderView",void 0),u([d({readOnly:!0})],Gc.prototype,"renderer",null),u([d({readOnly:!0})],Gc.prototype,"running",null),Gc=u([R("esri.views.3d.webgl-engine.Stage")],Gc);let p8t=class extends X5{constructor(e,r,i,s){super(r,i),this.point=e,this.createGraphic=s}};function COe(t){return fp(t)&&t.intersector===ki.PCL&&!!t.target}let m8t=class extends Hxe{constructor(e,r,i,s,n){super(e),this.layerUid=e,this.sublayerUid=r,this.nodeIndex=i,this.componentIndex=s,this.triangleNr=n}},y8t=class extends X5{constructor(e,r,i){super(r,null),this.point=e,this.createVoxelGraphic=i}};function F6(t){return fp(t)&&t.intersector===ki.I3S&&!!t.target}function AOe(t){return fp(t)&&t.intersector===ki.VOXEL&&!!t.target}function ihe(t,e){return Y5(t)||J5(t)?gR(t.target?.object,e):Nlt(t)?e.map?.ground:COe(t)||F6(t)||TEe(t)||AOe(t)?gR(t.target,e):null}function v8t(t,e){const r=nq(t,e);return r!=null&&r.type==="graphic"?r.graphic:null}function nq(t,e){if(t==null)return null;if(Y5(t)||J5(t))return she(t.target?.object,e);if(COe(t)){const r=t.target.createGraphic();return{type:"graphic",graphic:r,layer:r.layer}}if(AOe(t)){const r=t.target.createVoxelGraphic();return{type:"graphic",graphic:r,layer:r.layer}}return TEe(t)||gJ(t)?she(t.target,e):F6(t)?Ext(t.target,e):null}function she(t,e){if(t==null||t.graphicUid==null)return null;const r=gR(t,e);if(r==null)return null;if(r===e.graphics)return e.graphicsView==null||typeof t.graphicUid!="number"?null:e.graphicsView.getHit(t.graphicUid);const i=e.allLayerViews.find(s=>s.layer===r);return!i||i.suspended||t.graphicUid==null?null:"getHit"in i?i.getHit(t.graphicUid):null}function Ext(t,e){const r=gR(t,e);if(r==null)return null;const i=e.allLayerViews.find(s=>s.layer===r);return i&&!i.suspended&&"getGraphicFromIntersectorTarget"in i?Axt(i.getGraphicFromIntersectorTarget(t)):null}function Cxt(t,e){const r=gR(t,e);if(r==null)return null;const i=e.allLayerViews.find(s=>s.layer===r);return i&&!i.suspended&&"getAABBFromIntersectorTarget"in i?i.getAABBFromIntersectorTarget(t):null}function Axt(t){return t!=null?{type:"graphic",graphic:t,layer:t.layer}:null}function gR(t,e){return t&&t.layerUid!=null?e.graphicsView!=null&&t.layerUid===e.graphicsView.processor.layer.id?e.graphics:e.map.findLayerByUid(t.layerUid):null}function b8t(t,e){if(Y5(t)||J5(t))return bg(t.target.object.boundingVolumeWorldSpace.bounds);if(gJ(t)){O0e(E$,t.transformation);const r=Math.max(E$[0],E$[1],E$[2]);return t.target.baseBoundingSphere.radius*r}return F6(t)?uc(Cxt(t.target,e),r=>.5*Pge(r)):null}function w8t(t){return!Y5(t)&&!J5(t)&&(gJ(t)?t.target.numLodLevels>1:!!F6(t))}const E$=C();let Mk,Ik;function Oxt(t){const e=Pwe(t);for(;e.length>1;){const r=nhe(e.shift());if(r.available)return r}return nhe(e.shift())}function nhe(t){switch(t){case lr.WEBGL1:return Rxt();case lr.WEBGL2:return Pxt()}}function Rxt(){return Mk||(Mk=$xt()),Mk}function Pxt(){return Ik||(Ik=Lxt()),Ik}let OOe=class{constructor(){this.available=!1,this.majorPerformanceCaveat=!1,this.maxTextureSize=0,this.supportsVertexShaderSamplers=!1,this.supportsHighPrecisionFragment=!1,this.supportsElementIndexUint=!1,this.supportsStandardDerivatives=!1,this.supportsInstancedArrays=!1,this.supportsTextureFloat=!1,this.supportsTextureHalfFloat=!1,this.supportsColorBufferFloat=!1,this.supportsColorBufferFloatBlend=!1,this.supportsColorBufferHalfFloat=!1}},Mxt=class extends OOe{constructor(){super(...arguments),this.type=lr.WEBGL1}},Ixt=class extends OOe{constructor(){super(...arguments),this.type=lr.WEBGL2,this.supportsElementIndexUint=!0,this.supportsStandardDerivatives=!0,this.supportsInstancedArrays=!0,this.supportsTextureFloat=!0,this.supportsTextureHalfFloat=!0}};function ROe(t,e){if(t===lr.WEBGL1&&typeof WebGLRenderingContext>"u"||t===lr.WEBGL2&&typeof WebGL2RenderingContext>"u")return null;const r=document.createElement("canvas");if(!r)return null;let i=VG(r,t,{failIfMajorPerformanceCaveat:!0});if(i==null&&(i=VG(r,t),i!=null&&(e.majorPerformanceCaveat=!0)),i==null)return i;if(t===lr.WEBGL1){const n=i.getParameter(i.VERSION),o=n?.match(/^WebGL\s+([\d.]*)/);if(o){const a=parseFloat(o[1]);e.available=a>=.94}}else e.available=!0;e.maxTextureSize=i.getParameter(i.MAX_TEXTURE_SIZE),e.supportsVertexShaderSamplers=i.getParameter(i.MAX_VERTEX_TEXTURE_IMAGE_UNITS)>0;const s=i.getShaderPrecisionFormat(i.FRAGMENT_SHADER,i.HIGH_FLOAT);return s&&(e.supportsHighPrecisionFragment=s.precision>0),i}function $xt(){const t=new Mxt,e=ROe(lr.WEBGL1,t);return e==null||(t.supportsElementIndexUint=e.getExtension("OES_element_index_uint")!==null,t.supportsStandardDerivatives=e.getExtension("OES_standard_derivatives")!==null,t.supportsInstancedArrays=e.getExtension("ANGLE_instanced_arrays")!==null,t.supportsTextureFloat=e.getExtension("OES_texture_float")!==null,t.supportsTextureHalfFloat=e.getExtension("OES_texture_half_float")!==null,t.supportsColorBufferFloat=e.getExtension("WEBGL_color_buffer_float")!==null,t.supportsColorBufferFloatBlend=e.getExtension("EXT_float_blend")!==null,t.supportsColorBufferHalfFloat=e.getExtension("EXT_color_buffer_half_float")!==null),t}function Lxt(){const t=new Ixt,e=ROe(lr.WEBGL2,t);return e==null||(t.supportsColorBufferFloat=e.getExtension("EXT_color_buffer_float")!==null,t.supportsColorBufferFloatBlend=e.getExtension("EXT_float_blend")!==null,t.supportsColorBufferHalfFloat=t.supportsColorBufferFloat||e.getExtension("EXT_color_buffer_half_float")!==null),t}function Dxt(t){const e=Oxt(t);if(!e.available)return new F("webgl:required",t==="3d"?"WebGL2 is required but not supported.":"WebGL is required but not supported.",new Error().stack);if(t==="3d"&&e.majorPerformanceCaveat)return new F("webgl:major-performance-caveat-detected","Your WebGL implementation doesn't seem to support hardware accelerated rendering. Check your browser settings or if your GPU is in a blocklist.");if(!e.supportsHighPrecisionFragment)return new F("webgl:high-precision-fragment-required","WebGL support for high precision fragment shaders is required but not supported.");if(!e.supportsVertexShaderSamplers)return new F("webgl:vertex-shader-samplers-required","WebGL support for vertex shader samplers is required but not supported.");if(e.type===lr.WEBGL1){if(!e.supportsElementIndexUint)return new F("webgl:element-index-uint-required","WebGL support for uint vertex indices is required but not supported.");if(!e.supportsStandardDerivatives)return new F("webgl:standard-derivatives-required","WebGL support for standard derivatives is required but not supported.");if(!e.supportsInstancedArrays)return new F("webgl:instanced-arrays-required","WebGL support for instanced rendering is required but not supported.")}return null}function Nxt(t){return t&&"nodeType"in t}function Fxt(t){return t&&typeof t.render=="function"}const ohe={component:"esri-component"};let H1=class extends Te{constructor(){super(...arguments),this.widget=null}destroy(){this.node=null,this.widget?.destroy()}get id(){return this.get("widget.id")||this.get("node.id")}set node(e){const r=this._get("node");e!==r&&(e&&e.classList.add(ohe.component),r&&r.classList.remove(ohe.component),this._set("node",e))}castNode(e){return this.widget?.destroy(),e?typeof e=="string"||Nxt(e)?(this._set("widget",null),LF(e)):(Fxt(e)&&!e.domNode&&(e.domNode=document.createElement("div")),this._set("widget",e),e.domNode):(this._set("widget",null),null)}};u([d({dependsOn:[]})],H1.prototype,"id",null),u([d()],H1.prototype,"node",null),u([yr("node")],H1.prototype,"castNode",null),u([d({readOnly:!0})],H1.prototype,"widget",void 0),H1=u([R("esri.views.ui.Component")],H1);const CD=H1,Uxt={left:0,top:0,bottom:0,right:0},POe={bottom:30,top:15,right:15,left:15},Cm="esri-ui",kl={ui:Cm,corner:`${Cm}-corner`,innerContainer:`${Cm}-inner-container`,manualContainer:`${Cm}-manual-container`,cornerContainer:`${Cm}-corner-container`,topLeft:`${Cm}-top-left`,topRight:`${Cm}-top-right`,bottomLeft:`${Cm}-bottom-left`,bottomRight:`${Cm}-bottom-right`};function kxt(t){return t&&!t._started&&typeof t.postMixInProperties=="function"&&typeof t.buildRendering=="function"&&typeof t.postCreate=="function"&&typeof t.startup=="function"}function C$(t){return t===0?"0":`${t}px`}function $k(t){const e=typeof t=="object"&&t!==null&&Object.getPrototypeOf(t);return(e===null||e===Object.prototype)&&("component"in t||"index"in t||"position"in t)?t:null}function Lk(t,{top:e,bottom:r,left:i,right:s}){t.style.top=e,t.style.bottom=r,t.style.left=i,t.style.right=s}let of=class extends os.EventedAccessor{constructor(t){super(t),this._cornerNameToContainerLookup={},this._positionNameToContainerLookup={},this._components=new Array,this._componentMap=new Map,this._locale=_h(),this.view=null,this._applyViewPadding=()=>{const e=this.container;e&&Lk(e,this._toPixelPosition(this._getViewPadding()))},this._applyUIPadding=()=>{const e=this._innerContainer;e&&Lk(e,this._toPixelPosition(this.padding))},this._initContainers()}initialize(){this.addHandles([le(()=>[this.view?.padding,this.container],this._applyViewPadding,Vr),le(()=>this.padding,this._applyUIPadding,Vr),le(()=>[this.container,this._locale],([t,e])=>{t&&t.setAttribute("lang",e)},Vr),She(t=>{this._locale=t})])}destroy(){this.container=null;for(const t of this._components)t.destroy();this._components.length=0,this._componentMap.clear()}set container(t){const e=this._get("container");t!==e&&(t&&(t.classList.add(kl.ui),yje(t),this._attachContainers(t)),e&&(e.classList.remove(kl.ui),Lk(e,{top:"",bottom:"",left:"",right:""}),ome(e)),this._set("container",t))}get height(){const t=this.view?.height??0;if(t===0)return t;const e=this._getViewPadding(),{top:r,bottom:i}=e;return Math.max(t-r-i,0)}get padding(){return this._get("padding")}set padding(t){this._overrideIfSome("padding",t)}castPadding(t){return typeof t=="number"?{bottom:t,top:t,right:t,left:t}:{...POe,...t}}get width(){const t=this.view?.width??0;if(t===0)return t;const e=this._getViewPadding(),{left:r,right:i}=e;return Math.max(t-r-i,0)}add(t,e){let r,i,s;if(Array.isArray(t))return void t.forEach(o=>this.add(o,e));const n=$k(t);n&&({index:r,position:e,component:t,key:i}=n),e&&typeof e=="object"&&({index:r,key:i,position:e,internal:s}=e),!t||e&&!this._isValidPosition(e)||this._add(t,e,r,i,s)}remove(t,e){if(!t)return;if(Array.isArray(t))return t.map(i=>this.remove(i,e));const r=this._find(t);if(r){if(this._componentMap.has(t)&&this._componentMap.get(t)?.key!==e)return;const i=this._components.indexOf(r);return r.node.parentNode?.removeChild(r.node),this._componentMap.delete(t),this._components.splice(i,1)[0]}}empty(t,e={removeInternal:!1}){if(Array.isArray(t)){for(const s of t)this.empty(s,e);return}const r=this._positionNameToContainerLookup[t??"manual"],i=Array.prototype.slice.call(r.children).map(s=>this._findByNode(s)).filter(s=>s==null?!1:!(this._componentMap.get(s)?.internal??!1)||e.removeInternal);for(const s of i)this.remove(s)}move(t,e){if(Array.isArray(t)&&t.forEach(n=>this.move(n,e)),!t)return;let r;const i=$k(t)||$k(e);if(i&&(r=i.index,e=i.position,t=i.component||t),e&&!this._isValidPosition(e))return;const s=this.remove(t);s&&this.add(s,{position:e,index:r})}find(t){if(!t)return null;const e=this._findById(t);return e&&(e.widget||e.node)}getComponents(t,e={includeInternal:!1}){return t?Array.isArray(t)?t.map(r=>this._getComponentsAtPosition(r,e)).flat():this._getComponentsAtPosition(t,e):this._components.filter(r=>e.includeInternal||!this._componentMap.get(r)?.internal).map(({widget:r,node:i})=>r??i)}getPosition(t){for(const e in this._positionNameToContainerLookup)if(this._positionNameToContainerLookup[e].contains(t))return e;return null}_add(t,e,r,i,s){t instanceof CD||(t=new CD({node:t})),this._place({component:t,position:e,index:r}),this._components.push(t),this._componentMap.set(t,{key:i,internal:s})}_find(t){return t?t instanceof CD?this._findByComponent(t):typeof t=="string"?this._findById(t):this._findByNode(t.domNode||t):null}_getViewPadding(){return this.view?.padding??Uxt}_attachContainers(t){t.appendChild(this._innerContainer),t.appendChild(this._manualContainer)}_initContainers(){const t=document.createElement("div");t.classList.add(kl.innerContainer,kl.cornerContainer);const e=document.createElement("div");e.classList.add(kl.innerContainer,kl.manualContainer);const r=document.createElement("div");r.classList.add(kl.topLeft,kl.corner),t.appendChild(r);const i=document.createElement("div");i.classList.add(kl.topRight,kl.corner),t.appendChild(i);const s=document.createElement("div");s.classList.add(kl.bottomLeft,kl.corner),t.appendChild(s);const n=document.createElement("div");n.classList.add(kl.bottomRight,kl.corner),t.appendChild(n),this._innerContainer=t,this._manualContainer=e;const o=Sme();this._cornerNameToContainerLookup={"top-left":r,"top-right":i,"bottom-left":s,"bottom-right":n,"top-leading":o?i:r,"top-trailing":o?r:i,"bottom-leading":o?n:s,"bottom-trailing":o?s:n},this._positionNameToContainerLookup={manual:e,...this._cornerNameToContainerLookup}}_isValidPosition(t){return!!this._positionNameToContainerLookup[t]}_place(t){const e=t.position??"manual",{component:r,index:i}=t,s=this._positionNameToContainerLookup[e],n=i!=null&&i>-1;if(kxt(r.widget)&&r.widget.startup(),!n)return void s.appendChild(r.node);const o=Array.from(s.children);if(i===0)return void(s.firstChild?vK(r.node,s.firstChild):s.appendChild(r.node));i>=o.length?s.appendChild(r.node):vK(r.node,o[i])}_toPixelPosition(t){return{top:C$(t.top),left:C$(t.left),right:C$(t.right),bottom:C$(t.bottom)}}_findByComponent(t){return this._components.find(e=>e===t)??null}_findById(t){return this._components.find(({id:e})=>e===t)??null}_findByNode(t){return this._components.find(({node:e})=>e===t)??null}_getComponentsAtPosition(t,e){const r=this._positionNameToContainerLookup[t];return Array.prototype.slice.call(r.children).map(i=>this._findByNode(i)).filter(xw).filter(i=>e.includeInternal||!this._componentMap.get(i)?.internal).map(({widget:i,node:s})=>i??s)}};u([d()],of.prototype,"_locale",void 0),u([d()],of.prototype,"container",null),u([d()],of.prototype,"height",null),u([d({value:POe})],of.prototype,"padding",null),u([yr("padding")],of.prototype,"castPadding",null),u([d()],of.prototype,"view",void 0),u([d()],of.prototype,"width",null),of=u([R("esri.views.ui.UI")],of);const Vxt=of;function ahe(t,e){return t&&"copyright"in t&&(!e||typeof t.originOf=="function"&&t.originOf("copyright")==="user")}function zxt(t,e){return t.length!==e.length||t.some((r,i)=>r.text!==e[i].text)}function A$(t,e,r){!r||!e||t.find(i=>i.layerView===e&&i.text===r)||t.push({text:r,layerView:e})}function Bxt(t){return t.type==="bing-maps"}const Hy=[];let XT=class extends yO{constructor(t){super(t),this._clear=()=>{this._fetchedAttributionData.clear(),this._pendingAttributions.clear(),this.handles.remove("suspension"),this.notifyChange("state")},this._pendingAttributions=new Set,this._fetchedAttributionData=new Map,this.items=new Pt,this.view=null,this._allLayerViewsChange=e=>{this.handles.remove("suspension");const r=this.get("view.allLayerViews");r&&this.handles.add(r.map(i=>le(()=>[i.suspended,i.layer?.attributionVisible],()=>this._updateAttributionItems())),"suspension"),e&&e.removed&&e.removed.forEach(i=>{this._pendingAttributions.delete(i),this._fetchedAttributionData.delete(i)}),this._updateAttributionItems()},this.handles.add([Ga(()=>this.view?.allLayerViews,"change",e=>this._allLayerViewsChange(e),{onListenerAdd:()=>this._allLayerViewsChange(),onListenerRemove:this._clear}),Eh(()=>this.view?.stationary===!0,()=>this._updateAttributionItems())])}destroy(){this.view=null,this._fetchedAttributionData.clear(),this._pendingAttributions.clear(),this.items.removeAll()}get state(){return this.get("view.ready")?this._pendingAttributions.size>0?"loading":"ready":"disabled"}_updateAttributionItems(){const t=this.view,e=t?.allLayerViews;Hy.length=0,t&&e?(e.forEach(r=>{if(r.suspended||!r.layer?.attributionVisible)return;const i=r.layer;if(ahe(i,"user"))return void A$(Hy,r,i.copyright);if(i.hasAttributionData){if(this._fetchedAttributionData.has(r)){const n=this._fetchedAttributionData.get(r);return void(n?A$(Hy,r,this._getDynamicAttribution(n,t,i)):ahe(i)&&A$(Hy,r,i.copyright))}return void this._fetchAttributionData(r)}const s=i.get("portalItem.accessInformation");A$(Hy,r,s||i.copyright)}),zxt(this.items,Hy)&&(this.items.removeAll(),this.items.addMany(Hy)),Hy.length=0,this.notifyChange("state")):this._clear()}async _fetchAttributionData(t){if(this._pendingAttributions.has(t))return;this._pendingAttributions.add(t);const e=await gu(t.layer.fetchAttributionData());if(this._pendingAttributions.has(t)){const r=e.ok?this._createContributionIndex(e.value,Bxt(t.layer)):null;this._pendingAttributions.delete(t),this._fetchedAttributionData.set(t,r)}this._updateAttributionItems()}_createContributionIndex(t,e){const r=t.contributors,i={};if(!r)return i;for(let s=0;s<r.length;s++){const n=r[s],o=n.coverageAreas;if(!o)return;for(const a of o){const l=a.bbox,c=a.zoomMin-(e&&a.zoomMin?1:0),h=a.zoomMax-(e&&a.zoomMax?1:0),p=new _r({xmin:l[1],ymin:l[0],xmax:l[3],ymax:l[2],spatialReference:je.WGS84}),f={extent:T3(p),attribution:n.attribution||"",score:a.score!=null?a.score:100,id:s};for(let m=c;m<=h;m++)i[m]??(i[m]=[]),i[m].push(f)}}return i.maxKey=Math.max.apply(null,Object.keys(i)),i}_getDynamicAttribution(t,e,r){const{extent:i,scale:s}=e;let n=r.tileInfo?.scaleToZoom(s)??0;if(n=Math.min(t.maxKey??0,Math.round(n)),!i||n==null||n<=-1)return"";const o=t[n],a=Sw(i.center.clone().normalize(),e.spatialReference),l=new Set;return o?o.filter(c=>{const h=c.id,p=!l.has(h)&&a&&c.extent&&Jq(c.extent,a);return p&&l.add(h),p}).sort((c,h)=>h.score-c.score||c.objectId-h.objectId).map(c=>c.attribution).join(", "):""}};u([d({readOnly:!0,type:Pt})],XT.prototype,"items",void 0),u([d({readOnly:!0})],XT.prototype,"state",null),u([d()],XT.prototype,"view",void 0),XT=u([R("esri.widgets.Attribution.AttributionViewModel")],XT);const MOe=XT,Qx="esri-attribution",qy={base:`${Qx} esri-widget`,poweredBy:`${Qx}__powered-by`,sources:`${Qx}__sources`,open:`${Qx}--open`,sourcesOpen:`${Qx}__sources--open`,link:`${Qx}__link`,widgetIcon:"esri-icon-description",interactive:"esri-interactive"};let Ma=class extends Aw{constructor(e,r){super(e,r),this._isOpen=!1,this._attributionTextOverflowed=!1,this._prevSourceNodeHeight=0,this._resizeObserver=new ResizeObserver(i=>i.forEach(({target:s})=>this._checkSourceTextOverflow(s))),this.iconClass=qy.widgetIcon,this.icon=null,this.itemDelimiter=" | ",this.messages=null,this.viewModel=new MOe}initialize(){this.addHandles(Ga(()=>this.viewModel?.items,"change",()=>this.scheduleRender()))}destroy(){this._resizeObserver?.disconnect()}get _isInteractive(){return this._isOpen||this._attributionTextOverflowed}get attributionText(){return this.viewModel.items.reduce((e,r)=>(e.includes(r.text)||e.push(r.text),e),[]).join(this.itemDelimiter)}get label(){return this.messages?.widgetLabel??""}set label(e){this._overrideIfSome("label",e)}get view(){return this.viewModel.view}set view(e){this.viewModel.view=e}render(){const e={[qy.open]:this._isOpen};return Gr("div",{bind:this,class:this.classes(qy.base,e),dir:"ltr",onclick:this._toggleState,onkeydown:this._toggleState},this.renderSourcesNode(),this.renderPoweredBy())}renderPoweredBy(){return Gr("div",{class:qy.poweredBy},"Powered by"," ",Gr("a",{class:qy.link,href:"http://www.esri.com/",target:"_blank",rel:"noreferrer"},"Esri"))}renderSourcesNode(){const e=this._isOpen,r=this._isInteractive,i=r?"0":"",{attributionText:s}=this,n={[qy.sourcesOpen]:e,[qy.interactive]:r};return Gr("div",{afterCreate:this._afterSourcesNodeCreate,bind:this,class:this.classes(qy.sources,n),innerHTML:s,tabindex:i})}_afterSourcesNodeCreate(e){this._prevSourceNodeHeight=e.clientWidth,this._resizeObserver.observe(e)}_checkSourceTextOverflow(e){let r=!1;const{clientHeight:i,clientWidth:s,scrollWidth:n}=e,o=n>s,a=this._attributionTextOverflowed!==o;if(this._attributionTextOverflowed=o,a&&(r=!0),this._isOpen){const l=i<this._prevSourceNodeHeight;this._prevSourceNodeHeight=i,l&&(this._isOpen=!1,r=!0)}r&&this.scheduleRender()}_toggleState(){this._isInteractive&&(this._isOpen=!this._isOpen)}};u([d()],Ma.prototype,"_isOpen",void 0),u([d()],Ma.prototype,"_isInteractive",null),u([d()],Ma.prototype,"_attributionTextOverflowed",void 0),u([d()],Ma.prototype,"_prevSourceNodeHeight",void 0),u([d({readOnly:!0,dependsOn:["viewModel.items.length","itemDelimiter"]})],Ma.prototype,"attributionText",null),u([d()],Ma.prototype,"iconClass",void 0),u([d()],Ma.prototype,"icon",void 0),u([d()],Ma.prototype,"itemDelimiter",void 0),u([d()],Ma.prototype,"label",null),u([d(),sE("esri/widgets/Attribution/t9n/Attribution")],Ma.prototype,"messages",void 0),u([d()],Ma.prototype,"view",null),u([d({type:MOe})],Ma.prototype,"viewModel",void 0),u([x5()],Ma.prototype,"_toggleState",null),Ma=u([R("esri.widgets.Attribution")],Ma);const Gxt=Ma,jxt=t=>{let e=class extends t{constructor(...r){super(...r),this.goToOverride=null,this.view=null}callGoTo(r){const{view:i}=this;return yF(i),this.goToOverride?this.goToOverride(i,r):i.goTo(r.target,r.options)}};return u([d()],e.prototype,"goToOverride",void 0),u([d()],e.prototype,"view",void 0),e=u([R("esri.widgets.support.GoTo")],e),e},Hxt="esri.widgets.CompassViewModel";let q1=class extends jxt(Te){constructor(e){super(e),this._handles=new Oi,this.orientation={x:0,y:0,z:0},this.view=null,this._updateForCamera=this._updateForCamera.bind(this),this._updateForRotation=this._updateForRotation.bind(this),this._updateRotationWatcher=this._updateRotationWatcher.bind(this)}initialize(){this._handles.add(le(()=>this.view,this._updateRotationWatcher,Vr))}destroy(){Ii(this._handles),this.view=null}get canShowNorth(){const e=this.get("view.spatialReference");return!(!e||!e.isWebMercator&&!e.isGeographic)}get state(){return this.get("view.ready")?this.canShowNorth?"compass":"rotation":"disabled"}reset(){if(!this.get("view.ready"))return;const e={};this.view?.type==="2d"?e.rotation=0:e.heading=0,this.callGoTo({target:e})}_updateForRotation(e){e!=null&&(this.orientation={z:e})}_updateForCamera(e){if(!e)return;const r=-e.heading;this.orientation={x:0,y:0,z:r}}_updateRotationWatcher(e){this._handles.removeAll(),e&&this._handles.add(e.type==="2d"?le(()=>e?.rotation,this._updateForRotation,Vr):le(()=>e?.camera,this._updateForCamera,Vr))}};u([d({readOnly:!0})],q1.prototype,"canShowNorth",null),u([d()],q1.prototype,"orientation",void 0),u([d({readOnly:!0})],q1.prototype,"state",null),u([d()],q1.prototype,"view",void 0),q1=u([R(Hxt)],q1);const IOe=q1,Wy={base:"esri-compass esri-widget--button esri-widget",text:"esri-icon-font-fallback-text",icon:"esri-compass__icon",rotationIcon:"esri-icon-dial",northIcon:"esri-icon-compass",widgetIcon:"esri-icon-locate-circled",interactive:"esri-interactive",disabled:"esri-disabled"};let Ed=class extends Aw{constructor(e,r){super(e,r),this.iconClass=Wy.widgetIcon,this.icon=null,this.messages=null,this.viewModel=new IOe}get goToOverride(){return this.viewModel.goToOverride}set goToOverride(e){this.viewModel.goToOverride=e}get label(){return this.messages?.widgetLabel??""}set label(e){this._overrideIfSome("label",e)}get view(){return this.viewModel.view}set view(e){this.viewModel.view=e}reset(){return this.viewModel.reset()}render(){const{orientation:e,state:r}=this.viewModel,i=r==="disabled",s=(r==="rotation"?"rotation":"compass")=="compass",n=i?-1:0,o={[Wy.disabled]:i,[Wy.interactive]:!i},a={[Wy.northIcon]:s,[Wy.rotationIcon]:!s},{messages:l}=this;return Gr("div",{bind:this,class:this.classes(Wy.base,o),onclick:this._reset,onkeydown:this._reset,role:"button",tabIndex:n,"aria-label":l.reset,title:l.reset},Gr("span",{"aria-hidden":"true",class:this.classes(Wy.icon,a),styles:this._toRotationTransform(e)}),Gr("span",{class:Wy.text},l.reset))}_reset(){this.viewModel.reset()}_toRotationTransform(e){return{transform:`rotateZ(${e.z}deg)`}}};u([d()],Ed.prototype,"goToOverride",null),u([d()],Ed.prototype,"iconClass",void 0),u([d()],Ed.prototype,"icon",void 0),u([d()],Ed.prototype,"label",null),u([d(),sE("esri/widgets/Compass/t9n/Compass")],Ed.prototype,"messages",void 0),u([d()],Ed.prototype,"view",null),u([d({type:IOe})],Ed.prototype,"viewModel",void 0),u([x5()],Ed.prototype,"_reset",null),Ed=u([R("esri.widgets.Compass")],Ed);const qxt=Ed,Kx="esri-navigation-toggle",$u={base:`${Kx} esri-widget`,button:`${Kx}__button esri-widget--button`,activeButton:`${Kx}__button--active`,panButton:`${Kx}__button--pan`,rotateButton:`${Kx}__button--rotate`,isLayoutHorizontal:`${Kx}--horizontal`,rotationIcon:"esri-icon-rotate",panIcon:"esri-icon-pan",widgetIcon:"esri-icon-pan2",disabled:"esri-disabled"};let YT=class extends Te{constructor(t){super(t),this.navigationMode="pan",this.view=null}initialize(){this.own(Eh(()=>this.view?.inputManager,()=>this._setNavigationMode()))}destroy(){this.view=null}get state(){return this.get("view.ready")&&this.view?.type==="3d"?"ready":"disabled"}toggle(){this.state!=="disabled"&&(this.navigationMode=this.navigationMode!=="pan"?"pan":"rotate",this._setNavigationMode())}_setNavigationMode(){this.get("view.inputManager").primaryDragAction=this.navigationMode==="pan"?"pan":"rotate"}};u([d({readOnly:!0})],YT.prototype,"state",null),u([d()],YT.prototype,"navigationMode",void 0),u([d()],YT.prototype,"view",void 0),YT=u([R("esri.widgets.NavigationToggleViewModel")],YT);const $Oe=YT;let Cd=class extends Aw{constructor(e,r){super(e,r),this.iconClass=$u.widgetIcon,this.icon=null,this.messages=null,this.viewModel=new $Oe}get label(){return this.messages?.widgetLabel??""}set label(e){this._overrideIfSome("label",e)}set layout(e){e!=="horizontal"&&(e="vertical"),this._set("layout",e)}get view(){return this.viewModel.view}set view(e){this.viewModel.view=e}toggle(){return this.viewModel.toggle()}render(){const e=this.get("viewModel.state")==="disabled",r=this.get("viewModel.navigationMode")==="pan",i={[$u.disabled]:e,[$u.isLayoutHorizontal]:this.layout==="horizontal"},s={[$u.activeButton]:r},n={[$u.activeButton]:!r},o=e?-1:0,a=this.messages.toggle;return Gr("div",{bind:this,class:this.classes($u.base,i),onclick:this._toggle,onkeydown:this._toggle,tabIndex:o,"aria-label":a,title:a},Gr("div",{class:this.classes($u.button,$u.panButton,s)},Gr("span",{class:$u.panIcon})),Gr("div",{class:this.classes($u.button,$u.rotateButton,n)},Gr("span",{class:$u.rotationIcon})))}_toggle(){this.toggle()}};u([d()],Cd.prototype,"iconClass",void 0),u([d()],Cd.prototype,"icon",void 0),u([d()],Cd.prototype,"label",null),u([d({value:"vertical"})],Cd.prototype,"layout",null),u([d(),sE("esri/widgets/NavigationToggle/t9n/NavigationToggle")],Cd.prototype,"messages",void 0),u([d()],Cd.prototype,"view",null),u([d({type:$Oe})],Cd.prototype,"viewModel",void 0),u([x5()],Cd.prototype,"_toggle",null),Cd=u([R("esri.widgets.NavigationToggle")],Cd);const Wxt=Cd,IC={button:"esri-widget--button esri-widget",disabled:"esri-disabled",interactive:"esri-interactive",iconText:"esri-icon-font-fallback-text",icon:"esri-icon"};let Qm=class extends Aw{constructor(){super(...arguments),this.enabled=!0,this.iconClass=null,this.icon=null,this.title=""}render(){const t=this.enabled?0:-1,e={[IC.disabled]:!this.enabled,[IC.interactive]:this.enabled};return Gr("div",{bind:this,class:this.classes(IC.button,e),onclick:this._triggerAction,onkeydown:this._triggerAction,role:"button",tabIndex:t,title:this.title},Gr("span",{"aria-hidden":"true",role:"presentation",class:this.classes(IC.icon,this.iconClass??"")}),Gr("span",{class:IC.iconText},this.title))}_triggerAction(){this.action.call(this)}};u([d()],Qm.prototype,"action",void 0),u([d()],Qm.prototype,"enabled",void 0),u([d()],Qm.prototype,"iconClass",void 0),u([d()],Qm.prototype,"icon",void 0),u([d()],Qm.prototype,"title",void 0),u([x5()],Qm.prototype,"_triggerAction",null),Qm=u([R("esri.widgets.IconButton")],Qm);const lhe=Qm;let JT=class extends Te{get canZoomIn(){if(!this.get("view.ready"))return!1;const t=this.get("view.animation.target.scale")||this.get("view.scale"),e=this.get("view.constraints.effectiveMaxScale");return e===0||t>e}get canZoomOut(){if(!this.get("view.ready"))return!1;const t=this.get("view.animation.target.scale")||this.get("view.scale"),e=this.get("view.constraints.effectiveMinScale");return e===0||t<e}};u([d({readOnly:!0})],JT.prototype,"canZoomIn",null),u([d({readOnly:!0})],JT.prototype,"canZoomOut",null),u([d()],JT.prototype,"view",void 0),JT=u([R("esri.widgets.Zoom.ZoomConditions2D")],JT);const Zxt=JT;let QT=class extends Te{get canZoomIn(){return!!this.view.ready}get canZoomOut(){return!!this.view.ready}};u([d({readOnly:!0})],QT.prototype,"canZoomIn",null),u([d({readOnly:!0})],QT.prototype,"canZoomOut",null),u([d()],QT.prototype,"view",void 0),QT=u([R("esri.widgets.Zoom.ZoomConditions3D")],QT);const Xxt=QT;let C0=class extends Te{constructor(e){super(e)}destroy(){this.view=null}get canZoomIn(){return this._zoomConditions!=null&&this._zoomConditions.canZoomIn}get canZoomOut(){return this._zoomConditions!=null&&this._zoomConditions?.canZoomOut}get state(){return this.view?.ready?"ready":"disabled"}set view(e){e?e.type==="2d"?this._zoomConditions=new Zxt({view:e}):e.type==="3d"&&(this._zoomConditions=new Xxt({view:e})):this._zoomConditions=null,this._set("view",e)}zoomIn(){if(!this.canZoomIn)return;const e=this.view;e.type==="2d"?e.mapViewNavigation.zoomIn():qk(e.goTo({zoomFactor:2}))}zoomOut(){if(!this.canZoomOut)return;const e=this.view;e.type==="2d"?e.mapViewNavigation.zoomOut():qk(e.goTo({zoomFactor:.5}))}};u([d()],C0.prototype,"_zoomConditions",void 0),u([d()],C0.prototype,"canZoomIn",null),u([d()],C0.prototype,"canZoomOut",null),u([d({readOnly:!0})],C0.prototype,"state",null),u([d()],C0.prototype,"view",null),C0=u([R("esri.widgets.Zoom.ZoomViewModel")],C0);const LOe=C0,$C={base:"esri-zoom esri-widget",horizontalLayout:"esri-zoom--horizontal",zoomInIcon:"esri-icon-plus",zoomOutIcon:"esri-icon-minus",widgetIcon:"esri-icon-zoom-in-magnifying-glass"};let af=class extends Aw{constructor(t,e){super(t,e),this.iconClass=$C.widgetIcon,this.icon=null,this.messages=null,this.viewModel=new LOe}initialize(){this._zoomInButton=new lhe({action:this.zoomIn.bind(this),iconClass:$C.zoomInIcon}),this._zoomOutButton=new lhe({action:this.zoomOut.bind(this),iconClass:$C.zoomOutIcon})}destroy(){this._zoomInButton=Me(this._zoomInButton),this._zoomOutButton=Me(this._zoomOutButton)}get label(){return this.messages?.widgetLabel??""}set label(t){this._overrideIfSome("label",t)}set layout(t){t!=="horizontal"&&(t="vertical"),this._set("layout",t)}set view(t){this.viewModel.view=t}get view(){return this.viewModel.view}render(){const t=this.viewModel,e={[$C.horizontalLayout]:this.layout==="horizontal"},{canZoomIn:r,canZoomOut:i}=t;this._zoomInButton.enabled=r,this._zoomOutButton.enabled=i;const{zoomIn:s,zoomOut:n}=this.messages;return this._zoomInButton.title=s,this._zoomOutButton.title=n,Gr("div",{class:this.classes($C.base,e)},this._zoomInButton.render(),this._zoomOutButton.render())}zoomIn(){return this.viewModel.zoomIn()}zoomOut(){return this.viewModel.zoomOut()}};u([d()],af.prototype,"iconClass",void 0),u([d()],af.prototype,"icon",void 0),u([d()],af.prototype,"label",null),u([d({value:"vertical"})],af.prototype,"layout",null),u([d(),sE("esri/widgets/Zoom/t9n/Zoom")],af.prototype,"messages",void 0),u([d()],af.prototype,"view",null),u([d({type:LOe})],af.prototype,"viewModel",void 0),af=u([R("esri.widgets.Zoom")],af);const Yxt=af;function Jxt(t){return t?.view!==void 0}let AD=class extends Vxt{constructor(t){super(t),this._defaultPositionLookup={attribution:"manual",compass:"top-left","navigation-toggle":"top-left",zoom:"top-left"},this.components=[],this._updateViewAwareWidgets=e=>{this.components.forEach(r=>{const i=this._find(r),s=i?.widget;Jxt(s)&&(s.view=e)})},this._componentsWatcher=(e,r)=>{this._removeComponents(r),this._addComponents(e),this._adjustPadding(e)}}initialize(){this.addHandles([le(()=>this.components,this._componentsWatcher,Vr),le(()=>this.view,this._updateViewAwareWidgets,Vr)])}_add(t,e,r,i,s){let n=t;if(typeof t=="string"&&this._defaultPositionLookup[t]){if(this._find(t))return;n=this._createComponent(t)}super._add(n,e,r,i,s)}_removeComponents(t){t.forEach(e=>{const r=this._find(e);r&&(this.remove(r),r.destroy())})}_adjustPadding(t){if(!t.includes("attribution")&&!this._isOverridden("padding")){const{top:e}=this.padding;this.padding=e}}_addComponents(t){this.constructed&&t.forEach(e=>this.add(this._createComponent(e),this._defaultPositionLookup[e]))}_createComponent(t){const e=this._createWidget(t);return new CD({id:t,node:e})}_createWidget(t){const{view:e}=this;switch(t){case"attribution":return new Gxt({view:e});case"compass":return new qxt({view:e});case"navigation-toggle":return new Wxt({view:e});case"zoom":return new Yxt({view:e})}}};u([d()],AD.prototype,"components",void 0),AD=u([R("esri.views.ui.DefaultUI")],AD);const DOe=AD;let OD=class extends DOe{constructor(t){super(t),this.components=["attribution","zoom","navigation-toggle","compass"]}};u([d()],OD.prototype,"components",void 0),OD=u([R("esri.views.ui.3d.DefaultUI3D")],OD);const NOe=OD;let Ze=class extends cXe(PXe(fXe(iYe))){constructor(t){super(t),this._userClippingArea=null,this._clippingArea=null,this._initialDefaultSpatialReference=null,this._defaults={},this._externallySet={environment:!1},this._createGraphicsViewController=null,this._resolveWhenReady=[],this._propertiesPool=new kg({slicePlane:Pbe},this),this._resourceController=hgt(this),this._defaultToMapOptions={include:new Set},this._defaultHitTestOptions={exclude:new Set},this.deconflictor=new oH({view:this}),this.labeler=new V1({view:this,deconflictor:this.deconflictor.labels}),this.sharedSymbolResources=null,this.analyses=new w2,this.basemapTerrain=null,this.elevationProvider=null,this.canvas=null,this.constraints=new ib,this.environmentManager=new _d,this.floors=new Pt,this.fullOpacity=1,this.graphicsView=null,this.analysisViewManager=new oYe({view:this}),this.groundView=null,this.map=null,this.screenSizePerspectiveEnabled=!0,this.state=new Amt,this.spatialReference=null,this.alphaCompositingEnabled=!1,this.preserveDrawingBufferEnabled=!1,this.supersampleScreenshotsEnabled=!0,this.type="3d",this.ui=new NOe,this._numUpdating=0,this._lastUpdateTime=0,this.updatingProgress=.5,this.highlightOptions=new AH,this.voxelWasm=null,this.voxelWasmPromise=null,tke(),t&&t.environment||(this._defaults.environment=new NT,this.environment=this._defaults.environment);const e=(r=null)=>{r!=null&&r.type===ri.MOVE||(this._updatingChanged(),this.map&&this.map.allLayers.forEach(async i=>{try{await i.when()}catch{}this._updatingChanged()}))};this.addHandles([Ga(()=>this.map?.allLayers,"after-changes",r=>e(r),{onListenerAdd:()=>e(),onListenerRemove:()=>e(),sync:!0}),this.allLayerViews.on("after-changes",r=>this._updateUpdatingMonitors(r)),le(()=>this.map,r=>{r&&"load"in r&&r.load&&r.load().catch(()=>{})})]),this.inputManager=new ist({view:this}),this.stateManager=new vn({view:this})}initialize(){this.groundView=new RXe({view:this}),this._updateUpdatingMonitors();const t=()=>this._updateDefaultToMapOptions();this.addHandles(Ga(()=>this.map?.allLayers,"after-changes",t,{onListenerAdd:t,onListenerRemove:t})),this.updatingHandles.add(()=>this.qualitySettings.memoryLimit,e=>{this.resourceController&&(this.resourceController.memoryController.maxMemory=e)},Vr),this.updatingHandles.add(()=>this.qualitySettings.additionalCacheMemory,e=>{this.resourceController&&(this.resourceController.memoryController.additionalCacheMemory=e)},Vr),this.updatingHandles.add(()=>this.qualitySettings.frameRate??0,e=>n$e(e>0?1e3/Math.ceil(e):0),Vr),this.updatingHandles.add(()=>this.map?.ground,t,As),this.updatingHandles.add(()=>this.map?.ground?.opacity,()=>this._updateDefaultHitTestOptions(),As),this.addHandles(le(()=>this.spatialReference,()=>this.notifyChange("clippingArea"),jr))}destroy(){this.destroyed||(this.updatingHandles.removeAll(),this.removeAllHandles(),this.invalidate(),this.activeTool=null,this.layerViewManager.clear(),this._exitSurface(),this._disposeGraphicsView(),this.sharedSymbolResources=Me(this.sharedSymbolResources),this._set("labeler",Me(this.labeler)),this._set("deconflictor",Me(this.deconflictor)),this._resourceController=Me(this._resourceController),this._set("stateManager",Me(this.stateManager)),this._set("inputManager",Me(this.inputManager)),this.state.destroy(),this._propertiesPool.destroy(),this.removeHandles("updatingMonitors"),this._set("environmentManager",Me(this.environmentManager)),this.groundView=Me(this.groundView),this._exitBasemapTerrain(),this._stage?.destroy(),this.removeAllHandles(),this.updatingHandles.removeAll(),this.handles.removeAll())}get renderSpatialReference(){return this.renderCoordsHelper&&this.renderCoordsHelper.spatialReference}get basemapSpatialReference(){return this.basemapTerrain?.spatialReference}get animation(){return this.state?.animation}get camera(){return this.stateManager?.camera}set camera(t){this.stateManager&&(this.stateManager.camera=t)}get contentCamera(){return this.stateManager?.contentCamera}set contentCamera(t){this.stateManager&&(this.stateManager.contentCamera=t)}installContentCameraReset(t={sticky:!1}){return this.stateManager.installContentCameraReset(t)}get center(){return this.stateManager?.center}set center(t){this.stateManager&&(this.stateManager.center=t)}get clippingArea(){if(this.viewingMode==="global")return null;let t=this._userClippingArea||("clippingArea"in this.map?this.map?.clippingArea:void 0);return!this._userClippingArea&&!this.get("map.clippingEnabled")||t==null?(this._clippingArea=null,null):t instanceof _r?this.spatialReference&&(t=O$(t,this.spatialReference),t==null)?(Q.getLogger(this).error("#clippingArea","setting clippingArea with incompatible SpatialReference"),this._clippingArea):(t=t.clone(),t.intersection(this._groundAndLayersExtent)==null&&(t.xmin=t.xmax,t.ymin=t.ymax),t.zmin=void 0,t.zmax=void 0,t.equals(this._clippingArea)||(this._clippingArea=t),this._clippingArea):(Q.getLogger(this).error("#clippingArea","only clippingArea geometries of type Extent are supported"),this._clippingArea)}set clippingArea(t){this.ready&&this.viewingMode==="global"&&t!=null?Q.getLogger(this).error("#clippingArea=","Clipping area is only supported in local viewingMode"):this._userClippingArea=t}get renderDataExtent(){if(this.state.viewingMode===De.Global)return null;const t=this.renderSpatialReference,e=this.dataExtent;return e==null||t==null||e.spatialReference.equals(t)?e:O$(e,t)}get dataExtent(){let t=this._groundAndLayersExtent;const e=this.spatialReference||je.WGS84,r=O$(this.clippingArea,e);r!=null&&(t=t!=null?t.intersection(r):r);const i=this._get("dataExtent");return t!=null&&t.equals(i)?i:t}get _groundAndLayersExtent(){const t=this.spatialReference||je.WGS84;let e;const r=n=>{const o=O$(n,t);o!=null&&(e!=null?e.union(o):e=o.clone())},i=this.basemapTerrain;if(i?.spatialReference){const n=i.groundExtent;r(new _r({xmin:n[0],ymin:n[1],zmin:0,xmax:n[2],ymax:n[3],zmax:0,spatialReference:i.spatialReference}))}if(this.map){const n=o=>{o.fullExtent==null||o.type==="graphics"&&o.internal||r(o.fullExtent)};this.map.allLayers.forEach(o=>n(o))}if(e==null)return null;e.hasZ?(e.zmin=Math.min(0,e.zmin??0),e.zmax=Math.max(0,e.zmax??0)):(e.zmin=0,e.zmax=0);const s=this._get("_groundAndLayersExtent");return e.equals(s)?s:e}set environment(t){t!==this._defaults.environment&&(this._externallySet.environment=!0),this._set("environment",t)}castEnvironment(t){return t?t instanceof NT?t:t instanceof fwe?this.environment!=null?this.environment.cloneWithWebsceneEnvironment(t):NT.fromWebsceneEnvironment(t):Zs(NT,t):new NT}get extent(){return this.stateManager?.extent}set extent(t){this.stateManager&&(this.stateManager.extent=t)}get screenCenter(){return this.stateManager?.screenCenter}get frustum(){return this.stateManager?.frustum}get initialExtentRequired(){return this.stateManager&&!this.stateManager.hasInitialView}get _defaultsFromMapSettings(){return{required:{tileInfo:!1,heightModelInfo:!0,extent:!1}}}get interacting(){return this.navigating||(this.toolViewManager?.interacting??!1)}get stationary(){return!this.animation&&!this.resizing&&(this.state==null||this.state.stationary)}get navigating(){return this.state?.navigating??!1}get padding(){return this.stateManager?.padding}set padding(t){this.stateManager&&(this.stateManager.padding=t)}set qualityProfile(t){fD.isValidProfile(t)&&(fD.apply(t,this.qualitySettings),this._set("qualityProfile",t))}get qualityProfile(){return this._get("qualityProfile")||fD.getDefaultProfile()}set slicePlane(t){if(this._stage!=null&&this._stage.renderer.setParameters({slicePlane:t}),t==null)return void this._set("slicePlane",null);const e=this._propertiesPool.get("slicePlane");Uw(t,e),this._set("slicePlane",e)}get typeSpecificPreconditionsReady(){return!!this.viewingMode}get resolution(){return this.spatialReference!=null?nXe(this.scale,this.spatialReference):0}get scale(){return this.stateManager?.scale}set scale(t){this.stateManager&&(this.stateManager.scale=t)}get heightModelInfo(){const t=this.getDefaultHeightModelInfo();return t!=null?$w.deriveUnitFromSR(t,this.spatialReference):null}get updating(){if(this.destroyed)return!1;let t=0,e=this.layerViewManager.updating,r=e?this.layerViewManager.updatingRemaining:0;this.allLayerViews.forEach(s=>{if(s.isFulfilled()){if(s.updating){if(e=!0,s.suspended||uR(s))return;++r,t+=s.updatingProgress}}else++r});for(const s of this._updatingObjects)s!=null&&s.updating&&(r+=.1,t+=.5*.1);for(const s of this._updatingObjectsWithProgress)s!=null&&s.updating&&(++r,t+=s.updatingProgress);const i=!this.stateManager.test.updatingIgnoreRenderState&&this.state.updating;if(e=!!(e||r>0||this.updatingHandles.updating||!this.ready||!this.stationary||i||this._createGraphicsViewController||this.inputManager?.updating||this.map?.allLayers?.some(s=>!s.isFulfilled())),e?(this._numUpdating=Math.max(r,this._numUpdating),t+=this._numUpdating-r):this._numUpdating=0,this._numUpdating>0?t/=this._numUpdating:t=e?0:1,this._get("updatingProgress")!==t){const s=performance.now();if(t<1){const n=Math.min((s-this._lastUpdateTime)/2e3,1);t=this.updatingProgress*(1-n)+t*n}this._set("updatingProgress",t),this._lastUpdateTime=e&&t<1?s:0}return e}get _updatingObjects(){return[this.graphicsView,this.basemapView,this._resourceController,this._stage,this.featureTiles,this.pointsOfInterest,this.environmentManager,this.overlay,this._featureTreeDebugger,this.toolViewManager,this.analysisViewManager]}get _updatingObjectsWithProgress(){return[this.deconflictor,this.labeler,this.basemapTerrain]}get viewingMode(){const t=this._predeterminedViewingMode;if(t!=null)return jU(t);const e=this.spatialReference;return e?this.defaultsFromMap?.viewingMode!=null&&e.equals(this.defaultsFromMap.spatialReference)?jU(this.defaultsFromMap.viewingMode):qj(e,De.Global)?"global":"local":"global"}set viewingMode(t){this.ready?Q.getLogger(this).error("#viewingMode","viewingMode cannot be set once view is ready"):this._overrideIfSome("viewingMode",t)}get viewpoint(){return this.stateManager?.viewpoint}set viewpoint(t){this.stateManager&&(this.stateManager.viewpoint=t)}get zoom(){return this.stateManager.zoom}set zoom(t){this.stateManager&&(this.stateManager.zoom=t)}get resourceController(){return this._resourceController}get performanceInfo(){return new Fgt(this)}on(t,e,r,i){return this.viewEvents.on(t,e,r,i)||super.on(t,e)}hasEventListener(t){return super.hasEventListener(t)||this.viewEvents.hasHandler(t)}toMap(t,e){if(!this.ready)return Q.getLogger(this).error("#toMap()","Scene view cannot be used before it is ready"),null;const r=e?this.externalToInternalIntersectOptions(e):this._defaultToMapOptions,i=r.graphics!=null&&(r.graphics.include!=null||r.graphics.exclude!=null),s=zte(t)?Vte(this,t):t,n=ff(s);r.enableDraped=r.include&&!r.include.has(z0)||r.exclude&&r.exclude.has(z0);const o=this.sceneIntersectionHelper,a=Dh(this.state.viewingMode);if(a.options.selectionMode=!0,a.options.store=i?vo.ALL:vo.MIN,o.intersectIntersectorScreen(n,a,r),i){for(const l of a.results.all){const c=nq(l,this);if(c==null)return this._intersectResultToMapPoint(l);if(c.type!=="graphic"||this._testGraphicUidFilter(r.graphics,c.graphic))return this._intersectResultToMapPoint(l)}return null}return this._intersectResultToMapPoint(a.results.min)}toScreen(t){if(!this.ready)return Q.getLogger(this).error("#toScreen()","Scene view cannot be used before it is ready"),null;const e=(t.z==null?wf(this.elevationProvider,t):null)??0;return wo(t,eT,this.renderSpatialReference,e),this.state.camera.projectToScreen(eT,Dk),Ah(Dk[0],Dk[1])}pixelSizeAt(t){return this.ready?t?(wo(t,eT,this.renderSpatialReference),this.state.camera.computeScreenPixelSizeAt(eT)):0:(Q.getLogger(this).error("#pixelSizeAt()","Scene view cannot be used before it is ready"),null)}overlayPixelSizeInMapUnits(t){const e=this.basemapTerrain.overlayManager;return e?e.overlayPixelSizeInMapUnits(t):1}hitTest(t,e){if(!this.ready)return Q.getLogger(this).error("#hitTest()","Scene view cannot be used before it is ready"),null;const r=zte(t)?Vte(this,t):t,i=Zi(r.x,r.y),s=e?this.externalToInternalIntersectOptions(e):this._defaultHitTestOptions;s.requiresGroundFeedback=!0,s.enableDraped=!0;const n=Dh(this.state.viewingMode);n.options.selectionMode=!0,n.options.store=vo.ALL,this.sceneIntersectionHelper.intersectIntersectorScreen(i,n,s);const o=this._intersectResultsToHits(n.results.all,s.graphics),a=n.results.ground,l=ihe(a,this),c=l!=null&&"type"in l&&l.type==="integrated-mesh"?l:null,h={screenPoint:r,results:o,ground:{mapPoint:this._intersectResultToMapPoint(a),distance:fp(a)?a.distanceInRenderSpace:0,layer:c}};return ni.SCENEVIEW_HITTEST_RETURN_INTERSECTOR&&(h.intersector=n),Promise.resolve(h)}async popupHitTest(t){const{results:e,ground:r}=await vGe(this,t);let i=null;return!(e.length===0||Math.abs((e[0].distance??0)-r.distance)<1e-5)||r.layer&&r.layer.type==="integrated-mesh"||(i=r.mapPoint),{results:e,screenPoint:t,mapPoint:i}}goTo(t,e){return this.updatingHandles.addPromise(this.stateManager.goTo(t,e))}async whenAnalysisView(t){if(t.parent==null)throw new F("view:no-analysisview-for-analysis","The analysis has not been added to view.analyses",{analysis:t});switch(t.parent.type){case"line-of-sight":case"dimension":return(await this.whenLayerView(t.parent)).whenAnalysisView();default:return this.analysisViewManager.whenAnalysisView(t)}}whenLayerView(t){return super.whenLayerView(t)}async takeScreenshot(t){const e=this._completeSettings(t);await this.whenReady();const r=await this._stage.renderView.takeScreenshot(e);return Ok(r,e,this._pixelFormat())}async _takeScreenshot(t){const e=this._completeSettings(t);await this.whenReady();const r=await this._stage.renderView.takeScreenshot(e);return Rk(r,this._pixelFormat())}async _takeScreenshotWithObjectAndLayerId(t){const e=this._completeSettings(t);await this.whenReady();const r=await this._stage.renderView.takeScreenshotWithOID(e);return[Rk(r[0],this._pixelFormat()),Rk(r[1],this._pixelFormat())]}_completeSettings(t){const e=axt(t,this);return e.pixelRatio/=this.state.pixelRatio,hxt(e,this.supersampleScreenshotsEnabled,this.padding)}_pixelFormat(){return{flipY:!0,premultipliedAlpha:this._stage.renderView.getAlpha()}}get test(){return{takeScreenshot:t=>this._takeScreenshot(t),takeScreenshotWithObjectAndLayerId:t=>this._takeScreenshotWithObjectAndLayerId(t)}}async takeScreenshotWithObjectAndLayerId(t){if(!oe("enable-feature:objectAndLayerId-rendering"))throw new Error("has enable-feature:objectAndLayerId-rendering must be true");const e=this._completeSettings(t);await this.whenReady();const r=await this._stage.renderView.takeScreenshotWithOID(e),i=Ok(r[0],e,this._pixelFormat()),s=this._completeSettings(t);return s.format="png",[i,Ok(r[1],s,this._pixelFormat())]}getColorToObjectAndLayerIdMapping(){if(this._stage.renderView.objectAndLayerIdRenderHelper==null)throw new Error("has enable-feature:objectAndLayerId-rendering must be true");return this._stage.renderView.objectAndLayerIdRenderHelper.getColorToObjectAndLayerIdMapping()}addUpdatingPromise(t){return this.updatingHandles.addPromise(t)}importLayerView(t){return Yre.importLayerView(t)}hasLayerViewModule(t){return Yre.hasLayerViewModule(t)}forceDOMReadyCycle(){this.forceReadyCycle()}getDefaultSpatialReference(){return this.map&&"initialViewProperties"in this.map&&this.map?.initialViewProperties?.spatialReference||this.defaultsFromMap?.spatialReference||this.defaultsFromMap?.ready&&this._initialDefaultSpatialReference||null}async validate(){let t=Dxt(this.type);const e=oe("safari");if(e&&e<9&&(t=new F("sceneview:browser-not-supported","This browser is not supported by SceneView (Safari < 9)",{type:"safari",requiredVersion:9,detectedVersion:e})),t!=null)throw Q.getLogger(this).warn("#validate()",t.message),t}get _predeterminedViewingMode(){const t=this._isOverridden("viewingMode")?this._get("viewingMode"):(this.map&&"initialViewProperties"in this.map?this.map.initialViewProperties?.viewingMode:null)??null;return t!=null?fre(t):null}getSpatialReferenceSupport({spatialReference:t,layer:e}){const r=this._predeterminedViewingMode;if(r!=null)return this._validateSpatialReferenceForViewingMode(t,e,r)?{constraints:this._makeSpatialReferenceConstraints(t,e,r)}:null;const i=this._validateSpatialReferenceForViewingMode(t,e,De.Local),s=this._validateSpatialReferenceForViewingMode(t,e,De.Global);return i||s?i&&s?{constraints:this._makeSpatialReferenceConstraints(t,e,null)}:i?{constraints:this._makeSpatialReferenceConstraints(t,e,De.Local)}:{constraints:this._makeSpatialReferenceConstraints(t,e,De.Global)}:null}_validateSpatialReferenceForViewingMode(t,e,r){return!!qj(t,r)&&(e==null||!!nee(e)||(!A3(e)||P6(e,t,r)!=null)&&(!see(e)||r!==De.Global))}_makeSpatialReferenceConstraints(t,e,r){if(e==null)return[{spatialReference:t,viewingMode:r}];const i=t.isWebMercator,s=t.isWGS84;return nee(e)&&(i||s)?!s||r===De.Local||EJ(e.tileInfo,e.fullExtent,t,De.Global)===null?[{spatialReference:t,viewingMode:r},{spatialReference:je.WebMercator,viewingMode:r}]:[{spatialReference:i?je.WGS84:je.WebMercator,viewingMode:r}]:A3(e)||see(e)||!i&&!s?A3(e)&&i&&r!==De.Global?[{spatialReference:t,viewingMode:r},{spatialReference:je.WGS84,viewingMode:De.Local}]:[{spatialReference:t,viewingMode:r}]:[{spatialReference:t,viewingMode:r},{spatialReference:i?je.WGS84:je.WebMercator,viewingMode:r}]}_validateSpatialReference(t){const e=this.getSpatialReferenceSupport({spatialReference:t})!=null,r=this._predeterminedViewingMode;return e||(r!=null?Q.getLogger(this).warnOnce(`Spatial reference defined on view not supported in ${jU(r)} viewing mode.`):t.isGeographic&&Q.getLogger(this).warnOnce("Spatial reference is geographic but not supported.")),e}whenReady(){return new Promise(t=>{this.ready?t(this):this._resolveWhenReady.push(t)})}computeMapPointFromVec3d(t,e){let r=this.spatialReference||je.WGS84;return Ws(t,this.renderSpatialReference,t,r)||(r=je.WGS84,Ws(t,this.renderSpatialReference,t,r)),e?(e.x=t[0],e.y=t[1],e.z=t[2],e.spatialReference=r):e=new pt(t,r),e}trackGraphicState(t){if(!t.graphic)return Q.getLogger(this).error("trackGraphicState","GraphicState.graphic must not be null or undefined to start tracking"),null;const e=this.getViewForGraphic(t.graphic);let r=null,i=!1;const s=n=>{!i&&n!=null&&"processor"in n&&n.processor?.type==="graphics-3d"&&n.processor.graphicsCore&&(r=n.processor.graphicsCore.trackGraphicState(t))};return e!=null?s(e):this.whenViewForGraphic(t.graphic,{waitForLayer:!0}).then(n=>s(n),()=>{}).catch(()=>{}),{remove:()=>{i=!0,r!=null&&(r.remove(),r=null)}}}highlight(t){if(Array.isArray(t))return XS(t.map(r=>this.highlight(r)));if(Pt.isCollection(t))return XS(t.toArray().map(r=>this.highlight(r)));const e=this.getViewForGraphic(t);return e&&"highlight"in e?e.highlight(t):bo()}maskOccludee(t){if(!t)return Q.getLogger(this).error("maskOccludee","GraphicState.graphic must not be null or undefined to mask an occludee"),null;const e=this.getViewForGraphic(t);let r=null,i=!1;const s=n=>{!i&&n!=null&&wGe(n)&&(r=n.maskOccludee(t))};return e!=null?s(e):this.whenViewForGraphic(t,{waitForLayer:!0}).then(n=>s(n),()=>{}).catch(()=>{}),{remove:()=>{i=!0,r!=null&&(r.remove(),r=null)}}}getViewForGraphic(t){return t.layer===this.graphics?this.graphicsView:t.layer?this.allLayerViews.find(e=>e.layer===t.layer):null}graphicChanged(t){this.graphicsView!=null&&this.graphicsView.graphicChanged(t)}async whenViewForGraphic(t,e){if(t.layer===this)return await QS(()=>this.graphicsView),this.graphicsView;if(!t.layer||!this.map)throw new F("no-view-for-graphic");return e&&e.waitForLayer&&!this.map.allLayers.includes(t.layer)?new Promise((r,i)=>{const s=this.map.allLayers.on("change",n=>{n.added.includes(t.layer)&&(s.remove(),this.whenLayerView(t.layer).then(r,i))})}):this.whenLayerView(t.layer)}externalToInternalIntersectOptions(t){const e=this._externalToInternalRenderItems(t.include,hO.INCLUDE),r=this._externalToInternalRenderItems(t.exclude,hO.EXCLUDE);return{include:e.layerUids,exclude:r.layerUids,graphics:{include:e.graphicUids,exclude:r.graphicUids}}}_intersectResultToMapPoint(t,e){return t.getIntersectionPoint(eT)?(e=this.computeMapPointFromVec3d(eT,e),t.intersector===ki.TERRAIN&&this.basemapTerrain&&(e.z=wf(this.basemapTerrain,e)??0),e):null}_intersectResultsToHits(t,e){const r=new Array;let i=null;for(let s=0;s<t.length;s++){const n=t[s],o=ihe(n,this);if(o!=null&&(o===this.map.ground||"type"in o&&o.type==="integrated-mesh"))break;const a=nq(n,this);if(a==null)continue;if(a.type==="graphic"){if(i==null&&s!==t.length-1&&(i=new Set),i!=null){const h=this._getGraphicFilterUid(a.graphic);if(i.has(h))continue;i.add(h)}if(!this._testGraphicUidFilter(e,a.graphic))continue}const l=this._intersectResultToMapPoint(n),c=n.distanceInRenderSpace;r.push({...a,mapPoint:l,distance:c})}return r}_getGraphicFilterUid(t){const e=t.sourceLayer,r=t.layer,i=e&&"objectIdField"in e?e:r&&"objectIdField"in r?r:e;if(i){const s=i.objectIdField??aXe,n=t.attributes?.[s];if(n)return`o-${i.id}-${n}`}return`u-${t.uid}`}_testGraphicUidFilter(t,e){const r=this._getGraphicFilterUid(e);return t==null||(t.include==null||t.include.has(r))&&(t.exclude==null||!t.exclude.has(r))}_externalToInternalRenderItems(t,e,r={layerUids:void 0,graphicUids:void 0}){if(!t)return r;if(t instanceof Oh)Qxt(r,this._getGraphicFilterUid(t)),e===hO.INCLUDE&&(this.graphicsView!=null&&t.layer===this?LC(r,this.graphicsView.processor.layer.id):t.layer&&LC(r,t.layer.uid));else if(Kk(t))for(const i of t)i===this.graphics&&this.graphicsView!=null?LC(r,this.graphicsView.processor.layer.id):i===this.map.ground?LC(r,z0):this._externalToInternalRenderItems(i,e,r);else"uid"in t&&LC(r,t.uid);return r}_initBasemapTerrain(){this._set("basemapTerrain",new k_t({view:this})),this._set("elevationProvider",new i3({view:this})),this.elevationProvider.register("ground",this.basemapTerrain)}_exitBasemapTerrain(){this.basemapTerrain&&(this.elevationProvider.unregister(this.basemapTerrain),this.elevationProvider.destroy(),this._set("elevationProvider",null),this.basemapTerrain.destroy(),this._set("basemapTerrain",null))}_initGlobe(){this._initCoordinateSystem(),this.state.createInitialCamera(),this._initBasemapTerrain(),this._set("pointsOfInterest",new pl({view:this})),this._set("featureTiles",new uo({renderCoordsHelper:this.renderCoordsHelper,cameraOnSurface:this.pointsOfInterest.cameraOnSurface,focus:this.pointsOfInterest.focus,tilingSchemeOwner:this.basemapTerrain,viewState:this.state,scheduler:this._resourceController.scheduler,terrain:this.basemapTerrain}));const t=()=>{const e=this.basemapTerrain?.extent;if(this.clippingArea||e)if(e&&this.basemapTerrain.spatialReference){const r=this.basemapTerrain.extent!=null&&this.basemapTerrain.spatialReference!=null?Lw(RF(this.basemapTerrain.extent,this.basemapTerrain.spatialReference),this.spatialReference):null;this.clippingArea!=null?this.featureTiles.filterExtent=this.clippingArea.intersection(r):this.featureTiles.filterExtent=r}else this.featureTiles.filterExtent=this.clippingArea;else this.featureTiles.filterExtent=null};this.addHandles([this.updatingHandles.add(()=>ni.FEATURE_TILE_TREE_SHOW_TILES,e=>{e&&this.featureTiles&&!this._featureTreeDebugger?this.updatingHandles.addPromise(ae(()=>import("./FeatureTileTree3DDebugger-ee3b60fa.js"),["./FeatureTileTree3DDebugger-ee3b60fa.js","./TileTreeDebugger-67b84aad.js"],import.meta.url)).then(({FeatureTileTree3DDebugger:r})=>{!this._featureTreeDebugger&&ni.FEATURE_TILE_TREE_SHOW_TILES&&(this._featureTreeDebugger=new r({view:this}))}):e||!this._featureTreeDebugger||ni.FEATURE_TILE_TREE_SHOW_TILES||(this._featureTreeDebugger.destroy(),this._featureTreeDebugger=null)},As),this.updatingHandles.add(()=>this.clippingArea,t,As),this.updatingHandles.add(()=>this.basemapTerrain.extent,t,As)],"feature-tiles"),this.stateManager.init()}_exitGlobe(){this.state&&(this.stateManager.exit(),this.removeHandles("render-coords-helper"),this.removeHandles("feature-tiles"),this.featureTiles.destroy(),this._set("featureTiles",null),this.pointsOfInterest.destroy(),this._set("pointsOfInterest",null),this._exitBasemapTerrain(),this.state.exit(),this._exitCoordinateSystem())}_initCoordinateSystem(){if(this.spatialReference){const t=this.spatialReference;this.mapCoordsHelper&&this.mapCoordsHelper.spatialReference.equals(t)||this._set("mapCoordsHelper",new Wmt(this.map,t));const e=this.state.isGlobal,r=sXe(e,t);r!==this.renderSpatialReference&&(this._set("renderCoordsHelper",Jmt.create(this.state.viewingMode,r)),e||this.addHandles(le(()=>this.basemapTerrain?.extent,i=>{const s=this.renderCoordsHelper.spatialReference;i==null||i[0]===0&&i[1]===0&&i[2]===0&&i[3]===0||!qR(i,this.basemapTerrain.spatialReference,che,s)||(this.renderCoordsHelper.extent=che)},jr),"render-coords-helper"),this.sceneIntersectionHelper&&this.sceneIntersectionHelper.setTolerance(O2/this.renderCoordsHelper.unitInMeters))}else this._set("mapCoordsHelper",null),this._set("renderCoordsHelper",null)}_exitCoordinateSystem(){this.mapCoordsHelper&&(this.removeHandles("render-coords-helper"),this._set("renderCoordsHelper",null),this._set("mapCoordsHelper",null))}_updatingChanged(){this.notifyChange("updating")}_updateUpdatingMonitors(t=null){t!=null&&t.type===ri.MOVE||(this.removeHandles("updatingMonitors"),this.allLayerViews.forEach(e=>{e.destroyed||(this.addHandles(le(()=>[e.updating,e.updatingProgress],()=>this._updatingChanged(),jr),"updatingMonitors"),e.when(()=>this._updatingChanged(),()=>this._updatingChanged()))}),this._updatingChanged())}async _prepareScreenshotOverlay(){this.overlay&&await this.overlay.prepare()}_renderScreenshotOverlay(t,e){if(!this.overlay||!this.overlay.hasVisibleItems)return e;const r=t.getContext("2d");return r.putImageData(e,0,0),this.overlay.renderCanvas(t),r.getImageData(0,0,e.width,e.height)}_initStage(){const t={deactivatedWebGLExtensions:this.deactivatedWebGLExtensions,debugWebGLExtensions:this.debugWebGLExtensions,alpha:this.alphaCompositingEnabled,preserveDrawingBuffer:this.preserveDrawingBufferEnabled,canvas:this.renderCanvas,screenshot:{prepareOverlay:()=>this._prepareScreenshotOverlay(),renderOverlay:(s,n)=>this._renderScreenshotOverlay(s,n)}},e=new Omt(this.state.viewingMode,s=>this._stage.layers.forAll(s),this);this._set("sceneIntersectionHelper",e);const r=LF(this.surface);this._stage=new Gc({view:this,options:t,container:r}),this._stage.renderer.setParameters({slicePlane:this.slicePlane}),this.addHandles([this.updatingHandles.add(()=>this.qualitySettings.antialiasingEnabled,()=>this._stage.renderer.setParameters({antialiasingEnabled:this.qualitySettings.antialiasingEnabled}),Vr),this.updatingHandles.add(()=>this.qualitySettings.highQualityTransparency,s=>this._stage.renderer.setParameters({highQualityTransparency:s}),Vr),le(()=>this.magnifier,s=>this._stage.renderView.magnifier=s,As),this.on("pointer-move",()=>this._stage?.renderer.resetAnimation()),h_(this._stage.renderView.canvas,"webglcontextlost",s=>this.fatalError=new F("webgl-context-lost",s.statusMessage))],"stage");const i=()=>{this._stage.renderer.setParameters({defaultHighlightOptions:AH.toEngineOptions(this.highlightOptions)})};this.addHandles(this.updatingHandles.add(()=>[this.highlightOptions.color,this.highlightOptions.haloColor,this.highlightOptions.haloOpacity,this.highlightOptions.fillOpacity,this.highlightOptions.shadowOpacity,this.highlightOptions.shadowColor,this.highlightOptions.shadowDifference],i),"stage"),i(),this.renderCoordsHelper&&this.sceneIntersectionHelper.setTolerance(O2/this.renderCoordsHelper.unitInMeters),this._set("canvas",this._stage.renderView.canvas)}_exitStage(){this._set("sceneIntersectionHelper",null),this._stage=Me(this._stage),this.removeHandles("stage"),this._set("canvas",null)}_initSurface(t){this._exitSurface(),this.state.init(t,this.spatialReference),this._initStage(),this._initGlobe(),this.sharedSymbolResources=new Vgt({view:this,viewingMode:t,resourceController:this._resourceController,pointsOfInterest:this.pointsOfInterest,viewState:this.state})}_exitSurface(){this.sharedSymbolResources&&(this.sharedSymbolResources.objectResourceCache.destroy(),this.sharedSymbolResources.destroy(),this.sharedSymbolResources=null,this._exitGlobe(),this._exitStage())}_createGraphicsViewIfNeeded(){if(this.graphicsView||this._createGraphicsViewController||this.graphics.length===0)return;this.removeHandles("graphics-view"),this._createGraphicsViewController=new AbortController;const t=()=>{this._createGraphicsViewController=null,this._updatingChanged()};this._createGraphicsViewAsync(this._createGraphicsViewController.signal).then(t,t),this._updatingChanged()}async _createGraphicsViewAsync(t){const e=(await ae(()=>import("./GraphicsView3D-2d87139c.js"),["./GraphicsView3D-2d87139c.js","./GraphicsProcessor-2061d640.js","./Graphics3DScaleVisibility-eaf5a046.js","./rendererConversion-22515807.js","./optimizedFeatureQueryEngineAdapter-f5f88773.js","./centroid-3dcadaf5.js","./PooledRBush-506b9510.js","./quickselect-d16016af.js"],import.meta.url)).default;Xt(t),await QS(()=>this.basemapTerrain?.ready,t),this._set("graphicsView",new e({view:this}))}_disposeGraphicsView(){this._createGraphicsViewController&&(this._createGraphicsViewController.abort(),this._createGraphicsViewController=null),this.removeHandles("graphics-view"),this.graphicsView!=null&&(this.removeHandles(this.graphicsView.processor.layer.id),this.graphicsView.destroy(),this._set("graphicsView",null))}_startup(){const t=fre(this.viewingMode);if(t===De.Global&&(this._clippingArea=null),this._initSurface(t),this._set("ready",!0),this.addHandles(Ga(()=>this.graphics,"after-changes",()=>this._createGraphicsViewIfNeeded()),"graphics-view"),this._createGraphicsViewIfNeeded(),!this._externallySet.environment){const r=this.get("map.initialViewProperties.environment");r&&(this.environment=r)}this.labeler.setup(),this.environmentManager.connectView(this),this.inputManager.connect();const e=this._resolveWhenReady;this._resolveWhenReady=[],e.forEach(r=>r(this))}_teardown(){this._initialDefaultSpatialReference=null,this.inputManager.disconnect(),this.environmentManager.disconnectView(),this.labeler.dispose(),this._disposeGraphicsView(),this.removeHandles("graphics-view"),this._exitSurface(),this._set("ready",!1)}_updateDefaultToMapOptions(){if(this._defaultToMapOptions.include.clear(),this.map){this.map.ground&&this._defaultToMapOptions.include.add(z0);for(const t of this.map.allLayers.items)t.type==="integrated-mesh"&&this._defaultToMapOptions.include.add(t.uid)}}_updateDefaultHitTestOptions(){if(this._defaultHitTestOptions.exclude.clear(),this.map){this.map.ground&&this.map.ground.opacity<1&&this._defaultHitTestOptions.exclude.add(z0);for(const t of this.map.allLayers.items)t.type==="integrated-mesh"&&t.opacity<1&&this._defaultHitTestOptions.exclude.add(t.uid)}}addVoxelLayerViewToWasm(t){return this.voxelWasm==null?(this.voxelWasmPromise==null&&(this.voxelWasmPromise=ae(()=>import("./VoxelWasmPerSceneView-6ee5866a.js"),[],import.meta.url).then(e=>(this.voxelWasm=new e.default(this),this.voxelWasm))),this.voxelWasmPromise.then(e=>e.addVoxelLayer(t))):this.voxelWasm.addVoxelLayer(t)}removeVoxelLayerViewFromWasm(t){this.voxelWasm!=null&&this.voxelWasm.removeVoxelLayer(t)<1&&(this.voxelWasm=null,this.voxelWasmPromise=null)}};function LC(t,e){t.layerUids||(t.layerUids=new Set),t.layerUids.add(e)}function Qxt(t,e){t.graphicUids||(t.graphicUids=new Set),t.graphicUids.add(e)}function O$(t,e){return t!=null&&Vf(t.spatialReference,e)?Lw(t,e):null}var hO;Ze.type="3d",u([d()],Ze.prototype,"_userClippingArea",void 0),u([d()],Ze.prototype,"_resourceController",void 0),u([d()],Ze.prototype,"_stage",void 0),u([d({readOnly:!0})],Ze.prototype,"deconflictor",void 0),u([d({readOnly:!0})],Ze.prototype,"labeler",void 0),u([d(G7(w2,"analyses"))],Ze.prototype,"analyses",void 0),u([d({type:T2,readOnly:!0})],Ze.prototype,"animation",null),u([d({readOnly:!0})],Ze.prototype,"basemapTerrain",void 0),u([d({readOnly:!0})],Ze.prototype,"elevationProvider",void 0),u([d()],Ze.prototype,"camera",null),u([d({type:Ih})],Ze.prototype,"contentCamera",null),u([d({readOnly:!0})],Ze.prototype,"canvas",void 0),u([d({type:pt})],Ze.prototype,"center",null),u([d({type:_r})],Ze.prototype,"clippingArea",null),u([d({type:ib})],Ze.prototype,"constraints",void 0),u([d({type:_r,readOnly:!0})],Ze.prototype,"renderDataExtent",null),u([d({type:_r,readOnly:!0})],Ze.prototype,"dataExtent",null),u([d({type:_r,readOnly:!0})],Ze.prototype,"_groundAndLayersExtent",null),u([d({value:null,type:NT})],Ze.prototype,"environment",null),u([yr("environment")],Ze.prototype,"castEnvironment",null),u([d({readOnly:!0})],Ze.prototype,"environmentManager",void 0),u([d({type:_r})],Ze.prototype,"extent",null),u([d()],Ze.prototype,"floors",void 0),u([d()],Ze.prototype,"screenCenter",null),u([d()],Ze.prototype,"frustum",null),u([d({type:Number,readOnly:!0})],Ze.prototype,"fullOpacity",void 0),u([d({readOnly:!0})],Ze.prototype,"graphicsView",void 0),u([d({readOnly:!0})],Ze.prototype,"analysisViewManager",void 0),u([d()],Ze.prototype,"groundView",void 0),u([d({type:Boolean})],Ze.prototype,"initialExtentRequired",null),u([d()],Ze.prototype,"_defaultsFromMapSettings",null),u([d()],Ze.prototype,"interacting",null),u([d()],Ze.prototype,"stationary",null),u([d()],Ze.prototype,"navigating",null),u([d()],Ze.prototype,"map",void 0),u([d({readOnly:!0})],Ze.prototype,"mapCoordsHelper",void 0),u([d()],Ze.prototype,"padding",null),u([d({type:pl,readOnly:!0})],Ze.prototype,"pointsOfInterest",void 0),u([d({type:uo,readOnly:!0})],Ze.prototype,"featureTiles",void 0),u([d()],Ze.prototype,"_featureTreeDebugger",void 0),u([d({type:Boolean})],Ze.prototype,"screenSizePerspectiveEnabled",void 0),u([d({constructOnly:!0})],Ze.prototype,"deactivatedWebGLExtensions",void 0),u([d({constructOnly:!0})],Ze.prototype,"debugWebGLExtensions",void 0),u([d({constructOnly:!0})],Ze.prototype,"renderCanvas",void 0),u([d({constructOnly:!0})],Ze.prototype,"state",void 0),u([d({readOnly:!0})],Ze.prototype,"inputManager",void 0),u([d({readOnly:!0})],Ze.prototype,"stateManager",void 0),u([d({type:["low","medium","high"]})],Ze.prototype,"qualityProfile",null),u([d({type:Kae,get(){let t=this._get("qualitySettings");return t||(t=new Kae,fD.apply(this.qualityProfile,t)),t}})],Ze.prototype,"qualitySettings",void 0),u([d()],Ze.prototype,"slicePlane",null),u([d({readOnly:!0})],Ze.prototype,"typeSpecificPreconditionsReady",null),u([d({readOnly:!0})],Ze.prototype,"renderCoordsHelper",void 0),u([d({readOnly:!0})],Ze.prototype,"sceneIntersectionHelper",void 0),u([d({type:Number,dependsOn:["scale","spatialReference"],readOnly:!0})],Ze.prototype,"resolution",null),u([d({type:Number})],Ze.prototype,"scale",null),u([d()],Ze.prototype,"heightModelInfo",null),u([d()],Ze.prototype,"spatialReference",void 0),u([d({type:Boolean,constructOnly:!0})],Ze.prototype,"alphaCompositingEnabled",void 0),u([d({constructOnly:!0})],Ze.prototype,"preserveDrawingBufferEnabled",void 0),u([d({type:Boolean})],Ze.prototype,"supersampleScreenshotsEnabled",void 0),u([d({readOnly:!0})],Ze.prototype,"type",void 0),u([d(),yr(t=>t instanceof DOe?t:Bb(NOe,t))],Ze.prototype,"ui",void 0),u([d({type:Boolean,readOnly:!0,dependsOn:["graphicsView.updating","basemapView.updating","basemapTerrain.updating","layerViewManager.updating","layerViewManager.updatingRemaining","_resourceController.updating","_stage.updating","featureTiles.updating","pointsOfInterest.updating","environmentManager.updating","overlay.updating","updatingHandles.updating","featureTreeDebugger.updating","labeler.updating","deconflictor.updating","ready","stationary","inputManager.updating","toolViewManager.updating","analysisViewManager.updating","state.updating"]})],Ze.prototype,"updating",null),u([d()],Ze.prototype,"_updatingObjects",null),u([d()],Ze.prototype,"_updatingObjectsWithProgress",null),u([d({type:Number,readOnly:!0,dependsOn:["updating"]})],Ze.prototype,"updatingProgress",void 0),u([d({type:["global","local"]})],Ze.prototype,"viewingMode",null),u([d({type:lp})],Ze.prototype,"viewpoint",null),u([d({type:Number})],Ze.prototype,"zoom",null),u([d({type:AH})],Ze.prototype,"highlightOptions",void 0),Ze=u([R("esri.views.SceneView")],Ze),function(t){t[t.INCLUDE=0]="INCLUDE",t[t.EXCLUDE=1]="EXCLUDE"}(hO||(hO={}));const eT=C(),Dk=Zi(),che=Ut(),Kxt=Ze;const uhe=document.location.pathname,eTt=uhe.substring(0,uhe.lastIndexOf("/")),tTt=`${document.location.origin}${eTt}/oauth-callback-api.html`;T5.registerOAuthInfos([new Q7({appId:"KojZjH6glligLidj",popup:!0,popupCallbackUrl:tTt})]);window.setOAuthResponseHash=t=>{T5.setOAuthResponseHash(t)};const rTt="https://services2.arcgis.com/cFEFS0EWrhfDeVw9/arcgis/rest/services/SO__3857__CH_Zurich__Buildings_InnerCity/SceneServer",iTt=new URLSearchParams(window.location.search),sTt=new Abe({outFields:["*"],title:"Sample 3D Object Layer",url:iTt.get("url")||rTt}),nTt=new h1e({basemap:"topo-vector",ground:"world-elevation",layers:[sTt]}),oTt=new Kxt({spatialReference:je.WebMercator,viewingMode:"local",container:"viewDiv",map:nTt,qualityProfile:"high",camera:{position:{spatialReference:je.WebMercator,x:950536.3463579026,y:6.0024481828584075e6,z:2058.876304641366},heading:8.074740948860455,tilt:34.11767720840555},environment:{lighting:{directShadowsEnabled:!0}}});window.view=oTt;export{Ont as $,B3e as A,t1t as B,jwe as C,P4 as D,RJe as E,Yct as F,yct as G,wct as H,kJ as I,sJ as J,Xyt as K,Zyt as L,I6 as M,Yyt as N,L4 as O,glt as P,D1t as Q,Z3e as R,$Ye as S,U1t as T,J3e as U,wvt as V,V1t as W,eOe as X,Hct as Y,N6 as Z,BAe as _,zwe as a,_F as a$,Q1t as a0,abt as a1,_bt as a2,bbt as a3,xbt as a4,tct as a5,tOe as a6,tbt as a7,kbt as a8,Wut as a9,pt as aA,F as aB,pu as aC,u as aD,d as aE,R as aF,LEt as aG,TQ as aH,qs as aI,$Et as aJ,XS as aK,h_ as aL,bo as aM,p2t as aN,j5e as aO,O2t as aP,m2t as aQ,IFe as aR,Cf as aS,Oi as aT,Vr as aU,Me as aV,Jd as aW,DW as aX,ZK as aY,cN as aZ,ZS as a_,Sht as aa,jpt as ab,uft as ac,sft as ad,f2t as ae,g2t as af,d2t as ag,Dme as ah,T2t as ai,R2t as aj,x2t as ak,y2t as al,M2t as am,UFe as an,w2t as ao,P2t as ap,I2t as aq,$2t as ar,E2t as as,k5e as at,Te as au,ms as av,uE as aw,Xt as ax,Dr as ay,ae as az,uxe as b,$e as b$,bW as b0,Io as b1,ge as b2,PLe as b3,MLe as b4,ILe as b5,$Le as b6,fSt as b7,mSt as b8,mVe as b9,je as bA,MF as bB,BCt as bC,Zpe as bD,jCt as bE,GCt as bF,kGe as bG,Ve as bH,Ld as bI,WZ as bJ,Ks as bK,Ive as bL,lc as bM,Vi as bN,Oe as bO,tt as bP,Fa as bQ,EKe as bR,b8 as bS,$s as bT,bMt as bU,wMt as bV,qN as bW,Gie as bX,Ske as bY,On as bZ,be as b_,rve as ba,F3 as bb,UVe as bc,G7 as bd,mZ as be,Za as bf,se as bg,C as bh,os as bi,Ee as bj,Fe as bk,de as bl,JW as bm,vV as bn,DVe as bo,Ah as bp,Dw as bq,Zi as br,ie as bs,gf as bt,VO as bu,zo as bv,Mg as bw,gr as bx,yR as by,Ba as bz,yQe as c,Rn as c$,$0e as c0,Fh as c1,Pg as c2,qt as c3,o8e as c4,n8e as c5,SS as c6,S2t as c7,xCt as c8,wCt as c9,eNt as cA,j8e as cB,kE as cC,xw as cD,pw as cE,j_ as cF,kt as cG,gTt as cH,Nk as cI,dhe as cJ,BR as cK,aZ as cL,BVe as cM,_h as cN,yTt as cO,Yye as cP,zP as cQ,pn as cR,J6e as cS,Wg as cT,wu as cU,tE as cV,lce as cW,dce as cX,fu as cY,VGe as cZ,Ur as c_,K as ca,VUe as cb,UUe as cc,Q as cd,Pt as ce,Vb as cf,Oh as cg,X_ as ch,ze as ci,K0 as cj,Pw as ck,iE as cl,wt as cm,yO as cn,eO as co,v_ as cp,f9e as cq,le as cr,jr as cs,ELt as ct,CLt as cu,lot as cv,zg as cw,Y_ as cx,As as cy,N$t as cz,aKe as d,bje as d$,cZ as d0,SSt as d1,Ut as d2,r2 as d3,qa as d4,la as d5,_St as d6,Ws as d7,hb as d8,ia as d9,TF as dA,DF as dB,nSt as dC,ASt as dD,De as dE,ufe as dF,m_ as dG,Ab as dH,J_e as dI,SEt as dJ,ave as dK,Qn as dL,FEt as dM,cn as dN,Iw as dO,f8e as dP,OTt as dQ,w0e as dR,zmt as dS,oe as dT,Vo as dU,gyt as dV,r5t as dW,EJ as dX,Ga as dY,pr as dZ,Sh as d_,IWe as da,na as db,X3t as dc,Z3t as dd,Aie as de,N2 as df,ySt as dg,gSt as dh,di,OR as dj,_r as dk,Gf as dl,Vf as dm,Lqe as dn,D3t as dp,ss as dq,nEe as dr,ay as ds,zw as dt,Eh as du,KXe as dv,QS as dw,pRt as dx,Sw as dy,Hmt as dz,yKe as e,Ts as e$,MHe as e0,L_e as e1,abe as e2,DEt as e3,xpe as e4,lCt as e5,ri as e6,N$ as e7,lEt as e8,_Lt as e9,fW as eA,BSt as eB,hDe as eC,F3t as eD,lre as eE,N3t as eF,Zqe as eG,Cbe as eH,INe as eI,CZe as eJ,l4e as eK,xi as eL,kf as eM,at as eN,me as eO,zO as eP,mOt as eQ,ROt as eR,Mee as eS,dt as eT,uZe as eU,hOt as eV,OVe as eW,y5 as eX,NO as eY,Lw as eZ,x7 as e_,wc as ea,jge as eb,ew as ec,pH as ed,sn as ee,I9e as ef,ECt as eg,xq as eh,RF as ei,ji as ej,NTt as ek,bu as el,Vs as em,E as en,ke as eo,k2 as ep,Tn as eq,aJ as er,$t as es,Lfe as et,OBe as eu,d_ as ev,Gb as ew,pW as ex,dW as ey,Jfe as ez,Wot as f,KSt as f$,w7 as f0,S7 as f1,$N as f2,A_e as f3,$St as f4,tR as f5,NUe as f6,$At as f7,Ms as f8,xAt as f9,F7 as fA,Yf as fB,XCt as fC,ZCt as fD,YBe as fE,EEt as fF,Fvt as fG,Uvt as fH,Pvt as fI,DUt as fJ,tF as fK,G6t as fL,Vvt as fM,bLe as fN,cke as fO,WNe as fP,wat as fQ,xat as fR,mW as fS,Y2e as fT,dLt as fU,hLt as fV,RNe as fW,$F as fX,e2t as fY,r2t as fZ,JSt as f_,yve as fa,TAt as fb,Aft as fc,hEt as fd,bAt as fe,Jf as ff,S0e as fg,__e as fh,Q_e as fi,fZ as fj,syt as fk,Ui as fl,Lo as fm,iyt as fn,kb as fo,$w as fp,K0e as fq,GL as fr,SQ as fs,Uze as ft,kze as fu,Vze as fv,ere as fw,XW as fx,qCt as fy,zOe as fz,UX as g,DR as g$,aa as g0,aNe as g1,pLt as g2,nat as g3,k1e as g4,DC as g5,oi as g6,Xr as g7,Bf as g8,yc as g9,UOt as gA,rm as gB,c1e as gC,h7e as gD,d2 as gE,Xi as gF,f_ as gG,Tb as gH,OV as gI,Ha as gJ,Ud as gK,tZ as gL,_l as gM,yr as gN,J2 as gO,aTt as gP,Cke as gQ,ETt as gR,PTt as gS,uM as gT,Yee as gU,bc as gV,uc as gW,KEt as gX,oTt as gY,sTt as gZ,YF as g_,Hi as ga,LN as gb,Mde as gc,Wk as gd,R_e as ge,IAt as gf,Yfe as gg,dO as gh,bCt as gi,q_ as gj,S_ as gk,sIe as gl,_0e as gm,Gt as gn,n5 as go,K2 as gp,s7e as gq,vO as gr,i_e as gs,e_e as gt,Sc as gu,JF as gv,o7e as gw,T0e as gx,gVe as gy,dg as gz,hQe as h,Fg as h$,A2t as h0,U5e as h1,N5e as h2,_2t as h3,v2t as h4,b2t as h5,C2t as h6,ja as h7,un as h8,Bo as h9,wo as hA,z$t as hB,V$t as hC,B_ as hD,mp as hE,cP as hF,E_ as hG,yyt as hH,GOt as hI,yF as hJ,bXe as hK,gu as hL,mK as hM,ru as hN,op as hO,nMt as hP,MR as hQ,Yi as hR,g5 as hS,ni as hT,nn as hU,Lg as hV,Pi as hW,VAt as hX,CV as hY,SCt as hZ,Fee as h_,yZ as ha,KPt as hb,F2 as hc,Tl as hd,si as he,L_ as hf,mNt as hg,fw as hh,pNt as hi,gNt as hj,a5 as hk,fNt as hl,dht as hm,mht as hn,iK as ho,Li as hp,pht as hq,fht as hr,NBe as hs,x2 as ht,hot as hu,Ii as hv,qk as hw,NCt as hx,ff as hy,UN as hz,eEe as i,NN as i$,mHe as i0,lve as i1,CHe as i2,Sbe as i3,Q1 as i4,Gu as i5,RA as i6,MA as i7,p0e as i8,d5 as i9,n3t as iA,AEt as iB,r3t as iC,gc as iD,ce as iE,gs as iF,_We as iG,Wd as iH,dp as iI,Pb as iJ,LOt as iK,EWe as iL,$Tt as iM,ZMe as iN,Ql as iO,Pq as iP,OIe as iQ,kr as iR,VH as iS,zH as iT,Q2 as iU,oN as iV,i5 as iW,nze as iX,i8e as iY,p5 as iZ,HR as i_,eE as ia,Rr as ib,ove as ic,iZe as id,a0t as ie,Oxt as ig,sh as ih,WK as ii,zR as ij,rke as ik,pO as il,RTt as im,l2t as io,NEt as ip,$d as iq,b0e as ir,Vne as is,rc as it,vLe as iu,t3t as iv,eCt as iw,a9e as ix,KT as iy,R7 as iz,bw as j,lr as j$,VVe as j0,zVe as j1,VZ as j2,Zg as j3,pZ as j4,Zye as j5,Wze as j6,qze as j7,Hze as j8,Sze as j9,Q0e as jA,nve as jB,Vje as jC,kje as jD,Fje as jE,Gte as jF,ua as jG,EHe as jH,Dg as jI,m2 as jJ,Kb as jK,sEt as jL,yK as jM,tu as jN,Ff as jO,vh as jP,$O as jQ,CZ as jR,kVe as jS,SZ as jT,rFt as jU,Gmt as jV,T3 as jW,zC as jX,N as jY,ue as jZ,ki as j_,Y0e as ja,lze as jb,uze as jc,Rye as jd,qVe as je,WVe as jf,ZVe as jg,YVe as jh,JVe as ji,QVe as jj,KVe as jk,eze as jl,tze as jm,rze as jn,ize as jo,Kfe as jp,sze as jq,sve as jr,WF as js,O_ as jt,_Be as ju,fBe as jv,PVe as jw,t_e as jx,a7 as jy,s5 as jz,C0t as k,CY as k$,Kr as k0,qd as k1,fs as k2,Ye as k3,ui as k4,Jmt as k5,sXe as k6,G0 as k7,Hs as k8,vo as k9,sm as kA,ot as kB,Tc as kC,we as kD,B as kE,pi as kF,Er as kG,Uo as kH,Pr as kI,Cr as kJ,br as kK,At as kL,oy as kM,F5 as kN,rv as kO,Ol as kP,c6 as kQ,Vt as kR,Wf as kS,H_ as kT,iv as kU,d6 as kV,KY as kW,u6 as kX,TE as kY,zlt as kZ,IX as k_,JX as ka,y8t as kb,jO as kc,$$t as kd,iO as ke,yV as kf,vSt as kg,I4 as kh,Mi as ki,Lt as kj,mh as kk,he as kl,Tae as km,dS as kn,aMt as ko,Le as kp,Ls as kq,wr as kr,vc as ks,xl as kt,b as ku,ps as kv,vu as kw,Je as kx,Re as ky,R4 as kz,qat as l,TEt as l$,UAt as l0,Xp as l1,xO as l2,oLt as l3,eMt as l4,y6 as l5,EAe as l6,No as l7,pZe as l8,lOt as l9,JK as lA,jSt as lB,n2 as lC,cEt as lD,Zs as lE,_Tt as lF,tw as lG,WCt as lH,c_e as lI,Uq as lJ,R_ as lK,xT as lL,DUe as lM,tAt as lN,a_e as lO,Bb as lP,VD as lQ,UEt as lR,mLe as lS,w_ as lT,i2t as lU,UC as lV,uMe as lW,cMe as lX,lMe as lY,c4e as lZ,GC as l_,pOt as la,bbe as lb,Rxe as lc,WLe as ld,e2 as le,l3t as lf,Z0 as lg,aXe as lh,hhe as li,cZe as lj,or as lk,ZZ as ll,wge as lm,Br as ln,te as lo,H3t as lp,PWe as lq,hMe as lr,du as ls,lTt as lt,JTt as lu,vq as lv,Hbt as lw,Jr as lx,C_e as ly,I$ as lz,X0t as m,zZ as m$,fMe as m0,vTt as m1,QSt as m2,KS as m3,aN as m4,nLe as m5,t2t as m6,gMe as m7,lN as m8,Gr as m9,FSt as mA,Iat as mB,Wht as mC,zht as mD,Bht as mE,Xht as mF,jht as mG,Hht as mH,cp as mI,Ght as mJ,ha as mK,Zht as mL,QR as mM,j5 as mN,dn as mO,Mat as mP,qht as mQ,q5 as mR,Lh as mS,ev as mT,GS as mU,Lx as mV,_ve as mW,wve as mX,BZ as mY,V7e as mZ,xve as m_,hFe as ma,O_e as mb,wf as mc,VR as md,oNt as me,wH as mf,VBe as mg,AR as mh,aW as mi,K6 as mj,Nr as mk,uOt as ml,nr as mm,hc as mn,zW as mo,Tie as mp,ECe as mq,ACe as mr,Pu as ms,rO as mt,Fb as mu,_Ce as mv,ydt as mw,hht as mx,Pat as my,Q2e as mz,P3e as n,dWe as n$,PK as n0,MAt as n1,SAt as n2,CAt as n3,L7e as n4,rGe as n5,gGe as n6,qge as n7,aUe as n8,OAt as n9,YSt as nA,qSt as nB,ZSt as nC,WSt as nD,XSt as nE,au as nF,s2e as nG,wF as nH,Ig as nI,IH as nJ,Yg as nK,wR as nL,Uw as nM,Vg as nN,hi as nO,fX as nP,mu as nQ,uX as nR,JS as nS,vke as nT,Of as nU,hNt as nV,$ as nW,hSt as nX,ug as nY,U5 as nZ,Xf as n_,RAt as na,PAt as nb,Xn as nc,J2t as nd,V3t as ne,iTe as nf,Fw as ng,Ce as nh,P_e as ni,Ir as nj,ZR as nk,G3t as nl,fe as nm,Dh as nn,z0 as no,TL as np,AAt as nq,aF as nr,Ew as ns,Bmt as nt,Vmt as nu,nXe as nv,SO as nw,a3t as nx,RVe as ny,IF as nz,qvt as o,tm as o$,wS as o0,Imt as o1,VJe as o2,ca as o3,CPt as o4,SPt as o5,EPt as o6,DOt as o7,h2e as o8,sMt as o9,up as oA,sr as oB,M2 as oC,Ft as oD,go as oE,Wt as oF,uu as oG,h6 as oH,tv as oI,mSe as oJ,K_ as oK,zi as oL,ASe as oM,et as oN,AY as oO,Bd as oP,oEt as oQ,ut as oR,Gre as oS,Dq as oT,Ph as oU,pX as oV,X2t as oW,yo as oX,NOt as oY,VSt as oZ,Bre as o_,Z1e as oa,Us as ob,fG as oc,hTt as od,FCt as oe,mLt as of,fLt as og,Zve as oh,KAt as oi,Dfe as oj,sE as ok,Aw as ol,L2t as om,EK as on,u2t as oo,Sme as op,oE as oq,sZ as or,CS as os,_8e as ot,y8e as ou,r5 as ov,Nye as ow,F8e as ox,zye as oy,AN as oz,$3e as p,bve as p$,b5 as p0,DZ as p1,Dt as p2,Rh as p3,Zoe as p4,$Y as p5,WTt as p6,MMe as p7,aAt as p8,oAt as p9,Aqe as pA,z3t as pB,Rie as pC,QQe as pD,BO as pE,h2 as pF,Y2t as pG,Ytt as pH,mX as pI,zZe as pJ,pc as pK,$5 as pL,F_e as pM,St as pN,NSt as pO,She as pP,LSt as pQ,Ide as pR,f6e as pS,Mq as pT,Aq as pU,sy as pV,Bie as pW,vMt as pX,OLt as pY,wD as pZ,Q0t as p_,sAt as pa,tS as pb,O7e as pc,nAt as pd,Ibe as pe,FZe as pf,kAt as pg,ta as ph,NXe as pi,kO as pj,HNe as pk,rme as pl,yye as pm,uA as pn,sLe as po,NW as pp,vje as pq,y6e as pr,_6e as ps,xo as pt,ei as pu,pa as pv,C0e as pw,u2 as px,sbe as py,Al as pz,Xvt as q,yLt as q$,fqe as q0,OSt as q1,Qq as q2,dDe as q3,DDe as q4,WGe as q5,NGe as q6,FGe as q7,fhe as q8,mc as q9,tDe as qA,_u as qB,x6 as qC,Sr as qD,$i as qE,pp as qF,Cc as qG,Lr as qH,Tr as qI,Uh as qJ,su as qK,bSe as qL,$Ot as qM,Tst as qN,Rl as qO,Ue as qP,yu as qQ,PZe as qR,rnt as qS,D2 as qT,iNe as qU,nu as qV,yot as qW,Pj as qX,MY as qY,x3 as qZ,p_ as q_,zde as qa,STt as qb,OQ as qc,Bge as qd,wAt as qe,xGe as qf,NAt as qg,Hve as qh,Mh as qi,g2 as qj,zHe as qk,KZ as ql,sqe as qm,Nw as qn,jGe as qo,nh as qp,dr as qq,EF as qr,j2t as qs,Ng as qt,x_ as qu,Vge as qv,o2 as qw,CTt as qx,NF as qy,eG as qz,Jvt as r,U_e as r$,kne as r0,vLt as r1,HSt as r2,cLt as r3,q2e as r4,Z2e as r5,j2e as r6,Hne as r7,Lat as r8,e3t as r9,cw as rA,V5 as rB,Ec as rC,ny as rD,_o as rE,Ke as rF,bi as rG,Mge as rH,sOt as rI,nOt as rJ,aOt as rK,VW as rL,p8t as rM,DXe as rN,H4t as rO,_Ot as rP,vOt as rQ,bf as rR,qR as rS,Nfe as rT,pbe as rU,zAt as rV,ZN as rW,Wa as rX,S8e as rY,Eb as rZ,q3t as r_,Zfe as ra,fDe as rb,MSt as rc,QLe as rd,nDe as re,X2e as rf,Jq as rg,xSt as rh,Xye as ri,q8e as rj,HF as rk,za as rl,tOt as rm,iOt as rn,nEt as ro,j6e as rp,O1 as rq,K3t as rr,vZe as rs,c4 as rt,uEt as ru,p$t as rv,uSe as rw,iJ as rx,cu as ry,SV as rz,k3e as s,Lot as s$,$_ as s0,kBe as s1,j3t as s2,RWe as s3,sw as s4,If as s5,TS as s6,fn as s7,jB as s8,Eqe as s9,iSt as sA,jd as sB,Iye as sC,R3 as sD,XF as sE,FR as sF,h_e as sG,I6e as sH,DCt as sI,Wft as sJ,iat as sK,tat as sL,X$t as sM,Z$t as sN,kg as sO,xLt as sP,Zn as sQ,ko as sR,J4t as sS,YY as sT,jo as sU,tSt as sV,Qc as sW,YP as sX,u3t as sY,P7 as sZ,s3t as s_,aqe as sa,nqe as sb,fg as sc,aq as sd,mqe as se,ATt as sf,LLe as sg,T_ as sh,B3t as si,F6 as sj,XN as sk,Nlt as sl,v8t as sm,h3t as sn,w8t as so,b8t as sp,PR as sq,Cn as sr,kSt as ss,zre as st,xge as su,AHe as sv,CCt as sw,y_e as sx,qw as sy,EVe as sz,N3e as t,W3t as t$,ZF as t0,Mw as t1,Zft as t2,Is as t3,dAe as t4,pmt as t5,Lge as t6,vhe as t7,WOe as t8,DSt as t9,TOt as tA,rE as tB,xOt as tC,Bt as tD,kye as tE,Vye as tF,F$t as tG,wOt as tH,dOt as tI,H0e as tJ,jke as tK,Hke as tL,EAt as tM,mje as tN,uCt as tO,WB as tP,C8e as tQ,x5 as tR,kve as tS,Nve as tT,OF as tU,iN as tV,Hg as tW,A5 as tX,g_ as tY,P5 as tZ,mbe as t_,$et as ta,EOt as tb,COt as tc,m8t as td,dX as te,bOt as tf,gOt as tg,yOt as th,fOt as ti,KI as tj,RSe as tk,pvt as tl,Yqe as tm,oqe as tn,rOt as to,SOt as tp,Jqe as tq,IBe as tr,bre as ts,qS as tt,tMt as tu,y2 as tv,zBe as tw,Ps as tx,rZe as ty,yb as tz,nxe as u,uTt as u$,ZEe as u0,xCe as u1,Xde as u2,obe as u3,wL as u4,cCt as u5,OOt as u6,AOt as u7,_2 as u8,CWe as u9,Wve as uA,MTt as uB,ule as uC,BH as uD,id as uE,Q4 as uF,pSt as uG,dSt as uH,AF as uI,plt as uJ,YS as uK,cq as uL,d3t as uM,Xut as uN,mw as uO,QFt as uP,K4 as uQ,nc as uR,oc as uS,HH as uT,GH as uU,qH as uV,jH as uW,hle as uX,m8e as uY,uje as uZ,zSt as u_,xg as ua,uJ as ub,T6 as uc,Yr as ud,P6t as ue,UCt as uf,U3t as ug,wq as uh,xTt as ui,WO as uj,bO as uk,k$t as ul,Xwe as um,tZe as un,oOt as uo,a_ as up,gWe as uq,hZe as ur,fre as us,cOt as ut,fK as uu,Kmt as uv,zF as uw,Ht as ux,GOe as uy,qve as uz,vJe as v,wV as v$,_5t as v0,USt as v1,SVe as v2,c3t as v3,ac as v4,wTt as v5,x8e as v6,Fct as v7,jc as v8,vr as v9,dle as vA,GFt as vB,qFt as vC,ab as vD,zFt as vE,tk as vF,uD as vG,El as vH,$h as vI,O2e as vJ,ch as vK,Mgt as vL,Igt as vM,DBe as vN,IW as vO,u6e as vP,TMe as vQ,xN as vR,SN as vS,RO as vT,c6e as vU,p3t as vV,jxt as vW,h2t as vX,Fve as vY,CA as vZ,xS as v_,hn as va,ks as vb,Et as vc,wi as vd,Fo as ve,xY as vf,jf as vg,h$t as vh,Ct as vi,Tt as vj,Xe as vk,QEt as vl,uLt as vm,m3 as vn,SDe as vo,E5 as vp,eN as vq,CF as vr,BLe as vs,zLe as vt,bSt as vu,$$e as vv,jFt as vw,KFt as vx,rCe as vy,lb as vz,Vwe as w,cW as w$,Xa as w0,qut as w1,Hut as w2,LTt as w3,aEt as w4,PF as w5,lMt as w6,cMt as w7,JQe as w8,oMt as w9,Mle as wA,x7e as wB,hZ as wC,S9e as wD,dZ as wE,u0e as wF,jZ as wG,h0e as wH,fGe as wI,B7 as wJ,Bze as wK,Gze as wL,jze as wM,fut as wN,TSt as wO,Jle as wP,qle as wQ,lDe as wR,Wle as wS,cce as wT,Zle as wU,GSt as wV,ece as wW,yce as wX,_ce as wY,vce as wZ,RSt as w_,sX as wa,PSt as wb,UWe as wc,dc as wd,A_ as we,pWe as wf,p9e as wg,ENe as wh,H6e as wi,bLt as wj,gLt as wk,B9e as wl,sCt as wm,kB as wn,o9 as wo,a9 as wp,fTt as wq,mTt as wr,aLt as ws,M9e as wt,M_ as wu,Ude as wv,G7e as ww,U7e as wx,T1 as wy,Rle as wz,CJe as x,SUe as x$,mfe as x0,ESt as x1,dNe as x2,gDe as x3,CSt as x4,bce as x5,ISt as x6,lAt as x7,vAt as x8,mAt as x9,cAt as xA,Rft as xB,C7e as xC,gW as xD,MO as xE,CEt as xF,u8e as xG,A8e as xH,fo as xI,t5 as xJ,c2 as xK,vGe as xL,FAt as xM,$Ne as xN,DTt as xO,mye as xP,n2t as xQ,c2t as xR,LF as xS,Eme as xT,mFe as xU,aMe as xV,pTt as xW,xP as xX,Qs as xY,GNe as xZ,OEt as x_,fAt as xa,Eft as xb,gAt as xc,yAt as xd,Dte as xe,Fte as xf,Nte as xg,dAt as xh,pAt as xi,Ble as xj,$le as xk,Lle as xl,Dle as xm,tce as xn,Oce as xo,Mce as xp,Gle as xq,Rce as xr,qF as xs,FN as xt,_At as xu,S7e as xv,E7e as xw,uAt as xx,hAt as xy,uve as xz,z3 as y,Tge as y0,eEt as y1,wEt as y2,xEt as y3,BEt as y4,YEt as y5,PCt as y6,HCt as y7,iAt as y8,MOt as y9,L$t as ya,INt as yb,Kvt as z};
