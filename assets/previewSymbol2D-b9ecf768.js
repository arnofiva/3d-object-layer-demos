import{eI as z,eH as w,eJ as O,eK as P,eL as A,aB as B,eM as S,eN as W,bd as F,eO as H,eP as R,eQ as x,bW as V}from"./index-cdda5707.js";import{s as j}from"./colorUtils-c9a97827.js";const T="picture-fill",I="picture-marker",J="simple-fill",K="simple-line",N="simple-marker",Q="text",U="Aa",$=z.size,L=z.maxSize,G=z.maxOutlineSize,X=z.lineWidth,E=225,Y=document.createElement("canvas");function Z(a,e){const n=Y.getContext("2d"),t=[];return e&&(e.weight&&t.push(e.weight),e.size&&t.push(e.size+"px"),e.family&&t.push(e.family)),n.font=t.join(" "),n.measureText(a).width}const _=7.2/2.54,ee=72/2.54;function ae(a){if(a.length===0)return 0;if(a.length>2){const e=V(1),n=parseFloat(a);switch(a.slice(-2)){case"px":return n;case"pt":return n*e;case"in":return 72*n*e;case"pc":return 12*n*e;case"mm":return n*_*e;case"cm":return n*ee*e}}return parseFloat(a)}function k(a){const e=a?.size;return{width:e!=null&&typeof e=="object"&&"width"in e?w(e.width):null,height:e!=null&&typeof e=="object"&&"height"in e?w(e.height):null}}async function te(a,e){const n=e.fill,t=a.color;if(n?.type==="pattern"&&t&&a.type!==T){const o=await H(n.src,t.toCss(!0));n.src=o,e.fill=n}}async function ne(a,e,n,t){if(!("font"in a)||!a.font||e.shape.type!=="text")return;try{await R(a.font)}catch{}const{width:o}=k(t),r=/[\uE600-\uE6FF]/.test(e.shape.text);o!=null||r||(n[0]=Z(e.shape.text,{weight:e.font?.weight,size:e.font?.size,family:e.font?.family}))}function le(a,e,n,t,o){if(a.haloColor!=null&&a.haloSize!=null){o.masking??(o.masking=n.map(()=>[]));const r=w(a.haloSize);t[0]+=r,t[1]+=r,n.unshift([{...e,fill:null,stroke:{color:a.haloColor,width:2*r,join:"round",cap:"round"}}]),o.masking.unshift([{shape:{type:"rect",x:0,y:0,width:t[0]+2*x,height:t[1]+2*x},fill:[255,255,255],stroke:null},{...e,fill:[0,0,0,0],stroke:null}])}a.backgroundColor==null&&a.borderLineColor==null||(t[0]+=2*x,t[1]+=2*x,n.unshift([{shape:{type:"rect",x:0,y:0,width:t[0],height:t[1]},fill:a.backgroundColor,stroke:{color:a.borderLineColor,width:w(a.borderLineSize)}}]),o.masking?.unshift([]))}function D(a,e){return a>e?"dark":"light"}function ie(a,e){const n=typeof e?.size=="number"?e?.size:null,t=n!=null?w(n):null,o=e?.maxSize!=null?w(e.maxSize):null,r=e?.rotation!=null?e.rotation:"angle"in a?a.angle:null,y=O(a);let m=P(a);se(a,245)!=="dark"||e?.ignoreWhiteSymbols||(m={width:.75,...m,color:"#bdc3c7"});const h={shape:null,fill:y,stroke:m,offset:[0,0]};m?.width&&(m.width=Math.min(m.width,G));const p=m?.width||0;let g=e?.size!=null&&(e?.scale==null||e?.scale),l=0,i=0,v=!1;switch(a.type){case N:{const c=a.style,{width:u,height:s}=k(e),b=u===s&&u!=null?u:t??Math.min(w(a.size),o||L);switch(l=b,i=b,c){case"circle":h.shape={type:"circle",cx:0,cy:0,r:.5*b},g||(l+=p,i+=p);break;case"cross":h.shape={type:"path",path:[{command:"M",values:[0,.5*i]},{command:"L",values:[l,.5*i]},{command:"M",values:[.5*l,0]},{command:"L",values:[.5*l,i]}]};break;case"diamond":h.shape={type:"path",path:[{command:"M",values:[0,.5*i]},{command:"L",values:[.5*l,0]},{command:"L",values:[l,.5*i]},{command:"L",values:[.5*l,i]},{command:"Z",values:[]}]},g||(l+=p,i+=p);break;case"square":h.shape={type:"path",path:[{command:"M",values:[0,0]},{command:"L",values:[l,0]},{command:"L",values:[l,i]},{command:"L",values:[0,i]},{command:"Z",values:[]}]},g||(l+=p,i+=p),r&&(v=!0);break;case"triangle":h.shape={type:"path",path:[{command:"M",values:[.5*l,0]},{command:"L",values:[l,i]},{command:"L",values:[0,i]},{command:"Z",values:[]}]},g||(l+=p,i+=p),r&&(v=!0);break;case"x":h.shape={type:"path",path:[{command:"M",values:[0,0]},{command:"L",values:[l,i]},{command:"M",values:[l,0]},{command:"L",values:[0,i]}]},r&&(v=!0);break;case"path":h.shape={type:"path",path:a.path||""},g||(l+=p,i+=p),r&&(v=!0),g=!0}break}case K:{const{width:c,height:u}=k(e),s=u??t??p,b=c??X;m&&(m.width=s),l=b,i=s;const f=h?.stroke?.cap||"butt",d=f==="round";g=!0,h.stroke&&(h.stroke.cap=f==="butt"?"square":f),h.shape={type:"path",path:[{command:"M",values:[d?s/2:0,i/2]},{command:"L",values:[d?l-s/2:l,i/2]}]};break}case T:case J:{const c=typeof e?.symbolConfig=="object"&&!!e?.symbolConfig?.isSquareFill,{width:u,height:s}=k(e);l=!c&&u!==s||u==null?t??$:u,i=!c&&u!==s||s==null?l:s,g||(l+=p,i+=p),g=!0,h.shape=c?{type:"path",path:[{command:"M",values:[0,0]},{command:"L",values:[l,0]},{command:"L",values:[l,i]},{command:"L",values:[0,i]},{command:"L",values:[0,0]},{command:"Z",values:[]}]}:A.fill[0];break}case I:{const c=Math.min(w(a.width),o||L),u=Math.min(w(a.height),o||L),{width:s,height:b}=k(e),f=s===b&&s!=null?s:t??Math.max(c,u),d=c/u;l=d<=1?Math.ceil(f*d):f,i=d<=1?f:Math.ceil(f/d),h.shape={type:"image",x:-Math.round(l/2),y:-Math.round(i/2),width:l,height:i,src:a.url||""},r&&(v=!0);break}case Q:{const c=a,u=e?.overrideText||c.text||U,s=c.font,{width:b,height:f}=k(e),d=f??t??Math.min(w(s.size),o||L),q=Z(u,{weight:s.weight,size:d,family:s.family}),M=/[\uE600-\uE6FF]/.test(u);l=b??(M?d:q),i=d;let C=.25*ae((s?d:0).toString());M&&(C+=5),h.shape={type:"text",text:u,x:c.xoffset||0,y:c.yoffset||C,align:"middle",alignBaseline:c.verticalAlignment,decoration:s&&s.decoration,rotated:c.rotated,kerning:c.kerning},h.font=s&&{size:d,style:s.style,decoration:s.decoration,weight:s.weight,family:s.family};break}}return{shapeDescriptor:h,size:[l,i],renderOptions:{node:e?.node,scale:g,opacity:e?.opacity,rotation:r,useRotationSize:v,effectView:e?.effectView,ariaLabel:e?.ariaLabel}}}async function ce(a,e){const{shapeDescriptor:n,size:t,renderOptions:o}=ie(a,e);if(!n.shape)throw new B("symbolPreview: renderPreviewHTML2D","symbol not supported.");await te(a,n),await ne(a,n,t,e);const r=[[n]];if(typeof e?.symbolConfig=="object"&&e?.symbolConfig?.applyColorModulation){const y=.6*t[0];r.unshift([{...n,offset:[-y,0],fill:S(n.fill,-.3)}]),r.push([{...n,offset:[y,0],fill:S(n.fill,.3)}]),t[0]+=2*y,o.scale=!1}return a.type==="text"&&le(a,n,r,t,o),W(r,t,o)}function se(a,e=E){const n=O(a),t=P(a),o=!n||"type"in n?null:new F(n),r=t?.color?new F(t?.color):null,y=o?D(j(o),e):null,m=r?D(j(r),e):null;return m?y?y===m?y:e>=E?"light":"dark":m:y}export{se as getContrastingBackgroundTheme,ie as getRenderSymbolParameters,ce as previewSymbol2D};
